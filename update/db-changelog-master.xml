<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.22.xsd">

    <!-- Создание таблицы без комментариев -->
    <changeSet id="create-table-DBDUI_REPORTPOSTINFO_DBT" author="borisov-tyur" failOnError="false">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="DBDUI_REPORTPOSTINFO_DBT"/>
            </not>
        </preConditions>
        <createTable tableName="DBDUI_REPORTPOSTINFO_DBT">
            <column name="T_FORM" type="VARCHAR(60)"/>
            <column name="T_LIMITDATE" type="DATE"/>
            <column name="T_SENDDAY" type="DATE"/>
            <column name="T_REGDATE" type="DATE"/>
            <column name="T_STATUS" type="VARCHAR(250)"/>
            <column name="T_MESSAGE" type="VARCHAR(500)"/>
        </createTable>
    </changeSet>

    <!-- Комментарии для Oracle -->
    <changeSet id="oracle-comments" author="borisov-tyur" dbms="oracle" failOnError="false">
        <preConditions onFail="MARK_RAN">
            <dbms type="oracle"/>
        </preConditions>
        <sqlFile path="oracle/table_comments.sql" relativeToChangelogFile="true" stripComments="true"/>
    </changeSet>

    <!-- Комментарии для PostgreSQL -->
    <changeSet id="postgres-comments" author="borisov-tyur" dbms="postgresql" failOnError="false">
        <preConditions onFail="MARK_RAN">
            <dbms type="postgresql"/>
        </preConditions>
        <sqlFile path="postgresql/table_comments.sql" relativeToChangelogFile="true" stripComments="true"/>
    </changeSet>

    <!-- Создание индекса по T_LIMITDATE -->
    <changeSet id="create-index-on-T_LIMITDATE" author="borisov-tyur" failOnError="false">
        <preConditions onFail="MARK_RAN">
            <and>
                <tableExists tableName="DBDUI_REPORTPOSTINFO_DBT"/>
                <not>
                    <indexExists indexName="IDX_DBPST_T_LIMITDATE"/>
                </not>
            </and>
        </preConditions>
        <createIndex
                tableName="DBDUI_REPORTPOSTINFO_DBT"
                indexName="IDX_DBPST_T_LIMITDATE"
                unique="false">
            <column name="T_LIMITDATE"/>
        </createIndex>
    </changeSet>

    <!-- Oracle-специфичные объекты -->
    <changeSet id="oracle-specific-objects" author="borisov-tyur" dbms="oracle" failOnError="false">
        <preConditions onFail="MARK_RAN">
            <dbms type="oracle"/>
        </preConditions>
        <sqlFile path="oracle/ControlDateReportRun.sql" relativeToChangelogFile="true" stripComments="true"/>
    </changeSet>

    <!-- PostgreSQL-специфичные объекты -->
    <changeSet id="postgres-specific-objects" author="borisov-tyur" dbms="postgresql" failOnError="false">
        <preConditions onFail="MARK_RAN">
            <dbms type="postgresql"/>
        </preConditions>
        <sqlFile path="postgresql/ControlDateReportRun.sql" relativeToChangelogFile="true" stripComments="true"/>
    </changeSet>

    <!-- Oracle JSON wrapper function -->
    <changeSet id="oracle-json-wrapper-function" author="borisov-tyur" dbms="oracle" failOnError="false">
        <preConditions onFail="MARK_RAN">
            <dbms type="oracle"/>
        </preConditions>
        <sqlFile path="oracle/ControlDateReportRunJsonWrapper.sql" relativeToChangelogFile="true" stripComments="true"/>
    </changeSet>

    <!-- PostgreSQL JSON wrapper function -->
    <changeSet id="postgres-json-wrapper-function" author="borisov-tyur" dbms="postgresql" failOnError="false">
        <preConditions onFail="MARK_RAN">
            <dbms type="postgresql"/>
        </preConditions>
        <sqlFile path="postgresql/ControlDateReportRunJsonWrapper.sql" relativeToChangelogFile="true" stripComments="true"/>
    </changeSet>

</databaseChangeLog>