/*06.02.2015 voikin*/
import general,/* "empty.cls", "mtforms.cls", */utils;

/*
Функция возвращает дату через p_Days рабочих дней в пределах базового календаря от даты p_CurDate в <направлении> p_StepFromDT.
Если искомая дата находится вне календаря, то возвращается NULL.

p_CalTyp - ИД типа календаря из справочника SCLNDR;
p_CurDate - дата;
p_StepFromDT - направление выбора даты (1 - следующая, 0 - предыдущая);
p_Days - количество рабочих дней.
*/
macro GETWORKDAY(P_CALTYP, P_CURDATE, P_STEPFROMDT, P_DAYS)

  var SQLtext;
  var q;
  var ret = Date(0,0,0);

  SQLtext = " begin "+
            "  :p1 := RSP_CALENDAR.GETWORKDAY(:p2, :p3, :p4, :p5); "+
            " end;";
  q = ExecQuery (SQLtext, ret, P_CALTYP, P_CURDATE, P_STEPFROMDT, P_DAYS);

  if (not TstObj (q))
    RunError (toansi("Функция получения даты GETWORKDAY: ошибка при вызове функции"));
  end;

  ret = q.GetVariable("p1");

  return ret;

end;

macro ShowMainCalendar()
  ShowCalendar(CLNDR_TYPE_MAIN);
end;

macro ShowKorrCalendar(Korr)
  if(ValType(Korr.nkorr.id_sclndr) == V_UNDEF)
    MsgBox("Для контрагента "+int(Korr.nkorr.CODE)+" календарь не задан!");
    return;
  end;
  ShowCalendar(int(Korr.nkorr.id_sclndr));
end;

macro ShowIDCalendar(clndr)
  ShowCalendar(clndr);
end;
