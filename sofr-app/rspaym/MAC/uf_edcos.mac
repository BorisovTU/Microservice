/*08.06.2015 Karlov*/

import uf_general, uf_utils;

macro SetEDCOS(EDCOS,EDNO,TYP)

  EDCOS.EDNO       = EDNO;
  EDCOS.EDDATE     = {CurDate};
  EDCOS.EDAUTHOR   = UFEDAuthor;
  if(TYP == "ED501")
    EDCOS.EDRECEIVER = "";
  else
    EDCOS.EDRECEIVER = UFEDReceiver;
  end;
  EDCOS.TYP        = TYP;
  EDCOS.USERS      = {Oper};
  EDCOS.IN_OUT     = 1;
  EDCOS.STATUS     = 0;

end;

macro GetEDREceiverFromBIC(BIC)
/*Возвращает значение для поля EDReceiver на основании БИКа (BIC):
два первых символа отрезает, в конец добавляет "000"*/

  return SubStr(BIC,3)+"000";
end;

/*функция создания конверта ED501*/
macro create_501

  var EDNo = 0;
  var QueryObj;

  EDNo = GetEDNo(UFSysCodeCOS);

  QueryObj = TRslPayDoc(Type_Doc_ED501,0);

  if(ValType(QueryObj) != V_GENOBJ)
    RunError("Не удалось создать объект");
  end;

  SetEDCOS(QueryObj.EDCOS,EDNo,"ED501",UFSysCodeCOS);

  return QueryObj;

end;

/*функция создания ЭС512*/
macro create_512

  var EDNo = 0;
  var QueryObj;

  EDNo = GetEDNo(UFSysCodeCOS);

  QueryObj = TRslPayDoc(Type_Doc_ED512, 0);

  if(ValType(QueryObj) != V_GENOBJ)
    RunError(toansi("Не удалось создать объект"));
  end;

  SetEDCOS(QueryObj.EDCOS,EDNo,"ED512",UFSysCodeCOS);

  return QueryObj;

end;

/*функция создания ЭС*/
macro create_EDCOS(TYP)

  var EDNo = 0;
  var QueryObj;

  /*Получение EDNo для запроса*/
  EDNo = GetEDNo(UFSysCodeCOS);

  QueryObj = TRslPayDoc(Type_Doc_EDCOS, 0);

  if(ValType(QueryObj) != V_GENOBJ)
    RunError(toansi("Не удалось создать объект"));
  end;

  SetEDCOS(QueryObj.EDCOS,EDNo,TYP,UFSysCodeCOS);

  return QueryObj;
end;


/*-------Макрофункции пунктов меню списка ЭС-------------*/
macro ED501_COS()

  var obj = create_501();
  RefreshScreen;
  return obj;

end;

macro ED512_COS()

  var obj = create_512();
  RefreshScreen;
  return obj;

end;


/*-------Макрофункции пунктов меню панели-------------*/
/*macro create_ED512_EDCOS(edcos)

  var obj;

  if(edcos.edcos.typ == "ED512")
    obj = create_512(Type_Doc_ED512,edcos.edcos.ID_EDCOS);
    RefreshScreen;
    return obj;
  else
    MsgBox("Операция не соответствует типу ЭС");
  end;

end;
*/

/*-------Макрофункции проверки заполнения полей форм------------*/
macro Check_ED501(ED)
  if(ED.EDCOS.EDRECEIVER == "")
    MsgBox("Получатель должен быть заполнен");
    return false;
  elif(ED.ED501.PROPDOC == "")
    MsgBox("Документ должен быть заполнен");
    return false;
  end;
  return true;
end;

macro Check_ED512(ED)
  if(not ED.ED512.ID_SCDICTUPD)
    MsgBox("Тип модификации должен быть заполнен");
    return false;
  elif((ED.ED512.UISSENDES == "")and(ED.ED512.BICRECEIVER == ""))
    MsgBox("УИС Отправителя ЭС503 или БИК Получателя должен быть заполнен");
    return false;
  elif((ED.ED512.BICRECEIVER != "")and((ED.ED512.UISSENDFS == "")or(ED.ED512.BICSENDFS == "")))
    MsgBox("УИС и БИК Отправителя ЭС503 должны быть заполнены");
    return false;
  elif((ED.ED512.BICRECEIVER == "")and((ED.ED512.UISSENDFS != "")and(ED.ED512.BICSENDFS == "")))
    MsgBox("БИК Получателя и БИК Отправителя ЭС503 должны быть заполнены");
    return false;
  elif((ED.ED512.BICRECEIVER == "")and((ED.ED512.UISSENDFS == "")and(ED.ED512.BICSENDFS != "")))
    MsgBox("БИК Получателя и УИС Отправителя ЭС503 должны быть заполнены");
    return false;
  end;
  return true;
end;
