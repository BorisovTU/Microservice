import ws_file, ws_utils;


macro ad_s(params,button)

   if(button != MessageBoxButtonType.Ok)
     return;
   end;

   var RepStr;
   var Model = Xml2Rsl(params);

   ADGroupSynhro(Model.DOMENSGROUP8ID_DOMENSGROUP,RepStr);

   var idrep = SaveReportHTML(RepStr, "adsynhro.html","");
   return GetReportFile(idrep, "adsynhro.html");
end;


macro ads(Params)
  var   Pay = Params.Model;

  var mes = IMessage(null, "Выполнить синхронизацию?", MessageBoxType.Question,
                      makeArray(MessageBoxButtonType.Ok,MessageBoxButtonType.Cancel),
                      WebServiceCallback("ad_w", "ad_s", Rsl2Xml(Params.Model)));
  return WebServiceResult(WebServiceResultType.Message, mes);
end;




macro adlist_s(params,button)

   if(button != MessageBoxButtonType.Ok)
     return;
   end;

   var log,RepStr = "";
   var cmd = TRslOraQuery();
   cmd.sqlText ="select id_domensgroup from DOMENSGROUP";
   if(not cmd.Execute)
     return WebServiceResult(WebServiceResultType.Message, IMessage("Ошибка", "ошибка в запросе  - "+cmd.Error, MessageBoxType.Error));
   end;

   while(NOT cmd.Eof)
     ADGroupSynhro(int(cmd.Rec.id_domensgroup),log);
     RepStr=RepStr+log+RN;
     cmd.Next();
   end;


   var idrep = SaveReportHTML(RepStr, "adsynhro.html","");
   return GetReportFile(idrep, "adsynhro.html");
end;


macro ads_list(Params)

  var mes = IMessage(null, "Выполнить синхронизацию всех групп?", MessageBoxType.Question,
                      makeArray(MessageBoxButtonType.Ok,MessageBoxButtonType.Cancel),
                      WebServiceCallback("ad_w", "adlist_s"));
  return WebServiceResult(WebServiceResultType.Message, mes);
end;
