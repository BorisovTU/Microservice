


macro Cr_Card()
  var fr;

  if(not VclGetInt(fr,"Введите код формы","Создание простой карточки",0,5))
     return;
  end;


  var cmd = TRslOraQuery();
  var upd = TRslOraQuery();

  cmd.sqlText ="select t.*, tb.name, tf.text "+
               "from nfield t, ntable tb, stypefield tf "+
               "where t.id_nform = (select id_nform from nform f where f.code = :p1) "+
                " and t.id_ntable = tb.id_ntable(+) "+
                " and t.id_stypefield = tf.id_stypefield "+
                " and t.name NOT in('VERSIONREC','TS') "+
                " and t.Islkponly = 0 "+
               "order by t.orderfield ";

  cmd.DeclareAndSet("p1", fr);

  if(not cmd.Execute)
     println( "Ошибкав в запросе  - "+cmd.Error);
     return;
  end;


  upd.sqlText = "update nfield  set ISVISIBLE = 1, istextup = 1, Top = :p1, Left = :p2, Width = :p3 WHERE ID_NFIELD = :p4";


  var Top = 25, DeltaTop = 40, Witch = 400, Left = 10; 
  while(NOT cmd.Eof)
     upd.DeclareAndSet("p1", Top, "p2", Left, "p3", Witch, "p4", cmd.Rec.Id_nfield);
     if(not upd.execute) 
       OraTrnRollback();
       runError(toansi(upd.error));    
     end;
     Top = Top + DeltaTop;
     cmd.Next();
  end;

  OraTrnCommit();


end;