/************************************************************************/
/*         Автоматизированная банковская система RS-Bank v5.1           */
/*                 Copyright (c) R-Style Software Lab 1999              */
/*                                                                      */
/*  Описание         : Определение полного списания купленной ваоюты    */
/*                                                                      */
/************************************************************************/
import  PSInter;

macro   ExecuteCaseStep(OperationKind, StepNumber, Document, DocKind)
/*
        record  bo(ps_bcord);
        Var             SumCur,
                        SumOut,
                        error;

        setbuff( bo, Document);

        /* Получить сумму поставленной по заявке валюты  */
        error = GetOrderSum( bo.DocKind, bo.OrderID, 1, SumCur );      
        if ( error  != 0 )
                MsgBox( "Ошибка номер  " + error + "  при подсчете суммы поставленной валюты" );
                return  error;
        end;

        /* Получить сумму списанной валюты    */
        error = GetOutSum( bo.OrderID, SumOut );        
        if ( error  != 0 )
                MsgBox( "Ошибка номер  " + error + "  при подсчете суммы списанной валюты" );
                return  error;
        end;

        if ( SumCur ==  SumOut )
                /*  Вся валюта списана, обязательная продажа не нужна   */
                return  "200";
        end;

        if ( SumCur  <  SumOut )
                /*  Валюты списана больше, чем зачислено по заявке      */
                MsgBox( "Произошла ошибка в учете денежных средств  !!!|| Валюты списано больше чем куплено !!!" );
                return  "";
        end;
  */
        /*  Не вся купленная валюта списана. Необходимо выполнить обязательную продажу валюты */
        return  "80";

END;
