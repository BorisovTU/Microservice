/* ╔══════════════════════════════════════════════════════════════════╗ */
/*         Автоматизированная банковская система RS-Bank v5.0           */
/*                 Copyright (c) R-Style Software Lab 1998              */
/*                                                                      */
/*  Имя файла        : pspoinit.mac                                     */
/*                                                                      */
/*  Описание         : Макрос инициализации операции для клиентского    */
/*                     документа                                        */
/*                                                                      */
/*  Программист      : Дудин В.А.                                       */
/*                                                                      */
/*  Создан           : 14.05.99                                         */
/*                                                                      */
/* ╚══════════════════════════════════════════════════════════════════╝ */
import  BankInter, PSInter;
import  paym_rec; /* Pm_paym, Pm_rmprop, Pm_debet, Pm_credit */
import  pmpurp;

RECORD  Ps_payord( pspayord );

MACRO InitOperation( KindOp, KindDoc, pspayord )

  setbuff( Ps_payord, pspayord );
  var stat = 0;
  var payment:RsbPayment = RsbPayment( Pm_paym.PaymentID );

  /* При вводе из *.dbf были зафиксированы поля с некооректными данными */
  if( Ps_payord.Origin == PSPO_OR_COGNITIVE )
      stat = FindInverFlag( Ps_payord );
      if( stat == 0 ) 
        MsgBox("Документ имеет поля с некорректно загруженными данными.");
        return 1841;
      end;
  end; 

  if( ( payment.IsPurpose != "X" ) and ( IsPurposefulPayment( payment ) == true ) )
    payment.IsPurpose = "X";
    Pm_paym.IsPurpose = "X";
  end;

  return 0;
END;
