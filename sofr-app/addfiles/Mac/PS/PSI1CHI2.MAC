/************************************************************************/
/*         Автоматизированная банковская система RS-Bank                */
/*                 Copyright (c) R-Style Software Lab 1998              */
/*                                                                      */
/*  Имя файла        : psi1chi2.mac                                     */
/*                                                                      */
/*  Описание         : Шаг - определение, находится ли платеж в карт N2 */
/*                                                                      */
/*  Программист      : Зайцев А.В.                                      */
/*                                                                      */
/*  Создан           : 12.2.99                                          */
/*                                                                      */
/************************************************************************/
import BankInter,payconst, PaymInter;
import paym_rec; /* Pm_paym, Pm_rmprop, Pm_debet, Pm_credit */

RECORD  PartPmpaym( pmpaym );     /* ─┐                                                               */
RECORD  PartDebet ( pmprop );     /*  ├─ параметры платежного документа частичной оплаты картотеки №2 */
RECORD  PartPmrmprop( pmrmprop ); /* ─┘                                                               */
RECORD  PartCredit( pmprop);

RECORD  Ps_payord( pspayord );

/**********************************/
/* Выполнение шага                */
/**********************************/
MACRO ExecuteCaseStep(Kind_Operation, Number_Step, pspayord, KindDoc)

  setbuff(Ps_payord, pspayord);

    var Карт2:integer = 0;
    /* Статус платежа - "отвергнут" */
    if(Ps_payord.CurrentState == PSPO_ST_REJECTED)
       return "";
    /* Платеж находится в картотеке N2 */
    elif(Ps_payord.CurrentState == PSPO_ST_I2)
       Карт2 = 1;
    end;

    /* Проверка на внешний платеж */
    if(Карт2)
      if( (Pm_credit.PaymentID == Pm_paym.PaymentID) and (Pm_credit.Group == PAYMENTS_GROUP_EXTERNAL) )
           return string(НомерШагаЧастОплатыВнешПлатК12);
      else
           return string(НомерШагаЧастОплатыВнутрПлатК12);
      end;
    else
      if( (Pm_credit.PaymentID == Pm_paym.PaymentID) and (Pm_credit.Group == PAYMENTS_GROUP_EXTERNAL) )
           return string(НомерШагаСписанияК1);
      else
           return string(НомерШагаКонтроляК1);
      end;
    end;

END;


