/* ╔══════════════════════════════════════════════════════════════════╗ */
/*         Автоматизированная банковская система RS-Bank v5.0           */
/*                 Copyright (c) R-Style Software Lab 1998              */
/*                                                                      */
/*  Имя файла        : psichdpp.mac                                     */
/*                                                                      */
/*  Описание         : Проверка ДПП                                     */
/*  Программист      : Бабин А.П.                                       */
/*                                                                      */
/*  Создан           : 02.08.01                                         */
/*                                                                      */
/* ╚══════════════════════════════════════════════════════════════════╝ */
import  InsCarryDoc, OprInter, FIInter, payconst, PaymInter, PTInter;
import  paym_rec; /* Pm_paym, Pm_rmprop, Pm_debet, Pm_credit */

RECORD  PartPmpaym( pmpaym );     /* ─┐                                                               */
RECORD  PartDebet ( pmprop );     /*  ├─ параметры платежного документа частичной оплаты картотеки №2 */
RECORD  PartCredit( pmprop );     /*  │                                                               */
RECORD  PartPmrmprop( pmrmprop ); /* ─┘                                                               */

RECORD  d(arhdoc);

/**********************************/
/* Выполнение шага                */
/**********************************/
MACRO ExecuteStep( doc, payorder )

  /*Проверяем ДПП платежа*/
  if ( Pm_credit.DebetCredit==0 )
     if ( PaymOutChangeDPP(Pm_paym, Pm_credit, NULL, 0 )==false )
        return 1;
     end;
  else
     if ( PaymOutChangeDPP(Pm_paym, NULL, Pm_credit, 0 )==false )
        return 1;
     end;
  end;

  /* при частичной оплате внешнего платежа, изменяем статус частичной оплаты */
/*  if( (Pm_paym.PaymentID) and (PartCredit.PaymentID == PartPmpaym.PaymentID) and (PartCredit.Group == PAYMENTS_GROUP_EXTERNAL) )
     if( not InsertPaymentStat( PartPmpaym.PaymentID, PM_READY_TO_SEND ) )
        msgbox( "Ошибка при обновлении статуса платежа" );
        return 1;
     end;
  end;
*/
  return 0;
END;
