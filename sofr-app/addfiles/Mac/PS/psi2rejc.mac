/* ╔══════════════════════════════════════════════════════════════════╗ */
/*         Автоматизированная банковская система RS-Bank v5.0           */
/*                 Copyright (c) R-Style Software Lab 1998              */
/*                                                                      */
/*  Имя файла        : psi2ins.mac                                      */
/*                                                                      */
/*  Описание         : Выполнение шага по                               */
/*                     отзыву из картотеки №2                           */
/*                                                                      */
/*  Программист      : Дудин В.А.                                       */
/*                                                                      */
/*  Создан           : 6.03.99                                          */
/*                                                                      */
/* ╚══════════════════════════════════════════════════════════════════╝ */
import  InsCarryDoc, OprInter, FIInter, payconst, payinter, "paym_rec.mac";

RECORD  PartPmpaym( pmpaym );     /* ─┐                                                               */
RECORD  PartDebet ( pmprop );     /*  ├─ параметры платежного документа частичной оплаты картотеки №2 */
RECORD  PartCredit( pmprop );     /*  │                                                               */
RECORD  PartPmrmprop( pmrmprop ); /* ─┘                                                               */

RECORD  d(arhdoc);

/**********************************/
/* Выполнение шага                */
/**********************************/
MACRO ExecuteStep( doc, payorder )

setbuff(d,doc);
/*
     var err, СистемныйСчетДляКартотек, ВнебалСчетКартотеки2;

     GetRegistryValue( ПутьНастройкиСчетаКорреспКарт2, V_STRING, СистемныйСчетДляКартотек, err );
     if( (err != REG_OK) or (СистемныйСчетДляКартотек == "") )
        DisplayErrMes_CorrAcc(err,СистемныйСчетДляКартотек);
        return 1;
     end;*/
    /*
     if( GetAccount90902(PartPmpaym.PayerAccount,
                         PartPmpaym.PayerFIID,
                         PartPmpaym.BaseFIID,
                         ВнебалСчетКартотеки2,  /* В случае успеха, сюда вернется номер "привязанного" счета */
                        )) return 1;
     end;
      */
/*****************************************************
 Снятие с внебаланса
*****************************************************/
/*     ClearRecord(d);

     d.Chapter = 3;

     d.Account_Payer = СистемныйСчетДляКартотек;
     d.Account_Receiver = ВнебалСчетКартотеки2;

     d.Sum = PartPmpaym.Amount;
     d.Numb_Document = PartPmrmprop.Number;
     d.Department    = PartPmpaym.Department;
     d.Number_Pack   = PartPmpaym.NumberPack;

     /*d.Date_Carry = {curdate};*/
     d.Date_Carry = PartPmpaym.ValueDate;

     d.Result_Carry = 53;
     d.Kind_Oper = " 1";

     d.Ground = "Отзыв из картотеки №2 " + PartPmrmprop.Ground;

     if( not InsertRubDocument(NULL,PMMET_ID,Pm_paym.PaymentID) )
        msgbox("Ошибка при вставке рублевого документа");
        return 1;
     end;
  */
/*****************************************************
Здесь можно вставлять дополнительные проводки для шага
*****************************************************/

     return 0;

END;
