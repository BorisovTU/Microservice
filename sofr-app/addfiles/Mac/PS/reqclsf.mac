/*
$Name:           reqclsf.mac
$Module:         РКО
$Description:    Закрытие договора обслуживания
*/
/* -------------------------------------------------------------------- */
/*         Автоматизированная банковская система RS-Bank v6.0           */
/*                 Copyright (c) R-Style Software Lab                   */
/*                                                                      */
/*  Имя файла  : openingy.mac                                           */
/*                                                                      */
/*  Описание   : Операция - 3035 - "Открытие закрытие счета"            */
/*               Шаг      - 10   - "Закрытие договора обслуживания"     */
/*                                                                      */
/*  Программист: Локтюшин В.Ю.                                          */
/*                                                                      */
/*  Создан     : 08.02.2007                                             */
/*                                                                      */
/* -------------------------------------------------------------------- */

IMPORT InsCarryDoc, reqinter, OprInter, PSInter, pr_adcla;

var ReqCloseAccObj:RsbReqCloseAcc;

/* Выполнение шага */
MACRO ExecuteStep( doc, reqacc )

 return 0;

END;

macro PostStep( message,     /* данный параметр может принимать следующие       */
                             /* значения: 1 - выполнение шага; 2 - откат шага;  */
                errTrn,      /* статус выполнения шага. Если параметр не равен 0*/
                             /* произошла ошибка                                */
                FirstDoc,    /* указатель на первичный документ                 */
                ID_Oper,     /* внутренний идентификатор операции               */
                Num_Step,    /* Номер шага операции (из настроек)               */
                KindOper,    /* номер вида операции                             */
                KindDoc,     /* номер вида первичного документа                 */
                KindStep,    /* вид шага операции                               */
                ID_Step )    /* внутренний идентификатор шага операции          */
  var stat = 0;
  var oldoutput;
  var OutNameDirFile = GetTxtFileName("noticlacc.txt");

  if( ( errTrn == 0 ) and ( message == 1 ) )// на выполнении шага
    if ((ReqCloseAccObj.SubKind == 2) and (ReqCloseAccObj.OrderKind == 2)) //(Распоряжение) и (ПОД/ФТ)
      if( not IsOprMultiExec() and ExistFile(OutNameDirFile) )
        DelFile(OutNameDirFile);
      end;
      oldoutput = SetOutput( OutNameDirFile, true );
      PrintAdviceClAcc( ReqCloseAccObj.Account, ReqCloseAccObj.Code_Currency );
      SetOutput( oldoutput );
      if( not IsOprMultiExec() )
        ShowFV( OutNameDirFile );
      end;
    end;
  end;
  return stat;

END;