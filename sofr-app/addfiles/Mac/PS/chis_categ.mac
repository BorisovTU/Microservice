/* ╔══════════════════════════════════════════════════════════════════╗ */
/*         Автоматизированная банковская система RS-Bank v5.0           */
/*                 Copyright (c) R-Style Software Lab 1998              */
/*                                                                      */
/*  Имя файла        : chiss_categ.mac                                  */
/*                                                                      */
/*  Описание         : Перевод заявлений цен. бл. на категории учета    */
/*                                                                      */
/*                                                                      */
/*  Программист      : Локтюшин В.Ю.                                    */
/*                                                                      */
/*  Создан           : 14.09.2006                                       */
/*                                                                      */
/* ╚══════════════════════════════════════════════════════════════════╝ */

import PSInter, OprInter, PaymInter, "cat_acc.mac", CTInter, chisfun;
                                                    

private const RegPath_CalcFIID = "PS\\CHECKISS\\CALCFIID";

/*========================================================================*/
/*                Первичный документ для категорий                        */
/*                                                                        */
/*========================================================================*/

CLASS (RsbCheckIss) CheckissFirstDoc( OrderID )

/* данные класса ---------------------------------------------------- */

    VAR
                                                                   
      Error = 0, kind, id, PSPartyID;

    var PlStr = PlaceStorage( {OperDprt} );
    var CalcFIID:integer = -1;
/* ------------------------------------------------------------------ */

/* вернуть параметр второго рода ------------------------------------ */

    MACRO GetParametr( ParmKind, OperDate, CatCode, FIRole )
       VAR Parametr = -1;
       
       if  ( ParmKind == MC_TYPE_PARAMETR_DOCKIND          ) return PS_CHECKISS;
       elif( ParmKind == MC_TYPE_PARAMETR_DOCID            ) return OrderID;
       elif( ParmKind == MC_TYPE_PARAMETR_OWNER            ) return {OurBank};
       elif( ParmKind == MC_TYPE_PARAMETR_DEPARTMENT       ) return {OperDprt};
       elif( ParmKind == MC_TYPE_PARAMETR_INDEXDATE        ) return ValueDate;
       elif( ParmKind == MC_TYPE_PARAMETR_PLACE            ) return PSPartyID;
       elif( ParmKind == MC_TYPE_PARAMETR_FIID             ) return FormKind;
       end;

       return Parametr;
    END;

/* ------------------------------------------------------------------ */

/* вернуть параметр первого рода ------------------------------------ */

    MACRO GetParametrTemplate ( ObjectID, Classificator, OperDate, FIRole )         
      VAR Parametr = -1;
      
//      if( ( ObjectID == OBJTYPE_BACKOFFICE ) and ( Classificator == LLCLASS_BACKOFFICE ) )
        Parametr = 9;
//      end; 

      return Parametr;
    END;

/* ------------------------------------------------------------------ */

/* остновная роль фИ ------------------------------------------------ */

    MACRO GetBasisFIRole(FIRole)
       return FIROLE_UNDEF;
    END;

/* ------------------------------------------------------------------ */

/* вернуть весь базис ролей ----------------------------------------- */

    MACRO GetFIRoleBArray()
       return 0;
    END;

/* ------------------------------------------------------------------ */

/* найти/открыть счет ---------------------------------------------- */

   MACRO FindAndOpenAccount( Category, isMass, Open_Date )
      var opendate:Date = {curDate};
      
      if ( ValType(Open_Date) == V_DATE )
         opendate = Open_Date;
      end;

      return MC_FindAndOpenAccount( Category, this, opendate, isMass, MC_OPENACC_CREATE, null, null, null, null, null, null );
   END;

/* ------------------------------------------------------------------ */

/* найти счет ------------------------------------------------------- */

   MACRO FindAccount( Category, isMass )
      return MC_FindAndOpenAccount( Category, this, {curDate}, isMass, MC_OPENACC_CHECKEXIST, null, null, null, null, null, null );
   END;

/* ------------------------------------------------------------------ */

/* привязать счет заново -------------------------------------------- */

   MACRO RecreateAccount( Category, isMass )
      return MC_FindAndOpenCommonAccByFD( Category, this, {curDate}, isMass, MC_OPENACC_RECREATE, null, null, null, null, null, null );
   END;

/* ------------------------------------------------------------------ */

/* ------------------------------------------------------------------ */
  
   MACRO FindSysAccount( Category, isMass )

   return  MC_FindAndOpenCommonAccByFD( Category, this, {curDate}, isMass, MC_OPENACC_ACT/*MC_OPENACC_CHECKEXIST*/, null,
                                        CalcFIID, null, null, null, null, null, null, PlStr.Code );

   END;

/* ------------------------------------------------------------------ */

/* ------------------------------------------------------------------ */
  
   MACRO FindAndOpenSysAccount( Category, isMass )

   return  MC_FindAndOpenCommonAccByFD( Category, this, {curDate}, isMass, MC_OPENACC_CREATE, null,
                                        CalcFIID, null, null, null, null, null, null, PlStr.Code );

   END;

/* ------------------------------------------------------------------ */

/* Корректировка счета ---------------------------------------------- */

   MACRO CorrectAccount( account, accblnc, ORScheme, categ, templ, accdoc,  OperDate )
      return true;
   END;
/* ------------------------------------------------------------------ */

/* Вернуть дату ----------------------------------------------------- */
   MACRO GetDate()
      return GetParametr( MC_TYPE_PARAMETR_INDEXDATE, null, null, null );
   END;
/* ------------------------------------------------------------------ */

/* конструктор ------------------------------------------------------ */
    InitRsbCheckIss( OrderID );
    
    PSPartyID = PlStr.PartyID;
    
    if( PSPartyID < 0 )
      MsgBox("Не найдено хранилище ценностей");
    end;

    GetRegistryValue( RegPath_CalcFIID, V_INTEGER, CalcFIID, Error );

    Kind = PS_CHECKISS;
    Id   = OrderID;
/* ------------------------------------------------------------------ */

END;

