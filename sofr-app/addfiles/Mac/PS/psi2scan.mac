/*
  $Name:        psi2scan.mac
  $Module:      РКО
  $Description: Печать протокола работы процедуры массового сканирования К2
*/

/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : psi2scan.mac
  Created     : 25.11.2009
  Programmer  : Попова О.
  Description : Печать протокола работы процедуры массового сканирования К2

└───────────────────────────────────────────────────────────────────────────*/
import globals, likepy, oralib, "bnk_ptlib.mac";


macro I2ScanReportPrint( Oper:integer, FIID:integer )

  var OperName:string = GetNameOper( Oper );
[
   Протокол процедуры сканирования картотеки №2 ###########################################################

   Дата отчета: ##########                                                                    ]
( IfThenElse( Oper == 0, "", "по счетам операциониста " + string(Oper) + " " + OperName ),
  {curdate} );

[  Операционист: ##### # ]( {oper}, {Name_Oper} );  
[  ─────────────────────────┬────────────────────────────────────────┬───────────────────┬────────────────────┬───────────────────────────────────────────────────────────────────
    Счет плательщика        │   Наименование                         │ Сумма, доступная  │ Сумма документов   │     Примечание
                            │                                        │ для списания      │ в картотеке 2      │ 
   ─────────────────────────┴────────────────────────────────────────┴───────────────────┴────────────────────┴─────────────────────────────────────────────────────────────────── ];

  var query :string = "select scani.t_Account, pt.t_Name, scani.t_Rest, scani.t_Sum, scani.t_IsTax "
                      "from dpmscani_tmp scani, "
                      "     dparty_dbt pt "
                      "where pt.t_PartyID = scani.t_PartyID "
                      "order by scani.t_Rest desc";

  var rs:RsdRecordset = execSQLselect( query );

  while( rs.moveNext() )
[  ######################### ######################################## ################### ###################  ##################################################################  ]
( rs.Value(0),
  rs.Value(1),
  rs.Value(2),
  rs.Value(3),                    
  IfThenElse(rs.Value(4) == "X", "Сумма доступна для оплаты документов налоговых и страховых взносов", "") );
  end;

[  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── ];
  
end;                      
