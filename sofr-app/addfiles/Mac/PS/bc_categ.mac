//------------------------------------------------------------------------------
// Перевод поручений на п/п/к валюты на категории учета
//------------------------------------------------------------------------------
import BankInter, PSInter, CTInter, globals, "payconst.mac", likepy;

//------------------------------------------------------------------------------
// Первичный документ для категорий
//------------------------------------------------------------------------------
CLASS (RsbBuyCurrencyOrder) BuyCurOrder_FirstDoc( PaymentID )

//------------------------------------------------------------------------------
// данные класса
//------------------------------------------------------------------------------
  // Допустимые базис ролей
  PRIVATE VAR FIRoleB:TArray = makeArray( FIROLE_FIREQ, //ФИ требования по сделке
                                          FIROLE_FICOM, //ФИ обязательства по сделке
                                          FIROLE_EXCHFI //ФИ торгов 
                                        );

  VAR Error = 0, kind, id;

//------------------------------------------------------------------------------
// вернуть параметр второго рода
//------------------------------------------------------------------------------
  MACRO GetParametr( ParmKind, OperDate, CatCode, FIRole )
     VAR Parametr = -1;

       if( ParmKind == MC_TYPE_PARAMETR_DOCKIND       )
        return Payment.DocKind;
     elif( ParmKind == MC_TYPE_PARAMETR_DOCID         )
        return PaymentID;
     elif( ParmKind == MC_TYPE_PARAMETR_DEPARTMENT    )
       return {OperDprtNode};
     elif( ParmKind == MC_TYPE_PARAMETR_OWNER         ) 
        return Payment.Payer;
     elif( ParmKind == MC_TYPE_PARAMETR_CONTRACTOR    )
        return /*Payment.Payer*/{OurBank};
     elif( (ParmKind == MC_TYPE_PARAMETR_FIID) OR
           (ParmKind == MC_TYPE_PARAMETR_PAYCURRENCY) )
         if( FIRole == FIROLE_FIREQ  )
         return Payment.ReceiverFIID;
       elif( FIRole == FIROLE_FICOM  )
         return Payment.PayerFIID;
       elif( FIRole == FIROLE_EXCHFI )
         return ExchangeFIID;
       end;
     end;

     return Parametr;
  END;

//------------------------------------------------------------------------------
// параметры шаблона
//------------------------------------------------------------------------------
    MACRO GetParametrTemplate( ObjectID, Classificator, OperDate, FIRole )         
       VAR Parametr = -1;
       if( Classificator == /*LLCLASS_CHAPTER_OCP*/700 )
         return Payment.Chapter();
       elif( Classificator == LLCLASS_BACKOFFICE )
         return 9;
       end;
       return Parametr;
    END;

//------------------------------------------------------------------------------
// основная роль фИ
//------------------------------------------------------------------------------
    MACRO GetBasisFIRole( FIRole )
       return FIRole;
    END;

//------------------------------------------------------------------------------
// вернуть весь базис ролей
//------------------------------------------------------------------------------
    MACRO GetFIRoleBArray()
       return FIRoleB;
    END;

//------------------------------------------------------------------------------
// найти/открыть счет
//------------------------------------------------------------------------------
   MACRO FindAndOpenAccount( Category, isMass, Open_Date, FIRole )
      var opendate:Date = {curDate};
      
      if ( ValType(Open_Date) == V_DATE )
         opendate = Open_Date;
      end;

      return MC_FindAndOpenAccount( Category, this, opendate, isMass, MC_OPENACC_CREATE, null, null, null, null, null, FIRole );
   END; 

//------------------------------------------------------------------------------
// Корректировка счета
//------------------------------------------------------------------------------
   MACRO CorrectAccount( account, accblnc, ORScheme, categ, templ, accdoc, OperDate )
      return true;
   END;

//------------------------------------------------------------------------------
// конструктор
//------------------------------------------------------------------------------
    InitRsbBuyCurrencyOrder( PaymentID );
    Kind = Payment.DocKind;
    Id   = Payment.PaymentID;
END;
//------------------------------------------------------------------------------
