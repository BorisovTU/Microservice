/************************************************************************/
/*         Автоматизированная банковская система RS-Bank v5.1           */
/*                 Copyright (c) R-Style Software Lab 1999              */
/*                                                                      */
/*  Описание         : Определение исполнения заявки                    */
/*                                                                      */
/************************************************************************/
import  PaymInter;

macro   ExecuteCaseStep(OperationKind, StepNumber, Document, DocKind)

        record  bo(ps_bcord);
        record  paymentB( pmpaym );

        setbuff( bo, Document);

        /* Найти платеж по базовому финансовому инструменту */
        if ( FindPayment( 
                0,      /* Индентификатор неизвестен    */
                1,      /* Базовый актив                */
                0,      /* Subpurpose                   */
                bo.dockind,
                bo.orderid,
                true,   /* Поиск по реальной базе       */
                paymentB
                )       !=      0 )

                MsgBox( "Не могу найти платеж по поставке валюты" );
                return  1;
        end;


        /* Если статус платежа больше "готов к отправке (в Корсчета/МБР)",
           то завершаем операцию. Иначе переходим на шаг исполнения заявки */
        if(paymentB.PaymStatus >= 3000 ) return "";      
        else                             return "60";
        end;

END;
