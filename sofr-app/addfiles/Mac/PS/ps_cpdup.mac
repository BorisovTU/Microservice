/*
$Name:             ps_cpdup.mac
$Module:           РКО юридических лиц
$Description:      Инициализация и проверки дубликата валютного платежного поручения
*/

/************************************************************************/
/*         Автоматизированная банковская система RS-Bank                */
/*                 Copyright (c) R-Style Software Lab 1999              */
/*                                                                      */
/*  Имя файла        : ps_cpdup.mac                                     */
/*                                                                      */
/*  Описание         : Инициализация и проверки дубликата               */
/*                     валютного платежного поручения                   */
/*  Программист      : Андреева Е.П.                                    */
/*                                                                      */
/*  Создан           : 12.03.2003                                       */
/*                                                                      */
/************************************************************************/

import BankInter, PSInter, globals,"pm_tools.mac", pmbuff;

/*номера полей в панели*/
const fld_Number      = 1,
      fld_Date        = 2,
      fld_DateValue   = 3,
      fld_BaseAmount  = 5,
      fld_ReceiverINN = 34,
      fld_Details     = 34,
      fld_GroundIPVS  = 24,
      fld_ReceiverBankName = 29,
      fld_PayerBankName    = 24,
      fld_ReceiverName     = 35,
      fld_PayerName        = 11;

macro   Новый_Документ( )
        return 0;
end;

macro   Проверить_Документ( Режим )

  var stat     :integer = 0 ,
      note     :string  = "",
      save_note:string  = "",
      ret_val  :bool;

  /* Проверяем номер для всех документов */           
  if( (Режим == 2 ) or (Режим == 3) )
              
    if( CheckINN(r_pmrmprop.ReceiverINN) > 0 )
      msgBox ("Ошибка в ИНН получателя");
      return fld_ReceiverINN;
    end;
    if( StrLen( r_pmrmprop.Ground ) == 0 )
      if ((r_pmpaym.DocKind == PS_DUINRQ) or (r_pmpaym.DocKind == PS_INRQ))
        MsgBox("Не задано назначение платежа");
        return fld_GroundIPVS;
      else
        MsgBox("Не заданы детали платежа");
        return fld_Details;

      end;
    end;
    if( StrLen( r_pmrmprop.Number ) == 0 )
      MsgBox("Не задан номер документа");
      return fld_Number;
    end;

  end;

  if( Режим == 1 ) /*УДАЛЕНИЕ ДОКУМЕНТА*/
  end;
         
  if( Режим == 2)  /* ВВОД ДОКУМЕНТА */
    if(r_pscpord.Kind_Operation) /* Вставка документа одновременно с началом операции */
      if(r_pmpaym.ValueDate < {curdate}) /* Дата валютирования*/
        r_pmpaym.ValueDate = {curdate};
      end;
    end;
  end;

  if( Режим == 3 ) /* РЕДАКТИРОВАНИЕ ДОКУМЕНТА */
  end;

  return stat;
end;

macro   Проверить_Счет_В_Документе( поле ) /*0-счет плательщика, 1-счет получателя*/
        var новое_значение_счета;

        if(поле) новое_значение_счета = r_pmpaym.ReceiverAccount;
        else новое_значение_счета = r_pmpaym.PayerAccount;
        end;
        return новое_значение_счета;
end;

macro   Функция_Пользователя( Режим:integer )
 /*
 Возможные значения Режим:
  UFN_PANEL_INPUT(1) - функция вызвана из панели ввода объекта;
  UFN_PANEL_EDIT(2) - функция вызвана из панели корректировки объекта;
  UFN_SCROL(3) - функция вызвана из панели скролинга, единичный вызов, любая корректировка объекта запрещена;
  UFN_SCROL_FMASS(4) - функция вызвана из панели скролинга, работа по нескольким записям, вызов до начала обработки, любая корректировка объекта запрещена;
 
// Пример работы: 
 if( Режим == UFN_SCROL )
   return UPDTPAGE;    // Обновить страницу записей и область скролинга
   //return UPDTREC;     // Обновить текущую запись, загрузив из файла
 end;
 */
   return 0;
end;

macro    УстановитьПодсказкуПоиска( СтараяПодсказка )
        return "/*+FIRST_ROWS LEADING(step) INDEX(step doprstep_dbt_idx7)*/";
end;

MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStates:integer ):string
  return DefaultHint;
END;

/*
macro ProcessPanel(mode)
  msgbox(mode);
end;
*/