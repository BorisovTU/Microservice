/* ╔══════════════════════════════════════════════════════════════════╗ */
/*         Автоматизированная банковская система RS-Bank v5.0           */
/*                 Copyright (c) R-Style Software Lab 1998              */
/*                                                                      */
/*  Имя файла        : bcbecase.mac                                     */
/*                                                                      */
/*  Описание         : Проверка на удовлетворенность полностью          */
/*                                                                      */
/*  Операция         : Покупка валюты                                   */
/*                                                                      */
/*  Программист      : Бурак В.Ю.                                       */
/*                                                                      */
/*  Создан           : 21.05.2001                                       */
/*                                                                      */
/* ╚══════════════════════════════════════════════════════════════════╝ */
import InsCarryDoc, payconst, "bcall.mac";

record  PartBCexe (ps_bcexe); /*Параметры исполнения*/

/**********************************/
/* Выполнение шага                */
/**********************************/
MACRO ExecuteCaseStep(Kind_Operation, Number_Step, ps_bcord, KindDoc)

  var Дата;
  var NumStep = Number_Step;

  record  bc(ps_bcord);
  setbuff(bc,ps_bcord);

  
  if( not bc.FullExecute )
      if (bc.MarketPlace != PTID_UNKNOWNPARTY)
          NumStep = ПКВ_Биржа_НомерШагаПокупкиВалюты;
      else
          NumStep = ПКВ_Банк_НомерШагаПокупкаВалюты;
      end;
  else //а этих шагов больше нет!!! (SCR 64226)
      if (ПолучитьДатуПоследнегоИсполнениеПоПоручению (bc.OrderID, Дата))
         DefineOprDate( 1, Дата ); 
         if (bc.MarketPlace != PTID_UNKNOWNPARTY)
            NumStep = "";//ПКВ_Биржа_НомерШагаФормированияПродажи;
         else
            NumStep = "";//ПКВ_Банк_НомерШагаФормированиеПродажи;
         end;
      end; 
  end;

  return string(NumStep);
END;
