/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.10                                         R-Style Software Lab

  File Name   : bcsctdf.mac
  Created     : 13.03.2001
  Description : Печать отчета сканирования массвого отката поручений п\п валюты

└───────────────────────────────────────────────────────────────────────────*/
IMPORT PaymInter, OprInter, gstname;

RECORD psbc_firstdoc (ps_bcord);

const   Ошибка   = 0,
        Первый   = 1,
        Последний= 2;

MACRO Печать_ОтчетСканирования (Вызов,firstdoc,Статус,Сообщение)

  record pm_rmprop (pmrmprop);
  record pm_paym   (pmpaym);
 
  setbuff (psbc_firstdoc,firstdoc);

  if( Вызов == Первый )
[               Отчет о групповом помещении поручений на п\п валюты в отложенные.                ];
[┌─────────┬─────────────┬─────────────┬──────────┬──────┬──────────────────────────────────────┐];
[│  Номер  │    Сумма    │    Сумма    │   Дата   │Номер │                Сообщение             │];
[│документа│   продажи   │   покупки   │          │ошибки│                                      │];
[├─────────┼─────────────┼─────────────┼──────────┼──────┼──────────────────────────────────────┤];
  elif( Вызов == Ошибка )

    if( Статус == 0 )
      Сообщение = "Операция выполнена успешно";
    end;
    if( FindPayment( 0, PM_PURP_PSBCCONV, 0, PS_BUYCURORDER, psbc_firstdoc.PaymentID, true, pm_paym, null, null, pm_rmprop ) != 0 )
      Статус = 1;
      Сообщение = "Не найден платежный документ";
    elif ( Статус != 10103 ) 
      Сообщение = Сообщение+". "+GetStepNameExecuteRead(pm_paym.PaymentID, pm_paym.DocKind, pm_paym.PaymStatus);
    end;
[│#########│#############│#############│##########│######│######################################│](pm_rmprop.Number, pm_paym.Amount, pm_paym.PayAmount, pm_rmprop.Date, Статус, StrSubst(Сообщение, "|", " " ):w);

  elif( Вызов == Последний )
[└─────────┴─────────────┴─────────────┴──────────┴──────┴──────────────────────────────────────┘]
  end;

END;