/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : pr_chrdd.mac
  Created     : 10.09.2010
  Description : âç¥â ¯® ¨§¬¥­¥­¨ï¬ ¢ à áç¥â­ëå ¤®ªã¬¥­â å
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/


import oralib, likepy;

private MACRO PrintPayerProp(rs:RsdRecordset)

  var Bookmark = rs.Bookmark;
  var PaymentID = 0;
               
  while((PaymentID == 0) or (rs.MoveNext and (rs.value("t_PaymentID") == PaymentID)))
   
    if(PaymentID == 0)
[º ¥ª¢¨§¨âë ¯® áâ®à®­¥ ¯« â¥«ìé¨ª                                                                                                                                                 º
 ÇÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
 º ü¯/¯³ ‚¨¤ ¤®ªã¬. ³®¬¥à ¤®ªã¬. ³„ â  ¤®ªã¬. ³„¥©áâ¢ã¥â á³   ˆŠ   ³     ­ª  ¯« â¥«ìé¨ª   ³ Š®àáç¥â ¡ ­ª  ¯« â.³  ‘ç¥â ¯« â¥«ìé¨ª   ³     « â¥«ìé¨ª     ³       ˆ/Š        º
 ÇÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
      PaymentID = rs.value("t_PaymentID");
    else
[ÇÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
    end;

[º#####³############³#############³############³###########³#########³#######################³####################³####################³####################³######################º]
( rs.value("t_Num"), rs.value("t_NameNormDoc"), rs.value("t_NumberNormDoc"), date(rs.value("t_DateNormDoc")):c, 
  date(rs.value("t_DateFrom")):c, rs.value("t_PayerBankCode"), rs.value("t_PayerBankName"):w, rs.value("t_PayerCorrAccNostro"), 
  rs.value("t_PayerAccount"), rs.value("t_PayerName"):w, rs.value("t_PayerINN") );

  end;

[ÇÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
 
 rs.move( Bookmark, /*RSDO_BOOKMARK*/2 );

END;

private MACRO PrintReceiverProp(rs:RsdRecordset)

  var Bookmark = rs.Bookmark;
  var PaymentID = 0;

  while((PaymentID == 0) or (rs.MoveNext and (rs.value("t_PaymentID") == PaymentID)))
   
    if(PaymentID == 0)
[º ¥ª¢¨§¨âë ¯® áâ®à®­¥ ¯®«ãç â¥«ï                                                                                                                                                 º
 ÇÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
 º ü¯/¯³ ‚¨¤ ¤®ªã¬. ³®¬¥à ¤®ªã¬. ³„ â  ¤®ªã¬. ³„¥©áâ¢ã¥â á³   ˆŠ   ³     ­ª ¯®«ãç â¥«ï    ³Š®àáç¥â ¡ ­ª  ¯®«ãç.³  ‘ç¥â ¯®«ãç â¥«ï   ³     ®«ãç â¥«ì     ³       ˆ/Š        º
 ÇÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
      PaymentID = rs.value("t_PaymentID");
    else
[ÇÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
    end;

[º#####³############³#############³############³###########³#########³#######################³####################³####################³####################³######################º]
( rs.value("t_Num"), rs.value("t_NameNormDoc"), rs.value("t_NumberNormDoc"), date(rs.value("t_DateNormDoc")):c, 
  date(rs.value("t_DateFrom")):c, rs.value("t_ReceiverBankCode"), rs.value("t_ReceiverBankName"):w, rs.value("t_ReceiverCorrAccNostro"), 
  rs.value("t_ReceiverAccount"), rs.value("t_ReceiverName"):w, rs.value("t_ReceiverINN") );

  end;

[ÇÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
 
 rs.move( Bookmark, /*RSDO_BOOKMARK*/2 );

END;

private MACRO PrintComplementaryProp(rs:RsdRecordset, neof:@bool)

  var PaymentID = 0;

  while((PaymentID == 0) or ((neof = rs.MoveNext) and (rs.value("t_PaymentID") == PaymentID)))
   
    if(PaymentID == 0)
      if( rs.value("t_DocKind") == 202 )
[º „®¯®«­¨â¥«ì­ë¥ à¥ª¢¨§¨âë                                                                                                                                                        º
 ÇÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
 º ü¯/¯³ ‚¨¤ ¤®ªã¬. ³®¬¥à ¤®ªã¬. ³„ â  ¤®ªã¬. ³„¥©áâ¢ã¥â á³   ®¬¥à ¤®ªã¬¥­â     ³        §­ ç¥­¨¥ ¯« â¥¦                ³ Š®¤ ¨­áâàãªæ¨¨ ³ ’¥ª. ªãàá ¤¥¡¥â  ³ ’¥ª. ªãàá ªà¥¤¨â  º
 ÇÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
      else
[º „®¯®«­¨â¥«ì­ë¥ à¥ª¢¨§¨âë                                                                                                                                                        º
 ÇÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
 º ü¯/¯³ ‚¨¤ ¤®ªã¬. ³®¬¥à ¤®ªã¬. ³„ â  ¤®ªã¬. ³„¥©áâ¢ã¥â á³   ®¬¥à ¤®ªã¬¥­â     ³                                 §­ ç¥­¨¥ ¯« â¥¦                                               º
 ÇÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
      end;
      PaymentID = rs.value("t_PaymentID");
    else
      if( rs.value("t_DocKind") == 202 )
[ÇÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
      else
[ÇÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶];
      end;
    end;

      if( rs.value("t_DocKind") == 202 )
[º#####³############³#############³############³###########³######################³########################################³################³##################³###################º]
( rs.value("t_Num"), rs.value("t_NameNormDoc"), rs.value("t_NumberNormDoc"), date(rs.value("t_DateNormDoc")):c, 
  date(rs.value("t_DateFrom")):c,  rs.value("t_DocNum"), rs.value("t_Ground"):w, rs.value("t_InstructionCode"):w,  rs.value("t_FutureDRateStr"):w, rs.value("t_FutureCRateStr"):w );
      else
[º#####³############³#############³############³###########³######################³################################################################################################º]
( rs.value("t_Num"), rs.value("t_NameNormDoc"), rs.value("t_NumberNormDoc"), date(rs.value("t_DateNormDoc")):c, 
  date(rs.value("t_DateFrom")):c,  rs.value("t_DocNum"), rs.value("t_Ground"):w );
      end;
  end;

END;

private MACRO PrintOneTable(rs:RsdRecordset, neof:@bool)

  var Table = 0;
  var LastDocKind = 0;
  var NamePayment =  "";

  while((Table == 0) or (neof and (Table == rs.value("t_NumTab"))))
    
    LastDocKind = rs.value("t_DocKind");

    if(Table == 0)
[ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º                                                                                                                                                                                 º];
      Table = rs.value("t_NumTab");
    else
      if( rs.value("t_DocKind") == 202 )
[ÌÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º                                                                                                                                                                                 º];
      else
[ÌÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º                                                                                                                                                                                 º];
      end;
    end;
    NamePayment = rs.value("t_NamePrimDoc") + " ®â " + date(rs.value("t_DocDate")) + " ­  áã¬¬ã " + rs.value("t_Sum") + " " + IfThenElse( rs.value("t_DocKind") == 202,  rs.value("t_BaseFIIDStr"), "" );
[º ############################################################################################################################################################################### º
 ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶]
 ( NamePayment );
    PrintPayerProp(rs);
    PrintReceiverProp(rs);
    PrintComplementaryProp(rs, @neof);
  end;

  if( LastDocKind == 202 )
[ÈÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼];
  else
[ÈÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼];
  end;
END;

private MACRO PrintTables(rs:RsdRecordset)
  
  var neof:bool = true;

  if( rs.MoveFirst )
    while( neof )
      if(rs.value("t_NumTab") == 2 )
[ 
  „®ªã¬¥­âë, ­ å®¤ïé¨¥áï ¢ ª àâ®â¥ª¥ ü1];
      elif(rs.value("t_NumTab") == 3 )
[ 
  „®ªã¬¥­âë, ­ å®¤ïé¨¥áï ¢ ª àâ®â¥ª¥ ü2];
      elif(rs.value("t_NumTab") == 4 )
[ 
  „®ªã¬¥­âë, ­ å®¤ïé¨¥áï ¢ ª àâ®â¥ª¥ ];
      end;
      PrintOneTable(rs, @neof);
    end;
  else
[ ¥â ¤®ªã¬¥­â®¢, ã¤®¢«¥â¢®àïîé¨å ¤ ­­ë¬ ãá«®¢¨ï¬. ];
  end;

END;

MACRO PrintReportChangesDocumnt( RepDate:date, DepNum:integer, DepName:string, VspNum:integer, VspName:string, Oper:integer, OperName:string, State:integer )

  var select:string = 
    " select t1.t_NamePrimDoc,                                                                                                    "+
    "        t1.t_DocDate,                                                                                                        "+
    "        t1.t_Sum,                                                                                                            "+
    "        pmih.t_HistoryNum as t_Num,                                                                                          "+
    "        nvl(PM_SCRHLP.GetLLValuesName( 1681, pmcnd.t_DocumentKind ), chr(1)) as t_NameNormDoc,                               "+
    "        nvl(pmcnd.t_Number, chr(1)) as t_NumberNormDoc,                                                                      "+
    "        nvl(pmcnd.t_Date, to_date('01.01.0001', 'dd.mm.yyyy')) as t_DateNormDoc,                                             "+
    "        pmih.t_DateFrom,                                                                                                     "+
    "        pmih.t_PayerBankCode,                                                                                                "+
    "        pmih.t_PayerBankName,                                                                                                "+
    "        pmih.t_PayerCorrAccNostro,                                                                                           "+
    "        pmih.t_PayerName,                                                                                                    "+
    "        pmih.t_PayerINN,                                                                                                     "+
    "        pmih.t_PayerAccount,                                                                                                 "+
    "        pmih.t_ReceiverBankName,                                                                                             "+
    "        pmih.t_ReceiverCorrAccNostro,                                                                                        "+
    "        pmih.t_ReceiverName,                                                                                                 "+
    "        pmih.t_ReceiverINN,                                                                                                  "+
    "        pmih.t_ReceiverAccount,                                                                                              "+
    "        pmih.t_ReceiverBankCode,                                                                                             "+
    "        pmih.t_Number as t_DocNum,                                                                                           "+
    "        pmih.t_Ground,                                                                                                       "+
    "        pmih.t_InstructionCode,                                                                                              "+
    "        t1.t_NumTab,                                                                                                         "+
    "        t1.t_PaymentID,                                                                                                      "+
    "        t1.t_DocKind,                                                                                                        "+
    "        to_char(pmih.t_FutureDRate * POWER( 10, -pmih.t_FutureDRatePoint )) || ' ' || decode( pmih.t_FutureDRateIsInverse, 'X', PM_SCRHLP.GetFICode( t1.t_BaseFIID ), PM_SCRHLP.GetFICode( t1.t_FIID_FuturePayAcc ) ) || ' §  ' || to_char( pmih.t_FutureDRateScale ) || ' ' ||decode( pmih.t_FutureDRateIsInverse, 'X', PM_SCRHLP.GetFICode( t1.t_FIID_FuturePayAcc ), PM_SCRHLP.GetFICode( t1.t_BaseFIID ) ) as t_FutureDRateStr, "+
    "        to_char(pmih.t_FutureCRate * POWER( 10, -pmih.t_FutureCRatePoint )) || ' ' || decode( pmih.t_FutureCRateIsInverse, 'X', PM_SCRHLP.GetFICode( t1.t_BaseFIID ), PM_SCRHLP.GetFICode( t1.t_FIID_FutureRecAcc ) ) || ' §  ' || to_char( pmih.t_FutureCRateScale ) || ' ' ||decode( pmih.t_FutureCRateIsInverse, 'X', PM_SCRHLP.GetFICode( t1.t_FIID_FutureRecAcc ), PM_SCRHLP.GetFICode( t1.t_BaseFIID ) ) as t_FutureCRateStr, "+
    "        PM_SCRHLP.GetFICode( t1.t_BaseFIID ) as  t_BaseFIIDStr                                                               "+
    "  from (  select t.*, ( case                                                                                                 "+
    "                          when t.t_PaymStatusDataRep not in( 2000, 2100, -1 ) and t_POStatusDataRep not in( 3, -1 ) then     "+
    "                            1                                                                                                "+
    "                          when t.t_POStatusDataRep = 3 then                                                                  "+
    "                            2                                                                                                "+
    "                          when t.t_PaymStatusDataRep = 2000 then                                                             "+
    "                            3                                                                                                "+
    "                          when t.t_PaymStatusDataRep = 2100 then                                                             "+
    "                            4                                                                                                "+
    "                          else                                                                                               "+
    "                            -1                                                                                               "+
    "                        end                                                                                                  "+
    "                      ) as t_NumTab                                                                                          "+
    "          from (select paym.t_PaymentID,                                                                                     "+
    "                       paym.t_BaseAmount as t_Sum,                                                                           "+
    "                       paym.t_DocKind,                                                                                       "+
    "                       paym.t_FIID_FuturePayAcc,                                                                             "+
    "                       paym.t_FIID_FutureRecAcc,                                                                             "+
    "                       paym.t_BaseFIID,                                                                                      "+
    "                       rm.t_Date as t_DocDate,                                                                               "+
    "                       hmax.t_MaxHistoryNum,                                                                                 "+
    "                       ( case                                                                                                "+
    "                           when :State1 != 2 then                                                                            "+
    "                             nvl( ( select pmh.t_StatusIDTo                                                                  "+
    "                                      from dpmhist_dbt pmh                                                                   "+
    "                                     where pmh.t_AutoKey = ( select max(pmhmax.t_AutoKey)                                    "+
    "                                                               from dpmhist_dbt pmhmax                                       "+
    "                                                              where pmhmax.t_PaymentID = hmax.t_PaymentID                    "+
    "                                                                and pmhmax.t_Date <= :RepDate1                               "+
    "                                                           )                                                                 "+
    "                                  ), 0                                                                                       "+
    "                                )                                                                                            "+
    "                           else                                                                                              "+
    "                             -1                                                                                              "+
    "                         end                                                                                                 "+
    "                       ) as t_PaymStatusDataRep,                                                                             "+
    "                       ( case                                                                                                "+
    "                           when paym.t_DocKind = 201 and :State2 not in (4, 3) then                                          "+
    "                             nvl( ( select poh.t_StatusIDTo                                                                  "+
    "                                      from dpspohist_dbt poh                                                                 "+
    "                                     where poh.t_OrderID = hmax.t_PaymentID                                                  "+
    "                                       and poh.t_Date <= :RepDate2                                                           "+
    "                                       and (   poh.t_DateChange > :RepDate3                                                  "+
    "                                             or                                                                              "+
    "                                               poh.t_DateChange = to_date('01.01.0001', 'dd.mm.yyyy')                        "+
    "                                           )                                                                                 "+
    "                                   ), 0                                                                                      "+
    "                                )                                                                                            "+
    "                           else                                                                                              "+
    "                             -1                                                                                              "+
    "                         end                                                                                                 "+
    "                       ) as t_POStatusDataRep,                                                                               "+
    "                       ( case                                                                                                "+
    "                           when paym.t_DocKind = 201 then                                                                    "+
    "                             ( select n.t_SzNameAlg                                                                          "+
    "                                 from dnamealg_dbt n, dpspayord_dbt po                                                       "+
    "                                 where po.t_OrderID = hmax.t_PaymentID                                                       "+
    "                                   and n.t_ITypeAlg = 2983                                                                   "+
    "                                   and n.t_INumberAlg = po.t_DocKind                                                         "+
    "                             )                                                                                               "+
    "                           when paym.t_DocKind = 203 then                                                                    "+
    "                             'ˆ­ª áá®¢®¥ ¯®àãç¥­¨¥ ª ¢ «îâ­®¬ã áç¥âã'                                                        "+
    "                           else                                                                                              "+
    "                             ( select okd.t_Name                                                                             "+
    "                                 from doprkdoc_dbt okd                                                                       "+
    "                                 where okd.t_DocKind = paym.t_DocKind                                                        "+
    "                             )                                                                                               "+
    "                         end                                                                                                 "+
    "                       ) as t_NamePrimDoc                                                                                    "+
    "                from ( select h.t_PaymentID as t_PaymentID, max(h.t_HistoryNum) as t_MaxHistoryNum                           "+
    "                         from dpminhist_dbt h                                                                                "+
    "                        where h.t_BankDate = :RepDate4                                                                       "+
    "                        group by h.t_PaymentID ) hmax, dpmpaym_dbt paym, dpmrmprop_dbt rm                                    "+
    "                where paym.t_PaymentID = hmax.t_PaymentID                                                                    "+
    "                  and rm.t_PaymentID = hmax.t_PaymentID                                                                      "+
    "                  and ( paym.t_StartDepartment = :DepNum1 or :DepNum2 <= 0 )                                                 "+
    "                  and ( paym.t_Oper = :Oper1 or :Oper2 <= 0 )                                                                "+
    "                  and ( paym.t_OperNode = :VspNum1 or :VspNum2 <= 0 )                                                        "+
    "               ) t                                                                                                           "+
    "       ) t1, dpminhist_dbt pmih, dpmchndoc_dbt pmcnd                                                                         "+
    "  where pmih.t_PaymentID = t1.t_PaymentID                                                                                    "+
    "    and pmih.t_HistoryNum <= t1.t_MaxHistoryNum                                                                              "+
    "    and pmcnd.t_DocumentID(+) = pmih.t_DocumentID                                                                            "+
    "    and (    :State3 = 1 and t1.t_NumTab != -1                                                                               "+
    "          or :State4 = 2 and t1.t_NumTab = 2                                                                                 "+
    "          or :State5 = 3 and t1.t_NumTab = 3                                                                                 "+
    "          or :State6 = 4 and t1.t_NumTab = 4                                                                                 "+
    "          or :State7 = 5 and t1.t_NumTab not in ( 2, 3, 4, -1 )                                                              "+
    "        )                                                                                                                    "+
    " order by t1.t_NumTab asc, t1.t_DocDate desc, t1.t_PaymentID desc, pmih.t_HistoryNum asc                                     ";                                                                                                                           
                                                                                                                              
  var params:TArray  = MakeArray( SQLParam( "State1"   , State   ),
                                  SQLParam( "RepDate1" , RepDate ),
                                  SQLParam( "State2"   , State   ),
                                  SQLParam( "RepDate2" , RepDate ),
                                  SQLParam( "RepDate3" , RepDate ),
                                  SQLParam( "RepDate4" , RepDate ),
                                  SQLParam( "DepNum1"  , DepNum  ),
                                  SQLParam( "DepNum2"  , DepNum  ),
                                  SQLParam( "Oper1"    , Oper    ),
                                  SQLParam( "Oper2"    , Oper    ),
                                  SQLParam( "VspNum1"  , VspNum  ),
                                  SQLParam( "VspNum2"  , VspNum  ),
                                  SQLParam( "State3"   , State   ),
                                  SQLParam( "State4"   , State   ),
                                  SQLParam( "State5"   , State   ),
                                  SQLParam( "State6"   , State   ),
                                  SQLParam( "State7"   , State   )                                                                                                                 
                                );

  var rs:RsdRecordset = execSQLselect( select, params, FALSE, RSDVAL_CLIENT, RSDVAL_STATIC );                                                               
                                                                                                                              
  if( rs )                                                                                                                    
    rs.Command.NullConversion = true;                                                                                         
[ âç¥â ¯® ¨§¬¥­¥­¨ï¬ ¢ à áç¥â­ëå ¤®ªã¬¥­â å 

  ”¨«¨ «: #################################################################################################
  ®¤à §¤¥«¥­¨¥: ##########################################################################################
  ¯¥à æ¨®­¨áâ: ###########################################################################################
  „ â  ®âç¥â : ############## 

] (DepName, VspName, IfThenElse( Oper <= 0, OperName, Oper + " " + OperName ), RepDate);
    PrintTables(rs);                                                                                                          
  end;


END;


