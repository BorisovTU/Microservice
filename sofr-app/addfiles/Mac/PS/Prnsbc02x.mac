/*
$Name:        Prnsbc02x.mac
$Module:      РКО
$Description: Печать заявлений об открытии/закрытии счета.
*/

/************************************************************************/
/*         Автоматизированная банковская система RS-Bank                */
/*                 Copyright (c) R-Style Software Lab 2014              */
/*                                                                      */
/*  Имя файла      : Prnsbc02x.mac                                      */
/*                                                                      */
/*  Релиз          : SBC0_510, SBC2_510                                 */
/*                                                                      */
/*  Описание       : Печать заявлений об открытии/закрытии счета.       */
/*                                                                      */
/*  Программист    : Тимонин Д. В.                                      */
/*                                                                      */
/*  Создан         : 27.05.14                                           */
/*                                                                      */
/************************************************************************/

IMPORT "BnkTemplReport.mac";
IMPORT rqmeslib, prngni;

private class (BnkTemplReport)ReqOpenCloseReport(p_wlmes)

  var wlmes = p_wlmes;

  MACRO Create()
      
    ОчиститьФормуСообщения();
    ЗаполнитьДанныеСообщенияОбОткрытииЗакрытии( wlmes );

    SetSheetName( ReqAccount );

    SetValuesMultiCell( "FormKND"               , "1114301"          ,3    ,  7 , //form
                        "SeriesAndNum_1"        , SeriesAndNum       ,3    , 18 , //1
                        "TypeMes_1"             , TypeMes            ,3    ,  3 , //2
                        "CodeNOB_1"             , CodeNOB            ,3    ,  4 , //4
                        "IndexSV_1"             , IndexSV            ,3    ,  6 , //8
                        "BankRegNomSV_1"        , BankRegNomSV       ,3    ,  4 , //10
                        "BankNumber_1"          , BankNumber         ,3    ,  4 , //11
                        "BankBIC_1"             , BankBIC            ,3    ,  9 , //12
                        "BankINN_1"             , BankINN            ,3    , 10 , //13
                        "BankKPP_1"             , BankKPP            ,3    ,  9 , //14
                        "BankOGRN_1"            , BankOGRN           ,3    , 13 , //15
                        "ClientCodeSV_1"        , ClientCodeSV       ,3    ,  1 , //5
                        "UchSeries_1"           , UchSeries          ,3    ,  2 , //19
                        "UchNumber_1"           , UchNumber          ,3    ,  9 , //20
                        "INNKIO_1"              , INNKIO             ,3    , 12 , //21
                        "KPP_1"                 , KPP                ,3    ,  9 , //22
                        "ORGRN_1"               , OGRN               ,3    , 15 , //23
                        "Zakl_1"                , Zakl               ,3    ,  1 , //24
                        "CodeContr_1"           , CodeContr          ,3    ,  1 , //25
                        "BankAlOrder_1"         , BankAlOrder        ,3    ,  1 , //40
                        "Court_1"               , Court              ,3    ,  1 , //41
                        "DogAccDateD_1"         , DogAccDateD        ,3    ,  2 , //26
                        "DogAccDateM_1"         , DogAccDateM        ,3    ,  2 , //26
                        "DogAccDateY_1"         , DogAccDateY        ,3    ,  4 , //26
                        "DogAccNumber_1"        , DogAccNumber       ,3    , 20 , //27
                        "OpenAcc_1"             , OpenAcc            ,3    ,  1 , //28
                        "CloseAcc_1"            , CloseAcc           ,3    ,  1 , //29
                        "NatCurAcc_1"           , NatCurAcc          ,3    ,  1 , //30
                        "ValCurAcc_1"           , ValCurAcc          ,3    ,  1 , //31
                        "OpClAccDateD_1"        , OpAccDateD         ,3    ,  2 , //33
                        "OpClAccDateM_1"        , OpAccDateM         ,3    ,  2 , //33
                        "OpClAccDateY_1"        , OpAccDateY         ,3    ,  4 , //33
                        "ReqAccount_1"          , ReqAccount         ,3    , 20 , //34
                        "OpClAccDateD_2"        , ClAccDateD         ,3    ,  2 , //39
                        "OpClAccDateM_2"        , ClAccDateM         ,3    ,  2 , //39
                        "OpClAccDateY_2"        , ClAccDateY         ,3    ,  4 , //39
                        "MessAccDateD_1"        , MessAccDateD       ,3    ,  2 , //37
                        "MessAccDateM_1"        , MessAccDateM       ,3    ,  2 , //37
                        "MessAccDateY_1"        , MessAccDateY       ,3    ,  4 , //37
                        "Phone_1"               , Phone              ,3    , 20   //38
                      );

    SetValues( "NameCOSV_1"       , NameCOSV,       // 7
               "BankAddrMNKO_1"   , BankAddrMNKO,   // 9
               "FullNameFIO_1"    , FullNameFIO,    // 16 
               "KindAcc_1"        , KindAcc,        // 32
               "PostBank_1"       , PostBank,       // 35
               "FamPRB_1"         , FamPRB          // 36
             );   

  END;

  initBnkTemplReport("ReqOpenCloseBNK.xls");
end; 

/* Макрос печати заявления на открытие/закрытие счета */
MACRO PrintDocument( mes ):bool  
  var StatDoc:integer;
  SetBuff(wlmes, mes);
  //сначала ищем, какой документ будем печатать
  StatDoc = FindAllFile();
  if(StatDoc == 0)
    Msgbox("По данному документу не найдено заявление на|открытие (закрытие, изменение) счета");
    return true;
  else
    if( ( StatDoc == 1 ) or ( StatDoc == 2 ) )
      if(( GetKindRegOrgan() == REG_ORGAN_KIND_FNS ) or ( GetKindRegOrgan() == REG_ORGAN_KIND_NON ))
        ReqOpenCloseReport(wlmes).Print();
      end;
    end;
  end;
  return TRUE;
END;
