//-----------------------------------------------------------------------------
// Блок     : "Обработка отвергнутого"
// Шаг      : "Обработка отвергнутого"
// Описание : Макрос шага
//-----------------------------------------------------------------------------

import PaymInter, PSInter, psbccomn, cbsttls;

var PaymentObj:RsbPayment;

MACRO ExecuteStep( doc, paymDoc )
  if( PM_NeedDocumentRestart() == true )
    if( УстановитьСтатусыПлатежа( OPR_BC_DO, OPR_BC_ST_PREP ) )
      msgbox("Ошибка при установке сегментов статуса экземпляра операции");
      return 1;
    end;
    if( УстановитьСтатусыПлатежа( OPR_BC_CONTROL, OPR_BC_ST_CTRL_NOTCONTROL ) )
      msgbox("Ошибка при установке сегментов статуса экземпляра операции");
      return 1;
    end;
    BC_SetPrimDocumentState( PaymentObj, PSBCORD_ST_WORKING );
    PaymentObj.PaymStatus = PM_READIED;
  else
    if( УстановитьСтатусыПлатежа( OPR_BC_STATE, OPR_BC_ST_CLOSE ) )
      msgbox("Ошибка при установке сегментов статуса экземпляра операции");
      return 1;
    end;
  end;

  return 0;
END;
