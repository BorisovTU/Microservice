//-----------------------------------------------------------------------------
// Блок      : Вне блока
// Шаг       : Вне шага
// Назначение: Различные функции
// Описание  : Классы для работы со счетами КУ
//-----------------------------------------------------------------------------
import OprInter, PaymInter, "cat_acc.mac", "pm_categ.mac", pm_common;

//-----------------------------------------------------------------------------
// Первичный документ для счета КУ "Картотека 1"
//-----------------------------------------------------------------------------
CLASS (TCommonFirstDoc) PaymIndex1_FirstDoc( parm1, parm2 )


   VAR
      m_payment:RsbPayment, m_payOrder;

   PRIVATE MACRO InitParmArray

      ParmA[regList.registration(MC_TYPE_PARAMETR_DOCKIND   )] = m_payment.DocKind   ;
      ParmA[regList.registration(MC_TYPE_PARAMETR_DOCID     )] = m_payment.PaymentID ;
      ParmA[regList.registration(MC_TYPE_PARAMETR_FIID      )] = m_payment.PayerFIID ;
      ParmA[regList.registration(MC_TYPE_PARAMETR_OWNER     )] = m_payment.Payer     ;
      ParmA[regList.registration(MC_TYPE_PARAMETR_DEPARTMENT)] = m_payment.Department;
      
      if( m_payment.DocKind == PS_PAYORDER )
        m_payOrder = GenObject( "RsbPsPayOrder", m_payment.PaymentID );
        ParmA[regList.registration(MC_TYPE_PARAMETR_INDEXDATE )] = GetNextDateAfterDays( m_payOrder.AcceptDate, m_payment.StartDepartment, CALENDAR_SERVICE_BANK, /*ON*/1, 1 );
      end;
      
      ParmA[regList.registration(MC_TYPE_PARAMETR_CONTRACTOR)] = m_payment.Payer;

      FIRoleBArray[0] = 0;
   END;

   // Конструктор

   if( ValType( parm2 ) == V_INTEGER  )   // Если 2 параметра - то это DocKind и DocID
     m_payment = RsbPayment( parm2 );
   elif( ValType( parm1 ) == V_INTEGER  ) // Если 1 параметр  - то это DocID
     m_payment = RsbPayment( parm1 );
   else                                   // Если параметров нету...
     m_payment = RsbPayment( 0 );
   end;

   InitTCommonFirstDoc();
   InitParmArray();

   Kind = ParmA[MC_TYPE_PARAMETR_DOCKIND];
   Id   = ParmA[MC_TYPE_PARAMETR_DOCID  ];
END;

