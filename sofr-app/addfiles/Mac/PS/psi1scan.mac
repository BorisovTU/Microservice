/*
  $Name:        psi1scan.mac
  $Module:      РКО
  $Description: Печать протокола работы процедуры сканирования К1
*/

/*──────────────────────────────────────────────────────────────────────────┐
                                            R-Style Software Lab

  File Name   : psi1scan.mac
  Created     : 6.04.2012
  Programmer  : Лазаренко М.
  Description : Печать протокола работы процедуры сканирования К1

└───────────────────────────────────────────────────────────────────────────*/
import payinter;


macro I1ScanReportPrintHeader( Oper:integer )

  var Note:string = NULL;
[
   Протокол процедуры сканирования картотеки №1 по сроку акцепта ##########

   Дата отчета: ##########                                                                    ]
( {curdate}, {curdate} );

[  Операционист: #### # ]( {oper}, {Name_Oper} );
[  ──────────┬──────────┬──────────────────┬─────────────────────────┬─────────┬─────────────────────────┬────────────────────────────────────────┬──────────────────┬───────────────────────────────────
    Номер    │  Дата    │    Сумма         │  Счет плательщика       │  Банк   │ Счет получателя         │   Получатель                           │  Сумма акцепта   │ Примечание
    док.     │ документа│  документа       │                         │  получ. │                         │                                        │                  │
   ──────────┴──────────┴──────────────────┴─────────────────────────┴─────────┴─────────────────────────┴────────────────────────────────────────┴──────────────────┴─────────────────────────────────── ]; 
end;

macro I1ScanReportPrintStr( PaymentID:integer, Note:string, AcceptSum )
  var query :string = " select dem.t_orderid, rm.t_number,         "
                      "   rm.t_date, dem.t_reqsum,                 "
                      "   pm.t_payeraccount, prop.t_BankCode,      "
                      "   pm.t_ReceiverAccount, rm.t_ReceiverName  "
                      " from dpmpaym_dbt pm,                       "
                      "   dpspaydem_dbt dem,                       "
                      "   dpspayord_dbt ord,                       "
                      "   dpmrmprop_dbt rm,                        "
                      "   dpmprop_dbt prop                         "
                      " where pm.t_paymentid     = :paymentID      "
                      "   and pm.t_documentid    = dem.t_orderid   "
                      "  and dem.t_orderid = ord.t_orderid         "
                      "  and pm.t_paymentid = prop.t_paymentid     "
                      "  and prop.t_debetcredit = :CREDIT          "
                      "   and rm.t_paymentid     = pm.t_paymentid  ";


  var params:TArray = makeArray( SQLParam( "paymentid", PaymentID ), SQLParam( "CREDIT", 0 ) );
  
  var rs:RsdRecordset = execSQLselect( query, params );
  while( rs.moveNext() )
  
[  ########## ########## ################## ######################### ######### ######################### ######################################## ################## ################################### ]
( rs.Value(1),
  date(rs.Value(2)), 
  rs.Value(3), 
  rs.Value(4),
  rs.Value(5),
  rs.Value(6),
  rs.Value(7),
  AcceptSum,
  Note:w );
  end;
  
end;                      
