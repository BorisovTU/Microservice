/*
  $Name:        lcdoc.mac
  $Module:      Документарные аккредитивы
  $Description: Макрос скроллинга документарных аккредитивов
*/

//-----------------------------------------------------------------------------
//          Автоматизированная банковская система RS-Bank               
//                 Copyright (c) R-Style Software Lab
//
// Описание     : Макрос скроллинга документарных аккредитивов
//
// Программист  : Чукина Т.А.
//
// Создан       : 11.03.2013
//
//-----------------------------------------------------------------------------

import LCInter, BankInter, likepy;

RECORD r_lcdoc(lcdoc);
RECORD r_lcreimb(lcreimb);
var    s_docreq : string = "";
var    s_addcond : string = "";

RECORD r_lcdoc_old(lcdoc);
RECORD r_lcreimb_old(lcreimb);
var    s_docreq_old : string = "";
var    s_addcond_old : string = "";

/*Хинт для списков по статусу документа*/
private const Hint_ByStatus : string = "/*+FIRST_ROWS LEADING(t) INDEX(t dlcdoc_dbt_idx1)*/";

/* Установка подсказки для скроллингов из макроса */
MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStates:integer ):string

  if( InList(ScrolStates, LCDOC_SFLTR_ALL, LCDOC_SFLTR_WAITING) ) // Все, Ожидающие исполнения
    return DefaultHint;
  end;

  return Hint_ByStatus;
END;

macro Новый_Документ()
  return 0;
end;

/*
 * Проверка документа при определённых действиях
 * @param Mode Вид действия
 * @return 0 - всё хорошо
           >0 - номер поля, что-то плохо
           CHANG_IMPORTANT,CHANG_NOTKEEP - изменения документа с операцией важные, сохранение запрещено
           CHANG_NOTIMPORTANT - изменения документа с операцией неважные, сохранение возможно
 */
macro Проверить_Документ( Mode )

  private macro ShowError( Text:string, FldNumber:integer ):integer
    MsgBox( Text );
    return FldNumber + 1;
  end;

  // Проверки корректности при вводе/редактировании
  if( ( Mode == OBJ_INSERT    ) or
      ( Mode == OBJ_INSNOTOPR ) or
      ( Mode == OBJ_UPDATE    ) 
    )
    if(   r_lcdoc.ValidDate == date( 0, 0, 0 ) )
      return ShowError( "Не задана дата, до которой действует документ", LCDOCPN_PF_VALIDTODATE );
    elif( r_lcdoc.Amount == $0 )
      return ShowError( "Не задана сумма документа", LCDOCPN_PF_AMOUNT );
    elif( r_lcdoc.FIID == -1 )
      return ShowError( "Не задана валюта", LCDOCPN_PF_FICODE );
    elif( not trim( r_lcdoc.Rules ) )
      return ShowError( "Не заданы правила", LCDOCPN_PF_RULES );
    end;
  end;

  return 0;
end;

macro Функция_Пользователя( Режим:integer ) 
 /*
 Возможные значения Режим:
  UFN_PANEL_INPUT(1) - функция вызвана из панели ввода объекта;
  UFN_PANEL_EDIT(2) - функция вызвана из панели корректировки объекта;
  UFN_SCROL(3) - функция вызвана из панели скролинга, единичный вызов, любая корректировка объекта запрещена;
  UFN_SCROL_FMASS(4) - функция вызвана из панели скролинга, работа по нескольким записям, вызов до начала обработки, любая корректировка объекта запрещена;
 
 // Пример работы: 
 if( Режим == UFN_SCROL )
   return UPDTPAGE;    // Обновить страницу записей и область скролинга
   //return UPDTREC;     // Обновить текущую запись, загрузив из файла
 end;
 */
 return  0;
end;
