/*
  $Name:        lc006_10.mac
  $Module:      Документарные аккредитивы
  $Description: Макрос шага
*/

// --------------------------------------------------------------------
//         Автоматизированная банковская система RS-Bank v6.0
//                 Copyright (c) R-Style Software Lab
//
//  Назначение  : Макрос шага
//
//  Описание    : Операция - 3411   - "Аккредитив"
//                Блок     - 341006 - "Выдача кредита RS-Loans"
//                Шаг      - 10     - "Открытие кредитного договора в RS-Loans"
//
//  Программист : Чукина Т.А.
//
//  Создан      : 23.05.2013
//
// --------------------------------------------------------------------

IMPORT LCInter;

var LCDocObj:RsbLetterOfCredit;

MACRO ExecuteStep()
  var RecLcpay : TRecHandler = TRecHandler("lcpay");

  var IsFoundPay : bool = ( LCDocObj.Pays().First(RecLcpay) == 0 );

  while(IsFoundPay)
    if(RecLcpay.rec.CoverState == LCPAY_COVER_STATUS_NOTPROC) // не обработано
      var stat : integer = 0;
      if(RecLcpay.rec.ContrID <= 0)
        // пока не реализуется

      end;

      if(not stat)
        RecLcpay.rec.CoverState == LCPAY_COVER_STATUS_TOTRANSFER; // К перечислению
        if( LCDocObj.Pays().Update(RecLcpay) != 0 )
          msgbox("Ошибка при изменении статуса покрытия выплаты");
          return 1;
        end;
      end;
    end;

    IsFoundPay = ( LCDocObj.Pays().Next(RecLcpay) == 0 );
  end;

  return 0;
END;
