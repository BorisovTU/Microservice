/*
  $Name:        lc004_10.mac
  $Module:      Документарные аккредитивы
  $Description: Макрос шага
*/

// --------------------------------------------------------------------
//         Автоматизированная банковская система RS-Bank v6.0
//                 Copyright (c) R-Style Software Lab
//
//  Назначение  : Макрос шага
//
//  Описание    : Операция - 3411   - "Аккредитив"
//                Блок     - 341004 - "Выпуск рамбурсного полномочия"
//                Шаг      - 10     - "Выгрузка рамбурсного полномочия в МБР"
//
//  Программист : Чукина Т.А.
//
//  Создан      : 22.05.2013
//
// --------------------------------------------------------------------

IMPORT LCInter, InsCarryDoc, BankInter;

var LCDocObj:RsbLetterOfCredit;

private macro GenMessage() : integer
  var stat = 0;

  var Rei : TRecHandler = TRecHandler("lcparty");
  LCDocObj.Parties.Find(LCPARTY_KIND_REIMBURSING_BANK, Rei);

  stat = InsertLCMessage(LCDocObj.LcdocID, LCDocObj.RlsFormID_LCREIMB, LCDocObj.TpSchemID_LCREIMB, Rei);
  if(stat)
    DisplayError();
  end;

  return stat;
end;

MACRO ExecuteStep()
  var stat : integer = 0;
  var ShowRlsPanel : bool = true;

  if(LCDocObj.IsEmptyLcreimb())
    msgbox("Не задан способ рамбурсирования");
    return 1;
  end;

  if(LCDocObj.RlsFormID_LCREIMB <= 0)
    stat = DefineRlsFormLCDOC_Reimburs(LCDocObj, 0, LCDocObj.TpSchemID_LCREIMB, 0, LCDocObj.RlsFormID_LCREIMB, ShowRlsPanel);
    if(stat)
      msgbox("Не определена форма и релиз сообщения рамбурсного полномочия");
      return stat;
    end;
  end;

  stat = GenMessage();

  return stat;
END;
