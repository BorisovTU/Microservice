/* отчет о количестве и сумме остатка на счетах каждого вида вкладов.
   Для проверки работы конвертации */

file dep(depositr,"..\\vklady.db\\bank.def") key 4;

/*--------------------------*/
macro PrintType(LT,wS,wC,tC,LC)

[___________________________________________________
  #  ############   #                     #         #
](tC:r, LT, LC, money(wS):a:r, wC:l);

end;


var wSum=0.00;
var wCnt=0;
var LastType="";
var LastCurr=0;
var TCounter=0;  
var GCntKZT=0;
var GCntUSD=0;

[
  Тип счета                 Сумма          Кол-во
];
if(open(dep,"..\\vklady.db\\depositr.dbt"))

 next(dep);
 LastType=dep.Type_Account;
 LastCurr=dep.Code_Currency;
 if(dep.Open_Close=="")
    wSum=wSum+dep.SumR0;
    wCnt=wCnt+1;
        if(dep.Code_Currency==0)
            GCntKZT=GCntKZT+1;
            else
                GCntUSD=GCntUSD+1;
        end;
 end;
 while(next(dep))
    if(dep.Type_Account!=LastType)
        TCounter=TCounter+1;
        PrintType(LastType,wSum,wCnt,TCounter,LastCurr);
        wSum=0.00;
        wCnt=0;
        LastType=dep.Type_Account;
        LastCurr=dep.Code_Currency;

    end;
    if(dep.Open_Close!="")
[
kzt #                            usd #
](GCntKZT:l,GCntUSd:l);
        return;
    end;
    if(dep.Open_Close=="")
        wSum=wSum+dep.SumR0;
        wCnt=wCnt+1;
        if(dep.Code_Currency==0)
            GCntKZT=GCntKZT+1;
            else
                GCntUSD=GCntUSD+1;
        end;
    end;
 end;

else
 msgbox("!");
end;

