/*-RSL---------------------------------------- R-Style Software Lab --*/
/*--------------- Печать справки о приеме на экспертизу --------------*/
/* RS-Bank      подсистема Обменный пункт   AV  16.05.97              */
/* 14.11.2000 VS Адаптирован для Оперкассы.                           */

import ExchangeInter, "sprvfunc.mac", "rstrfunc.mac", "string.mac", sprexpcl;
record      e ("b_incaso.str", "exchange.def");
file exoperat ("exoperat.dbt", "exchange.def") key 1;

/* структура b_incaso.str используется как для печати квитанции о приеме на  */
/* инкассо, так и для печати справки о приеме денежного билета на экспертизу*/

/******************************************************************************/
class (TSpravkaExpertPrint) TKassaSpravkaExpertPrint

  macro GetNumSpravka()    
    return e.NumbSprv;
  end;

  macro ProcessBagInfo()
    ProcessBagInfoEx( exoperat.IncomeRefVal );
  end;

  macro FillFIODocumAndAddress()
    var clntL = TClientList;

    FIO = exoperat.Sname + " " + exoperat.Name + " " + exoperat.Pname;
    Docum = GetNameOfPAPRKIND ( exoperat.ClientDocType ) + " " + 
            exoperat.ClientDocSeria + " № " + 
            exoperat.ClientDocNumber + " выдан (кем, когда) " + 
            exoperat.ClientDocInfo;

    if ( clntL.GetRecord( exoperat.ClientCode ) )
        PaperIssuerCode = clntL.CurRec.rec.PaperIssuerCode;

        // почтовый адрес
        clntL.CurRec.AdressType = 3;
        Address = clntL.CurRec.rec.Address;
    end;
    // юридический адрес клиента (в справке нужен почтовый)
    //Address = exoperat.ClientAddress;
  end;

  InitTSpravkaExpertPrint;
end;


/******************************************************************************/

/* находит первичку по данной операции */
macro FindExOperat()
  exoperat.ApplicationKind = e.ApplicationKind;
  exoperat.ApplicationKey  = e.ApplicationKey;
  GetEQ( exoperat );
end;

macro PrintReference( Incasso )
  ARRAY SD;

  var obj;
  
  SetBuff( e, Incasso );
  var Seria, Number;
  
  /* Информация о клиенте */
  var FullName = e.Surname + " " + e.FirstName + " " + e.Patronymic;
  var DocInfo  = e.DocName + " " + e.DocSer + " " + e.DocNum;
  
  /* Информация о ценности */
  var Full = e.TrsName + ", " + trim(e.NameNominal) + ", " + 
             RegNumToStr( e.Seria, e.Numb ) + ", ";
  if( e.YearIssuer ) Full = Full + e.YearIssuer + ", "; end;
  Full = Full + e.Issuer;
  StrSplit( Full, SD, 66, 66, 3 );

  FindExOperat(); /* найдем первичку по данной операции */

  /* Информация о справке БСО */
  if( (e.SprvSer == "--") or (e.SprvNum == "0000000") )
    GetSprvSerNum( e.ApplicationKind, e.ApplicationKey, GetBSOShortName (), Seria, Number );
    Number = string(Number);
    Number = StrFillBeg( Number, "0", 7 ); /* дополнение ведущими нулями */
    e.SprvSer = Seria;
    e.SprvNum = Number;
  end;
  
  /* печать содержимого справки */

  if( exoperat.SubOper == 0 )
//    ШапкаСправкиОПриеме(); /* печать общей шапки */
/*
[
                            СПРАВКА N ########
          О ПРИЕМЕ НА ЭКСПЕРТИЗУ ДЕНЕЖНОГО БИЛЕТА ИНОСТРАННОГО
        ГОСУДАРСТВА (ПЛАТЕЖНОГО ДОКУМЕНТА В ИНОСТРАННОЙ ВАЛЮТЕ),
                 ВЫЗЫВАЮЩЕГО СОМНЕНИЕ В ЕГО ПОДЛИННОСТИ

                                     #

        Настоящая    справка     составлена     в    том,    что    у
   лица                              #
       (фамилия, имя и отчество)

                                 #
   (паспорт или заменяющий его документ)

   был  изъят  сомнительный денежный  билет  иностранного государства
   (платежный документ в иностранной валюте)
   ##################################################################
    (наименование, номинал, серия и номер,
   ##################################################################
                   год эмиссии, наименование эмитента)
   ##################################################################


   Указанный денежный билет (платежный документ) подлежит  экспертизе
   в установленном порядке.
](
   e.NumbSprv,
   StrAddZeroDate( e.DateOper ),
   FullName:c,
   DocInfo:c,
   SD(0),
   SD(1),
   SD(2)
 );
*/
    CountryInit = e.Issuer;
    FIOInit = FullName;
    NominalInit = e.NameNominal;
    if( e.YearIssuer ) 
      YearInit = e.YearIssuer;
    end;
    SeriesInit = RegNumToStr( e.Seria, e.Numb );
    obj = TKassaSpravkaExpertPrint;
    obj.RunReport();

  elif( exoperat.SubOper == 1 )

    ШапкаСправкиОПриеме(); /* печать общей шапки */
[
                            СПРАВКА N ########
               О ПРИЕМЕ НА ЭКСПЕРТИЗУ ЛОТЕРЕЙНОГО БИЛЕТА,
                 ВЫЗЫВАЮЩЕГО СОМНЕНИЕ В ЕГО ПОДЛИННОСТИ

                                     #

        Настоящая    справка     составлена     в    том,    что    у
   лица                              #
       (фамилия, имя и отчество)

                                 #
   (паспорт или заменяющий его документ)

   был  изъят  сомнительный  лотерейный  билет
   ##################################################################
    (наименование, номинал, серия и номер,
   ##################################################################
                   год эмиссии, наименование эмитента)
   ##################################################################


   Указанный  лотерейный  билет  подлежит  экспертизе
   в установленном порядке.
](
   e.NumbSprv,
   StrAddZeroDate( e.DateOper ),
   FullName:c,
   DocInfo:c,
   SD(0),
   SD(1),
   SD(2)
 );

  if( StrFor(GetProgramID) != "X" )
[
   Кассир операционной кассы _______________ (#######################)]( {FIO_oper} );
  else
[
   Кассир обменного пункта ________________ (########################)]( {FIO_oper} );
  end;

[                             (подпись)

   Штамп (печать) кассира обменного пункта

   Справка напечатана в двух экземплярах.
];
  elif( exoperat.SubOper == 2 )
    ШапкаСправкиОПриеме(); /* печать общей шапки */
[
                            СПРАВКА N ########
                   О ПРИЕМЕ НА ЭКСПЕРТИЗУ СЕРТИФИКАТА,
                 ВЫЗЫВАЮЩЕГО СОМНЕНИЕ В ЕГО ПОДЛИННОСТИ

                                     #

        Настоящая    справка     составлена     в    том,    что    у
   лица                              #
       (фамилия, имя и отчество)

                                 #
   (паспорт или заменяющий его документ)

   был  изъят  сомнительный  сертификат
   ##################################################################
    (наименование, номинал, серия и номер,
   ##################################################################
                   год эмиссии, наименование эмитента)
   ##################################################################


   Указанный сертификат подлежит экспертизе в установленном порядке.
](
   e.NumbSprv,
   StrAddZeroDate( e.DateOper ),
   FullName:c,
   DocInfo:c,
   SD(0),
   SD(1),
   SD(2)
 );

  if( StrFor(GetProgramID) != "X" )
[
   Кассир операционной кассы _______________ (#######################)]( {FIO_oper} );
  else
[
   Кассир обменного пункта ________________ (########################)]( {FIO_oper} );
  end;

[                             (подпись)

   Штамп (печать) кассира обменного пункта

   Справка напечатана в двух экземплярах.
];
  end;

end;
