/*-RSL---------------------------------------- R-Style Software Lab --*/
/*---------------------- è•Á†‚Ï ·Ø‡†¢™® Æ° Æ·‚†‚™†Â ------------------*/
/* RS-Bank      ØÆ§·®·‚•¨† é°¨•≠≠Î© Ø„≠™‚             RA 04-02-02     */

import ExchangeInter, DeskInter,
       "define.mac", "RD_Comm.mac", "office.mac", chkboss;

file GroupMember ( "groupmem.dbt", "sbbank.def" ) key 0;
file CashDC      ( "sb_casdc.dbt", "sbbank.def" ) key 5;
file CashAcc     ( "sb_casac.dbt", "sbbank.def" ) key 0;
file RegNum      ( "reg_num.dbt" , "sbbank.def" ) key 0;
file Bunch       ( "bunch.dbt"   , "sbbank.def" ) key 0;
file Alg         ( "namealg.dbt" , "bank.def"   ) key 0;

const 
      CASHOP_REMOVE_SAFE_1 = 12, /* Ç≠„‚‡•≠≠•• ØÆ§™‡•Ø´•≠®• ·•©‰† (è‡®ÂÆ§) */
      CASHOP_CREDIT_SAFE   = 14, /* è‡®ÂÆ§ ¢ ·•©‰ */

      ALG_CASH_VAL_TYPE    = 811,/* í®ØÎ ‡•·„‡·Æ¢ ™†··Î ¢ namealg.dbt */

      TYPEDOC_CARRYOFF     = 1,  /* é‚´Æ¶•≠ (≠• ØÆ§‚¢•‡¶§•≠) */
      TYPEDOC_CARRYON      = 2;  /* è‡Æ¢•§•≠ (ØÆ§‚¢•‡¶§•≠)   */

var äÆ´è†Á•™ñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† = 0, Ç·•£Æñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† = 0;

MACRO ë‚‡Æ™†èÆ§®‚Æ£†ñ•≠≠Æ·‚®()
 if( (äÆ´è†Á•™ñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† > 1) and (Ç·•£Æñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† != 0) )
   [|                          à‚Æ£Æ:|            |                          | ######## |]( Ç·•£Æñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† );
 end;
END;

MACRO GetNativeSafe()

  file Group("rtgroup.dbt") key 2;

  var
     OperBrigade = GetOperBrigade();
 
  Group.Branch = Branch;
  Group.Date = {curdate};
  Group.ID = OperBrigade;
  if(GetEQ(Group))
    return Group.SafeID;
  else
    MsgBox("ç• ≠†©§•≠ ·•©‰ °‡®£†§Î ¸ ", OperBrigade);
    Exit;
  end;
END;

MACRO WorkDeskName( Oper, Brigade )
  var Name, name1;

  if ( Oper == 0 )
    Name = "0";
  else
    Name = string(Oper);    Name = mkstr( "0", 4 - strlen(Name )) + Name;
    name1= string(Brigade); name1= mkstr( "0", 2 - strlen(name1)) + name1;
    Name = Name + "\/" + name1;
  end;
  return Name;  
END;

/*  èÆ´„Á®‚Ï ≠†ß¢†≠®• ‚®Ø† ‡•·„‡·† ™†··Î                                  */
MACRO GetCashTypeName( Type )
  Alg.iTypeAlg   = ALG_CASH_VAL_TYPE;
  Alg.iNumberAlg = Type;
  if(GetEQ(Alg))
    return Alg.szNameAlg;
  else
    return "???";
  end;
END;

/* ë‰Æ‡¨®‡Æ¢†‚Ï ≠†ß¢†≠®• ‡•·„‡·† ™†··Î                                    */
MACRO MakeCashValueName()
  if( CashValue.Type != TYPE_RES_PAY )
    return CashValue.NameValue + "\n(" + GetCashTypeName( CashValue.Type ) + ")";
  else
    return CashValue.NameValue;
  end;
END;

MACRO á†£Æ´Æ¢Æ™ñ•≠≠Æ·‚•©( TypeValue )
  if  ( TypeValue == TYPERES_CURRENCY )
[+---------------------+---+---------------+-----------------------------------------+];
[| ç†®¨•≠Æ¢†≠®• ¢†´Ó‚Î |äÆ§| ë„¨¨† Ê®‰‡†¨® |ë„¨¨† Ø‡ÆØ®·ÏÓ · „™†ß†≠®•¨ ≠†®¨•≠Æ¢†≠®Ô  |];
[|                     |¢†´|               |                 ¢†´Ó‚Î                  |];
[+---------------------+---+---------------+-----------------------------------------+];
  elif( TypeValue == TYPERES_PAYDOC   )
[+--------------------------------+---+---------------+------------------------------+];
[|    Ç®§ Ø´†‚•¶≠Æ£Æ §Æ™„¨•≠‚†    |äÆ§| ë„¨¨† Ê®‰‡†¨® |  ë„¨¨† Ø‡ÆØ®·ÏÓ · „™†ß†≠®•¨  |];
[|                                |¢†´|               |     ≠†®¨•≠Æ¢†≠®Ô ¢†´Ó‚Î      |];
[+--------------------------------+---+---------------+------------------------------+];
  elif( TypeValue == TYPERES_VALFORM  )
[+--------------------------------+-------------------------+-------------+----------+];
[|    Ç®§ Ê•≠≠Æ£Æ °´†≠™†          |        çÆ¨•‡†   ·       |      ØÆ     |äÆ´®Á•·‚¢Æ|];
[|                                |                         |             |          |];
[+--------------------------------+-------------------------+-------------+----------+];
  end;
END;

MACRO ë‚‡Æ™†ñ•≠≠Æ·‚•©( TypeValue, í®ØÑ†≠≠ÎÂ )
  var 
      CurrNumericalCode = GetCurrNumericalCode( FindCodCurByRefVal( CashValue.RefValue ) ),
      ValueMoney,
      ValueCol,
      Series,
      MinNum,
      MaxNum;
  var ç†ß¢†≠®•Ñ´Ôè•Á†‚® = "";
      
  if  ( í®ØÑ†≠≠ÎÂ == "è‡®ÂÆ§" )
    ValueMoney = CashDC.ValueMoney;
    ValueCol   = CashDC.ValueCol;
    Series     = Bunch.Series;
    MinNum     = Bunch.Min;
    MaxNum     = Bunch.Max;
  elif( í®ØÑ†≠≠ÎÂ == "é·‚†‚Æ™" )
    ValueMoney = CashAcc.RestMoney;
    ValueCol   = CashAcc.RestCol;
    Series     = RegNum.Series;
    MinNum     = RegNum.Min;
    MaxNum     = RegNum.Max;
  end;

  if( (ValueMoney == 0) and (ValueCol == 0) )          return;       end;

  if  ( TypeValue == TYPERES_CURRENCY )
[|#####################|###|###############|#########################################|]
    ( MakeCashValueName():w,
      CurrNumericalCode,
      ValueMoney,
      CurToStrAlt( ValueMoney, null, null, int(CurrNumericalCode) ):w
    );
  elif( TypeValue == TYPERES_PAYDOC   )
[|################################|###|###############|##############################|]
    ( MakeCashValueName():w,
      CurrNumericalCode,
      ValueMoney,
      CurToStrAlt( ValueMoney, null, null, int(CurrNumericalCode) ):w
    );
  elif( TypeValue == TYPERES_VALFORM  )
    if( Ç·•£Æñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† == 0 ) ç†ß¢†≠®•Ñ´Ôè•Á†‚® = MakeCashValueName(); end;
    Ç·•£Æñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† = Ç·•£Æñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† + MaxNum - MinNum + 1;
    äÆ´è†Á•™ñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† = äÆ´è†Á•™ñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† + 1;
[|################################|#########################|#############| ######## |]
    ( ç†ß¢†≠®•Ñ´Ôè•Á†‚®:w,
/*      Series:c,
      MinNum:r,*/
      RegNumToStr( Series, MinNum ):c,
      MaxNum:c,
      MaxNum - MinNum + 1
    );
  end;
END;

MACRO ë‚‡Æ™†é·‚†‚™Æ¢ñ•≠≠Æ·‚•©( TypeValue )
  ë‚‡Æ™†ñ•≠≠Æ·‚•©( TypeValue, "é·‚†‚Æ™" );
END;

MACRO ë‚‡Æ™†è‡®ÂÆ§†ñ•≠≠Æ·‚•©( TypeValue )
  ë‚‡Æ™†ñ•≠≠Æ·‚•©( TypeValue,  "è‡®ÂÆ§" );
END;

MACRO à‚Æ£ñ•≠≠Æ·‚•©( TypeValue )
  if  ( TypeValue == TYPERES_CURRENCY )
[+---------------------+---+---------------+-----------------------------------------+];
  elif( TypeValue == TYPERES_PAYDOC   )
[+--------------------------------+---+---------------+------------------------------+];
  elif( TypeValue == TYPERES_VALFORM  )
[+--------------------------------+------------+--------------------------+----------+];
  end;
END;

MACRO ë‚‡Æ™®è‡®ÂÆ§†ñ•≠≠Æ·‚•©àßè†Á•™( TypeValue, ValueRef )
   
  var
    RecFound;

  ClearRecord( Bunch );
  Bunch.BagAppKind = CashDC.ApplicationKind;
  Bunch.BagAppKey  = CashDC.ApplicationKey;
  Bunch.Nominal    = $10000000000;
  RecFound = GetGE( Bunch );

  while (     RecFound
        and ( Bunch.BagAppKind == CashDC.ApplicationKind )
        and ( Bunch.BagAppKey  == CashDC.ApplicationKey  )
        )
    ë‚‡Æ™†è‡®ÂÆ§†ñ•≠≠Æ·‚•©( TypeValue );
    RecFound = Next( Bunch );
  end;

END;

MACRO Filterè‡®ÂÆ§( TypeValue, RefValue, í®ØÑ†≠≠ÎÂ )
  var RetVal = false;

  if(   (  ( í®ØÑ†≠≠ÎÂ      == "Ä¢†≠·"              )
      and( ( CashDC.NumOper == CASHOP_CREDIT_SAFE   ) or
           ( CashDC.NumOper == CASHOP_ADVANCE       )  )
        )
    or  (  ( í®ØÑ†≠≠ÎÂ      == "è•‡•§†Á†"           )
      and  ( CashDC.NumOper == CASHOP_REMOVE_SAFE_1 )
        )
    )
    if  ( RefValue > 0 )
      RetVal = (   (  TypeValue == CashValue.TypeValue ) 
               and (  RefValue  == CashValue.RefValue  ) );
    elif( RefValue < 0 )
      RetVal = (   (  TypeValue == CashValue.TypeValue ) 
               and ( -RefValue  != CashValue.RefValue  ) );
    else
      RetVal =     (  TypeValue == CashValue.TypeValue );
    end;
  else
    RetVal = false;
  end;
  return RetVal;
END;

/* ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø */
/* ≥ è•Á†‚Ï Ø‡®ÂÆ§† ØÆ §†≠≠Æ© £‡„ØØ• Ê•≠≠Æ·‚•©                              ≥ */
/* ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ */
/* RefValue = 0 - ¢·• Ê•≠≠Æ·‚®,                                               */
/* RefValue > 0 - §†≠≠†Ô Ê•≠≠Æ·‚Ï,                                            */
/* RefValue < 0 - ¢·•, ™‡Æ¨• §†≠≠Æ© Ê•≠≠Æ·‚®                                  */
/* í®ØÑ†≠≠ÎÂ - "Ä¢†≠·" ®´® "è•‡•§†Á†"                                         */
MACRO è‡®ÂÆ§( TypeValue, RefValue, í®ØÑ†≠≠ÎÂ )

  var
      Safe = GetNativeSafe(),
      á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ = false,
      RecFound;
  var è‡•§Î§„È†Ôñ•≠≠Æ·‚Ï = RefValue;
 
  ClearRecord( CashDC );
  CashDC.Branch      = Branch;
  CashDC.CashDateDoc = {curdate};
  CashDC.TypeDoc     = TYPEDOC_CARRYON;
  CashDC.CashPatern  = Safe;
  CashDC.RefValue    = RefValue;
  RecFound = GetGE( CashDC ); 

  while (     RecFound
        and ( CashDC.Branch      == Branch          )
        and ( CashDC.CashDateDoc == {curdate}       )
        and ( CashDC.TypeDoc     == TYPEDOC_CARRYON )
        and ( CashDC.CashPatern  == Safe            )
        )

    if(     FindCashValue( CashDC.RefValue )
        and Filterè‡®ÂÆ§ ( TypeValue, RefValue, í®ØÑ†≠≠ÎÂ ) )
      
      if( è‡•§Î§„È†Ôñ•≠≠Æ·‚Ï != CashValue.RefValue ) /* TONIK 25-02-03 */
        if( TypeValue == TYPERES_VALFORM )
          ë‚‡Æ™†èÆ§®‚Æ£†ñ•≠≠Æ·‚®();
        end;
        è‡•§Î§„È†Ôñ•≠≠Æ·‚Ï = CashValue.RefValue;
        Ç·•£Æñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† = 0;
        äÆ´è†Á•™ñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† = 0;
      end;
      
      if( á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ == false )
        á†£Æ´Æ¢Æ™ñ•≠≠Æ·‚•©( TypeValue );
        á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ = true;
      end;
      
      if( TypeValue == TYPERES_VALFORM )
        /* ≠• °Î´Æ §•‚†´®ß†Ê®® - ¢ÆßÏ¨•¨ ®ß ™†··Æ¢Æ£Æ §Æ™„¨•≠‚† */
        if( CashDC.Series != "" )
          Bunch.Series = CashDC.Series;
          Bunch.Min    = CashDC.MinRegistrNumber;
          Bunch.Max    = CashDC.MaxRegistrNumber;
          ë‚‡Æ™†è‡®ÂÆ§†ñ•≠≠Æ·‚•©( TypeValue );
        /* °Î´† §•‚†´®ß†Ê®Ô - ¢ÆßÏ¨•¨ ®ß °„≠Á•© */
        else
          ë‚‡Æ™®è‡®ÂÆ§†ñ•≠≠Æ·‚•©àßè†Á•™( TypeValue, CashValue.RefValue );
        end;
      else
        ë‚‡Æ™†è‡®ÂÆ§†ñ•≠≠Æ·‚•©( TypeValue );
      end;

    end;
    RecFound = Next( CashDC );
  end;

  if( á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ == true )
    if( TypeValue == TYPERES_VALFORM ) ë‚‡Æ™†èÆ§®‚Æ£†ñ•≠≠Æ·‚®(); end;
    à‚Æ£ñ•≠≠Æ·‚•©( TypeValue );
  end;

END;

/* ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø */
/* ≥ è•Á†‚Ï †¢†≠·† ØÆ §†≠≠Æ© £‡„ØØ• Ê•≠≠Æ·‚•©                               ≥ */
/* ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ */
/* RefValue = 0 - ¢·• Ê•≠≠Æ·‚®,                                               */
/* RefValue > 0 - §†≠≠†Ô Ê•≠≠Æ·‚Ï,                                            */
/* RefValue < 0 - ¢·•, ™‡Æ¨• §†≠≠Æ© Ê•≠≠Æ·‚®                                  */
MACRO Ä¢†≠·( TypeValue/*, RefValue*/ )
  var RefValue;
  if( not GetParm( 1, RefValue ) )    RefValue = 0;  end;
  è‡®ÂÆ§( TypeValue, RefValue, "Ä¢†≠·" );
END;

/* ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø */
/* ≥ è•Á†‚Ï Ø•‡•§†Á® Æ‚ §‡.™†··®‡Æ¢ ØÆ §†≠≠Æ© £‡„ØØ• Ê•≠≠Æ·‚•©              ≥ */
/* ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ */
/* RefValue = 0 - ¢·• Ê•≠≠Æ·‚®,                                               */
/* RefValue > 0 - §†≠≠†Ô Ê•≠≠Æ·‚Ï,                                            */
/* RefValue < 0 - ¢·•, ™‡Æ¨• §†≠≠Æ© Ê•≠≠Æ·‚®                                  */
MACRO è•‡•§†Á†( TypeValue/*, RefValue*/ )
  var RefValue;
  if( not GetParm( 1, RefValue ) )    RefValue = 0;  end;
  è‡®ÂÆ§( TypeValue, RefValue, "è•‡•§†Á†" );
END;

MACRO ë‚‡Æ™®é·‚†‚™Æ¢ñ•≠≠Æ·‚•©àßè†Á•™( TypeValue, ValueRef, CashOper )
   
  var
    RecFound;

  ClearRecord( RegNum );
  RegNum.Branch     = Branch;
  RegNum.CashOper   = CashOper;
  RegNum.SubAccount = "";
  RegNum.ValueRef   = ValueRef;
  RegNum.Date       = {curdate};
  RegNum.Nominal    = $10000000000;
  RecFound = GetGE( RegNum );

  while (     RecFound
        and ( RegNum.Branch     == Branch   )
        and ( RegNum.CashOper   == CashOper )
        and ( RegNum.SubAccount == ""       )
        and ( RegNum.ValueRef   == ValueRef )
        and ( RegNum.Date       == {curdate})
      /*and ( RegNum.Nominal    == $0       )*/
        )
    ë‚‡Æ™†é·‚†‚™Æ¢ñ•≠≠Æ·‚•©( TypeValue );
    RecFound = Next( RegNum );
  end;

END;

MACRO Filteré·‚†‚™®( TypeValue, RefValue )
  var RetVal = false;
  if  ( RefValue > 0 )
    RetVal = (   (  TypeValue == CashValue.TypeValue ) 
             and (  RefValue  == CashValue.RefValue  ) );
  elif( RefValue < 0 )
    RetVal = (   (  TypeValue == CashValue.TypeValue ) 
             and ( -RefValue  != CashValue.RefValue  ) );
  else
    RetVal =     (  TypeValue == CashValue.TypeValue );
  end;
  return RetVal;
END;


/* ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø */
/* ≥ è•Á†‚Ï ‚•™„È®Â Æ·‚†‚™Æ¢ ØÆ §†≠≠Æ© £‡„ØØ• Ê•≠≠Æ·‚•©                     ≥ */
/* ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ */
/* RefValue = 0 - ¢·• Ê•≠≠Æ·‚®,                                               */
/* RefValue > 0 - §†≠≠†Ô Ê•≠≠Æ·‚Ï,                                            */
/* RefValue < 0 - ¢·•, ™‡Æ¨• §†≠≠Æ© Ê•≠≠Æ·‚®                                  */
MACRO é·‚†‚™®é§≠Æ£Æë„°Í•™‚†( TypeValue, RefValue, CashOper, á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ )

  var 
      RecFound;
  var è‡•§Î§„È†Ôñ•≠≠Æ·‚Ï = RefValue;
      
  CashAcc.Branch     = Branch;
  CashAcc.Date       = {curdate};
  CashAcc.CashOper   = CashOper;
  CashAcc.SubAccount = "";
  CashAcc.RefValue   = RefValue;
  RecFound = GetGE( CashAcc ); 

  while (     RecFound
        and ( CashAcc.Branch     == Branch    )
        and ( CashAcc.Date       == {curdate} )
        and ( CashAcc.CashOper   == CashOper  )
        and ( CashAcc.SubAccount == ""        )
        )
    if(     FindCashValue( CashAcc.RefValue )
        and Filteré·‚†‚™®( TypeValue, RefValue ) )

      if( è‡•§Î§„È†Ôñ•≠≠Æ·‚Ï != CashValue.RefValue ) /* TONIK 25-02-03 */
        if( TypeValue == TYPERES_VALFORM )
          ë‚‡Æ™†èÆ§®‚Æ£†ñ•≠≠Æ·‚®();
        end;
        è‡•§Î§„È†Ôñ•≠≠Æ·‚Ï = CashValue.RefValue;
        Ç·•£Æñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† = 0;
        äÆ´è†Á•™ñ•≠≠Æ·‚•©Ñ†≠≠Æ£Æí®Ø† = 0;
      end;

      if( á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ == false )
        á†£Æ´Æ¢Æ™ñ•≠≠Æ·‚•©( TypeValue );
        á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ = true;
      end;
      if( TypeValue == TYPERES_VALFORM )
        ë‚‡Æ™®é·‚†‚™Æ¢ñ•≠≠Æ·‚•©àßè†Á•™( TypeValue, CashValue.RefValue, CashOper ); /* ·•‡®®-≠Æ¨•‡† */
      else
        ë‚‡Æ™†é·‚†‚™Æ¢ñ•≠≠Æ·‚•©( TypeValue );
      end;

    end;
    RecFound = Next( CashAcc );
  end;
  
  SetParm( 3, á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ );

END;

/* ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø */
/* ≥ è•Á†‚Ï ‚•™„È®Â Æ·‚†‚™Æ¢ ØÆ §†≠≠Æ© £‡„ØØ• Ê•≠≠Æ·‚•©                     ≥ */
/* ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ */
/* RefValue = 0 - ¢·• Ê•≠≠Æ·‚®,                                               */
/* RefValue > 0 - §†≠≠†Ô Ê•≠≠Æ·‚Ï,                                            */
/* RefValue < 0 - ¢·•, ™‡Æ¨• §†≠≠Æ© Ê•≠≠Æ·‚®                                  */
MACRO é·‚†‚™®( TypeValue /*, RefValue */ )

  var
      RefValue,
      á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ = false,
      OperBrigade = GetOperBrigade(),
      CashOper,
      RecFound;

  if( not GetParm( 1, RefValue ) )
    RefValue = 0;
  end;

  /* ØÆ ·•©‰„ ·¨•≠Î */
  CashOper = GetNativeSafe();
  é·‚†‚™®é§≠Æ£Æë„°Í•™‚†( TypeValue, RefValue, CashOper, á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ );

  /* ØÆ ¢·•¨ ÆØ•‡†Ê®Æ≠®·‚†¨ */
  ClearRecord( GroupMember );
  GroupMember.Branch = Branch;
  GroupMember.Date   = {curdate};
  GroupMember.Group  = OperBrigade;
  RecFound = GetGE( GroupMember );

  while(       RecFound
         and ( GroupMember.Branch == Branch      )
         and ( GroupMember.Date   == {curdate}   )
         and ( GroupMember.Group  == OperBrigade )
       )
    
    CashOper = WorkDeskName( GroupMember.Oper, OperBrigade );
    é·‚†‚™®é§≠Æ£Æë„°Í•™‚†( TypeValue, RefValue, CashOper, á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ );

    RecFound = Next( GroupMember );
  end;

  if( á†£Æ´Æ¢Æ™ç†Ø•Á†‚†≠ == true )
    à‚Æ£ñ•≠≠Æ·‚•©( TypeValue );
  end;

END;


/* ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø */
/* ≥ è•Á†‚Ï ·Ø‡†¢™® Æ° Æ·‚†‚™†Â                                             ≥ */
/* ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ */
MACRO è•Á†‚ÏëØ‡†¢™®é°é·‚†‚™†Â()

[                                                                            ];
[ ########################################################################## ]( Office.BankName:w:r );
[ ########################################################################## ]( Office.Address:w:r  );
[                                                        ê•£.≠Æ¨•‡ ######### ]( Office.RegNumb      );
[                                                                            ];
[                                ëèêÄÇäÄ                                     ];
[         éÅ éëíÄíäÄï  çÄãàóçéâ àçéëíêÄççéâ ÇÄãûíõ, èãÄíÖÜçõï                ];
[          ÑéäìåÖçíéÇ Ç àçéëíêÄççéâ ÇÄãûíÖ à çÄãàóçõï êìÅãÖâ                 ];
[             Ç éÅåÖççéå èìçäíÖ çÄ äéçÖñ éèÖêÄñàéççéÉé Ñçü                   ];
[                                                                            ];
[                                   #                                        ]( StrAddZeroDate( {curdate} ):c );
[                                                                            ];
[1. èÆ´„Á•≠ †¢†≠·:                                                           ];
[                                                                            ];
[ç†´®Á≠†Ô ®≠Æ·‚‡†≠≠†Ô ¢†´Ó‚†                                                 ];
  Ä¢†≠·( TYPERES_CURRENCY, -Office.RVNationalCurr );
[                                                                            ];
[è´†‚•¶≠Î• §Æ™„¨•≠‚Î ¢ ®≠Æ·‚‡†≠≠Æ© ¢†´Ó‚• ® Ê•≠≠Î• °´†≠™®                    ];
  Ä¢†≠·( TYPERES_PAYDOC  );
  Ä¢†≠·( TYPERES_VALFORM );
[                                                                            ];
[ç†´®Á≠Î• ‡„°´®                                                              ];
  Ä¢†≠·( TYPERES_CURRENCY, Office.RVNationalCurr );
[                                                                            ];
[----------------------------------------------------------------------------];
[                                                                            ];
[2. è‡®≠Ô‚Æ ØÆ †™‚„ Æ‚ §‡„£Æ£Æ ™†··®‡† Æ°¨•≠≠Æ£Æ Ø„≠™‚†:                     ];
[                                                                            ];
[ç†´®Á≠†Ô ®≠Æ·‚‡†≠≠†Ô ¢†´Ó‚†                                                 ];
  è•‡•§†Á†( TYPERES_CURRENCY, -Office.RVNationalCurr );
[                                                                            ];
[è´†‚•¶≠Î• §Æ™„¨•≠‚Î ¢ ®≠Æ·‚‡†≠≠Æ© ¢†´Ó‚• ® Ê•≠≠Î• °´†≠™®                    ];
  è•‡•§†Á†( TYPERES_PAYDOC   );
  è•‡•§†Á†( TYPERES_VALFORM  );
[                                                                            ];
[ç†´®Á≠Î• ‡„°´®                                                              ];
  è•‡•§†Á†( TYPERES_CURRENCY, Office.RVNationalCurr );
[                                                                            ];
[----------------------------------------------------------------------------];
[                                                                            ];
[3. é·‚†‚™® ≠† ™Æ≠•Ê ÆØ•‡†Ê®Æ≠≠Æ£Æ §≠Ô:                                      ];
[                                                                            ];
[ç†´®Á≠†Ô ®≠Æ·‚‡†≠≠†Ô ¢†´Ó‚†                                                 ];
  é·‚†‚™®( TYPERES_CURRENCY, -Office.RVNationalCurr );
[                                                                            ];
[è´†‚•¶≠Î• §Æ™„¨•≠‚Î ¢ ®≠Æ·‚‡†≠≠Æ© ¢†´Ó‚• ® Ê•≠≠Î• °´†≠™®                    ];
  é·‚†‚™®( TYPERES_PAYDOC   );
  é·‚†‚™®( TYPERES_VALFORM  );
[                                                                            ];
[ç†´®Á≠Î• ‡„°´®                                                              ];
  é·‚†‚™®( TYPERES_CURRENCY, Office.RVNationalCurr );
[                                                                            ];
[----------------------------------------------------------------------------];
[                                                                            ];
[                                                                            ];
[ä†··®‡ Æ°¨•≠≠Æ£Æ Ø„≠™‚† __________________( ######################### )     ]( GetFIOEmployee( {oper} ) );
[                               (ØÆ§Ø®·Ï)                                    ];

END;

ByeBoss(0);
è•Á†‚ÏëØ‡†¢™®é°é·‚†‚™†Â();
