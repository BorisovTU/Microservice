/*
$Name:             rstr_203.mac
$Module:           RS-Retail
$Description:      Валютные операции.  Печать ордеров по реестрам 136-И.
*/

import ExchangeInter, CommonInter, DeskInter, RSD;

private var {curdate};
private var {oper};

private var Brigade = GetOperBrigade();

  var cmd, rs;

  cmd = RsdCommand( "SELECT D.t_DocumentID as docID, Tp.T_PrintFormMacro as prMacro " +
                    "FROM drtdocument_dbt D, dPmdtype_dbt Tp " +
                    "WHERE D.T_DocTypeID = TP.T_DOCTYPEID " +
                      "AND ( TP.T_NAME = '0402008' OR TP.T_NAME = '0402009' OR  TP.T_NAME = 'ПРО_ВОО' ) " +
                      "AND D.T_ISCONSOLIDATED = 'X' " +
                      "AND D.T_ShiftNumber = :p_brig " +
                      "AND D.T_DATE = :p_date " +
                      "AND D.T_OPER = :p_oper " +
                      "AND D.T_EXCHANGEOPERATIONCODE <> CHR (1) " +
                      "AND D.T_DebitAmount > 0 " +
                      "AND D.T_CreditAmount > 0 " +
                    "ORDER BY D.T_EXCHANGEREGISTERNUMBER" );

  cmd.addParam( "p_brig", RSDBP_IN, Brigade );
  cmd.addParam( "p_date", RSDBP_IN, {curdate} );
  cmd.addParam( "p_oper", RSDBP_IN, {oper} );

  cmd.execute;

  rs = RsdRecordset( cmd );

  while ( rs.moveNext )
    ExecMacroFile( "DOC_CashExch_print.mac", "PrintRTDocument", rs.value( "docID" ), 1 );
  end;

end;
