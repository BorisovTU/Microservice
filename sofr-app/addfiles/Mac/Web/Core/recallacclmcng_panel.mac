 /*
 $Name: recallacclmcng_panel.mac
 $Module: Главная книга
 $Description: Макрос Список претензий
 */

import RsbDataSet, globals, oralib, likepy;
import BankInter;
import "ws_partycommon.mac";
import "ws_validation.mac";
import "account_scroll.mac";
import "ws_person.mac";
import "ws_datafilter.mac";
import "ws_llvalues.mac";
import "ws_partyclasses.mac";
import "ws_file.mac";



class TWebRecallAcClmCngObject 

  var ChangeDocID  : integer;  
  
  var RecallDate   : Date;
  
  var Reason    : String;
  
end;

PRIVATE VAR ResponseBuilder : WebResponseBuilder;

private macro AddErrorMessage(ErrorMessage : @WsErrorMessage)

  var objErr = AL_GetErrorInfo();

  ErrorMessage.Code     = objErr.stat;
  ErrorMessage.Message  = objErr.message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

private macro AddErrorMessageExt(ErrorMessage : @WsErrorMessage, stat, message)

  ErrorMessage.Code     = stat;
  ErrorMessage.Message  = message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

macro WebCore_GetRecallAcClmCngObject(ChangeDocID)

  var RecallAcClmCngObject = TWebRecallAcClmCngObject();
  
  var cmd, rs;
	
  var query = " SELECT *                    "
				
			  " FROM dacclmcng_dbt acclmcng "  
				
			  " WHERE acclmcng.T_CHANGEDOCID = ? " ;
    
  cmd = RsdCommand(query);
  
  rs = RsdRecordset(cmd);
  
  cmd.addParam( "", RSDBP_IN, ChangeDocID );

  if(rs.movenext)
  
    RecallAcClmCngObject.ChangeDocID = ChangeDocID;
	
	RecallAcClmCngObject.RecallDate = SQL_ConvType(rs.value("T_STARTDATE"));    
	  
  end;
  
  return RecallAcClmCngObject;
  
end;

macro WebCore_RecallAcClmCng(ChangeDocID, RecallDate, Reason)

  var res = True;

  ResponseBuilder = WebResponseBuilder();

  var ErrorMessage : WsErrorMessage = WsErrorMessage();

  res = CB_RecallAcClmCng(ChangeDocID,RecallDate,Reason);

  if(res != True)

    AddErrorMessage(@ErrorMessage);

  end;

  responseBuilder.SetUserObject(res);

  return responseBuilder.Result;
  
end;


