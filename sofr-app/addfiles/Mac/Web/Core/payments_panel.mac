/*
$Name:        payments_panel.mac
$Module:      É´†¢≠†Ô ™≠®£†
$Description:	ë•‡¢®· ØÆ´„Á•≠®Ô §†≠≠ÎÂ Æ Ø´†‚•¶•
*/

IMPORT BankInter;

import "ws_file.mac";
import "ws_validation.mac";
import "ws_datafilter.mac";
import "ws_namealg.mac";
import "ws_dprt.mac";
import "ws_llvalues.mac";
import "ws_fiunilist.mac";
import "ws_getparty.mac";
import "ws_fiunilist.mac";
import "account_widget.mac";
import "cipher_widget.mac";
import "ws_person.mac";
import "cb_sql.mac";

class TWebPmObjPanel 
 
  var  PaymentID     	     		    : integer ; 

  var  ShortName       	     		  : String ;
  
  var  DocKind       	     		    : integer ;
		
  var  DocKindName       	     		: String ;
		
  var  Number        	     		    : String ; 

  var  Date          	     		    : Date ; 

  var  ValueDate            		    : Date;  

  var  Department            		    ; // TWsDepartment

  var  PayerBankEnterDate    		    : Date;  

  var  AcceptTermList        		    ; //List<TWsNameAlg>
  
  var  AcceptPeriod          		    : integer;  

  var  Amount                		    : Money;  

  var  TaxAuthorStateList    		    ; //List<TWsLlvalues>

  var  BaseCurrency          		    ; // TWsFinInstr

  var  BaseAmount            		    : Money ; 

  var  Payer                 		    ; //TWsPartyEx

  var  PayerINN              		    : String ; 

  var  PayerKPP              		    : String ; 

  var  PayerCurrency         		    ; // TWsFinInstr

  var  PayerAccount         		    ; //TWebAccount

  var  PayerBank             		    ; //TWsPartyEx

  var  CodeKindCollection    		    ; //List<TWsObjKCode>

  var  CodeValueCollectionPayerBank     ; //List<TWsObjCode>     

  var  PayerBankCodeKind                : integer ; 

  var  PayerCorrAccNostro               : String;
   
  var ReceiverBank		           		; //TWsPartyEx
  
  var CodeValueCollectionReceiverBank   ; //List<TWsObjKCode>
  
  var ReceiverBankCodeKind		 	    : integer;
  
  var ReceiverCorrAccNostro		        : String;
  
  var Receiver		                    ; //TWsPartyEx
  
  var ReceiverINN		                : String;
  
  var ReceiverKPP		                : String;
  
  var ReceiverCurrency		            ; //TWsFinInstr
  
  var ReceiverAccount		            ; //TWebAccount
  
  var UIN		                        : String;
  
  var CashSymbolDebet		            : String;
  
  var CashSymbolCredit		            : String;
  
  var SymbNotBalDebet		            : String;
  
  var Ground		                    : String;
  
  var Cipher		                    ; //TWebCipher
  
  var Priority		                    : integer;
  
  var Oper		                        ; //TWsPerson
  
  var NumberPack		                : integer;
  
  var DocumentID						: integer;
  
end;


PRIVATE VAR ResponseBuilder : WebResponseBuilder;

private macro AddErrorMessage(ErrorMessage : @WsErrorMessage)

  var objErr = AL_GetErrorInfo();

  ErrorMessage.Code     = objErr.stat;
  ErrorMessage.Message  = objErr.message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

private macro AddErrorMessageExt(ErrorMessage : @WsErrorMessage, stat, message)

  ErrorMessage.Code     = stat;
  ErrorMessage.Message  = message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

private macro GetErrorMessage(ErrorCode : @integer, ErrorMessage : @string)

  var objErr = AL_GetErrorInfo();

  ErrorCode     = objErr.stat;
  ErrorMessage  = objErr.message;

  InitError();

end;

private macro SettingParm(): integer

  var err=0;
  
  var ProcValue;
  
  GetRegistryValue( "BANK_INI\\éÅôàÖ èÄêÄåÖíêõ\\éíéÅêÄÜÖçàÖ èéãÖâ\\FICODE_ISO", V_INTEGER, ProcValue, err);

  if(err == 0)
    
    return ProcValue;
	 
  else

    return 0;
	
  end;
 
end;

macro NumberAlgList(PaymentId)

  var cmd, rs;

  var NumberAlgListArray  = TArray();
  
  var query = 	" 	SELECT PSPAYDEM.T_ACCEPTTERM  ACCEPTTERM  	"+
				"	FROM DPSPAYDEM_DBT PSPAYDEM					"+
				"	WHERE PSPAYDEM.T_ORDERID = ? 				";

  cmd = RsdCommand(query);
 
  cmd.addParam( "", RSDBP_IN, PaymentId);
  
  rs = RsdRecordset(cmd);

  while(rs.movenext)
	  	  
	NumberAlgListArray[NumberAlgListArray.size] = rs.value("ACCEPTTERM"); 
	  
  end;

  return NumberAlgListArray;

end;

macro WebCore_GetPmPanelObject(PaymentID)

  var obj  = TWebPmObjPanel();
  
  var cmd, rs;
  
  file pspayordFile("pspayord.dbt") key 0 write;
  
  var query =   "  SELECT																"+
				"          PMPAYM.T_PAYMENTID PaymentID, 								"+
				"          (SELECT PM_SCRHLP.GetPaymPurpName(PMPAYM.T_PURPOSE) FROM dual) ShortName, 	"+
				"          PMPAYM.T_DOCKIND Dockind, 									"+
				"          (SELECT PM_SCRHLP.GetDocKindName(PMPAYM.T_DOCKIND) FROM dual) DocKindName, 	"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_NUMBER  									"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 		        "+
				"		  ) NumberDoc,													"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_DATE   									"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) DateDoc,													"+
				"          PMPAYM.T_DEPARTMENT Department,							    "+
				"          PMPAYM.T_VALUEDATE ValueDate,								"+
				"          PMPAYM.T_PAYERBANKENTERDATE PayerBankEnterDate,				"+
				"		  CASE															"+
				"          WHEN PMPAYM.T_DOCKIND = 17 THEN								"+
				"          (  															"+
				"		    SELECT PMDEMAND.T_ACCEPTTERM    							"+
				"		    FROM DPMDEMAND_DBT PMDEMAND									"+
				"		    WHERE PMDEMAND.T_PAYMENTID = PMPAYM.T_PAYMENTID 			"+
				"		   )															"+
				"         ELSE 															"+
				"          (  															"+
				"		    SELECT PSPAYDEM.T_ACCEPTTERM    							"+
				"		    FROM DPSPAYDEM_DBT PSPAYDEM									"+
				"		    WHERE PSPAYDEM.T_ORDERID = PMPAYM.T_PAYMENTID 				"+
				"		   )															"+
				"		  END NumberAlgList,											"+
				"         (  															"+
				"		   SELECT PSPAYDEM.T_ACCEPTPERIOD     							"+
				"		   FROM DPSPAYDEM_DBT PSPAYDEM									"+
				"		   WHERE PSPAYDEM.T_ORDERID = PMPAYM.T_PAYMENTID 				"+
				"		  ) AcceptPeriod ,												"+
				"          PMPAYM.T_AMOUNT Amount,										"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_TAXAUTHORSTATE   							"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) TAXAUTHORSTATE ,											"+
				"          PMPAYM.T_BASEFIID BaseFIID,								 	"+
				"          PMPAYM.T_BASEAMOUNT BaseAmount,								"+
				"          PMPAYM.T_PAYER Payer,										"+
				"         (  															"+
				"		   SELECT OBJCODE.T_CODE 			   							"+
				"		   FROM DOBJCODE_DBT OBJCODE									"+
				"		   WHERE OBJCODE.T_OBJECTTYPE = 3 AND				 			"+
				"		   OBJCODE.T_CODEKIND = 16 AND 									"+
				"		   OBJCODE.T_BANKDATE <= to_date('" + {curdate} + "', 'dd.mm.yyyy') AND			"+
				"		   DECODE(OBJCODE.T_BANKCLOSEDATE, TO_DATE('01.01.0001', 'DD.MM.YYYY'), TO_DATE('31.12.9999', 'DD.MM.YYYY'), OBJCODE.T_BANKCLOSEDATE) > to_date('" + {curdate} + "', 'dd.mm.yyyy') AND	"+
				"		   OBJCODE.T_OBJECTID = PMPAYM.T_PAYER 							"+
				"		  ) PayerINN ,													"+
				"         (  															"+
				"		   SELECT OBJCODE.T_CODE 			   							"+
				"		   FROM DOBJCODE_DBT OBJCODE									"+
				"		   WHERE OBJCODE.T_OBJECTTYPE = 3 AND				 			"+
				"		   OBJCODE.T_CODEKIND = 16 AND 									"+
				"		   OBJCODE.T_BANKDATE <= to_date('" + {curdate} + "', 'dd.mm.yyyy') AND			"+
				"		   DECODE(OBJCODE.T_BANKCLOSEDATE, TO_DATE('01.01.0001', 'DD.MM.YYYY'), TO_DATE('31.12.9999', 'DD.MM.YYYY'), OBJCODE.T_BANKCLOSEDATE) > to_date('" + {curdate} + "', 'dd.mm.yyyy') AND	"+
				"		   OBJCODE.T_OBJECTID = PMPAYM.T_PAYER 							"+
				"		  ) PayerKPP ,													"+
				"          PMPAYM.T_FIID Fiid,								 			"+
				"          PMPAYM.T_CHAPTER Chapter,								 	"+
				"          PMPAYM.T_PAYERACCOUNT PayerAccount,							"+
				"          PMPAYM.T_PAYERBANKID PayerBankID,							"+
				"         (  															"+
				"		   SELECT PMPROP.T_CODEKIND   									"+
				"		   FROM DPMPROP_DBT PMPROP										"+
				"		   WHERE PMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID AND		    "+
				"		   PMPROP.T_DEBETCREDIT  = 0  									"+
				"		  ) PayerBankCodeKind,											"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_PAYERCORRACCNOSTRO    						"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) PAYERCORRACCNOSTRO ,										"+
				"          PMPAYM.T_RECEIVERBANKID RECEIVERBANKID,						"+
				"         (  															"+
				"		   SELECT PMPROP.T_CODEKIND    									"+
				"		   FROM DPMPROP_DBT PMPROP										"+
				"		   WHERE PMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID AND			"+
				"		   PMPROP.T_DEBETCREDIT  = 1  									"+
				"		  ) ReceiverBankCodeKind ,										"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_RECEIVERCORRACCNOSTRO    					"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) RECEIVERCORRACCNOSTRO ,										"+
				"          PMPAYM.T_PAYFIID PAYFIID,									"+
				"          PMPAYM.T_RECEIVER RECEIVER,									"+
				"         (  															"+
				"		   SELECT OBJCODE.T_CODE 			   							"+
				"		   FROM DOBJCODE_DBT OBJCODE									"+
				"		   WHERE OBJCODE.T_OBJECTTYPE = 3 AND				 			"+
				"		   OBJCODE.T_CODEKIND = 16 AND 									"+
				"		   OBJCODE.T_BANKDATE <= to_date('" + {curdate} + "', 'dd.mm.yyyy') AND			"+
				"		   DECODE(OBJCODE.T_BANKCLOSEDATE, TO_DATE('01.01.0001', 'DD.MM.YYYY'), TO_DATE('31.12.9999', 'DD.MM.YYYY'), OBJCODE.T_BANKCLOSEDATE) > to_date('" + {curdate} + "', 'dd.mm.yyyy') AND	"+
				"		   OBJCODE.T_OBJECTID = PMPAYM.T_RECEIVER 						"+
				"		  ) ReceiverINN ,												"+
				"         (  															"+
				"		   SELECT OBJCODE.T_CODE 			   							"+
				"		   FROM DOBJCODE_DBT OBJCODE									"+
				"		   WHERE OBJCODE.T_OBJECTTYPE = 3 AND				 			"+
				"		   OBJCODE.T_CODEKIND = 16 AND 									"+
				"		   OBJCODE.T_BANKDATE <= to_date('" + {curdate} + "', 'dd.mm.yyyy') AND			"+
				"		   DECODE(OBJCODE.T_BANKCLOSEDATE, TO_DATE('01.01.0001', 'DD.MM.YYYY'), TO_DATE('31.12.9999', 'DD.MM.YYYY'), OBJCODE.T_BANKCLOSEDATE) > to_date('" + {curdate} + "', 'dd.mm.yyyy') AND	"+
				"		   OBJCODE.T_OBJECTID = PMPAYM.T_RECEIVER 						"+
				"		  ) ReceiverKPP ,												"+
				"          PMPAYM.T_RECEIVERACCOUNT RECEIVERACCOUNT,					"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_UIN     									"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) UIN  ,														"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_CASHSYMBOLDEBET      						"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) CASHSYMBOLDEBET   ,											"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_CASHSYMBOLCREDIT       					"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) CASHSYMBOLCREDIT    ,										"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_SYMBNOTBALDEBET        					"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) SYMBNOTBALDEBET     ,										"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_GROUND        								"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) GROUND      ,												"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_SHIFROPER         							"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) SHIFROPER       ,											"+
				"         (  															"+
				"		   SELECT PMRMPROP.T_PRIORITY          							"+
				"		   FROM DPMRMPROP_DBT PMRMPROP									"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 				"+
				"		  ) PRIORITY        ,											"+
				"          PMPAYM.T_OPER 		   OPER,								"+
				"          PMPAYM.T_NUMBERPACK     NUMBERPACK,							"+
				"          PMPAYM.T_DOCUMENTID DOCUMENTID  							    "+      
				"  FROM DPMPAYM_DBT PMPAYM	 											"+
				"  WHERE PMPAYM.T_PAYMENTID = ? 										";
				   	  	    
  cmd = RsdCommand(query);
 
  cmd.addParam( "", RSDBP_IN, PaymentID);
  
  cmd.NullConversion = true;

  rs = RsdRecordset(cmd);
        	  
  if (rs.movenext)

	if(ValType(rs.value("PaymentID")) != 26)
	
      obj.PaymentID  	= 	rs.value("PaymentID");  

    end;

	if(ValType(rs.value("ShortName")) != 26)
	
      obj.ShortName  	= 	rs.value("ShortName");  

    end;	

	if(ValType(rs.value("DocKind")) != 26)

	  if(rs.value("DocKind") == 201)
	  
	      
  
		  var stat : bool;

		  pspayordFile.OrderID = rs.value("PaymentID");

          stat = GetEQ( pspayordFile );
		  
		  if(stat != false)
		  
		    if(pspayordFile.Dockind == 1)
			
			  obj.DocKind  	= 	271; 
			
			end;
			
			if(pspayordFile.Dockind == 2)
			
			  obj.DocKind  	= 	272; 
			
			end;
			
			if(pspayordFile.Dockind == 3)
			
			  obj.DocKind  	= 	273; 
			
			end;
			
			if(pspayordFile.Dockind == 4)
			
			  obj.DocKind  	= 	274; 
			
			end;
		  
		  end;
		  
	  else

	    obj.DocKind  	= 	rs.value("DocKind");  

	  end;
	  	
    end;

	if(ValType(rs.value("DocKindName")) != 26)
	
      obj.DocKindName  	= 	rs.value("DocKindName");  

    end;	
		
	if(ValType(rs.value("NumberDoc")) != 26)
	
      obj.Number  	= 	rs.value("NumberDoc");  

    end;		

	if(ValType(rs.value("DateDoc")) != 26)
	
      obj.Date  	= 	rs.value("DateDoc");  

    end;		 
	
	if(ValType(rs.value("ValueDate")) != 26)
	
      obj.ValueDate  	= 	rs.value("ValueDate");  

    end;	
           
    if(ValType(rs.value("Department")) != 26)
	
      obj.Department  		= GetTWsDepartmentByCode(rs.value("Department")); 

    end;	
	 
	if(ValType(rs.value("PayerBankEnterDate")) != 26)
	
      obj.PayerBankEnterDate  	= 	rs.value("PayerBankEnterDate");  

    end;		

	if(ValType(rs.value("NumberAlgList")) != 26)
	
	  var arr = TArray;
	
	  arr.(0) = rs.value("NumberAlgList");
	
      obj.AcceptTermList = GetListNamealg(3003, arr); 

    end;	
	
	if(ValType(rs.value("AcceptPeriod")) != 26)
	
      obj.AcceptPeriod  	= 	rs.value("AcceptPeriod");  

    end;          	

	if(ValType(rs.value("Amount")) != 26)
	
      obj.Amount  	= 	rs.value("Amount");  

    end;      	

    if(rs.value("TAXAUTHORSTATE") != "")

	  var element = Int(rs.value("TAXAUTHORSTATE"));
      obj.TaxAuthorStateList = TArray;
      obj.TaxAuthorStateList[obj.TaxAuthorStateList.size] = CreateLLValueFromAppServ(1800, element); 

    end;		

    if(ValType(rs.value("BaseFIID")) != 26)
	
      obj.BaseCurrency  		= GetTWsFinInstrByID(rs.value("BaseFIID"));  

    end;		

	if(ValType(rs.value("BaseAmount")) != 26)
	
      obj.BaseAmount  	= 	rs.value("BaseAmount");  

    end;     	

    if(ValType(rs.value("Payer")) != 26)
	
      obj.Payer  		= GetTWsPartyExByID(rs.value("Payer")); 

    end;			

	if(ValType(rs.value("PayerINN")) != 26)
	
      SplitFullINN(rs.value("PayerINN"), obj.PayerINN, null);

    end;    	

	if(ValType(rs.value("PayerKPP")) != 26)
	
      SplitFullINN(rs.value("PayerKPP"), null, obj.PayerKPP);      

    end;    	

    if(ValType(rs.value("Fiid")) != 26)
	
      obj.PayerCurrency  		= GetTWsFinInstrByID(rs.value("Fiid"));

    end;

	if((ValType(rs.value("Fiid")) != 26) AND (ValType(rs.value("PayerAccount")) != "") AND (ValType(rs.value("Chapter")) != 26))
	
      obj.PayerAccount  		= WebCore_CreateTWebAccountFromBD0(rs.value("Chapter"),rs.value("PayerAccount"),rs.value("Fiid"));  

    end;		     		

    if(ValType(rs.value("PayerBankID")) != 26)
	
      obj.PayerBank  		= GetTWsPartyExByID(rs.value("PayerBankID"));  
	  
	  obj.CodeValueCollectionPayerBank  = GetObjcodeListByPartyID(3, rs.value("PayerBankID")); 

    end;	

    obj.CodeKindCollection  = 	GetObjkcodeList(3);   		   
       
	if(ValType(rs.value("PayerBankCodeKind")) != 26)
	
      obj.PayerBankCodeKind  	= 	rs.value("PayerBankCodeKind");  

    end;    		

	if( ValType(rs.value("PAYERCORRACCNOSTRO")) != 26)
	
      obj.PayerCorrAccNostro = rs.value("PAYERCORRACCNOSTRO"); 

    end;		
   
	if(ValType(rs.value("RECEIVERBANKID")) != 26)
	
      obj.ReceiverBank  	= 	GetTWsPartyExByID(rs.value("RECEIVERBANKID")); 

	  obj.CodeValueCollectionReceiverBank = GetObjcodeListByPartyID(3,rs.value("RECEIVERBANKID")); 	  

    end;    		
  
	if(ValType(rs.value("ReceiverBankCodeKind")) != 26)
	
      obj.ReceiverBankCodeKind  	= 	rs.value("ReceiverBankCodeKind");  

    end;   	
  
	if(ValType(rs.value("RECEIVERCORRACCNOSTRO")) != 26)
	
      obj.ReceiverCorrAccNostro = rs.value("RECEIVERCORRACCNOSTRO"); 

    end;		
  
	if(ValType(rs.value("RECEIVER")) != 26)
	
      obj.Receiver  	= 	GetTWsPartyExByID(rs.value("RECEIVER"));  

    end;   		
  
	if(ValType(rs.value("ReceiverINN")) != 26)
	
      SplitFullINN(rs.value("ReceiverINN"), obj.ReceiverINN, null);

    end;   	
  
	if(ValType(rs.value("ReceiverKPP")) != 26)
	
      SplitFullINN(rs.value("ReceiverKPP"), null, obj.ReceiverKPP);

    end;   	
  
	if(ValType(rs.value("PAYFIID")) != 26)
	
      obj.ReceiverCurrency  	= 	GetTWsFinInstrByID(rs.value("PAYFIID")); 

    end;  	
  
	if((ValType(rs.value("PAYFIID")) != 26) AND (ValType(rs.value("RECEIVERACCOUNT")) != "") AND (ValType(rs.value("Chapter")) != 26))
	
      obj.ReceiverAccount  		=   WebCore_CreateTWebAccountFromBD0(rs.value("Chapter"),rs.value("RECEIVERACCOUNT"),rs.value("PAYFIID")); 

    end;		
  
	if(ValType(rs.value("UIN")) != 26)
	
      obj.UIN  	= 	rs.value("UIN");  

    end;  	
  
	if(ValType(rs.value("CASHSYMBOLDEBET")) != 26)
	
      obj.CashSymbolDebet  	= 	rs.value("CASHSYMBOLDEBET");  

    end;  	
  
	if(ValType(rs.value("CASHSYMBOLCREDIT")) != 26)
	
      obj.CashSymbolCredit  	= 	rs.value("CASHSYMBOLCREDIT");  

    end;  	
  
	if(ValType(rs.value("SYMBNOTBALDEBET")) != 26)
	
      obj.SymbNotBalDebet  	= 	rs.value("SYMBNOTBALDEBET");  

    end;  	
  
	if(ValType(rs.value("GROUND")) != 26)
	
      obj.Ground  	= 	rs.value("GROUND");  

    end;  	
  
	if( (ValType(rs.value("SHIFROPER")) != 26) AND (rs.value("SHIFROPER") != "") )
	
      obj.Cipher  	= 	WebCore_GetCipherItemByShifr(SQL_ConvType(rs.value("SHIFROPER"))); 

    end;  		
  
	if(ValType(rs.value("PRIORITY")) != 26)
	
      obj.Priority  	= 	rs.value("PRIORITY");  

    end;  		
  
	if(ValType(rs.value("OPER")) != 26)
	
      obj.Oper  	= 	FindPersonByNumber(rs.value("OPER"));  

    end;  		
  
	if(ValType(rs.value("NUMBERPACK")) != 26)
	
      obj.NumberPack  	= 	rs.value("NUMBERPACK");  

    end; 

	if(ValType(rs.value("DOCUMENTID")) != 26)
	
      obj.DocumentID  	= 	rs.value("DOCUMENTID");  

    end;  			
				
  end; 

  return obj;

end;
