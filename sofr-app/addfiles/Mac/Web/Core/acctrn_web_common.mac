/*
$Name:        acctrn_web_common.mac
$Module:      Главная книга
$Description: Макрос с реализацией общих функций, необходимых для списков панели проводки в Web-интерфейсе
*/
Import BankInter, FIInter;
import "ofrsymbol_widget.mac";

class TWebAcctrnGridItem
  var AcctrnID;
  var Department;
  var Branch;
  var Numb_Document;
  var Date_Carry;
  var Account_Payer;
  var FI_Payer;
  var Sum_Payer : money = $0;
  var Account_Receiver;
  var FI_Receiver;
  var Sum_Receiver : money = $0;
  var Sum_NatCur : money = $0;
  var Oper;
  var Ground;
  var SumEq_Payer : money = $0;
  var FIEq_Payer;
  var SumEq_Receiver : money = $0;
  var FIEq_Receiver;
  var Result_Carry;
  var Number_Pack;
  var Shifr_Oper;
  var Kind_Oper;
  var Symbol_Debet;
  var Symbol_Credit;
  var Symbol_NotB;
  var IsCashAccPayer;
  var IsCashAccReceiver;
  var IsMultyCarry;
  var IsExistExRate;
  var OFRSymbol;
end;

/* Определить, является ли проводка с данными атрибутами мультивалютной или связанной с ней */
macro GetIsMultyCarryAcctrn( FIID_Payer : integer, FIID_Receiver : integer, Result_Carry : integer ) : bool

  var IsMultyCarryAcctrn = false;

  if( FIID_Payer != FIID_Receiver )

    if( (Result_Carry == DELTARATE_MCD) or ((Result_Carry != DELTARATE) and (Result_Carry != REGRESTOUTCARRY) and (Result_Carry != DELTARATE_ADD)) )

      IsMultyCarryAcctrn = true;

    end;

  end;

  return IsMultyCarryAcctrn;

end;

/* Определить, есть ли для проводки связанная с ней */
macro GetIsExistExRate( ExRateAcctrnID : integer, Result_Carry : integer ) : bool

  var IsExistExRate = false;

  if( (ExRateAcctrnID != null) and (ExRateAcctrnID > 0) )

    IsExistExRate = true;

  else

    IsExistExRate = (Result_Carry == DELTARATE_MCD);

  end;

  return IsExistExRate;

end;

/* Получить объект TWebOFRSymbol по OFRRecID */
macro GetOFRSymbol(OFRRecID)

  var cmd, rs, p;

  var query = " SELECT t_RecID, t_Code "
              "   FROM dopusymb_dbt "
              " WHERE t_RecID = " + string(OFRRecID);
  
  cmd = RsdCommand(query);

  rs = RsdRecordset(cmd);

  if(rs.movenext)
    
    p = TWebOFRSymbol();
    
    p.RecID = SQL_ConvType(rs.value("t_RecID" ));
    p.Code  = SQL_ConvType(rs.value("t_Code" ));
    
  end;

  return p;
end;
