/*
$Name:        payments_scroll.mac
$Module:      Главная книга
$Description:	Сервис получения списка платежей
*/

IMPORT BankInter;

import "ws_file.mac";
import "ws_validation.mac";
import "ws_datafilter.mac";
import "cb_sql.mac";

class TWebPmPaymGridItem 
 
  var  PaymStatus   : integer = 0 ; 
  var  OpCompleted   : bool = false ; 

  var  IsFactPaym         : bool = false;
		
  var  ShortName   		  : String = "" ; 

  var  BaseFICode         : String = "" ; 

  var  BaseAmount         : Money = $0; 

  var  FICode             : String = "" ; 

  var  Amount             : Money = $0;   

  var  PayFICode          : String = "" ; 

  var  PayAmount          : Money = $0;   

  var  FuturePayerAmount  : Money = $0;  

  var  ValueDate          : Date = date ("00.00.0000"); 

  var  PayerCode          : String = "" ; 

  var  DebetBankCode      : String = "" ; 

  var  PayerAccount       : String = "" ;  

  var  ReceiverCode       : String = "" ;  

  var  CreditBankCode     : String = "" ; 

  var  ReceiverAccount    : String = "" ;  

  var  Netting            : bool = false;

  var  Status             : String = "" ; 

  var  DocKindName        : String = "" ; 

  var  Ground             : String = "" ; 

  var  Number             : String = "" ;  

  var  PaymentID          : integer = 0;
  
  var Documentid		  : integer = 0;
 
end;


PRIVATE VAR ResponseBuilder : WebResponseBuilder;

private macro AddErrorMessage(ErrorMessage : @WsErrorMessage)

  var objErr = AL_GetErrorInfo();

  ErrorMessage.Code     = objErr.stat;
  ErrorMessage.Message  = objErr.message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

private macro AddErrorMessageExt(ErrorMessage : @WsErrorMessage, stat, message)

  ErrorMessage.Code     = stat;
  ErrorMessage.Message  = message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

private macro GetErrorMessage(ErrorCode : @integer, ErrorMessage : @string)

  var objErr = AL_GetErrorInfo();

  ErrorCode     = objErr.stat;
  ErrorMessage  = objErr.message;

  InitError();

end;

private macro SettingParm(): integer

  var err=0;
  
  var ProcValue;
  
  GetRegistryValue( "BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ОТОБРАЖЕНИЕ ПОЛЕЙ\\FICODE_ISO", V_INTEGER, ProcValue, err);

  if(err == 0)
    
    return ProcValue;
	 
  else

    return 0;
	
  end;
 
end;

private macro ConvertBool(CurValue :bool ) : string

  if(CurValue==true)
    
	return "CHR (88)";
	
  else
  
    return "CHR (0)";
	
  end;
  
end;

private macro ConvertCharToBool(CurValue :string ) : bool

  if(CurValue == "CHR (88)")
    
	return true;
	
  else
  
    return false;
	
  end;
  
end;

private macro FillProperty(PropertyValue, Value )

  if(ValType(PropertyValue) == ValType(Value) )
	
    return Value; 

  end;   

  if((ValType(PropertyValue) == V_BOOL) AND (ValType(Value) == V_STRING))
	
    return ConvertCharToBool(Value); 

  end;

  return   PropertyValue;
  
end;


private const FILTERITEM_VALUEDATE = 0;  		// Дата значения
private const FILTERITEM_DOCKIND = 1;    		// Вид первичного документа
private const FILTERITEM_PURPOSE = 2;    		// Назначение платежа
private const FILTERITEM_BASEFIID = 3;   		// Базовый актив
private const FILTERITEM_FIID = 4;       		// Актив дебета
private const FILTERITEM_PAYFIID = 5;    		// Актив кредита
private const FILTERITEM_BASEAMOUNT = 6; 		// Базовая сумма
private const FILTERITEM_AMOUNT = 7;     		// Сумма дебета
private const FILTERITEM_PAYAMOUNT = 8;  		// Сумма кредита
private const FILTERITEM_PAYER = 9;      		// Плательщик
private const FILTERITEM_PAYERACCOUNT = 10; 	// Счет плательщика
private const FILTERITEM_PAYERBANKID = 11;  	// Банк плательщика
private const FILTERITEM_RECEIVER = 12; 		// Получатель
private const FILTERITEM_RECEIVERACCOUNT = 13;  // Счет получателя
private const FILTERITEM_RECEIVERBANKID = 14;   // Банк получателя
private const FILTERITEM_DATE = 15; 			// Дата документа
private const FILTERITEM_CLIENTDATE = 16; 		// Дата проводки
private const FILTERITEM_PAYDATE = 17; 			// Срок платежа
private const FILTERITEM_PAYMSTATUS = 18; 		// Статус платежа
private const FILTERITEM_STARTDEPARTMENT = 19;  // Начальный филиал
private const FILTERITEM_DEPARTMENT = 20; 		// Текущий филиал
private const FILTERITEM_ENDDEPARTMENT = 21; 	// Конечный филиал
private const FILTERITEM_OPERNODE = 22; 		// Узел операциониста
private const FILTERITEM_ISPLANPAYM = 23; 		// Является плановым
private const FILTERITEM_ISFACTPAYM = 24; 		// Является фактическим
private const FILTERITEM_NUMBERPACK = 25;	    // Номер пачки
private const FILTERITEM_PRIORITY = 26; 		// Очередность платежа
private const FILTERITEM_PAYMENTKIND = 27; 		// Вид платежа
private const FILTERITEM_SHIFROPER = 28; 		// Шифр операции
private const FILTERITEM_GROUND = 29; 			// Основание (назначение) платежа
private const FILTERITEM_COMISSCHARGES = 30; 	// Комиссии






private macro GetAddWhereCondition(FilterItems)

  var condition =  " ";
  
  var ValueCount;
  
  var FilterItemsCount = 0;

  while( FilterItemsCount < FilterItems.Size )

    if( FilterItems[FilterItemsCount].Id == FILTERITEM_VALUEDATE ) // Дата значения
		  
      if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_VALUEDATE !=  TO_DATE(' ";
		  
		else
		
		  condition = condition + " AND PMPAYM.T_VALUEDATE =  TO_DATE(' ";
		
		end;

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_From )

	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND   ( PMPAYM.T_VALUEDATE <=  TO_DATE(' ";
		  
		else
		
		  condition = condition + " AND  ( PMPAYM.T_VALUEDATE >=  TO_DATE(' ";
		
		end;		

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') )";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_To )

	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND  ( PMPAYM.T_VALUEDATE >=  TO_DATE(' ";
		  
		else
		
		  condition = condition + " AND ( PMPAYM.T_VALUEDATE <=  TO_DATE(' ";
		
		end;	  

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ) ";
		    		
	  end;
	  
	   if( FilterItems[FilterItemsCount].Condition == FilterCondition_Between )

	   if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_VALUEDATE NOT BETWEEN    TO_DATE(' ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		
		  condition = condition + " AND TO_DATE(' ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		  
		else
		
		  condition = condition + " AND PMPAYM.T_VALUEDATE  BETWEEN    TO_DATE(' ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		
		  condition = condition + " AND TO_DATE(' ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		
		end;	  		
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_CurrentDate )

		if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_VALUEDATE !=  TO_DATE(' ";
		  
		else
		
		  condition = condition + " AND PMPAYM.T_VALUEDATE =  TO_DATE(' ";
		
		end;

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') )";
		    		
	  end;
	  
    end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_DOCKIND ) // Вид первичного документа
		  
      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))

		if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_DOCKIND NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_DOCKIND IN (  ";
		
		end;
			  
        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition +FilterItems[FilterItemsCount].Value[ValueCount].DocKind;
		  
		  ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		condition = condition + " ) ";

      end;
     
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_PURPOSE ) // Назначение платежа
	
      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_PURPOSE NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_PURPOSE IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Purpose;
		  
		  ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
	    condition = condition + " ) ";

      end;
    
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_BASEFIID ) // Базовый актив	

      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_BASEFIID NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_BASEFIID IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Fiid;
		  
		  ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		      condition = condition + " ) ";

      end;
    
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_FIID ) // Актив дебета
	
      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_FIID NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_FIID IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Fiid;
		  
		  ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		condition = condition + " ) ";

      end;
    
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_PAYFIID ) // Актив кредита
	
      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_PAYFIID NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_PAYFIID IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Fiid;
		  
		  ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		condition = condition + " ) ";

      end;
    
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_BASEAMOUNT ) // Базовая сумма
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_BASEAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_From )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_BASEAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " <= ";
		  
		  else
		
	        condition = condition + " >= ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Greater )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_BASEAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " < ";
		  
		  else
		
	        condition = condition + " > ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_To )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_BASEAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " >= ";
		  
		  else
		
	        condition = condition + " < ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Less )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_BASEAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " > ";
		  
		  else
		
	        condition = condition + " < ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Between )

	   if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  AND PMPAYM.T_BASEAMOUNT NOT BETWEEN    ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
				
		  condition = condition + " AND  ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
		  
		else
		
		  condition = condition + " AND PMPAYM.T_BASEAMOUNT  BETWEEN    ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
				
		  condition = condition + " AND  ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];		
		  
		end;
		
	  end;	  		
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_AMOUNT ) // Сумма дебета
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_AMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_From )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_AMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " <= ";
		  
		  else
		
	        condition = condition + " >= ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Greater )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_AMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " < ";
		  
		  else
		
	        condition = condition + " > ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_To )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_AMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " >= ";
		  
		  else
		
	        condition = condition + " < ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Less )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_AMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " > ";
		  
		  else
		
	        condition = condition + " < ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Between )

	   if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "AND  PMPAYM.T_AMOUNT NOT BETWEEN    ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
				
		  condition = condition + " AND  ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
				  
		else
		
		  condition = condition + "AND  PMPAYM.T_AMOUNT  BETWEEN  (  ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
				
		  condition = condition + " AND  ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
				  
		end;
		
	  end;	  		
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_PAYAMOUNT ) // Сумма кредита
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_PAYAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_From )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_PAYAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " <= ";
		  
		  else
		
	        condition = condition + " >= ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Greater )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_PAYAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " < ";
		  
		  else
		
	        condition = condition + " > ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_To )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_PAYAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " >= ";
		  
		  else
		
	        condition = condition + " < ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Less )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
		   
		  condition = condition + " AND PMPAYM.T_PAYAMOUNT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " > ";
		  
		  else
		
	        condition = condition + " < ";
		
		  end; 
          
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Between )

	   if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_PAYAMOUNT NOT BETWEEN  (  ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
				
		  condition = condition + " AND  ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];		
		  
		else
		
		  condition = condition + " AND PMPAYM.T_PAYAMOUNT  BETWEEN    ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
				
		  condition = condition + " AND  ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];		
		  
		end;
		
	  end;	  		
	  
	end;

   if( FilterItems[FilterItemsCount].Id == FILTERITEM_PAYER ) // Плательщик
	
      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_PAYER NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_PAYER IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Partyid;
		  
          ValueCount = ValueCount + 1;	
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		condition = condition + " ) ";

      end;
 	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_PAYERACCOUNT ) // Счет плательщика
	
      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_PAYERACCOUNT NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_PAYERACCOUNT IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Account;
		  
          ValueCount = ValueCount + 1;	
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		condition = condition + " ) ";

      end;
  	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_PAYERBANKID ) // Банк плательщика
	
      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_PAYERBANKID NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_PAYERBANKID IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Partyid;
		  
          ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		condition = condition + " ) ";

      end;
       	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_RECEIVER ) // Получатель
	
      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_RECEIVER NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_RECEIVER IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Partyid;
		  
		  ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		condition = condition + " ) ";

      end;
       	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_RECEIVERACCOUNT ) // Счет получателя

      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_RECEIVERACCOUNT NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_RECEIVERACCOUNT IN (  '";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Account;
		  
		  ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		condition = condition + "' ) ";

      end;
  	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_RECEIVERBANKID ) // Банк получателя

      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_RECEIVERBANKID NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_RECEIVERBANKID IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Partyid;
		  
		  ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;

        end;
		
		condition = condition + " ) ";

      end;
  
	end;
					  
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_DATE ) // Дата документа
	
	  condition = condition + " AND PMPAYM.T_PAYMENTID ";
		  
      condition = condition + " = ";
		  
      condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE ";
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  PMRMPROP.T_DATE !=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  PMRMPROP.T_DATE =  TO_DATE(' ";
		
		end;

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_From )

	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "   NOT ( PMRMPROP.T_DATE <=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  ( PMRMPROP.T_DATE >=  TO_DATE(' ";
		
		end;
		
	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') )";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_To )

	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "   NOT ( PMRMPROP.T_DATE >=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  ( PMRMPROP.T_DATE <=  TO_DATE(' ";
		
		end;	  

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ) ";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Between )

	   if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  PMPAYM.T_DATE NOT BETWEEN  (  TO_DATE(' ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		
		  condition = condition + " AND TO_DATE(' ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
		
		  condition = condition + " ', 'DD.MM.YYYY') )";
		  
		else
		
		  condition = condition + "  PMPAYM.T_DATE  BETWEEN    TO_DATE(' ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		
		  condition = condition + " AND TO_DATE(' ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		  
		end;
		
	end;	  		
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_CurrentDate )

		if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  PMRMPROP.T_DATE !=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  PMRMPROP.T_DATE =  TO_DATE(' ";
		
		end;

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ";
		    		
	  end;	  
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_CLIENTDATE ) // Дата проводки
	  
	  condition = condition + " AND PMPAYM.T_PAYMENTID ";
		  
	  condition = condition + " = "; 
		  
      condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE   ";
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  PMRMPROP.T_CLIENTDATE !=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  PMRMPROP.T_CLIENTDATE =  TO_DATE(' ";
		
		end;

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_From )

	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "   NOT ( PMRMPROP.T_CLIENTDATE <=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  ( PMRMPROP.T_CLIENTDATE >=  TO_DATE(' ";
		
		end;
		
	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') )";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_To )

	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "   NOT ( PMRMPROP.T_CLIENTDATE >=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  ( PMRMPROP.T_CLIENTDATE <=  TO_DATE(' ";
		
		end;	  

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ) ";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Between )

	   if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  PMRMPROP.T_CLIENTDATE NOT BETWEEN    TO_DATE(' ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		
		  condition = condition + " AND TO_DATE(' ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		  
		else
		
		  condition = condition + "  PMRMPROP.T_CLIENTDATE  BETWEEN    TO_DATE(' ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		
		  condition = condition + " AND TO_DATE(' ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		  
		end;
		
	  end;	  		
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_CurrentDate )

		if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  PMRMPROP.T_CLIENTDATE !=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  PMRMPROP.T_CLIENTDATE =  TO_DATE(' ";
		
		end;

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ";
		    		
	  end;
	  
	end;
			
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_PAYDATE ) // Срок платежа
	  
	  condition = condition + " AND PMPAYM.T_PAYMENTID ";
		  
      condition = condition + " = ";
		  
      condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE  ";
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  PMRMPROP.T_PAYDATE !=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  PMRMPROP.T_PAYDATE =  TO_DATE(' ";
		
		end;

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_From )

	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "   NOT ( PMRMPROP.T_PAYDATE <=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  ( PMRMPROP.T_PAYDATE >=  TO_DATE(' ";
		
		end;
		
	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') )";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_To )

	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "   NOT ( PMRMPROP.T_PAYDATE >=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  ( PMRMPROP.T_PAYDATE <=  TO_DATE(' ";
		
		end;	  

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ) ";
		    		
	  end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Between )

	   if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  PMRMPROP.T_PAYDATE NOT BETWEEN    TO_DATE(' ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		
		  condition = condition + " AND TO_DATE(' ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		  
		else
		
		  condition = condition + "  PMRMPROP.T_PAYDATE  BETWEEN    TO_DATE(' ";

	      condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		
		  condition = condition + " AND (' ";
		  
		  condition = condition +FilterItems[FilterItemsCount].Value[1];
		
		  condition = condition + " ', 'DD.MM.YYYY') ";
		  
		end;
		
	end;	  		
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_CurrentDate )

		if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + "  PMRMPROP.T_PAYDATE !=  TO_DATE(' ";
		  
		else
		
		  condition = condition + "  PMRMPROP.T_PAYDATE =  TO_DATE(' ";
		
		end;

	    condition = condition +FilterItems[FilterItemsCount].Value[0];
		
		condition = condition + " ', 'DD.MM.YYYY') ";
		    		
	  end;	
 	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_PAYMSTATUS ) // Статус платежа	

      if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))
	  
	    if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " AND PMPAYM.T_PAYMSTATUS NOT IN (  ";
		  
		else
		
	      condition = condition + " AND PMPAYM.T_PAYMSTATUS IN (  ";
		
		end;

        ValueCount = 0;
		
        while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	      condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Paymstatus;
		  
		  ValueCount = ValueCount + 1;
		  
	      if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		    condition = condition + " , ";
			  
	      end;
        
        end;
		
		condition = condition + " ) ";

      end;
  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_STARTDEPARTMENT ) // Начальный филиал
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_STARTDEPARTMENT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0].Code);
          
        end;

      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_DEPARTMENT ) // Текущий филиал
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_DEPARTMENT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0].Code);
          
        end;

      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_ENDDEPARTMENT ) // Конечный филиал
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_ENDDEPARTMENT ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0].Code);
          
        end;

      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_OPERNODE ) // Узел операциониста
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_OPERNODE ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0].Code);
          
        end;

      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_ISPLANPAYM ) // Является плановым
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )

        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_ISPLANPAYM ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
          condition = condition + ConvertBool(FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_ISFACTPAYM ) // Является фактическим

	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_ISFACTPAYM ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
          condition = condition +ConvertBool(FilterItems[FilterItemsCount].Value[0]);
          
        end;

      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_NUMBERPACK ) // Номер пачки
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_NUMBERPACK ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
          condition = condition + " ' " + (FilterItems[FilterItemsCount].Value[0]) + " ' ";
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Include )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_NUMBERPACK ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + "  NOT like '%";
		  
		  else
		
	        condition = condition + "  like '%";
		
		  end; 
		  		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
		  
		  condition = condition + "%' )";
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_StartWith )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_NUMBERPACK ";
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + "  NOT like '";
		  
		  else
		
	        condition = condition + "  like '";
		
		  end; 
		  		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
		  
		  condition = condition + "%' )";
          
        end;

      end;
	    
	end;
		
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_PRIORITY ) // Очередность платежа
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_PAYMENTID ";
		  
          condition = condition + " IN ";
		  
          condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE PMRMPROP.T_PRIORITY " ;
		  
		  if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
		  condition = condition + (FilterItems[FilterItemsCount].Value[0])+ ")";
          
        end;

      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_PAYMENTKIND ) // Вид платежа
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
                  
        condition = condition + " AND PMPAYM.T_PAYMENTID ";
		
        condition = condition + " IN ";
		
        condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE  ";
		
		if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " PMRMPROP.T_PAYMENTKIND NOT IN (  '";
		  
		else
		
	      condition = condition + " PMRMPROP.T_PAYMENTKIND IN (  '";
		
		end; 
		
		if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))

          ValueCount = 0;
		
          while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	        condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].PaymentKind;
			
		    ValueCount = ValueCount + 1;
			
	        if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		      condition = condition + " , ";
			  
	        end;

          end;

        end;
  
        condition = condition + "' ) ) ";
		  
      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_SHIFROPER ) // Шифр операции
;
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
                  
        condition = condition + " AND PMPAYM.T_PAYMENTID ";
		
        condition = condition + " IN ";
		
        condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE  ";	

		if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " PMRMPROP.T_SHIFROPER NOT IN (  '";
		  
		else
		
	      condition = condition + " PMRMPROP.T_SHIFROPER IN ( '";
		
		end; 		

		if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))

          ValueCount = 0;

          while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	        condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Shifr_Oper;
			
		    ValueCount = ValueCount + 1;
			
	        if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		      condition = condition + " , ";
			  
	        end;

          end;

        end;
  
        condition = condition + "') ) ";
		  
      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_GROUND ) // Основание (назначение) платежа

	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))
           
          condition = condition + " AND PMPAYM.T_PAYMENTID ";
		  
          condition = condition + " IN ";
		  
          condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE PMRMPROP.T_GROUND ";
		  
		  if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + " != ";
		  
		  else
		
	        condition = condition + " = ";
		
		  end; 
		  
		  condition = condition + "'"+(FilterItems[FilterItemsCount].Value[0])+ "' )";

        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Include )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null)) 

          condition = condition + " AND PMPAYM.T_PAYMENTID ";
		  
          condition = condition + " IN ";
		  
          condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE PMRMPROP.T_GROUND ";	   
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + "  NOT like '%";
		  
		  else
		
	        condition = condition + "  like '%";
		
		  end; 
		  		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
		  
		  condition = condition + "%' )";
          
        end;

      end;
	  
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_StartWith )
        
        if((FilterItems[FilterItemsCount].Value.Size > 0) AND
           (FilterItems[FilterItemsCount].Value[0] != null))  

          condition = condition + " AND PMPAYM.T_PAYMENTID ";
		  
          condition = condition + " IN ";
		  
          condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE PMRMPROP.T_GROUND ";	   
		  
          if( FilterItems[FilterItemsCount].IsNot )
		
            condition = condition + "  NOT like '";
		  
		  else
		
	        condition = condition + "  like '";
		
		  end; 
		  		  
          condition = condition + (FilterItems[FilterItemsCount].Value[0]);
		  
		  condition = condition + "%' )";
          
        end;

      end;
	  
	end;
	
	if( FilterItems[FilterItemsCount].Id == FILTERITEM_COMISSCHARGES ) // Комиссии
	
	  if( FilterItems[FilterItemsCount].Condition == FilterCondition_Equal )
                  
        condition = condition + " AND PMPAYM.T_PAYMENTID ";
        condition = condition + " IN ";
        condition = condition + "( SELECT PMRMPROP.T_PAYMENTID  FROM DPMRMPROP_DBT PMRMPROP WHERE  ";

		if( FilterItems[FilterItemsCount].IsNot )
		
          condition = condition + " PMRMPROP.T_COMISSCHARGES NOT IN (  ";
		  
		else
		
	      condition = condition + " PMRMPROP.T_COMISSCHARGES IN (  ";
		
		end; 				

		if((FilterItems[FilterItemsCount].Value != null) AND (FilterItems[FilterItemsCount].Value.Size > 0))

          ValueCount = 0;
		
          while( ValueCount < FilterItems[FilterItemsCount].Value.Size )

	        condition = condition + FilterItems[FilterItemsCount].Value[ValueCount].Element;
			
		    ValueCount = ValueCount + 1;
			
	        if((ValueCount > 0) AND (ValueCount < FilterItems[FilterItemsCount].Value.Size))
			
		      condition = condition + " , ";
			  
	        end;

          end;

        end;
  
        condition = condition + " ) ) ";
		  
      end;
	 
	end;
	
	FilterItemsCount=FilterItemsCount + 1;
	
  end;
  
  return condition;

end;





macro WebCore_GetPmPaymGridItemList(PageSize, PageNum, Account, Department, PayerReceiver ,FilterItems,OrderItems)

  var result  = TArray;
  
  var cmd, rs, obj;
  
  var query =   "  SELECT																						"+
				"          PMPAYM.T_PAYMSTATUS PaymStatus, 												"+
        "          (SELECT t_completed "+ // операция завершена
        "            FROM doproper_dbt op "+
        "          WHERE     op.t_dockind = PMPAYM.t_primdockind "+
        "                AND op.t_documentid = TRIM(TO_CHAR(PMPAYM.t_documentid, '0000000000000000000000000000000000'))) "+
        "            opcompleted,        "+
				"          PMPAYM.T_ISFACTPAYM IsFactPaym,														"+
				"          (SELECT PM_SCRHLP.GetPaymPurpName(PMPAYM.T_PURPOSE) FROM dual) ShortName,			"+
				"          (SELECT PM_SCRHLP.GetFiCode(PMPAYM.T_BASEFIID, ?) FROM dual) BaseFICode,	 			"+
				"          PMPAYM.T_BASEAMOUNT BaseAmount, 														"+
				"          (SELECT PM_SCRHLP.GetFiCode(PMPAYM.T_FIID, ?) FROM dual) FICode,  					"+
				"          PMPAYM.T_AMOUNT Amount,  															"+
				"          (SELECT PM_SCRHLP.GetFiCode(PMPAYM.T_PAYFIID,?) FROM dual) PayFICode, 				"+
				"          PMPAYM.T_PAYAMOUNT PayAmount, 														"+
				"          PMPAYM.T_FUTUREPAYERAMOUNT FuturePayerAmount, 										"+
				"          PMPAYM.T_VALUEDATE ValueDate, 														"+
				"          PMPAYM.T_PAYERCODE PayerCode, 														"+
				"         (  																					"+
				"		   SELECT PMPROP.T_BANKCODE 															"+
				"		   FROM DPMPROP_DBT PMPROP																"+
				"		   WHERE PMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID AND PMPROP.T_DEBETCREDIT =0 			"+
				"		  ) DebetBankCode,																		"+
				"          PMPAYM.T_PAYERACCOUNT PayerAccount,  												"+
				"          PMPAYM.T_RECEIVERCODE ReceiverCode, 													"+
				"         (  																					"+
				"		   SELECT PMPROP.T_BANKCODE 															"+
				"		   FROM DPMPROP_DBT PMPROP																"+
				"		   WHERE PMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID AND PMPROP.T_DEBETCREDIT =1 			"+
				"		  ) CreditBankCode,																		"+
				"          PMPAYM.T_RECEIVERACCOUNT ReceiverAccount, 											"+
				"          PMPAYM.T_NETTING Netting, 															"+
				"          (SELECT PM_SCRHLP.GetPaymStatusName(PMPAYM.T_PAYMSTATUS) FROM dual) Status, 			"+
				"          (SELECT PM_SCRHLP.GetDocKindName(PMPAYM.T_DOCKIND) FROM dual) DocKindName, 			"+
				"        (  																					"+
				"		   SELECT PMRMPROP.T_GROUND 															"+
				"		   FROM DPMRMPROP_DBT PMRMPROP 															"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 										"+
				"		 ) Ground,																			    "+
				"        (  																					"+
				"		   SELECT PMRMPROP.T_NUMBER 															"+
				"		   FROM DPMRMPROP_DBT PMRMPROP 															"+
				"		   WHERE PMRMPROP.T_PAYMENTID = PMPAYM.T_PAYMENTID 										"+
				"		 ) T_NUMBER,																			"+
				"          PMPAYM.T_PAYMENTID PAYMENTID,  														"+  
				"          PMPAYM.T_DOCUMENTID DOCUMENTID  														"+        				
				"  FROM DPMPAYM_DBT PMPAYM	 																	";


  var query_cond =" WHERE 1 = 1 ";
  
  if((ValType(Account) != V_UNDEF) AND (ValType(Department) != V_UNDEF) AND (PayerReceiver == 0) )
  
    query_cond = query_cond +" AND PMPAYM.T_PAYERACCOUNT = ? AND PMPAYM.T_PAYERBANKID = (SELECT DP_DEP.T_PARTYID FROM DDP_DEP_DBT DP_DEP WHERE DP_DEP.T_CODE = ?) ";
  
  end;
  
  if((ValType(Account) != V_UNDEF) AND (ValType(Department) != V_UNDEF) AND (PayerReceiver == 1) )
  
    query_cond = query_cond +" AND PMPAYM.T_RECEIVERACCOUNT = ? AND PMPAYM.T_RECEIVERBANKID = (SELECT DP_DEP.T_PARTYID FROM DDP_DEP_DBT DP_DEP WHERE DP_DEP.T_CODE = ?) ";
  
  end;
   
  query = query + query_cond;

  var strAddWhere = GetAddWhereCondition( FilterItems);
  
  query = query + strAddWhere;

  if(PageSize != 0)
  
    query = SQL_WrapSelect( query, PageNum, PageSize);
    
  end;
  
  cmd = RsdCommand(query);
  
  var val = SettingParm();

  cmd.addParam( "", RSDBP_IN, val);
  
  cmd.addParam( "", RSDBP_IN, val);
  
  cmd.addParam( "", RSDBP_IN, val);
  
  cmd.addParam( "", RSDBP_IN, Account);
  
  cmd.addParam( "", RSDBP_IN, Department);
  
  cmd.NullConversion = true;
  
  rs = RsdRecordset(cmd);

  while (rs.movenext)

    obj = TWebPmPaymGridItem;
	
    obj.PaymStatus = SQL_ConvTypeInteger(rs.value("PaymStatus"));
    obj.OpCompleted = SQL_ConvTypeBool(rs.value("OpCompleted"));

    obj.IsFactPaym = SQL_ConvType(rs.value("IsFactPaym"));	       		
	
    obj.ShortName = SQL_ConvType(rs.value("ShortName"));		

    obj.BaseFICode = SQL_ConvType(rs.value("BaseFICode"));		

    obj.BaseAmount = SQL_ConvType(rs.value("BaseAmount"));		

    obj.FICode = SQL_ConvType(rs.value("FICode"));		

    obj.Amount = SQL_ConvType(rs.value("Amount"));		

    obj.PayFICode = SQL_ConvType(rs.value("PayFICode"));		

    obj.PayAmount = SQL_ConvType(rs.value("PayAmount"));		
	
	obj.FuturePayerAmount = SQL_ConvType(rs.value("FuturePayerAmount"));	

    obj.ValueDate = SQL_ConvType(rs.value("ValueDate"));			

    obj.PayerCode = SQL_ConvType(rs.value("PayerCode"));

    obj.DebetBankCode = SQL_ConvType(rs.value("DebetBankCode"));		

    obj.PayerAccount = SQL_ConvType(rs.value("PayerAccount"));    

    obj.ReceiverCode = SQL_ConvType(rs.value("ReceiverCode"));	
	
	obj.CreditBankCode = SQL_ConvType(rs.value("CreditBankCode"));

    obj.ReceiverAccount = SQL_ConvType(rs.value("ReceiverAccount"));	

    obj.Netting = SQL_ConvType(rs.value("Netting"));	

    obj.Status = SQL_ConvType(rs.value("Status"));	
    
    obj.DocKindName = SQL_ConvType(rs.value("DocKindName"));	
	
    obj.Ground = SQL_ConvType(rs.value("Ground"));	

    obj.Number = SQL_ConvType(rs.value("T_NUMBER"));	
	
	obj.PaymentID = SQL_ConvType(rs.value("PAYMENTID"));
		
    obj.Documentid = SQL_ConvType(rs.value("DOCUMENTID"));
				
	result[result.size] = obj;

  end; 

  return result;

end;

macro WebCore_GetPmPaymGridItemListCount( Account, Department, PayerReceiver, FilterItems): integer
  
  var count;
  
  var cmd, rs, obj;
  
  var query =   "  SELECT count(*)	c																						  "         
				"  FROM DPMPAYM_DBT PMPAYM																		  ";

  var query_cond =" WHERE 1 = 1 ";
   	  	  
  if((ValType(Account) != V_UNDEF) AND (ValType(Department) != V_UNDEF) AND (PayerReceiver == 0) )
  
    query_cond = query_cond +" AND PMPAYM.T_PAYERACCOUNT = ? AND PMPAYM.T_PAYERBANKID = (SELECT DP_DEP.T_PARTYID FROM DDP_DEP_DBT DP_DEP WHERE DP_DEP.T_CODE = ?) ";
  
  end;
  
  if((ValType(Account) != V_UNDEF) AND (ValType(Department) != V_UNDEF) AND (PayerReceiver == 1) )
  
    query_cond = query_cond +" AND PMPAYM.T_RECEIVERACCOUNT = ? AND PMPAYM.T_RECEIVERBANKID = (SELECT DP_DEP.T_PARTYID FROM DDP_DEP_DBT DP_DEP WHERE DP_DEP.T_CODE = ?) ";
  
  end;

  query= query + query_cond;

  var strAddWhere = GetAddWhereCondition( FilterItems);

  query = query + strAddWhere;
  cmd = RsdCommand(query);
  
  cmd.addParam( "", RSDBP_IN, Account);
  
  cmd.addParam( "", RSDBP_IN, Department);
  
  rs = RsdRecordset(cmd);

  while (rs.movenext)

    count = rs.value("c");
	
  end; 

  return count;

end;
