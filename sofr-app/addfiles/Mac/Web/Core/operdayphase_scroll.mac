/*
$Name:        operdayphase_scroll.mac
$Module:      
$Description: 
*/

IMPORT BankInter;
import "ws_validation.mac";



class TWebOperDayPhaseGridItem 
  var Phase            : integer;   
  var Name             : string ;
  var IsSystem         : bool ;
  var IsMandatory      : bool ;
  var SwitchByScheduler: bool ;
end;

PRIVATE VAR ResponseBuilder : WebResponseBuilder;

private macro AddErrorMessage(ErrorMessage : @WsErrorMessage)

  var objErr = AL_GetErrorInfo();

  ErrorMessage.Code     = objErr.stat;
  ErrorMessage.Message  = objErr.message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

macro WebCore_GetOperDayPhaseGridItemList():TArray

  var result = TArray();

  var query = " SELECT *  FROM dphases_dbt accblnc ORDER BY T_PHASE ;";
    
  var  cmd = RsdCommand(query);
  
  var rs = RsdRecordset(cmd);

  while(rs.movenext)
  
    var PhaseGridItem = TWebOperDayPhaseGridItem();
	
	PhaseGridItem.Phase    = SQL_ConvType(rs.value("T_PHASE" ));
	
	PhaseGridItem.Name    = SQL_ConvType(rs.value("T_NAME" ));
	
	PhaseGridItem.IsSystem    = SQL_ConvType(rs.value("T_ISSYSTEM" ));
	
	PhaseGridItem.IsMandatory    = SQL_ConvType(rs.value("T_ISMANDATORY" ));
	
	PhaseGridItem.SwitchByScheduler    = SQL_ConvType(rs.value("T_SWITCHBYSHEDULER" ));
	
	result[result.size] = PhaseGridItem;
     
    PhaseGridItem = null;
  
  end;
  
  return result;
	
end;

macro WebCore_DeleteOperDayPhase(Phase):WebResponseBuilder

  responseBuilder =WebResponseBuilder();
    
  var ErrorMessage : WsErrorMessage = WsErrorMessage();
  
  var res = CB_DeleteOperDayPhase(Phase);
     
  if(res != true)
   
     AddErrorMessage(@ErrorMessage);
  
  end;
    
  responseBuilder.SetUserObject(res);
  
  return responseBuilder.Result;

end;

  
    






















