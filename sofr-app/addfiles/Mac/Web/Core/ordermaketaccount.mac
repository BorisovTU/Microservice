 /*
 $Name: ordermaketaccount.mac
 $Module: É´†¢≠†Ô ™≠®£†
 $Description: å†™‡Æ· è†≠•´® "å†™•‚ ·Æ‡‚®‡Æ¢™® ´®Ê•¢ÎÂ ·Á•‚Æ¢"
 */

import globals;
import "ws_validation.mac";

class TWebIOrderMaketAccountList
  var UserSort;
  var UserMacro;
	var Bal_Order: integer;
  var Bal_1;
  var Bal_2;
  var Bal_3;
  var Bal_4;
  var Bal_5;
  var Bal_6;
  var Bal_7;
  var Bal_8;
  var Bal_9;
  var Bal_A;
  var Bal_B;
  var Bal_C;
  var Bal_D;
  var Bal_E;
  var Bal_F;
  var Bal_G;
  var Bal_H;
  var Bal_I;
  var Bal_J;
  var Bal_K;
  var Bal_L;
  var Bal_M;
  var Bal_N;
  var Bal_O;
  var Bal_P;
  var Acc_Order: integer;
  var Acc_1;
  var Acc_2;
  var Acc_3;
  var Acc_4;
  var Acc_5;
  var Acc_6;
  var Acc_7;
  var Acc_8;
  var Acc_9;
  var Acc_A;
  var Acc_B;
  var Acc_C;
  var Acc_D;
  var Acc_E;
  var Acc_F;
  var Acc_G;
  var Acc_H;
  var Acc_I;
  var Acc_J;
  var Acc_K;
  var Acc_L;
  var Acc_M;
  var Acc_N;
  var Acc_O;
  var Acc_P;
	var Client_Order: integer;
	var Currency_Order: integer;
end;

/* Ä≠†´Æ£ ÆØ•‡†‚Æ‡† ?: ¢ ·®. */
private macro IIF( condition, value_true, value_false )
   if( condition )
      return value_true;
   else
      return value_false;
   end;
end;

PRIVATE VAR ResponseBuilder : WebResponseBuilder;

private macro AddErrorMessage(ErrorMessage : @WsErrorMessage)

  var objErr = AL_GetErrorInfo();

  ErrorMessage.Code     = objErr.stat;
  ErrorMessage.Message  = objErr.message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

private macro GetNumberFromChar(char)

  var n = 0;

  if(char == "1")
    n = 1;
  else
    if(char == "2")
      n = 2;
    else
      if(char == "3")
        n = 3;
      else
        if(char == "4")
          n = 4;
        else
          if(char == "5")
            n = 5;
          else
            if(char == "6")
              n = 6;
            else
              if(char == "7")
                n = 7;
              else
                if(char == "8")
                  n = 8;
                else
                  if(char == "9")
                    n = 9;
                  else
                    if(char == "A")
                      n = 10;
                    else
                      if(char == "B")
                        n = 11;
                      else
                        if(char == "C")
                          n = 12;
                        else
                          if(char == "D")
                            n = 13;
                          else
                            if(char == "E")
                              n = 14;
                            else
                              if(char == "F")
                                n = 15;
                              else
                                if(char == "G")
                                  n = 16;
                                else
                                  if(char == "H")
                                    n = 17;
                                  else
                                    if(char == "I")
                                      n = 18;
                                    else
                                      if(char == "J")
                                        n = 19;
                                      else
                                        if(char == "K")
                                          n = 20;
                                        else
                                          if(char == "L")
                                            n = 21;
                                          else
                                            if(char == "M")
                                              n = 22;
                                            else
                                              if(char == "N")
                                                n = 23;
                                              else
                                                if(char == "O")
                                                  n = 24;
                                                else
                                                  if(char == "P")
                                                    n = 25;
                                                  end;
                                                end;
                                              end;
                                            end;
                                          end;
                                        end;
                                      end;
                                    end;
                                  end;
                                end;
                              end;
                            end;
                          end;
                        end;
                      end;
                    end;
                  end;
                end;
              end;
            end;
          end;
        end;
      end;
    end;
  end;

  return n;

end;
private macro GetCharFromNumber(num)

  var char = " ";

  if(num == 1)
    char = "1";
  else
    if(num == 2)
      char = "2";
    else
      if(num == 3)
        char = "3";
      else
        if(num == 4)
          char = "4";
        else
          if(num == 5)
            char = "5";
          else
            if(num == 6)
              char = "6";
            else
              if(num == 7)
                char = "7";
              else
                if(num == 8)
                  char = "8";
                else
                  if(num == 9)
                    char = "9";
                  else
                    if(num == 10)
                      char = "A";
                    else
                      if(num == 11)
                        char = "B";
                      else
                        if(num == 12)
                          char = "C";
                        else
                          if(num == 13)
                            char = "D";
                          else
                            if(num == 14)
                              char = "E";
                            else
                              if(num == 15)
                                char = "F";
                              else
                                if(num == 16)
                                  char = "G";
                                else
                                  if(num == 17)
                                    char = "H";
                                  else
                                    if(num == 18)
                                      char = "I";
                                    else
                                      if(num == 19)
                                        char = "J";
                                      else
                                        if(num == 20)
                                          char = "K";
                                        else
                                          if(num == 21)
                                            char = "L";
                                          else
                                            if(num == 22)
                                              char = "M";
                                            else
                                              if(num == 23)
                                                char = "N";
                                              else
                                                if(num == 24)
                                                  char = "O";
                                                else
                                                  if(num == 25)
                                                    char = "P";
                                                  end;
                                                end;
                                              end;
                                            end;
                                          end;
                                        end;
                                      end;
                                    end;
                                  end;
                                end;
                              end;
                            end;
                          end;
                        end;
                      end;
                    end;
                  end;
                end;
              end;
            end;
          end;
        end;
      end;
    end;
  end;

  return char;

end;

macro WebCore_GetOrderMaketAccountList()

  var result = TWebIOrderMaketAccountList();

  var res;
  var err;

  GetRegistryValue( "BANK_INI\\éÅôàÖ èÄêÄåÖíêõ\\èÖêÖåÖççõÖ\\SORTACCOUNT", V_STRING, res, err );

  if(err == 0)

    result.UserMacro = res;

  else
    RunError("éË®°™† Ø‡® Á‚•≠®® ≠†·‚‡Æ©™® ‡••·‚‡†!");
  end;

  var stat;

  var UserSort   : bool;
  var SA_Field0  : integer;
  var SA_Field1  : integer;
  var SA_Field2  : integer;
  var SA_Field3  : integer;
  var SA_Balance : string;
  var SA_Account : string;

  stat = CB_GetOrderMaketAccountList(UserSort, SA_Field0, SA_Field1, SA_Field2, SA_Field3, SA_Balance, SA_Account);

  if(stat == 0)

    result.UserSort       = UserSort;

    result.Bal_Order      = StrFor(SA_Field0);
    result.Acc_Order      = StrFor(SA_Field1);
    result.Client_Order   = StrFor(SA_Field2);
    result.Currency_Order = StrFor(SA_Field3);

    result.Bal_1 = GetNumberFromChar(StrUpr(SubStr(SA_Balance,  1, 1)));
    result.Bal_2 = GetNumberFromChar(StrUpr(SubStr(SA_Balance,  2, 1)));
    result.Bal_3 = GetNumberFromChar(StrUpr(SubStr(SA_Balance,  3, 1)));
    result.Bal_4 = GetNumberFromChar(StrUpr(SubStr(SA_Balance,  4, 1)));
    result.Bal_5 = GetNumberFromChar(StrUpr(SubStr(SA_Balance,  5, 1)));
    result.Bal_6 = GetNumberFromChar(StrUpr(SubStr(SA_Balance,  6, 1)));
    result.Bal_7 = GetNumberFromChar(StrUpr(SubStr(SA_Balance,  7, 1)));
    result.Bal_8 = GetNumberFromChar(StrUpr(SubStr(SA_Balance,  8, 1)));
    result.Bal_9 = GetNumberFromChar(StrUpr(SubStr(SA_Balance,  9, 1)));
    result.Bal_A = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 10, 1)));
    result.Bal_B = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 11, 1)));
    result.Bal_C = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 12, 1)));
    result.Bal_D = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 13, 1)));
    result.Bal_E = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 14, 1)));
    result.Bal_F = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 15, 1)));
    result.Bal_G = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 16, 1)));
    result.Bal_H = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 17, 1)));
    result.Bal_I = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 18, 1)));
    result.Bal_J = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 19, 1)));
    result.Bal_K = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 20, 1)));
    result.Bal_L = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 21, 1)));
    result.Bal_M = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 22, 1)));
    result.Bal_N = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 23, 1)));
    result.Bal_O = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 24, 1)));
    result.Bal_P = GetNumberFromChar(StrUpr(SubStr(SA_Balance, 25, 1)));

    result.Acc_1 = GetNumberFromChar(StrUpr(SubStr(SA_Account,  1, 1)));
    result.Acc_2 = GetNumberFromChar(StrUpr(SubStr(SA_Account,  2, 1)));
    result.Acc_3 = GetNumberFromChar(StrUpr(SubStr(SA_Account,  3, 1)));
    result.Acc_4 = GetNumberFromChar(StrUpr(SubStr(SA_Account,  4, 1)));
    result.Acc_5 = GetNumberFromChar(StrUpr(SubStr(SA_Account,  5, 1)));
    result.Acc_6 = GetNumberFromChar(StrUpr(SubStr(SA_Account,  6, 1)));
    result.Acc_7 = GetNumberFromChar(StrUpr(SubStr(SA_Account,  7, 1)));
    result.Acc_8 = GetNumberFromChar(StrUpr(SubStr(SA_Account,  8, 1)));
    result.Acc_9 = GetNumberFromChar(StrUpr(SubStr(SA_Account,  9, 1)));
    result.Acc_A = GetNumberFromChar(StrUpr(SubStr(SA_Account, 10, 1)));
    result.Acc_B = GetNumberFromChar(StrUpr(SubStr(SA_Account, 11, 1)));
    result.Acc_C = GetNumberFromChar(StrUpr(SubStr(SA_Account, 12, 1)));
    result.Acc_D = GetNumberFromChar(StrUpr(SubStr(SA_Account, 13, 1)));
    result.Acc_E = GetNumberFromChar(StrUpr(SubStr(SA_Account, 14, 1)));
    result.Acc_F = GetNumberFromChar(StrUpr(SubStr(SA_Account, 15, 1)));
    result.Acc_G = GetNumberFromChar(StrUpr(SubStr(SA_Account, 16, 1)));
    result.Acc_H = GetNumberFromChar(StrUpr(SubStr(SA_Account, 17, 1)));
    result.Acc_I = GetNumberFromChar(StrUpr(SubStr(SA_Account, 18, 1)));
    result.Acc_J = GetNumberFromChar(StrUpr(SubStr(SA_Account, 19, 1)));
    result.Acc_K = GetNumberFromChar(StrUpr(SubStr(SA_Account, 20, 1)));
    result.Acc_L = GetNumberFromChar(StrUpr(SubStr(SA_Account, 21, 1)));
    result.Acc_M = GetNumberFromChar(StrUpr(SubStr(SA_Account, 22, 1)));
    result.Acc_N = GetNumberFromChar(StrUpr(SubStr(SA_Account, 23, 1)));
    result.Acc_O = GetNumberFromChar(StrUpr(SubStr(SA_Account, 24, 1)));
    result.Acc_P = GetNumberFromChar(StrUpr(SubStr(SA_Account, 25, 1)));

  end;

  return result;

end;

macro WebCore_SaveOrderMaketAccountList(IOrderMaketAccountList)

  ResponseBuilder = WebResponseBuilder();

  var ErrorMessage : WsErrorMessage = WsErrorMessage();

  var stat = true;

  var SA_Field0  : string;
  var SA_Field1  : string;
  var SA_Field2  : string;
  var SA_Field3  : string;
  var SA_Balance : string;
  var SA_Account : string;
  
  if(IOrderMaketAccountList.UserSort == true)
    
    stat = SetRegistryValue( "BANK_INI\\éÅôàÖ èÄêÄåÖíêõ\\èÖêÖåÖççõÖ\\SORTACCOUNT",  IOrderMaketAccountList.UserMacro );
    
  end;

  SA_Field0 = IIF(IOrderMaketAccountList.Bal_Order == 0, " ", IOrderMaketAccountList.Bal_Order );
  SA_Field1 = IIF(IOrderMaketAccountList.Acc_Order == 0, " ", IOrderMaketAccountList.Acc_Order );
  SA_Field2 = IIF(IOrderMaketAccountList.Client_Order == 0, " ", IOrderMaketAccountList.Client_Order );
  SA_Field3 = IIF(IOrderMaketAccountList.Currency_Order == 0, " ", IOrderMaketAccountList.Currency_Order );

  SA_Balance = GetCharFromNumber(IOrderMaketAccountList.Bal_1) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_2) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_3) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_4) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_5) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_6) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_7) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_8) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_9) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_A) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_B) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_C) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_D) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_E) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_F) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_G) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_H) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_I) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_J) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_K) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_L) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_M) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_N) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_O) +
               GetCharFromNumber(IOrderMaketAccountList.Bal_P);

  SA_Account = GetCharFromNumber(IOrderMaketAccountList.Acc_1) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_2) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_3) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_4) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_5) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_6) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_7) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_8) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_9) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_A) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_B) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_C) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_D) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_E) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_F) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_G) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_H) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_I) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_J) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_K) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_L) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_M) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_N) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_O) +
               GetCharFromNumber(IOrderMaketAccountList.Acc_P);
               
  stat = CB_SaveOrderMaketAccountList(IOrderMaketAccountList.UserSort, SA_Field0, SA_Field1, SA_Field2, SA_Field3, SA_Balance, SA_Account);
  
  if(stat != true )
    AddErrorMessage(@ErrorMessage);
  end;

  responseBuilder.SetUserObject(stat);

  return responseBuilder.Result;

end;