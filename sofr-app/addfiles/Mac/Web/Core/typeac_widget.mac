/*
$Name:        typeac_widget.mac
$Module:      Главная книга
$Description: Макрос виджета выбора значений справочника типов
*/

import "ws_partycommon.mac";

class TWebTypeAc
  var INumType;
  var Type_Account;
  var Name_Type;
end;

macro WebCore_GetTypeAcList(iNumType, Types_Account)

  var cmd, rs;

  var Arr = TArray;

  var query = " SELECT T_INUMTYPE, T_TYPE_ACCOUNT, T_NAME_TYPE "
              " FROM DTYPEAC_DBT t WHERE 1 = 1 ";

  if( Types_Account != NULL )
        query = query + " AND ? LIKE ('%' || T_TYPE_ACCOUNT || '%')";
  end;

  if( iNumType != NULL )
      query = query + " AND T_INUMTYPE = ? ";
  end;


  cmd = RsdCommand(query);
  
  
  if( Types_Account != NULL ) 
       cmd.addParam( "", RSDBP_IN, Types_Account );
  end;
  
  if( iNumType != NULL )
  cmd.addParam( "", RSDBP_IN, iNumType );
  end;

  rs = RsdRecordset(cmd);

  while(rs.movenext)

    var obj = TWebTypeAc;

    obj.iNumType     = rs.value("T_INUMTYPE");
    obj.Type_Account = rs.value("T_TYPE_ACCOUNT");
    obj.Name_Type    = rs.value("T_NAME_TYPE");

    Arr[Arr.size] = obj;

  end;

  return Arr;

end;



macro WebCore_CreateTWebTypeAcFromBD(Type_Account)

  var obj;

  var cmd, rs;

  var query = " SELECT T_INUMTYPE, T_TYPE_ACCOUNT, T_NAME_TYPE "
              " FROM DACCTYPE_DBT t WHERE T_TYPE_ACCOUNT = ? ";

  cmd = RsdCommand(query);

  cmd.addParam( "", RSDBP_IN, Type_Account );

  rs = RsdRecordset(cmd);

  if(rs.movenext)

    obj = TWebTypeAc;

    obj.iNumType     = rs.value("T_INUMTYPE");
    obj.Type_Account = rs.value("T_TYPE_ACCOUNT");
    obj.Name_Type    = rs.value("T_NAME_TYPE");

  end;

  return obj;

end;

macro WebCore_CreateTWebTypeAc(iNumType, Type_Account, Name_Type)

  var obj = TWebTypeAc;

  obj.iNumType     = iNumType;
  obj.Type_Account = Type_Account;
  obj.Name_Type    = Name_Type;

  return obj;

end;