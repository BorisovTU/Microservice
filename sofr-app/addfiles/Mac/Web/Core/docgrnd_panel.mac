/*
$Name:        docgrnd_panel.mac
$Module:      Главная книга
$Description: Макрос содержит реализацию сервисов для панели ввода основания документа
*/

import "ws_partycommon.mac";
import "ws_person.mac";
import "ws_validation.mac";

class TWebDocGroundObject
  var RecID;
  var DocKind;
  var SubDocKind;
  var GroundCode;
  var Oper;
  var GroundText;
end;

PRIVATE VAR ResponseBuilder : WebResponseBuilder;

private macro AddErrorMessage(ErrorMessage : @WsErrorMessage)

  var objErr = AL_GetErrorInfo();

  ErrorMessage.Code     = objErr.stat;
  ErrorMessage.Message  = objErr.message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

macro WebCore_InsertDocGroundObject(DocGroundObject, AllGrounds)

  var res = True;

  ResponseBuilder = WebResponseBuilder();

  var ErrorMessage : WsErrorMessage = WsErrorMessage();

  file docgrnd("docgrnd.dbt");

  ClearRecord(docgrnd);

  docgrnd.DocKind    = DocGroundObject.DocKind;
  docgrnd.SubDocKind = DocGroundObject.SubDocKind;
  docgrnd.GroundCode = DocGroundObject.GroundCode;
  docgrnd.Oper       = DocGroundObject.Oper.Number;
  docgrnd.GroundText = DocGroundObject.GroundText;

  res = CB_InsertUpdateDocGrnd(docgrnd, AllGrounds);

  if(res != True)

    AddErrorMessage(@ErrorMessage);

  end;

  responseBuilder.SetUserObject(res);

  return responseBuilder.Result;

end;