/*
$Name:        nameplan_scroll.mac
$Module:      Главная книга
$Description: Макрос списка планов счетов
*/

import "ws_partycommon.mac";
import "ws_validation.mac";
import BankInter;

PRIVATE VAR ResponseBuilder : WebResponseBuilder;

private macro AddErrorMessage(ErrorMessage : @WsErrorMessage)

  var objErr = AL_GetErrorInfo();

  ErrorMessage.Code     = objErr.stat;
  ErrorMessage.Message  = objErr.message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

macro WebCore_GetNamePlanList()

  var cmd, rs;

  var Rec = TRecHandler("nameplan");
  var Arr = TArray;

  var query = "select * from dnameplan_dbt  ORDER BY T_INUMPLAN ";

  cmd = RsdCommand(query);
  rs = RsdRecordset(cmd);

  while(rs.movenext)

    _CopyRecordsetToRecHandler(rs, Rec);

    var p = TRecHandler("nameplan");
    copy(p, Rec);

    Arr[Arr.size] = p.rec;

  end;

  return Arr;
  
end;

macro WebCore_UpdateNamePlan( iNamePlan, szNamePlan)

  var res = True;

  ResponseBuilder = WebResponseBuilder();

  var ErrorMessage : WsErrorMessage = WsErrorMessage();
  
  res = CB_UpdateNamePlan(iNamePlan, szNamePlan);
  
  if(res != True)

    AddErrorMessage(@ErrorMessage);

  end;

  responseBuilder.SetUserObject(res);

  return responseBuilder.Result;  

end;