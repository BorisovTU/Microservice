 /*
 $Name: ofrsymbolrep_panel.mac
 $Module: Главная книга
 $Description: Макрос Проверка корректности символов ОФР
 */
 
import globals;
import "ws_validation.mac";
import "ws_file.mac";
import "pr_opus.mac";

PRIVATE VAR ResponseBuilder : WebResponseBuilder;

private macro AddErrorMessage(ErrorMessage : @WsErrorMessage)

  var objErr = AL_GetErrorInfo();

  ErrorMessage.Code     = objErr.stat;
  ErrorMessage.Message  = objErr.message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

private macro AddErrorMessageExt(ErrorMessage : @WsErrorMessage, stat, message)

  ErrorMessage.Code     = stat;
  ErrorMessage.Message  = message;
  ErrorMessage.Severity = MessageSeverity.RuntimeError;

  ResponseBuilder.AddMessage( ErrorMessage );

end;

macro WebCore_ExecOFRSymbolReport(CheckAccount, CheckSymbPeriod, StartPeriod, EndPeriod)

  var fc = null;
  
  ResponseBuilder = WebResponseBuilder();

  var ErrorMessage : WsErrorMessage = WsErrorMessage();
  
  fc = GetTxtFileName("OFRSymbolReport");
  
  setOutput(fc);
  
  ProcessReport(CheckAccount,CheckSymbPeriod,StartPeriod,EndPeriod);
  
  setOutput();
    
  fc = ConvertTxt2Html(fc);

  fc = GetTextFile(fc);
  
  responseBuilder.SetUserObject(fc);

  return responseBuilder.Result;
  
end;