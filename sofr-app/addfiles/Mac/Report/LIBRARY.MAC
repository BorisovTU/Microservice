/*───────────────────────────────────────────────────────────────────────────┐
   RS-Bank v4.21                                     R-Style Software Lab Ltd
   Библиотека интерпретируемых модулей

   Библиотека часто используемых макросов

  File Name        : library.mac

  Public routines  : RestOnAccount (...)

CREATED: June 1 ,1994 Иванов А. Р.
MODIFICATIONS:
   07-15-96 Мол. - для 4.21

└───────────────────────────────────────────────────────────────────────────*/
/* 21.06.2005 ABP В сборке за 21.06.2005 эта функция нигде не вызывается.
MACRO RestOnAccount    /* Вычисляет остаток на счете */
(
Account,    /* номер счета, ОБРЕЗАННЫЙ ДО 9 СИМВОЛОВ */
DebtDate,   /* дата, на которую вычисляется остаток  */
Currency,    /* код валюты                            */
Chapter
)

file Acc   (account);          /* файл балансовых счетов лицевых счетов  */
file AccC  ("account$.dbt");   /* файл балансовых счетов валютных счетов */
file Rest  (restdate);         /* файл рублевых остатков по датам        */
file RestC ("restdat$.dbt");   /* файл валютных остатков по датам        */
D = $0;

if (DebtDate == {curdate})
   if (Currency == 0)
        Acc.Account = Account;
        Acc.Chapter = Chapter;
      if (getEQ (Acc) )
         D = Acc.R0;
      end;
   else
        AccC.Account = Account;
        AccC.Code_Currency = Currency;
        AccC.Chapter = Chapter;
      if (getEQ (AccC) )
         D = AccC.R0;
      end;
   end;
elif (DebtDate < {curdate})
   if (Currency == 0)
        Rest.Account = Account;
        Rest.Code_Currency = 0;
        Rest.Chapter = Chapter;
        Rest.Date_Value = DebtDate;
      if (getLE (Rest) )
         if (Rest.Account == Account)
            D = Rest.Rest;
         end;
      end;
   else
        RestC.Account = Account;
        RestC.Code_Currency = Currency;
        RestC.Date_Value = DebtDate;
        RestC.Chapter = Chapter;
      if (getLE (RestC) )
         if ((RestC.Account == Account) and (RestC.Code_Currency == Currency))
            D = RestC.Rest;
         end;
      end;
   end;
end;
return D;
END;
*/
MACRO АП(Остаток)
     if (Остаток<=0) return "актив";
     else return "пассив";
     end;
END;

MACRO ДК(Остаток)
     if (Остаток<=0) return "Д";
     else return "К";
     end;
END;

MACRO Pow10(val1);
   return Pow( 10, val1);
END;

VAR Olddate = date(1,1,"");
VAR OldCur = -1;
VAR dOldRet = 0.0;

MACRO GetOfRate(Cur,dat);
   file cd (crncdate);
   file cr (currency);
   if ((Olddate == dat)and(OldCur == Cur)) return double(dOldRet); end;
   Olddate = dat; OldCur = Cur;
   dOldRet = 1.0;
   if (Cur == 0) return double(dOldRet); end;
   if (date>={curdate})
      cr.Code_Currency = Cur;
      if (getEQ(cr))
         dOldRet = (cr.Cur_Rate/pow10(cr.PointOfc))/cr.ScaleOfc;
      else
         dOldRet = 0.0;
      end;
   else
      cd.Code_Currency = Cur;
      cd.Date_Rate = dat;
      if (getLE(cd))
         dOldRet = (cd.Rate/pow10(cd.Point))/cd.Scale;
      else
         dOldRet = 0.0;
      end;
   end;
   return double(dOldRet);
END;

var OldRet = "???";
var OldCod = -1;

MACRO GetISO(Cod);
   file cr (currency) key 0;
   if (OldCod == Cod) return OldRet; end;
   cr.Code_Currency = Cod;
   if (getEQ(cr))
      OldRet = cr.Short_Name;
   else
      OldRet = "???";
   end;
   OldCod = Cod;
   return OldRet;
END;

/*eof*/