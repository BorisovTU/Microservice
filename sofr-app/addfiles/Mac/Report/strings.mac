/*
ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º  Žâ¤¥« ®¤¤¥à¦ª¨           R-Style SoftWare Lab               ‚ çìï­ žà¨©  º
ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹                             
º                       ”ã­ªæ¨¨ ¤«ï à ¡®âë á® áâà®ª ¬¨ 			     º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³01.09.99 - ‘®§¤ ­¨¥                                                         ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
*/


Macro LSymb( vSrting, sSymb, iLen )
var 	sTrimSring	= Trim( String( vSrting ) );
var 	iTrimLen	= StrLen( sTrimSring );
 	sSymb		= String(sSymb);
	If ( iTrimLen >= iLen ) 
		Return sTrimSring
	Else  
		Return MkStr( sSymb, iLen-iTrimLen ) + sTrimSring
	End;
End;

Macro ‡ ¬¥­¨âì‘âà®ª®©‘ ç « (‘âà®ª , —â®, —¥¬)
    	‘âà®ª 		= String(‘âà®ª );
    	—â®		= String(—â®);
    	—¥¬		= String(—¥¬);
var 	„«¨­ —â®	= StrLen(—â®);
var 	„«¨­ —¥¬	= StrLen(—¥¬);
var 	i = 1;
	While(SubStr(‘âà®ª , i, „«¨­ —â®) == —â®)
		‘âà®ª  = SubStr(‘âà®ª , 1, i-1) + —¥¬ + SubStr(‘âà®ª , i + „«¨­ —â®);
		i = i + „«¨­ —¥¬
	End;
	Return ‘âà®ª 
End;


Macro DelSymbInBegin(S, Symb)
var 	Len = StrLen(Symb);
	While(SubStr(S,1,Len) == Symb)
		S = SubStr(S,Len+1);
	End;
	Return S
End;

Macro DelSymbInBegin2(S, Symb)
var 	Len	= StrLen(Symb);
var 	i	= 1;
var 	sSymb	= SubStr(S,i,1);
	While(	(sSymb == ".")
		or (sSymb == ",")
		or (sSymb == "\t")
		or (sSymb == "\n")
		or (sSymb == "?")
		or (sSymb == "!")
		or (sSymb == " "))
		If(sSymb == Symb)
			S = SubStr(S,1,i-1) + SubStr(S,i+1);
		Else
			i = i + 1;
		End;
		sSymb	= SubStr(S,i,1);
	End;
	Return S
End;


Macro LTrim( S )
	S = DelSymbInBegin2( S, ".");
	S = DelSymbInBegin2( S, ",");
	S = DelSymbInBegin2( S, " ");
	S = DelSymbInBegin2( S, "\t");
	S = DelSymbInBegin2( S, "\n");
	S = DelSymbInBegin2( S, "?");
	S = DelSymbInBegin2( S, "!");
	Return S
End;

 Macro Filter(Val, FilterStr)

  Macro ˆ­¤¥ªá®á«¥®¤áâà®ª¨¥§‡¢¥§¤®ç¥ª(Val, FilterStr)

   Macro ®¨áª—¥£®¨¡ã¤ì(FilterStr)
    var IndexOne = Index(FilterStr, "?");
    var FirstStr = FilterStr, SecondStr	;
    If(IndexOne > 0)
     SecondStr	= FilterStr;
     FirstStr	= SubStr(SecondStr, 1, IndexOne-1);
     While((FirstStr == "") and (IndexOne != 0))
      SecondStr	= SubStr(SecondStr, IndexOne + 1);
      IndexOne	= Index(SecondStr,"?");
      FirstStr	= SubStr(SecondStr, 1, IndexOne-1);
     End;
     If(IndexOne == 0)
      FirstStr = SecondStr
     End;
    End;
    Return FirstStr
   End;

   Macro ScanStr(Val, FilterStr, IndexOne, IndexSub, FirstPos)
    Val	= SubStr(Val, IndexOne-IndexSub+1, FirstPos);
    FirstPos = FirstPos + IndexOne - IndexSub + 1;
    IndexOne = Index(FilterStr,"?");
    While(IndexOne > 0)
     StrSet(Val,IndexOne,"*");
     StrSet(FilterStr,IndexOne,"*");
     IndexOne = Index(FilterStr,"?");
    End;
    If(Val == FilterStr)
     Return FirstPos;
    Else
     Return 0;
    End;
   End;

   var FirstStr	= ®¨áª—¥£®¨¡ã¤ì(FilterStr);
   var FirstPos	= Strlen(FilterStr);
   var IndexOne	= Index(Val, FirstStr);
   var IndexSub	= Index(FilterStr, FirstStr);
   var RezScan	= ScanStr(Val, FilterStr, IndexOne, IndexSub, FirstPos);
   var IndexZv;

   While((IndexOne > 0) and (RezScan == 0))
    StrSet(Val, IndexOne, "*");
    IndexOne	= Index(Val, FirstStr);
    RezScan	= ScanStr(Val, FilterStr, IndexOne, IndexSub, FirstPos);
   End;

   Return RezScan
  End;

  var FirstStr, IndexFirstStr, IndexZv;
  Val		= StrUpr(Val);
  FilterStr	= StrUpr(FilterStr);

  IndexZv = Index(FilterStr,"*");
  If(IndexZv == 0)
   Return ˆ­¤¥ªá®á«¥®¤áâà®ª¨¥§‡¢¥§¤®ç¥ª(Val, FilterStr) != 0
  End;

  While(IndexZv > 0)
   FirstStr	= SubStr(FilterStr,1,IndexZv-1);
   FilterStr	= SubStr(FilterStr,IndexZv+1);
   IndexFirstStr= ˆ­¤¥ªá®á«¥®¤áâà®ª¨¥§‡¢¥§¤®ç¥ª(Val, FirstStr);
   If(IndexFirstStr == 0)
    Return False
   End;
   DelSymbInBegin(FilterStr,"*");
   IndexZv	= Index(FilterStr,"*");
   Val		= SubStr(Val, IndexFirstStr);
  End;
  Return ˆ­¤¥ªá®á«¥®¤áâà®ª¨¥§‡¢¥§¤®ç¥ª(Val, FilterStr) != 0
 End;

/*
 Macro Filter(Val, FilterStr)

  Macro ˆ­¤¥ªá®á«¥®¤áâà®ª¨¥§‡¢¥§¤®ç¥ª(Val, FilterStr)

   Macro ®¨áª—¥£®¨¡ã¤ì(FilterStr)
    IndexOne = Index(FilterStr, "?");
    FirstStr = FilterStr;
    If(IndexOne > 0)
     SecondStr	= FilterStr;
     FirstStr	= SubStr(SecondStr, 1, IndexOne-1);
     While((FirstStr == "") and (IndexOne != 0))
      SecondStr	= SubStr(SecondStr, IndexOne + 1);
      IndexOne	= Index(SecondStr,"?");
      FirstStr	= SubStr(SecondStr, 1, IndexOne-1);
     End;
     If(IndexOne == 0)
      FirstStr = SecondStr
     End;
    End;
    Return FirstStr
   End;

   Macro ScanStr(Val, FilterStr, IndexOne, IndexSub, FirstPos)
    Val	= SubStr(Val, IndexOne-IndexSub+1, FirstPos);
    FirstPos = FirstPos + IndexOne - IndexSub + 1;
    IndexOne = Index(FilterStr,"?");
    While(IndexOne > 0)
     StrSet(Val,IndexOne,"*");
     StrSet(FilterStr,IndexOne,"*");
     IndexOne = Index(FilterStr,"?");
    End;
    If(Val == FilterStr)
     Return FirstPos;
    Else
     Return 0;
    End;
   End;

   FirstStr	= ®¨áª—¥£®¨¡ã¤ì(FilterStr);
   FirstPos	= Strlen(FilterStr);
   IndexOne	= Index(Val, FirstStr);
   IndexSub	= Index(FilterStr, FirstStr);
   RezScan	= ScanStr(Val, FilterStr, IndexOne, IndexSub, FirstPos);

   While((IndexOne > 0) and (RezScan == 0))
    StrSet(Val, IndexOne, "*");
    IndexOne	= Index(Val, FirstStr);
    RezScan	= ScanStr(Val, FilterStr, IndexOne, IndexSub, FirstPos);
   End;

   Return RezScan
  End;

  Val		= StrUpr(Val);
  FilterStr	= StrUpr(FilterStr);

  IndexZv = Index(FilterStr,"*");
  If(IndexZv == 0)
   Return ˆ­¤¥ªá®á«¥®¤áâà®ª¨¥§‡¢¥§¤®ç¥ª(Val, FilterStr) != 0
  End;

  While(IndexZv > 0)
   FirstStr	= SubStr(FilterStr,1,IndexZv-1);
   FilterStr	= SubStr(FilterStr,IndexZv+1);
   IndexFirstStr= ˆ­¤¥ªá®á«¥®¤áâà®ª¨¥§‡¢¥§¤®ç¥ª(Val, FirstStr);
   If(IndexFirstStr == 0)
    Return False
   End;
   DelSymbInBegin(FilterStr,"*");
   IndexZv	= Index(FilterStr,"*");
   Val		= SubStr(Val, IndexFirstStr);
  End;
  Return ˆ­¤¥ªá®á«¥®¤áâà®ª¨¥§‡¢¥§¤®ç¥ª(Val, FilterStr) != 0
 End;
*/

var sFormatDate = "";

Macro DateToStr( dDate )
  var iDay, iMonth, iYear, smask, iind, iindbegin, iIndEnd,
      iLen, iNum, iLenNum, iy;

	DateSplit( dDate, iDay, iMonth, iYear );

	If(Not GetParm(1, sMask) or (sMask == ""))
		sMask = sFormatDate
	End;

	Macro ‡ ¬¥­ ‘¨¬¢®«®¢ —¨á« ( sSymb, iNum )
		iInd		= Index( sMask, sSymb);
		If(iInd == 0)
			Return True
		End;
		iIndBegin	= iInd;
		iIndEnd		= iInd;
		While(iInd > 0)
			StrSet( sMask, iInd, StrFor(1) );
			iIndEnd	= iInd;
			iInd	= Index( sMask, sSymb);
			If(iInd - iIndEnd > 1)
				Return False
			End;
		End;
		iNum	= String(iNum);
		iLen	= iIndEnd-iIndBegin+1;
		iLenNum	= StrLen(iNum);
		If(iLenNum < iLen)
			iNum	= MkStr("0",iLen-iLenNum) + iNum
		Else
			If( sSymb == "Y" )
				iNum	= SubStr( iNum, iLenNum-iLen+1 );
			End;
		End;
		sMask	= SubStr(sMask,1,iIndBegin-1) + iNum + SubStr(sMask,iIndEnd+1);
		Return True
	End;

	If(	(sMask != "")
		and ‡ ¬¥­ ‘¨¬¢®«®¢ —¨á« ( "D", iDay )
		and ‡ ¬¥­ ‘¨¬¢®«®¢ —¨á« ( "M", iMonth )
		and ‡ ¬¥­ ‘¨¬¢®«®¢ —¨á« ( "Y", iYear ))
		Return sMask
	Else
		Return String(dDate)
	End;
End;

Macro StrToDate( sDate )
  var iDay, iMonth, iYear, smask, iind, iindbegin, iIndEnd,
      iLen, iNum, iLenNum, iy;

	If(Not GetParm(1, sMask) or (sMask == ""))
		sMask = sFormatDate
	End;

	Macro —¨á«®ˆ§‘¨¬¢®«®¢( sSymb )
	 	iInd		= Index( sMask, sSymb);
		If(iInd == 0)
			SetParm( 1, Null );
			Return True
		End;
		iIndBegin	= iInd;
		iIndEnd		= iInd;
		While(iInd > 0)
			StrSet( sMask, iInd, StrFor(1) );
			iIndEnd	= iInd;
			iInd	= Index( sMask, sSymb);
			If(iInd - iIndEnd > 1)
				Return False
			End;
		End;
		iLen	= iIndEnd-iIndBegin+1;
		iNum	= SubStr(sDate, iIndBegin, iLen);
		If(sSymb == "Y")
			If(iLen < 4)
				DateSplit(Date,Null,Null,iY);
				iY	= String(iY);
				If	(iLen == 1)
					StrSet(iY,4,iNum);
				ElIf	(iLen == 2)
					If(Int(iNum) < 50)
						StrSet(iY,3,iNum);
					Else
						iY	= "19" + iNum;
					End;
				ElIf	(iLen == 3)
					If(Int(iNum) < 500)
						StrSet(iY,2,iNum);
					Else
						iY	= "1" + iNum;
					End;
				End;
				iNum = iY;
			End;
		End;
		iNum = Int(iNum);
		If(iNum == 0)
			Return False
		End;
		SetParm( 1, iNum );
		Return True
	End;

	If(	(sMask != "")
		and —¨á«®ˆ§‘¨¬¢®«®¢( "D", iDay )
		and —¨á«®ˆ§‘¨¬¢®«®¢( "M", iMonth )
		and —¨á«®ˆ§‘¨¬¢®«®¢( "Y", iYear ))
		Return Date(iDay,iMonth,iYear)
	Else
		Return Date(0,0,0)
	End;
End;
