/*
$Name: IbrFieldWeb.mac
$Module: Отчеты банка
$Description: Транспортный класс поля для веб-интефрейса
*/

macro cmpIbrAttr(v1, v2)
    if (v1.nameParameter < v2.nameParameter)
        return -1;
    elif (v1.nameParameter > v2.nameParameter)
        return 1;
    else
        return 0;
    end;
end;

/**
 * Класс поля
 * Транспортный класс, для веб-интефрейса
 */
class TIbrFieldWeb()

    /**
     * Идентификатор
     */
    var identifierField: Integer = 0;

    /**
     * Значение
     */
    var value: TIbrValueWeb = TIbrValueWeb();

    /**
     * Значение по умолчанию
     */
    var valueDefault: TIbrValueWeb = TIbrValueWeb();

    /**
     * Список атрибутов поля
     */
    var attributeList: TArray = TArray();

    /**
     * Наименование поля
     */
    var name: String = "";

    /**
     * Порядок сортировки
     */
    var sortWeight: Integer = 0;

    /**
     * Признак пользовательского поля
     */
    var isUser: Bool = FALSE;

    /**
     * Декорация (группа\вкладка)
     */
    var decoration: Object = NULL;

    /**
     * Заполнить занчениями из источника данных
     *
     * @dataSet Object Набор данных
     */
    macro initialize(dataSet: Object)

        if (isUser == NULL)

            throw_web(TIbrUndefinedValueException("TIbrFieldWeb::initialize", "dataSet"));

        end;

        execExp("TIbrField().initialize(this, dataSet)");

    end;

    /**
     * Установить порядок сортировки
     *
     * @param sortWeightParameter Integer Порядок сортировки
     *
     * @return True, если порядок сортировки изменён успешно, иначе - False.
     */
    macro setSortWeight(sortWeightParameter: Integer): Bool

        if (TIbrSystem.isNullOrEmpty(sortWeightParameter))

            throw_web(TIbrIncorrectParameterException("TIbrFieldWeb::setSortWeight"));

        end;

        return execExp("TIbrField().setSortWeight(this, sortWeightParameter)");

    end;

    /**
     * Удаление поля
     *
     * @return True, если поле удалена, иначе - False
     */
    macro delete(): Bool

        return execExp("TIbrField().delete(this)");

    end;

    macro toString()
        var s = "Field: "
                        + String(identifierField)
                + " - " + String(name)
                + " - " + String(sortWeight)
                + " - " + String(isUser)
                ;
        qsort(attributeList, "cmpIbrAttr");
        for (var d, attributeList)
            s = s + "\n" + String(d);
        end;
        return s;
    end;
end;
