/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank 5.0                                         R-Style Software Lab

  File Name   : pr_docp.mac                                December 7,1998
  Programmer  : LCh
  Description : ‘¯à ¢ª  ® ¯à®¢¥¤¥­­ëå ¤®ªã¬¥­â å
  Comment     :
  Modifications:
       14.11.2000 Kasatsky - “¢¥«¨ç¥­® ¯®«¥ ¢ë¢®¤  ¤«ï ­®¬¥à  ¯ çª¨ ¤® 5 á¨¬¢®«®¢
       26.04.2012 SCR 169514 - ˆá¯à ¢«¥­ë ®è¨¡ª¨ ¢ ¯¥ç â­®© ä®à¬¥

ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
import RsbDataset;

import BankInter;
import FiInter;
import Reporting;
import ofstream;
import cb_sql;
import rep_lib;
import testLib;

private const ALLCURRENCY = -2;
private const AKMULTYCARRY = 15;

private const tempProtocolTableName = "drepdocer_tmp";
private var tempInserter;

private const useProtocol = true;

    var reportBodyFileName;

private MACRO B2I(val)
  if (val == true)
    return 1;
  else
    return 0;
  end;
END;

/**
 * «¥¬¥­â ª¥è 
 * @author ABP
 * @since v.6.00.020.29
 */
private class TFinancialInstrumentCachedDataElement(_fiId : Integer, _fiCode : String)
    var fiId : Integer = _fiId;
    var fiCode : String = _fiCode;
end;

/**
 * Š¥è¨àãîé¨© ˆ„ ä¨­. ¨­áâàã¬¥­â®¢
 * @author ABP
 * @since v.6.00.020.29
 */
private class TFinancialInstrumentCachedData()

    private var m_cache : Object;

    private macro add(fiId : Integer) : Object
        var finInstr = TBFile("fininstr");
        finInstr.rec.fiId = fiId;
        if (finInstr.getEQ())
            m_cache[fiId] = TFinancialInstrumentCachedDataElement(fiId, finInstr.rec.fi_code);
            return m_cache[fiId];
        else
            return null;
        end;
    end;

    /**
     * ®«ãç¨âì í«¥¬¥­â ª¥è 
     * @param fiId ˆ¤¥­â¨ä¨ª â®à ä¨­. ¨­áâàã¬¥­â 
     * @return ®¡ê¥ªâ ª« áá  TFinancialInstrumentCachedDataElement ¨«¨ null
     */
    macro get(fiId : Integer) : Object
        var result = m_cache[fiId];
        if (result == null)
            return add(fiId);
        else
            return result;
        end;
    end;

    /**
     * ®«ãç¨âì ª®¤ ä¨­. ¨­áâàã¬¥­â 
     * @param fiId ˆ¤¥­â¨ä¨ª â®à ä¨­. ¨­áâàã¬¥­â 
     * @return ª®¤ ä¨­. ¨­áâàã¬¥­â 
     */
    macro getFiCode(fiId : Integer) : String
        return get(fiId).fiCode;
    end;

    private macro constructorTFinancialInstrumentCachedData()
        m_cache = TArray();
    end;

    constructorTFinancialInstrumentCachedData();

end;

private var m_financialInstrumentCachedData = TFinancialInstrumentCachedData();

/* à ¬¥âàë ¤«ï á®§¤ ­¨ï ®âç¥â , ¯®«ãç¥­­ë¥ ¨§ ¯ ­¥«¨*/
CLASS TReportParameters(departmentCode,
                         orgStructure,
                            issueMode,
                        chapterNumber,
                                 plan,
                         currencyCode,
                  periodBeginningDate,
                     periodEndingDate,
                       needGroupSplit,
                           operNumber,
                           packNumber,
                          sortingKind,
                         needPackItog,
                        needOperSplit,
       needNationalCurrencyEquivalent,
                 needEveryDayPrinting,
                         paymentsData,
                     needApostrophies,
                 needExchangeRateDiff)

    var m_departmentCode                 = departmentCode;
    var m_orgStructure                   = orgStructure;
    var m_issueMode                      = issueMode;
    var m_chapterNumber                  = chapterNumber;
    var m_plan                           = plan;
    var m_currencyCode                   = currencyCode;
    var m_periodBeginningDate            = periodBeginningDate;
    var m_periodEndingDate               = periodEndingDate;
    var m_operNumber                     = operNumber;
    var m_packNumber                     = packNumber;
    var m_sortingKind:TArray             = sortingKind;
    var m_needPackItog                   = needPackItog;
    var m_needNationalCurrencyEquivalent = needNationalCurrencyEquivalent;
    var m_needEveryDayPrinting           = needEveryDayPrinting;
    var m_paymentsData                   = paymentsData;
    var m_needApostrophies               = needApostrophies;
    var m_needOperSplit                  = needOperSplit;
    var m_needGroupSplit                 = needGroupSplit;
    var m_needExchangeRateDiff           = needExchangeRateDiff;

    var m_departmentList   = RepDepartmentList(m_orgStructure, m_issueMode, m_departmentCode);
    /*¤«ï áç¥â®¢ ‚*/
    var m_ocpAccountServer = RepOcpAccountServer(m_chapterNumber, ALLFININSTR, m_departmentList);
    /*¯à¨¢¨«¥£¨ï 073*/
    var m_accountFilter    = RepAccountFilter(m_departmentList, PRIV_GET_ACCOUNT_DATA_FOR_REPORTS); /*„«ï ä¨«ìâà  ¯® ’‘/‘*/
    /*¯à¨¢¨«¥£¨ï 008*/
    var m_documentFilter   = RepDocumentFilter(m_departmentList);

END; /*class TReportParameters*/

/*€£à¥£¨àãîé¨¥ ¤ ­­ë¥ ®âç¥â */
CLASS TReportAggregates (operCode,
                       packNumber,
                     currencyCode,
            packNumberOfDocuments,
                         packSumm,
                 packCoveringSumm,
            operNumberOfDocuments,
                         operSumm,
                 operCoveringSumm,
        currencyNumberOfDocuments,
                     currencySumm,
             currencyCoveringSumm,
     documentsNumberInOneCurrency,
 operDocumentsNumberInOneCurrency,
           finalNumberOfDocuments,
              finalEquivalentSumm,
    operCoveringSummInOneCurrency)

    var m_operCode                         = operCode;                 /*ª®¤ ®¯¥à */
    var m_packNumber                       = packNumber;               /*­®¬¥à ¯ çª¨*/
    var m_currencyCode                     = currencyCode;             /*ª®¤ ¢ «îâë*/
    var m_packNumberOfDocuments            = packNumberOfDocuments;    /*ç¨á«® ¤®ªã¬¥­â®¢ ¢ ¯ çª¥*/
    var m_packSumm                         = packSumm;                 /*áã¬¬  ¤®ªã¬¥­â®¢ ¢ ¯ çª¥*/
    var m_packCoveringSumm                 = packCoveringSumm;         /*áã¬¬  ¯®ªàëâ¨ï ¤®ªã¬¥­â®¢ ¢ ¯ çª¥*/
    var m_operNumberOfDocuments            = operNumberOfDocuments;    /*ç¨á«® ¤®ªã¬¥­â®¢ ¯® ®¯¥à æ¨®­¨áâã*/
    var m_operSumm                         = operSumm;                 /*áã¬¬  ¤®ªã¬¥­â®¢ ¯® ®¯¥à æ¨®­¨áâã*/
    var m_operCoveringSumm                 = operCoveringSumm;         /*áã¬¬  ¯®ªàëâ¨ï ¤®ªã¬¥­â®¢ ¯® ®¯¥à æ¨®­¨áâã*/
    var m_currencyNumberOfDocuments        = currencyNumberOfDocuments;/*ç¨á«® ¤®ªã¬¥­â®¢ ¯® ¢ «îâ¥*/
    var m_currencySumm                     = currencySumm;             /*áã¬¬  ¤®ªã¬¥­â®¢ ¯® ¢ «îâ¥*/
    var m_currencyCoveringSumm             = currencyCoveringSumm;     /*áã¬¬  ¯®ªàëâ¨ï ¤®ªã¬¥­â®¢ ¯® ¢ «îâ¥*/
    var m_documentsNumberInOneCurrency     = documentsNumberInOneCurrency; /*ª®«¨ç¥áâ¢® ¤®ªã¬¥­â®¢ ¢ ¯ çª¥ ¯® ®¤­®© ¢ «îâ¥*/
    var m_operDocumentsNumberInOneCurrency = operDocumentsNumberInOneCurrency; /*ª®«¨ç¥áâ¢® ¤®ªã¬¥­â®¢ ®¯¥à  ¯® ®¤­®© ¢ «îâ¥*/
    var m_finalNumberOfDocuments           = finalNumberOfDocuments; /*®¡é¥¥ ª®«¨ç¥áâ¢® ¤®ªã¬¥­â®¢*/
    var m_finalEquivalentSumm              = finalEquivalentSumm;    /*®¡é ï áã¬¬  ¯®ªàëâ¨ï*/
    var m_operCoveringSummInOneCurrency    = operCoveringSummInOneCurrency; /*áã¬¬  ¯®ªàëâ¨ï ¯® ®¤­®© ¢ «îâ¥ ®¤­®£® ®¯¥à */
END;

/*€£à¥£¨àãîé¨¥ ¤ ­­ë¥ ®âç¥â  ¯® ®¤­®© ¢ «îâ¥ ¢ ¯ çª¥*/
CLASS TOneCurrencyAggregatesInPack(currencyCode,
                              numberOfDocuments,
                                debitSummInPack,
                               creditSummInPack,
                           equivalentSummInPack)

    var m_codeCurrency         = currencyCode;               /*ª®¤ ¢ «îâë*/
    var m_numberOfDocuments    = numberOfDocuments;          /*ª®«¨ç¥áâ¢® ¤®ªã¬¥­â®¢ ¯® ®¤­®© ¢ «îâ¥ ¢ ¯ çª¥*/
    var m_debitSumm            = debitSummInPack;            /*áã¬¬  ¤¥¡¥â  ¢ ¯ çª¥ ¯® íâ®© ¢ «îâ¥*/
    var m_creditSumm           = creditSummInPack;           /*áã¬¬  ªà¥¤¨â  ¢ ¯ çª¥ ¯® íâ®© ¢ «îâ¥*/
    var m_equivalentSumm       = equivalentSummInPack;
END;

/*€£à¥£¨àãîé¨¥ ¤ ­­ë¥ ®âç¥â  ¯® ®¤­®© ¢ «îâ¥ ®¤­®£® ®¯¥à */
CLASS TOneCurrencyAggregatesByOper(currencyCode,
                              numberOfDocuments,
                                debitSummByOper,
                               creditSummByOper,
                           equivalentSummByOper)

    var m_codeCurrency         = currencyCode;               /*ª®¤ ¢ «îâë*/
    var m_numberOfDocuments    = numberOfDocuments;          /*ª®«¨ç¥áâ¢® ¤®ªã¬¥­â®¢ ¯® ®¤­®© ¢ «îâ¥*/
    var m_debitSumm            = debitSummByOper;            /*áã¬¬  ¤¥¡¥â  ®¯¥à  ¯® íâ®© ¢ «îâ¥*/
    var m_creditSumm           = creditSummByOper;           /*áã¬¬  ªà¥¤¨â  ®¯¥à  ¯® íâ®© ¢ «îâ¥*/
    var m_equivalentSumm       = equivalentSummByOper; /*áã¬¬  ¯®ªàëâ¨ï ®¯¥à  ¯® íâ®© ¢ «îâ¥*/
END;

/*ˆâ®£®¢ë¥  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ®âç¥â  ¯® ®¤­®© ¢ «îâ¥*/
CLASS TFinalOneCurrencyAggregates(currencyCode,
                                debitFinalSumm,
                               creditFinalSumm,
                           equivalentFinalSumm)

    var m_codeCurrency         = currencyCode;               /*ª®¤ ¢ «îâë*/
    var m_debitSumm            = debitFinalSumm;             /*áã¬¬  ¤¥¡¥â  ¯® ¢ «îâ¥*/
    var m_creditSumm           = creditFinalSumm;            /*áã¬¬  ªà¥¤¨â  ¯® ¢ «îâ¥*/
    var m_equivalentSumm       = equivalentFinalSumm;  /*áã¬¬  ªà¥¤¨â  ®¯¥à  ¯® ¢ «îâ¥*/
END;

class TPair(_oper, _pack)
    var oper = _oper;
    var pack = _pack;
end;

CLASS TGroupOfOpersAndPacks()

    var oper     : Object;
    var operpack : Object;
    var i;

    macro addPair(_oper, _pack)
        operpack[operpack.size] = TPair(_oper, _pack);
    end;

    macro addSingle(_oper)
        oper[oper.size] = _oper;
    end;

    macro haveSingle(_oper)
        i = 0;
        while (i < oper.size)
            if (oper[i] == _oper)
                return true;
            end;
            i = i + 1;
        end;
        return false;
    end;

    macro havePair(_oper, _pack)
        i = 0;
        while (i < operpack.size)
            if ((operpack[i].oper == _oper) AND (operpack[i].pack == _pack))
                return true;
            end;
            i = i + 1;
        end;
        return false;
    end;

    macro clear()
        i = 0;
        while (i < oper.size)
            oper[i] = -1;
            i = i + 1;
        end;
        while (i < operpack.size)
            operpack[i].oper = -1;
            operpack[i].pack = -1;
            i = i + 1;
        end;
        oper.size = 0;
        operpack.size = 0;
    end;

    macro constructorTGroupOfOpersAndPacks()
        oper     = TArray();
        operpack = TArray();
    end;

    constructorTGroupOfOpersAndPacks();
end;

/**
 * ¯â¨¬¨§¨à®¢ ­­®¥ åà ­¨«¨é¥ ®¡à ¡®â ­­ëå ­®¬¥à®¢ ®¯¥à æ¨®­¨áâ®¢ ¨ ­®¬¥à®¢ ¯ ç¥ª ¤®ªã¬¥­â®¢
 * @author ABP
 * @since v.6.00.020.29
 */
private class (TGroupOfOpersAndPacks) TGroupOfOpersAndPacksOptimized()

    /**
     * „®¡ ¢¨âì ¢ åà ­¨«¨é¥ ¯ àã "­®¬¥à ®¯¥à æ¨®­¨áâ  - ­®¬¥à ¯ çª¨"
     * @param _oper ­®¬¥à ®¯¥à æ¨®­¨áâ 
     * @param _pack ­®¬¥à ¯ çª¨
     */
    macro addPair(_oper : Integer, _pack : Integer)
        operPack[_oper] = TArray();
        operPack[_oper][_pack] = 1;
    end;

    /**
     * à®¢¥à¨âì ­ «¨ç¨¥ ¯ àë "­®¬¥à  ®¯¥à æ¨®­¨áâ  - ­®¬¥à ¯ çª¨"
     * @param _oper ­®¬¥à ®¯¥à æ¨®­¨áâ 
     * @param _pack ­®¬¥à ¯ çª¨
     * @return ¯à¨§­ ª ­ «¨ç¨ï ¢ åà ­¨«¨é¥ § ¤ ­­®© ¯ àë "­®¬¥à  ®¯¥à æ¨®­¨áâ  - ­®¬¥à ¯ çª¨" (false ¨«¨ true)
     */
    macro havePair(_oper : Integer, _pack : Integer) : Bool
        return ((operPack[_oper] != null) and (operPack[_oper][_pack] != null));
    end;

    /**
     * „®¡ ¢¨âì ¢ åà ­¨«¨é¥ ­®¬¥à ®¯¥à æ¨®­¨áâ 
     * @param _oper ­®¬¥à ®¯¥à æ¨®­¨áâ 
     */
    macro addSingle(_oper : Integer)
        oper[_oper] = _oper;
    end;

    /**
     * à®¢¥à¨âì ­ «¨ç¨¥ ­®¬¥à  ®¯¥à æ¨®­¨áâ 
     * @param _oper ­®¬¥à ®¯¥à æ¨®­¨áâ 
     * @return ¯à¨§­ ª ­ «¨ç¨ï ¢ åà ­¨«¨é¥ § ¤ ­­®£® ­®¬¥à  ®¯¥à æ¨®­¨áâ  (false ¨«¨ true)
     */
    macro haveSingle(_oper : Integer) : Bool
        return (oper[_oper] != null);
    end;

    /**
     * ç¨áâª  åà ­¨«¨é 
     */
    macro clear()
        oper.size = 0;
        operPack.size = 0;
    end;

    private macro constructorTGroupOfOpersAndPacksOptimized()
        initTGroupOfOpersAndPacks();
    end;

    constructorTGroupOfOpersAndPacksOptimized();

end;

/*à®æ¥¤ãà  ¤®¡ ¢«ï¥â § ¯¨áì ¢® ¢à¥¬¥­­ãî â ¡«¨æã á ¤ ­­ë¬¨ ¤«ï ¯à®â®ª®« */
MACRO addRecordToProtocol(dataRecord, errorCode)
/*    tempInserter.Update();*/
    tempInserter.AddNew();
    tempInserter.t_applicationkey   = dataRecord.accTrnId;
    tempInserter.t_error_code       = errorCode;                         /* ‘¥£¬¥­â ã­¨ª «ì­®£® ¨­¤¥ªá  */
    tempInserter.t_date_carry       = dataRecord.docdate_carry;
    tempInserter.t_document_number  = dataRecord.docnumb_document;
    tempInserter.t_payment_id       = dataRecord.paymentIdNotNull;
    tempInserter.t_currency_code    = dataRecord.doccode_currency;
    tempInserter.t_payer_account    = dataRecord.docaccount_payer;
    tempInserter.t_receiver_account = dataRecord.docaccount_receiver;
    tempInserter.t_document_summ    = dataRecord.docsum;

    tempInserter.Update();
    OnError(err);
        tempInserter.CancelEdit();

END;

/*à®æ¥¤ãà  § ¯®«­ï¥â á¯¨á®ª ä¨­.¨­áâàã¬¥­â®¢ ¨ ª®«¨ç¥áâ¢® ä¨­.¨­áâàã¬¥­â®¢*/
MACRO getCurrencyList(currencyList:TArray):TArray
    var queryText = "";
    var data;
    var i;

    queryText = "SELECT t_fiId"
       + "\n" + "  FROM dfininstr_dbt"
       + "\n" + " WHERE t_fi_kind IN (" + FIKIND_CURRENCY + ", " + FIKIND_METAL + ")"
       + "\n" + " ORDER BY t_fi_code";

    data = TRsbDataset(queryText);
    while (data.next())
        currencyList[currencyList.size] = data.fiId;
    end;

    return currencyList;
END;

/*®«ãç¥­¨¥ ­®¬¥à  ¨ ­ ¨¬¥­®¢ ­¨¥ ¢ «îâë ¯® ª®¤ã.  ¯à¨¬¥à, ¤®«« à ‘˜€: ª®¤ 5, ­®¬¥à 840*/
MACRO getCurrencyNumber(currencyCode, numberOfCurrency)
    setparm (1, m_financialInstrumentCachedData.getFiCode(currencyCode));
END;

/*¥ç âì "§ £®«®¢ª " (¢á¥, çâ® ¤® â ¡«¨æë)*/
MACRO printHeader(chapterNumber, beginningDate, endingDate, reportDate, width, shift, isPeriod)
    var dateOfReport;
    var timeOfReport;

    var dateOfBeginningDate;
    var timeOfBeginningDate;

    var dateOfEndingDate;
    var timeOfEndingDate;

    printLn();
    println(mkStr(" ", shift) + StrAlign("‘€‚Š€  ‚…„…›• „Š“Œ…’€•", width, STR_ALIGN_CENTER));
    println(mkStr(" ", shift) + StrAlign("¯® £« ¢¥ " +  §¢ ­¨¥ƒ« ¢ë(chapterNumber), width, STR_ALIGN_CENTER));
    if (isPeriod)
        /*…á«¨ ¤ âë ­ ç «  ¨ ª®­æ  ¯¥à¨®¤  á®¢¯ ¤ îâ, â® ¯¥ç â ¥¬ ª ª ­  ¤ âã*/
        if (beginningDate != endingDate)
            dtTmSplit (beginningDate, dateOfBeginningDate, timeOfBeginningDate);
            dtTmSplit (endingDate, dateOfEndingDate, timeOfEndingDate);
            printLn(mkStr(" ", shift) + StrAlign(string("§  ¯¥à¨®¤ á ",string(dateOfBeginningDate:f)," ¯® ",string(dateOfEndingDate:f)), width, STR_ALIGN_CENTER));
        elif (beginningDate == endingDate)
            dtTmSplit (beginningDate, dateOfReport, timeOfReport);
            printLn(mkStr(" ", shift) + StrAlign(string("§  ",string(dateOfReport:f)), width, STR_ALIGN_CENTER));
        end;
    else
        dtTmSplit (reportDate, dateOfReport, timeOfReport);
        printLn(mkStr(" ", shift) + StrAlign(string("§  ",string(dateOfReport:f)), width, STR_ALIGN_CENTER));
    end;
END;

/*¥ç âì è ¯ª¨ â ¡«¨æë*/
MACRO printTableHeader(isForeignCurrency, isNationalEquivalent, needOperSplit)
    if (isForeignCurrency)
        if (isNationalEquivalent)
            if (needOperSplit)
                [ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                 ³    ®¬¥à      ³    „ â   ³ Š®¤  ³      ˆŠ       ³          „¥¡¥â          ³         Šà¥¤¨â          ³      ‘ã¬¬  ¤¥¡¥â        ³      ‘ã¬¬  ªà¥¤¨â       ³       ª¢¨¢ «¥­â        ³
                 ³  ¤®ªã¬¥­â     ³ ¤®ªã¬¥­â ³¢ «îâë³                ³                         ³                         ³        ¢ ¢ «îâ¥         ³        ¢ ¢ «îâ¥         ³      ¢ ­ æ. ¢ «îâ¥      ³
                 ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                ];
            else
                [ÚÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                 ³  ®¬¥à  ³    ®¬¥à      ³    „ â   ³ Š®¤  ³      ˆŠ       ³          „¥¡¥â          ³         Šà¥¤¨â          ³      ‘ã¬¬  ¤¥¡¥â        ³      ‘ã¬¬  ªà¥¤¨â       ³        ª¢¨¢ «¥­â       ³
                 ³®¯¥à æ¨®-³  ¤®ªã¬¥­â     ³ ¤®ªã¬¥­â ³¢ «îâë³                ³                         ³                         ³        ¢ ¢ «îâ¥         ³        ¢ ¢ «îâ¥         ³       ¢ ­ æ. ¢ «îâ¥     ³
                 ³  ­¨áâ   ³               ³          ³      ³                ³                         ³                         ³                         ³                         ³                         ³
                 ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                ];
            end;
        else
            if (needOperSplit)
                [ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                 ³    ®¬¥à      ³    „ â   ³ Š®¤  ³      ˆŠ       ³          „¥¡¥â          ³         Šà¥¤¨â          ³      ‘ã¬¬  ¤¥¡¥â        ³      ‘ã¬¬  ªà¥¤¨â       ³
                 ³  ¤®ªã¬¥­â     ³ ¤®ªã¬¥­â ³¢ «îâë³                ³                         ³                         ³                         ³                         ³
                 ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                ];
            else
                [ÚÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                 ³  ®¬¥à  ³    ®¬¥à      ³    „ â   ³ Š®¤  ³      ˆŠ       ³          „¥¡¥â          ³         Šà¥¤¨â          ³      ‘ã¬¬  ¤¥¡¥â        ³      ‘ã¬¬  ªà¥¤¨â       ³
                 ³®¯¥à æ¨®-³  ¤®ªã¬¥­â     ³ ¤®ªã¬¥­â ³¢ «îâë³                ³                         ³                         ³                         ³                         ³
                 ³  ­¨áâ   ³               ³          ³      ³                ³                         ³                         ³                         ³                         ³
                 ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                ];
            end;
        end;
    else
        if (needOperSplit)
            [ÚÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
             ³®¬¥à³    „ â   ³  ³               „¥¡¥â               ³              Šà¥¤¨â               ³        ‘ã¬¬        ³
             ³¤®ªã-³ ¤®ªã¬¥­â ³‚ÃÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´                    ³
             ³¬¥­â ³          ³  ³   ˆŠ   ³           ‘ç¥â          ³   ˆŠ   ³          ‘ç¥â           ³                    ³
             ÃÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
            ];
        else
            [ÚÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
             ³  ®¬¥à  ³®¬¥à³    „ â   ³  ³               „¥¡¥â               ³              Šà¥¤¨â               ³        ‘ã¬¬        ³
             ³®¯¥à æ¨®-³¤®ªã-³ ¤®ªã¬¥­â ³‚ÃÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´                    ³
             ³  ­¨áâ   ³¬¥­â ³          ³  ³   ˆŠ   ³           ‘ç¥â          ³   ˆŠ   ³          ‘ç¥â           ³                    ³
             ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
            ];
        end;
    end;
END;

/*¥ç âì § £®«®¢ª  ¯ çª¨*/
MACRO printNewPack(packNumber)
    [ çª  ü #####](packNumber);
END;

/*¥ç âì § £®«®¢ª  ®¯¥à */
MACRO printNewOper( operNumber)
    [¯¥à æ¨®­¨áâ ü #####](operNumber);
END;

/*¥ç âì § £®«®¢ª  £àã¯¯ë ®¯¥à æ¨®­¨áâ®¢*/
MACRO printNewGroup( groupNumber)
    println();
    if (groupNumber == -1)
        [¯¥à æ¨®­¨áâë, ­¥ ¢å®¤ïé¨¥ ­¨ ¢ ®¤­ã £àã¯¯ã];
    else
        [ƒàã¯¯  ®¯¥à æ¨®­¨áâ®¢ ü ##########](string(groupNumber:10:0:l));
    end;
END;

/*¥ç âì ¨â®£  ¯® ¯ çª¥*/
MACRO printPackResult(numberOfDocumentsInPack, summInPack, needApostrophiesInSumm, needOperSplit)
    var printableSummInPack;

    if (needApostrophiesInSumm)
        printableSummInPack = string(summInPack:a);
    else
        printableSummInPack = string(summInPack);
    end;

    if (needOperSplit)
        [ÃÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
         ³         „®ªã¬¥­â®¢ ¢ ¯ çª¥: #####                               ˆâ®£® ¯® ¯ çª¥:            ####################³
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
        ](numberOfDocumentsInPack, printableSummInPack:r);
    else
        [ÃÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
         ³         „®ªã¬¥­â®¢ ¢ ¯ çª¥: #####                                        ˆâ®£® ¯® ¯ çª¥:            ####################³
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
        ](numberOfDocumentsInPack, printableSummInPack:r);
    end;
END;

/*¥ç âì à¥§ã«ìâ â®¢ ¯® ¯ çª¥ ¢ ¢ «îâ­®¬ ®âç¥â¥*/
MACRO printPackResultInForeignReport(numberOfDocumentsInPack, equivalentSumm, isEquivalent, needApostrophiesInSumm, needOperSplit)
    var printableEquivalent;

    if (needApostrophiesInSumm)
        printableEquivalent = ternary(equivalentSumm == 0, "", string(equivalentSumm : a));
    else
        printableEquivalent = ternary(equivalentSumm == 0, "", string(equivalentSumm));
    end;

    if (isEquivalent)
        if (needOperSplit)
            [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
              „®ªã¬¥­â®¢ ¢ ¯ çª¥:                                ########                         ˆâ®£® ¯® ¯ çª¥:                                                        #########################
            ](numberOfDocumentsInPack, printableEquivalent:r);
        else
            [ÀÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
              „®ªã¬¥­â®¢ ¢ ¯ çª¥:                                         ########                         ˆâ®£® ¯® ¯ çª¥:                                                        #########################
            ](numberOfDocumentsInPack, printableEquivalent:r);
        end;
    else
        if (needOperSplit)
            [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
              „®ªã¬¥­â®¢ ¢ ¯ çª¥:                                ########                         ˆâ®£® ¯® ¯ çª¥:
            ](numberOfDocumentsInPack);
        else
            [ÀÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
              „®ªã¬¥­â®¢ ¢ ¯ çª¥:                                         ########                         ˆâ®£® ¯® ¯ çª¥:
            ](numberOfDocumentsInPack);
        end;
    end;
END;

/*¥ç âì à¥§ã«ìâ â®¢ ¯® ®¯¥àã ¢ ¢ «îâ­®¬ ®âç¥â¥*/
MACRO printOperResultInForeignReport(numberOfOperDocuments,
                                             equivalentSumm,
                                               isEquivalent,
                                                     isPack,
                                     needApostrophiesInSumm,
                                              needOperSplit)
    var printableEquivalent;

    if (isPack == FALSE)
          if (isEquivalent)
              if (needOperSplit)
                  [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
              else
                  [ÃÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
              end;
          else
              if (needOperSplit)
                  [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
              else
                  [ÃÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
              end;
          end;
    end;

    if (needApostrophiesInSumm)
        printableEquivalent = ternary(equivalentSumm == 0, "", string(equivalentSumm : 0 : 2 : a));
    else
        printableEquivalent = ternary(equivalentSumm == 0, "", string(equivalentSumm : 0 : 2));
    end;

    if (isEquivalent)
        if (needOperSplit)
            [
              „®ªã¬¥­â®¢ ã ®¯¥à æ¨®­¨áâ :    ########                          ˆâ®£® ¯® ®¯¥à æ¨®­¨áâã:                                                                   #########################
            ](numberOfOperDocuments, printableEquivalent:r);
        else
            [³„®ªã¬¥­â®¢ ã ®¯¥à æ¨®­¨áâ :              ########                          ˆâ®£® ¯® ®¯¥à æ¨®­¨áâã:                                                                   #########################³
            ](numberOfOperDocuments, printableEquivalent:r);
        end;
    else
        if (needOperSplit)
            [
              „®ªã¬¥­â®¢ ã ®¯¥à æ¨®­¨áâ :             ########                 ˆâ®£® ¯® ®¯¥à æ¨®­¨áâã:
            ](numberOfOperDocuments);
        else
            [³„®ªã¬¥­â®¢ ã ®¯¥à æ¨®­¨áâ :             ########                 ˆâ®£® ¯® ®¯¥à æ¨®­¨áâã:                                                                            ³
            ](numberOfOperDocuments);
        end;
    end;
END;

MACRO printFinalResultInForeignReport(numberOfDocuments,
                                         equivalentSumm,
                                           isEquivalent,
                                 needApostrophiesInSumm,
                                          needOperSplit)
    var printableEquivalent;

    if (needApostrophiesInSumm)
        printableEquivalent = ternary(equivalentSumm == 0, "", string(equivalentSumm : a));
    else
        printableEquivalent = ternary(equivalentSumm == 0, "", string(equivalentSumm));
    end;

    if (isEquivalent)
        if (needOperSplit)
            [
              ‚á¥£® ¤®ªã¬¥­â®¢:                       ########                                  ˆ’ƒ:                                                                   #########################
            ](numberOfDocuments, printableEquivalent:r);
        else
            [
              ‚á¥£® ¤®ªã¬¥­â®¢:                        ########                                           ˆ’ƒ:                                                                   #########################
            ](numberOfDocuments, printableEquivalent:r);
        end;
    else
        [
          ‚á¥£® ¤®ªã¬¥­â®¢:                       ########                                  ˆ’ƒ:
        ](numberOfDocuments);
    end;
END;

/*¥ç âì  £à¥£¨àãîé¨å ¤ ­­ëå ¢ à §à¥§¥ ¢ «îâ*/
MACRO printAggregatesByCurrencies(listOfAggregates:TArray, isEquivalent, needApostrophiesInSumm, needOperSplit, isFinal)
    var currencyCode;
    var i = 0;

    var debitSumm;
    var creditSumm;
    var equivalent;

    var border;

    if (isFinal)
        border = " ";
    else
        border = "³";
    end;

    while (i < listOfAggregates.size)
        getCurrencyNumber(listOfAggregates[i].m_codeCurrency, currencyCode);
        /*¥ç â ¥¬ ¥á«¨ ¥áâì å®âï ¡ë ®¤­® ¨§ ¤ ­­ëå, ¨­ ç¥ ¢ «îâã ¯à®¯ãáª ¥¬*/
        if ((listOfAggregates[i].m_debitSumm      != 0) or
            (listOfAggregates[i].m_creditSumm     != 0) or
            (listOfAggregates[i].m_equivalentSumm != 0)
            )

            debitSumm = ternary(listOfAggregates[i].m_debitSumm != 0, money(listOfAggregates[i].m_debitSumm), "");
            creditSumm = ternary(listOfAggregates[i].m_creditSumm != 0, money(listOfAggregates[i].m_creditSumm), "");;

            equivalent = ternary(listOfAggregates[i].m_equivalentSumm != 0, money(listOfAggregates[i].m_equivalentSumm), "");

            if (needApostrophiesInSumm)
                debitSumm = string(debitSumm : 0 : 2 : a);
                creditSumm = string(creditSumm : 0 : 2 : a);
                equivalent = string(equivalent : 0 : 2 : a);
            else
                debitSumm = string(debitSumm : 0 : 2);
                creditSumm = string(creditSumm : 0 : 2);
                equivalent = string(equivalent : 0 : 2);
            end;

            if (isEquivalent)
                if (needOperSplit)
                    [              ¯® ¢ «îâ¥ ###:                                                                            ######################### ######################### #########################
                    ](currencyCode, debitSumm:r,
                                   creditSumm:r, equivalent:r);
                else
                    equivalent = equivalent + border;
                    [#             ¯® ¢ «îâ¥ ###:                                                                                      ######################### ######################### ##########################
                    ](border,
                      currencyCode, debitSumm:r,
                                   creditSumm:r, equivalent:r);
                end;
            else
                if (needOperSplit)
                    [              ¯® ¢ «îâ¥ ###:                                                                            ######################### #########################
                    ](currencyCode, debitSumm:r, creditSumm:r);
                else
                    creditSumm = creditSumm + border;
                    [#             ¯® ¢ «îâ¥ ###:                                                                                      ######################### ##########################
                    ](border,
                      currencyCode, debitSumm:r, creditSumm:r);
                end;
            end;
        end;
        i = i + 1;
    end;
END;

/*¥ç âì ¨â®£  ¯® ®¯¥àã*/
MACRO printOperResult(operNumberOfDocumets, operSumm, needPackSort, needApostrophiesInSumm, needOperSplit)
    var printableOperSumm;

    if (needPackSort)
        [ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
    else
        if (needOperSplit)
            [ÃÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        else
            [ÃÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];

        end;
    end;

    if (needApostrophiesInSumm)
        printableOperSumm = string(operSumm:a);
    else
        printableOperSumm = string(operSumm);
    end;

    if (needOperSplit or needPackSort)
        [³ „®ªã¬¥­â®¢ ã ®¯¥à æ¨®­¨áâ : #####                       ˆâ®£® ¯® ®¯¥à æ¨®­¨áâã:            ####################³
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
        ](operNumberOfDocumets, printableOperSumm:r);
    else
        [³ „®ªã¬¥­â®¢ ã ®¯¥à æ¨®­¨áâ : #####                                 ˆâ®£® ¯® ®¯¥à æ¨®­¨áâã:            ####################³
        ](operNumberOfDocumets, printableOperSumm:r);
    end;
END;

/*¥ç âì à §¤¥«¨â¥«ì­®© «¨­¨¨ ¯®¤ ¨â®£ ¬¨ ®¯¥à  ¢ à¥¦¨¬¥ ¡¥§ à §¡¨¢ª¨ ¯® ®¯¥à ¬*/
MACRO printOperResultBackLine(isLastOper)
    if (isLastOper)
        [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
    else
        [ÃÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
    end;
END;

MACRO printOperForeignResultBackLine(isLastOper, needNationalCurrencyEquivalent)
    if (isLastOper)
        if (needNationalCurrencyEquivalent)
            [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
        else
            [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
        end;
    else
        if (needNationalCurrencyEquivalent)
            [ÃÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        else
            [ÃÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        end;
    end;
END;

MACRO printSignatures ()
    printLn();
    printLn({Name_Book}," ___________ ",{FIO_Book});
    printLn();
END;

/*¥ç âì ®¤­®© § ¯¨á¨ ¢ â ¡«¨æã ®âç¥â */
MACRO printOneNationalDocument(dataString, needApostrophiesInSumm, needOperSplit)
    var documentOper;
    var documentNumber;
    var operationKind;
    var payerBankCode;
    var payerAccount;
    var receiverBankCode;
    var receiverAccount;
    var documentSumm;
    var printableDocumentSum;
    var documentDate;

    documentOper     = dataString.docoper;
    documentNumber   = dataString.t_numb_document;
    documentDate     = dataString.t_date_document;
    operationKind    = dataString.t_shifr_Oper;
    payerBankCode    = dataString.PayerBankCodeNotNull;
    payerAccount     = dataString.t_payerAccount;
    receiverBankCode = dataString.ReceiverBankCodeNotNull;
    receiverAccount  = dataString.t_receiverAccount;
    documentSumm     = dataString.t_equivalentSumm;

    if (needApostrophiesInSumm)
        printableDocumentSum = string(documentSumm:a);
    else
        printableDocumentSum = string(documentSumm);
    end;

    if (needOperSplit)
        [³#####³##########³##³#########³#########################³#########³#########################³####################³
        ](documentNumber,
          documentDate:f,
          operationKind,
          payerBankCode,
          payerAccount,
          receiverBankCode,
          receiverAccount,
          printableDocumentSum:r);
    else
        [³#########³#####³##########³##³#########³#########################³#########³#########################³####################³
        ](documentOper,
          documentNumber,
          documentDate:f,
          operationKind,
          payerBankCode,
          payerAccount,
          receiverBankCode,
          receiverAccount,
          printableDocumentSum:r);
    end;
END;

/*¥ç âì ®¤­®© § ¯¨á¨ ¢ ¢ «îâ­®¬ ®âç¥â¥*/
MACRO printOneForeignCurrencyDocument(parametersF:TReportParameters,
                                                        dataStringF,
                                                         equivalent);

    var documentOper         = dataStringF.docoper;
    var documentNumber       = dataStringF.numb_Document;
    var documentDate         = dataStringF.date_document;
    var currencyCode;
    var receiverBankCode     = dataStringF.receiverBankCodeNotNull;
    var payerAccount         = dataStringF.payerAccount;
    var receiverAccount      = dataStringF.receiverAccount;
    var debitSumm            = dataStringF.payerAmount;
    var creditSumm           = dataStringF.receiverAmount;
    var equivalentSumm       = numeric(equivalent);

    getCurrencyNumber(dataStringF.payerFiid, currencyCode);

    if (not parametersF.m_needOperSplit)
        print("³" + string(documentOper:9:r));
    end;

    if (parametersF.m_needNationalCurrencyEquivalent)

        if (    (   (dataStringF.receiverFiId != NATCUR)
                 or (dataStringF.payerFiId != NATCUR)
                )
            and (not in(dataStringF.t_result_carry, DELTARATE, REGRESTOUTCARRY, DELTARATE_ADD, DELTARATE_MCD))
           )
            /*¬ã«ìâ¨¢ «îâ­ ï ¯à®¢®¤ª */
            if (parametersF.m_needApostrophies)
                [³###############³##########³ ###  ³################³#########################³#########################³#########################³#########################³#########################³
                ](documentNumber,
                  documentDate:f,
                  currencyCode,
                  receiverBankCode,
                  payerAccount,
                  receiverAccount,
                  debitSumm:r:a,
                  creditSumm:r:a,
                  equivalentSumm:r:a);
            else
                [³###############³##########³ ###  ³################³#########################³#########################³#########################³#########################³#########################³
                ](documentNumber,
                  documentDate:f,
                  currencyCode,
                  receiverBankCode,
                  payerAccount,
                  receiverAccount,
                  debitSumm:r,
                  creditSumm:r,
                  equivalentSumm:r);
            end;
        else
            if (parametersF.m_needApostrophies)
                [³###############³##########³ ###  ³################³#########################³#########################³#########################³                         ³#########################³
                ](documentNumber,
                  documentDate:f,
                  currencyCode,
                  receiverBankCode,
                  payerAccount,
                  receiverAccount,
                  debitSumm:r:a,
                  equivalentSumm:r:a);
            else
                [³###############³##########³ ###  ³################³#########################³#########################³#########################³                         ³#########################³
                ](documentNumber,
                  documentDate:f,
                  currencyCode,
                  receiverBankCode,
                  payerAccount,
                  receiverAccount,
                  debitSumm:r,
                  equivalentSumm:r);
            end;
        end;
    else
         /*¬ã«ìâ¨¢ «îâ­ ï ¯à®¢®¤ª */
        if (    (   (dataStringF.receiverFiId != NATCUR)
                 or (dataStringF.payerFiId != NATCUR)
                )
            and (not in(dataStringF.t_result_carry, DELTARATE, REGRESTOUTCARRY, DELTARATE_ADD, DELTARATE_MCD))
           )
            if (parametersF.m_needApostrophies)
                [³###############³##########³ ###  ³################³#########################³#########################³#########################³#########################³
                ](documentNumber,
                  documentDate:f,
                  currencyCode,
                  receiverBankCode,
                  payerAccount,
                  receiverAccount,
                  debitSumm:r:a,
                  creditSumm:r:a);
            else
                [³###############³##########³ ###  ³################³#########################³#########################³#########################³#########################³
                ](documentNumber,
                  documentDate:f,
                  currencyCode,
                  receiverBankCode,
                  payerAccount,
                  receiverAccount,
                  debitSumm:r,
                  creditSumm:r);
            end;
        else
            if (parametersF.m_needApostrophies)
                [³###############³##########³ ###  ³################³#########################³#########################³#########################³                         ³
                ](documentNumber,
                  documentDate:f,
                  currencyCode,
                  receiverBankCode,
                  payerAccount,
                  receiverAccount,
                  debitSumm:r:a);
            else
                [³###############³##########³ ###  ³################³#########################³#########################³#########################³                         ³
                ](documentNumber,
                  documentDate:f,
                  currencyCode,
                  receiverBankCode,
                  payerAccount,
                  receiverAccount,
                  debitSumm:r);
            end;
        end;
    end;
END;

MACRO printTableWithNationalResults(parametersOfReport:TReportParameters, aggregates:TArray, resultDate, chapter)
    var i = 0;
    var resultsListSize;

    MACRO printResultHeader(chapterNumber, dateForPrinting, needPackSort)
        var resultDate;
        var resultTime;
        var resultWidth;
        var resultShift = 0;

        if (needPackSort)
            resultWidth = 58;
        else
            resultWidth = 50;
        end;

        dtTmSplit (dateForPrinting, resultDate, resultTime);

        printLn();
        printLn();
        printLn(mkStr(" ",resultShift) + strAlign("‘€‚Š€  ‚…„…›• „Š“Œ…’€•",resultWidth, STR_ALIGN_CENTER));
        printLn(mkStr(" ",resultShift) + strAlign(string("¯® £« ¢¥ " +  §¢ ­¨¥ƒ« ¢ë(chapterNumber)), resultWidth, STR_ALIGN_CENTER));
        printLn(mkStr(" ",resultShift) + strAlign(string("§  " + string(resultDate:f)), resultWidth, STR_ALIGN_CENTER));
        if (needPackSort)
            [
             ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄ¿
             ³              ³       ³                    ³ Š®«¨ç¥áâ¢® ³
             ³ ¯¥à æ¨®­¨áâ ³  çª  ³      ‘ã¬¬          ³ ¤®ªã¬¥­â®¢ ³
             ³              ³       ³                    ³            ³
             ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´
            ];
        else
            [
             ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄ¿
             ³              ³                    ³ Š®«¨ç¥áâ¢® ³
             ³ ¯¥à æ¨®­¨áâ ³      ‘ã¬¬          ³ ¤®ªã¬¥­â®¢ ³
             ³              ³                    ³            ³
             ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´
            ];
      end;
    END;

    MACRO printPackString(aggregatesData:TReportAggregates)
       var operNumber              = aggregatesData.m_operCode;
       var packNumber              = aggregatesData.m_packNumber;
       var summInPack              = aggregatesData.m_packSumm;
       var numberOfDocumentsInPack = aggregatesData.m_packNumberOfDocuments;
        if (parametersOfReport.m_needApostrophies)
            [³      #####   ³ ##### ³####################³   #####    ³
            ](operNumber, packNumber, summInPack:r:a, numberOfDocumentsInPack);
        else
            [³      #####   ³ ##### ³####################³   #####    ³
            ](operNumber, packNumber, summInPack:r, numberOfDocumentsInPack);
        end;
    END;


    MACRO printOperString (aggregatesData:TReportAggregates, needPackSort)
        var operNumber            = aggregatesData.m_operCode;
        var operSumm              = aggregatesData.m_operSumm;
        var operNumberOfDocuments = aggregatesData.m_operNumberOfDocuments;

         if (needPackSort)
             if (parametersOfReport.m_needApostrophies)
                 [ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´];
                 [³    ¯¥à.       ##### ³####################³   #####    ³] (operNumber, operSumm:r:a, operNumberOfDocuments);
                 [ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´]
             else
                 [ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´];
                 [³    ¯¥à.       ##### ³####################³   #####    ³] (operNumber, operSumm:r, operNumberOfDocuments);
                 [ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´]
             end;
         else
             if (parametersOfReport.m_needApostrophies)
                 [³      #####   ³####################³   #####    ³] (operNumber, operSumm:r:a, operNumberOfDocuments);
             else
                 [³      #####   ³####################³   #####    ³] (operNumber, operSumm:r, operNumberOfDocuments);
             end;
         end;
    END;

    MACRO printFinalResult(aggregatesData:TReportAggregates, needPackSort)
          var finalSumm              = aggregatesData.m_currencySumm;
          var finalNumberOfDocuments = aggregatesData.m_currencyNumberOfDocuments;

          if (needPackSort)
             if (parametersOfReport.m_needApostrophies)
                 [³‚‘…ƒ:        ³       ³####################³   #####    ³
                  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÙ

                 ](finalSumm:r:a, finalNumberOfDocuments);
             else
                 [³‚‘…ƒ:        ³       ³####################³   #####    ³
                  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÙ

                 ](finalSumm:r, finalNumberOfDocuments);

             end;
          else
             if (parametersOfReport.m_needApostrophies)
                 [ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´
                  ³‚‘…ƒ:        ³####################³   #####    ³
                  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÙ

                 ](finalSumm:r:a, finalNumberOfDocuments);
             else
                 [ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´
                  ³‚‘…ƒ:        ³####################³   #####    ³
                  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÙ

                 ](finalSumm:r, finalNumberOfDocuments);
             end;
          end;
    END;

    resultsListSize = aggregates.size;


    if (parametersOfReport.m_needPackItog)

        if (parametersOfReport.m_needEveryDayPrinting)
            printResultHeader(chapter, resultDate, TRUE);
        else
            printResultHeader(chapter, parametersOfReport.m_periodEndingDate, TRUE);
        end;

        while (i < resultsListSize)
            if   ((aggregates[i].m_packNumber != 0) or
                  (aggregates[i].m_packNumberOfDocuments != 0) or
                  (aggregates[i].m_packSumm != 0))
                printPackString(aggregates[i]);
            elif ((aggregates[i].m_operCode != 0) or
                  (aggregates[i].m_operNumberOfDocuments != 0) or
                  (aggregates[i].m_operSumm != 0))
                printOperString (aggregates[i], TRUE);
            elif ((aggregates[i].m_currencyNumberOfDocuments != 0) or
                  (aggregates[i].m_currencySumm != 0))
                printFinalResult(aggregates[i], TRUE);
            end;

            i = i + 1;
        end;
    else
        if (parametersOfReport.m_needEveryDayPrinting)
            printResultHeader(chapter, resultDate, FALSE);
        else
            printResultHeader(chapter, parametersOfReport.m_periodEndingDate, FALSE);
        end;

        while (i < resultsListSize)
            if ((aggregates[i].m_operCode != 0) or
                (aggregates[i].m_operNumberOfDocuments != 0) or
                (aggregates[i].m_operSumm != 0))
                printOperString (aggregates[i], FALSE);
            elif ((aggregates[i].m_currencyNumberOfDocuments != 0) or
                  (aggregates[i].m_currencySumm != 0))
                printFinalResult(aggregates[i], FALSE);
            end;

            i = i + 1;
        end;
    end;
END;

MACRO printTableWithForeignResults (parametersOfReport:TReportParameters, aggregates:TArray, resultDate, chapter)
    var resultsListSize;
    var i;
    var wasOperResultForOneCurrency = FALSE;
    var wasOperString               = FALSE;

    MACRO printResultHeader(chapterNumber, dateForPrinting, needPackSort)
        var resultDate;
        var resultTime;
        var resultWidth;
        var resultShift = 0;

        if (parametersOfReport.m_needNationalCurrencyEquivalent)
            resultWidth =  90;
        else
            resultWidth =  64;
        end;

        dtTmSplit (dateForPrinting, resultDate, resultTime);

        printLn();
        printLn();
        printLn(mkStr(" ",resultShift) + strAlign("‘€‚Š€  ‚…„…›• „Š“Œ…’€•",resultWidth, STR_ALIGN_CENTER));
        printLn(mkStr(" ",resultShift) + strAlign(string("¯® £« ¢¥ " +  §¢ ­¨¥ƒ« ¢ë(chapterNumber)), resultWidth, STR_ALIGN_CENTER));
        printLn(mkStr(" ",resultShift) + strAlign(string("§  " + string(resultDate:f)), resultWidth, STR_ALIGN_CENTER));
        if (needPackSort)
            if (parametersOfReport.m_needNationalCurrencyEquivalent)
               [ÚÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                ³¯¥à æ¨®­¨áâ³ çª ³‚ «îâ ³Š®«¨ç¥áâ¢®³          ‘ã¬¬           ³      ‘ã¬¬  íª¢¨¢ «¥­â   ³
                ³            ³     ³      ³¤®ªã¬¥­â®¢³                         ³         ¢ ­ æ.¢ «îâ¥    ³
                ÃÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
               ];
            else
               [ÚÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                ³¯¥à æ¨®­¨áâ³ çª ³‚ «îâ ³Š®«¨ç¥áâ¢®³          ‘ã¬¬           ³
                ³            ³     ³      ³¤®ªã¬¥­â®¢³                         ³
                ÃÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
               ];
            end;
        else
            if (parametersOfReport.m_needNationalCurrencyEquivalent)
               [ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                ³  ¯¥à æ¨®­¨áâ    ³‚ «îâ ³Š®«¨ç¥áâ¢®³          ‘ã¬¬           ³      ‘ã¬¬  íª¢¨¢ «¥â­â  ³
                ³                  ³      ³¤®ªã¬¥­â®¢³                         ³         ¢ ­ æ.¢ «îâ¥    ³
                ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
               ];
            else
               [ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                ³  ¯¥à æ¨®­¨áâ    ³‚ «îâ ³Š®«¨ç¥áâ¢®³          ‘ã¬¬           ³
                ³                  ³      ³¤®ªã¬¥­â®¢³                         ³
                ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
               ];
            end;
      end;
    END;

    MACRO printPackString (aggregatesData:TReportAggregates)
        var currencyCode;
        var i;
        var equivalentSumm = numeric(aggregatesData.m_packCoveringSumm);

        getCurrencyNumber(aggregatesData.m_currencyCode, currencyCode);

        if (parametersOfReport.m_needNationalCurrencyEquivalent)
           if (parametersOfReport.m_needApostrophies)
               [³    ####    ³#####³ ###  ³ ######## ³#########################³#########################³
               ](aggregatesData.m_operCode,
                 aggregatesData.m_packNumber,
                 currencyCode,
                 aggregatesData.m_documentsNumberInOneCurrency,
                 aggregatesData.m_packSumm:r:a,
                 equivalentSumm:r:a);
           else
               [³    ####    ³#####³ ###  ³ ######## ³#########################³#########################³
               ](aggregatesData.m_operCode,
                 aggregatesData.m_packNumber,
                 currencyCode,
                 aggregatesData.m_documentsNumberInOneCurrency,
                 aggregatesData.m_packSumm:r,
                 equivalentSumm:r);
           end;
        else
           if (parametersOfReport.m_needApostrophies)
               [³    ####    ³#####³ ###  ³ ######## ³#########################³
               ](aggregatesData.m_operCode,
                 aggregatesData.m_packNumber,
                 currencyCode,
                 aggregatesData.m_documentsNumberInOneCurrency,
                 aggregatesData.m_packSumm:r:a);
           else
               [³    ####    ³#####³ ###  ³ ######## ³#########################³
               ](aggregatesData.m_operCode,
                 aggregatesData.m_packNumber,
                 currencyCode,
                 aggregatesData.m_documentsNumberInOneCurrency,
                 aggregatesData.m_packSumm:r);
           end;
        end;
    END;

    MACRO printOperString (aggregatesData:TReportAggregates)
        var equivalentSumm = numeric(aggregatesData.m_operCoveringSumm);

        if (parametersOfReport.m_needPackItog)
            if (parametersOfReport.m_needNationalCurrencyEquivalent)
                if (parametersOfReport.m_needApostrophies)
                    [ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                     ³ ¯¥à.            ³      ³ ######## ³                         ³#########################³
                     ³ ####             ³      ³          ³                         ³                         ³
                     ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                    ](aggregatesData.m_operNumberOfDocuments, equivalentSumm:r:a, aggregatesData.m_operCode);
                else
                    [ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                     ³ ¯¥à.            ³      ³ ######## ³                         ³#########################³
                     ³ ####             ³      ³          ³                         ³                         ³
                     ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                    ](aggregatesData.m_operNumberOfDocuments, equivalentSumm:r, aggregatesData.m_operCode);
                end;
            else
                [ÃÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                 ³ ¯¥à.            ³      ³ ######## ³                         ³
                 ³ ####             ³      ³          ³                         ³
                 ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                ](aggregatesData.m_operNumberOfDocuments, aggregatesData.m_operCode);
            end;
        else
            if (parametersOfReport.m_needNationalCurrencyEquivalent)
                if (parametersOfReport.m_needApostrophies)
                    [³    ####          ³      ³ ######## ³                         ³#########################³
                    ](aggregatesData.m_operCode, aggregatesData.m_operNumberOfDocuments, equivalentSumm:r:a);
                else
                    [³    ####          ³      ³ ######## ³                         ³#########################³
                    ](aggregatesData.m_operCode, aggregatesData.m_operNumberOfDocuments, equivalentSumm:r);
                end;
            else
                [³    ####          ³      ³ ######## ³                         ³
                ](aggregatesData.m_operCode, aggregatesData.m_operNumberOfDocuments);
            end;
        end;
    END;

    MACRO printOperStringForOneCurrency(aggregatesData:TReportAggregates)
        var currencyCode;
        var equivalentSumm = numeric(aggregatesData.m_operCoveringSummInOneCurrency);
        getCurrencyNumber(aggregatesData.m_currencyCode, currencyCode);

        if (parametersOfReport.m_needNationalCurrencyEquivalent)
            if (parametersOfReport.m_needApostrophies)
                [³                  ³ ###  ³ ######## ³#########################³#########################³
                ](currencyCode,
                  aggregatesData.m_operDocumentsNumberInOneCurrency,
                  aggregatesData.m_operSumm:r:a,
                  equivalentSumm:r:a);
            else
                [³                  ³ ###  ³ ######## ³#########################³#########################³
                ](currencyCode,
                  aggregatesData.m_operDocumentsNumberInOneCurrency,
                  aggregatesData.m_operSumm:r,
                  equivalentSumm:r);
            end;
        else
            if (parametersOfReport.m_needApostrophies)
                [³                  ³ ###  ³ ######## ³#########################³
                ](currencyCode,
                  aggregatesData.m_operDocumentsNumberInOneCurrency,
                  aggregatesData.m_operSumm:r:a);
            else
                [³                  ³ ###  ³ ######## ³#########################³
                ](currencyCode,
                  aggregatesData.m_operDocumentsNumberInOneCurrency,
                  aggregatesData.m_operSumm:r);
            end;
        end;
    END;

    MACRO printSeparateLineIfPack(isEquivalent)
        if (isEquivalent)
            [ÃÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        else
            [ÃÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        end;
    END;

    MACRO printSeparateLine(isEquivalent)
        if (isEquivalent)
            [ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        else
            [ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        end;
    END;

    MACRO finishTable(isEquivalent)
        if (isEquivalent)
            [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
        else
            [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
        end;
    END;

    MACRO printResults (aggregatesData:TReportAggregates)
        var equivalentSumm = numeric(aggregatesData.m_finalEquivalentSumm);

        if (parametersOfReport.m_needNationalCurrencyEquivalent)
            if (parametersOfReport.m_needApostrophies)
                [ ‚á¥£® ¤®ªã¬¥­â®¢:          ########                            #########################
                ](aggregatesData.m_finalNumberOfDocuments, equivalentSumm:r:a);
            else
                [ ‚á¥£® ¤®ªã¬¥­â®¢:          ########                            #########################
                ](aggregatesData.m_finalNumberOfDocuments, equivalentSumm:r);
            end;
        else
            [   ‚á¥£® ¤®ªã¬¥­â®¢:        ########
            ] (aggregatesData.m_finalNumberOfDocuments);
        end;
    END;

    MACRO printResultsForOneCurrency(aggregatesData:TReportAggregates)
        var currencyCode;
        var equivalentSumm = numeric(aggregatesData.m_currencyCoveringSumm);

        getCurrencyNumber(aggregatesData.m_currencyCode, currencyCode);

        if (parametersOfReport.m_needNationalCurrencyEquivalent)
            if (parametersOfReport.m_needApostrophies)
                [        ¯® ¢ «îâ¥:   ###              ######################### #########################
                ](currencyCode, aggregatesData.m_currencySumm:r:a, equivalentSumm:r:a);
            else
                [        ¯® ¢ «îâ¥:   ###              ######################### #########################
                ](currencyCode, aggregatesData.m_currencySumm:r, equivalentSumm:r);
            end;
        else
            if (parametersOfReport.m_needApostrophies)
                [          ¯® ¢ «îâ¥: ###              #########################
                ](currencyCode, aggregatesData.m_currencySumm:r:a);
            else
                [          ¯® ¢ «îâ¥: ###              #########################
                ](currencyCode, aggregatesData.m_currencySumm:r);
            end;
        end;
    END;
    resultsListSize = aggregates.size;

    if (parametersOfReport.m_needNationalCurrencyEquivalent)
        if (parametersOfReport.m_needPackItog)

            if (parametersOfReport.m_needEveryDayPrinting)
                printResultHeader(chapter, resultDate, TRUE);
            else
                printResultHeader(chapter, parametersOfReport.m_periodEndingDate, TRUE);
            end;

            i = 0;
            while (i < resultsListSize)
                if   ((aggregates[i].m_packNumber                   != 0) or
                      (aggregates[i].m_packSumm                     != 0) or
                      (aggregates[i].m_documentsNumberInOneCurrency != 0) or
                      (aggregates[i].m_packCoveringSumm             != 0))
                    if (wasOperResultForOneCurrency)
                       printSeparateLineIfPack(TRUE);
                       printPackString(aggregates[i]);
                    else
                       printPackString(aggregates[i]);
                    end;
                    wasOperResultForOneCurrency = FALSE;
                elif ((aggregates[i].m_operNumberOfDocuments != 0) or
                      (aggregates[i].m_operCoveringSumm      != 0))
                    printOperString (aggregates[i]);
                elif ((aggregates[i].m_operSumm                         != 0) or
                      (aggregates[i].m_operDocumentsNumberInOneCurrency != 0) or
                      (aggregates[i].m_operCoveringSummInOneCurrency    != 0))
                    printOperStringForOneCurrency(aggregates[i]);
                    wasOperResultForOneCurrency = TRUE;
                elif ((aggregates[i].m_finalNumberOfDocuments != 0) or
                      (aggregates[i].m_finalEquivalentSumm    != 0))
                    finishTable(TRUE);
                    printResults (aggregates[i]);
                elif ((aggregates[i].m_currencySumm         != 0) or
                      (aggregates[i].m_currencyCoveringSumm != 0))
                    printResultsForOneCurrency(aggregates[i]);
                end;
                i = i + 1;
            end;
        else
            if (parametersOfReport.m_needEveryDayPrinting)
                printResultHeader(chapter, resultDate, FALSE);
            else
                printResultHeader(chapter, parametersOfReport.m_periodEndingDate, FALSE);
            end;

            i = 0;
            while (i < resultsListSize)
                if ((aggregates[i].m_operNumberOfDocuments         != 0) or
                    (aggregates[i].m_operCoveringSumm              != 0))
                    if (wasOperResultForOneCurrency)
                        printSeparateLine(TRUE);
                        printOperString (aggregates[i]);
                    else
                        printOperString (aggregates[i]);
                    end;
                    wasOperResultForOneCurrency = FALSE;
                    wasOperString = TRUE;
                elif  ((aggregates[i].m_operSumm                        != 0) or
                      (aggregates[i].m_operDocumentsNumberInOneCurrency != 0) or
                      (aggregates[i].m_operCoveringSummInOneCurrency    != 0))
                    if (wasOperString)
                        printSeparateLine(TRUE);
                        printOperStringForOneCurrency(aggregates[i]);
                    else
                        printOperStringForOneCurrency(aggregates[i]);
                    end;
                    wasOperResultForOneCurrency = TRUE;
                    wasOperString = FALSE;
                elif ((aggregates[i].m_finalNumberOfDocuments != 0) or
                      (aggregates[i].m_finalEquivalentSumm    != 0))
                    finishTable(TRUE);
                    printResults (aggregates[i]);
                elif ((aggregates[i].m_currencySumm != 0) or
                      (aggregates[i].m_currencyCoveringSumm != 0))
                    printResultsForOneCurrency(aggregates[i]);
                end;
                i = i + 1;
            end;
        end;
    else
        if (parametersOfReport.m_needPackItog)

            if (parametersOfReport.m_needEveryDayPrinting)
                printResultHeader(chapter, resultDate, TRUE);
            else
                printResultHeader(chapter, parametersOfReport.m_periodEndingDate, TRUE);
            end;

            i = 0;
            while (i < resultsListSize)
                if   ((aggregates[i].m_packNumber                   != 0) or
                      (aggregates[i].m_packSumm                     != 0) or
                      (aggregates[i].m_documentsNumberInOneCurrency != 0))
                    if (wasOperResultForOneCurrency)
                       printSeparateLineIfPack(FALSE);
                       printPackString(aggregates[i]);
                    else
                       printPackString(aggregates[i]);
                    end;
                    wasOperResultForOneCurrency = FALSE;
                elif (aggregates[i].m_operNumberOfDocuments != 0)
                    printOperString (aggregates[i]);
                elif ((aggregates[i].m_operSumm                         != 0) or
                      (aggregates[i].m_operDocumentsNumberInOneCurrency != 0))
                    printOperStringForOneCurrency(aggregates[i]);
                    wasOperResultForOneCurrency = TRUE;
                elif (aggregates[i].m_finalNumberOfDocuments != 0)
                    finishTable(FALSE);
                    printResults (aggregates[i]);
                elif (aggregates[i].m_currencySumm != 0)
                    printResultsForOneCurrency(aggregates[i]);
                end;

                i = i + 1;
            end;
        else
            if (parametersOfReport.m_needEveryDayPrinting)
                printResultHeader(chapter, resultDate, FALSE);
            else
                printResultHeader(chapter, parametersOfReport.m_periodEndingDate, FALSE);
            end;

            i = 0;
            while (i < resultsListSize)
                if (aggregates[i].m_operNumberOfDocuments != 0)
                    if (wasOperResultForOneCurrency)
                        printSeparateLine();
                        printOperString (aggregates[i]);
                    else
                        printOperString (aggregates[i]);
                    end;
                    wasOperResultForOneCurrency = FALSE;
                    wasOperString = TRUE;
                elif  ((aggregates[i].m_operSumm                        != 0) or
                      (aggregates[i].m_operDocumentsNumberInOneCurrency != 0))
                    if (wasOperString)
                        printSeparateLine();
                        printOperStringForOneCurrency(aggregates[i]);
                    else
                        printOperStringForOneCurrency(aggregates[i]);
                    end;
                    wasOperResultForOneCurrency = TRUE;
                    wasOperString = FALSE;
                elif (aggregates[i].m_finalNumberOfDocuments != 0)
                    finishTable(FALSE);
                    printResults (aggregates[i]);
                elif (aggregates[i].m_currencySumm != 0)
                    printResultsForOneCurrency(aggregates[i]);
                end;
                i = i + 1;
            end;
        end;
    end;
END;

/**
 * ”®à¬¨à®¢ ­¨¥ â¥ªáâ  SQL-§ ¯à®á  ¤«ï ¢ë¡®àª¨ ¤ ­­ëå ¯® ­ æ¨®­ «ì­®© ¨«¨ ¨­®áâà ­­®© ¢ «îâ¥
 */
private macro makeCarryQuery(parameters: TReportParameters)

    var needSystemMaketSort;
    var query = "";
    var i;

    var numb_document = ternary(parameters.m_paymentsData, "CASE "
                                                 + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                          + REGRESTOUTCARRY + ","
                                                                                                                          + DELTARATE_ADD + ","
                                                                                                                          + DELTARATE_MCD + "))"
                                                 + "\n" + "        THEN                                            "
                                                 + "\n" + "            NVL(pmrmprop.t_number, doc.t_numb_document) "
                                                 + "\n" + "        ELSE                                            "
                                                 + "\n" + "            doc.t_numb_document                         "
                                                 + "\n" + " END",
                                                 "doc.t_numb_document");

    var date_document = ternary(parameters.m_paymentsData, "CASE "
                                                 + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                          + REGRESTOUTCARRY + ","
                                                                                                                          + DELTARATE_ADD + ","
                                                                                                                          + DELTARATE_MCD + "))"
                                                 + "\n" + "        THEN                                            "
                                                 + "\n" + "            NVL(pmrmprop.t_date, doc.t_date_carry)    "
                                                 + "\n" + "        ELSE                                            "
                                                 + "\n" + "            doc.t_date_carry                            "
                                                 + "\n" + " END",
                                                 "doc.t_date_carry");


    var shifr_oper = ternary(parameters.m_paymentsData, "CASE "
                                                 + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                          + REGRESTOUTCARRY + ","
                                                                                                                          + DELTARATE_ADD + ","
                                                                                                                          + DELTARATE_MCD + "))"
                                                 + "\n" + "        THEN                                             "
                                                 + "\n" + "            NVL(pmrmprop.t_shifrOper, doc.t_shifr_oper)  "
                                                 + "\n" + "        ELSE                                             "
                                                 + "\n" + "            doc.t_shifr_oper                             "
                                                 + "\n" + " END",
                                                 "doc.t_shifr_oper");

    var receiverBankCode = ternary(parameters.m_paymentsData,
                                   "CASE"
                          + "\n" + "    WHEN pmprop_credit.t_bankCode IS NOT NULL"
                          + "\n" + "    THEN DECODE(pmprop_credit.t_codeKind,"
                          + "\n" + "            " + PTCK_BIC + ","
                          + "\n" + "                pmprop_credit.t_bankCode,"
                          + "\n" + "                CHR(1)"
                          + "\n" + "               )"
                          + "\n" + "    ELSE rsb_rep_pt.get_partyCode(" + PTCK_BIC + ","
                          + "\n" + "                                  (SELECT dep.t_partyId FROM ddp_dep_dbt dep WHERE dep.t_code = accr.t_department),"
                          + "\n" + "                                  doc.t_date_carry,"
                          + "\n" + "                                  1"
                          + "\n" + "                                 )"
                          + "\n" + " END",
                                   "rsb_rep_pt.get_partyCode(" + PTCK_BIC + ","
                          + "\n" + "                         (SELECT dep.t_partyId FROM ddp_dep_dbt dep WHERE dep.t_code = accr.t_department),"
                          + "\n" + "                         doc.t_date_carry,"
                          + "\n" + "                         1"
                          + "\n" + "                        )"
                                  );

    var payerBankCode = ternary(parameters.m_paymentsData,
                                "CASE"
                       + "\n" + "    WHEN pmprop_debit.t_bankCode IS NOT NULL"
                       + "\n" + "    THEN DECODE(pmprop_debit.t_codeKind,"
                       + "\n" + "            " + PTCK_BIC + ","
                       + "\n" + "                pmprop_debit.t_bankCode,"
                       + "\n" + "                CHR(1)"
                       + "\n" + "               )"
                       + "\n" + "    ELSE rsb_rep_pt.get_partyCode(" + PTCK_BIC + ","
                       + "\n" + "                                  (SELECT dep.t_partyId FROM ddp_dep_dbt dep WHERE dep.t_code = accp.t_department),"
                       + "\n" + "                                  doc.t_date_carry,"
                       + "\n" + "                                  1"
                       + "\n" + "                                 )"
                       + "\n" + " END",
                                "rsb_rep_pt.get_partyCode(" + PTCK_BIC + ","
                       + "\n" + "                         (SELECT dep.t_partyId FROM ddp_dep_dbt dep WHERE dep.t_code = accp.t_department),"
                       + "\n" + "                         doc.t_date_carry,"
                       + "\n" + "                         1"
                       + "\n" + "                        )"
                               );

    var receiverAccount = ternary(parameters.m_paymentsData, "CASE "
                                                    + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                             + REGRESTOUTCARRY + ","
                                                                                                                             + DELTARATE_ADD + ","
                                                                                                                             + DELTARATE_MCD + "))"
                                                    + "\n" + "     THEN NVL(pmpaym.t_receiverAccount, doc.t_account_receiver) "
                                                    + "\n" + "     ELSE doc.t_account_receiver                                "
                                                    + "\n" + "END",
                                                             "doc.t_account_receiver"
                                 );

    var payerAccount = ternary(parameters.m_paymentsData, "   CASE "
                                                    + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                             + REGRESTOUTCARRY + ","
                                                                                                                             + DELTARATE_ADD + ","
                                                                                                                             + DELTARATE_MCD + "))"
                                                    + "\n" + "     THEN NVL(pmpaym.t_payerAccount, doc.t_account_payer)       "
                                                    + "\n" + "     ELSE doc.t_account_payer                                   "
                                                    + "\n" + "END",
                                                          "doc.t_account_payer"
                              );

    var receiverAmount = ternary(parameters.m_paymentsData,  "   CASE "
                                                    + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                             + REGRESTOUTCARRY + ","
                                                                                                                             + DELTARATE_ADD + ","
                                                                                                                             + DELTARATE_MCD + "))"
                                                    + "\n" + "     THEN NVL(pmpaym.t_payAmount, doc.t_sum_receiver)          "
                                                    + "\n" + "     ELSE doc.t_sum_receiver                                   "
                                                    + "\n" + "END",
                                                             "doc.t_sum_receiver");

    var payerAmount = ternary(parameters.m_paymentsData,   "   CASE "
                                                    + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                             + REGRESTOUTCARRY + ","
                                                                                                                             + DELTARATE_ADD + ","
                                                                                                                             + DELTARATE_MCD + "))"
                                                    + "\n" + "     THEN NVL(pmpaym.t_amount, doc.t_sum_payer)          "
                                                    + "\n" + "     ELSE doc.t_sum_payer                                "
                                                    + "\n" + "END",
                                                             "doc.t_sum_payer");


    var receiverFiId = ternary(parameters.m_paymentsData, "   CASE "
                                                    + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                             + REGRESTOUTCARRY + ","
                                                                                                                             + DELTARATE_ADD + ","
                                                                                                                             + DELTARATE_MCD + "))"
                                                    + "\n" + "     THEN NVL(pmpaym.t_payFiId, doc.t_fiId_receiver)            "
                                                    + "\n" + "     ELSE doc.t_fiId_receiver                                   "
                                                    + "\n" + "END",
                                                          "doc.t_fiId_receiver"
                              );

    var payerFiId = ternary(parameters.m_paymentsData, "      CASE "
                                                    + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                             + REGRESTOUTCARRY + ","
                                                                                                                             + DELTARATE_ADD + ","
                                                                                                                             + DELTARATE_MCD + "))"
                                                    + "\n" + "     THEN NVL(pmpaym.t_fiId, doc.t_fiId_payer)               "
                                                    + "\n" + "     ELSE doc.t_fiId_payer                                   "
                                                    + "\n" + "END",
                                                       "doc.t_fiId_payer"
                           );

    var paymentIdNotNull = ternary(parameters.m_paymentsData,"CASE "
                                                    + "\n" + "     WHEN doc.t_chapter != 3 AND (doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                                                                             + REGRESTOUTCARRY + ","
                                                                                                                             + DELTARATE_ADD + ","
                                                                                                                             + DELTARATE_MCD + "))"
                                                    + "\n" + "     THEN NVL(pmpaym.t_paymentId, 0)                                 "
                                                    + "\n" + "     ELSE 0                                                          "
                                                    + "\n" + "END",
                                                             "0"
                                  );

    var currencyFilterClause;

    if (parameters.m_currencyCode() == NATCUR)

        currencyFilterClause = "\n" + "   AND (   (    doc.t_fiId_payer = " + parameters.m_currencyCode()
                             + "\n" + "            AND doc.t_fiId_receiver = " + parameters.m_currencyCode()
                             + "\n" + "           )"
                             + "\n" + "        OR doc.t_result_carry IN (" + DELTARATE + ","
                                                                           + REGRESTOUTCARRY + ","
                                                                           + DELTARATE_ADD + ","
                                                                           + DELTARATE_MCD + ")"
                             + "\n" + "       )";

    elif (parameters.m_currencyCode() > NATCUR)

        currencyFilterClause = "\n" + "   AND (   doc.t_fiId_payer = " + parameters.m_currencyCode()
                             + "\n" + "        OR doc.t_fiId_receiver = " + parameters.m_currencyCode()
                             + "\n" + "       )"
                             + "\n" + "   AND doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                           + REGRESTOUTCARRY + ","
                                                                           + DELTARATE_ADD + ","
                                                                           + DELTARATE_MCD + ")";

    elif (parameters.m_currencyCode() == ALLCURRENCY)

        currencyFilterClause = "\n" + "   AND (   doc.t_fiId_payer != " + NATCUR
                             + "\n" + "        OR doc.t_fiId_receiver != " + NATCUR
                             + "\n" + "       )"
                             + "\n" + "   AND doc.t_result_carry NOT IN (" + DELTARATE + ","
                                                                           + REGRESTOUTCARRY + ","
                                                                           + DELTARATE_ADD + ","
                                                                           + DELTARATE_MCD + ")";

//    elif (m_parameters.getCurrencyCode() == ALLFININSTR)
//
//        currencyFilterClause = "\n" + "   AND doc.t_result_carry NOT IN (" + DELTARATE_MCD + ")";
//
    else
        currencyFilterClause = "";
    end;

    needSystemMaketSort = false;
    i = 0;
    while (i < parameters.m_sortingKind.size) /*¯® ª ¦¤®¬ã § ¤ ­­®¬ã ¢¨¤ã á®àâ¨à®¢ª¨*/
      if (parameters.m_sortingKind[i] == REP_PATTERNSORT_SYSTEM_MAKET)
        needSystemMaketSort = true;
        break;
      end;
      i = i +1;
    end;

    query =      "SELECT " + numb_document + "                AS t_numb_document,"
        + "\n" + "       " + date_document + "                AS t_date_document,"
        + "\n" + "       " + shifr_oper + "                   AS t_shifr_oper,"
        + "\n" + "       " + receiverBankCode + "             AS t_receiverBankCodeNotNull,"
        + "\n" + "       " + receiverAccount + "              AS t_receiverAccount,"
        + "\n" + "       " + payerBankCode + "                AS t_payerBankCodeNotNull,"
        + "\n" + "       " + payerAccount + "                 AS t_payerAccount,"
        + "\n" + "       doc.t_fiId_payer                     AS t_code_currency,"
        + "\n" + "       " + receiverAmount + "               AS t_receiverAmount,"
        + "\n" + "       " + payerAmount + "                  AS t_payerAmount,"
        + "\n" + "       " + receiverFiId + "                 AS t_receiverFiId,"
        + "\n" + "       " + payerFiId + "                    AS t_payerFiId,"
        + "\n" + "       " + paymentIdNotNull + "             AS t_paymentIdNotNull,"
        + "\n" + "       doc.t_sum_payer                      AS t_docsum,"
        + "\n" + "       doc.t_result_carry                   AS t_result_carry,"
        + "\n" + "       doc.t_oper                           AS t_docoper,"
        + "\n" + "       doc.t_chapter                        AS t_docchapter,"
        + "\n" + "       doc.t_date_carry                     AS t_docdate_carry,"
        + "\n" + "       doc.t_number_pack                    AS t_docnumber_pack,"
        + "\n" + "       doc.t_accTrnId                       AS t_accTrnId,"
        + "\n" + "       doc.t_sum_natcur                     AS t_equivalentSumm";

    if (useProtocol)
        query = query + ","
        + "\n" + "       doc.t_fiId_receiver                  AS t_doccode_currency,"
        + "\n" + "       doc.t_numb_document                  AS t_docnumb_document,"
        + "\n" + "       doc.t_account_payer                  AS t_docaccount_payer,"
        + "\n" + "       doc.t_account_receiver               AS t_docaccount_receiver";
    end;

    if (needSystemMaketSort)
        query = query + ","
        + "\n" + "     accp.t_sort                             AS t_systemMaketSort";
    end;

    /*„®¡ ¢«ï¥¬ ¯®«ï á £àã¯ ¬¨ ®¯¥à æ¨®­¨áâ®¢*/
    if (parameters.m_needGroupSplit)
        query = query + ","
        + "\n" + "    NVL(grp.t_groupid, -1)                  AS t_groupId,"
        + "\n" + "    grp.t_groupid                           AS t_groupIdNull";
    end;

    query = query
        + "\n" + "  FROM daccTrn_dbt doc"
        + "\n" + " LEFT OUTER JOIN daccount_dbt accp"
        + "\n" + "    ON accp.t_accountId = doc.t_accountId_payer"
        + "\n" + " LEFT OUTER JOIN daccount_dbt accr"
        + "\n" + "    ON accr.t_accountId = doc.t_accountId_receiver";

    if (parameters.m_needGroupSplit)
        query = query
        + "\n" + "  LEFT OUTER JOIN dacsgroupoper_dbt grp"
        + "\n" + "               ON doc.t_oper = grp.t_oper";
    end;

    if (not useProtocol and not parameters.m_paymentsData)
        query = query
        + "\n" + "  LEFT OUTER JOIN dpmdocs_dbt pmdocs"
        + "\n" + "               ON doc.t_accTrnId = pmdocs.t_accTrnId"
        + "\n" + "  LEFT OUTER JOIN dpmprop_dbt pmprop_debit"
        + "\n" + "               ON pmdocs.t_paymentId = pmprop_debit.t_paymentId"
        + "\n" + "              AND 0 = pmprop_debit.t_debetCredit"
        + "\n" + "  LEFT OUTER JOIN dpmprop_dbt pmprop_credit"
        + "\n" + "               ON pmdocs.t_paymentId = pmprop_credit.t_paymentId"
        + "\n" + "              AND 1 = pmprop_credit.t_debetCredit";
    end;

    if (useProtocol or parameters.m_paymentsData)
        query = query
        + "\n" + "  LEFT OUTER JOIN dpmdocs_dbt pmdocs"
        + "\n" + "               ON doc.t_accTrnId = pmdocs.t_accTrnId"
        + "\n" + "  LEFT OUTER JOIN dpmpaym_dbt pmpaym"
        + "\n" + "               ON pmdocs.t_paymentId = pmpaym.t_paymentId"
        + "\n" + "  LEFT OUTER JOIN dpmprop_dbt pmprop_debit"
        + "\n" + "               ON pmpaym.t_paymentId = pmprop_debit.t_paymentId"
        + "\n" + "              AND 0 = pmprop_debit.t_debetCredit"
        + "\n" + "  LEFT OUTER JOIN dpmprop_dbt pmprop_credit"
        + "\n" + "               ON pmpaym.t_paymentId = pmprop_credit.t_paymentId"
        + "\n" + "              AND 1 = pmprop_credit.t_debetCredit"
    end;

    if (parameters.m_paymentsData)
        query = query
        + "\n" + "  LEFT OUTER JOIN dpmrmprop_dbt pmrmprop"
        + "\n" + "               ON pmpaym.t_paymentId = pmrmprop.t_paymentId";
    end;

    query = query
        + "\n" + " WHERE (" + parameters.m_accountFilter.getAsSqlString("accp")
        + "\n" + " OR     " + parameters.m_accountFilter.getAsSqlString("accr") + ")"

        + "\n" + "   AND (" + parameters.m_documentFilter.getAsSqlString("doc.t_department",
                                                                         "accp.t_branch",
                                                                         "accr.t_branch",
                                                                         PRIV_GET_ACCOUNT_DATA_FOR_REPORTS)
        + "\n" + "       )"

        + "\n" + "   AND doc.t_state = 1"
        + "\n" + "   AND doc.t_date_carry BETWEEN " + getSqlDate(parameters.m_periodBeginningDate)
        + "\n" + "                            AND " + getSqlDate(parameters.m_periodEndingDate)
        +        currencyFilterClause;

    if (parameters.m_chapterNumber != 0)
        query = query
        + "\n" + "   AND doc.t_chapter = " + parameters.m_chapterNumber;
    end;

    if ((parameters.m_operNumber != 0) AND (not parameters.m_needGroupSplit))
        query = query
        + "\n" + "   AND doc.t_oper = " + parameters.m_operNumber;
    end;

    if (parameters.m_packNumber != 0)
        query = query
         + "\n" + "   AND doc.t_number_pack = " + parameters.m_packNumber;
    end;

    if ((parameters.m_operNumber != 0) AND (parameters.m_needGroupSplit))
        query = query
         + "\n" + "   AND grp.t_groupid = " + parameters.m_operNumber;
    end;

    if (not parameters.m_needExchangeRateDiff)
        query = query
         + "\n" + "   AND doc.t_result_carry != " + DELTARATE_MCD;
    end;

    query = query
      + "\n" + "ORDER BY t_docchapter";

    if (parameters.m_needEveryDayPrinting)
        query = query + ","
          + "\n" + "     t_docdate_carry";
    end;

    if (parameters.m_needGroupSplit)
        query = query + ","
          + "\n" + "     t_groupIdNull NULLS LAST";
    end;

    query = query + ","
          + "\n" + "     t_docoper";

    if (parameters.m_needPackItog)
        query = query + ","
          + "\n" + "     t_docnumber_pack";
    end;

    /*§ ¤ ­­ ï ¢ ¯ ­¥«¨ á®àâ¨à®¢ª */
    i = 0;
    while (i < parameters.m_sortingKind.size)
        query = query + ", ";
        if (parameters.m_sortingKind[i] == REP_PATTERNSORT_SUM_DOCUMENT)
            query = query
            + "\n" + "   t_docsum";
        elif (parameters.m_sortingKind[i] == REP_PATTERNSORT_SYSTEM_MAKET)
            query = query
            + "\n" + "   t_systemMaketSort";
        end;
        i = i +1;
    end;

    return query;
end;

private macro resultQuery(parameters: TReportParameters)
    return makeCarryQuery(parameters);
end;

/*¥ç âì ®âç¥â */
MACRO printReport (parameters: TReportParameters);

    var width         = 83;
    var shift         = 0;
    var reportData;
    var isDataRecords = FALSE;
    var data;
    var dataRecord;

    var summEquivalent   = 0;  /*â¥ªãé ï áã¬¬  ¯®ªàëâ¨ï ¤«ï ¬ã«ìâ¨¢ «îâ­®© ¯à®¢®¤ª¨*/
    var wasRecordsOfCurrentMultyCarry = 0; /*ª®«¨ç¥áâ¢® à áá¬®âà¥­­ëå § ¯¨á¥© */
                                                  /*¯® â¥ªãé¥© ¬ã«ìâ¨¢ «îâ­®© ¯à®¢®¤ª¥*/

    /* £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
    var numberOfOperDocuments   = 0; /*ª®«¨ç¥áâ¢® ¤®ªã¬¥­â®¢ ã ®¯¥à æ¨®­¨áâ */
    var numberOfDocumentsInPack = 0; /*ª®«¨ç¥áâ¢® ¤®ªã¬¥­â®¢ ¢ ¯ çª¥*/
    var summOfOperDocuments     = 0; /*¨â®£® ¯® ®¯¥à æ¨®­¨áâã*/
    var summOfDocumentsInPack   = 0; /*¨â®£® ¯® ¯ çª¥*/
    var finalNumberOfDocuments  = 0; /*®¡é¥¥ ª®«¨ç¥áâ¢® ¤®ªã¬¥­â®¢*/
    var finalSumm               = 0; /*®¡é ï áã¬¬ */
    /* £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¤«ï ¢ «îâ­®£® ®âç¥â */
    var equivalentSummInPack               = 0; /*áã¬¬  ¯®ªàëâ¨ï ¯® ªà¥¤¨âã ¢ ¯ çª¥*/

    var equivalentOperSumm                 = 0; /*áã¬¬  ¯®ªàëâ¨ï ¯® ªà¥¤¨âã ®¯¥à */

    var equivalentFinalSumm                = 0; /*¨â®£®¢ ï áã¬¬  ¯®ªàëâ¨ï ¯® ªà¥¤¨âã*/
    var creditFinalSummForOneCurrency            = 0; /*¨â®£®¢ ï áã¬¬  ¯® ªà¥¤¨âã ¯® ®¤­®© ¢ «îâ¥*/
    var finalEquivalentSummForOneCurrency  = 0; /*¨â®£®¢ ï áã¬¬  ¯®ªàëâ¨ï ¯® ªà¥¤¨âã ¯® ®¤­®© ¢ «îâ¥*/

    var listOfReportAggregates = TArray; /*á¯¨á®ª  £à¥£¨àãîé¨å ¤ ­­ëå*/
/*    var indexOfReportAggregates  = 0;    ¨­¤¥ªá ¢ á¯¨áª¥  £à¥£¨àãîé¨å ¤ ­­ëå*/
    var currentReportAggregates;

    var listOfAggregatesInPack = TArray; /*á¯¨á®ª à¥§ã«ìâ â®¢ ¯® ¢ «îâ ¬ ¢ ¯ çª¥*/
    var listOfAggregatesOfOper = TArray; /*á¯¨á®ª à¥§ã«ìâ â®¢ ¯® ¢ «îâ ¬ ¤«ï ®¯¥à */
    var listOfFinalAggregates  = TArray; /*á¯¨á®ª ¨â®£®¢ëå à¥§ã«ìâ â®¢ ¯® ¢ «îâ ¬*/
    var currencyList;                    /*á¯¨á®ª ¢ «îâ*/
    var listOfFinalAggregates_Groups  = TArray; /*á¯¨á®ª ¨â®£®¢ëå à¥§ã«ìâ â®¢ ¯® ¢ «îâ ¬ ¯à¨ à §¡¨¢ª  ­  £àã¯¯ë*/

/*ãä¥à § ¯¨á¨ ¯® ¬ã«ìâ¨¢ «îâ­®© ¯à®¢®¤ª¥ á ¯®ªàëâ¨¥¬*/
    var buffer_documentNumber;
    var buffer_currencyCode;
    var buffer_receiverBankCode;
    var buffer_payerAccount;
    var buffer_receiverAccount;
    var buffer_debitSumm;
    var buffer_creditSumm;
    var buffer_equivalentSumm;

    /*â¥ªãé¨¥ §­ ç¥­¨ï*/
    var currentChapter;
    var currentDate;
    var currentGroup;
    var currentOper;
    var currentPack;
    var currentCurrency;
    var currentCarryId;

    var wasRecord = FALSE;

    var count = 0; /*ª®«¨ç¥áâ¢® § ¯¨á¥© ¢ ®âç¥â¥*/

//    var usedOpersList = TGroupOfOpersAndPacks();
    var usedOpersList = TGroupOfOpersAndPacksOptimized();

    /*”ã­ªæ¨ï ¯¥ç â ¥â äà £¬¥­â àã¡«¥¢®£® ®âç¥â  â®«ìª® á ¤ ­­ë¬¨ ¯® ®¯¥à ¬ ¨ ¯ çª ¬*/
    MACRO printNationalReportPart1(parameters1:TReportParameters, recordForPrinting1)

        if (((recordForPrinting1.docOper == currentOper) AND (not parameters1.m_needGroupSplit)) OR
            ((recordForPrinting1.docOper == currentOper) AND (parameters1.m_needGroupSplit) AND
             (recordForPrinting1.groupid == currentGroup)))

             if (parameters1.m_needPackItog)
                 if (recordForPrinting1.docNumber_Pack == currentPack)
                     printOneNationalDocument(recordForPrinting1,
                                              parameters1.m_needApostrophies, parameters.m_needOperSplit);
                     /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                     numberOfDocumentsInPack = numberOfDocumentsInPack + 1;
                     summOfDocumentsInPack   = summOfDocumentsInPack + recordForPrinting1.t_equivalentSumm;
                     numberOfOperDocuments   = numberOfOperDocuments + 1;
                     summOfOperDocuments     = summOfOperDocuments   + recordForPrinting1.t_equivalentSumm;

                     /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                     currentPack = recordForPrinting1.docNumber_Pack;
                 else /*(recordForPrinting1.docNumberPack != currentPack)*/
                     /*­ ¯¥ç â «¨ ¨â®£ ¯® ¯ çª¥*/
                     printPackResult(numberOfDocumentsInPack,
                                     summOfDocumentsInPack,
                                     parameters1.m_needApostrophies, parameters.m_needOperSplit);

                     /*á«®¦¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ¯ çª¥ ¢ á¯¨á®ª*/
                     currentReportAggregates = TReportAggregates(currentOper,
                                                                  currentPack,
                                                                            0,
                                                      numberOfDocumentsInPack,
                                                        summOfDocumentsInPack,
                                                                            0,
                                                                            0,
                                                                            0,
                                                                            0,
                                                                            0,
                                                                            0,
                                                                            0,
                                                                            0,
                                                                            0,
                                                                            0,
                                                                            0,
                                                                            0);
                     if (parameters1.m_needGroupSplit)
                         if (not usedOpersList.havePair(currentOper, currentPack))
                            usedOpersList.addPair(currentOper, currentPack);
                            listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
                         end;
                     else
                         listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
                     end;

                     /*®¡­ã«¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ¯ çª¥*/
                     numberOfDocumentsInPack = 0;
                     summOfDocumentsInPack   = 0;

                     printNewPack(recordForPrinting1.docNumber_pack);

                     printTableHeader(FALSE, FALSE, parameters.m_needOperSplit);

                     printOneNationalDocument(recordForPrinting1, parameters1.m_needApostrophies, parameters.m_needOperSplit);
                     /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                     numberOfDocumentsInPack = numberOfDocumentsInPack + 1;
                     summOfDocumentsInPack   = summOfDocumentsInPack + recordForPrinting1.t_equivalentSumm;
                     numberOfOperDocuments   = numberOfOperDocuments + 1;
                     summOfOperDocuments     = summOfOperDocuments   + recordForPrinting1.t_equivalentSumm;

                     /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                     currentPack = recordForPrinting1.docNumber_Pack;
                 end;/*(recordForPrinting1.docNumberPack == currentPack)*/
             else/*(parameters1.m_needPackItog == "")*/

                 printOneNationalDocument(recordForPrinting1, parameters1.m_needApostrophies, parameters.m_needOperSplit);
                 /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                 numberOfOperDocuments  = numberOfOperDocuments + 1;
                 summOfOperDocuments    = summOfOperDocuments   + recordForPrinting1.t_equivalentSumm;

             end;/*(parameters1.m_needPackItog)*/
         else  /*(recordForPrinting1.docOper != currentOper)*/
             if (parameters1.m_needPackItog)

                 /*­ ¯¥ç â «¨ ¨â®£ ¯® ¯ çª¥*/
                 printPackResult(numberOfDocumentsInPack, summOfDocumentsInPack, parameters1.m_needApostrophies, parameters.m_needOperSplit);

                 /*á«®¦¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ¯ çª¥ ¢ á¯¨á®ª*/
                 currentReportAggregates = TReportAggregates(currentOper,
                                                              currentPack,
                                                                        0,
                                                  numberOfDocumentsInPack,
                                                    summOfDocumentsInPack,
                                                                        0,
                                                                        0,
                                                                        0,
                                                                        0,
                                                                        0,
                                                                        0,
                                                                        0,
                                                                        0,
                                                                        0,
                                                                        0,
                                                                        0,
                                                                        0);
                 if (parameters1.m_needGroupSplit)
                     if (not usedOpersList.havePair(currentOper, currentPack))
                         usedOpersList.addPair(currentOper, currentPack);
                         listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
                     end;
                 else
                     listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
                 end;

                 /*®¡­ã«¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ¯ çª¥*/
                 numberOfDocumentsInPack = 0;
                 summOfDocumentsInPack   = 0;

             end;/*(parameters1.m_needPackItog)*/

             /*­ ¯¥ç â «¨ ¨â®£ ¯® ®¯¥àã*/
             printOperResult(numberOfOperDocuments,
                               summOfOperDocuments,
                        parameters1.m_needPackItog,
                    parameters1.m_needApostrophies,
                        parameters.m_needOperSplit);

             /*á«®¦¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ®¯¥àã ¢ á¯¨á®ª*/

             currentReportAggregates = TReportAggregates (currentOper,
                                                                    0,
                                                                    0,
                                                                    0,
                                                                    0,
                                                                    0,
                                                numberOfOperDocuments,
                                                  summOfOperDocuments,
                                                                    0,
                                                                    0,
                                                                    0,
                                                                    0,
                                                                    0,
                                                                    0,
                                                                    0,
                                                                    0,
                                                                    0);
             if (parameters1.m_needGroupSplit)
                 if (not usedOpersList.haveSingle(currentOper))
                 /*¤®¯®«­¨«¨ ®¡é¨¥  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯¥à¥¤ ®¡­ã«¥­¨¥¬ ¤ ­­ëå ¯® ®¯¥àã*/
                 finalNumberOfDocuments = finalNumberOfDocuments + numberOfOperDocuments;
                 finalSumm              = finalSumm + summOfOperDocuments;

                 listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;

                 usedOpersList.addSingle(currentOper);
                 end;
             else
                 /*¤®¯®«­¨«¨ ®¡é¨¥  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯¥à¥¤ ®¡­ã«¥­¨¥¬ ¤ ­­ëå ¯® ®¯¥àã*/
                 finalNumberOfDocuments = finalNumberOfDocuments + numberOfOperDocuments;
                 finalSumm              = finalSumm + summOfOperDocuments;

                 listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
             end;

             /*®¡­ã«¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ®¯¥àã*/
             numberOfOperDocuments = 0;
             summOfOperDocuments   = 0;

             if ((parameters1.m_needGroupSplit) AND (reportData.groupid != currentGroup))
                 if (not parameters1.m_needOperSplit)
                     printOperResultBackLine(true);   // ‡ ªàë¢ ¥¬ â ¡«¨æã
                 end;
                 printNewGroup(recordForPrinting1.groupid);
             else
                 if (not parameters1.m_needOperSplit)
                     printOperResultBackLine(false);   // ¯à®¤®«¦ ¥¬ â ¡«¨æã
                 end;
             end;

             if (parameters1.m_needOperSplit)
                 printNewOper(recordForPrinting1.docOper);
             end;

             if (parameters1.m_needPackItog)
                 printNewPack(recordForPrinting1.docNumber_pack);
             end;

             if (parameters1.m_needOperSplit OR
                 ((parameters1.m_needGroupSplit) AND (recordForPrinting1.groupid != currentGroup)))
                 printTableHeader(FALSE, FALSE, parameters1.m_needOperSplit);
             end;

             printOneNationalDocument(recordForPrinting1, parameters1.m_needApostrophies, parameters.m_needOperSplit);
             /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
             if (parameters1.m_needPackItog)
                 numberOfDocumentsInPack = numberOfDocumentsInPack + 1;
                 summOfDocumentsInPack   = summOfDocumentsInPack + recordForPrinting1.t_equivalentSumm;
             end;

             numberOfOperDocuments   = numberOfOperDocuments + 1;
             summOfOperDocuments     = summOfOperDocuments   + recordForPrinting1.t_equivalentSumm;

             /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
             if (parameters1.m_needPackItog)
                 currentPack = recordForPrinting1.docNumber_Pack;
             end;
             if (parameters1.m_needGroupSplit)
                 currentGroup  = recordForPrinting1.groupid;
             end;
             currentOper  = recordForPrinting1.docOper;
//end;
        end;  /*(recordForPrinting1.docOper == currentOper)*/

    END;

    /*¥ç âì ç áâ¨ ®âç¥â  á ¨â®£ ¬¨ ¯® ®¯¥àã (¯ çª¥), â ¡«¨æ¥© ¨â®£®¢ ¨ ¯®¤¯¨áï¬¨*/
    MACRO printNationalReportPart2(parameters2:TReportParameters, recordForPrinting2)
         var j;

         if (parameters2.m_needPackItog)
             /*­ ¯¥ç â «¨ ¨â®£ ¯® ¯ çª¥*/
             printPackResult(numberOfDocumentsInPack, summOfDocumentsInPack, parameters2.m_needApostrophies, parameters.m_needOperSplit);

             /*á«®¦¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ¯ çª¥ ¢ á¯¨á®ª*/
             currentReportAggregates = TReportAggregates(currentOper,
                                                         currentPack,
                                                                   0,
                                             numberOfDocumentsInPack,
                                               summOfDocumentsInPack,
                                                                   0,
                                                                   0,
                                                                   0,
                                                                   0,
                                                                   0,
                                                                   0,
                                                                   0,
                                                                   0,
                                                                   0,
                                                                   0,
                                                                   0,
                                                                   0);
             if (parameters2.m_needGroupSplit)
                 if (not usedOpersList.havePair(currentOper, currentPack))
                     usedOpersList.addPair(currentOper, currentPack);
                     listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
                 end;
             else
                 listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
             end;

             /*®¡­ã«¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ¯ çª¥*/
             numberOfDocumentsInPack = 0;
             summOfDocumentsInPack   = 0;
         end;/*(parameters2.m_needPackItog)*/

         /*­ ¯¥ç â «¨ ¨â®£ ¯® ®¯¥àã*/
         printOperResult(numberOfOperDocuments,
                         summOfOperDocuments,
                         parameters2.m_needPackItog,
                         parameters2.m_needApostrophies,
                         parameters.m_needOperSplit);

         if (not parameters2.m_needOperSplit)
             printOperResultBackLine(true);   // ‡ ªàë¢ ¥¬ â ¡«¨æã
         end;


         /*á«®¦¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ®¯¥àã ¢ á¯¨á®ª*/
         currentReportAggregates = TReportAggregates(currentOper,
                                                                0,
                                                                0,
                                                                0,
                                                                0,
                                                                0,
                                            numberOfOperDocuments,
                                              summOfOperDocuments,
                                                                0,
                                                                0,
                                                                0,
                                                                0,
                                                                0,
                                                                0,
                                                                0,
                                                                0,
                                                                0);
         if (parameters2.m_needGroupSplit)
             if (not usedOpersList.haveSingle(currentOper))
                 usedOpersList.addSingle(currentOper);

                 /*¤®¯®«­¨«¨ ®¡é¨¥  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯¥à¥¤ ®¡­ã«¥­¨¥¬ ¤ ­­ëå ¯® ®¯¥àã*/
                 finalNumberOfDocuments = finalNumberOfDocuments + numberOfOperDocuments;
                 finalSumm              = finalSumm + summOfOperDocuments;

                 listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
             end;
         else
             /*¤®¯®«­¨«¨ ®¡é¨¥  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯¥à¥¤ ®¡­ã«¥­¨¥¬ ¤ ­­ëå ¯® ®¯¥àã*/
             finalNumberOfDocuments = finalNumberOfDocuments + numberOfOperDocuments;
             finalSumm              = finalSumm + summOfOperDocuments;

             listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
         end;

         /*®¡­ã«¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ®¯¥àã*/
         numberOfOperDocuments = 0;
         summOfOperDocuments   = 0;

         /*á«®¦¨«¨ ®¡é¨¥  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¢ á¯¨á®ª*/
         currentReportAggregates = TReportAggregates(0,
                                                     0,
                                                     0,
                                                     0,
                                                     0,
                                                     0,
                                                     0,
                                                     0,
                                                     0,
                                finalNumberOfDocuments,
                                             finalSumm,
                                                     0,
                                                     0,
                                                     0,
                                                     0,
                                                     0,
                                                     0);
         listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;

         /*¡­ã«¨«¨ ®¡é¨¥ ¨â®£¨*/
         finalNumberOfDocuments  = 0;
         finalSumm               = 0;

         /* ¯¥ç â «¨ â ¡«¨çªã á à¥§ã«ìâ â ¬¨ ¤ ­­ëå*/
         printTableWithNationalResults(parameters2,
                            listOfReportAggregates,
                                       currentDate,
                                    currentChapter);

         /*®ç¨áâ¨«¨ á¯¨á®ª à¥§ã«ìâ â®¢*/
         j = 0;
         while (j < listOfReportAggregates.size)
             listOfReportAggregates[j].m_operCode                  = 0;
             listOfReportAggregates[j].m_packNumber                = 0;
             listOfReportAggregates[j].m_currencyCode              = 0;
             listOfReportAggregates[j].m_packNumberOfDocuments     = 0;
             listOfReportAggregates[j].m_packSumm                  = 0;
             listOfReportAggregates[j].m_packCoveringSumm          = 0;
             listOfReportAggregates[j].m_operNumberOfDocuments     = 0;
             listOfReportAggregates[j].m_operSumm                  = 0;
             listOfReportAggregates[j].m_operCoveringSumm          = 0;
             listOfReportAggregates[j].m_currencyNumberOfDocuments = 0;
             listOfReportAggregates[j].m_currencySumm              = 0;
             listOfReportAggregates[j].m_currencyCoveringSumm      = 0;
/*                            listOfReportAggregates[j].clear();*/
             j = j + 1;
         end;

         usedOpersList.clear();

         /* ¯¥ç â «¨ ¯®¤¯¨á¨*/
         printSignatures();
         printLn();
    END;


    /*¥ç âì ®âç¥â  ¢ ­ æ¨®­ «ì­®© ¢ «îâ¥*/
    MACRO printNationalReport(nationalParameters:TReportParameters, dataRecord)
//         var dataRecord;
         printTableHeader(FALSE, FALSE, parameters.m_needOperSplit);

         useProgress (count);

         printOneNationalDocument(dataRecord/*data*/, nationalParameters.m_needApostrophies, parameters.m_needOperSplit);
         /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
         if (parameters.m_needPackItog)
             numberOfDocumentsInPack = numberOfDocumentsInPack + 1;
             summOfDocumentsInPack   = summOfDocumentsInPack + dataRecord/*data*/.t_equivalentSumm;
         end;
         numberOfOperDocuments  = numberOfOperDocuments + 1;
         summOfOperDocuments    = summOfOperDocuments   + dataRecord/*data*/.t_equivalentSumm;

         /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
         currentChapter = dataRecord/*data*/.docchapter;
         if (parameters.m_needEveryDayPrinting)
            currentDate = dataRecord/*data*/.docdate_carry;
         end;
         if (parameters.m_needGroupSplit)
             currentGroup   = dataRecord/*data*/.groupid
         end;
         currentOper    = dataRecord/*data*/.docOper;
         if (parameters.m_needPackItog)
            currentPack = dataRecord/*data*/.docNumber_Pack;
         end;

        /*¯¥ç â ¥¬ ®áâ «ì­ë¥ § ¯¨á¨ ®âç¥â */
        while (dataRecord.next())
//            dataRecord = data.GetRecord();
            count = count + 1;
            useProgress (count);
            if (dataRecord.docChapter == currentChapter)

                if (parameters.m_needEveryDayPrinting)
                    if (dataRecord.docDate_carry == currentDate)
                        printNationalReportPart1(parameters, dataRecord);
                    else  /*(dataRecord.docDate_carry != currentDate)*/
                        printNationalReportPart2(parameters, dataRecord);

                        printBankHeader(parameters.m_departmentCode, parameters.m_orgStructure, width, shift);

                        printHeader(dataRecord.docChapter,
                         parameters.m_periodBeginningDate,
                            parameters.m_periodEndingDate,
                                 dataRecord.docdate_carry,
                                                    width,
                                                    shift,
                                                    FALSE);

                        if (parameters.m_needGroupSplit)
                            if (not parameters.m_needOperSplit)
                                printOperResultBackLine(true);   // ‡ ªàë¢ ¥¬ â ¡«¨æã
                            end;
                            printNewGroup(reportData.groupid);
                        end;

                        if (parameters.m_needOperSplit)
                            printNewOper(reportData.docoper);
                        end;

                        if (parameters.m_needPackItog)
                            printNewPack(reportData.docnumber_pack);
                        end;

                        printTableHeader(FALSE, FALSE, parameters.m_needOperSplit);

                        printOneNationalDocument(dataRecord, parameters.m_needApostrophies, parameters.m_needOperSplit);
                        /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                        if (parameters.m_needPackItog)
                            numberOfDocumentsInPack = numberOfDocumentsInPack + 1;
                            summOfDocumentsInPack   = summOfDocumentsInPack + dataRecord.t_equivalentSumm;
                        end;

                        numberOfOperDocuments   = numberOfOperDocuments + 1;
                        summOfOperDocuments     = summOfOperDocuments   + dataRecord.t_equivalentSumm;

                        /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                        if (parameters.m_needPackItog)
                            currentPack = dataRecord.docNumber_Pack;
                        end;
                        if (parameters.m_needGroupSplit)
                            currentGroup   = dataRecord.groupid;
                        end;
                        currentOper  = dataRecord.docOper;
                        currentDate  = dataRecord.docdate_carry;
                    end;  /*(dataRecord.docDate_carry == currentDate)*/
                else /*(parameters.m_needEveryDayPrinting == "")*/
                    printNationalReportPart1(parameters, dataRecord);
                end; /*(parameters.m_needEveryDayPrinting)*/

            else /*(dataRecord.docChapter != currentChapter)*/
                if (parameters.m_needEveryDayPrinting)
                    if (dataRecord.docDate_carry == currentDate)
                        printNationalReportPart1(parameters, dataRecord);
                    else  /*(dataRecord.docDate_carry != currentDate)*/
                        printNationalReportPart2(parameters, dataRecord);

                        printBankHeader(parameters.m_departmentCode, parameters.m_orgStructure, width, shift);

                        printHeader(reportData.docChapter,
                         parameters.m_periodBeginningDate,
                            parameters.m_periodEndingDate,
                                 reportData.docdate_carry,
                                                    width,
                                                    shift,
                                                    FALSE);
                        if (parameters.m_needGroupSplit)
                            printNewGroup(reportData.groupid);
                        end;

                        if (parameters.m_needOperSplit)
                            printNewOper(reportData.docoper);
                        end;

                        if (parameters.m_needPackItog)
                            printNewPack(reportData.docnumber_pack);
                        end;

                        printTableHeader(FALSE, FALSE, parameters.m_needOperSplit);

                        printOneNationalDocument(dataRecord, parameters.m_needApostrophies, parameters.m_needOperSplit);
                        /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                        if (parameters.m_needPackItog)
                            numberOfDocumentsInPack = numberOfDocumentsInPack + 1;
                            summOfDocumentsInPack   = summOfDocumentsInPack + dataRecord.t_equivalentSumm;
                        end;

                        numberOfOperDocuments   = numberOfOperDocuments + 1;
                        summOfOperDocuments     = summOfOperDocuments   + dataRecord.t_equivalentSumm;

                        /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                        if (parameters.m_needGroupSplit)
                            currentGroup   = dataRecord.groupid;
                        end;
                        if (parameters.m_needPackItog)
                            currentPack = dataRecord.docNumber_Pack;
                        end;
                        currentOper  = dataRecord.docOper;
                        currentDate  = dataRecord.docdate_carry;
                        currentChapter = dataRecord.docChapter;
                    end;  /*(dataRecord.docDate_carry == currentDate)*/
                else /*(parameters.m_needEveryDayPrinting == "")*/

                    printNationalReportPart2(parameters, dataRecord);

                    printBankHeader(parameters.m_departmentCode, parameters.m_orgStructure, width, shift);

                    printHeader(reportData.docChapter,
                     parameters.m_periodBeginningDate,
                        parameters.m_periodEndingDate,
                             reportData.docdate_carry,
                                                width,
                                                shift,
                                                TRUE);
                    if (parameters.m_needGroupSplit)
                        printNewGroup(reportData.groupid);
                    end;

                    if (parameters.m_needOperSplit)
                        printNewOper(reportData.docoper);
                    end;

                    if (parameters.m_needPackItog)
                        printNewPack(reportData.docnumber_pack);
                    end;

                    printTableHeader(FALSE, FALSE, parameters.m_needOperSplit);

                    printOneNationalDocument(dataRecord, parameters.m_needApostrophies, parameters.m_needOperSplit);
                    /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                    if (parameters.m_needPackItog)
                        numberOfDocumentsInPack = numberOfDocumentsInPack + 1;
                        summOfDocumentsInPack   = summOfDocumentsInPack + dataRecord.t_equivalentSumm;
                    end;

                    numberOfOperDocuments   = numberOfOperDocuments + 1;
                    summOfOperDocuments     = summOfOperDocuments   + dataRecord.t_equivalentSumm;

                    /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                    if (parameters.m_needGroupSplit)
                        currentGroup = dataRecord.groupid;
                    end;
                    if (parameters.m_needPackItog)
                        currentPack = dataRecord.docNumber_Pack;
                    end;
                    currentOper  = dataRecord.docOper;
                    currentDate  = dataRecord.docdate_carry;
                    currentChapter = dataRecord.docChapter;
                end; /*(parameters.m_needEveryDayPrinting)*/
            end; /*(dataRecord.docChapter == currentChapter)*/
        end; /*while*/

        printNationalReportPart2(parameters, dataRecord);
    END;

    /*”ã­ªæ¨ï § ¯®«­ï¥â í«¥¬¥­âë á¯¨áª®¢ à¥§ã«ìâ â®¢ ¯® ¢ «îâ ¬ ­ã«¥¢ë¬¨ §­ ç¥­¨ï¬¨ (¤«ï ¢ «îâ­®£® ®âç¥â )*/
    MACRO clearAggregates(finalAggregatesList:TArray, currencyList:TArray)
        var  i = 0;
        i = 0;
        while (i < currencyList.size)
            finalAggregatesList[i].m_codeCurrency         = 0;
            finalAggregatesList[i].m_debitSumm            = 0;
            finalAggregatesList[i].m_creditSumm           = 0;
            finalAggregatesList[i].m_equivalentSumm = 0;
            i = i + 1;
        end;
    END;


    MACRO clearOperAgregates(operAggregatesList:TArray, currencyList:TArray)
        var  i = 0;
        while (i < currencyList.size)

            operAggregatesList[i].m_codeCurrency         = 0;
            operAggregatesList[i].m_numberOfDocuments    = 0;
            operAggregatesList[i].m_debitSumm            = 0;
            operAggregatesList[i].m_creditSumm           = 0;
            operAggregatesList[i].m_equivalentSumm = 0;
            i = i + 1;
        end;
    END;

    /*”ã­ªæ¨ï § ¯®«­ï¥â í«¥¬¥­âë á¯¨áª  à¥§ã«ìâ â®¢ ¯ çª¨ ¯® ¢ «îâ ¬ ­ã«¥¢ë¬¨ §­ ç¥­¨ï¬¨ (¤«ï ¢ «îâ­®£® ®âç¥â )*/
    MACRO clearPackAggregates(packAggregatesList:TArray, currencyList:TArray)
        var  i = 0;
        while (i < currencyList.size)
            packAggregatesList[i].m_codeCurrency         = 0;
            packAggregatesList[i].m_numberOfDocuments    = 0;
            packAggregatesList[i].m_debitSumm            = 0;
            packAggregatesList[i].m_creditSumm           = 0;
            packAggregatesList[i].m_equivalentSumm = 0;
            i = i + 1;
        end;
    END;

    /*”ã­ªæ¨ï ¤®¡ ¢«ï¥â ¤ ­­ë¥ ¢ áã¬¬ à­ë¥ §­ ç¥­¨ï (¤«ï ¢ «îâ­®£® ®âç¥â )*/
    MACRO addDataToAggregates(dataString, finalAggregatesList:TArray, currencyList:TArray)
        var i;

        /*¤®¯®«­¨«¨ ®¡é¨¥ ¤ ­­ë¥*/
        finalNumberOfDocuments = finalNumberOfDocuments + 1;

        if (parameters.m_needNationalCurrencyEquivalent)
            if ((dataString.receiverFiId != dataString.payerFiId) and (dataString.t_result_carry != 18)
                                                            and (dataString.t_result_carry != 82)
                                                            and (dataString.t_result_carry != 83)
                                                            and (dataString.t_result_carry != 84))
                if ((parameters.m_paymentsData == TRUE) AND (dataString.docChapter != 3)) /*¤ ­­ë¥ ¨§ ¯« â¥¦¥©*/
                    if ((dataString.payerFiid == dataString.code_currency) or (dataString.payerFiid == NATCUR))
                        equivalentFinalSumm = equivalentFinalSumm + dataString.equivalentSumm;
                    end;
                else
                    equivalentFinalSumm = equivalentFinalSumm + dataString.equivalentSumm;
                end;
            else
                equivalentFinalSumm = equivalentFinalSumm + dataString.equivalentSumm;
            end;
        end;

        i = 0;
        while (i < currencyList.size)
            if (dataString.payerFiid == currencyList[i])
                if (parameters.m_needNationalCurrencyEquivalent)
                    if ((dataString.receiverFiId != dataString.payerFiId) and (dataString.t_result_carry != 18)
                                                                    and (dataString.t_result_carry != 82)
                                                                    and (dataString.t_result_carry != 83)
                                                                    and (dataString.t_result_carry != 84))
                        if ((parameters.m_paymentsData == TRUE) AND (dataString.docChapter != 3)) /*¤ ­­ë¥ ¨§ ¯« â¥¦¥©*/
                            if ((dataString.payerFiid == dataString.code_currency) or (dataString.payerFiid == NATCUR))
                                finalAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                                finalAggregatesList[i].m_debitSumm = finalAggregatesList[i].m_debitSumm + dataString.payerAmount;
                                finalAggregatesList[i].m_creditSumm = finalAggregatesList[i].m_creditSumm +
                                                                     dataString.receiverAmount;

                                finalAggregatesList[i].m_equivalentSumm = finalAggregatesList[i].m_equivalentSumm +
                                                                               dataString.equivalentSumm;
                            end;
                        else
                            finalAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                            finalAggregatesList[i].m_debitSumm = finalAggregatesList[i].m_debitSumm + dataString.payerAmount;
                            finalAggregatesList[i].m_creditSumm = finalAggregatesList[i].m_creditSumm +
                                                                 dataString.receiverAmount;

                            finalAggregatesList[i].m_equivalentSumm = finalAggregatesList[i].m_equivalentSumm +
                                                                           dataString.equivalentSumm;
                        end;
                    else
                        finalAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                        finalAggregatesList[i].m_debitSumm = finalAggregatesList[i].m_debitSumm + dataString.payerAmount;

                        finalAggregatesList[i].m_equivalentSumm = finalAggregatesList[i].m_equivalentSumm
                                                                           + dataString.equivalentSumm;
                    end;
                else
                    finalAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                    finalAggregatesList[i].m_debitSumm = finalAggregatesList[i].m_debitSumm + dataString.payerAmount;

                    if ((dataString.receiverFiId != dataString.payerFiId) and (dataString.t_result_carry != 18)
                                                                    and (dataString.t_result_carry != 82)
                                                                    and (dataString.t_result_carry != 83)
                                                             and (dataString.t_result_carry != 84))
                        finalAggregatesList[i].m_creditSumm = finalAggregatesList[i].m_creditSumm + dataString.receiverAmount;
                    end;
                end;
                break;
            end;
            i = i + 1;
        end;
    END;

    MACRO addDataToOperAggregates(dataString, operAggregatesList:TArray, currencyList:TArray)
        var i;

        /*¤®¯®«­¨«¨ ¤ ­­ë¥ ¯® ®¯¥àã*/
        numberOfOperDocuments = numberOfOperDocuments + 1;

        if (parameters.m_needNationalCurrencyEquivalent)
            if ((dataString.receiverFiId != dataString.payerFiId) and (dataString.t_result_carry != 18)
                                                            and (dataString.t_result_carry != 82)
                                                            and (dataString.t_result_carry != 83)
                                                            and (dataString.t_result_carry != 84))
                if ((parameters.m_paymentsData == TRUE) AND (dataString.docChapter != 3)) /*¤ ­­ë¥ ¨§ ¯« â¥¦¥©*/
                    if ((dataString.payerFiid == dataString.code_currency) or (dataString.payerFiid == NATCUR))
                        equivalentOperSumm = equivalentOperSumm + dataString.equivalentSumm;
                    end;
                else
                    equivalentOperSumm = equivalentOperSumm + dataString.equivalentSumm;
                end;
            else
                equivalentOperSumm = equivalentOperSumm + dataString.equivalentSumm;
            end;
         end;

        i = 0;
        while (i < currencyList.size)
            if (dataString.payerFiid == currencyList[i])
                if (parameters.m_needNationalCurrencyEquivalent)
                    if ((dataString.receiverFiId != dataString.payerFiId) and (dataString.t_result_carry != 18)
                                                                    and (dataString.t_result_carry != 82)
                                                                    and (dataString.t_result_carry != 83)
                                                                    and (dataString.t_result_carry != 84))
                        if ((parameters.m_paymentsData == TRUE) AND (dataString.docChapter != 3)) /*¤ ­­ë¥ ¨§ ¯« â¥¦¥©*/

                            if ((dataString.payerFiid == dataString.code_currency) or (dataString.payerFiid == NATCUR))
                                operAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                                operAggregatesList[i].m_debitSumm = operAggregatesList[i].m_debitSumm + dataString.payerAmount;
                                operAggregatesList[i].m_numberOfDocuments = operAggregatesList[i].m_numberOfDocuments + 1;
                                operAggregatesList[i].m_creditSumm = operAggregatesList[i].m_creditSumm +
                                                                     dataString.receiverAmount;

                                operAggregatesList[i].m_equivalentSumm = operAggregatesList[i].m_equivalentSumm +
                                                                              dataString.equivalentSumm;
                            end;
                        else
                            operAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                            operAggregatesList[i].m_debitSumm = operAggregatesList[i].m_debitSumm + dataString.payerAmount;
                            operAggregatesList[i].m_numberOfDocuments = operAggregatesList[i].m_numberOfDocuments + 1;
                            operAggregatesList[i].m_creditSumm = operAggregatesList[i].m_creditSumm +
                                                                 dataString.receiverAmount;

                            operAggregatesList[i].m_equivalentSumm = operAggregatesList[i].m_equivalentSumm +
                                                                          dataString.equivalentSumm;
                        end;
                    else
                        operAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                        operAggregatesList[i].m_debitSumm = operAggregatesList[i].m_debitSumm + dataString.payerAmount;
                        operAggregatesList[i].m_numberOfDocuments = operAggregatesList[i].m_numberOfDocuments + 1;
                        operAggregatesList[i].m_equivalentSumm = operAggregatesList[i].m_equivalentSumm
                                                                           + dataString.equivalentSumm;
                    end;
                else
                    operAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                    operAggregatesList[i].m_debitSumm = operAggregatesList[i].m_debitSumm + dataString.payerAmount;
                    operAggregatesList[i].m_numberOfDocuments = operAggregatesList[i].m_numberOfDocuments + 1;

                    if ((dataString.receiverFiId != dataString.payerFiId) and (dataString.t_result_carry != 18)
                                                                    and (dataString.t_result_carry != 82)
                                                                    and (dataString.t_result_carry != 83)
                                                                    and (dataString.t_result_carry != 84))
                        operAggregatesList[i].m_creditSumm = operAggregatesList[i].m_creditSumm +
                                                                         dataString.receiverAmount;
                    end;
                end;
                break;
            end;
            i = i + 1;
        end;

    END;


    MACRO addDataToPackAggregates(dataString, packAggregatesList:TArray, currencyList:TArray)
        var i = 0;
        var ww;
        ww = currencyList.size;

        numberOfDocumentsInPack = numberOfDocumentsInPack + 1;
        if (parameters.m_needNationalCurrencyEquivalent)
            if ((dataString.receiverFiId != dataString.payerFiId) and (dataString.t_result_carry != 18)
                                                            and (dataString.t_result_carry != 82)
                                                            and (dataString.t_result_carry != 83)
                                                            and (dataString.t_result_carry != 84))
                if ((parameters.m_paymentsData == TRUE) AND (dataString.docChapter != 3)) /*¤ ­­ë¥ ¨§ ¯« â¥¦¥©*/
                    if ((dataString.payerFiid == dataString.code_currency) or (dataString.payerFiid == NATCUR))
                        equivalentSummInPack = equivalentSummInPack + dataString.equivalentSumm;
                    end;
                else
                    equivalentSummInPack = equivalentSummInPack + dataString.equivalentSumm;
                end;
            else
                equivalentSummInPack = equivalentSummInPack + dataString.equivalentSumm;
            end;
        end;

        i = 0;
        while (i < ww)
            if (dataString.payerFiid == currencyList[i])
                if (parameters.m_needNationalCurrencyEquivalent)
                    if ((dataString.receiverFiId != dataString.payerFiId) and (dataString.t_result_carry != 18)
                                                                    and (dataString.t_result_carry != 82)
                                                                    and (dataString.t_result_carry != 83)
                                                                    and (dataString.t_result_carry != 84))
                        if ((parameters.m_paymentsData == TRUE) AND (dataString.docChapter != 3)) /*¤ ­­ë¥ ¨§ ¯« â¥¦¥©*/
                            if ((dataString.payerFiid == dataString.code_currency) or (dataString.payerFiid == NATCUR))
                                packAggregatesList[i].m_numberOfDocuments = packAggregatesList[i].m_numberOfDocuments + 1;
                                packAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                                packAggregatesList[i].m_debitSumm = packAggregatesList[i].m_debitSumm + dataString.payerAmount;
                                packAggregatesList[i].m_creditSumm = packAggregatesList[i].m_creditSumm +
                                                                     dataString.receiverAmount;

                                packAggregatesList[i].m_equivalentSumm = packAggregatesList[i].m_equivalentSumm +
                                                                               dataString.equivalentSumm;
                            end;
                        else
                            packAggregatesList[i].m_numberOfDocuments = packAggregatesList[i].m_numberOfDocuments + 1;
                            packAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                            packAggregatesList[i].m_debitSumm = packAggregatesList[i].m_debitSumm + dataString.payerAmount;
                            packAggregatesList[i].m_creditSumm = packAggregatesList[i].m_creditSumm +
                                                                 dataString.receiverAmount;

                            packAggregatesList[i].m_equivalentSumm = packAggregatesList[i].m_equivalentSumm +
                                                                           dataString.equivalentSumm;
                        end;
                    else
                        packAggregatesList[i].m_numberOfDocuments = packAggregatesList[i].m_numberOfDocuments + 1;
                        packAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                        packAggregatesList[i].m_debitSumm = packAggregatesList[i].m_debitSumm + dataString.payerAmount;
                        packAggregatesList[i].m_equivalentSumm = packAggregatesList[i].m_equivalentSumm
                                                                           + dataString.equivalentSumm;
                    end;
                else
                    packAggregatesList[i].m_numberOfDocuments = packAggregatesList[i].m_numberOfDocuments + 1;
                    packAggregatesList[i].m_codeCurrency = dataString.payerFiid;
                    packAggregatesList[i].m_debitSumm = packAggregatesList[i].m_debitSumm + dataString.payerAmount;

                    if ((dataString.receiverFiId != dataString.payerFiId) and (dataString.t_result_carry != 18)
                                                                    and (dataString.t_result_carry != 82)
                                                                    and (dataString.t_result_carry != 83)
                                                                    and (dataString.t_result_carry != 84))
                        packAggregatesList[i].m_creditSumm = packAggregatesList[i].m_creditSumm +
                                                                         dataString.receiverAmount;
                    end;
                end;
                break;
            end;
            i = i + 1;
        end;
    END;

    MACRO addOperAgregatesToFinalAggregates(finalAggregatesList:TArray, operAggregatesList:TArray)

        var i;

        finalNumberOfDocuments = finalNumberOfDocuments + numberOfOperDocuments;
        equivalentFinalSumm    = equivalentFinalSumm + equivalentOperSumm;

        i = 0;
        while (i < operAggregatesList.size)
            if (
                (operAggregatesList[i].m_debitSumm      != 0) or
                (operAggregatesList[i].m_creditSumm     != 0) or
                (operAggregatesList[i].m_equivalentSumm != 0)
               )

                finalAggregatesList[i].m_codeCurrency = operAggregatesList[i].m_codeCurrency;

                finalAggregatesList[i].m_debitSumm =
                finalAggregatesList[i].m_debitSumm + operAggregatesList[i].m_debitSumm;
                finalAggregatesList[i].m_creditSumm =
                finalAggregatesList[i].m_creditSumm + operAggregatesList[i].m_creditSumm;

                finalAggregatesList[i].m_equivalentSumm =
                finalAggregatesList[i].m_equivalentSumm + operAggregatesList[i].m_equivalentSumm;
            end;
            i = i + 1;
        end;

    END;

    /*”ã­ªæ¨ï § ¯®¬¨­ ¥â â¥ªãé¨¥ §­ ç¥­¨ï (¤«ï ¢ «îâ­®£® ®âç¥â )*/
    MACRO setCurrentValues(dataString)
        currentChapter = dataString.docchapter;
        if (parameters.m_needEveryDayPrinting)
           currentDate = dataString.docdate_carry;
        end;
        if (parameters.m_needGroupSplit)
            currentGroup   = dataString.groupid
        end;
        currentOper    = dataString.docOper;
        if (parameters.m_needPackItog)
           currentPack = dataString.docNumber_Pack;
        end;
    END;

    /*ä®à¬«¥­¨¥ § ¢¥àè¥­¨ï ¯ çª¨*/
    MACRO performPackResult(parameters1:TReportParameters, recordForPrinting1, currencyList:TArray)
        var i;
        /*­ ¯¥ç â «¨ ¨â®£ ¯® ¯ çª¥*/
        if (parameters1.m_needNationalCurrencyEquivalent)
            printPackResultInForeignReport(numberOfDocumentsInPack, equivalentSummInPack, TRUE, parameters1.m_needApostrophies, parameters1.m_needOperSplit);
        else
            printPackResultInForeignReport(numberOfDocumentsInPack, 0, FALSE, parameters1.m_needApostrophies, parameters1.m_needOperSplit);
        end;
        /*­ ¯¥ç â «¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ¯ çª¥*/
        printAggregatesByCurrencies(listOfAggregatesInPack,
              parameters1.m_needNationalCurrencyEquivalent,
                            parameters1.m_needApostrophies,
                               parameters1.m_needOperSplit, false);
        /*á«®¦¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ¯ çª¥ ¢ á¯¨á®ª*/
        i = 0;
        while (i < listOfAggregatesInPack.size)
            if (parameters1.m_needNationalCurrencyEquivalent)
               if ((listOfAggregatesInPack[i].m_debitSumm      != 0) or
                   (listOfAggregatesInPack[i].m_creditSumm     != 0) or
                   (listOfAggregatesInPack[i].m_equivalentSumm != 0)
                  )
                   currentReportAggregates = TReportAggregates(currentOper,
                                                               currentPack,
                                  listOfAggregatesInPack[i].m_codeCurrency,
                                                                         0,
                                     listOfAggregatesInPack[i].m_debitSumm,
                                listOfAggregatesInPack[i].m_equivalentSumm,
                                                                         0,
                                                                         0,
                                                                         0,
                                                                         0,
                                                                         0,
                                                                         0,
                             listOfAggregatesInPack[i].m_numberOfDocuments,
                                                                         0,
                                                                         0,
                                                                         0,
                                                                         0);
                   if (not (parameters1.m_needGroupSplit AND usedOpersList.havePair(currentOper, currentPack)))
                       listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
                   end;

               end;
            else
               if ((listOfAggregatesInPack[i].m_debitSumm            != 0) or
                   (listOfAggregatesInPack[i].m_creditSumm           != 0)
                  )
                   currentReportAggregates = TReportAggregates(currentOper,
                                                               currentPack,
                                  listOfAggregatesInPack[i].m_codeCurrency,
                                                                         0,
                                     listOfAggregatesInPack[i].m_debitSumm,
                                                                         0,
                                                                         0,
                                                                         0,
                                                                         0,
                                                                         0,
                                                                         0,
                                                                         0,
                             listOfAggregatesInPack[i].m_numberOfDocuments,
                                                                         0,
                                                                         0,
                                                                         0,
                                                                         0);
                   if (not (parameters1.m_needGroupSplit AND usedOpersList.havePair(currentOper, currentPack)))
                       listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
                   end;

               end;
            end;
            i = i + 1;
        end;

        if (not (parameters1.m_needGroupSplit AND usedOpersList.havePair(currentOper, currentPack)))
            usedOpersList.addPair(currentOper, currentPack);
        end;

        /*®¡­ã«¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ¯ çª¥*/
        numberOfDocumentsInPack    = 0;
        summOfDocumentsInPack      = 0;
        equivalentSummInPack = 0;

        clearPackAggregates(listOfAggregatesInPack, currencyList);
    END;

    /*ä®à¬«¥­¨¥ § ¢¥àè¥­¨ï ®¯¥à */
    MACRO performOperResult(parameters1:TReportParameters, recordForPrinting1, currencyList:TArray)
        var i;
        /*­ ¯¥ç â «¨ ¨â®£ ¯® ®¯¥àã*/
        if (parameters1.m_needNationalCurrencyEquivalent)
            printOperResultInForeignReport(numberOfOperDocuments,
                                              equivalentOperSumm,
                                                            TRUE,
                                      parameters1.m_needPackItog,
                                  parameters1.m_needApostrophies,
                                     parameters1.m_needOperSplit);
        else
            printOperResultInForeignReport(numberOfOperDocuments,
                                                               0,
                                                           FALSE,
                                      parameters1.m_needPackItog,
                                  parameters1.m_needApostrophies,
                                     parameters1.m_needOperSplit);
        end;
        /*­ ¯¥ç â «¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ®¯¥àã*/
        printAggregatesByCurrencies(listOfAggregatesOfOper,
              parameters1.m_needNationalCurrencyEquivalent,
                            parameters1.m_needApostrophies,
                               parameters1.m_needOperSplit, false);

        /*á«®¦¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ®¯¥àã ¢ á¯¨á®ª*/
        /*®¡é¥¥ ª®«¨ç¥áâ¢® ¤®ªã¬¥­â®¢ ¯® ®¯¥àã*/
        if (parameters1.m_needNationalCurrencyEquivalent)
            currentReportAggregates = TReportAggregates(currentOper,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                              numberOfOperDocuments,
                                                                  0,
                                                 equivalentOperSumm,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0);
        else
            currentReportAggregates = TReportAggregates(currentOper,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                              numberOfOperDocuments,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0,
                                                                  0);
        end;

        if (not (parameters1.m_needGroupSplit AND usedOpersList.haveSingle(currentOper)))
            listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
        end;

        i = 0;
        /*¤ ­­ë¥ ¯® ®¯¥àã ¢ à §à¥§¥ ¢ «îâ*/
        while (i < listOfAggregatesOfOper.size)
            if (parameters1.m_needNationalCurrencyEquivalent)
               if ((listOfAggregatesOfOper[i].m_debitSumm      != 0) or
                   (listOfAggregatesOfOper[i].m_creditSumm     != 0) or
                   (listOfAggregatesOfOper[i].m_equivalentSumm != 0)
                  )
                   currentReportAggregates = TReportAggregates(0,
                                                               0,
                        listOfAggregatesOfOper[i].m_codeCurrency,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                           listOfAggregatesOfOper[i].m_debitSumm,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                   listOfAggregatesOfOper[i].m_numberOfDocuments,
                                                               0,
                                                               0,
                      listOfAggregatesOfOper[i].m_equivalentSumm);

                 if (not (parameters1.m_needGroupSplit AND usedOpersList.haveSingle(currentOper)))
                     listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
                 end
               end;
            else
               if ((listOfAggregatesOfOper[i].m_debitSumm            != 0) or
                   (listOfAggregatesOfOper[i].m_creditSumm           != 0)
                  )
                  currentReportAggregates = TReportAggregates(0,
                                                              0,
                       listOfAggregatesOfOper[i].m_codeCurrency,
                                                              0,
                                                              0,
                                                              0,
                                                              0,
                          listOfAggregatesOfOper[i].m_debitSumm,
                                                              0,
                                                              0,
                                                              0,
                                                              0,
                                                              0,
                  listOfAggregatesOfOper[i].m_numberOfDocuments,
                                                              0,
                                                              0,
                                                              0);
                 if (not (parameters1.m_needGroupSplit AND usedOpersList.haveSingle(currentOper)))
                     listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
                 end
               end;
            end;
            i = i + 1;
        end;

        if (not (parameters1.m_needGroupSplit AND usedOpersList.haveSingle(currentOper)))
            addOperAgregatesToFinalAggregates(listOfFinalAggregates, listOfAggregatesOfOper);
            usedOpersList.addSingle(currentOper);
        end;

        /*®¡­ã«¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¯® ®¯¥àã*/
        numberOfOperDocuments    = 0;
        summOfOperDocuments      = 0;
        equivalentOperSumm = 0;
        clearOperAgregates(listOfAggregatesOfOper, currencyList);
    END;

    MACRO performPrintOneCurrencyDocument (parameters1:TReportParameters, recordForPrinting1)
        if ((parameters1.m_paymentsData == TRUE) AND (recordForPrinting1.docChapter != 3)) /*¤ ­­ë¥ ¨§ ¯« â¥¦¥©*/
            if (useProtocol)
                /*˜ˆŠ€ 1 - ‚ ’Š‹ (­¥â ¯« â¥¦ )*/
                if (recordForPrinting1.paymentIdNotNull == 0)
                    addRecordToProtocol(recordForPrinting1, 1);
                end;
            end;
        end;

        if (parameters1.m_needNationalCurrencyEquivalent)
            printOneForeignCurrencyDocument(parameters1, recordForPrinting1, recordForPrinting1.equivalentSumm);
        else
            printOneForeignCurrencyDocument(parameters1, recordForPrinting1, 0);
        end;
    END;

    /*”ã­ªæ¨ï ¯¥ç â ¥â äà £¬¥­â ®âç¥â  ¢ ¨­.¢ «îâ¥ â®«ìª® á ¤ ­­ë¬¨ ¯® ®¯¥à ¬ ¨ ¯ çª ¬*/
    MACRO printForeignCurrencyReportPart1(parameters1:TReportParameters, recordForPrinting1, currencyList:TArray)
         var i = 0;
        if (((recordForPrinting1.docOper == currentOper) AND (not parameters1.m_needGroupSplit)) OR
            ((recordForPrinting1.docOper == currentOper) AND (parameters1.m_needGroupSplit) AND
             (recordForPrinting1.groupid == currentGroup)))

             if (parameters1.m_needPackItog)
                 if (recordForPrinting1.docNumber_Pack == currentPack)
                     /*­ ¯¥ç â «¨ ¤®ªã¬¥­â*/
                     performPrintOneCurrencyDocument (parameters1, recordForPrinting1);
                     /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                     addDataToPackAggregates(recordForPrinting1, listOfAggregatesInPack, currencyList);
                     addDataToOperAggregates(recordForPrinting1, listOfAggregatesOfOper, currencyList);

                     /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                     setCurrentValues(recordForPrinting1);
                 else /*(recordForPrinting1.docNumberPack != currentPack)*/
                     /*ä®à¬¨«¨ § ¢¥àè¥­¨¥ ¯ çª¨*/
                     performPackResult(parameters1, recordForPrinting1, currencyList);
                     printNewPack(recordForPrinting1.docNumber_pack);

                     printTableHeader(TRUE, parameters1.m_needNationalCurrencyEquivalent, parameters.m_needOperSplit);

                     /*­ ¯¥ç â «¨ ¤®ªã¬¥­â*/
                     performPrintOneCurrencyDocument (parameters1, recordForPrinting1);                     /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                     addDataToPackAggregates(recordForPrinting1, listOfAggregatesInPack, currencyList);
                     addDataToOperAggregates(recordForPrinting1, listOfAggregatesOfOper, currencyList);

                     /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                     setCurrentValues(recordForPrinting1);
                 end;/*(recordForPrinting1.docNumberPack == currentPack)*/
             else/*(parameters1.m_needPackItog == "")*/
                 /*­ ¯¥ç â «¨ ¤®ªã¬¥­â*/
                 performPrintOneCurrencyDocument(parameters1, recordForPrinting1);
                 /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                 addDataToOperAggregates(recordForPrinting1, listOfAggregatesOfOper, currencyList);
             end;/*(parameters1.m_needPackItog)*/
         else  /*(recordForPrinting1.docOper != currentOper)*/
             if (parameters1.m_needPackItog)
                 /*ä®à¬¨«¨ § ¢¥àè¥­¨¥ ¯ çª¨*/
                 performPackResult(parameters1, recordForPrinting1, currencyList);
             end;/*(parameters1.m_needPackItog)*/

             performOperResult(parameters1, recordForPrinting1, currencyList);

             if ((parameters1.m_needGroupSplit) AND (recordForPrinting1.groupid != currentGroup))
                 if (not parameters1.m_needOperSplit)
                     printOperForeignResultBackLine(true, parameters1.m_needNationalCurrencyEquivalent);   // ‡ ªàë¢ ¥¬ â ¡«¨æã
                 end;
                 printNewGroup(recordForPrinting1.groupid);
             else
                 if (not parameters1.m_needOperSplit)
                     printOperForeignResultBackLine(false, parameters1.m_needNationalCurrencyEquivalent);   // ¯à®¤®«¦ ¥¬ â ¡«¨æã
                 end;
             end;

             if (parameters1.m_needOperSplit)
                 printNewOper(recordForPrinting1.docOper);
             end;

             if (parameters1.m_needPackItog)
                 printNewPack(recordForPrinting1.docNumber_pack);
             end;

             if (parameters1.m_needOperSplit OR
                 ((parameters1.m_needGroupSplit) AND (reportData.groupid != currentGroup)))
                 printTableHeader(TRUE, parameters1.m_needNationalCurrencyEquivalent, parameters.m_needOperSplit);
             end;

             /*­ ¯¥ç â «¨ ¤®ªã¬¥­â*/
             performPrintOneCurrencyDocument (parameters1, recordForPrinting1);
             /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
             if (parameters1.m_needPackItog)
                 addDataToPackAggregates(recordForPrinting1, listOfAggregatesInPack, currencyList);
             end;
             addDataToOperAggregates(recordForPrinting1, listOfAggregatesOfOper, currencyList);

             /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
             setCurrentValues(recordForPrinting1);
         end;  /*(recordForPrinting1.docOper == currentOper)*/
    END;

    MACRO performFinalResult(parametersF, recordForPrintingF, currencyList:TArray)
        var i;
        /*­ ¯¥ç â «¨ ®¡é¨© ¨â®£*/
        if (parametersF.m_needNationalCurrencyEquivalent)
            printFinalResultInForeignReport(finalNumberOfDocuments,
                                               equivalentFinalSumm,
                                                              TRUE,
                                    parametersF.m_needApostrophies,
                                       parametersF.m_needOperSplit);
        else
            printFinalResultInForeignReport(finalNumberOfDocuments,
                                                                 0,
                                                             FALSE,
                                    parametersF.m_needApostrophies,
                                       parametersF.m_needOperSplit);
        end;
        /*­ ¯¥ç â «¨ ®¡é¨¥  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
        printAggregatesByCurrencies(listOfFinalAggregates,
             parametersF.m_needNationalCurrencyEquivalent,
                           parametersF.m_needApostrophies,
                              parametersF.m_needOperSplit,
                                                    true);

        /*á«®¦¨«¨ ®¡é¨¥  £à¥£¨àãîé¨¥ ¤ ­­ë¥ ¢ á¯¨á®ª*/
        if (parametersF.m_needNationalCurrencyEquivalent)
            currentReportAggregates = TReportAggregates(0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                   finalNumberOfDocuments,
                                      equivalentFinalSumm,
                                                        0);
        else
            currentReportAggregates = TReportAggregates(0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                                        0,
                                   finalNumberOfDocuments,
                                                        0,
                                                        0);
        end;
        listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;

        i = 0;
        while (i < listOfFinalAggregates.size)
            if (parametersF.m_needNationalCurrencyEquivalent)
               if ((listOfFinalAggregates[i].m_debitSumm      != 0) or
                   (listOfFinalAggregates[i].m_creditSumm     != 0) or
                   (listOfFinalAggregates[i].m_equivalentSumm != 0)
                  )
                   currentReportAggregates = TReportAggregates(0,
                                                               0,
                         listOfFinalAggregates[i].m_codeCurrency,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                            listOfFinalAggregates[i].m_debitSumm,
                       listOfFinalAggregates[i].m_equivalentSumm,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0);
                   listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
               end;
            else
               if ((listOfFinalAggregates[i].m_debitSumm   != 0) or
                   (listOfFinalAggregates[i].m_creditSumm  != 0)
                  )
                   currentReportAggregates = TReportAggregates(0,
                                                               0,
                         listOfFinalAggregates[i].m_codeCurrency,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                            listOfFinalAggregates[i].m_debitSumm,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0,
                                                               0);
                   listOfReportAggregates[listOfReportAggregates.size] = currentReportAggregates;
               end;
            end;
            i = i + 1;
        end;
        /*®¡­ã«¨«¨ ®¡é¨¥  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
        finalNumberOfDocuments = 0;
        /*…á«¨ ¥áâì íª¢¨¢ «¥­â*/
        equivalentFinalSumm = 0;

        clearAggregates(listOfFinalAggregates, currencyList);
    END;

    MACRO printForeignCurrencyReportPart2(parameters2:TReportParameters, recordForPrinting2, currencyList:TArray)
         var j;

         if (parameters2.m_needPackItog)
             /*­ ¯¥ç â «¨ ¨â®£ ¯® ¯ çª¥*/
             performPackResult(parameters2, recordForPrinting2, currencyList);
         end;/*(parameters2.m_needPackItog)*/

         performOperResult(parameters2, recordForPrinting2, currencyList);

         if (not parameters2.m_needOperSplit)
             printOperForeignResultBackLine(true, parameters2.m_needNationalCurrencyEquivalent);   // ‡ ªàë¢ ¥¬ â ¡«¨æã
         end;

         performFinalResult(parameters2, recordForPrinting2, currencyList);

         /* ¯¥ç â «¨ â ¡«¨çªã á à¥§ã«ìâ â ¬¨ ¤ ­­ëå*/
         printTableWithForeignResults (parameters2, listOfReportAggregates, currentDate, currentChapter);

         /*®ç¨áâ¨«¨ á¯¨á®ª à¥§ã«ìâ â®¢*/
         j = 0;
         while (j < listOfReportAggregates.size)
             listOfReportAggregates[j].m_operCode                         = 0;
             listOfReportAggregates[j].m_packNumber                       = 0;
             listOfReportAggregates[j].m_currencyCode                     = 0;
             listOfReportAggregates[j].m_packNumberOfDocuments            = 0;
             listOfReportAggregates[j].m_packSumm                         = 0;
             listOfReportAggregates[j].m_packCoveringSumm                 = 0;
             listOfReportAggregates[j].m_operNumberOfDocuments            = 0;
             listOfReportAggregates[j].m_operSumm                         = 0;
             listOfReportAggregates[j].m_operCoveringSumm                 = 0;
             listOfReportAggregates[j].m_currencyNumberOfDocuments        = 0;
             listOfReportAggregates[j].m_currencySumm                     = 0;
             listOfReportAggregates[j].m_currencyCoveringSumm             = 0;
             listOfReportAggregates[j].m_documentsNumberInOneCurrency     = 0;
             listOfReportAggregates[j].m_operDocumentsNumberInOneCurrency = 0;
             listOfReportAggregates[j].m_finalNumberOfDocuments           = 0;
             listOfReportAggregates[j].m_finalEquivalentSumm              = 0;
             listOfReportAggregates[j].m_operCoveringSummInOneCurrency    = 0;
             j = j + 1;
         end;

         usedOpersList.clear();

         /* ¯¥ç â «¨ ¯®¤¯¨á¨*/
         printSignatures();
         printLn();
    END;

    /*¥ç âì ®âç¥â  ¢ ¨­.¢ «îâ¥ ¨«¨ ®¡é¥£® ®âç¥â */
    MACRO printForeignReport(parameters:TReportParameters, dataRecord /*dataForPrint*/, currencyList:TArray)
        var i = 0;
//        var dataRecord;

        useProgress (count);
        /*¯à®¨­¨æ¨ «¨§¨à®¢ «¨ á¯¨áª¨ à¥§ã«ìâ¨àãîé¨å ¤ ­­ëå ­ã«¥¢ë¬¨ §­ ç¥­¨ï¬¨*/
        while (i < currencyList.size)
            listOfAggregatesInPack[i] = TOneCurrencyAggregatesInPack(0,0,0,0,0);
            listOfAggregatesOfOper[i] = TOneCurrencyAggregatesByOper(0,0,0,0,0);
            listOfFinalAggregates[i]  = TFinalOneCurrencyAggregates(0,0,0,0);
            i = i + 1;
        end;

        printTableHeader(TRUE, parameters.m_needNationalCurrencyEquivalent, parameters.m_needOperSplit);
        /*­ ¯¥ç â «¨ ¤®ªã¬¥­â*/
        performPrintOneCurrencyDocument(parameters, /*dataForPrint*/dataRecord);

        /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
        if (parameters.m_needPackItog)
            addDataToPackAggregates(dataRecord/*dataForPrint*/, listOfAggregatesInPack, currencyList);
        end;
        addDataToOperAggregates(dataRecord/*dataForPrint*/, listOfAggregatesOfOper, currencyList);
        setCurrentValues(dataRecord/*dataForPrint*/);
        /*¯¥ç â ¥¬ ®áâ «ì­ë¥ § ¯¨á¨ ®âç¥â */
        while (dataRecord/*dataForPrint*/.next())
//            dataRecord = dataForPrint.GetRecord();
            count = count + 1;
            useProgress (count);
            if (dataRecord.docChapter == currentChapter)
                if (parameters.m_needEveryDayPrinting)
                    if (dataRecord.docDate_carry == currentDate)
                        printForeignCurrencyReportPart1(parameters, dataRecord, currencyList);
                    else  /*(dataRecord.docDate_carry != currentDate)*/
                        printForeignCurrencyReportPart2(parameters, dataRecord, currencyList);

                        printBankHeader(parameters.m_departmentCode, parameters.m_orgStructure, width, shift);

                        printHeader(dataRecord.docChapter,
                         parameters.m_periodBeginningDate,
                            parameters.m_periodEndingDate,
                                 dataRecord.docdate_carry,
                                                    width,
                                                    shift,
                                                    FALSE);
                        if (parameters.m_needGroupSplit)
                            if (not parameters.m_needOperSplit)
                                printOperForeignResultBackLine(true, parameters.m_needNationalCurrencyEquivalent);   // ‡ ªàë¢ ¥¬ â ¡«¨æã
                            end;
                            printNewGroup(dataRecord.groupid);
                        end;

                        if (parameters.m_needOperSplit)
                            printNewOper(dataRecord.docoper);
                        end;

                        if (parameters.m_needPackItog)
                            printNewPack(dataRecord.docnumber_pack);
                        end;

                        printTableHeader(TRUE, parameters.m_needNationalCurrencyEquivalent, parameters.m_needOperSplit);

                        performPrintOneCurrencyDocument (parameters, dataRecord);

                        /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                        if (parameters.m_needPackItog)
                            addDataToPackAggregates(dataRecord, listOfAggregatesInPack, currencyList);
                        end;
                        addDataToOperAggregates(dataRecord, listOfAggregatesOfOper, currencyList);

                        /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                        setCurrentValues(dataRecord);
                    end;  /*(dataRecord.docDate_carry == currentDate)*/
                else /*(parameters.m_needEveryDayPrinting == "")*/
                    printForeignCurrencyReportPart1(parameters, dataRecord, currencyList);
                end; /*(parameters.m_needEveryDayPrinting)*/
            else /*(dataRecord.docChapter != currentChapter)*/
                if (parameters.m_needEveryDayPrinting)
                    if (dataRecord.docDate_carry == currentDate)
                        printForeignCurrencyReportPart1(parameters, dataRecord, currencyList);
                    else  /*(dataRecord.docDate_carry != currentDate)*/
                        printForeignCurrencyReportPart2(parameters, dataRecord, currencyList);

                        printBankHeader(parameters.m_departmentCode, parameters.m_orgStructure, width, shift);

                        printHeader(dataRecord.docChapter,
                         parameters.m_periodBeginningDate,
                            parameters.m_periodEndingDate,
                                 dataRecord.docdate_carry,
                                                    width,
                                                    shift,
                                                    FALSE);
                        if (parameters.m_needGroupSplit)
                            printNewGroup(dataRecord.groupid);
                        end;

                        if (parameters.m_needOperSplit)
                            printNewOper(dataRecord.docoper);
                        end;

                        if (parameters.m_needPackItog)
                            printNewPack(dataRecord.docnumber_pack);
                        end;

                        printTableHeader(TRUE, parameters.m_needNationalCurrencyEquivalent, parameters.m_needOperSplit);

                        performPrintOneCurrencyDocument (parameters, dataRecord);

                        /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                        if (parameters.m_needPackItog)
                            addDataToPackAggregates(dataRecord, listOfAggregatesInPack, currencyList);
                        end;
                        addDataToOperAggregates(dataRecord, listOfAggregatesOfOper, currencyList);

                        /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                        setCurrentValues(dataRecord);
                    end;  /*(dataRecord.docDate_carry == currentDate)*/
                else /*(parameters.m_needEveryDayPrinting == "")*/
//                    printForeignCurrencyReportPart1(parameters, dataRecord, currencyList);

                    printForeignCurrencyReportPart2(parameters, dataRecord, currencyList);

                    printBankHeader(parameters.m_departmentCode, parameters.m_orgStructure, width, shift);

                    printHeader(dataRecord.docChapter,
                     parameters.m_periodBeginningDate,
                        parameters.m_periodEndingDate,
                             dataRecord.docdate_carry,
                                                width,
                                                shift,
                                                TRUE);
                    if (parameters.m_needGroupSplit)
                        printNewGroup(dataRecord.groupid);
                    end;

                    if (parameters.m_needOperSplit)
                        printNewOper(dataRecord.docoper);
                    end;

                    if (parameters.m_needPackItog)
                        printNewPack(dataRecord.docnumber_pack);
                    end;

                    printTableHeader(TRUE, parameters.m_needNationalCurrencyEquivalent, parameters.m_needOperSplit);

                    performPrintOneCurrencyDocument(parameters, dataRecord);

                    /*¤®¯®«­¨«¨  £à¥£¨àãîé¨¥ ¤ ­­ë¥*/
                    if (parameters.m_needPackItog)
                        addDataToPackAggregates(dataRecord, listOfAggregatesInPack, currencyList);
                    end;
                    addDataToOperAggregates(dataRecord, listOfAggregatesOfOper, currencyList);

                    /*§ ¯®¬­¨«¨ â¥ªãé¨¥ §­ ç¥­¨ï*/
                    setCurrentValues(dataRecord);
                end; /*(parameters.m_needEveryDayPrinting)*/
            end; /*(dataRecord.docChapter == currentChapter)*/
        end; /*while*/

        printForeignCurrencyReportPart2(parameters, dataRecord, currencyList);
        /*end;*/
    END;

    if (useProtocol)
        SQL_Truncate(tempProtocolTableName);
        tempInserter = TRsbDataSet("SELECT * FROM " + tempProtocolTableName
                          + "\n" + " WHERE 0 = 1",
                                   RSDVAL_CLIENT, RSDVAL_STATIC);
    end;

    begAction(1000, "®«ãç¥­¨¥ ¤ ­­ëå...");

    reportData = TRsbDataSet(resultQuery(parameters));

    reportData.setFieldType("t_date_document", V_DATE);
    reportData.setFieldType("t_code_currency", V_INTEGER);
    reportData.setFieldType("t_receiverAmount", V_MONEY);
    reportData.setFieldType("t_payerAmount", V_MONEY);
    reportData.setFieldType("t_receiverFiId", V_INTEGER);
    reportData.setFieldType("t_payerFiId", V_INTEGER);
    reportData.setFieldType("t_paymentIdNotNull", V_INTEGER);
    reportData.setFieldType("t_docsum", V_MONEY);
    reportData.setFieldType("t_docoper", V_INTEGER);
    reportData.setFieldType("t_docchapter", V_INTEGER);
    reportData.setFieldType("t_docdate_carry", V_DATE);
    reportData.setFieldType("t_docnumber_pack", V_INTEGER);
    reportData.setFieldType("t_accTrnId", V_INTEGER);
    reportData.setFieldType("t_equivalentSumm", V_MONEY);

    if (useProtocol)
        reportData.setFieldType("t_doccode_currency", V_INTEGER);
    end;

    if (parameters.m_needNationalCurrencyEquivalent)
        reportData.setFieldType("t_carryIdNotNull", V_INTEGER);
    end;

    if (parameters.m_needGroupSplit)
        reportData.setFieldType("t_groupId", V_INTEGER);
        reportData.setFieldType("t_groupIdNull", V_INTEGER);
    end;

    endAction();

    isDataRecords = reportData.next();

    initProgress(-1, "", "¥ç âì ®âç¥â ");

    count = count + 1;

    if (isDataRecords == TRUE)

        if (parameters.m_currencyCode == NATCUR)
            width = 104;      //104
            shift = 0;
        else
            width = 146;      //198
            shift = 0;
        end;

        if (parameters.m_needNationalCurrencyEquivalent)
            width = width + 52;
        end;

        if (not parameters.m_needOperSplit)
            width = width + 9;
        end;

        printBankHeader(parameters.m_departmentCode, parameters.m_orgStructure, width, shift);

        if (parameters.m_needEveryDayPrinting)
            printHeader(reportData.docChapter,
             parameters.m_periodBeginningDate,
                parameters.m_periodEndingDate,
                     reportData.docdate_carry,
                                        width,
                                        shift,
                                        FALSE);
        else
            printHeader(reportData.docChapter,
             parameters.m_periodBeginningDate,
                parameters.m_periodEndingDate,
                parameters.m_periodEndingDate,
                                        width,
                                        shift,
                                        TRUE);
        end;

        if (parameters.m_needGroupSplit)
            printNewGroup(reportData.groupid);
        end;

        if (parameters.m_needOperSplit)
            printNewOper(reportData.docoper);
        end;

        if (parameters.m_needPackItog)
            printNewPack(reportData.docnumber_pack);
        end;

        if (parameters.m_currencyCode == NATCUR)
            printNationalReport(parameters, reportData);
        else
            /*‡ ¯®«­ï¥¬ á¯¨á®ª ¢ «îâ*/
            currencyList = TArray;
            currencyList = getCurrencyList(currencyList);

            printForeignReport(parameters, reportData, currencyList);
        end;

    else
    /*ãáâ®© ®âç¥â*/
        PrintBankHeader(parameters.m_departmentCode, parameters.m_orgStructure, width, shift);

        printHeader(parameters.m_chapterNumber,
              parameters.m_periodBeginningDate,
                 parameters.m_periodEndingDate,
                 parameters.m_periodEndingDate, /*¬®¦­® ¯¥à¥¤ âì «î¡®¥ §­ ç¥­¨¥, â.ª. ¢á¥ à ¢­® ¯¥ç â â¥¬ §  ¯¥à¨®¤*/
                                         width,
                                         shift,
                                         TRUE);

        if (parameters.m_operNumber != 0)
            printNewOper(parameters.m_operNumber);
        end;

        if (parameters.m_packNumber != 0)
            printNewPack(parameters.m_packNumber);
        end;

        printLn();
        println(mkStr(" ", shift) + StrAlign("¥â ¤ ­­ëå ¤«ï ®âç¥â ", width, STR_ALIGN_CENTER));
        printSignatures();
    end;

    remProgress();
END;

MACRO printHeaderOfProtocol(dateForPrint)
     var dateOfReport;
     var timeOfReport;

     dtTmSplit (dateForPrint, dateOfReport, timeOfReport);

     printLn();
     printLn("‘¯à ¢ª  ® ¯à®¢¥¤¥­­ëå ¤®ªã¬¥­â å §  ¤ âã ", string(dateOfReport:f));
     printLn();
END;

MACRO printErrorTitle(errorCode)
     printLn(string("¯® è¨¡ª¥", errorCode));
     printLn();
END;

MACRO printOneRecordFromProtocol(dataRecord)
    var currencyCode;

    getCurrencyNumber(dataRecord.t_currency_code, currencyCode);

    if   (dataRecord.t_error_code == 1)
        printLn("ü ¤®ª. - ", dataRecord.t_document_number, "; ª®¤ ¢ «îâë - ", currencyCode, "; áç¥â ¤¥¡¥â  ", dataRecord.t_payer_account, ";");
        printLn("áç¥â ªà¥¤¨â  ", dataRecord.t_receiver_account, "; áã¬¬  ", dataRecord.t_document_summ);
        printLn("à®¢®¤ª  ­¥ ¯à¨¢ï§ ­  ª ¯« â¥¦ã");
    elif (dataRecord.t_error_code == 2)
        printLn("ü á¤¥«ª¨ - ", dataRecord.t_payment_id, ";");
        printLn("ü ¤®ª. - ", dataRecord.t_document_number, "; ª®¤ ¢ «îâë - ", currencyCode, "; áç¥â ¤¥¡¥â  ", dataRecord.t_payer_account, ";");
        printLn("áç¥â ªà¥¤¨â  ", dataRecord.t_receiver_account, "; áã¬¬  ", dataRecord.t_document_summ);
        printLn(" ©¤¥­® ¡®«¥¥ ®¤­®£® áç¥â , ª®àà¥á¯®­¤¨àãîé¥£® á ¨áå®¤­ë¬ ¢ ¤ ­­®¬ ¯« â¥¦¥, ‘");
        printLn("ª®â®à®£® ­¥ ¢å®¤¨â ¢ ¬ áá¨¢ ¨áª«îç¥­¨©");
    elif (dataRecord.t_error_code == 3)
        printLn("ü ¤®ª. - ", dataRecord.t_document_number, "; ª®¤ ¢ «îâë - ", currencyCode, "; áç¥â ¤¥¡¥â  ", dataRecord.t_payer_account, ";");
        printLn("áç¥â ªà¥¤¨â  ", dataRecord.t_receiver_account, "; áã¬¬  ", dataRecord.t_document_summ);
        printLn("¥¢®§¬®¦­® ®¯à¥¤¥«¨âì ¯à®¢®¤ªã àã¡«¥¢®£® ¯®ªàëâ¨ï");
    end;
    printLn();
END;

MACRO printProtocol()
   var protocolData;
   var queryText        = "";
   var messageString    = ""; /*áâà®ª  á®®¡é¥­¨ï ­  íªà ­, ¥á«¨ ¥áâì ¯à®â®ª®«*/
   var completeFileName = ""; /*¯®«­®¥ ¨¬ï ä ©«  ¯à®â®ª®« */

   var currentDate;
   var currentErrorCode;

   var count = 0;
   queryText =          "SELECT *"
               + "\n" + "  FROM " + tempProtocolTableName
               + "\n" + " ORDER BY " + tempProtocolTableName +".t_date_carry,"
               + "\n" + "          " + tempProtocolTableName +".t_error_code";

   protocolData = TRsbDataSet(queryText);

   if (protocolData.Next() == TRUE)
       completeFileName = GetTxtFileName("OutDocsError");
       messageString = messageString + string("ë«¨ ®¡­ àã¦¥­ë ®è¨¡ª¨. ®¤à®¡­¥¥ á¬. ä ©« - ", completeFileName);
       msgbox(messageString);

       initProgress (-1, "", "¥ç âì ¤ ­­ëå ¢ ä ©« ¯à®â®ª®« ");
       count = count + 1;
       useProgress (count);

       printHeaderOfProtocol(protocolData.t_date_carry);
       printErrorTitle(protocolData.t_error_code);
       printOneRecordFromProtocol(protocolData);
       currentDate = protocolData.t_date_carry;
       currentErrorCode = protocolData.t_error_code;
   end;

   while (protocolData.Next() == TRUE)
       count = count + 1;
       useProgress (count);
       if (protocolData.t_date_carry == currentDate)
           if (protocolData.t_error_code == currentErrorCode)
               printOneRecordFromProtocol(protocolData);
               currentDate = protocolData.t_date_carry;
               currentErrorCode = protocolData.t_error_code;
           else
               printErrorTitle(protocolData.t_error_code);
               printOneRecordFromProtocol(protocolData);
               currentDate = protocolData.t_date_carry;
               currentErrorCode = protocolData.t_error_code;
           end;
       else
           printHeaderOfProtocol(protocolData.t_date_carry);
           printErrorTitle(protocolData.t_error_code);
           printOneRecordFromProtocol(protocolData);
           currentDate = protocolData.t_date_carry;
           currentErrorCode = protocolData.t_error_code;
       end;
   end;

   remProgress();
END;



/*’—Š€ ‚•„€ ‚ ƒ€ŒŒ“!*/
MACRO makeReport(departmentCode,
                   orgStructure,
                      issueMode,
                  chapterNumber,
                           plan,
                   currencyCode,
            periodBeginningDate,
               periodEndingDate,
                 needGroupSplit,
                     operNumber,
                     packNumber,
                    sortingKind,
                   needPackItog,
                  needOperSplit,
 needNationalCurrencyEquivalent,
           needEveryDayPrinting,
                   paymentsData,
               needApostrophies,
           needExchangeRateDiff,
                       fileName
)

    var profiler = TSQLProfiler(getTxtFileName("!pr_doc_profile"));
    profiler.clear();
    profiler.on();

    var parameters = TReportParameters(departmentCode,
                                        orgStructure,
                                           issueMode,
                                       chapterNumber,
                                                plan,
                                        currencyCode,
                                  periodBeginningDate,
                                    periodEndingDate,
                                      needGroupSplit,
                                          operNumber,
                                          packNumber,
                                         sortingKind,
                                        needPackItog,
                                       needOperSplit,
                      needNationalCurrencyEquivalent,
                                needEveryDayPrinting,
                                        paymentsData,
                                    needApostrophies,
                                needExchangeRateDiff);

    var i = 0;
    var dataString;
    var reportOutPut;
    var protocolFileName;
    /* Š®­âà®«ì ®âªàëâëå ®¯¥à¤­¥© */
    if (RepOperdaysOpened(parameters.m_departmentList, parameters.m_periodBeginningDate, parameters.m_periodEndingDate).ShouldContinue == false)
        exit(1);
    end;

    if (fileName != null)
        var printOfstream = TOfstream(fileName);

        printOfstream = TOfstream(fileName);
        printOfstream.setOutputFile();
        reportBodyFileName = printOfstream.getFileName();
    end;

    /*¯¥ç â ¥¬ ®âç¥â*/
    printReport(parameters);

    if (useProtocol)
        protocolFileName = GetTxtFileName("OutDocsError");
        reportOutPut     = setOutPut(protocolFileName,false);
        printProtocol();
        setOutPut(reportOutPut, true);
    end;

    if ((fileName != null) and (ExistFile(reportBodyFileName, 0)))
        printOfstream.resetOutputFile(); 
        return true
   end;
END;
