/*
$Name:         RepOpenedOperdaysChecker.mac
$Module:       Отчетность
$Description:  Проверка незакрытых операционных дней
*/

import Reporting;
import rep_lib;
import RepParametersNames;
import repoperday;

macro checkOpenedOperdays(p1, p2, p3)
    var departmentList;
    var beginDate;
    var endDate;

    if (genClassName(p1) == "RepParameterCollection")
        var organizationStructure : Integer = p1.getValue(ORGANIZATION_STRUCTURE);
        var issueMode : Integer = p1.getValue(ISSUE_MODE);
        var departmentId : Integer = getDepartmentId(p1.getValue(DEPARTMENT_CODE), organizationStructure);

        departmentList = RepDepartmentList(organizationStructure, issueMode, departmentId);
        beginDate = p1.getValue(BEGIN_DATE);
        endDate = p1.getValue(END_DATE);
    else
        departmentList = p1;
        beginDate = p2;
        endDate = p3;
    end;

    var passed = RepOperdaysOpened(departmentList, beginDate, endDate).shouldContinue();
    RepTxtFilesQueue().add(getLogFileName(), false);

    return passed;
end;
