import CommonInter;
import "or_tpl_h.mac";

const OPF_MSOFFICE     = 1, 
      OPF_TXT          = 2,
      OPF_MSOFFICE_TXT = 3;

// Формат печати ордеров
const ORDER_PRINT_FORMAT = OPF_TXT; // GetRegVal("RS-RETAIL\\???");

// Количество строк в документе при котором включается механизм печати через CSV-файлы
const ORDER_PRINT_NMULTI = 3;

// Максимальное количество счетов на листе многостраничного ордера
const MaxNumAccount = 6;

// Код национальной валюты (аналогично 0)
const NationalCurr = 810;

// Признак автоматической отправки документа на принтер (количество копий определяется настройками).
const AutoPrint = FALSE;

// RS-Retail.  Вывод отчета на печать для Word.  _Copies - число копий (определяется настройками).
macro RT_PrintOut_Doc( _rep :CMakeReport,  _Copies:integer )
  if ( AutoPrint  AND  ( ValType( _Copies ) == V_INTEGER )  AND  ( _Copies > 0 ) )
    _rep.PrintOut_doc( _Copies );
  end;
end;

// RS-Retail.  Вывод отчета на печать в текстовом режиме.  _Copies - число копий (определяется настройками).
macro RT_PrintRep( _rep :CMakeReport,  _Copies:integer )
  if ( ( ValType( _Copies ) == V_INTEGER )  AND  ( _Copies < 0 ) )
    _Copies = 1;
  end;
  _rep.PrintRepCopy( _Copies );
end;

macro isGroupProcReport()
  var isGroup = false;
  GetGroupProc(isGroup);
  return isGroup;
end;

macro beginXlsReport(): CTemplateXLS
  var repObject = CTemplateXLS();

  if (isGroupProcReport())
    var repName = RetrieveValue("GroupProcReportFileName");
    if (not repName)
      repObject.CreateTotalBook();
    else
      repObject.OpenTotalBook(repName);
    end;
  end;

  return repObject;
end;

macro endXlsReport(repObject:CTemplateXLS)
  if (not isGroupProcReport())
      repObject.SaveAsTemplate("Готовый отчет");
  else
    var existingDoc = false;
    var repName = RetrieveValue("GroupProcReportFileName");
    if (repName)
      existingDoc = true;
    end;

    repObject.CopyAllSheetInTotalBook(null, true, null);
    repObject.Close();
    repObject.SaveTotalBook("Готовый отчет", false, existingDoc);
    StoreValue("GroupProcReportFileName", repObject.ReportFileName_xls);
  end;
end;

macro showGroupProcReport
  if (isGroupProcReport())
    var repName = RetrieveValue("GroupProcReportFileName");
    if (repName)
      var repObject = CTemplateXLS();
      repObject.OpenTotalBook(repName);
      repObject.SaveTotalBook("Готовый отчет", true, true);
      StoreValue("GroupProcReportFileName", "");
    end;
  end;
end;

