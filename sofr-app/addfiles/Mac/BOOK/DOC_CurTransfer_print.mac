/*
$Name:             DOC_CurTransfer_print.mac
$Module:           RS-Retail
$Description:      ¥ç â­ ï ä®à¬  ‚ «îâ­®£® ¯¥à¥¢®¤  MT103SWIFT.
*/

import "Or_Rep_h.mac";
import order_const, rsd, ErrHandler;

private const CODEKIND_SWIFT = 6;

private var {curdate};
private var {CNum};

private var address = TBFile( "adress.dbt",   "r", 0 );
private var curr    = TBFile( "currency.dbt", "r", 0 );

// ------------------------------------------------------------
private macro GetAddress( party_id:integer )
  var addr = "";
  address.ReWind();
  address.Clear();
  address.rec.PartyID = party_id;
  address.rec.Type = 1;  // îà¨¤¨ç¥áª¨©  ¤à¥á
  if ( address.GetEQ() )
    addr = address.rec.Adress;
  end;
  return addr;
end;

// ------------------------------------------------------------
private macro GetParty( party_id:integer )
  var cmd = RsdCommand(
      "select * " +
      "from dparty_dbt " +
      "where t_PartyId = ? ");
  cmd.addParam("PartyId", RSDBP_IN, party_id);
  cmd.execute();
  var rs = RsdRecordset(cmd);
  rs.NullConversion = true;
  return rs;
end;

// ------------------------------------------------------------
private macro MoneyToStr( sum )
  var str = string(sum:f );
  var isDigit = true;
  var stat = 0;
  GetRegistryValue("COMMON\\…—€’œ\\„…\\„€Ÿ_—€‘’œ_–ˆ”€Œˆ", V_BOOL, isDigit, stat);
  if (stat != 0)
    isDigit = true;
  end;                                    
  if (not isDigit and (SubStr(str, strlen(str) - 2) == "-00"))
    str = SubStr(str, 1, strlen(str) - 3) + "=";
  end;
  return str;
end;

// ------------------------------------------------------------
private macro getExtCurr( codeCurr )
  var exc = "";
  curr.ReWind();
  curr.Clear();
  curr.rec.Code_Currency = codeCurr;
  if ( curr.GetEQ() )
    exc = curr.rec.ExternalCode;
  end;
  return exc;
end;

// ------------------------------------------------------------
private macro GetTempParty(party_id:integer)
  var cmd = RsdCommand(
      "select * " +
      "from dtemporaryparty_dbt " +
      "where t_TempPartyId = ? ");
  cmd.addParam("PartyId", RSDBP_IN, party_id);
  cmd.execute();
  var rs = RsdRecordset(cmd);
  rs.NullConversion = true;
  return rs;
end;

// ------------------------------------------------------------
private class RepParams
  private var Params = "";

  macro add(str:string, format:string)
    if (Params != "")
      Params = Params + ", ";
    end;
    str = StrSubst(str, "\\", "\\\\"); // íªà ­¨à®¢ âì \
    str = StrSubst(str, "\"", "\\" + "\""); // íªà ­¨à®¢ âì "
    Params = Params + "\"" + str + "\"";
    if (format == null)
      format = ":l";
    end;
    Params = Params + ",\"" + format + "\"";
  end;

  macro getList()
    return Params;
  end;
end;

// ------------------------------------------------------------
private class CURRTR( doc_id:integer )

  private class Party
    var Name = "";
    var INN = "";
    var KPP = "";
    var Account = "";
    var Bank = "";
    var BankCode = "";
    var BankCorAcc = "";
  end;

  private var payer    = Party;
  private var receiver = Party;

  private var documentId = doc_id;
  private var documentNumber = "";
  private var docDate;
  private var valueDate;
  private var PayerName;
  private var PayerAddress;
  private var PayerINN;
  private var PayCurrCode = "";
  private var PaySum = $0;
  private var PaySumStr = "";
  private var PayAcc = "";
  private var PayBankAddress = "";
  private var RecvBankAddress = "";
  private var RecvAddress = "";
  private var Ground = "";

  private var rep = CMakeReport( "", SEP_DEFAULT, 99999 );

  private macro getBankInfoForParty(client:Party, id:integer)
    var party_rs = GetParty(id);
    if (party_rs.moveNext())
      client.Bank = party_rs.value("t_Name");
      address.ReWind();
      address.Clear();
      address.rec.PartyID = id;
      address.rec.Type = 1;  // îà¨¤¨ç¥áª¨©  ¤à¥á
      if ( address.GetEQ() )
        client.Bank = client.Bank + ", " + address.rec.CodePlace + " " + address.rec.Place;
      end;
      client.BankCode = findPartyCode( id, I_PTCK_SWIFT );  // I_PTCK_BIC);
      iFindBank( CODEKIND_SWIFT, client.BankCode, null, client.BankCorAcc );
    end;
  end;

  private macro getBankInfo( client:Party, rs:RsdRecordset, party_fld_name:string, temp_party_fld_name:string )
    var is_null;
    var party_rs;
    var id = rs.value(party_fld_name, is_null);
    if ((not is_null) and (id != 0))
      getBankInfoForParty( client, id );
    else
      id = rs.value(temp_party_fld_name, is_null);
      if (not is_null)
        party_rs = GetTempParty(id);
        if (party_rs.moveNext())
          client.Bank = party_rs.value("t_Name");// + ", " + party_rs.value("t_Address");
          if (party_rs.value("t_BankCodeKind") == CODEKIND_SWIFT )
            client.BankCode = party_rs.value("t_BankCode");
          end;
          client.BankCorAcc = party_rs.value("t_BankCorrAccount");
        end;
      end;
    end;
  end;

  private macro init()

    var vPayerID = -1;
    
    var cmd = RsdCommand(
        "select * " +
        "from drtdocument_dbt d, drtcurrencytransfer_dbt co " +
        "where d.t_DocumentId = co.t_DocumentId " +
        "  and d.t_DocumentId = ? ");

    cmd.addParam("DocumentId", RSDBP_IN, documentId);
    cmd.execute();
    var rs = RsdRecordset(cmd);
    rs.NullConversion = true;
    if ( not rs.moveNext() )
      DoError( "‚ «îâ­ë© ¯¥à¥¢®¤ ­¥ ­ ©¤¥­" );
    end;

    documentNumber = rs.value("t_DocumentNumber");
    DtTmSplit(rs.value("t_Date"), docDate);
    DtTmSplit(rs.value("t_ValueDate"), valueDate);

    if ( ValType( rs.value( "t_PayerPartyID" ) ) == V_INTEGER )
      vPayerID = rs.value( "t_PayerPartyID" );
      var party_rs = GetParty( int( vPayerID ) );
      if ( party_rs.moveNext() )
        PayerName = party_rs.value( "t_Name" );
        PayerAddress = GetAddress( vPayerID );
      end;
      PayerINN = getPartyINN( vPayerID, 1 );
    else
      PayerName = "";
      PayerAddress = "";
      PayerINN = "";
    end;

    PayCurrCode = rs.value( "t_DebitCurrCode" );
    PaySum = rs.value( "t_DebitAmount" );
    PayCurrCode = getExtCurr( rs.value( "t_DebitCurrCode" ) );
    PaySumStr = CurToStrAlt( PaySum, null, null, int( PayCurrCode ) );

    PayAcc = rs.value( "t_PayerAccount" );

    getBankInfo( payer, rs, "t_agentBankPartyId", "t_agentBankTempPartyId" );

    if ( ( ValType( rs.value( "t_agentBankPartyId" ) ) == V_INTEGER )  AND  ( rs.value( "t_agentBankPartyId" ) > 0 ) )
      PayBankAddress = GetAddress( rs.value( "t_agentBankPartyId" ) );
    elif ( ( ValType( rs.value( "t_agentBankTempPartyId" ) ) == V_INTEGER )  AND  ( rs.value( "t_agentBankTempPartyId" ) > 0 ) )
      PayBankAddress = GetAddress( rs.value( "t_agentBankTempPartyId" ) );  // ®¯ëâª  ¯®«ãç¨âì  ¤à¥á ¡ ­ª  ¨§ ®á­®¢­®© â ¡«¨æë, ­®, áª®à¥¥ ¢á¥£®, ¥£® â ¬ ¨ ­¥â...
    end;

    getBankInfo( receiver, rs, "t_ReceiverBankPartyID", "t_ReceiverBankTempPartyID" );

    if ( ( ValType( rs.value( "t_ReceiverBankPartyID" ) ) == V_INTEGER )  AND  ( rs.value( "t_ReceiverBankPartyID" ) > 0 ) )
      RecvBankAddress = GetAddress( rs.value( "t_ReceiverBankPartyID" ) );
    elif ( ( ValType( rs.value( "t_ReceiverBankTempPartyID" ) ) == V_INTEGER )  AND  ( rs.value( "t_ReceiverBankTempPartyID" ) > 0 ) )
      RecvBankAddress = GetAddress( rs.value( "t_ReceiverBankTempPartyID" ) );  // ®¯ëâª  ¯®«ãç¨âì  ¤à¥á ¡ ­ª  ¨§ ®á­®¢­®© â ¡«¨æë, ­®, áª®à¥¥ ¢á¥£®, ¥£® â ¬ ¨ ­¥â...
    end;

    receiver.Name = rs.value( "t_ReceiverName" );
    receiver.Account = rs.value("t_ReceiverAccount");
    if ( ( ValType( rs.value( "t_ReceiverPartyID" ) ) == V_INTEGER )  AND  ( rs.value( "t_ReceiverPartyID" ) > 0 ) )
      RecvAddress = GetAddress( rs.value( "t_ReceiverPartyID" ) );
    end;

    Ground = rs.value("t_Ground");
  end;

  private macro makeOrder()
    var template = "";
    var params = RepParams;

    var payerNameArray = StrSplit2( PayerName, 51, 51, 2 );
    var payerAddressArray = StrSplit2( PayerAddress, 51, 51, 3 );

    var sumArray = StrSplit2( PaySumStr, 52, 52, 3 );

    var payBankArray = StrSplit2( payer.Bank, 102, 102, 2 );
    var payBankAddrArray = StrSplit2( PayBankAddress, 102, 102, 2 );

    var recvBankArray = StrSplit2( receiver.Bank, 102, 102, 2 );
    var recvBankAddrArray = StrSplit2( RecvBankAddress, 102, 102, 2 );

    var receiverNameArray = StrSplit2( receiver.Name, 102, 102, 2 );
    var receiverAddrArray = StrSplit2( RecvAddress, 102, 102, 2 );

    var groundArray = StrSplit2(ground, 102, 102, 3 );

    template = template +

        " ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ " + "\n" +
        " ³                                                     ³                                                     ³ " + "\n" +
        " ³                             ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿       ³                                                     ³ " + "\n" +
        " ³ ‡€Ÿ‚‹…ˆ… € ……‚„ Œ…  ³ ############# ³       ³   ‡€‹Ÿ…’‘Ÿ €ŠŒ                                ³ " + "\n" +
        " ³ PAYMENT ORDER NUMBER        ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ       ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                     ³                                                     ³ " + "\n" +
        " ³                  ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿                     ³                                     ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ ³ " + "\n" +
        " ³ „ â /Date        ³ ########## ³                     ³  Š®¬¨áá¨ï §  ¯¥à¥¢®¤                ³             ³ ³ " + "\n" +
        " ³                  ÀÄÄÄÄÄÄÄÄÄÄÄÄÙ                     ³                                     ÃÄÄÄÄÄÄÄÄÄÄÄÄÄ´ ³ " + "\n" +
        " ³                                                     ³  Š®¬¨áá¨ï §   á¯®àâ á¤¥«ª¨         ³             ³ ³ " + "\n" +
        " ³                                                     ³                                     ÃÄÄÄÄÄÄÄÄÄÄÄÄÄ´ ³ " + "\n" +
        " ³                                                     ³  „‘                                ³             ³ ³ " + "\n" +
        " ³                                                     ³                                     ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÙ ³ " + "\n" +
        " ³                                                     ³                                                     ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                     ³                                                     ³ " + "\n" +
        " ³  :50: Š‹ˆ…’/CLIENT                                 ³                          ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  ³ " + "\n" +
        " ³  ˆ¬ï ª«¨¥­â  / Client's name                        ³   ‘ã¬¬  ª ¯¥à¥¢®¤ã       ³                       ³  ³ " + "\n" +
        " ³ ################################################### ³                          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  ³ " + "\n" +
        " ³ ################################################### ³    ­ª-ª®àà¥á¯®­¤¥­â                                ³ " + "\n" +
        " ³  €¤à¥á/Address                                      ³                                                     ³ " + "\n" +
        " ³ ################################################### ³   :30: „ â  ¢ «îâ¨à®¢ ­¨ï                           ³ " + "\n" +
        " ³ ################################################### ³                                                     ³ " + "\n" +
        " ³ ################################################### ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³            ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿   ³                                                     ³ " + "\n" +
        " ³  ˆ       ³ ################################## ³   ³  ®¤¯¨á¨ ®â¢¥âáâ¢¥­­ëå «¨æ                          ³ " + "\n" +
        " ³            ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ   ³                                                     ³ " + "\n" +
        " ³                                                     ³                                                     ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ³  :32:‹€’ˆ’œ/PAY                                              ‘ã¬¬  ¯à®¯¨áìî / Amount in words            ³ " + "\n" +
        " ³  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿                                                           ³ " + "\n" +
        " ³  ³     ###      ³ ########################### ³      #################################################### ³ " + "\n" +
        " ³  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ      #################################################### ³ " + "\n" +
        " ³  ‚ «îâ  ¯« â¥¦         ‘ã¬¬  æ¨äà ¬¨                 #################################################### ³ " + "\n" +
        " ³  Paymentcurrency       Numerical Amount                                                                   ³ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                                    ³                                      ³ " + "\n" +
        " ³                                    ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ ³ ¥à¥¢®¤ ­  ãá«®¢¨ïå:/Payment terms:  ³ " + "\n" +
        " ³  « â¥¦ ®áãé¥áâ¢¨âì á ­ è¥£® áç¥â  ³ ########################### ³ ³              ÚÄÄÄ¿             ÚÄÄÄ¿ ³ " + "\n" +
        " ³  Please debit our account No       ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ ³ ®¡ëç­ë©/SPOT ³   ³ áà®ç­ë©/TOD ³   ³ ³ " + "\n" +
        " ³                                                                    ³              ÀÄÄÄÙ             ÀÄÄÄÙ ³ " + "\n" +
        " ³                                                                    ³                                      ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ³                                                     ÚÄÄ¿                                        ÚÄÄ¿      ³ " + "\n" +
        " ³  : :   áå®¤ë ¯® ¯¥à¥¢®¤ã ­ è¥£® ¡ ­ª  §  ­ è áç¥â  ³  ³             §  áç¥â ¯®«ãç â¥«ï         ³  ³      ³ " + "\n" +
        " ³       Charges of our bank for our account           ÀÄÄÙ             for beneficiary's account  ÀÄÄÙ      ³ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ³                                                     ÚÄÄ¿                                        ÚÄÄ¿      ³ " + "\n" +
        " ³  :71: Š®¬¨áá¨¨ ¡ ­ª®¢ ª®àà¥á¯®­¤¥­â®¢ §  ­ è áç¥â   ³  ³             §  áç¥â ¯®«ãç â¥«ï         ³  ³      ³ " + "\n" +
        " ³       Correspondent`s charges for our account       ÀÄÄÙ             for beneficiary's account  ÀÄÄÙ      ³ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ³  :56: €Š-Š…‘„…’ €Š€ ‹“—€’…‹Ÿ                                                                 ³ " + "\n" +
        " ³       CORRESPONDENT BANK OF BENEFICIARY'S BANK                                                            ³ " + "\n" +
        " ³        ¨¬¥­®¢ ­¨¥ ¡ ­ª  / Bank name                                                                      ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³       €¤à¥á / Address                                                                                     ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  S.W.I.F.T. ª®¤/code          ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿        <CHIPS UID No, ABA No,               ³ " + "\n" +
        " ³  ¨«¨/or <...>                 ³ ########################### ³        Bank Code, Sort Code etc.>           ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ³  :57: €Š ‹“—€’…‹Ÿ ‹€’…†€ / BENEFICIARY'S BANK                                                        ³ " + "\n" +
        " ³        ¨¬¥­®¢ ­¨¥ ¡ ­ª  / Bank name                                                                      ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³       €¤à¥á / Address                                                                                     ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  ‘ç¥â ¢ ¡ ­ª¥-ª®àà¥á¯.        ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿                                             ³ " + "\n" +
        " ³  Acc with corresp. Bank       ³                             ³                                             ³ " + "\n" +
        " ³                               ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ                                             ³ " + "\n" +
        " ³  S.W.I.F.T. ª®¤/code          ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿        <CHIPS UID No, ABA No,               ³ " + "\n" +
        " ³  ¨«¨/or <...>                 ³ ########################### ³        Bank Code, Sort Code etc.>           ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ³  :59: ‹“—€’…‹œ ‹€’…†€ / BENEFICIARY                                                                    ³ " + "\n" +
        " ³       ˆ¬ï ¯®«ãç â¥«ï / Beneficiary's name                                                                 ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³       €¤à¥á / Address                                                                                     ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  ‘ç¥â ¯®«ãç â¥«ï ­®¬¥à        ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿                                             ³ " + "\n" +
        " ³  Beneficiary's Acc No         ³ ########################### ³                                             ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³                                                                                                           ³ " + "\n" +
        " ³  :70: „…’€‹ˆ ‹€’…†€ / PAYMENT DETAILS                                                                    ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ³  #######################################################################################################  ³ " + "\n" +
        " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ " + "\n" +
        " ³  ‚ á«ãç ¥ ­¥¤®áâ â®ç­®© ¨­ä®à¬ æ¨¨ ¤«ï ¯« â¥¦   ­ª ­¥ ­¥á¥â ®â¢¥âáâ¢¥­­®áâ¨ §  áà®ª¨ ¯à®å®¦¤¥­¨ï ¯« â¥¦  ³ " + "\n" +
        " ³In case of incomplete or incorrect information in payment instructions the Bank incurs no responsibility   ³ " + "\n" +
        " ³                                      for processing of payment                                            ³ " + "\n" +
        " ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ " + "\n" +
        "                                                                                                               " + "\n" +
        "                                                                                                               " + "\n" +
        "                 Œ..                    ®¤¯¨á¨ / Signatures " + "\n";

    params.add( documentNumber );
    params.add( docDate );
    params.add( payerNameArray[0] );
    params.add( payerNameArray[1] );
    params.add( payerAddressArray[0] );
    params.add( payerAddressArray[1] );
    params.add( payerAddressArray[2] );
    params.add( PayerINN );
    params.add( PayCurrCode );
    params.add( MoneyToStr( PaySum ), ":r" );
    params.add( sumArray[0] );
    params.add( sumArray[1] );
    params.add( sumArray[2] );
    params.add( PayAcc );
    params.add( payBankArray[0] );
    params.add( payBankArray[1] );
    params.add( payBankAddrArray[0] );
    params.add( payBankAddrArray[1] );
    params.add( payer.BankCode );
    params.add( recvBankArray[0] );
    params.add( recvBankArray[1] );
    params.add( recvBankAddrArray[0] );
    params.add( recvBankAddrArray[1] );
    params.add( receiver.BankCode );
    params.add( receiverNameArray[0] );
    params.add( receiverNameArray[1] );
    params.add( receiverAddrArray[0] );
    params.add( receiverAddrArray[1] );
    params.add( receiver.Account );
    params.add( groundArray[0] );
    params.add( groundArray[1] );
    params.add( groundArray[2] );

    template = "\n" + template;
    var str = "rep.AutoScan(\"[\" + template + \"]()\"," +  params.getList() + ")";
    ExecExp( str );
  end;

  macro printOrder( FileNameTxt:string, Copies:integer )
    var TempRep = "", FileNameOffic = "";

    init();
    
    // Œ¥­ï¥¬ èà¨äâ ¯®-ã¬®«ç ­¨î, çâ®¡ë ®âç¥â ¢ Word-¥ ¢«¥§ ¢ «¨áâ ä®à¬ â  €4
    rep.SetDefaultFontSize( 8 );

    makeOrder();
    
    FileNameOffic = "CURTR" + StrSubst( string({curdate}), ".", "" );
                                        
    if ( FileNameTxt == null )
      FileNameTxt = FileNameOffic + "." + string({CNum});
    end;

    rep.SetFileNameWin( FileNameOffic );
                                        
    if ( ( ORDER_PRINT_FORMAT == OPF_TXT      ) or ( ORDER_PRINT_FORMAT == OPF_MSOFFICE_TXT ) )
      RT_PrintRep( rep, Copies );
    end;
    if ( ( ORDER_PRINT_FORMAT == OPF_MSOFFICE ) or ( ORDER_PRINT_FORMAT == OPF_MSOFFICE_TXT ) )
      rep.SetWinRepOutPut( 0, 0 );
      rep.AddWinRepOutput( WINREP_OUTPUT_WORD, WINREP_FORMAT_DOC );
      rep.SetExecuteWord( "WordDocument.PageSetup.LeftMargin = 20;" );
      rep.SetExecuteWord( "WordDocument.PageSetup.TopMargin  = 20;" );
      rep.PrintWinRep();
      RT_PrintOut_Doc( rep, Copies );
      rep.ShowWinRep();
    end;

  end;

end;

macro PrintRTDocument( RTDocID:integer, Copies:integer ):integer
  var order = CURRTR( RTDocID );
  order.printOrder( Copies );

OnError(err)
  ShowError(err);
end;
