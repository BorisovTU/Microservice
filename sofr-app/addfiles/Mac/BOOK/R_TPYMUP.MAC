/**************************************************************************

                            RS-Bank ( Сбербанк )
                       Обслуживание безналичных платежей

                 Выпуск справки по возврату незачисленных сумм
                          организации-плательщику

***************************************************************************/

import Acc_Form;

record PayMess ( "trn_paym.dbt" );        /* Платежное поручение          */
file   Contr   ( "trn_cntr.dbt" ) key 0;  /* Договора по безнал.перечисл. */

private var {Name_Bank};

/***********************************************************************/
macro Документ_1
[


                                    #

                                    #
                                    #
                                    #
                                    #

                    Заданная сумма: #
                 Проведенная сумма: #
                  Возвращена сумма: #


  Главный бухгалтер ________________________________________________
]
  ( {Name_Bank}:c,
    "Справка по возврату незачисленных сумм":c,
    Contr.NameBusines:c,
    ("по договору " + PayMess.NumberContract):c,
    ("платежному поручению " + PayMess.Num_PayMessage):c,
    PayMess.GlobalSumBusines:20:2:l,
    PayMess.GlobalSumFact:20:2:l,
    (PayMess.GlobalSumBusines - PayMess.GlobalSumFact):20:2:l );

end;

/***********************************************************************/
macro Документ_2

  if ( PayMess.TaxPercentGl == $0 )
    println( "Размер комисии равен нулю. Комиссия не взымается." );
    println( "\n\n\n  Главный бухгалтер __________________________" );
    return;
  end;

[


                                    #

                                    #
                                    #
                                    #
                                    #

                    Заданная сумма: #
                 Проведенная сумма: #
         Возвращена сумма комиссии: #


  Главный бухгалтер ________________________________________________
]
  ( {Name_Bank}:c,
    "Справка по возврату комиссии незачисленных сумм":c,
    Contr.NameBusines:c,
    ("по договору " + PayMess.NumberContract):c,
    ("платежному поручению " + PayMess.Num_PayMessage):c,
    PayMess.GlobalSumBusines:20:2:l,
    PayMess.GlobalSumFact:20:2:l,
    (PayMess.GlobalSumBusines - PayMess.GlobalSumFact)*PayMess.TaxPercentGl/
      $100:20:2:l );

end;

/***********************************************************************/
macro Документ_3

  if ( PayMess.TaxPercentGl == $0 )
    println( "Размер комисии равен нулю. Комиссия не взымается." );
    println( "\n\n\n  Главный бухгалтер __________________________" );
    return;
  end;


[


                                    #

                                    #
                                    #
                                    #
                                    #

                    Заданная сумма: #
                 Проведенная сумма: #
         Возвращена сумма комиссии: #
             Перечисление со счета: 
                           на счет: 


  Главный бухгалтер ________________________________________________
]
  ( {Name_Bank}:c,
    "Справка на списание комиссии в доходы банка":0:c,
    Contr.NameBusines:0:c,
    ("по договору " + PayMess.NumberContract):0:c,
    ("платежному поручению " + PayMess.Num_PayMessage):0:c,
    PayMess.GlobalSumBusines:20:2:l,
    PayMess.GlobalSumFact:20:2:l,
    (PayMess.GlobalSumBusines - PayMess.GlobalSumFact)*PayMess.TaxPercentGl/
      $100:20:2:l );

end;

/***********************************************************************/
macro Order ( Addr )

  SetBuff( PayMess, Addr );

  if ( PayMess.SignKvitGlobal != "X" )
    println( " Платежное поручение ", PayMess.Num_PayMessage,
             " (договор < ", PayMess.NumberContract,
             " >) не сквитовано." );
    return;
  end;

  if ( PayMess.GlobalSumBusines == PayMess.GlobalSumFact )
    println( " В платежном поручении ", PayMess.Num_PayMessage,
             " (договор < ", PayMess.NumberContract,
             " >) суммы заданная и проведенная равны ", PayMess.GlobalSumBusines:20:2 );
    return;
  end;

  /*  Поиск записи по Договору  */
  Contr.NumberContract = PayMess.NumberContract;
  if ( getEQ( Contr ) )
    Документ_1();
    Документ_2();
    Документ_3();
  else
    println( " Не найден договор < ", PayMess.NumberContract, " >." );
  end;

end;
