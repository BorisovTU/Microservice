import RSD, CTInter;
var sql, cmd, rs;
sql = "select sf.*,dl.t_dlcontrid  from dsfcontr_dbt sf, ddlcontr_dbt dl where sf.t_servkind = 0 " +
      " and sf.T_SERVKINDSUB = 0 and exists (select sc.t_partyid from dscqinv_dbt sc where sc.t_partyid = sf.t_partyid) and dl.t_sfcontrid = sf.t_id ";

cmd = RSDCommand(sql);
var stat = -1;
var result;
begaction(5,"Установка категорий на договора...", false);
rs = RSDRecordset(cmd, rsdval_client, rsdval_static);
while (rs.movenext())
   //msgbox("!!!");
result = ConnectObjAttr(stat, 207, string (rs.value("t_ID"):o:34), 140, 1, null, null, rs.value("T_DATEBEGIN"));

   if( ( not DisconnectObjAttr(207,  string (rs.value("t_dlcontrID"):o:34), 140) ) OR
            ( not ConnectObjAttr(stat, 207, string (rs.value("t_dlcontrID"):o:34), 140, 1, null, null, rs.value("T_DATEBEGIN")) ) )
             println( "Ошибка при установке Категории для sf:" + rs.value("T_NUMBER") );
             return 1;
   end;
end;
endaction;

begaction(5,"Снятие категории для договоров-исключений...", false);
sql = "select sf.*,dl.t_dlcontrid  from dsfcontr_dbt sf, ddlcontr_dbt dl where sf.t_servkind = 0 " +
      " and sf.T_SERVKINDSUB = 0 and exists (select sc.t_partyid from dscqinv_dbt sc where sc.t_partyid = sf.t_partyid) and dl.t_sfcontrid = sf.t_id and sf.t_id in (11929, 26311, 6023, 6305, 25367, 25456 , 25491, 17044)";

cmd = RSDCommand(sql);
rs = RSDRecordset(cmd, rsdval_client, rsdval_static);
while (rs.movenext())
   //msgbox("!!!");
result = ConnectObjAttr(stat, 207, string (rs.value("t_ID"):o:34), 140, 1, null, null, rs.value("T_DATEBEGIN"));
        DisconnectObjAttr(207,  string (rs.value("t_dlcontrID"):o:34), 140);
  /* if( ( not DisconnectObjAttr(207,  string (rs.value("t_dlcontrID"):o:34), 140) ) OR
            ( not ConnectObjAttr(stat, 207, string (rs.value("t_dlcontrID"):o:34), 140, 0, null, null, rs.value("T_DATEBEGIN")) ) )
             println( "Ошибка при установке Категории для sf:" + rs.value("T_NUMBER") );
             return 1;
   end;    */
end;

endaction;

msgbox("Выполнено");