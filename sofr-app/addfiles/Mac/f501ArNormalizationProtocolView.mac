/*
$Name:        f501ArNormalizationProtocolView.mac
$Module:      Регламентируемая отчетность
$Description: Форма 501Ar. Протокол нормализации.
*/

class (TProtocolView) TF501ArNormalizationProtocolView()
    initTProtocolView("ПРОТОКОЛ ПРОЦЕДУРЫ НОРМАЛИЗАЦИИ", RcbApplication().currentReport.form.id);

    private var m_isHeadPrinted = false;
    private var m_isSaparatorPrinted = false;

    macro printNormalizationDisabled()
        [    Нормализация отключена в настройках отчетного периода.];
    end;

    macro printNormalizationNotRequired()
        [    Отчет сформирован в #, нормализация не требуется.](ternary(RcbApplication().currentReport.dimension == RCB_DIM_NATIONAL, "единицах валюты", "единицах нац. валюты"));
    end;

    macro printNullData()
        [    Корректировок округленных значений символов не потребовалось.];
    end;

    macro beginProtocol()
        setProtocolOutput();
        printHead();
    end;

    macro printSeparatorLine()
        if(m_isSaparatorPrinted)
            [├───────────────────────────────┼────────────────┼─────────────┼─────────────────┼──────────┤];
        end;
    end;

    macro endProtocol()
        if (m_isHeadPrinted)
            [└───────────────────────────────┴────────────────┴─────────────┴─────────────────┴──────────┘];
            [ ];
        end;
        if (m_isEmpty)
            printNullData();
        end;
        resetProtocolOutput();
    end;

    macro printString(str : String, exact : Money, scaled : Double)
        var floored = floor(Double(exact) / rcbApplication.currentReport.multiplier + 0.5);

        if (not m_isHeadPrinted)
            [┌───────────────────────────────┬───────────────────────────────────────────────────────────┐];
            [│                               │                          Значение                         │];
            [│               л./с.           ├────────────────┬─────────────┬─────────────────┬──────────┤];
            [│                               │ Действительное │ Округленное │ Нормализованное │ Разность │];
            [├───────────────────────────────┼────────────────┼─────────────┼─────────────────┼──────────┤];
            m_isHeadPrinted = true;
            m_isSaparatorPrinted = true;
        end;

        [│###############################│################│#############│#################│##########│]
        (str, exact, floored : 0 : 0, scaled : 0 : 0, abs(floored - scaled) : 0 : 0);

        m_isEmpty = false;
    end;
end;
