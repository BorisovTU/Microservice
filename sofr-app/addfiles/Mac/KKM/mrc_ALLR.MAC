/*********************************************************************
* ---------------------                                              *
* R-Style SoftWare Lab.                                              *
* ---------------------                                              *
* RS-Retail 1.0                                                      *
*                                                                    *
* Работа с Контрольно-кассовой машиной ПРИМ-07Ф                      *
* Печать сменного отчета (без закрытия смены)                        *
*                                                                    *
* Щукин О.И.                                                         *
* 10.12.98                                                           *
*********************************************************************/

import "kkm_val.mac","kkm_err.mac",mercury;

var statI = 0;

macro MERC_AllReport

  Message(" Печать ведомости общих показаний...");

  /* Определение текущих параметров ККМ */
  statI = GetParamMerc(IsOpenShiftKKM,
                       IsFiscRegimKKM,
                       DateKKM,
                       TimeKKM,
                       NumberOperKKM,
                       RegisNumberKKM);

  /* Ошибок нет, можно печатать сменный отчет, спросим об этом */
  if (stat == 0)
    if (NOT GetTrue(TRUE," Вы действительно хотите напечатать ведомость общих показаний ? "))
      stat = RSKKMERR_USER_ABORT; /* Отказались от проведения операции */
    end;
  end;

  /* Печать сменного отчета */
  if (stat == 0)
    stat = ShiftReportMerc();
  end;

  KKM_Parm.aRetCode = stat;

  [ ];
  [ ──── Печать ведомости общих показаний на Контрольно-кассовой машине ────];
  [ ];
  if (stat == 0)
    if (KKM_PARM.aSilence == 0)
      MsgBox(" Ведомость общих показаний успешно напечатана | Время операции  " + Trim(String(Date())) + "  " + String(Time()) + " ");
    end;
    [ Время операции : #](Trim(String(Date())) + "  " + String(Time()));
  elif (stat == RSKKMERR_USER_ABORT)
    if (KKM_PARM.aSilence == 0)
      MsgBox(" Вы отказались от печати ведомости общих показаний ");
    end;
    [ Вы отказались от печати ведомости общих показаний];
  else
    StrErr = WriteError(stat,KKM_PARM.aSilence);
    StrErr = "Ошибка " + String(stat) + ": " + StrErr;
    [ ];
    [ #](StrErr)
  end;

end;
