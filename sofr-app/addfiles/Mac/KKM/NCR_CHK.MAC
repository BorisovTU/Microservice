/*********************************************************************
* ---------------------                                              *
* R-Style SoftWare Lab.                                              *
* ---------------------                                              *
* RS-Retail 2.0                                                      *
*                                                                    *
* Работа с Контрольно-кассовой машиной NCR 2113                      *
* Проверка возможности оплаты на ККМ                                 *
*                                                                    *
* Щукин О.И.                                                         *
* 25.03.99                                                           *
*********************************************************************/

import "kkm_val.mac","kkm_err.mac",ncr_serv;


var statN = 0;                 /* Возвращенное значение функций */


macro NCR_Check

  Message(" Проверка возможности оплаты на контрольно-кассовой машине...");

  /* Определение текущих параметров ККМ */
  statN = CheckNCR();

  if (statN == 7004)   /* Устройство не найдено */
    statN = RSKKMERR_NOT_DEVICE;
  end;
                       /* Крышка ККМ открыта */
  if ( ( statN == 7008 )  or  ( statN == 7009 ) )
    statN = RSKKMERR_COVER_OPEN;
  end;

  if (statN == RSKKMERR_MERC18)   /* Ошибка пароля связи */
    MsgBox( WriteError(RSKKMERR_MERC18,1) );
  end;

  if (statN == 7013)   /* Не установлен режим регистрации */
    MsgBox( WriteError(RSKKMERR_NCR_KEY,1) );
  end;

  KKM_Parm.aRetCode = statN;

end;
