import "sp_car.mac", "scservop.mac";

var FIIDDebet, FIIDCredit, Sum, FiRoleCred, FiRoleDeb, Ground, CatDeb, CatCred, DebAccNumber = "", CredAccNumber = "", FD,
    Group, Bpp = false, GroupBank;
var debug = false; //true;

Import cb_sql;

  var AccBirgRub = TRecHandler("account");
  var AccBirgUSD = TRecHandler("account");
  var AccBirgEUR = TRecHandler("account");
  var AccBirg = TRecHandler("account");


Private Macro  GetBirgAccount(currency) 
var sql, cmd, Birgacc = "";
  var AccBuf = TRecHandler("account");
  AccBuf.Clear();

sql = "select * from dmcaccdoc_DBT where t_catnum = 214 and t_iscommon = 'X' and t_currency = " + currency + "  and t_marketplaceofficeid = 2";
cmd = TrsbDataSet(sql);
If(cmd.movenext())
   Birgacc = cmd.t_account;
else

end;
GetAccount( 1, currency, Birgacc, AccBuf, false );
return AccBuf;

End;
var ExcelApp;

//ExcelApp = ActiveX("Excel.Application", null, true);

var startAX = CreateObject("rsax", "TRsAxServer", "FmAxServer", isStandalone());
ExcelApp = startAX.CreateComObject("Excel.Application");
var file_name ="C:\\SOFR\\IMPORT\\Корректировки31122019БезМинфина_ДляКадина.xlsx";  
//var file_name ="C:\\SOFR\\IMPORT\\Минфинка_проводки30_31.xlsx";  
var ExcelDoc = ExcelApp.Workbooks.Open(file_name);
    ExcelDoc.Sheets(1).Activate();
var ActiveSheet = ExcelApp.ActiveSheet;
var row_cnt = ActiveSheet.UsedRange.Rows.Count;
var ind = 1;

Var Amount = 0, Portf = 0, Summa = $0, StrCatDeb = "", StrCatCred = "", TypeSum = "";
const bonusdate = date(31,12,2019);
const convdate = date(31,12,2019);


AccBirgRub = GetBirgAccount(0);
AccBirgUSD = GetBirgAccount(7);
AccBirgEUR = GetBirgAccount(8);


while ( ind <= row_cnt )
            StrCatDeb = "";
            StrCatCred = "";
            CatCred= "";
            CatDeb= "";

	    If(valtype(ActiveSheet.Cells(ind, 1).Value) == v_undef)
	       ind = ind + 1;
               continue;
	    end;

	    If(ActiveSheet.Cells(ind, 1).Value == "Тип суммы")
	       ind = ind + 1;
               continue;
	    end;

            TypeSum = ActiveSheet.Cells(ind, 1).Value; 
	    Amount = int(ActiveSheet.Cells(ind, 4).Value); 
	     Portf = Int(ActiveSheet.Cells(ind, 5).Value);
	    If(Portf == 6)
               ind = ind + 1;
               continue;
            end;
            FD = SPFirstDocFI(DLDOC_ISSUE, Amount, Amount, Group, {OurBank}, null, null, null);
            If(valtype(ActiveSheet.Cells(ind, 8).Value) == v_undef)
               ind = ind + 1;
               continue;
            end;
            Summa = money(ActiveSheet.Cells(ind, 8).Value);
	     StrCatDeb = string(ActiveSheet.Cells(ind, 9).Value);
	     StrCatCred = string(ActiveSheet.Cells(ind, 10).Value);
               Bpp = false;
               GroupBank = Group = Portf;
               Sum = abs(Summa);

               If(StrCatDeb == "+%Дц/б")
                  StrCatDeb = "+%ДЦ/б";
                  FIIDDebet = NATCUR;          
                  FIRoleDeb = GetFIRoleByPortfolio(Group);
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "Биржа")
                  StrCatDeb = "+Биржа";
                  FIIDDebet = FD.fininstr.rec.FaceValueFI;
                  FIRoleDeb = null;
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "+Корректировка, ц/б")
                  StrCatDeb = "+Корректировка, ц/б";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = GetFIRoleByPortfolio(Group);
                  CatDeb = StrCatDeb;

               end;

               If(StrCatDeb == "-Премия, ц/б")
                  StrCatDeb = "-Премия, ц/б";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = GetFIRoleByPortfolio(Group, false, false, false, false, true);
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "+Переоценка, ц/б")
                  StrCatDeb = "+Переоценка, ц/б СССД_ЦБ";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = FIROLE_BA_PPR;
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "-Переоценка, ц/б")
                  StrCatDeb = "-Переоценка, ц/б СССД_ЦБ";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = FIROLE_BA_PPR;
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "Начисл.ПДД, ц/б")
                  StrCatDeb = "Начисл.ПДД, ц/б";
                  FIIDDebet = FD.fininstr.rec.FaceValueFI;
                  FIRoleDeb = GetFIRoleByPortfolio(Group, true, false, Bpp);
                  CatDeb = StrCatDeb;
               end;

 /*8*/              If(StrCatDeb == "Премия, ц/б")
                  StrCatDeb = "Премия, ц/б";
                  FIIDDebet = FD.fininstr.rec.FaceValueFI;
                  FIRoleDeb = GetFIRoleByPortfolioBonus(Group, Bpp);
                  CatDeb = StrCatDeb;
               end;


               If(StrCatDeb == "Реализация")
                  StrCatDeb = "Реализация, ц/б";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = GetFIRoleByPortfolio(Group);
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "-ПО ДК 2014")
                  StrCatDeb = "-ПО ДК 2014";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = FIROLE_BA_PPR;
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "+ПО ДК 2014")
                  StrCatDeb = "+ПО ДК 2014";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = FIROLE_BA_PPR;
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "-КорЭПС_%, ц/б")
                  StrCatDeb = "-КорЭПС_%, ц/б";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = GetFIRoleByPortfolio(Group);
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "Наш портфель")
                  StrCatDeb = "Наш портфель ц/б";
                  FIIDDebet = FD.fininstr.rec.FaceValueFI;
                  FIRoleDeb = GetFIRoleByPortfolio(Group);
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "-Маржа, ц/б")
                  StrCatDeb = "-Маржа, ц/б";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = GetFIRoleByPortfolio(Group);
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "-Корректировка, ц/б")
                  StrCatDeb = "-Корректировка, ц/б";
                  FIIDDebet = NATCUR;
                  FIRoleDeb = GetFIRoleByPortfolio(Group);
                  CatDeb = StrCatDeb;
               end;

               If(StrCatDeb == "Премия, ц/б БПП")
                  Bpp = true;
                  StrCatDeb = "Премия, ц/б";
                  FIIDDebet = FD.fininstr.rec.FaceValueFI;
                  FIRoleDeb = GetFIRoleByPortfolioBonus(Group, Bpp);
                  CatDeb = StrCatDeb;
                  Bpp = false;
               end;



/*Кредит*/

               If(StrCatCred == "Биржа")
                  StrCatCred = "+Биржа";
                  FIIDCredit = FD.fininstr.rec.FaceValueFI;
                  FIRoleCred = null;
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     Ground = "Корректирующее списание дисконта при погашении по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);

               end;

               If(StrCatCred == "+%Дц/б")
                  StrCatCred = "+%ДЦ/б";
                  FIIDCredit = NATCUR;          
                  FIRoleCred = GetFIRoleByPortfolio(Group);
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     Ground = "Корректирующее доначисление дисконта по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);

               end;

               If(StrCatCred == "+Переоценка, ц/б")
                  StrCatCred = "+Переоценка, ц/б СССД_ЦБ";
                  FIIDCredit = NATCUR;
                  FIRoleCred = FIROLE_BA_PPR;
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     If((StrCatDeb == "Реализация") or (StrCatDeb == "Реализация, ц/б") )
                        Ground = "Корректирующее списание переоценки при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                     end;

               end;


               If(StrCatCred == "-Переоценка, ц/б")
                  StrCatCred = "-Переоценка, ц/б СССД_ЦБ";
                  FIIDCredit = NATCUR;
                  FIRoleCred = FIROLE_BA_PPR;
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     If((StrCatDeb == "Реализация") or (StrCatDeb == "Реализация, ц/б") )
                        Ground = "Корректирующее списание переоценки при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                     else
                        Ground = "Корректирующая переоценка по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                     end;

               end;


               If(StrCatCred == "+Корректировка, ц/б")
                  StrCatCred = "+Корректировка, ц/б";
                  FIIDCredit = NATCUR;
                  FIRoleCred = GetFIRoleByPortfolio(Group);
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     If((StrCatDeb == "Реализация") or (StrCatDeb == "Реализация, ц/б") )
                        Ground = "Корректирующее списание корректировки до ЭПС при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                     end;
               end;

               If(StrCatCred == "-Корректировка, ц/б")
                  StrCatCred = "-Корректировка, ц/б";
                  FIIDCredit = NATCUR;
                  FIRoleCred = GetFIRoleByPortfolio(Group);
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     If((StrCatDeb == "Реализация") or (StrCatDeb == "Реализация, ц/б") )
                        Ground = "Корректирующее списание корректировки до ЭПС при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                     end;
               end;


               If(StrCatCred == "-Премия, ц/б")
                  StrCatCred = "-Премия, ц/б";
                  FIIDCredit = NATCUR;
                  FIRoleCred = GetFIRoleByPortfolio(Group, false, false, false, false, true);
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     Ground = "Корректирующая проводка по списанию премии по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);

               end;

               If(StrCatCred == "Премия, ц/б")
                  StrCatCred = "Премия, ц/б";
                  FIIDCredit = FD.fininstr.rec.FaceValueFI;
                  FIRoleCred = GetFIRoleByPortfolioBonus(Group, Bpp);
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     If((StrCatDeb == "Реализация") or (StrCatDeb == "Реализация, ц/б") )
                        Ground = "Корректирующая проводка по списанию премии при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                     else
                        Ground = "Корректирующая проводка по списанию премии по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                     end;
               end;

               If(StrCatCred == "Реализация")
                  StrCatCred = "Реализация, ц/б";
                  FIIDCredit = NATCUR;
                  FIRoleCred = GetFIRoleByPortfolio(Group);
                  CatCred = StrCatCred;
		  Ground = "Корректировка";
                  If(StrCatDeb == "Начисл.ПДД, ц/б")
                     Ground = "Корректирующее списание дисконта при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  elIf((StrCatDeb == "-Корректировка, ц/б") OR (StrCatDeb == "-Корректировка, ц/б"))
                     Ground = "Корректирующее списание корректировок до ЭПС при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  elIf((StrCatDeb == "Премия, ц/б") OR (StrCatDeb == "Премия, ц/б"))
                     Ground = "Корректирующее списание премии при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  elif(((StrCatDeb == "-Маржа, ц/б") OR (StrCatDeb == "-Маржа, ц/б")) and (TypeSum == "Списание премии продажа"))
                     Ground = "Корректирующее списание премии при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  elif(((StrCatDeb == "-Маржа, ц/б") OR (StrCatDeb == "-Маржа, ц/б")) and (TypeSum == "Списание дисконта продажа"))
                     Ground = "Корректирующее списание дисконта при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  elif(((StrCatDeb == "-Маржа, ц/б") OR (StrCatDeb == "-Маржа, ц/б")) and (TypeSum == "Списание корректировки ЭПС"))
                     Ground = "Корректирующее списание корректировок до ЭПС при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  elif(((StrCatDeb == "-Маржа, ц/б") OR (StrCatDeb == "-Маржа, ц/б")) and (TypeSum == "Списание переоценки"))
                     Ground = "Корректирующее списание переоценки до ЭПС при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  end;

               end;

               If(StrCatCred == "+КорЭПС_%, ц/б")
                  StrCatCred = "+КорЭПС_%, ц/б";
                  FIIDCredit = NATCUR;
                  FIRoleCred = GetFIRoleByPortfolio(Group);
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     Ground = "Корректирующая проводка по корректировке до ЭПС по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
               end;

               If(StrCatCred == "+ПО ДК 2014")
                  StrCatCred = "+ПО ДК 2014";
                  FIIDCredit = NATCUR;
                  FIRoleCred = FIROLE_BA_PPR;
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     Ground = "Корректирующая проводка по Переоценке по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
               end;

               If(StrCatCred == "-ПО ДК 2014")
                  StrCatCred = "-ПО ДК 2014";
                  FIIDCredit = NATCUR;
                  FIRoleCred = FIROLE_BA_PPR;
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                     Ground = "Корректирующая проводка по списанию переоценки по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
               end;

               If(StrCatCred == "+Маржа, ц/б")
                  StrCatCred = "+Маржа, ц/б";
                  FIIDCredit = NATCUR;
                  FIRoleCred = GetFIRoleByPortfolio(Group);
                  CatCred = StrCatCred;
		  Ground = "Корректировка";
                  if(TypeSum == "Списание дисконта продажа")
                     Ground = "Корректирующее списание дисконта при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  elif(TypeSum == "Списание премии продажа")
                     Ground = "Корректирующее списание премии при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  elif(TypeSum == "Списание переоценки")
                     Ground = "Корректирующее списание переоценки при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  elif(TypeSum == "Списание корректировки ЭПС")
                     Ground = "Корректирующее списание корректировок по ЭПС при продаже по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
	 	  end;
               end;

               
               If(StrCatCred == "Начисл.ПДД, ц/б")
                  StrCatCred = "Начисл.ПДД, ц/б";
                  FIIDCredit = FD.fininstr.rec.FaceValueFI;
                  FIRoleCred = GetFIRoleByPortfolio(Group, true, false, Bpp);
                  CatCred = StrCatCred;
		  Ground = "Корректировка";

                  If(StrCatDeb == "+Биржа")

                     Ground = "Корректирующее списание дисконта при частичном погашении по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  else
                     Ground = "Корректирующее доначисление дисконта по ЦБ " + GetFinName(FD.fininstr.rec) + ", портфель " + GroupBank + "-я категория. Номер гос. рег." + User_GetLsin(FD.fininstr.rec.fiid);
                  end;
               end;


               If(StrCatCred == "Премия, ц/б БПП")
                  Bpp = true;
                  StrCatCred = "Премия, ц/б";
                  FIIDCredit = FD.fininstr.rec.FaceValueFI;
                  FIRoleCred = GetFIRoleByPortfolioBonus(Group, Bpp);
                  CatCred = StrCatCred;
                  Bpp = false;
               end;

               Ground = TypeSum + "(урегулирование по состоянию на 31.12.2019 ). ЦБ " + GetFinName(FD.fininstr.rec);

/*  Дисконт */
               If(StrCatDeb == "+Биржа")
                  If(FD.fininstr.rec.FaceValueFI == 0)
                     AccBirg = AccBirgRub;
                  elif(FD.fininstr.rec.FaceValueFI == 7)
                     AccBirg = AccBirgUsd;
                  elif(FD.fininstr.rec.FaceValueFI == 8)
                     AccBirg = AccBirgEur;
                  end;
                  if (not debug )
                     if( not ПроводкаПоКатегориямУчета( FD, 
                                                        AccBirg, CatCred,         /* КатегДеб , КатегКредит*/
                                                        convdate,                         /* Дата */
                                                        1,                       /* Глава */
                                                        FIIDDebet,                    /* Валюта */
                                                        Sum,                         /* Сумма */
                                                        Doc,                         /* Документ */
                                                        INPCARRY,                    /* Result_Carry */
                                                        " 1",                        /* Kind_Oper */
                                                        "",                          /* Numb_Document */
                                                        ground,
                                                        null,
                                                        FIRoleDeb, FIRoleCred,
                                                        FIIDDebet, FIIDCredit,
                                                        null, null, null, null, null, null, null,
                                                        @DebAccNumber,
                                                        @CredAccNumber
                                                      ) 
                       )
                        return println( 1, "Ошибка при выполнении проводки с " + AccBirg.rec.account + " на " + CatCred + "на сумму " + Sum );
                     end;
                  end;

/**/
               elif((StrCatDeb != "+Биржа") and (StrCatCred == "+Биржа"))
                  If(FD.fininstr.rec.FaceValueFI == 0)
                     AccBirg = AccBirgRub;
                  elif(FD.fininstr.rec.FaceValueFI == 7)
                     AccBirg = AccBirgUsd;
                  elif(FD.fininstr.rec.FaceValueFI == 8)
                     AccBirg = AccBirgEur;
                  end;
                  if (not debug )
                     if( not ПроводкаПоКатегориямУчета( FD, 
                                                        CatDeb, AccBirg,         /* КатегДеб , КатегКредит*/
                                                        convdate,                         /* Дата */
                                                        1,                       /* Глава */
                                                        FIIDDebet,                    /* Валюта */
                                                        Sum,                         /* Сумма */
                                                        Doc,                         /* Документ */
                                                        INPCARRY,                    /* Result_Carry */
                                                        " 1",                        /* Kind_Oper */
                                                        "",                          /* Numb_Document */
                                                        ground,
                                                        null,
                                                        FIRoleDeb, FIRoleCred,
                                                        FIIDDebet, FIIDCredit,
                                                        null, null, null, null, null, null, null,
                                                        @DebAccNumber,
                                                        @CredAccNumber
                                                      ) 
                       )
                        return println( 1, "Ошибка при выполнении проводки с " + CatDeb + " на " + AccBirg.rec.account + "на сумму " + Sum );
                     end;
                  end;
              

              
               elif(StrCatDeb == "-Премия, ц/б")
                  if (not debug )

                    if( not ПроводкаПоКатегориямУчета( FD,
                                                       CatDeb, CatCred,             /* КатегДеб, КатегКредит*/
                                                       convdate,                         /* Дата */
                                                       1,                           /* Глава */
                                                       null, /*FIIDDebet,*/ /* Валюта */
                                                       null, /*Sum,*/                         /* Сумма */
                                                       Doc,                         /* Документ */
                                                       INPCARRY,                    /* Result_Carry */
                                                       " 1",                        /* Kind_Oper */
                                                       "",                          /* Numb_Document */
                                                       ground,
                                                       null,
                                                       FIRoleDeb, FIRoleCred,
                                                       FIIDDebet, FIIDCredit,
                                                       /*null, null, */ FIIDCredit, Sum, null, null, null, null, null,
                                                       @DebAccNumber,
                                                       @CredAccNumber
                                                     )
                      )
                       return println( 1, "Ошибка при выполнении проводки с " + CatDeb + " на " + CatCred + "на сумму " + Sum  );
                    end;
                 end;
               else
                  if (not debug )
                     if( not ПроводкаПоКатегориямУчета( FD, 
                                                        CatDeb, CatCred,         /* КатегДеб , КатегКредит*/
                                                        convdate,                         /* Дата */
                                                        1,                       /* Глава */
                                                        FIIDDebet,                    /* Валюта */
                                                        Sum,                         /* Сумма */
                                                        Doc,                         /* Документ */
                                                        INPCARRY,                    /* Result_Carry */
                                                        " 1",                        /* Kind_Oper */
                                                        "",                          /* Numb_Document */
                                                        ground,
                                                        null,
                                                        FIRoleDeb, FIRoleCred,
                                                        FIIDDebet, FIIDCredit,
                                                        null, null, null, null, null, null, null,
                                                        @DebAccNumber,
                                                        @CredAccNumber
                                                      ) 
                       )
                        return println( 1, "Ошибка при выполнении проводки  с " + CatDeb + " на " + CatCred + "на сумму " + Sum   );
                     end;
                  end;

              end;
               println(DebAccNumber + "    " + CredAccNumber + "   " + Ground);
               StrCatDeb = "";
               StrCatCred = "";
               CatCred = "";
               CatDeb = "";
                ind = ind + 1;

            end;

end;