/*
     R-Style Software Lab.

     RS-Retail 2.01.

     Заявка на получение аванса для операций
     в операционной кассе вне кассового узла (ОКВКУ)

*/

/* Для Пробизнесбанка реализована печать двух отдельных заявок на получение аванса:
        (1) на рубли
        (2) на валюту, ПД и справки БСО.
 */

 import DeprIntr, DeskInter, Календарь;

 file bank     ( bank     ) key 9999;  /* Параметры Банка */
/* file listfdep ( listfdep ) key 0;*/     /* Филиалы   Банка */
 var party = TRecHandler( "i_party.rec" );

 const
   BS_BRANCH       = 0,    /* Филиал                 */
   BS_DEP          = 1,    /* Отделение              */
   BS_EXCH         = 2,    /* Обменный пункт         */
   BS_OPERDEP      = 3;    /* Оперчасть              */

 const FNCash  = NumFNCash();  /* Номер филиала */

 var {curdate};         
 var {Oper};
 var NextWorkDay;

 var BankName       = "";
 var NameBranch     = "";
 var AddrBranch     = "";
 var Placement      = "";
 var ShortPlacement = "";
 var StatusBranch   = "";


 macro Get_OperName
  file pers  ( person, "bank.def" );
  var  Name = " ", IOtmp;

  ClearRecord( pers );
  pers.Oper = {Oper};
  if ( GetEq( pers ) )
    Name = SubStr( pers.Name, 1, Index(pers.Name, " ") - 1 );
    IOtmp= Trim( Substr( pers.Name, Index(pers.Name, " ") ) );
    Name = Name + " " + strupr( Substr(IOtmp, 1, 1)) + ".";
    IOtmp = Trim( Substr( IOtmp, Index(IOtmp," ") ) );
    Name = Name + strupr( Substr( IOtmp, 1, 1 ) ) + ".";
  end;

  return Name;
 end;

 
 macro RUR_cs_avans
 [
                                                  Заявка на получение аванса
                                                  для совершения операций в
                                                  # 
                                                  (рубли)


                                     ЗАЯВКА
        на получение аванса для совершения операций в #
                                        #

                                        #

 Адрес #                                                                          
 Прошу выдать мне _____________________________________________________________
 1. Аванс:
 Наличные рубли _______________________________________________________________
 ______________________________________________________________________________
 ______________________________________________________________________________


 Кассир                                          _____________________________
                                                                       (Ф.И.О.)

 ]( 
    StatusBranch + " " + ShortPlacement,
    StatusBranch,
    Placement + " " + NameBranch:c,
    String(NextWorkDay:m):c,
    AddrBranch 
    /*, Get_OperName */ 
  );
 PrintLn( StrFor( 12 ) );
 end;


 macro VAL_cs_avans
 [
                                                  Заявка на получение аванса
                                                  для совершения операций в
                                                  #
                                                  (валюта и БСО)


                                     ЗАЯВКА
        на получение аванса для совершения операций в #
                                        #

                                        #

 Адрес #                                                                          
 Прошу выдать мне _____________________________________________________________
 1. Аванс:
 Наличная валюта:
 Доллары США __________________________________________________________________
 ______________________________________________________________________________
 ______________________________________________________________________________
 Евро _________________________________________________________________________
 ______________________________________________________________________________
 Другие валюты ________________________________________________________________
 ______________________________________________________________________________
 ______________________________________________________________________________
 ______________________________________________________________________________
 2. Бланки платежных документов _______________________________________________
 ______________________________________________________________________________
 3. Бланки строгой отчетности ф.0406007 в количестве: __________________ листов
 ______________________________________________________________________________


 Кассир                                          _____________________________
                                                                       (Ф.И.О.)
 ]( 
    StatusBranch + " " + ShortPlacement,
    StatusBranch,
    Placement + " " + NameBranch:c, 
    String(NextWorkDay:m):c,
    AddrBranch 
    /*, Get_OperName */ 
  );
 end;


 /* Получение имени и адреса оперкассы */
 if ( findDepartment(FNCash, null, null, party) )
   NameBranch = party.rec.Name;
   AddrBranch = party.rec.address;
/*
   if( listfdep.Placement )
     Placement      = "вне кассового узла";
     ShortPlacement = "ВКУ";
   end;
*/
   if(   GetBranchStatus() == BS_EXCH    )
     StatusBranch = "обменном пункте";
   elif( GetBranchStatus() == BS_OPERDEP )
     StatusBranch = "операционной кассе";
   end;
 end;

 /* Получение даты следующего рабочего дня */
 NextWorkDay = {curdate}+1;
 while ( not( IsWorkDay(NextWorkDay) ) )
   NextWorkDay = NextWorkDay + 1;
 end;

   RUR_cs_avans;
   VAL_cs_avans;
 end;
