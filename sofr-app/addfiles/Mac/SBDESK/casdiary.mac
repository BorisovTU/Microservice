/* „­¥¢­¨ª ¯® ª« ¤®¢®© */

import deprintr, chkboss;

file Alg    ("namealg.dbt","bank.def")  key 0;
file CashDoc("sb_casdc.dbt"          ) key 5;
file CashVal("sb_casvl.dbt"          ) key 0;

const
  CD_Uncarried = 1,
  CD_Carried = 2;

const
  OC_Debet = "1",
  OC_Credit = "2";

const
  ALG_CASH_VAL_TYPE = 811;    /* ’¨¯ë à¥áãàá®¢ ª ááë ¢ namealg.dbt */

var
  Branch = NumFNCash,
  Safe,
  OperBrigade = GetOperBrigade,
  {curdate};

macro GetNativeSafe

  file Group("rtgroup.dbt") key 2;

  if( GetProgramID != CodeFor( "‹" ) )       /* ­¥ Š« ¤®¢ ï ®â¤¥«¥­¨ï */
    Group.Branch = Branch;
    Group.Date = {curdate};
    Group.ID = OperBrigade;
    if(GetEQ(Group))
      return Group.SafeID;
    else
      MsgBox("¥ ­ ©¤¥­ á¥©ä ¡à¨£ ¤ë ü ", OperBrigade);
      Exit;
    end;
  else
    return "Š« ¤®¢ ï";
  end;
end;

/* ®«ãç¨âì ­ §¢ ­¨¥ â¨¯  à¥áãàá  ª ááë */
macro GetCashTypeName(Type)

  Alg.iTypeAlg = ALG_CASH_VAL_TYPE;
  Alg.iNumberAlg = Type;
  if(GetEQ(Alg))
    return Alg.szNameAlg;
  else
    return String(Type);
  end;
end;

macro GetValName(RefValue)
  var str;
  CashVal.RefValue=RefValue;
  if(not GetEQ(CashVal))
    MsgBox("è¨¡ª  ¯à¨ çâ¥­¨¨ ä ©«  sb_casvl.dbt");
    Exit;
  else
    str = CashVal.NameValue;
    if ( CashVal.Type != 0 )
      str = str + " (" + GetCashTypeName(CashVal.Type) + ")";
    end;
    return str;
  end;
end;

macro OutTitle;

  [
                            Š­¨£  ¯® ãç¥âã ¢­¥á¥­­ëå ¢ ª« ¤®¢ãî
                         ¨ ¢ë­¥á¥­­ëå ¨§ ª« ¤®¢®© ¤¥­¥£ ¨ æ¥­­®áâ¥©
                                        §  ##########
  ]
  (String({curdate}));
end;

macro OutCarriedDocsSubTitle;

  PrintLn;
  PrintLn("  ®¤â¢¥à¦¤¥­­ë¥ ¤®ªã¬¥­âë");
  PrintLn;
end;

macro OutUncarriedDocsSubTitle;

  PrintLn;
  PrintLn("  ¥¯®¤â¢¥à¦¤¥­­ë¥ ¤®ªã¬¥­âë");
  PrintLn;
end;

macro OutHeader;

  [ÚÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
   ³            ³                                                             ³                        ³   ® ¤ ¯ ¨ á ¨  ³                       ³   ® ¤ ¯ ¨ á ¨  ³
   ³            ³                                                             ³                        ÃÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄ´                       ÃÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄ´
   ³    „ â     ³                                                             ³                        ³  § ¢.  ³«¨æ,¯à¨-³                       ³  § ¢.  ³«¨æ,¯à¨-³
   ³            ³             ¨ ¬ ¥ ­ ® ¢   ­ ¨ ¥   æ ¥ ­ ­ ® á â ¨          ³  ‚ë­¥á¥­® ¨§ ª« ¤®¢®©  ³ª« ¤®¢®©³áãâáâ¢®-³  ‚­¥á¥­® ¢ ª« ¤®¢ãî   ³ª« ¤®¢®©³áãâáâ¢®-³
   ³   § ¯¨á¨   ³                                                             ³                        ³  (áâ.  ³ ¢ ¢è¨å ³                       ³  (áâ.  ³ ¢ ¢è¨å ³
   ³            ³                                                             ³                        ³ª áá¨à )³¯à¨ ¢ë­.³                       ³ª áá¨à )³ ¯à¨ ¢­.³
   ³            ³                                                             ³                        ³        ³æ¥­­®áâ.³                       ³        ³æ¥­­®áâ.³
   ÃÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄ´];
end;

macro OutLine;

  var
    Debet,Credit;

  if(CashDoc.FlagDebCredOper==OC_Debet)
    Credit="";
    if(CashDoc.ValueMoney>$0.00)
      Debet=String(CashDoc.ValueMoney);
    elif(CashDoc.ValueCol>0)
      Debet=String(CashDoc.ValueCol);
    else
      Debet="";
    end;
  else
    Debet="";
    if(CashDoc.ValueMoney>$0.00)
      Credit=String(CashDoc.ValueMoney);
    elif(CashDoc.ValueCol>0)
      Credit=String(CashDoc.ValueCol);
    else
      Credit="";
    end;
  end;

  [³ ########## ³ ########################################################### ³ ###################### ³        ³        ³ ##################### ³        ³        ³]
  (CashDoc.CashDateDoc,GetValName(CashDoc.RefValue):w,Debet:r,Credit:r);
end;

macro OutBottomLine;

  [ÀÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÙ];
end;

macro OutCarriedDocs;

  CashDoc.Branch=Branch;
  CashDoc.CashDateDoc={curdate};
  CashDoc.TypeDoc=CD_Carried;
  CashDoc.CashPatern=Safe;
  CashDoc.RefValue=0;
  CashDoc.FlagDebCredOper="";

  OutCarriedDocsSubTitle;
  OutHeader;

  if(GetGE(CashDoc) and
    (CashDoc.Branch==Branch) and
    (CashDoc.CashDateDoc=={curdate}) and
    (CashDoc.TypeDoc==CD_Carried) and
    (cashDoc.CashPatern==Safe))
    OutLine;
    while(Next(CashDoc) and
      (CashDoc.Branch==Branch) and
      (CashDoc.CashDateDoc=={curdate}) and
      (CashDoc.TypeDoc==CD_Carried) and
      (cashDoc.CashPatern==Safe))
      OutLine;
    end;
  end;

  OutBottomLine;
end;

macro OutUncarriedDocs;

  CashDoc.Branch=Branch;
  CashDoc.CashDateDoc={curdate};
  CashDoc.TypeDoc=CD_Uncarried;
  CashDoc.CashPatern=Safe;
  CashDoc.RefValue=0;
  CashDoc.FlagDebCredOper="";

  OutUncarriedDocsSubTitle;
  OutHeader;

  if(GetGE(CashDoc) and
    (CashDoc.Branch==Branch) and
    (CashDoc.CashDateDoc=={curdate}) and
    (CashDoc.TypeDoc==CD_Uncarried) and
    (cashDoc.CashPatern==Safe))
    OutLine;
    while(Next(CashDoc) and
      (CashDoc.Branch==Branch) and
      (CashDoc.CashDateDoc=={curdate}) and
      (CashDoc.TypeDoc==CD_Uncarried) and
      (cashDoc.CashPatern==Safe))
      OutLine;
    end;
  end;

  OutBottomLine;
end;

  ByeBoss(0);
  Safe = GetNativeSafe;
  OutTitle;
  OutCarriedDocs;
  OutUncarriedDocs;
end;

