
/* Переходник для ф.61 */

import Form_61;

file BagDoc( "bag_doc.dbt" ) key 0;  
record Bag( "bag.dbt" );
file Person( "person.dbt", "bank.def" )   key 0;

const
  PT_OPER        = 1,
  PT_CONTR       = 2; 

var
  {PantryAutoMode};

macro GetPerson

  Person.Oper = {oper};
  return GetEQ( Person );
end;

macro CheckPersonType( Type )

  if ( {PantryAutoMode} )
    return;
  end;

  GetPerson;
  if ( ( Type == PT_OPER ) and ( Person.cTypePerson != "О" ) )
    Exit( 1 );
  elif ( ( Type == PT_CONTR ) and ( Person.cTypePerson == "О" ) )
    Exit( 1 );
  end;
end;

macro CanIssueOrders

  CheckPersonType( PT_OPER );

  Person.Oper = {oper};
  if ( not GetEQ( Person ) )
    MsgBox( "Пользователь не найден: ", {oper} );
    Exit( -1 );
  end;
  return ( Bag.Operation == CASHOP_PANT_RDEB ) 
     or ( ( Person.cTypePerson != "У" ) 
     and ( Person.cTypePerson != "Б" )
     and ( Person.cTypePerson != "С" ) );
end;

  if ( not CanIssueOrders )
    MsgBox( "Вы не имеете права выпускать приходные ордера" );
    Exit( -1 );
  end;
                                     
  BagDoc.BagAppKind = Bag.ApplicationKind;
  BagDoc.BagAppKey = Bag.ApplicationKey;
  BagDoc.State = Bag.State;
  if ( GetEQ( BagDoc ) )
    PrintForm61( BagDoc.ApplicationKind, BagDoc.ApplicationKey );
  end;
end;


