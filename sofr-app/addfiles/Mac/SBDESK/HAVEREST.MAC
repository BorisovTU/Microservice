/*
  RS-Bank Сбербанка
  Касса филиала

  Список счетов на сегодня с ненулевым остатком

  05.09.97
  Ромодин Александр Васильевич
*/
import BankInter,deprintr,rep_desk;

file acc ("sb_casac.dbt");
file val ("sb_casvl.dbt");

var {curdate}, Branch = NumFNCash;

/***********************************************************/

macro Разделитель_1
  [-----------------------------------------------------------------------------------------]
end;
/***********************************************************/

macro Заголовок_отчета
  [ ];
  [  	         Список счетов с ненулевым остатком на ##########]({curdate});
  [ ];
  Разделитель_1();
  [|  Кассир    |            Ресурсия                   |       Сумма             | Кол-во |];
  [|            |                                       |      (деньги)           |(штуки) |];
  Разделитель_1();
/*  ############ ####################################### ######################### ######## */
end;
/***********************************************************/

macro Название_ценности (RefValue)
  var NameValue;
  KeyNum (val,0);
  val.RefValue = RefValue;
  if (GetEQ(val))
    NameValue = val.NameValue;
  else
    NameValue = "";
  end;
  return NameValue;
end;
/***********************************************************/

macro Строка_отчета
  var NameValue = Название_ценности(acc.RefValue);
  [ ############ ####################################### ######################### ########]
   (acc.CashOper,
    NameValue,
    acc.RestMoney,acc.RestCol);
end;
/***********************************************************/

macro  Конец_отчета
  Разделитель_1 ();
  [ ];
end;
/***********************************************************
************************************************************/

/***********************************************************
************************************************************/
macro Подходящий_Субъект

  file DeskSubj( "desksubj.dbt" ) key 1;

  const
    DST_WORKDESK = 3; 

  DeskSubj.Branch = Branch;
  DeskSubj.Type = DST_WORKDESK;
  DeskSubj.Name = acc.CashOper;

  return GetEQ( DeskSubj );
end;

macro Цикл_по_счетам
  var stat;

  KeyNum (acc,0);
  acc.Branch = Branch;
  acc.Date = {curdate};
  acc.CashOper = "";
  acc.RefValue = 0;
  stat = GetGE (acc);
  while (stat)
    if ((acc.Date != {curdate}) or (acc.Branch != Branch))
      stat = FALSE;
    else
      if (Подходящий_Субъект and ((acc.RestMoney != 0) OR (acc.RestCol != 0)) and (acc.SubAccount == ""))
	Строка_отчета ();
      end;
      stat = Next (acc);
    end;
  end;
end;

/***********************************************************
##### Головной макрос ######################################
************************************************************/

  Начало_Конец_отчета ();
  Заголовок_отчета ();
  Цикл_по_счетам ();
  Конец_отчета ();
  Начало_Конец_отчета ();
end;

/***********************************************************/
