/*
$Name: res2_out.mac
$Module: Касса
$Description: Ф. 25-в -- функции вывода
*/

/* закомментировано при удалении таблицы ddesk_rec_dbt по ##197859, 198467 */
/*
import ResComm;

macro OutTitle;

  [
   Место для штампа учреждения                                                                                  Форма № 25-в

                                                          Приложение к операционному дневнику № ####
                                                                          за ###########

  ]
  (GetDiaryNo,String({curdate}));
end;

macro OutVFHeader;

  [                                                  Раздел II. "Ценные бланки" ];
  [ ];
  [+----------------------------------------+----------+---------+----------+----------+----------+------------------------------+
   |                                        | Остаток  |         |Израсходов| Выслано в| Остаток  |       №№ ценных бланков      |
   |          Наименование бланка           | к началу |Поступило| по опера-|учреждения| к концу  |         ( с № по № )         |
   |                                        |   дня    |         |   циям   |Сбербанка |   дня    |                              |
   +----------------------------------------+----------+---------+----------+----------+----------+------------------------------+];
end;

macro OutVFNameValTail

  var
   RangeStr = "",
   NameValStr = "",
   RecFound,
   i=1;

  while((RecFound = (Next(RegNumList)
    and (RegNumList.Branch == CashAcc.rec.Branch)
    and (RegNumList.CashOper == CashAcc.rec.CashOper)
    and (RegNumList.Date == CashAcc.rec.Date)
    and (RegNumList.ValueRef == CashAcc.rec.RefValue)))
    or (i < asize(NameValArr)))
    if(i < asize(NameValArr))
      NameValStr = NameValArr(i);
    end;
    if(RecFound)
      RangeStr = MakeRangeStr;
    end;

    [| ###################################### |          |         |          |          |          | ############################ |]
    (
      NameValStr,
      RangeStr
    );
    i=i+1;
  end;
end;

macro OutVFLine(NameVal,PrevRest,IPrevRest,CurRest,ICurRest,Cred,ICred,OtherCred,IOtherCred,Deb,IDeb,OtherDeb,IOtherDeb);

  var
    RangeStr = "";

  StrSplit(NameVal,NameValArr,38);

  if((not ShowNullLines) and (PrevRest==$0) and (Cred==$0) and (OtherCred==$0)
     and (Deb==$0) and (OtherDeb==$0) and (CurRest==$0)
     and (IPrevRest==0) and (ICred==0) and (IOtherCred==0)
     and (IDeb==0) and (IOtherDeb==0) and (ICurRest==0))
    return;
  end;

  if ( not PrevRest )
    PrevRest = Money( IPrevRest );
  end;
  if ( not CurRest )
    CurRest = Money( ICurRest );
  end;
  if ( not Cred )
    Cred = Money( ICred );
  end;
  if ( not OtherCred )
    OtherCred = Money( IOtherCred );
  end;
  if ( not Deb )
    Deb = Money( IDeb );
  end;
  if ( not OtherDeb )
    OtherDeb = Money( IOtherDeb );
  end;

  ClearRecord(RegNumList);
  RegNumList.Branch = CashAcc.rec.Branch;
  RegNumList.CashOper = CashAcc.rec.CashOper;
  RegNumList.ValueRef = CashAcc.rec.RefValue;
  RegNumList.Date = CashAcc.rec.Date;
  if(GetGE(RegNumList)
    and (RegNumList.Branch == CashAcc.rec.Branch)
    and (RegNumList.CashOper == CashAcc.rec.CashOper)
    and (RegNumList.Date == CashAcc.rec.Date)
    and (RegNumList.ValueRef == CashAcc.rec.RefValue))
    RangeStr = MakeRangeStr;
  end;

  [| ###################################### |##########|#########|##########|##########|##########| ############################ |]
  (NameValArr(0),PrevRest:z,Cred+OtherCred:z,OtherDeb:z,Deb:z,CurRest:z,RangeStr);
  OutVFNameValTail;
  TotPrevRestF=TotPrevRestF+PrevRest;
  TotCreditF=TotCreditF+Cred;
  TotDebetF=TotDebetF+Deb;
  TotOtherCredF=TotOtherCredF+OtherCred;
  TotOtherDebF=TotOtherDebF+OtherDeb;
  TotRestF=TotRestF+CurRest;
end;

macro OutVFTotLine;

  [+----------------------------------------+----------+---------+----------+----------+----------+------------------------------+];
  [| И т о г о                              |##########|#########|##########|##########|##########|                              |]
  (TotPrevRestF,TotCreditF+TotOtherCredF,TotOtherDebF,TotDebetF,TotRestF);
end;

macro OutCrHeader;

  [                                                          Раздел I. "Иностранная валюта" ];
  [ ];
  [+---+--------------------+----------------------------+------------------------+--------------------------+---------------------------+
   |   |                    |   Остаток на начало дня    |        Приход          |           Расход         |    Остаток на конец дня   |
   |Код|                    |--------------+-------------+-----------+------------|------------+-------------|-------------+-------------|
   |   |    Наименование    |              |  в рублях   |           |            |            |             |             |             |
   |вал|       валюты       |  в валюте    |-------------+ в валюте  |  в рублях  |  в валюте  |   в рублях  |   в валюте  |   в рублях  |
   |   |                    |              |за пред. день|           |            |            |             |             |             |
   |   |                    |              |-------------|           |            |            |             |             |             |
   |   |                    |              |с уч.изм.курс|           |            |            |             |             |             |
   +---+--------------------+--------------+-------------+-----------+------------+------------+-------------+-------------+-------------+];
end;

macro OutCrNameValTail

  var i=1;

  while(i<asize(NameValArr))
  [|   |####################|              |             |           |            |            |             |             |             |]
    (NameValArr(i));
    i=i+1;
  end;
end;

macro OutCrLine(PrevRest,CurRest,Cred,OtherCred,Deb,OtherDeb);

  var
    PrevRestRN="",
    PrevRestR="",
    Credit=Cred+OtherCred,
    CreditR,
    Debet=Deb+OtherDeb,
    DebetR,
    CurRestR;
  var ScaleRate = 1;

  if (Currency.ScaleOfc != 0)
    ScaleRate = Currency.ScaleOfc;
  end;

  CreditR  = Money(Credit*Currency.Cur_Rate/(100 * ScaleRate));
  DebetR   = Money(Debet*Currency.Cur_Rate/(100 * ScaleRate));
  CurRestR = Money(CurRest*Currency.Cur_Rate/(100 * ScaleRate));

  if(Currency.Date_Rate=={curdate})
    PrevRestRN=Money(PrevRest*Currency.Cur_Rate/(100 * ScaleRate));
    PrevRestR=Money(PrevRest*Currency.Prev_Rate/(100 * ScaleRate));
  else
    PrevRestR=Money(PrevRest*Currency.Cur_Rate/(100 * ScaleRate));
  end;

  StrSplit(Currency.Name_Currency,NameValArr,23);

  if((not ShowNullLines) and (PrevRest==0) and (PrevRestR==0)
     and (PrevRestRN==0) and (Credit==0) and (CreditR==0)
     and (Debet==0) and (DebetR==0) and (CurRest==0) and (CurRestR==0))
    return;
  end;

  [|###|####################|##############|#############|###########|############|############|#############|#############|#############|
   |   |                    |              |#############|           |            |            |             |             |             |]
  (
    Currency.ExternalCode,
    NameValArr(0),
    PrevRest:z,
    PrevRestR:z,
    Credit:z,
    CreditR:z,
    Debet:z,
    DebetR:z,
    CurRest:z,
    CurRestR:z,
    PrevRestRN:z
  );
  OutCrNameValTail;
  TotPrevRestC=TotPrevRestC+PrevRest;
  TotPrevRestCR=TotPrevRestCR+PrevRestR;
  TotPrevRestCRN=TotPrevRestCRN+PrevRestRN;
  TotCreditC=TotCreditC+Credit;
  TotCreditCR=TotCreditCR+CreditR;
  TotDebetC=TotDebetC+Debet;
  TotDebetCR=TotDebetCR+DebetR;
  TotRestC=TotRestC+CurRest;
  TotRestCR=TotRestCR+CurRestR;
end;

macro OutCrTotLine;

  [+---+-------------------------+-----------------------+-----------------------+-----------------------+-----------------------+----------------------+-----------------------+];
  [|   | И т о г о :             | ##################### | ##################### | ##################### | ##################### | #################### | ##################### |]
  (
    TotPrevRestC,
    TotPrevRestCR,
    TotPrevRestCRN,
    TotCreditC,
    TotCreditCR,
    TotDebetC,
    TotDebetCR,
    TotRestC,
    TotRestCR
  );
end;

macro OutDepHead

  PrintLn("                         Раздел III. Справка об оборотах и остатках по счетам в инвалюте ");
  PrintLn;
end;

macro OutDepSubHead

  PrintLn(Currency.Name_Currency);
  PrintLn;
  [                                                       Обороты и остатки];
  [+-----+-----------------------------+---------------------+-------------------+-------------------+---------------------------+
   |  №  |                             | Остаток к началу дня|         Приход    |         Расход    |   Остаток к концу дня     |
   |счета|      Наименование счета     |-----+---------------|---+---------------|---+---------------|-----+---------------------|
   |     |                             |счета|    сумма      |сч.|        сумма  |сч.|    сумма      |счета|        сумма        |
   +-----+-----------------------------+-----+---------------+---+---------------+---+---------------+-----+---------------------+];
end;

macro OutStatTotals

  [+-----+-----------------------------+-----+---------------+---+---------------+---+---------------+-----+---------------------+];
  [| И т о г о:                        | ####| ##############|###| ##############|###|###############|#####|#####################|]
  (
    TotPrevAcc,
    TotPrevRestC,
    TotOpenedAcc,
    TotCreditC,
    TotClosedAcc,
    TotDebetC,
    TotAcc,
    TotRestC
  );
end;

macro OutDepLine

  var
    CitStr;
  var BAcc = "";

  if((not ShowNullLines)
     and (PrevStat.ColOpenedAcc==0)
     and (PrevStat.Rest==0)
     and (DepStat.rec.ColAccounts==PrevStat.ColAccounts)
     and (DepStat.rec.KredSum==0)
     and (DepStat.rec.ColClosedAcc==PrevStat.ColClosedAcc)
     and (DepStat.rec.DebSum==0)
     and (DepStat.rec.ColOpenedAcc==0)
     and (DepStat.rec.Rest==0))
    return;
  end;

  if(not DepStat.rec.FlagRez)
    CitStr = " (рез.)";
    BAcc = DepType.BalAcc;
  else
    CitStr = " (нер.)";
    BAcc = DepType.BalAccNotRez;
  end;

  [|#####|#############################|#####|###############|###|###############|###|###############|#####|#####################|]
  (
    BAcc,
    (DepType.Name+CitStr):w,
    PrevStat.ColOpenedAcc:z,
    PrevStat.Rest:z,
    DepStat.rec.CurOpenAc:z,
    DepStat.rec.KredSum:z,
    DepStat.rec.CurClosAc:z,
    DepStat.rec.DebSum:z,
    DepStat.rec.ColOpenedAcc:z,
    DepStat.rec.Rest:z
  );
  TotPrevAcc = TotPrevAcc + PrevStat.ColOpenedAcc;
  TotOpenedAcc = TotOpenedAcc + DepStat.rec.CurOpenAc;
  TotClosedAcc = TotClosedAcc + DepStat.rec.CurClosAc;
  TotAcc = TotAcc + DepStat.rec.ColOpenedAcc;
  TotPrevRestC = TotPrevRestC + PrevStat.Rest;
  TotCreditC = TotCreditC + DepStat.rec.KredSum;
  TotDebetC = TotDebetC + DepStat.rec.DebSum;
  TotRestC = TotRestC + DepStat.rec.Rest;
end;


macro OutStatHead2

  [ ];
  if (NOT WasPrintCurr)
    PrintLn(Currency.Name_Currency);
    [ ];
  end;
  [                                 Ведомость начисленных процентов, отраженных по балансу];
  [+-----+------------------------------+----------------------------------------------------------------------------------+
   |  №  |                              |               Сумма начисленных процентов, отраженных по балансу                 |
   |счета|     Наименование счета       |-------------+-----------+-----------------------------------------+--------------|
   |     |                              |  Остаток на | Начислено |                  Списано                |  Остаток на  |
   |     |                              |  начало дня |           |---------------------+-------------------|  конец дня   |
   |     |                              |             |           |Причисленные к вкладу|Излишне начисленные|              |    
   +-----+------------------------------+-------------+-----------+---------------------+-------------------+--------------+];
end;

macro OutStatTotals2

  if (NOT WasPrintEstim)
    [+-----+------------------------------+-------------+-----------+---------------------+-------------------+--------------+];
  end;
  [| И т о г о:                         |#############|###########|#####################|###################|##############|]
  (
  TotPrevEstimRest,
  TotEstimIn,
  TotEstinOut,
  TotEstimOverOut,
  TotEstimRest
  );

end;

macro OutStatTotalBA

  [+-----+------------------------------+-------------+-----------+---------------------+-------------------+--------------+];
  [| Итого по б/с ######                |#############|###########|#####################|###################|##############|]
  (
  NumBA,
  BAPrevEstimRest,
  BAEstimIn,
  BAEstinOut,
  BAEstimOverOut,
  BAEstimRest
  );
  [+-----+------------------------------+-------------+-----------+---------------------+-------------------+--------------+];

end;

macro OutDepLine2

  var
    CitStr;
  var BAcc = "";

  if((not ShowNullLines)
     and (PrevStat.EstimRest==0)
     and (DepStat.rec.EstimIn==0)
     and (DepStat.rec.EstimOut==0)
     and (DepStat.rec.EstimOverOut==0)
     and (DepStat.rec.EstimRest==0))
    return;
  end;

  if(not DepStat.rec.FlagRez)
    CitStr = " (рез.)";
    BAcc = DepType.BalAcc;
  else
    CitStr = " (нер.)";
    BAcc = DepType.BalAccNotRez;
  end;

  [|#####|############################# |#############|###########|#####################|###################|##############|]
  (
    BAcc,
    (DepType.Name+CitStr):w,
    PrevStat.EstimRest:z,
    DepStat.rec.EstimIn:z,
    DepStat.rec.EstimOut:z,
    DepStat.rec.EstimOverOut:z,
    DepStat.rec.EstimRest:z
  );

  WasPrintBA    = TRUE;
  WasPrintEstim = TRUE;
  NumBA = BAcc;

  TotPrevEstimRest = TotPrevEstimRest + PrevStat.EstimRest;
  TotEstimIn       = TotEstimIn       + DepStat.rec.EstimIn;
  TotEstinOut      = TotEstinOut      + DepStat.rec.EstimOut;
  TotEstimOverOut  = TotEstimOverOut  + DepStat.rec.EstimOverOut;
  TotEstimRest     = TotEstimRest     + DepStat.rec.EstimRest;

  BAPrevEstimRest = BAPrevEstimRest + PrevStat.EstimRest;
  BAEstimIn       = BAEstimIn       + DepStat.rec.EstimIn;
  BAEstinOut      = BAEstinOut      + DepStat.rec.EstimOut;
  BAEstimOverOut  = BAEstimOverOut  + DepStat.rec.EstimOverOut;
  BAEstimRest     = BAEstimRest     + DepStat.rec.EstimRest;

end;


macro OutMemHead

  [ ];
  [ ];
  [                                       Раздел V. "Справка о безналичных операциях за квартал" ];
end;


macro OutOpHead

  [ ];
  [                                                       Раздел IV. "Учет операций" ];
end;


macro OutMemSubHead;
  [ ];
  [#](Currency.Name_Currency);
  [ ];
  [+--------------------------------------------------------------------+--------------------------------------------------------+
   |                                                                    |   К началу дня   |       За день    |С начала квартала |
   +--------------------------------------------------------------------+------------------+------------------+------------------+];
end;

macro OutOpSubHead

  [ ];
  [#](Currency.Name_Currency);
  [ ];
  [+--------------------------------------------------------------------+--------------------------------------------------------+
   |                                                                    |              Количество операций                       |
   |                      В И Д Ы   О П Е Р А Ц И Й                     |------------------+------------------+------------------|
   |                                                                    |   К началу дня   |       За день    | С начала квартала|
   +--------------------------------------------------------------------+------------------+------------------+------------------+];
end;


macro OutOpMemLine(OpName, PrevNOps, NOps)

  if(PrevNOps or NOps)
    [| ################################################################## |##################|##################|##################|]
    (
      OpName,
      PrevNOps:z,
      NOps - PrevNOps:z,
      NOps:z
    );
    TotPrevNOps = TotPrevNOps + PrevNOps;
    TotNOps = TotNOps + NOps;
  end;
end;

macro OutBottom
  [
   -----------------------------------------------------------------------------------------------------------------------------
   Ст.контролер (контролер) _________________________________________________ Кассир ___________________________________________

   Отчет проверил "___" ________________ ______ г.                            Бухгалтер ________________________________________];
end;

*/