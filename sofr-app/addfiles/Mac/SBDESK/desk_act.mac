
/* Акт на излишки и недостачу */

import deprintr, DeskInter, RD_Comm;

const
  CASHOP_DEBIT     = 5,  /* Расход */
  CASHOP_CREDIT    = 6,  /* Приход */
  CASHOP_DEBET_SAFE = 13,  /* Расход из сейфа */
  CASHOP_CREDIT_SAFE = 14; /* Приход в сейф */

var
  PayerName,
  Number,
  Overplus = $0,
  Shortage = $0;                   

macro GetCurrRate1

  CBRate   = Double(0);
  BuyRate  = Double(0);
  SellRate = Double(0);

  Copy( RtlCurr, Curr );
  CBRate = GetCurrRate({curdate});
  if (CBRate == 0)
    MsgBox( "Не определен курс валюты '" + Curr.Name_Currency + "'" );
    Exit( 1 );
  end;
end;

macro ConvertSum( Sum )

  var
    Stat = true;

  if ( ( CashValue.TypeValue == TYPERES_CURRENCY ) and ( CashValue.CodIntValue != 0 ) )
    Stat = FindCurr( CashValue.CodIntValue );
    if ( Stat )
      GetCurrRate1;
      return SumConv(Sum, CBRate);
    end;
  else
    return Sum;    
  end;
  if ( not Stat )
    MsgBox( "Не найдена валюта. Код " + CashValue.CodIntValue );
    Exit( 1 );
  end;
end;

macro GetSums

  if ( ( CashDoc.NumOper == CASHOP_DEBIT ) or ( CashDoc.NumOper == CASHOP_DEBET_SAFE ) )
    if ( CashDoc.ValueMoney )
      Shortage = ConvertSum( CashDoc.ValueMoney );
    else
      Shortage = Money( CashDoc.ValueCol );
    end;
  else
    if ( CashDoc.ValueMoney )
      Overplus = ConvertSum( CashDoc.ValueMoney );
    else
      Overplus = Money( CashDoc.ValueCol );
    end;
  end;  
end;

macro PrintSumLine( SumDesc, Sum )

  if ( Sum == $0 )
    return;
  end;

  [ в пачке                                    целой                              ];
  [ -------  за № _____________________ с  -------------  упаковкой               ];
  [  мешке                                   нарушенной                           ];
  [                                                                               ];   
  [                       целой              пломбой №                            ];  
  [ ############## с ----------------      -----------------------------          ]   
  ( SumDesc );                                                                        
  [                     нарушенной           упаковкой №                          ];  
  [                                                                               ];  
  [        целыми                                                                 ];  
  [ с ----------------- бандеролями ##############                                ]   
  ( SumDesc );                                                                        
  [      нарушенными                                                              ];  
  [                                                         банкнот(а) №№         ];           
  [ _____________________________________________________ ----------------------  ];  
  [         ( количество цифрами и прописью )               монеты(а)             ];  
  [                                                                               ];  
  [ достоинством __________________________________ на сумму руб. ##############  ]   
  ( Sum:l );                                                                          
  [ ############################################################################# ]   
  ( "( " +  String( Sum:m ) + " )" );                                                                          
  [                                                                               ];  
  [           пачка в количестве .... корешков, из которых в .... корешке         ];  
  [ Указанная ------------------------------------------------------------ был(а) ];  
  [                           монета из мешка, в котором                          ];  
  [                                                                               ];  
  [                                банкнот(а)                                     ];  
  [ обнаружен(а) ############### --------------, пересчитана полностью            ]   
  ( SumDesc );                                                                        
  [                                монеты(а)                                      ];  
  [                                                                               ];  
  [ кассиром ###################################################### в присутствии ]
  ( Person.Name + MkStr( "_", 54 - StrLen( Person.Name ) ) );
  [                        ( фамилия, имя, отчество )                             ];  
  [ ____________________________________________________________________ при этом ];  
  [              ( должность, фамилия, имя, отчество )                            ];    
  [                                                                               ];  
  [                      банкнот(а)                                               ];  
  [ ################### ------------ в сумме руб. #############################   ]   
  ( SumDesc, Sum:l );                                                                 
  [                      монет(а)                                                 ];  
  [                                                                               ];  
  [ ########################################################## подтвердился(лась) ]   
  ( "( " + String( Sum:m ) + " )" );                                                                          
  [                                                                               ];  
end;

macro PrintSums

  PrintSumLine( "излишек", Overplus );
  PrintSumLine( "недостача", Shortage );
end;

macro PrintAct

  [                                                                               ];
  [                                                               --------------- ];
  [                                                               |   0482145   | ];
  [                                                               --------------- ];
  [                                                                               ];
  [                                   А К Т                                       ];
  [                                                                               ];
  [ ##################################                          № ##############  ]
  ( CashDoc.CashDateDoc:m, Number:l );
  [                                                                               ];
  [       об излишках, недостачах                     банкнот(ах) в пачках        ];
  [       -------------------------                   --------------------        ];
  [       неплатежных, сомнительных                   монеты(ах) в мешках         ];
  [                                                                               ];
  [ в упаковке __________________________________________________________________ ];  
  [                                                                               ];
  [ Настоящий акт составлен ##################################################### ]
  ( {Name_Bank} );
  [                                                                               ];
  [ в гор. ______________ в том, что сего числа при вскрытии и пересчета в кассе, ];
  [                                                                               ];
  [ в предкладовой, в помещении для пересчета денег клиентом,                     ];
  [                                                                               ];
  [ банкнот  кассовым работником                                                  ];
  [ -------  ------------------- ################################## в присутствии ]
  ( Person.Name + MkStr( "_", 34 - StrLen( Person.Name ) )  );
  [ монет         клиентом           ( фамилия, имя, отчество )                   ];
  [                                                                               ];
  [ _____________________________________________________________________________ ];
  [        ( фамилия, имя, отчество кассового работника учреждения банка )        ];
  [                                                                               ];
  [ был(а,и) обнаружен(а,и)                                                       ];    
  [                                                                               ];
  PrintSums;
  [                                                                               ];
  [                                                                               ];
  [ Подписи лиц, производивших пересчет    ______________________________________ ];
  [                                               ( расшифровка подписей )        ];
  [                                                                               ];
  [ Подписи лиц, присутсиовавших           ______________________________________ ];
  [ при пересчете                                 ( расшифровка подписей )        ];
  [                                                                               ];
  [                                                                               ];
  [                                                                               ];
  [     К акту прилагаются:                                                       ];       
  [        - верхняя и нижняя накладки от пачки;                                  ];
  [        - бандероли от всех корешков ( полной величины );                      ];
  [        - обвязка с пломбой ( полиэтиленовый рукав с оттисками клише ) и       ];                         
  [          и ярлык от мешка с монетами, где был(а) обнаружен(а)                 ];
  [                                                                               ];
  [       излишек, недостача                          банкнот(а)                  ];
  [       -------------------------                 -------------                 ];
  [       неплатежная, сомнительная                   монеты(а)                   ];
  [                                                                               ];
end;

  GetPerson;
  FindCashValue( CashDoc.RefValue );
  GetSums;

  if ( ( Overplus == $0 )
    and ( Shortage == $0 ) )
    PrintLn( "Нажмите ESC" );
    Exit( 1 );
  end;

  if ( GetTrue( false, "Печатать акт на излишки/недостачу ?" ) )
    GetInt( Number, "Введите номер акта" );
    if ( ValType( Number ) != V_INTEGER )
      Exit( 1 );
    end;
    PrintAct;
  end;
end;
