/**************************************************************************\
*  ---------------------                                                   *
*  R-Style Software Lab.                                                   *
*  ---------------------                                                   *
*  RS-Retail                                                               *
*                                                                          *
*                                                                          *
*  Класс, предназанченный для работы с датой                               *
*    (представление в различных видах)                                     *
* 									   *
*                                                                          *
*  Крестьянинов Е.А.                                                       *
*  5.08.2005                                                               *
\**************************************************************************/

private var {curdate};


class TDateStorage( needDate )

  private var
    curDate = needDate,
    dd = 0,
    mm = 0,
    yyyy = 0;

/****************************************************************/
  macro _init()
    DateSplit(curDate, dd, mm, yyyy);
  end;

/****************************************************************/
  macro setDate( dat )
    var oldDate;

    oldDate = curDate;
    if( valtype( dat ) == V_DATE )
      curDate = dat;
      _init();
    end;

    return oldDate;
  end;
/****************************************************************/
  macro getYear()
    return yyyy;
  end;

  macro getDay()
    return dd;
  end;

  macro getMonthNumber()
    return mm;
  end;
/****************************************************************/
  macro getLastTwoDigitsInYear( year )

    if( year == null )
      year = yyyy;
    end;

    return substr( string(year), strlen(string(year)) - 1, 2);
  end;

/****************************************************************/
  macro getMonthInTwoDigits( number )

    if( number == null )
      number = mm;
    end;

    if( strlen( string( number ) ) == 1 )
      return "0" + string( number );
    else
      return string( number );
    end;
  
  end;

/****************************************************************/
  macro getNameMonthForNum( number, imenitelniy )
    var monat;

    if( number == null )
      number = mm;
    end;

    if( imenitelniy )
      if(number == 1)
           monat = "январь";
      elif(number == 2)
           monat = "февраль";
      elif(number == 3)
         monat = "март";
      elif(number == 4)
         monat = "апрель";
      elif(number == 5)
         monat = "май";
      elif(number == 6)
         monat = "июнь";
      elif(number == 7)
         monat = "июль";
      elif(number == 8)
         monat = "август";
      elif(number == 9)
         monat = "сентябрь";
      elif(number == 10)
         monat = "октябрь";
      elif(number == 11)
         monat = "ноябрь";
      elif(number == 12)
         monat = "декабрь";
      else
         monat = "ошибка в номере месяца";
      end;
    else
      if(number == 1)
         monat = "января";
      elif(number == 2)
         monat = "февраля";
      elif(number == 3)
         monat = "марта";
      elif(number == 4)
         monat = "апреля";
      elif(number == 5)
         monat = "мая";
      elif(number == 6)
         monat = "июня";
      elif(number == 7)
         monat = "июля";
      elif(number == 8)
         monat = "августа";
      elif(number == 9)
         monat = "сентября";
      elif(number == 10)
         monat = "октября";
      elif(number == 11)
         monat = "ноября";
      elif(number == 12)
         monat = "декабря";
      else
         monat = "ошибка в номере месяца";
      end;
    end;

    return monat;
  end;
/****************************************************************/
  macro getDateInCurStr( str, dat )
    var ret = "", oldDate = null, i;

    if( valtype(str) == V_STRING )
 
      if( valtype( dat ) == V_DATE )
        oldDate = setDate( dat );
      end;

      i = Index(str, "d");
      if( i > 0 )
        ret = SubStr( str, 1, i - 1 );
        if( substr(str, i, 2) == "dd" )
          ret = ret + string( dd );
          i = i + 2;
        end;
      else
        i = 1  
      end;
      ret = ret + SubStr( str, i , strlen(str) - i + 1 );
      str = ret;

      i = Index(str, "m");
      if( i > 0 )
        ret = SubStr( str, 1, i - 1 );
        if( substr(str, i, 2) == "mm" )
          ret = ret + getMonthInTwoDigits();
          i = i + 2;
        else
          if( substr(str, i, 5) == "month" )
            ret = ret + getNameMonthForNum();
            i = i + 5;
          end;
        end;
        ret = ret + SubStr( str, i , strlen(str) - i + 1 );
      end;
      str = ret;

      i = Index(str, "y");
      if( i > 0 )
        ret = SubStr( str, 1, i - 1 );
        if( (substr(str, i, 2) == "yy") and (substr(str, i, 4) != "yyyy") )
          ret = ret + getLastTwoDigitsInYear();
          i = i + 2;
        else
          if( substr(str, i, 4) == "yyyy" )
            ret = ret + string( yyyy );
            i = i + 4;
          end;
        end;
        ret = ret + SubStr( str, i , strlen(str) - i + 1 );
      end;

    end;

    if( oldDate != null )
      setDate( oldDate );
    end;

    return ret;
  end;

/****************************************************************/
// Конструктор
  if ( curDate == null ) 
    curDate = {curdate};
  end;
  _init();


end;