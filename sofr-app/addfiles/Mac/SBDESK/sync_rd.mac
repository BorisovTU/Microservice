
/* Синхронизация справочников подвидов для Кассы пересчета */

file DSubOp( "dsuboper.dbt" ) key 0 write;
file PayCsOp( "pay_csop.dbt" ) key 0 write;

private var Branch = NumFNcash();
const
  CO_RDesk = 200;  /* Касса пересчета */

const
  CASHOP_PANT_RDEB = 30, /* Расход по кассе пересчета */
  CASHOP_PANT_RCRD = 31, /* Приход по кассе пересчета */ 
  CASHOP_PANT_ECRD = 41; /* Приход по вечерней кассе */ 

macro TreatSubOp( IsCur )

  PayCsOp.IsCur = IsCur;
  PayCsOp.GroupType = CO_RDesk;
  PayCsOp.NumOperat = DSubOp.OperType;    
  PayCsOp.ApplType = DSubOp.Type;
  if ( not GetEQ( PayCsOp ) )
    PayCsOp.NameCompType = SubStr( DSubOp.Name, 1, 14 );
    Insert( PayCsOp );
  end;
end;

macro TreatOp( Op )

  var
    RecFound;

  ClearRecord( DSubOp );
  DSubOp.Branch = Branch;
  DSubOp.OperType = Op;
  RecFound = GetGE( DSubOp );
  while ( RecFound and ( DSubOp.OperType == Op ) and ( DSubOp.Branch == Branch ) )  
    TreatSubOp( 0 );
    TreatSubOp( 1 );
    RecFound = Next( DSubOp );
  end;
end;

macro SyncEDWithRD

  record Tmp( "dsuboper.dbt" );

  var
    RecFound;

  ClearRecord( DSubOp );
  DSubOp.Branch = Branch;
  DSubOp.OperType = CASHOP_PANT_RCRD;
  RecFound = GetGE( DSubOp );
  while ( RecFound and ( DSubOp.OperType == CASHOP_PANT_RCRD ) and (DSubOp.Branch = Branch) )  
    GetPos( DSubOp );
    DSubOp.Branch = Branch;
    DSubOp.OperType = CASHOP_PANT_ECRD;
    Copy( Tmp, DSubOp );
    if ( GetEQ( DSubOp ) )
      Delete( DSubOp );
    end;
    Copy( DSubOp, Tmp );
    Insert( DSubOp ); 
    GetDirect( DSubOp );
    RecFound = Next( DSubOp );
  end;
end;

  SyncEDWithRD;
/*
  TreatOp( CASHOP_PANT_RDEB );
  TreatOp( CASHOP_PANT_RCRD );
  TreatOp( CASHOP_PANT_ECRD );
*/
end;