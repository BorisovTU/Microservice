/*
$Name:             loans_fnp.mac
$Module:           Кредитование
$Description:      Структура уведомлений
*/
import XmlRpcInter,total;

//3.1   Класс RSCFNPSource - параметры источника сообщения
CLASS RSCFNPSource
    VAR SenderID      :String; //Код абонента                                                            1
    VAR MessageID     :String; //Идентификатор запроса, формируемый в смежной АС, к RS-Connect (GUID)    1
    VAR SenderPointID :String; //Идентификатор подразделения - источника сообщения                       1
END;

//3.4 Класс RSCFNPExCondition - информация об условиях обработки
CLASS RSCFNPExCondition
    VAR ExConditionCode :String; //Код условий обработки (список кодов определяется на этапе проектирования реализации). Должен быть предусмотрен код "ручная обработка".    1
    VAR ExConditionText :String; //Текстовое описание кода условий обработки                                                                                                 1
END;

//3.41   Класс RSCFNPRequestList - список идентификационных параметров учетного объекта уведомления
CLASS RSCFNPRequestList
   VAR ObjectIdList :TArray; //Идентификационные параметры учетного объекта уведомления RSCFNPObjectIdParam    1-N
END;

//3.40   Класс RSCFNPObjectIdParam - Идентификационные параметры учетного объекта уведомления ФНП
CLASS RSCFNPObjectIdParam
   VAR OrigNotificationId :String;            //Идентификатор уведомления в смежной системе             0-1
   VAR ObjectID           :Integer;           //Уникальный идентификатор созданного учетного объекта    0-1
   VAR ObjectType         :String;            //Тип учетного объекта, созданного в RS-Connect           0-1
   VAR ExCondition        :RSCFNPExCondition; //Условия обработки                                       0-1
END;

//3.39   Класс RSCFNPNotificationList - список  уведомлений
//в массиве одновременно могут находиться элементы только одного типа
CLASS RSCFNPNotificationList
   VAR PledgeNotificationList :TArray; //Массив уведомлений.                                       1
END;


CLASS PledgeContractType // Сведения о договоре залога, иной сделке, на основании которой возникает залог в силу закона
   VAR Name  : String;  // Наименование договора или иной сделки
   VAR Date  : Date;    // Дата договора
   VAR Number: String;  // Номер договора (при наличии)
   VAR TermOfContract: String; // Срок исполнения основного обязательства
END;

CLASS VehiclePropertyType // Транспортное средство
   VAR VIN        : String;   // VIN (указывается при наличии)
   VAR Description: String;   // Описание транспортного средства
END;

CLASS OtherPropertyType     // Иное имущество
   VAR IdentifyingValue:String; // Идентификатор (указывается при наличии)
   VAR Description     :String; // Описание иного имущества
END;

CLASS PersonalPropertyType // Движимое имущество, переданное в залог
//    PersonalProperty  
   VAR ID:      String; //Идентификатор объекта в базе данных Абонента    1
   VAR VehicleProperty; // VehiclePropertyType; // Транспортное средство (если заполнено, то параметр OtherProperty не заполняется)
   VAR OtherProperty  ; // OtherPropertyType;   // Иное имущество (если заполнено, то параметр VehicleProperty не заполняется)
END;

CLASS AddressForeignType // Адрес за пределами РФ
   VAR CountryCode :String; // Код страны (из общероссийского классификатора стран мира)
   VAR Country     :String; // Наименование страны
   VAR AddressRus  :String; // Адрес буквами российского алфавита
   VAR AddressLat  :String; // Адрес буквами латинского алфавита
END;

CLASS ForeignOrganizationType // Описание иностранного юридического лица
   VAR NameFull           : String; // Полное наименование организации
   VAR NameFullLat        : String; // Полное наименование организации буквами латинского алфавита
   VAR ForeignRegisterName: String; // Наименование реестра для регистрации юридических лиц
   VAR RN                 : String; // Регистрационный номер организации
   VAR INN                : String; // ИНН организации
   VAR Address            : AddressForeignType; // Адрес (место нахождения) организации
   VAR Email              : String; // Email организации
END;

CLASS AddressRFType // Российский адрес (по ФИАС)
   VAR RegionCode  : String; // Код субъекта РФ
   VAR Region      : String; // Наименование субъекта РФ
   VAR DistrictType: String; // Наименование типа района
   VAR District    : String; // Район
   VAR CityType    : String; // Наименование типа города
   VAR City        : String; // Город
   VAR LocalityType: String; // Наименование типа населенного пункта
   VAR Locality    : String; // Населенный пункт (село, поселок и т.д.)
   VAR StreetType  : String; // Наименование типа улицы
   VAR Street      : String; // Улица (проспект, переулок и т.д.)
   VAR House       : String; // Номер дома (владения)
   VAR Building    : String; // Номер корпуса (строения)
   VAR Apartment   : String; // Номер квартиры (офиса)
   VAR Registration: Bool;   // Признак адреса регистрации:
END;

CLASS RussianOrganizationType // Описание российского юридического лица
   VAR NameFull: String; // Полное наименование организации
   VAR OGRN    : String; // ОГРН организации
   VAR INN     : String; // ИНН организации
   VAR Address : AddressRFType; // Адрес (место нахождения) организации
   VAR Email   : String; // email организации
END;

CLASS OrganizationType // Юридическое лицо
   VAR RussianOrganization  ;//: RussianOrganizationType; // Описание российского юридического лица (если заполнено, то параметр ForeignOrganization не заполняется)
   VAR ForeignOrganization  ;//: ForeignOrganizationType; // Описание иностранного юридического лица (если заполнено, то параметр RussianOrganization не заполняется)
END;

CLASS PrivatePersonNameType // ФИО физического лица
   VAR Last   :String; // Фамилия
   VAR First  :String; // Имя
   VAR Middle :String; // Отчество
END;

CLASS PrivatePersonDocumentType // Документ, удостоверяющий личность
   VAR Code  : String; // Код вида документа (по справочнику СПДУЛ ФНС России)
   VAR Series: String; // Серия документа
   VAR Number: String; // Номер документа
END;

CLASS AddressPrivatePersonType // Адрес физического лица
   VAR AddressRF     ; //: AddressRFType;      // Адрес в РФ
   VAR AddressForeign; //: AddressForeignType; // Адрес за пределами РФ
END;

CLASS PersonCommonData // Общая информация о физическом лице
   VAR Name          ;//: PrivatePersonNameType;      // ФИО
   VAR NameForeign   ;//: PrivatePersonNameType;      // ФИО для иностранных граждан
   VAR BirthDate     : Date;                       // Дата рождения
   VAR PersonDocument: PrivatePersonDocumentType;  // Документ, удостоверяющий личность
   VAR PersonAddress : AddressPrivatePersonType;   // Адрес
END;

CLASS PrivatePersonType // Физическое лицо
   VAR PersonData: PersonCommonData; // Общая информация о физическом лице
   VAR Email     : String;           // Адрес электронной почты
END;

CLASS ContractSubjectType  // Субъект договора
//    Pledgor  
   VAR Organization   ; //: OrganizationType;  // Юридическое лицо (если заполнено, то параметр PrivatePerson не заполняется)
   VAR PrivatePerson  ; //: PrivatePersonType; // Физическое лицо (если заполнено, то параметр Organization не заполняется)
END;

CLASS NotificationOrganizationType // Сведения об организации, подающей уведомление
   VAR NameFull: String; // Полное наименование организации
   VAR URN     : String; // ОГРН/регистрационный номер юридического лица в стране его регистрации
   VAR UINN    : String; // Идентификационный номер налогоплательщика
   VAR Email   : String; // Адрес электронной почты
END;

CLASS NotificationPrivatePersonType // Сведения о физическом лице, подающем уведомление
   VAR Name : PrivatePersonNameType; // ФИО
   VAR Email: String; // Адрес электронной почты
END;

CLASS NotificationSubjectType // Сведения о стороне, подающей уведомление
   VAR SubjectType  : String; // Тип субъекта, подающего уведомление:(1 - ЮЛ, 2 - ФЛ)
   VAR Organization ;//: NotificationOrganizationType;  // Сведения об организации, подающей уведомление (если заполнено, то параметр PrivatePerson не заполняется)
   VAR PrivatePerson;//: NotificationPrivatePersonType; // Сведения о физическом лице, подающем уведомление (если заполнено, то параметр Organization не заполняется)
END;

//3.33   Класс RSCFNPNotificationIdentifier - Идентификационные параметры уведомления
CLASS RSCFNPNotificationIdentifier
   VAR OrigNotificationId      :String; //Идентификатор уведомления в смежной системе                                                        1
   VAR InitialOrigNotifId      :String; //Идентификатор уведомления о возникновении залога в смежной системе                                 0-1
   VAR CreationReferenceNumber :String; //Регистрационный номер уведомления о возникновении залога (присваивается ФНП)                       0-1
   VAR InitialObjectID         :String; //Уникальный идентификатор учетного объекта-запроса предыдущего уведомления в цепочке уведомлений    0-1
END;

// 7.1.4.2.1.7 Сведения о заявителе
CLASS PledgeNotifCreateApplicantType
   VAR Role             : String;   // Какой стороной подается уведомление (1 - Залогодатель, 2 - Залогодержатель)
   VAR AttorneyPersNum  : String;   // Табельный номер представителя Заявителя.
END;


//3.35   Класс RSCFNPPledgeNotificationUP1 - Параметры уведомления об исключении сведений о залоге движимого имущества
CLASS RSCFNPPledgeNotificationUP1
   VAR NotificationIdentifier;                             //Идентификационные параметры уведомления RSCFNPNotificationIdentifier        1
   VAR ExCondition                     :RSCFNPExCondition; //Условия обработки                                                           0-1
   VAR NotificationApplicant           :PledgeNotifCreateApplicantType; //Сведения о Заявителе
END;

// Табл. 37 
CLASS PledgeNotifObtainAttorneyType
   VAR AttorneyPersNum        : String;            // Табельный номер сотрудника-представителя заявителя в базе данных Абонента
   VAR PersonData             : PersonCommonData;  // Общая информация о физическом лице
   VAR Authority              : String;            // Основание полномочий представителя
END;

// Табл. 36 
CLASS PledgeNotifObtainApplicantType
   VAR Role                   : String;                        // Какой стороной подается уведомление:
   VAR NotificationSubject    : NotificationSubjectType;       // Сведения о стороне, подающей уведомление
   VAR Attorney               : PledgeNotifObtainAttorneyType; // Информация о представителе заявителя
END;

//3.32   Класс RSCFNPPledgeNotificationUZ1 - Параметры уведомления о возникновении залога движимого имущества
CLASS RSCFNPPledgeNotificationUZ1
   VAR OrigNotificationId              :String;            //Идентификатор уведомления в смежной системе                                 1
   VAR ExCondition                     :RSCFNPExCondition; //Условия обработки                                                           0-1
   VAR PersonalProperties;                                 //Список движимого имущества, переданного в залог RSCFNPPersonalProperty      1-N
   VAR Pledgors;                                           //Список сведений о Залогодателе(ях) RSCFNPContractSubject                    1-N
   VAR Pledgees;                                           //Список Залогодержателей RSCFNPContractSubject                               1-N
   VAR PledgeContract;                                     //Сведения о договоре залога, иной сделке RSCFNPPledgeContract                0-1
   VAR NotificationApplicant:PledgeNotifCreateApplicantType;//Сведения о Заявителе                                                       1
END;

//3.34   Класс RSCFNPPledgeNotificationUI1 - Параметры уведомления об изменении залога движимого имущества
CLASS RSCFNPPledgeNotificationUI1
   VAR NotificationIdentifier;                             //Идентификационные параметры уведомления RSCFNPNotificationIdentifier        1
   VAR ExCondition                     :RSCFNPExCondition; //Условия обработки                                                           0-1
   VAR PersonalProperties;                                 //Список движимого имущества, переданного в залог RSCFNPPersonalProperty      0-N
   VAR Pledgors;                                           //Список сведений о Залогодателе(ях) RSCFNPContractSubject                    0-N
   VAR Pledgees;                                           //Список Залогодержателей RSCFNPContractSubject                               0-N
   VAR PledgeContract;                                     //Сведения о договоре залога, иной сделке RSCFNPPledgeContract                0-1
   VAR NotificationApplicant:PledgeNotifCreateApplicantType;//Сведения о Заявителе                                                       1
END;

// Получить статусы обработки уведомлений
CLASS ObjectIdParamType
   VAR OrigNotificationId: String;
   VAR ObjectId          : String;
   VAR ObjectType        : String;
   VAR ExCondition       : RSCFNPExCondition;
END;

// Движимое имущество, переданное в залог
MACRO GetPersonalProperty(ID)

   VAR A  : TArray = TArray();

   VAR RS = CRSDCommand("SELECT * FROM DFNP_PERSPROP_DBT WHERE T_NOTICE = ?",
                        "p1", ID,
                       V_GENOBJ);

   WHILE (RS.MoveNext())
      VAR PPT = PersonalPropertyType();
      VAR VPT = VehiclePropertyType();    // Транспортное средство
      VAR OPT = OtherPropertyType();

      VPT.VIN         = SQL_NVL(RS.Value("T_VIN"),         V_STRING); // VIN (указывается при наличии)
      VPT.Description = SQL_NVL(RS.Value("T_DESCRIPTION"), V_STRING); // Описание транспортного средства

      OPT.IdentifyingValue = SQL_NVL(RS.Value("T_ID"), V_INTEGER);
      OPT.Description = SQL_NVL(RS.Value("T_DESCRIPTION"), V_STRING); // Описание транспортного средства

      PPT.ID          = SQL_NVL(RS.Value("T_ID"), V_INTEGER);

      PPT.VehicleProperty = VPT;  // Транспортное средство (если заполнено, то параметр OtherProperty не заполняется)
      PPT.OtherProperty   = NULL; // Иное имущество (если заполнено, то параметр VehicleProperty не заполняется)

      A[A.size] = PPT;
   END;

   RETURN A;
END;

// Список Залогодателей
MACRO GetPledgor(ID)
   VAR Mas: TArray = TArray();
   VAR CST: ContractSubjectType;  // Субъект договора

   // Физик
   VAR P =
   CRSDCommand("SELECT * FROM DFNP_PRIVATEPERSON_DBT WHERE T_NOTICE  = ?",
               "p1", ID,
              V_GENOBJ);

   IF (P.MoveNext())
      VAR PPNT: PrivatePersonNameType; // ФИО физического лица
      PPNT.Last   = SQL_NVL(P.Value("T_LAST"),   V_STRING);
      PPNT.First  = SQL_NVL(P.Value("T_FIRST"),  V_STRING);
      PPNT.Middle = SQL_NVL(P.Value("T_MIDDLE"), V_STRING);

      VAR PPDT: PrivatePersonDocumentType; // Документ, удостоверяющий личность
      PPDT.Code  = SQL_NVL(P.Value("T_Code"),   V_STRING);
      PPDT.Series= SQL_NVL(P.Value("T_Series"), V_STRING);
      PPDT.Number= SQL_NVL(P.Value("T_Number"), V_STRING);

      VAR APPT: AddressPrivatePersonType; // Адрес физического лица
      IF (SQL_NVL(P.Value("T_AddressRus"), V_STRING) != "")
         VAR AFT: AddressForeignType; // Адрес за пределами РФ
         AFT.CountryCode = SQL_NVL(P.Value("T_CountryCode"),   V_STRING);
         AFT.Country     = SQL_NVL(P.Value("T_Country"),       V_STRING);
         AFT.AddressRus  = SQL_NVL(P.Value("T_AddressRus"),    V_STRING);
         AFT.AddressLat  = SQL_NVL(P.Value("T_AddressLat"),    V_STRING);

         APPT.AddressRF      = NULL;// Адрес в РФ
         APPT.AddressForeign = AFT; // Адрес за пределами РФ
      ELSE
         VAR ARFT: AddressRFType; // Российский адрес (по ФИАС)
         ARFT.RegionCode  = SQL_NVL(P.Value("T_RegionCode"),   V_STRING);
         ARFT.Region      = SQL_NVL(P.Value("T_Region"),       V_STRING);
         ARFT.DistrictType= SQL_NVL(P.Value("T_DistrictType"), V_STRING);
         ARFT.District    = SQL_NVL(P.Value("T_District"),     V_STRING);
         ARFT.CityType    = SQL_NVL(P.Value("T_CityType"),     V_STRING);
         ARFT.City        = SQL_NVL(P.Value("T_City"),         V_STRING);
         ARFT.LocalityType= SQL_NVL(P.Value("T_LocalityType"), V_STRING);
         ARFT.Locality    = SQL_NVL(P.Value("T_Locality"),     V_STRING);
         ARFT.StreetType  = SQL_NVL(P.Value("T_StreetType"),   V_STRING);
         ARFT.Street      = SQL_NVL(P.Value("T_Street"),       V_STRING);
         ARFT.House       = SQL_NVL(P.Value("T_House"),        V_STRING);
         ARFT.Building    = SQL_NVL(P.Value("T_Building"),     V_STRING);
         ARFT.Apartment   = SQL_NVL(P.Value("T_Apartment"),    V_STRING);

         IF (SQL_NVL(P.Value("T_Registration"), V_STRING) == "X")
            ARFT.Registration = TRUE;
         ELSE
            ARFT.Registration = FALSE;
         END;

         APPT.AddressRF      = ARFT; // Адрес в РФ
         APPT.AddressForeign = NULL; // Адрес за пределами РФ
      END;

      VAR PCD: PersonCommonData;     // Общая информация о физическом лице
      PCD.Name          = PPNT;      // ФИО
      PCD.NameForeign   = NULL;      // ФИО для иностранных граждан
      PCD.BirthDate     = SQL_NVL(P.Value("T_BIRTHDATE"), V_DATE); // Дата рождения
      PCD.PersonDocument= PPDT;      // Документ, удостоверяющий личность
      PCD.PersonAddress = APPT;      // Адрес

      VAR PP: PrivatePersonType;     // Физическое лицо
      PP.PersonData = PCD;           // Общая информация о физическом лице
      PP.Email      = SQL_NVL(P.Value("T_EMAIL"), V_STRING); // Адрес электронной почты

      CST.PrivatePerson = PP;        // Физическое лицо (если заполнено, то параметр Organization не заполняется)
      CST.Organization  = NULL;      // Юридическое лицо (если заполнено, то параметр PrivatePerson не заполняется)

      Mas[Mas.Size] = CST;

      RETURN Mas;
   END;

   VAR OT: OrganizationType; // Юридическое лицо

   VAR F =
   CRSDCommand("SELECT * FROM DFNP_FORORG_DBT WHERE T_NOTICE = ?",
               "p1", ID,
              V_GENOBJ);
   IF (F.MoveNext())
      OT.RussianOrganization = NULL; // Описание российского юридического лица (если заполнено, то параметр ForeignOrganization не заполняется)
      CST.PrivatePerson = NULL;        // Физическое лицо (если заполнено, то параметр Organization не заполняется)

      VAR FOT: ForeignOrganizationType; // Описание иностранного юридического лица
      FOT.NameFull           = SQL_NVL(F.Value("T_NameFull"), V_STRING); // "Полное наименование организации";
      FOT.NameFullLat        = SQL_NVL(F.Value("T_NameFullLat"), V_STRING); // "Полное наименование организации буквами латинского алфавита";
      FOT.ForeignRegisterName= SQL_NVL(F.Value("T_ForeignRegisterName"), V_STRING); // "Наименование реестра для регистрации юридических лиц";
      FOT.RN                 = SQL_NVL(F.Value("T_RN"), V_STRING); // "Регистрационный номер организации";
      FOT.INN                = SQL_NVL(F.Value("T_INN"), V_STRING); // "ИНН организации";
      FOT.Email              = SQL_NVL(F.Value("T_EMAIL"), V_STRING); // "Email организации";

      // VAR AFT: AddressForeignType; // Адрес за пределами РФ
      AFT.CountryCode = SQL_NVL(F.Value("T_CountryCode"),   V_STRING);
      AFT.Country     = SQL_NVL(F.Value("T_Country"),       V_STRING);
      AFT.AddressRus  = SQL_NVL(F.Value("T_AddressRus"),    V_STRING);
      AFT.AddressLat  = SQL_NVL(F.Value("T_AddressLat"),    V_STRING);
      FOT.Address     = AFT; // Адрес (место нахождения) организации

      OT.ForeignOrganization = FOT;
   END;


   VAR R =
   CRSDCommand("SELECT * FROM DFNP_RUSORG_DBT WHERE T_NOTICE = ?",
               "p1", ID,
              V_GENOBJ);
   IF (R.MoveNext())
      OT.ForeignOrganization = NULL; // Описание иностранного юридического лица (если заполнено, то параметр RussianOrganization не заполняется)
      CST.PrivatePerson = NULL;        // Физическое лицо (если заполнено, то параметр Organization не заполняется)

      VAR ROT: RussianOrganizationType; // Описание российского юридического лица
      ROT.NameFull = SQL_NVL(R.Value("T_NameFull"), V_STRING); // "Полное наименование организации";
      ROT.OGRN     = SQL_NVL(R.Value("T_OGRN"),     V_STRING); // "ОГРН организации";
      ROT.INN      = SQL_NVL(R.Value("T_INN"),      V_STRING); // "ИНН организации";
      ROT.Email    = SQL_NVL(R.Value("T_Email"),    V_STRING); // "email организации";

      // Российский адрес (по ФИАС)
      ARFT.RegionCode  = SQL_NVL(R.Value("T_RegionCode"),   V_STRING);
      ARFT.Region      = SQL_NVL(R.Value("T_Region"),       V_STRING);
      ARFT.DistrictType= SQL_NVL(R.Value("T_DistrictType"), V_STRING);
      ARFT.District    = SQL_NVL(R.Value("T_District"),     V_STRING);
      ARFT.CityType    = SQL_NVL(R.Value("T_CityType"),     V_STRING);
      ARFT.City        = SQL_NVL(R.Value("T_City"),         V_STRING);
      ARFT.LocalityType= SQL_NVL(R.Value("T_LocalityType"), V_STRING);
      ARFT.Locality    = SQL_NVL(R.Value("T_Locality"),     V_STRING);
      ARFT.StreetType  = SQL_NVL(R.Value("T_StreetType"),   V_STRING);
      ARFT.Street      = SQL_NVL(R.Value("T_Street"),       V_STRING);
      ARFT.House       = SQL_NVL(R.Value("T_House"),        V_STRING);
      ARFT.Building    = SQL_NVL(R.Value("T_Building"),     V_STRING);
      ARFT.Apartment   = SQL_NVL(R.Value("T_Apartment"),    V_STRING);

      IF (SQL_NVL(R.Value("T_Registration"), V_STRING) == "X")
         ARFT.Registration = TRUE;
      ELSE
         ARFT.Registration = FALSE;
      END;

      ROT.Address  = ARFT; // Адрес (место нахождения) организации
      OT.RussianOrganization = ROT;
   END;

   CST.Organization  = OT;

   Mas[Mas.Size] = CST;

   RETURN Mas;
END;

// Залогодержатель
MACRO GetPledgees(ID)
   VAR A  : TArray = TArray();
   VAR CST: ContractSubjectType;  // Субъект договора

   VAR P =
   CRSDCommand("SELECT * FROM DFNP_PLEDGEES_DBT WHERE T_NOTICE  = ?",
               "p1", ID,
              V_GENOBJ);

   VAR OT: OrganizationType; // Юридическое лицо

   IF (P.MoveNext())
      CST.PrivatePerson = NULL;        // Физическое лицо (если заполнено, то параметр Organization не заполняется)

      IF (SQL_NVL(P.Value("T_AddressRus"),    V_STRING) != "")

         OT.RussianOrganization = NULL; // Описание российского юридического лица (если заполнено, то параметр ForeignOrganization не заполняется)
      
         VAR FOT: ForeignOrganizationType; // Описание иностранного юридического лица
         FOT.NameFull           = SQL_NVL(P.Value("T_NameFull"), V_STRING); // "Полное наименование организации";
         FOT.NameFullLat        = SQL_NVL(P.Value("T_NameFullLat"), V_STRING); // "Полное наименование организации буквами латинского алфавита";
         FOT.ForeignRegisterName= SQL_NVL(P.Value("T_ForeignRegisterName"), V_STRING); // "Наименование реестра для регистрации юридических лиц";
         FOT.RN                 = SQL_NVL(P.Value("T_RN"), V_STRING); // "Регистрационный номер организации";
         FOT.INN                = SQL_NVL(P.Value("T_INN"), V_STRING); // "ИНН организации";
         FOT.Email              = SQL_NVL(P.Value("T_EMAIL"), V_STRING); // "Email организации";
      
         VAR AFT: AddressForeignType; // Адрес за пределами РФ
         AFT.CountryCode = SQL_NVL(P.Value("T_CountryCode"),   V_STRING);
         AFT.Country     = SQL_NVL(P.Value("T_Country"),       V_STRING);
         AFT.AddressRus  = SQL_NVL(P.Value("T_AddressRus"),    V_STRING);
         AFT.AddressLat  = SQL_NVL(P.Value("T_AddressLat"),    V_STRING);
         FOT.Address     = AFT; // Адрес (место нахождения) организации
      
         OT.ForeignOrganization = FOT;
      ELSE
         OT.ForeignOrganization = NULL; // Описание иностранного юридического лица (если заполнено, то параметр RussianOrganization не заполняется)
         VAR ROT: RussianOrganizationType; // Описание российского юридического лица
         ROT.NameFull = SQL_NVL(P.Value("T_NameFull"), V_STRING); // "Полное наименование организации";
         ROT.OGRN     = SQL_NVL(P.Value("T_OGRN"),     V_STRING); // "ОГРН организации";
         ROT.INN      = SQL_NVL(P.Value("T_INN"),      V_STRING); // "ИНН организации";
         ROT.Email    = SQL_NVL(P.Value("T_Email"),    V_STRING); // "email организации";
      
         // Российский адрес (по ФИАС)
     VAR ARFT: AddressRFType; // Российский адрес (по ФИАС)
         ARFT.RegionCode  = SQL_NVL(P.Value("T_RegionCode"),   V_STRING);
         ARFT.Region      = SQL_NVL(P.Value("T_Region"),       V_STRING);
         ARFT.DistrictType= SQL_NVL(P.Value("T_DistrictType"), V_STRING);
         ARFT.District    = SQL_NVL(P.Value("T_District"),     V_STRING);
         ARFT.CityType    = SQL_NVL(P.Value("T_CityType"),     V_STRING);
         ARFT.City        = SQL_NVL(P.Value("T_City"),         V_STRING);
         ARFT.LocalityType= SQL_NVL(P.Value("T_LocalityType"), V_STRING);
         ARFT.Locality    = SQL_NVL(P.Value("T_Locality"),     V_STRING);
         ARFT.StreetType  = SQL_NVL(P.Value("T_StreetType"),   V_STRING);
         ARFT.Street      = SQL_NVL(P.Value("T_Street"),       V_STRING);
         ARFT.House       = SQL_NVL(P.Value("T_House"),        V_STRING);
         ARFT.Building    = SQL_NVL(P.Value("T_Building"),     V_STRING);
         ARFT.Apartment   = SQL_NVL(P.Value("T_Apartment"),    V_STRING);
      
         IF (SQL_NVL(P.Value("T_Registration"), V_STRING) == "X")
            ARFT.Registration = TRUE;
         ELSE
            ARFT.Registration = FALSE;
         END;
      
         ROT.Address  = ARFT; // Адрес (место нахождения) организации
         OT.RussianOrganization = ROT;
      END;
   END;

   CST.Organization  = OT;

   A[A.size] = CST;

   RETURN A;
END;


// Сведения о договоре залога, иной сделке, на основании которой возникает залог в силу закона
MACRO GetPledgeContract(ID)
   VAR PC: PledgeContractType;
   
   VAR RS = CRSDCommand("SELECT * FROM DFNP_PLEDGECONTRACT_DBT WHERE T_NOTICE = ?",
                        "p1", ID,
                       V_GENOBJ);
   IF (RS.MoveNext)
      PC.Name           = SQL_NVL(RS.Value("T_NAME"), V_STRING);
      PC.Date           = SQL_NVL(RS.Value("T_DATE"), V_DATE); // Дата договора
      PC.Number         = SQL_NVL(RS.Value("T_NUMBER"), V_STRING); // Номер договора (при наличии)";
      PC.TermOfContract = SQL_NVL(RS.Value("T_TERMOFCONTRACT"), V_DATE); // "Срок исполнения основного обязательства";

      RETURN PC;
   END;

   RETURN NULL;  
END;

MACRO GetNotificationApplicant(ID)
   VAR GNA = PledgeNotifCreateApplicantType;

   GNA.Role = "2";
   GNA.AttorneyPersNum = "";

   RETURN GNA;
END;