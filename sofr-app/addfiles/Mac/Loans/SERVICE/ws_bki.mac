/*
$Name:             ws_bki.mac 
$Module:           Кредитование
$Description:      Пакетная выгрузка КИ
*/
//
IMPORT SbCrdInter, BankInter,
       "lgo_opstruct.mac", "lgo_const.mac", "lgo_func.mac", total, RsbDataSet;

macro OperationBki(_taskID, _execID, _conveyerID, _operationID, _packetID, _Params)

   const ExecutionMacroFunc = "КонвейернаяОбработкаПачки";

   var BkiMacroFile = CRSDCommand("select t_macroforming from dlbki_dbt where t_bkiid = :bkiid", "bkiid",  _Params.Bkiid, V_STRING);
   
   var retVal = ExecMacroFile(BkiMacroFile, ExecutionMacroFunc,_taskID, _execID, _conveyerID, _operationID, _packetID, _Params);
   
   if (retVal == null)
      RunError("Макропроцедура отбора объектов " + ExecutionMacroFunc + " в макросе " + BkiMacroFile + " не найдена");
   end;
   
   LgoSqlExec("update dcnvpack_dbt set t_State = T_State + 1 where t_TaskID = ? and t_ExecID = ? and t_PackID = ? and t_ConvTypeID = ?",
              _taskID, _execID, _packetID, _conveyerID);

   return retVal;

END;
