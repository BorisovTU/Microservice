/*
$Name:             fssp_infouser.mac
$Module:           Кредитование
$Description:      ФССП. Информирования пользователей, ответственных за обмен
*/

Import rslx, rcw;

private macro CreateOutlookApplication()
   var startAX;  
   var OutlookApplication;
      if (isStandAlone())
         OutlookApplication = ActiveX("Outlook.Application", null, true);
      else
         if (startAX == null)
            startAX = CreateObject("rsax", "TRsAxServer", "MailAxServer", isStandalone());
         end;
         OutlookApplication = startAX.CreateComObject("Outlook.Application");
      end;

  return OutlookApplication;
end;

// ФССП. Отправка писем пользователям ответственных за обмен
macro FSSP_SendEMail(SubjectMail:string, BodyMail:string, EMail_To:string)

  var OutlookApp;
  var OutlookNS;
  var OutlookEmail; 

  OutlookApp = CreateOutlookApplication();
  if( OutlookApp )

     OutlookNS = OutlookApp.GetNamespace("MAPI");
     
     /* подключаемся к почте */
     /* используется стандартная конфигурация для Outlook с названием "outlook" */
     /* можно указать конфигурацию, созданную специально для RS-Bank */
     /* если конфигурацию не указать, то при запущенном Outlook будет использовано текущее подключение,
        при не запущенном - выводится запрос на выбор конфигурации */
     OutlookNS.Logon("outlook");
   
     OutlookEmail = OutlookApp.CreateItem(0);
     
     OutlookEmail.To = EMail_To;

     OutlookEmail.Subject = SubjectMail;
     OutlookEmail.Body = BodyMail;

     OutlookEmail.Send;

  end;
end;

