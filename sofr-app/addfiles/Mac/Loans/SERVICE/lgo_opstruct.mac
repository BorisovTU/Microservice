/*
$Name:             lgo_opstruct.mac
$Module:           Кредитование
$Description:      Базовый класс параметров операции (приходит в сервис операции)
*/
//........................................................................//
//........................................................................//
// Базовый класс параметров операции (приходит в сервис операции)
//........................................................................//
class BaseOpParm()
  var
      InitStruct  = 0, // Нельзя ставить NULL иначе ошибка
      OperationID = 0;
end;
//........................................................................//
//........................................................................//
// Описание прикладных параметров отбора
//........................................................................//
//Структура параметров отбора для "Всех операций".
CLASS (BaseOpParm) ConveerOperation(_OperDate, 
                                    _CarryDate, 
                                    _FIID, 
                                    _CreditKind, 
                                    _UserCreditKind, 
                                    _FNCash, 
                                    _BriefCaseID,
                                    _ZeroRest)
   VAR
      OperDate      : date     = _OperDate,       // Дата операции
      CarryDate     : date     = _CarryDate,      // Дата проводки в БУ
      CurCode       : integer  = _FIID,           // Валюта. -1 - все валюты.
      CreditKind    : TArray   = _CreditKind,     // Массив видов кредита
      UserCreditKind: string   = _UserCreditKind, // Пользовательские виды кредита в виде строки
      FNCash        : integer  = _FNCash,         // Филиал
      BriefCaseID   : integer  = 0,               // Портфель
      ZeroRest      : integer  = 1;               // Не отбирать договоры с нулевым остатком ОД

   // Определим портфель, если он задан
   IF (ValType(_BriefCaseID) == V_INTEGER)
      BriefCaseID = _BriefCaseID;
   END;

   // доинициализируем виды кредитов
   IF (ValType(CreditKind) == V_UNDEF)
      CreditKind = TArray();
   END;

   IF (ValType(ZeroRest) == V_UNDEF)
      ZeroRest = 1;
   ELSE
      ZeroRest = _ZeroRest;
   END;

   InitBaseOpParm();
END;

//Структура параметров отбора для "Всех операций".
CLASS (BaseOpParm) SimpleOperation(_BriefCaseID)
   VAR BriefCaseID : integer  = 0;

   IF (ValType(_BriefCaseID) == V_INTEGER)
      BriefCaseID = _BriefCaseID;
   END;

   InitBaseOpParm();
END;

//........................................................................//
//Структура параметров отбора для "Начисление процентов".
CLASS (BaseOpParm) PercOperation(_FIID, 
                                 _CreditKind, 
                                 _UserCreditKind, 
                                 _Case, 
                                 _FNCash, 
                                 _PcAddAfter, 
                                 _SMAString, 
                                 _OperDate, 
                                 _CarryDate, 
                                 _OpType, 
                                 _CalcDate, 
                                 _Graph, 
                                 _addgraff, 
                                 _SPOD,
                                 _Choice,
                                 _Protocol)
   VAR
      OperType      : integer  = _OpType,         // Операция.
      OperDate      : date     = _OperDate,       // Дата операции
      CalcDate      : date     = _CalcDate,       // Дата окончания начисления
      CarryDate     : date     = _CarryDate,      // Дата проводки в БУ.
      CurCode       : integer  = _FIID,           // Валюта. -1 - все валюты.
      CreditKind    : TArray   = _CreditKind,     // Массив видов кредита
      UserCreditKind: string   = _UserCreditKind, // Пользовательские виды кредита в виде строки
      FNCash        : integer  = _FNCash,         // Филиал
      Case          : integer  = _Case,           // Портфель
      Graph         : integer  = _Graph,          // Дата окончания начисления - по графику.
      addgraff      : string   = _addgraff,       // Начисление по графику
      PcAddAfter    = _PcAddAfter,                // Начисление по договорам с истекшим сроком
      SMAString     = _SMAString,                 // СУД
      SPOD          = _SPOD,
      Choice        : integer = _Choice,
      Protocol      : string  = _Protocol;

   // Иначе значение параметра будет UNDEF и ошибка
   IF (ValType(CreditKind) == V_UNDEF)
      CreditKind = TArray();
   END;
   
    IF (CreditKind.Size == 0)
      CreditKind(CreditKind.Size) = 0;
   END;

  InitBaseOpParm();
end;
//........................................................................//
//........................................................................//
//Структура параметров отбора для "Просрочки".
class (BaseOpParm) ExpOperation(_OperType, 
                                _OperDate, 
                                _CalcDate, 
                                _CarryDate, 
                                _CurCode, 
                                _CreditKind, 
                                _ObjectTypeID, 
                                _FNCash, 
                                _UserCreditKind, 
                                _AddPrc, 
                                _SMAString, 
                                _ForGraph, 
                                _cExpiration, 
                                _SPOD,
                                _Choice,
                                _Protocol)
   VAR
      OperType      : integer = _OperType,        // Операция.
      OperDate      : date    = _OperDate,       // Дата операции
      CalcDate      : date    = _CalcDate,       // Дата окончания начисления
      CarryDate     : date    = _CarryDate,      // Дата проводки в БУ.
      CurCode       : integer = _CurCode,        // Валюта. -1 - все валюты.
      CreditKind    : TArray  = _CreditKind,     // Массив видов кредита
      UserCreditKind: string  = _UserCreditKind, // Пользовательские виды кредита в виде строки
      FNCash        : integer = _FNCash,         // Филиал
      ObjectTypeID  : integer = _ObjectTypeID,
      AddPrc        : integer = _AddPrc,
      SMAString     : string  = _SMAString,
      ForGraph      : integer = _ForGraph,
      cExpiration   : integer = _cExpiration,
      SPOD          : string  = _SPOD,
      Choice        : integer = _Choice,
      Protocol      : string  = _Protocol;

   // Иначе значение параметра будет UNDEF и ошибка
   IF (ValType(CreditKind) == V_UNDEF)
      CreditKind = TArray();
   END;
   
    IF (CreditKind.Size == 0)
      CreditKind(CreditKind.Size) = 0;
   END;

  InitBaseOpParm();
end;
//........................................................................//
//........................................................................//
//Структура параметров отбора для "Погашение".
class (BaseOpParm) DutyOperation(_OperType, 
                                 _OperDate, 
                                 _CalcDate, 
                                 _CarryDate, 
                                 _CurCode, 
                                 _CreditKind, 
                                 _UserType, 
                                 _FNCash, 
                                 _ObjectTypeID, 
                                 _YesnoUsertype, 
                                 _SMAString, 
                                 _isgraphpay, 
                                 _DutyPriority, 
                                 _dp_source, 
                                 _addprc, 
                                 _forGraph, 
                                 _mode, 
                                 _SPOD,
                                 _Choice,
                                 _Protocol)
   VAR
      OperType      : integer  = _OperType,         // Операция.
      OperDate      : date     = _OperDate,       // Дата операции
      CalcDate      : date     = _CalcDate,       // Дата окончания начисления
      CarryDate     : date     = _CarryDate,      // Дата проводки в БУ.
      CurCode       : integer  = _CurCode,        // Валюта. -1 - все валюты.
      CreditKind    : TArray   = _CreditKind,     // Массив видов кредита
      UserCreditKind: string   = _UserType,       // Пользовательские виды кредита в виде строки
      FNCash        : integer  = _FNCash,         // Филиал
      ObjectTypeID  : integer = _ObjectTypeID,
      YesnoUsertype : string  = _YesnoUsertype,
      SMAString     : string  = _SMAString,
      isgraphpay    : string  = _isgraphpay,
      DutyPriority  : integer = _DutyPriority,
      dp_source     : integer = _dp_source,
      addprc        : integer = _addprc,
      forGraph      : integer = _forGraph,
      mode          : integer = _mode,
      SPOD          : string  = _SPOD,
      Choice        : integer = _Choice,
      Protocol      : string  = _Protocol;

   // Иначе значение параметра будет UNDEF и ошибка
   IF (ValType(CreditKind) == V_UNDEF)
      CreditKind = TArray();
   END;
   
    IF (CreditKind.Size == 0)
      CreditKind(CreditKind.Size) = 0;
   END;

   InitBaseOpParm();
END;
//........................................................................//
//........................................................................//
////Структура параметров отбора для "Закрытие".
class (BaseOpParm) CloseOperation(_OperType, 
                                  _OperDate, 
                                  _CurCode, 
                                  _CreditKind, 
                                  _UserCreditKind, 
                                  _ObjectTypeID, 
                                  _FnCash, 
                                  _YesnoUsertype, 
                                  _SMAString)
   VAR 
      OperType      : integer  = _OperType,       // Операция.
      OperDate      : date     = _OperDate,       // Дата операции
      CalcDate      : date     = _OperDate,       // Дата окончания начисления
      CarryDate     : date     = _OperDate,       // Дата проводки в БУ.
      CurCode       : integer  = _CurCode,        // Валюта. -1 - все валюты.
      CreditKind    : TArray   = _CreditKind,     // Массив видов кредита
      UserCreditKind: string   = _UserCreditKind, // Пользовательские виды кредита в виде строки
      FNCash        : integer  = _FnCash,         // Филиал
      ObjectTypeID  : integer  = _ObjectTypeID,
      YesnoUsertype : string  =  _YesnoUsertype,
      SMAString     : string   = _SMAString;      // Массив видов кредита

   // Иначе значение параметра будет UNDEF и ошибка
   IF (ValType(CreditKind) == V_UNDEF)
      CreditKind = TArray();
   END;
   
    IF (CreditKind.Size == 0)
      CreditKind(CreditKind.Size) = 0;
   END;

  InitBaseOpParm();
end;
//........................................................................//
//........................................................................//
//Структура параметров операции "Формирование РВПС".
class (BaseOpParm) RVPSOperation(_OperType, 
                                 _OperDate, 
                                 _CarryDate, 
                                 _FNCash, 
                                 _Protocol, 
                                 _CheckVal, 
                                 _ObjectTypeID, 
                                 _CreditKind, 
                                 _CaseKind, 
                                 _UserCreditKind, 
                                 _UserCaseKind, 
                                 _KKS, 
                                 _Regulaterez, 
                                 _SMAString, 
                                 _CrdOp, 
                                 _CaseOp, 
                                 _CessID)
  VAR
      OperType       : integer = _OperType,       // Операция.
      OperDate       : date    = _OperDate,       // Дата операции.
      CarryDate      : date    = _CarryDate,      // Дата проводки в БУ.
      FNCash         : integer = _FNCash,         // Филиал
      Protocol       : integer = _Protocol,       // Протокол
      CheckVal       : integer = _CheckVal,       // Проверка валюты
      ObjectTypeID   : integer = _ObjectTypeID,   // Вид объекта
      CreditKind     : TArray  = _CreditKind,     // ВК
      CaseKind       : TArray  = _CaseKind,       // ПРТФ ВК
      UserCreditKind : string  = _UserCreditKind, // ПВК
      UserCaseKind   : string  = _UserCaseKind,   // 
      KKS            : integer = _KKS,            // ККС
      Regulaterez    : integer = _Regulaterez,    // 
      SMAString      : string  = _SMAString,      // 
      CrdOp          : integer = _CrdOp,          // 
      CaseOp         : integer = _CaseOp,         // 
      CessID         : integer = _CessID,         // 
      BatchObjK      : integer = 0,      // ?
      BatchObjN      : integer = 0,      // ?
      CurCode        : integer = 0,
      BriefCaseID    : integer = 0, 
      CaseTC_StdCrd_Op  : integer,  // Признак, что в операции участвуют Стандартные кредиты в портфеле
      CaseTC_CessCrd_Op : integer,  // Признак, что в операции участвуют Приобретенные кредиты в портфеле
      CaseTC_Guar_Op    : integer,  // Признак, что в операции участвуют Гарантии в портфеле
      CaseTC_OV_Op      : integer,  // Признак, что в операции участвуют Овердрафты в портфеле
      CaseTC_Karta_Op   : integer;  // Признак, что в операции участвуют Кредиты по карте в портфеле

   // Иначе значение параметра будет UNDEF и ошибка
   IF (ValType(CreditKind) == V_UNDEF)
      CreditKind = TArray();
   END;
   
    IF (CreditKind.Size == 0)
      CreditKind(CreditKind.Size) = 0;
   END;

   IF (ValType(CaseKind) == V_UNDEF)
      CaseKind = TArray();
   END;
   
    IF (CaseKind.Size == 0)
      CaseKind(CaseKind.Size) = 0;
   END;
      
//constructor
  InitBaseOpParm();
end;
//........................................................................//
//........................................................................//
// Описание параметров операции
//........................................................................//
//Структура параметров операции "Перевода ссуд".
class (BaseOpParm) TransferOperation(_OperDate, 
                                     _CarryDate, 
                                     _CalcDate, 
                                     _CalcPercDown, 
                                     _CalcPercUp, 
                                     _BriefCaseId, 
                                     _Fiz, 
                                     _Jur)
  var
      OperDate        : date    = _OperDate,        // Дата операции.
      CarryDate       : date    = _CarryDate,       // Дата проводки в БУ.
      CalcDate        : date    = _CalcDate,        //
      CalcPercDown    : integer = _CalcPercDown,    //
      CalcPercUp      : integer = _CalcPercUp,      //
      BriefCaseId     : integer = _BriefCaseId,     // 
      Fiz             : string  = _Fiz,             //
      Jur             : string  = _Jur,             //
      CurCode         : integer = -1,
      UserCreditKind  : string  = "",
      FNCash          : integer = -1,
      CreditKind      : TArray;
   IF (ValType(CreditKind) == V_UNDEF)
      CreditKind = TArray();
   END;
   
   IF (CreditKind.Size == 0)
      CreditKind(CreditKind.Size) = 0;
   END;
      
//constructor
  InitBaseOpParm();
END;
//........................................................................//

CLASS (BaseOpParm) RecalcGraphConvParams (_OperType, 
                                          _OperDate, 
                                          _CurCode, 
                                          _CreditKind, 
                                          _UserCreditKind, 
                                          _FnCash)
   VAR 
      OperType      : integer  = _OperType,       // Операция.
      OperDate      : date     = _OperDate,       // Дата операции
      CurCode       : integer  = _CurCode,        // Валюта. -1 - все валюты.
      CreditKind    : TArray   = _CreditKind,     // Массив видов кредита
      UserCreditKind: string   = _UserCreditKind, // Пользовательские виды кредита в виде строки
      FNCash        : integer  = _FnCash;         // Массив видов кредита

   // Иначе значение параметра будет UNDEF и ошибка
   IF (ValType(CreditKind) == V_UNDEF)
      CreditKind = TArray();
   END;
   
   IF (CreditKind.Size == 0)
      CreditKind(CreditKind.Size) = 0;
   END;

//constructor
  InitBaseOpParm();
END;


//........................................................................//
//Структура параметров отбора для "Выгрузка Кредитной Истории".
CLASS (BaseOpParm) BkiConvParams(_BkiID, _SendKind, _BkiGroup, _LegalForm, _Oper, _RepDate, _StartDate, _ByGroup, _AutoDetectStartDate, _PathForming, _CreditKind, _FNCash)

   VAR BkiID                  : integer  = _BkiID;                     // БКИ
   VAR SendKind               : integer  = _SendKind;                  // Вид передачи
   VAR BkiGroup               : integer  = _BkiGroup;                  // Группа БКИ
   VAR LegalForm              : integer  = _LegalForm;                 // Вид субъектов
   VAR Oper                   : integer  = _Oper;                      // Вид субъектов
   VAR RepDate                : date     = _RepDate;                   // Дата отчета
   VAR StartDate              : date     = _StartDate;                 // Начало периода формирования
   VAR ByGroup                : bool     = _ByGroup;                   // По группе БКИ
   VAR AutoDetectStartDate    : bool     = _AutoDetectStartDate;       // Автоматическое определения даты начала периода сбора КИ
   VAR PathForming            : string   = _PathForming;               // Путь

   VAR CreditKind             : TArray   = _CreditKind;                // Виды кредита
   VAR FNCash                 : integer  = _FNCash;                    // Филиал

   InitBaseOpParm();
END;