/*
$Name:             smplgrph.mac                                            
$Module:           Кредитование
$Description:      Отлагательное Условие График выдачи
*/
/*===============================================================================
Отлагательное Условие График выборки
KOE
22.05.07
=================================================================================*/
import "total.mac";

/*В случае успеха возвращается 1*/
macro CheckDilaCond (ObjType, ObjNum, DilaCondID, OperDate)
    /*Анализировать наступление даты выдачи (даты начала выдачи), установленной графиком*/
    var rs = null, count = 0, RSDcmd = null;
    if(ObjType != LO_CREDIT)
        return 0;
    end;

    RSDcmd = RsdCommand(RslDefCon,"SELECT 1 from dpayment_tmp where t_CreditNumber_Ref = ?" +
                                 " AND t_BegDate <= ?" +
                                 " and t_EndDate >= ?" + 
                                 " and t_ID = ?");
   RSDcmd.addParam("", RSDBP_IN); RSDcmd.value(0) = ObjNum;
   RSDcmd.addParam("", RSDBP_IN); RSDcmd.value(1) = OperDate;
   RSDcmd.addParam("", RSDBP_IN); RSDcmd.value(2) = OperDate;
   RSDcmd.addParam("", RSDBP_IN); RSDcmd.value(3) = DilaCondID; 
   rs  = RsdRecordset(RSDcmd);
   RSDcmd.execute;
  
   if ((rs != null) and (rs.MoveNext()) and (rs.value(0, null, V_INTEGER) != null))
      return rs.value(0, null, V_INTEGER);
   end;
   return 0;
    /*Анализировать наступление даты выдачи (даты начала выдачи), установленной графиком*/
  /*  var rs = null, count = 0, RSDcmd = null;

    if(ObjType != LO_CREDIT)
        return 0;
    end;

    RSDcmd = RsdCommand(RslDefCon,"SELECT 1 from dpayment_tmp where t_CreditNumber_Ref = ?" +
                                 " AND t_BegDate <= ?" +
                                 " AND t_IsOperation != 'X'");
   RSDcmd.addParam("", RSDBP_IN); RSDcmd.value(0) = ObjNum;
   RSDcmd.addParam("", RSDBP_IN); RSDcmd.value(1) = OperDate;
   rs  = RsdRecordset(RSDcmd);
   RSDcmd.execute;
  
   if ((rs != null) and (rs.MoveNext()) and (rs.value(0, null, V_INTEGER) != null))
      return rs.value(0, null, V_INTEGER);
   end;
   return 0; */  
end;
