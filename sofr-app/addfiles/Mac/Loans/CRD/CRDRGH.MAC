import SbCrdInter;

record         Договор     ("credit_c.dbt", "loans.def");        /* запись кредитного договора */
file           СчетДоговор ("acc_crd.dbt",  "loans.def") key 1;  /* Файл счетов по договору    */
private file   TypeCrd     ("type_crd.dbt", "loans.def") key 0;  /* файл видов кредита         */
record         RghData     ("rghdata.tmp",  "loans.def");

const prompt = "Остаток по счету просроченных % равен 0. Продолжить?";

var ClaimAccount, NoPercAccount;

macro FindAccount(AccountType)
  СчетДоговор.ObjectID = LO_CREDIT;
  СчетДоговор.ObjectNumber = Договор.CreditNumber;
  СчетДоговор.CreditAccountType = AccountType;
  СчетДоговор.CurCode = Договор.CurCode;
  if( not GetEQ(СчетДоговор))
    MsgBox("Не найден счет по договору!|Документы не сформируются.");
    return false;
  else
    return true;
  end;
end;

macro СменаГруппыРиска(ExchDate, Data)

 SetBuff(RghData, Data);
 
 
 /*Взятие остатков на счетах требований*/
 if ((RghData.OldRiskGroup <= 1) and
     (RghData.NewRiskGroup >= 2) and
     (Договор.FlagOB == FlagOB_SetValue))

   if ((RghData.Rest == $0) and (RghData.Flag == 1))
     if (not GetTrue(false, prompt))
       return false;
     end;
   end;

   RghData.Rest1 = ОстатокНаСчете(LO_CREDIT, Договор.CreditNumber, Договор.CurCode, CLAIM, ExchDate);
 elif ((RghData.OldRiskGroup >= 2) and
       (RghData.NewRiskGroup == 1) and
       (Договор.FlagOB == FlagOB_SetValue))

   if ((RghData.Rest == $0) and (RghData.Flag == 1))
     if (not GetTrue(false, prompt))
       return false;
     end;
   end;

   RghData.Rest1 = ОстатокНаСчете(LO_CREDIT, Договор.CreditNumber, Договор.CurCode, NO_PERC_2, ExchDate);
 else
   RghData.Rest = RghData.Rest1 = $0;
 end;
 return true;
end;
