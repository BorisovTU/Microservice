/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank 4.3                                          R-Style Software Lab

  File Name   : rep_crd.mac                                    21.10.98
  Description : ®âç¥â "Š àâ®çª¨ ¯® ¤®£®¢®àã"

ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/

import prn_crd;

FILE Credit ("credit_c.dbt", "loans.def") key 7;
FILE Curr   ("currency.dbt", "sbbank.def");

var    CreditNumber;

var {GROUP_OPER};
var {TypePerson};

macro ®«ãç¨âì„®£®¢®à()
  array LCreditNumber;
  array LClientName;
  array LCurName;
  array LCurCode;
  array MenuCrdContr;
  var   number = 0;

  while( next (Credit) )
    if ((({TypePerson} == 128) or ({TypePerson} == 129) or
        (({TypePerson} == 142) and (Credit.GroupNum == {GROUP_OPER})) or
        (({TypePerson} == 147) and ({GROUP_OPER} == 0)) or
        (({TypePerson} == 147) and (Credit.GroupNum == {GROUP_OPER}))))
      LCreditNumber(number) = Credit.UsCreditNumber;
      LClientName(number)   = FindClient(Credit.ClientID_Ref);
      LCurName(number)      = FindShortName(Credit.CurCode);
      LCurCode(number)      = Credit.CurCode;
      MenuCrdContr(number)  = string(LCreditNumber(number):15:l) + " " + LClientName(number) + " " + LCurName(number);
      number = number + 1 ;
    end;
  end;
  if(number == 0)
    msgbox("‘¯¨á®ª ¤®£®¢®à®¢ ¯ãáâ");
    exit(1);
  end;
  number = Menu( MenuCrdContr, " ‚ë¡¥à¨â¥ ¤®£®¢®à : ", " ‘¯¨á®ª ¤®£®¢®à®¢ " );
  if(number < 0)  exit(1); end;
  SetParm ( 0 , LCreditNumber(number) );
end;

 ®«ãç¨âì„®£®¢®à(CreditNumber);
 Credit.UsCreditNumber = CreditNumber;
 if ( getEQ(Credit) )
   copy(„®£®¢®à,Credit);
   ¥ç âì„®£®¢®à();
 end;

