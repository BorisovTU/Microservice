/*
   Формирование номера требования
   13.07.05 Tereshchenko FS
*/
IMPORT "sbcrdnum.mac", "total.mac";

RECORD С_Требование ("doc_duty.dbt");

MACRO ОбработкаШаблона(buff, Template)
   VAR Count = 0;

   SetBuff(С_Требование, buff);

   IF (С_Требование.CreditNumber_Ref == 0)
      MsgBox("Не задан номер кредитного договора!");
      RETURN;
   END;

   // Порядковый номер требования
   Count = LnSelectValue("SELECT COUNT(*) FROM DDOC_DUTY_DBT WHERE T_CREDITNUMBER_REF = " + С_Требование.CreditNumber_Ref +
                                                             " AND T_KIND             = 1" , V_INTEGER);
   Count = Count + 1;

   С_Требование.Number = Template;
   ВставитьФрагмент(СмвлНомерДокумента,       С_Требование.CreditNumber_Ref, Template, С_Требование.Number);
   ВставитьФрагмент(СмвлСледПорНомКредДогВсе, Count,                         Template, С_Требование.Number);
END;