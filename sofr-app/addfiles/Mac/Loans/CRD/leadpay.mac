/*---------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : leadpay.mac
 Description : Создание документа по шагу операции (отвод рассрочки)

 Programmer  : Tsibulsky A.V.
 18.01.2007    : Создан
-----------------------------------------------------------------------------------*/
import SbCrdInter, macperc;

record ШагОперации ("step_op.dbt",  "loans.def");     /* Запись шага операции */
record Документ    ("doc_acc.dbt",  "loans.def");     /* Буфер документа      */
record Операция    ("crd_op.dbt",   "loans.def");     /* Операция по договору */
record Договор     ("credit_c.dbt", "loans.def");
RECORD Сумма       ("SUM.",         "loans.def");

macro ВыполнитьШаг (OperDate, Sum, Data)
    var stat:integer = 0;
    VAR DocID        : integer = 0;
    VAR СуммаОП: money;

    setbuff(Сумма, Sum);
    Документ.CarrySum = Сумма(0);
    stat = СоздатьДокумент (Документ, DocID);
    if (stat == 0)
        stat = ИзменитьРегистр(LO_KARTA, Договор.CreditNumber, TDR_MAINREST, DocID, -Документ.CarrySum);
        stat = ИзменитьРегистр(LO_DUTY, Операция.ObjectID_Ref, TDR_MAINREST, DocID, Документ.CarrySum);
    end;
    return 0;
end;
