/*------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : CessDemS.mac                                           2008-09-02
 Description : Макрос операций уступки прав требования

 Programmer  : Manushkina E.V.
 2008-09-02  : Создан prj 984
------------------------------------------------------------------------------*/

import "total.mac";

// заполнение файла dpayment_tmp
// для операции уступки прав
macro FillFileCes (
   OpType   : integer,
   OpDate   : date,
   CalcDate : date,
   CesK     : integer,
   CesN     : integer
)
   var RSDcmd = NULL;

   BegAction (1, "Формирование списка задолженности. Ждите, это может занять несколько минут.", false);

   RSDcmd = RsdCommand (RslDefCon, "BEGIN LoansFillPayment.FillForConCessionOp (?, ?, ?, ?, ?); END;");
   RSDcmd.addParam ("OpType",   RSDBP_IN); RSDcmd.value ("OpType")   = OpType;
   RSDcmd.addParam ("OpDate",   RSDBP_IN); RSDcmd.value ("OpDate")   = OpDate;
   RSDcmd.addParam ("CalcDate", RSDBP_IN); RSDcmd.value ("CalcDate") = CalcDate;
   RSDcmd.addParam ("CesK",     RSDBP_IN); RSDcmd.value ("CesK")     = CesK;
   RSDcmd.addParam ("CesN",     RSDBP_IN); RSDcmd.value ("CesN")     = CesN;

   RSDcmd.execute();

   EndAction (1);
end;

// расчет задолженности
// для операции уступки прав
macro CalcPercent (OpDate:date)
   var RSDcmd; 

   RSDcmd = RsdCommand (RslDefCon, "DELETE FROM dpercpay_tmp");
   RSDcmd.execute();

   /*Основной долг рассчитывается теперь отдельно от всех остальных ВЗ*/
   CalcGroupPercent(OpDate, OpDate, 0);
END;