/*---------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : duty_r2.mac
 Description : Создание документа по шагу операции "Погашение в рублях"
               (2-й шаг - перечисление средств с рублевого счета на валютный)

 Programmer  : TT
 23.02.03    : Создан
-----------------------------------------------------------------------------------*/
import SbCrdInter, total;

record ШагОперации ("step_op.dbt",  "loans.def");     /* Запись шага операции */
record Документ    ("doc_acc.dbt",  "loans.def");     /* Буфер документа      */
record Операция    ("crd_op.dbt",   "loans.def");     /* Операция по договору */
record Договор     ("credit_c.dbt", "loans.def");

private VAR  payment_tmp = TBFile ("payment.tmp", "r", 0);

macro ВыполнитьШаг (OperDate, Sum, Data)
    payment_tmp.rewind;
    Документ.CarrySum = $0;
    while (payment_tmp.next)
        Документ.CarrySum = Документ.CarrySum + payment_tmp.rec.PaySum;
    end;
    return СоздатьДокумент(Документ);
end;
