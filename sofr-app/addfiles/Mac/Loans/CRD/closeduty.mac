/*
$Name:              closeduty.mac  
$Module:            Кредитование
$Description:       Макрос для пользовательской функции проверки перед удалением СО
*/
/*
Programmer: Shershnev V.S.
2014-05-22  : Создан #207167 
*/
IMPORT TOTAL, SbCrdInter;

record Обязательство ("duty_crd.dbt", "loans.def");

macro UserCheck(CrdKind:integer, OpDate:date, TypeOperNumber:integer)
   //Проверим нет ли остатков на регистрах
   var result = CRsdCommand("SELECT count(T_REGREST) FROM dlcusreg_dbt WHERE      T_OBJECTTYPEID  = ?" +
                                                                             "AND T_OBJECTNUMBER  = ?" + 
                                                                             "AND T_REGREST      != 0",
                              "p1", CrdKind,        
                              "p2", Обязательство.DUTYID,
                              V_INTEGER
                           );
   if (result > 0)
       LoansError("По обязательству имеются ненулевые остатки. Закрытие невозможно!");
   end;
   return result;

end;