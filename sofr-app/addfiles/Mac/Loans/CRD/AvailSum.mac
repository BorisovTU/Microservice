/*------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : AvailSum.mac                                           2008.04.22
 Description : Макрос расчета доступной суммы к выдачи

 Programmer  : Manushkina E.V.
 2008-04-22  : Создан #124150
 2009-01-20  : Возврат % по депозиту
------------------------------------------------------------------------------*/

import "total.mac";

record Договор ("credit_c.dbt", "loans.def");
record Обязательство ("duty_crd.dbt", "loans.def");

// расчитать максимальную сумму которую можно выдать
macro CalcMaxAvailablePaySum (
   PayT,   // тип выдачи (для СО определяется по КД)
   ObjK,   // вид объекта по которому инициируется операция выдачи
   ObjN,   // номер объекта по которому инициируется операция выдачи
   CrdN,   // номер КД к которому привязо СО (для операции по КД равно номеру КД)
   ObjS,   // сумма объекта по которому инициируется операция
   CalcD,  // дата операции выдачи
   OpSyst // id системной операции
)
   var RSDcmd;
   
   RSDcmd = RsdCommand (RslDefCon, "begin ? := LoansUserFunction.CalcMaxAvailPaySum (?,?,?,?,?,?,?); end;");

   RSDcmd.addParam("retval", RSDBP_RETVAL, V_NUMERIC);

   RSDcmd.addParam ("PayT",   RSDBP_IN); RSDcmd.value ("PayT")   = PayT;
   RSDcmd.addParam ("ObjK",   RSDBP_IN); RSDcmd.value ("ObjK")   = ObjK;
   RSDcmd.addParam ("ObjN",   RSDBP_IN); RSDcmd.value ("ObjN")   = ObjN;
   RSDcmd.addParam ("CrdN",   RSDBP_IN); RSDcmd.value ("CrdN")   = CrdN;
   RSDcmd.addParam ("ObjS",   RSDBP_IN); RSDcmd.value ("ObjS")   = ObjS;
   RSDcmd.addParam ("CalcD",  RSDBP_IN); RSDcmd.value ("CalcD")  = CalcD;
   RSDcmd.addParam ("OpSyst", RSDBP_IN); RSDcmd.value ("OpSyst") = OpSyst;

   RSDcmd.execute ();

   return RSDcmd.Value(0);

   OnError
      return $0;
end;
