/*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

    RS-Loans 6.00

    Кредитование

    Массовое закрытие видов кредита
    TFS 07.06.2011

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/

import LoansFind;
import "total.mac";

macro ReportPrintHeader(OperName, OperDate, Title)
[ ];
[     Вид операции : ##################################################](OperName);
[     Дата операции: ##########](OperDate);
[ ];
END;

macro ReportPrintLine(Res)
   IF (Res == 0)
[ Успешно выполненные];
   ELSE
[ Операции не сформированны];
   END;
[ ╓──────────────────────────────────────────────────┬──────────┬──────┬──────────────────────────╖];
[ ║     Вид кредита                                  │   Дата   │Валюта│Статус выполнения операции║];
[ ╟──────────────────────────────────────────────────┼──────────┼──────┼──────────────────────────╢];
   VAR strStatus = "", RS;

   RS = 
   CRSDCommand("SELECT tcr.T_CREDITTYPENAME, gr.T_DATE, fn.T_FI_CODE, gr.T_FLAG FROM " +
   " DGROUP_PAY_TMP gr, DTYPE_CRD_DBT tcr, DFININSTR_DBT fn WHERE " +
       " gr.T_CREDITNUMBER_REF = tcr.T_CREDITTYPEID " +
   " AND gr.T_RESULT   = ? " +
   " AND tcr.T_CURCODE = fn.T_FIID ",
         "p1", Res, V_GENOBJ);

   WHILE (RS.MoveNext())
      IF (RS.Value(3) == "X")
         strStatus = "Исключен";   
      ELSE
         IF (Res == -1)
            strStatus = "Ошибка выполнения";   
         ELSE
            strStatus = "Обработан";
         END;
      END;

[ ║##################################################│##########│######│##########################║]
(  RS.Value(0),
   date(RS.Value(1)),
   RS.Value(2),
   strStatus);
   END;

[ ╙──────────────────────────────────────────────────┴──────────┴──────┴──────────────────────────╜];
[ ];
    return 0;
end;

MACRO PrintReport(OperDate: date, OperTypeNumber: integer)
VAR OperName = LnSelectValue("SELECT T_TYPEOPERNAME FROM DTYPE_OP_DBT WHERE T_TYPEOPERNUMBER = " + OperTypeNumber, V_STRING);
 
   IF (Trim(OperName) == "")
      OperName = "По умолчанию";
   END;

   ReportPrintHeader(OperName, OperDate);
   ReportPrintLine(0);
   ReportPrintLine(-1);
END;