/*------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : rez_sum.mac
 Description : Расчёт резерва по договору

 Programmer  : TFS
 xx.xx.xx    : Создан
------------------------------------------------------------------------------*/
/* Функции:
     MACRO РасчетРезерва_РВПС(ВидОбъекта, НомерОбъекта, ДатаОперации, Data);
     MACRO РасчетРезерва_РВП(ВидОбъекта, НомерОбъекта, ДатаОперации, Data);
     т.д.
*/

IMPORT SbCrdInter;

private record Договор  ("credit_c.dbt", "loans.def");             /* Текущий буфер договора */
private record Портфель ("lbrfcase.dbt", "loans.def");             /* Текущий буфер договора */

record RezData  ("rezdata.tmp",  "loans.def");

MACRO РасчетРезерва_РВП(ВидОбъекта, НомерОбъекта, ДатаОперации, Data, show_message: bool, recalc: bool, CherCur:bool, TypeContract:integer)
var ErrStr;
   
   if(ValType(TypeContract) == V_UNDEF)
     TypeContract = CASE_UNI_TC_NotSet;
   end;

   setbuff(RezData, Data);
   if(SQLCalcRezSum(ВидОбъекта, НомерОбъекта, ДатаОперации, RezData, recalc, ErrStr, CherCur, 0, TypeContract))
      IF (show_message) LoansError(ErrStr); end;
      return false;
   end;
   return true;
END;

MACRO РасчетРезерва_РВПС(ВидОбъекта, НомерОбъекта, ДатаОперации, Data, recalc : bool, TakinCase: bool, show_message: bool, chekval: bool)
var ErrStr;
   if (ValType(Data) == V_MEMADDR)
      setbuff(RezData, Data);
   else
      copy(RezData, Data);
   end;
   if(SQLCalcRezSum(ВидОбъекта, НомерОбъекта, ДатаОперации, RezData, recalc, ErrStr, chekval, 1))
      IF (show_message) LoansError(ErrStr); end;
      return false;
   end;
   if (ValType(Data) != V_MEMADDR)
      copy(Data, RezData);
   end; 
   return true;
end;

MACRO РасчетРезерваПредоплаты(ВидОбъекта, НомерОбъекта, ДатаОперации, Data, recalc : bool, TakinCase: bool, show_message: bool, chekval: bool)
var ErrStr;
   if (ValType(Data) == V_MEMADDR)
      setbuff(RezData, Data);
   else
      copy(RezData, Data);
   end;
   if(SQLCalcRezSum(ВидОбъекта, НомерОбъекта, ДатаОперации, RezData, recalc, ErrStr, chekval, 2))
      IF (show_message) LoansError(ErrStr); end;
      return false;
   end;
   if (ValType(Data) != V_MEMADDR)
      copy(Data, RezData);
   end; 
   return true;
end;

MACRO РасчетРезерваПортфеля_РВПС(ВидОбъекта, НомерОбъекта, ДатаОпер, Data, recalc : bool, TakinCase: bool, show_message: bool, curcheck: bool, TypeContract:integer)
var ErrStr;
   
   if(ValType(TypeContract) == V_UNDEF)
      TypeContract = CASE_UNI_TC_NotSet;
   end;

   if (ValType(Data) == V_MEMADDR)
      setbuff(RezData, Data);
   else
      copy(RezData, Data);
   end;
   if(SQLCalcRezSum(ВидОбъекта, НомерОбъекта, ДатаОпер, RezData, recalc, ErrStr, curcheck, 1, TypeContract))
      IF (show_message) LoansError(ErrStr); end;
      return false;
   end;
   if (ValType(Data) != V_MEMADDR)
      copy(Data, RezData);
   end; 
   return true;
end;