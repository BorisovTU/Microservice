import total;

var
 ActualDate,
 QuoteDate,
 RateValue,
 RetVal,
 MaxCurdate;

macro PrintRateGraph(TypeRateID, TrffValueId, ObjID, ObjN, FiID)

macro PrintHeader()
var trname: string;
var indicname : string;
var pstring : string;
  trname = CRsdCommand ("SELECT T_TYPERATENAME FROM DLCTYPUSE_DBT WHERE T_TYPERATEID = ?", "trid", TypeRateID, V_STRING);
  [ ];
  [   ƒà ä¨ª  ªâã «¨§ æ¨¨ §­ ç¥­¨© â à¨ä  ###############################################################################] (trname); 
  [ ];
  [ ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
  [ ³ „ â   ªâã «¨§ æ¨¨ ³ „ â  ª®â¨à®¢ª¨ ³ ‡­ ç¥­¨¥ áâ ¢ª¨ ³];
  [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];

end;                                                               

macro PrintFooter()
  [ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
end;

macro PrintString()
  if (ActualDate > MaxCurdate)
   RateValue = " ";
  end;
  [ ³ ################# ³ ############## ³ ############### ³]
  (ActualDate,
   QuoteDate,
   RateValue:0:9);
end;

macro PrintBody()
 var rs2 = NULL, rs = NULL;

  rs = CRSDCommand ("SELECT t.T_ACTUALDATE, t.T_QOUTDATE FROM DLCHRTGRPH_TMP t " + 
                     "WHERE t.T_TrffValueID = ?",
                          "p1", TrffValueID,
            V_GENOBJ);
  while (rs.moveNext())

    ActualDate = rs.value (0, NULL, V_DATE);
    QuoteDate  = rs.value (1, NULL, V_DATE);
    RateValue  = GetLoansRateValue(ObjID, ObjN, TypeRateID, QuoteDate, TrffValueID);
    
    PrintString();
    RateValue = 0;
  end;

end;

  MaxCurdate = CRsdCommand ("SELECT MAX (T_CURDATE) FROM DCURDATE_DBT WHERE T_BRANCH = ? AND LNNVL (T_ISCLOSED = ?)",
            "br", {OperDprt},
            "iscls", "X",
            V_DATE);

  PrintHeader();
  PrintBody();
  PrintFooter();
end;
