IMPORT SbCrdInter, LoansFind;

File lctypuse ("lctypuse.dbt", "loans.def") write;

MACRO FillCredOperBuff(buff)
    record CrdOp   ("crd_op.dbt",   "loans.def");
    record DutyCrd ("duty_crd.dbt", "loans.def");
    record EnsContr("enscontr.dbt", "loans.def");
    record Case    ("lbrfcase.dbt", "loans.def");

    SetBuff(CrdOp, buff);

    IF((CrdOp.ObjectTypeID_Ref == LO_CREDIT) or
       (CrdOp.ObjectTypeID_Ref == LO_KARTA))
        CrdOp.CreditNumber_Ref = CrdOp.ObjectID_Ref;
    ELIF (CrdOp.ObjectTypeID_Ref == LO_DUTY)
        IF (NOT Loans_FindDuty(CrdOp.ObjectID_Ref, DutyCrd))
            RETURN false;
        END;
        CrdOp.CreditNumber_Ref = DutyCrd.CreditNumber_Ref;
    ELIF (CrdOp.ObjectTypeID_Ref == LO_ENSCONTR)
        IF (NOT Loans_FindEnsContract(CrdOp.ObjectID_Ref, EnsContr))
            RETURN false;
        END;
        CrdOp.CreditNumber_Ref = EnsContr.CreditNumber_Ref;
    ELIF (CrdOp.ObjectTypeID_Ref == LO_CASE)
        IF (NOT Loans_FindCASE(CrdOp.ObjectID_Ref, Case))
           RETURN FALSE;
        END;
        CrdOp.CreditNumber_Ref = Case.BriefcaseID;
    END;

    RETURN true;
END;