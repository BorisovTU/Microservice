/*
$Name:               restruct.mac
$Module:            เฅคจโฎขญจฅ
$Description:       RSL ไใญชๆจฎญซ์ญฎแโ์ ฅแโเใชโใเจงๆจจ
*/
import total;

Macro PrintHeader(repdate: date)
   Println("ฏจแฎช คฎฃฎขฎเฎข ชซจฅญโ, ขชซ๎็ฅญญ๋ๅ ข ฏฎเโไฅซจ");
  [ษอออออออัออออออออออออออออออออออออออออออออออออออออัอออออออออออัอออออออออออออัออออออออออออออออออออออออัอออออออัอออออออออออออออออออออออออป];
  [บก๊ฅชโ ณฎฌฅเ คฎฃฎขฎเ                          ณ     แ     ณ      ฏฎ     ณ แโโฎช งคฎซฆฅญญญฎแโจ ณ ซ๎โณ ฎเโไฅซ์                บ];
  [ฬอออออออุออออออออออออออออออออออออออออออออออออออออุอออออออออออุอออออออออออออุออออออออออออออออออออออออุอออออออุอออออออออออออออออออออออออน];
//[บ   ##  ณ####################################### ณ   ########ณ     ########ณ              ##########ณ    ###ณ#########################บ];

END;

Macro PrintFooter
  [ศอออออออฯออออออออออออออออออออออออออออออออออออออออฯอออออออออออฯอออออออออออออฯออออออออออออออออออออออออฯอออออออฯอออออออออออออออออออออออออผ];
END;

Macro PrintBody(repdate: date)
  VAR RSDcmd : object = NULL;
  VAR rs     : object = NULL;
  RSDcmd = RsdCommand (RslDefCon, " SELECT lo.t_shortname as t_shortname,res.t_uscreditnumber,res.t_uscreditnumber, res.t_regdate, res.t_returndate,res.t_curcode, "+
  " cast(DECODE (t_type, 1, LoansKernel.GetCaseDutySum (res.t_crd_kind, res.t_creditnumber, ?, 0,1), "+
  "       0, (DECODE (res.t_crd_kind, ?, LoansKernel.GetCaseDutySum (res.t_crd_kind,res.t_creditnumber, ?, ?, 0), "+
                               "      ?, LoansKernel.GetCaseDutySum (res.t_crd_kind,res.t_creditnumber, ?, ?, 0), "+
                               "      ?, LoansKernel.GetCaseDutySum (res.t_crd_kind,res.t_creditnumber, ?, ?, 0), "+
                               "      ?, LoansKernel.GetCaseDutySum (res.t_crd_kind,res.t_creditnumber, ?, ?, 0), "+
              " 0)),0) as number(32,12))  AS t_rest, decode(lbrf.t_referenceid, 0, t_briefcasename, (select l.t_briefcasename from dlbrfcase_dbt l where l.t_briefcaseid = lbrf.t_referenceid)) as t_briefcasename "+
              " FROM (SELECT crd.t_uscreditnumber,crd.t_regdate,crd.t_returndate,crd.t_crd_kind,crd.t_creditnumber,crd.t_curcode, "+
              " LoansKernel.dutyincases (crd.t_crd_kind, crd.t_creditnumber,?, 0)  AS lbrfid "+
              " FROM dcredit_c_dbt crd, DTMPKD_TMP t  where  crd.t_creditnumber = t.T_CREDITNUMBER_REF "+
              " UNION ALL "+
              " SELECT crd.t_uscreditnumber, crd.t_regdate, crd.t_returndate, crd.t_crd_kind, crd.t_creditnumber,crd.t_curcode, "+
              " LoansKernel.dutyincases (crd.t_crd_kind, crd.t_creditnumber, ?, 1) AS lbrfid "+
              " FROM dcredit_c_dbt crd, DTMPKD_TMP t where  crd.t_creditnumber = t.T_CREDITNUMBER_REF) res, dlbrfcase_dbt lbrf, dlobject_dbt lo "+
              " WHERE lbrf.t_briefcaseid = res.lbrfid AND res.lbrfid != 0 AND  lo.t_objectid = RES.T_CRD_KIND");
   RSDcmd.addParam ("opdate1",   RSDBP_IN); RSDcmd.value ("opdate1")  = repdate;
   RSDcmd.addParam ("crdtype",   RSDBP_IN); RSDcmd.value ("crdtype")  = lo_credit;
   RSDcmd.addParam ("opdate2",   RSDBP_IN); RSDcmd.value ("opdate2")  = repdate;
   RSDcmd.addParam ("reg_av" ,   RSDBP_IN); RSDcmd.value ("reg_av")   = TDR_AVAILABLELIMIT;
   RSDcmd.addParam ("bk"     ,   RSDBP_IN); RSDcmd.value ("bk")       = lo_karta;
   RSDcmd.addParam ("opdate3",   RSDBP_IN); RSDcmd.value ("opdate3")  = repdate;
   RSDcmd.addParam ("lim"    ,   RSDBP_IN); RSDcmd.value ("lim")      = TCLTR_LIMDUTY;
   RSDcmd.addParam ("ov"     ,   RSDBP_IN); RSDcmd.value ("ov")       = LO_OVERDRAFT;
   RSDcmd.addParam ("opdate4",   RSDBP_IN); RSDcmd.value ("opdate4")  = repdate;
   RSDcmd.addParam ("lim2"   ,   RSDBP_IN); RSDcmd.value ("lim2")     = TCLTR_LIMDUTY;
   RSDcmd.addParam ("guar"   ,   RSDBP_IN); RSDcmd.value ("guar")     = LO_GUARANTEE;
   RSDcmd.addParam ("opdate5",   RSDBP_IN); RSDcmd.value ("opdate5")  = repdate;
   RSDcmd.addParam ("payed"  ,   RSDBP_IN); RSDcmd.value ("payed")    = TDR_PAYEDGUARANTEE;
   RSDcmd.addParam ("opdate6",   RSDBP_IN); RSDcmd.value ("opdate6")  = repdate;
   RSDcmd.addParam ("opdate7",   RSDBP_IN); RSDcmd.value ("opdate7")  = repdate;
   RSDcmd.execute();  
   rs = RsdRecordset (RSDcmd);
   WHILE (rs.MoveNext )
        [บ   ##  ณ####################################### ณ ##########ณ   ##########ณ              ##########ณ    ###ณ#########################บ]
        (rs.value("t_shortname"),
         rs.value("t_uscreditnumber"),
         rs.value("t_regdate",     NULL,  V_DATE),
         rs.value("t_returndate",  NULL,  V_DATE),
         rs.value("t_rest",        NULL, V_MONEY),
         getCurISOl( rs.value("t_curcode")),
         rs.value("t_briefcasename")
        );
   end;
END;


Macro DutyInCase(repdate: date)
   PrintHeader(repdate);
   PrintBody(repdate);
   PrintFooter;
end;




//DutyInCase({curdate});