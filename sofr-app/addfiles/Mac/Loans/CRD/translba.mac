/*
$Name:             translba.mac
$Module:           Кредитование
$Description:      Макрос общих функций для Кредитного бухгалтера
*/
IMPORT Календарь, "total.mac";

FILE ListFDep ("listfdep.dbt", "sbbank.def");
FILE Credit   ("credit_c.dbt", "loans.def");
FILE DutyCrd  ("duty_crd.dbt", "loans.def");
FILE EnsContr ("enscontr.dbt", "loans.def");
FILE Risk     ("riskgr.dbt",   "loans.def");
private file EnsCrd  ("ens_crd.dbt",  "loans.def") key 0;
PRIVATE FILE Party ("party.dbt", "bank.def");

FILE Rep  () txt write;
FILE RepA () txt;

CONST _DAY_  = 1,
      _YEAR_ = 2;

CONST Tbl ="123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ0";

VAR NameFile;
private var ErrCode;
var stat:bool = false;

if(GetRegistryValue ("RS-RETAIL\\INI\\ДИРЕКТОРИИ\\TEXTDIR", V_STRING, NameFile, ErrCode) != V_STRING)
    msgBox(ErrCode);
    return true;
end;

var OutShem = "";
if(GetRegistryValue ("RS-LOANS\\ОТЧЕТЫ\\СХЕМА_ВЫГРУЗКИ", V_STRING, OutShem, ErrCode) != V_STRING)
    msgBox(ErrCode);
    return true;
end;
VAR RepDate:date,
    i:integer,
    Pos:integer,
    K:doublel;
VAR day:integer,
    mon:integer,
    year:integer,
    c:integer = 0,
    FN:string,
    fb:bool,
    sum = $0;


VAR {ФИЛИАЛ};

CLASS Data
    VAR P:string;
    VAR D:moneyl;
END;

VAR Out = TArray(0);

MACRO InputDate()

    var Ext = "";

    if (ValType(OutShem) == V_UNDEF)
       MsgBox("Не определена схема выгрузки!");
       OutShem = "F";
    else
       OutShem = StrUpr(Substr(trim(OutShem), 1, 1));
    end;

    if (OutShem == "F")
       Ext = "BNK";
    else
       Ext = String({ФИЛИАЛ}:3:o)
    end;

    RepDate = {curdate};

    IF (not GetDate(RepDate, "Введите дату отчета"))
        Exit(1);
    END;
    IF (RepDate > {curdate})
        MsgBox("Дата отчета превышает текущую");
    END;

    DateSplit(RepDate, day, mon, year);
    FN = "#1"+SubStr(Tbl, mon, 1)+SubStr(Tbl, day, 1)+SubStr(String(year),3,2)+"1"+OutShem+"."+Ext;
END;


MACRO CheckDate(BD:date, ED:date, FD:integer, TFD:integer, LD:integer, TLD:integer)
    VAR day = ED - BD;

    IF ((TFD == _DAY_) AND (TLD == _DAY_))
        IF ((day >= FD) AND (day <= LD))
            RETURN TRUE;
        END;
    ELIF ((TFD == _DAY_) AND (TLD == _YEAR_))
        IF (LD == 999)
            IF (day >= FD)
                RETURN TRUE;
            END;
        ELIF ((day >= FD) AND (DateAfterCalenMonths(BD, LD*12) <= ED))
            RETURN TRUE;
        END;
    ELSE
        IF (LD == 999)
            IF ((BD+day) > DateAfterCalenMonths(BD, FD*12))
                RETURN TRUE;
            END;
        ELIF (((BD+day) > DateAfterCalenMonths(BD, FD*12)) AND (DateAfterCalenMonths(BD, LD*12) <= ED))
            RETURN TRUE;
        END;
    END;

    RETURN FALSE;
END;

MACRO GetDutyRestDuration(CurCode:integer,
                          FD:integer,
                          TFD:integer,
                          LD:integer,
                          TLD:integer,
                          IsRes:string,
                          TypeRest:integer)
    VAR Sum:moneyl = $0;

    i = i + 1;
    UseProgress(i);
    ReWind(Credit);
    WHILE (Next(Credit))
        IF ((Credit.CurCode == CurCode) AND
            (FindClient (Credit.ClientID_Ref) != "") AND
            (DepClnt.OffshoreResident == IsRes))
            ReWind(DutyCrd);
            WHILE (Next(DutyCrd))
                IF ((DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND
                    (DutyCrd.DutyType == 0) AND
                    (DutyCrd.DutyLastDate >= (RepDate-1)))
                    IF (CheckDate(DutyCrd.DutyFirstDate, DutyCrd.DutyLastDate, FD, TFD, LD, TLD))
                        Sum = Sum + ОстатокСО(DutyCrd.DutyID, TypeRest, RepDate-1);
                    END;
                END;
            END;
        END;
    END;

    RETURN moneyL(round(Sum * GetRate(RepDate, CurCode)));
END;

InputDate();
Out(0) = GenObject("Data");
Out(0).P = "00Крз0000";
Out(0).D = $0;
ReWind(Credit);
i = 0;
InitProgress(NRecords(Credit), "Обработка данных для <Часть 8925>", "Кредитные договоры");
WHILE (Next(Credit))
    i = i + 1;
    UseProgress(i);
    IF ((Credit.CurCode == 0) OR (Credit.CurCode == 1))
        IF (isInsider(Credit.ClientID_Ref))
            KeyNum(DutyCrd, 1);
            DutyCrd.CreditNumber_Ref = Credit.CreditNumber;
            DutyCrd.DutyState = "";
            IF (GetGE(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber))
                Prev(DutyCrd);
                WHILE (Next(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND (DutyCrd.DutyType == 0))
                    IF (DutyCrd.DutyLastDate >= (RepDate-1))
                        Out(0).D = Out(0).D
                                 + round( ОстатокСО(DutyCrd.DutyID, TDR_MAINREST, RepDate-1)
                                 * GetRate(RepDate, Credit.CurCode));
                    END;
                END;
            END;
            
            ClearRecord(EnsCrd);
            EnsCrd.EnsContractID_Ref = 0;                              
            EnsCrd.CreditNumber_Ref = Credit.CreditNumber;                                                    
            stat = GetGE(EnsCrd);
            while((stat) and (EnsCrd.CreditNumber_Ref == Credit.CreditNumber))
                keyNum(EnsContr, 0);
                ClearRecord(EnsContr);
                EnsContr.EnsContractID = EnsCrd.EnsContractID_Ref;
                stat = GetGE(EnsContr);
                while((stat) and (EnsContr.EnsContractID == EnsCrd.EnsContractID_Ref)
                      and (EnsContr.EnsContractStatus == EC_IN))
                    IF (EnsContr.EnsSysType == 1)
                        Out(0).D = Out(0).D
                                 + round(EnsContr.EnsContractSum
                                 * GetRate(RepDate, Credit.CurCode));
                    END;
                    stat = Next(EnsContr);
                end;
                stat = Next(EnsCrd);
            end;
        END;
    END;
END;
RemProgress();


Out(1) = GenObject("Data");
Out(1).P = "00Кри0000";
Out(1).D = $0;
ReWind(Credit);
i = 0;
InitProgress(NRecords(Credit), "Обработка данных для <Часть 8949>", "Кредитные договоры");
WHILE (Next(Credit))
    i = i + 1;
    UseProgress(i);
    IF ((Credit.CurCode == 0) OR (Credit.CurCode == 1))
        DateSplit (RepDate-1, NULL, NULL, year);
        if( year < 1999 )  K = 0; end;
        if( year == 1999 ) K = 0.75; end;
        if( year >= 2000 ) K = 1; end;

        Risk.NumberRiskGroup = ГруппаРиска(Credit.CreditNumber, RepDate-1);
        GetEQ(Risk);
        DoubleL(Risk.DefaultPercentRate);
        Out(1).D = Out(1).D +
                   (MoneyL(ОстатокОткрытыхСО (Credit.CreditNumber, TDR_MAINREST, RepDate-1) * DoubleL(Risk.DefaultPercentRate) * K) +
                    MoneyL(ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, EXPCRD, RepDate-1) * DoubleL(Risk.DefaultPercentRate) * K)) *
                   GetRate(RepDate, Credit.CurCode) / 100 -
                   ОстатокНаСчете(LO_CREDIT, Credit.CreditNumber, Credit.CurCode, REZ_ACC, RepDate-1) -
                   ОстатокНаСчете(LO_CREDIT, Credit.CreditNumber, Credit.CurCode, REZ_EXP, RepDate-1)/* -
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_ACC_1, RepDate-1) -
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_ACC_2, RepDate-1) -
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_ACC_3, RepDate-1) -
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_EXP_1, RepDate-1) -
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_EXP_2, RepDate-1) -
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_EXP_3, RepDate-1)*/;
    END;
    Out(1).D = MoneyL(round(Out(1).D));
END;
RemProgress();


Out(2) = GenObject("Data");
Out(2).P = "008925000";
Out(2).D = $0;
ReWind(Credit);
i = 0;
InitProgress(NRecords(Credit), "Обработка данных для <8968>", "Кредитные договоры");
WHILE (Next(Credit))
    i = i + 1;
    UseProgress(i);
    IF (((Credit.CurCode == 0) OR (Credit.CurCode == 1)) AND
        (ГруппаРиска (Credit.CreditNumber, RepDate-1) == 1))
        Out(2).D = Out(2).D +
                   ОстатокНаСчете(LO_CREDIT, Credit.CreditNumber, Credit.CurCode, REZ_ACC, RepDate-1) +
                   ОстатокНаСчете(LO_CREDIT, Credit.CreditNumber, Credit.CurCode, REZ_EXP, RepDate-1)

              /* + ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_ACC_1, RepDate-1) +
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_ACC_2, RepDate-1) +
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_ACC_3, RepDate-1) +
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_EXP_1, RepDate-1) +
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_EXP_2, RepDate-1) +
                   ОстатокНаСчете(Credit.CreditNumber, Credit.CurCode, REZ_EXP_3, RepDate-1)*/;
    END;
    Out(2).D.D = MoneyL(round(Out(2).D));
END;
RemProgress();


Out(3) = GenObject("Data");
Out(3).P = "008949000";
Out(3).D = $0;

Out(4) = GenObject("Data");
Out(4).P = "008968000";
Out(4).D = $0;

Out(5) = GenObject("Data");
Out(5).P = "008974000";
Out(5).D = $0;
ReWind(Credit);
i = 0;
InitProgress(NRecords(Credit), "Обработка данных для <8974>", "Кредитные договоры");
WHILE (Next(Credit))
    i = i + 1;
    UseProgress(i);
    IF ((Credit.CurCode == 0) OR (Credit.CurCode == 1))
        ClearRecord(EnsCrd);
        EnsCrd.EnsContractID_Ref = 0;                              
        EnsCrd.CreditNumber_Ref = Credit.CreditNumber;                                                    
        stat = GetGE(EnsCrd);
        while((stat) and (EnsCrd.CreditNumber_Ref == Credit.CreditNumber))
            keyNum(EnsContr, 0);
            ClearRecord(EnsContr);
            EnsContr.EnsContractID = EnsCrd.EnsContractID_Ref;
            stat = GetGE(EnsContr);
            while((stat) and (EnsContr.EnsContractID == EnsCrd.EnsContractID_Ref)
                   and (EnsContr.EnsContractStatus == EC_IN))
                IF (EnsContr.EnsSysType == 2)
                    KeyNum(EnsObj, 1);
                    EnsObj.EnsContractID_Ref = EnsContr.EnsContractID;
                    EnsObj.EnsObjectID = 0;
                    IF (GetGE(EnsObj) AND (EnsObj.EnsContractID_Ref == EnsContr.EnsContractID))
                        Prev(EnsObj);
                        WHILE(Next(EnsObj) AND (EnsObj.EnsContractID_Ref == EnsContr.EnsContractID))
                            IF (EnsObj.EnsTypeID_Ref == 9)
                                Out(3).D = Out(3).D
                                         + round(EnsObj.EnsObjectSum
                                         * GetRate(RepDate, EnsObj.EnsObjectCur));
                            ELIF (EnsObj.EnsTypeID_Ref == 10)
                                Out(4).D = Out(4).D
                                         + round(EnsObj.EnsObjectSum
                                         * GetRate(RepDate, EnsObj.EnsObjectCur));
                            ELIF (EnsObj.EnsTypeID_Ref == 11)
                                Out(5).D = Out(5).D
                                         + round(EnsObj.EnsObjectSum
                                         * GetRate(RepDate, EnsObj.EnsObjectCur));
                            END;
                        END;
                    END;
                END;
                stat = Next(EnsContr);
            end;
            stat = Next(EnsCrd);
        END;
    END;
END;
RemProgress();


Out(6) = GenObject("Data");
Out(6).P = "008975000";
Out(6).D = $0;
ReWind(Credit);
i = 0;
InitProgress(NRecords(Credit), "Обработка данных для <8989>", "Кредитные договоры");
WHILE (Next(Credit))
    i = i + 1;
    UseProgress(i);
    IF ((Credit.CurCode == 0) OR (Credit.CurCode == 1))
        KeyNum(DutyCrd, 1);
        DutyCrd.CreditNumber_Ref = Credit.CreditNumber;
        DutyCrd.DutyType = 0;
        DutyCrd.DutyState = "";
        IF (GetGE(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND (DutyCrd.DutyType == 0))
            Prev(DutyCrd);
            WHILE (Next(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND (DutyCrd.DutyType == 0))
                IF (CheckDate(DutyCrd.DutyFirstDate, DutyCrd.DutyLastDate, 30, _DAY_, 999, _YEAR_) AND
                   (DutyCrd.DutyLastDate > RepDate) AND
                   (DutyCrd.DutyLastDate < (RepDate+31)) AND
                   (DutyCrd.FirstDutyID_Ref == 0))
                    Pos = GetPos(DutyCrd);
                    DutyCrd.CreditNumber_Ref = Credit.CreditNumber;
                    DutyCrd.DutyType = 0;
                    DutyCrd.FirstDutyID_Ref = DutyCrd.DutyID;
                    DutyCrd.DutyNumber = 0;
                    IF (NOT (GetGE(DutyCrd) AND
                            (DutyCrd.DutyType == 0) AND
                            (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND
                            (DutyCrd.FirstDutyID_Ref == DutyCrd.DutyID)))
                        Out(6).D = Out(6).D
                                 + round(ОстатокСО(DutyCrd.DutyID, TDR_MAINREST, RepDate-1)
                                 * GetRate(RepDate, Credit.CurCode));
                    END;
                    GetDirect(DutyCrd, Pos);
                END;
            END;
        END;
    END;
END;
RemProgress();


Out(7) = GenObject("Data");
Out(7).P = "008978000";
Out(7).D = $0;
ReWind(Credit);
i = 0;
InitProgress(NRecords(Credit), "Обработка данных для <8996>", "Кредитные договоры");
WHILE (Next(Credit))
    i = i + 1;
    UseProgress(i);
    IF ((Credit.CurCode == 0) OR (Credit.CurCode == 1))
        KeyNum(DutyCrd, 1);
        DutyCrd.CreditNumber_Ref = Credit.CreditNumber;
        DutyCrd.DutyType = 0;
        DutyCrd.DutyState = "";
        IF (GetGE(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND (DutyCrd.DutyType == 0))
            Prev(DutyCrd);
            WHILE (Next(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND (DutyCrd.DutyType == 0))
                IF (CheckDate(DutyCrd.DutyFirstDate, DutyCrd.DutyLastDate, 1, _YEAR_, 999, _YEAR_) AND
                    (DutyCrd.DutyLastDate >= (RepDate-1)))
                    Out(7).D = Out(7).D
                             + round((ОстатокСО(DutyCrd.DutyID, TDR_MAINREST, RepDate-1)
                                + ОстатокСО(DutyCrd.DutyID, TDR_EXPREST, RepDate-1))
                             * GetRate(RepDate, Credit.CurCode));
                END;
            END;
        END;
    END;
  END;
  RemProgress();

  Out(8) = GenObject("Data");
  Out(8).P = "008989000";
  Out(8).D = $0;

  InitProgress(NRecords(Party), "Обработка данных для <Часть Крз>", "Клиенты");
  ReWind(Party);
  KeyNum(Credit, 6);
  i = 0;
  WHILE (Next(Party));
    i = i + 1;
    UseProgress(i);
    Credit.ClientID_Ref = Party.PartyID;
    Credit.CreditState = "";
    sum = $0;
    IF (GetGE(Credit) AND (Credit.ClientID_Ref == Party.PartyID))
      Prev(Credit);
      WHILE (Next(Credit) AND (Credit.ClientID_Ref == Party.PartyID))
        IF ((Credit.CurCode == 0) OR (Credit.CurCode == 1))
            KeyNum(DutyCrd, 1);
            DutyCrd.CreditNumber_Ref = Credit.CreditNumber;
            DutyCrd.DutyType = 0;
            DutyCrd.DutyState = "";
            IF (GetGE(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND (DutyCrd.DutyType == 0))
                Prev(DutyCrd);
                WHILE (Next(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND (DutyCrd.DutyType == 0))
                    IF (DutyCrd.DutyLastDate >= (RepDate-1))
                        sum = sum + round((ОстатокСО(DutyCrd.DutyID, TDR_MAINREST, RepDate-1)
                             + ОстатокСО(DutyCrd.DutyID, TDR_EXPREST, RepDate-1))
                             * GetRate(RepDate, Credit.CurCode));
                    END;
                END;
            END;
        END;
      END;
    END;
    IF (Out(8).D < sum)
        Out(8).D = sum;
    END;
  END;
  KeyNum(Credit, 0);
  RemProgress();


Out(9) = GenObject("Data");
Out(9).P = "008996000";
Out(9).D = $0;
ReWind(Credit);
i = 0;
InitProgress(NRecords(Credit), "Обработка данных для <Часть Кри>", "Кредитные договоры");
WHILE (Next(Credit))
    i = i + 1;
    UseProgress(i);
    IF (((Credit.CurCode == 0) OR (Credit.CurCode == 1)) AND isInsider(Credit.ClientID_Ref) )
        KeyNum(DutyCrd, 1);
        DutyCrd.CreditNumber_Ref = Credit.CreditNumber;
        DutyCrd.DutyType = 0;
        DutyCrd.DutyState = "";
        IF (GetGE(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND (DutyCrd.DutyType == 0))
            Prev(DutyCrd);
            WHILE (Next(DutyCrd) AND (DutyCrd.CreditNumber_Ref == Credit.CreditNumber) AND (DutyCrd.DutyType == 0))
                IF (DutyCrd.DutyLastDate >= (RepDate-1))
                    Out(9).D = Out(9).D
                             + round((ОстатокСО(DutyCrd.DutyID, TDR_MAINREST, RepDate-1)
                                + ОстатокСО(DutyCrd.DutyID, TDR_EXPREST, RepDate-1))
                             * GetRate(RepDate, Credit.CurCode));
                END;
            END;
        END;
    END;
END;
RemProgress();

ListFDep.FNCash = {ФИЛИАЛ};
GetEQ(ListFDep);


[  ###########
  Расшифровки отдельных балансовых счетов для расчета обязательных нормативов
                                 на ##########
+---------------+----------------------------------------------+---------------+
|Код обозначения|               Краткое описание               |Сумма, тыс.руб.|
+---------------+----------------------------------------------+---------------+
| 8913          |Ссуды, выданные банком,  по которым надлежащее|               |
|               |исполнение обязательств заемщика обеспечено   |               |
|               |поручительствами органов государственной      |               |
|               |власти субъектов Российской Федерации в части,|               |
|               |равной отвественности указанного органа власти|               |
|               |по поручительству, части счетов: 443А, 444А,  |               |
|               |445А, 446А, 447А, 448А, 449А, 450А, 451А,     |               |
|               |452А, 453А, 454А, 456А, 462А, 463А, 464А,     |               |
|               |465А, 466А, 467А, 468А, 469А, 470А, 471А,     |               |
|               |472А, 473А                                    |               |
+---------------+----------------------------------------------+---------------+
| 8914          |Синдицированные и аналогичные им суммы в      |               |
|               |части, равной величине предоставленных банку  |               |
|               |третьими лицами средств, в части счетов:      |               |
|               |441А, 442А, 443А, 444А, 445А, 446А, 447А,     |               |
|               |448А, 449А, 450А, 451А, 452А, 453А, 454А,     |               |
|               |455А, 456А, 457А, 460А, 461А, 462А, 463А,     |               |
|               |464А, 465А, 466А, 467А, 468А, 469А, 470А,     |               |
|               |471А, 472А, 473А, 40109А                      |               |
+---------------+----------------------------------------------+---------------+
| 8924          |Резерв на возможные потери по ссудам,         |               |
|               |отнесенные ко 2-4 группам риска, в части      |               |
|               |сформированной под кредиты, гарантии и        |               |
|               |поручительства, предоставленных банком своим  |               |
|               |участникам (акционерам) и инсайдерам сверх    |               |
|               |лимитов, установленных нормативами H9, H9.1,  |               |
|               |H10, H10.1 и отраженных по коду 8948          |               |
|               |Примечание: расчет невозможен, см. 8948       |               |
+---------------+----------------------------------------------+---------------+
| Часть 8925    |Совокупная величина кредитов и займов,        |###############|
|               |предоставленных своим инсайдерам, а также     |               |
|               |гарантий и поручительств, выданных в их       |               |
|               |пользу                                        |               |
+---------------+----------------------------------------------+---------------+
| 8948          |Кредиты, гарантии и поручительства,           |               |
|               |предоставленные банком своим участникам       |               |
|               |(акционерам) и инсайдерам сверх лимитов,      |               |
|               |установленных нормативами H9, H9.1, H10, H10.1|               |
|               |Примечание: лимит, утановленный указанными    |               |
|               |нормативами представляет собой допустимое     |               |
|               |процентное отношение величин Крз, Кра, Кри к  |               |
|               |капиталу банка                                |               |
+---------------+----------------------------------------------+---------------+
| часть 8949    |Величина недосозданных резервов на возможные  |###############|
|               |потери по ссудам (разница между расчетной     |               |
|               |величиной резервов, требуемой нормативными    |               |
|               |документами Банка России, и фактической суммой|               |
|               |резервов), за исключением суммы недосозданного|               |
|               |резерва на величиу кредитов, отраженных по    |               |
|               |коду 8948 (включая суммы, невзысканные банком |               |
|               |по своим гарантиям)                           |               |
+---------------+----------------------------------------------+---------------+
| 8959          |Ссуды клиентам, предоставленные банками со    |               |
|               |100%-ным участием иностранных инвестиций под  |               |
|               |гарантии, полученнные от материнских банков   |               |
|               |стран из числа "группы развитых стран", в     |               |
|               |части, под которую получены гарантии          |               |
+---------------+----------------------------------------------+---------------+
| 8968          |Резервы на возможные потери по ссудам в части,|###############|
|               |сформированной под ссуды 1-й группы риска,    |               |
|               |часть счетов 20321, 32015, 32115, 32211,      |               |
|               |32311, 32403, 44115, 44215, 44315, 44415,     |               |
|               |44515, 44615, 44715, 44815, 44915, 45015,     |               |
|               |45115, 45215, 45315, 45415, 45515, 45615,     |               |
|               |45715, 45815, 46008, 46108, 46208, 46308,     |               |
|               |46408, 46508, 46608, 46708, 46808, 46908,     |               |
|               |47008, 47108, 47208, 47308, 47425 (только в   |               |
|               |отношении задолженности, учитываемой на счете |               |
|               |47402, а также в части резерва,               |               |
|               |сформированного в соответствии с Указанием    |               |
|               |Банка Росии от 14.07.98 №290-У), 51210, 51310,|               |
|               |51410, 51510, 51610, 51710, 51810, 51910,     |               |
|               |60324 (только в отношении задолженности,      |               |
|               |указываемой на счете 60315)                   |               |
+---------------+----------------------------------------------+---------------+
| 8973          |Ссуды, гарантированные Правительством РФ, в   |               |
|               |части, под которую получены гарантии          |               |
+---------------+----------------------------------------------+---------------+
| 8974          |Ссуды под залог государственных ценных бумаг  |###############|
|               |Российской Федерации в части, равной рыночной |               |
|               |стоимости указанных бумаг                     |               |
+---------------+----------------------------------------------+---------------+
| 8975          |Ссуды под залог драгоценных металлов в слитках|###############|
|               |в части, равной их рыночной стоимости         |               |
+---------------+----------------------------------------------+---------------+
| 8978          |Ссуды под залог ценных бумаг субъектов        |###############|
|               |Российской Федерации и местных органов        |               |
|               |самоуправления в части, равно рыночной        |               |
|               |стоимости указанных бумаг                     |               |
+---------------+----------------------------------------------+---------------+
| часть 8989    |Требования банка сроком погашения в течение   |###############|
|               |ближайших 30 календарных дней, за исключением |               |
|               |сумм, на которые наложен арест:               |               |
|               |*кредиты заемщикам (исключая пролонгированные |               |
|               |хотя бы один раз и выданные в погашение ранее |               |
|               |выданных ссуд), части счетов 40308, 44104...  |               |
|               |44108, 44205... 44209, 44305... 44409,        |               |
|               |44504...44508, 44604...44608, 44704...44708,  |               |
|               |44804...44808, 44904...44908, 45004...45008,  |               |
|               |45104...45108, 45204...45208, 45304...45308,  |               |
|               |45404...45308, 45404...45408, 45503...45507,  |               |
|               |45602...45606, 45702...45706, 46003...46007,  |               |
|               |46103...46107, 46203...46207, 46303...46307,  |               |
|               |46403...46407, 46503...46507, 46603...46607,  |               |
|               |46703...46707, 46803...46807, 46903...46907,  |               |
|               |47003...47007, 47103...47107, 47203...47207,  |               |
|               |47303...47307;                                |               |
|               |*кредиты, предоставленные при недостатке      |               |
|               |средств на корреспондентском, расчетном       |               |
|               |(текущем) счете ("овердрафт"), числящиеся на  |               |
|               |балансе менее 30 календарных дней или сроком  |               |
|               |погашения в соответствии с договором в        |               |
|               |ближайшие 30 календарных дней, части счетов   |               |
|               |32001, 32101, 44201, 44301, 44401, 44501,     |               |
|               |44601, 44701, 44801, 44901, 45001, 45101,     |               |
|               |45201, 45301, 45401, 45608                    |               |
+---------------+----------------------------------------------+---------------+
| часть 8996    |Кредиты и депозиты сроком погашения свыше     |###############|
|               |года, включая просроченные, части счетов      |               |
|               |32008, 32009, 32108, 32109, 32208, 32209,     |               |
|               |32308, 32309, 32401, 32402, 44107, 44108,     |               |
|               |44208, 44209, 44308, 44309, 44408, 44409,     |               |
|               |44507, 44508, 44607, 44608, 44707, 44708,     |               |
|               |44807, 44808, 44907, 44908, 45007, 45008,     |               |
|               |45107, 45108, 45207, 45208, 45307, 45308,     |               |
|               |45407, 45408, 45506, 45507, 45605, 45606,     |               |
|               |45705, 45706, 458А (в части просроченных ссуд,|               |
|               |предоставленных на срок свыше года), 46006,   |               |
|               |46007, 46106, 46107, 46206, 46207, 46306,     |               |
|               |46307, 46406, 46407, 46506, 46507, 46606,     |               |
|               |46607, 46706, 46707, 46806, 46807, 46906,     |               |
|               |46907, 47006, 47007, 47106, 47107, 47206,     |               |
|               |47207, за исключением долгосрочных ссуд,      |               |
|               |отраженных по кодам 8973, 8974, 8975, 8978.   |               |
+---------------+----------------------------------------------+---------------+
| 8950          |Кредиты и прочие размещенные средства до      |               |
|               |востребования, исполнение обязательств по     |               |
|               |которым в соответствии с договором            |               |
|               |предусмотренно не позднее чем на следующий    |               |
|               |день после дня востребования, части счетов:   |               |
|               |32010, 32110, 45109, 45309, 45409, 45508,     |               |
|               |45607, 45707, 47001, 47101, 47201, 47301.     |               |
+---------------+----------------------------------------------+---------------+
| 8951          |Кредиты и прочие размещенные средства до      |               |
|               |востребования, исполнение обязательств по     |               |
|               |которым в соответствии с договором            |               |
|               |предусмотренно не позднее чем через 30        |               |
|               |календарных дней после дня востребования,     |               |
|               |части счетов: 32010, 32110, 45109, 45309,     |               |
|               |45409, 45508, 45607, 45707, 47001, 47101,     |               |
|               |47201, 47301.                                 |               |
+---------------+----------------------------------------------+---------------+
| часть Крз     |Совокупная сумма требований банка к заемщику  |###############|
|               |или группе взаимосвязанных заемщиков.         |               |
+---------------+----------------------------------------------+---------------+
| часть Кра     |Значение показателя Крз в отношении тех       |               |
|               |акционеров (участников), вклад которых в      |               |
|               |уставной капитал превышает 5% от его          |               |
|               |зарегистрированной Банком России величины.    |               |
+---------------+----------------------------------------------+---------------+
| часть Кри     |Совокупная сумма требований банка (включая    |###############|
|               |забалансовые), взвешенные с учетом риска, в   |               |
|               |отношении инсайдера банка и связанных с ним   |               |
|               |лиц.                                          |               |
+---------------+----------------------------------------------+---------------+
]
(ListFDep.NameBranch,
 RepDate,
 Out(0).D/1000:r:15:2,
 Out(1).D/1000:r:15:2,
 Out(2).D/1000:r:15:2,
 Out(3).D/1000:r:15:2,
 Out(4).D/1000:r:15:2,
 Out(5).D/1000:r:15:2,
 Out(6).D/1000:r:15:2,
 Out(7).D/1000:r:15:2,
 Out(8).D/1000:r:15:2,
 Out(9).D/1000:r:15:2);

IF (Open(RepA, NameFile + FN))
    ReWind(RepA);
    Next(RepA);
    Next(RepA);
    WHILE (Next(RepA))
        i = Index(RepA.str, "=");
        c = 0;
        fb = false;
        WHILE ((c < Out.size) and (not fb))
            IF (Out(c).P == SubStr(RepA.str, 1, i-1))
                fb = true;
            END;
            c = c + 1;
        END;
        IF (not fb)
            Out(Out.size) = GenObject("Data");
            Out(Out.size-1).P = SubStr(RepA.str, 1, i-1);
            Out(Out.size-1).D = MoneyL(SubStr(RepA.str, i+1));
        END;
    END;
    Close(RepA);
END;

IF (Open(Rep, NameFile + FN))

    Rep.str = "";
    i = 0;
    WHILE (i < 100)
        Rep.str = Rep.str + " ";
        i = i + 1;
    END;
    Insert(Rep);

    i = c = 0;
    WHILE (i < Out.size)
        IF (Out(i).D != 0)
            c = c + 1;
        END;
        i = i + 1;
    END;

    Rep.str = OutShem + "=" + ListFDep.NameBranch + "=";
    DateSplit(RepDate, day, mon, year);
    Rep.str = Rep.str + string(day:2:o)+string(mon:2:o)+SubStr(string(year), 2, 3)+"1=";
    DateSplit(RepDate-1, day, mon, year);
    Rep.str = Rep.str + string(day:2:o)+string(mon:2:o)+SubStr(string(year), 2, 3)+"2=";
    DateSplit(RepDate-1, day, mon, year);
    Rep.str = Rep.str + string(day:2:o)+string(mon:2:o)+SubStr(string(year), 2, 3)+"3=";
    DateSplit(date(), day, mon, year);
    Rep.str = Rep.str + string(day:2:o)+string(mon:2:o)+SubStr(string(year), 2, 3)+"4=";
    TimeSplit(time(), day, mon, year);
    Rep.str = Rep.str + string(day:2:o)+string(mon:2:o)+"="+string(c:9:o)+"="+FN;
    Insert(Rep);
    // 3-я строка - пустая
    Rep.str = "";
    Insert(Rep);

    i = 0;
    WHILE (i < Out.size)
        IF (Out(i).D != 0)
            Rep.str = Out(i).P+"="+string(Out(i).D);
            Insert(Rep);
        END;
        i = i + 1;
    END;

    Close(Rep);
   END;