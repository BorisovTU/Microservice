/*---------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : duerur1.mac
 Description : Создание документа по шагу операции (зачисление рублей на счет)

 Programmer  : PA
 24.11.99    : Создан
-----------------------------------------------------------------------------------*/
import SbCrdInter, macperc;

record ШагОперации ("step_op.dbt",  "loans.def");     /* Запись шага операции */
record Документ    ("doc_acc.dbt",  "loans.def");     /* Буфер документа      */
record Операция    ("crd_op.dbt",   "loans.def");     /* Операция по договору */
record Договор     ("credit_c.dbt", "loans.def");

MACRO ВыполнитьШаг (OperDate, Sum, Data)

VAR stat  : integer = 0,
    DocID : integer = 0;
  Документ.CarrySum = GetPaySum(DS_DEBITSELLS, Операция.ObjectTypeID_Ref, Операция.ObjectID_Ref);
  stat = СоздатьДокумент(Документ, DocID);
  IF (stat == 0)
      stat = ИзменитьРегистр(LO_CREDIT, Договор.CreditNumber, TDR_DEBSELL, DocID, -Документ.CarrySum);
  END;
  RETURN stat;
END;
