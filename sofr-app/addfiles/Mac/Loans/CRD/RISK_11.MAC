/*---------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : risk_11.mac
 Description : Создание документа по шагу операции (изменение группы риска)
 Programmer  : ROV
 17.02.99    : Создан
-----------------------------------------------------------------------------------*/
import SbCrdInter, macperc, total;

record ШагОперации ("step_op.dbt",  "loans.def");
record Документ    ("doc_acc.dbt",  "loans.def");
record Операция    ("crd_op.dbt",   "loans.def");
record Договор     ("credit_c.dbt", "loans.def");
record RghData     ("rghdata.tmp",  "loans.def");

macro ВыполнитьШаг (OperDate, Sum, Data)
   var stat = 0, DocID = 0;
   var Sperc = $0, Snperc = $0, Sgar = $0;

   SetBuff(RghData, Data);

   if (NOT ((NOT ReliableKKS(RghData.OldRiskGroup)) and (ReliableKKS(RghData.NewRiskGroup))))
      return 0; end;

   Sperc  = GetPaySumWithSO (DS_PERC, Операция.ObjectTypeID_Ref, Операция.ObjectID_Ref);
   Snperc = GetPaySumWithSO (DS_NOOVCRDPERCENT, Операция.ObjectTypeID_Ref, Операция.ObjectID_Ref);
   Sgar   = GetPaySum (DS_PAYMGUARPERCENT, Операция.ObjectTypeID_Ref, Операция.ObjectID_Ref);

   Документ.CarrySum = Sperc + Snperc + Sgar;
   stat = СоздатьДокумент(Документ, DocID);
   
   return stat;
end;
