/*---------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : risksum.mac
 Description : макрос вызова ХП формирования и расчета разноски в операции Изменения ККС

 Programmer  :
 14.11.2007  : Создан
 05.12.2012  : Изменен
-----------------------------------------------------------------------------------*/
import "total.mac", SbCrdInter;

var OldRiskGr = -1, NewRiskGr = -1;

macro FillFile (
   PercType    : integer,
   ObjID       : integer,
   ObjN        : integer,
   OpDate      : date,
   CalcPerc    : string
)
   var fCalcPerc: integer = 0;
   var RSDcmd = null;

   if (CalcPerc == "X") fCalcPerc = 1;
   else fCalcPerc = 0; end;

   RSDcmd = RsdCommand(RslDefCon, "begin LoansFillPayment.FillPaymentForRiskOp (?, ?, ?, ?, ?); end;");

   RSDcmd.addParam("typeop",   RSDBP_IN); RSDcmd.value("TypeOp")   = PercType;
   RSDcmd.addParam("objid",    RSDBP_IN); RSDcmd.value("ObjID")    = ObjID;
   RSDcmd.addParam("objn",     RSDBP_IN); RSDcmd.value("ObjN")     = ObjN;
   RSDcmd.addParam("opdate",   RSDBP_IN); RSDcmd.value("OpDate")   = OpDate;
   RSDcmd.addParam("CalcPerc", RSDBP_IN); RSDcmd.value("CalcPerc") = fCalcPerc;

   RSDcmd.execute();
   RSDcmd = null;

   return true;
end;

macro CalcRest (OpDate:date, ObjN:integer, HiddenProgress:integer)
   var RSDcmd;
   
   RSDcmd = RsdCommand(RslDefCon, "BEGIN LoansFillPayment.CalcRiskSum (?,?,?,?); END;");

   RSDcmd.addParam("opdate",       RSDBP_IN); RSDcmd.value("opdate")       = OpDate;
   RSDcmd.addParam("objn",         RSDBP_IN); RSDcmd.value("objn")         = ObjN;
   RSDcmd.addParam("oldriskgr",    RSDBP_IN); RSDcmd.value("oldriskgr")    = OldRiskGr;
   RSDcmd.addParam("newriskgr",    RSDBP_IN); RSDcmd.value("newriskgr")    = NewRiskGr;

   RSDcmd.execute();
   RSDcmd = null;
end;
