import "sbcrdnum.mac";

macro ОбработкаШаблона(buff, Template, ObjectNumber, FromClaim)
   if (ValType(FromClaim) == V_UNDEF)
      FromClaim = false;
   end;
   
   SetBuff(С_Обеспечение, buff);
  
   if (FromClaim == false)
      if(ObjectNumber !=0)
      
         Ф_Договор.CreditNumber = ObjectNumber;

         if (GetEQ(Ф_Договор))
            Copy(С_Договор, Ф_Договор);
         else
            MsgBox("Не найден кредитный договор ID = ", ObjectNumber);
            return;
         end;
      end;
   else
      Ф_Заявка.ClaimID = ObjectNumber;

      if (GetEQ(Ф_Заявка))
         Copy(С_Заявка, Ф_Заявка);
      else
         MsgBox("Не найдена заявка ID = ", ObjectNumber);
         return;
      end;
   end;

   if (С_Обеспечение.EnsSysType == 0)
      MsgBox("Не задан вид обеспечения");
      return;
   end;

   С_Обеспечение.EnsContractNumber = СтрокаПоШаблону(Template, LO_ENSCONTR, FromClaim);
end;
