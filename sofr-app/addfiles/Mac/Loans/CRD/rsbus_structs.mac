/*
$Name: rsbus_structs.mac
$Module: Кредитование
$Description: Содержит описание структур данных, используемых в комплекте сервисов RS-Bus
*/
/*------------------------------------------------------------------------------
                            Вспомогательный макрос  RS-Bus
 Programmer  : Melnik Andrey
 06.03.12    : Создан
------------------------------------------------------------------------------*/
import total, rsbus_check;
private const РАСЧЕТНЫЙ_СЧЕТ = 4;
private const ФИЗ_ЛИЦО = 2;
private var parm;


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//класс для хранения параметров банка
class TBank(pBankID, pBankCodeKind, pBankCode, pBankName)   
   var BankID:integer       =pBankID,                      //ID субъекта
    BankCodeKind:integer       =pBankCodeKind,              //Вид кода Банка. По умолчанию = 3 (БИК ЦБ РФ)
    BankCodeKindName:string = NULL,
    BankCode:string         =pBankCode,                   //Код Банка. Если не передан, заполняется по Банку BankID, если он передан.
    BankName:string        =pBankName;  //Наименование Банка. Если не передан, заполняется по Банку BankID, если он передан.
   if (ValType(BankCodeKind) == V_UNDEF)
      BankCodeKind = 3;
   end;

   if (ValType(BankCodeKindName) == V_UNDEF)
      BankCodeKindName = LnSelectValue("SELECT T_SHORTNAME FROM DOBJKCODE_DBT WHERE T_OBJECTTYPE = 3" +
                                        " AND T_CODEKIND = " + BankCodeKind,
                                        V_STRING);
   end;
 // проверки переданных значений. ТОЛЬКО ДЛЯ переданных извне, не применимо для считанных из базы!
   macro CheckVals
      var party;
      party = SubjectCheck(BankID);
      if ( (ValType(BankID) != V_UNDEF) AND (NOT SKIP_BANKID_CHECK) )
         if ( (ValType( party ) == V_UNDEF) OR (NOT party.IsOwned(PTK_BANK)) )
            RunError("Код Банка задан неверно", 18574 );
         end;   
         if (ValType(BankCode) == V_UNDEF) 
            BankCode = FindBankCodeByCodeKind(BankID, BankCodeKind);
         end;
         if (ValType(BankName) == V_UNDEF)
            BankName = party.FullName;
         end;
      end;
   end;

end;

/////////////////////////////////////////////////
//Класс для хранения номера счета вместе с главой
CLASS CLnsMaskedAccount
    VAR Account : String;
    VAR Chapter : String;
    
    this.Account = "";
    this.Chapter = "";
END;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 //класс для хранения СПИ
class TSetAccount(pType, pAccountNumber, pAccountCurCode, pClientID, pClientINN, pClientName, pDepartment, pBank, pBankCorr, pChapter) 
   var Type:integer          = pType,            //Тип счета другой подсистемы. По умолчанию, если не передан = $(Расчетный счет).
    AccountNumber:CLnsMaskedAccount = CLnsMaskedAccount(),    //Номер счета.
    AccountCurCode:integer   = pAccountCurCode,   //Валюта счета. Передается код ФИ.
    ClientID:integer         = pClientID,         //Клиент счета.
    ClientINN:string         = pClientINN,        //ИНН клиента
    ClientName:string        = pClientName,       //ФИО клиента
    Department:integer       = pDepartment,       //Филиал. Если передан, то банк заполняется по нему.
    Bank:TBank,                                   //Банк, в котором открыт счет.Заполняется по Банку привязанному к Филиалу, если Department передан
    BankCorr:TBank;                               //Банк-посредник
    
    AccountNumber.Account = pAccountNumber;
    AccountNumber.Chapter = pChapter;
    
    if (pBank)
       Bank = TBank(pBank.BankID,pBank.BankCodeKind, pBank.BankCode, pBank.BankName);
    end;
    if (pBankCorr)
       BankCorr = TBank(pBankCorr.BankID, pBankCorr.BankCodeKind, pBankCorr.BankCode, pBankCorr.BankName);
    end;

//макрос выполняет необходимые проверки для полей класса, выбрасывая ошибку в случае несоответствия переданных параметров требованиям, и дозаполняя по возможности незаполненные поля. 
//ТОЛЬКО ДЛЯ переданных извне, не применимо для считанных из базы!
   macro CheckVals(credContr/*record(credit_c)*/)
      var err:integer;
      var party;
      record  igTypAcc(igtypacc);
      //переданный номер счета
      if(ValType(AccountNumber) == V_UNDEF)
         RunError("Не задан счет", 18571);
      end;
      //валюта
      if ( (ValType(AccountCurCode) != V_UNDEF) AND (NOT SKIP_CURRENCY_CHECK) )
         AccountCurCode = getCurISOl(AccountCurCode, err);
         if (err)
            RunError("Валюта задана некорректно", err);
         end;
      else
        AccountCurCode = credContr.CurCode;
      end;
      //тип счета 
      if ( (ValType(Type) != V_UNDEF) AND (NOT SKIP_ACCOUNT_TYPE_CHECK) )
      if ( NOT AccTypeCheck(Type, igTypAcc) )
         RunError("Неверно задан тип счета", 18572);
      end;
      else
         Type = РАСЧЕТНЫЙ_СЧЕТ;   
      end;
      //субьект
      if ( (ValType(ClientID) != V_UNDEF) AND (NOT SKIP_CLIENT_CHECK) )
         if ( (ValType( party = SubjectCheck(ClientID) ) == V_UNDEF) OR (party.LegalForm != ФИЗ_ЛИЦО) )
            RunError("Клиент не зарегистрирован", 18501);
         else
            //INN
            if ((ValType(ClientINN) == V_UNDEF)OR(ClientName == ""))
               ClientINN = party.Code(PTCK_INN);
            end;
             //ClienName
         if ((ValType(ClientName) == V_UNDEF) OR (ClientName == ""))
         ClientName = party.FullName;
         end;   
         end;
      else
      ClientID = credContr.ClientID_REF;
      var partyType = ValType(party=SubjectCheck(ClientID));
      //INN
      if ( ((ValType(ClientINN) == V_UNDEF)OR(ClientName == "")) AND (partyType != V_UNDEF) )
         ClientINN = party.Code(PTCK_INN);
     end;
      //ClienName
      if ( ((ValType(ClientName) == V_UNDEF) OR (ClientName == "")) AND (partyType != V_UNDEF) )
         ClientName = party.FullName;
      end;
      end;
      //филиал
      if (ValType(Department) != V_UNDEF)
      if (NOT SKIP_DEPARTMENT_CHECK)
            if ( NOT DepartmentCheck(Department) )
            RunError("Неверно задан филиал", 18573);
         end;
      end;
         //банк заполняется по значению филиала
      Bank=TBank(GetPartyIDByDepart(Department),null,null,null);
      Bank.CheckVals;
      else
         //выполняем проверки для переданных значения Bank
      if ( ValType(Bank) != V_UNDEF )   
            Bank.CheckVals;
      else
         Bank = TBank(null,null,null,null);
      end;
      end;

      //банк посредник
      if ( (ValType(BankCorr) != V_UNDEF) AND (ValType(BankCorr.BankID) == V_INTEGER) )
          BankCorr.CheckVals;
      end;
   end;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Класс, содежращий детальную информацию о задолженности клиента
class TDeptDetail(pDutyStageID, pDutyStageName, pGrupDebtsId, pGrupDebtsName, pDeptGroupSUM);   
   var DutyStageId:integer      = pDutyStageId,         //Id вида задолженности КД  
    DutyStageName:string        = pDutyStageName,              //Наименование вида задолженности КД 
    GrupDebtsId:integer     = pGrupDebtsId,            //Id группы задолженности КД 
    GrupDebtsName:string        = pGrupDebtsName,              //Наименование группы задолженности КД
    DeptGroupSUM:money      = pDeptGroupSUM;               //Рассчитанная сумма 
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//общая структура задолженности
class TDept
   var  TotalSum:money,                             //Общая сумма задолженности
    CurCode:string,                                 //Валюта договора
   DeptDetail:TArray = TArray(TDeptDetail),         //Детализация задолженности клиента - Массив задолженностей.
   MainRest:money;                                 //Остаток основного долга по договору
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class TLoansAccount
   var AccCategID       :integer;   //Категория учета (КУ) счета Лоанс.
   var AccountNumber    :string;    //Номер счета Loans.
   var CurCode          :string;    //Валюта счета Loans. 
   var ODBAccountNumber :string;    //Номер счета ОДБ
   var ODBCurCode       :string;    //Валюта счета ОДБ.
   //инициализация полей класса, в случае, если переданы
   if((getparm(1, parm))AND(ValType(parm) == V_INTEGER))
      AccCategID = parm;
   end;
   if(getparm(2, parm))
      AccountNumber = parm;
   end;   
   if(getparm(3, parm))
      CurCode = parm;
   end;   
   if(getparm(4, parm))
      ODBAccountNumber = parm;
   end;   
   if(getparm(5, parm))
      ODBCurCode = parm;
   end;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class (TLoansAccount)TLoansAccountEx(pAccCategID, pAccountNumber, pCurCode, pODBAccountNumber, pODBCurCode, pAccCategName);
   var AccCategName:string;     //Наименование категории учета (КУ) счета Лоанс по справочнику taccred.dbt
   //инициализация полей класса
   InitTLoansAccount(pAccCategID, pAccountNumber, pCurCode, pODBAccountNumber, pODBCurCode);
   AccCategName = pAccCategName;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class TComissPay(pPayDate, pExpDate, pComissSum)
   var payDate:date,        //Дата платежа (planpay.PlannedPayDate).
    expDate:date,       //Дата просрочки (planpay.PlannedExpDate).Если дата не передана, то она будет равна дате payDate
    comissSum:money;       //Сумма комиссии (planpay.PlannedPercentSum). 
   //инициализация полей класса
      payDate = pPayDate;
      if (ValType(pExpDate) == V_UNDEF)
         expDate = payDate;
      else
      expDate = pExpDate;
      end;
      comissSum = pComissSum;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class TPay(pPayDate, pExpDate, pPaySum, pPercentSum)
   var payDate:date,            //Дата платежа (planpay.PlannedPayDate).
    expDate:date,                //Дата просрочки (planpay.PlannedExpDate).
    paySum:money,                //Сумма основного долга (planpay.PlannedPaySum).
    percentSum:money;            //Сумма процентов (planpay.PlannedPercentSum).
   //инициализация полей класса
       payDate  = pPayDate;
    expDate = pExpDate;
    paySum        = pPaySum;
    percentSum  = pPercentSum;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class TComiss
   var type:integer,                             //Тип комиссии 
    sum:money,                                    //Сумма комиссии.  Поле заполняется в случае, если сумма комиссии всегда остается неизменной и даты платежей по комиссии такие же как и даты основного графика платежей. 
    comissPay:TArray = TArray(TComissPay);    //График платежей по комиссии
    //метод инициализации полей класса
    macro InitComiss(pType, pSum, pComissPay);
    type = pType;
    sum  = pSum;
    comissPay = pComissPay;
    end;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class (TSetAccount)TSetAccountEx(pType, pAccountNumber, pAccountCurCode, pClientID, pClientINN, pClientName, pDepartment, pBank, pBankCorr, pTypeName, pRest, pChapter)
                                
   var TypeName:string, //Наименование типа счета другой подсистемы по справочнику igtypacc.dbt
   Rest:Money; //Остаток счета
   // инициализация полей класса
   InitTSetAccount(pType, pAccountNumber, pAccountCurCode, pClientID, pClientINN, pClientName, pDepartment, pBank, pBankCorr, pChapter);
   TypeName = pTypeName;
   Rest = pRest;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//документ, удостоверяющий личность
class TPersonIdentity(pDocCode, pSeries, pNumber, pIssuedDate, pIssuer, pIssuerCode)
   var docCode:string,      //Код вида документа по справочнику parpkind.dbt.
        series:string,            //Серия 
        number:string,            //Номер   
       issuedDate:date,     //Дата выдачи
       issuer:string,             //Наименование выдавшей организации
        issuerCode:string;      //Код подразделения выдавшей организации
   // инициализация полей класса
   DocCode     = pDocCode;
   Series       = pSeries;
   Number       = pNumber;
   IssuedDate   = pIssuedDate;
   Issuer       = pIssuer;
   IssuerCode   = pIssuerCode;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//данные клиента - физ.лица
class TPerson(pPersonID, pSecondName, pFirstName, pMiddleName, pBornDate, pPersonDoc)
   var personID:integer,            //ID субъекта по справочнику субъектов экономики. 
       secondName:string,           //Фамилия
       firstName:string,                //Имя
       middleName:string,           //Отчество
       bornDate:date,                    //Дата рождения
       personDoc;       //документ, удостоверяющий личность
   // инициализация полей класса
   PersonID      = pPersonID;
   SecondName  = pSecondName;
   FirstName   = pFirstName;
   MiddleName  = pMiddleName;
   BornDate    = pBornDate;
   PersonDoc   = pPersonDoc;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//базовый класс, содержит общие данные по КД
class TCreditContrGetBase  
   var ID:integer,             //ID кредитного договора
    number:string,              //Номер КД.
    creditType:integer,        //ID вида кредита по справочнику Видов кредитов type_crd.dbt.
    creditTypeName:string,     //Наименование вида кредита creditType.
    regDate:date,              //Дата начала действия КД 
    returnDate:date,           //Дата окончания действия КД.
   closeDate:date,            //Дата фактического закрытия КД. Заполняется только для КД со статусом <Закрыт> датой последней операции закрытия договора.
    territorialStruct:integer,  //Подразделение ТС по справочнику ТС (dp_dep.Code)
    userType:string,            //Список пользовательских видов кредита в виде строки идентифицирующих их символов подряд друг за другом без разделителей между символами.
    privilege:bool,           //Признак льготного кредита 
    specific:string,            //Целевые назначения по справочнику <Целевые назначения>.
    sum:money,                 //Сумма кредита.
    currency:string,            //Числовой код по ISO для валюты КД. 
    annuit:bool,                  //Аннуитентный платеж?
    indClassification:bool,    //Индивидуальная классификация ссуды?
   curRate:double,            //Значение ставки по основному долгу по КД, действующее на дату текущего операционного дня.
    pay:TArray = TArray(TPay), //Список платежей по кредиту (основному  долгу и проценты). 
    comiss:TArray = TArray(TComiss),    //Список комиссий поf
    account:TArray = TArray(TLoansAccountEx),   //Счета по КД
    setAccount:TArray = TArray(TSetAccountEx),//СПИ по КД.
    FirstNonRepaymExpDate:date, //Наименьшая дата операции просрочки ОД 
    AvailableLimit:money;//Остаток доступного лимита
   // инициализация полей класса
   macro InitBaseVals(pID, pNumber, pCreditType, pCreditTypeName, pRegDate, pReturnDate, pTerritorialStruct, pUserType, pPrivilege, pSpecific, pSum, 
                  pCurrency, pBeforeDutyIsInd, pFineCondIsInd, pAnnuit, pIndClassification, pPay, pComiss, pAccount, pSetAccount)
      ID              = pID;
      Number           = pNumber;
      CreditType       = pCreditType;
      CreditTypeName   = pCreditTypeName;
      RegDate           = pRegDate;
      ReturnDate       = pReturnDate;
      TerritorialStruct= pTerritorialStruct;
      UserType        = pUserType;
      Privilege       = pPrivilege;
      Specific        = pSpecific;
      Sum             = pSum;
      Currency        = pCurrency;
      Annuit          = pAnnuit;
      IndClassification= pIndClassification;
      Pay             = pPay;
      Comiss          = pComiss;
      Account         = pAccount;
      SetAccount          = pSetAccount;
   end;

end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class (TCreditContrGetBase) TCreditContrGet
   var clientID:integer;    //ID заемщика по справочнику субъектов экономики
   // инициализация полей класса
    InitTCreditContrGetBase;
   macro InitVals(pID, pNumber, pCreditType, pCreditTypeName, pRegDate, pReturnDate, pTerritorialStruct, pUserType, pPrivilege, 
                             pSpecific, pSum, pCurrency, pBeforeDutyIsInd, pFineCondIsInd, pAnnuit, pIndClassification, pPay, pComiss, 
                             pAccount, pSetAccount, pClientID)
      InitBaseVals(pID, pNumber, pCreditType, pCreditTypeName, pRegDate, pReturnDate, pTerritorialStruct, pUserType, pPrivilege, pSpecific, pSum, 
                  pCurrency, pBeforeDutyIsInd, pFineCondIsInd, pAnnuit, pIndClassification, pPay, pComiss, pAccount, pSetAccount); 
      clientID = pClientID;
   end;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class (TCreditContrGetBase) TCreditContrGetEx
   var client:TPerson,      //Заемщик по справочнику субъектов экономики. 
    groupNum:integer,          //Номер бухгалтерской группы по справочнику групп пользователей 
    repDate:date,             //Дата предоставления отчета
    userField1:string,      //Примечание 1 
    userField2:string;      //Примечание 2
   // инициализация полей класса
    InitTCreditContrGetBase;
   macro InitVals(pID, pNumber, pCreditType, pCreditTypeName, pRegDate, pReturnDate, pTerritorialStruct, pUserType, pPrivilege,
                           pSpecific, pSum, pCurrency, pBeforeDutyIsInd, pFineCondIsInd, pAnnuit, pIndClassification, pPay, pComiss, 
                           pAccount, pSetAccount, pClient, pGroupNum, pRepDate, pDutyPriory, pUserField1, pUserField2)
      InitBaseVals(pID, pNumber, pCreditType, pCreditTypeName, pRegDate, pReturnDate, pTerritorialStruct, pUserType, pPrivilege, pSpecific, pSum, 
                  pCurrency, pBeforeDutyIsInd, pFineCondIsInd, pAnnuit, pIndClassification, pPay, pComiss, pAccount, pSetAccount); 
      client       = pClient;
      groupNum     = pGroupNum;
      repDate      = pRepDate;
      userField1   = pUserField1;
      userField2   = pUserField2;
   end;

end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class TEnsObjReqInfo(pEnsObjectID, pEnsObjectName)
   var EnsObjectID:integer,    //Уникальный Id объекта обеспечения (densobj_dbt.t_EnsObjectID). Если не задан, для идентификации предмета залога используется EnsObjectName
       EnsObjectName:string;   //Название объекта обеспечения.
   EnsObjectName = pEnsObjectName;
   EnsObjectID = pEnsObjectID;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class TUsFieldCh
   var fieldType:integer,     //Идентификатор пользовательского поля (dlufield_dbt.t_usFieldID) 
       fieldValue:string,     //Значение пользовательского поля (dlufvalue_dbt.t_usFieldValue).
       fieldDate:date,        //Дата установки значения (dlufvalue_dbt.t_usFieldValDate).
       isDelete:bool;         //Признак удаления значения поля.   
   if ((getparm(1,parm))AND(ValType(parm) == V_INTEGER))
      fieldType     = parm;
   end;
   if (getparm(2,parm))
      fieldValue    = parm;
   end;
   if ((getparm(3,parm))AND(ValType(parm) == V_DATE))
      fieldDate     = parm;
   end;
   if ((getparm(4,parm))AND(ValType(parm) == V_BOOL))
      isDelete      = parm;
   end;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
class TEnsObjCh
   var Name:string,           //Наименование предмета залога (densobj.t_EnsObjectName). 
       RevalDate:date,        //Дата оценки ОО (deoverval_dbt.t_Date)
       RatingSum:money,       //Оценочная стоимость (deoverval_dbt.t_RatingSum).
       RatingCurCode:string,  //Валюта оценочной стоимости.
       MarketSum:money,       //Рыночная стоимость (deoverval_dbt.t_MarketSum).
       MarketCurCode:string,  //Валюта рыночной стоимости
       RezSum:money,          //Стоимость для резерва (deoverval_dbt.t_RezSum).
       RezCurCode:string,     //Валюта стоимости для резерва.
       Quality:integer,       //Категория качества обеспечения (densobj_dbt.t_QUALITYID_Ref).
       RVPS:bool,             //Признак учета для РВПС (densobj_dbt.t_FLAG_RVPS).
       CountUnit:double,      //Количество единиц (densobj_dbt.t_CountUnit).
       CountUnitType:integer, //Тип единицы (densobj_dbt.t_TypeCountUnit) по справочнику <Единицы измерения> (dmeasure_dbt.t_MeasureCode).
       usField=TArray(TUsFieldCh);       //Массив пользовательских полей и их значений (объектов класса TUsFieldCh)
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//-------------------------------------------------------------------------
//Класс КД
//История изменений:
//21.03.2012 Добавление полей в соответствии с проектом сервиса регистрации
//20.12.2012 Добавление и удаление полей в соответствии с проектом сервиса регистрации
//-------------------------------------------------------------------------
class TCreditContr
   var id                :integer;
   var creditType        :integer;
   var client            :integer;
   var number            :string;
   var regDate           :date;
   var returnDate        :date;
   var territorialStruct :integer;
   var groupNum          :integer;
   var userType          :string;
   var privilege         :bool;
   var specific          :string;
   var sum               :money;
   var currency          :string;
   var repDate           :date;
   var beforeDutyIsInd   :bool;
   var fineCondIsInd     :bool;
   var annuit            :bool;
   var indClassification :bool;
   var userField1        :string;
   var userField2        :string;
   var TarPlan           :integer;
   var CondTarPlan       :integer;
   var tariff            =Tarray;
end;

//-------------------------------------------------------------------------
//Класс Тарифы
//История изменений:
//20.12.2012 Перенос в rsbus_struct
//-------------------------------------------------------------------------
class TTariff
   var type       :integer;
   var hist       = Tarray; 
end;

//-------------------------------------------------------------------------
//Класс История тарифов
//История изменений:
//20.12.2012 Перенос в rsbus_struct
//-------------------------------------------------------------------------

class TTarHist
   var date       :date;
   var calendar   :integer;
   var valueBase  :integer;
   var dayInMonth :integer;
   var isFormulaValue : bool;
   var value : string;
end;

//-------------------------------------------------------------------------
//Класс История алгоритмов
//История изменений:
//21.03.2012 Перенос в rsbus_struct
//-------------------------------------------------------------------------
class TAlgHist
   var date       :date;
   var typeRest   :integer;
   var calendar   :integer;
   var valueBase  :integer;
   var dayInMonth :integer;
end;
//-------------------------------------------------------------------------
//Класс Алгоритм (атрибут в классе КД)
//История изменений:
//21.03.2012 Перенос в rsbus_struct
//-------------------------------------------------------------------------
class TAlg
   var type       :integer;
   var hist       = Tarray; // TRateHist;
end;
//-------------------------------------------------------------------------
//Класс История ставок
//История изменений:
//21.03.2012 Перенос в rsbus_struct
//-------------------------------------------------------------------------
class TRateHist
   var date       :date;
   var value      :double;
end;
//-------------------------------------------------------------------------
//Класс Ставка (атрибут в классе КД)
//История изменений:
//21.03.2012 Перенос в rsbus_struct
//-------------------------------------------------------------------------
class TRate
   var type       :integer;
   var hist       = Tarray; // TRateHist;
end;
//-------------------------------------------------------------------------
//Класс описывает структуру возвращаемых данных по счету
class TAccountData
   var Category:integer,            //Код категории учета (КУ).
       Chapter:integer,             //Глава счета (1- первая и т.д.) по справочнику глав учета ГК (dobchaptr_dbt)
       Department:integer,          //Код филиала по справочнику подразделений банка (ddp_dep_dbt)
       AccountNumber:string,        //Номер счета в Кредитовании
       Currency:string,             //Код ФИ валюты счета (значение fininistr.FI_Code из справочника ФИ).
       AccountType:string,           //Тип счета. 
       AccountName:string,          //Наименование счета
       OpenDate:date,               //Дата открытия
       CloseDate:date,              //Дата закрытия. Заполняется, если счет в состоянии <Закрыт>. Если открыт - NULL
       ODBAccountNumber:string,     //Номер счета в ГК
       AccountRest:money,           //Остаток счета
       FinalDate:date;              //Дата последнего движения по счету. Если движений по счету не было возвращается NULL.
   if ((getparm(1,parm))AND(ValType(parm) == V_INTEGER))
      Category     = parm;
   end;
   if ((getparm(2,parm))AND(ValType(parm) == V_INTEGER))
      Chapter     = parm;
   end;
   if ((getparm(3,parm))AND(ValType(parm) == V_INTEGER))
      Department     = parm;
   end;
   if ((getparm(4,parm))AND(ValType(parm) == V_STRING))
      AccountNumber     = parm;
   end;
   if ((getparm(5,parm))AND(ValType(parm) == V_STRING))
      Currency     = parm;
   end;
   if ((getparm(6,parm))AND(ValType(parm) == V_STRING))
      AccountType     = parm;
   end;
   if ((getparm(7,parm))AND(ValType(parm) == V_STRING))
      AccountName     = parm;
   end;
   if ((getparm(8,parm))AND(ValType(parm) == V_DATE))
      OpenDate     = parm;
   end;
   if ((getparm(9,parm))AND(ValType(parm) == V_DATE))
      CloseDate     = parm;
   end;
   if ((getparm(10,parm))AND(ValType(parm) == V_STRING))
      ODBAccountNumber     = parm;
   end;
   if ((getparm(11,parm))AND(ValType(parm) == V_MONEY))
      AccountRest     = parm;
   end;
   if ((getparm(12,parm))AND(ValType(parm) == V_DATE))
      FinalDate     = parm;
   end;

end;

//-------------------------------------------------------------------------
//Класс описывает структуру возвращаемых данных по сервису досрочного погашения
class TRepaymentData
   var CredOperId:integer,    // ID выполненной операции погашения
       DutyRest:money;        // Остаток основного долга по договору после выполнения операции погашения
   if ((getparm(1,parm)) AND (ValType(parm) == V_INTEGER))
      CredOperID = parm;
   end;
   if ((getparm(2,parm)) AND (ValType(parm) == V_MONEY))
      DutyRest = parm;
   end;
end;

class (TSetAccountEx)TSetAccountGet(pType, pAccountNumber, pAccountCurCode, pClientID, pClientINN, pClientName, pDepartment, pBank, pBankCorr, pTypeName, pUsePriority)
   var UsePriority: integer;
   InitTSetAccount(pType, pAccountNumber, pAccountCurCode, pClientID, pClientINN, pClientName, pDepartment, pBank, pBankCorr);
   UsePriority = pUsePriority;
end;    

class TSetAccountData 
   var ID            : integer;
   var number        : string;
   var AccCount      : integer;
   var setAccountList: TArray = TArray(TSetAccountGet);
end;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Структура полей ДО(ДоговораОбеспечения)
class TEns
   var   
      Type      :integer,
      Number    :string,
      Person    :integer,
      beginDate :date,
      endDate   :date,
      Sum       :money,
      CurCode   :string,
      Category  :string,
      RVPS      :bool = false,
      Quality   :integer = 0,
      Discount  :double,
      Deposit   :bool;
end;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Структура пользовательского поля объекта залога
class TUsField
   var
      fieldType  :integer,
      fieldValue :string;
END;

// Входящая структура полей объекта залога
class TEnsZalogObj
   var
      Kind          :integer = 0,
      Name          :string  = 0,
      Date          :date = {curdate},
      RatingSum     :money,
      RatingCurCode :string,
      MarketSum     :money,
      MarketCurCode :string,
      RezSum        :money,  
      RezCurCode    :string,
      Quality       :integer = 0,
      RVPS          :bool = false,
      CountUnit     :double  = 1,
      CountUnitType :integer = 796,
      usField     = TArray(TUsField);
END;
