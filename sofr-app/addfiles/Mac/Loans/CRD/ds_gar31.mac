/*Вид задолженности - Начисленные %% по выданной гарантии*/
/*DS_PAYEDGUARPERCENT*/

IMPORT rsd,"total.mac";

MACRO ds_gar31_calc(ObjID:integer, ObjN:integer, OpDate:date, RegID:integer, RateID:@integer, BegDate:@date, EndDate:date, Sum:@money, PaySum:@money, RestNoPay:@money, SystemOperationID:integer)
VAR RSDcmd;

    LnSqlExec("delete from dplanpay_tmp");
    
    RSDcmd = RsdCommand(RslDefCon, "begin Loansfillpayment.ds_gar31_mac(?,?,?,?,?,?,?,?,?,?,?); end;");
    RSDcmd.addParam("objid",  RSDBP_IN);
    RSDcmd.value("objid")   = ObjID;
    RSDcmd.addParam("objn",   RSDBP_IN);
    RSDcmd.value("objn")    = ObjN;
    RSDcmd.addParam("opdate", RSDBP_IN);
    RSDcmd.value("opdate")  = OpDate;
    RSDcmd.addParam("regid",  RSDBP_IN);
    RSDcmd.value("regid")   = RegID;
    RSDcmd.addParam("rateid", RSDBP_IN);
    RSDcmd.value("rateid")  = RateID;
    RSDcmd.addParam("begdate",3 /*RSDBP_IN_OUT*/);
    RSDcmd.value("begdate") = BegDate;
    RSDcmd.addParam("enddate",RSDBP_IN);
    RSDcmd.value("enddate") = EndDate;
    RSDcmd.addParam("summ",   3 /*RSDBP_IN_OUT*/);
    RSDcmd.value("summ")    = Sum;
    RSDcmd.addParam("paysum", 3 /*RSDBP_IN_OUT*/);
    RSDcmd.value("paysum")    = PaySum;
    RSDcmd.addParam("restnopay", 3 /*RSDBP_IN_OUT*/);
    RSDcmd.value("restnopay")  = RestNoPay;
    RSDcmd.addParam("systemoperationid",   RSDBP_IN);
    RSDcmd.value("systemoperationid")    = SystemOperationID;
    RSDcmd.execute();
    Sum       = RSDcmd.value("summ");
    PaySum    = RSDcmd.value("paysum");
    RestNoPay = RSDcmd.value("restnopay");
    RSDcmd = null;
END;

MACRO ds_gar32_calc_for_operation(ObjID:integer, ObjN:integer, OpDate:date, ParentID:integer, Reference:integer)
VAR RSDcmd;
    RSDcmd = RsdCommand(RslDefCon, "begin Loansfillpayment.debtscalculation(?,?,?,?,?); end;");
    RSDcmd.addParam("objid",     RSDBP_IN);
    RSDcmd.value("objid")      = ObjID;
    RSDcmd.addParam("objn",      RSDBP_IN);
    RSDcmd.value("objn")       = ObjN;
    RSDcmd.addParam("parentid",  RSDBP_IN);
    RSDcmd.value("parentid")   = ParentID;
    RSDcmd.addParam("REFERENCE", RSDBP_IN);
    RSDcmd.value("REFERENCE")  = Reference;
    RSDcmd.addParam("opdate",    RSDBP_IN);
    RSDcmd.value("opdate")     = OpDate;
    RSDcmd.execute();
    RSDcmd = null;
END;