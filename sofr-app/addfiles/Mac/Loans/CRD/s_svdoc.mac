/*******************************************************************************
 * RS-Loans                                                                    *
 * --------------------------------------------------------------------------- *
 * Description | Откат выгрузки документов                                     *
 * SCR         | 67516                                                         *
 * Programmer  | Kopacheva Olga                                                *
 * Date        | 03.05.2005                                                    *
 *******************************************************************************/

IMPORT "total.mac", SbCrdInter;
RECORD svdocum ("doc_acc.dbt",  "loans.def"); /* Буфер документа */
VAR docacc   = TRecHandler("doc_acc.dbt",  "loans.def");
VAR {GROUP_MODE};
private const ROLLBACK_OK = 6; // успешный откат выгрузки
/*
 Возвращаемые значения:
    0 - Откатывать документ RS-Loans вместе с документов RS-Bank
    1 - Ничего не откатывать
    2 - Откатывать только документ RS-Loans
 */
MACRO OnBackOutDoc()
   RETURN 0;
END;

MACRO RollBackDocUniRetail(DocAccBuf)
   SetBuff(svdocum, DocAccBuf);
   Copy(docacc, svdocum);
   var retailRes= TArray;
   var docId =string(docacc.rec.docaccid);
   
   InstLoadModule("BookInter");
   var MacroFun = "RollBackAccountingDocument";
   retailRes =  ExecMacro2(MacroFun, docId, GetIdentProgram());

   if (retailRes.ResultCode==ROLLBACK_OK)
        MsgBox("Откат выгрузки успешно выполнен!");
        return 0;
   else
        MsgBox("Откат выгрузки не выполнен!");
        return retailRes.ResultCode; 
   end; 

   MsgBox("Откат выгрузки не выполнен!");
   RETURN 1;
END;

/* Установка подсказки для скролингов из макроса */
MACRO УстановитьПодсказку(TableName:string, IndexNum:integer, DefaultHint:string, oper:integer):string
   // RETURN DefaultHint;
   // ПРИМЕР:
   // RETURN "/*+CHOOSE LEADING(t) INDEX(t ddoc_acc_dbt_idx0)*/";
   RETURN "";
END;