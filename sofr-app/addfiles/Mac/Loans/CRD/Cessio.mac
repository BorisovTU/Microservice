/*------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : Cessio.mac                                             2008-08-19
 Description : Макрос расчета доступной суммы к выдачи

 Programmer  : Manushkina E.V.
 2008-08-19  : Создан prj 984
------------------------------------------------------------------------------*/

import "total.mac";

record CessioBuf ("credit_c.dbt", "loans.def");
record CessioParm ("asgmtparm.dbt", "loans.def");

macro CalcPriceAndSelling ()
   var RSDcmd;

   CessioParm.Price = $0;
   CessioParm.Selling = $0;

   RSDcmd = RsdCommand (RslDefCon, "begin ? := RSO_LN_CESSIO.CalcPriceAndSelling (?,?,?,?,?,?,?,?,?); end;");

   RSDcmd.addParam ("retval", RSDBP_RETVAL, V_INTEGER);

   RSDcmd.addParam ("ObjK",     RSDBP_IN); RSDcmd.value ("ObjK")     = CessioBuf.Crd_kind;
   RSDcmd.addParam ("ObjN",     RSDBP_IN); RSDcmd.value ("ObjN")     = CessioBuf.CreditNumber;
   RSDcmd.addParam ("CalcDate", RSDBP_IN); RSDcmd.value ("CalcDate") = CessioParm.Concession;

   RSDcmd.addParam ("Paying",         RSDBP_IN); RSDcmd.value ("Paying")         = CessioParm.Paying;
   RSDcmd.addParam ("Recompense",     RSDBP_IN); RSDcmd.value ("Recompense")     = CessioParm.Recompense;
   RSDcmd.addParam ("Interest",       RSDBP_IN); RSDcmd.value ("Interest")       = CessioParm.Interest;
   RSDcmd.addParam ("IntereCompense", RSDBP_IN); RSDcmd.value ("IntereCompense") = CessioParm.IntereCompense;

   RSDcmd.addParam ("Price",   RSDBP_OUT, V_NUMERIC);
   RSDcmd.addParam ("Selling", RSDBP_OUT, V_NUMERIC);

   RSDcmd.execute ();

   CessioParm.Price = RSDcmd.value ("Price");
   CessioParm.Selling = RSDcmd.value ("Selling"); 
end;

// Получить номинальную стоимоть объекта
macro GetNominalValue (
   ObjK   : integer,
   ObjN   : integer,
   OpDate : date
)
   var RSDcmd;
   var NominalValue : money = $0;

   RSDcmd = RsdCommand (RslDefCon, "begin ? := RSO_LN_CESSIO.GetNominalValue (?, ?, ?); end;");

   RSDcmd.addParam ("NominalValue", RSDBP_RETVAL, V_NUMERIC);
                                                            
   RSDcmd.addParam ("ObjK",   RSDBP_IN); RSDcmd.value ("ObjK")   = ObjK;
   RSDcmd.addParam ("ObjN",   RSDBP_IN); RSDcmd.value ("ObjN")   = ObjN;
   RSDcmd.addParam ("OpDate", RSDBP_IN); RSDcmd.value ("OpDate") = OpDate;

   RSDcmd.execute ();

   NominalValue = RSDcmd.value ("NominalValue");

   return NominalValue;
end;
