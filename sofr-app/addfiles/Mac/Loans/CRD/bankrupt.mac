/*
$Name:             bankrupt.mac
$Module:           кредитование
$Description:      сохраниение данных о банкротстве
*/

import CTInter, bankinter, sbcrdinter, prpm;
PRIVATE RECORD party("party.dbt");

macro CheckAndSave(PartyID: integer, nameCourti: string, file_number: string, istetc: string, iTypeBankruptcy:integer, cTypeBankruptcy: string, decision : string, opdate:date, CreditNumber:integer, iKindBankruptcy:integer)
var note: string;

   if((strbrk(nameCourti,      ";") != 0) or
      (strbrk(file_number,     ";") != 0) or
      (strbrk(istetc,          ";") != 0) or
      (strbrk(cTypeBankruptcy, ";") != 0) or
      (strbrk(decision, ";") != 0)
     )

       LoansError("Запрещено использовать символ ';'");
       return false;
    end;

    if( ПолучитьСубъекта( PartyID, party ) != 0 )
       return false;
    end;

    note = nameCourti + ";" + file_number + ";" + trim(string(opdate)) + ";" + istetc + ";" +  iTypeBankruptcy + ";" + cTypeBankruptcy + ";" + decision + ";" +  iKindBankruptcy + ";";

    if(addNoteForObject(OBJTYPE_PARTY, UniID(party, OBJTYPE_PARTY), 44, note, opdate) != 0)
       LoansError("Ошибка сохранение информации о банкротстве!");
       return false;
    end;

    return true;
end;