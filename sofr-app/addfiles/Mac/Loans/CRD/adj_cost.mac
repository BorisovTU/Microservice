/*
$Name:              adj_cost.mac
$Module:            Кредитование
$Description:       Корректировка стоимости
*/
/*------------------------------------------------------------------------------
                     Библиотека интерпретируемых модулей

 Filename    : adj_cost.mac
 Description : Корректировка стоимости

 Programmer  : TFS
 25.07.2018  : Создан
------------------------------------------------------------------------------*/

IMPORT total;

// Формирование разноски
MACRO FillFileGroup(
                    OpDate        : date,
                    UserType      : string,
                    SMAString     : string,
                    FnCash        : integer
                   )

   VAR RSDcmd = NULL, Cnt = -1 * GetCNum(), ErrCode = 0, PackSize = 0;

   BegAction(1, "Формирование списка задолженности. Ждите, это может занять время.", false);

   RSDcmd = RsdCommand(RslDefCon, "BEGIN ? := RSO_LoansRsBus.FillWSAdj(?,?,?,?,?,?,?,?); END;");
   RSDcmd.addParam("RetVal",        RSDBP_RETVAL, V_INTEGER );
   RSDcmd.AddParam("taskID",        RSDBP_IN, 0);
   RSDcmd.AddParam("execID",        RSDBP_IN, Cnt);
   RSDcmd.AddParam("conveyerID",    RSDBP_IN, 0);
   RSDcmd.AddParam("packetSize",    RSDBP_IN, 0);
   RSDcmd.addParam("opdate",        RSDBP_IN, OpDate);
   RSDcmd.addParam("usertype",      RSDBP_IN, UserType);
   RSDcmd.addParam("FnCash",        RSDBP_IN, FnCash);
   RSDcmd.addParam("SMAString",     RSDBP_IN, SMAString);
   RSDcmd.execute();

   IF (LnSelectValue("SELECT COUNT(1) FROM DCNVDOC_DBT WHERE T_EXECID = " + Cnt, V_INTEGER) == 0)
      EndAction(1);
      RETURN FALSE;
   END;

   EndAction(1);

   RETURN TRUE;
END;