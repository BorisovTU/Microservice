/*
$Name: ws_lns_TypeEns.mac
$Module: WebLoans
$Description: Сервис источника данных для листалки "Типы обеспечений"
*/
IMPORT RsbDataSet, total, likepy;

CLASS CLnsTypeEns()
    VAR TypeEnsID: integer = 0;    // Идентификатор типа обеспечения
    VAR SysTypeEnsID: integer = 0; // Идентификатор системного типа обеспечения
    VAR TypeEnsName: string = "";  // Название типа обеспечения
END;

MACRO lns_TypeEnsList(SysTypeEnsIDList)
    VAR result = TArray(), obj = NULL;
    VAR rs = NULL;
    VAR query = "SELECT * FROM DTYPE_ENS_DBT WHERE T_HIDE != 'X' ";

    if ((SysTypeEnsIDList != null) AND (SysTypeEnsIDList.Size != 0))
        query = query + "AND T_SYSTYPEENSID_REF in (" + join(SysTypeEnsIDList, ", ") + ")";
    end;

    rs = TRsbDataSet(query);

    WHILE (rs.moveNext())
        obj = CLnsTypeEns();

        obj.TypeEnsID    = rs.TypeEnsID;
        obj.SysTypeEnsID = rs.SysTypeEnsID_Ref;
        obj.TypeEnsName  = rs.TypeEnsName;
        
        result[result.size] = obj;
    END;
  
    RETURN result;
END;

MACRO lns_TypeEnsByID(TypeEnsID)
    VAR result = CLnsTypeEns();
    VAR rs = NULL;

    VAR query = "SELECT * FROM dtype_ens_dbt WHERE t_typeensid = " + TypeEnsID;

    rs = TRsbDataSet(query);
    if (rs.moveNext())
        result.TypeEnsID    = rs.TypeEnsID;
        result.SysTypeEnsID = rs.SysTypeEnsID_Ref;
        result.TypeEnsName  = rs.TypeEnsName;
    end;
  
    RETURN result;

END;

MACRO Lns_TypeEnsByIDList(TypeEnsIDList)
    VAR query = "SELECT * FROM dtype_ens_dbt WHERE t_typeensid in (" + join(TypeEnsIDList, ",") + ")",
        rs = null,
        result = TArray(),
        obj = null;
        
    IF ((TypeEnsIDList != null) AND (TypeEnsIDList.Size != 0))
        rs = TRsbDataSet(query);
        WHILE (rs.MoveNext)
            obj = CLnsTypeEns();

            obj.TypeEnsID    = rs.TypeEnsID;
            obj.SysTypeEnsID = rs.SysTypeEnsID_Ref;
            obj.TypeEnsName  = rs.TypeEnsName;
            
            result[result.size] = obj;
        END;
    END;
    
    RETURN result;
END;