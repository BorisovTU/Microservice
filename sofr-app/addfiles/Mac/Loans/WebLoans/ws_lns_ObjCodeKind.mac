/*
$Name: ws_lns_ObjCodeKind.mac
$Module: WebLoans
$Description: Сервис источника данных для листалки "Вид кода"
*/
IMPORT RsbDataSet, "total.mac";

CLASS CLnsObjCodeKind()
    VAR ObjectType: integer = 0;
    VAR CodeKind: integer = 0;
    VAR Name: string = "";
    VAR ShortName: string = "";
    VAR Definition: string = "";
END;

MACRO lns_ObjCodeKindList()
    VAR result = TArray(), obj = NULL;
    VAR rs = NULL;
    VAR query = "select * from dobjkcode_dbt where t_objecttype = 3";
    rs = TRsbDataSet(query);
    
    WHILE (rs.moveNext())
        obj = CLnsObjCodeKind();
        obj.ObjectType     = rs.ObjectType;
        obj.Name           = rs.Name;
        obj.CodeKind       = rs.CodeKind;
        obj.ShortName      = rs.ShortName;
        obj.Definition     = rs.Definition;
        result[result.size] = obj;
    END;
  
    RETURN result;
END;

MACRO lns_ObjCodeKindByID(CodeKind: integer)
    VAR result = CLnsObjCodeKind();
    VAR rs = NULL;
    VAR query = "select * from dobjkcode_dbt where t_objecttype = 3 and t_codekind = " + CodeKind;
    rs = TRsbDataSet(query);
    
    if (rs.moveNext())
        result.ObjectType     = rs.ObjectType;
        result.Name           = rs.Name;
        result.CodeKind       = rs.CodeKind;
        result.ShortName      = rs.ShortName;
        result.Definition     = rs.Definition;
    end;
  
    RETURN result;

END;


