//

import BankInter, DeprIntr, DeskInter, ListCurr;
import rcw;
import tcr_bc_err;

private var {curdate};

/***********************************************************/
//             Проверка успешной разгрузки.
/***********************************************************/

  var agent = CreateObject( "rtbrcash.d32", "TBranchCashAgent", NULL, false );
  var bce = BC_ErrCode;
  var str = "";
  var res = 0;

  if ( agent.login( 1, 1 ) )
    if ( agent.GetSafeInfoXml2( {curdate}, 1, str ) )
      MsgBox( "С устройством можно работать" );
    else
      agent.GetLastBranchCashResult( res );  // Получение кода ошибки.
      if ( res == 1008 )
        MsgBox( "Разгрузка устройства не завершена" );
      else
        MsgBox( bce.ErrMsg( res ) );  // Сообщение об ошибке.
      end;
    end;
  end;

end;
