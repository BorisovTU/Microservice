/*********************************************************\
  R-Style Softlab
  RS-Retail
  Электронный кассир Pro Cash 6000
  Воронцов Ю.В., IIX.2006
Отчет об остатках денег в электронном кассире - tcd_pc_rinf.mac

Точки вызова: Для данного отчета есть несколько точек вызова:
  -  Перед выполнением операции "Подкрепление кассы" или "Сдача в хранилище из кассы" (в начале функции InitCashDocInBunch)
  -  После подтверждения кассового документа такой операции (в конце функции CarryCashDocFromScrl)
  -  В АРМ "Оперкасса" из п.м. "Работа - TCD - Отчеты - Текущая информация". 
	В этом случае перед вызовом макроса пользователю выдается панель параметров отчета об остатке средств 
	(см главу "Доработка функциональности"). //P_REPTCD
	Если пользователем выбран конкретный ЭК, вызывается макрос для него, 
	в противном случае (отчет по всем ЭК) организуется цикл по всем ЭК данного подразделения 
	(tcd_unit.FNCash == ::FNcash)  и макрос вызывается отдельно для каждого ЭК. 
	Вывод от всех вызовов "склеивается" в единый файл при помощи COutputAccumulator

Параметры: TCD_PARM.aTCDRef - ID ЭК

Алгоритм:
1.        Подключиться к указанному ЭК.
2.        Если подключение выполнено
2.1.        Получить данные об остатках в ЭК (метод TProCashDevice.getMoneyRestInfo)
2.2.        Вывести отчет. Форма приведена в Приложении 1
2.3.        Отключиться от ЭК
Обработка ошибок стандартнаяя
\*********************************************************/

Import tcd_pc_def;
Import tcd_pc_report;

//macro mainProCash(in_aTCDRef:integer, in_aCurrency:integer, in_aSum:money ):integer
macro mainProCash(in_aTCDRef:integer, in_aCurrency:integer, in_aSum:money , in_adrCashDoc ):integer
  var stat = true;
  
  name_pc_Macro = "tcd_pc_rinf.mac";
  
  //Получение платёжного документа
  getCashDoc( in_adrCashDoc );
  
  if( in_aSum < 0 ) 
    in_aSum = - in_aSum;
  end;
  
  if( validateCurCurrency(in_aCurrency) == false )
    //msgbox("Работа с ЭК осуществляется только с национальной валютой.");
    return 0;
  end;

  if( procStandConnect(_MODE_SPECIFIED_TCD,in_aTCDRef) == false ) 
    return 7071;//-1; 
  end;

  stat = getProCashReport(_REPMODE_RESTINFO, in_aTCDRef);

  if(stat == true)
    return 0;
  else
    return 7074;//1;
  end;
  
end;//mainProCash

// 7071; //ККМ выключена или отсутствует - оплату производить нельзя
// 7072; //Ошибка при проверке возможности проведения оплаты на ККМ
// 7004; //Недостаточное количество ресурса на счёте при проведении операции
// 7074 // Ошибка в макрофункции при проведении операции на ККМ
      


/*
Import tcd_pc_def;
Import tcd_pc_report;

  var stat;

  if( validateCurCurrency(TCD_PARM.aCurrency) == false )
    //msgbox("Работа с ЭК осуществляется только с национальной валютой.");
    return 0;
  end;

  if(  procStandConnect(_MODE_SPECIFIED_TCD) == false ) return -1; end;

  stat = getProCashReport(_REPMODE_RESTINFO);

  if(stat == true)
    return 0;
  else
    return 1;
  end;


end;//macros
*/
