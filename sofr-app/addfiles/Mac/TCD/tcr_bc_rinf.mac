//

import RCW;

private var {curdate};

var str = "";

private macro ReportFromXML( s )
  var n1, n2, v1, v2, t1, t2, r1, r2;
  var vN, vC, vV, vT, vR;
  var i = Index( s, "<Cassette>" );

  [ 
    +----+-----+---------+-------+--------+
    | üü | ‚ « | ®¬¨­ « | Šã¯îà | ˆá¯®àç |
    +----+-----+---------+-------+--------+];

  while ( i > 0 )
    n1 = Index( SubStr( s, i ), "<Number>" );
    n2 = Index( SubStr( s, i ), "</Number>" );

    v1 = Index( SubStr( s, i ), "<Value>" );
    v2 = Index( SubStr( s, i ), "</Value>" );

    t1 = Index( SubStr( s, i ), "<Count>" );
    t2 = Index( SubStr( s, i ), "</Count>" );

    r1 = Index( SubStr( s, i ), "<Rejected>" );
    r2 = Index( SubStr( s, i ), "</Rejected>" );

    vN = Int( SubStr( s, i + n1 + 7, n2 - n1 - 8 ) );
    vC = SubStr( s, i + 38, 3 );
    vV = Int( SubStr( s, i + v1 + 6, v2 - v1 - 7 ) );
    vT = Int( SubStr( s, i + t1 + 6, t2 - t1 - 7 ) );
    vR = Int( SubStr( s, i + r1 + 9, r2 - r1 - 8 ) );

    [ | ## | ### | ####### | ##### | ###### |]
    ( vN:2, vC:3, vV:7, vT:5, vR:6 );

    s = SubStr( s, 1, i - 1 ) + "*" + SubStr( s, i + 1 );
    i = Index( s, "<Cassette>" );
  end;
  [ +----+-----+---------+-------+--------+];
end;

private var agent = CreateObject( "rtbrcash.d32", "TBranchCashAgent", NULL, false );

if ( agent.GetSafeInfoXml2( {curdate}, 1, str ) )
  ReportFromXML( str );
end;
