/***************************************************************/
/*                                                             */
/*      RS-Retail 2.0                                          */
/*                                                             */
/*      ‘¨áâ¥¬  ®¡á«ã¦¨¢ ­¨ï TCD                               */
/*                                                             */
/*      Œ ªà®á ®âç¥â  ¯® § £àã§ª ¬ TCD                         */
/*                                                             */
/***************************************************************/

  Import deprintr, ListCurr;

  file   fLoad ( TCD_Load, "TCD.DEF" ) key 2;
  file   fSlot ( TCD_Slot, "TCD.DEF" ) key 1;
  file   fPers ( TCD_Pers, "TCD.DEF" ) key 1;
  file   fUnit ( TCD_Unit, "TCD.DEF" ) key 0;

  record dlg( "REP_PARM", "TCD.LBR" ) dialog;

  const NoRight = "‚ë ­¥ ¬®¦¥â¥|à ¡®â âì á TCD";

  array aStat;

  var {oper}, {curdate};

  var PersonRefLoad = 0;
  var TCDRef        = 0;
  var TCD_ID        = "";
  var LoadRef       = 0;
  var NumCassettes  = 0;

  var Slots      = 0;
  var UnitStatus = "";
  var UnitDate   = Date();
  var UnitTime   = Time();

  var Branch = NumFNCash;

  var Casher, Date1, Date2;

  var stat  = 0;
  var ret   = TRUE;
  var i, j, k, l;

  /********************************************************/
  /***                Žâç¥â ¯® § £àã§ª ¬                ***/
  /********************************************************/

  aStat(0) = "TCD § £àã¦¥­";
  aStat(1) = "‡ £àã§ª  ­ ç â ";
  aStat(2) = "Ž¯¥à æ¨ï ¯®¯®«­¥­¨ï";
  aStat(3) = "Š®¬ ­¤  TCD § £àã§ª¨";
  aStat(4) = "Š®¬ ­¤  TCD ¯à®è«  ãá¯¥è­®";
  aStat(5) = "Š®¬ ­¤  TCD ¯à®è«  á ®è¨¡ª®©";
  aStat(6) = " ç â  ¢ë£àã§ª ";
  aStat(7) = "“á¯¥è­ ï ¢ë£àã§ª ";
  aStat(8) = "Žè¨¡ª  ¯à¨ ¢ë£àã§ª¥";
  aStat(9) = "à®¢¥¤¥­  ¨­ª áá æ¨ï";

  Casher = {oper};
  Date1  = Date();
  Date2  = Date1;

  /* „¨ «®£ ¯®«ãç¥­¨ï ¯ à ¬¥âà®¢ ®âç¥â  */
  dlg.Oper  = Casher;
  dlg.Date1 = Date1;
  dlg.Date2 = Date2;

  if ( RunDialog( dlg ) )
    Casher = dlg.Oper;
    Date1  = dlg.Date1;
    Date2  = dlg.Date2;
  end;

  /* ®¨áª § ¯¨á¨ ¯® ª áá¨àã */
  ClearRecord( fPers );
  fPers.Oper = Casher;
  if ( getEQ( fPers ) )
    PersonRefLoad = fPers.Reference;
  else
    MsgBox( NoRight );
    stat = 1;
  end;

  /* ®¨áª § ¯¨á¨ ¯® TCD */
  if ( stat == 0 )
    ClearRecord( fUnit );
    fUnit.Reference = fPers.TCDRef;
    if ( getEQ( fUnit ) )
      TCDRef = fUnit.Reference;
      TCD_ID = fUnit.ID;
    else
      MsgBox( "‡ ¯¨áì ¯® TCD|­¥ ­ ©¤¥­ " );
      stat = 2;
    end;
  end;

  /* à®¢¥àª  ä¨«¨ «  TCD */
  if ( ( stat == 0 )  AND  ( fUnit.FNCash != Branch ) )
    MsgBox( "”¨«¨ « TCD (# ", fUnit.FNCash,
            ") ­¥ ï¢«ï¥âáï|â¥ªãé¨¬ ä¨«¨ «®¬ (# ", Branch, ")" );
    stat = 3;
  end;

  /* ®¨áª § ¯¨á¨ ¯® ¯®á«¥¤­¥© § £àã§ª¥ */
  if ( stat == 0 )
    ClearRecord( fLoad );
    fLoad.FNCash = Branch;
    fLoad.TCDRef = TCDRef;
    fLoad.Date   = Date1;
    if ( ( GetGE( fLoad ) )          AND
         ( fLoad.FNcash == Branch )  AND
         ( fLoad.TCDRef == TCDRef )  AND
         ( fLoad.Date   >= Date1  )  AND
         ( fLoad.Date   <= Date2  ) )
      [
         Žâç¥â ¯® § £àã§ª ¬. Š áá¨à ####. „ âë ®â ########## ¤® ##########.

        ÚÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄ¿
        ³    „ â     ³  ‚à¥¬ï   ³           ‘â âãá             ³    „ â     ³
        ³            ³          ³                              ³   ®¯¥à¤­ï  ³
        ÃÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´
      ] ( Casher, Date1, Date2 );
      while ( ret  AND
              ( fLoad.FNcash == Branch )  AND
              ( fLoad.TCDRef == TCDRef )  AND
              ( fLoad.Date   >= Date1  )  AND
              ( fLoad.Date   <= Date2  ) )
        [ ³ ########## ³ ######## ³ ############################ ³ ########## ³]
        ( fLoad.Date, fLoad.Time, aStat(fLoad.Status):28, fLoad.CurDate );
        ret = Next( fLoad );
      end;
      [ ÀÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÙ];
    else
      MsgBox( "¥ ­ ©¤¥­ë § ¯¨á¨ § £àã§ª¨/¢ë£àã§ª¨|¯® ä¨«¨ «ã ", Branch,
              "|¤«ï TCD \"", TCD_ID, "\"" +
              "|®â ¤ âë ", Date1, " ¤® ", Date2 );
      LoadRef = -1;
    end;
  end;

end;