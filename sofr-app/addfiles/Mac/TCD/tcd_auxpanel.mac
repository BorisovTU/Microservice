/***************************************************************/
/*                                                             */
/*      RS-Retail                                              */
/*                                                             */
/*      Система обслуживания Электронных кассиров              */
/*                                                             */
/*      Макрос панели дополнительных параметров устройства     */
/*                                                             */
/***************************************************************/

Import BankInter, DeprIntr, DeskInter;

private record dlg ( "ADD_PARM", "TCD.LBR" ) dialog;
private record Unit ( "tcd_unit.dbt" );

private file F_Unit ( "tcd_unit.dbt" ) key 0 write;

private macro EventProcR( dlg, cmd, id, key )
  if ( cmd == DLG_SAVE )
    if ( ( dlg.SlotsNum < 1 )  OR  ( dlg.SlotsNum > 6 ) )
      MsgBox( "Неверное число кассет ", dlg.SlotsNum, "|(должно быть от 1 до 6)" );
      return CM_CANCEL;
    end;
    if ( ( dlg.MaxNotes < 0 )  OR  ( dlg.MaxNotes > 999 ) )
      MsgBox( "Неверное ограничение на число купюр ", dlg.MaxNotes, "|(должно быть от 0 до 999)" );
      return CM_CANCEL;
    end;
  end;
  return CM_DEFAULT;
end;

macro RunTCDAddParamPanel( Addr )
  SetBuff( Unit, Addr );
  ClearRecord( F_Unit );
  F_Unit.Reference = Unit.Reference;
  if ( getEQ( F_Unit ) )
    dlg.SlotsNum   = F_Unit.SlotsNum;
    dlg.MaxNotes   = F_Unit.MaxNotes;
    dlg.NetAddress = F_Unit.NetAddress;
    if ( RunDialog( dlg, "EventProcR" ) )
      F_Unit.SlotsNum   = dlg.SlotsNum;
      F_Unit.MaxNotes   = dlg.MaxNotes;
      F_Unit.NetAddress = dlg.NetAddress;
      Update( F_Unit );
    end;
  else
    MsgBox( "Не найдена запись по ЭК: ", Unit.ID, ", ", Unit.Description );
  end;
end;