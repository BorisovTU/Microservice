/*
$Name:           gt_oper.mac
$Module:         Шлюз
$Description:    Процедура репликации операциониста.
*/

import "replicoperman.mac", ws_operman;

var operman = TBFile("person", "R", 0);

var oOpermanParm : TWsGateOperman;
    oOpermanParm = TWsGateOperman;

macro CarryOper
  var stat = 0;  

    if (InfObject.ActionID == ACT_INSERT)
      stat = ActionOperman("InsertOperman", oOpermanParm, @ErrorMessage );
    elif (InfObject.ActionID == ACT_UPDATE)
      stat = ActionOperman("UpdateOperman", oOpermanParm, @ErrorMessage );
    elif (InfObject.ActionID == ACT_DELETE)
      stat = ActionOperman("DeleteOperman", oOpermanParm.Oper, @ErrorMessage );
    end;
 
    MVODB_ObjectCode = SubStr( "00000", strlen(string(oOpermanParm.Oper)) + 1 ) + string(oOpermanParm.Oper);
 
    return stat;
end;


macro GetOpermanGKBO()

 codeObject.rec.ObjectID      = InfObject.ObjectID;
 codeObject.rec.ApplicationID = GKBO;
 codeObject.rec.ObjectKind    = Object.ObjectKind;

 if (GetEQ(codeObject))

    if(InfObject.ActionID == ACT_DELETE)
    
      oOpermanParm.Oper = int(codeObject.rec.ObjectCode);

    else

     operman.rec.Oper = int(codeObject.rec.ObjectCode);

     if(GetEQ(operman))
       oOpermanParm.Oper        = operman.rec.Oper;
       oOpermanParm.Name_Oper   = operman.rec.Name;
       oOpermanParm.cTypePerson = operman.rec.cTypePerson;
       oOpermanParm.UserBlocked = operman.rec.UserBlocked;
       oOpermanParm.UserClosed  = operman.rec.UserClosed;
     else
       ReplicatorMsgBox(string( "Объект не найден"));
       codeObject.dropFilter();
   
       return Error_NoObjectCode;
 
     end;
   end;
 else
 
   ReplicatorMsgBox(string( "Код объекта не найден"));
   codeObject.dropFilter();

   return Error_NoObjectCode;

 end;

 codeObject.dropFilter();

 return 0;

end;



macro PrepareExportOperman()

  var stat = 0;
  stat = GetOpermanGKBO();

  return stat;

end;
