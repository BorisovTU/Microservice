/*
$Name:        gtEvents.mac
$Module:      ˜«î§
$Description:
*/
IMPORT RsbDataSet, DealsInter;

var RunDLBeginGTImp:bool = false;

macro beforeImportToRSB( SeanceID, SncLog, ds ):integer
  var RetVal:integer = 0;

  RunDLBeginGTImp = false;

  var query = " SELECT count(1) cnt " +
              "  FROM dgtsncrec_dbt gtsncrec, dgtobject_dbt gtobject " +
              " WHERE gtsncrec.t_seanceid = " + SeanceID +
              "   AND gtobject.t_ObjectID = gtsncrec.t_ObjectID " +
              "   AND gtobject.t_ObjectKind = " + RG_SECURDEAL;

  var rsb = TRsbDataSet(query);
  if( rsb.MoveNext and (int(rsb.cnt) > 0) )
     RunDLBeginGTImp = true;
     DL_BeginGTImp();
  end;

  return RetVal;
end;

macro afterImportToRSB(SeanceID, SncLog, ds)
  var
      query = "", rsb = NULL;

    query = "SELECT gtseance.t_ApplicationID "
             "FROM dgtseance_dbt gtseance, "
             "     dgtsncrec_dbt gtsncrec "
             "WHERE "
             "  gtsncrec.t_SeanceID = gtseance.t_SeanceID "
             "  AND gtseance.t_Kind = 1 "
             "  AND gtseance.t_Direction = 1 "
             "  AND gtsncrec.t_RecordID IN (select t_RecordID from dgtsncrec_dbt where t_seanceid = " + SeanceID + ") ";

   rsb = TRsbDataSet(query);
   while (rsb.MoveNext)
       if (rsb.ApplicationID == 109) //ƒà ä¨ª Thaler
           InstLoadModule("gtLns.mac");
           ExecMacro2("LnsAfterImportToRSB", SeanceID,SncLog, ds);
       end;
   end;

   if( RunDLBeginGTImp )
      DL_EndGTImp();
   end;
end;
