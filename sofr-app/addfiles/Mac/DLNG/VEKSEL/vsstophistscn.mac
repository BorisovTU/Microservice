/*
$Name:          vsstophistscn.mac
$Module:        Векселя банка
$Description:   Массовое выполнение действий сервисными операциями ввода/вывода в стоп-лист
*/

IMPORT FIInter, DealsInter, VSInter;   
 
PRIVATE VAR srvd = TRecHandler( "vssrvdoc.dbt" );


PRIVATE CONST ERROR_EXEC = 0,
              PRINT_HEADER = 1,
              PRINT_FOOTER = 2;

PRIVATE MACRO PrintHead( Head:STRING )
[
                   #
┌──────────────────────────┬──────┬───────────────────────────────────────────────────────────────────────────────────────────────────┐
│       Код операции       │  №   │                      Сообщение                                                                    │
│                          │ошибки│                                                                                                   │
├──────────────────────────┼──────┼───────────────────────────────────────────────────────────────────────────────────────────────────┤](Head);
END;


PRIVATE MACRO PrintFooter()
[└──────────────────────────┴──────┴───────────────────────────────────────────────────────────────────────────────────────────────────┘
];

END;

PRIVATE MACRO PrintLine( ErrStatus:INTEGER, ErrMessage:STRING )
[│##########################│######│###################################################################################################│]
( srvd.rec.DocNumber:w, ErrStatus, ErrMessage:w );
END;


PRIVATE MACRO DeleteVSSRVDOC( NumExec:INTEGER, ErrStatus:INTEGER, ErrMessage:STRING )

  if( NumExec == PRINT_HEADER )
     PrintHead( "Отчет о массовом удалении операций." );
  elif( NumExec == PRINT_FOOTER )            
     PrintFooter();
  elif( NumExec == ERROR_EXEC )
     if( ErrStatus == 0 ) 
       ErrMessage = "Операция удалена.";
     end;
     PrintLine( ErrStatus, ErrMessage);
  end;
END;


/*   Action = 3 - удаление (F8 из скроллинга )
*/
MACRO Печать_ОтчетСканирования( NumExec:INTEGER, FDoc:VARIANT, ErrStatus:INTEGER, ErrMessage:STRING, Action:INTEGER )

  srvd.SetRecordAddr( FDoc );

  if( Action == 1 ) //Удаление
    DeleteVSSRVDOC( NumExec, ErrStatus, ErrMessage );
  end;

END;
