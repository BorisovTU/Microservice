/*
$Name:             vsi073.mac
$Module:           Векселя банка
$Description:      Макрос шага "Расчет комиссии"
*/
/*
Операция "Выдача собственного векселя банка"
*/
IMPORT OprInter, vsdates, RsbDataSet, SfInter;

PRIVATE record ord("dl_order");
PRIVATE VAR sfcomiss = TRecHandler( "sfcomiss.dbt" );
PRIVATE record oprcom ("oprsfcom.dbt");


MACRO ExecuteCaseStep(OperationKind, StepNumber, ordbuf, DocKind)
  var Sum = 0;

  SetBuff( ord, ordbuf );

  ClearRecord (oprcom);
  while(SfGetOperCommission (NULL, NULL, oprcom))
    if (SfGetComiss (oprcom.FeeType, oprcom.CommNumber, sfcomiss))
      Sum = Sum + oprcom.Sum + oprcom.SumNDS;
    end;
  end;

  if (Sum > 0)
    return "75"; // Оплата комиссии
  else
    return "80"; // Закрытие договора
  end;
end;
