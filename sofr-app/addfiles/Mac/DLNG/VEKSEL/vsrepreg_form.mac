/*
$Name:         vsrepreg_form.mac
$Module:       Векселя банка
$Description:  Отчет "Обязательства по погашению векселей" - форма ввода данных
*/

IMPORT "DlRepForm_h.mac";

// Номера полей в форме отчета
CONST
    PNFLD_REGREP_BEGINDATE   = 0, // отчетная начала
    PNFLD_REGREP_CURCODE     = 1, // код валюты
    PNFLD_REGREP_CURNAME     = 2, // наименование валюты
    PNFLD_REGREP_BEFORE      = 3, // срок до погашения
    PNFLD_REGREP_DEPARTCODE  = 4, // код филиала
    PNFLD_REGREP_DEPARTMENT  = 5; // наименование филиала

// Срок до погашения
CONST
    VSBNR_BEFORE_REG_ALL  = 0,  // Все
    VSBNR_BEFORE_REG_1    = 1,  // До востребования и на 1 день
    VSBNR_BEFORE_REG_5    = 2,  // До 5    дней
    VSBNR_BEFORE_REG_10   = 3,  // До 10   дней
    VSBNR_BEFORE_REG_20   = 4,  // До 20   дней
    VSBNR_BEFORE_REG_30   = 5,  // До 30   дней
    VSBNR_BEFORE_REG_90   = 6,  // До 90   дней
    VSBNR_BEFORE_REG_180  = 7,  // До 180  дней
    VSBNR_BEFORE_REG_270  = 8,  // До 270  дней
    VSBNR_BEFORE_REG_360  = 9,  // До 1    года
    VSBNR_BEFORE_REG_HUGE = 10; // Свыше 1 года

VAR VSBNR_BEFORE_REG_NAME = TArray();
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_ALL]  = "Все";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_1]    = "До востребования и на 1 день";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_5]    = "До 5    дней";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_10]   = "До 10   дней";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_20]   = "До 20   дней";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_30]   = "До 30   дней";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_90]   = "До 90   дней";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_180]  = "До 180  дней";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_270]  = "До 270  дней";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_360]  = "До 1    года";
VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_HUGE] = "Свыше 1 года";

// Обработка срока до погашения
PRIVATE MACRO FldProc_Before( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
    if( Cmd == DLG_INIT )
        if( FldRealValue == null )
            FldRealValue = VSBNR_BEFORE_REG_ALL;
        end;
        FldShowValue = VSBNR_BEFORE_REG_NAME[FldRealValue];
    elif( Cmd == DLG_CHANGEVALUE )
        FldShowValue = VSBNR_BEFORE_REG_NAME[FldRealValue];
    elif( ( Cmd == DLG_KEY ) AND ( Key == KEY_F3 ) )
        DL_ListString( null, pThis.CurrentFldX(), pThis.CurrentFldY(), @FldShowValue, @FldRealValue,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_ALL], VSBNR_BEFORE_REG_ALL,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_1],   VSBNR_BEFORE_REG_1,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_5],   VSBNR_BEFORE_REG_5,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_10],  VSBNR_BEFORE_REG_10,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_20],  VSBNR_BEFORE_REG_20,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_30],  VSBNR_BEFORE_REG_30,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_90],  VSBNR_BEFORE_REG_90,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_180], VSBNR_BEFORE_REG_180,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_270], VSBNR_BEFORE_REG_270,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_360], VSBNR_BEFORE_REG_360,
                       VSBNR_BEFORE_REG_NAME[VSBNR_BEFORE_REG_HUGE],VSBNR_BEFORE_REG_HUGE );
    elif( ( Cmd == DLG_KEY ) AND ( Key == KEY_SPACE ) )
        FldRealValue = VSBNR_BEFORE_REG_ALL;
        FldShowValue = VSBNR_BEFORE_REG_NAME[FldRealValue];
    end;
    return CM_DEFAULT;
END;

CLASS ( DL_CPanel ) VS_RepReg_Panel()
    PRIVATE MACRO Init()
        AddFieldProc( 0, PNFLD_REGREP_BEGINDATE,  DL_PNFLD_BEGINDATE,  @DL_FldProc_BeginDate, {curdate} );
        AddFieldProc( 0, PNFLD_REGREP_CURCODE,    DL_PNFLD_FI,         @DL_FldProc_FI, NATCUR, 1, 1 );
        AddFieldProc( 0, PNFLD_REGREP_CURNAME,    DL_PNFLD_FI_NAME,    @DL_FldProc_FI_Name, NATCUR, 1, 1 );
        AddFieldProc( 0, PNFLD_REGREP_BEFORE,     DL_USERFIELD,        @FldProc_Before, VSBNR_BEFORE_REG_ALL, 40, 11 );
        AddFieldProc( 0, PNFLD_REGREP_DEPARTCODE, DL_PNFLD_DEPARTCODE, @DL_FldProc_DepartCode, {OperDprt}, 1, 1 );
        AddFieldProc( 0, PNFLD_REGREP_DEPARTMENT, DL_PNFLD_DEPARTMENT, @DL_FldProc_Department, {OperDprt}, 1, 1 );
    END;

    PRIVATE MACRO Check():BOOL
        return true;
    END;

    initDL_CPanel( "vs_rep.lbr", "REGREP" ); 
END;
