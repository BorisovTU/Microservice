/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vsscs.mac
  Created     : 16.07.2002
  Programmer  : Велигжанин А.В.
  Comment     : договор продажи векселей (Sale - продажа)
└───────────────────────────────────────────────────────────────────────────*/

Import BankInter, VSInter, vsordnum, vslib, vs4each, vsordchk;

RECORD ДоговорПродажи (dl_order);
RECORD СтарыйДоговорПродажи (dl_order);

MACRO ФункцияПользователя_ДоговорПродажи (Режим)
  var mnu = tarray(), imnu = 0;

  mnu(imnu) = "Распоряжение о постановке на ностро-позицию";
  imnu = imnu + 1;

  mnu(imnu) = "Распоряжение о выдаче векселя из хранилища";
  imnu = imnu + 1;

  if(imnu > 0)
    imnu = -2;
    imnu = menu(mnu);
    if(imnu >= 0)
      if(mnu(imnu) == "Распоряжение о постановке на ностро-позицию")
        ExecMacroFile("printdocs.mac", "VD_17", ДоговорПродажи);
      elif(mnu(imnu) == "Распоряжение о выдаче векселя из хранилища")
        ExecMacroFile("printdocs.mac", "VD_25", ДоговорПродажи);
      end;
    end;
  end;
  
  return 0;
END;

MACRO Новый_ДоговорПродажи ()
    return 0;
END;

MACRO Проверить_ДоговорПродажи(Режим)
var stat=0;

  if ( Режим == OBJ_DELETE )    
    return 0;
  elif ( Режим == OBJ_UPDATE)
    if ( ПроверитьНомерДоговора(ДоговорПродажи))
      return 1;
    elif ( ВажнИзмДог(СтарыйДоговорПродажи, ДоговорПродажи) )  
      return 1;
    end;
  elif ( Режим == OBJ_DELETEOPR)
    return 0;
  elif ( Режим == OBJ_INSNOTOPR)
    return ПроверитьНомерДоговора(ДоговорПродажи);
  elif ( Режим == OBJ_STARTOPR)
    if(VS_CheckOrderStartOpr(ДоговорПродажи) != 0)
       return 1;
    else
       // Проверяет, был ли у векселя статус "выкуплен" на дату подписания договора
       return ПроверитьСтатусВекселейНаДату( ДоговорПродажи, VSBANNER_STATUS_REDEEMED );
    end;
  elif ( Режим == OBJ_COMPLETE)
    return 0;/* Возвращаемое значение не важно. Обработано не будет. */
  elif ( Режим == OBJ_NOTCOMPLETE)
    return 0;/* Возвращаемое значение не важно. Обработано не будет. */
  elif ( Режим == OBJ_AFTERINSERT)
    return VS_CheckOrderAfterInsert(ДоговорПродажи);
  elif ( Режим == OBJ_AFTERUPDATE)
    return VS_CheckOrderAfterUpdate(ДоговорПродажи);
  end;

    return stat;
END;

/* Установка подсказки для скролингов из макроса */
PRIVATE MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStatus:integer, ScrolKind:integer ):string

  //ScrolStatus
  //ORDER_CONTRACT_STATUS_ALL       = -1,      // любой
  //ORDER_CONTRACT_STATUS_PREP      = 0,       // отложенные
  //ORDER_CONTRACT_STATUS_OPENED    = 10,      // открытые
  //ORDER_CONTRACT_STATUS_CLOSED    = 20      // закрытые

  //пример
  if(TableName == "ddl_order_dbt")
    //return "/*+FIRST_ROWS LEADING(t) INDEX(t ddl_order_dbt_idx0)*/";
  end;

  return DefaultHint;

END;