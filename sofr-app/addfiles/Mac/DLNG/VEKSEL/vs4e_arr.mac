/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vs4e_arr.mac
  Programmer  : ‚¥«¨£¦ ­¨­ €.‚.
  Comment     : ˆâ¥à â®à ¤«ï ¢ë¯®«­¥­¨ï ¤¥©áâ¢¨© ¤«ï ª ¦¤®£® ¢¥ªá¥«ï
                ¯® ¤®£®¢®àã
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
IMPORT vslib;


/* €­ «®£ VS_ForEachBanner ¤«ï ¬ áá¨¢ 
*/
MACRO VS_ForEachBannerInArray(lnk_array, ord, action, role, data:@variant, mode)
PRIVATE var bnr   = TBfile ("vsbanner"),
            leg   = TBfile ("dl_leg"),
            needBnr,              /* ­ã¦­® «¨ ¨áª âì ¢¥ªá¥«ì */
            needLeg,              /* ­ã¦­® «¨ ¨áª âì æ¥­.ãá«®¢¨ï */
            BCID, i = 0, stat = 0;

    ®“¬®«ç ­¨î(role, VSORDLNK_K_ALL);
    ®“¬®«ç ­¨î(mode, "BL");

    mode = StrUpr(mode);
    needBnr = (Index(mode, "B") > 0);
    needLeg = (Index(mode, "L") > 0);

    while((i < lnk_array.size) and (stat == 0)) 

          BCID = lnk_array(i).rec.BCID;

          if(needBnr)
            if(not ®¨áª‚¥ªá¥«ï(bnr, BCID))
               Žè¨¡ª ("¥ ­ ©¤¥­ ¢¥ªá¥«ì ", BCID);
               stat = 1;
            end;
          end;

          if((stat == 0) AND needLeg)
            if (not ®¨áª–¥­®¢ëå“á«®¢¨©‚¥ªá¥«ï(leg, BCID))
              stat = 1;
              Žè¨¡ª ("¥ ­ ©¤¥­ë æ¥­®¢ë¥ ãá«®¢¨ï ¢¥ªá¥«ï ",BCID);
            end;
          end;

          if(stat != 0)
            /* ã¦¥ ®è¨¡ª  */
          elif(ExecMacro2(@action, bnr, leg, null/*emi*/, ord, i, lnk_array(i), @data, null/*emiLnk*/) == 0)
            // „-à í¬¨áá¨¨ ­¥ ¨é¥¬, ­® ¯ à ¬¥âàë ®áâ ¢«¥­ë ¤«ï á®¢¬¥áâ¨¬®áâ¨ á MACRO „«ïŠ ¦¤®£®‚¥ªá¥«ï
            i = i + 1;
          else
            stat = 1;
          end;

    end;

    return stat;
END;


