/*
$Name:        vsconv.mac
$Module:      Векселя банка
$Description: Конвертация валют
*/

IMPORT FIInter, "dlmisc.mac";

// Конвертирует сумму на дату в другую валюту.
//
MACRO VS_Convert( Сумма:money/*Simanov*/, Дата, From, To, err )
var
   СуммаКонв = Сумма,
   Курс = 1.0;

   if(ValType(Дата) != V_DATE)
      Дата = {curdate};
   end;

   if(ValType(To) != V_INTEGER)
      To = NATCUR;
   end;

   if (Сумма == 0.0)
     return 0.0;
   end;

   if( (From != To) and (From != -1) and (To != -1) )
     if (ConvSum (СуммаКонв/*Курс*/, Сумма/*$1*/, Дата, From, To) == 0)
       //СуммаКонв = Курс * Сумма;
     else
       /* попробуем найти обратный курс */
       if (ConvSum (СуммаКонв/*Курс*/, Сумма/*$1*/, Дата, To, From) == 0)
         if( СуммаКонв != 0 )
           //СуммаКонв = Сумма / Курс;
         else
           msgbox("Неверное (нулевое) значение курса валюты ", ПолучитьКодФинИн(From, err), " за ", IIF(Дата != ZeroDate, Дата, "00.00.0000"));
         end;
       else
         msgbox("Не найден курс валюты ", ПолучитьКодФинИн(From, err), " за ", IIF(Дата != ZeroDate, Дата, "00.00.0000"));
       end;
     end;
   end;

   return СуммаКонв;
END;
