/**
 @file vsb070ou.mac
 @brief Операция "Мена векселей". Шаг "Формирование сертификатов векселей".
  vs - вексель
   b - операция мены векселей (barter)
 070 - номер (соответствующий шагу)
  ou - в настоящее время ничего не обозначает (осталось исторически)
  
  # tag
 - functional_block:Векселя
 - code_type:BP_Step
 - Векселя банка
 
  # changeLog
 |date       |author         |tasks                                                     |note                                                        
 |-----------|---------------|----------------------------------------------------------|-------------------------------------------------------------
 |           |Велигжанин А.В.|                                                          | Создание
 |02.04.2025 |Топорков Д.В.  |BOSS-7972                                                 | Новая версия
 */
import "vsform.mac", vsdates;

/**
 @brief Выполнение шага
*/
macro ExecuteStep(Buffer, dl_order)
  var StepDate;

  record order( dl_order );
  SetBuff( order, dl_order );

  if(not VS_TestStepDate(DATE_BART_DOC, @StepDate, order.SignDate))
    return 1;
  end;

  FillBnrForm(order);

  return 0;
end;


/**
 @brief Функция постобработки
*/
macro PostStep (    
                CommitOrRollback, /*1-выполнение шага,2 -отакат шага*/
                errTrn,        /* Статус выполнения шага-!0-произошла ошибка */
                FirstDoc,      /* Указатель на первичный документ */
                ID_Operation,  /* Номер экземпляра операции */
                Num_Step,      /* Номер шага операции(из настроек) */
                Kind_Operation,/* Вид операции */
                KindDoc,       /* Вид первичного документа */
                KindStep,      /* Вид шага операции */
                ID_Step)       /* Номер шага операции */

    if (errTrn OR (CommitOrRollback==2)) 
        /* Произошла ошибка или происходит откат */
        return;
    end;

    return 1;

end;


/**
 @brief Функция печати шага
*/
macro PrintStepDocs (ID_Operation,  // Номер экземпляра операции
                     ID_Step,       // Номер шага операции
                     Kind_Operation,// Вид операции
                     KindStep)      // Вид шага операции

  if (FillBnrFormByOperationID(ID_Operation) != 0)
    return 1;
  end;
  
  exit(1);
end;


