/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vs4eacha.mac
  Programmer  : Велигжанин А.В.
  Comment     : Итератор для выполнения действий для каждого агента
                по векселю
  Функции     : ДляКаждогоАгента
└───────────────────────────────────────────────────────────────────────────*/
import FIInter;


/*  Для каждого агента, связанного с текущим векселем 'BCID',
    выполняет действие 'action'.
    Возвращает 0, если все действия произведены успешно
      data - общие данные
*/
MACRO ДляКаждогоАгента(BCID, action, data:@variant)
PRIVATE var 
            ag = TBfile ("vsircag"), Ok, i;

    ag.keyNum = 1;   /* Индекс BCID + AgentRole + DateOfSigning + Id */
    ag.rec.AvoirKind = AVOIRISSKIND_BILL;
    ag.rec.BCID = BCID;
    Ok = ag.GetGE;

    i = 0;
    while(Ok)
       Ok = ((ag.rec.BCID == BCID) and (ag.rec.AvoirKind == AVOIRISSKIND_BILL));
       if(Ok)
          if(ExecMacro2(@action, ag, i, @data) == 0)
            i = i + 1;
          else
            return 1;
          end;

          Ok = ag.next;
       end;
    end;

    return 0;

END;


