/*
$Name:         vsacc.mac
$Module:       Учтенные векселя
$Description:  Получить счет векселя
*/

IMPORT CTInter, mccatacf, dlmisc;

const VS_FNDACC = 11;

/* Возвращает false, если ошибка или отказ от ввода счета.
*/
MACRO ПолучитьСчетВекселя(
    CatCode,       /* код категории */
    fd,            /* первичный документ */
    FindAccount,   /* здесь вернется номер счета */
    /*необязательные параметры*/
    AccCreate,     /* признак верификации\открытия лицевого счета       */
    Currency,      /* если задан код валюты, то получаем счет по этой
                      валюте, иначе используем основную валюту */
    AccBuf,        /* буфер для найденного\открытого счета (account.dbt)*/
    ActionDate,    /* дата действия */
    FIRole,        /* роль финансового инструмента */
    DepartmentID,
    IsDisableMessage, /*Отключение сообщения об ошибке*/
    IsCommon
)
var
    stat = 0;
    IsCommon = IIF(valType(IsCommon) == V_UNDEF, false, IsCommon);

    if (ValType(FIRole)==V_UNDEF)
        FIRole = 0;
    end;

    if(AccCreate == VS_FNDACC)

       FindAccount = MC_GetAccountNumber(
           CatCode,
           fd,
           ActionDate,             /* ActionDate */
           0,                      /* немассовый режим */
           Currency,               /* валюта проводки. если -1, то не определена */
           FIRole                  /* роль финансового инструмента */
       );

    else
       if(not IsCommon)
       FindAccount = MC_FindAndOpenAccountEx (
           CatCode,
           fd,
           ActionDate,             /* ActionDate */
           0,                      /* немассовый режим */
           AccCreate,              /* Создавать счет ?*/
           AccBuf,
           Currency,               /* Валюта проводки */
           null,
           null,                   /* PairAcc */
           null,
           FIRole,                 /* роль финансового инструмента */
           null,
           null,
           DepartmentID
       );
       else
        FindAccount = MC_FindAndOpenCommonAccByFD(
            CatCode,
            fd,
            ActionDate,
            0,
            AccCreate,
            AccBuf,
            Currency,
            null,
            null,
            null,
            FIRole,
            null,
            null,
            DepartmentID,
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            null
    	  );
      end;

    end;

    if(FindAccount == "")
        If (Not ((ValType(IsDisableMessage) == V_BOOL) and (IsDisableMessage == true)))
          msgbox("Ошибка в получении счета:|категория: ", CatCode);
        end;
        stat = 1;
    else
        SetParm( 2, FindAccount );
    end;

    return (stat == 0);
END;

