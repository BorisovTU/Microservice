/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vsb065in.mac
                                vs-вексель
                                 b-операция мены векселей (barter)
                               065-номер (соответствующий шагу)
                                tn-настройка операции (tuning)
  Programmer  : Азарёнок Ю.Г.
  Операция    : Мена векселей
  Шаг         : Есть новые векселя ?
└───────────────────────────────────────────────────────────────────────────*/
IMPORT DealsInter, vs4each;

PRIVATE var 
   ДогМены,
   ПервыйНовВексель=false;

PRIVATE MACRO ПоикНовВекс(bnr, leg, emi, order, numOrd, lnk)

 if (lnk.rec.IsPartycular == "X")
   ПервыйНовВексель=true;
 end;
   return 0;
END;

/* 
*/
PRIVATE MACRO ПоискНовыхВекс()
var stat=ДляКаждогоВекселя(ДогМены, @ПоикНовВекс, VSORDLNK_K_EMISSION,null, null);
    return (stat==0);
END;

/* Запуск шага
*/
MACRO ExecuteCaseStep(OperationKind, StepNumber, dl_order)

 record order(dl_order);
 SetBuff( order, dl_order );
 ДогМены = order;
 ПервыйНовВексель=false;

   if( not ПоискНовыхВекс() )
     msgbox("Ошибка при поиске векселей для погашения");
   end;
   if (ПервыйНовВексель)
     return "70";   /* Формирование сертификатов векселей */
   else
     return "90";   /* Выдача векселей */
   end;

END;
