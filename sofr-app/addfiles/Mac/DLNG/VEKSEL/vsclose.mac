/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vsclose.mac
  Programmer  : Велигжанин А.В.
  Comment     : Закрытие договора
                Общая часть, выполняемая в операциях эмиссии и мены
└───────────────────────────────────────────────────────────────────────────*/
IMPORT RsbDataSet, vscateg, VSInter, vs4each, dlclose;


/* Проверка векселей.
*/
PRIVATE MACRO ПроверитьПогашенЛиВексель(bnr, leg, emi, order, numOrd, lnk)
  return 0; //Simanov. Убрал все проверки, т.к. операция выдачи закрывается сразу
END;


/* Запуск шага. Шаг является последним.
   В случае успешного выполнения шага
   статус договора автоматически становится закрытым.
   При откате шага - статус договора открытый.
*/
MACRO ПроверкаПриЗакрытии(order)
var 
   stat=ДляКаждогоВекселя(order, @ПроверитьПогашенЛиВексель, VSORDLNK_K_EMISSION, null,"BL");
   return (stat==0);
END;

