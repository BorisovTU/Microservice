/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vsfmonum.mac
  Programmer  : Велигжанин А.В.
  Comment     : Генерация номера распоряжения по бланкам векселей.
└───────────────────────────────────────────────────────────────────────────*/
IMPORT BankInter;

/* Идентификатор референса
*/
PRIVATE CONST
              REF_ID = 85;


/* Генерация номера распоряжения по бланкам векселей.
*/
MACRO VS_GetFmoNumber( fmo )
var
  s = "", err = 0;

  if(GenerateReference(REF_ID, s) != 0)
    msgbox("Ошибка при генерации референса");
    err = 4792;   /* 4792 ошибка при генерации референса */
  else
    fmo.rec.DocNumber = s;
  end;

  return err;
END;


/* Проверка: номер договора должен быть
   задан.
*/
MACRO VS_CheckFmoNumber( FmoBuf )
var
    fmo = TRecHandler("vsfrmord"),
    err = 0;

  if(FmoBuf.DocNumber == "")
     if(not GetTrue(true, String("Поле <номер распоряжения> не заполнено. ",
                                 "|Сформировать номер автоматически ?")))
        err = 1;
     else 
        copy( fmo, FmoBuf );
        err = VS_GetFmoNumber( fmo );
        if (not err)
          FmoBuf.DocNumber = fmo.rec.DocNumber;
        end;
     end;
  end;

  return err;
END;

