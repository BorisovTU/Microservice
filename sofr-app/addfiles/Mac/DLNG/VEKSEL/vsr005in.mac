/*
$Name:         vsr005in.mac
$Module:       Векселя банка
$Description:  Погашение векселя. Инициализация операции

               vs-вексель
                r-операция погашения векселя (Repayment)
              005-номер (соответствующий шагу)
               in-инициализация
*/

IMPORT InsCarryDoc, vsdates, vslib, vsrepay6;

/* Запуск шага
*/
MACRO ExecuteStep(Buffer, dl_order)
    var stat = 0, paym = null;
    record order(dl_order); SetBuff(order, dl_order);

    if(not ИнициализацияПогашения(order, order.SignDate))
        stat = 1;
    end;

    if((stat == 0) and not НайтиПлатежПоДоговору(@paym, order, -1))
        stat = Ошибка("Не найден платеж по договору");
    end;

    if((stat == 0) and not OprReplanStepPlanDates(DATE_EMI_PAY, paym.ValueDate)) // Дата оплаты
        stat = 1;
    end;

    return stat;
END;
