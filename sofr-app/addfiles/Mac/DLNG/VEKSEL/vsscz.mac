/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vsscz.mac
  Created     : 27.08.2001
  Programmer  : Азаренок Ю.
  Comment     : договор залога
└───────────────────────────────────────────────────────────────────────────*/

Import BankInter, DealsInter, vsordnum, vslib, vs4each, vsordchk;

RECORD ДоговорЗалога (dl_order);
RECORD СтарыйДоговорЗалога (dl_order);

MACRO ФункцияПользователя_ДоговорЗалога (Режим)
    msgbox(String("Выполняется макрофункция с именем|",
                  "ФункцияПользователя,|",
                  "которая определена в файле|",
                  "vsscz.mac|",
                  "договор залога"));
    return 0;
END;

MACRO Новый_ДоговорЗалога ()
    return 0;
END;

//Simanov. Пользовательские проверки
private macro User_check (order)
  var stat = 0;

  if (order.Flag1 == "X") //Если установлен признак - формируются проводки по внебалансу, которых нам не надо
    MsgBox("Снимите признак \"Оформить прием/выдачу\"");
    stat = 1;
  end;

  return stat;
End;

MACRO Проверить_ДоговорЗалога (Режим)
 var stat=0;

  if ( Режим == OBJ_DELETE )    
    return 0;
  elif ( Режим == OBJ_UPDATE)
    if ( ПроверитьНомерДоговора(ДоговорЗалога))
      return 1;
    elif ( ВажнИзмДог(СтарыйДоговорЗалога, ДоговорЗалога) )  
      return 1;
    elif ( User_check(ДоговорЗалога) )
      return 1;
    end;
  elif ( Режим == OBJ_DELETEOPR)
    return 0;
  elif ( Режим == OBJ_INSNOTOPR)
    if ( User_check(ДоговорЗалога) )
      return 1;
    end;
    return ПроверитьНомерДоговора(ДоговорЗалога);
  elif ( Режим == OBJ_STARTOPR)
    if(VS_CheckOrderStartOpr(ДоговорЗалога) != 0)
       return 1;
    else
       // Проверяет, был ли у векселя статус "оформлен" или "выдан" на дату подписания договора
       return ПроверитьСтатусВекселейНаДату( ДоговорЗалога, VSBANNER_STATUS_FORMED, VSORDLNK_K_STORAGE );
    end;
  elif ( Режим == OBJ_COMPLETE)
    return 0; /* Возвращаемое значение не важно. Обработано не будет. */
  elif ( Режим == OBJ_NOTCOMPLETE)
    return 0; /* Возвращаемое значение не важно. Обработано не будет. */
  elif ( Режим == OBJ_AFTERINSERT)
    return VS_CheckOrderAfterInsert(ДоговорЗалога);
  elif ( Режим == OBJ_AFTERUPDATE)
    return VS_CheckOrderAfterUpdate(ДоговорЗалога);
  end;

    return stat;
END;

/* Установка подсказки для скролингов из макроса */
PRIVATE MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStatus:integer, ScrolKind:integer ):string

  //ScrolStatus
  //ORDER_CONTRACT_STATUS_ALL       = -1,      // любой
  //ORDER_CONTRACT_STATUS_PREP      = 0,       // отложенные
  //ORDER_CONTRACT_STATUS_OPENED    = 10,      // открытые
  //ORDER_CONTRACT_STATUS_CLOSED    = 20      // закрытые

  //пример
  if(TableName == "ddl_order_dbt")
    //return "/*+FIRST_ROWS LEADING(t) INDEX(t ddl_order_dbt_idx0)*/";
  end;

  return DefaultHint;

END;