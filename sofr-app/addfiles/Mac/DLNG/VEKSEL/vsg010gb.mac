/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vsg010gb.mac
                                vs-вексель
                                 g-операция получение бланков векселей (get)
                               010-номер (соответствующий шагу)
                                gb-get blanks (получение бланков)
  Programmer  : Велигжанин А.В.
  Операция    : Получение бланков векселей из кассы.
  Убрана проводка по бланкам
└───────────────────────────────────────────────────────────────────────────*/
IMPORT FIInter, VSInter,
       vsdates, vsfmofd, vscateg, vsprord, vsprlib, vsrep;

/* Выполняет проводку "ПриемКасса"
*/
PRIVATE MACRO ПроводкаПриемКасса()
  return true;
END;


/* Запуск шага
*/
MACRO ExecuteStep(Buffer, fmo_buf)
var
    UseOper, SendToDep, Branch, StepDate,OperPartyID = -1,
    stat = 0;

    record fmo( vsfrmord );
    SetBuff( fmo, fmo_buf );

    if(not VS_TestStepDate(DATE_BLNK_DOC, @StepDate, fmo.Signed, " даты распоряжения "))
       return 1;
    end;

    UseOper = fmo.Oper;

    if ((fmo.SendToDepartment > 0) and (fmo.SendToDepartment == fmo.Department))
      if ({OperDprt} != fmo.SendToDepartment)
        msgbox("Выполнение возможно только в филиале-адресате операции \"Передача бланков в филиал\"");
        stat = 1;
      end;
      UseOper = {oper};
      SendToDep = fmo.SendToDepartment;
      Branch = {OperDprtNode};
    end;

    /*Simanov. Проводки не нужны
    if (not stat)
      if(not ПроводкаПриемКасса(fmo, StepDate))
         stat = 1;
      else
         if ((OperPartyID = GetPerson(UseOper)) < 0 )
            stat = 1;
         else      
            VS_SetStatusToBlanks(fmo.FrmOrdId, VSFORM_STATUS_INCASH, OperPartyID, StepDate, Branch, NULL, SendToDep);
         end;
      end;
    end;
Simanov*/

    VS_SetStatusToBlanks(fmo.FrmOrdId, VSFORM_STATUS_INCASH, OperPartyID, StepDate, Branch, NULL, SendToDep);

    return stat;
END;


/* Макрос постобработки
*/
MACRO PostStep (
                CommitOrRollback, /*1-выполнение шага,2 -отакат шага*/
                errTrn,        /* Статус выполнения шага-!0-произошла ошибка */
                FirstDoc,      /* Указатель на первичный документ */
                ID_Operation,  /* Номер экземпляра операции */
                Num_Step,      /* Номер шага операции(из настроек) */
                Kind_Operation,/* Вид операции */
                KindDoc,       /* Вид первичного документа */
                KindStep,      /* Вид шага операции */
                ID_Step)       /* Номер шага операции */

    if (errTrn OR (CommitOrRollback==2))
        /* Произошла ошибка или происходит откат */
        return;
    end;

    Печать(true, "vsrep", ID_Operation, ID_step, isOprMultiExec, "СО"); /* Счета, Проводки, МемОрдера */

    return 1;
END;


/* Макрос печати
*/
MACRO PrintStepDocs (
                ID_Operation,  /* Номер экземпляра операции */
                ID_Step,       /* Номер шага операции */
                Kind_Operation,/* Вид операции */
                KindStep)      /* Вид шага операции */

    if(not Печать(false, "vsrep", ID_Operation, ID_step, isOprMultiExec, "СО")) /* Счета, Проводки, МемОрдера */
      msgbox("Нет документов для печати");
      exit(1);
    end;

    return 1;
END;


