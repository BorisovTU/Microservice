/*
$Name:         vsz4_20.mac
$Module:       Векселя банка
$Description:  Залог векселей. Возврат для погашения векселей из залога. Списание с подотчета погашенного векселя
*/

IMPORT OprInter, vsdates, vszlib;

PRIVATE record ord("dl_order");
PRIVATE VAR StepDate;

PRIVATE MACRO СписатьСПодотчетаВексель(bnr, leg)
var
    stat = 0;

    if(not VSZLIB_ПроводкаЗалога("списание с подотчета", ord, bnr, leg, StepDate))
        stat = 1;
    end;

    return stat;
END;

MACRO ExecuteStep(docbuf, ordbuf)
var
    stat = 0;

    SetBuff(ord, ordbuf);

    if(not VS_TestStepDate(DATE_PAWN_DOC, @StepDate, ord.SignDate))
        stat = 1;
    end;

    if(stat == 0)
        stat = ДляКаждогоВекселя(ord, @СписатьСПодотчетаВексель, null, null, "BL");
    end;

    return stat;
END;
