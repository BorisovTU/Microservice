/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vsb100.mac
                                vs-вексель
                                 b-операция мены векселей (barter)
                               100-номер (соответствующий шагу)
  Programmer  : Велигжанин А.В.
  Операция    : Мена векселей
  Шаг         : Закрытие договора.
  Comment     : Используется общий код для операций мены и эмиссии
                (см. vsclose)
└───────────────────────────────────────────────────────────────────────────*/
IMPORT vsclose, vsdates, vsaccclose;


/* Запуск шага
*/
MACRO ExecuteStep(Buffer, dl_order, DocKind, ID_Operation, ID_Step)
var StepDate = {curdate}, stat = 0;

    record order( dl_order );
    SetBuff( order, dl_order );

    if(not VS_TestStepDate(DATE_BART_DOC, @StepDate, order.SignDate))
       return 1;
    end;

    if(not DL_TestAllSteps(ID_Operation, ID_Step))
       msgbox("Нельзя закрыть договор:|в операции есть невыполненные шаги.");
       stat = 1;
    elif(not ПроверкаПриЗакрытии(order))
       stat=1;
    end;

    if (stat == 0)
        if(not ЗакрытьСчетаВекселя(order, StepDate)) 
           stat = 1;
        end;
    end;

    return stat;

END;


