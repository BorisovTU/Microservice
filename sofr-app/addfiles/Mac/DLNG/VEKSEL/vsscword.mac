/*
$Name:         vsscword.mac
$Module:       Векселя банка
$Description:  Распоряжение на списание ранее выкупленных векселей
*/
Import BankInter, vsordchk;

private var СписНеПредъяв = 14912;

RECORD РаспСписВык (vsfrmord);
RECORD СтарыйРаспСписВык (vsfrmord);

MACRO ФункцияПользователя_РаспСписВык (Режим)
  var mnu = tarray(), imnu = 0;

  if (РаспСписВык.Kind_Operation == СписНеПредъяв) 
    mnu(imnu) = "Распоряжение о списании с баланса векселя";
    imnu = imnu + 1;
  end;

  if(imnu > 0)
    imnu = -2;
    imnu = menu(mnu);
    if(imnu >= 0)
      if(mnu(imnu) == "Распоряжение о списании с баланса векселя")
        ExecMacroFile("printdocs.mac", "VD_38", РаспСписВык);
      end;
    end;
  end;

  return 0;
END;

MACRO Новый_РаспСписВык ()
    return 0;
END;

PRIVATE MACRO Проверить_НачалоОперации()
var stat = 0;

    stat = VS_CheckOrderStartOpr(РаспСписВык);

    return stat;
END;

MACRO Проверить_РаспСписВык(Режим)
var
    stat = 0;

    if ( Режим == OBJ_DELETE )    
        return 0;
    elif ( Режим == OBJ_UPDATE)
        return 0;
    elif ( Режим == OBJ_DELETEOPR)
        return 0;
    elif ( Режим == OBJ_INSNOTOPR)
        return 0;
    elif ( Режим == OBJ_STARTOPR)
        return Проверить_НачалоОперации();
    elif ( Режим == OBJ_COMPLETE)
        return 0;/* Возвращаемое значение не важно. Обработано не будет. */
    elif ( Режим == OBJ_NOTCOMPLETE)
        return 0;/* Возвращаемое значение не важно. Обработано не будет. */
    elif ( Режим == OBJ_AFTERINSERT)
        return 0;
    elif ( Режим == OBJ_AFTERUPDATE)
        return 0;
    end;

    return stat;
END;

/* Установка подсказки для скролингов из макроса */
PRIVATE MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStatus:integer, ScrolKind:integer ):string

  //ScrolStatus
  //ORDER_CONTRACT_STATUS_ALL       = -1,      // любой
  //ORDER_CONTRACT_STATUS_PREP      = 0,       // отложенные
  //ORDER_CONTRACT_STATUS_OPENED    = 10,      // открытые
  //ORDER_CONTRACT_STATUS_CLOSED    = 20      // закрытые

  //пример
  if(TableName == "dvsfrmord_dbt")
    //return "/*+FIRST_ROWS LEADING(t) INDEX(t dvsfrmord_dbt_idx0)*/";
  end;

  return DefaultHint;

END;

private const   
    Ошибка   = 0,
    Первый   = 1,
    Последний= 2,
    Создание_операции = 0,
    Перевод_в_отложенные = 1,
    Удаление_операции = 2;


MACRO Печать_ОтчетСканирования (Вызов, firstdoc, Статус, Сообщение, Действие)
    setbuff(РаспСписВык, firstdoc);
    if (Вызов == Первый)
        if (Действие == Создание_операции)
[            Отчет о групповом создании операций для распоряжений на списание ранее выкупленных векселей.];
        elif (Действие == Перевод_в_отложенные)
[            Отчет о групповом переводе распоряжений на списание ранее выкупленных векселей в отложенные.];
        elif (Действие == Удаление_операции)
[            Отчет о групповом удалении операций для распоряжений на списание ранее выкупленных векселей.];
        else
[             Отчет о групповой операции с распоряжениями на списание ранее выкупленных векселей.];
        end;

[┌────────────────────┬───────┬───────────────────────────────────────────────────────────┐];
[│       Номер        │№ошибки│                 Сообщение                                 │];
[│      документа     │       │                                                           │];
[├────────────────────┼───────┼───────────────────────────────────────────────────────────┤];
    elif (Вызов == Ошибка)
            if (Статус == 0)
                if (Действие == Создание_операции)
                    Сообщение = "Операция создана успешно";
                elif (Действие == Перевод_в_отложенные)
                    Сообщение = "Перевод в отложенные выполнен успешно";
                elif (Действие == Удаление_операции)
                    Сообщение = "Операция удалена успешно";
                else
                    Сообщение = "Действие выполнено успешно";
                end;
            end;
[│####################│#######│###########################################################│](РаспСписВык.DocNumber, Статус, Сообщение);
    elif (Вызов == Последний)                                                   
[└────────────────────┴───────┴───────────────────────────────────────────────────────────┘];
    end;  
END;

