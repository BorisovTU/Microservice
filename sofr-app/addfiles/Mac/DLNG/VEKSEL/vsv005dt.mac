/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : vsv005dt.mac
                                vs-вексель
                                 v-операция выкупа векселя
                               005-номер (соответствующий шагу)
                                dt-dates
  Операция    : Выкуп собственных векселей банка
  Шаг         : Инициализация дат
  Comment     :
└───────────────────────────────────────────────────────────────────────────*/
IMPORT InsCarryDoc, vsdates, vslib;
import "mail.mac", oralib, likepy;

/* АЛГОРИТМ ШАГА:
    1. Инициализация даты Выполнение платежа.
*/
MACRO ExecuteParamStep(OperationKind, DocKind, Document)
var stat = 0, paym, ToDeposit;

    record order (dl_order);
    SetBuff(order, Document);

    if(not НайтиПлатежПоДоговору(@paym, order, PM_PURP_VEKSELDRAW))
      stat = Ошибка("Не найден платеж по договору");
    else
      DefineOprDate( DATE_REP_PAY,         paym.ValueDate);      /* Выполнение платежа */
    end;

    return stat;
END;


/* Макрос постобработки 
*/
MACRO PostStep (
                CommitOrRollback, /*1-выполнение шага,2 -отакат шага*/
                errTrn,        /* Статус выполнения шага-!0-произошла ошибка */
                FirstDoc,      /* Указатель на первичный документ */
                ID_Operation,  /* Номер экземпляра операции */
                Num_Step,      /* Номер шага операции(из настроек) */
                Kind_Operation,/* Вид операции */
                KindDoc,       /* Вид первичного документа */
                KindStep,      /* Вид шага операции */
                ID_Step)       /* Номер шага операции */
    record order( dl_order );
    SetBuff( order, FirstDoc );
    var v_email_processor = email_proc_env();
    var mail_arr;

    if (errTrn OR (CommitOrRollback==2)) 
        /* Произошла ошибка или происходит откат */
        return;
    end;

    return 1;
END;


/* Макрос печати 
*/
MACRO PrintStepDocs (
                ID_Operation,  /* Номер экземпляра операции */
                ID_Step,       /* Номер шага операции */
                Kind_Operation,/* Вид операции */
                KindStep)      /* Вид шага операции */

    return 1;
END;
