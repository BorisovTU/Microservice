/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : vsc005in.mac
                                vs-вексель
                                 c-операция зачет требований (interChange)
                               005-номер (соответствующий шагу)
                                in-инициализация
  Операция    : Зачет взаимных требований
  Шаг         : Инициализация операции
└───────────────────────────────────────────────────────────────────────────*/
IMPORT InsCarryDoc, PaymInter, vsdates, vslib;


/* Запуск шага
*/
MACRO ExecuteParamStep(OperationKind, DocKind, Document)
var
   stat = 0, paym;

   record order( dl_order );
   SetBuff(order, Document);

   if(not НайтиПлатежПоДоговору(@paym, order, PM_PURP_VSDIFF2C))  /* оплата разницы по договору клиенту */
      if(not НайтиПлатежПоДоговору(@paym, order, PM_PURP_VSDIFF2B))  /* оплата разницы по договору банку */
         stat = Ошибка("Не найден платеж по договору");
      end;
   end;
   
   if(stat == 0)
      if (paym.PayerAmount == 0)
        DefineOprDate(DATE_EMI_PAY, order.SignDate); // 94323 
      else
        DefineOprDate( DATE_EMI_PAY, paym.ValueDate);      /* Дата оплаты */
      end;        
//   elif(OprReplanStepPlanDates( DATE_EMI_PAY, paym.ValueDate ) == false) // Дата оплаты
//      stat = 1;
   end;

   return stat;
END;


