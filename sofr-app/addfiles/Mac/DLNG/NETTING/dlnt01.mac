/*
$Name:        dlnt01.mac
$Module:      Неттинг
$Description: макрос шага "Инициализация"
*/
IMPORT FIInter, InsCarryDoc, "dlntlib.mac", Календарь;
  RECORD ntg_buff ("dl_nett");

MACRO ExecuteParamStep( kind_oper, BOf_kind, FDoc )
//RECORD ntg_buff ("dl_nett");

  SetBuff(ntg_buff, FDoc);

  DefineOprDate(0, ntg_buff.ValueDate);
  DefineOprDate(2, ntg_buff.ValueDate);

  if( ntg_buff.IdentProgram <= 0 )
     MsgBox( "В сделке не задан модуль, к которому она относится. Необходимо заполнить поле ddl_nett_dbt.t_IdentProgram." );
     return 1;
  end;

  if( (ntg_buff.IdentProgram != 14/*IP_SEC*/) and (ntg_buff.FI_Kind == FIKIND_AVOIRISS) )
     msgbox("Неттинг по ц/б может выполняться только в БО Ц/Б");
     return 1;
  end;

  return 0;
END;

MACRO PostStep (    
                CommitOrRollback, /*1-выполнение шага,2 -откат шага*/
                errTrn,        /* Статус выполнения шага-!0-произошла ошибка */
                FirstDoc,      /* Указатель на первичный документ */
                ID_Operation,  /* Номер экземпляра операции */
                Num_Step,      /* Номер шага операции(из настроек) */
                Kind_Operation,/* Вид операции */
                KindDoc,       /* Вид первичного документа */
                KindStep,      /* Вид шага операции */
                ID_Step)       /* Номер шага операции */  


  SetBuff(ntg_buff, FirstDoc );
  if ( CommitOrRollback == 1 )
      execmacrofile("dl_mt", "Kontr_plat",ntg_buff.nettingid) ;
  end;

  return 0;
END;

