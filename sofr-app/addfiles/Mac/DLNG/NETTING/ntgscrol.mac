/*
$Name:        ntgscrol.mac
$Module:      Неттинг
$Description: Макрос применяется для инициализации и проверки параметров сделки в скроллинге сделок неттинга
*/
import BankInter, TSInter, "dlntlib.mac";

const NTG_DEFER = 0;

RECORD Сделка(dl_nett);         /* текущая сделка */
RECORD СтрСделка(dl_nett);      /* сохраненная сделка */

var HasPayms;                   /* существуют ли платежи */

MACRO Новая_Сделка()
    return 0;
END;

MACRO CmpDeal( Режим )
    if( (Режим == OBJ_UPDATE) OR (Режим == OBJ_INSERT) OR (Режим == OBJ_STARTOPR) )
       if( Сделка.IdentProgram <= 0 )
          MsgBox( "В сделке не задан модуль, к которому она относится. Необходимо заполнить поле ddl_nett_dbt.t_IdentProgram." );
          return 1;
       end;
    end;

    if( (Режим == OBJ_UPDATE) AND (Сделка.Status != NTG_DEFER) AND
        ((Сделка.Contractor != СтрСделка.Contractor) OR
         (Сделка.ValueDate != СтрСделка.ValueDate)) )
        MsgBox("Произведенные изменения возможны только в отложенных сделках.| Для этого переведите сделку в отложенные...");
        return OBJ_IMPORTANT;     /*  важные изменения */
    end;
    return 0;  
END;

MACRO Проверить_Сделку( Режим )

     if( (Режим == OBJ_UPDATE) OR (Режим == OBJ_INSERT) )
         return CmpDeal( Режим );   

     elif( (Режим == OBJ_STARTOPR) )
         if( CmpDeal( Режим ) != 0 )   
            return -1;
         end;
     elif( Режим == SCR_USERVIEW ) 

        /*  можно переопределить текущий режим редактирования  */
        /*  return 1; просмотр */
        /*  return 2; редактирование */
        return 0; /*отставить текущий режим редактирвоания без изменения*/       
     end;

     return 0;
END;

MACRO Функция_Пользователя( Режим )
  return 0;
END;

MACRO HINT_PMLINK()
    return "/*+CHOOSE LEADING(t) INDEX(t DPMLINK_DBT_IDX1)*/";
END;
