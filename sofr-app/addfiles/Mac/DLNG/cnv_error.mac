/*
// КЛАСС, ЗАПИСЫВАЮЩИЙ ОШИБКИ В МАССИВ
*/

class ErrorRecorder(_ViewErrors, _ViewWarnings)
   var Errors   = tarray;        // текст ошибки
   var warnings = Tarray;        // текст предупреждения
   var QuantErrors   = 0;        // количество ошибок
   var QuantWarnings = 0;        // количество предупреждений
   var IsWarning     = false;    // наличие предупреждения
   var IsError       = false;    // наличие ошибки
   var ViewErrors    ;
   var ViewWarnings  ;

   private macro iif(a,b,c)
      if(a)
         return b;
      else
         return c;
      end;
   end;

/****** ДОБАВИТЬ СТРОКУ ОШИБКИ ******/
   macro Add(str,stat)
      if(stat)                   // если передаем true - ошибка, иначе предупреждение
         Errors(Errors.size)     = str;
         IsError                 = true;
      else
         Warnings(Warnings.size) = str;
         isWarning               = true;
      end;
      return true;
   end;

/****** ПРОСМОТРЕТЬ ОШИБКИ ******/
   macro RepErr(num)
      var   i   =  1;
      var   str =  "";

      if   (valtype(Num) != V_INTEGER)                        // при любом нечисловом аргументе

         while(i   <= errors.size)
            str = str + string(i) +". ERR! " + Errors(i-1);        // выводим все имеющееся в массиве
            str = str + "\n";
            i   = i   + 1;
/*
            if(i   <=  Errors.size )                           // добавлять символ переноса
               str = str + "\n";                              // на всех кроме последнего
            end;
*/  
         end;
      elif((valtype(Num) == V_INTEGER  ) and                  // при числовом 
           (Num          <= Errors.size)   )                  // и имеющемся
         str = string(Num+1) +". ERR! " + Errors(Num);             // выводим соответствующее сообщение
      else                                                    // при числовом но большем чем есть
         str = "Ошибки с номером " + Num + " не найдено";
      end;
      return str;
   end;
/****** ПРОСМОТРЕТЬ ПРЕДУПРЕЖДЕНИЯ ******/
   macro RepWarn(Num)
      var   i   =  1;
      var   str =  "";

      if   (valtype(Num) != V_INTEGER)                        // при любом нечисловом аргументе
         while(i   <= Warnings.size)
            str = str + string(i) +".warn " + Warnings(i-1);        // выводим все имеющееся в массиве
            str = str + "\n";
            i   = i   + 1;
/*
            if(i   <=  Warnings.size )                        // добавлять символ переноса
               str = str + "\n";                              // на всех кроме последнего
            end;
*/
         end;
      elif((valtype(Num) == V_INTEGER  ) and                  // при числовом 
           (Num          <= Warnings.size)   )                  // и имеющемся
         str = string(Num+1) +".warn " + Warnings(Num);             // выводим соответствующее сообщение
      else                                                    // при числовом но большем чем есть
         str = "Ошибки с номером " + Num + " не найдено";
      end;
      return str;
   end;

/****** ПРОСМОТРЕТЬ ВСЕ ******/
   macro Rep()
      var errstr  = "";
      var warnstr = "";
      if(ViewErrors)
         errstr  = RepErr();
      end;
      if(ViewWarnings)
         warnstr = RepWarn();
      end;
      return(trim(errstr + warnstr));
   end;

/****** ПРОСМОТРЕТЬ ВСЕ ПО РЕЗУЛЬТАТАМ РАБОТЫ******/
   macro Show()
      var i = 0;
      var k = 0;
      if(ViewErrors)
         while (i<Errors.size)
            println(string(k+1) +". ERR! " + Errors(i));
            i = i + 1;
            k = k + 1;
         end;
      end;
      i= 0;
      if(ViewWarnings)
         while (i<Warnings.size)
            println(string(k+1) +". warn " + Warnings(i));
            i = i + 1;
            k = k + 1;
         end;
      end;
   end;


/****** ОЧИСТИТЬ ЛОКАЛЬНО ******/
/*   macro ClearLocal()
      Loc = false;
      return true;
   end;
*/
/****** ОЧИСТИТЬ СОДЕРЖИМОЕ ******/
   macro ClearErr(param)
      Errors = NULL;
      Errors = tarray;
      if(param == true)
        IsError = false;
      end;
      return true;

   end;

   macro ClearWarning(param)
      Warnings = NULL;
      Warnings = tarray;
      if(param == true)
        IsWarning = false;
      end;
      return true;
   end;

   macro ClearGlobal()
      ClearErr(true);
      ClearWarning(true);
      return true;
   end;


   if(valtype(_ViewErrors)== V_BOOL)
      ViewErrors = _ViewErrors;
   else
      ViewErrors = true;
   end;
   
   if(valtype(_ViewWarnings)== V_BOOL)
      ViewWarnings = _ViewWarnings;
   else
      ViewWarnings = false;
   end;
end;
