/*******************************************************************************
 DESCRIPTION  :   Отчет "Реестр регистрации лиц, признанных КИ" - форма ввода данных(БО ЦБ, ПИ)
 PROGRAMMED BY:   Nikolskaya  V.
 CREATION DATE:   20.01.10
*******************************************************************************/
import "DlRepForm_h.mac", "globals.mac";

/*Номера полей в форме отчета*/
CONST PNFLD_REESTRKI_OPER_DATE  = 0,
      PNFLD_REESTRKI_WITHOUTCHNG= 1,
      PNFLD_REESTRKI_PRINTEXCEL = 2;

PRIVATE MACRO Default( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( (Cmd == DLG_INIT) OR (Cmd == DLG_CHANGEVALUE) )
    FldShowValue = FldRealValue;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_OperDate( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  VAR Year, Month, BeginDate, EndDate, Period, PeriodYear;

  if( Cmd == DLG_INIT ) 
     if( FldRealValue == null ) 
        FldRealValue = {curdate};
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) 
     FldRealValue = FldShowValue;
     if( FldRealValue > {curdate} )
        MsgBox( "Дата формирования не может быть больше текущей.");
        return CM_IGNORE;
     end;
  elif( (Cmd == DLG_KEY) AND (Key == KEY_F3) ) 
     FldRealValue = GetDateByCalendar( FldRealValue );
     FldShowValue = FldRealValue;
  end;
  return CM_DEFAULT;
END;

CLASS (DL_CPanel) DL_REESTRKI_Panel()

  PRIVATE MACRO Init()
     AddFieldProc( 0, PNFLD_REESTRKI_OPER_DATE,   DL_PNFLD_BEGINDATE,   @FldProc_OperDate,   {curdate} ); 
     AddFieldProc( 0, PNFLD_REESTRKI_WITHOUTCHNG, DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,"" );
     AddFieldProc( 0, PNFLD_REESTRKI_PRINTEXCEL,  DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,"X" );
  END;

  PRIVATE MACRO Check():BOOL
     return true;
  END;

  initDL_CPanel( "dlrep.lbr", "REESTRKI" ); 
END;