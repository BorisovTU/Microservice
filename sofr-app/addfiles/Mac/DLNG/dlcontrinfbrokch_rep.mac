/*
$Name:        dlcontrinfbrokch_rep.mac
$Module:      –¥­­ë¥ ¡ã¬ £¨
$Description: à®â®ª®« ¨§¬¥­¥­¨© § ¯¨á¨ ¢ª« ¤ª¨ "‘¢¥¤¥­¨ï ® ¤à. ¡à®ª¥à å" „
*/
import OprInter, RsbDataSet, "cb_sql.mac", "scsrvrepfun.mac";

MACRO PrintReportDlContrInfBrokCh(InfID:integer):integer
  var errcode, errtext;
  var ReportFileName;
  var query, cmd, DataSet;
  var FirstTime = time(), LastTime = time();
  var First:bool = true;
  FILE ReportOutFile() txt write; /*ä ©« ¢ë¢®¤  ¤«ï ®âç¥â */
  var i = 1;

  ReportFileName = GetTxtFileName("dlcontrinfbrokch");
  if( not Open(ReportOutFile, ReportFileName) )
     errcode = status(errtext);
     RunError("è¨¡ª  ¯à¨ á®§¤ ­¨¨ ä ©« |"+ReportFileName+"|(" + errcode + ") " + errtext);
  end;
  SetOutput( ReportFileName );

  query =   " select ch.*, p.t_Name as OperName "
          + "   from ddlcontrinfbrokch_dbt ch, dperson_dbt p "
          + "  where ch.t_InfID = ? "
          + "    and p.t_Oper = ch.t_Oper "
          + " order by ch.t_ID ASC ";

  cmd = DL_RSDCommand(query);

  cmd.AddParam(InfID);

  DataSet = cmd.Execute();


  println( "à®â®ª®« ¨§¬¥­¥­¨© § ¯¨á¨ ¢ª« ¤ª¨ \"‘¢¥¤¥­¨ï ® ¤à. ¡à®ª¥à å\"");
  println( "ÚÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿\n" +
           "³ ü ³ „ â  ¨§¬¥­¥­¨ï ³     ®«ì§®¢ â¥«ì     ³       ®¬¥à       ³              ¥à¥¤ ¢è¨©             ³            ®¬¥à            ³          „ â          ³           ®¬¥à ¨ ¤ â             ³    Š®«¨ç¥áâ¢®     ³\n" +
           "³   ³                ³                      ³       § ¯¨á¨      ³                ¡à®ª¥à               ³         ¤®£®¢®à  ˆˆ‘        ³      ¤®£®¢®à  ˆˆ‘     ³              á¯à ¢ª¨              ³      «¨áâ®¢       ³\n" +
           "³   ³                ³                      ÃÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄ´\n" +
           "³   ³                ³                      ³   ë«®  ³  ‘â «®  ³       ë«®       ³       ‘â «®      ³     ë«®     ³     ‘â «®    ³    ë«®   ³   ‘â «®   ³       ë«®      ³      ‘â «®      ³   ë«®  ³  ‘â «®  ³\n" +
           "ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄ´");
  while( DataSet.MoveNext() )
     if(i > 1)
       println("ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄ´");
       
     end;
           
           [³###³################³######################³#########³#########³##################³##################³##############³##############³###########³###########³#################³#################³#########³#########³]
           ( i, 
             string(string(date(DataSet.ChangeDate):f) + " " + string(time(DataSet.ChangeTime):f)):c:w, 
             string(string(DataSet.Oper) + " "+DataSet.OperName):w, 
             DataSet.RecNum_Old:c:0,
             DataSet.RecNum_New:c:0, 
             DataSet.BrokerName_Old:c,
             DataSet.BrokerName_New:c,
             DataSet.ContrNumber_Old:c,
             DataSet.ContrNumber_New:c,
             date(DataSet.ContrDate_Old):c:f,
             date(DataSet.ContrDate_New):c:f,
             DataSet.NumAndDateRef_Old:c,
             DataSet.NumAndDateRef_New:c,
             DataSet.ListCount_Old:c,
             DataSet.ListCount_New:c
           );     
     
     i = i + 1;
  end;
     
   println("ÀÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÙ");  

  SetOutput(NULL, true);
  close(ReportOutFile);
  ViewFile(ReportOutFile);

  return 0;
END;