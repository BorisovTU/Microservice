/*
$Name:         ws_md_StartShed.mac
$Module:       Монитор дилера
$Description:  Запуск планировщика для получения данных о котировках
*/

import "ws_md_ReutSettings.mac", "ws_md.mac";

macro StartSheduler()

  var TerminalId; // Идентификатор терминала
  var ErrCode = 0;

  GetRegistryValue( "МОНИТОР ДИЛЕРА\\ИДЕНТИФИКАТОР ТЕРМИНАЛА", V_INTEGER, TerminalId, ErrCode );
  if( ErrCode != 0 )
     MsgBox( "Ошибка при чтении настройки \"" + "МОНИТОР ДИЛЕРА\\ИДЕНТИФИКАТОР ТЕРМИНАЛА" + "\".");
  else
    if ( TerminalId == REUTERS_TERM_ID )
        var reuters = REUTERS_SETTINGS();
        if(  (reuters.GetMacroName()!= "" ) and (reuters.GetProcName()!= "" ) )
           ExecMacroFile(reuters.GetMacroName(), reuters.GetProcName());
        end; 
    elif(TerminalId == MICEX_TERM_ID)
        ExecMacroFile(MICEX_MACRONAME, MICEX_MACROFUNC);
/*TODO: Для других терминалов определить свой макрос и функцию обработки
    elif(TerminalId == ... )      */                       
    else
       MsgBox( "Не задан макрос обработки терминала.");
    end;

  end;
end;

StartSheduler();
