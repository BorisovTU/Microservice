/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : RvaBillOnBalance.mac
  Programmer  : Кастелин А.Н.
  Comment     : контрольные примеры для RsVox объекта RvaBillOnBalance
└───────────────────────────────────────────────────────────────────────────*/

IMPORT RsbObjFactory, dlmisc, HTMLRep, bills;

PRIVATE MACRO DecodeOpCode(code)
    if   (code == 10)
        return "покупка";
    elif (code == 20)
        return "продажа";
    elif (code == 30)
        return "прямое РЕПО";
    elif (code == 40)
        return "обратное РЕПО";
    elif (code == 50)
        return "погашение";
    elif (code == 60)
        return "мена";
    elif (code == 70)
        return "зачисление";
    elif (code == 80)
        return "списание";
    end;
END;

PRIVATE MACRO DecodeFormula(code)
    if (code == 0)
        return "дисконтный ";
    elif   (code == 1) // Простые проценты
        return "процентный";
    elif   (code == 2) // Сложные проценты
        return "процентный";
    elif   (code == 3) // Процентный выданный с дисконтом
        return "дисконтно-процентный";
    else
        return "непонятный";
    end;
END;
//=========================================================
var factory = RsbObjectFactory();
if (factory == NULL)
    msgbox("can't create RsbObjFactory");
    return;
end;

var bnr = factory.GetObject("RvaBillOnBalance");
if (bnr == NULL)
    msgbox("can't create RvaBillOnBalance");
    return;
end;

var rep_date = date(01, 01, 9999);

if (GetDate(rep_date, "Введите отчётную дату:"))
    bnr.SetParmValue("EndDate", rep_date);
end;

bnr.AddSortFld("BCID");

rep_start("..\\txtfile\\RvaBillOnBalance_rep.html", "BillOnBalance " + string(rep_date));

bnr.ApplyFilter();

rep_br("контрольные примеры для RsVox объекта RvaBillOnBalance");
rep_br("");

rep_br("выборка на дату " + string(rep_date));
rep_br("");

rep_tbl_start();

rep_hdr("BCID");
rep("<th colspan=2>""Серия/ номер векселя""</th>");
rep_hdr("Код эмитента");
rep_hdr("Номинал");
rep_hdr("Валюта номинала");
rep_hdr("Валюта платежа по векселю");
rep_hdr("Дата составления");
rep_hdr("Дата предъявления");
rep_hdr("Код формулировки срока");
rep_hdr("Дата ""не ранее""");
rep_hdr("Дата ""не позднее""");
rep_hdr("Плановая дата погашения");
rep_hdr("Срок векселя");
rep_hdr("Процентная ставка");
rep_hdr("Количество дней в году по базе расчёта");
rep_hdr("Дата начала начисления процентов");
rep_hdr("Вид дохода");
rep_hdr("Цена зачисления");
rep_hdr("Валюта цены зачисления");
rep_hdr("Балансовая стоимость в ВН");
rep_hdr("Дата зачисления");
rep_hdr("Код операции зачисления");
rep_hdr("Код вида операции зачисления");
rep_hdr("Дата списания");
rep_hdr("Код операции списания");
rep_hdr("Код вида операции списания");
rep_hdr("Цена списания");
rep_hdr("Код валюты цены списания");
rep_hdr("Дата переноса векселя на просрочку");
rep_hdr("Сумма просроченных процентов в ВН");
rep_hdr("Лицевой счет");
rep_hdr("Категория качества");
rep_hdr("Сумма созданного РВПС");
rep_hdr("Номер л/с по учету резервов");
rep_hdr("Процент резерва");
rep_hdr("Сумма расчетного РВПС");
rep_hdr("Филиал");

rep_tbl_hdrend();

var stat = bnr.Next();
while (stat)

    rep_tbl_group(bnr.bcid);
    rep_tbl_row_start();

    rep_cell(bnr.bcid);                             // BCID
    rep_cell(bnr.series);                           // Серия/номер векселя
    rep_cell(bnr.number);                           // Серия/номер векселя
    rep_cell(bnr.IssuerCode);                       // Код эмитента
    rep_cell(bnr.Principal);                        // Номинал
    rep_cell(bnr.PrincipalCur);                     // Валюта номинала
    rep_cell(bnr.PaymCur);                          // Валюта платежа по векселю
    rep_cell(bnr.Start);                            // Дата составления
    rep_cell(bnr.Presentation);                     // Дата предъявления
    rep_cell(DecodeValidity(bnr.Validity));         // Код формулировки срока
    rep_cell(bnr.Maturity);                         // Дата "не ранее"
    rep_cell(bnr.Expiry);                           // Дата "не позднее"
    rep_cell(bnr.RepaymentDate);                    // Плановая дата погашения
    rep_cell(bnr.RepaymentPeriod);                  // Срок векселя
    rep_cell(bnr.Rate);                             // Процентная ставка
    rep_cell(bnr.DaysInYearByBasis);                // Количество дней в году по базе расчёта
    rep_cell(bnr.InterestStart);                    // Дата начала начисления процентов
    rep_cell(DecodeFormula(bnr.Formula));           // Вид дохода
    rep_cell(bnr.EnrolCost);                        // Цена зачисления
    rep_cell(bnr.EnrolCur);                         // Валюта цены зачисления
    rep_cell(bnr.BalanceCost);                      // Балансовая стоимость в ВН
    rep_cell(bnr.EnrolDate);                        // Дата зачисления
    rep_cell(bnr.EnrolDealCode);                    // Код операции зачисления
    rep_cell(DecodeOpCode(bnr.EnrolOperType));      // Код вида операции зачисления
    rep_cell(bnr.WrtOffDate);                       // Дата списания
    rep_cell(bnr.WrtOffDealCode);                   // Код операции списания
    rep_cell(DecodeOpCode(bnr.WrtOffOperType));     // Код вида операции списания
    rep_cell(bnr.WrtOffCost);                       // Цена списания
    rep_cell(bnr.WrtOffCur);                        // Код валюты цены списания
    rep_cell(bnr.ExpInterestDate);                  // Дата переноса векселя на просрочку
    rep_cell(bnr.ExpInterestAmount);                // Сумма просроченных процентов в ВН
    rep_cell(bnr.Account);                          // Лицевой счет
    rep_cell(bnr.QualityCategory);                  // Категория качества
    rep_cell(bnr.ReserveAmount);                    // Сумма созданного РВПС
    rep_cell(bnr.ReserveAccount);                   // Номер л/с по учету резервов
    rep_cell(bnr.ReservePercent);                   // Процент резерва
    rep_cell(bnr.ReserveClc);                       // Сумма расчетного РВПС
    rep_cell(DL_DepartmentName(bnr.DepartmentID));  // Филиал

    rep_tbl_row_end();

    stat = bnr.Next();
end;

rep_tbl_end();

rep_end();
        
