/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : RvaBillCirculationAgent.mac
  Programmer  : Кастелин А.Н.
  Comment     : контрольные примеры для RsVox объекта RvaBillCirculationAgent
└───────────────────────────────────────────────────────────────────────────*/

IMPORT RsbObjFactory, HTMLRep;

const obj_name = "RvaBillCirculationAgent";

var factory = RsbObjectFactory();
if (factory == NULL)
    msgbox("can't create RsbObjFactory");
    return;
end;

var bca = factory.GetObject(obj_name);
if (bca == NULL)
    msgbox("can't create " + obj_name);
    return;
end;

var rep_date = date(01, 01, 9999);

if (GetDate(rep_date, "Введите отчётную дату:"))
    bca.SetParmValue("EndDate", rep_date);
end;

bca.AddSortFld("BCID");
bca.AddSortFld("AgentRole");

rep_start("..\\txtfile\\" + obj_name + "_rep.html", obj_name + " " + string(rep_date));

rep_br("контрольные примеры для RsVox объекта " + obj_name);
rep_br("");

rep_br("выборка на дату " + string(rep_date));
rep_br("");

rep_tbl_start();

rep_hdr("BCID");
rep("<th colspan=2>""Серия/ номер векселя""</th>");
rep_hdr("AgentID");
rep_hdr("Субъект");
rep_hdr("Роль");
rep_hdr("Сумма");
rep_hdr("Валюта");
rep_hdr("Дата");

rep_tbl_hdrend();

var stat = bca.Next();
while (stat)

    rep_tbl_group(bca.bcid);
    rep_tbl_row_start();

    rep_cell(bca.bcid);                         // BCID
    rep_cell(bca.bill.series);                  // Серия/номер векселя
    rep_cell(bca.bill.number);                  // Серия/номер векселя
    rep_cell(bca.AgentID);                      // AgentID
    rep_cell(bca.agent.ShortName);              // Субъект
    rep_cell(bca.AgentRoleName);                // Роль
    rep_cell(bca.Amount);                       // Сумма
    rep_cell(bca.currency.iso_number);          // Валюта
    rep_cell(bca.signdate);                     // Дата

    rep_tbl_row_end();

    stat = bca.Next();
end;

rep_tbl_end();

rep_end();
        
