import RsbObjFactory, "or_rep_h.mac", globals;

var Table = "⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒø\n"+
            "≥  í‡•°Æ¢†≠®•/  ≥     Ñ†‚†      ≥   è´†≠Æ¢†Ô  ≥ î†™‚®Á•·™†Ô ≥è‡Æ·‡ÆÁ•≠≥    Ñ†‚†     ≥  É´†¢†  ≥         çÆ¨•‡ ´/·          ≥      ë„¨¨†      ≥ Ç†´Ó‚† ≥\n"+
            "≥ é°Ôß†‚•´Ï·‚¢Æ ≥ ¢Æß≠®™≠Æ¢•≠®Ô ≥     §†‚†    ≥     §†‚†    ≥         ≥  ¢Î≠Æ·† ≠†  ≥ °†´†≠·† ≥                            ≥                 ≥        ≥\n"+
            "≥               ≥               ≥             ≥             ≥         ≥  Ø‡Æ·‡ÆÁ™„  ≥         ≥                            ≥                 ≥        ≥\n"+
            "√ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒ¥";

var Rep = CMakeReport(Table);

const FontStyleTitel =  "ex_FS(b)";


macro IsNULL( str )
   if( str != NULL )
      return str;
   else
      return " ";
   end;
end;

macro IsNULLSum( str )
   if( str > 0 )
      return str;
   else
      return " ";
   end;
end;


macro PrintWarrants(Obj)
  var  IsLate;

  if( Obj.IsLate )
     IsLate = "Ñ†";
  else
     IsLate = "ç•‚";
  end;

   Rep.AddPrintCell( IsNull(Obj.Direction)+"-"+Obj.DealID+"-"+Obj.DealPart,        0, 0, "c:"+FontStyleTitel);
   Rep.AddPrintCell( IsNull(Obj.Date),             0, 0, "c");
   Rep.AddPrintCell( IsNull(Obj.PlanDate),         0, 0, "c");
   Rep.AddPrintCell( IsNull(Obj.FactDate),         0, 0, "c");
   Rep.AddPrintCell( IsLate,                       0, 0, "c");
   Rep.AddPrintCell( IsNull(Obj.DelayDate),        0, 0, "c");
   Rep.AddPrintCell( IsNull(Obj.Chapter),          0, 0, "c");
   Rep.AddPrintCell( IsNull(Obj.AccountNumber),    0, 0, "c:"+FontStyleTitel);
   Rep.AddPrintCell( IsNull(Obj.Amount),           0, 2, "r");
   Rep.AddPrintCell( IsNull(Obj.CurrencyCode),     0, 0, "c");
   Rep.AddStr();
end;



var Factory = RsbObjectFactory();

var Object = Factory.GetObject("RSCOMSecurObligation");
var bRes, DateRep = {CurDate};
var Num = 0;

   if( not GetDate(DateRep, "Ç¢•§®‚• §†‚„"))
      DateRep = {CurDate};
   end;

   Object.SetParmValue("BeginDate", DateRep);
   Object.SetParmValue("EndDate", DateRep);
   Object.ApplyFilter();


   Rep.AddPrintCell( "Ñ†‚†: " + DateRep, Rep.GetHeaderWidth(), 0, "l:"+FontStyleTitel, REP_ELEM_STR);
   Rep.AddStr();
   
   bRes = Object.Next();
   while(bRes)
      PrintWarrants(Object);
      bRes = Object.Next();
      Num = Num + 1;
   end;

   Rep.AddPrintCell( "Ç·•£Æ: " + String(Num), Rep.GetHeaderWidth(), 0, "l:"+FontStyleTitel, REP_ELEM_STR);
   Rep.AddStr();

   
   Rep.PrintWinRep();
   Rep.ShowWinRep();

