/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : RfxDeal.mac
  Programmer  : Кастелин А.Н.
  Comment     : контрольные примеры для RsVox объекта RfxDeal
└───────────────────────────────────────────────────────────────────────────*/

IMPORT RsbObjFactory, HTMLRep;

MACRO PrintCarries(car)
var stat = car.Next(),
    data = false,
    i = 0;

    if (stat)
        data = true;

        rep_tbl_regroup();

        rep_tbl_start();

        rep_hdr("Дата значения остатка");
        rep_hdr("Сумма");
        rep_hdr("Валюта");
        rep_hdr("Дебет");
        rep_hdr("Кредит");

        rep_tbl_hdrend();

        while (stat)            
	    rep_tbl_group(i);
            rep_tbl_row_start();

            rep_cell(car.ValueDate);
            rep_cell(car.Amount);
            rep_cell(car.Currency);
            rep_cell(car.DebitAccount);
            rep_cell(car.CreditAccount);

            rep_tbl_row_end();
                           
 	    i = i + 1;
            stat = car.Next();
        end;

        rep_tbl_end();
    end;

    return data;
END;
//=========================================================

var factory = RsbObjectFactory();
if (factory == NULL)
    msgbox("can't create RsbObjFactory");
    return;
end;

var deal = factory.GetObject("RfxDeal");
if (deal == NULL)
    msgbox("can't create RfxDeal");
    return;
end;

var dcode = "",
    filter = "";

if (GetString(dcode, "Введите код сделки:"))
    filter = "DealCode = " + dcode;
else
    return;
end;
deal.SetFilter(filter);

deal.ApplyFilter();

var txtDir = "";
var TxtFileName = "";
GetRegistryValue("BANK_INI\\╬┴┘╚┼ ╧└╨└╠┼╥╨█\\─╚╨┼╩╥╬╨╚╚\\TEXTDIR",V_STRING, txtDir, "");
TxtFileName = txtDir + "\\RfxDeal_rep.htmlz";
rep_start(TxtFileName, "RfxDeal");


rep_br("контрольные примеры для RsVox объекта RfxDeal");
rep_br("");

rep_tbl_start();

rep_hdr("DealID");
rep_hdr("Код сделки");
rep_hdr("Вид сделки");
rep_hdr("Направление");
rep_hdr("Дата заключения сделки");
rep_hdr("Дата закрытия сделки");
rep_hdr("Дата возникновения требований");
rep_hdr("Дата возникновения обязательств");
rep_hdr("Контрагент по сделке");
rep_hdr("Срок погашения требований");
rep_hdr("Срок погашения обязательств");
rep_hdr("Сумма требований");
rep_hdr("Сумма обязательств");
rep_hdr("Валюта требований");
rep_hdr("Валюта обязательств");
rep_hdr("Дата исполнения требований");
rep_hdr("Дата исполнения обязательств");
rep_hdr("Плановая дата погашения требований");
rep_hdr("Плановая дата погашения обязательств");
rep_hdr("Дата постановки требований на баланс");
rep_hdr("Дата постановки обязательств на баланс");
rep_hdr("Номер л/с требования (глава Г)");
rep_hdr("Номер л/с обязательства (глава Г)");
rep_hdr("Номер л/с требования (глава А)");
rep_hdr("Номер л/с обязательства (глава А)");

rep_tbl_hdrend();

var stat = deal.Next(),
    party;
while (stat)
    party = "-";
    if (deal.party)
        party = deal.party.FullName;
    end;

    rep_tbl_group(deal.dealid);
    rep_tbl_row_start();

    rep_cell(deal.dealid);                  // DealID
    rep_cell(deal.DealCode);                // Код сделки
    rep_cell(deal.DealKind);                // Вид сделки
    rep_cell(deal.Direction);               // Направление
    rep_cell(deal.DealDate);                // Дата заключения сделки
    rep_cell(deal.CloseDate);               // Дата закрытия сделки
    rep_cell(deal.DealDate);                // Дата возникновения требований
    rep_cell(deal.DealDate);                // Дата возникновения обязательств
    rep_cell(party);                        // Контрагент по сделке
    rep_cell(deal.DemandAbsoluteTerm);      // Срок погашения требований
    rep_cell(deal.LiabilityAbsoluteTerm);   // Срок погашения обязательств
    rep_cell(deal.DemandAmount);            // Сумма требований
    rep_cell(deal.LiabilityAmount);         // Сумма обязательств
    rep_cell(deal.DemandCurrency);          // Валюта требований
    rep_cell(deal.LiabilityCurrency);       // Валюта обязательств
    rep_cell(deal.DemandExecDate);          // Дата исполнения требований
    rep_cell(deal.LiabilityExecDate);       // Дата исполнения обязательств
    rep_cell(deal.DemandOnBalRefl);         // Плановая дата погашения требований
    rep_cell(deal.LiabilityOnBalRefl);      // Плановая дата погашения обязательств
    rep_cell(deal.BalanceDate);             // Дата постановки требований на баланс
    rep_cell(deal.BalanceDate);             // Дата постановки обязательств на баланс
    rep_cell(deal.OBDemandAccount);	    // Номер л/с требования (глава Г)
    rep_cell(deal.OBLiabilityAccount);      // Номер л/с обязательства (глава Г)
    rep_cell(deal.BDemandAccount);          // Номер л/с требования (глава А)
    rep_cell(deal.BLiabilityAccount);       // Номер л/с обязательства (глава А)

    rep_tbl_row_end();

    stat = deal.Next();
end;

rep_tbl_end();
rep_br("");

    stat = deal.Next();
while (stat)

    rep_br("Доходы и расходы для сделки " + deal.DealCode + " (" + deal.Direction + "):");
    PrintCarries(deal.Carries);
    rep_br("");

    stat = deal.Next();
end;

rep_end();


