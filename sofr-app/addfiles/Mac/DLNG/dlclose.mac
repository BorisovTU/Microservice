/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : dlclose.mac
  Programmer  : Кастелин А.Н.
  Comment     : Закрытие договора
                Общая часть, выполняемая в операциях
└───────────────────────────────────────────────────────────────────────────*/
IMPORT RsbDataSet;


/* Проверка: все ли шаги операции выполнены (кроме нашего) ?
*/
MACRO DL_TestAllSteps(ID_Operation, ID_Step)
var
    ok = false,
    step_count = TRsbDataSet("SELECT COUNT(*) cnt FROM doprstep_dbt "
                          "WHERE t_ID_Operation = " + ID_Operation + 
                           " AND t_ID_Step != " + ID_Step + 
                           " AND t_IsExecute NOT LIKE 'X'");
    ok = step_count.MoveNext();

    if(ok)
       ok = (step_count.cnt < 1);
    else
       msgbox("Ошибка TRsbDataSet при выполнении запроса");
    end;

    return ok;
END;
