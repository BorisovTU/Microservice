/*
$Name:         ws_md_MTEConnect.mac
$Module:       Монитор дилера
$Description:  Подключение к шлюзу ММВБ
*/

import "ws_md_MTECommon.mac";

macro MTEConnect()
  var prm = Settings();
  ReplaceMacro( "msgbox", "MTE_WriteLog" );

  var errMsg = "";
  var stat = 0;

  ResetConnectIdx();
  if(prm.CheckSettings() == 0)
    var Idx = Web_MTEConnect(prm.MakeConnectStr(), errMsg);
   
    if(Idx >= MTE_OK )
      SetConnectIdxToCache(Idx);
      /*Открыть таблицу*/
      ResetTableIdx();
      var Htable = Web_MTEOpenTable(Idx, prm.GetTableName(), prm.GetOpenTablePrm(), false, errMsg);

      if(Htable >= MTE_OK)
        SetTableIdxToCache(Htable);        
      else
        msgbox(errMsg);        
      end;
    else
      msgbox(errMsg);
    end;
  end;

  ReplaceMacro( "msgbox", NULL );
end;

MTEConnect();
