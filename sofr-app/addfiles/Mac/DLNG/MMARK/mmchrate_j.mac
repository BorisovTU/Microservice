/*
$Name:        mmchrate_j.mac
$Module:      МБ Кредиты
$Description: макрос выполнения шага "Изменение ставки"
*/

IMPORT MmarkInter, mmlib, mmlibr, mmservop;

PRIVATE VAR
    ID_Operation = 0,
    ID_Step      = 0,
    ExecDate,
    OprServDoc;

/*----------------------------------------------------------------------------
    Выполнение шага
----------------------------------------------------------------------------*/

MACRO ExecuteStep(Buffer, Document, DocKind, IDOperation, IDStep)
    record deal( dl_tick );
    SetBuff(deal, Document);
    var deal_pd = MMFirstDoc(DL_IBCDOC, deal.DealID, true);

    ID_Operation = IDOperation;
    ID_Step      = IDStep;

    OprServDoc = GetOprServDoc();
    MM_ChangeRate(deal.DealID, OprServDoc.rec.Rate, OprServDoc.rec.RateDate);
    //SvOpAddProcObj(deal_pd.GetTick().BOfficeKind, deal_pd.GetTick().DealID, OprServDoc.rec.Rate, deal_pd.GetLeg().Price/(pow(10, deal_pd.GetLeg().Point)));

    return 0;
END;

NameMacroFile = "mmchrate_j.mac";
