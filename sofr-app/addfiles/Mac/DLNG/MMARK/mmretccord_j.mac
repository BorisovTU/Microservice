IMPORT mmservop, mmordcr, OprInter;

MACRO ExecuteStep(Buffer, Document)
    record ord(dl_order);

    SetBuff(ord, Document);

    if ((not GetOprServDoc().rec.Flag7)and(not IsCONVERT_RECEIPT(GetOperationGroup (ord.Kind_Operation))))
        ;
    elif ((GetOprServDoc().rec.Flag7)and(IsCONVERT_RECEIPT(GetOperationGroup (ord.Kind_Operation))))
        ;
    else return 1;
    end;

    if (not GetOprServDoc().rec.Flag7)
        if (not IsBUY(GetOperationGroup (ord.Kind_Operation)))
            return MM_OrdPledgeExecCarry(RevalTCCSetInledge, ord, -1, GetOprServDoc().rec.CommDate).ExecCarry();
        else
            return MM_OrdPledgeExecCarry(RevalTCCGetInledge, ord, -1, GetOprServDoc().rec.CommDate).ExecCarry();
        end;
    else
        if (not IsBUY(GetOperationGroup (ord.Kind_Operation)))
            return MM_OrdPledgeSecurExecCarry(RevalTCCSetInledge, ord, -1, GetOprServDoc().rec.CommDate).ExecCarry();
        else
            return MM_OrdPledgeSecurExecCarry(RevalTCCGetInledge, ord, -1, GetOprServDoc().rec.CommDate).ExecCarry();
        end;
    end;

    return 0;
END;
