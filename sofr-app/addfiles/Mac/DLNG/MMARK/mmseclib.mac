/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank 6.0                                          R-Style Softlab

  File Name   : mmseclib.mac
  Created     : 04.04.2009
  Programmer  : ’ ­¥¥¢ ’..
  Description : ”ã­ªæ¨¨ ¤«ï à ¡®âë á ®¡¥á¯¥ç¥­¨ï¬¨.
  Comment     :
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
IMPORT RsbDataSet;

/* 72667. Korotkov. */
MACRO ‚¥à­ã«¨ˆ§‡ «®£ (tick)

   var data = TRsbDataSet("select DDL_SECUR_DBT.T_GENERALCONTRACT " +
                          "from DOPROPER_DBT, DDL_TICK_DBT, DDL_SECUR_DBT, " +
                               "DOPRSTEP_DBT " +
                          "where DDL_SECUR_DBT.T_CONTRACTID = DDL_TICK_DBT.T_DEALID " +
                                 " and DDL_TICK_DBT.T_DEALID = " + tick.DealID +
                                 " and DDL_SECUR_DBT.T_GENERALCONTRACT = DOPROPER_DBT.T_DOCUMENTID " +
                                 " and DOPROPER_DBT.T_DOCKIND = " + DL_MMPAWN +
                                 " and DOPRSTEP_DBT.T_ID_OPERATION = DOPROPER_DBT.T_ID_OPERATION " +
                                 " and DOPRSTEP_DBT.T_SYMBOL = '‡' " +
                                " and DOPRSTEP_DBT.T_ISEXECUTE = 'X' ");

  return data.MoveNext();

END;

/* 65594. */
MACRO …áâìà¥¤¬¥âë‡ «®£ (ContractID)

  var data = TRsbDataSet("select DDL_SECUR_DBT.T_CONTRACTID " +
                          "from DDL_SECUR_DBT " +
                          "where DDL_SECUR_DBT.T_CONTRACTID = " + ContractID +
                           " or (DDL_SECUR_DBT.T_GENERALCONTRACT = " + ContractID +
                                 " and DDL_SECUR_DBT.T_SECURITYPROPERTIES > 0 )");

  return data.MoveNext();
END;