/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.0                                          R-Style Software Lab

  File Name   : mmscmt.mac
  Programmer  : Сабитов Р.Р.
  Description : Печать подтверждений
                IL 03.10.2000 Убил MMCMT_WordFilesPtr.
                              Подтверждение контрагенту тоже в Word.
└───────────────────────────────────────────────────────────────────────────*/
ARRAY  MMCMT_WordFiles; /* При массовой печати подтверждений, здесь будут имена файлов с ними */
CONST  МассоваяПечатьПодтверждений = true;
/*MMCMT_WordFilesPtr;*/

IMPORT BankInter, mmlib, rsexts;

/*file l_report_write ("1.txt") txt write;*/
/*file l_report () txt;*/
const   Ошибка   = 0,
        Первый   = 1,
        Последний= 2;


const   MMCMT_DotFile = "FCNF050e.dot";


MACRO WriteHeader(word,filename)
/*
    word.Selection.Style = word.ActiveDocument.Styles("Heading 1");
    word.Selection.ParagraphFormat.Alignment = 1; /*wdAlignParagraphCenter*/
    word.Selection.TypeText(filename);
    word.Selection.TypeParagraph
*/
END;

MACRO WriteFooter(word,filename)
    word.Selection.TypeText(filename);
END;

MACRO WordRep 

var first = true,
    need_pb = false,
    curptr = 0,
    MMCMT_WordFilesPtr = ASize(MMCMT_WordFiles),
    SCMT_Word          = ActiveX( "Word.Application", null, true ),    
    Path = MM_GetDotFileDir(MMCMT_DotFile),
    tmp = MMCMT_processPath(Path),
    SCMT_curdoc = SCMT_Word.Documents.Add( tmp, FALSE ),
    TXT_PATH, doc_filename,
    txtRegistryPath = "BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ДИРЕКТОРИИ\\TEXTDIR";

    while (curptr!=MMCMT_WordFilesPtr)
        if (curptr)
            SCMT_Word.Selection.EndKey(6); /*wdStory*/
            SCMT_Word.Selection.InsertBreak(7); /*wdPageBreak*/
        end;

        WriteHeader(SCMT_Word,MMCMT_WordFiles[curptr]);
        SCMT_Word.Selection.InsertFile(MMCMT_WordFiles[curptr],"",false,false,false);
        WriteFooter(SCMT_Word,MMCMT_WordFiles[curptr]);
        curptr=curptr+1;
    end;

    if (IsStandAlone)
        SCMT_Word.Visible = TRUE;
    else
        tmp = GetWorkFileName("wrdrep");
        SCMT_curdoc.SaveAs (tmp,0);
        if (not CopyFile (tmp,"$txtfile\\tmprep.doc"))
            MsgBox ("Ошибка при передаче файла на терминал");
            return false;
        else
            if(MM_SetRegistryPath(txtRegistryPath, TXT_PATH) == 0)
              // получит полный путь
              TXT_PATH = MMCMT_processPath(TXT_PATH);
              doc_filename = TXT_PATH + "\\tmprep.doc";
              CallRemoteRsl ("mmshrp.mac" ,"ShowReport", doc_filename);
           end;
        end;
        SCMT_curdoc.Close;
        SCMT_Word.Quit;
    end;
END;
/*
MACRO CreateFiles
/*
    if (not open(l_report_write, MMCMT_ReportFile))
        msgbox( "Ошибка открытия файла ", MMCMT_ReportFile );
    else
        close (l_report_write);
    end;
*/
/*    MMCMT_WordFilesPtr = 0;*/
END;
*/
MACRO ViewReports
/*
    if( not open( l_report, MMCMT_ReportFile ) )
        msgbox( "Ошибка открытия файла ", MMCMT_ReportFile );
    elif (Next(l_report))
        viewfile (l_report);
    end;
*/
    if (ASize( MMCMT_WordFiles )/*MMCMT_WordFilesPtr*/)
        WordRep;
    end;
END;

MACRO Печать_ОтчетСканирования (Вызов,firstdoc,Статус,Сообщение)
    if (Вызов==Первый)
/*        CreateFiles;*/
[+-------+-------+------------------------------------------------------------+];
[|       |№ошибки|                 Сообщение                                  |];
[|       |       |                                                            |];
[+-------+-------+------------------------------------------------------------+];
    elif (Вызов==Ошибка)
            if (Статус == 0)
            Сообщение = "Шаг выполнен";
            end;
[|       |#######|############################################################|](Статус,Сообщение);
    elif (Вызов==Последний)         
[+-------+-------+------------------------------------------------------------+];
        ViewReports;
    end;
END;