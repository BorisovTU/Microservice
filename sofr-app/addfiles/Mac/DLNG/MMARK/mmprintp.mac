/* ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank                                        R-Style Software Lab Ltd
  ” ©« ¯®¤á¨áâ¥¬ë "ŒŠ"

  ¥ç âì ¯®¤â¢¥à¦¤¥­¨ï ®¡ ãáâ ­®¢«¥­¨¨ ¤®£®¢®à­®© ¯à®æ¥­â­®© áâ ¢ª¨ ¨
         à á¯®àï¦¥­¨ï ­  ¡«®ª¨à®¢ªã ®áâ âª  ­  ª®àáç¥â¥  ­ª -à¥á¯®­¤¥­â .


CREATED : 10.02.00 LA
MODIFICATIONS: IL 03.10.2000 ¯¥à¥¤¥« « ¯¥ç âì ¯®¤â¢¥à¦¤¥­¨ï ¢ Word
NOTES:

ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ */
import param, mmactx, DealsInter, BankInter;

/* ®«­ë¥ ­ §¢ ­¨ï ä ©«®¢, ªã¤  ¡ã¤¥â ¯à®¨§¢¥¤¥­  ¯¥ç âì:
   ¤«ï ¯®¤â¢¥à¦¤¥­¨ï (EOFA030) ¨ à á¯®àï¦¥­¨ï (FASO410) á®®â¢¥âáâ¢¥­­® */
const pcmt_TemplateName = "EOFA030.dot"; /*  §¢ ­¨¥ ä ©«  á è ¡«®­®¬ ä®à¬ë */

FILE dl_leg  ( dl_leg );
FILE party   ( party );
FILE fininstr( fininstr );

/* ------------------------------------------------------------------------- */

/* ®«ãç¨âì á®ªà é¥­­®¥ ­ ¨¬¥­®¢ ­¨¥ ª®­âà £¥­â  - ¤«ï ¯¥ç â¨ */
MACRO getPartyShortName( p_id )
 party.PartyID = p_id;

 if( not getEQ( party ) )
  return "";
 end;
 return party.ShortName;
END;

/* ......................................................................... */

/* ®«ãç¨âì ISO-ª®¤ ¨ 3å ¡ãª¢¥­­ë© « â. ª®¤ ¢ «îâë ¯® ID */
MACRO getISOByID( p_id )
 fininstr.FIID = p_id;
 if( not getEQ( fininstr ) )
  setparm( 1, 0 );
  setparm( 2, "" );
  return;
 end;
 setparm( 1, fininstr.ISO_Number );
 setparm( 2, fininstr.Ccy );
END;

/* ......................................................................... */

/* âª®­¢¥àâ¨âì Duration ¢ ¤­¨ */
MACRO conv2days( p_duration, p_pitch )
 if( p_pitch == 1 ) /* ¤­¨ */
  return int( p_duration );
 else /* ­  íâ®â á«ãç © ¯®ª  § £«ãèª  */
  msgbox( "è¨¡ª !| ¥¢®§¬®¦­® ¢ëç¨á«¨âì %-© ¯¥à¨®¤ (áà®ª) ¢ ¤­ïå:|…¤¨­¨æ  ¨§¬¥à¥­¨ï áà®ª  - ­¥ ¤­¨.|(®« £ ¥¬ áà®ª à ¢­ë¬ 0)" );
  return 0;
 end;
END;

/* ......................................................................... */

/* (–¥«®¥) —¨á«® ¯à®¯¨áìî */
MACRO strnum( p_num )
var l_res = "";
    rubtostr( moneyL( p_num ), l_res, null );
    return l_res;
END;

/* ......................................................................... */

/* ‘ª«®­¥­¨¥ ¤­¥© ¢ § ¢¨á¨¬®áâ¨ ®â ç¨á«  */
MACRO strdays( p_num )
var l_num;
 p_num = string( p_num );
 l_num = substr( p_num, strlen( p_num ) - 1, 1 );
 if( l_num == "1" )
  return "¤­¥©";
 end;

 l_num = substr( p_num, strlen( p_num ) );

 if( l_num == "1" )
  return "¤¥­ì";
 elif( ( l_num >= "2" ) and
       ( l_num <= "4" ) )
  return "¤­ï";
 end;
 return "¤­¥©";
END;

/* ......................................................................... */

/* à®¨§¢®«ì­®¥ (¬.¡. ¤à®¡­®¥) ç¨á«® ¯à®¯¨áìî */
MACRO decimalInWords( p_number )

var l_p, l_int, l_intE, 
    l_frc, l_frcE,
    l_dec, l_res;

 /* (–¥«®¥) —¨á«® (¯¥à¥¤ ­­®¥ ª ª áâà®ª ) ¯à®¯¨áìî ¢ ¦¥­áª®¬ à®¤¥ */
 MACRO strnumF( p_num )
 var l_res = curtostralt( moneyL( double( p_num ) ), null, null, 999 ),
     l_p   = index( l_res, "èâ" );

  return trim( substr( l_res, 1, l_p - 1 ) );
 END;

 /* “¡à âì ¯®á«¥¤­¨¥ ­ã«¨ ã ç¨á« , ¯¥à¥¤ ­­®£® ª ª áâà®ª  */
 MACRO remove0( p_num )
  while( substr( p_num, strlen( p_num ) ) == "0" )
   p_num = substr( p_num, 1, strlen( p_num ) - 1 );
  end;
  return p_num;
 END;

 /* ¯à¥¤¥«¨âì ®ª®­ç ­¨¥ ¦¥­áª®£® à®¤  ­ §¢ ­¨ï § ¤ ­­®£® ¢ áâà®ª¥ ç¨á«  */
 MACRO defineWordEnd( p_num )
 var l_num = substr( p_num, strlen( p_num ) - 1, 1 );

  if( l_num == "1" )
   return "ëå";
  end;

  l_num = substr( p_num, strlen( p_num ) );

  if( l_num == "1" )
   return " ï";
  end;
  return "ëå";
 END;

 /* Macro entry point */
 p_number = string( double( p_number ) );
 l_p    = strbrk( p_number, "." );

 l_int  = substr( p_number, 1, l_p - 1 );                 /* æ¥« ï ç áâì */
 l_intE = substr( l_int, max( 1, strlen( l_int ) - 1 ) ); /* ¯®á«¥¤­¨¥ 2 æ¨äàë æ¥«®© ç áâ¨ */

 l_frc  = remove0( substr( p_number, l_p + 1 ) );         /* ¤à®¡­ ï ç áâì */
 l_frcE = substr( l_frc, max( 1, strlen( l_frc ) - 1 ) ); /* ¯®á«¥¤­¨¥ 2 æ¨äàë ¤à®¡­®© ç áâ¨ */

 l_p    = strlen( l_frc );

 if( l_p == 1 )
  l_dec = "¤¥áïâ";
 elif( l_p == 2 )
  l_dec = "á®â";
 elif( l_p == 3 )
  l_dec = "âëáïç­";
 elif( l_p == 4 )
  l_dec = "¤¥áïâ¨âëáïç­";
 else
  l_dec = "";
 end;

 l_res = strnumF( l_int ) + " " + "æ¥«" + defineWordEnd( l_intE );

 if( l_dec != "" )
  l_res = l_res + " " + strlwr( strnumF( l_frc ) ) + " " + l_dec +
          defineWordEnd( l_frcE );
 end;

 return l_res;
END;

/* ......................................................................... */

/* ®«ãç¨âì ü ¤®¯®«­¨â¥«ì­®£® á®£« è¥­¨ï (§ £«ãèª ) */
MACRO fetchAgreement( p_partyID, p_market, p_agreementKind )
 return "              ";
END;


/* ......................................................................... */
/* ¥ç âì à á¯®àï¦¥­¨ï */
MACRO printEOFA030( p_pointer )
 RECORD l_dealrec( dl_tick );

 setbuff( l_dealrec, p_pointer );

var
 l_startdate = date( 0,0,0 ), /* „ â  ­ ç «  (¢ «îâ¨à®¢ ­¨ï) á¤¥«ª¨ */
 l_principal = $0,            /* ¡ê¥¬ ¯à¨­æ¨¯ «  */
 l_FIID      = 0,             /* ID ¢ «îâë */
 l_Ccy       = "",            /* ISO ª®¤ « â. */
 l_duration  = 0,             /* ‘à®ª */
 l_maturity  = date( 0,0,0 ), /* „ â  § ¢¥àè¥­¨ï á¤¥«ª¨ */
 l_rate      = 0,             /* % áâ ¢ª  */
 l_accnum    = "";            /* ü à áç¥â­®£® áç¥â  à¥á¯®­¤¥­â  */

 dl_leg.LegKind = LEG_KIND_DL_TICK;
 dl_leg.DealID = l_dealrec.DealID;
 dl_leg.LegID  = 1; /* ‘ªàëâë© £¥­¥à «ì­ë© âà ­è, ¯® ¨¤¥¥ ¤®«¦­® ¡ëâì -1 */

 if( getEQ( dl_leg ) )
  l_startdate = dl_leg.Start;
  l_principal = dl_leg.Principal;
  l_FIID      = dl_leg.PFI;
  l_duration  = conv2days( dl_leg.Duration, dl_leg.Pitch );
  l_maturity  = dl_leg.Maturity;
  l_rate      = dl_leg.Price;
 else
  msgbox( "¥ ­ ©¤¥­ âà ­è á¤¥«ª¨" );
 end;

 getISOByID( l_FIID, l_FIID, l_Ccy );

/* if( not getOprAccount( 241, l_accnum ) )*/
  l_accnum = "                        ";
/* end;*/

/*
 l_packet   = isOprMultiExec; /* ?¯ ª¥â­®¥ ¢ë¯®«­¥­¨¥ */

 setoutput( wrkfilenameE, l_packet );

 println( "\n\n\n" );
 println( " ®«ãç â¥«ì : ", getPartyShortName( l_dealrec.PartyID ) );
 println( " â¯à ¢¨â¥«ì: ", {Name_Bank}:l, "\n" );

 println( " ", date:m, "\n\n" );
 println( "                         ®¤â¢¥à¦¤¥­¨¥ ®¡ ãáâ ­®¢«¥­¨¨" );
 println( "                     ¤®£®¢®à­®© ¯à®æ¥­â­®© áâ ¢ª¨ ü ", l_dealrec.DealCode, "\n\n" );


 println( " ‚ á®®â¢¥âáâ¢¨¨ á ­ áâ®ïé¨¬ ®¤â¢¥à¦¤¥­¨¥¬, ï¢«ïîé¨¬áï à¨«®¦¥­¨¥¬ ª " );
 println( "„®¯®«­¨â¥«ì­®¬ã á®£« è¥­¨î ü ", fetchAgreement );
 println( "®¡ ãáâ ­®¢«¥­¨¨ ¤®£®¢®à­®© ¯à®æ¥­â­®©" );
 println( "áâ ¢ª¨ ¯® ®áâ âªã ­  ª®àà¥á¯®­¤¥­âáª®¬ áç¥â¥,  ­ª-à¥á¯®­¤¥­â ", l_startdate:m );
 println( "¯¥à¥ç¨á«ï¥â ­  á¢®© ª®àà¥á¯®­¤¥­âáª¨© áç¥â \"‹®à®\" ü ", l_accnum, "," );
 println( "®âªàëâë© ¢  ­ª¥-ª®àà¥á¯®­¤¥­â¥,"  );
 println( "áã¬¬ã ", l_principal:a," ", l_Ccy, " ( ", curtostralt( l_principal, null, null, l_FIID ), " )," );
 println( "áà®ª®¬ ­  ", l_duration, " ( ", strnum( l_duration ), " ) ", strdays( l_duration ), ", ¤® ", l_maturity:m, "." );
 println( "  ¢ëè¥ãª § ­­ãî áã¬¬ã ­ ç¨á«ïîâáï ¯à®æ¥­âë" );
 println( "¯® áâ ¢ª¥ ", l_rate, " ( ", decimalInWords( l_rate ), " ) % £®¤®¢ëå.\n" );


 println( "à®á¨¬ ­ ¯à ¢¨âì  ­ «®£¨ç­®¥ ®¤â¢¥à¦¤¥­¨¥ ¯® ä ªáã ", ®¬¥à_ä ªá  );
 println( "­¥ ¯®§¤­¥¥ 17-00 ç á. ¬®áª®¢áª®£® ¢à¥¬¥­¨.\n\n" );


 println( "ˆ.. à¥¤á¥¤ â¥«ï                        ", {FIO_Boss}, "\n" );
 println( "ƒ«. ¡ãå£ «â¥à                            ", {FIO_Book} );
 println( "\n\n\n" );

 /* ‚ë¢®¤ ­  íªà ­ */

 if( ( not l_packet ) and
     ( open( wrkfile, setoutput( null ) ) ) )
  viewfile( wrkfile );
 end;
*/
 /* ¥ç âì ®âç¥â  */
 var l_D = OpenWordDocumentByDot( pcmt_TemplateName );
 if( l_D == null )   return "";   end;

 l_D.Bookmarks( "Receiver"      ).Range.Text = getPartyShortName( l_dealrec.PartyID );
 l_D.Bookmarks( "Send"          ).Range.Text = string({Name_Bank}:l);
 l_D.Bookmarks( "Date"          ).Range.Text = string(date:m);
 l_D.Bookmarks( "Number"        ).Range.Text = l_dealrec.DealCode;
 l_D.Bookmarks( "Fetch"         ).Range.Text = fetchAgreement;
 l_D.Bookmarks( "StartDate"     ).Range.Text = string(l_startdate:m);
 l_D.Bookmarks( "LoroAcc"       ).Range.Text = l_accnum;
 l_D.Bookmarks( "Principal"     ).Range.Text = string(l_principal:a);
 l_D.Bookmarks( "Currency"      ).Range.Text = l_Ccy;
 l_D.Bookmarks( "PrincipalWrite").Range.Text = curtostralt( l_principal, null, null, l_FIID );
 l_D.Bookmarks( "Duration"      ).Range.Text = l_duration;
 l_D.Bookmarks( "DurationWrite" ).Range.Text = strnum( l_duration );
 l_D.Bookmarks( "Days"          ).Range.Text = strdays( l_duration );
 l_D.Bookmarks( "Maturity"      ).Range.Text = string(l_maturity:m);
 l_D.Bookmarks( "Rate"          ).Range.Text = string(l_rate);
 l_D.Bookmarks( "RateWrite"     ).Range.Text = decimalInWords( l_rate );
 l_D.Bookmarks( "Fax"           ).Range.Text = string(®¬¥à_ä ªá );
 l_D.Bookmarks( "FIO_Boss"      ).Range.Text = {FIO_Boss};
 l_D.Bookmarks( "FIO_Book"      ).Range.Text = {FIO_Book};

 return SaveRTFandCloseDoc( l_D, "EOFA030_" + trim( l_dealrec.DealCode ) + ".rtf" );
END;

/* ......................................................................... */

/* ¥ç âì à á¯®àï¦¥­¨ï */
MACRO printFASO410( p_pointer )
 RECORD l_dealrec( dl_tick );
 FILE   wrkfile() TXT; /* ” ©«, ªã¤  ¢ë¢®¤¨âáï â¥ªáâ */

 setbuff( l_dealrec, p_pointer );

var wrkfilenameF = GetTxtFileName("FASO410");
 /* ®«ãç¨âì ¤ ­­ë¥ */
var
 l_startdate = date( 0,0,0 ), /* „ â  ­ ç «  (¢ «îâ¨à®¢ ­¨ï) á¤¥«ª¨ */
 l_principal = $0,            /* ¡ê¥¬ ¯à¨­æ¨¯ «  */
 l_FIID      = 0,             /* ID ¢ «îâë */
 l_Ccy       = "",            /* ISO ª®¤ « â. */
 l_maturity  = date( 0,0,0 ), /* „ â  § ¢¥àè¥­¨ï á¤¥«ª¨ */
 l_interest  = $0,            /* ¡ê¥¬ % */
 l_accnum    = "";            /* ü à áç¥â­®£® áç¥â  à¥á¯®­¤¥­â  */

var l_percstr, l_packet,
    l_strsum0, l_strsum1;

 dl_leg.DealID = l_dealrec.DealID;
 dl_leg.LegID  = 1; /* ‘ªàëâë© £¥­¥à «ì­ë© âà ­è, ¯® ¨¤¥¥ ¤®«¦­® ¡ëâì -1 */

 if( getEQ( dl_leg ) )
  l_startdate = dl_leg.Start;
  l_principal = dl_leg.Principal;
  l_FIID      = dl_leg.PFI;
  l_maturity  = dl_leg.Maturity;
  l_interest  = dl_leg.Cost;
 else
  msgbox( "¥ ­ ©¤¥­ âà ­è á¤¥«ª¨" );
 end;
 getISOByID( l_FIID, l_FIID, l_Ccy );

/* if( not getOprAccount( 241, l_accnum ) )*/
  l_accnum = "                        ";
/* end;*/

 /* ®«ãç¨âì ¥¤.¢ «îâë ¢ à®¤¨â¥«ì­®¬ ¯ ¤¥¦¥ */
 l_percstr = curtostralt( l_interest, l_strsum0, l_strsum1, l_FIID );
 l_percstr = substr( l_percstr, strlen( l_strsum0 ) + 1 );
 l_percstr = trim( substr( l_percstr, 1, index( l_percstr, l_strsum1 ) - 1 ) );

 /* ®¤£®â®¢ª  ª ¯¥ç â¨ */
 l_packet   = isOprMultiExec; /* ?¯ ª¥â­®¥ ¢ë¯®«­¥­¨¥ */
 setoutput( wrkfilenameF, l_packet );

 println( "\n\n\n" );
 println( "                                                  ‚  áç¥â­ë© æ¥­âà \n\n" );
 println( date:m, "\n\n" );


 println( "  á¯®àï¦¥­¨¥ ­  ¡«®ª¨à®¢ªã ®áâ âª  ­  ª®àáç¥â¥  ­ª -à¥á¯®­¤¥­â  ¨" );
 println( "            ­ ç¨á«¥­¨¥ ¯à®æ¥­â®¢ ¯® ¤®£®¢®à­®© áâ ¢ª¥.\n\n" );


 println( "  ‚ á®®â¢¥âáâ¢¨¨ á ãá«®¢¨ï¬¨ \"®¤â¢¥à¦¤¥­¨ï ®¡ ãáâ ­®¢«¥­¨¨ ¤®£®¢®à­®©" );
 println( "¯à®æ¥­â­®© áâ ¢ª¨\" ü ", l_dealrec.DealCode, " ®â ", l_dealrec.DealDate:m, " ¯à®á¨¬ ‚ á ®¡¥á¯¥ç¨âì" );
 println( "¡«®ª¨à®¢ªã ®áâ âª  ", l_principal:a, " ", l_Ccy, " ( ", curtostralt( l_principal, null, null, l_FIID ), " )" );
 println( "­  áç¥â¥ ü ", l_accnum," ¡ ­ª  '", getPartyShortName( l_dealrec.PartyID ), "'" );
 println( "á ", l_startdate:m, " ¯® ", l_maturity:m, " ¨ ­ ç¨á«¨âì ¯à®æ¥­âë ¢ áã¬¬¥" );
 println( l_interest:a, " ", l_percstr, ".\n\n\n" );

 println( "„¥¦ãà­ë© á®âàã¤­¨ª “¯à ¢«¥­¨ï à¥áãàá®¢\n\n" );

 /* ‚ë¢®¤ ­  íªà ­ */
 if( ( not l_packet ) and
     ( open( wrkfile, setoutput( null ) ) ) )
  viewfile( wrkfile );
 end;
END;

/* ......................................................................... */
