/*
$Name:        
$Module:      Ценные бумаги
$Description: 
*/

import "dlutils.mac";

macro CheckSofrIdExists(sofrId)
  var oldDialog = SetDialogFlag(0);
  var query = 
   " SELECT party.T_PARTYID " +
   "    FROM dparty_dbt party " +
   "   WHERE party.T_PARTYID = ? ";
  var cmd = DL_RSDCommand(query);
  cmd.addParam( sofrId );
  var ds = cmd.Execute();
  SetDialogFlag(oldDialog);
  if (ds.moveNext())
    return true;
  end;
  return false;
OnError(er)
  SetDialogFlag(oldDialog);
  return false;
end;

macro GetSofrIDFromCftId(cftId)
  var oldDialog = SetDialogFlag(0);
  var query = 
   " SELECT o.t_ObjectID " +
   "    FROM DOBJCODE_DBT o " +
   "   WHERE o.t_ObjectType = 3 " +
   "     AND o.t_CodeKind = 101 " +
   "     AND o.t_Code = ? " +
   "     AND o.t_state = 0 ";
  var cmd = DL_RSDCommand(query);
  cmd.addParam( cftId );
  var ds = cmd.Execute();
  SetDialogFlag(oldDialog);
  if (ds.moveNext())
    return SQL_ConvTypeInteger(ds.ObjectID);
  end;
  return 0;
OnError(er)
  SetDialogFlag(oldDialog);
  return 0;
end;

macro GetCftIDFromSofrID(sofrId)
  var oldDialog = SetDialogFlag(0);
  var query = 
   " SELECT o.t_Code " +
   "    FROM DOBJCODE_DBT o " +
   "   WHERE o.t_ObjectType = 3 " +
   "     AND o.t_CodeKind = 101 " +
   "     AND o.t_ObjectID = ? " +
   "     AND o.t_state = 0 ";
  var cmd = DL_RSDCommand(query);
  cmd.addParam( sofrId );
  var ds = cmd.Execute();
  SetDialogFlag(oldDialog);
  if (ds.moveNext())
    return SQL_ConvTypeStr(ds.Code);
  end;
  return "";
OnError(er)
  SetDialogFlag(oldDialog);
  return "";
end;