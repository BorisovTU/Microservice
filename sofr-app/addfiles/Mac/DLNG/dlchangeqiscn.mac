/*å†··Æ¢Æ• ¢ÎØÆ´≠•≠®• §•©·‚¢®© ≠†§ äà*/
IMPORT PTInter;

PRIVATE RECORD Party( party );

PRIVATE CONST ERROR_EXEC = 0,
              PRINT_HEADER = 1,
              PRINT_FOOTER = 2;
              
private const NOTIFICATION_FORMING_ERROR = 8902;

PRIVATE MACRO PrintHead( Head:STRING )
[
                   #
⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
≥     äÆ§            ≥  ¸   ≥                      ëÆÆ°È•≠®•                                                                    ≥
≥   ·„°Í•™‚†         ≥ÆË®°™®≥                                                                                                   ≥
√ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥](Head);
END;


PRIVATE MACRO PrintFooter()
[¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
];

END;

PRIVATE MACRO PrintLine( ErrStatus:INTEGER, ErrMessage:STRING )
[≥####################≥######≥###################################################################################################≥]
( èÆ´„Á®‚ÏäÆ§ë„°Í•™‚†( Party.PartyID, PTCK_CONTR ):w, ErrStatus, ErrMessage:w );
END;

PRIVATE MACRO ChangeState( NumExec:INTEGER, ErrStatus:INTEGER, ErrMessage:STRING )
  if( NumExec == PRINT_HEADER )
     PrintHead( "é‚Á•‚ Æ ¨†··Æ¢Æ¨ ®ß¨•≠•≠®® ·‚†‚„·† äà." );
  elif( NumExec == PRINT_FOOTER )            
     PrintFooter();
  elif( NumExec == ERROR_EXEC )
     if ((ErrStatus == 0) or (ErrStatus == NOTIFICATION_FORMING_ERROR)) 
        if (StrLen(ErrMessage) > 0)
          ErrMessage = StrSubst(ErrMessage, "|", " ") + "\në‚†‚„· ®ß¨•≠Ò≠.";
        else
          ErrMessage = "ë‚†‚„· ®ß¨•≠Ò≠.";
        end;
     else
        ErrMessage = ErrMessage + "\në‚†‚„· ≠• ®ß¨•≠Ò≠.";
     end;
     PrintLine( ErrStatus, ErrMessage);
  end;
END;

PRIVATE MACRO SetControlDate( NumExec:INTEGER, ErrStatus:INTEGER, ErrMessage:STRING )
  if( NumExec == PRINT_HEADER )
     PrintHead( "é‚Á•‚ Æ ¨†··Æ¢Æ¨ ®ß¨•≠•≠®® §†‚Î Ø‡Æ¢•‡™®." );
  elif( NumExec == PRINT_FOOTER )            
     PrintFooter();
  elif( NumExec == ERROR_EXEC )
     if( ErrStatus == 0 ) 
        ErrMessage = "Ñ†‚† „·‚†≠Æ¢´•≠†.";
     else
        ErrMessage = ErrMessage + "\nÑ†‚† ≠• ®ß¨•≠Ò≠†.";
     end;
     PrintLine( ErrStatus, ErrMessage);
  end;
END;


MACRO è•Á†‚Ï_é‚Á•‚ë™†≠®‡Æ¢†≠®Ô( NumExec:INTEGER, FDoc:VARIANT, ErrStatus:INTEGER, ErrMessage:STRING, Action:INTEGER )

  SetBuff( Party, FDoc );

  if( Action == 1 )
     ChangeState( NumExec, ErrStatus, ErrMessage );
  end;

  if( Action == 2 )
     SetControlDate( NumExec, ErrStatus, ErrMessage );
  end;

END;
