/*
$Name:        dlreestrel_form.mac
$Module:      Ценные бумаги
$Description: Отчет "Сведения о сделках". (Электронная анкета ФСФР)
*/

CONST 
      PNFLD_DLREESTREL_Period      = 0,
      PNFLD_DLREESTREL_Year        = 1,
      PNFLD_DLREESTREL_Secur       = 2,
      PNFLD_DLREESTREL_Deriv       = 3,
      PNFLD_DLREESTREL_VeksAcc     = 4,
      PNFLD_DLREESTREL_APOSTROPHE  = 5,
      PNFLD_DLREESTREL_EXCEL       = 6,
      PNFLD_DLREESTREL_XML         = 7;

PRIVATE MACRO Default( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) 
    FldRealValue = FldRealValue;
  end;
  return CM_DEFAULT;
END;

CLASS (DL_XML_CPanel) SP_DLREESTREL_Panel(Form, TableHeader:STRING, _With_XML:bool)
  PRIVATE VAR With_XML = DL_IIF(_With_XML==NULL,false,_With_XML);

  PRIVATE MACRO Init()
     VAR CurMonth, CurYear, Period, Year;

     DateSplit( {curdate}, null, CurMonth, CurYear );
     Period = (CurMonth - 1)/3 + 13; /*текущий квартал*/

     AddFieldProc( 0, PNFLD_DLREESTREL_Period,      DL_PNFLD_PERIOD,   @DL_FldProc_Period,   Period, 37, 8 );         
     AddFieldProc( 0, PNFLD_DLREESTREL_Year,        DL_PNFLD_YEAR,     @DL_FldProc_Year,     Year );
     AddFieldProc( 0, PNFLD_DLREESTREL_Secur,       DL_PNFLD_CHECKBOX, @DL_FldProc_CheckBox, "X");         
     AddFieldProc( 0, PNFLD_DLREESTREL_Deriv,       DL_PNFLD_CHECKBOX, @DL_FldProc_CheckBox, "X");         
     AddFieldProc( 0, PNFLD_DLREESTREL_VeksAcc,     DL_PNFLD_CHECKBOX, @DL_FldProc_CheckBox, "X");
     AddFieldProc( 0, PNFLD_DLREESTREL_APOSTROPHE,  DL_PNFLD_CHECKBOX, @DL_FldProc_CheckBox, "X");     

     if( With_XML )/*в excel или xml*/
        AddFieldProc( 0, PNFLD_DLREESTREL_EXCEL,    DL_PNFLD_EXCEL,    @DL_FldProc_CheckEXCEL,   "X");
        AddFieldProc( 0, PNFLD_DLREESTREL_XML,      DL_PNFLD_XML,      @DL_FldProc_CheckXML,     "");
     else/*только в excel*/
        AddFieldProc( 0, PNFLD_DLREESTREL_EXCEL,            DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          "X");
        DisableFields( this.Data(), PNFLD_DLREESTREL_EXCEL );
     end;

  END;

  PRIVATE MACRO Check():BOOL
     return true;
  END;
 
  initDL_XML_CPanel( Form, TableHeader, PNFLD_DLREESTREL_EXCEL, DL_IIF(With_XML,PNFLD_DLREESTREL_XML,NULL));
END;
