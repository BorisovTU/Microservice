/*
$Name:         dlsciragscn.mac
$Module:       Ядро Securities
$Description:  Массовое выполнение действий над агентами обращения
*/

import PTInter;
import CTInter;

private const ERROR_EXEC = 0;
private const PRINT_HEADER = 1;
private const PRINT_FOOTER = 2;

private const IRCAG_MASS_DEL = 0; // Удаление

private macro PrintHead( Head:String )
[
                   #
┌──────────────────────────┬──────┬───────────────────────────────────────────────────────────────────────────────────────────────────┐
│         Параметры        │  №   │                      Сообщение                                                                    │
│     агента обращения     │ошибки│                                                                                                   │
├──────────────────────────┼──────┼───────────────────────────────────────────────────────────────────────────────────────────────────┤]
( Head );
end;


private macro PrintFooter()
[└──────────────────────────┴──────┴───────────────────────────────────────────────────────────────────────────────────────────────────┘
];
end;

private macro PrintLine( FDoc:Variant, ErrStatus:Integer, ErrMessage:String )
    var VsIrcAg = TRecHandler( "vsircag" );
    var LLValues = TBFile( "llvalues" );
    var Params:String = "";

    VsIrcAg.SetRecordAddr( FDoc );

    ПолучитьКодСубъекта( VsIrcAg.rec.Agent, PTCK_CONTR );

    LLValues.Clear();
    LLValues.rec.List = OBJTYPE_VSAGNTROLE;
    LLValues.rec.Element = VsIrcAg.rec.AgentRole;
    LLValues.GetEQ();

    Params =
        ПолучитьКодСубъекта( VsIrcAg.rec.Agent, PTCK_CONTR ) + "\n"
      + LLValues.rec.Name + "\n"
      + VsIrcAg.rec.AgentName;

[│##########################│######│###################################################################################################│]
( Params:w, ErrStatus, ErrMessage:w );
end;

private macro DeleteIrcAg( NumExec:Integer, FDoc:Variant, ErrStatus:Integer, ErrMessage:String )
    if( NumExec == PRINT_HEADER )
        PrintHead( "Отчет о массовом удалении агентов обращения." );
    elif( NumExec == PRINT_FOOTER )
        PrintFooter();
    elif( NumExec == ERROR_EXEC )
        if( ErrStatus == 0 )
            ErrMessage = "Агент обращения успешно удален.";
        end;
        PrintLine( FDoc, ErrStatus, ErrMessage );
    end;
end;

macro Печать_ОтчетСканирования( NumExec:Integer, FDoc:Variant, ErrStatus:Integer, ErrMessage:STRING, Action:Integer )
    if( Action == IRCAG_MASS_DEL )
        DeleteIrcAg( NumExec, FDoc, ErrStatus, ErrMessage );
    end;
end;
