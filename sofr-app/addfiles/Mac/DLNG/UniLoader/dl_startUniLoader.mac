/*
$Name: dl_startUniLoader.mac
$Module: “­¨¢¥àá «ì­ë© § £àã§ç¨ª
$Description: ˆ¬¯®àâ ¢­¥è­¨å ¤ ­­ëå
*/

IMPORT RsbDataSet, RSD, "ul_const.mac", "dl_ul.mac", "globals.mac";

MACRO manipulation_func(_loader, _obj)
  var
      retVal = true,
      rs = TRsbDataSet("select * from ddl_ul_format_dbt where t_ID = " + _loader.Format);

    rs.MoveNext();

/*    if (rs.ID_DATAKIND == UL_DATAKIND_RATES)
        InstLoadModule("UL_Import_Rate.mac");
        retVal = ExecMacro2("UL_Import_Rate", _obj, _loader.Log);
    elif (rs.ID_DATAKIND == UL_DATAKIND_FRX)
        InstLoadModule("UL_Import_DLNGDeals.mac");
        retVal = ExecMacro2("UL_Import_FXDeal", _obj, _loader.Log);
    elif (rs.ID_DATAKIND == UL_DATAKIND_IBC)
        InstLoadModule("UL_Import_DLNGDeals.mac");
        retVal = ExecMacro2("UL_Import_IBCDeal", _obj, _loader.Log);
    else
        if (ValType(_loader.Log) != V_UNDEF)
            _loader.AddErrorLog("¥ ¨§¢¥áâ­ë© ¢¨¤ ¤ ­­ëå");
            return false;
        end;
    end;*/

    return retVal;
END;

PRIVATE MACRO AddReportLine(_Str, _ReportFile)
  var 
      retVal = false;

    if (_ReportFile != NULL)
        insert(_ReportFile, _Str);
        retVal = true;
    end;

    return retVal;
END;

MACRO log_func(_log)
  file RepFile() txt write;

  var
      ReportName = "UL_LOG_" + String({curdate}),
      idx = 0, cntError = _log.GetLog().size;

    open(RepFile, GetTxtFileName(ReportName));

    AddReportLine("ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿", RepFile);
    AddReportLine("³                               ‘®®¡é¥­¨¥                                          ³", RepFile);
    AddReportLine("ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´", RepFile);

    while (idx < cntError)
        AddReportLine("³" + 
                        string(_log.GetLog()[idx]:82) +
                      "³", RepFile);
        idx = idx + 1;
    end;

    AddReportLine("ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ", RepFile);

    close(RepFile);

    ViewFile(RepFile);
END;

LoadExternalData(NULL, "manipulation_func", "log_func");
exit(1);
