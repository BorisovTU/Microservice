/*
$Name: ul_conv_alfabank.mac
$Module: Универсальный загрузчик
$Description: Функции конвертации форматов Альфабанка
*/

IMPORT "ul_const.mac", "ul_conv_common.mac";

MACRO AB_ConvertDate(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    if (ValType(_input_value) == V_UNDEF)
        retVal_ = NULL;
    else
        retVal_ = date(int(substr(_input_value, 9, 2)),
                       int(substr(_input_value, 6, 2)),
                       int(substr(_input_value, 1, 4)));
    end;

    SetParm(0, retVal_);
    return 0;
END;

MACRO AB_ConvertCurrency(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    retVal_ = UL_GetRealIDObject(UL_CURRENCY, substr(_input_value, 1, 3), 3, _Log);
    SetParm(0, retVal_);
    return 0;
END;

MACRO AB_ConvertDealType(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    retVal_ = NULL;

    if (_input_value == "SPOT")
        retVal_ = 1000;
    elif (_input_value == "SWAP")
        retVal_ = 1020;
    end;

    SetParm(0, retVal_);
    return 0;
END;

MACRO AB_ConvertOriginID(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    SetParm(0, 0);
    return 0;
END;

MACRO AB_ConvertPartyID(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    retVal_ = UL_GetRealIDObject(UL_PARTY, _input_value, 1, _Log);
    SetParm(0, retVal_);
    return 0;
END;

MACRO AB_ConvertTradeSystem(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    SetParm(0, 0);
    return 0;
END;

MACRO AB_ConvertTraderID(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    SetParm(0, -1);
    return 0;
END;

MACRO AB_ConvertTypeDoc(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    retVal_ = NULL;

    if (_input_value == "BUY")
        retVal_ = "B";
    elif (_input_value == "SELL")
        retVal_ = "B";
    end;

    SetParm(0, retVal_);
    return 0;
END;