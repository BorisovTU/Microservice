/*
$Name: ul_parse_delim.mac
$Module: Универсальный загрузчик
$Description: Разбор файловых форматов через разделитель и формирование массива промежуточных объектов
*/

IMPORT "UL_InputDataObj.mac";

MACRO UL_Parse_Delim(_input_data, _loader)
  file TF() txt;

  var 
      retVal = TArray(),
      obj = NULL,
      delim = " ", Ключ = "", Значение = "";

    if (ValType(_loader.formatConfig) != V_UNDEF)
        if (_loader.formatConfig.Delim() == 1)
            delim = " ";
        elif (_loader.formatConfig.Delim() == 2)
            delim = "\t";
        end;
    end;

    SetDelim(delim);

    if (Open(TF, _input_data))
        Rewind(TF);

        obj = UL_InputDataObj_Base();
        while(Next(TF))
            Ключ = TF(0);
            Значение  = TF(1);
            if (StrBrk(TF.str, delim) == StrLen(TF.str))
                Значение  = "";
            end;

            obj.Add(Ключ, Значение);
        end;

        Close(TF);
        retVal[retVal.size] = obj;
    else
        _loader.AddErrorLog("Не могу открыть файл: " + String(_input_data));
        return NULL;
    end;

    return retVal;
END;