/*
$Name: ul_conv_mmvb.mac
$Module: Универсальный загрузчик
$Description: Функции конвертации форматов ММВБ
*/

IMPORT "ul_const.mac", "ul_conv_common.mac";

MACRO MMVB_ConvertCurrency(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    retVal_ = UL_GetRealIDObject(UL_CURRENCY, substr(_input_value, 1, 3), 3, _Log);
    SetParm(0, retVal_);
    return 0;
END;

MACRO MMVB_ConvertDealType(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    SetParm(0, 1000);
    return 0;
END;

MACRO MMVB_ConvertOriginID(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    SetParm(0, 7);
    return 0;
END;

MACRO MMVB_ConvertPartyID(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    if ((ValType(_input_value) == V_UNDEF)or(strlen(trim(_input_value)) == 0))
        _input_value = "XMIC";
    end;
    retVal_ = UL_GetRealIDObject(UL_PARTY, _input_value, 8, _Log);
    SetParm(0, retVal_);
    return 0;
END;

MACRO MMVB_ConvertTradeSystem(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    SetParm(0, 8);
    return 0;
END;

MACRO MMVB_ConvertTraderID(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    retVal_ = UL_GetRealIDObject(UL_PARTY, _input_value, 29, _Log);
    SetParm(0, retVal_);
    return 0;
END;

MACRO MMVB_ConvertMarket_Place(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    SetParm(0, "XMIC");
    return 0;
END;

MACRO MMVB_ConvertDate(retVal_, _input_value, _inputDataObj, _DataObj, _Log)
    if (ValType(_input_value) == V_UNDEF)
        retVal_ = NULL;
    else
        retVal_ = date(int(substr(_input_value, 9, 2)),
                       int(substr(_input_value, 6, 2)),
                       int(substr(_input_value, 1, 4)));
    end;

    SetParm(0, retVal_);
    return 0;
END;
