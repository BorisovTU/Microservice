/*
$Name: ul_conv_common.mac
$Module: Универсальный загрузчик
$Description: Общие функции конвертации
*/

IMPORT PTInter, FIInter, "ul_const.mac", "globals.mac";

MACRO UL_ByDefault(_val, _defval)
    if (ValType(_val) == V_UNDEF)
        return _defval;
    end;
    return _val;
end;

PRIVATE RECORD _fininstr(fininstr);
MACRO UL_GetRealIDObject(_KindObj, _Code, _GKBO_CodeKind, _Log);
  var
      PartyID = 0;

    if (_Code == "")
        _Code = -1;
    elif (_KindObj == UL_PARTY)
        PartyID = ПолучитьКодСубъекта(_Code, _GKBO_CodeKind);
        if (PartyID <= 0)
            if (ValType(_Log) != V_UNDEF)
                _Log.ErrorLog("В ГКБО не найден субъект с кодом \"" + _Code + "\" вида  " + _GKBO_CodeKind);
            end;
            _Code = -1;
        else
            _Code = PartyID;
        end;
    elif (_KindObj == UL_CURRENCY)
        if (ПолучитьФинИн( _Code, _fininstr, NULL, NULL, NULL, _GKBO_CodeKind))
            if (ValType(_Log) != V_UNDEF)
                _Log.ErrorLog("В ГКБО не найден ФИ с кодом \"" + _Code + "\" вида  " + _GKBO_CodeKind);
            end;
            _Code = -1;
        else
            _Code = _fininstr.fiid;  
        end;
    else
        if (ValType(_Log) != V_UNDEF)
            _Log.ErrorLog("Не известный вид объекта " + _GKBO_CodeKind);
        end;
        _Code = -1;
    end;

    return int(_Code);
END;
////////////////////////////////////////////////////////////////////////////////

MACRO DefUnknownParty(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, -1));
    return 0;
END;

MACRO DefStringEmpty(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, ""));
    return 0;
END;

MACRO DefInt0(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, 0));
    return 0;
END;

MACRO DefInt1(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, 1));
    return 0;
END;

MACRO DefInt3(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, 3));
    return 0;
END;

MACRO DefInt8(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, 8));
    return 0;
END;

MACRO DefSET_CHAR(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, "X"));
    return 0;
END;

MACRO DefUNSET_CHAR(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, CodeFor(0)));
    return 0;
END;

MACRO DefOperDprt(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, {OperDprt}));
    return 0;
END;

MACRO DefOurBank(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, UL_ByDefault(_input_value, {OurBank}));
    return 0;
END;

MACRO DoubleAbsVal(retVal_, _input_value, _inputDataObj, _DataObj)
    SetParm(0, abs(Double(_input_value)));
    return 0;
END;
