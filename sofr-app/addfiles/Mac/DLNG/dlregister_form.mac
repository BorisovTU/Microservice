/*
$Name:         dlregister_form.mac
$Module:       Векселя банка
$Description:  Отчет "Регистр по собственным/учтенным векселям" - форма ввода данных
*/

IMPORT "DlRepForm_h.mac";

MACRO DL_FldProc_FormMethod( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
    FldRealValue = DL_OUTREPORT_EXCEL;
    FldShowValue = "Excel";
  end;
  return CM_DEFAULT;
END;

// Номера полей в форме отчета
CONST
    PNFLD_DLREGREP_PERIOD     = 0, // отчетная дата
    PNFLD_DLREGREP_YEAR       = 1, // код валюты
    PNFLD_DLREGREP_GROWTH     = 2, // наименование валюты
    PNFLD_DLREGREP_BEGINDATE  = 3, // код филиала
    PNFLD_DLREGREP_ENDDATE    = 4, // наименование филиала
    PNFLD_DLREGREP_FI         = 5, // наименование филиала
    PNFLD_DLREGREP_FI_NAME    = 6, // наименование филиала
    PNFLD_DLREGREP_DEPARTCODE = 7, // наименование филиала
    PNFLD_DLREGREP_FORMMETHOD = 8; // наименование филиала

CLASS ( DL_CPanel ) DL_Register_Panel(NameResource)
    PRIVATE MACRO Init()
        VAR CurMonth, CurYear, CurQuartal, Year;
        DateSplit( {curdate}, null, @CurMonth, CurYear );
            
        if( CurMonth == 1 )
            Year        = CurYear - 1;
            CurQuartal = 16;
        else
            CurQuartal = (CurMonth - 1)/3 + 13; /*текущий квартал*/
        end;

        AddFieldProc( 0, PNFLD_DLREGREP_PERIOD, DL_PNFLD_PERIOD, @DL_FldProc_Period, CurQuartal, 1,1);
        AddFieldProc( 0, PNFLD_DLREGREP_YEAR, DL_PNFLD_YEAR, @DL_FldProc_Year, Year, 1,1);
        AddFieldProc( 0, PNFLD_DLREGREP_GROWTH, DL_PNFLD_GROWTH, @DL_FldProc_Growth, "X", 1,1);
        AddFieldProc( 0, PNFLD_DLREGREP_BEGINDATE, DL_PNFLD_BEGINDATE, @DL_FldProc_BeginDate, {curdate}, 1,1);
        AddFieldProc( 0, PNFLD_DLREGREP_ENDDATE, DL_PNFLD_ENDDATE, @DL_FldProc_EndDate, {curdate}, 1,1);
        AddFieldProc( 0, PNFLD_DLREGREP_FI, DL_PNFLD_FI, @DL_FldProc_FI, ALLFININSTR, 1,1);
        AddFieldProc( 0, PNFLD_DLREGREP_FI_NAME, DL_PNFLD_FI_NAME, @DL_FldProc_FI_Name, ALLFININSTR, 1,1);
        AddFieldProc( 0, PNFLD_DLREGREP_DEPARTCODE, DL_PNFLD_DEPARTCODE, @DL_FldProc_DepartCode, -1, 1,1);
        AddFieldProc( 0, PNFLD_DLREGREP_FORMMETHOD, DL_USERFIELD, @DL_FldProc_FormMethod, NULL, 1,1);
    END;

    PRIVATE MACRO Check():BOOL
        return true;
    END;

    initDL_CPanel( "vs_rep.lbr", NameResource ); 
END;

