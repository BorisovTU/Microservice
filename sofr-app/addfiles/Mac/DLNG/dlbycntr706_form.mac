/*
$Name:        dlbycntr706_form.mac
$Module:      Ценные бумаги
$Description: форма отчета "Сведения об объемах внебиржевых сделок"
*/

import "DlRepForm_h.mac", "globals.mac";

/*Номера полей в форме отчета*/
CONST PNFLD_DLBYCNTR_PERIOD         = 0,
      PNFLD_DLBYCNTR_YEAR           = 1,
      PNFLD_DLBYCNTR_ISSECUR        = 2,
      PNFLD_DLBYCNTR_ISVA           = 3,
      PNFLD_DLBYCNTR_APOSTROPHE     = 4,
      PNFLD_DLBYCNTR_EXCEL          = 5,
      PNFLD_DLBYCNTR_STD            = 6,
      PNFLD_DLBYCNTR_KLIKO          = 7,
      PNFLD_DLBYCNTR_DELTA          = 8;
                                      
PRIVATE CONST /* Обработчики для нестандарных контролов */
      H_DLBYCNTR_ISSECUR = 101,
      H_DLBYCNTR_ISDV    = 102,
      H_DLBYCNTR_ISVA    = 103;

PRIVATE MACRO DL_FldProc_CheckISSECUR( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = "";
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != "X" )
           FldShowValue = FldRealValue = "X";
        else
           if( pThis.GetLinkedValue(H_DLBYCNTR_ISVA) == "X" )
              FldShowValue = FldRealValue = "";
           end;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO DL_FldProc_CheckISVA( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = "";
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != "X" )
           FldShowValue = FldRealValue = "X";
        else
           if( pThis.GetLinkedValue(H_DLBYCNTR_ISSECUR) == "X" )
              FldShowValue = FldRealValue = "";
           end;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

CLASS (DL_CPanel) DL_DLBYCNTR_706_Panel()

  PRIVATE MACRO Init()
     VAR CurMonth, CurYear;
     DateSplit( {curdate}, null, CurMonth, CurYear );

     /*текущий год или предшествующий текущему, если текущая операционная дата не превышает 31 января*/
     if( CurMonth == 1 )
        CurYear     = CurYear - 1;
        CurMonth    = 12;
     end;

     AddFieldProc( 0, PNFLD_DLBYCNTR_PERIOD,     DL_PNFLD_PERIOD,      @DL_FldProc_Period,            CurMonth, 39, 12 );
     AddFieldProc( 0, PNFLD_DLBYCNTR_YEAR,       DL_PNFLD_YEAR,        @DL_FldProc_Year,              CurYear );
     AddFieldProc( 0, PNFLD_DLBYCNTR_ISSECUR,    H_DLBYCNTR_ISSECUR,   @DL_FldProc_CheckISSECUR,      SET_CHAR );
     AddFieldProc( 0, PNFLD_DLBYCNTR_ISVA,       H_DLBYCNTR_ISVA,      @DL_FldProc_CheckISVA,         SET_CHAR );

     AddFieldProc( 0, PNFLD_DLBYCNTR_APOSTROPHE, DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          SET_CHAR );
     AddFieldProc( 0, PNFLD_DLBYCNTR_EXCEL,      DL_PNFLD_EXCEL,       @DL_FldProc_CheckEXCEL,        SET_CHAR );
     AddFieldProc( 0, PNFLD_DLBYCNTR_STD,        DL_PNFLD_STD,         @DL_FldProc_CheckSTD,          UNSET_CHAR );
     AddFieldProc( 0, PNFLD_DLBYCNTR_KLIKO,      DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          UNSET_CHAR );
     AddFieldProc( 0, PNFLD_DLBYCNTR_DELTA,      DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          UNSET_CHAR );

     DisableFields( This.Data(), PNFLD_DLBYCNTR_STD ); /*вывод в текст заблокирован пока, т.к. возможно в будущем откажемся от такого вывода*/

  END;

  PRIVATE MACRO Check():BOOL
     return true;
  END;

  initDL_CPanel( "dlrep.lbr", "DLBYC706" ); 
END;
