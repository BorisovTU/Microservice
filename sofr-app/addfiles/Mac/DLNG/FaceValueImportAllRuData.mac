/**
 @file  FaceValueImportAllRuData.mac
 @brief Перегрузить номинал по всем бумагам с изменяемым номиналом  через kafka 
 */

import oralib, likepy, globals, rsexts,dlquery;

/*
@brief Запуск хранимой процедуры it_rudata.DateOptionsTableWrapper_Rq, Перегрузить номинал по всем бумагам с изменяемым номиналом  через kafka
*/

macro start_RuData_FaceValue()
  var v_sql,v_cmd, err, v_code = 0, v_desc= "";

   v_sql = "declare  "
                + "  out_result_code   NUMBER; "               
                + "  out_result_text   VARCHAR2(4000); "  
                + "  begin" 
                + "  it_rudata.DateOptionsTableWrapper_Rq(p_result_code  => out_result_code  "
                + "                                      ,p_result_text  => out_result_text ) ;"
                + "   ?:= out_result_code; " 
                + "   ?:= out_result_text; " 
                + " end;";  

         v_cmd = RSDCommand(v_sql);
         v_cmd.addParam("out_result_code",   RSDBP_OUT, V_INTEGER);
         v_cmd.addParam("out_result_text",   RSDBP_OUT, V_STRING, 1000);
         v_cmd.Execute(); 

         v_code = v_cmd.value("out_result_code");
         v_desc = v_cmd.value("out_result_text");

  if(v_code == 0)
    msgbox("Успешно выполнено");
  else
    msgbox(v_desc);
  end;
  v_cmd.close(); v_cmd = null; v_sql = null;

onError(err)
  MsgBox(err.message);
end;


if (Gettrue(false, "Необходимо ли загрузить номинал по всем бумагам?"))
   start_RuData_FaceValue();
else 
   return;
end;