/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vasflib.mac
  Programmer  : €§ à¥­®ª ž.ƒ.
  Comment     : ‘â ­¤ àâ­ë¥  «£®à¨â¬ë ¢§¨¬ ­¨ï ª®¬¨áá¨¨.
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
Import SfInter, va4each, valib, vamisc, VAInter;

const SF_BASETYPE_SUM     = 1;      /* ‘ã¬¬ */
const SF_BASETYPE_QUONT   = 2;      /* Š®«¨ç¥áâ¢®*/

record sfbassum( "sfbassum.str" );

/* €«£®à¨â¬ 1
*/
MACRO vasf_1(tick, cur)

var sum = $0, b_sum = $0, s_sum = $0, role = VSORDLNK_K_ALL;

    if (VA_IsExchange(tick.DealType))
        //„«ï ¬¥­ë áã¬¬  á¤¥«ª¨ - íâ® áâ®¨¬®áâì ¯¥à¥¤ ¢ ¥¬ëå ¢¥ªá¥«¥© á ãç¥â®¬ ¤®¯« âë
        //ˆ‹ˆ áâ®¨¬®áâì ¯®«ãç ¥¬ëå ¢¥ªá¥«¥© á ãç¥â®¬ ¤®¯« âë
        VA_GetTickSum(tick, @b_sum, tick.DealDate, cur, VSORDLNK_K_BUY);
        VA_GetTickSum(tick, @s_sum, tick.DealDate, cur, VSORDLNK_K_SALE);

        if (b_sum > s_sum)
           sum = b_sum;
        else
           sum = s_sum;
        end;
    else
        if (VA_IsBuy(tick.DealType))
           role = VSORDLNK_K_BUY;
        elif (VA_IsSale(tick.DealType))
           role = VSORDLNK_K_SALE;
        end;

        VA_GetTickSum(tick, @sum, tick.DealDate, cur, role);
    end;

    ClearRecord(sfbassum);
    sfbassum.baseType      = SF_BASETYPE_SUM;
    sfbassum.baseSum       = sum;
    sfbassum.FIID_baseSum  = cur;
    sfbassum.baseType2     = SF_BASETYPE_SUM;   
    sfbassum.baseSum2      = sum;
    sfbassum.FIID_baseSum2 = cur;
    if(InsertSumList(sfbassum) != 0)
        MsgBox("Žè¨¡ª  ¯à¨ ¢áâ ¢ª¥ ¡ §®¢®© áã¬¬ë");
    end;

END;


