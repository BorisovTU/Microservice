/*******************************************************************************
 DESCRIPTION  :   Отчет "Реестр показателей по учтенным ценным бумагам" - форма ввода данных
 PROGRAMMED BY:   Nikonorov Evgeny
 CREATION DATE:   22.11.2011
*******************************************************************************/
import "DlRepForm_h.mac", "globals.mac";

/*Номера полей в форме отчета*/
CONST PNFLD_CALCREG_BEGINDATE      = 0,
      PNFLD_CALCREG_ENDDATE        = 1,
      PNFLD_CALCREG_APOSTR         = 2,
      PNFLD_CALCREG_BYDEPCERTS     = 3,
      PNFLD_CALCREG_BYBILLS        = 4,
      PNFLD_CALCREG_BYALLBILLS     = 5,
      PNFLD_CALCREG_BYDISCBILLS    = 6,
      PNFLD_CALCREG_BYPERCBILLS    = 7,
      PNFLD_CALCREG_RESERVE_YES    = 8,
      PNFLD_CALCREG_RESERVE_NO     = 9,
      PNFLD_CALCREG_RESERVE_ONLYRES= 10,
      PNFLD_CALCREG_PRINTEXCEL     = 11,
      PNFLD_CALCREG_PRINTTXT       = 12;

PRIVATE CONST 
      H_CHECKBOX_BYBILLS           = 100,
      H_RADIO_BYALLBILLS           = 101, 
      H_RADIO_BYDISCBILLS          = 102,
      H_RADIO_BYPERCBILLS          = 103,
      H_RADIO_RESERVE_YES          = 104,
      H_RADIO_RESERVE_NO           = 105, 
      H_RADIO_RESERVE_ONLYRES      = 106,
      H_RADIO_PRINTEXCEL           = 107, 
      H_RADIO_PRINTTXT             = 108; 



CLASS VACalcRegFormData()
  VAR BegDate         = {curdate},
      EndDate         = {curdate},
      IsUseApp        = SET_CHAR,
      ByDepCerts      = SET_CHAR,
      ByBills         = SET_CHAR,
      ByAllBills      = SET_CHAR,
      ByDiscBills     = UNSET_CHAR,
      ByPercBills     = UNSET_CHAR,
      ReserveYes      = SET_CHAR,
      ReserveNo       = UNSET_CHAR,
      ReserveOnlyRes  = UNSET_CHAR,
      PrintExcel      = SET_CHAR,
      PrintTxt        = UNSET_CHAR;

END;

VAR VACalcRegRepFormData = VACalcRegFormData();

PRIVATE MACRO FldProc_RadioReserveYes( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = UNSET_CHAR;
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
     if (FldShowValue == SET_CHAR)
       pThis.SetLinkedValue( H_RADIO_RESERVE_NO    , UNSET_CHAR);
       pThis.SetLinkedValue( H_RADIO_RESERVE_ONLYRES, UNSET_CHAR);
     end;
     if (FldRealValue != FldShowValue)
      FldShowValue = FldRealValue;
     end;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_RadioReserveNo( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = UNSET_CHAR;
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
     if (FldShowValue == SET_CHAR)
       pThis.SetLinkedValue( H_RADIO_RESERVE_YES   , UNSET_CHAR);
       pThis.SetLinkedValue( H_RADIO_RESERVE_ONLYRES, UNSET_CHAR);
     end;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_RadioReserveOnlyRes( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = UNSET_CHAR;
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
     if (FldShowValue == SET_CHAR)
       pThis.SetLinkedValue( H_RADIO_RESERVE_YES, UNSET_CHAR);
       pThis.SetLinkedValue( H_RADIO_RESERVE_NO, UNSET_CHAR);
     end;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_RadioPrintExcel( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = UNSET_CHAR;
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
     if (FldShowValue == SET_CHAR)
       pThis.SetLinkedValue( H_RADIO_PRINTTXT, UNSET_CHAR);
     end;
     if (FldRealValue != FldShowValue)
      FldShowValue = FldRealValue;
     end;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_RadioPrintTxt( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = UNSET_CHAR;
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
     if (FldShowValue == SET_CHAR)
       pThis.SetLinkedValue( H_RADIO_PRINTEXCEL, UNSET_CHAR);
     end;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_ByBills( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = SET_CHAR;
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
     
     if (FldShowValue == SET_CHAR)
       EnableFields( pThis.Data(), PNFLD_CALCREG_BYALLBILLS );
       EnableFields( pThis.Data(), PNFLD_CALCREG_BYDISCBILLS );
       EnableFields( pThis.Data(), PNFLD_CALCREG_BYPERCBILLS );

       if((pThis.GetLinkedValue(H_RADIO_BYALLBILLS) == UNSET_CHAR) and (pThis.GetLinkedValue(H_RADIO_BYDISCBILLS) == UNSET_CHAR) and (pThis.GetLinkedValue(H_RADIO_BYPERCBILLS) == UNSET_CHAR))
         pThis.SetLinkedValue( H_RADIO_BYALLBILLS,  SET_CHAR);
         pThis.SetLinkedValue( H_RADIO_BYDISCBILLS, UNSET_CHAR);
         pThis.SetLinkedValue( H_RADIO_BYPERCBILLS, UNSET_CHAR);
       end;
     else
       DisableFields( pThis.Data(), PNFLD_CALCREG_BYALLBILLS );
       DisableFields( pThis.Data(), PNFLD_CALCREG_BYDISCBILLS );
       DisableFields( pThis.Data(), PNFLD_CALCREG_BYPERCBILLS );

       pThis.SetLinkedValue( H_RADIO_BYALLBILLS,  UNSET_CHAR);
       pThis.SetLinkedValue( H_RADIO_BYDISCBILLS, UNSET_CHAR);
       pThis.SetLinkedValue( H_RADIO_BYPERCBILLS, UNSET_CHAR);
     end;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
        else
           FldShowValue = FldRealValue = UNSET_CHAR;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_ByAllBills( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = SET_CHAR;
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
     if (FldShowValue == SET_CHAR)
       pThis.SetLinkedValue( H_RADIO_BYDISCBILLS, UNSET_CHAR);
       pThis.SetLinkedValue( H_RADIO_BYPERCBILLS, UNSET_CHAR);
     end;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_ByDiscBills( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = SET_CHAR;
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
     if (FldShowValue == SET_CHAR)
       pThis.SetLinkedValue( H_RADIO_BYALLBILLS, UNSET_CHAR);
       pThis.SetLinkedValue( H_RADIO_BYPERCBILLS, UNSET_CHAR);
     end;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
        end;
     end;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_ByPercBills( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = SET_CHAR;
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
     if (FldShowValue == SET_CHAR)
       pThis.SetLinkedValue( H_RADIO_BYALLBILLS, UNSET_CHAR);
       pThis.SetLinkedValue( H_RADIO_BYDISCBILLS, UNSET_CHAR);
     end;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
        end;
     end;
  end;
  return CM_DEFAULT;
END;



CLASS (DL_CPanel) VA_CalcReg_Panel()

  PRIVATE MACRO Init()

     AddFieldProc( 0, PNFLD_CALCREG_BEGINDATE,    DL_PNFLD_BEGINDATE,    @DL_FldProc_BeginDate,  VACalcRegRepFormData.BegDate);
     AddFieldProc( 0, PNFLD_CALCREG_ENDDATE,      DL_PNFLD_ENDDATE,      @DL_FldProc_EndDate,    VACalcRegRepFormData.EndDate);
     AddFieldProc( 0, PNFLD_CALCREG_APOSTR,       DL_PNFLD_CHECKBOX,     @DL_FldProc_CheckBox,   VACalcRegRepFormData.IsUseApp);

     AddFieldProc( 0, PNFLD_CALCREG_BYDEPCERTS,   DL_PNFLD_CHECKBOX,     @DL_FldProc_CheckBox,   VACalcRegRepFormData.ByDepCerts);
     AddFieldProc( 0, PNFLD_CALCREG_BYBILLS,      H_CHECKBOX_BYBILLS,    @FldProc_ByBills,       VACalcRegRepFormData.ByBills);
     AddFieldProc( 0, PNFLD_CALCREG_BYALLBILLS,   H_RADIO_BYALLBILLS,    @FldProc_ByAllBills,    VACalcRegRepFormData.ByAllBills);
     AddFieldProc( 0, PNFLD_CALCREG_BYDISCBILLS,  H_RADIO_BYDISCBILLS,   @FldProc_ByDiscBills,   VACalcRegRepFormData.ByDiscBills);
     AddFieldProc( 0, PNFLD_CALCREG_BYPERCBILLS,  H_RADIO_BYPERCBILLS,   @FldProc_ByPercBills,   VACalcRegRepFormData.ByPercBills);

     AddFieldProc( 0, PNFLD_CALCREG_RESERVE_YES,    H_RADIO_RESERVE_YES,    @FldProc_RadioReserveYes,     VACalcRegRepFormData.ReserveYes);
     AddFieldProc( 0, PNFLD_CALCREG_RESERVE_NO,     H_RADIO_RESERVE_NO,     @FldProc_RadioReserveNo,      VACalcRegRepFormData.ReserveNo);
     AddFieldProc( 0, PNFLD_CALCREG_RESERVE_ONLYRES, H_RADIO_RESERVE_ONLYRES, @FldProc_RadioReserveOnlyRes,  VACalcRegRepFormData.ReserveOnlyRes);

     AddFieldProc( 0, PNFLD_CALCREG_PRINTEXCEL,   H_RADIO_PRINTEXCEL,    @FldProc_RadioPrintExcel,   VACalcRegRepFormData.PrintExcel);
     AddFieldProc( 0, PNFLD_CALCREG_PRINTTXT,     H_RADIO_PRINTTXT,      @FldProc_RadioPrintTxt,     VACalcRegRepFormData.PrintTxt);

  END;

  PRIVATE MACRO Check():BOOL
     if((GetFieldValue(PNFLD_CALCREG_BYBILLS) != SET_CHAR) AND (GetFieldValue(PNFLD_CALCREG_BYDEPCERTS) != SET_CHAR))
       msgbox("Необходимо указать вид ц/б");
       return false;
     end;

     return true;
  END;

  
  initDL_CPanel( "deals.lbr", "VACALCRG" ); 
END;