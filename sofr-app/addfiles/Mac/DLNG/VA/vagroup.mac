/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : vagroup.mac
  Comment     : Группировка векселей по валюте номинала
                Используется при постановке на / снятия с внебаланса
└───────────────────────────────────────────────────────────────────────────*/


/* класс с информацией по группе с ФИ векселей
*/
PRIVATE CLASS FiidGrp (TheFiid, TheAccount, TheAmount, TheAmountVR) 
var 
   FIID, acc, amount, amountVR;

   FIID    = TheFiid;          // ВН
   acc     = TheAccount;
   amount  = TheAmount;        // сумма в ВН
   amountVR  = TheAmountVR;    // сумма в ВР

END;


/* Класс: группы векселей по Fiid
*/
CLASS VA_FiidGroupsClass ()
 var 
  stat = 0,
  ArrGrp = TArray; /* Массив групп  */

  ArrGrp.size = 0;

  PRIVATE MACRO newGrp(fiid, acc, amount, amountVR)
   ArrGrp[ArrGrp.size] = FiidGrp(fiid, acc, amount, amountVR);
  END;

  PRIVATE MACRO find(fiid)
   var i = 0;
    while (i < ArrGrp.size)
      if(ArrGrp[i].FIID == fiid)
        return i;
      end;
      i = i + 1;
    end;
    return -1;
  END;

  PRIVATE MACRO add (i, amount, amountVR)
     ArrGrp[i].amount = ArrGrp[i].amount + amount;
     ArrGrp[i].amountVR = ArrGrp[i].amountVR + amountVR;
  END;

  MACRO group(fiid, acc, amount, amountVR)
   var i = find(fiid);
     if(i == -1)
        newGrp(fiid, acc, amount, amountVR);
     else
        add (i, amount, amountVR);
     end;
  END;


END;
