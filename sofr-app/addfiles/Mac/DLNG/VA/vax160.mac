/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vax160.mac
                                va-вексель
                                 x-операция мены векселей (bart)
                               160-номер (соответствующий шагу)
  Programmer  : Чижик К.Н.
  Операция    : Мена векселей
  Шаг         : Требуется доплата?
└───────────────────────────────────────────────────────────────────────────*/
IMPORT vacateg, valib, vabart, vamisc;

/* Требуется доплата?
*/
MACRO ExecuteCaseStep( Kind_Operation, Number_Step, FDoc, KindDoc )
var step = "", payms = TBfile("pmpaym.dbt"), StepDate;
    record tick("dl_tick");
    SetBuff( tick, FDoc );

    GetOprDate( DATE_BART_OLD, @StepDate );
    
    if( StepDate > {curdate} )
       MsgBox ("Преждевременное выполнение шага запрещено.");
       return 1;
    end;

    if(VA_Get1stPlanPaym(tick.BofficeKind, tick.DealID, PM_PURP_VSBARTERDIFF, payms))
       step = "165"; /* да */
    elif(not ПоискШагаЗакрытие(tick))
       step = "200"; /* нет */
    end;

    return step;
END;
