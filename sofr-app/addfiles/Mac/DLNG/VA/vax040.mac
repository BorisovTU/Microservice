/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vax040.mac
                                va-вексель
                                 x-операция мены векселей (bart)
                               040-номер (соответствующий шагу)
  Programmer  : Чижик К.Н.
  Операция    : Мена векселей
  Шаг         : Вести внебалансовый учет?
└───────────────────────────────────────────────────────────────────────────*/
IMPORT OprInter, vabart, vamisc;

/* Запуск шага
     1.  Если указан клиент в сделке, то выход по ветке Нет (клиент).
     2.  Если Dс <> Dп_тр и Dс <> Dп_об и Dс <> Dо, то выход по ветке Да.
     3.  Выход по ветке Нет (банк).
*/
MACRO ExecuteCaseStep( Kind_Operation, Number_Step, FDoc, KindDoc )

   var OldDate, NewDate, DiffDate;
   record tick("dl_tick");

   SetBuff( tick, FDoc );

   if( tick.DealDate > {curdate} )
      MsgBox ("Преждевременное выполнение шага запрещено.");
      return 1;
   end;

   if(VA_IsClient(tick))
      /* Нет (клиент) */
      return "120";   /* Исполнение обязательств */
   else
      GetOprDate( DATE_BART_DIFF, DiffDate ); /* Дата оплаты разницы */
      GetOprDate( DATE_BART_OLD, OldDate ); /* Дата поставки ц/б по обязательствам */
      GetOprDate( DATE_BART_NEW, NewDate ); /* Дата поставки ц/б по требованиям */
      if((tick.DealDate != DiffDate) AND (tick.DealDate != OldDate) AND (tick.DealDate != NewDate))
         /* Да */
         return "50";
      else
         /* Нет (банк) */
         return "100";
      end;
   end;

END;
