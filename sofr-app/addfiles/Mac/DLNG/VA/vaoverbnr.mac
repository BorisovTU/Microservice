import vaovernvpi, vacateg, InsCarryDoc, OprInter, PaymInter, vaservop;

PRIVATE RECORD bnr(vsbanner);

MACRO ExecuteStep(Buffer, FirstDoc)
  var stat = 0;
  var РольСчета, Дата={curdate}, ВалРасчетов;
  var ObjType = OverObjType;
  
  SetBuff( bnr, FirstDoc );
  if((ValType(OprServDoc) != V_UNDEF) and (OprServDoc.ValueDate > date(0,0,0)))
    Дата = OprServDoc.ValueDate;
  end;
   
  if(ValType(ObjType) == V_UNDEF) //не из сервисной операции
    if(ВексельДляПереоценкиНВПИВложенийВЦБ(bnr, Дата))
      ObjType = VAOVER_OBJTYPE_AVOIRISS;
    elif(ВексельДляПереоценкиНВПИИндоссамента(bnr, Дата))
      ObjType = VAOVER_OBJTYPE_ENDORSEMENT;
    end;
  end;

  if((ObjType == VAOVER_OBJTYPE_AVOIRISS))
    stat = ПереоценкаНВПИВекселя(bnr.BCID, Дата);
  elif(ObjType == VAOVER_OBJTYPE_ENDORSEMENT)
    stat = ПереоценкаНВПИИндоссамента(bnr.BCID, Дата);
  end;
  
  return stat;

END;

