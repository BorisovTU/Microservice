/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : vae050.mac
                                va-вексель
                               B/S-операция зачисление/списание векселей
                                50-номер (соответствующий шагу)
  Programmer  : 
  Операция    : Зачисление/списание векселей
  Шаг         : З.закрытие
  Comment     :
└───────────────────────────────────────────────────────────────────────────*/
IMPORT vacateg, valib, vapaym, vaopr;


/* Запуск шага
   Алгоритм:
     Если статус хотя бы одного платежа с назначениями "актив" < 
     $(Готов к отправке), то выход по ошибке 
     "Требования по сделке не исполнены".
*/
MACRO ExecuteStep(Buffer, dl_tick, DocKind, ID_Operation)
var
    stat = 0;

    record tick( dl_tick );
    SetBuff( tick, dl_tick );

    if(not VA_ArePaymsClosed(tick, BAi))     /* проверка платежей по активу */
      stat = VA_Err("Требования по сделке не исполнены");
    elif(not CheckAllStepsExecuted(ID_Operation))   /* проверка что все шаги выполнены */
      stat = VA_Err("Перед закрытием операции все шаги должны быть исполнены!");
    end;

    return stat;

END;


