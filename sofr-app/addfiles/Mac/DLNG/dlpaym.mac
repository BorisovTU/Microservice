/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  Programmer  : Сабитов Р.Р.
  Description : Сервисные ф-ии для платежей
└───────────────────────────────────────────────────────────────────────────*/
IMPORT FIInter;
/* Класс свойств платежа*/
CLASS (TBfile) TBFilePMPROP (p1,p2,p3,p4,p5)
    MACRO find (paym, IsKredit)
        this.KeyNum = 0;
        this.rec.PaymentId = paym.rec.PaymentID;
        if (IsKredit)
            this.rec.DebetCredit = 1;
        else
            this.rec.DebetCredit = 0;
        end;

        if (not this.GetEQ)
            msgbox ("Платеж должен быть внешним");
            return false;
        end;
        return true;
    END;

    MACRO ПолучитьКорСчет (paym, CorrAcc)
        CorrAcc = GetCorAcc (paym.rec.FIID, this.rec.Corschem, CORS_ACC_ACCOUNT);

        if (CorrAcc=="")
            msgbox ("Не найден корреспонденский|счет в валюте " + ПолучитьКодФинИн(paym.rec.FIID), 
                       "|по схеме расчетов " + this.rec.Corschem);
            return false;
        end;

        SetParm (2, CorrAcc);
        return true;
    END;

    if (p1==null)
        p1 = "pmprop";
    end;

    InitTBFile(p1,p2,p3,p4,p5);
END;

/*класс корсхемы*/
CLASS (TBFile) TBFileCORSCHEM (p1,p2,p3,p4,p5)
    MACRO find (pmpaym, pmprop)
        this.KeyNum = 1;
        this.rec.Number = pmprop.rec.Corschem;
        this.rec.FI_Kind = FIKIND_CURRENCY;
        this.rec.FIID = pmpaym.rec.FIID;
        if (not this.GetEQ)
          msgbox ("Не могу получить схему расчетов");
          return false;
        end;

        return true;
    END;

    if (p1==null)
        p1 = "corschem";
    end;
    InitTBFile(p1,p2,p3,p4,p5);
END;