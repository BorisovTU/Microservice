/*
$Name:        GenerateCntrlPariedAccRep.mac
$Module:      Ценные бумаги
$Description: Отчет "Контроль по привязке парных счетов"
*/

import "GenerateCntrlPariedAccRep_form.mac", IPS;

var settingsForm = DL_PAIRAREP_Panel();

if (settingsForm.Run())
  var reportName = "Отчет Контроль по привязке парных счетов за " + String(settingsForm.GetFieldValue(PNFLD_PAIRAREP_DATE):f) + ".xlsx";
  var result = IPSDFactoryRequest(GetFullTxtPath(not IsStandAlone()) + reportName,
                                  "it_generatcntrlpariedacc.ReportRun",
                                  MakeArray(settingsForm.GetFieldValue(PNFLD_PAIRAREP_DATE), settingsForm.GetFieldValue(PNFLD_PAIRAREP_SEC), settingsForm.GetFieldValue(PNFLD_PAIRAREP_DV), settingsForm.GetFieldValue(PNFLD_PAIRAREP_MMARK), settingsForm.GetFieldValue(PNFLD_PAIRAREP_BANKVEKSEL), settingsForm.GetFieldValue(PNFLD_PAIRAREP_VEKSEL)));
                                  
  if (result.errorCode != 0)
    MsgBox("Ошибка формирования отчета:\n" + result.errorDesc);
  elif (not StartShellProgram(result.data.fileName) == 0)
    MsgBox("Сформирован файл:\n" + result.data.fileName);
  end;
end;
