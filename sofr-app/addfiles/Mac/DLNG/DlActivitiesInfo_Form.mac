/*
$Name:        DlActivitiesInfo_Form.mac
$Module:      Ценные бумаги
$Description: Форма отчета "Сведения об осуществлении брокерской,
              депозитарной деятельности и деятельности по управлению ценными бумагами"
*/

import "DlRepForm_h.mac", "globals.mac";

/*Номера полей в форме отчета*/
CONST PNFLD_FORM707_PERIOD         = 0,
      PNFLD_FORM707_YEAR           = 1,
      PNFLD_FORM707_ISSECUR        = 2,
      PNFLD_FORM707_ISDV           = 3,
      PNFLD_FORM707_ISVA           = 4,
      PNFLD_FORM707_ISDEPO         = 5,
      PNFLD_FORM707_APP            = 6,
      PNFLD_FORM707_EXCEL          = 7,
      PNFLD_FORM707_STD            = 8,
      PNFLD_FORM707_KLIKO          = 9,
      PNFLD_FORM707_PROTOCOL_TXT   = 10,
      PNFLD_FORM707_DELTA          = 11;

CLASS (DL_CPanel) DL_ActivitiesInfo_Form707()

  PRIVATE MACRO Init()
     VAR CurMonth, CurYear, CurQuartal, Year;
     DateSplit( {curdate}, null, @CurMonth, CurYear );

     if( CurMonth == 1 )
        Year        = CurYear - 1;
        CurQuartal = 16;
     else
        CurQuartal = (CurMonth - 1)/3 + 13; /*текущий квартал*/
     end;

     AddFieldProc( 0, PNFLD_FORM707_PERIOD,       DL_PNFLD_PERIOD,      @DL_FldProc_Period,            CurQuartal, 39, 12 );
     AddFieldProc( 0, PNFLD_FORM707_YEAR,         DL_PNFLD_YEAR,        @DL_FldProc_Year,              Year );
     AddFieldProc( 0, PNFLD_FORM707_ISSECUR,      DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          SET_CHAR );
     AddFieldProc( 0, PNFLD_FORM707_ISDV,         DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          SET_CHAR );
     AddFieldProc( 0, PNFLD_FORM707_ISVA,         DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          SET_CHAR );
     AddFieldProc( 0, PNFLD_FORM707_ISDEPO,       DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          SET_CHAR );
     AddFieldProc( 0, PNFLD_FORM707_APP,          DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          SET_CHAR );
     AddFieldProc( 0, PNFLD_FORM707_EXCEL,        DL_PNFLD_EXCEL,       @DL_FldProc_CheckEXCEL,        SET_CHAR );
     AddFieldProc( 0, PNFLD_FORM707_KLIKO,        DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          UNSET_CHAR );
     AddFieldProc( 0, PNFLD_FORM707_PROTOCOL_TXT, DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          UNSET_CHAR );
     AddFieldProc( 0, PNFLD_FORM707_DELTA,        DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,          UNSET_CHAR );


     DisableFields( This.Data(), PNFLD_FORM707_STD ); /*вывод в текст заблокирован пока, т.к. возможно в будущем откажемся от такого вывода*/

  END;

  PRIVATE MACRO Check():BOOL
     if( (this.GetFieldValue( PNFLD_FORM707_ISSECUR ) == UNSET_CHAR) and
         (this.GetFieldValue( PNFLD_FORM707_ISDV ) == UNSET_CHAR) and
         (this.GetFieldValue( PNFLD_FORM707_ISVA ) == UNSET_CHAR) and
         (this.GetFieldValue( PNFLD_FORM707_ISDEPO ) == UNSET_CHAR)  )
        msgbox("Необходимо выбрать хотя бы один из модулей для формирования отчёта");
        return false;
     end;

     return true;
  END;

  initDL_CPanel( "dlrep.lbr", "DLACT707" ); 
END;
