/*
$Name:         ws_md_MTEDisconnect.mac
$Module:       Монитор дилера
$Description:  Отключение от шлюза ММВБ
*/
import "ws_md_MTECommon.mac";

macro MTEDisconnect()
  ReplaceMacro( "msgbox", "MTE_WriteLog" );

  var errMsg = "";
  var Idx = GetConnectIdxFromCache();
  if(Idx >= MTE_OK)
     /*Вначале закрыть таблицу*/
     var hTable = GetTableIdxFromCache();
     if(hTable >= MTE_OK)
       if(Web_MTECloseTable(Idx, hTable, errMsg) < MTE_OK)
         msgbox(errMsg);
       end;
     else
       msgbox("Не открыта таблица с фин.инструментами");
     end;

     /*Закрыть соединение*/
     Idx = Web_MTEDisconnect(Idx, errMsg);
     if (Idx < MTE_OK)
        msgbox(errMsg);
     end;
  else
     msgbox("Подключение к серверу разорвано");
  end;

  ResetConnectIdx();
  ResetTableIdx();

  ReplaceMacro( "msgbox", NULL );
end;

MTEDisconnect();
