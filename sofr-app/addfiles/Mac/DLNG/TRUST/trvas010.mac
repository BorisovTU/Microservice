/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank 6.0                                          R-Style SoftLab

  File Name   : trvas010.mac
  Programmer  : Nikonorov Evgeny
  Ž¯¥à æ¨ï    : à®¤ ¦  ¢¥ªá¥«¥© ¢ „“
  ˜ £         : 10 - ˆ­¨æ¨ «¨§ æ¨ï
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/

IMPORT InsCarryDoc, globals, vasale, valib, vaprdeca, va_voop, vapaym;


MACRO ExecuteParamStep(OperationKind, DocKind, Document)
    
    record  tick(dl_tick);
    var     stat = 0, RegDate, PayDate, SupplyDate, CloseDate, MoveDate,
            BlankDate = date(0,0,0);
    var     tickfd;
    
    SetBuff(tick, Document); 

    tickfd = VATickFD(tick);
    
    SupplyDate = tickfd.GetPlanSupplyDate();
    PayDate    = tickfd.GetPlanPayDate();   
    MoveDate   = tick.DealDate;

    if(SupplyDate == BlankDate)
       stat = VA_Err("¥¢¥à­ ï ¤ â  ¯®áâ ¢ª¨");
    elif(PayDate == BlankDate)
       stat = VA_Err("¥¢¥à­ ï ¤ â  ®¯« âë");
    else
       if(SupplyDate > PayDate)
          RegDate = PayDate;
          CloseDate = SupplyDate;
       else
          RegDate = SupplyDate;
          CloseDate = PayDate;
       end;
       
       DefineOprDate( DATE_SALE_REG,    RegDate);    /* „ â  ãç¥â  */
       DefineOprDate( DATE_SALE_PAY,    PayDate);    /* „ â  ®¯« âë */
       DefineOprDate( DATE_SALE_SUPPLY, SupplyDate); /* „ â  ¯®áâ ¢ª¨ */
       DefineOprDate( DATE_SALE_CLOSE,  CloseDate);  /* „ â  § ªàëâ¨ï */
       DefineOprDate( DATE_SALE_MOVE,   MoveDate);   /* „ â  ¯¥à¥­®á  */
    end;
    
    if(not stat)
      stat = VA_ForEachPaym(tick, CAi, @VA_SetPaymentsGround);
    end;

    return stat;
END;