/* Операция движения активов
   Планирование */
IMPORT InsCarryDoc, TSInter, "tsutil.mac";

MACRO ExecuteStep( DlDoc, FDoc, DocKind, ID_Operation, ID_Step )
  VAR    RoleOA, RoleBA;
  RECORD Oper( tsoper );
  SetBuff( Oper, FDoc );   
  
  RoleOA = ПолучитьРольТО( Oper.MainDemand );
  RoleBA = ПолучитьРольТО( Oper.BaseDemand );
/*
  if( (RoleOA == TS_DEMAND_ROLE_REQUEST) OR (RoleOA == TS_DEMAND_ROLE_OBLIGATION) )
     if( TS_OpenDemandByID( Oper.MainDemand, Oper.BeginDate, true ) != 0 )
        return 1;
     end;
  end;
  if( (RoleBA == TS_DEMAND_ROLE_REQUEST) OR (RoleBA == TS_DEMAND_ROLE_OBLIGATION) )
     if( TS_OpenDemandByID( Oper.BaseDemand, Oper.BeginDate, true ) != 0 )
        return 1;
     end;
  end;
*/
  if( (RoleOA == TS_DEMAND_ROLE_REQUEST) OR (RoleBA == TS_DEMAND_ROLE_REQUEST) )
    if( not InsertOprStatus( TS_OPERSTATUS_KIND_DEMAND, TS_OPERSTATUS_DEMAND_PLAN) ) 
       msgbox( "Ошибка при установке статуса операции" );
       return 1;
    end;
  end;

  if( (RoleOA == TS_DEMAND_ROLE_OBLIGATION) OR (RoleBA == TS_DEMAND_ROLE_OBLIGATION) )
    if( not InsertOprStatus( TS_OPERSTATUS_KIND_OBLIGATION, TS_OPERSTATUS_DEMAND_PLAN) ) 
       msgbox( "Ошибка при установке статуса операции" );
       return 1;
    end;
  end;

  return 0;
END;

