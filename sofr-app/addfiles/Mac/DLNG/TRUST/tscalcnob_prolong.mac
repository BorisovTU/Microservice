/* Операция сопровождения договора ДУ
   Шаг 1 - расчет параметров НОБ*/

IMPORT InsCarryDoc, "tsutil.mac";

PRIVATE VAR ServOp  = TRecHandler( "tssrvop.dbt" ); /*Сервисная операция, из которой выполняется расчет*/

MACRO ExecuteStep( DlDoc, FDoc, DocKind, ID_Operation, ID_Step )

  VAR ADate, OrderFD:TS_OrderFD; /*Договор ДДУ, для которого происходит расчет*/

  if( TS_RunFromServiceOper( ServOp ) )
     ADate = ServOp.rec.StepDate;
  else
     ADate = {CurDate};
  end;

  OrderFD = TS_OrderFD( 0, FDoc );

  if( TS_IsPayerNPTaxAllCheck( OrderFD.Order.rec.Trustor, ADate ) )
     return NPTCalcNOB_Ex( OrderFD, ADate, ID_Operation, ID_Step );
  end;

  return 0;
END;
