/* Расчеты по производным инструментам с биржей/брокером в ДУ
   Завершение торгового дня*/
import InsCarryDoc, "dvserv.mac";

macro ExecuteStep( doc, FDoc, DocKind, _OperationID, ID_Step )
  
  VAR DVOper = TRecHandler( "dvoper" );

  DVOper.SetRecordAddr( FDoc );

  if( ОбнулятьИтоги() != 0 )
     if( OprNullingPositions( DVOper ) == false )
        return 1;
     end;       
  end;

  if( OprClosePositions( DVOper ) == false )
     return 1;
  end; 

  return 0;
end;
