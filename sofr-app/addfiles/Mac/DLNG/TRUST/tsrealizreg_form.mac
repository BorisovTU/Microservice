/*******************************************************************************
 DESCRIPTION  :   Отчет "НДФЛ_Регистр реализации"
 PROGRAMMED BY:   Nikolskaya V.
 CREATION DATE:   03.09.2009 
*******************************************************************************/
import "DlRepForm_h.mac", "globals.mac";
/*Номера полей в форме отчета*/
CONST PNFLD_TSREALIZREG_BEGDATE           = 0,
      PNFLD_TSREALIZREG_ENDDATE           = 1,
      PNFLD_TSREALIZREG_CLIENTCODE        = 2,
      PNFLD_TSREALIZREG_CLIENTNAME        = 3,
      PNFLD_TSREALIZREG_CLIENTCONTR       = 4,
      PNFLD_TSREALIZREG_ORCB              = 5,
      PNFLD_TSREALIZREG_ORCB_EMISS        = 6,
      PNFLD_TSREALIZREG_ORCB_DERIV        = 7,
      PNFLD_TSREALIZREG_NO_ORCB           = 8,
      PNFLD_TSREALIZREG_NO_ORCB_EMISS     = 9,
      PNFLD_TSREALIZREG_NO_ORCB_NO_EMISS  = 10,
      PNFLD_TSREALIZREG_ISEXCEL           = 11;

CONST H_ORCB_EMISS       = 100,
      H_ORCB_DERIV       = 101,
      H_NO_ORCB_EMISS    = 102,
      H_NO_ORCB_NO_EMISS = 103;

CLASS TsRealizRegFormData()

  Var BegDate,
      EndDate,
      ClientCode,
      ClientName,
      ClientContr,
      ORCB,
      ORCB_Emiss,
      ORCB_Deriv,
      NO_ORCB,
      NO_ORCB_Emiss,
      NO_ORCB_NO_Emiss,
      IsExcel;

      BegDate           = {curdate};
      EndDate           = {curdate};
      ClientCode        = -1;
      ClientName        = -1;
      ClientContr       = -1;
      ORCB              = "X";
      ORCB_Emiss        = "X";
      ORCB_Deriv        = ""; /* 2-я очередь */
      NO_ORCB           = "X";
      NO_ORCB_Emiss     = "X";
      NO_ORCB_NO_Emiss  = "X";
      IsExcel           = "X";

END;

VAR TsRealizRegData = TsRealizRegFormData();

PRIVATE MACRO DLUSR_FldProc_ORCB( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = "";
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
  elif( (Cmd == DLG_KEY) AND (Key == KEY_SPACE) )
     if( FldRealValue != "X" )
        FldShowValue = FldRealValue = "X";
     else
        FldShowValue = FldRealValue = "";
        pThis.SetLinkedValue( H_ORCB_EMISS, null );
        pThis.SetLinkedValue( H_ORCB_DERIV, null );
     end;
  end;

  if( FldRealValue != "X" )
        DisableFields( pThis.Data(), PNFLD_TSREALIZREG_ORCB_EMISS );
        DisableFields( pThis.Data(), PNFLD_TSREALIZREG_ORCB_DERIV );
  else
    EnableFields( pThis.Data(), PNFLD_TSREALIZREG_ORCB_EMISS );
/*    EnableFields( pThis.Data(), PNFLD_TSREALIZREG_ORCB_DERIV ); отключил, что бы не вылазили ошибки, т.к. еще не реализовано */
  end;

  return CM_DEFAULT;
END;

PRIVATE MACRO DLUSR_FldProc_NO_ORCB( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = "";
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
  elif( (Cmd == DLG_KEY) AND (Key == KEY_SPACE) )
     if( FldRealValue != "X" )
        FldShowValue = FldRealValue = "X";
     else
        FldShowValue = FldRealValue = "";
        pThis.SetLinkedValue( H_NO_ORCB_EMISS,    null );
        pThis.SetLinkedValue( H_NO_ORCB_NO_EMISS, null );
     end;
  end;

  if( FldRealValue != "X" )
    DisableFields( pThis.Data(), PNFLD_TSREALIZREG_NO_ORCB_EMISS );
    DisableFields( pThis.Data(), PNFLD_TSREALIZREG_NO_ORCB_NO_EMISS );
  else
    EnableFields( pThis.Data(), PNFLD_TSREALIZREG_NO_ORCB_EMISS );
    EnableFields( pThis.Data(), PNFLD_TSREALIZREG_NO_ORCB_NO_EMISS );
  end;

  return CM_DEFAULT;
END;

PRIVATE MACRO Default( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  DisableFields( pThis.Data(), PNFLD_TSREALIZREG_ORCB_DERIV ); // убрать после реализации отчета по ПИ
  if( Cmd == DLG_INIT )
    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) 
    FldRealValue = FldShowValue;
  end;
  return CM_DEFAULT;
END;

CLASS (DL_CPanel) TS_REALIZREG_Panel()

  PRIVATE MACRO Init()
     AddFieldProc( 0, PNFLD_TSREALIZREG_BEGDATE,          DL_PNFLD_BEGINDATE,        @DL_FldProc_BeginDate,   TsRealizRegData.BegDate ); 
     AddFieldProc( 0, PNFLD_TSREALIZREG_ENDDATE,          DL_PNFLD_ENDDATE,          @DL_FldProc_EndDate,     TsRealizRegData.EndDate );
     AddFieldProc( 0, PNFLD_TSREALIZREG_CLIENTCODE,       DL_PNFLD_CLIENT_NUM_OFBU,  @DL_FldProc_ClientNDFL,  TsRealizRegData.ClientCode );
     AddFieldProc( 0, PNFLD_TSREALIZREG_CLIENTNAME,       DL_PNFLD_CLIENT_NAME_OFBU, @Default,                TsRealizRegData.ClientName );
     AddFieldProc( 0, PNFLD_TSREALIZREG_CLIENTCONTR,      DL_PNFLD_CONTRACT_OFBU,    @DL_FldProc_ContractIDDU,TsRealizRegData.ClientContr ); 
     AddFieldProc( 0, PNFLD_TSREALIZREG_ORCB,             DL_PNFLD_CHECKBOX,         @DLUSR_FldProc_ORCB,     TsRealizRegData.ORCB );
     AddFieldProc( 0, PNFLD_TSREALIZREG_ORCB_EMISS,       H_ORCB_EMISS,              @DL_FldProc_CheckBox,    TsRealizRegData.ORCB_Emiss );
     AddFieldProc( 0, PNFLD_TSREALIZREG_ORCB_DERIV,       H_ORCB_DERIV,              @DL_FldProc_CheckBox,    TsRealizRegData.ORCB_Deriv );
     AddFieldProc( 0, PNFLD_TSREALIZREG_NO_ORCB,          DL_PNFLD_CHECKBOX,         @DLUSR_FldProc_NO_ORCB,  TsRealizRegData.NO_ORCB );
     AddFieldProc( 0, PNFLD_TSREALIZREG_NO_ORCB_EMISS,    H_NO_ORCB_EMISS,           @DL_FldProc_CheckBox,    TsRealizRegData.NO_ORCB_Emiss );
     AddFieldProc( 0, PNFLD_TSREALIZREG_NO_ORCB_NO_EMISS, H_NO_ORCB_NO_EMISS,        @DL_FldProc_CheckBox,    TsRealizRegData.NO_ORCB_NO_Emiss ); 
     AddFieldProc( 0, PNFLD_TSREALIZREG_ISEXCEL,          DL_PNFLD_CHECKBOX,         @DL_FldProc_CheckBox,    TsRealizRegData.IsExcel );
  END;

  PRIVATE MACRO Check():BOOL
     return true;
  END;

  initDL_CPanel( "trust.lbr", "REALIZRG" ); 
END;