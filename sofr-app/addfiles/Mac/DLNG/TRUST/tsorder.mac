/*Печать ИДДУ*/
import "or_tools.mac", "dlRepFun.mac", "dlwreps.mac", "adress.mac", "tsutil.mac", "tscateg.mac", "pt_lib.mac", "tssec.mac", "tsrepsign.mac";
import lib_str;
import RsbDataSet;

var Order:TS_OrderFD;
var RepSign:TS_ReportData;

var GrTemp = TRecHandler( "dlgrtemp.dbt" );

private macro FindGrTemp( Num )

  if( Num > 0 )
     return TS_GetRecHandler( GrTemp, " SELECT GrTemp.* "+
                                      "   FROM ddlgrtemp_dbt GrTemp " +
                                      "  WHERE GrTemp.t_DocLog = 590 AND " +
                                      "        GrTemp.t_Num    = " + string(Num)
                            );
  end;
  return false;
end;

private macro ПолучитьОграничениеВида(DocKind:integer, DocId:integer, Kind:integer, Val:@double, Share:@double, FIID:@integer, MinVCapFlag:@bool)

  var query, select;

  Val   = 0;
  Share = 0;
  FIID  = 0;
  MinVCapFlag = FALSE;

  query = "select doclim.t_Value, doclim.t_Share, doclim.t_FIID "
        + " from dtsdoclim_dbt doclim, dtslimdic_dbt limdic "
        + " where doclim.t_DocKind = " + string(DocKind) 
        + "   and doclim.t_DocID = " + string(DocId)
        + "   and limdic.t_ID = doclim.t_LimitDictID "
        + "   and limdic.t_Number = " + string(Kind);

  select = TRsbDataSet(query);

  if( select.MoveNext() )
     Val = select.Value;
     Share = select.Share;
     FIID = select.FIID;
     MinVCapFlag = TRUE;
  end;

end;

private macro НаименованиеВалюты(str:string, flag:bool)

  var i, masks, ret = "";
  var mask;

  masks = StrCut( str, " " );
  i = 0;
  while( i < masks.size )
     mask = substr(masks[i], 1, 3);
     if(((flag == true) and ((mask == "руб") or (mask == "дол") or (mask == "евр")))
         or ((flag == false) and ((mask == "коп") or (mask == "цен") or (mask == "евр"))))
        ret = masks[i];
        break;
     end;
     i = i+1;
  end;

  return ret;
end;

private macro СокращенноеНаименованиеВалюты(str:string)

  var ret, TempStr;

  TempStr = substr(str, 1, 3);

  if(TempStr == "руб")
     ret = "руб.";
  elif(TempStr == "дол")
     ret = "долл.";
  elif(TempStr == "евр")
     ret = "евр.";
  else
     ret = "";
  end;

  return ret;
end;

private macro ConvRubProc(str:string)

  var ret = "";
  if(str == "рубль")
     ret = "процент"
  elif(str == "рубля")
     ret = "процента"
  elif(str == "рублей")
     ret = "процентов"
  end;

  return ret;
end;

private macro ВзятьДанныеИзПлатежа( ID:integer, TotalSumm:@double, ShortValText:@string, TotalSummText:@string, ValText:@string, TotalSummCop:@integer, CopText:@string,
                                    ClientPaymAcc:@string, ClientPaymBank:@string, BICClientPaymBank:@string, ClientPaymCorrAcc:@string,
                                    OurPaymAcc:@string, OurPaymBank:@string, BICOurPaymBank:@string, TotalSummFlag:@bool, TrustorID )

  var Payment;
  var fullstr, str;
  var rub, kop;
  var PaymFlag = false;
  var Account, BankName, CorrAcc, BankID;
  
  var query = RSDCommand( " SELECT RQ.t_ID             " +
                          "   FROM dtsiorqst_dbt RQ    " +
                          "  WHERE RQ.t_OrderID    = ? " +
                          "    AND RQ.t_Direction  = ? " +
                          "    AND RQ.t_Type       = ? " +
                          "    AND RQ.t_ActiveKind = ? " );
  query.addParam( "", RSDBP_IN, ID );
  query.addParam( "", RSDBP_IN, TS_IOREQ_DIRECTION_IN );
  query.addParam( "", RSDBP_IN, TS_KINDDECLAR_BEGIN );
  query.addParam( "", RSDBP_IN, TS_IOREQ_ACTIVEKIND_MONEY );
  query.execute();
  var RS = TRsbDataSet(query);

  TotalSummFlag = FALSE;
  if( RS.MoveNext() )
     Payment = RsbPayment( TS_DOC_DECLAR, RS.ID, CAi, 0 );
     if( (Payment != null) AND (Payment.ID != 0) ) /* если нашли платеж по первоночальному внесению денежных средств */
        TotalSumm    = Payment.BaseAmount;
        TotalSummFlag = TRUE;
        fullstr      = CurToStrAlt ( Payment.BaseAmount, TotalSummText, @kop, Payment.BaseFIID );
        ValText      = НаименованиеВалюты(fullstr,TRUE);
        ShortValText = СокращенноеНаименованиеВалюты(ValText);
        if((Payment.BaseAmount - round(Payment.BaseAmount, 0)) != 0)
           TotalSummCop = kop;//(!!!) закомментировано по запросу #176394 Payment.BaseAmount - round(Payment.BaseAmount, 0);
           CopText      = НаименованиеВалюты(fullstr,FALSE);
        end;
        ClientPaymAcc     = Payment.PayerAccount;
        ClientPaymBank    = Payment.PayerBankName;
        BICClientPaymBank = ПолучитьКодСубъекта(Payment.PayerBankID, PTCK_BIC);
        ClientPaymCorrAcc = Payment.PayerBankCorrAcc;
        OurPaymAcc        = Payment.ReceiverAccount;
        OurPaymBank       = Payment.ReceiverBankName;
        BICOurPaymBank    = ПолучитьКодСубъекта(Payment.ReceiverBankID, PTCK_BIC);
        PaymFlag = true;
     end;
  end;

  if(PaymFlag == false)
     ClientPaymAcc     = RepSign.ClientSPIAcc;
     ClientPaymBank    = RepSign.ClientSPIBank;
     BICClientPaymBank = RepSign.BICClientSPIBank;
     ClientPaymCorrAcc = RepSign.ClientSPICorrAcc;
     OurPaymAcc        = RepSign.OurSPIAcc;
     OurPaymBank       = RepSign.OurSPIBank;
     BICOurPaymBank    = RepSign.BICOurSPIBankCode;
  end;
end;

private macro _println(str)
  if(ValType(str) != V_UNDEF)
    println(str);
  end;
end;

private macro ПреобразоватьСуммуЦифрами(val_)

  var StrVal_;
  var ind;
  var Cel, Drob;
  var InvCel;
  var ret, n=0;

  if(ValType(val_) != V_UNDEF)
     StrVal_ = string(val_);
     ind  = Index(StrVal_, ".");
     Cel  = substr(StrVal_, 1, ind-1);
     Drob = substr(StrVal_, ind+1, 2);
     InvCel = InvertStr(string(Cel));

     while(substr(InvCel, 1+n, 3) != "")
        if(n == 0)
           ret = substr(InvCel, 1+n, 3);
        else
           ret = ret + " " + substr(InvCel, 1+n, 3);
        end;
        n = n + 3;
     end;

     ret = InvertStr(ret) + "," + Drob;
  end;

  return ret;
end;

private macro ДатаСВедущимНулем(str_)

  var str = string(str_);
  while(Index(str," ") == 1)
     str = substr(str, 2, strlen(str)-1);
  end;
  if((str == "") or (Index(str,".") == 3) or (Index(str," ") == 3))
     return str;
  else
     return "0" + str;
  end;
end;

private macro DateToStr(pDate)

  var str = DL_DateToStr(pDate);

  return ДатаСВедущимНулем(substr(str, 1, strlen(str)-3));  /*отсекём " г."*/
end;

private macro ПечатьСПроверкой(Str:string, Flag:@bool)
  if(Str == "")
     Flag = FALSE;
  else
     _println( Str );
  end;
end;

private macro ПолучитьНаименРасчПериода(CalcPeriod:integer,CalcPeriodName:@string,CalcPeriodText:@string);
  CalcPeriodText = "последнего рабочего дня отчетного ";
  if( CalcPeriod == 1 )
     CalcPeriodName = "Ежедневно";
     CalcPeriodText = "отчетного";
  elif( CalcPeriod == 2 )
     CalcPeriodName = "Ежемесячно";
     CalcPeriodText = CalcPeriodText + "месяца";
  elif( CalcPeriod == 3 )
     CalcPeriodName = "Ежеквартально";
     CalcPeriodText = CalcPeriodText + "квартала";
  elif( CalcPeriod == 4 )
     CalcPeriodName = "Каждое полугодие";
     CalcPeriodText = CalcPeriodText + "полугодия";
  elif( CalcPeriod == 5 )
     CalcPeriodName = "Ежегодно";
     CalcPeriodText = CalcPeriodText + "года";
  else
     CalcPeriodName = "";
     CalcPeriodText = "";
  end;
end;                                         

private macro НаименКолваКаленДней( NumDays:integer )
   var NumDaysStr = string(NumDays);

   if( (NumDays == 1) OR 
       ((NumDays > 10) AND (substr(NumDaysStr,strlen(NumDaysStr), 1) == "1") AND (substr(NumDaysStr,strlen(NumDaysStr) - 1, 1) != "1")) )
      return "календарного дня";
   else
      return "календарных дней";
   end;
end;

private var cur_date = null;
private  macro CurDate()
  if( cur_date == null )
     if( {curdate} < Order.BeginDate() )  
        cur_date = Order.BeginDate();         
     else
        cur_date = {curdate}; 
     end;              
  end;  
  return cur_date;                           
end;    

private macro ПолучитьДатуОкончКомис(SfContrID:integer,ComissEnd:@Date,Flag:@integer);
  var ConCom    =  TRecHandler( "sfconcom.dbt" );
  var ComNumber = -1;
  ComissEnd = date(0,0,0);
  ComNumber = ПолучитьНомерКомиссии(SfContrID, "TSP", CurDate, null, null, true);
  if( ComNumber > 0 )
     while( SfGetConCom( SfContrID, SF_FEE_TYPE_PERIOD, ConCom ) == true ) /* перебирает от старых к новым */
        if( ConCom.rec.CommNumber == ComNumber )
           /* перетираем, то что уже было найдено, если находили более раннии комиссии */
           ComissEnd = date(0,0,0);
           Flag = 0;
           if( (ValType(ConCom.rec.DateEnd) != V_UNDEF) And (ConCom.rec.DateEnd != Date(0,0,0)) )
              ComissEnd = ConCom.rec.DateEnd;
              Flag = 1;
           end;
           if( ComissEnd >= CurDate )
              break;
           else
              /* прерывать не надо, вдруг ещё найдём */
           end;
        end;
     end;
  end;
end;

private macro ПериодичностьКомисииСтрокой(ComPeriod:integer):string
  var RetVal:string = "";
  if(ComPeriod == 1)
     RetVal = "дня";
  elif(ComPeriod == 2)
     RetVal = "месяца";
  elif(ComPeriod == 3)
     RetVal = "квартала";
  elif(ComPeriod == 4)
     RetVal = "года";
  end;

  return RetVal;
end;

private macro PrintContr( ncopy:integer )

  var ComNumber = -1;
  var TempFile;
  var DocName;
  var persnFlag = false;
  var Account, BankName, CorrAcc, BankID;
  var AccountTr, BankNameTr, CorrAccTr, BankIDTr;
  var Val, Share, FIID;
  var fullstr, rub, Rstr, kop, procstr;
  var TotalSumm, ShortValText, TotalSummText, ValText, TotalSummCop, CopText;
  var ClientPaymAcc, ClientPaymBank, BICClientPaymBank, ClientPaymCorrAcc;
  var OurPaymAcc, OurPaymBank, BICOurPaymBank;
  var RateCom;
  var OurBankLicFlag, OurRepresPosFlag, OurRepresFlag, OurRepresDocFlag, ClientRepresPosFlag, ClientRepresFlag,
      MinVCapFlag, TotalSummFlag,
      ComManagFlag, ComSuccesFlag, ComOUTCapFlag, ComOUTEndFlag;
  var HeadPR  = "┌─────┬────────────────────────────────────────────────────────────────────────────────────────────────────┐\n"+
                "│  №  │                                             Описание                                               │\n"+
                "├─────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤";

  var FootPR  = "└─────┴────────────────────────────────────────────────────────────────────────────────────────────────────┘\n";
  var DelimPR = "├─────┼────────────────────────────────────────────────────────────────────────────────────────────────────┤";
  var iPR = 1;
  var ReportFileName, errcode, errtext;
  FILE ReportOutFile() txt write; /*файл вывода для протокола*/
  var MngPlanFlag = FALSE, MngPlanGBPRate, MngPlanID, CalcPeriodName, CalcPeriodText, ComissEnd, QuantyCalDays = 0;
  var ComPeriod:integer = -1, ComPeriodStr:string = "";

  /*Шаблон*/
  [#]( GrTemp.rec.File_Name );

  /*Имя выходного файла*/
  DocName = "Договор ИДДУ № " + Order.Number();
  if( ncopy > 1 )
     /*добавить в название номер копии, иначе будет ошибка при создании, т.к. получим
       несколько документов с одинаковыми именами*/
     DocName = DocName + "_"+ string(ncopy);
  end;
  [#.rtf]( DocName );

  OurBankLicFlag = OurRepresPosFlag = OurRepresFlag = OurRepresDocFlag = ClientRepresPosFlag =  ClientRepresFlag = ClientRepresFlag = MinVCapFlag = TRUE;
  ComManagFlag = ComSuccesFlag = ComOUTCapFlag = ComOUTEndFlag = 0;

  if( Order.MngPlan(CurDate) )
     MngPlanFlag = TRUE;
     MngPlanGBPRate = Order.MngPlan(CurDate).rec.GBPRate;
     MngPlanGBPRate = ЧислоCЗаданнойТочностью(MngPlanGBPRate, 2);
     MngPlanID = Order.MngPlan(CurDate).rec.ID;
  end;

  if(Order.Trustor().rec.LegalForm == 1)   /*Юридическое лицо*/

     /*Номер договора с учредителем*/
     [~ContractDUNumb];
     _println( Order.Number() );

     /*Город из адреса нашего банка*/
     [~City];
     _println( RepSign.City );

     /*Дата заключения договора*/
     [~ContractDUDate];
     _println( DateToStr(Order.BeginDate()) );

     /*Полное наименование нашего банка из анкеты субъекта*/
     [~OurBankFull];
     _println( RepSign.OurBankFull );

     /*Сведения о генеральной лицензии нашего банка*/
     [~OurBankLic];
     ПечатьСПроверкой( RepSign.OurBankLic, @OurBankLicFlag );  /*9 - Сведения о наличии лицензий на осуществление определенного вида деятельности или операции*/

     /*Должность в родительном падеже представителя нашего банка*/
     [~OurRepresPos];
     ПечатьСПроверкой( RepSign.OurRepresPos, @OurRepresPosFlag ); /*50 - Должность в родит. падеже*/

     /*Фамилия, имя, отчество начальника отдела ДУ нашего банка в родительном падеже*/
     [~OurRepres];
     ПечатьСПроверкой( RepSign.OurRepres, @OurRepresFlag ); /*49 - Полное наименование в родит. падеже - ФИО*/

     /*Данные в родительном падеже о документе, на основании которого действует представитель нашего банка*/
     [~OurRepresDoc];
     ПечатьСПроверкой( RepSign.OurRepresDoc, @OurRepresDocFlag ); /*51 - Документ-основание представителя по договору в родит. падеже - ФИО*/

     /*Полное наименование клиента-учредителя из договора*/
     [~ClientFull];
     _println( RepSign.ClientFull );

     /*Должность в родительном падеже представителя клиента-учредителя*/
     [~ClientRepresPos];
     ПечатьСПроверкой( RepSign.ClientRepresPos, @ClientRepresPosFlag ); /*50 - Должность в родит. падеже*/

     /*Фамилия, имя и отчество в родительном падеже представителя клиента-учредителя*/
     [~ClientRepres]; 
     ПечатьСПроверкой( RepSign.ClientRepres, @ClientRepresFlag ); /*49 - Полное наименование в родит. падеже - ФИО*/

     ВзятьДанныеИзПлатежа( Order.Order().rec.ID, @TotalSumm, @ShortValText, @TotalSummText, @ValText, @TotalSummCop, @CopText,
                           @ClientPaymAcc, @ClientPaymBank, @BICClientPaymBank, @ClientPaymCorrAcc,
                           @OurPaymAcc, @OurPaymBank, @BICOurPaymBank, @TotalSummFlag, Order.Trustor.rec.PartyID );
     /*Сумма денежных средств, вносимых учредителем по договору*/
     [~TotalSumm];
     if(TotalSummFlag == TRUE)
        _println( ПреобразоватьСуммуЦифрами(TotalSumm) );
     end;

     /*Сокращенное название валюты*/
     [~ShortValText];
     if(TotalSummFlag == TRUE)
        _println( ShortValText );
     end;

     /*Количество целых рублей/долларов США/евро из вносимой суммы по ИДДУ*/
     [~TotalSummText];
     if(TotalSummFlag == TRUE)
        _println( TotalSummText );
     end;

     /*Полное наименование (в родительном падеже) валюты средств, вносимых учредителем по договору*/
     [~ValText];
     if(TotalSummFlag == TRUE)
        _println( ValText );
     end;

     /*Если в сумме присутствуют копейки/центы/евроценты, то
       вывести количество копеек/центов/евроцентов из общей суммы, вносимых средств по договору, цифрами*/
     [~TotalSummCop];
     if(TotalSummFlag == TRUE)
        _println( TotalSummCop );
     end;

     /*Если в сумме присутствуют копейки/центы/евроценты, то вывести наименование*/
     [~CopText];
     if(TotalSummFlag == TRUE)
        _println( CopText );
     end;

     /*Расчетный счет учредителя*/
     [~ClientPaymAcc];
     _println( ClientPaymAcc );

     /*Полное наименование банка*/
     [~ClientPaymBank];
     _println( ClientPaymBank );

     /*БИК банка*/
     [~BICClientPaymBank];
     _println( BICClientPaymBank );

     /*Корреспондентский счет*/
     [~ClientPaymCorrAcc];
     _println( ClientPaymCorrAcc );

     /*ИНН/КПП учредителя из анкеты субъекта*/
     [~ClientINN];
     _println( RepSign.ClientINN );

     /*Расчетный счет нашего банка*/
     [~OurPaymAcc];
     _println( OurPaymAcc ); 

     /*Банк получателя*/
     [~OurPaymBank];
     _println( OurPaymBank ); 

     /*БИК банка получателя*/
     [~BICOurPaymBank];
     _println( BICOurPaymBank ); 

     /*ИНН/КПП нашего банка из анкеты субъекта*/
     [~OurINN];
     _println( RepSign.OurINN );

     /*то тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_2];

     /*тоже, что и ContractDUDate*/
     [~ContractDUDate_dup_2];

     /*Дата окончания договора*/
     [~ContractDUEndDate];
     _println( ДатаСВедущимНулем(Order.Valid(CurDate).rec.EndDate) );

     /*Сумма/доля ограничения "Минимальный объем капитала или его остатка"*/
     [~MinVCap];
     if(MngPlanFlag == TRUE)
        ПолучитьОграничениеВида(TS_DOC_MNGPLN, MngPlanId, 1, @Val, @Share, @FIID, @MinVCapFlag );
        if(MinVCapFlag == TRUE)
           _println( ПреобразоватьСуммуЦифрами(Val) );
        end;
     end;

     /*Количество целых рублей из ограничения "Минимальный объем капитала или его остатка"*/
     [~MinVCapText];
     if(MinVCapFlag == TRUE)
        fullstr = CurToStrAlt ( Val, rub, kop, 810 ); /*по хорошему вместо 810 должно быть FIID*/
        _println( rub );
     end;

     /*Полное наименование (в родительном падеже) валюты суммы ограничения минимального объема капитала или его остатка*/
     [~MinValText];
     if(MinVCapFlag == TRUE)
        /*так есть ограничение, что валюта только рубли, то можно сделать так*/
        _println( НаименованиеВалюты(fullstr,TRUE) );
     end;

     /*Расчетный период по выплате дохода +
       Текст: "месяца", "квартала", "полугодия", "года"*/
     if( MngPlanFlag == TRUE )
        ПолучитьНаименРасчПериода(Order.MngPlan(CurDate).rec.CalcPeriod,@CalcPeriodName,@CalcPeriodText);
     end;

     [~Period]; 
     _println( CalcPeriodName );

     [~PeriodText];
     _println( CalcPeriodText );

     Order.SfContr();
     ComNumber = ПолучитьНомерКомиссии(Order.SfContr.rec.ID, "TSM", CurDate, @ComPeriod, null, true);
     ПолучитьСтавкуКомиссии(Order.SfContr.rec.ID, ComNumber, null, null, @RateCom, @ComManagFlag);
     RateCom = ЧислоCЗаданнойТочностью(RateCom, 2);
     /*Ставка комиссии (в %), цифрами с учетом точности из договора обслуживания с видом комиссии равной "за управление"*/
     [~ComManag];
     if( ComManagFlag == 1 )
        _println( RateCom );
     end;

     /*Ставка комиссии прописью*/
     [~ComText];
     if( ComManagFlag == 1 )
        _println( NumToStr(RateCom, "процент","процента","процентов",true) );
     end;

     /*Текст "процент", "процента", "процентов"*/
     [~ProcText];
     if( ComManagFlag == 1 )
        _println( ConvRubProc( НаименованиеВалюты(fullstr,TRUE) ) );
     end;

     ComPeriodStr = ПериодичностьКомисииСтрокой(ComPeriod);
     [~ComPeriod];
     if( ComManagFlag == 1 )
        _println( ComPeriodStr );
     end;
     [~ComPeriod_dup_2];

     ComNumber = ПолучитьНомерКомиссии(Order.SfContr.rec.ID, "TSS", CurDate, null, null, true);
     ПолучитьСтавкуКомиссии(Order.SfContr.rec.ID, ComNumber, null, null, @RateCom, @ComSuccesFlag);
     RateCom = ЧислоCЗаданнойТочностью(RateCom, 2);
     /*Ставка комиссии (в %), цифрами с учетом точности из договора обслуживания с видом комиссии равной "за успех"*/
     [~ComSucces];
     if( ComSuccesFlag == 1 )
        _println( RateCom );
     end;

     /*тоже, что и ComText*/
     [~ComText2];
     if( ComSuccesFlag == 1 )
        _println( NumToStr(RateCom, "процент","процента","процентов",true) );
     end;

     /*тоже, что и ProcText*/
     [~ProcText2];
     if( ComSuccesFlag == 1 )
        _println( ConvRubProc( НаименованиеВалюты(fullstr,TRUE) ) );
     end;

     ComNumber = ПолучитьНомерКомиссии(Order.SfContr.rec.ID, "TSP", CurDate, null, null, true);
     ПолучитьСтавкуКомиссии(Order.SfContr.rec.ID, ComNumber, null, null, @RateCom, @ComOUTCapFlag);
     RateCom = ЧислоCЗаданнойТочностью(RateCom, 2);
     /*Ставка комиссии (в %), цифрами с учетом точности из договора обслуживания с видом комиссии равной "за досрочный вывод капитала".*/
     [~ComOUTCap];
     if( ComOUTCapFlag == 1 )
        _println( RateCom );
     end;

     /*тоже, что и ComText*/
     [~ComText3];
     if( ComOUTCapFlag == 1 )
        _println( NumToStr(RateCom, "процент","процента","процентов",true) );
     end;

     /*тоже, что и ProcText*/
     [~ProcText3];
     if( ComOUTCapFlag == 1 )
        _println( ConvRubProc( НаименованиеВалюты(fullstr,TRUE) ) );
     end;

     ПолучитьДатуОкончКомис(Order.SfContr().rec.ID,@ComissEnd,@ComOUTEndFlag);
     if( ComOUTEndFlag == 1 )
        QuantyCalDays = max(ComissEnd - Order.Valid(CurDate).rec.BeginDate, 0);
     end;

     [~QuantyCalDays];
     if( ComOUTEndFlag == 1 )
        _println( QuantyCalDays );
     end;

     [~QuantyCalDaysText];
     _println( НаименКолваКаленДней(QuantyCalDays) );

     /*Ставка для расчета пороговой величины за день*/
     [~Rate];
     if(MngPlanFlag == TRUE)
        _println( MngPlanGBPRate );
     end;

     /*Количество процентов прописью*/
     [~RateText];
     if(MngPlanFlag == TRUE)
        _println( NumToStr(MngPlanGBPRate, "процент","процента","процентов",true) );
     end;

     /*Текст "процент" или "процента", или "процентов"*/
     [~RateProcText];
     /*опять извращаемся*/
     _println( ConvRubProc( НаименованиеВалюты(fullstr,TRUE) ) );
  
     /*Сокращенное наименование нашего банка из анкеты субъекта*/
     [~OurBankShort];
     _println( RepSign.OurBankShort );

     /*Адрес нашего банка, включая индекс*/
     [~OurAddr];
     _println( RepSign.OurFullAddr );

     /*тоже, что и OurINN*/
     [~OurINN_dup_2];

     /*р/счет из СПИ нашего банка (выбор СПИ - по виду обслуживания = "Доверительное управление"). Поле в СПИ "счет"*/
     [~OurSPIAcc];
     _println( RepSign.OurSPIAcc );

     /*банк из СПИ нашего банка (выбор СПИ - по виду обслуживания = "Доверительное управление"). Поле в СПИ "в банке"*/
     [~OurSPIBank];
     _println( RepSign.OurSPIBank );

     /*БИК банка из СПИ нашего банка (выбор СПИ - по виду обслуживания = "Доверительное управление"). Поле в СПИ "БИК"*/
     [~BICOurSPIBank];
     _println( RepSign.BICOurSPIBankCode );

     /*ФИО представителя нашего банка - начальника подразделения, заданного в настройке "Отдел доверительного управления"*/
     [~OurRepr];
     _println( RepSign.ShortOurRepr );

     /*тоже, что и ClientFull*/
     [~ClientFull_dup_2];

     /*Адрес учредителя, включая индекс*/
     [~ClientAddr];

     _println( RepSign.ClientFullAddr );

     /*тоже, что и ClientINN*/
     [~ClientINN_dup_2];

     /*р/счет из СПИ учредителя по договору. Поле "счет"*/
     [~ClientSPIAcc];
     _println( RepSign.ClientSPIAcc );

     /*Полное наименование банка из СПИ учредителя по договору. Поле "в банке"*/
     [~ClientSPIBank];
     _println( RepSign.ClientSPIBank );

     /*БИК банка из СПИ учредителя по договору. Поле "БИК"*/
     [~BICClientSPIBank];
     _println( RepSign.BICClientSPIBank );

     /*Кор/счет из СПИ учредителя по договору. Поле "корсчет"*/
     [~ClientSPICorrAcc];
     _println( RepSign.ClientSPICorrAcc );

     /*ФИО представителя учредителя (сотрудника учредителя с признаком первого лица)*/
     [~ClientRepr];
     _println( RepSign.ShortClientRepr );

     /*тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_3];

     /*тоже, что и City*/
     [~City_dup_2];

     /*тоже, что и ContractDUDate*/
     [~ContractDUDate_dup_3];

     /*тоже, что и OurBankShort*/
     [~OurBankShort_dup_2];

     /*тоже, что и OurAddr*/
     [~OurAddr_dup_2];

     /*тоже, что и OurINN*/
     [~OurINN_dup_3];

     [~OurSPIAcc_dup_2];

     /*тоже, что и OurSPIBank*/
     [~OurSPIBank_dup_2];

     /*тоже, что и BICOurSPIBank*/
     [~BICOurSPIBank_dup_2];

     /*тоже, что и OurRepr*/
     [~OurRepr_dup_2];

     /*тоже, что и ClientFull*/
     [~ClientFull_dup_3];

     /*тоже, что и ClientAddr*/
     [~ClientAddr_dup_2];

     /*тоже, что и ClientINN*/
     [~ClientINN_dup_3];

     /*тоже, что и ClientSPIAcc*/
     [~ClientSPIAcc_dup_2];

     /*тоже, что и ClientSPIBank*/
     [~ClientSPIBank_dup_2];

     /*тоже, что и BICClientSPIBank*/
     [~BICClientSPIBank_dup_2];

     /*тоже, что и ClientSPICorrAcc*/
     [~ClientSPICorrAcc_dup_2];

     /*тоже, что и ClientRepr*/
     [~ClientRepr_dup_2];

     /*тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_6];

     /*тоже, что и City*/
     [~City_dup_3];

     /*тоже, что и ContractDUDate*/
     [~ContractDUDate_dup_5];

     /*тоже, что и OurBankShort*/
     [~OurBankShort_dup_3];

     /*тоже, что и OurAddr*/
     [~OurAddr_dup_3];
       
     /*тоже, что и OurINN*/
     [~OurINN_dup_4];

     /*тоже, что и OurSPIAcc*/
     [~OurSPIAcc_dup_3];

     /*тоже, что и OurSPIBank*/
     [~OurSPIBank_dup_3];

     /*тоже, что и BICOurSPIBank*/
     [~BICOurSPIBank_dup_3];

     /*тоже, что и OurRepr*/
     [~OurRepr_dup_3];

     /*тоже, что и ClientFull*/
     [~ClientFull_dup_4];

     /*тоже, что и ClientAddr*/
     [~ClientAddr_dup_3];

     /*тоже, что и ClientINN*/
     [~ClientINN_dup_4];

     /*тоже, что и ClientSPIAcc*/
     [~ClientSPIAcc_dup_3];

     /*тоже, что и ClientSPIBank*/
     [~ClBithPlace_dup_3];

     /*тоже, что и ClientSPIAcc*/
     [~ClientSPIAcc_dup_3];

     /*тоже, что и ClientSPIBank*/
     [~ClientSPIBank_dup_3];

     /*тоже, что и BICClientSPIBank*/
     [~BICClientSPIBank_dup_3];

     /*тоже, что и ClientSPICorrAcc*/
     [~ClientSPICorrAcc_dup_3];

     /*тоже, что и ClientRepr*/
     [~ClientRepr_dup_3];

     /*тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_4];

     /*тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_5];

     /*тоже, что и ContractDUDate*/
     [~ContractDUDate_dup_4];

     /*тоже, что и ClientRepres*/
     [~ClientRepres_dup_2];

     /*Адрес электронной почты учредителя из договора*/
     [~ClientEmail];
     _println( RepSign.ClientEmail );

     /*Дата заявления равна дате открытия договора*/
     [~StatementDate];
     _println( DateToStr(Order.BeginDate()) );

  elif(Order.Trustor().rec.LegalForm == 2)  /*Физическое лицо*/

     /*Номер договора с учредителем*/
     [~ContractDUNumb];
     _println( Order.Number() );

     /*Город из адреса нашего банка*/
     [~City];
     _println( RepSign.City );

     /*Дата заключения договора*/
     [~ContractDUDate];
     _println( DateToStr(Order.BeginDate()) );

     /*Полное наименование нашего банка из анкеты субъекта*/
     [~OurBankFull];
     _println( RepSign.OurBankFull );

     /*Сведения о генеральной лицензии нашего банка*/
     [~OurBankLic];
     ПечатьСПроверкой( RepSign.OurBankLic, @OurBankLicFlag );  /*9 - Сведения о наличии лицензий на осуществление определенного вида деятельности или операции*/

     /*Должность в родительном падеже представителя нашего банка*/
     [~OurRepresPos];
     ПечатьСПроверкой( RepSign.OurRepresPos, @OurRepresPosFlag ); /*50 - Должность в родит. падеже*/

     /*Фамилия, имя, отчество начальника отдела ДУ нашего банка в родительном падеже*/
     [~OurRepres];    
     ПечатьСПроверкой( RepSign.OurRepres, @OurRepresFlag ); /*49 - Полное наименование в родит. падеже - ФИО*/

     /*Данные в родительном падеже о документе, на основании которого действует представитель нашего банка*/
     [~OurRepresDoc];
     ПечатьСПроверкой( RepSign.OurRepresDoc, @OurRepresDocFlag ); /*51 - Документ-основание представителя по договору в родит. падеже - ФИО*/

     /*Полное наименование клиента-учредителя из договора*/
     [~ClientFull];
     _println( RepSign.ClientFull );

     /*Серия паспорта учредителя из анкеты субъекта*/
     [~ClPasspSer];
     _println( RepSign.ClPasspSer );

     /*Номер паспорта из анкеты субъекта*/
     [~ClPasspNumb];
     _println( RepSign.ClPasspNumb );

     /*Орган, выдавший паспорт, из анкеты субъекта*/
     [~ClPasspGive];
     _println( RepSign.ClPasspGive );

     /*Дата выдачи паспорта из анкеты субъекта*/
     [~ClPasspGiveDate];
     _println( ДатаСВедущимНулем( RepSign.ClPasspGiveDate ) );

     /*Адрес учредителя, включая индекс*/
     [~ClientAddr];
     _println( RepSign.ClientFullAddr );

     ВзятьДанныеИзПлатежа( Order.Order().rec.ID, @TotalSumm, @ShortValText, @TotalSummText, @ValText, @TotalSummCop, @CopText,
                           @ClientPaymAcc, @ClientPaymBank, @BICClientPaymBank, @ClientPaymCorrAcc,
                           @OurPaymAcc, @OurPaymBank, @BICOurPaymBank, @TotalSummFlag, Order.Trustor.rec.PartyID ); 
     /*Сумма денежных средств, вносимых учредителем по договору*/
     [~TotalSumm];
     if(TotalSummFlag == TRUE)
        _println( ПреобразоватьСуммуЦифрами(TotalSumm) );
     end;

     /*Сокращенное название валюты*/
     [~ShortValText];
     if(TotalSummFlag == TRUE)
        _println( ShortValText );
     end;

     /*Количество целых рублей/долларов США/евро из вносимой суммы по ИДДУ*/
     [~TotalSummText];
     if(TotalSummFlag == TRUE)
        _println( TotalSummText );
     end;

     /*Полное наименование (в родительном падеже) валюты средств, вносимых учредителем по договору*/
     [~ValText];
     if(TotalSummFlag == TRUE)
        _println( ValText );
     end;

     /*Если в сумме присутствуют копейки/центы/евроценты, то
       вывести количество копеек/центов/евроцентов из общей суммы, вносимых средств по договору, цифрами*/
     [~TotalSummCop];
     if(TotalSummFlag == TRUE)
        _println( TotalSummCop );
     end;

     /*Если в сумме присутствуют копейки/центы/евроценты, то вывести наименование*/
     [~CopText];
     if(TotalSummFlag == TRUE)
        _println( CopText );
     end;

     /*Расчетный счет учредителя*/
     [~ClientPaymAcc];
     _println( ClientPaymAcc );

     /*Полное наименование банка*/
     [~ClientPaymBank];
     _println( ClientPaymBank );

     /*БИК банка*/
     [~BICClientPaymBank];
     _println( BICClientPaymBank );

     /*Корреспондентский счет*/
     [~ClientPaymCorrAcc];
     _println( ClientPaymCorrAcc );

     /*ИНН/КПП нашего банка из анкеты субъекта*/
     [~OurINN];
     _println( RepSign.OurINN );

     /*Расчетный счет нашего банка*/
     [~OurPaymAcc];
     _println( OurPaymAcc );

     /*Банк получателя*/
     [~OurPaymBank];
     _println( OurPaymBank );

     /*БИК банка получателя*/
     [~BICOurPaymBank];
     _println( BICOurPaymBank );

     /*тоже, что и OurINN*/
     [~OurINN_dup_2];

     /*то тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_2];

     /*тоже, что и ContractDUDate*/
     [~ContractDUDate_dup_2];

     /*Дата окончания договора*/
     [~ContractDUEndDate];
     _println( ДатаСВедущимНулем(Order.Valid(CurDate).rec.EndDate) );

     /*Сумма/доля ограничения "Минимальный объем капитала или его остатка"*/
     [~MinVCap];
     if(MngPlanFlag == TRUE)
        ПолучитьОграничениеВида(TS_DOC_MNGPLN, MngPlanId, 1, @Val, @Share, @FIID, @MinVCapFlag);
        _println( ПреобразоватьСуммуЦифрами(Val) );
     end;

     /*Количество целых рублей из ограничения "Минимальный объем капитала или его остатка"*/
     [~MinVCapText];
     if(MinVCapFlag == TRUE)
        fullstr = CurToStrAlt ( Val, rub, kop, 810 ); /*по хорошему вместо 810 должно быть FIID*/
        _println( rub );
     end;

     /*Полное наименование (в родительном падеже) валюты суммы ограничения минимального объема капитала или его остатка*/
     [~MinValText];
     if(MinVCapFlag == TRUE)
        /*так есть ограничение, что валюта только рубли, то можно сделать так*/
        _println( НаименованиеВалюты(fullstr,TRUE) );
     end;

     /*Расчетный период по выплате дохода +
       Текст: "месяца", "квартала", "полугодия", "года"*/
     if( MngPlanFlag == TRUE )
        ПолучитьНаименРасчПериода(Order.MngPlan(CurDate).rec.CalcPeriod,@CalcPeriodName,@CalcPeriodText);
     end;

     [~Period]; 
     _println( CalcPeriodName );

     [~PeriodText];
     _println( CalcPeriodText );

     Order.SfContr();
     ComNumber = ПолучитьНомерКомиссии(Order.SfContr.rec.ID, "TSM", CurDate, @ComPeriod, null, true);
     ПолучитьСтавкуКомиссии(Order.SfContr.rec.ID, ComNumber, null, null, @RateCom, @ComManagFlag);
     RateCom = ЧислоCЗаданнойТочностью(RateCom, 2);
     /*Ставка комиссии (в %), цифрами с учетом точности из договора обслуживания с видом комиссии равной "за управление"*/
     [~ComManag];
     if( ComManagFlag == 1 )
        _println( RateCom );
     end;

     /*Ставка комиссии прописью*/
     [~ComText];
     if( ComManagFlag == 1 )
        _println( NumToStr(RateCom, "процент","процента","процентов",true) );
     end;

     /*Текст "процент", "процента", "процентов"*/
     [~ProcText];
     if( ComManagFlag == 1 )
        _println( ConvRubProc( НаименованиеВалюты(fullstr,TRUE) ) );
     end;

     ComPeriodStr = ПериодичностьКомисииСтрокой(ComPeriod);
     [~ComPeriod];
     if( ComManagFlag == 1 )
        _println( ComPeriodStr );
     end;
     [~ComPeriod_dup_2];

     ComNumber = ПолучитьНомерКомиссии(Order.SfContr.rec.ID, "TSS", CurDate, null, null, true);
     ПолучитьСтавкуКомиссии(Order.SfContr.rec.ID, ComNumber, null, null, @RateCom, @ComSuccesFlag);
     RateCom = ЧислоCЗаданнойТочностью(RateCom, 2);
     /*Ставка комиссии (в %), цифрами с учетом точности из договора обслуживания с видом комиссии равной "за успех"*/
     [~ComSucces];
     if( ComSuccesFlag == 1 )
        _println( RateCom );
     end;

     /*тоже, что и ComText*/
     [~ComText2];
     if( ComSuccesFlag == 1 )
        _println( NumToStr(RateCom, "процент","процента","процентов",true) );
     end;

     /*тоже, что и ProcText*/
     [~ProcText2];
     if( ComSuccesFlag == 1 )
        _println( ConvRubProc( НаименованиеВалюты(fullstr,TRUE) ) );
     end;

     ComNumber = ПолучитьНомерКомиссии(Order.SfContr.rec.ID, "TSP", CurDate, null, null, true);
     ПолучитьСтавкуКомиссии(Order.SfContr.rec.ID, ComNumber, null, null, @RateCom, @ComOUTCapFlag);
     RateCom = ЧислоCЗаданнойТочностью(RateCom, 2);
     /*Ставка комиссии (в %), цифрами с учетом точности из договора обслуживания с видом комиссии равной "за досрочный вывод капитала".*/
     [~ComOUTCap];
     if( ComOUTCapFlag == 1 )
        _println( RateCom );
     end;

     /*тоже, что и ComText*/
     [~ComText3];
     if( ComOUTCapFlag == 1 )
        _println( NumToStr(RateCom, "процент","процента","процентов",true) );
     end;

     /*тоже, что и ProcText*/
     [~ProcText3];
     if( ComOUTCapFlag == 1 )
        _println( ConvRubProc( НаименованиеВалюты(fullstr,TRUE) ) );
     end;

     ПолучитьДатуОкончКомис(Order.SfContr().rec.ID,@ComissEnd,@ComOUTEndFlag);
     if( ComOUTEndFlag == 1 )
        QuantyCalDays = max(ComissEnd - Order.Valid(CurDate).rec.BeginDate, 0);
     end;

     [~QuantyCalDays];
     if( ComOUTEndFlag == 1 )
        _println( QuantyCalDays );
     end;

     [~QuantyCalDaysText];
     _println( НаименКолваКаленДней(QuantyCalDays) );

     /*Ставка для расчета пороговой величины за день*/
     [~Rate];
     if(MngPlanFlag == TRUE)
        _println( MngPlanGBPRate );
     end;

     /*Количество процентов прописью*/
     [~RateText];
     if(MngPlanFlag == TRUE)
        _println( NumToStr(MngPlanGBPRate, "процент","процента","процентов",true) );
     end;

     /*Текст "процент" или "процента", или "процентов"*/
     [~RateProcText];
     /*опять извращаемся*/
     _println( ConvRubProc( НаименованиеВалюты(fullstr,TRUE) ) );

     /*тоже, что и OurBankFull*/
     [~OurBankFull_dup_2];

     /*Адрес нашего банка, включая индекс*/
     [~OurAddr];
     _println( RepSign.OurFullAddr );

     /*тоже, что и OurINN*/
     [~OurINN_dup_3];

     /*р/счет из СПИ нашего банка (выбор СПИ - по виду обслуживания = "Доверительное управление"). Поле в СПИ "счет"*/
     [~OurSPIAcc];
    /* GetAccountAndBankName({ourbank}, @Account, @CorrAcc, @BankName, @BankID); */
     _println( RepSign.OurSPIAcc );

     /*банк из СПИ нашего банка (выбор СПИ - по виду обслуживания = "Доверительное управление"). Поле в СПИ "в банке"*/
     [~OurSPIBank];
     _println( RepSign.OurSPIBank );

     /*БИК банка из СПИ нашего банка (выбор СПИ - по виду обслуживания = "Доверительное управление"). Поле в СПИ "БИК"*/
     [~BICOurSPIBank];
     _println( RepSign.BICOurSPIBankCode );

     /*ФИО представителя нашего банка - начальника подразделения, заданного в настройке "Отдел доверительного управления"*/
     [~OurRepr];
     _println( RepSign.ShortOurRepr );

     /*тоже, что и ClientFull*/
     [~ClientFull_dup_2];

     /*тоже, что и ClPasspSer*/
     [~ClPasspSer_dup_2];

     /*тоже, что и ClPasspNumb*/
     [~ClPasspNumb_dup_2];

     /*тоже, что и ClPasspGive*/
     [~ClPasspGive_dup_2];

     /*тоже, что и ClPasspGiveDate*/
     [~ClPasspGiveDate_dup_2];

     /*тоже, что и ClientAddr*/
     [~ClientAddr_dup_2];

     /*Дата рождения из анкеты субъекта*/
     [~ClBithDate];
     if(RepSign.ClBithDate != Date(0,0,0))
        _println( ДатаСВедущимНулем(RepSign.ClBithDate) );
     end;

     /*Место рождения из анкеты субъекта*/
     [~ClBithPlace];
     _println( RepSign.ClBithPlace );

     /*р/счет из СПИ учредителя по договору. Поле "счет"*/
     [~ClientSPIAcc];
    /* GetAccountAndBankName(Order.Trustor.rec.PartyID, @AccountTr, @CorrAccTr, @BankNameTr, @BankIDTr);*/
     _println( RepSign.ClientSPIAcc );

     /*Полное наименование банка из СПИ учредителя по договору. Поле "в банке"*/
     [~ClientSPIBank];
     _println( RepSign.ClientSPIBank );

     /*БИК банка из СПИ учредителя по договору. Поле "БИК"*/
     [~BICClientSPIBank];
     _println( RepSign.BICClientSPIBank );

     /*Кор/счет из СПИ учредителя по договору. Поле "корсчет"*/
     [~ClientSPICorrAcc];
     _println( RepSign.ClientSPICorrAcc );

     /*ФИО представителя учредителя (сотрудника учредителя с признаком первого лица)*/
     [~ClientRepr];
     _println( RepSign.ShortClientRepr );

     /*тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_3];

     /*тоже, что и City*/
     [~City_dup_2];

     /*тоже, что и ContractDUDate*/
     [~ContractDUDate_dup_3];

     /*тоже, что и OurBankFull*/
     [~OurBankFull_dup_3];

     /*тоже, что и OurAddr*/
     [~OurAddr_dup_2];

     /*тоже, что и OurINN*/
     [~OurINN_dup_4];

     /*тоже, что и OurSPIAcc*/
     [~OurSPIAcc_dup_2];

     /*тоже, что и OurSPIBank*/
     [~OurSPIBank_dup_2];

     /*тоже, что и BICOurSPIBank*/
     [~BICOurSPIBank_dup_2];

     /*тоже, что и OurRepr*/
     [~OurRepr_dup_2];

     /*тоже, что и ClientFull*/
     [~ClientFull_dup_3];

     /*тоже, что и ClPasspSer*/
     [~ClPasspSer_dup_3];

     /*тоже, что и ClPasspNumb*/
     [~ClPasspNumb_dup_3];

     /*тоже, что и ClPasspGive*/
     [~ClPasspGive_dup_3];

     /*тоже, что и ClPasspGiveDate*/
     [~ClPasspGiveDate_dup_3];

     /*тоже, что и ClientAddr*/
     [~ClientAddr_dup_3];

     /*тоже, что и ClBithDate*/
     [~ClBithDate_dup_2];

     /*тоже, что и ClBithPlace*/
     [~ClBithPlace_dup_2];

     /*тоже, что и ClientSPIAcc*/
     [~ClientSPIAcc_dup_2];

     /*тоже, что и ClientSPIBank*/
     [~ClientSPIBank_dup_2];

     /*тоже, что и BICClientSPIBank*/
     [~BICClientSPIBank_dup_2];

     /*тоже, что и ClientSPICorrAcc*/
     [~ClientSPICorrAcc_dup_2];

     /*тоже, что и ClientRepr*/
     [~ClientRepr_dup_2];

     /*тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_6];

     /*тоже, что и City*/
     [~City_dup_3];

     /*тоже, что и ContractDUDate*/
     [~ContractDUDate_dup_5];

     /*тоже, что и OurBankFull*/
     [~OurBankFull_dup_4];

     /*тоже, что и OurAddr*/
     [~OurAddr_dup_3];
       
     /*тоже, что и OurINN*/
     [~OurINN_dup_5];

     /*тоже, что и OurSPIAcc*/
     [~OurSPIAcc_dup_3];

     /*тоже, что и OurSPIBank*/
     [~OurSPIBank_dup_3];

     /*тоже, что и BICOurSPIBank*/
     [~BICOurSPIBank_dup_3];

     /*тоже, что и OurRepr*/
     [~OurRepr_dup_3];

     /*тоже, что и ClientFull*/
     [~ClientFull_dup_4];

     /*тоже, что и ClPasspSer*/
     [~ClPasspSer_dup_4];

     /*тоже, что и ClPasspNumb*/
     [~ClPasspNumb_dup_4];

     /*тоже, что и ClPasspGive*/
     [~ClPasspGive_dup_4];

     /*тоже, что и ClPasspGiveDate*/
     [~ClPasspGiveDate_dup_4];

     /*тоже, что и ClientAddr*/
     [~ClientAddr_dup_4];

     /*тоже, что и ClBithDate*/
     [~ClBithDate_dup_3];

     /*тоже, что и ClBithPlace*/
     [~ClBithPlace_dup_3];

     /*тоже, что и ClientSPIAcc*/
     [~ClientSPIAcc_dup_3];

     /*тоже, что и ClientSPIBank*/
     [~ClientSPIBank_dup_3];

     /*тоже, что и BICClientSPIBank*/
     [~BICClientSPIBank_dup_3];

     /*тоже, что и ClientSPICorrAcc*/
     [~ClientSPICorrAcc_dup_3];

     /*тоже, что и ClientRepr*/
     [~ClientRepr_dup_4];

     /*тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_4];

     /*тоже, что и ContractDUNumb*/
     [~ContractDUNumb_dup_5];

     /*тоже, что и ContractDUDate*/
     [~ContractDUDate_dup_4];

     /*Фамилия, имя и отчество в родительном падеже клиента-учредителя.
       Из данных учредителя, примечание вида "Полное наименование в родит. падеже"*/
     [~ClientRepres];
     _println( RepSign.ClientRepres ); /*49 - Полное наименование в родит. падеже - ФИО*/

     /*тоже, что и ClientRepr*/
     [~ClientRepr_dup_3];

     /*Адрес электронной почты учредителя из договора*/
     [~ClientEmail];
     _println( RepSign.ClientEmail );

     /*Дата заявления равна дате открытия договора*/
     [~StatementDate];
     _println( DateToStr(Order.BeginDate()) );

  end;

  TempFile = SetOutPut(GetTxtFileName("tmpout"), FALSE);
  DLWREPS_PrintReportFromTagFile( TempFile );

  ReportFileName = GetTxtFileName( "протокол" );
  if( Open( ReportOutFile, ReportFileName ) == false )
     errcode = status( errtext );
     MsgBox( "Ошибка при открытии файла |"+ ReportFileName +"|(" + errcode + ") " + errtext);
     break;
  end;
  SetOutput( ReportFileName );

  /*печатаем протокол*/
  println( "Договор ИДДУ № " + Order.Number() );
  println( HeadPR );
  if(OurBankLicFlag == FALSE)
     println( "│ " + String(iPR:3) + " │ Для нашего банка не заполнено примечание вида 'Сведения о наличии лицензий на осуществление        │\n"+
                                  "│     │ определенного вида деятельности или операции'                                                      │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if(OurRepresPosFlag == FALSE)
     println( "│ " + String(iPR:3) + " │ Не заполнено примечание вида 'Должность в родительном падеже' представителя нашего банка           │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if(OurRepresFlag == FALSE)
     println( "│ " + String(iPR:3) + " │ Не заполнено примечание вида 'Полное наименование в родит. падеже' начальника отдела ДУ нашего     │\n"+
                                  "│     │ банка                                                                                              │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if(OurRepresDocFlag == FALSE)
     println( "│ " + String(iPR:3) + " │ Не заполнено примечание вида 'Документ-основание представителя банка' для представителя нашего     │\n"+
                                "│     │ банка                                                                                              │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if((ClientRepresPosFlag == FALSE) and (Order.Trustor().rec.LegalForm == 1))
     println( "│ " + String(iPR:3) + " │ Не заполнено примечание вида 'Должность в родит. падеже' для  представителя учредителя             │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if((ClientRepresFlag == FALSE) and (Order.Trustor().rec.LegalForm == 1))
     println( "│ " + String(iPR:3) + " │ Не заполнено примечание вида 'Фамилия, имя, отчество в родительном падеже' для представителя       │\n"+
                                "│     │ учредителя                                                                                         │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if(TotalSummFlag == FALSE)
     println( "│ " + String(iPR:3) + " │ Не сформирован платеж по внесению капитала учредителем                                             │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if(MinVCapFlag == FALSE)
     println( "│ " + String(iPR:3) + " │ Не заполнена сумма ограничения 'Минимальный объем капитала или его остатка' в плане управления     │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if(ComManagFlag == -1)
     println( "│ " + String(iPR:3) + " │ Невозможно вывести значение комиссии вида 'за управление', по договору облуживания задана тарифная │\n"+
                                "│     │ сетка                                                                                              │");
     println( DelimPR );
     iPR = iPR + 1;
  elif(ComManagFlag == 0)
     println( "│ " + String(iPR:3) + " │ Для договора обслуживания не задана ставка комиссии 'за управление'                                │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if(ComSuccesFlag == -1)
     println( "│ " + String(iPR:3) + " │ Невозможно вывести значение комиссии вида 'за успех', по договору облуживания задана тарифная      │\n"+
                                "│     │ сетка                                                                                              │");
     println( DelimPR );
     iPR = iPR + 1;
  elif(ComSuccesFlag == 0)
     println( "│ " + String(iPR:3) + " │ Для договора обслуживания не задана ставка комиссии 'за успех'                                     │");
     println( DelimPR );
     iPR = iPR + 1;
  end;
  if(ComOUTCapFlag == -1)
     println( "│ " + String(iPR:3) + " │ Невозможно вывести значение комиссии вида 'за досрочный вывод капитала', по договору облуживания   │\n"+
                                "│     │ задана тарифная сетка                                                                              │");
     println( DelimPR );
     iPR = iPR + 1;
  elif(ComOUTCapFlag == 0)
     println( "│ " + String(iPR:3) + " │ Для договора обслуживания не задана ставка комиссии 'за досрочный вывод капитала'                  │");
     println( DelimPR );
/*  elif( ComOUTEndFlag == 0)
     println( "│ " + String(iPR:3) + " │ Не задана дата окончания действия комиссии 'за досрочный вывод капитала'                           │");
     println( DelimPR );*/
  end;
  println( FootPR );

  SetOutput( NULL, true );
  close( ReportOutFile );
  ViewFile( ReportOutFile );

end;

macro PrintDocument( ID, DocKind ):integer

  var RetVal:integer = 0;
  var ReportFile, errcode, errtext;
  FILE ReportOutFile() txt write; /*файл вывода для протокола*/

  Order = TS_OrderFD( DocKind, ID );
  RepSign = TS_ReportData(Order.Order());

  if(FindGrTemp(Order.Ground().rec.DocTemplate))
  message("Печать договора ...");
  PrintContr(1);
  else
    RetVal = 1;
    ReportFile = GetTxtFileName( "протокол" );
    if( Open( ReportOutFile, ReportFile ) == false )
       errcode = status( errtext );
       MsgBox( "Ошибка при открытии файла |"+ ReportFile +"|(" + errcode + ") " + errtext);
       break;
    end;
    SetOutput( ReportFile );
    println( "Не найден шаблон для печати." );
    SetOutput( NULL, true );
    close( ReportOutFile );
    ViewFile( ReportOutFile );
  end;

  return RetVal;
end;
