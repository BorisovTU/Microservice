/*******************************************************************************
 DESCRIPTION  :   Отчет "НДФЛ_Материальная выгода"
 PROGRAMMED BY:   Nikolskaya V.
 CREATION DATE:   18.09.2009 
*******************************************************************************/
import "DlRepForm_h.mac", "globals.mac";
/*Номера полей в форме отчета*/
CONST PNFLD_TSMTGAIN_BEGDATE           = 0,
      PNFLD_TSMTGAIN_ENDDATE           = 1,
      PNFLD_TSMTGAIN_CLIENTCODE        = 2,
      PNFLD_TSMTGAIN_CLIENTNAME        = 3,
      PNFLD_TSMTGAIN_CLIENTCONTR       = 4,
      PNFLD_TSMTGAIN_EMISS             = 5,
      PNFLD_TSMTGAIN_DERIV             = 6,
      PNFLD_TSMTGAIN_ISEXCEL           = 7;

CLASS TsMtGainFormData()

  Var BegDate,
      EndDate,
      ClientCode,
      ClientName,
      ClientContr,
      Emiss,
      Deriv,
      IsExcel;

      BegDate           = {curdate};
      EndDate           = {curdate};
      ClientCode        = -1;
      ClientName        = -1;
      ClientContr       = -1;
      Emiss             = "X";
      Deriv             = "X";
      IsExcel           = "X";

END;

VAR TsMtGainData = TsMtGainFormData();

PRIVATE MACRO Default( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) 
    FldRealValue = FldRealValue;
  end;
  return CM_DEFAULT;
END;

CLASS (DL_CPanel) TS_MTGAIN_Panel()

  PRIVATE MACRO Init()
     AddFieldProc( 0, PNFLD_TSMTGAIN_BEGDATE,          DL_PNFLD_BEGINDATE,        @DL_FldProc_BeginDate,   TsMtGainData.BegDate ); 
     AddFieldProc( 0, PNFLD_TSMTGAIN_ENDDATE,          DL_PNFLD_ENDDATE,          @DL_FldProc_EndDate,     TsMtGainData.EndDate );
     AddFieldProc( 0, PNFLD_TSMTGAIN_CLIENTCODE,       DL_PNFLD_CLIENT_NUM_OFBU,  @DL_FldProc_ClientNDFL,  TsMtGainData.ClientCode );
     AddFieldProc( 0, PNFLD_TSMTGAIN_CLIENTNAME,       DL_PNFLD_CLIENT_NAME_OFBU, @Default,                TsMtGainData.ClientName );
     AddFieldProc( 0, PNFLD_TSMTGAIN_CLIENTCONTR,      DL_PNFLD_CONTRACT_OFBU,    @DL_FldProc_ContractIDDU,TsMtGainData.ClientContr ); 
     AddFieldProc( 0, PNFLD_TSMTGAIN_EMISS,            DL_PNFLD_CHECKBOX,         @DL_FldProc_CheckBox,    TsMtGainData.Emiss );
     AddFieldProc( 0, PNFLD_TSMTGAIN_DERIV,            DL_PNFLD_CHECKBOX,         @DL_FldProc_CheckBox,    TsMtGainData.Deriv );
     AddFieldProc( 0, PNFLD_TSMTGAIN_ISEXCEL,          DL_PNFLD_CHECKBOX,         @DL_FldProc_CheckBox,    TsMtGainData.IsExcel );
  END;

  PRIVATE MACRO Check():BOOL                 
     
     var RetVal:bool = true; 
     if(GetFieldValue(PNFLD_TSMTGAIN_ENDDATE) > {curdate})    
        MsgBox("Окончание периода не может быть позже текущего операционного дня.");
        RetVal = false;
     end;

     return RetVal;
  END;

  initDL_CPanel( "trust.lbr", "MTGAINRG" ); 
END;
