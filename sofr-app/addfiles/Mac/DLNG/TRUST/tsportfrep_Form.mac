/*******************************************************************************
 Отчет Состав портфеля ц/б в ДУ
*******************************************************************************/
import "DlRepForm_h.mac";

/*Номера полей в форме отчета*/
CONST PNFLD_PORTFREP_MINDATE          = 0,
      PNFLD_PORTFREP_MAXDATE          = 1,
      PNFLD_PORTFREP_COMPRINTMETHOD   = 2,

      PNFLD_PORTFREP_IS_CLIENT_OFBU   = 3,
      PNFLD_PORTFREP_CLIENT_OFBU      = 4,
      PNFLD_PORTFREP_CLIENT_NAME_OFBU = 5,
      PNFLD_PORTFREP_CONTRACT_OFBU    = 6,

      PNFLD_PORTFREP_AVR_KIND         = 7,

      PNFLD_PORTFREP_PRINTMETHOD      = 8;

CONST UNDF     =  -1;

// Значение по-умолчанию
CLASS DlPortfRepFormData()

  VAR MinDate         = {curdate};
  VAR MaxDate         = {curdate};
  VAR ComPrintMethod  = SET_CHAR;

  VAR IsClientOFBU    = UNSET_CHAR;
  VAR ClientOFBU      = UNDF;
  VAR ClientNameOFBU  = STR_ALLVALUE;
  VAR ContractOFBU    = UNDF;

  VAR AvrKind         = DL_DERIVKIND_ALL;

  VAR PrintMethod     = DL_OUTREPORT_EXCEL;

END;

VAR DlPortfRepData = DlPortfRepFormData();

//////////////////////////////////////////////////////////////////////////////////////////////////////////

PRIVATE MACRO Default( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
        FldShowValue = FldRealValue;
  elif( (Cmd == DLG_KEY) AND (Key == KEY_SPACE) )
     FldRealValue = 0;
     FldShowValue = "";
  end;
  FldShowValue = FldRealValue;
  return CM_DEFAULT;
END;

CLASS (DL_CPanel) TS_PortfRep_Panel()

  PRIVATE MACRO Init()

     AddFieldProc( 0, PNFLD_PORTFREP_MINDATE,          DL_PNFLD_BEGINDATE,        @DL_FldProc_BeginDate,       DlPortfRepData.MinDate        );
     AddFieldProc( 0, PNFLD_PORTFREP_MAXDATE,          DL_PNFLD_BEGINDATE,        @DL_FldProc_EndDate,         DlPortfRepData.MaxDate        );
     AddFieldProc( 0, PNFLD_PORTFREP_COMPRINTMETHOD,   DL_PNFLD_CHECKBOX,         @DL_FldProc_CheckBox,        DlPortfRepData.ComPrintMethod );
     AddFieldProc( 0, PNFLD_PORTFREP_IS_CLIENT_OFBU,   DL_PNFLD_ISCLIENT_OFBU,    @DL_FldProc_IsClientOFBU,    DlPortfRepData.IsClientOFBU   );
     AddFieldProc( 0, PNFLD_PORTFREP_CLIENT_OFBU,      DL_PNFLD_CLIENT_NUM_OFBU,  @DL_FldProc_ClientOFBU,      DlPortfRepData.ClientOFBU     );
     AddFieldProc( 0, PNFLD_PORTFREP_CLIENT_NAME_OFBU, DL_PNFLD_CLIENT_NAME_OFBU, @Default,                    DlPortfRepData.ClientNameOFBU );
     AddFieldProc( 0, PNFLD_PORTFREP_CONTRACT_OFBU,    DL_PNFLD_CONTRACT_OFBU,    @DL_FldProc_ContractOFBU,    DlPortfRepData.ContractOFBU   );
     AddFieldProc( 0, PNFLD_PORTFREP_AVR_KIND,         DL_PNFLD_AVRKIND,          @DL_FldProc_AvrKind,         DlPortfRepData.AvrKind,     25, 10);
     AddFieldProc( 0, PNFLD_PORTFREP_PRINTMETHOD,      DL_PNFLD_PRINTMETHOD,      @DL_FldProc_PrintMethod,     DlPortfRepData.PrintMethod, 33, 14);

  END;

  PRIVATE MACRO Check():BOOL
     return true;
  END;

  initDL_CPanel( "trust.lbr", "TSPORTF" );
END;
