/*******************************************************************************
 DESCRIPTION  :   Отчет "Сведения об осуществлении деятельности по управлению ц/б"
 PROGRAMMED BY:   Иванов А.И.
 CREATION DATE:   IAL 13 January 2009 
*******************************************************************************/
import "DlRepForm_h.mac", "globals.mac";

/*Номера полей в форме отчета*/
CONST PNFLD_TSBRREP_PERIOD         = 0,
      PNFLD_TSBRREP_YEAR           = 1,
      PNFLD_TSBRREP_COMPRINTMETHOD = 2,
      PNFLD_TSBRREP_PRINTMETHOD    = 3;

CLASS TsBrRepFormData()

  VAR BegDate         = {curdate};
  VAR RepDate         = {curdate};
  VAR Year, PrevQuartal;
  VAR ComPrintMethod  = SET_CHAR;
  VAR PrintMethod     = DL_OUTREPORT_EXCEL;

END;

VAR TsBrRepData = TsBrRepFormData();

CLASS (DL_CPanel) TS_TSBRREP_Panel()

  PRIVATE MACRO Init()
     VAR CurMonth;
     DateSplit( {curdate}, null, CurMonth, TsBrRepData.Year );

     TsBrRepData.PrevQuartal = (CurMonth - 1)/3; /*текущий квартал-1*/
     if( TsBrRepData.PrevQuartal == 0 )
        TsBrRepData.PrevQuartal = 4;
        TsBrRepData.Year        = TsBrRepData.Year - 1;
     end;

     /*Получим отчетную дату - последнюю дату из отчетного периода.*/
     Period_GetInterval( TsBrRepData.PrevQuartal + 12, TsBrRepData.Year, @TsBrRepData.BegDate, @TsBrRepData.RepDate );

     AddFieldProc( 0, PNFLD_TSBRREP_PERIOD,           DL_PNFLD_PERIOD,      @DL_FldProc_Period,      TsBrRepData.PrevQuartal + 12, 31, 5 ); /*(+12 - для NameAlg.dbt)*/
     AddFieldProc( 0, PNFLD_TSBRREP_YEAR,             DL_PNFLD_YEAR,        @DL_FldProc_Year,        TsBrRepData.Year );
     AddFieldProc( 0, PNFLD_TSBRREP_COMPRINTMETHOD,   DL_PNFLD_CHECKBOX,    @DL_FldProc_CheckBox,    TsBrRepData.ComPrintMethod );
     AddFieldProc( 0, PNFLD_TSBRREP_PRINTMETHOD,      DL_PNFLD_PRINTMETHOD, @DL_FldProc_PrintMethod, TsBrRepData.PrintMethod, 30, 9 );
  END;

  PRIVATE MACRO Check():BOOL
     return true;
  END;

  initDL_CPanel( "trust.lbr", "TRBRREP" ); 
END;
