/*Массовое выполнение действий над документами*/
IMPORT "tsutil.mac";

record spgrdoc("spgrdoc.dbt");
private var SpGround = TRecHandler( "spground.dbt" );

PRIVATE CONST ERROR_EXEC   = 0,
              PRINT_HEADER = 1,
              PRINT_FOOTER = 2;

PRIVATE MACRO PrintHead( Head:STRING )
[
                   #
┌────────────────────┬──────┬───────────────────────────────────────────────────────────────────────────────────────────────────┐
│     Номер          │  №   │                      Сообщение                                                                    │
│   документа        │ошибки│                                                                                                   │
├────────────────────┼──────┼───────────────────────────────────────────────────────────────────────────────────────────────────┤](Head);
END;

PRIVATE MACRO PrintFooter()
[└────────────────────┴──────┴───────────────────────────────────────────────────────────────────────────────────────────────────┘
];
END;

PRIVATE MACRO PrintLine( Number:STRING, ErrStatus:INTEGER, ErrMessage:STRING )
[│####################│######│###################################################################################################│]
(Number:w, ErrStatus, ErrMessage:w);
END;

PRIVATE MACRO PrintDocument( NumExec:INTEGER, ErrStatus:INTEGER, ErrMessage:STRING )
  if( NumExec == PRINT_HEADER )
     PrintHead("Отчет о массовой печати документов.");
  elif( NumExec == PRINT_FOOTER )
     PrintFooter();
  elif( NumExec == ERROR_EXEC )
     if( (ErrStatus != 0) or ((ErrMessage != NULL) and (ErrMessage != "")) )
        var Number = "";
        if( TS_FindGroundByID(spgrdoc.SpGroundID, SpGround) )
           Number = SpGround.rec.Xld;
        end;
        PrintLine(Number, ErrStatus, ErrMessage);
     end;
  end;
END;

/* Action = 1 - печать документа (F7 из скроллинга документов) */
MACRO Печать_ОтчетСканирования( NumExec:INTEGER, FDoc:VARIANT, ErrStatus:INTEGER, ErrMessage:STRING, Action:INTEGER )

  SetBuff(spgrdoc, FDoc);

  if( Action == 1 )
     PrintDocument( NumExec, ErrStatus, ErrMessage );
  end;

END;
