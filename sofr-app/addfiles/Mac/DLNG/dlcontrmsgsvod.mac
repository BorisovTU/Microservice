/*
$Name:        dlcontrmsgsvod.mac
$Module:      Ядро Securities
$Description: Формирование уведомлений ДБО на биржи: ММВБ, СПБ
*/
import "dlcontrmsg_mmvb.mac";
import "dlcontrmsg_spb.mac";

var OutFiles_spb = TArray();

СформироватьСводноеСообщениеДБО_ММВБ();
СформироватьУведомленияДБО_СПБ(OutFiles_spb);

//BIQ-7041, события для ЭП РСХБ
   var i = 0;
   var sql_str, cmd;
   while( i < OutFiles_spb.size )
      sql_str = "insert into utableprocessout_dbt (t_objecttype, t_status, t_timestamp, t_fullfilename) "+
                    " values (:T_OBJECTTYPE, :T_STATUS, :T_TIMESTAMP, :T_FULLFILENAME )";
      cmd = RSDCommand(sql_str);
      cmd.AddParam("T_OBJECTTYPE", RSDBP_IN, OutFiles_spb(i).MessType);
      cmd.AddParam("T_STATUS", RSDBP_IN, 2);
      cmd.AddParam("T_TIMESTAMP", RSDBP_IN, dttm(date(), time()));
      cmd.AddParam("T_FULLFILENAME", RSDBP_IN, OutFiles_spb(i).FullFileName);
      cmd.Execute;

      i = i + 1;
   end;
