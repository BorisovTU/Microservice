/*
$Name:        fxcsblnc.mac
$Module:      FOREX
$Description: Функция шагов выбора "Вести учет сделки по внебалансу"
*/

/*-------------------------------------------------------------------------
          Автоматизированная банковская система RS-Bank v5.1
                 Copyright (c) R-Style Software Lab

  Имя файла        : fxcsblnc.mac

  Библиотека       : FOREX

  Описание         : Функция шагов выбора "Вести учет сделки по внебалансу"

  Программист      : Kalashnikov Michael (KMV)

  Создан           : 29.11.2001
-------------------------------------------------------------------------*/
import InsCarryDoc, OprInter, fxlb;

/*Вести учет сделки по внебалансу?*/
MACRO FX_DoNonBalanceCase(fd)
  var ValDate, ReqDate, ComDate;

  if (fd.leg.rec.LegID == DL_LEGID_BASE)
    if (not GetOprDate(FX_OPERDATE_VAL, ValDate))
        return 1;
    end;
    if (not GetOprDate(FX_OPERDATE_VAL_RQ, ReqDate))
        return 1;
    end;
    if (not GetOprDate(FX_OPERDATE_VAL_CM, ComDate))
        return 1;
    end;
  else
    if (not GetOprDate(FX_OPERDATE_VAL_REV, ValDate))
        return 1;
    end;
    if (not GetOprDate(FX_OPERDATE_VAL_RQ_REV, ReqDate))
        return 1;
    end;
    if (not GetOprDate(FX_OPERDATE_VAL_CM_REV, ComDate))
        return 1;
    end;
  end;

  if ((ValDate == fd.tick.rec.DealDate)or
      ((ReqDate == {curdate})or(ComDate == {curdate})))
    if (fd.leg.rec.LegID == DL_LEGID_BASE)
      return string(FX_STEP_SETBALANCE);
    else
      return string(FX_STEP_SETBALANCE_REV);
    end;
  else
    if (fd.leg.rec.LegID == DL_LEGID_BASE)
      return string(FX_STEP_SETNONBALANCE);
    else
      return string(FX_STEP_SETNONBALANCE_REV);
    end;
  end;

  return 1;
END;

FX_NameMacroFile = "fxcsblnc";
