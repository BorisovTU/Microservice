/*-------------------------------------------------------------------------
          Автоматизированная банковская система RS-Bank v5.1
                 Copyright (c) R-Style Software Lab

  Имя файла        : fxinitop.mac

  Библиотека       : FOREX

  Описание         : Настройка операции

  Программист      : Goldobin Alexey 

  Создан           : 5.07.02
-------------------------------------------------------------------------*/
import InsCarryDoc, fxlb;

PRIVATE MACRO DefineDates_base (fd)
    var ok = true;

    ok = ok and DefineOprDate(FX_OPERDATE_VAL, fd.GetOperDate(FX_OPERDATE_VAL));
    ok = ok and DefineOprDate(FX_OPERDATE_VAL_RQ, fd.GetOperDate(FX_OPERDATE_VAL_RQ));
    ok = ok and DefineOprDate(FX_OPERDATE_VAL_CM, fd.GetOperDate(FX_OPERDATE_VAL_CM));

    return ok;
END;

PRIVATE MACRO DefineDates_rev (fd)
    var ok = true;

    ok = ok and DefineOprDate(FX_OPERDATE_VAL_REV, fd.GetOperDate(FX_OPERDATE_VAL_REV));
    ok = ok and DefineOprDate(FX_OPERDATE_VAL_RQ_REV, fd.GetOperDate(FX_OPERDATE_VAL_RQ_REV));
    ok = ok and DefineOprDate(FX_OPERDATE_VAL_CM_REV, fd.GetOperDate(FX_OPERDATE_VAL_CM_REV));

    return ok;
END;

PRIVATE MACRO SayError (ok)
  if ( not ok )
      fx_error("Ошибка при определении дат операции");
  end;  
  return ok;
END;


MACRO FX_InitStepForFD_FX(fd)
  var ok = true;
   
  if (fd.leg.rec.LegID == DL_LEGID_BASE)
      ok = ok and DefineOprDate(FX_OPERDATE_DEAL, fd.GetOperDate(FX_OPERDATE_DEAL));
      ok = ok and DefineOprDate(FX_OPERDATE_DEALCLOSE, fd.GetOperDate(FX_OPERDATE_DEALCLOSE));

      ok = ok and DefineDates_base(fd);
  end;

  return SayError(ok);
END;

MACRO FX_InitStepForFD_SW(fd)
  var ok = true;   

  if (fd.leg.rec.LegID == DL_LEGID_BASE)
      ok = ok and DefineOprDate(FX_OPERDATE_DEAL, fd.GetOperDate(FX_OPERDATE_DEAL));
      ok = ok and DefineDates_base(fd);
  else 
      ok = ok and DefineOprDate(FX_OPERDATE_DEALCLOSE, fd.GetOperDate(FX_OPERDATE_DEALCLOSE));
      ok = ok and DefineDates_rev(fd);
  end;

  return SayError(ok);
END;

FX_NameMacroFile = "fxinitop";