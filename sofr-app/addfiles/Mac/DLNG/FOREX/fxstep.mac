/*-------------------------------------------------------------------------
          Автоматизированная банковская система RS-Bank v5.1
                 Copyright (c) R-Style Software Lab

  Имя файла        : fxstep.mac

  Библиотека       : FOREX

  Описание         : Функции шагов операций

  Программист      : Kalashnikov Michael (KMV)

  Создан           : 29.11.2001
-------------------------------------------------------------------------*/
import fxcateg, fxlb;

/*функция создает первичный документ и запускает переданную ей функцию шага*/
MACRO FX_ExecuteStepFunction(tickID, legID, function, ID_Operation, ID_Step)
  var fd, leg = TBFile("dl_leg.dbt");
  
  leg.KeyNum = 0;	
  leg.rec.LegKind = LEG_KIND_DL_TICK;
  leg.rec.DealID = tickID;
  leg.rec.LegID = legID;
  if (not leg.GetEQ)
    fx_error("Не могу найти " + legID + "-й транш сделки");
    return false;
  end;

  fd = FXFirstDoc(DL_FXLEG, leg.rec.Id, true);
  if (ValType(fd) != V_GENOBJ)
    fx_error("Не могу создать первичный документ");
    return false;
  end;
  return ExecMacro2(function, fd, ID_Operation, ID_Step);
END;

FX_NameMacroFile = "fxstep";
