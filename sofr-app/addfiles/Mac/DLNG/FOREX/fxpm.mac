/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : fxpm.mac
  Comment     : Класc платежа с немного измененной функцией проводки
└───────────────────────────────────────────────────────────────────────────*/
import PaymInter;


/* Установка переменной, если она не определена
*/
PRIVATE MACRO ByDefault(x, value)
  if (ValType(x) == V_UNDEF)
      setparm(0, value);
  end;
end;


MACRO FX_PmBookpass(pm,
                   BpGround,                          /* основание проводки */
                   CreditAccount, CreditAccountFIID,  /* счет кредита с валютой */
                   MinorAmount, MinorFIID,            /* сумма проводки с валютой */
                   MinorCrossRate,                    /* курс конверсии Minor'а к дебету */
                   MinorCreditCrossRate,              /* курс конверсии Minor'а к кредиту */
                   IsPartOfMain,
                   Date_Carry,
                   Number_Pack,
                   Numb_Document,
                   Result_Carry
                   )
   var
       paymtr, pd;

   paymtr = pm.MakeTransaction(CreditAccount, CreditAccountFIID,
                                 MinorAmount, MinorFIID,
                                 MinorCrossRate, MinorCreditCrossRate);

   if( paymtr == NULL )
     MsgBox("Ошибка при создании проводки по платежу");
     return false;
   end;

   if( ValType(IsPartOfMain) != V_Undef ) paymtr.IsPartOfMain = IsPartOfMain; end;

   ByDefault(Date_Carry,     {curdate});
   ByDefault(Result_Carry,   1);
   ByDefault(BpGround,       pm.Ground);
   ByDefault(CreditAccount,  pm.FutureReceiverAccount);

   if(CreditAccount == "")
     MsgBox("Не задан счет получателя в платеже");
     return false;
   end;

   paymtr.Chapter = 1;
   paymtr.Date_Carry = Date_Carry; //Data Znacheniya
   
   paymtr.ResultCarry = Result_Carry;
   paymtr.Kind_Oper     = " 1";
   paymtr.Ground       = BpGround;
/*   paymtr.Numb_Document = VS_GetBookpassNum(pm.FuturePayerAccount,
                                            CreditAccount, pm.PayerFIID, 1);*/

   if( not paymtr.Carry )
     MsgBox("Ошибка при актуализации платежа");
     return false;
   end;

   return true;
end;


/* Класс платежа с немного измененной функцией проводки
*/
CLASS (RsbPayment) FxRsbPayment (p1)
    MACRO Bookpass(BpGround,                          /* основание проводки */
                   CreditAccount, CreditAccountFIID,  /* счет кредита с валютой */
                   MinorAmount, MinorFIID,            /* сумма проводки с валютой */
                   MinorCrossRate,                    /* курс конверсии Minor'а к дебету */
                   MinorCreditCrossRate,              /* курс конверсии Minor'а к кредиту */
                   IsPartOfMain,
                   Date_Carry,
                   Number_Pack,
                   Numb_Document,
                   Result_Carry
                   )

      return FX_PmBookpass(this,
                   BpGround,                          /* основание проводки */
                   CreditAccount, CreditAccountFIID,  /* счет кредита с валютой */
                   MinorAmount, MinorFIID,            /* сумма проводки с валютой */
                   MinorCrossRate,                    /* курс конверсии Minor'а к дебету */
                   MinorCreditCrossRate,              /* курс конверсии Minor'а к кредиту */
                   IsPartOfMain,
                   Date_Carry,
                   Number_Pack,
                   Numb_Document,
                   Result_Carry);
    end;

    InitRsbPayment(p1);
END;
