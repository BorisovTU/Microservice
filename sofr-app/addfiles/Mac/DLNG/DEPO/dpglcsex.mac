/************************************************************************/
/*         Автоматизированная банковская система RS-Bank 6.0            */
/*                 Copyright (c) R-Style Software Lab 2005              */
/*                                                                      */
/*  Имя файла        : dpglcsex.mac                                     */
/*                                                                      */
/*  Описание         : Глобальные операции депозитария                  */
/*                     макрос case-шагов всех глобальных операций       */
/*                     Исполнить инвентарную операцию?                  */
/*  Программист      : Nikonorov Evgeny                                 */
/*                                                                      */
/*  Создан           : 05.07.2005                                       */
/*                                                                      */
/************************************************************************/


import InsCarryDoc, OprInter, "dlcarry.inc", DPInter;

/* Буферы ГЛ, заполняемые из операции */
record corpop ( dpcorpop );    /*поручение*/
record regstr( dpregstr ); /*реестр*/


/* Номера шагов для перехода */
const НомерШагаВыпускОтчетаОбИсполнении = 100;

const НомерШагаОткрытиеРазделов = 20;

/*Номера видов системных дат*/
const DATE_VALUE = 1;

/**********************************/
/* Выполнение шага                */
/**********************************/
macro ExecuteCaseStep( Kind_Operation, Number_Step, first, KindDoc )
  record crp( dpcorpop );

  SetBuff( crp, first );
  
  DefineOprDate( DATE_VALUE, crp.ValueDate );
  
  if( crp.OperState == DP_INVSTATUSORDER_REJECT )
    return string( НомерШагаВыпускОтчетаОбИсполнении );
  else
    if(   crp.DocKind == DP_DEPOPER_CONVERT )
      return string( НомерШагаОткрытиеРазделов );
    elif( crp.DocKind == DP_DEPOPER_REPAY )
      return string( НомерШагаОткрытиеРазделов );
    elif( crp.DocKind == DP_DEPOPER_BONEMISS )
      return string( НомерШагаОткрытиеРазделов );
    else
      msgbox( "Неизвестный вид поручения ", crp.DocKind );
      return 1;
    end;
  end;

end;
