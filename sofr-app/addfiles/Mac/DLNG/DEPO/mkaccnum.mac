/************************************************************************/
/*-    ФОРМИРОВАНИЕ НОМЕРОВ ЛИЦЕВЫХ СЧЕТОВ для СЧЕТОВ и РАЗДЕЛОВ ДЕПО   -*/
/*----------------------------------------------------------------------*/
/*-  Programming:   Alex V. Mishin                                     -*/
/*-  Creation: 30.10.2001                                              -*/
/************************************************************************/

Import "dppattern.mac";

const ChangedSymbols  = "АВЕКМНОРСТХ"; /* Символы руского алфавита, по начертанию совпадающие с латинскими */
const ChangingSymbols = "ABEKMHOPCTX"; /* Символы латинского алфавита, заменяющие аналогичные русские */
const AllowedSymbols  = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"; /* Символы, допустимые к использованию в номерах счетов */

/* Проверка и коррекция недопустимых символов */
macro CheckAllowedSymbols( Str )
  var len, i;

  if( Strlen(Str) )
    /* Переводим в верхний регистр */
    Str = StrUpr( Str );

    /* Заменяем допустимые русские буквы на соотвт. латинские */
    len = Strlen( ChangedSymbols );
    i = 1;
    while( i <= len )
      if( Index( Str, SubStr(ChangedSymbols, i, 1 ) ) )
        Str = StrSubst( Str, SubStr(ChangedSymbols, i, 1 ), SubStr(ChangingSymbols, i, 1 ) );
      end;
      i = i + 1;
    end;

    /* Проверяем получившуюся строку на допустимые символы */
    len = Strlen( Str );
    i = 1;
    while( ( Strlen( Str ) ) AND ( i <= len ) )
      if( NOT Index( AllowedSymbols, SubStr( Str, i, 1 ) ) )
        MsgBox("В строке для генерации номера лицевого счета должны быть только|цифры и латинские буквы");
        Str = "";
      end;
      i = i + 1;
    end;
  end;

  return Str;
end;

/*
Процедура формирования номера лицевого счета ДЕПО для данного счета/раздела
*/
macro MakeAccCodeForDepo( DepoAcc, FIID, Indoor, Issuer )
  
  var num;

  num =  CheckAllowedSymbols( DP_FormNumObjByPattern( DP_GetPatternForObj(DPPATNUM_OBJECT_FACEACC, 
                                                                          DPPATNUM_KINDCODE_UNDEF, 
                                                                          DepoAcc,
                                                                          FIID, Indoor, Issuer), 
                                                      DepoAcc, FIID, Indoor, Issuer) );
  CounterAccount = CounterAccount + 1;
  return num;
end;


/*
Процедура формирования имени лицевого счета ДЕПО для данного счета/раздела
Возвращает имя лицевого счета, если возращает пустую строку - счет именуется по умолчанию -
по имени своего владельца
*/
macro MakeAccNameForDepo( DepoAcc, FIID, Indoor )

  return "";
end;
