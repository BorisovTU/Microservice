/*
$Name: spinfrep.mac
$Module: Депозитарий
$Description: Стандартные ф-ции для работы с пользовательскими отчетами Депозитария
*/
import "DlRepForm_h.mac", "dlcnst.inc", DPInter;

//Обязательные переменные для ИО
var PanFieldNums = TArray();   //поля панели
var RepPan = "";            //панель

record RepParm("dprepparm.rec");
record RepData("dprepdata.rec");

record GrReport("spground");
record GrDraft("spground");
record IOLogopr("splogopr");
record IOInfopr("spinfopr");

var RepError = 0;
////////////////////////////////

private const UNDEF_ID  = -1; // неопределенный идентификатор
private const UNDEF_NID = 0;  /* неопределенный идентификатор в тех случаях, когда
                                 нельзя использовать -1 (oper, значения из namealg и т.п.)*/

private const STR_DEPO_TYPE_BOTH = "Все";

class (DL_CPanel) DP_UserRep(_PanelDic, _PanelName)

  macro GetPanelFldsArr()
  end;

  private macro SetRepPanParm()
    var i = 0;
    var PanFields:TArray = GetPanelFldsArr();

    RepPan = this.Data();

    PanFieldNums.size = 0;
    while(i < PanFields.size())
      PanFieldNums[i] = PanFields[i];
      i = i + 1;
    end;
  end;

  //установить ошибку
  macro SetError(ErrStr:string)
    if(ErrStr != "")
      msgbox(ErrStr);
      RepError = 1;
    end;
  end;

  //ID информационной операции
  macro GetLogoprID()                       
    return IOLogopr.AutoKey;
  end;

  //Параметр поля - это ID или значение, по которому можно искать или передавать его в отчет
  macro GetFldParm(fld)
    
    if(fld == SP_REPORT_NUM)
      return RepParm.ReportNum;         
    elif(fld == SP_CODEDPRT)
      return RepParm.iNumDprt;        
    elif(fld == SP_NAMEDPRT)
      return RepParm.iNumDprt;         
    elif(fld == SP_REPDATE)
      return RepParm.RepDate;      
    elif(fld == SP_SHOWREPDATE)
      return RepParm.showRepDate;        
    elif(fld == SP_BEGINDATE)
      return RepParm.BeginDate;          
    elif(fld == SP_ENDDATE)
      return RepParm.EndDate;        
    elif(fld == SP_QUARTER)
      return RepParm.EndDate; 
    elif(fld == SP_YEAR)               
      return RepParm.EndDate;    
    elif(fld == SP_ACC_KIND)           
      return RepParm.iAccKind;
    elif(fld == SP_ACC_TYPE)           
      return RepParm.iAccType;
    elif(fld == SP_DEPO_ACC)
      return RepParm.iDepoAcc;           
    elif(fld == SP_DEPO_PART)
      return RepParm.iDepoPart;       
    elif(fld == SP_DACCOUNT)
      return RepParm.DAccount;         
    elif(fld == SP_IDPLAN)
      return RepParm.iPlan;           
    elif(fld == SP_NAMEPLAN)
      return RepParm.iPlan;        
    elif(fld == SP_SHOWDEPONENT)
      return RepParm.showDeponent;       
    elif(fld == SP_CODEDEPONENT)
      return RepParm.iDeponent;       
    elif(fld == SP_NAMEDEPONENT)
      return RepParm.iDeponent;       
    elif(fld == SP_CODEDOMICILIATE)
      return RepParm.iDomiciliate; 
    elif(fld == SP_NAMEDOMICILIATE)
      return RepParm.iDomiciliate; 
    elif(fld == SP_CODEOPERATOR)
      return RepParm.iOperator;    
    elif(fld == SP_NAMEOPERATOR)
      return RepParm.iOperator;    
    elif(fld == SP_CODEISSUER)
      return RepParm.iIssuer;     
    elif(fld == SP_NAMEISSUER)
      return RepParm.iIssuer;      
    elif(fld == SP_MORTGAGEECODE)
      return RepParm.iMortgagee;     
    elif(fld == SP_MORTGAGEENAME)
      return RepParm.iMortgagee;      
    elif(fld == SP_IDOPEROPENED)
      return RepParm.iOperOpened;    
    elif(fld == SP_NAMEOPEROPENED)
      return RepParm.iOperOpened;   
    elif(fld == SP_IDOPERCLOSED)
      return RepParm.iOperClosed;   
    elif(fld == SP_NAMEOPERCLOSED)
      return RepParm.iOperClosed;  
    elif(fld == SP_CODESTATUS)
      return RepParm.iStatus;      
    elif(fld == SP_FI_AVRNUM)
      return RepParm.iAvrKinds;       
    elif(fld == SP_FI_AVRKIND)
      return RepParm.iAvrKinds;      
    elif(fld == SP_FI_CODE)
      return RepParm.iFI;       
    elif(fld == SP_ISINSECUR)
      return RepParm.iFI;      
    elif(fld == SP_CODESECUR)
      return RepParm.iFI;      
    elif(fld == SP_NAMESECUR)
      return RepParm.iFI;      
    elif(fld == SP_AMOUNTSECUR)
      return RepParm.AmountSecur;      
    elif(fld == SP_FI_CODE_GEN)
      return RepParm.iFIGen;      
    elif(fld == SP_NAMESECUR_GEN)
      return RepParm.iFIGen;  
    elif(fld == SP_NULL_OVERS)
      return RepParm.null_overs;      
    elif(fld == SP_IS_APP)
      return RepParm.is_ap;            
    elif(fld == SP_ADMOPDATE)
      return RepParm.AdmopCarryDate;
    elif(fld == SP_SHOW_OPERDATE)
      return RepParm.showOperDate;      
    elif(fld == SP_ADMOPRegDATEBEGIN)
      return RepParm.AdmopRegDATEbegin;
    elif(fld == SP_ADMOPRegDATEEND)
      return RepParm.AdmopRegDATEend; 
    elif(fld == SP_ADMOPMASK)
      return RepParm.AdmopXldMask;       
    elif(fld == SP_SFCONTRS)
      return RepParm.SfContrID;        
    elif(fld == SP_SFCONTRSNAME)
      return RepParm.SfContrID;     
    elif(fld == SP_COMISSCODE)
      return RepParm.CommNumber;       
    elif(fld == SP_COMISSNAME)
      return RepParm.CommNumber;       
    elif(fld == SP_GRDOC)
      return RepParm.GrDoc;          
    elif(fld == SP_XLDBEGIN)
      return RepParm.XldBegin;        
    elif(fld == SP_XLDEND)
      return RepParm.XldEnd;        
    elif(fld == SP_OPCLASS)
      return RepParm.OpClass;        
    elif(fld == SP_OPCLASS_INV)
      return RepParm.OpClass_Inv;     
    elif(fld == SP_OPCLASS_INF)
      return RepParm.OpClass_Inf;     
    elif(fld == SP_OPCLASS_ADM)
      return RepParm.OpClass_Adm;     
    elif(fld == SP_OPNUMKIND)
      return RepParm.OpKind;       
    elif(fld == SP_OPKIND)
      return RepParm.OpKind;
    elif(fld == SP_OPNUMKIND_INV)
      return RepParm.OpKindINV;       
    elif(fld == SP_OPKIND_INV)
      return RepParm.OpKindINV;         
    elif(fld == SP_OPNUMKIND_INF)
      return RepParm.OpKindINF;       
    elif(fld == SP_OPKIND_INF)
      return RepParm.OpKindINF;         
    elif(fld == SP_OPNUMKIND_ADM)
      return RepParm.OpKindADM;       
    elif(fld == SP_OPKIND_ADM)
      return RepParm.OpKindADM;         
    elif(fld == SP_OPSTATUS)
      return RepParm.OpStatus;        
    elif(fld == SP_OPSTATUSBEGIN)
      return RepParm.OpStatusBegin;      
    elif(fld == SP_OPSTATUSEND)        
      return RepParm.OpStatusEnd;      
    elif(fld == SP_SHOWOJDNUM)
      return RepParm.ShowOjdNum;         
    elif(fld == SP_OJDNUMBEGIN)        
      return RepParm.OjdNumBegin;
    elif(fld == SP_OJDNUMEND)
      return RepParm.OjdNumEnd;      
    elif(fld == SP_PARTY)
      return RepParm.iParty;            
    elif(fld == SP_CERTIF)
      return RepParm.InvCardID;          
    elif(fld == SP_SHOW_PARTY)
      return RepParm.ShowParty;      
    elif(fld == SP_SHOW_DEPOACC)
      return RepParm.ShowDepoAcc;       
    elif(fld == SP_SHOW_DEPOPART)
      return RepParm.ShowDepoPart;    
    elif(fld == SP_SHOW_ISSIUER)
      return RepParm.ShowIssuer;     
    elif(fld == SP_PAWN)
      return RepParm.showPawn;     
    elif(fld == SP_SHOW_AVRKINDS)
      return RepParm.ShowAvrKinds;    
    elif(fld == SP_SHOW_FI)
      return RepParm.ShowFI;          
    elif(fld == SP_SHOW_FACEACC)
      return RepParm.ShowFaceAcc;     
    elif(fld == SP_SHOW_CERT_FIELD)
      return RepParm.ShowCertFld; 
    elif(fld == SP_SHOW_SECURQUAL)
      return RepParm.ShowSecurQual;  
    elif(fld == SP_DISP_PART)
      return RepParm.disp_part;       
    elif(fld == SP_pDEPONENTNAME)
      return RepParm.printDeponentName;     
    elif(fld == SP_pDEPONENTIURISD)
      return RepParm.printDeponentIURISD;    
    elif(fld == SP_pOPERATORNAME)
      return RepParm.printOperatorName;     
    elif(fld == SP_pOPERATORIURISD)
      return RepParm.printOperatorIURISD;    
    elif(fld == SP_STATUSOPEN_ACC)
      return RepParm.StatusOpen_ACC;  
    elif(fld == SP_STATUSLOCKED_ACC)
      return RepParm.StatusLocked_ACC;
    elif(fld == SP_STATUSCLOSE_ACC)
      return RepParm.StatusClose_ACC; 
    elif(fld == SP_STATUSOPEN_PAR)
      return RepParm.StatusOpen_PAR;  
    elif(fld == SP_STATUSLOCKED_PAR)
      return RepParm.StatusLocked_PAR; 
    elif(fld == SP_STATUSCLOSE_PAR)
      return RepParm.StatusClose_PAR; 
    elif(fld == SP_SHOW_ACTIVE)
      return RepParm.showActiveAccount;  
    elif(fld == SP_SHOW_PASSIVE)
      return RepParm.showPassiveAccount;    
    elif(fld == SP_AVRGROUP_SHARE)
      return RepParm.avrgroupShare;   
    elif(fld == SP_AVRGROUP_BOND)
      return RepParm.avrgroupBond;   
    elif(fld == SP_AVRGROUP_INVSHARE)
      return RepParm.avrgroupInvest;
    elif(fld == SP_AVRGROUP_NOTEMISS)
      return RepParm.avrgroupNotEmiss;
    elif(fld == SP_INVSHARE_POINT)
      return RepParm.InvPoint;  
    elif(fld == SP_ISSUER_RESIDENT)
      return RepParm.IssuerResident;  
    elif(fld == SP_ISSUER_NOTRESIDENT) 
      return RepParm.IssuerNotResident;
    elif(fld == SP_INCLUDE_IN_REPORT)
      return RepParm.IncludeInReport;
    elif(fld == SP_FLAG_ALLFINNSTR)
      return RepParm.ShowAllFininstr; 
    elif(fld == SP_ACC_OPENSTATE)
      return RepParm.ShowAccountOpenState;   
    elif(fld == SP_ACC_CLOSESTATE)
      return RepParm.ShowAccountCloseState;  
    elif(fld == SP_NOSTRO_LIST)
      return null; //параметра нет 
    elif(fld == SP_AVOIRISS_LIST)
      return null; //параметра нет 
    elif(fld == SP_GROUP_BY_AVOIR)
      return RepParm.group_by_avoir;  
    elif(fld == SP_SPLIT_PARTYGROUP)
      return RepParm.split_partygroup;
    elif(fld == SP_SHOW_GROUP_TOTAL)
      return RepParm.show_group_total;
    elif(fld == SP_SHOW_LIST_TOTAL)
      return RepParm.show_list_total; 
    elif(fld == SP_COUNT_RECORD)
      return RepParm.count_record;   
    elif(fld == SP_AOOPTYPECODE)
      return RepParm.OpKind;   
    elif(fld == SP_AOOPKINDNAME)
      return RepParm.AOOpKind;   
    elif(fld == SP_AOOPKINDCODE)
      return RepParm.AOOpKind;    
    elif(fld == SP_AOOBJTYPE)
      return RepParm.AOObjType;      
    elif(fld == SP_AOOBJCODE)
      if(RepParm.AOObjType == AOOT_DEPOACC)
        return RepParm.iDepoAcc;
      elif(RepParm.AOObjType == AOOT_DEPOPART)
        return RepParm.iDepoPart;
      elif(RepParm.AOObjType == AOOT_ACCOUNT)
        return RepParm.DAccount;
      elif(RepParm.AOObjType == AOOT_PARTY)
        return RepParm.iParty;
      elif(RepParm.AOObjType == AOOT_FIID)
        return RepParm.iFI;
      end;
      return null;                
    elif(fld == SP_AOOBJNAME)
      return GetFldParm(SP_AOOBJCODE);      
    elif(fld == SP_REP_PREPARED)
      return RepParm.rep_prepared;   
    elif(fld == SP_REP_SENT)
      return RepParm.rep_sent;       
    elif(fld == SP_REP_DUP)
      return RepParm.IsDup;       
    elif(fld == SP_REP_ORIGIN)
      return RepParm.IsOrigin;      
    elif(fld == SP_REP_DRAFTSTATUS)
      return RepParm.DraftStatus;
    elif(fld == SP_IOOBJTYPE)
      return RepParm.IOObjType;     
    elif(fld == SP_IOOBJCODE)
      if(RepParm.IOObjType == DPINF_DACCOUNT)
        return RepParm.IOObjCode;
      else
        return RepParm.IOObjID;
      end;           
    elif(fld == SP_TYPEREPFI)
      return RepParm.iTypeRepFi;     
    elif(fld == SP_TYPEREPFIREST)
      return RepParm.iTypeRepFiRest;  
    elif(fld == SP_STATUS_DOC)
      return RepParm.iStatus_doc;     
    elif(fld == SP_KIND_DOC_CODE)
      return RepParm.Kind_doc_Code;   
    elif(fld == SP_KIND_DOC_NAME)
      return RepParm.Kind_doc_Code;   
    elif(fld == SP_SENDER_DOC_CODE)
      return RepData.iSender; 
    elif(fld == SP_SENDER_DOC_NAME)
      return RepData.iSender; 
    elif(fld == SP_NUMBER_DOC_BEG)
      return RepParm.Number_doc_beg; 
    elif(fld == SP_NUMBER_DOC_END)
      return RepParm.Number_doc_end; 
    elif(fld == SP_DATE_DOC_BEG)
      return RepParm.Date_doc_beg;   
    elif(fld == SP_DATE_DOC_END)
      return RepParm.Date_doc_end;   
    elif(fld == SP_KIND_SEND_DOC)
      return RepParm.sKind_send_doc;  
    elif(fld == SP_POSTMAN_CODE)
      return RepParm.iPostman;   
    elif(fld == SP_POSTMAN_NAME)
      return RepParm.iPostman;   
    elif(fld == SP_GET_MAN_CODE)
      return RepParm.Get_man_Code;   
    elif(fld == SP_GET_MAN_NAME)
      return RepParm.Get_man_Code;    
    elif(fld == SP_CB_OPEN)
      return RepParm.StateCB_Open;      
    elif(fld == SP_CB_LOCKED)
      return RepParm.StateCB_Locked;      
    elif(fld == SP_CB_CLOSE)
      return RepParm.StateCB_Close;      
    elif(fld == SP_TOEXCEL)
      return RepParm.ToExcel;           
    elif(fld == SP_SHOW_STORAGEPLACE)
      return RepParm.ShowStoragePlace;
    elif(fld == SP_STORAGEPLACE)
      return RepParm.iStoragePlace;     
    elif(fld == SP_SHOW_STORACC)
      return RepParm.ShowStorAcc;    
    elif(fld == SP_STORACC)
      return RepParm.iStorAcc;     
    elif(fld == SP_SHOW_ISSUERTO)
      return RepParm.ShowIssuerTo;   
    elif(fld == SP_ISSUERTO)
      return RepParm.iIssuerTo;        
    elif(fld == SP_SHOW_FIIDTO)
      return RepParm.ShowFIIDto;     
    elif(fld == SP_FIIDTO)
      return RepParm.iFIIDto;          
    elif(fld == SP_GLFORM)
      return RepParm.iGlOpForm;           
    elif(fld == SP_FORM_PART1)
      return RepParm.FormPart1;      
    elif(fld == SP_FORM_PART2)
      return RepParm.FormPart2;      
    elif(fld == SP_DAY)
      return RepParm.iDay;          
    elif(fld == SP_CHAR1)
      return RepParm.Char1;           
    elif(fld == SP_CHAR2)
      return RepParm.Char2;           
    elif(fld == SP_WHATPAIMENTS)
      return RepParm.iWhatPayments;   
    elif(fld == SP_USERLOG)
      return RepParm.UserLog;         
    elif(fld == SP_ONLYLSINISIN)
      return RepParm.OnlyLSINISIN;   
    elif(fld == SP_SECURQUAL)
      return RepParm.SecurQual;       
    elif(fld == SP_EXTDOCKINDCODE)
      return RepParm.ExtDocKind;   
    elif(fld == SP_EXTDOCKINDNAME)
      return RepParm.ExtDocKind;  
    elif(fld == SP_CORRESPOND_ACC)
      return RepParm.iCorrespondAcc;  
    elif(fld == SP_CORRESPOND_PART)
      return RepParm.iCorrespondPart; 
    elif(fld == SP_RESULTBYACC)
      return RepParm.result_by_acc;    
    elif(fld == SP_RESULTBYDOCFI)
      return RepParm.result_by_docfi;   
    elif(fld == SP_INCLUDE_DEPCERT)
      return RepParm.IncludeDepCert; 
    elif(fld == SP_INCLUDE_MORTGAGE)
      return RepParm.IncludeMortgage;
    elif(fld == SP_NAMEALG1)
      return RepParm.NumberAlg1;
    elif(fld == SP_WITHAMORTIZATION)
      return RepParm.withAmortization;
    elif(fld == SP_WITHSTORAGEPLACE)
      return RepParm.withStoragePlace;
    elif(fld == SP_REPFORMATKIND)
      return RepParm.RepFormatKind;
    elif(fld == SP_COMMENT)
      return RepParm.Comment;
    end;
  end;

  //установить значение параметра
  macro SetFldParm(fld:integer, Parm)
    
    if(fld == SP_REPORT_NUM)
      RepParm.ReportNum = Parm;         
    elif(fld == SP_CODEDPRT)
      RepParm.iNumDprt = Parm;        
    elif(fld == SP_NAMEDPRT)
      RepParm.iNumDprt = Parm;         
    elif(fld == SP_REPDATE)
      RepParm.RepDate = Parm;      
    elif(fld == SP_SHOWREPDATE)
      RepParm.showRepDate = Parm;        
    elif(fld == SP_BEGINDATE)
      RepParm.BeginDate = Parm;          
    elif(fld == SP_ENDDATE)
      RepParm.EndDate = Parm;        
    elif(fld == SP_QUARTER)
      RepParm.EndDate = Parm; 
    elif(fld == SP_YEAR)               
      RepParm.EndDate = Parm;    
    elif(fld == SP_ACC_KIND)           
      RepParm.iAccKind = Parm;
    elif(fld == SP_ACC_TYPE)           
      RepParm.iAccType = Parm;
    elif(fld == SP_DEPO_ACC)
      RepParm.iDepoAcc = Parm;           
    elif(fld == SP_DEPO_PART)
      RepParm.iDepoPart = Parm;       
    elif(fld == SP_DACCOUNT)
      RepParm.DAccount = Parm;         
    elif(fld == SP_IDPLAN)
      RepParm.iPlan = Parm;           
    elif(fld == SP_NAMEPLAN)
      RepParm.iPlan = Parm;        
    elif(fld == SP_SHOWDEPONENT)
      RepParm.showDeponent = Parm;       
    elif(fld == SP_CODEDEPONENT)
      RepParm.iDeponent = Parm;       
    elif(fld == SP_NAMEDEPONENT)
      RepParm.iDeponent = Parm;       
    elif(fld == SP_CODEDOMICILIATE)
      RepParm.iDomiciliate = Parm; 
    elif(fld == SP_NAMEDOMICILIATE)
      RepParm.iDomiciliate = Parm; 
    elif(fld == SP_CODEOPERATOR)
      RepParm.iOperator = Parm;    
    elif(fld == SP_NAMEOPERATOR)
      RepParm.iOperator = Parm;    
    elif(fld == SP_CODEISSUER)
      RepParm.iIssuer = Parm;     
    elif(fld == SP_NAMEISSUER)
      RepParm.iIssuer = Parm;
    elif(fld == SP_MORTGAGEECODE)
      RepParm.iMortgagee = Parm;
    elif(fld == SP_MORTGAGEENAME)
      RepParm.iMortgagee = Parm;
    elif(fld == SP_IDOPEROPENED)
      RepParm.iOperOpened = Parm;    
    elif(fld == SP_NAMEOPEROPENED)
      RepParm.iOperOpened = Parm;   
    elif(fld == SP_IDOPERCLOSED)
      RepParm.iOperClosed = Parm;   
    elif(fld == SP_NAMEOPERCLOSED)
      RepParm.iOperClosed = Parm;  
    elif(fld == SP_CODESTATUS)
      RepParm.iStatus = Parm;      
    elif(fld == SP_FI_AVRNUM)
      RepParm.iAvrKinds = Parm;       
    elif(fld == SP_FI_AVRKIND)
      RepParm.iAvrKinds = Parm;      
    elif(fld == SP_FI_CODE)
      RepParm.iFI = Parm;       
    elif(fld == SP_ISINSECUR)
      RepParm.iFI = Parm;      
    elif(fld == SP_CODESECUR)
      RepParm.iFI = Parm;      
    elif(fld == SP_NAMESECUR)
      RepParm.iFI = Parm;
    elif(fld == SP_AMOUNTSECUR)
      RepParm.AmountSecur = Parm;
    elif(fld == SP_FI_CODE_GEN)
      RepParm.iFIGen = Parm;      
    elif(fld == SP_NAMESECUR_GEN)
      RepParm.iFIGen = Parm;  
    elif(fld == SP_NULL_OVERS)
      RepParm.null_overs =  Parm;      
    elif(fld == SP_IS_APP)
      RepParm.is_ap =  Parm;            
    elif(fld == SP_ADMOPDATE)
      RepParm.AdmopCarryDate = Parm;
    elif(fld == SP_SHOW_OPERDATE)
      RepParm.showOperDate =  Parm;      
    elif(fld == SP_ADMOPRegDATEBEGIN)
      RepParm.AdmopRegDATEbegin = Parm;
    elif(fld == SP_ADMOPRegDATEEND)
      RepParm.AdmopRegDATEend = Parm; 
    elif(fld == SP_ADMOPMASK)
      RepParm.AdmopXldMask = Parm;       
    elif(fld == SP_SFCONTRS)
      RepParm.SfContrID = Parm;        
    elif(fld == SP_SFCONTRSNAME)
      RepParm.SfContrID = Parm;     
    elif(fld == SP_COMISSCODE)
      RepParm.CommNumber = Parm;       
    elif(fld == SP_COMISSNAME)
      RepParm.CommNumber = Parm;       
    elif(fld == SP_GRDOC)
      RepParm.GrDoc = Parm;          
    elif(fld == SP_XLDBEGIN)
      RepParm.XldBegin = Parm;        
    elif(fld == SP_XLDEND)
      RepParm.XldEnd = Parm;        
    elif(fld == SP_OPCLASS)
      RepParm.OpClass = Parm;        
    elif(fld == SP_OPCLASS_INV)
      RepParm.OpClass_Inv =  Parm;     
    elif(fld == SP_OPCLASS_INF)
      RepParm.OpClass_Inf =  Parm;     
    elif(fld == SP_OPCLASS_ADM)
      RepParm.OpClass_Adm =  Parm;     
    elif(fld == SP_OPNUMKIND)
      RepParm.OpKind = Parm;       
    elif(fld == SP_OPKIND)
      RepParm.OpKind = Parm;         
    elif(fld == SP_OPNUMKIND_INV)
      RepParm.OpKindINV = Parm;       
    elif(fld == SP_OPKIND_INV)
      RepParm.OpKindINV = Parm;         
    elif(fld == SP_OPNUMKIND_INF)
      RepParm.OpKindINF = Parm;       
    elif(fld == SP_OPKIND_INF)
      RepParm.OpKindINF = Parm;         
    elif(fld == SP_OPNUMKIND_ADM)
      RepParm.OpKindADM = Parm;       
    elif(fld == SP_OPKIND_ADM)
      RepParm.OpKindADM = Parm;         
    elif(fld == SP_OPSTATUS)
      RepParm.OpStatus = Parm;        
    elif(fld == SP_OPSTATUSBEGIN)
      RepParm.OpStatusBegin = Parm;      
    elif(fld == SP_OPSTATUSEND)        
      RepParm.OpStatusEnd = Parm;      
    elif(fld == SP_SHOWOJDNUM)
      RepParm.ShowOjdNum =  Parm;         
    elif(fld == SP_OJDNUMBEGIN)        
      RepParm.OjdNumBegin = Parm;
    elif(fld == SP_OJDNUMEND)
      RepParm.OjdNumEnd = Parm;      
    elif(fld == SP_PARTY)
      RepParm.iParty = Parm;            
    elif(fld == SP_CERTIF)
      RepParm.InvCardID = Parm;          
    elif(fld == SP_SHOW_PARTY)
      RepParm.ShowParty =  Parm;      
    elif(fld == SP_SHOW_DEPOACC)
      RepParm.ShowDepoAcc =  Parm;       
    elif(fld == SP_SHOW_DEPOPART)
      RepParm.ShowDepoPart =  Parm;    
    elif(fld == SP_SHOW_ISSIUER)
      RepParm.ShowIssuer =  Parm;     
    elif(fld == SP_PAWN)
      RepParm.showPawn =  Parm;     
    elif(fld == SP_SHOW_AVRKINDS)
      RepParm.ShowAvrKinds =  Parm;    
    elif(fld == SP_SHOW_FI)
      RepParm.ShowFI =  Parm;          
    elif(fld == SP_SHOW_FACEACC)
      RepParm.ShowFaceAcc =  Parm;     
    elif(fld == SP_SHOW_CERT_FIELD)
      RepParm.ShowCertFld =  Parm; 
    elif(fld == SP_SHOW_SECURQUAL)
      RepParm.ShowSecurQual =  Parm;  
    elif(fld == SP_DISP_PART)
      RepParm.disp_part =  Parm;       
    elif(fld == SP_pDEPONENTNAME)
      RepParm.printDeponentName =  Parm;     
    elif(fld == SP_pDEPONENTIURISD)
      RepParm.printDeponentIURISD =  Parm;    
    elif(fld == SP_pOPERATORNAME)
      RepParm.printOperatorName =  Parm;     
    elif(fld == SP_pOPERATORIURISD)
      RepParm.printOperatorIURISD =  Parm;    
    elif(fld == SP_STATUSOPEN_ACC)
      RepParm.StatusOpen_ACC =  Parm;  
    elif(fld == SP_STATUSLOCKED_ACC)
      RepParm.StatusLocked_ACC =  Parm;
    elif(fld == SP_STATUSCLOSE_ACC)
      RepParm.StatusClose_ACC =  Parm; 
    elif(fld == SP_STATUSOPEN_PAR)
      RepParm.StatusOpen_PAR =  Parm;  
    elif(fld == SP_STATUSLOCKED_PAR)
      RepParm.StatusLocked_PAR =  Parm; 
    elif(fld == SP_STATUSCLOSE_PAR)
      RepParm.StatusClose_PAR =  Parm; 
    elif(fld == SP_SHOW_ACTIVE)
      RepParm.showActiveAccount =  Parm;  
    elif(fld == SP_SHOW_PASSIVE)
      RepParm.showPassiveAccount =  Parm;    
    elif(fld == SP_AVRGROUP_SHARE)
      RepParm.avrgroupShare =  Parm;   
    elif(fld == SP_AVRGROUP_BOND)
      RepParm.avrgroupBond =  Parm;   
    elif(fld == SP_AVRGROUP_INVSHARE)
      RepParm.avrgroupInvest =  Parm;
    elif(fld == SP_AVRGROUP_NOTEMISS)
      RepParm.avrgroupNotEmiss =  Parm;
    elif(fld == SP_INVSHARE_POINT)
      RepParm.InvPoint = Parm;  
    elif(fld == SP_ISSUER_RESIDENT)
      RepParm.IssuerResident =  Parm;  
    elif(fld == SP_ISSUER_NOTRESIDENT) 
      RepParm.IssuerNotResident =  Parm;
    elif(fld == SP_INCLUDE_IN_REPORT)
      RepParm.IncludeInReport =  Parm;
    elif(fld == SP_FLAG_ALLFINNSTR)
      RepParm.ShowAllFininstr =  Parm; 
    elif(fld == SP_ACC_OPENSTATE)
      RepParm.ShowAccountOpenState =  Parm;   
    elif(fld == SP_ACC_CLOSESTATE)
      RepParm.ShowAccountCloseState =  Parm;  
    elif(fld == SP_GROUP_BY_AVOIR)
      RepParm.group_by_avoir =  Parm;  
    elif(fld == SP_SPLIT_PARTYGROUP)
      RepParm.split_partygroup =  Parm;
    elif(fld == SP_SHOW_GROUP_TOTAL)
      RepParm.show_group_total =  Parm;
    elif(fld == SP_SHOW_LIST_TOTAL)
      RepParm.show_list_total =  Parm; 
    elif(fld == SP_COUNT_RECORD)
      RepParm.count_record =  Parm;   
    elif(fld == SP_AOOPTYPECODE)
      RepParm.OpKind = Parm;   
    elif(fld == SP_AOOPKINDNAME)
      RepParm.AOOpKind = Parm;   
    elif(fld == SP_AOOPKINDCODE)
      RepParm.AOOpKind = Parm;    
    elif(fld == SP_AOOBJTYPE)
      RepParm.AOObjType = Parm;      
    elif(fld == SP_AOOBJCODE)
      if(RepParm.AOObjType == AOOT_DEPOACC)
        RepParm.iDepoAcc = Parm;
      elif(RepParm.AOObjType == AOOT_DEPOPART)
        RepParm.iDepoPart = Parm;
      elif(RepParm.AOObjType == AOOT_ACCOUNT)
        RepParm.DAccount = Parm;
      elif(RepParm.AOObjType == AOOT_PARTY)
        RepParm.iParty = Parm;
      elif(RepParm.AOObjType == AOOT_FIID)
        RepParm.iFI = Parm;
      end;
    elif(fld == SP_AOOBJNAME)
      SetFldParm(SP_AOOBJCODE, Parm);      
    elif(fld == SP_REP_PREPARED)
      RepParm.rep_prepared =  Parm;   
    elif(fld == SP_REP_SENT)
      RepParm.rep_sent =  Parm;       
    elif(fld == SP_REP_DUP)
      RepParm.IsDup =  Parm;       
    elif(fld == SP_REP_ORIGIN)
      RepParm.IsOrigin =  Parm;      
    elif(fld == SP_REP_DRAFTSTATUS)
      RepParm.DraftStatus = Parm;
    elif(fld == SP_IOOBJTYPE)
      RepParm.IOObjType = Parm;     
    elif(fld == SP_IOOBJCODE)
      if(RepParm.IOObjType == DPINF_DACCOUNT)
        RepParm.IOObjCode = Parm;
      else
        RepParm.IOObjID = Parm;
      end;           
    elif(fld == SP_TYPEREPFI)
      RepParm.iTypeRepFi = Parm;     
    elif(fld == SP_TYPEREPFIREST)
      RepParm.iTypeRepFiRest = Parm;  
    elif(fld == SP_STATUS_DOC)
      RepParm.iStatus_doc = Parm;     
    elif(fld == SP_KIND_DOC_CODE)
      RepParm.Kind_doc_Code = Parm;   
    elif(fld == SP_KIND_DOC_NAME)
      RepParm.Kind_doc_Code = Parm;   
    elif(fld == SP_SENDER_DOC_CODE)
      RepData.iSender = Parm; 
    elif(fld == SP_SENDER_DOC_NAME)
      RepData.iSender = Parm; 
    elif(fld == SP_NUMBER_DOC_BEG)
      RepParm.Number_doc_beg = Parm; 
    elif(fld == SP_NUMBER_DOC_END)
      RepParm.Number_doc_end = Parm; 
    elif(fld == SP_DATE_DOC_BEG)
      RepParm.Date_doc_beg = Parm;   
    elif(fld == SP_DATE_DOC_END)
      RepParm.Date_doc_end = Parm;   
    elif(fld == SP_KIND_SEND_DOC)
      RepParm.sKind_send_doc = Parm;  
    elif(fld == SP_POSTMAN_CODE)
      RepParm.iPostman = Parm;   
    elif(fld == SP_POSTMAN_NAME)
      RepParm.iPostman = Parm;   
    elif(fld == SP_GET_MAN_CODE)
      RepParm.Get_man_Code = Parm;   
    elif(fld == SP_GET_MAN_NAME)
      RepParm.Get_man_Code = Parm;    
    elif(fld == SP_CB_OPEN)
      RepParm.StateCB_Open =  Parm;      
    elif(fld == SP_CB_LOCKED)
      RepParm.StateCB_Locked =  Parm;      
    elif(fld == SP_CB_CLOSE)
      RepParm.StateCB_Close =  Parm;      
    elif(fld == SP_TOEXCEL)
      RepParm.ToExcel =  Parm;           
    elif(fld == SP_SHOW_STORAGEPLACE)
      RepParm.ShowStoragePlace =  Parm;
    elif(fld == SP_STORAGEPLACE)
      RepParm.iStoragePlace = Parm;     
    elif(fld == SP_SHOW_STORACC)
      RepParm.ShowStorAcc =  Parm;    
    elif(fld == SP_STORACC)
      RepParm.iStorAcc = Parm;     
    elif(fld == SP_SHOW_ISSUERTO)
      RepParm.ShowIssuerTo =  Parm;   
    elif(fld == SP_ISSUERTO)
      RepParm.iIssuerTo = Parm;        
    elif(fld == SP_SHOW_FIIDTO)
      RepParm.ShowFIIDto =  Parm;     
    elif(fld == SP_FIIDTO)
      RepParm.iFIIDto = Parm;          
    elif(fld == SP_GLFORM)
      RepParm.iGlOpForm = Parm;           
    elif(fld == SP_FORM_PART1)
      RepParm.FormPart1 =  Parm;      
    elif(fld == SP_FORM_PART2)
      RepParm.FormPart2 =  Parm;      
    elif(fld == SP_DAY)
      RepParm.iDay = Parm;          
    elif(fld == SP_CHAR1)
      RepParm.Char1 =  Parm;           
    elif(fld == SP_CHAR2)
      RepParm.Char2 =  Parm;           
    elif(fld == SP_WHATPAIMENTS)
      RepParm.iWhatPayments = Parm;   
    elif(fld == SP_USERLOG)
      RepParm.UserLog = Parm;         
    elif(fld == SP_ONLYLSINISIN)
      RepParm.OnlyLSINISIN =  Parm;   
    elif(fld == SP_SECURQUAL)
      RepParm.SecurQual = Parm;       
    elif(fld == SP_EXTDOCKINDCODE)
      RepParm.ExtDocKind = Parm;   
    elif(fld == SP_EXTDOCKINDNAME)
      RepParm.ExtDocKind = Parm;  
    elif(fld == SP_CORRESPOND_ACC)
      RepParm.iCorrespondAcc = Parm;  
    elif(fld == SP_CORRESPOND_PART)
      RepParm.iCorrespondPart = Parm; 
    elif(fld == SP_RESULTBYACC)
      RepParm.result_by_acc =  Parm;    
    elif(fld == SP_RESULTBYDOCFI)
      RepParm.result_by_docfi =  Parm;   
    elif(fld == SP_INCLUDE_DEPCERT)
      RepParm.IncludeDepCert =  Parm; 
    elif(fld == SP_INCLUDE_MORTGAGE)
      RepParm.IncludeMortgage =  Parm;
    elif(fld == SP_NAMEALG1)
      RepParm.NumberAlg1 = Parm;
    elif(fld == SP_WITHAMORTIZATION)
      RepParm.withAmortization = Parm;
    elif(fld == SP_WITHSTORAGEPLACE)
      RepParm.withStoragePlace = Parm;
    elif(fld == SP_REPFORMATKIND)
      RepParm.RepFormatKind = Parm;
    elif(fld == SP_COMMENT)
      RepParm.Comment = Parm;
    end;
  end;

  //установить подкачиваемое значение в поле
  macro SetFldData(fld:integer, Data)
    
    if(fld == SP_CODEDPRT)
      RepData.CodeDprt = Data;        
    elif(fld == SP_NAMEDPRT)
      RepData.NameDprt = Data;         
    elif(fld == SP_QUARTER)
      RepData.Quarter = Data;
    elif(fld == SP_YEAR)               
      RepData.Year = Data;    
    elif(fld == SP_ACC_KIND)           
      RepData.AccKind = Data;
    elif(fld == SP_ACC_TYPE)           
      RepData.AccType = Data;
    elif(fld == SP_DEPO_ACC)
      RepData.DepoAcc = Data;           
    elif(fld == SP_DEPO_PART)
      RepData.DepoPart = Data;       
    elif(fld == SP_NAMEPLAN)
      RepData.NamePlan = Data;        
    elif(fld == SP_CODEDEPONENT)
      RepData.CodeDeponent = Data;       
    elif(fld == SP_NAMEDEPONENT)
      RepData.NameDeponent = Data;       
    elif(fld == SP_CODEDOMICILIATE)
      RepData.CodeDomiciliate = Data; 
    elif(fld == SP_NAMEDOMICILIATE)
      RepData.NameDomiciliate = Data; 
    elif(fld == SP_CODEOPERATOR)
      RepData.CodeOperator = Data;    
    elif(fld == SP_NAMEOPERATOR)
      RepData.NameOperator = Data;    
    elif(fld == SP_CODEISSUER)
      RepData.CodeIssuer = Data;     
    elif(fld == SP_NAMEISSUER)
      RepData.NameIssuer = Data;      
    elif(fld == SP_MORTGAGEECODE)
      RepData.CodeMortgagee = Data;      
    elif(fld == SP_MORTGAGEENAME)
      RepData.NameMortgagee = Data;      
    elif(fld == SP_NAMEOPEROPENED)
      RepData.NameOperOpened = Data;  
    elif(fld == SP_NAMEOPERCLOSED)
      RepData.NameOperClosed = Data;  
    elif(fld == SP_CODESTATUS)
      RepData.CodeStatus = Data;      
    elif(fld == SP_FI_AVRKIND)
      RepData.FI_AvoirName = Data;      
    elif(fld == SP_FI_CODE)
      RepData.FI_Code = Data;       
    elif(fld == SP_ISINSECUR)
      RepData.ISINSecur = Data;      
    elif(fld == SP_CODESECUR)
      RepData.CodeSecur = Data;      
    elif(fld == SP_NAMESECUR)
      RepData.NameSecur = Data;      
    elif(fld == SP_FI_CODE_GEN)
      RepData.FI_Code_Gen = Data;      
    elif(fld == SP_NAMESECUR_GEN)
      RepData.NameSecur_Gen = Data;  
    elif(fld == SP_SFCONTRS)
      RepData.ContractNumber = Data;        
    elif(fld == SP_SFCONTRSNAME)
      RepData.ContractName = Data;     
    elif(fld == SP_COMISSCODE)
      RepData.CommCode = Data;       
    elif(fld == SP_COMISSNAME)
      RepData.CommName = Data;       
    elif(fld == SP_GRDOC)
      RepData.GrDocName = Data;          
    elif(fld == SP_OPCLASS)
      RepData.OpClassName = Data;        
    elif(fld == SP_OPKIND)
      RepData.OpKindName = Data;         
    elif(fld == SP_OPKIND_INV)
      RepData.OpKindNameInv = Data;         
    elif(fld == SP_OPKIND_INF)
      RepData.OpKindNameInf = Data;         
    elif(fld == SP_OPKIND_ADM)
      RepData.OpKindNameAdm = Data;         
    elif(fld == SP_OPSTATUS)
      RepData.OpStatusName = Data;        
    elif(fld == SP_PARTY)
      RepData.PartyName = Data;            
    elif(fld == SP_AOOPTYPECODE)
      RepData.AOOpTypeCode = Data;   
    elif(fld == SP_AOOPKINDNAME)
      RepData.AOOpKindName = Data;   
    elif(fld == SP_AOOPKINDCODE)
      RepData.AOOpKindCode = Data;    
    elif(fld == SP_AOOBJTYPE)
      RepData.AOObjType = Data;      
    elif(fld == SP_AOOBJCODE)
      RepData.AOObjCode = Data;
    elif(fld == SP_AOOBJNAME)
      RepData.AOObjName = Data;      
    elif(fld == SP_REP_DRAFTSTATUS)
      RepData.DraftStatusName = Data;
    elif(fld == SP_IOOBJTYPE)
      RepData.IOObjType = Data;     
    elif(fld == SP_TYPEREPFI)
      RepData.NameTypeRepFi = Data;     
    elif(fld == SP_TYPEREPFIREST)
      RepData.NameTypeRepFiRest = Data;  
    elif(fld == SP_STATUS_DOC)
      RepData.Status_doc_Name = Data;     
    elif(fld == SP_KIND_DOC_NAME)
      RepData.Kind_doc_Name = Data;   
    elif(fld == SP_SENDER_DOC_CODE)
      RepData.Sender_doc_Code = Data; 
    elif(fld == SP_SENDER_DOC_NAME)
      RepData.Sender_doc_Name = Data; 
    elif(fld == SP_KIND_SEND_DOC)
      RepData.Kind_send_doc = Data;  
    elif(fld == SP_POSTMAN_CODE)
      RepData.Postman_Code = Data;   
    elif(fld == SP_POSTMAN_NAME)
      RepData.Postman_Name = Data;   
    elif(fld == SP_GET_MAN_NAME)
      RepData.Get_man_Name = Data;    
    elif(fld == SP_STORAGEPLACE)
      RepData.StorageName = Data;     
    elif(fld == SP_STORACC)
      RepData.BriefCodeStorAcc = Data;     
    elif(fld == SP_ISSUERTO)
      RepData.IssuerToName = Data;        
    elif(fld == SP_FIIDTO)
      RepData.FIIDtoCode = Data;          
    elif(fld == SP_GLFORM)
      RepData.OpFormName = Data;           
    elif(fld == SP_WHATPAIMENTS)
      RepData.WhatPayments = Data;   
    elif(fld == SP_USERLOG)
      RepData.UserLogName = Data;         
    elif(fld == SP_SECURQUAL)
      RepData.SecurQualName = Data;       
    elif(fld == SP_EXTDOCKINDNAME)
      RepData.ExtDocKindName = Data;  
    elif(fld == SP_CORRESPOND_ACC)
      RepData.CorrespondAcc = Data;  
    elif(fld == SP_CORRESPOND_PART)
      RepData.CorrespondPart = Data;
    elif(fld == SP_NAMEALG1)
      RepData.NameAlg1 = Data;
    elif(fld == SP_CERTIF)
      RepData.InvCardNumber = Data;
    elif(fld == SP_REPFORMATKIND)
      RepData.RepFormatKindName = Data;
    else
      SetFldParm(fld, Data);   
    end;
  end;

  macro ClearFld(field)
    if(field == SP_NAMEALG1)
      SetFldParm(field,0);
      SetFldData(field,"");
    end;
  end;

  macro GetFieldNum(field)
    var i = 0;
    
    while((i < PanFieldNums.size()) AND (ValType(PanFieldNums[i]) != V_UNDEF))
      if(PanFieldNums[i] == field)
        return i;
      end;
      i = i + 1;
    end;

    return -1;
  end;

  //заблокировать поле
  macro DisableField(field)
    DisableFields(this.Data(), GetFieldNum(field));
  end;

  //разблокировать поле
  macro EnableField(field)
    EnableFields(this.Data(), GetFieldNum(field));
  end;


  //инициализация новой записи
  macro InitIO()
  end;

  macro ProcessNumFields(PanField, key)
    var field = PanFieldNums[PanField];
    
    if(field == SP_NAMEALG1)
      if(key == KEY_SPACE)
        ClearFld(field);
        key = 0;
      end;
    end;

    return key;
  end;

  //обработчик клавиш панеле
  macro PanProc(key, PanField, fromIO)

    if(PanField >= 0)
      key = ProcessNumFields(PanField, key);
    end;

    return key;
  end;

  //запуск отчета на выполнение
  macro ExecRep()
  end;

  //подкачка данных при входе в панель
  macro PushDataToPanel(key, PanField, fromIO)
    var field = PanFieldNums[PanField];

    if( field == SP_NAMEALG1)
      ClearFld(field);
      key = 0;
    end; 

    return key;
  end;

  //перекачка данных при выходе из панели в ИО
  macro PopDataFromPanel(key, PanField, fromIO)
    return key;
  end;

  //проверки перед сохранением
  macro Check()
    return 0;
  end;

  //старт
  macro Run(mode, PanField, key, fromIO)
    
    if(mode == DP_REP_INITNEWIO)
      InitIO();
    elif(mode == DP_REP_CRPAN)
      SetRepPanParm();
    elif(mode == DP_REP_LOOP)
      key = PanProc(key, PanField, fromIO);
    elif(mode == DP_REP_PUSH)
      key = PushDataToPanel(key, PanField, fromIO);
    elif(mode == DP_REP_POP)
      key = PopDataFromPanel(key, PanField, fromIO);
    elif(mode == DP_REP_EXEC)
      key = ExecRep();
    elif(mode == DP_REP_CHECK)
      key = Check();
    end;

    return key;
  end;

  initDL_CPanel( _PanelDic, _PanelName );
  
end;

    
    