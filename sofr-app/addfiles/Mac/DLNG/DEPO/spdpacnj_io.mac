/*
$Name: spdpacnj_io.mac
$Module: Депозитарий
$Description: Отчет Операционный журнал счета депо
*/
import "spinfrep.mac", "deposerv.mac";

private var Rep = NULL;

private class (DP_UserRep) SPdpacnj_Rep(_PanelDic, _PanelName)

  macro GetPanelFldsArr():TArray
    var PanFields = TArray();

    PanFields[0]  = SP_CODEDPRT;
    PanFields[1]  = SP_NAMEDPRT;
    PanFields[2]  = SP_pDEPONENTNAME;
    PanFields[3]  = SP_SHOWREPDATE;
    PanFields[4]  = SP_BEGINDATE;
    PanFields[5]  = SP_ENDDATE;
    PanFields[6]  = SP_pDEPONENTIURISD;
    PanFields[7]  = SP_pOPERATORNAME;
    PanFields[8]  = SP_SHOW_OPERDATE;
    PanFields[9]  = SP_OPSTATUSBEGIN;
    PanFields[10] = SP_OPSTATUSEND;
    PanFields[11] = SP_pOPERATORIURISD;
    PanFields[12] = SP_SHOWOJDNUM;
    PanFields[13] = SP_OJDNUMBEGIN;
    PanFields[14] = SP_OJDNUMEND;
    PanFields[15] = SP_SHOWDEPONENT;
    PanFields[16] = SP_CODEDEPONENT;
    PanFields[17] = SP_NAMEDEPONENT;
    PanFields[18] = SP_SHOW_DEPOACC;
    PanFields[19] = SP_DEPO_ACC;
    PanFields[20] = SP_TOEXCEL;
    PanFields[21] = SP_IS_APP;

    return PanFields;
  end;

  macro InitIO();

    IOInfopr.Flag1 = SET_CHAR;
    IOInfopr.Flag2 = SET_CHAR;
    IOInfopr.Flag3 = SET_CHAR;
    IOInfopr.Flag4 = SET_CHAR;
  end;

  macro InitPan(fromIO)

  end;

  macro PanProc(key, PanField, fromIO)
    key = this.PanProc(key, PanField, fromIO);

    return key;
  end;

  macro PushDataToPanel(key, PanField, fromIO)
    var field = PanFieldNums[PanField];

    if( field == SP_pDEPONENTNAME)
      SetFldParm( field, iif(fromIO, IOInfopr.Flag1, SET_CHAR));
      key = 0;
    elif(field == SP_pDEPONENTIURISD)
      SetFldParm( field, iif(fromIO, IOInfopr.Flag2, SET_CHAR));
      key = 0;
    elif(field == SP_pOPERATORNAME)
      SetFldParm( field, iif(fromIO, IOInfopr.Flag3, SET_CHAR));
      key = 0;
    elif(field == SP_pOPERATORIURISD)
      SetFldParm( field, iif(fromIO, IOInfopr.Flag4, SET_CHAR));
      key = 0;
    end;

    return key;
  end;

  macro PopDataFromPanel(key, PanField, fromIO)
    var field = PanFieldNums[PanField];

    if(fromIO)
      if( field == SP_pDEPONENTNAME)
        IOInfopr.Flag1 = GetFldParm(field);
        key = 0;
      elif(field == SP_pDEPONENTIURISD)
        IOInfopr.Flag2 = GetFldParm(field);
        key = 0;
      elif(field == SP_pOPERATORNAME)
        IOInfopr.Flag3 = GetFldParm(field);
        key = 0;
      elif(field == SP_pOPERATORIURISD)
        IOInfopr.Flag4 = GetFldParm(field);
        key = 0;
      end;
    end;

    return key;
  end;

  macro ExecRep()
    var stat = ExecMacroFile("spdpacnj.mac", "AcnDepoJournal", GetLogoprID(),
                                                    GetFldParm(SP_CODEDPRT),
                                                    GetFldParm(SP_DEPO_ACC),
                                                    GetFldParm(SP_CODEDEPONENT),
                                                    GetFldParm(SP_BEGINDATE),
                                                    GetFldParm(SP_ENDDATE),
                                                    GetFldParm(SP_OPSTATUSBEGIN),
                                                    GetFldParm(SP_OPSTATUSEND),
                                                    GetFldParm(SP_OJDNUMBEGIN),
                                                    GetFldParm(SP_OJDNUMEND),
                                                    iif(GetFldParm(SP_SHOWREPDATE) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_SHOW_OPERDATE) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_SHOWOJDNUM) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_SHOWDEPONENT) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_SHOW_DEPOACC) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_pDEPONENTNAME) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_pDEPONENTIURISD) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_pOPERATORNAME) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_pOPERATORIURISD) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_TOEXCEL) == SET_CHAR, true, false),
                                                    iif(GetFldParm(SP_IS_APP) == SET_CHAR, true, false) );
     Dl_CallInsertStat( IIF( GetFldParm(SP_TOEXCEL) == SET_CHAR, DL_OUTREPORT_EXCEL, DL_OUTREPORT_STD ) );
     return stat;
  end;

  initDP_UserRep( _PanelDic, _PanelName );

end;

macro ExecRepPan(mode, field, key, fromIO)
  if(ValType(Rep) == V_UNDEF)
    Rep = SPdpacnj_Rep("dp_res.lbr", "DEPOACNT");
  end;
  return Rep.Run(mode, field, key, fromIO);
end;

