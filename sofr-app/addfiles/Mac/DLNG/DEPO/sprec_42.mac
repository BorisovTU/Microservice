/*                                                          */ 
/* операция "Прием документарных ц/б на хранение"           */
/*          "Снятие документарных ц/б с хранения"           */
/* шаг      "Подтверждение операции"                        */
/*                                                          */
import OprInter, PTInter, InsCarryDoc, PaymInter, opr_depo;

/* Буферы ПД, заполняемые из операции */
record Pm_paym( pmpaym );    /*основной платеж*/
record Pm_prop_deb( pmprop ); /*св-ва платежа банка-плательщика*/
record Pm_prop( pmprop );    /*св-ва платежа*/
record Pm_rmprop( pmrmprop ); /*платеж по ценным бумагам*/


macro ExecuteStep( d, spdraft )
  var err = 0;
  var KindOperation = 0;
  record r_spdraft( spdraft );
  var OprStatus = 0, StatusKind = 0;

  SetBuff( r_spdraft, spdraft );

  err = ExecConfirmSpdraft(r_spdraft, Pm_paym);

  if(not err)
    if(r_spdraft.Kind == SP_DEPOPER_RECORDER)
      StatusKind = DP_OPERSTATUS_RECORD_DO;
    else
      StatusKind = DP_OPERSTATUS_WRITEOFF_DO;
    end;

    OprStatus = DP_OPERSTATUS_SPDRAFT_DO_ACCCARRY; //Отражение по счетам

    if( not InsertOprStatus( StatusKind, OprStatus) ) 
       msgbox( "Ошибка при установке статуса <Документооборот> операции" );
       err = 1;
    end;
  end;

  return err;
end;
