/*                                           */ 
/* макрос шага обработки отказа в исполнении */
/* Chernov Anton 14-01-04                    */

import InsCarryDoc, OprInter, PaymInter, "dlcarry.inc", opr_depo, "spinfop.mac";

record Pm_paym( pmpaym );     /*основной платеж*/
record Pm_prop_deb( pmprop ); /*св-ва платежа банка-плательщика*/
record Pm_prop( pmprop );     /*св-ва платежа*/
record Pm_rmprop( pmprop );   /*св-ва платежа*/

file depoacnt("depoacnt");
const DLDOC_INSDPDRAFT_REJ = 860;

macro ExecuteStep( d, spdr ) 
  var stat = 0, rej_prm;
  record spdraft( spdraft );

  SetBuff(spdraft, spdr);

  rej_prm = GetGlobalParameter(DPRejectParm, true);
  if( rej_prm != NULL )
    stat = RejectDepoDraft(rej_prm, DLDOC_INSDPDRAFT_REJ);
  else
    stat = 1;
  end;
  if( stat )
    msgbox("Не удалось получить параметры отказа от исполнения.|Попробуйте откатить предыдущий шаг.");
  end;

  return stat;
end;
