/************************************************************************/
/*         Автоматизированная банковская система RS-Bank 6.0            */
/*                 Copyright (c) R-Style Software Lab 2005              */
/*                                                                      */
/*  Имя файла        : dpgl_10.mac                                      */
/*  Описание         : Глобальные операции депозитария                  */
/*                     шаг      "Настроек операции"                     */
/*  Программист      : Nikonorov Evgeny                                 */
/*  Создан           : 05.07.2005                                       */
/************************************************************************/
import InsCarryDoc, PaymInter, OprInter, opr_depo;

/* Буферы ГЛ, заполняемые из операции */
record corpop( dpcorpop ); /*собственно поручение*/
record regstr( dpregstr ); /*реестр*/

macro executeParamStep( KindOper, KindDoc, FDoc )
  var err = 0;
  Array Text;
  Array Button;
  Button(1) = "Провести текущей";
  Button(2) = "Прервать выполнение";
  var but, ind = 0;
  if( {curdate} < corpop.ValueDate )
     DefineOprDate( DATE_FIRST, {curdate} );
  else
     DefineOprDate( DATE_FIRST, corpop.ValueDate );
  end;

  DefineOprDate( DATE_VALUE, corpop.ValueDate );

  if( corpop.OperState == DP_INVSTATUSORDER_REJECT )
    if( not InsertOprStatus( GetGlobopOprState(corpop.DocKind), DEPOGLOBOP_STATEVALUE_REPORT) )
       msgbox("Невозможно изменить статус операции");
       err = 1;
    end;
  else
    if( not InsertOprStatus( GetGlobopOprState(corpop.DocKind), DEPOGLOBOP_STATEVALUE_OPENPART) )
       msgbox("Невозможно изменить статус операции");
       err = 1;
    end;
  end;
   
  return err;
end;