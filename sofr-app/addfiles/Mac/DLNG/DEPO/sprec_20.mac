/*                                                          */ 
/* операция "Прием документарных ц/б на хранение"           */
/* шаг      "Экспертиза"                                    */
/*                                                          */
import InsCarryDoc, OprInter, PaymInter, "dlcarry.inc", opr_depo;

/* Буферы ПД, заполняемые из операции */
record Pm_paym( pmpaym );    /*основной платеж*/
record Pm_prop_deb( pmprop ); /*св-ва платежа банка-плательщика*/
record Pm_prop( pmprop );    /*св-ва платежа*/
record Pm_rmprop( pmrmprop ); /*платеж по ценным бумагам*/


/* Результаты экспертизы  */
const ExamStateAccept = 1; /* Принять */
const ExamStateReject = 2; /* Отказать */

macro ExecuteStep( d, spdraft )
  var err = 0;
  record r_spdraft( spdraft );
  var OprStatus = 0;

  SetBuff( r_spdraft, spdraft );

  if( r_spdraft.ExamState == ExamStateAccept )
    OprStatus = DP_OPERSTATUS_SPDRAFT_DO_DEPOPART;
  elif( r_spdraft.ExamState == ExamStateReject )
    OprStatus = DP_OPERSTATUS_SPDRAFT_DO_CRREP;
  else
    msgbox( "Неизвестные результаты экспертизы" );
    err = 1;
  end;

  if( (not err) and (OprStatus) and (not InsertOprStatus( DP_OPERSTATUS_RECORD_DO, OprStatus)) ) 
     msgbox( "Ошибка при установке статуса <Документооборот> операции" );
     err = 1;
  end;

  return err;
end;
