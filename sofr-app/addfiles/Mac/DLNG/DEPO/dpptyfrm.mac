/*
$Name:         dpptyfrm.mac
$Module:       Депозитарий
$Description:  Отчет "Анкета субъекта"
*/

import PTInter, FIInter, CurrInter, CTInter, dprepsec, "adress.mac", "pt_lib.mac";
import RsbDataSet;

const физическое_лицо = 2;
const юридическое_лицо= 1;
const ГНИрег  = REGPT_TAXINSTITUTE;
const ОРЦБрег = OBJKDOC_LICEN_DEPOSITARY;
const ДЕПОрег = -27;

private var _LogoprID, _RepDate;

file party("party");
file NameAlg("namealg");
file persn("persn") key 0;
file country("country","rsrfdb.def") key 2;
file paper("paprkind") key 0;
file depoacnt("depoacnt");
file BankRec("party");
file bankdprt("bankdprt");
file PartCode("partcode");
file depoadmo("depoadmo");
file spground("spground");
file partyown("partyown") key 1;
var officer = TBFile("officer");
file pOFFICE("persn");
var partyreg = TBFile("objrgdoc");
var dk_reg = TBFile("objkdoc");
record persnidc("persnidc");
record pt("party");
record pty("party");
record RecordAdress ( adress );
var AttrBuff = TRecHandler("objattr.dbt");
var HeadTable = "┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐\n"+
                "│                                                                                                                                            │\n"+
                "├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤";

var tablewidth = Index(HeadTable, "\n");
var Rep = CMakeReport(HeadTable);
var _IsApp;
const RepFontStyleTitel =  "ex_FS(b)";

/*Внутренний интерфейс в Namealg.dbt*/
macro __NameAlg(Type, Number)
  NameAlg.iTypeAlg = Type;
  NameAlg.iNumberAlg = Number;
  if( GetEQ(NameAlg) )
    return NameAlg.szNameAlg;
  end;
  return " Не определен ";
end;
/******************************************************************************/
macro NotX(XChar)
  if(XChar == SET_CHAR)
     return " ";
  end;
  return "X";
end;
/******************************************************************************/
macro CheckX(kindsStr, kindCh)
  if(Index(kindsStr, kindCh))
    return "X";
  end;
  return " ";
end;
/******************************************************************************/
macro isBank(PartyID)
  partyown.partykind = PTK_BANK; /*party_kind_client;*/
  partyown.partyid = PartyID;
  if(GetEQ(partyown))
     return "X";
  end;
  return " ";
end;
/******************************************************************************/
/*Название региона*/
macro Регион(Region, FLAG_LEGAL_POST)
   file ptregion("ptregion");
   ClearRecord(RecordAdress);
   if(FLAG_LEGAL_POST == PTADDR_LEGAL)
      НайтиЮридическийАдресСубъекта(party.PartyID,RecordAdress);
   else
      НайтиПочтовыйАдресСубъекта(party.PartyID,RecordAdress);
   end;
   ptregion.CodeRegion = Region;
   if(getEQ(ptregion))
      return ptregion.NameRegion;
   end;

   return "";
end;
/******************************************************************************/
/*Название страны*/
macro Страна(_Country, FLAG_LEGAL_POST)
   file country("country") key 2;
   ClearRecord(RecordAdress);
   if(FLAG_LEGAL_POST == PTADDR_LEGAL)
      НайтиЮридическийАдресСубъекта(party.PartyID,RecordAdress);
   else
      НайтиПочтовыйАдресСубъекта(party.PartyID,RecordAdress);
   end;
   country.CodeLat3 = _Country;
   if(getGE(country) and (country.CodeLat3 == _Country))
      return country.Name;
   end;

   return "";
end;
/******************************************************************************/
macro КодТО(code, FLAG_LEGAL_POST)
   file admterr("admterr");
   ClearRecord(RecordAdress);
   if(FLAG_LEGAL_POST == PTADDR_LEGAL)
      НайтиЮридическийАдресСубъекта(party.PartyID,RecordAdress);
   else
      НайтиПочтовыйАдресСубъекта(party.PartyID,RecordAdress);
   end;
   admterr.NumberPlace = code;
   if(getEQ(admterr))
      return admterr.Place;
   end;

   return "";
end;
/******************************************************************************/
macro место_регистрации(party, FLAG_LEGAL_POST, person)
   var Adress = "-";
   ClearRecord(RecordAdress);
   if(FLAG_LEGAL_POST == PTADDR_LEGAL)
      НайтиЮридическийАдресСубъекта(party.PartyID,RecordAdress);
   else
      НайтиПочтовыйАдресСубъекта(party.PartyID,RecordAdress);
   end;

   if( RecordAdress.Country > 0 )
     if(person == физическое_лицо)
        Adress = RecordAdress.PostIndex + " " + Страна(RecordAdress.Country, FLAG_LEGAL_POST);
     else
        Adress = Страна(RecordAdress.Country, FLAG_LEGAL_POST);
     end;
   else
     if( RecordAdress.PostIndex != "" )
        Adress = RecordAdress.PostIndex;
     end;
   end;

   if (RecordAdress.Province != "")
      Adress = Adress + " " + КодТО(RecordAdress.CodeProvince, FLAG_LEGAL_POST)
                      + " " + RecordAdress.Province;
   else
      Adress = Adress + " " + Регион(RecordAdress.Region, FLAG_LEGAL_POST);
   end;

   if (RecordAdress.District != "")
      Adress = Adress + " " + КодТО(RecordAdress.CodeDistrict, FLAG_LEGAL_POST)
                      + " " + RecordAdress.District;
   end;

   if (RecordAdress.Place != "")
      Adress = Adress + " " + КодТО(RecordAdress.CodePlace, FLAG_LEGAL_POST)
                      + " " + RecordAdress.Place;
   end;

   if (RecordAdress.Street != "")
      Adress = Adress + " " + "ул." + " " + RecordAdress.Street;
   end;

   if (RecordAdress.House != "")
      Adress = Adress + " " + "дом" + " " + RecordAdress.House;
   end;

   if (RecordAdress.NumCorps != "")
      Adress = Adress + " " + "корп." + " " + RecordAdress.NumCorps;
   end;

   if (RecordAdress.Flat != "")
      Adress = Adress + " " + "кв." + " " + RecordAdress.Flat;
   end;

   return Adress;
end;
/******************************************************************************/
macro доп_адрес(PartyID, Type)
  ClearRecord(adress);
  adress.PartyID = PartyID;
  adress.Type    = Type;
  if(getEQ(adress))
     return adress.Adress;
  end;
  return "";
end;

/******************************************************************************/
macro доп_адрес_индекс(PartyID, Type)
  adress.PartyID = PartyID;
  adress.Type    = Type;
  if(getEQ(adress))
     return adress.PostIndex;
  end;
  return "";
end;

/******************************************************************************/

class PartysDepoacnt(NumDprt, iDeponent, iDepoAcc)
  var __iDeponent = iDeponent;
  var __iDepoAcc  = iDepoAcc;
  var DepoAcount = TBFile("depoacnt", NULL, 3);
  var Depoc = TBFile("depoac");
  var acGround = TBFile("spground");
  var acAdmo = TBFile("depoadmo");
  var llvl = TBFile("llvalues");
  var contin,
      DepoNum,
      DepoName,
      OpenDate,
      DepoType,
      Ground,
      GroundNum;
  var _NumDprt = NumDprt;
  macro SetFld()
     DepoNum = DepoAcount.rec.BriefCode;
     DepoName = DepoAcount.rec.Name;
     OpenDate = DepoAcount.rec.OpenDate;
     Depoc.rec.ID = DepoAcount.rec.Type;
     if(not depoc.GetEQ)
       DepoType = "";
     end;
     DepoType = depoc.rec.ShortName;

     Ground    = "-";
     GroundNum = "-";

     acAdmo.rec.AdmoprID = DepoAcount.rec.OpNum;
     if(GetEQ(acAdmo))
       acGround.rec.SPgroundID = acAdmo.rec.Ground;
       if(GetEQ(acGround))
         llvl.rec.List    = 1050;
         llvl.rec.Element = acGround.rec.Kind;
         if (GetEQ(llvl))
           Ground = llvl.rec.Name;
         else
           Ground = "";
         end;
         GroundNum = acGround.rec.Xld;
       end;
     end;
  end;
  macro FirstAcc()
     if(__iDepoAcc != 0)
        DepoAcount.AddFilter(" t_AutoKey = " + __iDepoAcc);
     else
        DepoAcount.AddFilter(" t_Owner = " + __iDeponent + " and t_Superior = 0 and t_Department = " + _NumDprt);
     end;
     while(DepoAcount.next())
         SetFld();
         return true;
     end;
     return false;
  end;

  macro NextAcc()
     while(DepoAcount.Next())
         SetFld();
         return true;
     end;
     return false;
  end;
end;

class OffPerson(PartyID)
   var __PartyID = PartyID;
   var FIO = "", Post = "", Tell = "";

   macro PostFIO()
       Post = officer.rec.Post;
       pOFFICE.PersonID = officer.rec.PersonID;
       if(GetEQ(pOFFICE))
          FIO = pOFFICE.Name1+" "+pOFFICE.Name2+" "+pOFFICE.Name3;
       else
          FIO = "";
       end;
       if( ПолучитьСубъекта(officer.rec.PersonID, pt) )
          ClearRecord(RecordAdress);
          НайтиЮридическийАдресСубъекта(pt.PartyID,RecordAdress);
          FindAdressContactValue(pt.PartyID, PTADDR_LEGAL, CNTADR_PHONENUMBER, Tell);
       end;
   end;

   macro Find(num)
      var cont;
      if(num == 1)
         KeyNum ( officer, 1);
         officer.AddFilter(" t_PartyID = " + __PartyID + " and t_IsFirstPerson = 'X'");
         if(officer.Next())
            PostFIO();
            return true;
         end;
      elif(num == 2)
         KeyNum ( officer, 2);
         officer.AddFilter(" t_PartyID = " + __PartyID + " and t_IsSecondPerson = 'X'");
         if(officer.Next())
            PostFIO();
            return true;
         end;
      elif(num == 3)
         KeyNum ( officer, 0);
         officer.AddFilter(" t_PartyID =  " +__PartyID
                           + " and t_IsFirstPerson != 'X' "
                           + " and t_IsSecondPerson != 'X' ");
         while( officer.next() )
               PostFIO();
               return true;
         end;
      end;
      Post = "";
      FIO  = "";
      return false;
   end;
end;

macro ПолучитьДанныеДляСвязи(PartyID, ТипЛица);

   var Attr = TARRAY;
   Attr[0] = "";
   Attr[1] = "";
   Attr[2] = "";
   Attr[3] = "";
   Attr[4] = "";

   if(ТипЛица == юридическое_лицо)
     FindAdressContactValue(PartyID, PTADDR_LEGAL, CNTADR_PHONENUMBER,  Attr[0]);
     FindAdressContactValue(PartyID, PTADDR_LEGAL, CNTADR_PHONENUMBER2, Attr[1]);
     FindAdressContactValue(PartyID, PTADDR_LEGAL, CNTADR_FAX,          Attr[2]);
     FindAdressContactValue(PartyID, PTADDR_LEGAL, CNTADR_E_MAIL,       Attr[3]);
     FindAdressContactValue(PartyID, PTADDR_LEGAL, CNTADR_TELEXNUMBER,  Attr[4]);
   end;
   //если какие-то данные отсутствуют в юридическом адресе, то берем их из почтового адреса
   if( Attr[0] == "")
     FindAdressContactValue(PartyID, PTADDR_POST, CNTADR_PHONENUMBER,  Attr[0]);
   end;
   if( Attr[1] == "")
     FindAdressContactValue(PartyID, PTADDR_POST, CNTADR_PHONENUMBER2, Attr[1]);
   end;
   if( Attr[2] == "")
     FindAdressContactValue(PartyID, PTADDR_POST, CNTADR_FAX,          Attr[2]);
   end;
   if( Attr[3] == "")
     FindAdressContactValue(PartyID, PTADDR_POST, CNTADR_E_MAIL,       Attr[3]);
   end;
   if( Attr[4] == "")
     FindAdressContactValue(PartyID, PTADDR_POST, CNTADR_TELEXNUMBER,  Attr[4]);
   end;
   //если какие-то данные отсутствуют в почтовом адресе, то берем их из фактического адреса
   if( Attr[0] == "")
     FindAdressContactValue(PartyID, PTADDR_REAL, CNTADR_PHONENUMBER,  Attr[0]);
   end;
   if( Attr[1] == "")
     FindAdressContactValue(PartyID, PTADDR_REAL, CNTADR_PHONENUMBER2, Attr[1]);
   end;
   if( Attr[2] == "")
     FindAdressContactValue(PartyID, PTADDR_REAL, CNTADR_FAX,          Attr[2]);
   end;
   if( Attr[3] == "")
     FindAdressContactValue(PartyID, PTADDR_REAL, CNTADR_E_MAIL,       Attr[3]);
   end;
   if( Attr[4] == "")
     FindAdressContactValue(PartyID, PTADDR_REAL, CNTADR_TELEXNUMBER,  Attr[4]);
   end;

   return Attr;
end;

macro ПечататьСпособыДоставки(tmpstr)
  var width1 = 16,
      width2 = 16,
      width3 = 18,
      width4 = 16,
      width5 = 19;


  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"E") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - Лично", width1, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"T") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - По телексу", width2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"F") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - По факсу", width3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"M")+ "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - По эл.почте", width4, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"N")+ "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - По эл.сети", width5, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"P")+ "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - Почтой", width1, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"C") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - С курьером", width2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"S") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - Фельд. Связью", width3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"A") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - Через а/я", width4, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"O")+ "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - Через дов. лицо", width5, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"W") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - Web-сайт", width1, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"L") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - ПО ЛУЧ", width2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"D") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - НРДирект", width3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"I")+ "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - QUIK", width4, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"K")+ "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - Кондор+", width5, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
end;

/******************************************************************************/
macro АнкетаФизЛица(NumDprt, Deponent,DepoAcc, RepDate)

  var err1:integer, tmpstr;
  var Name_Country = "", passp_str, BICBankRec = "";
  var AttrID = "", CodeOKONH = "", NumL = "";
  var DAcc = PartysDepoacnt(NumDprt, Deponent, DepoAcc);
  var settacc;
  var query;
  var subj;
  var BankName = "", CorrAcc = "", BankCorrName = "", BankCode = "", Account = "";
  var PhoneNumber  = "",
      PhoneNumber2 = "",
      Fax      = "",
      E_Mail     = "",
      TelexNumber  = "";
  var АтрибФиз  = TARRAY;

  persn.PersonID = Deponent;
  if(not GetEQ(persn))
    MsgBox("Не найдена запись о физ. лице в <PERSN.DBT>");
    return 1;
  end;

  ClearRecord(RecordAdress);
  НайтиАдресСубъекта(party.PartyID,PTADDR_POST,RecordAdress);

  country.CodeLat3 = RecordAdress.Country;
  if( getEQ(country) )
    Name_Country = trim(country.Name);
  end;

  GetPersonIdc(persn.PersonID, persnidc);
  paper.PaperKind = persnidc.PaperKind;
  if( getEQ(paper) )
    passp_str = paper.Name + ", ";
  end;
  passp_str = passp_str + "серия: " + persnidc.PaperSeries + " №: " + persnidc.PaperNumber +
              " выдан: " + date_as_string(1,persnidc.PaperIssuedDate) +
              " " + persnidc.PaperIssuer;

/*Адм. операция и основание
  depoadmo.AdmoprID = AdmoprID;
  if(GetEQ(depoadmo))
    spground.SPgroundID = depoadmo.Ground;
    if(not GetEQ(spground))
      MsgBox("Не найдено основание административной операции.");
      return 1;
    end;
  else
    MsgBox("Не найдена указанная в отчете административная операция.");
    return 1;
  end;
*/

  /*Счет депо и банк субъекта*/
  ClearRecord(depoacnt);
  ClearRecord(BankRec);
  ClearRecord(bankdprt);
  ClearRecord(pt);

  depoacnt.AutoKey = DepoAcc;
  if( depoacnt.AutoKey > 0 )
    GetEQ(depoacnt);
  end;

  subj = deponent;

  query =   " select sett.* from dsettacc_dbt sett, dpmautoac_dbt pm "
            + " where sett.t_PartyID = " + subj
            + "   and sett.t_FIID = " + NATCUR
            + "   and sett.t_FIKind = " + FIKIND_CURRENCY
            + "   and sett.t_SettAccID = pm.t_SettAccID";
  settacc = TRsbDataSet(query);
  if( settacc.MoveNext())
    BankName = settacc.BankName;
    CorrAcc = settacc.CorrAcc;
    BankCorrName = settacc.BankCorrName;
    BankCode = settacc.BankCode;
    Account = settacc.Account;

    BankRec.PartyID = settacc.BankID;
    if(not GetEQ(BankRec))
      ClearRecord(BankRec);
    end;
    bankdprt.PartyID = settacc.BankID;
    if(GetEQ(bankdprt))
      PartCode.CodeKind = PTCK_BIC;
      PartCode.Code = bankdprt.BIC_RCC;
      if( GetEQ( PartCode )  )
        if( ПолучитьСубъекта (PartCode.PartyID, pt) != 0 )
          ClearRecord(pt);
        end;
      end;
    else
      ClearRecord(bankdprt);
    end;
    BICBankRec = ПолучитьКодСубъекта(settacc.BankID, PTCK_BIC);
  else
    //Не нашли записи с нац. валютой, возьмем первую по Order (см. SCR 49895)
    query =   " select sett.* from dsettacc_dbt sett, dpmautoac_dbt pm "
            + " where sett.t_PartyID = " + subj
            + "   and sett.t_FIKind = " + FIKIND_CURRENCY
            + "   and sett.t_SettAccID = pm.t_SettAccID "
            + " ORDER BY sett.t_Order";
    settacc = TRsbDataSet(query);
    if( settacc.MoveNext() )
      BankName = settacc.BankName;
      CorrAcc = settacc.CorrAcc;
      BankCorrName = settacc.BankCorrName;
      BankCode = settacc.BankCode;
      Account = settacc.Account;
    end;
  end;

  /* 3  - вид объекта - "Субъект" */
  /* 7  - вид категории - "Коды ОКОНХ"*/
  /* ID объекта передается в виде строки дополненной слева нулями до 10 знаков*/
  GetMainObjAttr( err1, OBJTYPE_PARTY, UniID(party, 3), 7, AttrID, NumL, CodeOKONH );
  ClearRecord(RecordAdress);
  НайтиАдресСубъекта(party.PartyID,PTADDR_POST,RecordAdress);
/*============================================================================*/
  Rep.AddEmptyStr();
  DP_AddPrintCell( Rep,  "Фамилия  ", 9, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  persn.Name1, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  Имя  ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  persn.Name2, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  Отчество  ", 12, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  persn.Name3, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Код в системе " + ПолучитьКодСубъекта(Deponent, 1), 100, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Дата рождения  ", 15, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  persn.Born, 10, 0, "l:f:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  место рождения  ", 18, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  persn.BirsPlase, 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  if(Name_Country != "")
    DP_AddPrintCell( Rep,  "Гражданство " + Name_Country, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    Rep.AddStr();
  else
    DP_AddPrintCell( Rep,  "Гражданство Российская Федерация",tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    Rep.AddStr();
  end;
  DP_AddPrintCell( Rep,  "Документ, удостоверяющий личность", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  passp_str, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  if( доп_адрес(Deponent, PTADDR_LEGAL) == "" )
     DP_AddPrintCell( Rep,  "Место регистрации/прописки", 26, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "            ", 12, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  место_регистрации(party, PTADDR_LEGAL, физическое_лицо), tablewidth-38, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     Rep.AddStr();
  else
     DP_AddPrintCell( Rep,  "Место регистрации/прописки", 26, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "            ", 12, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  доп_адрес(Deponent, PTADDR_LEGAL), tablewidth-38, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     Rep.AddStr();
  end;
  DP_AddPrintCell( Rep,  "                                      (область, город, улица, дом, корпус, квартира)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  if( доп_адрес(Deponent, PTADDR_POST) == "" )
     DP_AddPrintCell( Rep,  "Почтовый адрес", 14, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "                        ", 24, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  место_регистрации(party, PTADDR_POST, физическое_лицо), tablewidth-38, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     Rep.AddStr();
  else
     DP_AddPrintCell( Rep,  "Почтовый адрес", 14, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "                        ", 24, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  доп_адрес(Deponent, PTADDR_POST), tablewidth-38, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     Rep.AddStr();
  end;

  АтрибФиз = ПолучитьДанныеДляСвязи(party.PartyID, физическое_лицо);
  PhoneNumber  = АтрибФиз[0];
  PhoneNumber2 = АтрибФиз[1];
  Fax          = АтрибФиз[2];
  E_Mail       = АтрибФиз[3];
  TelexNumber  = АтрибФиз[4];
  DP_AddPrintCell( Rep,  "                                      (область, город, улица, дом, корпус, квартира)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  PhoneNumber, 16, 0, "c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  PhoneNumber2, 26, 0, "c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  Fax, 23, 0, "c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "   (телефон)              (телефон)                    (факс)                    ", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  E_Mail, 39, 0, "c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " ", 1, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  TelexNumber, 19, 0, "c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " ", 1, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  ПолучитьКодСубъекта(party.PartyID, PTCK_SWIFT), 20, 0, "c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "      (адрес электронной почты),              (телекс)            (SWIFT)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Банковские реквизиты", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Название банка", 14, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "     ", 5, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  BankName, 74, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Корр.счет  ", 11, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  CorrAcc, 26, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  в  ", 5, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  BankCorrName, 39, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  БИК  ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  BankCode, 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Счет   ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  Account, 26, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "   ИНН ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  ПолучитьКодСубъекта(Deponent, PTCK_INN), 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                            ОКПО    ", 36, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  party.OKPO, 18, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "          ОКОНХ   ", 18, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  CodeOKONH, 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  DP_AddPrintCell( Rep,  "Способ выплаты доходов по ценным бумагам:", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  tmpstr = depoacnt.IncomeDelivery;

  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"C") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - наличными   ", 15, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"I") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - переводом, внутр   ", 22, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"O") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " -  переводом, внеш   ", 22, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"P")+ "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " -  почтовым переводом", 22, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  DP_AddPrintCell( Rep,  "Способ доставки поручений", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  tmpstr = depoacnt.OrderDelivery;

  ПечататьСпособыДоставки(tmpstr);

  DP_AddPrintCell( Rep,  "Способ доставки информации", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  tmpstr = depoacnt.StatementDelivery;

  ПечататьСпособыДоставки(tmpstr);

  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Доверенные лица", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Фамилия     ", 12, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 17, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );               /*S56*/
  DP_AddPrintCell( Rep,  "   Имя     ", 12, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 18, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );               /*S57*/
  DP_AddPrintCell( Rep,  "   Отчество   ", 14, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );               /*S58*/
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Документ, удостоверяющий личность", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  " ", 1, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 14, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );          /*S59*/
  DP_AddPrintCell( Rep,  "  серия  ", 9, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );           /*S60*/
  DP_AddPrintCell( Rep,  " №  ", 4, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );           /*S61*/
  DP_AddPrintCell( Rep,  "  выдан  ", 9, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 9, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );           /*S62*/
  DP_AddPrintCell( Rep,  " ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );          /*S63*/
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Почтовый адрес                                   " + ""/*S64*/, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                                                               (область, город, улица, дом, корпус, комната)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "", 16, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );        /*S65*/
  DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 23, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );        /*S66*/
  DP_AddPrintCell( Rep,  "     ", 5, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 21, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );        /*S67*/
  DP_AddPrintCell( Rep,  "    ", 4, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );        /*S68*/
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "   (телефон)            (телефон)                     (факс)           ", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  Rep.AddEmptyStr();
  DP_AddPrintCell( Rep,  "Образец подписи доверенного лица", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  Rep.AddEmptyStr();
  Rep.AddEmptyStr();
  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Достоверность данных, указанных в настоящем документе подтверждаю", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Дата заполнения   " + {curdate}, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Подпись Депонента", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  Rep.AddEmptyStr();
  Rep.AddEmptyStr();
  Rep.AddEmptyStr();

  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  if(DAcc.FirstAcc)
    DP_AddPrintCell( Rep,  "Счета ДЕПО", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    Rep.AddStr();

    DP_AddPrintCell( Rep,  DAcc.DepoNum, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    DP_AddPrintCell( Rep,  DAcc.DepoName, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    DP_AddPrintCell( Rep,  DAcc.DepoType, 22, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    DP_AddPrintCell( Rep,  "  открыт  ", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    DP_AddPrintCell( Rep,  DAcc.OpenDate, 10, 0, "l:f:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    DP_AddPrintCell( Rep,  "  на основании ", 15, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    DP_AddPrintCell( Rep,  DAcc.Ground+" № "+DAcc.GroundNum, tablewidth-111, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
    Rep.AddStr();
    while(DAcc.NextAcc)
      DP_AddPrintCell( Rep,  DAcc.DepoNum, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
      DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
      DP_AddPrintCell( Rep,  DAcc.DepoName, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
      DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
      DP_AddPrintCell( Rep,  DAcc.DepoType, 22, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
      DP_AddPrintCell( Rep,  "  открыт  ", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
      DP_AddPrintCell( Rep,  DAcc.OpenDate, 10, 0, "l:f:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
      DP_AddPrintCell( Rep,  "  на основании ", 15, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
      DP_AddPrintCell( Rep,  DAcc.Ground+" № "+DAcc.GroundNum, tablewidth-111, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
      Rep.AddStr();
    end;
  end;

   return 0;
end;

/******************************************************************************/
macro АнкетаЮрЛица(NumDprt, Deponent,DepoAcc,RepDate)

  var err1:integer, tmpstr;
  var Name_Country = "", passp_str, BICBankRec = "";
  var AttrID = "", CodeOKONH = "", OrgLegForm = "", Form = "", NumL = "";
  var DAcc = PartysDepoacnt(NumDprt, Deponent, DepoAcc);
  var Sotrud = OffPerson(Deponent);
  var settacc;
  var query;
  var subj;
  var BankName = "", CorrAcc = "", BankCorrName = "", BankCode = "", Account = "";
  var АтрибЮр = TARRAY;
  var PhoneNumber  = "",
      PhoneNumber2 = "",
      Fax          = "",
      E_Mail       = "",
      TelexNumber  = "";

  ClearRecord(RecordAdress);
  НайтиЮридическийАдресСубъекта(party.PartyID,RecordAdress);

  country.CodeLat3 = RecordAdress.Country;
  if( getEQ(country) )
    Name_Country = trim(country.Name);
  end;

  GetPersonIdc(persn.PersonID, persnidc);
  paper.PaperKind = persnidc.PaperKind;
  if( getEQ(paper) )
    passp_str = paper.Name + ", ";
  end;
  passp_str = passp_str + "серия: " + persnidc.PaperSeries + " №: " + persnidc.PaperNumber +
              " выдан: " + date_as_string(1,persnidc.PaperIssuedDate) +
              " " + persnidc.PaperIssuer;
/*Адм. операция и основание
  depoadmo.AdmoprID = AdmoprID;
  if(GetEQ(depoadmo))
    spground.SPgroundID = depoadmo.Ground;
    if(not GetEQ(spground))
      MsgBox("Не найдено основание административной операции.");
      return 1;
    end;
  else
    MsgBox("Не найдена указанная в отчете административная операция.");
    return 1;
  end;
*/
  /*Счет депо и банк субъекта*/
  ClearRecord(depoacnt);
  ClearRecord(BankRec);
  ClearRecord(bankdprt);
  ClearRecord(pt);

  depoacnt.AutoKey = DepoAcc;
  if( depoacnt.AutoKey > 0 )
    GetEQ(depoacnt);
  end;

  subj = deponent;

  query =   " select sett.* from dsettacc_dbt sett, dpmautoac_dbt pm "
            + " where sett.t_PartyID = " + subj
            + "   and sett.t_FIID = " + NATCUR
            + "   and sett.t_FIKind = " + FIKIND_CURRENCY
            + "   and sett.t_SettAccID = pm.t_SettAccID";
  settacc = TRsbDataSet(query);

  if ( settacc.MoveNext() )
    BankName = settacc.BankName;
    CorrAcc = settacc.CorrAcc;
    BankCorrName = settacc.BankCorrName;
    BankCode = settacc.BankCode;
    Account = settacc.Account;
    BankRec.PartyID = settacc.BankID;
    if(not GetEQ(BankRec))
      ClearRecord(BankRec);
    end;
    bankdprt.PartyID = settacc.BankID;
    if(GetEQ(bankdprt))
      PartCode.CodeKind = PTCK_BIC;
      PartCode.Code = bankdprt.BIC_RCC;
      if( GetEQ( PartCode )  )
        if( ПолучитьСубъекта (PartCode.PartyID, pt) != 0 )
          ClearRecord(pt);
        end;
      end;
    else
      ClearRecord(bankdprt);
    end;
    BICBankRec = ПолучитьКодСубъекта(settacc.BankID, PTCK_BIC);
  else
     //Не нашли записи с нац. валютой, возьмем первую по Order (см. SCR 49895)
    query =   " select sett.* from dsettacc_dbt sett, dpmautoac_dbt pm "
            + " where sett.t_PartyID = " + subj
            + "   and sett.t_FIKind = " + FIKIND_CURRENCY
            + "   and sett.t_SettAccID = pm.t_SettAccID"
            + " ORDER BY sett.t_Order";
    settacc = TRsbDataSet(query);
    if( settacc.MoveNext() )
      BankName = settacc.BankName;
      CorrAcc = settacc.CorrAcc;
      BankCorrName = settacc.BankCorrName;
      BankCode = settacc.BankCode;
      Account = settacc.Account;
    end;
  end;
  /* 3  - вид объекта - "Субъект экономики" */
  /* 4  - вид категории - "Организационно-правовая форма"*/
  /* ID объекта передается в виде строки дополненной слева нулями до 10 знаков*/
  GetMainObjAttr( err1, OBJTYPE_PARTY, UniID(party, 3), 4, AttrID, Form, NumL );

  if( not ObjAttr_FindFirst( AttrBuff, OBJTYPE_PARTY, UniID(party, 3), 4 ) )
    OrgLegForm = AttrBuff.rec.FullName; //если есть наименование
  end;
  if( OrgLegForm == "") //если наименования нет, то берм код
     OrgLegForm = Form;
  end;
  ObjAttr_FindClose();

  /* 3  - вид объекта - "Субъект" */
  /* 7  - вид категории - "Коды ОКОНХ"*/
  /* ID объекта передается в виде строки дополненной слева нулями до 10 знаков*/
  GetMainObjAttr( err1, 3, UniID(party, 3), 7, AttrID, NumL, CodeOKONH );
  if ( ObjAttr_FindFirst( AttrBuff, OBJTYPE_PARTY, UniID(party, 3), 7 ) == 0 )
    CodeOKONH = AttrBuff.rec.NumInList;
    while ( ObjAttr_FindNext(AttrBuff) == 0 )
      CodeOKONH = CodeOKONH + ", " + AttrBuff.rec.NumInList;
    end;
  end;
  ObjAttr_FindClose();

  macro Registration(PartyID, RegKind)
     var tRegKind, continu, flag = true;
     if(RegKind == ДЕПОрег)
        tRegKind = ОРЦБрег;
     else
        tRegKind = RegKind;
     end;

     ClearRecord(partyreg);
     partyreg.AddFilter(" t_ObjectID = " + PartyID
                        + " and t_ObjectType = " + 3
                        + " and t_RegDocKind = " + tRegKind
                        + " and t_IsClosed != 'X' ");
     while( partyreg.next() )
        if( (RegKind == ДЕПОрег) and flag) /*еще одна регистрация*/
           flag = false;
           return true;
        else
           return true;
        end;
     end;

     ClearRecord(partyreg);
     return false;
  end;

  macro RegDocName(DocKindID)
     dk_reg.rec.ObjectType = 3;
     dk_reg.rec.RegDocKind = DocKindID;
     if(dk_reg.GetEQ())
       return dk_reg.rec.Name;
     end;
     return "";
  end;

  ClearRecord(RecordAdress);
  НайтиЮридическийАдресСубъекта(party.PartyID,RecordAdress);
  /*============================================================================*/
  Rep.AddEmptyStr();
  DP_AddPrintCell( Rep,  "Название  ", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  party.Name, 55, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Код в системе " + ПолучитьКодСубъекта(Deponent,1), tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Организационно-правовая форма  " + OrgLegForm, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  Registration(Deponent, ГНИрег);
  DP_AddPrintCell( Rep,  "Регистрационный номер " + partyreg.rec.Number, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Регистрационный документ ", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  " " + RegDocName(partyreg.rec.RegDocKind), 28, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "    серия ", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  partyreg.rec.Series, 8, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " номер ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  partyreg.rec.Number, 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " выдан ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  partyreg.rec.StartDate, 10, 0, "l:f:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "      (наименование)", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  Registration(Deponent, ОРЦБрег);
  DP_AddPrintCell( Rep,  "Лицензия участника", 28, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "    серия ", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  partyreg.rec.Series, 8, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " номер ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  partyreg.rec.Number, 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " выдан ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  partyreg.rec.StartDate, 10, 0, "l:f:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "      рынка ЦБ", 30, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  Registration(Deponent, ДЕПОрег);
  DP_AddPrintCell( Rep,  "Лицензия на депозитарную", 28, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "    серия ", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  partyreg.rec.Series, 8, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " номер ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  partyreg.rec.Number, 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " выдан ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  partyreg.rec.StartDate, 10, 0, "l:f:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "      деятельность", 30, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  if( доп_адрес(Deponent, PTADDR_LEGAL) == "" )
     DP_AddPrintCell( Rep,  "Юридический адрес", 17, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "   ", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  RecordAdress.PostIndex, 17, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "   ", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  место_регистрации(party, PTADDR_LEGAL, юридическое_лицо), tablewidth-40, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     Rep.AddStr();
  else
     DP_AddPrintCell( Rep,  "Юридический адрес", 17, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "   ", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  доп_адрес_индекс(Deponent, PTADDR_LEGAL), 17, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "   ", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  доп_адрес(Deponent, PTADDR_LEGAL), tablewidth-40, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     Rep.AddStr();
  end;
  DP_AddPrintCell( Rep,  "                    (индекс)            (область, город, улица, дом, корпус, комната)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  if( доп_адрес(Deponent, PTADDR_POST) == "" )
     DP_AddPrintCell( Rep,  "Почтовый    адрес", 17, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "   ", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  RecordAdress.PostIndex, 17, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "   ", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  место_регистрации(party, PTADDR_POST, юридическое_лицо), tablewidth-40, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     Rep.AddStr();
  else
     DP_AddPrintCell( Rep,  "Почтовый    адрес", 17, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "   ", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  доп_адрес_индекс(Deponent, PTADDR_POST), 17, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  "   ", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     DP_AddPrintCell( Rep,  доп_адрес(Deponent, PTADDR_POST), tablewidth-40, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
     Rep.AddStr();
  end;
  DP_AddPrintCell( Rep,  "                    (индекс)            (область, город, улица, дом, корпус, комната)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  АтрибЮр = ПолучитьДанныеДляСвязи(party.PartyID, юридическое_лицо);
  PhoneNumber  = АтрибЮр[0];
  PhoneNumber2 = АтрибЮр[1];
  Fax          = АтрибЮр[2];
  E_Mail       = АтрибЮр[3];
  TelexNumber  = АтрибЮр[4];
  DP_AddPrintCell( Rep,  PhoneNumber, 16, 0, "l:c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  PhoneNumber2, 26, 0, "l:c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  Fax, 23, 0, "l:c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "    (телефон)             (телефон)                   (факс) ", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  DP_AddPrintCell( Rep,  E_Mail, 40, 0, "l:c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " ", 1, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  TelexNumber, 25, 0, "l:c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " ", 1, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  ПолучитьКодСубъекта(party.PartyID, PTCK_SWIFT), 11, 0, "l:c:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "      (адрес электронной почты)                       (телекс)                 (SWIFT)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", 150, 0, "l:w" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Банковские реквизиты", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Название банка", 14, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "     ", 5, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  BankName, tablewidth-19, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Корр.счет  ", 11, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  CorrAcc, 26, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  в  ", 5, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  BankCorrName, 39, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  БИК  ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  BankCode, 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Счет   ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  Account, 26, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "   ИНН ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  ПолучитьКодСубъекта(Deponent, PTCK_INN), 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                            ОКПО    ", 36, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  party.OKPO, tablewidth-36, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                            ОКОНХ   ", 36, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  CodeOKONH, tablewidth-36, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", 150, 0, "l:w" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Статус юридического лица          ", 34, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + string(NotX(party.NotResident)) + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - резидент  ", 13, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + string(party.NotResident) + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - нерезидент", 13, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Категория налогоплательщика       ", 34, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + string(isBank(Deponent)) + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - банк   [ ] - ПИФ   [X] - юридическое лицо   [ ] - физ.лицо", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Способ выплаты доходов по ценным бумагам:", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  tmpstr = depoacnt.IncomeDelivery;
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"C") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - наличными   ", 15, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"I") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " - переводом, внутр   ", 22, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"O") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " -  переводом, внеш ", 21, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "[" + CheckX(tmpstr,"P") + "]", 3, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " -  почтовым переводом", 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Официальные лица оператора счета депо, уполномоченные подписывать передаточные распоряжения и другие документы для Депозитария и действующие по Уставу", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  Sotrud.Find(1);
  DP_AddPrintCell( Rep,  "                " + Sotrud.FIO, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                  (ФИО)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                " + Sotrud.Post, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                  (Должность)                                                 (образец подписи)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  Sotrud.Find(2);
  DP_AddPrintCell( Rep,  "                " + Sotrud.FIO, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                  (ФИО)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                " + Sotrud.Post, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                  (Должность)                                                 (образец подписи)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  DP_AddPrintCell( Rep,  "Официальные лица оператора счета депо, уполномоченные подписывать передаточные распоряжения и другие документы для Депозитария и действующие по доверенности", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  Sotrud.Find(3);
  DP_AddPrintCell( Rep,  "                " + Sotrud.FIO, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                  (ФИО)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                " + Sotrud.Post, tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "                  (Должность)                                                 (образец подписи)", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  DP_AddPrintCell( Rep,  " " + Sotrud.Tell, 18, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "   Доверенность №  ", 19, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  Дата ", 7, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  " Действует до ", 14, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "   (телефон)", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  Rep.AddEmptyStr();
  DP_AddPrintCell( Rep,  "Способ доставки поручений", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  tmpstr = depoacnt.OrderDelivery;

  ПечататьСпособыДоставки(tmpstr);

  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", tablewidth, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Образец печати юридического лица", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     ---------------               ---------------       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     |             |               |             |       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     |             |               |             |       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     |             |               |             |       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     |             |               |             |       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     |             |               |             |       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     |             |               |             |       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     |             |               |             |       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     |             |               |             |       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "     ---------------               ---------------       ", tablewidth, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", tablewidth, 0, "l:ж┼" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  DP_AddPrintCell( Rep,  "Способ доставки информации", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  tmpstr = depoacnt.StatementDelivery;

  ПечататьСпособыДоставки(tmpstr);

  DP_AddPrintCell( Rep,  "-------------------------------------------------------------------------------------------------------------------------", tablewidth, 0, "l:ж┼" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
  if(DAcc.FirstAcc)
  DP_AddPrintCell( Rep,  "Счета ДЕПО", 50, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();

  DP_AddPrintCell( Rep,  DAcc.DepoNum, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  DAcc.DepoName, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  DAcc.DepoType, 20, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  открыт  ", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  DAcc.OpenDate, 10, 0, "l:f:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  "  на основании ", 15, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  DP_AddPrintCell( Rep,  DAcc.Ground+" № "+DAcc.GroundNum, tablewidth-109, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
  Rep.AddStr();
    while(DAcc.NextAcc)
       DP_AddPrintCell( Rep,  DAcc.DepoNum, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
       DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
       DP_AddPrintCell( Rep,  DAcc.DepoName, 25, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
       DP_AddPrintCell( Rep,  "  ", 2, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
       DP_AddPrintCell( Rep,  DAcc.DepoType, 20, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
       DP_AddPrintCell( Rep,  "  открыт  ", 10, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
       DP_AddPrintCell( Rep,  DAcc.OpenDate, 10, 0, "l:f:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
       DP_AddPrintCell( Rep,  "  на основании ", 15, 0, "l:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
       DP_AddPrintCell( Rep,  DAcc.Ground+" № "+DAcc.GroundNum, tablewidth-109, 0, "l:w:" + RepFontStyleTitel, _IsApp, REP_ELEM_STR );
       Rep.AddStr();
    end;
  end;

   return 0;
end;
/******************************************************************************/

private macro CreateEmptyRep()

  DP_StdHeaderLO_Ex( Rep, RepFontStyleTitel, "Анкета субъекта", _LogOprID, 0, false, _RepDate );
  Rep.AddEmptyStr();
  DP_StdFooter_Ex(Rep, RepFontStyleTitel);

end;

macro party_form( LogOprID:integer,
                  Deponent:integer,
                  DepoAcc:integer,
                  RepDate:date,
                  NumDprt:integer,
                  ToExcel:bool,
                  IsApp:bool )

     DP_BeginProtocol();  //начать протоколирование - подмена MsgBox

    _LogOprID = LogOprID;
    _RepDate  = RepDate;
    _IsApp    = IsApp;

    file depoadmo("depoadmo");
    var stat:integer = 0;

    if(Deponent == -1)
      DP_EndProtocol();                 //закончить протоколирование

      MsgBox("   Необходимо указать депонента.");
      return 1;
    end;

    Dl_CallInsertStat(IIF(ToExcel, DL_OUTREPORT_EXCEL, DL_OUTREPORT_STD));

    party.PartyID = Deponent;
    if(GetEQ(party))
      if(party.LegalForm==физическое_лицо)
         DP_StdHeaderLO_Ex( Rep, RepFontStyleTitel, "Анкета физического лица", LogOprID, 0, false, RepDate, NULL, tablewidth );
         stat = АнкетаФизЛица(NumDprt, Deponent,DepoAcc,RepDate);
      else
         DP_StdHeaderLO_Ex( Rep, RepFontStyleTitel, "Анкета юридического лица", LogOprID, 0, false, RepDate, NULL, tablewidth );
         stat = АнкетаЮрЛица( NumDprt, Deponent,DepoAcc,RepDate);
      end;
      if(not stat)
         Rep.AddEmptyStr();
         DP_StdFooter_Ex(Rep, RepFontStyleTitel, NULL, NULL, tablewidth);
      end;
    else
       stat = 1;
    end;

    if(stat) //если были ошибки, очистим отчет чтобы убрать напечатанную шапку
     Rep.ClearAllStr();
    end;

    DP_AddProtocol(Rep, "protocol");  //добавим протокол к уже сформированному отчету
    DP_EndProtocol();                 //закончить протоколирование

    return DP_StdReportControl( LogOprID, (not stat), @CreateEmptyRep, 0, ToExcel, Rep, ZOOM_TYPE_A4L );
end;
