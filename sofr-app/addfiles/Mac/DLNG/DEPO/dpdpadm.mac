/*                           
$Name:             dpdpadm.mac
$Module:           Депозитарий
$Description:                
         Автоматизированная банковская система RS-Bank                
                 Copyright (c) R-Style Software Lab 2007              
                                                                      
  Описание         : Проверки адм. операций                           
  Программист      : Nikonorov Evgeny                                 
  Создан           : 29.11.2007                                       
*/

import BankInter;

record Depoadmo( depoadmo );
private record Spground( spground );

record OldDepoadmo( depoadmo );
private record OldSpground( spground );

private var AUTO_CHAR = "A";

private macro Проверить_Документ(Режим)
  
  if(Режим == 3) //редактирование операции

    //здесь должны быть проверки при редактировании административной операции

  elif(Режим == 1) //удаление
    
    //здесь должны быть проверки при удалении административной операции

  end;

  return 0;
end;

//вызывается при подтверждении операции в скроллинге 
//или автоматически, если скроллинг не показывался, но операции есть (автоматический режим)
private macro Проверить_Документ_В_Открытые()

  var dpadmopr = TBFile("dpadmopr.dbt");
  var OpVisibleInScrol = true;  //отображалась ли операция в скроллинге
  var err = 0;
  var DontShowAdmoperList;

  dpadmopr.rec.Item     = Depoadmo.Item;
  dpadmopr.rec.OperKind = Depoadmo.OperKind;
  if( (getEQ(dpadmopr)) and (dpadmopr.rec.Generate == AUTO_CHAR) )
    OpVisibleInScrol = false;
  end;
  if( OpVisibleInScrol == true)
    GetRegistryValue( "DEPO\\DONTSHOWADMOPERLIST", V_BOOL, DontShowAdmoperList, err );
    if(not err)
      if(DontShowAdmoperList) OpVisibleInScrol == false; end;
    end;
  end;    
  //здесь должны быть проверки при выполении операции

  return 0;
end;
/* Установка подсказки для скролингов из макроса */
PRIVATE MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStatus:integer, ScrolKind:integer ):string
  //  Возможные значения ScrolStatus:
  // 0,  //всегда       
  
  //  Возможные значения ScrolKind:
  // 0,   // Всегда

  //пример
  //return "/*+FIRST_ROWS LEADING(t) INDEX(t ddepoadmo_dbt_idx0)*/";

  return DefaultHint;

END;

PRIVATE MACRO Функция_Пользователя()
  MsgBox( "Выполняется макрофункция \"dpdpadm.mac\\ Функция_Пользователя\"." );
  return 0;
END;