/*                                           */ 
/* макрос шага обработки отказа в исполнении */
/* Nikonorov Evgeny 04-10-05                 */

import InsCarryDoc, OprInter, "dlcarry.inc", opr_depo, "spinfop.mac";

/* Буферы ГЛ, заполняемые из операции */
record corpop( dpcorpop );    /*поручение*/
record regstr( dpregstr ); /*реестр*/

file depoacnt("depoacnt");
const DLDOC_INSGLOBOP_REJ      = 865;

macro ExecuteStep( d, crp ) 
  var stat = 0, rej_prm;
  record corpop( dpcorpop );

  SetBuff(corpop, crp);

  rej_prm = GetGlobalParameter(DPRejectParm, true);
  if( rej_prm != NULL )
    stat = RejectDepoDraft(rej_prm, DLDOC_INSGLOBOP_REJ);
  else
    stat = 1;
  end;
  if( stat )
    msgbox("Не удалось получить параметры отказа от исполнения.|Попробуйте откатить предыдущий шаг.");
  end;

  return stat;
end;
