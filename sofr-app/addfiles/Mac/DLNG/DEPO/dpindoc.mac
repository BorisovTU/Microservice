/* ----------------------------
  é‚Á•‚ "ÇÂÆ§ÔÈ®© §Æ™„¨•≠‚"
//  File Name    : dpindoc.mac
//
//  Description  : é‚Á•‚ "ÇÂÆ§ÔÈ®© §Æ™„¨•≠‚"
//
//  Programmer   : Godina Elena
//
//  Created      : 21.04.2008
 ----------------------------*/




import RsbDataSet;
import FIInter, CurrInter, CTInter, DPInter, secinter, deposerv;



var NameAlg  = TBFile("namealg");
var llvalues = TBFile("llvalues");
var party    = TBFile("party");

                                                                                               
private var HeadTable = "⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø\n"+
                        "≥                                                                                                    ≥\n"+
                        "√ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥";
private var tablewidth = Index(HeadTable, "\n");
private var Rep = CMakeReport(HeadTable);
private const RepFontStyleTitel =  "ex_FS(b)";
private const TA_STAT_DEL = 152;

private macro __LLValues( List, Number)
  llvalues.rec.List = List;
  llvalues.rec.Element = Number;
  if(llvalues.GetEQ)
    return llvalues.rec.Name;
  end;
  return NULL;
end;

private macro Person( Oper )
  file person("person");
  person.Oper = Oper;
  if( getEQ(person) )
     return person.Name; 
  end;

  return NULL;
end;

private macro FillReport( DeliveryKind )
  file typeac("typeac");
  typeac.iNumType = TA_STAT_DEL;
  typeac.Type_Account = DeliveryKind;
  if( getEQ(typeac) )
     return typeac.Name_type; 
  end;

  return NULL;
end;

macro PrintReport(spground, ToExcel)

      RECORD   spgr(spground);
      var Doc_Name, Pers_Name, DelivKindName,DeliverName, Party_Name;

      SetBuff(spgr, spground);
      
      DP_StdHeaderLO_Ex( Rep, RepFontStyleTitel, "", 0, 0, false, null, null, tablewidth );
      Rep.AddPrintCell( "                                      á†‡•£®·‚‡®‡Æ¢†≠Æ:      "+"Ñ†‚†  " + spgr.RegistrDate+"  Ç‡•¨Ô  " + spgr.RegistrTime, tablewidth, 0, "l:" + RepFontStyleTitel, REP_ELEM_STR );
      Rep.AddStr();
      Rep.AddPrintCell( "                                      ê•£®·‚‡†Ê®Æ≠≠Î© ≠Æ¨•‡: " + spgr.XLD, tablewidth, 0, "l:" + RepFontStyleTitel, REP_ELEM_STR );
      Rep.AddStr();
      Rep.AddPrintCell( "                                      Ñ†‚† §Æ™„¨•≠‚†:        " + spgr.SignedDate, tablewidth, 0, "l:" + RepFontStyleTitel, REP_ELEM_STR );
      Rep.AddStr();
      Rep.AddEmptyStr(2);

      Doc_Name = __LLValues( 1050, spgr.Kind );
      Rep.AddPrintCell( Doc_Name + " ¸ " + spgr.AltXLD, tablewidth, 0, "c:w:" + RepFontStyleTitel, REP_ELEM_STR );
      Rep.AddStr();
      Rep.AddEmptyStr();

      if( spgr.Party > -1 )
        if( èÆ´„Á®‚Ïë„°Í•™‚†(spgr.Party, party) == 0 )
          Party_Name = party.rec.Name;
        end;
      else
        Party_Name = "";
      end;
      Rep.AddPrintCell( "     é‚Ø‡†¢®‚•´Ï:       " + Party_Name, tablewidth, 0, "l:w:" + RepFontStyleTitel, REP_ELEM_STR );
      Rep.AddStr();
      Rep.AddPrintCell( "     Ñ•©·‚¢®‚•´Ï≠Æ:     · " + spgr.BeginningDate + "  ØÆ " + spgr.TerminateDate, tablewidth, 0, "l:w:" + RepFontStyleTitel, REP_ELEM_STR );
      Rep.AddStr();
      Rep.AddEmptyStr(2);
      Rep.AddPrintCell( "  ëÆ§•‡¶†≠®• §Æ™„¨•≠‚†:", tablewidth, 0, "l:" + RepFontStyleTitel, REP_ELEM_STR);
      Rep.AddStr();
      Rep.AddEmptyStr();
      Rep.AddPrintCell( spgr.Comment, 0, 0, "l:w:" + RepFontStyleTitel, REP_ELEM_STR);
      Rep.AddStr();
      Rep.AddEmptyStr(2);

      Rep.AddPrintCell( "                  èÆ§Ø®·Ï ______________", tablewidth, 0, "l:" + RepFontStyleTitel, REP_ELEM_STR);
      Rep.AddStr();
      Rep.AddPrintCell( "                                    å.è. ", tablewidth, 0, "l:" + RepFontStyleTitel, REP_ELEM_STR);
      Rep.AddStr();
      Rep.AddEmptyStr(2);

      Pers_Name = Person( spgr.Receptionist );
      Rep.AddPrintCell( "èÆ‡„Á•≠®• †¢‚Æ‡®ßÆ¢†≠Æ: " + Pers_Name, tablewidth, 0, "l:w:" + RepFontStyleTitel, REP_ELEM_STR);
      Rep.AddStr();
      if ((spgr.DeliveryKind > 0) and (spgr.Proxy >= 0))
          èÆ´„Á®‚Ïë„°Í•™‚†(spgr.Proxy, party);
          DeliverName = party.rec.Name;
          DelivKindName = FillReport( StrFor(spgr.DeliveryKind ));
          Rep.AddPrintCell( "èÆ‡„Á•≠®• §Æ·‚†¢´•≠Æ:   " + DeliverName + " - " + DelivKindName, tablewidth, 0, "l:w:" + RepFontStyleTitel, REP_ELEM_STR);
          Rep.AddStr();
      else 
          if (spgr.Proxy >= 0)
            èÆ´„Á®‚Ïë„°Í•™‚†(spgr.Proxy, party);
            DeliverName = party.rec.Name;
            Rep.AddPrintCell( "èÆ‡„Á•≠®• §Æ·‚†¢´•≠Æ:   " + DeliverName, tablewidth, 0, "l:w:" + RepFontStyleTitel, REP_ELEM_STR);
            Rep.AddStr();
          else if (spgr.DeliveryKind > 0)
                  DelivKindName = FillReport( StrFor(spgr.DeliveryKind ));
                  Rep.AddPrintCell( "èÆ‡„Á•≠®• §Æ·‚†¢´•≠Æ:   " + DelivKindName, tablewidth, 0, "l:w:" + RepFontStyleTitel, REP_ELEM_STR);
                  Rep.AddStr();
               end;
          end;
      end;
      Rep.AddEmptyStr();

      DP_StdFooter_Ex(Rep, RepFontStyleTitel, NULL, NULL, tablewidth);
      if( ToExcel )
        Rep.PrintWinRep();
        Rep.ShowWinRep();
      else
        Rep.PrintRep();
      end;


end;
