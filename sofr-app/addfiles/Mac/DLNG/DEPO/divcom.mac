
import SfInter, OprInter, "sccomalg.mac", "sccomiss.mac";

private file   comiss( sfcomiss ); 
private record rContr( sfcontr );
private record rAlgBase( "sfcalcal.dbt" );
private record bassum("sfbassum.str");


VAR MacroError :INTEGER = 0;

MACRO CalcCommissionSum( docKind, Doc, sfalg_adr, sfcontr_adr )

  var dppmacc = TBFile("dppmacc.tmp");
  ClearRecord( bassum );
  dppmacc.AddFilter(" t_DocumentID > 0");
  if( dppmacc.next() )
    bassum.baseType  = SF_BASETYPE_SUM;
    bassum.baseType2 = SF_BASETYPE_SUM;
    bassum.baseSum   = dppmacc.rec.Amount;
    bassum.baseSum2  = dppmacc.rec.Amount;
    bassum.FIID_baseSum  = NATCUR;
    bassum.FIID_baseSum2 = NATCUR;

    if( InsertSumList( bassum ) )
      MacroError = 1;
      msgbox( "Ошибка при вставке базовой суммы." );
    end;
  end;
  dppmacc.DropFilter();  
  return;
END;

