/* -@H------------------------------------------------------------------
*            Автоматизированная банковская система RS-Bank
*                 Библиотека интерпретируемых модулей
*                  Copyright (c) JV R-Style 1993-96
*
*                  По этому тарифу начисляется плата 
*                  ведение счета депо для физ лиц
*----------------------------------------------------------------------*/
import "dps_com.inc";

macro CalcServiceSum( sfcontr_addr, BeginDate, EndDate )
    record  rContr( sfcontr );
    record  rBaseSum( "sfbassum.str" );
    file   party(party);
    file   depoacnt("depoacnt") key 1;
    var Month;

    SetBuff( rContr, sfcontr_addr );
    
    party.PartyID = rContr.PartyID;
    if(not GetEQ(party))
       MsgBox("Не найден плательщик договора обслуживания № ", sfcontr_addr.Number);
       MacroError = 1;
       return 0;
    end;

    depoacnt.Code = rContr.Object; 
    if(not GetEQ(depoacnt))
       MsgBox("Не найден счет депо ", rContr.Object);
       MacroError = 1;
       return 0;
    end;

    if(party.LegalForm==физическое_лицо)

       Month = CalcDepoacntPay(BeginDate, EndDate, depoacnt.OpenDate);
       rBaseSum.baseType    = SF_BASETYPE_QUONT;
       rBaseSum.baseType2   = SF_BASETYPE_QUONT;
       rBaseSum.baseQuont   = Month; 
       rBaseSum.baseQuont2  = Month;

       rBaseSum.BaseObjectType = OBJTYPE_DEPOACNT;
       rBaseSum.BaseObjectID   = depoacnt.AutoKey;

/*     rBaseSum.baseSum     = Month;
       rBaseSum.baseSum2    = Month;   */
       if( InsertSumList(rBaseSum) )
          MacroError = 1;
          MsgBox("Ошибка при вставке базовой суммы");
       end;
    end;
    return 0;
end;
