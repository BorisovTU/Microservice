/*                                                             */ 
/* шаг      "Создание ИК" общий для инв. операций              */
/*                                                             */
/* Alex V. Mishin  15.10.03                                    */

import OprInter, FIInter, DealsInter, InsCarryDoc, opr_depo, "dpimp.mac";

/* Буферы ПД, заполняемые из операции */
record Pm_paym( pmpaym );    /*основной платеж*/
record Pm_prop_deb( pmprop ); /*св-ва платежа банка-плательщика*/
record Pm_prop( pmprop );    /*св-ва платежа*/
record Pm_rmprop( pmrmprop ); /*платеж по ценным бумагам*/



macro ExecuteStep( d, spdraft )
  var    Xid, bstat, err = 0;
  file   fininstr(fininstr);
  record spdraft_buf("spdraft");

  SetBuff( spdraft_buf, spdraft );

  fininstr.FIID = Pm_paym.FIID;
  if( NOT GetEQ(fininstr) )
    DPError.SetErr("Не найден финансовый инструмент с ID = ", Pm_paym.FIID);
    err = 1;
  end;

  if( err )
    err = RejectDepoDraftYesNo( spdraft, DP_SPDRAFT_OPERATION );
  end;

  return err;
end;
