/*
$Name:        dvdl030.mac
$Module:      Производные инструменты
$Description: Биржевая операция c ПИ. Шаг учета в позиции
*/
import InsCarryDoc, DVInter, "dv_fun.mac", "dvoprmassexec.mac";

macro __ExecuteStep( deal )

  if( УчетБиржевыхКонтрактов() == DV_ACCEXCONTR_DEAL )
     if( deal != NULL )
        if( (deal.Type == "B") OR (deal.Type == "S") OR (deal.Type == "D") OR (deal.Type == "G") )
           if( DV_SetDealPosAcc( deal.ID ) != 0 )
              return 1;
           end;
        end;
     else
        if( DV_SaveMassDealPosAcc() != 0 )
           return 1;
        end;

        if( DV_MassSetDealPosAcc() != 0 )
           return 1;
        end;
     end;
  end;

  /* Всё остальное в триггерах */

  return 0;
end;

macro ExecuteStep( doc, FDoc )

  record deal(dvdeal);

  SetBuff(deal, FDoc);

  return __ExecuteStep(deal);
end;

macro MassExecuteStep()
  return __ExecuteStep(NULL);
end;
