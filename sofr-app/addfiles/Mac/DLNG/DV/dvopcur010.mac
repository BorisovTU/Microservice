/*
$Name:        dvopcur010.mac
$Module:      Производные инструменты
$Description: Расчеты по производным инструментам на валютном рынке/рынке СПФИ. Шаг "Открытие дня"
*/
import InsCarryDoc, "dv_categ.mac";

macro executeParamStep( kind_oper, BOf_kind, FDoc )

  record oper(dvoper);

  SetBuff(oper, FDoc);

  var FD_Oper = DVFirstDocOper(DL_DVOPER, oper);

  if( not FD_Oper.ЕстьСуммыПеревода() )
     if( MsgBoxEx( "Не заданы суммы перевода на биржу.|Продолжить?", MB_YES+MB_NO, IND_NO ) == IND_NO )
        return 1;
     end;
  end;

  if( FD_Oper.ЕстьСуммыГарантийногоОбеспечения() )
     if( not InsertOprStatus(DV_OPCUR_OPERSTATUS_KIND_GUARANTEE, DV_OPCUR_OPERSTATUS_RUN) )
        MsgBox("Ошибка при установке статуса <Гарантийное обеспечение> по операции.");
        return 1;
     end;
  else
     if( not InsertOprStatus(DV_OPCUR_OPERSTATUS_KIND_GUARANTEE, DV_OPCUR_OPERSTATUS_COMPLETE) )
        MsgBox("Ошибка при установке статуса <Гарантийное обеспечение> по операции.");
        return 1;
     end;

     if( FD_Oper.ЕстьСуммыПереводаНаКлиринговыйСчет() )
        if( not InsertOprStatus(DV_OPCUR_OPERSTATUS_KIND_CLEARING, DV_OPCUR_OPERSTATUS_RUN) )
           MsgBox("Ошибка при установке статуса <Перевод средств на клиринговый счёт> по операции.");
           return 1;
        end;
     else
        if( not InsertOprStatus(DV_OPCUR_OPERSTATUS_KIND_CLEARING, DV_OPCUR_OPERSTATUS_COMPLETE) )
           MsgBox("Ошибка при установке статуса <Перевод средств на клиринговый счёт> по операции.");
           return 1;
        end;

        if( not InsertOprStatus(DV_OPCUR_OPERSTATUS_KIND_SUM_CARRY, DV_OPCUR_OPERSTATUS_RUN) )
           MsgBox("Ошибка при установке статуса <Сводные проводки> по операции.");
           return 1;
        end;
     end;
  end;

  return 0;
end;
