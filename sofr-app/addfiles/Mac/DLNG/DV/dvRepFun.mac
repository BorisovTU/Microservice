/****************************************************************************************
 FILE         :   dvrepfun.MAC
 DESCRIPTION  :   RS-Bank, ПИ, 
 PROGRAMMED BY:   Иванов Александр И.
 CREATION DATE:   /* IAL 06 July 2005 */
*****************************************************************************************/

import rsd, "dlcnst.inc", PaymInter, CTInter, BankInter, SPInter, PTInter, FIInter,
       "adress.mac", oprinter, "Календарь", "cb_sql.mac", "or_rep_h.mac", "dlrepfun.mac", "dlreport.mac", "dlmisc.mac", "dldlngfun.mac";



/* Функция возвращает для заданной биржи ID ведущей биржи или возвращает
   свой ID, если ведущей биржи нет.
      MarketID    -  ID проверяемой биржи
      ADate       -  дата, на которую ищем ведущую биржу, если не задана,
                     то используем текущую операционную */

/* Функция возвращает код группы, в которую входит указанная биржа.
   Если у биржи есть связанный объект "Ведущая биржа", то возвращаем код этой
   биржи; если связанного объекта нет, то вовзвращаем код проверяемой биржи.
   Код группы - это строка.
      MarketID    -  ID биржи (субъекта)
      Error       -  сюда вернем код ошибки, необязательный параметр,
                     0 - успешное завершение */
private macro ПолучитьКодГруппыБиржи( MarketID, Error )
   var
      LeaderMarketID,
      GroupCode;

   LeaderMarketID = MarketID;
   GroupCode      = ПолучитьКодСубъекта( LeaderMarketID, PTCK_CONTR, Error );
   SetParm( 1, Error );

   return GroupCode;
end;

/**********************************************************************************/
/* работа с датами */
/* Возвращает возвращает строку, сформирванную из даты _Date */
/* Возвращает наименование месяца в родительном падеже по его номеру */
MACRO MakeStrDate(_Date:date)

  private macro MonNameR(_NumbMon:integer)

    var RetValue:string = ""; /* Возвращаемое значение */
    if( (_NumbMon > 0) and (_NumbMon < 13) )
         if( (_NumbMon == 3) or (_NumbMon == 8) )
             RetValue = SubStr(MonName(_NumbMon), 1, StrLen(MonName(_NumbMon))) + "а";
         else
             RetValue = SubStr(MonName(_NumbMon), 1, StrLen(MonName(_NumbMon)) - 1) + "я";
         end;
    end;
    return StrLwr(RetValue);
  end; /* MonNameR */


  VAR StrZeroD:string  = "0"; /* Строка для дней, зависящая от флага отсечения незначащих нулей. По умолчанию "0" */
  VAR StrMon  :string  = "";  /* Строка, зависящая от флага вывода месяца в виде слова */
  VAR CurDay  :integer = 0;   /* День переданной даты */
  VAR CurMon  :integer = 0;   /* Месяц переданной даты */
  VAR CurYear :integer = 0;   /* Год переданной даты */
  VAR RetValue:string  = "";  /* Возвращаемое значение */

  if(ValType(_Date) == V_DATE)
       if(_Date != Date(0, 0, 0))
            DateSplit(_Date, CurDay, CurMon, CurYear);

            StrMon = MonNameR(CurMon);

            if(CurDay < 10)
                 RetValue = "\"" + StrZeroD + string(CurDay) + "\" " + StrMon + " " + String(CurYear);
            else RetValue = "\"" + string(CurDay) + "\" " + StrMon + " " + String(CurYear);
            end;

       end;       
  end;
  return RetValue;

END; /* MakeDateStr */

