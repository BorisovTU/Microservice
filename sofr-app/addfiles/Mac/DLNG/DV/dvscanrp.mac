/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : dvscanrp.mac
  Created     : //AV 17.05.2006
  Programmer  : Азарцов Валерий В.
  Description : Печать отчета сканирования. Массовое закрытие позиций в списке 
  позиций
└───────────────────────────────────────────────────────────────────────────*/
import DVInter;   

RECORD   pos_firstdoc (dvfipos); 
FILE     pos(dvfipos); 
VAR      fin = TBfile("fininstr.dbt"); 

const Ошибка = 0,
      Первый = 1,
   Последний = 2;

MACRO Печать_ОтчетСканирования (Вызов,firstdoc,Статус,Сообщение, Action)

   var   FICode:string = "";

   setbuff (pos_firstdoc,firstdoc);

   if (Вызов==Первый)

[      Отчет о групповом закрытии\удалении позиций ПИ.                            ];
[+----------+-------+------------------------------------------------------------+];
[|    Код   |№ошибки|                 Сообщение                                  |];
[|  сделки  |       |                                                            |];
[+----------+-------+------------------------------------------------------------+];

   elif (Вызов==Ошибка)

      if(Статус == 0) 
         if( Action == 1 )         
            Сообщение = "Шаги сервисной операции удалены.";
         else 
            if(pos_firstdoc.ID)
               pos.ID = pos_firstdoc.ID;
               if(GetEQ(pos))
                  if( pos.State != 2 )
                     Сообщение = "Позиция не закрыта.";
                  else
                     Сообщение = "Позиция закрыта успешно.";
                  end;
               else
                  Сообщение = "Позиция удалена успешно.";
               end;
            end;
         end;
      end;

      fin.Clear();
      fin.KeyNum = 0;
      fin.rec.FIID = pos_firstdoc.FIID;
      if( fin.GetEQ() ) 
         FICode = fin.rec.FI_Code;
      else
         FICode = "";
      end;

[|##########|#######|############################################################|](FICode,Статус,Сообщение);

   elif (Вызов==Последний)            

[+----------+-------+------------------------------------------------------------+];

   end;
END;