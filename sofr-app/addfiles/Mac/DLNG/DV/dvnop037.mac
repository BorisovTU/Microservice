/*
$Name:        dvnop037.mac
$Module:      Производные инструменты
$Description: Внебиржевая операция. Шаг: Ожидание неттинга Т/О 2ч
*/
import InsCarryDoc, "dv_car.mac";

macro ExecuteStep( doc, FDoc, DocKind, ID_Operation, ID_Step )

  record ndeal(dvndeal);

  SetBuff( ndeal, FDoc );
  var FD = DVFirstDocNDeal(DocKind, ndeal, 2);
  if (FD.ОтказОтИсполнения())
     return 0;
  end;

  if( ИсполнитьОбязательство(FD, FD.ДатаОбязательства(), doc) != 0 )
     return 1;
  end;
  
  if( ИсполнитьТребование(FD, FD.ДатаТребования(), doc) != 0 )
     return 1;
  end;

  if( not InsertOprStatus(FD.DV_OPERSTATUS_NETTING_PAYM_ED(), DV_OPERSTATUS_PAYM_NOTEX) )
     MsgBox("Ошибка при установке статуса <Неттинг платежей Т/О 2ч> для операции.");
     return 1;
  end;

  if( not InsertOprStatus(FD.DV_OPERSTATUS_DOC(), DV_OPERSTATUS_DOC_CLOSE) )
     MsgBox("Ошибка при установке статуса <Документооборот> по операции.");
     return 1;
  end;

  return 0;
end;
