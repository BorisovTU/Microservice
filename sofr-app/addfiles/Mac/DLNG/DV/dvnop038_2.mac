import InsCarryDoc, "dv_categ.mac", "dv_car.mac";

macro ExecuteStep( doc, FDoc, DocKind, ID_Operation, ID_Step )

    record ndeal(dvndeal);
    var FD;
    var ДатаИсполненияШага:date;
    SetBuff( ndeal, FDoc );
    FD = DVFirstDocNDeal(DocKind, ndeal);
    GetOprDate( DV_NDEAL_OPRDATE_EXEC, ДатаИсполненияШага );

    if( FD.Netting() )
     if( not InsertOprStatus(FD.DV_OPERSTATUS_NETTING_PAYM_OD(), DV_OPERSTATUS_PAYM_EX) )
        MsgBox("Ошибка при установке статуса <Неттинг платежей Т/О 1ч> для операции.");
        return 1;
     end;
    else

     if( ИсполнитьТребование(FD, ДатаИсполненияШага, doc) != 0 )
        return 1;
     end;

     if( not InsertOprStatus(FD.DV_OPERSTATUS_NETTING_PAYM_OD(), DV_OPERSTATUS_PAYM_NOTEX) )
        MsgBox("Ошибка при установке статуса <Неттинг платежей Т/О 1ч> для операции.");
        return 1;
     end;
    end;

  if( not InsertOprStatus(FD.DV_OPERSTATUS_EXEC(), DV_OPERSTATUS_EXEC_CLOSE) )
     MsgBox("Ошибка при установке статуса <Исполнение> по операции.");
     return 1;
  end;
  return 0;
end;