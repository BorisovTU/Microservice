/*
$Name:        dvtr120.mac
$Module:      ФИСС и КО
$Description: Операция расчетов по ПИ - Перемещение средств (Шаг - Цепочка перемещения средств у брокера)
*/

import InsCarryDoc, "dvserv.mac", "dv_fun.mac", "dv_carop.mac";

var TransAmount;
var TransCurr;
var TransAccountFrom;
var TransAccountTo;

macro ExecuteStep( doc, FDoc)
  
  record oper(dvoper);

  var FD_Oper:DVFirstDocOper;
  var IsAccoutFrom = true;
  var TransAccount = "";

  SetBuff( oper , FDoc );

  FD_Oper = DVFirstDocOper( DL_DVOPER, oper );

  if( (ValType(TransAmount) == V_UNDEF) and (ValType(TransCurr) == V_UNDEF) )
      MsgBox("Вставка цепочек возможна только из панели 'Перемещение средств'");  
      return 1;
  else

  if( TransAccountFrom ) 
     TransAccount = TransAccountFrom;
  elif(TransAccountTo)
     TransAccount = TransAccountTo;
     IsAccoutFrom = false;
  else
        msgbox("Не задан лицевой счет.");
     return 1;
  end;

  if( TransAmount )
     if( ВыполнитьПроводкуПеремещенияУБрокера( FD_Oper, oper, doc, TransAccount, TransAmount, TransCurr, IsAccoutFrom ) == false )
        return 1;
     end;
  else
     msgbox("Не задана сумма проводки.");
     return 1;
  end;

   end;
  return 0;
end;
