/*
$Name:        dvtr100.mac
$Module:      ФИСС и КО
$Description: Операция расчетов по ПИ - Перемещение средств (Шаг - Цепочка перевода средств)
*/

import InsCarryDoc, "dvserv.mac", "dv_fun.mac", "dv_carop.mac";

var TransAmount;
var TransCurr;
var TransAction;
var TransAmount_Clir;
var TransCurr_Clir;
var MarketSchemOtherID;

macro ExecuteStep( doc, FDoc)

  record oper(dvoper);
  VAR MarketSchemOther = TBFile( "dlmarket.dbt");
  var FD_Oper:DVFirstDocOper;

  SetBuff( oper , FDoc );

  FD_Oper = DVFirstDocOper( DL_DVOPER, oper );

  if(MarketSchemOtherID != NULL)
    MarketSchemOther.rec.ID = MarketSchemOtherID;
    MarketSchemOther.GetEQ();
    FD_Oper.SetDlMarketOther(MarketSchemOther);
  end;

  if( (ValType(TransAmount) == V_UNDEF) and (ValType(TransCurr) == V_UNDEF) and (ValType(TransAction) == V_UNDEF) )
     MsgBox("Вставка цепочек возможна только из панели 'Перемещение средств'");  
     return 1;
  else
     if( ВыполнитьПлатежПереводаВозвратаСредств( FD_Oper, oper, doc, TransAmount, TransCurr, TransAmount_Clir, TransCurr_Clir, TransAction, false ) == false )
        return 1;
     end;
  end;

  return 0;
end;
