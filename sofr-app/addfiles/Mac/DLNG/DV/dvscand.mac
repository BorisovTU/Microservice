/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : dvscand.mac
  Created     : //AV 21.06.05
  Programmer  : Азарцов Валерий В.
  Description : Печать отчета сканирования для сделок\операций исполнения ПИ 
└───────────────────────────────────────────────────────────────────────────*/
import DVInter;   

RECORD deal_firstdoc (dvdeal); 
FILE   dvdeal(dvdeal); 

const Ошибка = 0,
      Первый = 1,
   Последний = 2;

MACRO Печать_ОтчетСканирования (Вызов,firstdoc,Статус,Сообщение)
     var RetCount = 0;

     setbuff (deal_firstdoc,firstdoc);
     if (Вызов==Первый)
[             Отчет о групповом создании операций для сделок.];
[+----------+-------+----------------------------------------------------------------------------------------+];
[|    Код   |№ошибки|                 Сообщение                                                              |];
[|  сделки  |       |                                                                                        |];
[+----------+-------+----------------------------------------------------------------------------------------+];
     elif (Вызов==Ошибка)
        if(Статус == 0) 
           if(deal_firstdoc.ID)
              dvdeal.ID = deal_firstdoc.ID;
              if(GetEQ(dvdeal))
                 if(dvdeal.State    == 2 ) /*закрытая*/
                    Сообщение = "Операция создана успешно. Сделка закрыта.";
                 elif(dvdeal.State  == 1 ) /*открытая*/
                    Сообщение = "Операция создана успешно. Сделка не закрыта.";
                 elif( dvdeal.State == 0 ) /*отложенная*/
                    Сообщение = "Операция не создана.";
                 end;
              end;
           end;
        end;
[|##########|#######|########################################################################################|]
(deal_firstdoc.Code,Статус,Сообщение:w);
     elif (Вызов==Последний)            
[+----------+-------+----------------------------------------------------------------------------------------+];
     end;
END;