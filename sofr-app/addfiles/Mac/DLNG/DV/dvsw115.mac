/*
$Name:        dvsw115.mac
$Module:      Производные инструменты
$Description: Валютный СВОП. Шаг "Отнесение фин.результата"
*/
import InsCarryDoc, "dv_categ.mac", "dv_car.mac", "dv_period.mac";

macro ExecuteStep( doc, FDoc, DocKind, ID_Operation, ID_Step )

  RECORD ndeal(dvndeal);
  RECORD ВыбытиеПФИ(account);
  VAR ДатаИсполненияШага, FD, RestAcc;

  SetBuff( ndeal, FDoc );

  FD = DVFirstDocNDeal(DocKind, ndeal);
  if (FD.ОтказОтИсполнения())
     return 0;
  end;

  ДатаИсполненияШага = DV_GetPlanDateStep(ID_Operation, ID_Step);
  if( ДатаИсполненияШага == date(0,0,0) )
     ДатаИсполненияШага = FD.ДатаИсполнения();
  end;

  if ( (FD.ВыполненаПереоценкаСС(ДатаИсполненияШага)) or ( (FD.deal.rec.kind == 22710) and (FD.Биржевая()))  )/*Сделка Т+3 на бирже, по ним вар.маржа*/
    if( ОтнесениеФинРезультата( FD, doc, ДатаИсполненияШага ) != 0 )
       return 1;
    end;
  end;

  return 0;
end;
