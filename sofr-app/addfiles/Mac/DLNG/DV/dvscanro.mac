/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : dvscanro.mac
  Created     : //AV 21.06.05
  Programmer  : Азарцов Валерий В.
  Description : Операции расчета ПИ. Печать отчета сканирования. Удалении операций.
└───────────────────────────────────────────────────────────────────────────*/
import DVInter;   

RECORD oper_firstdoc (dvoper); 
FILE dvoper(dvoper); 

const Ошибка = 0,
      Первый = 1,
   Последний = 2;

/*Action = 1 - вызывается из списка сделок в сервисной операции*/
MACRO Печать_ОтчетСканирования (Вызов,firstdoc,Статус,Сообщение, Action)
     setbuff (oper_firstdoc,firstdoc);
     if (Вызов==Первый)
[         Отчет о групповом удалении операций для операций расчета ПИ.            ];
[+----------+-------+------------------------------------------------------------+];
[|    Код   |№ошибки|                 Сообщение                                  |];
[|  сделки  |       |                                                            |];
[+----------+-------+------------------------------------------------------------+];
     elif (Вызов==Ошибка)
        if(Статус == 0) 
           if( Action == 1 )
              Сообщение = "Шаги сервисной операции удалены.";
           else 
              if(oper_firstdoc.ID)
                 dvoper.ID = oper_firstdoc.ID;
                 if(GetEQ(dvoper))
                    if( dvoper.State != 0 )
                       Сообщение = "Операция не удалена.";
                    elif(dvoper.State == 0 )
                       Сообщение = "Операция удалена успешно. Сделка отложена.";
                    end;
                 else 
                    Сообщение = "Операция и сделка удалены успешно.";
                 end;
              end;                                                                                   
           end;
        end;
[|##########|#######|############################################################|](oper_firstdoc.Code,Статус,Сообщение);
     elif (Вызов==Последний)            
[+----------+-------+------------------------------------------------------------+];
     end;
END;