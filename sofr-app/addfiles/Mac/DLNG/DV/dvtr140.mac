/*
$Name:        dvtr140.mac
$Module:      ФИСС и КО
$Description: Операция расчетов по ПИ - Перемещение средств (Шаг - Цепочка возврата средств)
*/

import InsCarryDoc, "dvserv.mac", "dv_fun.mac", "dv_carop.mac";

var TransAmount;
var TransCurr;
var TransAction;
var TransAmount_Clir;
var TransCurr_Clir;

macro ExecuteStep( doc, FDoc)
  
  record oper(dvoper);

  var FD_Oper:DVFirstDocOper;

  SetBuff( oper , FDoc );

  FD_Oper = DVFirstDocOper( DL_DVOPER, oper );

  if( (ValType(TransAmount) == V_UNDEF) and (ValType(TransCurr) == V_UNDEF) and (ValType(TransAction) == V_UNDEF) )
     MsgBox("Вставка цепочек возможна только из панели 'Перемещение средств'");  
     return 1;
  else
     if( ВыполнитьПлатежПереводаВозвратаСредств( FD_Oper, oper, doc, TransAmount, TransCurr, TransAmount_Clir, TransCurr_Clir, TransAction, true ) == false )
        return 1;
     end;
  end; 

  return 0;
end;
