/*
$Name:        dlcontrfrobch_rep.mac
$Module:      –¥­­ë¥ ¡ã¬ £¨
$Description: à®â®ª®« ¨§¬¥­¥­¨© § ¯¨á¨ ¢ª« ¤ª¨ "”¨­.à¥§. ®â ¤à. ¡à®ª¥à " „
*/
import OprInter, RsbDataSet, "cb_sql.mac", "scsrvrepfun.mac";

MACRO PrintReportDlContrFrobCh(FrobID:integer):integer
  var errcode, errtext;
  var ReportFileName;
  var query, cmd, DataSet;
  var FirstTime = time(), LastTime = time();
  var First:bool = true;
  FILE ReportOutFile() txt write; /*ä ©« ¢ë¢®¤  ¤«ï ®âç¥â */
  var i = 1;

  ReportFileName = GetTxtFileName("dlcontrfrobch");
  if( not Open(ReportOutFile, ReportFileName) )
     errcode = status(errtext);
     RunError("è¨¡ª  ¯à¨ á®§¤ ­¨¨ ä ©« |"+ReportFileName+"|(" + errcode + ") " + errtext);
  end;
  SetOutput( ReportFileName );

  query =   " select ch.*, p.t_Name as OperName "
          + "   from ddlcontrfrobch_dbt ch, dperson_dbt p "
          + "  where ch.t_FrobID = ? "
          + "    and p.t_Oper = ch.t_Oper "
          + " order by ch.t_ID ASC ";

  cmd = DL_RSDCommand(query);

  cmd.AddParam(FrobID);

  DataSet = cmd.Execute();


  println( "à®â®ª®« ¨§¬¥­¥­¨© § ¯¨á¨ ¢ª« ¤ª¨ \"”¨­.à¥§. ®â ¤à. ¡à®ª¥à \"");
  println( "ÚÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿\n" +
           "³ ü ³ „ â  ¨§¬¥­¥­¨ï ³     ®«ì§®¢ â¥«ì     ³       «®£®¢ë©    ³        Š®¤        ³     ‘ã¬¬  ¤®å®¤ ,     ³        Š®¤        ³     ‘ã¬¬  ¢ëç¥â ,     ³\n" +
           "³   ³                ³                      ³       ¯¥à¨®¤      ³       ¤®å®¤       ³       àã¡. ª®¯.       ³       ¢ëç¥â       ³       àã¡. ª®¯.       ³\n" +
           "³   ³                ³                      ÃÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄ´\n" +
           "³   ³                ³                      ³   ë«®  ³  ‘â «®  ³   ë«®  ³  ‘â «®  ³    ë«®   ³   ‘â «®   ³   ë«®  ³  ‘â «®  ³    ë«®   ³   ‘â «®   ³\n" +
           "ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄ´");
  while( DataSet.MoveNext() )
     if(i > 1)
       println("ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄ´");
       
     end;
           
           [³###³################³######################³#########³#########³#########³#########³###########³###########³#########³#########³###########³###########³]
           ( i, 
             string(string(date(DataSet.ChangeDate):f) + " " + string(time(DataSet.ChangeTime):f)):c:w, 
             string(string(DataSet.Oper) + " "+DataSet.OperName):w, 
             DataSet.TaxPeriod_Old:c,
             DataSet.TaxPeriod_New:c, 
             DataSet.IncomeCode_Old:c:0,
             DataSet.IncomeCode_New:c:0,
             DataSet.IncomeSum_Old:c:2,
             DataSet.IncomeSum_New:c:2,
             DataSet.DeductionCode_Old:c:0,
             DataSet.DeductionCode_New:c:0,
             DataSet.DeductionSum_Old:c:2,
             DataSet.DeductionSum_New:c:2
           );     
     
     i = i + 1;
  end;
     
   println("ÀÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÙ");  

  SetOutput(NULL, true);
  close(ReportOutFile);
  ViewFile(ReportOutFile);

  return 0;
END;