/**
 @file 		SumConfirmExp_Print.mac
 @brief 	Отчет "Суммы подтвержденных расходов"

 # tag
 - functional_block: Отчетность_внутренняя
 - code_type: Report
 - code_type:GUI

 #menu 
  - БО ЦБ\ Внутренний учет \ Отчеты \ Поручения и операции клиентов \ Суммы подтвержденных расходов

 # changelog
 |date       |autor          |tasks                                           |note
 |-----------|---------------|------------------------------------------------|-------------------------------------------------------------
 |02.05.2025 |Велигжанин А.В.|DEF-88733                                       |CSumConfirmExp_Report() вызывается с параметром p_FuncObjFlag == true
 |           |               |                                                |(так как восстановлен и прежний формат формирования отчета с p_FuncObjFlag == false)

*/
import "FuncObj.mac", ServiceAction, BankInter, RSD;
import "SumConfirmExp_Print.mac";

macro PrintStartFunc(ObjectType, ObjectID, Param, GUID, FuncObjID/*, DataXml*/ )
  var cmd, rs;
debugbreak;
  var ReturnObj = FuncObjResult(FUNCOBJ_RESULT_OK, "", 0);
//SetRsTrace(true);
  ReturnObj.state = FUNCOBJ_RESULT_OK;
  ReturnObj.errorText = "";
  ReturnObj.errorCode = 0;

  cmd = RSDCommand( "SELECT t_ID, length(t_Data) as len, t_Data FROM DFUNCOBJ_DBT WHERE T_ID = ?" );
  cmd.NullConversion = true;
  cmd.addParam( "", RSDBP_IN, FuncObjID     );

  var DataXml = "";
  rs = RsdRecordSet(cmd);
  if (rs.moveNext())
    var LenXml = int(rs.value("len"));
    rs.Fld("t_Data").Read(DataXml, LenXml);
  end; 

/*
  if( (ValType(RSLResult) == V_GENOBJ) and (GenPropID(RSLResult, "faultString") != -1) )
    /* если вернули объект с полем faultString, значит была ошибка выполнения */
    ReturnObj.state     = FUNCOBJ_RESULT_ERROR;
    ReturnObj.errorText = toOEM(RSLResult.faultString, true);
    ReturnObj.errorCode = FUNCOBJ_STATE_FATAL_ERROR;
  end;
*/

  var ParmObj = NULL;
  var stat = ConvertToRSL(DataXml, ParmObj);
  CSumConfirmExp_Report(ParmObj.RepDate, ParmObj.LaunchMode, -1, -1, -1, ParmObj.GUID, ParmObj.PackNum, true).Run();    

//  SetRsTrace(false);
  return ReturnObj;
end;