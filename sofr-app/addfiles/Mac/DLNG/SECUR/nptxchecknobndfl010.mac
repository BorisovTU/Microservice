/*
$Name:        nptxchecknobndfl010.mac
$Module:      Ценные бумаги
$Description: Шаг "Инициализация" операции сверки НОБ/НДФЛ
*/

import "nptxsnobverfun.mac";

PRIVATE MACRO Error( ErrStr:STRING ):INTEGER
  DL_NPTX_PutMsg( ErrStr, 10 );
  MsgBox( ErrStr );
  return 1;
END;

MACRO ExecuteStep(doc, FDoc, DocKind, ID_Operation, ID_Step)
   var err = 0;
  var snobver = TRecHandler("nptxsnobver.dbt");
      snobver.SetRecordAddr( FDoc );

   if (UpdateSnobverStatus(snobver, 1) != 0)
     err = Error( "Ошибка при обновлении статуса" );
   end;

   if( not InsertOprStatus(46531, 1))
     err = Error( "Ошибка при установке статуса вида \"Документооборот\" операции" );        
   end;

   return err;
END;
