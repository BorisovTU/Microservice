/* 
   @file wrtavr35_201100.mac 
   @brief Операция зачисления ЦБ
   Шаг Отправка неторгового поручения в QUIK 
   Не используется
*/

import InsCarryDoc;
import "sp_car.mac";

/**
  @brief it_log - сохранение в лог текстового сообщения
  @param[in] text - текстовое сообщение
*/
private macro it_log(text)
  var sql = "begin it_log.log(:1); end;";
  var cmd = RSDCommand(sql);
  cmd.AddParam("",RSDBP_IN,text);
  cmd.execute;
end;

macro MassInitOperation_Impl()
  return 0;
end;

PRIVATE MACRO ExecMassInitOperation(FD)
  return MassInitOperation_Impl();
OnError(RslErrObj)
    return 1;
END;  


PRIVATE MACRO __ExecuteStep( FD:SPFirstDoc, dat:DATE ):INTEGER
  if( FD != NULL ) // единичное исполнение
     return ExecMassInitOperation(FD);
  else
     return ExecMassInitOperation();
  end;
END;

MACRO ExecuteStep( Doc, ticket )
  record deal(dl_tick);
  var FD, dat;

  SetBuff(deal, ticket);
  FD = SPFirstDoc(deal);
  GetOprDate(0, dat);
  return __ExecuteStep(FD, dat);
END;

/* Массовое исполнение */
MACRO MassExecuteStep()
  return __ExecuteStep(NULL);
END;
