/**
  @file weekly_rep_number_clients.mac 
  @brief Макрос, запускаемый планировщиком по умолчанию воскресенье 23-00. 

 #menu 
  - БО ЦБ\Отчеты\РСХБ\Еженедельная отчетность по количеству клиентов                                                                                                                                                                                                                          

 #tag                                                                                                          
 - functional_block:Отчетность_Внутренняя                                                                             
 - code_type:GUI 
 - code_type:API                                                                                                                                                                                               
                                                                                                                
 # changeLog                                                                                                    
 |date       |author         |tasks               |note                                                         
 |-----------|---------------|--------------------|-------------------------------------------------------------
 |2025.08.25 |Шишкин Е.В.    |BOSS-8797           |Еженедельная отчетность по количеству клиентов                                                                                                                                                 

*/

import "DlRepForm_h.mac";

PRIVATE CONST PNFLD_NUMBCLIENT_BEGINDATE = 0;
PRIVATE CONST PNFLD_NUMBCLIENT_ENDDATE = 1;

/**
 @brief Класс формы отчетности по количеству клиентов
*/                    
CLASS (DL_CPanel) NumberClientForm_Panel()
  var m_BeginRepDate = {curdate}-7; //Отчетная дата
  var m_EndRepDate = {curdate}; //Отчетная дата

  /**
   @brief Инициализация параметров формы, назначения обработчиков полей
  */                    
  PRIVATE MACRO Init()  
    AddFieldProc(0, PNFLD_NUMBCLIENT_BEGINDATE, DL_PNFLD_ENDDATE, @DL_FldProc_EndDate, m_BeginRepDate);
    AddFieldProc(0, PNFLD_NUMBCLIENT_ENDDATE, DL_PNFLD_ENDDATE, @DL_FldProc_EndDate, m_EndRepDate);
  END;

  /**
   @brief Проверка параметров формы
   @return true, если проверка пройдена успешно
   @return false, если в процессе проверки были обнаружены ошибки
  */                    
  PRIVATE MACRO Check():BOOL
    return true;
  END;

  /**
   @brief Запуск формы с последующей записью полученных параметров
   @return true, если форма отработала успешно и была подтверждена по F2
   @return false, если в процессе работы формы возникли ошибки или из нее вышли по Esc
  */                    
  MACRO Run()
    var stat = Run();

    m_BeginRepDate = GetFieldValue(PNFLD_NUMBCLIENT_BEGINDATE);
    m_EndRepDate = GetFieldValue(PNFLD_NUMBCLIENT_ENDDATE);

    return stat;
  END;

  initDL_CPanel("sp_rep.lbr", "NUMCL");
END;