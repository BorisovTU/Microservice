 /*
$Name:         loan010.mac 
$Module:       Ценные бумаги
$Description:  Операция займ. Шаг настройки операции
*/

import InsCarryDoc, "sp_class.mac", "sp_car2.mac", "SPQICheckOper.mac";

macro executeParamStep( kind_oper, BOf_kind, FDoc, ID_Operation, ID_Step )
  record  deal(dl_tick);
  var     FD, FD2, err = 0;

  SetBuff( deal, FDoc ); 
  FD  = SPFirstDoc( deal, false, true );
  FD2 = SPFirstDoc( deal, true, true );

  if( ИнициализироватьОперациюРЕПО( FD, FD2 ) == false )
     return 1;
  end;

  if(ПроверитьПринадлежностьКИ( FD ) == false)
     return 1;
  end;

  if( not ОбновитьСтатусЧастиСделки( FD2.dl_leg, DL_LEG_INITIAL ) )
     msgbox("Ошибка при изменении статуса сделки");
     return 1;
  end;

  return 0;
end;
