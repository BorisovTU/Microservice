/*
$Name:        scf110_form.mac
$Module:      Ценные бумаги
$Description: Панель для отчета "Расшифровки отдельных показателей деятельности кредитной организации" - (форма 0409110)
*/

import "DlRepForm_h.mac", secinter;

PRIVATE CONST
  H_PNFLD_PART    = 100;


CONST PNFLD_SCF110_MONTH          = 0,
      PNFLD_SCF110_YEAR           = 1,
      PNFLD_SCF110_PART           = 2,
      PNFLD_SCF110_CHECKREP_PART2 = 3;

/*Выбор части*/
MACRO FldProc_PartKind( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
//  VAR BeginDate, EndDate, Month, Year, BegD, EndD;

  if( Cmd == DLG_INIT ) /*Установка значения в поле*/
     
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = 0;
     end;     
    
     FldShowValue = DL_GetNameAlg( 8403, FldRealValue );

  elif( Cmd == DLG_CHANGEVALUE ) /*значение поля было изменено*/
     FldRealValue = FldShowValue;
  elif( (Cmd == DLG_KEY) AND (Key == KEY_F3) )
     DL_ListNA( 8403, @FldShowValue, @FldRealValue, pThis.CurrentFldX(), pThis.CurrentFldY() );
  end;
  return CM_DEFAULT;
END;

/*Флаг вывода протокола */
PRIVATE MACRO FldProc_PatrFlag_ChecBox( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
     FldShowValue = FldRealValue;
     if( FldRealValue == SET_CHAR )
        EnableFields( pThis.Data(), PNFLD_SCF110_PART );
     else
     DisableFields( pThis.Data(), PNFLD_SCF110_PART );
     end;
  elif( Cmd == DLG_CHANGEVALUE )
     FldRealValue = FldShowValue;
  elif( Cmd == DLG_KEY )
     if( Key == KEY_SPACE )
        if( FldRealValue != SET_CHAR )
           FldShowValue = FldRealValue = SET_CHAR;
           EnableFields( pThis.Data(), PNFLD_SCF110_PART );
        else
           FldShowValue = FldRealValue = "";
           DisableFields( pThis.Data(), PNFLD_SCF110_PART );
        end;
     end;
  end;
  return CM_DEFAULT;
END;


CLASS (DL_CPanel) SCF110_Panel()

  PRIVATE MACRO Init()
     VAR Year, Month, Part;

     //По умолчанию текущий год или предшествующий текущему, если текущая операционная дата не превышает 31 января
     DateSplit( {curdate}, null, Month, Year );

     if(Month == 1)
       Month = 12;
       Year = Year - 1;
     else
        Month = (Month - 1); 
     end; 

     AddFieldProc( 0, PNFLD_SCF110_MONTH,          DL_PNFLD_PERIOD,   @DL_FldProc_Period,    Month, 30, 9 );
     AddFieldProc( 0, PNFLD_SCF110_YEAR,           DL_PNFLD_YEAR,     @DL_FldProc_Year,     Year );
     AddFieldProc( 0, PNFLD_SCF110_PART,           H_PNFLD_PART,      @FldProc_PartKind,    Part, 53, 9 );
     AddFieldProc( 0, PNFLD_SCF110_CHECKREP_PART2, DL_PNFLD_CHECKBOX, @FldProc_PatrFlag_ChecBox, UNSET_CHAR );

  END;

  PRIVATE MACRO Check():BOOL
     return true;
  END;

  initDL_CPanel( "sp_rep.lbr", "SCF110" );
END;
