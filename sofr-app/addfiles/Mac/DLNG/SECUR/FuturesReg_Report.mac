/*
$Name:             FuturesReg_Report.mac
$Module:           АРНУ
$Description:      Отчет "Регистры срочных сделок" (НУ)
*/

IMPORT "FuturesReg_Form.mac", "RegistrReport.mac", "ws_txreportform.mac";

/*Здесь можно через "," в апострофах указать код (FININSTR.FI_Code) ценных бумаг, которые будут исключаться из отчета.
  Например: 
    ИсключаемыеИзОтчетаЦБ = "'1','2','3'"
*/
PRIVATE CONST ИсключаемыеИзОтчетаЦБ = "";

PRIVATE CONST Строка_Итого                = 0,
              Строка_СтрокаДанных         = 1;

PRIVATE CONST SHEET_0301 = "0301";
PRIVATE CONST SHEET_0302 = "0302";
PRIVATE CONST SHEET_0303 = "0303";
PRIVATE CONST SHEET_0304 = "0304";
PRIVATE CONST SHEET_0305 = "0305";
PRIVATE CONST SHEET_0306 = "0306";
PRIVATE CONST SHEET_0310 = "0310";

PRIVATE VAR   Futures_Form;
PRIVATE VAR   Futures_Report;
PRIVATE VAR   WebMenuItem; // Информация о запуске отчета из веб

PRIVATE VAR   T_Dep:T_Dep_Collector;

PRIVATE VAR ReportHeader =
"\n\n##############################  ###########################\n" +
"Приложение № ##.## \n" +
"Аналитический регистр налогового учета № 1-02-#####-###-##-000-##-210302-##-##-70102000000000000000\n" +
"                ┌──────────────────────┬─────────────────────────────────────────────────┐\n" +
"                │                    1 │Наименование налоговой базы                      │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   02 │Лист декларации                                  │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                ##### │Номер приложения синтетического регистра         │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                  ### │Код строки в синтетическом регистре              │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   ## │Номер аналитического регистра                    │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                  000 │Код филиала                                      │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   ## │                                                 │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │               210302 │Код структурного подразделения внутри филиала    │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   ## │Номер месяца (последний в отчетном периоде)      │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   ## │Две последние цифры года                         │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │ 70102000000000000000 │Номер лиц. счета по учету доходов/расходов банка │\n" +
"                └──────────────────────┴─────────────────────────────────────────────────┘\n" +
"############################################################################################################################################################################################################################################################################################################################\n" +
"за период с ########## по ##########\n" +
"Группа налогового учета: #################################################################\n" +
"Вид ц/б:                 #################################################################\n" +
"Выпуск ц/б:              #################################################################\n";

PRIVATE VAR TableHeader_0301 =
"┌───────────┬────────────────────┬─────────────┬─────────────────┬──────────┬───────────┬──────┬────────────────────┬──────────────────────────────┬────────────────────┬─────────────────┬───────────┬────────────┬──────────┬──────────┬────────┬───────────────────────┬─────────────────────────────┬───────────────────────────────┬───────────────┬────────────────┬───────────┬──────────────┬───────────┬────────────┬──────────┬────────────┬──────────────────────────────────┬────────────┬───────────┬────────────┬────────────┬─────┐\n" +
"│  Код      │Выпуск              │  Номер      │     Дата        │   Дата   │Количество │Код   │Цена реализации     │    Стоимость реализации      │Расчетная цена ФИСС,│   Сумма         │ Комиссия, │Номер сделки│   Дата   │Дата      │Код     │    Цена               │ Стоимость                   │ Максимальная цена на дату     │    Сумма      │    Стоимость   │  Комиссия,│Расходы при   │Курс ЦБ РФ │ Курс ЦБ РФ │   Курс   │    Курс    │      Дата переквалификации       │Контрагент  │ Контрагент│ГО/филиал   │ГО/филиал   │Нало-│\n" +
"│ бумаги    │ценной              │  сделки     │  заключения     │ перехода │бумаг, шт. │валюты│                    │                              │ уменьшенная на 20% │ отклонения      │уплаченная │приобретения│заключения│перехода  │валюты  │приобретения           │приобретения                 │   заключения сделки,          │ превышения    │  приобретенных │уплаченная │реализации,   │  на дату  │  на дату   │ пересчета│  пересчета │        сделки РЕПО/Займа         │ по сделке  │ по сделке │по сделке   │по сделке   │говая│\n" +
"│           │бумаги              │реализации   │    сделки       │   права  │           │цены  │                    │                              │                    │фактической      │    при    │            │сделки    │права     │цены    │                       │                             │сложивш. на ОРЦБ; расчетная    │ стоимости     │  ценных бумаг, │при        │    руб.      │заключения │ заключения │цены/ст-ти│ цены/ст-ти │                                  │реализации  │приобрете- │реализации  │приобретения│груп-│\n" +
"│           │                    │             │  реализации     │ собств-ти│           │реали-│                    │                              │                    │выручки ниже     │реализации │            │приобрете-│собств-ти │приобре-│                       │                             │ цена для ЦБ не обращ. на      │ приобретения  │ принимаемая для│приобрете- │              │   сделки  │   сделки   │реализации│приобретения│                                  │            │ния        │            │            │па   │\n" +
"│           │                    │             │      ЦБ         │    при   │           │зации │                    │                              │                    │  рыночной       │           │            │ния ЦБ    │при       │тения   │                       │                             │   ОРЦБ (расч. цена ЦБ,        │ над рыночной  │      целей     │нии, руб.  │              │реализации │приобретения│в рублевый│ в рублевый │                                  │            │           │            │            │     │\n" +
"│           │                    │             │                 │реализации│           │      │                    │                              │                    │(расчетной)      │           │            │          │приобрете-│        │                       │                             │ приобр.по срочн. сделке),     │ (расчетной)   │налогообложения,│           │              │           │            │эквивалент│ эквивалент │                                  │            │           │            │            │     │\n" +
"│           │                    │             │                 │    ЦБ    │           │      │                    │                              │                    │    цены         │           │            │          │нии ЦБ    │        │                       │                             │      увелич. на 20%           │ ценой, руб.   │      руб.      │           │              │           │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │                 │          │           │      │                    │                              │                    │                 │           │            │          │          │        │                       │                             │                               │               │                │           │              │           │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │                 │          │           │      │                    │                              │                    │                 │           │            │          │          │        │                       │                             │                               │               │                │           │              │           │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │                 │          │           │      │                    │                              │                    │                 │           │            │          │          │        │                       │                             │                               │               │                │           │              │           │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │                 │          │           │      ├──────────┬─────────┼───────────┬──────────────────┤                    │                 │           │            │          │          │        ├──────────┬────────────┼──────────────┬──────────────┼────────┬──────────┬───────────┤               │                │           │              │           │            │          │            ├────────────────┬─────────────────┤            │           │            │            │     │\n" +
"│           │                    │             │                 │          │           │      │ в валюте │  в      │ в валюте  │  в               │                    │                 │           │            │          │          │        │  в валюте│  в         │  в валюте    │  в           │Цена,   │ Источник │  Дата     │               │                │           │              │           │            │          │            │  для сделки    │    для сделки   │            │           │            │            │     │\n" +
"│           │                    │             │                 │          │           │      │   цены   │рублях   │   цены    │рублях            │                    │                 │           │            │          │          │        │    цены  │рублях      │    цены      │рублях        │ руб.   │информации│котировки  │               │                │           │              │           │            │          │            │  реализации    │   приобретения  │            │           │            │            │     │\n" +
"│           │                    │             │                 │          │           │      │          │         │           │                  │                    │                 │           │            │          │          │        │          │            │              │              │        │          │           │               │                │           │              │           │            │          │            │                │                 │            │           │            │            │     │\n" +
"│           │                    │             │                 │          │           │      │          │         │           │                  │                    │                 │           │            │          │          │        │          │            │              │              │        │          │           │               │                │           │              │           │            │          │            │                │                 │            │           │            │            │     │\n" +
"├───────────┼────────────────────┼─────────────┼─────────────────┼──────────┼───────────┼──────┼──────────┼─────────┼───────────┼──────────────────┼────────────────────┼─────────────────┼───────────┼────────────┼──────────┼──────────┼────────┼──────────┼────────────┼──────────────┼──────────────┼────────┼──────────┼───────────┼───────────────┼────────────────┼───────────┼──────────────┼───────────┼────────────┼──────────┼────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤\n" +
"│   1       │   2                │    3        │     4           │     5    │     6     │   7  │    8     │  9      │    10     │  11              │          12        │     13          │    14     │     15     │     16   │     17   │   18   │     19   │  20        │     21       │  22          │  23    │    24    │    25     │      26       │       27       │     28    │     29       │    Т1     │     Т2     │    Т3    │     Т4     │      Т5        │        Т6       │    Т7      │     Т8    │    Т9      │     Т10    │ Т11 │\n" +
"├───────────┼────────────────────┼─────────────┼─────────────────┼──────────┼───────────┼──────┼──────────┼─────────┼───────────┼──────────────────┼────────────────────┼─────────────────┼───────────┼────────────┼──────────┼──────────┼────────┼──────────┼────────────┼──────────────┼──────────────┼────────┼──────────┼───────────┼───────────────┼────────────────┼───────────┼──────────────┼───────────┼────────────┼──────────┼────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤";

PRIVATE VAR TableHeader_0302 =
"┌───────────┬────────────────────┬─────────────┬───────────┬─────────┬─────────────┬───────────┬──────────────────┬──────────────┬────────────────────────────────┬───────────────┬───────────────┬──────────────┬─────────────────────────────────────┬────────────────────┬───────────────┬───────────┬──────────────┬──────────┬──────────┬───────────┬───────────────┬──────────────┬──────────────────────────────────┬────────────┬────────────────┬────────────┬───────────────┬────────┬─────────────────────────────────────────────┬──────────────────────────────────────┬───────────────┬───────────────┬───────────────┬──────────────────────────────────┬────────────┬───────────┬────────────┬────────────┬─────┐\n" +
"│ Код       │Выпуск              │   Номер     │   Дата    │   Дата  │Количество   │    Цена   │  Стоимость       │     НКД      │    Процентный доход,           │  Купонный     │ Процентный    │  Доходы,     │        Выручка от реализации        │Расчетная цена ФИСС,│   Сумма       │ Комиссия, │Номер сделки  │    Дата  │Дата      │     Цена  │  Стоимость    │НКД уплаченный│  Максимальная цена на дату       │   Сумма    │    Стоимость   │  Комиссия, │Расходы при    │Отметка │Купонный доход, полученный от эмитента       │НКД, уплаченный при приобретении,     │Количество     │Дата выплаты   │Сальдо доходов │      Дата переквалификации       │Контрагент  │ Контрагент│ГО/филиал   │ГО/филиал   │Нало-│\n" +
"│бумаги     │ценной              │сделки       │заключения │перехода │бумаг, шт.   │реализации,│реализации,       │полученный    │    учтенный для целей          │    доход,     │доход          │ полученные   │              для целей              │ уменьшенная на 20%,│отклонения     │уплаченная │приобретения  │заключения│перехода  │приобрете- │ приобретения, │при           │заключения сделки, сложивш.       │превышения  │приобретенных   │уплаченная  │реализации,    │о       │при погашении купонов в отчетном             │уменьшающий, руб.                     │купонов,       │по последнему  │при погашении  │        сделки РЕПО/Займа         │по сделке   │по сделке  │по сделке   │по сделке   │говая│\n" +
"│           │бумаги              │реализации   │  сделки   │ права   │             │ % от      │     руб.         │ при          │    налогообложения в           │ полученный    │начисленный    │    при       │        налогообложения, руб.        │ в % от номинала    │фактической    │при        │              │  сделки  │права     │ния, в % от│ руб.          │приобретении, │на ОРЦБ; расчетная цена для ЦБ    │стоимости   │  ценных бумаг, │при приобре-│руб.           │наличии │(налоговом) периоде, руб.                    │                                      │подлежащих     │купону         │ купона, руб.  │                                  │реализации  │приобрете- │реализации  │приобретения│груп-│\n" +
"│           │                    │             │реализации │собств-ти│             │ номинала  │                  │реализации,   │        предыдущем              │от эмитента    │за отчетный    │ частичном    │                                     │                    │выручки ниже   │реализации,│              │  приоб-  │собств-ти │номинала   │               │руб.          │не обращ. на ОРЦБ (расч. цена     │приобретения│ принимаемая для│тении, руб. │               │выплат  │                                             │                                      │полученнию     │в отчетном     │               │                                  │            │ния        │            │            │па   │\n" +
"│           │                    │             │           │при      │             │           │                  │руб.          │    налоговом периоде,          │    при        │(налоговый)    │ погашении    │                                     │                    │  рыночной     │руб.       │              │ретения ЦБ│при       │           │               │              │ЦБ, приобр.по срочн. сделке),     │над рыночной│      целей     │            │               │купона  │                                             │                                      │в отчетном     │периоде        │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │реализа- │             │           │                  │              │     но не полученный           │ погашении     │период, руб.   │ номинала,    │                                     │                    │(расчетной)    │           │              │          │приобре-  │           │               │              │увелич. на 20%                    │(расчетной) │налогообложения,│            │               │от      │                                             │                                      │периоде        │в соответствии │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │ции      │             │           │                  │              │      от эмитента на            │ купонов в     │               │   руб.       │                                     │                    │ цены, руб.    │           │              │          │тении ЦБ  │           │               │              │                                  │ценой, руб. │      руб.      │            │               │эмитента│                                             │                                      │               │со справочником│               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │     начало отчетного           │  отчетном     │               │              │                                     │                    │               │           │              │          │          │           │               │              │                                  │            │                │            │               │до      │                                             │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │       (налогового)             │(налоговом)    │               │              │                                     │                    │               │           │              │          │          │           │               │              │                                  │            │                │            │               │начала  │                                             │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │         периода                │  периоде,     │               │              │                                     │                    │               │           │              │          │          │           │               │              │                                  │            │                │            │               │налого- │                                             │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │                                │    руб.       │               │              │                                     │                    │               │           │              │          │          │           │               │              │                                  │            │                │            │               │вого    │                                             │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │                                │               │               │              │                                     │                    │               │           │              │          │          │           │               │              │                                  │            │                │            │               │периода │                                             │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │                                │               │               │              │                                     │                    │               │           │              │          │          │           │               │              │                                  │            │                │            │               │(1 - да,│                                             │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │                                │               │               │              │                                     │                    │               │           │              │          │          │           │               │              │                                  │            │                │            │               │0 - нет)│                                             │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │                                │               │               │              │                                     │                    │               │           │              │          │          │           │               │              │                                  │            │                │            │               │        │                                             │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │                                │               │               │              │                                     │                    │               │           │              │          │          │           │               │              │                                  │            │                │            │               │        │                                             │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              ├─────────┬──────────────────────┤               │               │              ├────────────────────┬────────────────┤                    │               │           │              │          │          │           │               │              ├───────────┬───────────┬──────────┤            │                │            │               │        ├───────────┬──────────┬──────────┬───────────┼──────────────┬───────────┬───────────┤               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │Период,  │     Сумма, руб.      │               │               │              │      Всего         │  в том числе:  │                    │               │           │              │          │          │           │               │              │Цена, в    │ Источник  │  Дата    │            │                │            │               │        │ 1 купон в │2 купон в │3 купон в │4 купон в  │  процентные  │ процентные│ доходы от │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │дней     │                      │               │               │              │                    │суммы % дохода, │                    │               │           │              │          │          │           │               │              │  % от     │информации │котировки │            │                │            │               │        │  отчетном │отчетном  │отчетном  │отчетном   │доходы прошлых│  доходы   │реализации │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │         │                      │               │               │              │                    │  учтенные при  │                    │               │           │              │          │          │           │               │              │номинала   │           │          │            │                │            │               │        │  периоде  │ периоде  │ периоде  │ периоде   │  налоговых   │ текущего  │           │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │         │                      │               │               │              │                    │налогообложении │                    │               │           │              │          │          │           │               │              │           │           │          │            │                │            │               │        │           │          │          │           │   периодов   │налогового │           │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │         │                      │               │               │              │                    │   до начала    │                    │               │           │              │          │          │           │               │              │           │           │          │            │                │            │               │        │           │          │          │           │              │  периода  │           │               │               │               ├────────────────┬─────────────────┤            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │         │                      │               │               │              │                    │    текущего    │                    │               │           │              │          │          │           │               │              │           │           │          │            │                │            │               │        │           │          │          │           │              │           │           │               │               │               │  для сделки    │    для сделки   │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │         │                      │               │               │              │                    │   отчетного    │                    │               │           │              │          │          │           │               │              │           │           │          │            │                │            │               │        │           │          │          │           │              │           │           │               │               │               │  реализации    │   приобретения  │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │         │                      │               │               │              │                    │  (налогового)  │                    │               │           │              │          │          │           │               │              │           │           │          │            │                │            │               │        │           │          │          │           │              │           │           │               │               │               │                │                 │            │           │            │            │     │\n" +
"│           │                    │             │           │         │             │           │                  │              │         │                      │               │               │              │                    │    периода     │                    │               │           │              │          │          │           │               │              │           │           │          │            │                │            │               │        │           │          │          │           │              │           │           │               │               │               │                │                 │            │           │            │            │     │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼─────────┼─────────────┼───────────┼──────────────────┼──────────────┼─────────┼──────────────────────┼───────────────┼───────────────┼──────────────┼────────────────────┼────────────────┼────────────────────┼───────────────┼───────────┼──────────────┼──────────┼──────────┼───────────┼───────────────┼──────────────┼───────────┼───────────┼──────────┼────────────┼────────────────┼────────────┼───────────────┼────────┼───────────┼──────────┼──────────┼───────────┼──────────────┼───────────┼───────────┼───────────────┼───────────────┼───────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤\n" +
"│  1        │   2                │     3       │     4     │     5   │     6       │     7     │      8           │      9       │   10    │           11         │     12        │     13        │    14        │       15           │       16       │          17        │     18        │     19    │     20       │     21   │     22   │      23   │      24       │      25      │   26      │    27     │   28     │     29     │       30       │      31    │     32        │    Т1  │     Т2    │   Т3     │   Т4     │   Т5      │      Т6      │    Т7     │    Т8     │      Т9       │     Т10       │     Т11       │      Т12       │        Т13      │    Т14     │    Т15    │    Т16     │    Т17     │ Т18 │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼─────────┼─────────────┼───────────┼──────────────────┼──────────────┼─────────┼──────────────────────┼───────────────┼───────────────┼──────────────┼────────────────────┼────────────────┼────────────────────┼───────────────┼───────────┼──────────────┼──────────┼──────────┼───────────┼───────────────┼──────────────┼───────────┼───────────┼──────────┼────────────┼────────────────┼────────────┼───────────────┼────────┼───────────┼──────────┼──────────┼───────────┼──────────────┼───────────┼───────────┼───────────────┼───────────────┼───────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤";

PRIVATE VAR TableHeader_0303 =
"┌───────────┬────────────────────┬─────────────┬───────────┬──────────┬─────────┬──────────┬──────────┬─────────────────┬───────────┬────────────┬─────────────┬─────────────┬─────────────┬────────────┬─────────────────┬────────────────────┬────────────┬────────────┬────────────┬─────────────┬─────────────┬──────────────┬──────────────┬────────────────────────────────────┬─────────────┬─────────────────┬──────────────┬────────────┬──────────────────────────────────┬────────────┬───────────┬────────────┬────────────┬─────┐\n" +
"│ Код       │Выпуск              │   Номер     │   Дата    │   Дата   │Номинал, │   Дата   │  Дата    │Средневзвешенная │Количество │    Цена    │  Стоимость  │ Процентный  │ Процентный  │ Процентный │    Доходы от    │Расчетная цена ФИСС,│   Сумма    │ Комиссия,  │Номер сделки│    Дата     │Дата перехода│     Цена     │  Стоимость   │Максимальная цена на дату           │   Сумма     │    Стоимость    │  Комиссия,   │Расходы при │      Дата переквалификации       │Контрагент  │ Контрагент│ГО/филиал   │ГО/филиал   │Нало-│\n" +
"│бумаги     │ценной              │  сделки     │заключения │ перехода │  руб.   │размещения│погашения │цена размещения, │бумаг, шт. │реализации, │ реализации, │  доход за   │  доход за   │   доход,   │   реализации    │ уменьшенная на 20%,│ отклонения │ уплаченная │приобретения│ заключения  │    права    │приобретения, │приобретения, │заключения сделки, сложивш.         │превышения   │  приобретенных  │уплаченная при│реализации, │        сделки РЕПО/Займа         │ по сделке  │ по сделке │по сделке   │по сделке   │говая│\n" +
"│           │бумаги              │реализации   │  сделки   │   права  │         │          │          │  % от номинала  │           │    % от    │     руб.    │период с даты│период с даты│начисленный │       для       │ в % от номинала    │фактической │    при     │            │   сделки    │собств-ти при│    в % от    │     руб.     │на ОРЦБ; расчетная цена для         │стоимости    │  ценных бумаг,  │приобретении, │    руб.    │                                  │реализации  │приобрете- │реализации  │приобретения│груп-│\n" +
"│           │                    │             │реализации │ собств-ти│         │          │          │                 │           │  номинала  │             │приобретения │приобретения │за отчетный │      целей      │                    │выручки ниже│реализации, │            │приобретения │приобретении │   номинала   │              │ЦБ не обращ. на ОРЦБ (расч.         │приобретения │ принимаемая для │     руб.     │            │                                  │            │ния        │            │            │па   │\n" +
"│           │                    │             │    ЦБ     │    при   │         │          │          │                 │           │            │             │   до даты   │   по дату   │(налоговый) │налогообложения, │                    │  рыночной  │    руб.    │            │     ЦБ      │     ЦБ      │              │              │цена ЦБ, приобр.по срочн.           │над рыночной │      целей      │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │реализации│         │          │          │                 │           │            │             │   начала    │ реализации, │период, руб.│      руб.       │                    │(расчетной) │            │            │             │             │              │              │сделке), увелич. на 20%             │(расчетной)  │налогообложения, │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │    ЦБ    │         │          │          │                 │           │            │             │  отчетного  │    руб.     │            │                 │                    │ цены, руб. │            │            │             │             │              │              │                                    │ценой, руб.  │      руб.       │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │периода, руб.│             │            │                 │                    │            │            │            │             │             │              │              │                                    │             │                 │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │                                    │             │                 │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │                                    │             │                 │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │                                    │             │                 │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │                                    │             │                 │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │                                    │             │                 │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │                                    │             │                 │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │                                    │             │                 │              │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │                                    │             │                 │              │            ├────────────────┬─────────────────┤            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              ├─────────────┬───────────┬──────────┤             │                 │              │            │  для сделки    │    для сделки   │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │Цена, в % от │ Источник  │  Дата    │             │                 │              │            │  реализации    │   приобретения  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │  номинала   │информации │котировки │             │                 │              │            │                │                 │            │           │            │            │     │\n" +
"│           │                    │             │           │          │         │          │          │                 │           │            │             │             │             │            │                 │                    │            │            │            │             │             │              │              │             │           │          │             │                 │              │            │                │                 │            │           │            │            │     │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼─────────┼──────────┼──────────┼─────────────────┼───────────┼────────────┼─────────────┼─────────────┼─────────────┼────────────┼─────────────────┼────────────────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼──────────────┼─────────────┼───────────┼──────────┼─────────────┼─────────────────┼──────────────┼────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤\n" +
"│  1        │   2                │     3       │     4     │     5    │    6    │    7     │     8    │        9        │    10     │     11     │     12      │     13      │     14      │     15     │       16        │          17        │     18     │     19     │     20     │     21      │     22      │      23      │      24      │     25      │    26     │    27    │     28      │       29        │      30      │     31     │      Т1        │        Т2       │    Т3      │     Т4    │    Т5      │     Т6     │ Т7  │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼─────────┼──────────┼──────────┼─────────────────┼───────────┼────────────┼─────────────┼─────────────┼─────────────┼────────────┼─────────────────┼────────────────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼──────────────┼─────────────┼───────────┼──────────┼─────────────┼─────────────────┼──────────────┼────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤";

PRIVATE VAR TableHeader_0304 =
"┌───────────┬────────────────────┬─────────────┬───────────┬──────────┬───────────┬────────┬────────────┬───────────────────┬────────────────────┬────────────┬────────────┬────────────┬─────────────┬─────────────┬──────────────┬───────────────────┬────────────────────────────┬─────────────┬─────────────────┬──────────────┬────────────┬───────────┬────────────┬───────────┬────────────┬───────────┬────────────┬──────────┬────────────┬──────────┬────────────┬──────────────────────────────────┬────────────┬───────────┬────────────┬────────────┬─────┐\n" +
"│ Код       │Выпуск              │  Номер      │   Дата    │   Дата   │Количество │  Код   │    Цена    │Стоимость          │Расчетная цена ФИСС,│   Сумма    │ Комиссия,  │Номер сделки│    Дата     │Дата перехода│     Цена     │ Стоимость         │ Максимальная цена на дату  │   Сумма     │    Стоимость    │  Комиссия,   │Расходы при │Код валюты │Цена покупки│Код валюты │Цена продажи│Курс ЦБ РФ │ Курс ЦБ РФ │Курс ЦБ РФ│ Курс ЦБ РФ │Курс      │Курс        │      Дата переквалификации       │Контрагент  │ Контрагент│ГО/филиал   │ГО/филиал   │Нало-│\n" +
"│бумаги     │ценной              │  сделки     │заключения │ перехода │бумаг, шт. │ валюты │реализации, │реализации         │ уменьшенная на 20%,│ отклонения │ уплаченная │приобретения│ заключения  │    права    │приобретения, │приобретения       │   заключения сделки,       │превышения   │  приобретенных  │уплаченная при│реализации, │   цены    │  в валюте  │   цены    │  в валюте  │  на дату  │  на дату   │ на дату  │  на дату   │пересчета │пересчета   │        сделки РЕПО/Займа         │ по сделке  │ по сделке │по сделке   │по сделке   │говая│\n" +
"│           │бумаги              │реализации   │  сделки   │   права  │           │номинала│  в валюте  │                   │ в валюте номинала  │фактической │    при     │            │   сделки    │собств-ти при│   в валюте   │                   │сложивш. на ОРЦБ, расчетная │стоимости    │  ценных бумаг,  │приобретении, │    руб.    │  покупки  │    цены    │  продажи  │    цены    │заключения │ заключения │реализации│приобретения│из валюты │из валюты   │                                  │реализации  │приобрете- │реализации  │приобретения│груп-│\n" +
"│           │                    │             │реализации │ собств-ти│           │        │  номинала  │                   │                    │выручки ниже│реализации, │            │приобретения │приобретении │   номинала   │                   │ цена для ЦБ не обращ. на   │приобретения │ принимаемая для │     руб.     │            │           │            │           │            │  сделки   │   сделки   │          │            │расчетов  │расчетов    │                                  │            │ния        │            │            │па   │\n" +
"│           │                    │             │    ЦБ     │    при   │           │        │            │                   │                    │  рыночной  │    руб     │            │     ЦБ      │     ЦБ      │              │                   │   ОРЦБ (расч. цена ЦБ,     │над рыночной │      целей      │              │            │           │            │           │            │реализацию │приобретение│          │            │реализации│приобретения│                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │реализации│           │        │            │                   │                    │(расчетной) │            │            │             │             │              │                   │ приобр.по срочн. сделке),  │(расчетной)  │налогообложения, │              │            │           │            │           │            │           │            │          │            │в валюту  │в валюту    │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │    ЦБ    │           │        │            │                   │                    │ цены, руб. │            │            │             │             │              │                   │      увелич. на 20%        │ценой, руб.  │      руб.       │              │            │           │            │           │            │           │            │          │            │номинала  │номинала    │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                   │                    │            │            │            │             │             │              │                   │                            │             │                 │              │            │           │            │           │            │           │            │          │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                   │                    │            │            │            │             │             │              │                   │                            │             │                 │              │            │           │            │           │            │           │            │          │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                   │                    │            │            │            │             │             │              │                   │                            │             │                 │              │            │           │            │           │            │           │            │          │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            ├──────────┬────────┤                    │            │            │            │             │             │              ├────────────┬──────┼──────┬──────────┬──────────┤             │                 │              │            │           │            │           │            │           │            │          │            │          │            ├────────────────┬─────────────────┤            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │ в валюте │   в    │                    │            │            │            │             │             │              │  в валюте  │  в   │Цена, │ Источник │  Дата    │             │                 │              │            │           │            │           │            │           │            │          │            │          │            │  для сделки    │    для сделки   │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │ номинала │ рублях │                    │            │            │            │             │             │              │  номинала  │рублях│ руб. │информации│котировки │             │                 │              │            │           │            │           │            │           │            │          │            │          │            │  реализации    │   приобретения  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │          │        │                    │            │            │            │             │             │              │            │      │      │          │          │             │                 │              │            │           │            │           │            │           │            │          │            │          │            │                │                 │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │          │        │                    │            │            │            │             │             │              │            │      │      │          │          │             │                 │              │            │           │            │           │            │           │            │          │            │          │            │                │                 │            │           │            │            │     │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼───────────┼────────┼────────────┼──────────┼────────┼────────────────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼──────┼──────┼──────────┼──────────┼─────────────┼─────────────────┼──────────────┼────────────┼───────────┼────────────┼───────────┼────────────┼───────────┼────────────┼──────────┼────────────┼──────────┼────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤\n" +
"│  1        │   2                │    3        │     4     │     5    │     6     │   7    │     8      │    9     │  10    │          11        │     12     │     13     │     14     │     15      │     16      │      17      │     18     │  19  │  20  │    21    │    22    │     23      │       24        │      25      │     26     │    Т1     │     Т2     │    Т3     │     Т4     │    Т5     │     Т6     │    Т7    │     Т8     │    Т9    │     Т10    │      Т11       │        Т12      │    Т13     │     Т14   │    Т15     │     Т16    │ Т17 │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼───────────┼────────┼────────────┼──────────┼────────┼────────────────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼──────┼──────┼──────────┼──────────┼─────────────┼─────────────────┼──────────────┼────────────┼───────────┼────────────┼───────────┼────────────┼───────────┼────────────┼──────────┼────────────┼──────────┼────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤";

PRIVATE VAR TableHeader_0305 =
"┌───────────┬────────────────────┬─────────────┬───────────┬──────────┬───────────┬────────┬────────────┬──────────────────────────────────┬──────────────────────────────────┬────────────────────────────────────────────────┬───────────────────────────────────┬────────────┬──────────────────────────────────┬───────────────────────────────────────┬────────────────────┬────────────┬────────────┬────────────┬─────────────┬─────────────┬──────────────┬───────────────────────────────────┬───────────────────────────────────┬───────────────────────────────┬─────────────┬─────────────────┬──────────────┬────────────┬───────────┬───────────┬───────────┬────────────┬──────────┬────────────┬───────────┬──────────────────────────────────────┬───────────────┬───────────────┬───────────────┬──────────────────────────────────┬────────────┬───────────┬────────────┬────────────┬─────┐\n" +
"│ Код       │Выпуск              │   Номер     │   Дата    │   Дата   │Количество │  Код   │    Цена    │ Стоимость                        │    НКД                           │               Процентный доход,                │          Купонный доход,          │ Процентный │               Доходы,            │         Выручка от реализации         │Расчетная цена ФИСС,│   Сумма    │ Комиссия,  │Номер сделки│    Дата     │Дата перехода│     Цена     │ Стоимость                         │    НКД                            │  Максимальная цена на дату    │   Сумма     │    Стоимость    │  Комиссия,   │Расходы при │Код валюты │Код валюты │Курс ЦБ РФ │ Курс ЦБ РФ │Курс ЦБ РФ│ Курс ЦБ РФ │ Отметка о │     НКД,                             │Сальдо доходов │Количество     │Дата выплаты   │      Дата переквалификации       │Контрагент  │ Контрагент│ГО/филиал   │ГО/филиал   │Нало-│\n" +
"│бумаги     │ценной              │  сделки     │заключения │ перехода │бумаг, шт. │ валюты │реализации, │реализации                        │полученный                        │              учтенный для целей                │           полученный от           │   доход,   │             полученные           │               для целей               │ уменьшенная на 20%,│ отклонения │ уплаченная │приобретения│ заключения  │    права    │приобретения, │приобретения                       │ уплаченный                        │ заключения сделки, сложивш.   │превышения   │  приобретенных  │уплаченная при│реализации, │   цены    │   цены    │  на дату  │  на дату   │ на дату  │  на дату   │  наличии  │уплаченный при                        │при погашении  │купонов,       │по последнему  │        сделки РЕПО/Займа         │ по сделке  │ по сделке │по сделке   │по сделке   │говая│\n" +
"│           │бумаги              │реализации   │  сделки   │   права  │           │номинала│    % от    │                                  │    при                           │               налогообложения в                │            эмитента при           │начисленный │                 при              │         налогообложения, руб.         │ в % от номинала    │фактической │    при     │            │   сделки    │собств-ти при│    в % от    │                                   │    при                            │на ОРЦБ; расчетная цена для ЦБ │стоимости    │  ценных бумаг,  │приобретении, │    руб.    │  покупки  │  продажи  │заключения │ заключения │реализации│приобретения│  выплат   │приобретении,                         │ купона, руб.  │подлежащих     │купону         │                                  │реализации  │приобрете- │реализации  │приобретения│груп-│\n" +
"│           │                    │             │реализации │ собств-ти│           │        │  номинала  │                                  │реализации                        │             предыдущем налоговом               │         погашении купонов         │за отчетный │              частичном           │                                       │                    │выручки ниже│реализации, │            │приобретения │приобретении │   номинала   │                                   │приобретении                       │не обращ. на ОРЦБ (расч. цена  │приобретения │ принимаемая для │     руб.     │            │           │           │  сделки   │  сделки    │          │            │ купона от │ уменьшающий,                         │               │полученнию     │в отчетном     │                                  │            │ния        │            │            │па   │\n" +
"│           │                    │             │    ЦБ     │    при   │           │        │            │                                  │                                  │                периоде, но не                  │             в отчетном            │(налоговый) │              погашении           │                                       │                    │  рыночной  │    руб.    │            │     ЦБ      │     ЦБ      │              │                                   │                                   │ЦБ, приобр.по срочн. сделке),  │над рыночной │      целей      │              │            │           │           │реализации │приобретения│          │            │эмитента до│     руб.                             │               │в отчетном     │периоде        │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │реализации│           │        │            │                                  │                                  │            полученный от эмитента              │            (налоговом)            │период, руб.│              номинала            │                                       │                    │(расчетной) │            │            │             │             │              │                                   │                                   │        увелич. на 20%         │(расчетной)  │налогообложения, │              │            │           │           │           │            │          │            │  начала   │                                      │               │периоде        │в соответствии │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │    ЦБ    │           │        │            │                                  │                                  │              на начало отчетного               │              периоде              │            │                                  │                                       │                    │ цены, руб. │            │            │             │             │              │                                   │                                   │                               │ценой, руб.  │      руб.       │              │            │           │           │           │            │          │            │налогового │                                      │               │               │со справочником│                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                                  │                                  │             (налогового) периода               │                                   │            │                                  │                                       │                    │            │            │            │             │             │              │                                   │                                   │                               │             │                 │              │            │           │           │           │            │          │            │периода (1 │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                                  │                                  │                                                │                                   │            │                                  │                                       │                    │            │            │            │             │             │              │                                   │                                   │                               │             │                 │              │            │           │           │           │            │          │            │ ─ да, 0 ─ │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                                  │                                  │                                                │                                   │            │                                  │                                       │                    │            │            │            │             │             │              │                                   │                                   │                               │             │                 │              │            │           │           │           │            │          │            │   нет)    │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                                  │                                  │                                                │                                   │            │                                  │                                       │                    │            │            │            │             │             │              │                                   │                                   │                               │             │                 │              │            │           │           │           │            │          │            │           │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                                  │                                  │                                                │                                   │            │                                  │                                       │                    │            │            │            │             │             │              │                                   │                                   │                               │             │                 │              │            │           │           │           │            │          │            │           │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                                  │                                  │                                                │                                   │            │                                  │                                       │                    │            │            │            │             │             │              │                                   │                                   │                               │             │                 │              │            │           │           │           │            │          │            │           │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                                  │                                  │                                                │                                   │            │                                  │                                       │                    │            │            │            │             │             │              │                                   │                                   │                               │             │                 │              │            │           │           │           │            │          │            │           │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                                  │                                  │                                                │                                   │            │                                  │                                       │                    │            │            │            │             │             │              │                                   │                                   │                               │             │                 │              │            │           │           │           │            │          │            │           │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │                                  │                                  │                                                │                                   │            │                                  │                                       │                    │            │            │            │             │             │              │                                   │                                   │                               │             │                 │              │            │           │           │           │            │          │            │           │                                      │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            ├───────────┬──────────────────────┼───────────┬──────────────────────┼────────────────┬────────┬──────────────────────┼────────────┬──────────────────────┤            ├───────────┬──────────────────────┼──────────────────────┬────────────────┤                    │            │            │            │             │             │              ├────────────┬──────────────────────┼────────────┬──────────────────────┼────────┬───────────┬──────────┤             │                 │              │            │           │           │           │            │          │            │           ├──────────────┬───────────┬───────────┤               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │  Сумма в  │     Сумма, руб.      │  Сумма в  │     Сумма, руб.      │  Период, дней  │Сумма в │     Сумма, руб.      │  Сумма в   │     Сумма, руб.      │            │  Сумма в  │     Сумма, руб.      │        Всего         │  в том числе:  │                    │            │            │            │             │             │              │  Сумма в   │     Сумма, руб.      │  Сумма в   │     Сумма, руб.      │Цена, в │ Источник  │  Дата    │             │                 │              │            │           │           │           │            │          │            │           │  процентные  │ процентные│ доходы от │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │  валюте   │                      │  валюте   │                      │                │ валюте │                      │   валюте   │                      │            │  валюте   │                      │                      │суммы % дохода, │                    │            │            │            │             │             │              │   валюте   │                      │   валюте   │                      │  % от  │информации │котировки │             │                 │              │            │           │           │           │            │          │            │           │доходы прошлых│  доходы   │реализации │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │ номинала  │                      │ номинала  │                      │                │номинала│                      │  номинала  │                      │            │ номинала  │                      │                      │  учтенные при  │                    │            │            │            │             │             │              │  номинала  │                      │  номинала  │                      │номинала│           │          │             │                 │              │            │           │           │           │            │          │            │           │  налоговых   │ текущего  │           │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │           │                      │           │                      │                │        │                      │            │                      │            │           │                      │                      │налогообложении │                    │            │            │            │             │             │              │            │                      │            │                      │        │           │          │             │                 │              │            │           │           │           │            │          │            │           │   периодов   │налогового │           │               │               │               │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │           │                      │           │                      │                │        │                      │            │                      │            │           │                      │                      │   до начала    │                    │            │            │            │             │             │              │            │                      │            │                      │        │           │          │             │                 │              │            │           │           │           │            │          │            │           │              │  периода  │           │               │               │               ├────────────────┬─────────────────┤            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │           │                      │           │                      │                │        │                      │            │                      │            │           │                      │                      │    текущего    │                    │            │            │            │             │             │              │            │                      │            │                      │        │           │          │             │                 │              │            │           │           │           │            │          │            │           │              │           │           │               │               │               │  для сделки    │    для сделки   │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │           │                      │           │                      │                │        │                      │            │                      │            │           │                      │                      │   отчетного    │                    │            │            │            │             │             │              │            │                      │            │                      │        │           │          │             │                 │              │            │           │           │           │            │          │            │           │              │           │           │               │               │               │  реализации    │   приобретения  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │           │                      │           │                      │                │        │                      │            │                      │            │           │                      │                      │  (налогового)  │                    │            │            │            │             │             │              │            │                      │            │                      │        │           │          │             │                 │              │            │           │           │           │            │          │            │           │              │           │           │               │               │               │                │                 │            │           │            │            │     │\n" +
"│           │                    │             │           │          │           │        │            │           │                      │           │                      │                │        │                      │            │                      │            │           │                      │                      │    периода     │                    │            │            │            │             │             │              │            │                      │            │                      │        │           │          │             │                 │              │            │           │           │           │            │          │            │           │              │           │           │               │               │               │                │                 │            │           │            │            │     │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼───────────┼────────┼────────────┼───────────┼──────────────────────┼───────────┼──────────────────────┼────────────────┼────────┼──────────────────────┼────────────┼──────────────────────┼────────────┼───────────┼──────────────────────┼──────────────────────┼────────────────┼────────────────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼──────────────────────┼────────────┼──────────────────────┼────────┼───────────┼──────────┼─────────────┼─────────────────┼──────────────┼────────────┼───────────┼───────────┼───────────┼────────────┼──────────┼────────────┼───────────┼──────────────┼───────────┼───────────┼───────────────┼───────────────┼───────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤\n" +
"│  1        │   2                │     3       │     4     │     5    │     6     │   7    │     8      │     9     │           10         │    11     │           12         │       13       │   14   │           15         │     16     │          17          │     18     │    19     │           20         │           21         │       22       │          23        │     24     │     25     │     26     │     27      │     28      │      29      │     30     │           31         │     32     │           33         │   34   │    35     │    36    │     37      │       38        │      39      │     40     │    Т1     │    Т2     │    Т3     │     Т4     │    Т5    │     Т6     │    Т7     │      Т8      │    Т9     │    Т10    │     Т11       │      Т12      │     Т13       │      Т14       │        Т15      │    Т16     │    Т17    │    Т18     │    Т19     │ Т20 │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼───────────┼────────┼────────────┼───────────┼──────────────────────┼───────────┼──────────────────────┼────────────────┼────────┼──────────────────────┼────────────┼──────────────────────┼────────────┼───────────┼──────────────────────┼──────────────────────┼────────────────┼────────────────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼──────────────────────┼────────────┼──────────────────────┼────────┼───────────┼──────────┼─────────────┼─────────────────┼──────────────┼────────────┼───────────┼───────────┼───────────┼────────────┼──────────┼────────────┼───────────┼──────────────┼───────────┼───────────┼───────────────┼───────────────┼───────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤";

PRIVATE VAR TableHeader_0306 =
"┌───────────┬────────────────────┬─────────────┬───────────┬──────────┬───────┬────────┬──────────┬──────────┬───────────┬────────────┬──────────────────────────────────┬─────────────────┬────────────────────┬────────────────────┬────────────┬────────────┬────────────┬─────────────┬─────────────┬──────────────┬───────────────────────────────────┬────────────────────────────────────┬─────────────┬─────────────────┬──────────────┬────────────┬──────────┬────────────┬──────────────────────────────────┬────────────┬───────────┬────────────┬────────────┬─────┐\n" +
"│  Код      │Выпуск              │   Номер     │   Дата    │   Дата   │Номинал│  Код   │   Дата   │  Дата    │Количество │    Цена    │ Стоимость                        │ Процентный      │Доходы от реализации│Расчетная цена ФИСС,│   Сумма    │ Комиссия,  │Номер сделки│    Дата     │Дата перехода│     Цена     │ Стоимость                         │        Максимальная цена на        │   Сумма     │    Стоимость    │  Комиссия,   │Расходы при │Курс ЦБ РФ│ Курс ЦБ РФ │      Дата переквалификации       │Контрагент  │ Контрагент│ГО/филиал   │ГО/филиал   │Нало-│\n" +
"│ценной     │ценной              │  сделки     │заключения │ перехода │       │ валюты │размещения│погашения │бумаг, шт. │реализации, │реализации                        │  доход за       │     для целей      │ уменьшенная на 20%,│ отклонения │ уплаченная │приобретения│ заключения  │    права    │приобретения, │приобретения                       │          дату заключения           │превышения   │  приобретенных  │уплаченная при│реализации, │ на дату  │  на дату   │        сделки РЕПО/Займа         │ по сделке  │ по сделке │по сделке   │по сделке   │говая│\n" +
"│бумаги     │бумаги              │реализации   │  сделки   │   права  │       │номинала│          │          │           │    % от    │                                  │период с даты    │  налогообложения,  │ в % от номинала    │фактической │    при     │            │   сделки    │собств-ти при│    в % от    │                                   │       сделки, сложивш. на          │стоимости    │  ценных бумаг,  │приобретении, │    руб.    │реализации│приобретения│                                  │реализации  │приобрете- │реализации  │приобретения│груп-│\n" +
"│           │                    │             │реализации │ собств-ти│       │        │          │          │           │  номинала  │                                  │приобретения     │        руб.        │                    │выручки ниже│реализации, │            │приобретение │приобретении │   номинала   │                                   │       ОРЦБ; расчетная цена         │приобретения │ принимаемая для │     руб.     │            │          │            │                                  │            │ния        │            │            │па   │\n" +
"│           │                    │             │     ЦБ    │    при   │       │        │          │          │           │            │                                  │   до даты       │                    │                    │  рыночной  │    руб.    │            │     ЦБ      │     ЦБ      │              │                                   │        для ЦБ не обращ. на         │над рыночной │      целей      │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │реализации│       │        │          │          │           │            │                                  │   начала        │                    │                    │(расчетной) │            │            │             │             │              │                                   │       ОРЦБ (расч. цена ЦБ,         │(расчетной)  │налогообложения, │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │    ЦБ    │       │        │          │          │           │            │                                  │  отчетного      │                    │                    │ цены, руб. │            │            │             │             │              │                                   │         приобр.по срочн.           │ценой, руб.  │      руб.       │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │                                  │   периода       │                    │                    │            │            │            │             │             │              │                                   │        сделке), увелич. на         │             │                 │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │                                  │                 │                    │                    │            │            │            │             │             │              │                                   │                20%                 │             │                 │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │                                  │                 │                    │                    │            │            │            │             │             │              │                                   │                                    │             │                 │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │                                  │                 │                    │                    │            │            │            │             │             │              │                                   │                                    │             │                 │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │                                  │                 │                    │                    │            │            │            │             │             │              │                                   │                                    │             │                 │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │                                  │                 │                    │                    │            │            │            │             │             │              │                                   │                                    │             │                 │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │                                  │                 │                    │                    │            │            │            │             │             │              │                                   │                                    │             │                 │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │                                  │                 │                    │                    │            │            │            │             │             │              │                                   │                                    │             │                 │              │            │          │            │                                  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │                                  │                 │                    │                    │            │            │            │             │             │              │                                   │                                    │             │                 │              │            │          │            ├────────────────┬─────────────────┤            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            ├───────────┬──────────────────────┼────────┬────────┤                    │                    │            │            │            │             │             │              ├────────────┬──────────────────────┼─────────────┬───────────┬──────────┤             │                 │              │            │          │            │  для сделки    │    для сделки   │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │  Сумма в  │     Сумма, руб.      │  в     │   в    │                    │                    │            │            │            │             │             │              │  Сумма в   │     Сумма, руб.      │Цена, в % от │ Источник  │  Дата    │             │                 │              │            │          │            │  реализации    │   приобретения  │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │  валюте   │                      │ валюте │ рублях │                    │                    │            │            │            │             │             │              │   валюте   │                      │  номинала   │информации │котировки │             │                 │              │            │          │            │                │                 │            │           │            │            │     │\n" +
"│           │                    │             │           │          │       │        │          │          │           │            │ номинала  │                      │номинала│        │                    │                    │            │            │            │             │             │              │  номинала  │                      │             │           │          │             │                 │              │            │          │            │                │                 │            │           │            │            │     │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼───────┼────────┼──────────┼──────────┼───────────┼────────────┼───────────┼──────────────────────┼────────┼────────┼────────────────────┼────────────────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼──────────────────────┼─────────────┼───────────┼──────────┼─────────────┼─────────────────┼──────────────┼────────────┼──────────┼────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤\n" +
"│   1       │   2                │     3       │     4     │     5    │   6   │   7    │    8     │     9    │    10     │     11     │    12     │          13          │   14   │   15   │          16        │          17        │     18     │     19     │     20     │     21      │     22      │      23      │     24     │          25          │     26      │    27     │    28    │     29      │       30        │      31      │     32     │    Т1    │     Т2     │      Т3        │        Т4       │    Т5      │     Т6    │    Т7      │     Т8     │  Т9 │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼───────┼────────┼──────────┼──────────┼───────────┼────────────┼───────────┼──────────────────────┼────────┼────────┼────────────────────┼────────────────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼──────────────────────┼─────────────┼───────────┼──────────┼─────────────┼─────────────────┼──────────────┼────────────┼──────────┼────────────┼────────────────┼─────────────────┼────────────┼───────────┼────────────┼────────────┼─────┤";

PRIVATE VAR TableHeader_0310 =
"┌────────────┬───────────────┬─────────────────┬────────────┬───────────┬───────────────────────┬────────────────┬────────┬────────┬───────────────────────┬────────────────┬──────────────────────────────────────────────────┬──────────┬──────────┬────────────┬─────┬───────────┬──────────┬────────┬────────┬─────────┬──────┐\n" +
"│ Код бумаги │ Выпуск ценной │   Номер сделки  │ Вид сделки │   Дата    │  Дата перехода права  │   Количество   │  Код   │  Код   │   Дата оплаты ценных  │ Цена 1ой бумаги│         Сумма по договору (по сделке)            │   Иные   │Курс ЦБ РФ│ Курс ЦБ РФ │Курс │   Курс    │  Курс    │Признак │Контра- │ГО/филиал│Нало- │\n" +
"│            │               │                 │ (BUY/SELL) │заключения │  собствти на ценные   │   бумаг, шт.   │ валюты │ валюты │         бумаг         │  (для акций в  │                                                  │ расходы, │ на дату  │  на дату   │ на  │ пересчета │пересчета │частич- │гент по │по сделке│говая │\n" +
"│            │               │                 │            │  сделки   │        бумаги         │                │номинала│  цены  │                       │ валюте номинала│                                                  │относящие-│заключения│  перехода  │дату │цены/ст-ти │цены/ст-ти│  ной   │договору│         │группа│\n" +
"│            │               │                 │            │           ├───────────┬───────────┤                │        │        ├───────────┬───────────┤(в валюте цены),├────────────────┬────────────────┬────────────────┤   ся к   │ договора │   права    │опла-│в рублевый │ в валюту │ оплаты │(сделке)│         │      │\n" +
"│            │               │                 │            │           │ плановая  │фактическая│                │        │        │ плановая  │фактическая│ для облигаций  │  Стоимость по  │   НКД на дату  │ Общая сумма по │ срочной  │ (сделки) │собственнос-│ ты  │эквивалент │ номинала │  (Да.  │        │         │      │\n" +
"│            │               │                 │            │           │           │           │                │        │        │           │           │в % от номинала)│  договору (по  │ перехода права │   договору(по  │  сделке  │          │     ти     │     │           │          │  Нет)  │        │         │      │\n" +
"│            │               │                 │            │           │           │           │                │        │        │           │           │                │  сделке) без   │собственности, в│сделке) в валюте│          │          │            │     │           │          │        │        │         │      │\n" +
"│            │               │                 │            │           │           │           │                │        │        │           │           │                │  НДС, в валюте │валюте номинала │    договора    │          │          │            │     │           │          │        │        │         │      │\n" +
"│            │               │                 │            │           │           │           │                │        │        │           │           │                │     номинала   │                │                │          │          │            │     │           │          │        │        │         │      │\n" +
"├────────────┼───────────────┼─────────────────┼────────────┼───────────┼───────────┼───────────┼────────────────┼────────┼────────┼───────────┼───────────┼────────────────┼────────────────┼────────────────┼────────────────┼──────────┼──────────┼────────────┼─────┼───────────┼──────────┼────────┼────────┼─────────┼──────┤\n" +
"│     1      │       2       │        3        │      4     │     5     │     6     │     7     │        8       │    9   │   10   │     11    │     12    │       13       │       14       │       15       │       16       │    17    │    Т1    │     Т2     │ Т3  │    Т4     │    Т5    │   Т6   │   Т7   │    Т8   │  Т9  │\n" +
"├────────────┼───────────────┼─────────────────┼────────────┼───────────┼───────────┼───────────┼────────────────┼────────┼────────┼───────────┼───────────┼────────────────┼────────────────┼────────────────┼────────────────┼──────────┼──────────┼────────────┼─────┼───────────┼──────────┼────────┼────────┼─────────┼──────┤";

                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                              
PRIVATE MACRO WhereCondBond()
  return " RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_BOND+", fininstr.t_AvoirKind) > 0 ";
END;

/*Процентной облигацией считается облигация, относящаяся к одной из следующих налоговых групп:*/
PRIVATE MACRO WhereCondPC()
  return WhereCondBond() + " AND Rsb_SCTX.TXIsPercentAvoir(av.t_TaxGroup) = 1 ";
END;

/*Дисконтной облигацией считается облигация, относящаяся к одной из следующих налоговых групп:*/
PRIVATE MACRO WhereCondDiscount()
  return WhereCondBond() + " AND Rsb_SCTX.TXIsDiscountAvoir(av.t_TaxGroup) = 1 ";
END;

/*сделки с акциями, паями и депозитарными расписками*/
PRIVATE MACRO WhereCondShare()

  return   " (    RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_SHARE+", fininstr.t_AvoirKind) > 0 "
         + "   OR RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_DEPOSITORY_RECEIPT+", fininstr.t_AvoirKind) > 0 "
         + "   OR RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_INVESTMENT_SHARE+", fininstr.t_AvoirKind) > 0 "
         + " ) ";
END;

PRIVATE MACRO WhereCondNominalRUR()
  return " fininstr.t_FaceValueFI = 0 ";
END;


PRIVATE CLASS CFuturesReg_301( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*0301 отбираются сделки с акциями, паями и депозитарными расписками, номинированными в рублях */
     return " AND " + WhereCondNominalRUR();// + " AND " + WhereCondShare();
  END;


  MACRO Check(AvoirKind, TaxGroup)
    var ret = 0, rsd;
    var sql = RSDCommand("select (CASE WHEN 1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_SHARE+", ?) OR " +
                         "                  1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_DEPOSITORY_RECEIPT+", ?) OR " +
                         "                  1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_INVESTMENT_SHARE+", ?) THEN 1 ELSE 0 END) as CheckSum from dual");

    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.execute();

    rsd = TRsbDataSet(sql);
    if((rsd.moveNext()) and (rsd.CheckSum == 1))
     ret = 1;
    end;

    return ret; 
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( SHEET_0301 );

     m_Report.PrintHeader("N1_");

     m_Report.RegisterTable( "N1_MainTable", TableHeader_0301,
                 /*1  */     "N1_SecCode",   
                 /*2  */     "N1_SecName",  
                 /*3  */     "N1_CodeS", 
                 /*4  */     "N1_DZS",   
                 /*5  */     "N1_DDS",    
                 /*6  */     "N1_Qnty",      
                 /*7  */     "N1_VPrS",     
                 /*8  */     "N1_PrSvp", 
                 /*9  */     "N1_PrSrub",    
                 /*10 */     "N1_SumSvp",    
                 /*11 */     "N1_SumSrub",   
                 /*12 */     "N1_MinMrkt",   
                 /*13 */     "N1_DifS",  
                 /*14 */     "N1_ComS",  
                 /*15 */     "N1_CodeB", 
                 /*16 */     "N1_DZB",   
                 /*17 */     "N1_DDB",   
                 /*18 */     "N1_VPrB",  
                 /*19 */     "N1_PrBvp", 
                 /*20 */     "N1_PrBrub",    
                 /*21 */     "N1_SumBvp",    
                 /*22 */     "N1_SumBrub",   
                 /*23 */     "N1_MaxMrkt",   
                 /*24 */     "N1_MrktB", 
                 /*25 */     "N1_DMrktB",    
                 /*26 */     "N1_DifB",  
                 /*27 */     "N1_SumBtax",   
                 /*28 */     "N1_ComB",  
                 /*29 */     "N1_RashAll",   
                 /*Т1 */     "N1_CrSZ",  
                 /*Т2 */     "N1_CrBZ",  
                 /*Т3 */     "N1_CrSD",  
                 /*Т4 */     "N1_CrBD",  
                 /*Т5 */     "N1_DqualS",    
                 /*Т6 */     "N1_DqualB",    
                 /*Т7 */     "N1_ContS", 
                 /*Т8 */     "N1_ContB", 
                 /*Т9 */     "N1_FilS",  
                 /*Т10*/     "N1_FilB",  
                 /*Т11*/     "N1_SecType"               
                            );      

     m_Report.SetCellAutoSummaPoint( "Всего:",
                                 "N1_Qnty",6,               
                                 "N1_SumSvp",2,  
                                 "N1_SumSrub",2,     
                                 "N1_DifS",2,    
                                 "N1_ComS",2,                            
                                 "N1_SumBvp",2,  
                                 "N1_SumBrub",2,             
                                 "N1_DifB",2,    
                                 "N1_SumBtax",2, 
                                 "N1_ComB",2,    
                                 "N1_RashAll",2                                                         
                              );

     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                          "F23",   
                          "J23", 
                          "K23",
                          "M23",   
                          "N23",   
                          "U23", 
                          "V23",
                          "Z23",   
                          "AA23",
                          "AB23",   
                          "AC23"
                         );
  END;

  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )
     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N1_SecCode",    m_Report.SecCode(),     null,   /*1  */
                                 "N1_SecName",    m_Report.SecName(),     null,   /*2  */
                                 "N1_CodeS",      m_Report.CodeS(),       null,   /*3  */
                                 "N1_DZS",        m_Report.DZS(),         null,   /*4  */
                                 "N1_DDS",        m_Report.DDS(),         null,   /*5  */
                                 "N1_Qnty",       m_Report.Qnty(),        m_Report.QntyPrecision(),   /*6  */
                                 "N1_VPrS",       m_Report.VPrSNumber(),  null,   /*7  */
                                 "N1_PrSvp",      m_Report.PrSvp(),       null,   /*8  */
                                 "N1_PrSrub",     m_Report.PrSrub(),      null,   /*9  */
                                 "N1_SumSvp",     String(iif(m_Report.VPrS() != NATCUR, m_Report.SumSvp(), 0)),      null,   /*10 */
                                 "N1_SumSrub",    String(m_Report.SumSrub()),     null,   /*11 */
                                 "N1_MinMrkt",    m_Report.MinMrkt(),     null,   /*12 */
                                 "N1_DifS",       m_Report.DifS(),        null,   /*13 */
                                 "N1_ComS",       m_Report.ComS(),        null,   /*14 */
                                 "N1_CodeB",      m_Report.CodeB(),       null,   /*15 */
                                 "N1_DZB",        m_Report.DZB(),         null,   /*16 */
                                 "N1_DDB",        m_Report.DDB(),         null,   /*17 */
                                 "N1_VPrB",       m_Report.VPrBNumber(),  null,   /*18 */
                                 "N1_PrBvp",      m_Report.PrBvp(),       null,   /*19 */
                                 "N1_PrBrub",     m_Report.PrBrub(),      null,   /*20 */
                                 "N1_SumBvp",     String(iif(m_Report.VPrB() != NATCUR, m_Report.SumBvp(), 0)),      null,   /*21 */
                                 "N1_SumBrub",    String(m_Report.SumBrub()),     null,   /*22 */
                                 "N1_MaxMrkt",    m_Report.MaxMrkt(),     null,   /*23 */
                                 "N1_MrktB",      m_Report.MrktB(),       null,   /*24 */
                                 "N1_DMrktB",     m_Report.DMrktB(),      null,   /*25 */
                                 "N1_DifB",       m_Report.DifB(),        null,   /*26 */
                                 "N1_SumBtax",    String(m_Report.SumBtax()),     null,   /*27 */
                                 "N1_ComB",       m_Report.ComB(),        null,   /*28 */
                                 "N1_RashAll",    m_Report.RashAll(),     null,   /*29 */
                                 "N1_CrSZ",       m_Report.printCrSZ(),   null,   /*Т1 */
                                 "N1_CrBZ",       m_Report.printCrBZ(),   null,   /*Т2 */
                                 "N1_CrSD",       m_Report.printCrSD(),   null,   /*Т3 */
                                 "N1_CrBD",       m_Report.printCrBD(),   null,   /*Т4 */
                                 "N1_DqualS",     m_Report.DqualS(),      null,   /*Т5 */
                                 "N1_DqualB",     m_Report.DqualB(),      null,   /*Т6 */
                                 "N1_ContS",      m_Report.ContS(),       null,   /*Т7 */
                                 "N1_ContB",      m_Report.ContB(),       null,   /*Т8 */
                                 "N1_FilS",       m_Report.FilS(),        null,   /*Т9 */
                                 "N1_FilB",       m_Report.FilB(),        null,   /*Т10*/
                                 "N1_SecType",    m_Report.SecType(),     null    /*Т11*/
                               );

     elif( LineType == Строка_Итого )

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N1_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N1_SecCode",  "в том числе", null );

     end;
  END;         


  MACRO EndReport();
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N1_" );
  END;         

END;

PRIVATE CLASS CFuturesReg_302( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*0302 отбираются сделки с процентными облигациями, номинированными в рублях */
     return " AND " + WhereCondNominalRUR();// + " AND " + WhereCondPC();
  END;

  MACRO Check(AvoirKind, TaxGroup)
    var ret = 0, rsd;
    var sql = RSDCommand("select (CASE WHEN 1 = Rsb_SCTX.TXIsPercentAvoir(?) AND 1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_BOND+", ?) THEN 1 ELSE 0 END) as CheckSum from dual");

    sql.addParam( "", RSDBP_IN, TaxGroup );
    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.execute();

    rsd = TRsbDataSet(sql);
    if((rsd.moveNext()) and (rsd.CheckSum == 1))
     ret = 1;
    end;

   return ret; 
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( SHEET_0302 );

     m_Report.PrintHeader("N2_");

     m_Report.RegisterTable( "N2_MainTable", TableHeader_0302,
                 /*1  */     "N2_SecCode", 
                 /*2  */     "N2_SecName",   
                 /*3  */     "N2_CodeS", 
                 /*4  */     "N2_DZS",   
                 /*5  */     "N2_DDS",   
                 /*6  */     "N2_Qnty",  
                 /*7  */     "N2_PrSNom",    
                 /*8  */     "N2_SumSrub",   
                 /*9  */     "N2_NkdSvn",    
                 /*10 */     "N2_Tprev", 
                 /*11 */     "N2_NkdPrevVN", 
                 /*12 */     "N2_CoupVN",    
                 /*13 */     "N2_NkdRepRub", 
                 /*14 */     "N2_AmortVN",   
                 /*15 */     "N2_SumAllrub", 
                 /*16 */     "N2_NKDminusRub",   
                 /*17 */     "N2_MinMrkt",   
                 /*18 */     "N2_DifS",  
                 /*19 */     "N2_ComS",  
                 /*20 */     "N2_CodeB",     
                 /*21 */     "N2_DZB",   
                 /*22 */     "N2_DDB",   
                 /*23 */     "N2_PrBnom",    
                 /*24 */     "N2_SumBrub",   
                 /*25 */     "N2_NkdBVN",    
                 /*26 */     "N2_MaxMrkt",   
                 /*27 */     "N2_MrktB", 
                 /*28 */     "N2_DMrktB",    
                 /*29 */     "N2_DifB",  
                 /*30 */     "N2_SumBtax",   
                 /*31 */     "N2_ComB",  
                 /*32 */     "N2_RashAll",   
                 /*Т1 */     "N2_ifCoupPrev",    
                 /*Т2 */     "N2_CVN1",  
                 /*Т3 */     "N2_CVN2",  
                 /*Т4 */     "N2_CVN3",  
                 /*Т5 */     "N2_CVN4",  
                 /*Т6 */     "N2_NkdBprevRub",   
                 /*Т7 */     "N2_NkdBrepRub",    
                 /*Т8 */     "N2_NkdBsellRub",   
                 /*Т9 */     "N2_CoupCount", 
                 /*Т10*/     "N2_LastCoupDate",  
                 /*Т11*/     "N2_CoupSaldoRub",  
                 /*Т12*/     "N2_DqualS",    
                 /*Т13*/     "N2_DqualB",    
                 /*Т14*/     "N2_ContS", 
                 /*Т15*/     "N2_ContB", 
                 /*Т16*/     "N2_FilS",  
                 /*Т17*/     "N2_FilB",  
                 /*Т18*/     "N2_SecType"
                           );     


     m_Report.SetCellAutoSummaPoint( "Всего:",
                                "N2_Qnty",6,        
                                "N2_SumSrub",2, 
                                "N2_NkdSvn",2,      
                                "N2_NkdPrevVN",2,   
                                "N2_CoupVN",2,  
                                "N2_NkdRepRub",2,   
                                "N2_AmortVN",2, 
                                "N2_SumAllrub",2,   
                                "N2_NKDminusRub",2,     
                                "N2_DifS",2,    
                                "N2_ComS",2,                    
                                "N2_SumBrub",2,     
                                "N2_NkdBVN",2,              
                                "N2_DifB",2,    
                                "N2_SumBtax",2, 
                                "N2_ComB",2,    
                                "N2_RashAll",2,     
                                "N2_CVN1",2,    
                                "N2_CVN2",2,    
                                "N2_CVN3",2,    
                                "N2_CVN4",2,    
                                "N2_NkdBprevRub",2, 
                                "N2_NkdBrepRub",2,  
                                "N2_NkdBsellRub",2,                                     
                                "N2_CoupSaldoRub",2
                              );

     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubTotal( 29, 26 + MAXROWSHEET,
                           "F23",        
                           "H23",     
                           "I23",      
                           "K23",   
                           "L23",      
                           "M23",   
                           "N23",     
                           "O23",   
                           "P23", 
                           "R23",        
                           "S23",        
                           "X23",     
                           "Y23",      
                           "AC23",        
                           "AD23",     
                           "AE23",        
                           "AF23",     
                           "AH23",        
                           "AI23",        
                           "AJ23",        
                           "AK23",        
                           "AL23", 
                           "AM23",  
                           "AN23", 
                           "AQ23"
                         );
  END;


  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N2_SecCode",         m_Report.SecCode(),            null,   /*1  */
                                 "N2_SecName",         m_Report.SecName(),            null,   /*2  */
                                 "N2_CodeS",           m_Report.CodeS(),              null,   /*3  */
                                 "N2_DZS",             m_Report.DZS(),                null,   /*4  */
                                 "N2_DDS",             m_Report.DDS(),                null,   /*5  */
                                 "N2_Qnty",            m_Report.Qnty(),               m_Report.QntyPrecision(),   /*6  */
                                 "N2_PrSNom",          m_Report.PrSNom(),             null,   /*7  */
                                 "N2_SumSrub",         m_Report.SumSrub(),            null,   /*8  */
                                 "N2_NkdSvn",          m_Report.NkdSvn(),             null,   /*9  */
                                 "N2_Tprev",           m_Report.Tprev(),              null,   /*10 */
                                 "N2_NkdPrevVN",       String(m_Report.NkdPrevVN()),          null,   /*11 */
                                 "N2_CoupVN",          m_Report.CoupVN(),             null,   /*12 */
                                 "N2_NkdRepRub",       m_Report.NkdRepRub(),          null,   /*13 */
                                 "N2_AmortVN",         m_Report.AmortVN(),            null,   /*14 */
                                 "N2_SumAllrub",       String(m_Report.SumAllrub()),          null,   /*15 */
                                 "N2_NKDminusRub",     String(m_Report.NKDminusRub()),        null,   /*16 */
                                 "N2_MinMrkt",         m_Report.MinMrkt(),            null,   /*17 */
                                 "N2_DifS",            m_Report.DifS(),               null,   /*18 */
                                 "N2_ComS",            m_Report.ComS(),               null,   /*19 */
                                 "N2_CodeB",           m_Report.CodeB(),              null,   /*20 */
                                 "N2_DZB",             m_Report.DZB(),                null,   /*21 */
                                 "N2_DDB",             m_Report.DDB(),                null,   /*22 */
                                 "N2_PrBnom",          m_Report.PrBnom(),             null,   /*23 */
                                 "N2_SumBrub",         m_Report.SumBrub(),            null,   /*24 */
                                 "N2_NkdBVN",          m_Report.NkdBVN(),             null,   /*25 */
                                 "N2_MaxMrkt",         m_Report.MaxMrkt(),            null,   /*26 */
                                 "N2_MrktB",           m_Report.MrktB(),              null,   /*27 */
                                 "N2_DMrktB",          m_Report.DMrktB(),             null,   /*28 */
                                 "N2_DifB",            m_Report.DifB(),               null,   /*29 */
                                 "N2_SumBtax",         String(m_Report.SumBtax()),            null,   /*30 */
                                 "N2_ComB",            m_Report.ComB(),               null,   /*31 */
                                 "N2_RashAll",         m_Report.RashAll(),            null,   /*32 */
                                 "N2_ifCoupPrev",      m_Report.ifCoupPrev(),         null,   /*Т1 */
                                 "N2_CVN1",            m_Report.CVN1(),               null,   /*Т2 */
                                 "N2_CVN2",            m_Report.CVN2(),               null,   /*Т3 */
                                 "N2_CVN3",            m_Report.CVN3(),               null,   /*Т4 */
                                 "N2_CVN4",            m_Report.CVN4(),               null,   /*Т5 */
                                 "N2_NkdBprevRub",     m_Report.NkdBprevRub(),        null,   /*Т6 */
                                 "N2_NkdBrepRub",      m_Report.NkdBrepRub(),         null,   /*Т7 */
                                 "N2_NkdBsellRub",     m_Report.NkdBsellRub(),        null,   /*Т8 */
                                 "N2_CoupCount",       m_Report.CoupCount(),          null,   /*Т9 */
                                 "N2_LastCoupDate",    m_Report.LastCoupDate(),       null,   /*Т10*/
                                 "N2_CoupSaldoRub",    m_Report.CoupSaldoRub(),       null,   /*Т11*/
                                 "N2_DqualS",          m_Report.DqualS(),             null,   /*Т12*/
                                 "N2_DqualB",          m_Report.DqualB(),             null,   /*Т13*/
                                 "N2_ContS",           m_Report.ContS(),              null,   /*Т14*/
                                 "N2_ContB",           m_Report.ContB(),              null,   /*Т15*/
                                 "N2_FilS",            m_Report.FilS(),               null,   /*Т16*/
                                 "N2_FilB",            m_Report.FilB(),               null,   /*Т17*/
                                 "N2_SecType",         m_Report.SecType(),            null    /*Т18*/
                               );                                          
                                                                           
     elif( LineType == Строка_Итого )                                      

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N2_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N2_SecCode",  "в том числе", null );

     end;
  END;         


  MACRO EndReport();
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N2_" );
  END;         

END;

PRIVATE CLASS CFuturesReg_303( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*0303 - отбираются сделки с дисконтными облигациями, номинированными в рублях*/
     return " AND " + WhereCondNominalRUR();// + " AND " + WhereCondDiscount();
  END;

  MACRO Check(AvoirKind, TaxGroup)
    var ret = 0, rsd;
    var sql = RSDCommand("select (CASE WHEN 1 = Rsb_SCTX.TXIsDiscountAvoir(?) AND 1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_BOND+", ?) THEN 1 ELSE 0 END) as CheckSum from dual");

    sql.addParam( "", RSDBP_IN, TaxGroup );
    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.execute();

    rsd = TRsbDataSet(sql);
    if((rsd.moveNext()) and (rsd.CheckSum == 1))
     ret = 1;
    end;

   return ret; 
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( SHEET_0303 );

     m_Report.PrintHeader("N3_");

     m_Report.RegisterTable( "N3_MainTable", TableHeader_0303,
                    /*1  */  "N3_SecCode", 
                    /*2  */  "N3_SecName",   
                    /*3  */  "N3_CodeS", 
                    /*4  */  "N3_DZS",   
                    /*5  */  "N3_DDS",   
                    /*6  */  "N3_Nom",   
                    /*7  */  "N3_DAuс",  
                    /*8  */  "N3_Dexp",  
                    /*9  */  "N3_PrAucNom",  
                    /*10 */  "N3_Qnty",  
                    /*11 */  "N3_PrSNom",    
                    /*12 */  "N3_SumSrub",   
                    /*13 */  "N3_NkdBefVN",  
                    /*14 */  "N3_NKDownVN",
                    /*15 */  "N3_NkdRepRub",    
                    /*16 */  "N3_IncRub",   
                    /*17 */  "N3_MinMrkt",   
                    /*18 */  "N3_DifS",  
                    /*19 */  "N3_ComS",  
                    /*20 */  "N3_CodeB", 
                    /*21 */  "N3_DZB",   
                    /*22 */  "N3_DDB",   
                    /*23 */  "N3_PrBnom",    
                    /*24 */  "N3_SumBrub",   
                    /*25 */  "N3_MaxMrkt",   
                    /*26 */  "N3_MrktB", 
                    /*27 */  "N3_DMrktB",    
                    /*28 */  "N3_DifB",  
                    /*29 */  "N3_SumBtax",   
                    /*30 */  "N3_ComB",  
                    /*31 */  "N3_RashAll",   
                    /*Т1 */  "N3_DqualS",    
                    /*Т2 */  "N3_DqualB",    
                    /*Т3 */  "N3_ContS", 
                    /*Т4 */  "N3_ContB", 
                    /*Т5 */  "N3_FilS",  
                    /*Т6 */  "N3_FilB",  
                    /*Т7 */  "N3_SecType"                                       
                            );


     m_Report.SetCellAutoSummaPoint( "Всего:",
                                          "N3_Qnty",6,
                                          "N3_SumSrub",2,
                                          "N3_NkdBefVN",2,
                                          "N3_NKDownVN",2,
                                          "N3_NkdRepRub",2,
                                          "N3_IncRub",2,
                                          "N3_DifS",2,
                                          "N3_ComS",2,
                                          "N3_SumBrub",2,
                                          "N3_DifB",2,
                                          "N3_SumBtax",2,
                                          "N3_ComB",2,
                                          "N3_RashAll",2
                              );
                             
     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubTotal( 29, 26 + MAXROWSHEET,
                           "J23",       
                           "L23",    
                           "M23",   
                           "N23",   
                           "O23",  
                           "P23",     
                           "R23",       
                           "S23",       
                           "X23",    
                           "AB23",       
                           "AC23",    
                           "AD23",       
                           "AE23"    
                        );                                                                      
  END;


  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N3_SecCode",     m_Report.SecCode(),    null,   /*1  */
                                 "N3_SecName",     m_Report.SecName(),    null,   /*2  */
                                 "N3_CodeS",       m_Report.CodeS(),      null,   /*3  */
                                 "N3_DZS",         m_Report.DZS(),        null,   /*4  */
                                 "N3_DDS",         m_Report.DDS(),        null,   /*5  */
                                 "N3_Nom",         m_Report.Nom(),        null,   /*6  */
                                 "N3_DAuс",        m_Report.DAuc(),       null,   /*7  */
                                 "N3_Dexp",        m_Report.Dexp(),       null,   /*8  */
                                 "N3_PrAucNom",    m_Report.PrAucNom(),   null,   /*9  */
                                 "N3_Qnty",        m_Report.Qnty(),       m_Report.QntyPrecision(),   /*10 */
                                 "N3_PrSNom",      m_Report.PrSNom(),     null,   /*11 */
                                 "N3_SumSrub",     String(m_Report.SumSrub()),    null,   /*12 */
                                 "N3_NkdBefVN",    m_Report.NkdBefVN(),   null,   /*13 */
                                 "N3_NKDownVN",    m_Report.NKDownVN(),   null,   /*14 */
                                 "N3_NkdRepRub",   m_Report.NkdRepRub(),  null,   /*15 */
                                 "N3_IncRub",      m_Report.IncRub(),     null,   /*16 */
                                 "N3_MinMrkt",     m_Report.MinMrkt(),    null,   /*17 */
                                 "N3_DifS",        m_Report.DifS(),       null,   /*18 */
                                 "N3_ComS",        m_Report.ComS(),       null,   /*19 */
                                 "N3_CodeB",       m_Report.CodeB(),      null,   /*20 */
                                 "N3_DZB",         m_Report.DZB(),        null,   /*21 */
                                 "N3_DDB",         m_Report.DDB(),        null,   /*22 */
                                 "N3_PrBnom",      m_Report.PrBnom(),     null,   /*23 */
                                 "N3_SumBrub",     m_Report.SumBrub(),    null,   /*24 */
                                 "N3_MaxMrkt",     m_Report.MaxMrkt(),    null,   /*25 */
                                 "N3_MrktB",       m_Report.MrktB(),      null,   /*26 */
                                 "N3_DMrktB",      m_Report.DMrktB(),     null,   /*27 */
                                 "N3_DifB",        m_Report.DifB(),       null,   /*28 */
                                 "N3_SumBtax",     String(m_Report.SumBtax()),    null,   /*29 */
                                 "N3_ComB",        m_Report.ComB(),       null,   /*30 */
                                 "N3_RashAll",     m_Report.RashAll(),    null,   /*31 */
                                 "N3_DqualS",      m_Report.DqualS(),     null,   /*Т1 */
                                 "N3_DqualB",      m_Report.DqualB(),     null,   /*Т2 */
                                 "N3_ContS",       m_Report.ContS(),      null,   /*Т3 */
                                 "N3_ContB",       m_Report.ContB(),      null,   /*Т4 */
                                 "N3_FilS",        m_Report.FilS(),       null,   /*Т5 */
                                 "N3_FilB",        m_Report.FilB(),       null,   /*Т6 */
                                 "N3_SecType",     m_Report.SecType(),    null    /*Т7 */
                               );

     elif( LineType == Строка_Итого )

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N3_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N3_SecCode",  "в том числе", null );

     end;
  END;         


  MACRO EndReport();
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N3_" );
  END;         

END;

PRIVATE CLASS CFuturesReg_304( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*0304 - отбираются сделки с акциями, паями и депозитарными расписками, номинированными в иностранной валюте */
     return " AND " + " NOT ( " + WhereCondNominalRUR() + ")";// AND " + WhereCondShare();
  END;

  MACRO Check(AvoirKind, TaxGroup)
    var ret = 0, rsd;
    var sql = RSDCommand("select (CASE WHEN 1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_SHARE+", ?) OR " +
                         "                  1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_DEPOSITORY_RECEIPT+", ?) OR " +
                         "                  1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_INVESTMENT_SHARE+", ?) THEN 1 ELSE 0 END) as CheckSum from dual");

    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.execute();

    rsd = TRsbDataSet(sql);
    if((rsd.moveNext()) and (rsd.CheckSum == 1))
     ret = 1;
    end;

    return ret; 
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( SHEET_0304 );

     m_Report.PrintHeader("N4_");

     m_Report.RegisterTable( "N4_MainTable", TableHeader_0304,
                /*1  */      "N4_SecCode",    
                /*2  */      "N4_SecName",  
                /*3  */      "N4_CodeS", 
                /*4  */      "N4_DZS",   
                /*5  */      "N4_DDS",    
                /*6  */      "N4_Qnty",      
                /*7  */      "N4_VN",   
                /*8  */      "N4_PrSVN", 
                /*9  */      "N4_SumSvn",    
                /*10 */      "N4_SumSrub",   
                /*11 */      "N4_MinMrkt",   
                /*12 */      "N4_DifS",  
                /*13 */      "N4_ComS",  
                /*14 */      "N4_CodeB", 
                /*15 */      "N4_DZB",   
                /*16 */      "N4_DDB",   
                /*17 */      "N4_PrBvn", 
                /*18 */      "N4_SumBvn",    
                /*19 */      "N4_SumBrub",   
                /*20 */      "N4_MaxMrkt",   
                /*21 */      "N4_MrktB", 
                /*22 */      "N4_DMrktB",    
                /*23 */      "N4_DifB",  
                /*24 */      "N4_SumBtax",   
                /*25 */      "N4_ComB",  
                /*26 */      "N4_RashAll",   
                /*Т1 */      "N4_VPrB",  
                /*Т2 */      "N4_PrBvp", 
                /*Т3 */      "N4_VPrS",  
                /*Т4 */      "N4_PrSvp", 
                /*Т5 */      "N4_CrSZ",  
                /*Т6 */      "N4_CrBZ",  
                /*Т7 */      "N4_CrSD",  
                /*Т8 */      "N4_CrBD",  
                /*Т9 */      "N4_CrSP",  
                /*Т10*/      "N4_CrBP",  
                /*Т11*/      "N4_DqualS",    
                /*Т12*/      "N4_DqualB",    
                /*Т13*/      "N4_ContS", 
                /*Т14*/      "N4_ContB", 
                /*Т15*/      "N4_FilS",  
                /*Т16*/      "N4_FilB",  
                /*Т17*/      "N4_SecType"
                           );

     m_Report.SetCellAutoSummaPoint( "Всего:",
                                          "N4_Qnty",6,   
                                          "N4_SumSvn",2, 
                                          "N4_SumSrub",2,
                                          "N4_DifS",2,   
                                          "N4_ComS",2,   
                                          "N4_SumBvn",2, 
                                          "N4_SumBrub",2,
                                          "N4_DifB",2,   
                                          "N4_SumBtax",2,
                                          "N4_ComB",2,   
                                          "N4_RashAll",2
                              );
                             
     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubTotal( 29, 26 + MAXROWSHEET,
                           "F23",      
                           "I23",    
                           "J23",   
                           "L23",      
                           "M23",      
                           "R23",    
                           "S23",   
                           "W23",      
                           "X23",   
                           "Y23",      
                           "Z23"   
                        );                                                                      
  END;


  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )
     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N4_SecCode",   m_Report.SecCode(),   null,   /*1  */
                                 "N4_SecName",   m_Report.SecName(),   null,   /*2  */
                                 "N4_CodeS",     m_Report.CodeS(),     null,   /*3  */
                                 "N4_DZS",       m_Report.DZS(),       null,   /*4  */
                                 "N4_DDS",       m_Report.DDS(),       null,   /*5  */
                                 "N4_Qnty",      m_Report.Qnty(),      m_Report.QntyPrecision(),   /*6  */
                                 "N4_VN",        m_Report.VN(),        null,   /*7  */
                                 "N4_PrSVN",     m_Report.PrSVN(),     null,   /*8  */
                                 "N4_SumSvn",    String(m_Report.SumSvn()),    null,   /*9  */
                                 "N4_SumSrub",   String(m_Report.SumSrub()),   null,   /*10 */
                                 "N4_MinMrkt",   m_Report.MinMrkt(),   null,   /*11 */
                                 "N4_DifS",      m_Report.DifS(),      null,   /*12 */
                                 "N4_ComS",      m_Report.ComS(),      null,   /*13 */
                                 "N4_CodeB",     m_Report.CodeB(),     null,   /*14 */
                                 "N4_DZB",       m_Report.DZB(),       null,   /*15 */
                                 "N4_DDB",       m_Report.DDB(),       null,   /*16 */
                                 "N4_PrBvn",     m_Report.PrBvn(),     null,   /*17 */
                                 "N4_SumBvn",    String(m_Report.SumBvn()),    null,   /*18 */
                                 "N4_SumBrub",   String(m_Report.SumBrub()),   null,   /*19 */
                                 "N4_MaxMrkt",   String(m_Report.MaxMrkt()),   null,   /*20 */
                                 "N4_MrktB",     m_Report.MrktB(),     null,   /*21 */
                                 "N4_DMrktB",    m_Report.DMrktB(),    null,   /*22 */
                                 "N4_DifB",      m_Report.DifB(),      null,   /*23 */
                                 "N4_SumBtax",   String(m_Report.SumBtax()),   null,   /*24 */
                                 "N4_ComB",      m_Report.ComB(),      null,   /*25 */
                                 "N4_RashAll",   String(m_Report.RashAll()),   null,   /*26 */
                                 "N4_VPrB",      m_Report.VPrBNumber(),null,   /*Т1 */
                                 "N4_PrBvp",     m_Report.PrBvp(),     null,   /*Т2 */
                                 "N4_VPrS",      m_Report.VPrSNumber(),null,   /*Т3 */
                                 "N4_PrSvp",     m_Report.PrSvp(),     null,   /*Т4 */
                                 "N4_CrSZ",      m_Report.printCrSZ(), null,   /*Т5 */
                                 "N4_CrBZ",      m_Report.printCrBZ(), null,   /*Т6 */
                                 "N4_CrSD",      m_Report.printCrSD(), null,   /*Т7 */
                                 "N4_CrBD",      m_Report.printCrBD(), null,   /*Т8 */
                                 "N4_CrSP",      m_Report.printCrSP(), null,   /*Т9 */
                                 "N4_CrBP",      m_Report.printCrBP(), null,   /*Т10*/
                                 "N4_DqualS",    m_Report.DqualS(),    null,   /*Т11*/
                                 "N4_DqualB",    m_Report.DqualB(),    null,   /*Т12*/
                                 "N4_ContS",     m_Report.ContS(),     null,   /*Т13*/
                                 "N4_ContB",     m_Report.ContB(),     null,   /*Т14*/
                                 "N4_FilS",      m_Report.FilS(),      null,   /*Т15*/
                                 "N4_FilB",      m_Report.FilB(),      null,   /*Т16*/
                                 "N4_SecType",   m_Report.SecType(),   null    /*Т17*/
                            );

     elif( LineType == Строка_Итого )

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N4_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N4_SecCode",  "в том числе", null );

     end;
  END;         


  MACRO EndReport();
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N4_" );
  END;         

END;

PRIVATE CLASS CFuturesReg_305( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*0305 - отбираются сделки с процентными облигациями, номинированными в иностранной валюте*/
     return " AND " + " NOT ( " + WhereCondNominalRUR() + ")";// AND " + WhereCondPC();
  END;

  MACRO Check(AvoirKind, TaxGroup)
    var ret = 0, rsd;
    var sql = RSDCommand("select (CASE WHEN 1 = Rsb_SCTX.TXIsPercentAvoir(?) AND 1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_BOND+", ?) THEN 1 ELSE 0 END) as CheckSum from dual");

    sql.addParam( "", RSDBP_IN, TaxGroup );
    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.execute();

    rsd = TRsbDataSet(sql);
    if((rsd.moveNext()) and (rsd.CheckSum == 1))
     ret = 1;
    end;

   return ret; 
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( SHEET_0305 );

     m_Report.PrintHeader("N5_");

     m_Report.RegisterTable( "N5_MainTable", TableHeader_0305,
               /*1  */       "N5_SecCode",
               /*2  */       "N5_SecName",
               /*3  */       "N5_CodeS",
               /*4  */       "N5_DZS",
               /*5  */       "N5_DDS",
               /*6  */       "N5_Qnty",
               /*7  */       "N5_VN",
               /*8  */       "N5_PrSNom",
               /*9  */       "N5_SumSvn",
               /*10 */       "N5_SumSrub",
               /*11 */       "N5_NkdSvn",
               /*12 */       "N5_NkdSrub",
               /*13 */       "N5_Tprev",
               /*14 */       "N5_NkdPrevVN",
               /*15 */       "N5_NkdPrevRub",
               /*16 */       "N5_CoupVN",
               /*17 */       "N5_CoupRub",
               /*18 */       "N5_NKDrepRub",
               /*19 */       "N5_AmortVN",
               /*20 */       "N5_AmortRub",
               /*21 */       "N5_SumAllrub",
               /*22 */       "N5_NKDminusRub",
               /*23 */       "N5_MinMrkt",
               /*24 */       "N5_DifS",
               /*25 */       "N5_ComS",
               /*26 */       "N5_CodeB",
               /*27 */       "N5_DZB",
               /*28 */       "N5_DDB",
               /*29 */       "N5_PrBnom",
               /*30 */       "N5_SumBvn",
               /*31 */       "N5_SumBrub",
               /*32 */       "N5_NkdBvn",
               /*33 */       "N5_NkdBrub",
               /*34 */       "N5_MaxMrkt",
               /*35 */       "N5_MrktB",
               /*36 */       "N5_DMrktB",
               /*37 */       "N5_DifB",
               /*38 */       "N5_SumBtax",
               /*39 */       "N5_ComB",
               /*40 */       "N5_RashAll",
               /*Т1 */       "N5_VPrB",
               /*Т2 */       "N5_VPrS",
               /*Т3 */       "N5_CrSZ",
               /*Т4 */       "N5_CrBZ",
               /*Т5 */       "N5_CrSD",
               /*Т6 */       "N5_CrBD",
               /*Т7 */       "N5_ifCoupPrev",
               /*Т8 */       "N5_NkdBprevRub",
               /*Т9 */       "N5_NkdBrepRub",
               /*Т10*/       "N5_NkdBsellRub",
               /*Т11*/       "N5_CoupSaldoRub",
               /*Т12*/       "N5_CoupCount",
               /*Т13*/       "N5_LastCoupDate",
               /*Т14*/       "N5_DqualS",
               /*Т15*/       "N5_DqualB",
               /*Т16*/       "N5_ContS",
               /*Т17*/       "N5_ContB",
               /*Т18*/       "N5_FilS",
               /*Т19*/       "N5_FilB",
               /*Т20*/       "N5_SecType"
                           );  

     m_Report.SetCellAutoSummaPoint( "Всего:",
                                          "N5_Qnty",6,
                                          "N5_SumSvn",2,
                                          "N5_SumSrub",2,
                                          "N5_NkdSvn",2,
                                          "N5_NkdSrub",2,
                                          "N5_NkdPrevVN",2,
                                          "N5_NkdPrevRub",2,
                                          "N5_CoupVN",2,
                                          "N5_CoupRub",2,
                                          "N5_NkdRepRub",2,
                                          "N5_AmortVN",2,
                                          "N5_AmortRub",2,
                                          "N5_SumAllrub",2,
                                          "N5_NKDminusRub",2,
                                          "N5_DifS",2,
                                          "N5_ComS",2,
                                          "N5_SumBvn",2,
                                          "N5_SumBrub",2,
                                          "N5_NkdBVN",2,
                                          "N5_NkdBrub",2,
                                          "N5_DifB",2,
                                          "N5_SumBtax",2,
                                          "N5_ComB",2,
                                          "N5_RashAll",2,
                                          "N5_NkdBprevRub",2,
                                          "N5_NkdBrepRub",2,
                                          "N5_NkdBsellRub",2,
                                          "N5_CoupSaldoRub",2
                              );

     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubTotal( 29, 26 + MAXROWSHEET,
                           "F23",         
                           "I23",       
                           "J23",      
                           "K23",       
                           "L23",      
                           "N23",    
                           "O23",   
                           "P23",       
                           "Q23",      
                           "R23",    
                           "S23",      
                           "T23",     
                           "U23",    
                           "V23",  
                           "X23",         
                           "Y23",         
                           "AD23",       
                           "AE23",      
                           "AF23",       
                           "AG23",      
                           "AK23",         
                           "AL23",      
                           "AM23",         
                           "AN23",      
                           "AV23",  
                           "AW23",   
                           "AX23",  
                           "AY23" 
                        );                                                                      
  END;

  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N5_SecCode",         m_Report.SecCode(),        null,   /*1  */
                                 "N5_SecName",         m_Report.SecName(),        null,   /*2  */
                                 "N5_CodeS",           m_Report.CodeS(),          null,   /*3  */
                                 "N5_DZS",             m_Report.DZS(),            null,   /*4  */
                                 "N5_DDS",             m_Report.DDS(),            null,   /*5  */
                                 "N5_Qnty",            m_Report.Qnty(),           m_Report.QntyPrecision(),   /*6  */
                                 "N5_VN",              m_Report.VN(),             null,   /*7  */
                                 "N5_PrSNom",          m_Report.PrSNom(),         null,   /*8  */
                                 "N5_SumSvn",          m_Report.SumSvn(),         null,   /*9  */
                                 "N5_SumSrub",         m_Report.SumSrub(),        null,   /*10 */
                                 "N5_NkdSvn",          m_Report.NkdSvn(),         null,   /*11 */
                                 "N5_NkdSrub",         String(m_Report.NkdSrub()),        null,   /*12 */
                                 "N5_Tprev",           String(m_Report.Tprev()),          null,   /*13 */
                                 "N5_NkdPrevVN",       String(m_Report.NkdPrevVN()),      null,   /*14 */
                                 "N5_NkdPrevRub",      String(m_Report.NkdPrevRub()),     null,   /*15 */
                                 "N5_CoupVN",          m_Report.CoupVN(),         null,   /*16 */
                                 "N5_CoupRub",         m_Report.CoupRub(),        null,   /*17 */
                                 "N5_NKDrepRub",       m_Report.NKDrepRub(),      null,   /*18 */
                                 "N5_AmortVN",         m_Report.AmortVN(),        null,   /*19 */
                                 "N5_AmortRub",        m_Report.AmortRub(),       null,   /*20 */
                                 "N5_SumAllrub",       m_Report.SumAllrub(),      null,   /*21 */
                                 "N5_NKDminusRub",     m_Report.NKDminusRub(),    null,   /*22 */
                                 "N5_MinMrkt",         m_Report.MinMrkt(),        null,   /*23 */
                                 "N5_DifS",            String(m_Report.DifS()),           null,   /*24 */
                                 "N5_ComS",            String(m_Report.ComS()),           null,   /*25 */
                                 "N5_CodeB",           m_Report.CodeB(),          null,   /*26 */
                                 "N5_DZB",             m_Report.DZB(),            null,   /*27 */
                                 "N5_DDB",             m_Report.DDB(),            null,   /*28 */
                                 "N5_PrBnom",          m_Report.PrBnom(),         null,   /*29 */
                                 "N5_SumBvn",          m_Report.SumBvn(),         null,   /*30 */
                                 "N5_SumBrub",         m_Report.SumBrub(),        null,   /*31 */
                                 "N5_NkdBvn",          m_Report.NkdBvn(),         null,   /*32 */
                                 "N5_NkdBrub",         m_Report.NkdBrub(),        null,   /*33 */
                                 "N5_MaxMrkt",         m_Report.MaxMrkt(),        null,   /*34 */
                                 "N5_MrktB",           m_Report.MrktB(),          null,   /*35 */
                                 "N5_DMrktB",          m_Report.DMrktB(),         null,   /*36 */
                                 "N5_DifB",            m_Report.DifB(),           null,   /*37 */
                                 "N5_SumBtax",         m_Report.SumBtax(),        null,   /*38 */
                                 "N5_ComB",            m_Report.ComB(),           null,   /*39 */
                                 "N5_RashAll",         m_Report.RashAll(),        null,   /*40 */
                                 "N5_VPrB",            m_Report.VPrBNumber(),     null,   /*Т1 */
                                 "N5_VPrS",            m_Report.VPrSNumber(),     null,   /*Т2 */
                                 "N5_CrSZ",            m_Report.printCrSZ(),      null,   /*Т3 */
                                 "N5_CrBZ",            m_Report.printCrBZ(),      null,   /*Т4 */
                                 "N5_CrSD",            m_Report.printCrSD(),      null,   /*Т5 */
                                 "N5_CrBD",            m_Report.printCrBD(),      null,   /*Т6 */
                                 "N5_ifCoupPrev",      m_Report.ifCoupPrev(),     null,   /*Т7 */
                                 "N5_NkdBprevRub",     m_Report.NkdBprevRub(),    null,   /*Т8 */
                                 "N5_NkdBrepRub",      m_Report.NkdBrepRub(),     null,   /*Т9 */
                                 "N5_NkdBsellRub",     m_Report.NkdBsellRub(),    null,   /*Т10*/
                                 "N5_CoupSaldoRub",    m_Report.CoupSaldoRub(),   null,   /*Т11*/
                                 "N5_CoupCount",       m_Report.CoupCount(),      null,   /*Т12*/
                                 "N5_LastCoupDate",    m_Report.LastCoupDate(),   null,   /*Т13*/
                                 "N5_DqualS",          m_Report.DqualS(),         null,   /*Т14*/
                                 "N5_DqualB",          m_Report.DqualB(),         null,   /*Т15*/
                                 "N5_ContS",           m_Report.ContS(),          null,   /*Т16*/
                                 "N5_ContB",           m_Report.ContB(),          null,   /*Т17*/
                                 "N5_FilS",            m_Report.FilS(),           null,   /*Т18*/
                                 "N5_FilB",            m_Report.FilB(),           null,   /*Т19*/
                                 "N5_SecType",         m_Report.SecType(),        null    /*Т20*/
                               );                                          
                                                                           
     elif( LineType == Строка_Итого )                                      

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N5_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N5_SecCode",  "в том числе", null );

     end;
  END;         


  MACRO EndReport();
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N5_" );
  END;         

END;

PRIVATE CLASS CFuturesReg_306( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*0306 - отбираются сделки с дисконтными облигациями, номинированными в иностранной валюте*/
     return " AND " + " NOT ( " + WhereCondNominalRUR() + ") ";// AND " + WhereCondDiscount();
  END;

  MACRO Check(AvoirKind, TaxGroup)
    var ret = 0, rsd;
    var sql = RSDCommand("select (CASE WHEN 1 = Rsb_SCTX.TXIsDiscountAvoir(?) AND 1 = RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_BOND+", ?) THEN 1 ELSE 0 END) as CheckSum from dual");

    sql.addParam( "", RSDBP_IN, TaxGroup );
    sql.addParam( "", RSDBP_IN, AvoirKind );
    sql.execute();

    rsd = TRsbDataSet(sql);
    if((rsd.moveNext()) and (rsd.CheckSum == 1))
     ret = 1;
    end;

   return ret; 
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( SHEET_0306 );

     m_Report.PrintHeader("N6_");

     m_Report.RegisterTable( "N6_MainTable", TableHeader_0306,
                /*1  */      "N6_SecCode", 
                /*2  */      "N6_SecName",   
                /*3  */      "N6_CodeS", 
                /*4  */      "N6_DZS",   
                /*5  */      "N6_DDS",   
                /*6  */      "N6_Nom",  
                /*7  */      "N6_VN",   
                /*8  */      "N6_DAuс",  
                /*9  */      "N6_Dexp",  
                /*10 */      "N6_Qnty",  
                /*11 */      "N6_PrSnom",   
                /*12 */      "N6_SumSvn",   
                /*13 */      "N6_SumSrub",  
                /*14 */      "N6_NkdBefVN",  
                /*15 */      "N6_NkdBefRub", 
                /*16 */      "N6_IncRub",    
                /*17 */      "N6_MinMrkt",   
                /*18 */      "N6_DifS",  
                /*19 */      "N6_ComS",  
                /*20 */      "N6_CodeB", 
                /*21 */      "N6_DZB",   
                /*22 */      "N6_DDB",  
                /*23 */      "N6_PrBnom",    
                /*24 */      "N6_SumBvn",    
                /*25 */      "N6_SumBrub",   
                /*26 */      "N6_MaxMrkt",   
                /*27 */      "N6_MrktB", 
                /*28 */      "N6_DMrktB",    
                /*29 */      "N6_DifB",  
                /*30 */      "N6_SumBtax",   
                /*31 */      "N6_ComB",  
                /*32 */      "N6_RashAll",  
                /*Т1 */      "N6_CrSD",  
                /*Т2 */      "N6_CrBD",  
                /*Т3 */      "N6_DqualS",    
                /*Т4 */      "N6_DqualB",    
                /*Т5 */      "N6_ContS", 
                /*Т6 */      "N6_ContB", 
                /*Т7 */      "N6_FilS",  
                /*Т8 */      "N6_FilB",  
                /*Т9 */      "N6_SecType"                                           
                            );  

     m_Report.SetCellAutoSummaPoint( "Всего:", 
                                 "N6_Qnty",6,        
                                 "N6_SumSvn",2, 
                                 "N6_SumSrub",2,    
                                 "N6_NkdBefVN",2,    
                                 "N6_NkdBefRub",2,   
                                 "N6_IncRub",2,      
                                 "N6_DifS",2,    
                                 "N6_ComS",2,                    
                                 "N6_SumBvn",2,  
                                 "N6_SumBrub",2,             
                                 "N6_DifB",2,    
                                 "N6_SumBtax",2, 
                                 "N6_ComB",2,    
                                 "N6_RashAll",2                                                                             
                               );
                             
     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubTotal( 29, 26 + MAXROWSHEET,
                           "J23",        
                           "L23",      
                           "M23",     
                           "N23",    
                           "O23",   
                           "P23",
                           "R23",      
                           "S23",        
                           "X23",        
                           "Y23",      
                           "AC23",     
                           "AD23",        
                           "AE23",     
                           "AF23"     
                        );                                                                      
  END;


  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N6_SecCode",    m_Report.SecCode(),    null,   /*1  */
                                 "N6_SecName",    m_Report.SecName(),    null,   /*2  */
                                 "N6_CodeS",      m_Report.CodeS(),      null,   /*3  */
                                 "N6_DZS",        m_Report.DZS(),        null,   /*4  */
                                 "N6_DDS",        m_Report.DDS(),        null,   /*5  */
                                 "N6_Nom",        m_Report.Nom(),        null,   /*6  */
                                 "N6_VN",         m_Report.VN(),         null,   /*7  */
                                 "N6_DAuс",       m_Report.DAuc(),       null,   /*8  */
                                 "N6_Dexp",       m_Report.Dexp(),       null,   /*9  */
                                 "N6_Qnty",       m_Report.Qnty(),       m_Report.QntyPrecision(),   /*10 */
                                 "N6_PrSnom",     m_Report.PrSnom(),     null,   /*11 */
                                 "N6_SumSvn",     m_Report.SumSvn(),     null,   /*12 */
                                 "N6_SumSrub",    m_Report.SumSrub(),    null,   /*13 */
                                 "N6_NkdBefVN",   m_Report.NkdBefVN(),   null,   /*14 */
                                 "N6_NkdBefRub",  m_Report.NkdBefRub(),  null,   /*15 */
                                 "N6_IncRub",     m_Report.IncRub(),     null,   /*16 */
                                 "N6_MinMrkt",    m_Report.MinMrkt(),    null,   /*17 */
                                 "N6_DifS",       m_Report.DifS(),       null,   /*18 */
                                 "N6_ComS",       m_Report.ComS(),       null,   /*19 */
                                 "N6_CodeB",      m_Report.CodeB(),      null,   /*20 */
                                 "N6_DZB",        m_Report.DZB(),        null,   /*21 */
                                 "N6_DDB",        m_Report.DDB(),        null,   /*22 */
                                 "N6_PrBnom",     m_Report.PrBnom(),     null,   /*23 */
                                 "N6_SumBvn",     m_Report.SumBvn(),     null,   /*24 */
                                 "N6_SumBrub",    m_Report.SumBrub(),    null,   /*25 */
                                 "N6_MaxMrkt",    m_Report.MaxMrkt(),    null,   /*26 */
                                 "N6_MrktB",      m_Report.MrktB(),      null,   /*27 */
                                 "N6_DMrktB",     m_Report.DMrktB(),     null,   /*28 */
                                 "N6_DifB",       m_Report.DifB(),       null,   /*29 */
                                 "N6_SumBtax",    m_Report.SumBtax(),    null,   /*30 */
                                 "N6_ComB",       m_Report.ComB(),       null,   /*31 */
                                 "N6_RashAll",    m_Report.RashAll(),    null,   /*32 */
                                 "N6_CrSD",       m_Report.printCrSD(),  null,   /*Т1 */
                                 "N6_CrBD",       m_Report.printCrBD(),  null,   /*Т2 */
                                 "N6_DqualS",     m_Report.DqualS(),     null,   /*Т3 */
                                 "N6_DqualB",     m_Report.DqualB(),     null,   /*Т4 */
                                 "N6_ContS",      m_Report.ContS(),      null,   /*Т5 */
                                 "N6_ContB",      m_Report.ContB(),      null,   /*Т6 */
                                 "N6_FilS",       m_Report.FilS(),       null,   /*Т7 */
                                 "N6_FilB",       m_Report.FilB(),       null,   /*Т8 */
                                 "N6_SecType",    m_Report.SecType(),    null    /*Т9 */
                               );

     elif( LineType == Строка_Итого )

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N6_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N6_SecCode",  "в том числе", null );

     end;
  END;         


  MACRO EndReport();
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N6_" );
  END;         

END;

PRIVATE CLASS CFuturesReg_310( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     return "";
  END;

  MACRO Check(AvoirKind, TaxGroup)
    return 1;
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( SHEET_0310 );

     m_Report.PrintHeader("N7_");

     m_Report.RegisterTable( "N7_MainTable", TableHeader_0310,
               /*1  */       "N7_SecCode",       
               /*2  */       "N7_SecName",       
               /*3  */       "N7_Code",         
               /*4  */       "N7_Type", 
               /*5  */       "N7_DZ",           
               /*6  */       "N7_DDP",
               /*7  */       "N7_DDF",
               /*8  */       "N7_Qnty", 
               /*9  */       "N7_VN", 
               /*10 */       "N7_VPrS", 
               /*11 */       "N7_DOP", 
               /*12 */       "N7_DOF", 
               /*13 */       "N7_Price", 
               /*14 */       "N7_SumVn",
               /*15 */       "N7_NkdVn",  
               /*16 */       "N7_TotVp", 
               /*17 */       "N7_Com", 
               /*Т1 */       "N7_CrZ",          
               /*Т2 */       "N7_CrD",          
               /*Т3 */       "N7_CrO",          
               /*Т4 */       "N7_CrBal",          
               /*Т5 */       "N7_CrP",
               /*Т6 */       "N7_ifPartial",         
               /*Т7 */       "N7_ContS",         
               /*Т8 */       "N7_FilS",          
               /*Т9 */       "N7_SecType");      


     m_Report.SetCellAutoSummaPoint( "Всего:", "N7_Qnty",6,   
                                          "N7_SumVn",2, 
                                          "N7_NkdVn",2,
                                          "N7_TotVp",2,
                                          "N7_Com",2 );

     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N7_SecCode",  m_Report.SecCode(),    null,   /*1  */
                                 "N7_SecName",  m_Report.SecName(),    null,   /*2  */
                                 "N7_Code",     m_Report.Code(),       null,   /*3  */
                                 "N7_Type",     m_Report.Type(),       null,   /*4  */
                                 "N7_DZ",       m_Report.DZ(),         null,   /*5  */
                                 "N7_DDP",      m_Report.DDP(),        null,   /*6  */
                                 "N7_DDF",      m_Report.DDF(),        null,   /*7  */
                                 "N7_Qnty",     m_Report.Qnty(),       m_Report.QntyPrecision(),   /*8  */
                                 "N7_VN",       m_Report.VN(),         null,   /*9  */
                                 "N7_VPrS",     m_Report.VPrSNumber(), null,   /*10 */
                                 "N7_DOP",      m_Report.DOP(),        null,   /*11 */
                                 "N7_DOF",      m_Report.DOF(),        null,   /*12 */
                                 "N7_Price",    m_Report.Price(),      null,   /*13 */
                                 "N7_SumVn",    m_Report.SumVn(),      null,   /*14 */
                                 "N7_NkdVn",    m_Report.NkdVn(),      null,   /*15 */
                                 "N7_TotVp",    m_Report.TotVp(),      null,   /*16 */
                                 "N7_Com",      m_Report.Com(),        null,   /*17 */
                                 "N7_CrZ",      m_Report.printCrZ(),   null,   /*T1 */
                                 "N7_CrD",      m_Report.printCrD(),   null,   /*T2 */
                                 "N7_CrO",      m_Report.printCrO(),   null,   /*T3 */
                                 "N7_CrBal",    m_Report.printCrBal(), null,   /*T4 */
                                 "N7_CrP",      m_Report.printCrP(),   null,   /*T5 */
                                 "N7_ifPartial",m_Report.ifPartial(),  null,   /*T6 */
                                 "N7_ContS",    m_Report.Cont(),       null,   /*T7 */
                                 "N7_FilS",     m_Report.Fil(),        null,   /*T8 */
                                 "N7_SecType",  m_Report.SecType(),    null    /*T9 */
                               );

     elif( LineType == Строка_Итого )

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N7_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N7_SecCode",  "в том числе", null );

     end;
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubTotal( 29, 26 + MAXROWSHEET,
                           "H23",        
                           "N23",      
                           "O23",     
                           "P23",    
                           "Q23"
                        );                                                                      
  END;     


  MACRO EndReport();
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N7_" );
  END;         

END;


PRIVATE CLASS (TX_RegistrReport) SP_FuturesReg_Report( Form:DL_CPanel, TemplateName:STRING, UseCSV:BOOL, IsWebService:BOOL, ReportHashCode:INTEGER )
  PRIVATE VAR m_SheetCount = 0,
              m_AvrGroup,
              m_dl_leg   = TRecHandler( "dl_leg.dbt" );

  PRIVATE VAR m_IsDataExist = false; /*для Web, если нет данных, то ничего не показываем*/

 /* не показывать пустые отчет в Web*/
  MACRO CReport_DataExist()
    if(m_IsWebService == true)
      return (m_IsDataExist or ReportHasError() );
    else
      return true;                   /*в EW показываем листы всегда*/
    end;
  END; 

  MACRO PrintMode():INTEGER
     return DL_OUTREPORT_EXCEL;
  END;

  MACRO PrintHeader( FldPref:STRING )

     PrintFormatString( ReportHeader,
            FldPref+"H0_A:l" , this.H0_A(),  // Банк
            FldPref+"H0_B:l" , this.H0_B(),  // Инн/КПП
            FldPref+"H0_1"   , this.H0_1(),  // Приложение №
            FldPref+"H0_3"   , this.H0_3(),
            FldPref+"H0_12"  , this.H0_12(), // Аналитический регистр налогового учета №
            FldPref+"H0_2"   , this.H0_2(),
            FldPref+"H0_3"   , this.H0_3(),
            FldPref+"H0_1"   , this.H0_1(),
            FldPref+"H0_4"   , this.H0_4(),
            FldPref+"H0_5"   , this.H0_5(),
            FldPref+"H0_12"  , this.H0_12(), // Номер приложения синтетического регистра
            FldPref+"H0_2"   , this.H0_2(),  // Код строки в синтетическом регистре
            FldPref+"H0_3"   , this.H0_3(),  // Номер аналитического регистра
            FldPref+"H0_1"   , this.H0_1(),
            FldPref+"H0_4"   , this.H0_4(),  // Номер месяца (последний в отчетном периоде)
            FldPref+"H0_5"   , this.H0_5(),  // Две последние цифры года
            FldPref+"H0_6"   , this.H0_6(),  // Имя отчета
            FldPref+"H0_7"   , this.H0_7(),  // за период с
            FldPref+"H0_8"   , this.H0_8(),  // по
            FldPref+"H0_9"   , this.H0_9(),  // Группа налогового учета
            FldPref+"H0_10"  , this.H0_10(), // Вид ц/б
            FldPref+"H0_11"  , this.H0_11()  // Выпуск ц/б
          );
  END;

  PRIVATE MACRO BeginReport( NumCopy:INTEGER )
     m_SheetCount = 0;
  END;

  PRIVATE MACRO SetAutoFilter()
     if( ExistsSheet( SHEET_0301 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AN28", SHEET_0301);
     end;

     if( ExistsSheet( SHEET_0302 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AX28", SHEET_0302);
     end;

     if( ExistsSheet( SHEET_0303 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AL28", SHEET_0303);
     end;

     if( ExistsSheet( SHEET_0304 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AQ28", SHEET_0304);
     end;

     if( ExistsSheet( SHEET_0305 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:BH28", SHEET_0305);
     end;

     if( ExistsSheet( SHEET_0306 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AO28", SHEET_0306);
     end;

     if( ExistsSheet( SHEET_0310 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:Z28", SHEET_0310);
     end;
  END;

  PRIVATE MACRO EndReport()
    EndReport();
    SetAutoFilter();
  END;

  PRIVATE MACRO ExecuteReport( ObjReport:OBJECT )

     PRIVATE MACRO DataQuery_0310(AddWhere)
        VAR DataQuery = "select FinInstr.t_FI_Code as AvrCode, FinInstr.t_Name as AvrName, FinInstr.t_FaceValueFI as FaceValueFI, FinInstr.t_AvoirKind, FinInstr.t_SumPrecision, av.t_TaxGroup, " +
                        "       Lot.t_DealCodeTS as DealCode, Lot.t_Type, Lot.t_DealDate as DealDate, DECODE(Rsb_SCTXC.TXIsSale(Lot.t_Type), 1, Lot.t_SaleDate, Lot.t_BuyDate) as FactDate, " +
                        "       DECODE(Rsb_SCTXC.TXIsSale(Lot.t_Type), 1, 'SELL', 'BUY') as TypeDeal, " +
                        "       DECODE(Leg.t_MaturityIsPrincipal, chr(88), Leg.t_Expiry, Leg.t_Maturity) as PlanDate," +
                        "       DECODE(Leg.t_MaturityIsPrincipal, chr(88), Leg.t_Maturity, Leg.t_Expiry) as PlanPayDate," +
                        "       Lot.t_Amount, Lot.t_FIID as FIID, Leg.t_Nkd, Leg.t_CFI, Leg.t_TotalCost, " +
                        "       Deal.t_DealID, Deal.t_BOfficeKind as DealBOfficeKind, Deal.t_Department as DealDepartment, " +
                        Get_PartyName_Query( "Deal", "PartyName" ) + ", " +/*PartyName*/
                        "       Lot.t_PriceFIID as SalePriceFIID, Leg.t_Price as Price, Leg.t_Cost as DealCost, " +
                        "       (select max(t_ValueDate) from dpmpaym_dbt where t_DocumentID = Deal.t_DealID and t_DocKind = Deal.t_BOfficeKind and t_Purpose in (" + CAi + "," + CRi + ") and t_IsFactPaym = chr(88) and t_ValueDate <= " + GetSQLDate(this.H0_8()) + ") as FactPayDate, " +
                        "       NVL((select t_BaseFIID from dpmpaym_dbt where t_DocumentID = Deal.t_DealID and t_DocKind = Deal.t_BOfficeKind and t_Purpose in (" + CAi + "," + CRi + ") and t_IsFactPaym = chr(88) and t_ValueDate <= " + GetSQLDate(this.H0_8()) + " and ROWNUM = 1), -1) as PayFIID, " +
                        "       (select count(1) from dpmpaym_dbt where t_DocumentID = Deal.t_DealID and t_DocKind = Deal.t_BOfficeKind and t_Purpose in (" + CAi + "," + CRi + ") ) CountPayms, " +
                        "       Leg.t_CFI as VprS"
                        "  from dsctxlot_dbt Lot, ddl_tick_dbt Deal, ddl_leg_dbt Leg, dfininstr_dbt FinInstr, davoiriss_dbt av " +
                        " where ( ( Lot.t_Type = " + TXLOTS_BUY + " and " +
                        "           Lot.t_BuyDate >= " + GetSQLDate(this.H0_7()) + " and " + 
                        "           Lot.t_BuyDate <= " + GetSQLDate(this.H0_8()) + 
                        "         ) or " +
                        "         ( Lot.t_DealDate <= " + GetSQLDate(this.H0_8()) + " and " +
                        "           ( ( Lot.t_Type = " + TXLOTS_BUY + " and " +
                        "               ( Lot.t_BuyDate > " + GetSQLDate(this.H0_8()) + " or " +
                        "                 Lot.t_BuyDate = " + GetSQLDate(DATE(0,0,0)) + 
                        "               ) " +
                        "             ) or " +
                        "             ( Lot.t_Type = " + TXLOTS_SALE + " and " +
                        "               ( Lot.t_SaleDate > " + GetSQLDate(this.H0_8()) + " or " +
                        "                 Lot.t_SaleDate = " + GetSQLDate(DATE(0,0,0)) + 
                        "               ) " +
                        "             ) " +
                        "           ) " +
                        "         ) " +
                        "       ) and " +
                        "       Deal.t_DealID = Lot.t_DealID and " +
                        "       FinInstr.t_FIID = Lot.t_FIID and " +
                        "       FinInstr.t_FIID = av.t_FIID and " +
                        "       Leg.t_DealID = Deal.t_DealID and " +
                        "       Leg.t_LegKind = " + LEG_KIND_DL_TICK + " and Leg.t_LegID = 0 " + 
                        AddWhere +
                        " order by FinInstr.t_FI_Code";
        return DataQuery;
     END;

     PRIVATE MACRO DataQuery_0301_0306(AddWhere)
        var Query = 
                    " SELECT TXLink.t_Amount, " +

                    IIF ( ((m_ReportKind == FUTURES_REG_0302) or (m_ReportKind == FUTURES_REG_0305)),
                           " (NVL( (SELECT Count(fiw.t_DrawingDate) " +
                                  "   FROM dfiwarnts_dbt fiw " +
                                  "  WHERE fiw.t_FIID         =  lot.t_FIID AND " +
                                  "        fiw.t_IsPartial   != 'X' AND " +
                                  "        fiw.t_DrawingDate >=  (TXLotBuy.t_BuyDATE + 1)  AND " +
                                  "        fiw.t_DrawingDate <=  " + GetSQLDate(this.H0_7() - 1) +
                           "       ), 0 " +
                           "     ) " +
                           ") IfCoupPrev, ",
                        ""
                        ) + 
                    Get_PartyName_Query( "DealSale", "PartyNameSale" ) + ", " +/*PartyNameSale*/
                    Get_PartyName_Query( "DealBuy",  "PartyNameBuy" )  + ", " +/*PartyNameBuy*/

                    " Rsb_SCTX.TXGetComissionsSum(DealSale.t_DealID, DealSale.t_BOfficeKind, Lot.t_SALEDATE,     0) as CommSale, " +
                    " Rsb_SCTX.TXGetComissionsSum(DealBuy.t_DealID,  DealBuy.t_BOfficeKind,  TXLotBuy.t_BuyDATE, 0) as CommBuy, " +

                    IIF ( ((m_ReportKind != FUTURES_REG_0301) and (m_ReportKind != FUTURES_REG_0304)),
                           "       Rsb_SCTX.TXGetBondKind(av.t_TaxGroup) TaxGroupType, ", ""
                        ) + 

                    "        FinInstr.t_FIID, FinInstr.t_FI_Code AS AvrCode, FinInstr.t_Name AS AvrName, FinInstr.t_FaceValueFI AS FaceValueFI, FinInstr.t_DrawingDate, FinInstr.t_SumPrecision, FinInstr.t_Issued, av.t_TaxGroup, FinInstr.t_AvoirKind, "+
                    "        Lot.t_DealID AS DealSaleID, Lot.t_DEALDATE AS DealSaleDate, Lot.t_SALEDATE AS SaleDate, Lot.t_DEALCODETS AS DealSaleCodeTS,Lot.t_PriceFIID AS SalePriceFIID,LegS.t_Price AS SalePrice, LegS.t_Principal AS SaleAmount,"+
                    "        TXLotBuy.t_DealID  AS DealBuyID,  TXLotBuy.t_DEALDATE AS  DealBuyDate,  TXLotBuy.t_BuyDATE   AS BuyDate,  TXLotBuy.t_DEALCODETS  AS DealBuyCodeTS, LegB.t_Price AS BuyPrice, LegB.t_Principal AS BuyAmount,"+
                    "        DataSale.DealSaleGroup AS DealSaleGroup, DealSale.t_Department AS DealSaleDepartment," +
                    "        DataBuy.DealBuyGroup, DealBuy.t_Department AS DealBuyDepartment," +
                    "        Rsb_SCTX.GetMarketPrice( Lot.t_ID, TXLotBuy.t_ID ) AS SaleMarketPrice,"+
                    "        Rsb_SCTX.GetMarket( Lot.t_ID, TXLotBuy.t_ID ) AS SaleMarket,"+
                    "        Rsb_SCTX.GetDateMarket( Lot.t_ID, TXLotBuy.t_ID ) AS SaleDateMarket,"+
                    "        Rsb_SCTX.GetMarketPrice( TXLotBuy.t_ID, 0 ) AS BuyMarketPrice,"+
                    "        Rsb_SCTX.GetMarket( TXLotBuy.t_ID, 0 ) AS BuyMarket,"+
                    "        Rsb_SCTX.GetDateMarket( TXLotBuy.t_ID, 0 ) AS BuyDateMarket, "+
                    "        LegS.t_NKD as NKDSale, LegS.t_Price as DealSalePrice, LegS.t_Cost as SDealCost, LegS.t_CFI as VprS,"+
                    "        LegB.t_NKD as NKDBuy, LegB.t_Price as DealBuyPrice, LegB.t_Cost as BDealCost, LegB.t_CFI as VprB" +

                    "   FROM DSCTXLNK_DBT  TXLink,"+
                    "        DSCTXLOT_DBT  Lot," +
                    "        DSCTXLOT_DBT  TXLotBuy," +
                    "        DDL_TICK_DBT  DealSale," +
                    "        DDL_TICK_DBT  DealBuy," +
                    "        ddl_leg_dbt   LegS, " + 
                    "        ddl_leg_dbt   LegB, " +
                    "        DFININSTR_DBT FinInstr, " + 
                    "        DAVOIRISS_DBT av, " + 

                    "        ( Select SaleOper.t_Kind_Operation, SaleOper.t_DocKind, " +
                    "                 rsb_secur.get_OperationGroup(SaleOper.t_SysTypes) as DealSaleGroup, " +
                    "                 (CASE WHEN " +
                    "                            ((Rsb_Secur.IsBuy(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                    "                          or (Rsb_Secur.IsAvrWrtIn(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                    "                            ) " +
                    "                       THEN 2 " +
                    "                       ELSE 0 END " +
                    "                 ) as LegKindSale " +
                    "            From " +
                    "                 doprkoper_dbt SaleOper " + 
                    "        ) DataSale, " +

                    "        ( Select BuyOper.t_Kind_Operation, BuyOper.t_DocKind, " +
                    "                 rsb_secur.get_OperationGroup(BuyOper.t_SysTypes) as DealBuyGroup, " +
                    "                 (CASE WHEN " +
                    "                            ((Rsb_Secur.IsSale(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " +
                    "                          or (Rsb_Secur.IsAvrWrtOut(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " +
                    "                            ) " +
                    "                       THEN 2 " +
                    "                       ELSE 0 END " +
                    "                 ) as LegKindBuy " +
                    "            From " +
                    "                 doprkoper_dbt BuyOper " + 
                    "        ) DataBuy " +


                    "  WHERE TXLink.t_Type = " + TXLNK_DELIVER + " AND " +

                    "        ( ( ( TXLink.t_Date BETWEEN " + GetSQLDate(this.H0_7()) + " AND " + GetSQLDate(this.H0_8()) + " ) AND " +
                    "            ( TXLink.T_BEGDATE IS NULL OR " +
                    "              TXLink.T_BEGDATE = " + GetSQLDate( DATE(0,0,0) ) + 
                    "            ) " +
                    "          ) OR " +
                    "          ( TXLink.T_BEGDATE BETWEEN " + GetSQLDate(this.H0_7()) + " AND " + GetSQLDate(this.H0_8()) + 
                    "          ) " +
                    "        ) AND " +
                    "        TXLink.t_SaleID = Lot.t_ID AND " +
                    "        TXLink.t_BuyID  = TXLotBuy.t_ID AND " +
                    "        Lot.t_DealID = DealSale.t_DealID AND " +
                    "        TXLotBuy.t_DealID  = DealBuy.t_DealID AND " +
                    "        FinInstr.t_FIID = Lot.t_FIID AND " +
                    "        FinInstr.t_FIID = av.t_FIID AND " +
                    "        DataSale.t_Kind_Operation = DealSale.t_DealType AND " +
                    "        DataSale.t_DocKind        = DealSale.t_BOfficeKind AND " +
                    "        DataBuy.t_Kind_Operation  = DealBuy.t_DealType AND " +
                    "        DataBuy.t_DocKind         = DealBuy.t_BOfficeKind AND " + 
                    "        LegS.t_DealID             = DealSale.t_DealID AND " +
                    "        LegS.t_LegKind            = DataSale.LegKindSale AND " +
                    "        LegS.t_LegID              = 0 AND " +
                    "        LegB.t_DealID             = DealBuy.t_DealID AND " +
                    "        LegB.t_LegKind            = DataBuy.LegKindBuy AND " +
                    "        LegB.t_LegID              = 0 " + AddWhere;
                   
        return Query;
     END;

     PRIVATE MACRO Get_Rep_Name()
        if( m_ReportKind == FUTURES_REG_0301 )
           return SHEET_0301;
        elif( m_ReportKind == FUTURES_REG_0302 )
           return SHEET_0302;
        elif( m_ReportKind == FUTURES_REG_0303 )
           return SHEET_0303;
        elif( m_ReportKind == FUTURES_REG_0304 )
           return SHEET_0304;
        elif( m_ReportKind == FUTURES_REG_0305 )
           return SHEET_0305;
        elif( m_ReportKind == FUTURES_REG_0306 )
           return SHEET_0306;
        elif( m_ReportKind == FUTURES_REG_0310 )
           return SHEET_0310;
        end;
     END;


     VAR DataQuery, AvrFIID, AvrKind, AddWhere = "", Rep_Name,
         AvrFIIDList = null,
         AvrFIIDCount : Integer = 0,
         AvrFIIDAddWhere : String = "",
         WasSetSecurity : Bool = false,

         AvrKindList = null,
         AvrKindAddWhere : String = "",
         AvrKindCount : Integer = 0,
         
         GNUList = null,
         GNUAddWhere : String = "",
         GNUCount : Integer = 0,
         AvrGroup;
     VAR ProgressValue = CTxProgressValue();
     
     T_Dep.ClearArray();
     ObjReport.BeginReport();

     /*ценные бумаги в соединенных сделках  должны удовлетворять условиям, заданным панели подготовки отчета*/
     if( not m_IsWebService )
        AvrFIIDList = TArray();
        AvrFIIDList[AvrFIIDList.Size] = Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_AVRCODE );
     else
        AvrFIIDList = Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_AVRCODE );
     end;
     if( ( ValType( AvrFIIDList ) != V_UNDEF ) and ( AvrFIIDList.Size > 0 ) )
        while( AvrFIIDCount < AvrFIIDList.Size )
           if( ( ValType( AvrFIIDList[AvrFIIDCount] ) == V_INTEGER )
           and ( AvrFIIDList[AvrFIIDCount] > 0 ) )
              if( AvrFIIDAddWhere == "" )
                 AvrFIIDAddWhere = AvrFIIDAddWhere + " AND ( ";
              else
                 AvrFIIDAddWhere = AvrFIIDAddWhere + " OR ";
              end;

              if (m_ReportKind == FUTURES_REG_0310)
                AvrFIIDAddWhere = AvrFIIDAddWhere + " FinInstr.t_FIID = " + String( AvrFIIDList[AvrFIIDCount] ) + " ";
              else
              AvrFIIDAddWhere = AvrFIIDAddWhere + " TXLink.t_FIID = " + String( AvrFIIDList[AvrFIIDCount] ) + " ";
           end;

           end;
           AvrFIIDCount = AvrFIIDCount + 1;
        end;
        if( AvrFIIDAddWhere != "" )
           AvrFIIDAddWhere = AvrFIIDAddWhere + " ) ";
           WasSetSecurity = true;
        end;
        AddWhere = AddWhere + AvrFIIDAddWhere;
     end;

     /*если не задана бумага*/
     if( not WasSetSecurity )
        if( not m_IsWebService )
           AvrKindList = TArray();
           AvrKindList[AvrKindList.Size] = Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_AVRKIND );
        else
           AvrKindList = Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_AVRKIND );
        end;
        /*задан вид бумаги*/
        if( ( ValType( AvrKindList ) != V_UNDEF ) and ( AvrKindList.Size > 0 ) )
           while( AvrKindCount < AvrKindList.Size )
              if( ( ValType( AvrKindList[AvrKindCount] ) == V_INTEGER )
              and ( AvrKindList[AvrKindCount] > 0 ) )
                 if( AvrKindAddWhere == "" )
                    AvrKindAddWhere = AvrKindAddWhere + " AND ( ";
                 else
                    AvrKindAddWhere = AvrKindAddWhere + " OR ";
                 end;
                 AvrKindAddWhere = AvrKindAddWhere + " RSB_FIInstr.FI_AvrKindsEQ(2, " + String( AvrKindList[AvrKindCount] ) + ", FinInstr.t_AvoirKind) = 1 ";
              end;
              AvrKindCount = AvrKindCount + 1;
           end;
           if( AvrKindAddWhere != "" )
              AvrKindAddWhere = AvrKindAddWhere + " ) ";
           end;
           AddWhere = AddWhere + AvrKindAddWhere;
        end;

        if( not m_IsWebService )
           GNUList = TArray();
           GNUList[GNUList.Size] = Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_AVRGROUP );
        else
           GNUList = Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_AVRGROUP );
        end;
        /*задана категория бумаги*/
        if( ( ValType( GNUList ) != V_UNDEF ) and ( GNUList.Size > 0 ) )
           while( GNUCount < GNUList.Size )
              if( ( ValType( GNUList[GNUCount] ) == V_INTEGER )
              and ( GNUList[GNUCount] > 0 ) )
               if( GNUAddWhere == "" )
                    GNUAddWhere = GNUAddWhere + " AND ( ";
                 else
                    GNUAddWhere = GNUAddWhere + " OR ";
                 end;
                 GNUAddWhere = GNUAddWhere + " av.t_TaxGroup = " + String( GNUList[GNUCount] ) + " ";
              end;
              GNUCount = GNUCount + 1;
           end;
           if( GNUAddWhere != "" )
              GNUAddWhere = GNUAddWhere + " ) ";
           end;
           AddWhere = AddWhere + GNUAddWhere;
        end;
     end;

     if( (Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_EXCLUDE ) == "X") AND (ИсключаемыеИзОтчетаЦБ != "") )
        AddWhere = AddWhere + " AND fininstr.t_FI_Code not in (" + ИсключаемыеИзОтчетаЦБ + ")";
     end;

     AddWhere = AddWhere + " AND av.t_TaxGroup not in (13, 35, 919, 943 ) "
                         + " AND 1 = rsb_sctx.DealIsTerm(Lot.t_DealID, FinInstr.t_FIID, (CASE WHEN Lot.t_Type = " + TXLOTS_BUY + " THEN Lot.t_BUYDATE ELSE Lot.t_SALEDATE END)) "  + ObjReport.Where();

     if( m_ReportKind == FUTURES_REG_0310 )
        DataQuery = DataQuery_0310(AddWhere);
     else
        DataQuery = DataQuery_0301_0306(AddWhere);
     end;

     Rep_Name = Get_Rep_Name();
     ProgressValue.Maximum = SQL_GetNRecs( DataQuery );
     ProgressValue.Current = 0;

     if (ProgressValue.Maximum > 0)

       var ProgressIndicator = CreateProgressIndicator(m_IsWebService);

       if( m_IsWebService and (WebMenuItem != null) )
         var header = "Формирование отчета " + WebMenuItem.szNameItem;
         ProgressIndicator.Start(ProgressValue.Maximum, header, header);
       else
         ProgressIndicator.Start(ProgressValue.Maximum, Rep_Name, Rep_Name);
       end;

        m_RS = TRsbDataSet( DataQuery );

        m_CacheFinInstr.Clear();

        this.SetCurrentLineFont( 8, false, false );
        
        while( m_RS.MoveNext() )

           if(ObjReport.Check(m_RS.AvoirKind, m_RS.TaxGroup))
             this.ClearCacheOneRecord();

             m_IsDataExist = true;
             ObjReport.ПечататьСтрокуТаблицы( Строка_СтрокаДанных );
           end;

           ProgressValue.Current = ProgressValue.Current + 1;
           ProgressIndicator.Update(ProgressValue.Current,ProgressValue.Maximum); // всего 3 парамера Update(index, count, text)
        end;

        ProgressIndicator.Stop();
     end;

     ObjReport.EndReport();
  END;

  PRIVATE MACRO CreateReportByKind( Kind:INTEGER )
     m_ReportKind = Kind;

     if( Kind == FUTURES_REG_0301 )
        ExecuteReport( CFuturesReg_301(this) );
     elif( Kind == FUTURES_REG_0302 )
        ExecuteReport( CFuturesReg_302(this) );
     elif( Kind == FUTURES_REG_0303 )
        ExecuteReport( CFuturesReg_303(this) );
     elif( Kind == FUTURES_REG_0304 )
        ExecuteReport( CFuturesReg_304(this) );
     elif( Kind == FUTURES_REG_0305 )
        ExecuteReport( CFuturesReg_305(this) );
     elif( Kind == FUTURES_REG_0306 )
        ExecuteReport( CFuturesReg_306(this) );
     elif( Kind == FUTURES_REG_0310 )
        ExecuteReport( CFuturesReg_310(this) );
     end;
  END;

  PRIVATE MACRO Create()
     var SubKindList = null;
     var SubKindCount : Integer = 0;
     if( not m_IsWebService )
        SubKindList = TArray();
        SubKindList[SubKindList.Size] = Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_SUBKIND );
     else
        SubKindList = Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_SUBKIND );
     end;

     if( ( ValType( SubKindList ) != V_UNDEF )
     and ( SubKindList.Size > 0 )
     and ( ValType( SubKindList[SubKindCount] ) == V_INTEGER )
     and ( SubKindList[SubKindCount] != FUTURES_REG_ALL ) )
        while( SubKindCount < SubKindList.Size )
           CreateReportByKind( SubKindList[SubKindCount] );
           SubKindCount = SubKindCount + 1;
        end;
     else
        CreateReportByKind( FUTURES_REG_0301 );
        CreateReportByKind( FUTURES_REG_0302 );
        CreateReportByKind( FUTURES_REG_0303 );
        CreateReportByKind( FUTURES_REG_0304 );
        CreateReportByKind( FUTURES_REG_0305 );
        CreateReportByKind( FUTURES_REG_0306 );
        CreateReportByKind( FUTURES_REG_0310 );
     end;
  END;

  /*Кэшируемые данные для 1 записи отчета */
  PRIVATE VAR m_Price,   
              m_NkdRepRub, m_NkdBrepRub,
              m_CrDlink, 
              m_NkdBsellRub, m_CoupSaldoRub, m_DZ, m_NkdVn, m_CrD, m_CrO, m_CrZ, m_CrBal, m_Com, m_CrP,
              m_SumVn,
              m_pwrtsumBuy  = TBFile( "pmwrtsum.dbt", "R", 0 ),
              m_pwrtsumSale = TBFile( "pmwrtsum.dbt", "R", 0 ),
              m_pwrtsum     = TBFile( "pmwrtsum.dbt", "R", 0 ),
              m_Deal        = TBFile( "dl_tick.dbt", "R", 0 );

  MACRO ClearCacheOneRecord()
     this.ClearCacheOneRecord();
     m_DZS   = null;
     m_DZ    = null;
     m_PrSvn = null;
     m_Price = null;
     m_NkdSvn= null;
     m_NkdPrevVN = null;
     m_NkdBefVN  = null;
     m_NkdVn     = null;
     m_NKDownVN  = null;
     m_PrAucNom  = null;
     m_CoupVN    = null;
     m_CoupRub   = null;
     m_AmortVN   = null;
     m_AmortRub  = null;
     m_NkdRepRub = null;
     m_NkdBrepRub= null;
     m_NkdPrevRub= null;
     m_PrBNom    = null;
     m_SumSrub   = null;
     m_ComS      = null;
     m_pwrtsumBuy.Clear();
     m_pwrtsumSale.Clear();
     m_pwrtsum.Clear();
     m_DealSale.Clear();
     m_DealBuy.Clear();
     m_Deal.Clear();
     m_DZB       = null;
     m_PrBVN     = null;
     m_PrSNom    = null;
     m_SumSvn    = null;
     m_SumSvp    = null;
     m_SumBvn    = null;
     m_SumBvp    = null;
     m_SumVn     = null;
     m_NkdBvn    = null;
     m_DifB      = null;
     m_ComB      = null;
     m_CrSZ      = null;
     m_CrBZ      = null;
     m_SumBrub   = null;
     m_CrSD      = null;
     m_CrDlink   = null;
     m_CrBD      = null;
     m_ifCoupPrev= null;
     m_NkdBsellRub= null;
     m_CoupSaldoRub= null;
     m_CrZ       = null;
     m_CrD       = null;
     m_CrO       = null;
     m_CrBal     = null;
     m_Com       = null;
     m_CrP       = null;
  END;

  /*Наименование нашего банка*/
  MACRO H0_A():STRING
     return ПолучитьКороткоеИмяСубъекта( {OurBank} );
  END;

  /*ИНН / КПП нашего банка*/
  MACRO H0_B()
     VAR INN, KPP;

     SplitFullINN( ПолучитьКодСубъекта({OurBank}, PTCK_INN), INN, KPP );
     return INN + "/" + KPP;
  END;

  /*Константа, задаваемая в макросе формировании отчета. Значение константы - текст "03"*/
  MACRO H0_1():STRING
     return "03";
  END;

  /*Константа, задаваемая в макросе формировании отчета.  Значение константы - текст  "XXX"*/
  MACRO H0_2():STRING
     return "XXX";
  END;

  /*Константа, задаваемая в макросе формировании отчета. Значение константы -текст
       "01" - для подвида 0301
       "02" - для подвида 0302  */
  MACRO H0_3():STRING
     if( m_ReportKind == FUTURES_REG_0301 )
        return "01";
     elif( m_ReportKind == FUTURES_REG_0302 )
        return "02";
     elif( m_ReportKind == FUTURES_REG_0303 )
        return "03";
     elif( m_ReportKind == FUTURES_REG_0304 )
        return "04";
     elif( m_ReportKind == FUTURES_REG_0305 )
        return "05";
     elif( m_ReportKind == FUTURES_REG_0306 )
        return "06";
     elif( m_ReportKind == FUTURES_REG_0310 )
        return "10";
     end;                                                 
  END;

  /*Номер месяца из даты <H0_.8>*/
  MACRO H0_4():STRING
     VAR Month;
     DateSplit( this.H0_8(), null, Month, null );

     return string(Month:2:o);
  END;

  /*Две последние цифры года из даты <H0_.8>*/
  MACRO H0_5():STRING
     VAR Year;
     DateSplit( this.H0_8(), null, null, Year );

     return SubStr( string(Year), strlen(string(Year))-1 );
  END;

  /*Название подвида регистра: */
  MACRO H0_6():STRING
     if( m_ReportKind == FUTURES_REG_0301 )
        return "Операции с ФИСС, не обращающимися на ОРЦБ, базисным активом которых являются акции, номинал которых выражен в валюте РФ, и депозитарные расписки  (сделки, по которым переход права собственности при продаже базисного актива состоялся в отчетном (налоговом) периоде)";
     elif( m_ReportKind == FUTURES_REG_0302 )
        return "Операции с ФИСС, не обращающимися на ОРЦБ, базисным активом которых являются процентные облигации, номинал которых выражен в валюте РФ  (сделки, по которым переход права собственности при продаже базисного актива состоялся в отчетном (налоговом) периоде)";
     elif( m_ReportKind == FUTURES_REG_0303 )
        return "Операции с ФИСС, не обращающимися на ОРЦБ, базисным активом которых являются дисконтные облигации, номинал которых выражен в валюте РФ  (сделки, по которым переход права собственности при продаже базисного актива состоялся в отчетном (налоговом) периоде)";
     elif( m_ReportKind == FUTURES_REG_0304 )
        return "Операции с ФИСС, не обращающимися на ОРЦБ, базисным активом которых являются акции, номинал которых выражен в иностранной валюте и депозитарные расписки (сделки, по которым переход права собственности при продаже базисного актива состоялся в отчетном (налоговом) периоде)";
     elif( m_ReportKind == FUTURES_REG_0305 )
        return "Операции с ФИСС, не обращающимися на ОРЦБ, базисным активом которых являются процентные облигации, номинал которых выражен в иностранной валюте  (сделки, по которым переход права собственности при продаже базисного актива состоялся в отчетном (налоговом) периоде)";
     elif( m_ReportKind == FUTURES_REG_0306 )
        return "Операции с ФИСС, не обращающимися на ОРЦБ, базисным активом которых являются дисконтные облигации, номинал которых выражен в иностранной валюте  (сделки, по которым переход права собственности при продаже базисного актива состоялся в отчетном (налоговом) периоде)";
     elif( m_ReportKind == FUTURES_REG_0310 )
        return "Операции с ФИСС, не обращающимися на ОРЦБ, базисным активом которых являются ценные бумаги (кроме сделок реализации, по которым переход права собственности при продаже базисного актива состоялся в отчетном (налоговом) периоде)";
     end;
  END;

  /*Начальная дата*/
  MACRO H0_7():DATE
     return Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_BEGINDATE );
  END;

  /*Конечная дата*/
  MACRO H0_8():DATE
     return Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_ENDDATE );
  END;

  /*Группа налогового учета*/
  MACRO H0_9():STRING
     var GroupName = "";
     Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_AVRGROUP, @GroupName );
     return GroupName;
  END;

  /*Вид ц/б*/
  MACRO H0_10():STRING
     var AvrKindShowValue = "";
     Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_AVRKIND, @AvrKindShowValue );
     return AvrKindShowValue;
  END;

  /*Выпуск ц/б*/
  MACRO H0_11():STRING
     return Futures_Form.GetFieldValue( PNFLD_FUTURES_REG_AVRNAME );
  END;

  /*Константа, задаваемая в макросе формировании отчета.  Значение константы - текст  "РР"*/
  MACRO H0_12():STRING
     return "PP";
  END;

  PRIVATE MACRO GetDeal( Deal:TBFile, DealID:INTEGER ):BOOL
     Deal.Clear();
     Deal.rec.DealID = DealID;
     return Deal.GetEQ();
  END;


  MACRO Deal():TBFile
     if( m_Deal.rec.DealID == 0 )
        if( GetDeal( m_Deal, m_RS.DealID ) == false )
           MsgBox( "Не найдена сделка по лоту налогового учета DSCTXLOT_DBT.t_DealID = " + string(m_RS.DealID)  );
           m_Deal.Clear();
        end;
     end;
     return m_Deal;
  END;





  MACRO Дк():DATE // дата начала купона, который начинается до <H0.7> включительно, а заканчивается после <H0.7>,
     var Дк;
     //нужно очищать, так как используется другая дата
     m_CacheFinInstr.Clear();
     Дк = m_CacheFinInstr.GetCouponParms( m_RS.FIID, this.H0_7(), date(1,1,9999) ).m_Дк;
     m_CacheFinInstr.Clear();
     return Дк;
  END;

  MACRO Code():STRING // Номер сделки для формы 310
     return m_RS.DealCode;
  END;

  MACRO Type():STRING // Тип сделки для формы 310
     return m_RS.TypeDeal;
  END;

  MACRO DZ():DATE // Дата заключения сделки
     if( m_DZ == NULL )
       m_DZ = SQL_ConvTypeDate(m_RS.DealDate);
     end;
     return m_DZ;
  END;

  MACRO DDP():DATE // Дата перехода права собств-ти(плановая) ЦБ
     return SQL_ConvTypeDate(m_RS.PlanDate);
  END;

  MACRO DOP():DATE // Дата оплаты (плановая) ЦБ
     return SQL_ConvTypeDate(m_RS.PlanPayDate);
  END;

  MACRO DDF():DATE // Дата перехода права собств-ти(фактическая) ЦБ
     return iif( SQL_ConvTypeDate(m_RS.FactDate) <= this.H0_8(), SQL_ConvTypeDate(m_RS.FactDate), Date(0,0,0) );
  END;

  MACRO DOF():DATE // Дата оплаты (фактическая) ЦБ
     return iif( SQL_ConvTypeDate(m_RS.FactPayDate) <= this.H0_8(), SQL_ConvTypeDate(m_RS.FactPayDate), Date(0,0,0) );
  END;

  MACRO QntyPrecision():INTEGER //  точность кол-ва
     return m_RS.t_SumPrecision;
  END;


  MACRO ifPartial():STRING //Признак частичной оплаты (Да. Нет)
    var retVal = "Нет";
     if( m_RS.CountPayms > 1 )
        retVal = "Да";
     end;
     return retVal;
  END;

  MACRO Price():double // Цена
     var Nom;

     if( m_Price == null )
        if (FI_IsBond(m_RS.FIID))
           m_Price = m_RS.Price; //цена сделки в % от номинала
        else
           if (m_RS.FaceValueFI != NATCUR)
              m_Price = this.SumVn()/this.Qnty();
           else
              m_Price = m_RS.Price;
           end;
        end;
     end;
     return m_Price;
  END;

  MACRO PrSvp():DOUBLE // Цена реализации - в валюте
     if((m_ReportKind == FUTURES_REG_0301) and (this.VPrS() == NATCUR))
       return 0;
     end;

     return this.PrSvp();
  END;


  MACRO SumVn():MONEY // Стоимость
     if( m_SumVn == NULL )
        //m_SumVn = СтоимостьОднойБумаги( m_RS.DealID, false, m_RS.FaceValueFI ) * m_RS.Amount;

        if(this.VPrS() == m_RS.FaceValueFI)
          m_SumVn = m_RS.DealCost;
        else
          if(this.DDF() > date(0,0,0))
            if((this.VPrS() == NATCUR) and (m_RS.FaceValueFI != NATCUR))
              m_SumVn = m_RS.DealCost/this.CrP();
            elif((this.VPrS() != NATCUR) and (m_RS.FaceValueFI == NATCUR))
              m_SumVn = m_RS.DealCost * this.CrBal(); 
            else
              m_SumVn = m_RS.DealCost/this.CrP();
            end;
          else
           // m_SumVn = 0.0;  
          end;
        end;

     end;
     return m_SumVn;
  END;


  MACRO NkdVn():MONEY //  НКД
     if( m_NkdVn == NULL )
        if(this.VPrS() == m_RS.FaceValueFI)
          m_NkdVn = m_RS.NKD;
        elif(this.DDF() > date(0,0,0))
          m_NkdVn = m_RS.NKD/this.CrD();
        else
        //  m_NkdVn = 0.0;
        end;
     end;
     return m_NkdVn;
  END;


  MACRO CoupVN():MONEY //  Купонный доход, полученный от эмитента при погашении купонов в отчетном (налоговом) периоде (кроме купона, полученного при погашении бумаги) :
     if( m_CoupVN == NULL )
        m_CoupVN = GetCouponSumByPeriod( m_RS.FIID, this.Qnty(), this.Дн(), this.DDS() );
     end;
     return m_CoupVN;
  END;

  MACRO CoupRub():MONEY // Сумма купонов, выплаченных эмитентом в текущем отчетном (налоговом) периоде - в рублях
     if( m_CoupRub == NULL )
        m_CoupRub = GetCouponSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.Дн(), this.DDS(), m_RS.FaceValueFI );
     end;
     return m_CoupRub;
  END;

  MACRO AmortVN():MONEY // Доходы, полученные при частичном погашении номинала :
     if( m_AmortVN == NULL )
        m_AmortVN = GetPartialSumByPeriod( m_RS.FIID, this.Qnty(), this.DDB()+1, this.DDS() );
     end;
     return m_AmortVN;
  END;

  MACRO AmortRub():MONEY //  Доходы, полученные при частичном погашении номинала- сумма, руб
     if( m_AmortRub == NULL )
        m_AmortRub = GetPartialSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.DDB()+1, this.DDS() );
     end;
     return m_AmortRub;
  END;


  MACRO NkdRepRub():MONEY // Процентный доход, начисленный за отчетный (налоговый) период, руб.
     if( m_NkdRepRub == NULL )
        m_NkdRepRub = $0;

        if( m_ReportKind == FUTURES_REG_0302 )
           if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
              m_NkdRepRub = this.NkdSVN() + this.CoupVN() - this.NkdPrevVN() - this.NkdBrepRub();
           else
              if( this.CoupVN() > 0 )
                 m_NkdRepRub = this.CoupVN()-this.NkdPrevVN()-this.NkdBrepRub();
              end;
           end;
        elif( m_ReportKind == FUTURES_REG_0305 )
           if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
              m_NkdRepRub = this.NkdSrub()+this.CoupRub()-this.NkdPrevRub()-this.NkdBrepRub();
           else
              if( this.CoupVN() > 0 )
                 m_NkdRepRub = this.CoupRub()-this.NkdPrevRub()-this.NkdBrepRub();
              end;
           end;
        elif( m_ReportKind == FUTURES_REG_0303 )
           if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
              m_NkdRepRub = this.NKDownVN()-this.NkdBefVN();
           end;
        end;

     end;
     return m_NkdRepRub;
  END;

  MACRO TotVp():MONEY
     return m_RS.TotalCost;
  END;

  MACRO SumAllrub():MONEY // Выручка от реализации (погашения) для целей налогообложения, руб. - Всего
      VAR Summa = $0;

      if( m_ReportKind == FUTURES_REG_0302 )
         if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
            Summa = this.SumSRub()+ this.AmortVN();
         else
            Summa = this.SumSRub()+this.NkdSvn()+ this.AmortVN();
         end;
      elif( m_ReportKind == FUTURES_REG_0305 )
         if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
            Summa = this.SumSRub()+ this.AmortRub();
         else
            Summa = this.SumSRub()+this.NkdSrub()+ this.AmortRub();
         end;
      end;

      return Summa;
  END;

  MACRO NKDminusRub():MONEY // Выручка от реализации (погашения) для целей налогообложения, руб. - в том числе: суммы % дохода, учтенные при налогообложении до начала текущего отчетного (налогового) периода
     VAR Summa = $0;

     if( ЛьготнаяОблигация( m_RS.TaxGroupType ) == false )
        if( this.CoupVN() == $0 )
           if( m_ReportKind == FUTURES_REG_0302 )
              Summa = this.NkdPrevVN();
           elif( m_ReportKind == FUTURES_REG_0305 )
              Summa = this.NkdPrevRub();
           end;
        end;
     end;
     return Summa;
  END;


  MACRO MinMrkt():DOUBLE // Минимальная цена на дату заключения на ОРЦБ, расчетная цена для ЦБ не обращ. на ОРЦБ (уменьшенная на 20%)
     return m_RS.SaleMarketPrice;
  END;


  MACRO Com():MONEY //  Комиссия, уплаченная при реализации
     if( m_Com == NULL )
        m_Com = СуммаКомиссий( Deal().rec.DealID, Deal().rec.BOfficeKind, DDF(), NATCUR );
     end;
     return m_Com;
  END;



  MACRO PrBvp():DOUBLE // Цена реализации - в валюте
     if((m_ReportKind == FUTURES_REG_0301) and (this.VPrB() == NATCUR))
       return 0;
     end;

     return this.PrBvp();
  END;


  MACRO RashAll():MONEY // Расходы при реализации
     VAR Summa = $0;

     if( (m_ReportKind == FUTURES_REG_0301) OR (m_ReportKind == FUTURES_REG_0303) OR
         (m_ReportKind == FUTURES_REG_0304) OR (m_ReportKind == FUTURES_REG_0306)
       )
        Summa = this.ComS()+this.SumBtax()+ this.ComB();
     else
        Summa = this.ComS()+this.SumBtax()+ this.ComB()+this.NkdBsellRub();
     end;

     return Summa;
  END;


  MACRO CrZ():DOUBLE //  Курс ЦБ РФ на дату заключения договора
     if( m_CrZ == NULL )
        if( m_RS.SalePriceFIID != NATCUR )
           m_CrZ = GetRateOnDateCrossDbl( this.DZ(), m_RS.SalePriceFIID, NATCUR, true );
        end;
     end;
     
     if((m_CrZ == NULL) or (m_CrZ == 0.0))
       m_CrZ = NULL;
       return 1.0;
     end;

     return m_CrZ;
  END;

  MACRO printCrZ():DOUBLE
     this.CrZ();
     return m_CrZ;
  END;

  MACRO CrD():DOUBLE //  Курс ЦБ РФ дату реализации
     if( m_CrD == NULL )
        if( (this.DDF() > Date(0,0,0)) and (m_RS.FaceValueFI != NATCUR) )
           m_CrD = GetRateOnDateCrossDbl( this.DDF(), m_RS.FaceValueFI, NATCUR, true );
        end;
     end;

     if((m_CrD == NULL) or (m_CrD == 0.0))
       m_CrD = NULL;
       return 1.0;
     end;

     return m_CrD;
  END;

  MACRO printCrD():DOUBLE
     this.CrD();
     return m_CrD;
  END;

  MACRO CrO():DOUBLE //  Курс ЦБ РФ дату реализации
     if( m_CrO == NULL )
       if( this.VPrS() != NATCUR )
          m_CrO = GetRateOnDateCrossDbl( this.DOF(), this.VPrS(), NATCUR, true );
       end;
     end;

     if((m_CrO == NULL) or (m_CrO == 0.0))
       m_CrO = NULL;
       return 1.0;
     end;

     return m_CrO;
  END;

  MACRO printCrO():DOUBLE
     this.CrO();
     return m_CrO;
  END;

  MACRO CrBal():DOUBLE //  Курс пересчета цены/ст-ти в рублевый эквивалент 
     if( m_CrBal == NULL )
        if( m_RS.SalePriceFIID != NATCUR )
           m_CrBal = ПолучитьКурсПостановкиНаБаланс(Deal());
        end;
     end;

     if((m_CrBal == NULL) or (m_CrBal == 0.0))
       m_CrBal = NULL;
       return 1.0;
     end;

     return m_CrBal;
  END;

  MACRO printCrBal():DOUBLE
     this.CrBal();
     return m_CrBal;
  END;

  MACRO CrP():DOUBLE //  Курс пересчета цены/стоимости  в валюту номинала 
    var VprRate;
    
    if(m_CrP == NULL)
      if((m_RS.FaceValueFI == NATCUR) and (this.VprS() == NATCUR))
        m_CrP = 1.0;
      elif((m_RS.FaceValueFI == NATCUR) and (this.VprS() != NATCUR))
        VprRate = GetRateOnDateCrossDbl( this.DDF(), this.VprS(), NATCUR, true );
        if((ValType(VprRate) != V_UNDEF) AND (VprRate != 0.0))
          m_CrP = 1/VprRate;
        else
          m_CrP = 0.0;
        end;
      elif((m_RS.FaceValueFI != NATCUR) and (this.VprS() != NATCUR))
        VprRate = GetRateOnDateCrossDbl( this.DDF(), this.VprS(), NATCUR, true );
        if((ValType(VprRate) != V_UNDEF) AND (VprRate != 0.0))
          m_CrP = GetRateOnDateCrossDbl( this.DDF(), m_RS.FaceValueFI, NATCUR, true )/VprRate;
        else
          m_CrP = 0.0;
        end;
      else
        m_CrP = GetRateOnDateCrossDbl( this.DDF(), m_RS.FaceValueFI, NATCUR, true );
      end;
    end;

    if((m_CrP == NULL) or (m_CrP == 0.0))
      m_CrP = NULL;
      return 1.0;
    end;

    return m_CrP;
  END;

  MACRO printCrP():DOUBLE
     this.CrP();
     return m_CrP;
  END;


  MACRO NkdBprevRub():MONEY // НКД, уплаченный при приобретении, уменьшающий процентные доходы, руб - процентные доходы прошлых налоговых периодов
     if( ifCoupPrev() == 1 )
        if( m_ReportKind == FUTURES_REG_0302 ) 
           return this.NkdBvn();
        elif( m_ReportKind == FUTURES_REG_0305 ) 
           return this.NkdBrub();
        end;
     end;
     return 0;
  END;

  MACRO NkdBrepRub():MONEY //  НКД, уплаченный при приобретении, уменьшающий процентные доходы, руб - процентные доходы текущего налогового периода
     if( m_NkdBrepRub == NULL )
        m_NkdBrepRub = 0;

        if( ЛьготнаяОблигация( m_RS.TaxGroupType ) == false )
           if( (this.ifCoupPrev() == 0) AND (this.CoupVN() > 0) )
              if( m_ReportKind == FUTURES_REG_0302 ) 
                 m_NkdBrepRub = this.NkdBvn();
              elif( m_ReportKind == FUTURES_REG_0305 ) 
                 m_NkdBrepRub = this.NkdBrub();
              end;
           end;
        else
           if( this.ifCoupPrev() == 0 )
              if( m_ReportKind == FUTURES_REG_0302 ) 
                 m_NkdBrepRub = this.NkdBvn();
              elif( m_ReportKind == FUTURES_REG_0305 ) 
                 m_NkdBrepRub = this.NkdBrub();
              end;
           end;
        end;
     end;
     return m_NkdBrepRub;
  END;

  MACRO NkdBsellRub():MONEY // НКД, уплаченный при приобретении, уменьшающий процентные доходы, руб - доходы от реализации (погашения)
     if( m_NkdBsellRub == NULL )
        m_NkdBsellRub = 0;
        if( ЛьготнаяОблигация( m_RS.TaxGroupType ) == false )
           if( (this.ifCoupPrev() == 0) AND (this.CoupVN() == 0) )
              if( m_ReportKind == FUTURES_REG_0302 ) 
                 m_NkdBsellRub = this.NkdBvn();
              elif( m_ReportKind == FUTURES_REG_0305 ) 
                 m_NkdBsellRub = this.NkdBrub();
              end;
           end;
        end;
     end;
     return m_NkdBsellRub;
  END;

  MACRO CoupSaldoRub():MONEY // Сальдо доходов при погашении купона, руб.
     if( m_CoupSaldoRub == NULL )
        if( m_ReportKind == FUTURES_REG_0302 ) 
           if( (ifCoupPrev() == 0) AND (CoupVN() > $0) )
              m_CoupSaldoRub = CoupVN() - NkdBvn();
           else
              m_CoupSaldoRub = CoupVN();
           end;

        elif( m_ReportKind == FUTURES_REG_0305 ) 
           if( (ifCoupPrev() == 0) AND (CoupRub() > $0) )
              m_CoupSaldoRub = CoupRub() - NkdBrub();
           else
              m_CoupSaldoRub = CoupRub();
           end;
        end;
     end;
     return m_CoupSaldoRub;
  END;

  MACRO Cont():STRING // Контрагент по сделке реализации 
     return m_RS.PartyName;
  END;


  MACRO Fil():STRING //  Номер сделки - ГО/филиал
     return T_Dep.Get_Dep(m_RS.DealDepartment);
  END;

  MACRO DBV():DATE
    if( (m_ReportKind == FUTURES_REG_0304) and (this.DDB() <= date(14,07,2005)))
      return date(14,07,2005);
    end;
    return this.DDB();
  END;

  MACRO CoupCount():INTEGER
    return GetCountCouponInPeriod(m_RS.t_FIID, this.Дн(), this.DDS());
  END;

  MACRO LastCoupDate():DATE
    return GetMaxCouponDrawingDateInPeriod(m_RS.t_FIID, this.Дн(), this.DDS());
  END;

  initTX_RegistrReport( Form, TemplateName, UseCSV, IsWebService, ReportHashCode );
END;

MACRO ReportRunEx(
  IsWebService    : Bool
 ,FormData      //: CTxReportForm
 ,ReportHashCode  : Integer
 ,menuItem      //: WsMenuItem
)
  var stat = true;
  var FullReportFileNames = TArray();
  WebMenuItem = menuItem;

  if( CheckTaxDepositoryMode() == false ) /*если не включен режим хранилища данных для налогового учета*/
    msgbox("Отчет доступен только в режиме хранилища");

    stat = false;
  end;

  if( stat )
    if( not IsWebService )
      Futures_Form = SP_FuturesReg_Panel();
    else
      if( ValType( FormData ) != V_UNDEF )
        Futures_Form = WS_TX_FuturesReg_Panel( FormData );
      else
        stat = false;
      end;
    end;
  end;

  while( stat )
    if( not IsWebService )
      stat = Futures_Form.Run();
    end;

    if( stat )
      Futures_Report = SP_FuturesReg_Report( null, "Report_TXFutures.xls", null, IsWebService, ReportHashCode );
      Futures_Report.Run();

      if( IsWebService )
        Dl_CallInsertStat( Futures_Report.PrintMode(), menuItem.iCaseItem, menuItem.iIdentProgram, menuItem.szNameItem);
        FullReportFileNames = Futures_Report.GetFullReportFileNames();
        stat = false;
      else
        Dl_CallInsertStat( Futures_Report.PrintMode() );
      end;
    end;
  end;

  return FullReportFileNames;
END;
