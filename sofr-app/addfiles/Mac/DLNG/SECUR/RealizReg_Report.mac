/*
$Name:             RealizReg_Report.mac
$Module:           АРНУ
$Description:      Отчет "Регистры по реализации" (НУ)
*/

IMPORT "RealizReg_Form.mac", "RegistrReport.mac", "ws_txreportform.mac";

/*Здесь можно через "," в апострофах указать код (FININSTR.FI_Code) ценных бумаг, которые будут исключаться из отчета.
  Например: 
    ИсключаемыеИзОтчетаЦБ = "'1','2','3'"
*/
PRIVATE VAR RealizReg_Form;
PRIVATE VAR RealizReg_Report;
PRIVATE VAR WebMenuItem; // Информация о запуске отчета из веб

PRIVATE CONST ИсключаемыеИзОтчетаЦБ = "";

PRIVATE CONST H012 = "PP",
              H01  = "02",                                                                                                                                                                                                                                                                                                   
              H02  = "XXX",                                                                                                                                                                                                                                                                                                  
              ItogsLineName = "Всего:";

PRIVATE CONST SHEET_0201  = "0201";
PRIVATE CONST SHEET_0202  = "0202";
PRIVATE CONST SHEET_0203  = "0203";
PRIVATE CONST SHEET_0204  = "0204";
PRIVATE CONST SHEET_0205  = "0205";
PRIVATE CONST SHEET_0206  = "0206";

PRIVATE MACRO WhereCondBond()
  return " RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_BOND+", FinInstr.t_AvoirKind) > 0 ";
END;

/*Процентной облигацией считается облигация, относящаяся к одной из следующих налоговых групп:*/
PRIVATE MACRO WhereCondPC()
  return WhereCondBond() + " AND Rsb_SCTX.TXIsPercentAvoir(av.t_TaxGroup) = 1 ";
END;

/*Дисконтной облигацией считается облигация, относящаяся к одной из следующих налоговых групп:*/
PRIVATE MACRO WhereCondDiscount()
  return WhereCondBond() + " AND Rsb_SCTX.TXIsDiscountAvoir(av.t_TaxGroup) = 1 ";
END;

/*сделки с акциями, паями и депозитарными расписками*/
PRIVATE MACRO WhereCond201()
  return " ( RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_SHARE+", fininstr.t_AvoirKind) > 0 "
       + "   OR RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_DEPOSITORY_RECEIPT+", fininstr.t_AvoirKind) > 0 "
       + "   OR RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_INVESTMENT_SHARE+", fininstr.t_AvoirKind) > 0 ) ";
END;

PRIVATE MACRO WhereCondNominalRUR()
  return " fininstr.t_FaceValueFI = 0 ";
END;

PRIVATE CLASS CRealizReg_201( Report:OBJECT )
  VAR m_Report = Report;

  MACRO Where():STRING
     /*0201 отбираются сделки с акциями, паями и депозитарными расписками, номинированными в рублях */
     return WhereCondNominalRUR() + " AND " + WhereCond201();
  END;

  MACRO BeginReport()
     m_Report.PrintHeader( "N1_", "01", SHEET_0201, "Реализация акций, номинал которых выражен в валюте РФ, паев и депозитарных расписок" );
     m_Report.RegisterTable( "N1_MainTable", "",
                             "N1_SecCode",  "N1_SecName",  "N1_CodeS",   "N1_DZS",     "N1_DDS",      "N1_Qnty",      
                             "N1_VPrS",     "N1_PrSvp",    "N1_PrSrub",  "N1_SumSvp",  "N1_SumSrub",  "N1_MinMrkt",   
                             "N1_MrktS",    "N1_DMrktS",   "N1_DifS",    "N1_ComS",    "N1_CodeB",    "N1_DZB",   
                             "N1_DDB",      "N1_VPrB",     "N1_PrBvp",   "N1_PrBrub",  "N1_SumBvp",   "N1_SumBrub",   
                             "N1_MaxMrkt",  "N1_MrktB",    "N1_DMrktB",  "N1_DifB",    "N1_SumBtax",  "N1_ComB",  
                             "N1_RashAll",  "N1_CrSZ",     "N1_CrBZ",    "N1_CrSD",    "N1_CrBD",     "N1_DqualS",    
                             "N1_DqualB",   "N1_ContS",    "N1_ContB",   "N1_FilS",    "N1_FilB",     "N1_SecType",
                             "N1_DepS",     "N1_DepP"   
                           );

     m_Report.SetCellAutoSummaPoint( ItogsLineName, "N1_Qnty",6, "N1_SumSrub",2, "N1_DifS",2, "N1_ComS",2, "N1_SumBrub",2, "N1_DifB",2, "N1_SumBtax",2, "N1_ComB",2, "N1_RashAll",2 );

     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.PrintTableLine( "N1_SecCode",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, false, false );
     m_Report.PrintTableLine( "N1_SecCode",  "В том числе:", null );
  END;

  MACRO EndReport()
     m_Report.EndTable();
     this.ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N1_" );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                        "F23",
                        "K23",     
                        "O23",        
                        "P23",        
                        "X23",     
                        "AB23",        
                        "AC23",     
                        "AD23",        
                        "AE23"     
                    );                                                                      
  END;


  MACRO Print()
                 
          m_Report.PrintTableLine( 
                      /*1  */     "N1_SecCode",   m_Report.SecCode(),   null,                     
                      /*2  */     "N1_SecName",   m_Report.SecName(),   null,                     
                      /*3  */     "N1_CodeS",     m_Report.CodeS(),     null,                     
                      /*4  */     "N1_DZS",       m_Report.DZS(),       null,                     
                      /*5  */     "N1_DDS",       m_Report.DDS(),       null,                     
                      /*6  */     "N1_Qnty",      m_Report.Qnty(),      m_Report.QntyPrecision(), 
                      /*7  */     "N1_VPrS",      m_Report.VPrSNumber(),null ,
                      /*8  */     "N1_PrSvp",     IIF(m_Report.VprS()==NATCUR, "", m_Report.PrSvp()),     null, 
                      /*9  */     "N1_PrSrub",    m_Report.PrSrub(),    null,
                      /*10 */     "N1_SumSvp",    IIF(m_Report.VprS()!=NATCUR, m_Report.SumSvp(), ""),    null,
                      /*11 */     "N1_SumSrub",   m_Report.SumSrub(),   null,
                      /*12 */     "N1_MinMrkt",   m_Report.MinMrkt(),   null,
                      /*13 */     "N1_MrktS",     m_Report.MrktS(),     null,
                      /*14 */     "N1_DMrktS",    m_Report.DMrktS(),    null,
                      /*15 */     "N1_DifS",      m_Report.DifS(),      null,
                      /*16 */     "N1_ComS",      m_Report.ComS(),      null,
                      /*17 */     "N1_CodeB",     m_Report.CodeB(),     null,
                      /*18 */     "N1_DZB",       m_Report.DZB(),       null,
                      /*19 */     "N1_DDB",       m_Report.DDB(),       null,
                      /*20 */     "N1_VPrB",      m_Report.VPrBNumber(),null,
                      /*21 */     "N1_PrBvp",     IIF(m_Report.VprB()==NATCUR, "", m_Report.PrBvp()),     null,
                      /*22 */     "N1_PrBrub",    m_Report.PrBrub(),    null,
                      /*23 */     "N1_SumBvp",    IIF(m_Report.VprB()!=NATCUR, m_Report.SumBvp(), ""),    null,
                      /*24 */     "N1_SumBrub",   m_Report.SumBrub(),   null,
                      /*25 */     "N1_MaxMrkt",   m_Report.MaxMrkt(),   null,
                      /*26 */     "N1_MrktB",     m_Report.MrktB(),     null,
                      /*27 */     "N1_DMrktB",    m_Report.DMrktB(),    null,
                      /*28 */     "N1_DifB",      m_Report.DifB(),      null,
                      /*29 */     "N1_SumBtax",   m_Report.SumBtax(),   null,
                      /*30 */     "N1_ComB",      m_Report.ComB(),      null,
                      /*31 */     "N1_RashAll",   m_Report.RashAll(),   null,
                      /*Т1 */     "N1_CrSZ",      m_Report.printCrSZ(), null,
                      /*Т2 */     "N1_CrBZ",      m_Report.printCrBZ(), null,
                      /*Т3 */     "N1_CrSD",      m_Report.printCrSD(), null,
                      /*Т4 */     "N1_CrBD",      m_Report.printCrBD(), null,
                      /*Т5 */     "N1_DqualS",    m_Report.DqualS(),    null,
                      /*Т6 */     "N1_DqualB",    m_Report.DqualB(),    null,
                      /*Т7 */     "N1_ContS",     m_Report.ContS(),     null,
                      /*Т8 */     "N1_ContB",     m_Report.ContB(),     null,
                      /*Т9*/      "N1_FilS",      m_Report.FilS(),      null,
                      /*Т10*/     "N1_FilB",      m_Report.FilB(),      null,
                      /*Т11*/     "N1_SecType",   m_Report.SecType(),   null,
                                  "N1_DepS",      m_Report.DepS(),      null,
                                  "N1_DepP",      m_Report.DEpB(),      null
                                  );
  END;
  
END;

PRIVATE CLASS CRealizReg_202( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*0202 отбираются сделки с процентными облигациями, номинированными в рублях */
     return WhereCondNominalRUR() + " AND " + WhereCondPC();
  END;
  
  MACRO BeginReport()
     m_Report.PrintHeader( "N2_", "02", SHEET_0202, "Реализация (погашение) купонных облигаций, номинал которых выражен в валюте РФ" );
     m_Report.RegisterTable( "N2_MainTable", "",
                             "N2_SecCode",      "N2_SecName",      "N2_CodeS",                 "N2_DZS",               "N2_DDS",         "N2_Qnty",
                             "N2_PrSNom",       "N2_SumSrub",      "N2_NkdSvn",                "N2_Tprev",             "N2_NkdPrevVN",   "N2_CoupVN",
                             "N2_NkdRepRub",    "N2_AmortVNrep",   "N2_SumAllrub",             "N2_NKDminusRub",       "N2_MinMrkt",     "N2_MrktS",
                             "N2_DMrktS",       "N2_DifS",         "N2_ComS",                  "N2_CodeB",             "N2_DZB",         "N2_DDB",
                             "N2_PrBnom",       "N2_SumBrub",      "N2_NkdBVN",                "N2_MaxMrkt",           "N2_MrktB",       "N2_DMrktB",
                             "N2_DifB",         "N2_SumBtax",      "N2_ComB",                  "N2_RashAll",
                             "N2_DifSumBRub",   "N2_SumBNRub",     "N2_DifSum_BRub_AmortPrev", "N2_SumBRub_AmortPrev", "N2_AmortVN",     "N2_AmortVN_before",        
                             "N2_AmortVN_after","N2_AmortVNPer",   "N2_KSumBvn",               "N2_SumBvp_exps",
                             "N2_ifCoupPrev",   "N2_CoupCount",
                             "N2_LastCoupDate", "N2_CVN1",         "N2_CVN2",         "N2_CVN3",          "N2_CVN4",        "N2_NkdBprevRub",
                             "N2_NkdBrepRub",   "N2_NkdBsellRub",  "N2_CoupSaldoRub", "N2_SellType",      "N2_DqualS",      "N2_DqualB",
                             "N2_ContS",        "N2_ContB",        "N2_FilS",         "N2_FilB",          "N2_SecType",
                             "N2_DepS",         "N2_DepP"   
                           );

     m_Report.SetCellAutoSummaPoint( ItogsLineName, 
                                "N2_Qnty",6, "N2_SumSrub",2, "N2_NkdSvn",2, "N2_NkdPrevVN",2, "N2_CoupVN",2, "N2_NkdRepRub",2, "N2_AmortVN",2, "N2_SumAllrub",2, "N2_NKDminusRub",2,
                                "N2_DifS",2, "N2_ComS",2, "N2_SumBrub",2, "N2_NkdBVN",2, "N2_DifB",2, "N2_SumBtax",2, "N2_ComB",2, "N2_RashAll",2,
                                "N2_DifSumBRub",2,  "N2_SumBNRub",2,  "N2_DifSum_BRub_AmortPrev",2,  "N2_SumBRub_AmortPrev",2, "N2_AmortVN",2,     "N2_AmortVN_before",2,        
                                "N2_AmortVN_after",2, "N2_AmortVNPer",2, "N2_SumBvp_exps",2,
                                "N2_CVN1",2, "N2_CVN2",2,
                                "N2_CVN3",2, "N2_CVN4",2, "N2_NkdBprevRub",2, "N2_NkdBrepRub",2, "N2_NkdBsellRub",2, "N2_CoupSaldoRub",2                                 
                              );
                     
     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.PrintTableLine( "N2_SecCode",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, false, false );
     m_Report.PrintTableLine( "N2_SecCode",  "В том числе:", null );
  END;
  
  MACRO EndReport()
     m_Report.EndTable();
     this.ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N2_" );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                                 "F23",
                                 "H23",        
                                 "I23",         
                                 "K23",      
                                 "L23",         
                                 "M23",      
                                 "N23",        
                                 "O23",      
                                 "P23",    
                                 "T23",           
                                 "U23",           
                                 "Z23",        
                                 "AA23",              
                                 "AE23",           
                                 "AF23",        
                                 "AG23",           
                                 "AH23",
                                 "AI23",
                                 "AG23",
                                 "AK23",
                                 "AL23",           
                                 "AM23",
                                 "AN23",           
                                 "AO23",           
                                 "AP23",
                                 "AR23",
                                 "AV23",     
                                 "AW23",                               
                                 "AX23",     
                                 "AY23",     
                                 "AZ23",     
                                 "BA23",     
                                 "BB23",
                                 "BC23"
     
                    );                                                                      
  END;


  MACRO Print()
          m_Report.PrintTableLine(
                          /*1  */   "N2_SecCode",        m_Report.SecCode(),           null,                   
                          /*2  */   "N2_SecName",        m_Report.SecName(),           null,                   
                          /*3  */   "N2_CodeS",          m_Report.CodeS(),             null,                   
                          /*4  */   "N2_DZS",            m_Report.DZS(),               null,                   
                          /*5  */   "N2_DDS",            m_Report.DDS(),               null,                   
                          /*6  */   "N2_Qnty",           m_Report.Qnty(),              m_Report.QntyPrecision(),
                          /*7  */   "N2_PrSNom",         m_Report.PrSNom(),            null,                    
                          /*8  */   "N2_SumSrub",        m_Report.SumSrub(),           null,                    
                          /*9  */   "N2_NkdSvn",         m_Report.NkdSvn(),            null,                    
                          /*10 */   "N2_Tprev",          m_Report.Tprev(),             null,                    
                          /*11 */   "N2_NkdPrevVN",      m_Report.NkdPrevVN(),         null,                    
                          /*12 */   "N2_CoupVN",         m_Report.CoupVN(),            null,                    
                          /*13 */   "N2_NkdRepRub",      m_Report.NkdRepRub(),         null,                    
                          /*14 */   "N2_AmortVNrep",     m_Report.AmortVNrep(),        null,                    
                          /*15 */   "N2_SumAllrub",      m_Report.SumAllrub(),         null,                    
                          /*16 */   "N2_NKDminusRub",    m_Report.NKDminusRub(),       null,                    
                          /*17 */   "N2_MinMrkt",        m_Report.MinMrkt(),           null,                    
                          /*18 */   "N2_MrktS",          m_Report.MrktS(),             null,                    
                          /*19 */   "N2_DMrktS",         m_Report.DMrktS(),            null,                    
                          /*20 */   "N2_DifS",           m_Report.DifS(),              null,                    
                          /*21 */   "N2_ComS",           m_Report.ComS(),              null,                    
                          /*22 */   "N2_CodeB",          m_Report.CodeB(),             null,                    
                          /*23 */   "N2_DZB",            m_Report.DZB(),               null,                    
                          /*24 */   "N2_DDB",            m_Report.DDB(),               null,                    
                          /*25 */   "N2_PrBnom",         m_Report.PrBnom(),            null,                    
                          /*26 */   "N2_SumBrub",        m_Report.SumBrub(),           null,                    
                          /*27 */   "N2_NkdBVN",         m_Report.NkdBVN(),            null,                    
                          /*28 */   "N2_MaxMrkt",        m_Report.MaxMrkt(),           null,                    
                          /*29 */   "N2_MrktB",          m_Report.MrktB(),             null,                    
                          /*30 */   "N2_DMrktB",         m_Report.DMrktB(),            null,                    
                          /*31 */   "N2_DifB",           m_Report.DifB(),              null,                    
                          /*32 */   "N2_SumBtax",        m_Report.SumBtax(),           null,                    
                          /*33 */   "N2_ComB",           m_Report.ComB(),              null,                    
                          /*34 */   "N2_RashAll",        m_Report.RashAll(),           null,
                                                                
                                    "N2_DifSumBRub",            m_Report.DifSumBRub(),            null,
                                    "N2_SumBNRub",              m_Report.SumBNRub(),              null,
                                    "N2_DifSum_BRub_AmortPrev", m_Report.DifSumBRub_AmortPrev(), null,
                                    "N2_SumBRub_AmortPrev",     m_Report.SumBRub_AmortPrev(),     null,
                                    "N2_AmortVN",               m_Report.AmortVN(),               null,
                                    "N2_AmortVN_before",        m_Report.AmortVN_before(),        null,
                                    "N2_AmortVN_after",         m_Report.AmortVN_after(),         null,
                                    "N2_AmortVNPer",            m_Report.AmortVNPer(),            null,
                                    "N2_KSumBvn",               m_Report.KSumBvn(),               null,
                                    "N2_SumBvp_exps",           m_Report.SumBvp_exps(),           null,
                                                                
                          /*Т1 */   "N2_ifCoupPrev",     m_Report.ifCoupPrev(),        null,                    
                          /*Т2 */   "N2_CoupCount",      m_Report.CoupCount(),         null,                    
                          /*Т3 */   "N2_LastCoupDate",   m_Report.LastCoupDate(),      null,                    
                          /*Т4 */   "N2_CVN1",           m_Report.CVN1(),              null,                    
                          /*Т5 */   "N2_CVN2",           m_Report.CVN2(),              null,                    
                          /*Т6 */   "N2_CVN3",           m_Report.CVN3(),              null,                    
                          /*Т7 */   "N2_CVN4",           m_Report.CVN4(),              null,                    
                          /*Т8 */   "N2_NkdBprevRub",    m_Report.NkdBprevRub(),       null,                    
                          /*Т9 */   "N2_NkdBrepRub",     m_Report.NkdBrepRub(),        null,                   
                          /*Т10*/   "N2_NkdBsellRub",    m_Report.NkdBsellRub(),       null,                    
                          /*Т9*/    "N2_CoupSaldoRub",   m_Report.CoupSaldoRub(),      null,                    
                          /*Т10*/   "N2_SellType",       m_Report.SellType(),          null,                    
                          /*Т11*/   "N2_DqualS",         m_Report.DqualS(),            null,                    
                          /*Т12*/   "N2_DqualB",         m_Report.DqualB(),            null,                    
                          /*Т13*/   "N2_ContS",          m_Report.ContS(),             null,                    
                          /*Т14*/   "N2_ContB",          m_Report.ContB(),             null,                    
                          /*Т15*/   "N2_FilS",           m_Report.FilS(),              null,                    
                          /*Т16*/   "N2_FilB",           m_Report.FilB(),              null,                    
                          /*Т17*/   "N2_SecType",        m_Report.SecType(),           null,                     
                                    "N2_DepS",           m_Report.DepS(),              null,
                                    "N2_DepP",           m_Report.DEpB(),              null
                            );
  END;         
END;

PRIVATE CLASS CRealizReg_203( Report:OBJECT )
  VAR m_Report = Report;

  MACRO Where():STRING
     /*0203 - отбираются сделки с дисконтными облигациями, номинированными в рублях*/
     return WhereCondNominalRUR() + " AND " + WhereCondDiscount();
  END;

  MACRO BeginReport()
     m_Report.PrintHeader( "N3_", "03", SHEET_0203, "Реализация (погашение) дисконтных облигаций, номинал которых выражен в валюте РФ" );
     m_Report.RegisterTable( "N3_MainTable", "",
                             "N3_SecCode",       "N3_SecName",       "N3_CodeS",     "N3_DZS",     "N3_DDS",       "N3_Nom",   
                             "N3_DAuс",          "N3_Dexp",          "N3_PrAucNom",  "N3_Qnty",    "N3_PrSNom",    "N3_SumSrub",   
                             "N3_NkdBefVN",      "N3_NKDownVN",      "N3_NkdRepRub", "N3_IncRub",  "N3_MinMrkt",   "N3_MrktS", 
                             "N3_DMrktS",        "N3_DifS",          "N3_ComS",      "N3_CodeB",   "N3_DZB",       "N3_DDB",   
                             "N3_PrBnom",        "N3_SumBrub",       "N3_MaxMrkt",   "N3_MrktB",   "N3_DMrktB",    "N3_DifB",  
                             "N3_SumBtax",       "N3_ComB",          "N3_RashAll",   "N3_DqualS",  "N3_DqualB",    "N3_ContS", 
                             "N3_ContB",         "N3_FilS",          "N3_FilB",      "N3_SecType",                           
                             "N3_DepS",          "N3_DepP"   
                        );

     m_Report.SetCellAutoSummaPoint( ItogsLineName,
                                "N3_Qnty",6,     
                                "N3_SumSrub",2,  
                                "N3_NkdBefVN",2, 
                                "N3_NKDownVN",2, 
                                "N3_NkdRepRub",2,
                                "N3_IncRub",2,   
                                "N3_DifS",2,     
                                "N3_ComS",2,     
                                "N3_SumBrub",2,  
                                "N3_DifB",2,     
                                "N3_SumBtax",2,  
                                "N3_ComB",2,
                                "N3_RashAll",2
     
                              ); 
                              
     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.PrintTableLine( "N3_SecCode",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, false, false );
     m_Report.PrintTableLine( "N3_SecCode",  "В том числе:", null );
  END;

  MACRO EndReport()
     m_Report.EndTable();
     this.ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N3_" );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                        "J23",        
                        "L23",     
                        "M23",    
                        "N23",    
                        "O23",   
                        "P23",      
                        "T23",        
                        "U23",        
                        "Z23",     
                        "AD23",        
                        "AE23",     
                        "AF23",        
                        "AG23"     
                     );                                                                      
  END;


  MACRO Print()
          m_Report.PrintTableLine(
/*1  */                   "N3_SecCode",     m_Report.SecCode(),      null,                      
/*2  */                   "N3_SecName",     m_Report.SecName(),      null,                      
/*3  */                   "N3_CodeS",       m_Report.CodeS(),        null,                      
/*4  */                   "N3_DZS",         m_Report.DZS(),          null,                      
/*5  */                   "N3_DDS",         m_Report.DDS(),          null,                      
/*6  */                   "N3_Nom",         m_Report.Nom(),          null,                      
/*7  */                   "N3_DAuс",        m_Report.Dauc(),         null,                      
/*8  */                   "N3_Dexp",        m_Report.Dexp(),         null,                      
/*9  */                   "N3_PrAucNom",    m_Report.PrAucNom(),     null,                      
/*10 */                   "N3_Qnty",        m_Report.Qnty(),         m_Report.QntyPrecision(),  
/*11 */                   "N3_PrSNom",      m_Report.PrSNom(),       null,                      
/*12 */                   "N3_SumSrub",     m_Report.SumSrub(),      null,                      
/*13 */                   "N3_NkdBefVN",    m_Report.NkdBefVN(),     null,                      
/*14 */                   "N3_NKDownVN",    m_Report.NKDownVN(),     null,                      
/*15 */                   "N3_NkdRepRub",   m_Report.NkdRepRub(),    null,                      
/*16 */                   "N3_IncRub",      m_Report.IncRub(),       null,                      
/*17 */                   "N3_MinMrkt",     m_Report.MinMrkt(),      null,                      
/*18 */                   "N3_MrktS",       m_Report.MrktS(),        null,                      
/*19 */                   "N3_DMrktS",      m_Report.DMrktS(),       null,                      
/*20 */                   "N3_DifS",        m_Report.DifS(),         null,                      
/*21 */                   "N3_ComS",        m_Report.ComS(),         null,                      
/*22 */                   "N3_CodeB",       m_Report.CodeB(),        null,                      
/*23 */                   "N3_DZB",         m_Report.DZB(),          null,                      
/*24 */                   "N3_DDB",         m_Report.DDB(),          null,                      
/*25 */                   "N3_PrBnom",      m_Report.PrBnom(),       null,                      
/*26 */                   "N3_SumBrub",     m_Report.SumBrub(),      null,                      
/*27 */                   "N3_MaxMrkt",     m_Report.MaxMrkt(),      null,                      
/*28 */                   "N3_MrktB",       m_Report.MrktB(),        null,                      
/*29 */                   "N3_DMrktB",      m_Report.DMrktB(),       null,                      
/*30 */                   "N3_DifB",        m_Report.DifB(),         null,                      
/*31 */                   "N3_SumBtax",     m_Report.SumBtax(),      null,                      
/*32 */                   "N3_ComB",        m_Report.ComB(),         null,                      
/*33 */                   "N3_RashAll",     m_Report.RashAll(),      null,                      
/*Т1 */                   "N3_DqualS",      m_Report.DqualS(),       null,                      
/*Т2 */                   "N3_DqualB",      m_Report.DqualB(),       null,                      
/*Т3 */                   "N3_ContS",       m_Report.ContS(),        null,                      
/*Т4 */                   "N3_ContB",       m_Report.ContB(),        null,                      
/*Т5 */                   "N3_FilS",        m_Report.FilS(),         null,                      
/*Т6 */                   "N3_FilB",        m_Report.FilB(),         null,                      
/*Т7 */                   "N3_SecType",     m_Report.SecType(),      null,                                       
                          "N3_DepS",        m_Report.DepS(),         null,
                          "N3_DepP",        m_Report.DEpB(),         null
                                  ); 
  END;         
END;

PRIVATE CLASS CRealizReg_204( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*0204 - отбираются сделки с акциями, паями и депозитарными расписками, номинированными в иностранной валюте */
     return " NOT ( " + WhereCondNominalRUR() + ") AND " + WhereCond201();
  END;
  
  MACRO BeginReport()
     m_Report.PrintHeader( "N4_", "04", SHEET_0204, "Реализация акций, номинал которых выражен в иностранной валюте, паев и депозитарных расписок" );
     m_Report.RegisterTable( "N4_MainTable", "",
                             "N4_SecCode",  "N4_SecName",  "N4_CodeS",    "N4_DZS",      "N4_DDS",      "N4_Qnty",      
                             "N4_VN",       "N4_PrSVN",    "N4_SumSvn",   "N4_SumSrub",  "N4_MinMrkt",  "N4_MrktS", 
                             "N4_DMrktS",   "N4_DifS",     "N4_ComS",     "N4_CodeB",    "N4_DZB",      "N4_DDB",   
                             "N4_PrBvn",    "N4_SumBvn",   "N4_SumBrub",  "N4_MaxMrkt",  "N4_MrktB",    "N4_DMrktB",    
                             "N4_DifB",     "N4_SumBtax",  "N4_ComB",     "N4_RashAll",  "N4_VPrB",     "N4_PrBvp",  
                             "N4_VPrS",     "N4_PrSvp",    "N4_CrSZ",     "N4_CrBZ",     "N4_CrSD",     "N4_CrBD",  
                             "N4_CrSP",     "N4_CrBP",     "N4_DqualS",   "N4_DqualB",   "N4_ContS",    "N4_ContB", 
                             "N4_FilS",     "N4_FilB",     "N4_SecType",
                             "N4_DepS",     "N4_DepP"   
                           );

     m_Report.SetCellAutoSummaPoint( ItogsLineName, 
                                "N4_Qnty",6, "N4_SumSvn",2, "N4_SumSrub",2, "N4_DifS",2, "N4_ComS",2, "N4_SumBvn",2, "N4_SumBrub",2,    
                                "N4_DifB",2, "N4_SumBtax",2, "N4_ComB",2, "N4_RashAll",2                                                                 
                              );

     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.PrintTableLine( "N4_SecCode",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, false, false );
     m_Report.PrintTableLine( "N4_SecCode",  "В том числе:", null );
  END;
  
  MACRO EndReport()
     m_Report.EndTable();
     this.ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N4_" );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                        "F23",      
                        "I23",    
                        "J23",   
                        "N23",      
                        "O23",      
                        "T23",    
                        "U23",    
                        "Y23",      
                        "Z23",   
                        "AA23",      
                        "AB23"   
                     );                                                                      
  END;

  
  MACRO Print()
          m_Report.PrintTableLine(
/*1  */            "N4_SecCode",     m_Report.SecCode(),      null,                    
/*2  */            "N4_SecName",     m_Report.SecName(),      null,                    
/*3  */            "N4_CodeS",       m_Report.CodeS(),        null,                    
/*4  */            "N4_DZS",         m_Report.DZS(),          null,                    
/*5  */            "N4_DDS",         m_Report.DDS(),          null,                    
/*6  */            "N4_Qnty",        m_Report.Qnty(),         m_Report.QntyPrecision(),
/*7  */            "N4_VN",          m_Report.VN(),           null,                    
/*8  */            "N4_PrSVN",       m_Report.PrSVN(),        null,                    
/*9  */            "N4_SumSvn",      m_Report.SumSvn(),       null,                    
/*10 */            "N4_SumSrub",     m_Report.SumSrub(),      null,                    
/*11 */            "N4_MinMrkt",     m_Report.MinMrkt(),      null,                    
/*12 */            "N4_MrktS",       m_Report.MrktS(),        null,                    
/*13 */            "N4_DMrktS",      m_Report.DMrktS(),       null,                    
/*14 */            "N4_DifS",        m_Report.DifS(),         null,                    
/*15 */            "N4_ComS",        m_Report.ComS(),         null,                    
/*16 */            "N4_CodeB",       m_Report.CodeB(),        null,                    
/*17 */            "N4_DZB",         m_Report.DZB(),          null,                    
/*18 */            "N4_DDB",         m_Report.DDB(),          null,                    
/*19 */            "N4_PrBvn",       m_Report.PrBvn(),        null,                    
/*20 */            "N4_SumBvn",      m_Report.SumBvn(),       null,                    
/*21 */            "N4_SumBrub",     m_Report.SumBrub(),      null,                    
/*22 */            "N4_MaxMrkt",     m_Report.MaxMrkt(),      null,                    
/*23 */            "N4_MrktB",       m_Report.MrktB(),        null,                    
/*24 */            "N4_DMrktB",      m_Report.DMrktB(),       null,                    
/*25 */            "N4_DifB",        m_Report.DifB(),         null,                    
/*26 */            "N4_SumBtax",     m_Report.SumBtax(),      null,                    
/*27 */            "N4_ComB",        m_Report.ComB(),         null,                    
/*28 */            "N4_RashAll",     m_Report.RashAll(),      null,                    
/*Т1 */            "N4_VPrB",        m_Report.VPrBNumber(),   null,                    
/*Т2 */            "N4_PrBvp",       m_Report.PrBvp(),        null,                    
/*Т3 */            "N4_VPrS",        m_Report.VPrSNumber(),   null,                    
/*Т4 */            "N4_PrSvp",       m_Report.PrSvp(),        null,                    
/*Т5 */            "N4_CrSZ",        m_Report.printCrSZ(),    null,                    
/*Т6 */            "N4_CrBZ",        m_Report.printCrBZ(),    null,                    
/*Т7 */            "N4_CrSD",        m_Report.printCrSD(),    null,                    
/*Т8 */            "N4_CrBD",        m_Report.printCrBD(),    null,                    
/*Т9*/             "N4_CrSP",        m_Report.printCrSP(),    null,                    
/*Т10*/            "N4_CrBP",        m_Report.printCrBP(),    null,                    
/*Т11*/            "N4_DqualS",      m_Report.DqualS(),       null,                    
/*Т12*/            "N4_DqualB",      m_Report.DqualB(),       null,                    
/*Т13*/            "N4_ContS",       m_Report.ContS(),        null,                     
/*Т14*/            "N4_ContB",       m_Report.ContB(),        null,
/*Т15*/            "N4_FilS",        m_Report.FilS(),         null,
/*Т16*/            "N4_FilB",        m_Report.FilB(),         null,
/*Т17*/            "N4_SecType",     m_Report.SecType(),      null,
                   "N4_DepS",        m_Report.DepS(),         null,
                   "N4_DepP",        m_Report.DEpB(),         null
                                  );
  END;                           
END;

PRIVATE CLASS CRealizReg_205( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*205 - отбираются сделки с процентными облигациями, номинированными в иностранной валюте*/
     return " NOT ( " + WhereCondNominalRUR() + ") AND " + WhereCondPC();
  END;
  
  MACRO BeginReport()
     m_Report.PrintHeader( "N5_", "05", SHEET_0205, "Реализация (погашение) купонных облигаций, номинал которых выражен в иностранной валюте" );
     m_Report.RegisterTable( "N5_MainTable", "",
                             "N5_SecCode",      "N5_SecName",     "N5_CodeS",       "N5_DZS",           "N5_DDS",       "N5_Qnty",
                             "N5_VN",           "N5_PrSNom",      "N5_SumSvn",      "N5_SumSrub",       "N5_NkdSvn",    "N5_NkdSrub",
                             "N5_Tprev",        "N5_NkdPrevVN",   "N5_NkdPrevRub",  "N5_CoupVN",        "N5_CoupRub",   "N5_NKDrepRub",
                             "N5_AmortVNrep",   "N5_AmortRubrep", "N5_SumAllrub",   "N5_NKDminusRub",   "N5_MinMrkt",   "N5_MrktS",
                             "N5_DMrktS",       "N5_DifS",        "N5_ComS",        "N5_CodeB",         "N5_DZB",       "N5_DDB",
                             "N5_PrBnom",       "N5_SumBvn",      "N5_SumBrub",     "N5_NkdBvn",        "N5_NkdBrub",   "N5_MaxMrkt",
                             "N5_MrktB",        "N5_DMrktB",      "N5_DifB",        "N5_SumBtax",       "N5_ComB",      "N5_RashAll",
                             "N5_DifSumBRub",           
                             "N5_SumBNRub",              
                             "N5_DifSum_BRub_AmortPrev", 
                             "N5_SumBRub_AmortPrev",     
                             "N5_AmortVN",               
                             "N5_AmortVN_before",        
                             "N5_AmortVN_after",         
                             "N5_AmortVNPer",            
                             "N5_KSumBvn",               
                             "N5_SumBvp_exps",           
                             "N5_VPrB",         "N5_VPrS",        "N5_CrSZ",        "N5_CrBZ",          "N5_CrSD",      "N5_CrBD",
                             "N5_ifCoupPrev",   "N5_NkdBprevRub", "N5_NkdBrepRub",  "N5_NkdBsellRub",   "N5_CoupCount", "N5_LastCoupDate",
                             "N5_CoupSaldoRub", "N5_SellType",    "N5_DqualS",      "N5_DqualB",        "N5_ContS",     "N5_ContB", 
                             "N5_FilS",         "N5_FilB",        "N5_SecType",     "N5_DepS",          "N5_DepP"   
                           );
 
     m_Report.SetCellAutoSummaPoint( ItogsLineName, 
                                "N5_Qnty",6, "N5_SumSvn",2, "N5_SumSrub",2, "N5_NkdSvn",2, "N5_NkdSrub",2, "N5_NkdPrevVN",2, "N5_NkdPrevRub",2, "N5_CoupVN",2,  
                                "N5_CoupRub",2, "N5_NKDrepRub",2, "N5_AmortVNrep",2, "N5_AmortRubrep",2, "N5_SumAllrub",2, "N5_NKDminusRub",2, "N5_DifS",2, "N5_ComS",2,
                                "N5_SumBvn",2, "N5_SumBrub",2, "N5_NkdBvn",2, "N5_NkdBrub",2, "N5_DifB",2, "N5_SumBtax",2, "N5_ComB",2, "N5_RashAll",2,
                                "N5_DifSumBRub",2,           
                                "N5_SumBNRub",2,              
                                "N5_DifSum_BRub_AmortPrev",2, 
                                "N5_SumBRub_AmortPrev",2,     
                                "N5_AmortVN",2,               
                                "N5_AmortVN_before",2,        
                                "N5_AmortVN_after",2,         
                                "N5_AmortVNPer",2,            
                                "N5_KSumBvn",2,               
                                "N5_SumBvp_exps",2,           
                                "N5_NkdBprevRub",2, "N5_NkdBrepRub",2, "N5_NkdBsellRub",2, "N5_CoupSaldoRub",2                                
                              );

     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.PrintTableLine( "N5_SecCode",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, false, false );
     m_Report.PrintTableLine( "N5_SecCode",  "В том числе:", null );
  END;
  
  MACRO EndReport()
     m_Report.EndTable();
     this.ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N5_" );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                        "F23",           
                        "I23",         
                        "J23",        
                        "K23",         
                        "L23",        
                        "N23",      
                        "O23",     
                        "P23",         
                        "Q23",        
                        "R23",      
                        "S23",        
                        "T23",       
                        "U23",      
                        "V23",    
                        "Z23",           
                        "AA23",           
                        "AF23",         
                        "AG23",        
                        "AH23",         
                        "AI23",        
                        "AM23",           
                        "AN23",        
                        "AO23",           
                        "AP23",        
                        "AQ23",    
                        "AR23",     
                        "AS23",    
                        "AT23",   
                        "AU23",   
                        "AV23",   
                        "AW23",   
                        "AX23",   
                        "AZ23",   
                        "BH23",   
                        "BI23",   
                        "BJ23",   
                        "BM23"   
                     );                                                                      
  END;

  
  MACRO Print()
          m_Report.PrintTableLine(
            /*1  */   "N5_SecCode",       m_Report.SecCode(),            null,
            /*2  */   "N5_SecName",       m_Report.SecName(),            null,
            /*3  */   "N5_CodeS",         m_Report.CodeS(),              null,
            /*4  */   "N5_DZS",           m_Report.DZS(),                null,
            /*5  */   "N5_DDS",           m_Report.DDS(),                null,
            /*6  */   "N5_Qnty",          m_Report.Qnty(),               m_Report.QntyPrecision(),
            /*7  */   "N5_VN",            m_Report.VN(),                 null,
            /*8  */   "N5_PrSNom",        m_Report.PrSNom(),             null,
            /*9  */   "N5_SumSvn",        m_Report.SumSvn(),             null,
            /*10 */   "N5_SumSrub",       m_Report.SumSrub(),            null,
            /*11 */   "N5_NkdSvn",        m_Report.NkdSvn(),             null,
            /*12 */   "N5_NkdSrub",       m_Report.NkdSrub(),            null,
            /*13 */   "N5_Tprev",         m_Report.Tprev(),              null,
            /*14 */   "N5_NkdPrevVN",     m_Report.NkdPrevVN(),          null,
            /*15 */   "N5_NkdPrevRub",    m_Report.NkdPrevRub(),         null,
            /*16 */   "N5_CoupVN",        m_Report.CoupVN(),             null,
            /*17 */   "N5_CoupRub",       m_Report.CoupRub(),            null,
            /*18 */   "N5_NKDrepRub",     m_Report.NKDrepRub(),          null,
            /*19 */   "N5_AmortVNrep",    m_Report.AmortVNrep(),         null,
            /*20 */   "N5_AmortRubrep",   m_Report.AmortRubrep(),        null,
            /*21 */   "N5_SumAllrub",     m_Report.SumAllrub(),          null,
            /*22 */   "N5_NKDminusRub",   m_Report.NKDminusRub(),        null,
            /*23 */   "N5_MinMrkt",       m_Report.MinMrkt(),            null,
            /*24 */   "N5_MrktS",         m_Report.MrktS(),              null,
            /*25 */   "N5_DMrktS",        m_Report.DMrktS(),             null,
            /*26 */   "N5_DifS",          m_Report.DifS(),               null,
            /*27 */   "N5_ComS",          m_Report.ComS(),               null,
            /*28 */   "N5_CodeB",         m_Report.CodeB(),              null,
            /*29 */   "N5_DZB",           m_Report.DZB(),                null,
            /*30 */   "N5_DDB",           m_Report.DDB(),                null,
            /*31 */   "N5_PrBnom",        m_Report.PrBnom(),             null,
            /*32 */   "N5_SumBvn",        m_Report.SumBvn(),             null,
            /*33 */   "N5_SumBrub",       m_Report.SumBrub(),            null,
            /*34 */   "N5_NkdBvn",        m_Report.NkdBvn(),             null,
            /*35 */   "N5_NkdBrub",       m_Report.NkdBrub(),            null,
            /*36 */   "N5_MaxMrkt",       m_Report.MaxMrkt(),            null,
            /*37 */   "N5_MrktB",         m_Report.MrktB(),              null,
            /*38 */   "N5_DMrktB",        m_Report.DMrktB(),             null,
            /*39 */   "N5_DifB",          m_Report.DifB(),               null,
            /*40 */   "N5_SumBtax",       m_Report.SumBtax(),            null,
            /*41 */   "N5_ComB",          m_Report.ComB(),               null,
            /*42 */   "N5_RashAll",       m_Report.RashAll(),            null,
                                                  
                      "N5_DifSumBRub",            m_Report.DifSumBRub(),            null,           
                      "N5_SumBNRub",              m_Report.SumBNRub(),              null,             
                      "N5_DifSum_BRub_AmortPrev", m_Report.DifSumBRub_AmortPrev(), null,
                      "N5_SumBRub_AmortPrev",     m_Report.SumBRub_AmortPrev(),     null,    
                      "N5_AmortVN",               m_Report.AmortVN(),               null,              
                      "N5_AmortVN_before",        m_Report.AmortVN_before(),        null,       
                      "N5_AmortVN_after",         m_Report.AmortVN_after(),         null,        
                      "N5_AmortVNPer",            m_Report.AmortVNPer(),            null,           
                      "N5_KSumBvn",               m_Report.KSumBvn(),               null,              
                      "N5_SumBvp_exps",           m_Report.SumBvp_exps(),           null,          

            /*Т1 */   "N5_VPrB",          m_Report.VPrBNumber(),         null,
            /*Т2 */   "N5_VPrS",          m_Report.VPrSNumber(),         null,
            /*Т3 */   "N5_CrSZ",          m_Report.printCrSZ(),          null,
            /*Т4 */   "N5_CrBZ",          m_Report.printCrBZ(),          null,
            /*Т5 */   "N5_CrSD",          m_Report.printCrSD(),          null,
            /*Т6 */   "N5_CrBD",          m_Report.printCrBD(),          null,
            /*Т7 */   "N5_ifCoupPrev",    m_Report.ifCoupPrev(),         null,
            /*Т8 */   "N5_NkdBprevRub",   m_Report.NkdBprevRub(),        null,
            /*Т9 */   "N5_NkdBrepRub",    m_Report.NkdBrepRub(),         null,
            /*Т10*/   "N5_NkdBsellRub",   m_Report.NkdBsellRub(),        null,
            /*Т11*/   "N5_CoupCount",     m_Report.CoupCount(),          null,
            /*Т12*/   "N5_LastCoupDate",  m_Report.LastCoupDate(),       null,
            /*Т13*/   "N5_CoupSaldoRub",  m_Report.CoupSaldoRub(),       null,
            /*Т14*/   "N5_SellType",      m_Report.SellType(),           null,
            /*Т15*/   "N5_DqualS",        m_Report.DqualS(),             null,
            /*Т16*/   "N5_DqualB",        m_Report.DqualB(),             null,
            /*Т17*/   "N5_ContS",         m_Report.ContS(),              null,
            /*Т18*/   "N5_ContB",         m_Report.ContB(),              null,
            /*Т19*/   "N5_FilS",          m_Report.FilS(),               null,
            /*Т20*/   "N5_FilB",          m_Report.FilB(),               null,
            /*Т21*/   "N5_SecType",       m_Report.SecType(),            null,
                      "N5_DepS",          m_Report.DepS(),               null,
                      "N5_DepP",          m_Report.DEpB(),               null
                                  );
  END;         
END;

PRIVATE CLASS CRealizReg_206( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*206 - отбираются сделки с дисконтными облигациями, номинированными в иностранной валюте*/
     return " NOT ( " + WhereCondNominalRUR() + ") AND " + WhereCondDiscount();
  END;

  MACRO BeginReport()
     m_Report.PrintHeader( "N6_", "06", SHEET_0206, "Реализация (погашение) дисконтных облигаций, номинал которых выражен в иностранной валюте" );
     m_Report.RegisterTable( "N6_MainTable", "",
                             "N6_SecCode",     "N6_SecName",      "N6_CodeS",       "N6_DZS",         "N6_DDS",       "N6_Nom",  
                             "N6_VN",          "N6_DAuс",         "N6_Dexp",        "N6_Qnty",        "N6_PrSnom",    "N6_SumSvn",   
                             "N6_SumSrub",     "N6_NkdBefVN",     "N6_NkdBefRub",   "N6_IncRub",      "N6_MinMrkt",   "N6_MrktS", 
                             "N6_DMrktS",      "N6_DifS",         "N6_ComS",        "N6_CodeB",       "N6_DZB",       "N6_DDB",   
                             "N6_PrBnom",      "N6_SumBvn",       "N6_SumBrub",     "N6_MaxMrkt",     "N6_MrktB",     "N6_DMrktB",    
                             "N6_DifB",        "N6_SumBtax",      "N6_ComB",        "N6_RashAll",     "N6_CrSD",      "N6_CrBD",  
                             "N6_DqualS",      "N6_DqualB",       "N6_ContS",       "N6_ContB",       "N6_FilS",      "N6_FilB",  
                             "N6_SecType",     "N6_DepS",         "N6_DepP"                                      
                           );
 
     m_Report.SetCellAutoSummaPoint( ItogsLineName, 
                                "N6_Qnty",6, "N6_SumSvn",2, "N6_SumSrub",2, "N6_NkdBefVN",2, "N6_NkdBefRub",2, "N6_IncRub",2, "N6_DifS",2, "N6_ComS",2, 
                                "N6_SumBvn",2, "N6_SumBrub",2, "N6_DifB",2, "N6_SumBtax",2, "N6_ComB",2, "N6_RashAll",2                                                                        
                              );

     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.PrintTableLine( "N6_SecCode",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, false, false );
     m_Report.PrintTableLine( "N6_SecCode",  "В том числе:", null );
  END;

  MACRO EndReport()
     m_Report.EndTable();
     this.ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N6_" );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                        "J23",       
                        "L23",     
                        "M23",    
                        "N23",   
                        "O23",  
                        "P23",     
                        "T23",       
                        "U23",       
                        "Z23",     
                        "AA23",    
                        "AE23",       
                        "AF23",    
                        "AG23",       
                        "AH23"    
                     );                                                                      
  END;

  MACRO Print()
          m_Report.PrintTableLine(
          /*1  */    "N6_SecCode",    m_Report.SecCode(),     null,                    
          /*2  */    "N6_SecName",    m_Report.SecName(),     null,                    
          /*3  */    "N6_CodeS",      m_Report.CodeS(),       null,                    
          /*4  */    "N6_DZS",        m_Report.DZS(),         null,                    
          /*5  */    "N6_DDS",        m_Report.DDS(),         null,                    
          /*6  */    "N6_Nom",        m_Report.Nom(),         null,                    
          /*7  */    "N6_VN",         m_Report.VN(),          null,                    
          /*8  */    "N6_DAuс",       m_Report.DAuc(),        null,                    
          /*9  */    "N6_Dexp",       m_Report.Dexp(),        null,                    
          /*10 */    "N6_Qnty",       m_Report.Qnty(),        m_Report.QntyPrecision(),
          /*11 */    "N6_PrSnom",     m_Report.PrSnom(),      null,                    
          /*12 */    "N6_SumSvn",     m_Report.SumSvn(),      null,                    
          /*13 */    "N6_SumSrub",    m_Report.SumSrub(),     null,                    
          /*14 */    "N6_NkdBefVN",   m_Report.NkdBefVN(),    null,                    
          /*15 */    "N6_NkdBefRub",  m_Report.NkdBefRub(),   null,                    
          /*16 */    "N6_IncRub",     m_Report.IncRub(),      null,                    
          /*17 */    "N6_MinMrkt",    m_Report.MinMrkt(),     null,                    
          /*18 */    "N6_MrktS",      m_Report.MrktS(),       null,                    
          /*19 */    "N6_DMrktS",     m_Report.DMrktS(),      null,                    
          /*20 */    "N6_DifS",       m_Report.DifS(),        null,                    
          /*21 */    "N6_ComS",       m_Report.ComS(),        null,                    
          /*22 */    "N6_CodeB",      m_Report.CodeB(),       null,                    
          /*23 */    "N6_DZB",        m_Report.DZB(),         null,                    
          /*24 */    "N6_DDB",        m_Report.DDB(),         null,                    
          /*25 */    "N6_PrBnom",     m_Report.PrBnom(),      null,                    
          /*26 */    "N6_SumBvn",     m_Report.SumBvn(),      null,                    
          /*27 */    "N6_SumBrub",    m_Report.SumBrub(),     null,                    
          /*28 */    "N6_MaxMrkt",    m_Report.MaxMrkt(),     null,                    
          /*29 */    "N6_MrktB",      m_Report.MrktB(),       null,                    
          /*30 */    "N6_DMrktB",     m_Report.DMrktB(),      null,                    
          /*31 */    "N6_DifB",       m_Report.DifB(),        null,                    
          /*32 */    "N6_SumBtax",    m_Report.SumBtax(),     null,                    
          /*33 */    "N6_ComB",       m_Report.ComB(),        null,                    
          /*34 */    "N6_RashAll",    m_Report.RashAll(),     null,                    
          /*Т1 */    "N6_CrSD",       m_Report.printCrSD(),   null,                    
          /*Т2 */    "N6_CrBD",       m_Report.printCrBD(),   null,                    
          /*Т3 */    "N6_DqualS",     m_Report.DqualS(),      null,                    
          /*Т4 */    "N6_DqualB",     m_Report.DqualB(),      null,                    
          /*Т5 */    "N6_ContS",      m_Report.ContS(),       null,                    
          /*Т6 */    "N6_ContB",      m_Report.ContB(),       null,                    
          /*Т7 */    "N6_FilS",       m_Report.FilS(),        null,                    
          /*Т8 */    "N6_FilB",       m_Report.FilB(),        null,                    
          /*Т9*/     "N6_SecType",    m_Report.SecType(),     null,                                               
                     "N6_DepS",       m_Report.DepS(),        null,
                     "N6_DepP",       m_Report.DEpB(),        null
                                  );
  END;         
END;

PRIVATE CLASS (TX_RegistrReport) SP_RealizReg_Report( Form:DL_CPanel, TemplateName:STRING, UseCSV:BOOL, IsWebService:BOOL, ReportHashCode:INTEGER )
  PRIVATE VAR m_RunByQuoted = false, m_RunByNoQuoted = false, m_RunByTech = false;
  PRIVATE VAR m_NkdRepRub, m_NkdBrepRub, m_NkdBsellRub, m_CoupSaldoRub;
  PRIVATE VAR m_IsPrintByQuoted = false;
  PRIVATE VAR m_IsPrintByNoQuoted = false;
  PRIVATE VAR m_IsPrintByTech = false;

  PRIVATE VAR m_AmortVNrep, m_AmortRubrep, m_AmortVN_before, m_AmortVN_after, m_AmortVNPer, m_KSumBvn, m_ContIDB, m_ContIDS;

  PRIVATE VAR m_IsDataExist = false; /*для Web, если нет данных, то ничего не показываем*/

  PRIVATE VAR m_ContRecB = TRecHandler( "party.dbt" ), m_ContRecS = TRecHandler( "party.dbt" );

  MACRO IsDataExist()
     return m_IsDataExist();
  END;

  MACRO ClearCacheOneRecord()
    this.ClearCacheOneRecord();
    m_NkdRepRub = null;
    m_NkdBrepRub = null;
    m_NkdBsellRub = null;
    m_CoupSaldoRub = null;
    m_AmortVNrep   = null;
    m_AmortRubrep  = null;
    m_AmortVN_before = null;
    m_AmortVN_after  = null;
    m_AmortVNPer     = null;
    m_KSumBvn        = null;
    m_ContIDB        = null;
    m_ContIDS        = null;
  END;
  
  MACRO PrintMode():INTEGER
     return DL_OUTREPORT_EXCEL;
  END;

  PRIVATE MACRO BeginReport( NumCopy:INTEGER )
     var ByQuoted = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_BYQUOTED );
     var ByNoQuoted = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_BYNOQUOTED );
     var ByTech = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_BYTECH );

     if((ByQuoted == SET_CHAR) and (m_IsPrintByQuoted == false))
       m_IsPrintByQuoted = true;
       
       m_RunByQuoted = true;
       m_RunByNoQuoted = false;
       m_RunByTech   = false;
     elif((ByNoQuoted == SET_CHAR) and (m_IsPrintByNoQuoted == false))
       m_IsPrintByNoQuoted = true;

       m_RunByQuoted = false;
       m_RunByNoQuoted = true;
       m_RunByTech   = false;
     elif((ByTech == SET_CHAR) and (m_IsPrintByTech == false))
       m_IsPrintByTech = true;

       m_RunByQuoted = false;
       m_RunByNoQuoted = false;
       m_RunByTech   = true;
     end;

     m_H07 = RealizReg_Form.GetFieldValue(PNFLD_REALIZREG_BEGINDATE);
     m_H08 = RealizReg_Form.GetFieldValue(PNFLD_REALIZREG_ENDDATE);

  END;

  PRIVATE MACRO SetAutoFilter()
     if( ExistsSheet( SHEET_0201 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AR28", SHEET_0201);
     end;

     if( ExistsSheet( SHEET_0202 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:BM28", SHEET_0202);
     end;

     if( ExistsSheet( SHEET_0203 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AP28", SHEET_0203);
     end;

     if( ExistsSheet( SHEET_0204 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:Y28", SHEET_0204);
     end;

     if( ExistsSheet( SHEET_0205 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:BW28", SHEET_0205);
     end;

     if( ExistsSheet( SHEET_0206 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AS28", SHEET_0206);
     end;
  END;

  PRIVATE MACRO EndReport()
    EndReport();
    SetAutoFilter();
  END;

  MACRO PrintHeader( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )

     VAR Month, Year, INN, KPP, Quoted,
         GroupName = "",
         AvrKind = "";

     RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_AVRGROUP, @GroupName );
     RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_AVRKIND, @AvrKind );

     HTML_StSheetName = ReportCode;

     DateSplit( m_H08, null, Month, Year );

     Year = SubStr( string(Year), strlen(string(Year))-1 );
     SplitFullINN( ПолучитьКодСубъекта({OurBank}, PTCK_INN), INN, KPP );
     if( m_RunByQuoted == true )
        Quoted = "Обращающиеся на Бирже";
     elif( m_RunByTech == true )
        Quoted = "Технические сделки реализации";
     elif( m_RunByNoQuoted == true )
        Quoted = "Не обращающиеся на Бирже";
     end;

     SetActiveSheet( ReportCode );
     PrintFormatString( "",
                        FldPref+"H0_A:l" , ПолучитьКороткоеИмяСубъекта({OurBank}) + "    " +INN + "/" + KPP,  // Инн/КПП
                        FldPref+"H0_1"   , H01,  // Приложение №
                        FldPref+"H0_3"   , H03,
                        FldPref+"H0_12"  , H012, // Аналитический регистр налогового учета №
                        FldPref+"H0_2"   , H02,
                        FldPref+"H0_3"   , H03,
                        FldPref+"H0_1"   , H01,
                        FldPref+"H0_4"   , string(Month),
                        FldPref+"H0_5"   , string(Year),
                        FldPref+"H0_12:r"  , H012, // Номер приложения синтетического регистра
                        FldPref+"H0_2"   , H02,  // Код строки в синтетическом регистре
                        FldPref+"H0_3"   , H03,  // Номер аналитического регистра
                        FldPref+"H0_1"   , H01,
                        FldPref+"H0_4"   , string(Month:2:o),  // Номер месяца (последний в отчетном периоде)
                        FldPref+"H0_5"   , string(Year:2:o),   // Две последние цифры года
                        FldPref+"H0_6"   , ReportName,  // Имя отчета 
                        FldPref+"H0_7"   , m_H07,              // за период с
                        FldPref+"H0_8"   , m_H08,              // по
                        FldPref+"H0_9"   , GroupName,          // Группа налогового учета
                        FldPref+"H0_10"  , AvrKind,            // Вид ц/б
                        FldPref+"H0_11"  , RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_AVRNAME ), // Выпуск ц/б
                        FldPref+"H0_13"  , Quoted
                      );
  END;

  MACRO GetRS()
    return m_RS;
  END;

  MACRO CReport_DataExist()
    return ((m_RunByQuoted == true) or (m_RunByNoQuoted == true) or (m_RunByTech == true));
  END;

  PRIVATE MACRO ExecuteReport( ObjReport:OBJECT )
     VAR DataQuery;
     VAR strSelect;
     VAR strSelect0;
     VAR AddWhere = "";
     VAR AvrFIIDList = null;
     VAR AvrFIIDCount : Integer = 0;
     VAR AvrFIIDAddWhere : String = "";
     VAR WasSetSecurity : Bool = false;
     VAR AvrKindList = null;
     VAR AvrKindAddWhere : String = "";
     VAR AvrKindCount : Integer = 0;
     VAR GNUList = null;
     VAR GNUAddWhere : String = "";
     VAR GNUCount : Integer = 0;
     VAR SaleIsFuturesWhere = "";
     VAR SaleIsTechDealWhere = "";
     VAR AvrGroup;
     VAR ProgressValue = CTxProgressValue();

     ExecuteReport();
     
     ObjReport.BeginReport();
     
     if((m_RunByQuoted == true) or (m_RunByNoQuoted == true) or (m_RunByTech == true))
       /*ценные бумаги в соединенных сделках  должны удовлетворять условиям, заданным панели подготовки отчета*/
       if( not m_IsWebService )
          AvrFIIDList = TArray();
          AvrFIIDList[AvrFIIDList.Size] = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_AVRCODE );
       else
          AvrFIIDList = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_AVRCODE );
       end;
       if( ( ValType( AvrFIIDList ) != V_UNDEF ) and ( AvrFIIDList.Size > 0 ) )
          while( AvrFIIDCount < AvrFIIDList.Size )
             if( ( ValType( AvrFIIDList[AvrFIIDCount] ) == V_INTEGER )
             and ( AvrFIIDList[AvrFIIDCount] > 0 ) )
                if( AvrFIIDAddWhere == "" )
                   AvrFIIDAddWhere = AvrFIIDAddWhere + " AND ( ";
                else
                   AvrFIIDAddWhere = AvrFIIDAddWhere + " OR ";
                end;
                AvrFIIDAddWhere = AvrFIIDAddWhere + " TXLotBuy.t_FIID = " + String( AvrFIIDList[AvrFIIDCount] ) + " ";
             end;
             AvrFIIDCount = AvrFIIDCount + 1;
          end;
          if( AvrFIIDAddWhere != "" )
             AvrFIIDAddWhere = AvrFIIDAddWhere + " ) ";
             WasSetSecurity = true;
          end;
          AddWhere = AddWhere + AvrFIIDAddWhere;
       end;

       /*если не задана бумага*/
       if( not WasSetSecurity )
          if( not m_IsWebService )
             AvrKindList = TArray();
             AvrKindList[AvrKindList.Size] = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_AVRKIND );
          else
             AvrKindList = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_AVRKIND );
          end;
          /*задан вид бумаги*/
          if( ( ValType( AvrKindList ) != V_UNDEF ) and ( AvrKindList.Size > 0 ) )
             while( AvrKindCount < AvrKindList.Size )
                if( ( ValType( AvrKindList[AvrKindCount] ) == V_INTEGER )
                and ( AvrKindList[AvrKindCount] > 0 ) )
                   if( AvrKindAddWhere == "" )
                      AvrKindAddWhere = AvrKindAddWhere + " AND ( ";
                   else
                      AvrKindAddWhere = AvrKindAddWhere + " OR ";
                   end;
                   AvrKindAddWhere = AvrKindAddWhere + " RSB_FIInstr.FI_AvrKindsEQ(2, " + String( AvrKindList[AvrKindCount] ) + ", FinInstr.t_AvoirKind) = 1 ";
                end;
                AvrKindCount = AvrKindCount + 1;
             end;
             if( AvrKindAddWhere != "" )
                AvrKindAddWhere = AvrKindAddWhere + " ) ";
             end;
             AddWhere = AddWhere + AvrKindAddWhere;
          end;

          if( not m_IsWebService )
             GNUList = TArray();
             GNUList[GNUList.Size] = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_AVRGROUP );
          else
             GNUList = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_AVRGROUP );
          end;
          /*задана категория бумаги*/
          if( ( ValType( GNUList ) != V_UNDEF ) and ( GNUList.Size > 0 ) )
             while( GNUCount < GNUList.Size )
                if( ( ValType( GNUList[GNUCount] ) == V_INTEGER )
                and ( GNUList[GNUCount] > 0 ) )
                   if( GNUAddWhere == "" )
                      GNUAddWhere = GNUAddWhere + " AND ( ";
                   else
                      GNUAddWhere = GNUAddWhere + " OR ";
                   end;
                   GNUAddWhere = GNUAddWhere + " av.t_TaxGroup = " + String( GNUList[GNUCount] ) + " ";
                end;
                GNUCount = GNUCount + 1;
             end;
             if( GNUAddWhere != "" )
                GNUAddWhere = GNUAddWhere + " ) ";
             end;
             AddWhere = AddWhere + GNUAddWhere;
          end;
       end;

       if( (RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_EXCLUDE ) == "X") AND (ИсключаемыеИзОтчетаЦБ != "") )
          AddWhere = AddWhere + " AND fininstr.t_FI_Code not in (" + ИсключаемыеИзОтчетаЦБ + ")";
       end;

       //У сделки категория "Является технической сделкой" имеет значение 2 - Техническая сделка (ГО)
       SaleIsTechDealWhere = " ( SELECT COUNT(1) FROM dobjatcor_dbt objatcor " +
                             "    WHERE objatcor.t_ObjectType = "+ OBJTYPE_SECDEAL + " AND " + 
                             "          objatcor.t_GroupID    = 24 AND " + /*"Является технической сделкой"*/
                             "          objatcor.t_Object     = LPAD( TXLotSale.t_DealID, 34, '0' ) AND "+
                             "          objatcor.t_AttrID     = 2" + /*Техническая сделка (ГО)*/
                             " ) <> 0"; 



       if( m_RunByQuoted == true )
          AddWhere = AddWhere + " AND Rsb_SCTX.ifMarket( TXLotSale.t_ID, TXLotBuy.t_ID ) = 'X' AND NOT (" + SaleIsTechDealWhere + ")";
       end;       
       if ( m_RunByTech == true )
          AddWhere = AddWhere + " AND (" + SaleIsTechDealWhere + ")";
       end; 
       if ( m_RunByNoQuoted == true )
          AddWhere = AddWhere + " AND NVL(Rsb_SCTX.ifMarket( TXLotSale.t_ID, TXLotBuy.t_ID ), chr(0)) != 'X' AND NOT (" + SaleIsTechDealWhere + ")";
       end;

                                
       strSelect0 = " SELECT TXLink.t_Date ";

       strSelect = " SELECT TXLink.t_Date, TXLink.t_Amount," +

                      IIF ( ((m_ReportKind == REALIZREG_0202) or (m_ReportKind == REALIZREG_0205)),
                             " (NVL( (SELECT Count(fiw.t_DrawingDate) " +
                                    "   FROM dfiwarnts_dbt fiw " +
                                    "  WHERE fiw.t_FIID         =  TXLotSale.t_FIID AND " +
                                    "        fiw.t_IsPartial   != 'X' AND " +
                                    "        fiw.t_DrawingDate >=  (TXLotBuy.t_BuyDATE + 1)  AND " +
                                    "        fiw.t_DrawingDate <=  " + GetSQLDate(m_H07 - 1) +
                             "       ), 0 " +
                             "     ) " +
                             ") IfCoupPrev, " +
                             " (select nvl(max(ret.t_DealDate), to_date('01.01.0001', 'dd.mm.yyyy')) " +
                               "  from ddl_tick_dbt ret " +
                               " where ret.t_PFI = av.t_FIID " +
                               "   and ret.t_Bofficekind = " + DL_RETIREMENT +
                               "   and ret.t_DealStatus > 0 " +
                               "   and RSB_SECUR.IsRet_Issue(RSB_SECUR.get_OperationGroup(RSB_SECUR.get_OperSysTypes(ret.t_DealType, ret.t_BofficeKind)))=1 " +
                             " ) as t_IssDrawingDate, ", /*516235*/
                             ""
                          ) + 

                   " Rsb_SCTX.TXGetComissionsSum(DealSale.t_DealID, DealSale.t_BOfficeKind, case when DealSale.t_BofficeKind = "+DL_RETIREMENT+" then DealSale.t_DealDate else TXLotSale.t_SALEDATE end, 0) as CommSale, " +
                   " Rsb_SCTX.TXGetComissionsSum(DealBuy.t_DealID,  DealBuy.t_BOfficeKind,  TXLotBuy.t_BuyDATE,   0) as CommBuy, " +

                   IIF ( ((m_ReportKind != REALIZREG_0201) and (m_ReportKind != REALIZREG_0204)),
                          "       Rsb_SCTX.TXGetBondKind(av.t_TaxGroup) TaxGroupType, ", ""
                       ) + 

                   "        FinInstr.t_FIID, FinInstr.t_FI_Code AS AvrCode, FinInstr.t_Name AS AvrName, FinInstr.t_FaceValueFI AS FaceValueFI, RSI_RSB_FIInstr.FI_GetNominalDrawingDate(FinInstr.t_FIID, av.t_Termless) AS t_DrawingDate, FinInstr.t_SumPrecision, FinInstr.t_Issued, av.t_TaxGroup, FinInstr.t_AvoirKind, "+
                   "        TXLotSale.t_DealID AS DealSaleID, TXLotSale.t_DEALDATE AS DealSaleDate, FinInstr.t_ExpiryDate, "+
                   "        case when DealSale.t_BofficeKind = "+DL_RETIREMENT+" then DealSale.t_DealDate else TXLotSale.t_SALEDATE end AS SaleDate, "+
                   "        TXLotSale.t_DEALCODETS AS DealSaleCodeTS,TXLotSale.t_PriceFIID AS SalePriceFIID,LegS.t_Price AS SalePrice, LegS.t_Principal AS SaleAmount,"+
                   "        TXLotBuy.t_DealID  AS DealBuyID,  TXLotBuy.t_DEALDATE AS  DealBuyDate,  TXLotBuy.t_BuyDATE   AS BuyDate,  TXLotBuy.t_DEALCODETS  AS DealBuyCodeTS, TXLotBuy.t_PriceFIID AS BuyPriceFIID,LegB.t_Price AS BuyPrice, LegB.t_Principal AS BuyAmount,"+
                   "        DataSale.DealSaleGroup AS DealSaleGroup, DealSale.t_Department AS DealSaleDepartment," +
                   "        DataBuy.DealBuyGroup AS DealBuyGroup, DealBuy.t_Department AS DealBuyDepartment," +
                   "        Rsb_SCTX.GetMarketPrice( TXLotSale.t_ID, TXLotBuy.t_ID ) AS SaleMarketPrice,"+
                   "        Rsb_SCTX.GetMarket( TXLotSale.t_ID, TXLotBuy.t_ID ) AS SaleMarket,"+
                   "        Rsb_SCTX.GetDateMarket( TXLotSale.t_ID, TXLotBuy.t_ID ) AS SaleDateMarket,"+
                   "        Rsb_SCTX.GetMarketPrice( TXLotBuy.t_ID, 0 ) AS BuyMarketPrice,"+
                   "        Rsb_SCTX.GetMarket( TXLotBuy.t_ID, 0 ) AS BuyMarket,"+
                   "        Rsb_SCTX.GetDateMarket( TXLotBuy.t_ID, 0 ) AS BuyDateMarket, " +
                   "        LegS.t_NKD as NKDSale, LegS.t_Price as DealSalePrice, LegS.t_Cost as SDealCost, LegS.t_CFI as VprS, LegS.t_RelativePrice as SaleRelativePrice, "+
                   "        LegB.t_NKD as NKDBuy, LegB.t_Price as DealBuyPrice, LegB.t_Cost as BDealCost, LegB.t_CFI as VprB, LegB.t_RelativePrice as BuyRelativePrice ";/*516235*/

       DataQuery = "   FROM DSCTXLNK_DBT  TXLink,"+
                   "        DSCTXLOT_DBT  TXLotSale," +
                   "        DSCTXLOT_DBT  TXLotBuy," +
                   "        DDL_TICK_DBT  DealSale," +
                   "        DDL_TICK_DBT  DealBuy," +
                   "        DFININSTR_DBT FinInstr, " + 
                   "        DAVOIRISS_DBT av, " +
                   "        ddl_leg_dbt   LegS, " + 
                   "        ddl_leg_dbt   LegB, " +

                   "        ( Select SaleOper.t_Kind_Operation, SaleOper.t_DocKind, " +
                   "                 rsb_secur.get_OperationGroup(SaleOper.t_SysTypes) as DealSaleGroup, " +
                   "                 (CASE WHEN " +
                   "                            ((Rsb_Secur.IsBuy(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                   "                          or (Rsb_Secur.IsAvrWrtIn(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                   "                            ) " +
                   "                       THEN 2 " +
                   "                       ELSE 0 END " +
                   "                 ) as LegKindSale " +
                   "            From " +
                   "                 doprkoper_dbt SaleOper " + 
                   "        ) DataSale, " +

                   "        ( Select BuyOper.t_Kind_Operation, BuyOper.t_DocKind, " +
                   "                 rsb_secur.get_OperationGroup(BuyOper.t_SysTypes) as DealBuyGroup, " +
                   "                 (CASE WHEN " +
                   "                            ((Rsb_Secur.IsSale(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " +
                   "                          or (Rsb_Secur.IsAvrWrtOut(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " +
                   "                            ) " +
                   "                       THEN 2 " +
                   "                       ELSE 0 END " +
                   "                 ) as LegKindBuy " +
                   "            From " +
                   "                 doprkoper_dbt BuyOper " + 
                   "        ) DataBuy " +

                   "  WHERE TXLink.t_Type = " + TXLNK_DELIVER + " AND " +
                   "        ( ( TXLink.t_Date BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate(m_H08) + " AND " +
                   "            ( TXLink.T_BEGDATE IS NULL  OR " +
                   "              TXLink.T_BEGDATE = " + GetSQLDate( DATE(0,0,0) ) + 
                   "            ) " +
                   "          ) OR " +
                   "          ( TXLink.T_BEGDATE BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate( m_H08 ) + 
                   "          ) " +
                   "        ) " +

                   "        AND rsb_sctx.DealIsTerm(TXLotSale.t_DealID, TXLotSale.t_FIID, case when DealSale.t_BofficeKind = "+DL_RETIREMENT+" then DealSale.t_DealDate else TXLotSale.t_SALEDATE end ) = 0 " +
                   "        AND FinInstr.t_FIID = TXLotBuy.t_FIID " +

                            AddWhere + " AND " + ObjReport.Where() +
                   "        AND " +
                   "        TXLink.t_SaleID = TXLotSale.t_ID AND " +
                   "        TXLink.t_BuyID  = TXLotBuy.t_ID AND " +
                   "        DealSale.t_DealID  = DECODE( TXLotSale.t_VirtualType, 1, TXLotSale.t_DealID, " + 
                   "                                      (select t_DealID from dsctxlot_dbt where t_ID = TXLotSale.t_RealID) ) AND " +                    
                   "        TXLotBuy.t_DealID  = DealBuy.t_DealID AND " +
                   "        av.t_FIID = TXLotBuy.t_FIID AND " +
                   "        DataSale.t_Kind_Operation = DealSale.t_DealType AND " +
                   "        DataSale.t_DocKind        = DealSale.t_BOfficeKind AND " +
                   "        DataBuy.t_Kind_Operation  = DealBuy.t_DealType AND " +
                   "        DataBuy.t_DocKind         = DealBuy.t_BOfficeKind AND " +
                   "        LegS.t_DealID             = TXLotSale.t_DealID AND " +
                   "        LegS.t_LegKind            = DataSale.LegKindSale AND " +
                   "        LegS.t_LegID              = 0 AND " +
                   "        LegB.t_DealID             = TXLotBuy.t_DealID AND " +
                   "        LegB.t_LegKind            = DataBuy.LegKindBuy AND " +
                   "        LegB.t_LegID              = 0 ";
       
       ProgressValue.Maximum = SQL_GetNRecs( strSelect0 + DataQuery );
       ProgressValue.Current = 0;

       if (ProgressValue.Maximum > 0)
          var ProgressIndicator = CreateProgressIndicator(m_IsWebService);

          if( m_IsWebService and (WebMenuItem != null) )
            var header = "Формирование отчета " + WebMenuItem.szNameItem;
            ProgressIndicator.Start(ProgressValue.Maximum, header, header);
          else
            ProgressIndicator.Start(ProgressValue.Maximum, HTML_StSheetName, HTML_StSheetName);
          end;

          m_RS = TRsbDataSet( strSelect + DataQuery );
          while( m_RS.MoveNext() )

             ClearCacheOneRecord();
             m_IsDataExist = true;
             ObjReport.Print();

             ProgressValue.Current = ProgressValue.Current + 1;
             ProgressIndicator.Update(ProgressValue.Current,ProgressValue.Maximum); // всего 3 парамера Update(index, count, text)
             end;
          ProgressIndicator.Stop();
       end;
     end;
     ObjReport.EndReport();
     
  END;

  PRIVATE MACRO CreateReportByKind( Kind:INTEGER )
     m_ReportKind = Kind;

     if( Kind == REALIZREG_0201 )
        ExecuteReport( CRealizReg_201(this) );
     elif( Kind == REALIZREG_0202 )
        ExecuteReport( CRealizReg_202(this) );
     elif( Kind == REALIZREG_0203 )
        ExecuteReport( CRealizReg_203(this) );
     elif( Kind == REALIZREG_0204 )
        ExecuteReport( CRealizReg_204(this) );
     elif( Kind == REALIZREG_0205 )
        ExecuteReport( CRealizReg_205(this) );
     elif( Kind == REALIZREG_0206 )
        ExecuteReport( CRealizReg_206(this) );
     end;
  END;

  PRIVATE MACRO Create()
     var SubKindList = null;
     var SubKindCount : Integer = 0;

     if( not m_IsWebService )
        SubKindList = TArray();
        SubKindList[SubKindList.Size] = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_SUBKIND );
     else
        SubKindList = RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_SUBKIND );
     end;

     if( ( ValType( SubKindList ) != V_UNDEF )
     and ( SubKindList.Size > 0 )
     and ( ValType( SubKindList[SubKindCount] ) == V_INTEGER )
     and ( SubKindList[SubKindCount] != REALIZREG_ALL ) )
        while( SubKindCount < SubKindList.Size )
           CreateReportByKind( SubKindList[SubKindCount] );
           SubKindCount = SubKindCount + 1;
        end;
     else
        CreateReportByKind( REALIZREG_0201 );
        CreateReportByKind( REALIZREG_0202 );
        CreateReportByKind( REALIZREG_0203 );
        CreateReportByKind( REALIZREG_0204 );
        CreateReportByKind( REALIZREG_0205 );
        CreateReportByKind( REALIZREG_0206 );
     end;
  END;

  MACRO H0_7()
    return RealizReg_Form.GetFieldValue(PNFLD_REALIZREG_BEGINDATE);
  END;

  MACRO H0_8()
    return RealizReg_Form.GetFieldValue(PNFLD_REALIZREG_ENDDATE);
  END;

  MACRO Дк():DATE // дата начала купона, который начинается до <H0.7> включительно, а заканчивается после <H0.7>,
     var Дк;
     //нужно очищать, так как используется другая дата
     m_CacheFinInstr.Clear();
     Дк = m_CacheFinInstr.GetCouponParms( m_RS.FIID, this.H0_7(), date(1,1,9999) ).m_Дк;
     m_CacheFinInstr.Clear();
     return Дк;
  END;


  MACRO SumSmain():MONEY
    var SumSmain = this.SumSmain();
    if( IsRET_ISSUE(int(m_RS.DealSaleGroup)) )  /* погашение*/
      if(this.FI_IsAvrKindBond_AD(m_RS.t_FIID))  //бумага с ЧП
         SumSmain = this.Qnty()*GetFaceValue( m_RS.t_FIID, this.GetDrawingDate()-1, true, false );/*дата погашения определяется по операции погашения*/
      end;
    end;
    return SumSmain;
  END;

  MACRO SumBmain():MONEY
    var SumBmain = this.SumBmain();
    if( IsRET_ISSUE(int(m_RS.DealBuyGroup)) )  /* погашение*/
      if(this.FI_IsAvrKindBond_AD(m_RS.t_FIID))  //бумага с ЧП
         SumBmain = this.Qnty()*GetFaceValue( m_RS.t_FIID, this.GetDrawingDate()-1, true, false );/*дата погашения определяется по операции погашения*/
      end;
    end;
    return SumBmain;
  END;


  MACRO PrSvp():DOUBLE // Цена реализации - в валюте
     var PrSvp = this.PrSvp();
     if((m_ReportKind == REALIZREG_0201) and (m_RS.VprS == NATCUR))
       PrSvp = 0.0;
     end;
     return PrSvp;
  END;

  MACRO NkdRepRub():MONEY // Процентный доход, начисленный за отчетный (налоговый) период, руб.
     if( m_NkdRepRub == NULL )
        m_NkdRepRub = $0;

        if( m_ReportKind == REALIZREG_0202 )
           if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
              m_NkdRepRub = this.NkdSVN() + this.CoupVN() - this.NkdPrevVN() - this.NkdBrepRub();
           else
              if( this.CoupVN() > 0 )
                 m_NkdRepRub = this.CoupVN()-this.NkdPrevVN()-this.NkdBrepRub();
              end;
           end;
        elif( m_ReportKind == REALIZREG_0205 )
           if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
              m_NkdRepRub = this.NkdSrub()+this.CoupRub()-this.NkdPrevRub()-this.NkdBrepRub();
           else
              if( this.CoupVN() > 0 )
                 m_NkdRepRub = this.CoupRub()-this.NkdPrevRub()-this.NkdBrepRub();
              end;
           end;
        elif( m_ReportKind == REALIZREG_0203 )
           if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
             m_NkdRepRub = this.NKDownVN()-this.NkdBefVN();
           end;
        end;
     end;
     return m_NkdRepRub;
  END;

  MACRO SumAllrub():MONEY // Выручка от реализации (погашения) для целей налогообложения, руб. - Всего
      VAR Summa = $0;

      if( m_ReportKind == REALIZREG_0202 )
         if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
            Summa = SumSRub()+ this.AmortRubrep();
         else
            Summa = SumSRub()+NkdSvn()+ this.AmortVNrep();
         end;
      elif( m_ReportKind == REALIZREG_0205 )
         if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
            Summa = SumSRub()+ this.AmortRubrep();
         else
            Summa = SumSRub()+NkdSrub()+ this.AmortRubrep();
         end;
      end;

      return Summa;
  END;

  MACRO NKDminusRub():MONEY // Выручка от реализации (погашения) для целей налогообложения, руб. - в том числе: суммы % дохода, учтенные при налогообложении до начала текущего отчетного (налогового) периода
     VAR Summa = $0;

     if( ЛьготнаяОблигация( m_RS.TaxGroupType ) == false )
        if( this.CoupVN() ==0 )
           if( m_ReportKind == REALIZREG_0202 )
              Summa = NkdPrevVN();
           elif( m_ReportKind == REALIZREG_0205 )
              Summa = NkdPrevRub();
           end;
        end;
     end;
     return Summa;
  END;

  MACRO PrBvp():DOUBLE // Цена приобретения - в валюте
     var PrBvp = this.PrBvp();
     if((m_ReportKind == REALIZREG_0201) and (m_RS.VprB == NATCUR))
       PrBvp = 0.0;
     end;
     return PrBvp;
  END;

  MACRO RashAll():MONEY // Расходы при реализации
     VAR Summa = $0;

     if( (m_ReportKind == REALIZREG_0201) OR (m_ReportKind == REALIZREG_0203) OR
         (m_ReportKind == REALIZREG_0204) OR (m_ReportKind == REALIZREG_0206)
       )
        Summa = Round(this.ComS(),2)+Round(this.SumBtax(),2)+ Round(this.ComB(),2);            
     else
        Summa = Round(this.ComS(),2)+Round(this.SumBtax(),2)+ Round(this.ComB(),2)+Round(this.NkdBsellRub(),2);
     end;
     return Summa;
  END;

  MACRO NkdBprevRub():MONEY // НКД, уплаченный при приобретении, уменьшающий процентные доходы, руб - процентные доходы прошлых налоговых периодов
     if( this.ifCoupPrev() == 1 )
        if( m_ReportKind == REALIZREG_0202 ) 
           return this.NkdBVN();
        elif( m_ReportKind == REALIZREG_0205 ) 
           return this.NkdBrub();
        end;
     end;
     return 0;
  END;

  MACRO NkdBrepRub():MONEY //  НКД, уплаченный при приобретении, уменьшающий процентные доходы, руб - процентные доходы текущего налогового периода
     if( m_NkdBrepRub == NULL )
        m_NkdBrepRub = 0;
        if( ЛьготнаяОблигация( m_RS.TaxGroupType ) == false )
           if( (this.ifCoupPrev() == 0) AND (this.CoupVN() > 0) )
              if( m_ReportKind == REALIZREG_0202 ) 
                 m_NkdBrepRub = this.NkdBVN();
              elif( m_ReportKind == REALIZREG_0205 ) 
                 m_NkdBrepRub = this.NkdBrub();
              end;
           end;
        else
           if( this.ifCoupPrev() == 0 )
              if( m_ReportKind == REALIZREG_0202 ) 
                 m_NkdBrepRub = this.NkdBVN();
              elif( m_ReportKind == REALIZREG_0205 ) 
                 m_NkdBrepRub = this.NkdBrub();
              end;
           end;
        end;
     end;
     return m_NkdBrepRub;
  END;

  MACRO NkdBsellRub():MONEY // НКД, уплаченный при приобретении, уменьшающий процентные доходы, руб - доходы от реализации (погашения)
     if( m_NkdBsellRub == NULL )
        m_NkdBsellRub = 0;
        if( ЛьготнаяОблигация( m_RS.TaxGroupType ) == false )
           if( (this.ifCoupPrev() == 0) AND (this.CoupVN() == 0) )
              if( m_ReportKind == REALIZREG_0202 ) 
                 m_NkdBsellRub = this.NkdBVN();
              elif( m_ReportKind == REALIZREG_0205 ) 
                 m_NkdBsellRub = this.NkdBrub();
              end;
           end;
        end;
     end;
     return m_NkdBsellRub;
  END;

  MACRO CoupSaldoRub():MONEY // Сальдо доходов при погашении купона, руб.
     var CLR = 0;
     if( m_CoupSaldoRub == NULL )
        m_CoupSaldoRub = 0;
        if( m_ReportKind == REALIZREG_0202 ) 
           if (this.SellType() == 1)
              CLR = this.NkdSvn();
           end;

           if( (this.ifCoupPrev() == 0) AND (this.CoupVN() + CLR > $0) )
              m_CoupSaldoRub = this.CoupVN() - this.NkdBvn() + CLR;
           else
              m_CoupSaldoRub = this.CoupVN() + CLR;
           end;

        elif( m_ReportKind == REALIZREG_0205 ) 
           if (this.SellType() == 1)
              CLR = this.NkdSrub();
           end;

           if( (this.ifCoupPrev() == 0) AND (this.CoupRub() + CLR > $0) )
              m_CoupSaldoRub = this.CoupRub() - this.NkdBrub() + CLR;
           else
              m_CoupSaldoRub = this.CoupRub() + CLR;
           end;
        end;
     end;
     return m_CoupSaldoRub;
  END;

  MACRO DBV():DATE
    if( (m_ReportKind == REALIZREG_0204) and (this.DDB() <= date(14,07,2005)))
      return date(14,07,2005);
    end;
    return this.DDB();
  END;

  MACRO CoupCount():INTEGER
    return GetCountCouponInPeriod(m_RS.t_FIID, this.Дн(), this.DDS(), this.GetDrawingDate());
  END;

  MACRO LastCoupDate():DATE
    return GetMaxCouponDrawingDateInPeriod(m_RS.t_FIID, this.Дн(), this.DDS(), this.GetDrawingDate());
  END;

  MACRO PrSNom():DOUBLE //  Цена реализации, % от номинала (из сделки)
     var Nom = 0.0;
     if( m_PrSNom == NULL )
       if( IsRET_ISSUE(int(m_RS.DealSaleGroup)) ) 
          m_PrSNom = 100;
       elif(m_RS.SaleRelativePrice == UNSET_CHAR)
         Nom = GetFaceValue( m_RS.FIID, this.DDS(), true, false );
         if (Nom != 0.0)
             if( (this.VPrS() == NATCUR) and ((m_ReportKind == REALIZREG_0205) or (m_ReportKind == REALIZREG_0206)) )
                m_PrSNom = this.DealSalePrice() * 100.0 / Nom * GetRateOnDateCrossDbl(this.DDS(), this.VPrS(), NATCUR, true);
             else
                m_PrSNom = this.DealSalePrice() * 100.0 / Nom;
             end;
         else
            m_PrSNom = 0.0;
         end;
       else
         m_PrSNom = this.DealSalePrice();
       end;
     end;
     return m_PrSNom;
  END;

  /*для погашений дату погашения выпуска берем из операции, для продаж - из анкеты выпуска*/
  MACRO GetDrawingDate():DATE
     return IIF(IsRET_ISSUE(int(m_RS.DealSaleGroup)),this.DDS(),this.Dexp());
  END;

  MACRO AmortVN():MONEY
     return (this.AmortVN_before() + this.AmortVN_after());
  END;

  MACRO AmortVNrep():MONEY
     if( m_AmortVNrep == null )
        if( this.AmortVN_before() > 0 )
           m_AmortVNrep = this.AmortVN();
        else
           m_AmortVNrep = this.AmortVNPer();
        end;
     end;
     return m_AmortVNrep;
  END;

  MACRO AmortRubrep():MONEY
     if( m_AmortRubrep == null )
        m_AmortRubrep = 0;
        if (this.AmortVN_before() > 0)
           if(this.DDB() < Date(1,1,2015) )
              m_AmortRubrep = GetPartialSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.DDB()+1, min(this.DDS(),DATE(31,12,2014)), null, this.GetDrawingDate() );
           end;
           m_AmortRubrep = m_AmortRubrep + GetPartialSumByPeriod_Rub( m_RS.FIID, this.Qnty(), max(this.DDB()+1,DATE(1,1,2015)), this.DDS(), null, this.GetDrawingDate() );
        else
           m_AmortRubrep = GetPartialSumByPeriod_Rub( m_RS.FIID, this.Qnty(), max(this.DDB()+1,this.H0_7()), this.DDS(), null, this.GetDrawingDate() );
        end;
     end;
     return m_AmortRubrep;
  END;

  MACRO AmortVN_before():MONEY
     if( m_AmortVN_before == null )
         m_AmortVN_before = 0;
        if(this.DDB() < Date(1,1,2015) )
           m_AmortVN_before = GetPartialSumByPeriod( m_RS.FIID, this.Qnty(), this.DDB()+1, min(this.DDS(),DATE(31,12,2014)), null, this.GetDrawingDate() );
        end;
     end;
     return m_AmortVN_before;
  END;

  MACRO AmortVN_after():MONEY
     if( m_AmortVN_after == null )
        m_AmortVN_after = GetPartialSumByPeriod( m_RS.FIID, this.Qnty(), max(this.DDB()+1,DATE(1,1,2015)), this.DDS(), null, this.GetDrawingDate() );
     end;
     return m_AmortVN_after;
  END;

  MACRO AmortVNPer():MONEY
     if( m_AmortVNPer == null )
        m_AmortVNPer = GetPartialSumByPeriod( m_RS.FIID, this.Qnty(), max(this.DDB()+1,this.H0_7()), this.DDS(), null, this.GetDrawingDate() );
     end;
     return m_AmortVNPer;
  END;

  MACRO KSumBvn():DOUBLE
     if( m_KSumBvn == null )
        m_KSumBvn = 0.0;
        if( this.AmortVN() != $0 )
           if( this.AmortVN_before() == $0 )
              m_KSumBvn = (this.AmortVN_after() - this.AmortVNPer()) / this.NomB() / this.Qnty();
           end;
        end;
     end;
     return m_KSumBvn;
  END;

  MACRO SumBvp_exps():MONEY
     return (this.SumBvp()-(this.SumBvp()*this.KSumBvn()));
  END;

  MACRO DifSumBRub():MONEY
     return (this.DifB()*(1-this.KSumBvn()));
  END;

  MACRO SumBNRub():MONEY
     return (this.SumBvp_exps()*this.CrBD()-this.DifSumBRub());
  END;

  MACRO DifSumBRub_AmortPrev():MONEY
     return (this.DifB()*this.KSumBvn());
  END;

  MACRO SumBRub_AmortPrev()
     return (this.SumBrub()*this.KSumBvn()-this.DifSumBRub_AmortPrev());
  END;

  MACRO GetParty( ContRec:TRecHandler, Deal )
    var vContID;
    ContRec.clear();
    vContID = GetContrInDeal(Deal.rec); 
    if( ПолучитьСубъекта(vContID,ContRec) != 0 )
       msgbox("Не могу получить субъекта с ID = "+string(vContID));
    end;
  END;  

  MACRO GetPartyB()
    if( m_ContIDB == null )
       this.GetParty( m_ContRecB, this.DealBuy() );
       m_ContIDB = m_ContRecB.rec.PartyID;
    end;
    return m_ContRecB;
  END;  

  MACRO GetPartyS()
    if( m_ContIDS == null )
       this.GetParty( m_ContRecS, this.DealSale() );
       m_ContIDS = m_ContRecS.rec.PartyID;
    end;
    return m_ContRecS;
  END;  

  MACRO Dep_BS( Deal, ContRec:TRecHandler )
    record contrclient("party.dbt");
    var NumInList = "";

    DL_GetObjAttrName(OBJTYPE_PARTY, PARTY_ATTR_GROUP_KIND_INTERDEPENDENCE, DL_GetMainObjAttr(ContRec, PARTY_ATTR_GROUP_KIND_INTERDEPENDENCE, OBJTYPE_PARTY ),
                      null, null, @NumInList);

    if( NumInList == "" )
       if( GetLinkedObject( 1, OBJTYPE_SECDEAL, UniID( Deal, OBJTYPE_SECDEAL ), OBJTYPE_PARTY, contrclient) == 0 )
          if( ПолучитьСубъекта(contrclient.PartyID,contrclient.PartyID) != 0 )
             msgbox("Не могу получить субъекта с ID = "+string(contrclient.PartyID));
          else
             DL_GetObjAttrName(OBJTYPE_PARTY, PARTY_ATTR_GROUP_KIND_INTERDEPENDENCE, DL_GetMainObjAttr(contrclient, PARTY_ATTR_GROUP_KIND_INTERDEPENDENCE, OBJTYPE_PARTY ),
                               null, null, @NumInList);
          end;
       end;
    end;

    return NumInList;
  END;

  MACRO DepS()
     return Dep_BS(this.DealSale(),this.GetPartyS());
  END;

  MACRO DepB()
     return Dep_BS(this.DealBuy(),this.GetPartyB());
  END;

  MACRO ContS():STRING // Контрагент по сделке реализации 
     return this.GetPartyS().rec.Name;
  END;

  MACRO ContB():STRING // Контрагент по сделке приобретения
     return this.GetPartyB().rec.Name;
  END;

  initTX_RegistrReport( Form, TemplateName, UseCSV, IsWebService, ReportHashCode );
END;

MACRO ReportRunEx(
  IsWebService    : Bool
 ,FormData      //: CTxReportForm
 ,ReportHashCode  : Integer
 ,menuItem      //: WsMenuItem
)
  var stat = true;
  var NumCopy = 0;
  var FullReportFileNames = TArray();
  WebMenuItem = menuItem;

  if( CheckTaxDepositoryMode() == false ) /*если не включен режим хранилища данных для налогового учета*/
    msgbox("Отчет доступен только в режиме хранилища");

    stat = false;
  end;

  if( stat )
    if( not IsWebService )
      RealizReg_Form = SP_RealizReg_Panel();
    else
      if( ValType(FormData) != V_UNDEF )
        RealizReg_Form = WS_TX_RealizReg_Panel( FormData );
      else
        stat = false;
      end;
    end;
  end;

  while( stat )
    if( not IsWebService )
      stat = RealizReg_Form.Run();
    end;

    NumCopy = 0;

    if( stat )
      if( RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_BYQUOTED ) == SET_CHAR )
        NumCopy = NumCopy + 1;
      end;

      if( RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_BYNOQUOTED ) == SET_CHAR )
        NumCopy = NumCopy + 1;
      end;

      if( RealizReg_Form.GetFieldValue( PNFLD_REALIZREG_BYTECH ) == SET_CHAR )
        NumCopy = NumCopy + 1;
      end;

      RealizReg_Report = SP_RealizReg_Report( null, "Report_TxRealizReg.xls", null, IsWebService, ReportHashCode );
      RealizReg_Report.Run( NumCopy );

      if( IsWebService )
        DL_CallInsertStat( RealizReg_Report.PrintMode(), menuItem.iCaseItem, menuItem.iIdentProgram, menuItem.szNameItem );
        if( RealizReg_Report.IsDataExist() == true )
           FullReportFileNames = RealizReg_Report.GetFullReportFileNames();
        end;
        stat = false;
      else
        DL_CallInsertStat( RealizReg_Report.PrintMode() );
      end;

      RealizReg_Report = NULL;
    end;
  end;

  return FullReportFileNames;
END;
