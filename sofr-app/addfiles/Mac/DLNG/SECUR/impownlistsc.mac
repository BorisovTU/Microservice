/*
$Name:        impownlistsc.mac
$Module:      Ценные бумаги (ОЭБ)
$Description: Макрос скроллинга процедур импорта списка владельцев
*/
import DealsInter, SPInter, PTInter, globals;
import RsbDataSet;

/* Уже заполненные структуры, все изменения отразятся в базах */
PRIVATE VAR Документ         = TRecHandler( "scownlist" );
PRIVATE VAR СтарыйДокумент   = TRecHandler( "scownlist" ); /* заполняется при редактировании */

/* Макрофункция инициализации нового актива 
   необходимо заполнить структуру "Документ"
   возвращаемое значение
   0 - ошибок не было
   1 - была ошибка
*/
PRIVATE MACRO Новый_Документ()
  
  return 0;
END;

private macro Проверить_Документ( Режим:integer )
  if(Режим == 3) //редактирование операции

    //здесь должны быть проверки при редактировании

  elif(Режим == 1) //удаление
    
    //здесь должны быть проверки при удалении

  end;

  return 0;
end;

/* Установка подсказки для скролингов из макроса */
private MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStatus:integer, ScrolKind:integer ):string

  //пример
  //return "/*+FIRST_ROWS LEADING(t) INDEX(t dscownlist_dbt_idx0)*/";

  return DefaultHint;

END;

/* Вызывается по CTRL+Z из скроллинга */
private macro Функция_Пользователя()
 // MsgBox( "Выполняется макрофункция \"impownlistsc.mac\\ Функция_Пользователя\"." );
  var scr_sql  = "   SELECT                                                                                                                               /*+FIRST_ROWS*/ "
               + "        t.t_listid, "
               + "         t.t_ownerid, "
               + "         pt.t_shortname, "
               + "         CASE pt.t_legalform WHEN 1 THEN 'Юр. лицо' ELSE 'Физ. лицо' END AS T_personType, "
               + "         PT.T_NOTRESIDENT, "
               + "         t.t_total, "
               + "         t.t_accnumber, "
               + "         scownlist.t_ListDate, "
               + "         scownlist.t_ListTime, "
               + "         scownlist.t_ListNum, "
               + "         fininstr.t_FI_Code, "
               + "         rsb_secur.GetDealOperName (t.t_Oper) as t_oper "
               + "    FROM dscownhist_dbt t, "
               + "         dfininstr_dbt fininstr, "
               + "         dscownlist_dbt scownlist, "
               + "         dparty_dbt pt "
               + "   WHERE pt.t_partyid = t.t_ownerid AND (scownlist.t_ListID = t.t_ListID AND fininstr.t_FIID = scownlist.t_FIID AND scownlist.t_ListID = ?) "
               + "ORDER BY t.t_id ";
  var scr_cmd = RSDCommand(scr_sql);

      scr_cmd.AddParam("", rsdbp_in, 15);
  var scr_rs = RSDRecordset(scr_cmd, rsdval_client, rsdval_static);
  runscroll(scr_rs); 

  return 0;
end;

                