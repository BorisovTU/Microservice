/*
$Name:        DifNDRCar_Form.mac
$Module:      Ценные бумаги
$Description: Панель отчета "Расхождения между бух. учетом НДФЛ и объектами НДР"
*/

import "DlRepForm_h.mac";

const DIFNDRCAR_BEGDATE = 0;
const DIFNDRCAR_ENDDATE = 1;

private const PNFLD_DIFNDRCAR_BEGDATE = 100;
private const PNFLD_DIFNDRCAR_ENDDATE = 101;

CLASS (DL_CPanel) DifNDRCar_Form()
   private macro Init()
      var month, year:Integer;
      var BegDate, EndDate:Date;

      DateSplit({CurDate}, NULL, month, year);
      if(month > 1)
         BegDate = Date(1, month - 1, year);
         EndDate = Date(1, month, year) - 1;
      else
         BegDate = Date(1, 12, year - 1);
         EndDate = Date(31, 12, year - 1);
      end;

      AddFieldProc(0, DIFNDRCAR_BEGDATE, PNFLD_DIFNDRCAR_BEGDATE, @DL_FldProc_BeginDate, BegDate);
      AddFieldProc(0, DIFNDRCAR_ENDDATE, PNFLD_DIFNDRCAR_ENDDATE, @DL_FldProc_EndDate, EndDate);
   end;

   private macro Check():BOOL
      var BegDate:Date = GetFieldValue(DIFNDRCAR_BEGDATE),
          EndDate:Date = GetFieldValue(DIFNDRCAR_ENDDATE);

      if(BegDate > EndDate)
         MsgBox("Дата начала не может быть больше даты окончания отчетного периода");
         return false;
      end;

      return true;
   end;

   InitDL_CPanel("sp_rep.lbr", "DIFNDRCR");
END;