/*
$Name:             ws_txfilist.mac
$Module:           €“ 
$Description:      WEB. €“. Œ ªà®á á¥à¢¨á®¢ (á®¤¥à¦ é¨å ¯ à ¬¥âà á ¤®¯. ãá«®¢¨ï¬¨), ¢ë§ë¢ ¥¬ëå ¢¨¤¦¥â®¬ FIUniListWidget
*/
import "ws_fiunilistclass.mac";
import "ws_txfilistcond.mac";


class (FIUNIList) FIUNIList_TxFIListExt
  var Param;//:CTxAvoirIssFiltrParm;

///////////////////////////////////////////////////////////
// ¥à¥®¯à¥¤¥«¥­¨¥ äã­ªæ¨¨ ª« áá  GetCount: ®«ãç¨âì ®¡é¥¥ ª®«¨ç¥áâ¢® (¤«ï ¯ ¤¦¨­ æ¨¨) á ãç¥â®¬ AddWhere
///////////////////////////////////////////////////////////
  macro GetCount( fltrParm,
                  listLen,
                  filterConditionItems,
                  orderitems ):integer
    var p;
    var result : integer = 0;
    var query = "SELECT COUNT(*) as recordsCount FROM ( ";
    var queryWhere = ExecMacroFile("ws_fiunilistclass.mac", "GetFIQuery", fltrParm, TxGetAddWhere(Param), listLen, filterConditionItems, orderitems);
    query = query + queryWhere + ") tt";

    var ds = TRsbDataSet(query, RSDVAL_CLIENT, RSDVAL_STATIC);

    if (ds.moveNext())
      result = ds.recordsCount;
    end;

    return result;
  end;
  
end;

///////////////////////////////////////////////////////////
// ®«ãç¨âì á¯¨á®ª ¯®áâà ­¨ç­®
// PageSize - à §¬¥à áâà ­¨æë
// PageNum - ­®¬¥à áâà ­¨æë €—ˆ€Ÿ ‘ 0 !!!
///////////////////////////////////////////////////////////
macro GetFIList( PageSize,
                 PageIndex,
                 fltrParm,
                 AddWhereCond,
                 listLen,
                 filterConditionItems,
                 orderitems,
                 param):TArray

  var obj = FIUNIList_TxFIListExt();
  obj.Param = param;

  return obj.GetList( PageSize,
                       PageIndex,
                       fltrParm,
                       TxGetAddWhere(param),
                       listLen,
                       filterConditionItems,
                       orderitems );
end;

///////////////////////////////////////////////////////////
// ®«ãç¨âì ®¡é¥¥ ª®«¨ç¥áâ¢® (¤«ï ¯ ¤¦¨­ æ¨¨)
///////////////////////////////////////////////////////////
macro GetFICount( fltrParm,
                  AddWhereCond,
                  listLen,
                  filterConditionItems,
                  orderitems,
                  param):integer

  var obj = FIUNIList_TxFIListExt();
  obj.Param = param;

  return obj.GetCount( fltrParm,
                        listLen,
                        filterConditionItems,
                        orderitems);
end;


///////////////////////////////////////////////////////////
// ‚®§¢à é ¥â á¯¨á®ª ¤«¨­­ë listLen ¯®
// ç áâ¨ç­®¬ã á®¢¯ ¤¥­¨î §­ ç¥­¨ï
///////////////////////////////////////////////////////////
macro LookupFI( fltrParm, listLen, param ):TArray
  var obj = FIUNIList_TxFIListExt();
  obj.Param = param;

  return obj.Lookup( fltrParm, listLen );
end;

////////////////////////////////////////////////
// ‚®§¢à é ¥â ­®¬¥à áâà®ª¨
////////////////////////////////////////////////
macro GetFIRowNum() : integer
  var obj = FIUNIList_TxFIListExt();

  return obj.GetRowNum();
end;

macro GetTWsFinInstrByID(fiid : integer, codeKind  ):TWsFinInstr
  var p;
  var fltrParm = TWsFinInstrFltrParm();
  
  fltrParm.FindFIID = fiid;
  fltrParm.CodeKindWidget = codeKind;

  var list = GetFIList( 0, 0, fltrParm, 0, NULL, NULL);
  
  if( (list != NULL) AND (list.size > 0) )
    p = list[0];
  end;
  
  return p;
end;
