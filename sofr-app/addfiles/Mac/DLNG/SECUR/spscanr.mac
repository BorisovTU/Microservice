/*
  RS-Bank 5.0                                          R-Style Software Lab

  $Name: spscanr.mac
  $Module: БО ЦБ
  $Description: Печать отчета сканирования. удалении операций для сделок.
  $Created     : 16 January 2001 
  $Programmer  : Шкодин В.В.

*/
import secinter, DealsInter;   

RECORD deal_firstdoc (dl_tick); 
FILE dl_tick(dl_tick); 

const Ошибка = 0,
      Первый = 1,
   Последний = 2;

/*Action = 1 - вызывается из списка сделок в сервисной операции*/
MACRO Печать_ОтчетСканирования (Вызов,firstdoc,Статус,Сообщение, Action)
     setbuff (deal_firstdoc,firstdoc);
     if (Вызов==Первый)
[
                   Отчет о групповом удалении операций для сделок.
┌──────────────────────────┬──────┬───────────────────────────────────────────────────────────────────────────────────────────────────┐
│            Код           │  №   │                      Сообщение                                                                    │
│          сделки          │ошибки│                                                                                                   │
├──────────────────────────┼──────┼───────────────────────────────────────────────────────────────────────────────────────────────────┤];
     elif (Вызов==Ошибка)
        if(Статус == 0) 
           if( Action == 1 )
              Сообщение = "Шаги сервисной операции удалены.";
           else 
              if(deal_firstdoc.DealID)
                 dl_tick.DealID = deal_firstdoc.DealID;
                 if(GetEQ(dl_tick))
                    if( dl_tick.DealStatus != DL_PREPARING ) /*10*/
                       Сообщение = "Операция не удалена.";
                    elif(dl_tick.DealStatus == DL_PREPARING ) /*0*/
                       Сообщение = "Операция удалена успешно. Сделка отложена.";
                    end;
                 else 
                    Сообщение = "Операция и сделка удалены успешно.";
                 end;
              end;
           end;
        end;
[│##########################│######│###################################################################################################│]
( deal_firstdoc.DealCode:w, Статус, Сообщение:w );
     elif (Вызов==Последний)            
[└──────────────────────────┴──────┴───────────────────────────────────────────────────────────────────────────────────────────────────┘];
     end;
END;