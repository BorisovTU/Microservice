/********************************************************************************
 DESCRIPTION  :   Отчет "Расшифровка 401 Сделки ПФИ, кроме сделок с ценными бумагами"
                   - форма ввода данных 
 PROGRAMMED BY:   Сагиян С.Г.
 CREATION DATE:   19.02.2019
*******************************************************************************/
import "DlRepForm_h.mac", "globals.mac"; //, RSBDataset;

CONST PNFLD_OD1_DATE              = 0;       /* Дата отчета               */

CLASS Dl_OD1_Form_Data()
  VAR 
  RepDate;

  RepDate = {curdate};

END;

VAR DlComTrAvrRepFormData = Dl_OD1_Form_Data();


private macro GetDate
     Var EndDate, cmd1, rs1;
     cmd1 = RSDCommand("select  to_char(d - interval '1' day, 'dd.mm.yyyy') enddate from  (select  to_date( '01.'|| to_char( ? , 'mm.yyyy'), 'dd.mm.yyyy') d from dual)");
     cmd1.AddParam( "", RSDBP_IN, {curdate} );	  
     RS1 = TRsbDataSet( cmd1 );
     RS1.MoveNext;
     EndDate = RS1.EndDate;
     return enddate;
end;


PRIVATE MACRO Default( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) /*значение поля было изменено*/
    FldRealValue = FldRealValue;
  end;
  return CM_DEFAULT;
END;
                    
CLASS (DL_CPanel) DL_OD1_Panel()

  PRIVATE MACRO Init()
     var  d, m, y;
     var  repdate;

     RepDate = {curdate};


     AddFieldProc( 0, PNFLD_OD1_DATE,                DL_PNFLD_BEGINDATE,        @DL_FldProc_BeginDate,      GetDate);


  END;

  PRIVATE MACRO Check():BOOL
     return true;
  END;
  
  initDL_CPanel( "ndfl_sgs.lbr", "401_2" );
 
END;