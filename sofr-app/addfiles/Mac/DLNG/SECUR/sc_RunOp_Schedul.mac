/*
$Name:             sc_RunOp_Schedul.mac
$Module:           Ценные бумаги 
$Description:      Запуск из планировщика операций
*/
import spserv;

// СОБУ
macro SC_AccountingExecOp_Schedul( DlCommAddr )
   var comm = TRecHandler("dl_comm.dbt"), stat = 0;
   comm.SetRecordAddr(DlCommAddr);

   stat = SC_CreateDlCommOperation(comm);

   if( stat == 0 )
      stat = SC_ServOperExecuteSilent( DL_SCACCOUNTING, Int(comm.rec.DocumentID) );
   end;

   return stat;
end;

// СОВУ
macro SC_InAccountingExecOp_Schedul( DlCommAddr )
   var comm = TRecHandler("dl_comm.dbt"), stat = 0;
   comm.SetRecordAddr(DlCommAddr);

   stat = SC_CreateDlCommOperation(comm);

   if( stat == 0 )
      stat = SC_ServOperExecuteSilent( DL_INACCSRVOP, Int(comm.rec.DocumentID) );
   end;

   return stat;
end;

// СОДУ
macro SC_DepAccExecOp_Schedul( DlCommAddr )
   var comm = TRecHandler("dl_comm.dbt"), stat = 0;
   comm.SetRecordAddr(DlCommAddr);

   stat = SC_CreateDlCommOperation(comm);

   if( stat == 0 )
      stat = SC_ServOperExecuteSilent( DL_DEPOACCSRVOP, Int(comm.rec.DocumentID) );
   end;

   return stat;
end;

// Начисление процентного/дисконтного дохода
macro SC_IncomeExecOp_Schedul( DlCommAddr )
   var comm = TRecHandler("dl_comm.dbt"), stat = 0;
   comm.SetRecordAddr(DlCommAddr);

   stat = SC_CreateDlCommOperation(comm);

   if( stat == 0 )
      stat = SC_ServOperExecuteSilent( DL_GET_INCOME, Int(comm.rec.DocumentID) );
   end;

   return stat;
end;

// Резерв по требованиям сделок / ц/б
macro SC_ReservExecOp_Schedul( DlCommAddr )
   var comm = TRecHandler("dl_comm.dbt"), stat = 0;
   comm.SetRecordAddr(DlCommAddr);

   stat = SC_CreateDlCommOperation(comm);

   if( stat == 0 )
      stat = SC_ServOperExecuteSilent( DL_RESERVEDOC, Int(comm.rec.DocumentID) );
   end;

   return stat;
end;

// Операция переоенки
macro SC_OvervalueExecOp_Schedul( DlCommAddr )
   var comm = TRecHandler("dl_comm.dbt"), stat = 0;
   comm.SetRecordAddr(DlCommAddr);

   stat = SC_CreateDlCommOperation(comm);

   if( stat == 0 )
      stat = SC_ServOperExecuteSilent( DL_OVERVALUE, Int(comm.rec.DocumentID) );
   end;

   return stat;
end;

//Операция отправки отчета брокера
macro SC_SrvRepExecOp_Schedul(SrvRepAddr)
   var srvrep = TRecHandler("scsrvrep.dbt"), stat = 0;
   srvrep.SetRecordAddr(SrvRepAddr);

   stat = SC_CreateSrvRepOperation(srvrep);

   if( stat == 0 )
      stat = SC_ServOperExecuteSilent( SP_SRVBROKERREP, Int(srvrep.rec.ID) );
   end;

   return stat;
end;