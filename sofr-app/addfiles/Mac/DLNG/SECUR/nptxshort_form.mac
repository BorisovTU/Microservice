/*
$Name:        nptxshort_form.mac
$Module:      Ценные бумаги
$Description: Форма ввода данных для отчета "Краткая справка по расчету НДФЛ"
*/

import "DlRepForm_h.mac", "secinter.mac";

CONST PNFLD_NPTXSHORT_DATE         = 0,
      PNFLD_NPTXSHORT_TYPE         = 1,
      PNFLD_NPTXSHORT_INVESTORCODE = 2, 
      PNFLD_NPTXSHORT_INVESTORNAME = 3,
      PNFLD_NPTXSHORT_AVRKIND      = 4,
      PNFLD_NPTXSHORT_AVRCODE      = 5,
      PNFLD_NPTXSHORT_AVRNAME      = 6,
      PNFLD_NPTXSHORT_REALIZ       = 7,
      PNFLD_NPTXSHORT_SHORTPOS     = 8, 
      PNFLD_NPTXSHORT_REPO         = 9,
      PNFLD_NPTXSHORT_LUCRE        = 10;

CONST H_PNFLD_TYPE = 100;

PRIVATE MACRO Default( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
    if( FldRealValue == null ) /*инициализация по умолчанию*/
      FldRealValue = "";
    end;

    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) /*значение поля было изменено*/
    FldRealValue = FldShowValue;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_Type( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  VAR BeginDate, EndDate, Month, Year, BegD, EndD;

  if( Cmd == DLG_INIT ) /*Установка значения в поле*/
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = DL_TXHOLD_OPTYPE_OUTMONEY;
     end;
     FldShowValue = DL_GetNameAlg( 7332, FldRealValue );

  elif( Cmd == DLG_CHANGEVALUE ) /*значение поля было изменено*/

  elif( (Cmd == DLG_KEY) AND (Key == KEY_F3) )
     DL_ListNA( 7332, @FldShowValue, @FldRealValue, pThis.CurrentFldX(), pThis.CurrentFldY() );
  end;
  return CM_DEFAULT;
END;


CLASS (Dl_CPanel) NPTXShort_Panel()

  PRIVATE MACRO Init()
    /*сбросить поля, связанные с ц\б*/
    if( GetFieldByName(0,PNFLD_NPTXSHORT_AVRKIND) )
       SetLinkedValue( PNFLD_NPTXSHORT_AVRKIND, null );
    end;
    if( GetFieldByName(0,PNFLD_NPTXSHORT_AVRCODE) )
       SetLinkedValue( PNFLD_NPTXSHORT_AVRCODE, null );
    end;
    if( GetFieldByName(0,PNFLD_NPTXSHORT_AVRNAME) )
       SetLinkedValue( PNFLD_NPTXSHORT_AVRNAME, null );
    end;

    Report_Kind = "NPSHORT";
    rep_EndDate = {curdate};

    AddFieldProc( 0, PNFLD_NPTXSHORT_DATE,         DL_PNFLD_ENDDATE,             @DL_FldProc_EndDate, {curdate} );
    AddFieldProc( 0, PNFLD_NPTXSHORT_TYPE,         H_PNFLD_TYPE,                 @FldProc_Type, DL_TXHOLD_OPTYPE_OUTMONEY, 15, 7 );
    AddFieldProc( 0, PNFLD_NPTXSHORT_INVESTORCODE, DL_PNFLD_CLIENT_SDD_SVO_CODE, @DL_FldProc_Client_SDD_SVO_Code );
    AddFieldProc( 0, PNFLD_NPTXSHORT_INVESTORNAME, DL_PNFLD_CLIENT_SDD_SVO_NAME, @Default );
    AddFieldProc( 0, PNFLD_NPTXSHORT_AVRKIND,      DL_PNFLD_AVRKIND,             @DL_FldProc_AvrKind );
    AddFieldProc( 0, PNFLD_NPTXSHORT_AVRCODE,      DL_PNFLD_AVRCODE,             @DL_FldProc_NpTxAvrCode );
    AddFieldProc( 0, PNFLD_NPTXSHORT_AVRNAME,      DL_PNFLD_AVRNAME,             @Default );  
    AddFieldProc( 0, PNFLD_NPTXSHORT_REALIZ,       DL_PNFLD_CHECKBOX,            @DL_FldProc_CheckBox, SET_CHAR);
    AddFieldProc( 0, PNFLD_NPTXSHORT_SHORTPOS,     DL_PNFLD_CHECKBOX,            @DL_FldProc_CheckBox, UNSET_CHAR);
    AddFieldProc( 0, PNFLD_NPTXSHORT_REPO,         DL_PNFLD_CHECKBOX,            @DL_FldProc_CheckBox, UNSET_CHAR);
    AddFieldProc( 0, PNFLD_NPTXSHORT_LUCRE,        DL_PNFLD_CHECKBOX,            @DL_FldProc_CheckBox, UNSET_CHAR);
  END;

  initDL_CPanel("sp_rep.lbr", "NPSHORT");
END;
