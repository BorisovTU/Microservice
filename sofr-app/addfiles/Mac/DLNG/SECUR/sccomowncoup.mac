/*
$Name:         sccomowncoup.mac 
$Module:       Ценные бумаги
$Description:  Получение базовой суммы для комиссии ПГ_КУП
*/
import "spretownfun.mac", "sccomalg.mac";

VAR MacroError :INTEGER = 0;

macro CalcCommissionSum( docKind, Doc, sfalg_adr, sfcontr_adr )
  var bassum = TRecHandler( "sfbassum.str" );
  record tick("dl_tick");
  var FD = NULL;

  SetBuff( tick, Doc );
   
  FD = SPFirstDoc(tick, false);

  if(FD.ExistRqPayIncome())
    bassum.Clear();
    bassum.rec.baseType        = SF_BASETYPE_SUM;
    bassum.rec.baseType2       = bassum.rec.baseType;
    bassum.rec.baseSum         = FD.GetRQ(DLRQ_TYPE_PAYINCOME).rec.Amount;
    bassum.rec.baseSum2        = bassum.rec.baseSum;
    bassum.rec.FIID_baseSum    = FD.GetRQ(DLRQ_TYPE_PAYINCOME).rec.FIID;
    bassum.rec.FIID_baseSum2   = bassum.rec.FIID_baseSum;
    bassum.rec.BaseObjectType  = docKind;
    bassum.rec.BaseObjectID    = tick.DealID;

    if( InsertSumList( bassum ) )
       MsgBox( "Ошибка при вставке базовой суммы по сделке.\n" + GetErrMsg() );
       MacroError = 1;
    end;
  end;

end;