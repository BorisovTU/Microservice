/** 
 @file RepoRegister_Report_2014.mac
 @brief Отчет "Регистры РЕПО 2014" (НУ)

 Печать отчета "Регистры РЕПО 2014" (НУ) регистры 507-508, 511-514

 # menu
 - АРНУ\Отчеты\Проценты по РЕПО 2014 (507-508, 511-514)

 # tag
 - functional_block:Налоги_Отчеты
 - code_type:Report
 - АРНУ

 # changeLog 
 |date       |author         |tasks                              |note                            
 |-----------|---------------|-----------------------------------|--------------------------------
 |2023.09.18 |Фаршатов Г. К. |CCBO-7602                          | Добавлены комментарии          
 |2024.01.24 |Швецов Я.А.    |CCBO-1500 CCBO-1498 CCBO-1496      | Доработка регистров по замечаниям банка                  
             |               |CCBO-1494 CCBO-1319 CCBO-1314      |

*/

IMPORT "RepoRegister_Form_2014.mac";

/*Здесь можно через "," в апострофах указать код (FININSTR.FI_Code) ценных бумаг, которые будут исключаться из отчета.
  Например: 
    ИсключаемыеИзОтчетаЦБ_051 = "'1','2','3'"
*/
PRIVATE CONST ИсключаемыеИзОтчетаЦБ_051 = "";

PRIVATE CONST SHEET_0507  = "0507";
PRIVATE CONST SHEET_0508  = "0508";
PRIVATE CONST SHEET_0511  = "0511";
PRIVATE CONST SHEET_0512  = "0512";
PRIVATE CONST SHEET_0513  = "0513";
PRIVATE CONST SHEET_0514  = "0514";

PRIVATE CONST POI_MODE = TRUE;

private const NoDataTxt = "ДАННЫХ НЕТ";

PRIVATE VAR   RepoRegister_Form;
PRIVATE VAR   RepoRegister_Report;

/**
 @brief Класс отчета по 511-512 регистрам
 
 Класс для отчета по обратным\прямым РЕПО с валютой договора  - рубли
*/
PRIVATE CLASS CRepoReg_511_512( Report:OBJECT, ReportKind:STRING, FldNamePrefix:STRING  )
  VAR m_Report = Report;
  var m_FldNamePrefix = FldNamePrefix;
  var m_ReportKind = ReportKind;
  var m_NoDataFlag:bool = true;

  /**
   @brief Сформировать начало отчета

   Печать заголовков, регистрация табличных данных, вставка итоговой строчки
  */
  MACRO BeginReport()
    m_NoDataFlag = true;
    m_Report.PrintMainHeader_RSHB( m_ReportKind, m_FldNamePrefix );

    m_Report.RegisterTable( m_FldNamePrefix+"MainTable", "",
                            m_FldNamePrefix+"Dummy1",
                            m_FldNamePrefix+"SecCode",       m_FldNamePrefix+"SecName",       m_FldNamePrefix+"CodeR",         m_FldNamePrefix+"DZ",         m_FldNamePrefix+"Qnty",       m_FldNamePrefix+"DD1",       
                            m_FldNamePrefix+"DP1",           m_FldNamePrefix+"Tot1vp",        m_FldNamePrefix+"Rate",          m_FldNamePrefix+"CoupN",      m_FldNamePrefix+"CoupVp",        
                            m_FldNamePrefix+"AmortN",        m_FldNamePrefix+"AmortVp",       m_FldNamePrefix+"NMC",           m_FldNamePrefix+"MCvp",       m_FldNamePrefix+"PaySecCnt",  m_FldNamePrefix+"PaySecTot", 
                            m_FldNamePrefix+"DD2",           m_FldNamePrefix+"DP2",           m_FldNamePrefix+"Tot2vp",        
                            m_FldNamePrefix+"Trepo",         m_FldNamePrefix+"Trep",          m_FldNamePrefix+"DohPrevVp",     m_FldNamePrefix+"DohRepVp",   m_FldNamePrefix+"RashPrevVp", m_FldNamePrefix+"RashRepVP", 
                            m_FldNamePrefix+"Cont",          m_FldNamePrefix+"Com",           m_FldNamePrefix+"NDSCom",           m_FldNamePrefix+"TaxRashRepRub",                            m_FldNamePrefix+"DifRashRepRub", 
                            m_FldNamePrefix+"TaxDohRepRub",  m_FldNamePrefix+"DifDohRepRub",  m_FldNamePrefix+"VR",    
                            m_FldNamePrefix+"Yrepo",         m_FldNamePrefix+"MonthRepo",     m_FldNamePrefix+"ifDone2",       m_FldNamePrefix+"SumCalc2vp", m_FldNamePrefix+"SumDeal2vp", m_FldNamePrefix+"ContSum2",  
                            m_FldNamePrefix+"ContD1",        m_FldNamePrefix+"ContD2",        m_FldNamePrefix+"CoupD1endVN",   
                            m_FldNamePrefix+"CoupBegEndVn",  m_FldNamePrefix+"AmortD1endVn",  m_FldNamePrefix+"AmortBegEndVn", m_FldNamePrefix+"DfixDiv",    m_FldNamePrefix+"DohRub",     m_FldNamePrefix+"RashRub",   
                            m_FldNamePrefix+"StRate",        m_FldNamePrefix+"Kmin",          m_FldNamePrefix+"DifRate",       m_FldNamePrefix+"CBchange",      
                            m_FldNamePrefix+"FRate",         m_FldNamePrefix+"IsBlock",       m_FldNamePrefix+"ContLand",      m_FldNamePrefix+"ContCat",    m_FldNamePrefix+"Dep",        m_FldNamePrefix+"Control",
                            m_FldNamePrefix+"Control_Comment", m_FldNamePrefix+"SecType",     m_FldNamePrefix+"Prc_Provid",    m_FldNamePrefix+"Prc_Perform", m_FldNamePrefix+"ISIN"
                          );

    m_Report.SetCellAutoSummaPoint( m_Report.ItogsLineName(), 
                                    m_FldNamePrefix+"Qnty",6, m_FldNamePrefix+"Tot1vp",2, m_FldNamePrefix+"CoupN",0, m_FldNamePrefix+"CoupVp",2, m_FldNamePrefix+"AmortN",0, m_FldNamePrefix+"AmortVp",2, m_FldNamePrefix+"NMC",0,
                                    m_FldNamePrefix+"MCvp",0, m_FldNamePrefix+"PaySecCnt",0, m_FldNamePrefix+"PaySecTot",2, m_FldNamePrefix+"Tot2vp",2, 
                                    m_FldNamePrefix+"DohPrevVp",2, 
                                    m_FldNamePrefix+"DohRepVp",2,
                                    m_FldNamePrefix+"RashPrevVp",2, m_FldNamePrefix+"RashRepVP",2, m_FldNamePrefix+"Com",2, m_FldNamePrefix+"NDSCom",2, 
                                    m_FldNamePrefix+"TaxRashRepRub", 2, m_FldNamePrefix+"DifRashRepRub", 2, m_FldNamePrefix+"TaxDohRepRub",2,  m_FldNamePrefix+"DifDohRepRub",2,
                                    m_FldNamePrefix+"SumCalc2vp", 2, m_FldNamePrefix+"SumDeal2vp", 2,    
                                    m_FldNamePrefix+"ContSum2", 2, m_FldNamePrefix+"ContD1", 0, m_FldNamePrefix+"ContD2", 0, m_FldNamePrefix+"CoupD1endVN", 2, 
                                    m_FldNamePrefix+"CoupBegEndVn", 2,  m_FldNamePrefix+"AmortD1endVn", 2,  m_FldNamePrefix+"AmortBegEndVn", 2, m_FldNamePrefix+"DohRub", 2, m_FldNamePrefix+"RashRub", 2
                                   );

    this.ПечататьСтрокуТаблицы( m_Report.Строка_Итого() );
  END;

  /**
   @brief Печать промежуточных итогов
  */
  MACRO ПечататьПромежуточныеИтоги()    
    m_Report.SetSubtotalEx(26, 29,
                           "E23",             
                           "H23",           
                           "J23",            
                           "K23",           
                           "L23",           
                           "M23",           
                           "N23",          
                           "O23",              
                           "P23",             
                           "Q23",        
                           "T23",        
                           "W23",           
                           "X23",           
                           "Y23",           
                           "Z23",           
                           "AB23",        
                           "AC23",         
                           "AD23",     
                           "AI23",     
                           "AJ23",       
                           "AK23",        
                           "AL23",    
                           "AM23",    
                           "AN23",              
                           "AO23",       
                           "AP23",       
                           "AQ23",         
                           "AR23",
                           "AS23",           
                           "AU23",
                           "AV23",
                           "AY23" 
                          );                                                                      
  END;

  /**
   @brief Печать строки таблицы
   @param[in] LineType - Тип строки (данные и итого)
  */
  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )     
    if( LineType == m_Report.Строка_СтрокаДанных() )
      m_NoDataFlag = false;

      m_Report.PrintTableLine( m_FldNamePrefix+"SecCode",          m_Report.SecCode(),         null,               //1
                               m_FldNamePrefix+"SecName",          m_Report.SecName(),         null,               //2
                               m_FldNamePrefix+"CodeR",            m_Report.CodeR(),           null,               //3
                               m_FldNamePrefix+"DZ",               string(m_Report.DZ():f),    null,               //4
                               m_FldNamePrefix+"Qnty",             m_Report.printQnty(),       null,               //5
                               m_FldNamePrefix+"DD1",              string(m_Report.DD1():f),   null,               //6
                               m_FldNamePrefix+"DP1",              string(m_Report.DP1():f),   null,               //7
                               m_FldNamePrefix+"Tot1vp",           m_Report.Tot1vp(),          null,               //8
                               m_FldNamePrefix+"Rate",             m_Report.PrintRate(),       null,               //9       
                               m_FldNamePrefix+"CoupN",            m_Report.CoupN(),           null,               //10
                               m_FldNamePrefix+"CoupVp",           m_Report.CoupVp(),          null,               //11
                               m_FldNamePrefix+"AmortN",           m_Report.AmortN(),          null,               //12
                               m_FldNamePrefix+"AmortVp",          m_Report.AmortVp(),         null,               //13
                               m_FldNamePrefix+"NMC",              m_Report.NMC(),             null,               //14
                               m_FldNamePrefix+"MCvp",             m_Report.MCvp(),            null,               //15
                               m_FldNamePrefix+"PaySecCnt",        m_Report.PaySecCnt(),       null,               //16
                               m_FldNamePrefix+"PaySecTot",        m_Report.PaySecTot(),       null,               //17
                               m_FldNamePrefix+"DD2",              string(m_Report.DD2():f),   null,               //18
                               m_FldNamePrefix+"DP2",              string(m_Report.DP2():f),   null,               //19
                               m_FldNamePrefix+"Tot2vp",           m_Report.Tot2vp(),          null,               //20
                               m_FldNamePrefix+"Trepo",            m_Report.Trepo(),           null,               //21
                               m_FldNamePrefix+"Trep",             m_Report.Trep(),            null,               //22
                               m_FldNamePrefix+"DohPrevVp",        m_Report.DohPrevVp(),       null,               //23
                               m_FldNamePrefix+"DohRepVp",         m_Report.DohRepVp(),        null,               //24
                               m_FldNamePrefix+"RashPrevVp",       m_Report.RashPrevVp(),      null,               //25
                               m_FldNamePrefix+"RashRepVP",        m_Report.RashRepVP(),       null,               //26
                               m_FldNamePrefix+"Cont",             m_Report.Cont(),            null,               //27
                               m_FldNamePrefix+"Com",              m_Report.Com(),             null,               //28
                               m_FldNamePrefix+"NDSCom",           m_Report.NDSCom(),          null,               //28.1
                               m_FldNamePrefix+"TaxRashRepRub",    m_Report.TaxPashRepRub(),   null,               //А1
                               m_FldNamePrefix+"DifRashRepRub",    m_Report.DifRashRepRub(),   null,               //А2
                               m_FldNamePrefix+"TaxDohRepRub",     m_Report.TaxDohRepRub(),    null,               //А3
                               m_FldNamePrefix+"DifDohRepRub",     m_Report.DifDohRepRub(),    null,               //А4
                               m_FldNamePrefix+"VR",               m_Report.printVR(),         null,               //A5 
                               m_FldNamePrefix+"Yrepo",            m_Report.Yrepo(),           null,               //T1 
                               m_FldNamePrefix+"MonthRepo",        m_Report.MonthRepo(),       null,               //T2 
                               m_FldNamePrefix+"ifDone2",          m_Report.ifDone2(),         null,               //T3 
                               m_FldNamePrefix+"SumCalc2vp",       m_Report.SumCalc2vp(),      null,               //T4 
                               m_FldNamePrefix+"SumDeal2vp",       m_Report.SumDeal2vp(),      null,               //T5 
                               m_FldNamePrefix+"ContSum2",         m_Report.ContSum2(),        null,               //T6 
                               m_FldNamePrefix+"ContD1",           m_Report.ContD1(),          null,               //T7
                               m_FldNamePrefix+"ContD2",           m_Report.ContD2(),          null,               //T8 
                               m_FldNamePrefix+"CoupD1endVN",      m_Report.CoupD1endVN(),     null,               //T9
                               m_FldNamePrefix+"CoupBegEndVn",     m_Report.CoupBegEndVn(),    null,               //T10
                               m_FldNamePrefix+"AmortD1endVn",     m_Report.AmortD1endVn(),    null,               //T11
                               m_FldNamePrefix+"AmortBegEndVn",    m_Report.AmortBegEndVn(),   null,               //T12
                               m_FldNamePrefix+"DfixDiv",          m_Report.DfixDiv(),         null,               //T13
                               m_FldNamePrefix+"DohRub",           m_Report.DohRub(),          null,               //T14
                               m_FldNamePrefix+"RashRub",          m_Report.RashRub(),         null,               //T15 
                               m_FldNamePrefix+"StRate",           m_Report.printStRate(),     null,               //T16
                               m_FldNamePrefix+"Kmin",             m_Report.printKmin(),       null,               //T17
                               m_FldNamePrefix+"DifRate",          m_Report.printDifRate(),    null,               //T18
                               m_FldNamePrefix+"CBchange",         m_Report.CBchange(),        null,               //T19
                               m_FldNamePrefix+"FRate",            m_Report.FRate(),           null,               //T20
                               m_FldNamePrefix+"IsBlock",          m_Report.IsBlock(),         null,               //T21
                               m_FldNamePrefix+"ContLand",         m_Report.ContLand(),        null,               //T22
                               m_FldNamePrefix+"ContCat",          m_Report.ContCat(),         null,               //T23
                               m_FldNamePrefix+"Dep",              m_Report.Dep(),             null,               //T24
                               m_FldNamePrefix+"Control",          m_Report.Control(),         null,               //T25
                               m_FldNamePrefix+"Control_Comment",  m_Report.Control_Comment(), null,               //T26
                               m_FldNamePrefix+"SecType",          m_Report.SecType(),         null,               //T27
                               m_FldNamePrefix+"Prc_Provid",       m_Report.Prc_Provid(),      null,               //T28
                               m_FldNamePrefix+"Prc_Perform",      m_Report.Prc_Perform(),     null,               //T29
                               m_FldNamePrefix+"ISIN",             m_Report.ISIN(),            null                //R1
                               );

     elif( LineType == m_Report.Строка_Итого() )
       m_Report.SetCopyAutoSumRange("$A$7:BM7");
     elif( LineType == m_Report.Строка_ПустойОтчёт() )
       m_Report.PrintTableLine( m_FldNamePrefix+"SecCode",  NoDataTxt, null );
     end;
  END;         

  /**
   @brief Сформировать конец отчета

   Закрытие таблицы с данными, печать итогов, формирование окончания отчета
  */
  MACRO EndReport();
    if(m_NoDataFlag)
      this.ПечататьСтрокуТаблицы( m_Report.Строка_ПустойОтчёт() );
    end;

    m_Report.EndTable();
    m_Report.ReplaceFormulaAndCalculate();
    m_Report.SetCopyAutoSumRange(null);

    if(not m_NoDataFlag)  
      m_Report.SetOnAutoFilter(m_ReportKind, "B13:BM13");
      //m_Report.SetAutoSize();
    end;
  END;         
END;

/**
 @brief Класс отчета по 513-514 регистрам
 
 Класс для отчета по обратным\прямым РЕПО с валютой договора  - иностранная валюта
*/
PRIVATE CLASS CRepoReg_513_514( Report:OBJECT, ReportKind:STRING, FldNamePrefix:STRING  )
  VAR m_Report = Report;
  var m_FldNamePrefix = FldNamePrefix;
  var m_ReportKind = ReportKind;
  var m_NoDataFlag:bool = true;

  /**
   @brief Сформировать начало отчета

   Печать заголовков, регистрация табличных данных, вставка итоговой строчки
  */
  MACRO BeginReport()
    m_Report.PrintMainHeader_RSHB( m_ReportKind, m_FldNamePrefix );
    m_NoDataFlag = true;

    m_Report.RegisterTable( m_FldNamePrefix+"MainTable", "",
                            m_FldNamePrefix+"Dummy1",
                            m_FldNamePrefix+"SecCode",       m_FldNamePrefix+"SecName",       m_FldNamePrefix+"CodeR",         m_FldNamePrefix+"DZ",                   m_FldNamePrefix+"Qnty",            m_FldNamePrefix+"VP",    
                            m_FldNamePrefix+"DD1",   
                            m_FldNamePrefix+"DP1",           m_FldNamePrefix+"Tot1vp",        m_FldNamePrefix+"Rate",          m_FldNamePrefix+"CoupN",                m_FldNamePrefix+"CoupVp",          m_FldNamePrefix+"AmortN",        
                            m_FldNamePrefix+"AmortVp",       m_FldNamePrefix+"NMC",           m_FldNamePrefix+"MCvp",          m_FldNamePrefix+"PaySecCnt",            m_FldNamePrefix+"PaySecTot",       m_FldNamePrefix+"DD2",   
                            m_FldNamePrefix+"DP2",           m_FldNamePrefix+"Tot2vp",        m_FldNamePrefix+"Trepo",         m_FldNamePrefix+"Trep",                 m_FldNamePrefix+"DohPrevVp",       m_FldNamePrefix+"DohPrevRub",    
                            m_FldNamePrefix+"DohRepVp",      m_FldNamePrefix+"DohRepRub",     m_FldNamePrefix+"RashPrevVp",    m_FldNamePrefix+"RashPrevRub",          m_FldNamePrefix+"RashRepVP",       m_FldNamePrefix+"RashRepRub",    
                            m_FldNamePrefix+"Cont",          m_FldNamePrefix+"Com",           m_FldNamePrefix+"NDSCom",           m_FldNamePrefix+"TaxRashRepRub", m_FldNamePrefix+"DifRashRepRub",        
                            m_FldNamePrefix+"TaxDohRepRub",  m_FldNamePrefix+"DifDohRepRub",  m_FldNamePrefix+"VR",            m_FldNamePrefix+"PereocAll",     
                            m_FldNamePrefix+"PereocPrev",    
                            m_FldNamePrefix+"PereocDohRep",  m_FldNamePrefix+"PereocRashRep", m_FldNamePrefix+"PereocAllRub",  m_FldNamePrefix+"PereocPrevRub",        m_FldNamePrefix+"PereocDohRepRub", m_FldNamePrefix+"PereocRashRepRub",      
                            m_FldNamePrefix+"PereocDohTek",  m_FldNamePrefix+"PereocRashTek", m_FldNamePrefix+"SumP",
                            m_FldNamePrefix+"SumP2",         m_FldNamePrefix+"ControlSumP",   m_FldNamePrefix+"CrVP",          m_FldNamePrefix+"CrVP2_End",            m_FldNamePrefix+"Yrepo",           m_FldNamePrefix+"MonthRepo",     
                            m_FldNamePrefix+"ifDone2",       m_FldNamePrefix+"SumCalc2vp",    m_FldNamePrefix+"SumDeal2vp",    m_FldNamePrefix+"ContSum2",             m_FldNamePrefix+"ContD1",          m_FldNamePrefix+"ContD2",        
                            m_FldNamePrefix+"CoupD1endVN",   m_FldNamePrefix+"CoupBegEndVn",  m_FldNamePrefix+"AmortD1endVn",  m_FldNamePrefix+"AmortBegEndVn",        m_FldNamePrefix+"DfixDiv",         m_FldNamePrefix+"DohRub",        
                            m_FldNamePrefix+"RashRub",       m_FldNamePrefix+"StRate",        m_FldNamePrefix+"Kmin",          m_FldNamePrefix+"DifRate",              m_FldNamePrefix+"CBchange",        m_FldNamePrefix+"FRate", 
                            m_FldNamePrefix+"IsBlock",       m_FldNamePrefix+"ContLand",      m_FldNamePrefix+"ContCat",       m_FldNamePrefix+"Dep",                  m_FldNamePrefix+"Control",         m_FldNamePrefix+"Control_Comment",
                            m_FldNamePrefix+"SecType",       m_FldNamePrefix+"Prc_Provid",    m_FldNamePrefix+"Prc_Perform",   m_FldNamePrefix+"ISIN"
                          );

    m_Report.SetCellAutoSummaPoint( m_Report.ItogsLineName(), 
                                    m_FldNamePrefix+"Qnty",6,          m_FldNamePrefix+"Tot1vp",2,        m_FldNamePrefix+"CoupN",0,           m_FldNamePrefix+"CoupVp",2,        
                                    m_FldNamePrefix+"AmortN",0,        m_FldNamePrefix+"AmortVp",2,       m_FldNamePrefix+"NMC",0,             m_FldNamePrefix+"MCvp",2,  
                                    m_FldNamePrefix+"PaySecCnt",0,     m_FldNamePrefix+"PaySecTot",2,     m_FldNamePrefix+"Tot2vp",2,           
                                    m_FldNamePrefix+"DohPrevVp",2,     m_FldNamePrefix+"DohPrevRub",2,      m_FldNamePrefix+"DohRepVp",2,      
                                    m_FldNamePrefix+"DohRepRub",2,     m_FldNamePrefix+"RashPrevVp",2,    m_FldNamePrefix+"RashPrevRub",2,     m_FldNamePrefix+"RashRepVP",2,     
                                    m_FldNamePrefix+"RashRepRub",2,    m_FldNamePrefix+"Com",2,           m_FldNamePrefix+"NDSCom",2,           m_FldNamePrefix+"TaxRashRepRub",2,   
                                    m_FldNamePrefix+"DifRashRepRub",2, m_FldNamePrefix+"TaxDohRepRub",2,  m_FldNamePrefix+"DifDohRepRub",2,                                                                                                 
                                    m_FldNamePrefix+"PereocAll",2,     m_FldNamePrefix+"PereocPrev",2,    m_FldNamePrefix+"PereocDohRep",2,    m_FldNamePrefix+"PereocRashRep",2, 
                                    m_FldNamePrefix+"PereocAllRub",2,  m_FldNamePrefix+"PereocPrevRub",2, m_FldNamePrefix+"PereocDohRepRub",2, m_FldNamePrefix+"PereocRashRepRub",2,      
                                    m_FldNamePrefix+"PereocDohTek",2,  m_FldNamePrefix+"PereocRashTek",2,  
                                    m_FldNamePrefix+"SumP",2,          m_FldNamePrefix+"SumP2",2,         m_FldNamePrefix+"ControlSumP",2,
                                    m_FldNamePrefix+"SumCalc2vp",2,    m_FldNamePrefix+"SumDeal2vp",2,    m_FldNamePrefix+"ContSum2",2,        m_FldNamePrefix+"ContD1",0,        
                                    m_FldNamePrefix+"ContD2",0,        m_FldNamePrefix+"CoupD1endVN",2,   m_FldNamePrefix+"CoupBegEndVn",2,    m_FldNamePrefix+"AmortD1endVn",2,  
                                    m_FldNamePrefix+"AmortBegEndVn",2, m_FldNamePrefix+"DohRub",2,        m_FldNamePrefix+"RashRub",2
                                  );

    this.ПечататьСтрокуТаблицы( m_Report.Строка_Итого() );
  END;

  /**
   @brief Печать промежуточных итогов
  */
  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotalEx(26, 29,
                        "E23",             
                        "I23",           
                        "K23",           
                        "L23",           
                        "M23",           
                        "N23",          
                        "O23",              
                        "P23",             
                        "Q23",        
                        "R23",        
                        "U23",           
                        "X23",           
                        "Y23",           
                        "Z23",           
                        "AA23",        
                        "AB23",         
                        "AC23",         
                        "AD23",     
                        "AE23",     
                        "AG23",     
                        "AH23",     
                        "AI23",     
                        "AJ23",
                        "AK23",        
                        "AM23",    
                        "AN23",              
                        "AO23",       
                        "AP23",       
                        "AQ23",         
                        "AR23",         
                        "AS23",           
                        "AT23",       
                        "AU23",      
                        "AV23",      
                        "AW23",      
                        "AX23",
                        "AY23",
                        "BE23",     
                        "BF23",      
                        "BG23",      
                        "BH23",      
                        "BI23",      
                        "BJ23",      
                        "BK23",      
                        "BL23",
                        "BM23",      
                        "BO23",
                        "BP23",
                        "BS23" 
                      );                                                                      
  END;

  /**
   @brief Печать строки таблицы
   @param[in] LineType - Тип строки (данные и итого)
  */
  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )
      
     if( LineType == m_Report.Строка_СтрокаДанных() )
        m_NoDataFlag = false;
       
        m_Report.PrintTableLine( m_FldNamePrefix+"SecCode",               m_Report.SecCode(),               null,               //1
                                 m_FldNamePrefix+"SecName",               m_Report.SecName(),               null,               //2
                                 m_FldNamePrefix+"CodeR",                 m_Report.CodeR(),                 null,               //3
                                 m_FldNamePrefix+"DZ",                    string(m_Report.DZ():f),          null,               //4
                                 m_FldNamePrefix+"Qnty",                  m_Report.printQnty(),             null,               //5
                                 m_FldNamePrefix+"VP",                    m_Report.VP(),                    null,               //6
                                 m_FldNamePrefix+"DD1",                   string(m_Report.DD1():f),         null,               //7
                                 m_FldNamePrefix+"DP1",                   string(m_Report.DP1():f),         null,               //8
                                 m_FldNamePrefix+"Tot1vp",                m_Report.Tot1vp(),                null,               //9
                                 m_FldNamePrefix+"Rate",                  m_Report.PrintRate(),             null,               //10       
                                 m_FldNamePrefix+"CoupN",                 m_Report.CoupN(),                 null,               //11
                                 m_FldNamePrefix+"CoupVp",                m_Report.CoupVp(),                null,               //12
                                 m_FldNamePrefix+"AmortN",                m_Report.AmortN(),                null,               //13
                                 m_FldNamePrefix+"AmortVp",               m_Report.AmortVp(),               null,               //14
                                 m_FldNamePrefix+"NMC",                   m_Report.NMC(),                   null,               //15
                                 m_FldNamePrefix+"MCvp",                  m_Report.MCvp(),                  null,               //16
                                 m_FldNamePrefix+"PaySecCnt",             m_Report.PaySecCnt(),             null,               //17
                                 m_FldNamePrefix+"PaySecTot",             m_Report.PaySecTot(),             null,               //18
                                 m_FldNamePrefix+"DD2",                   string(m_Report.DD2():f),         null,               //19
                                 m_FldNamePrefix+"DP2",                   string(m_Report.DP2():f),         null,               //20
                                 m_FldNamePrefix+"Tot2vp",                m_Report.Tot2vp(),                null,               //21
                                 m_FldNamePrefix+"Trepo",                 m_Report.Trepo(),                 null,               //22
                                 m_FldNamePrefix+"Trep",                  m_Report.Trep(),                  null,               //23
                                 m_FldNamePrefix+"DohPrevVp",             m_Report.DohPrevVp(),             null,               //24
                                 m_FldNamePrefix+"DohPrevRub",            m_Report.DohPrevRub(),            null,               //25
                                 m_FldNamePrefix+"DohRepVp",              m_Report.DohRepVp(),              null,               //26
                                 m_FldNamePrefix+"DohRepRub",             m_Report.DohRepRub(),             null,               //27
                                 m_FldNamePrefix+"RashPrevVp",            m_Report.RashPrevVp(),            null,               //28
                                 m_FldNamePrefix+"RashPrevRub",           m_Report.RashPrevRub(),           null,               //29
                                 m_FldNamePrefix+"RashRepVP",             m_Report.RashRepVP(),             null,               //30
                                 m_FldNamePrefix+"RashRepRub",            m_Report.RashRepRub(),            null,               //31
                                 m_FldNamePrefix+"Cont",                  m_Report.Cont(),                  null,               //32
                                 m_FldNamePrefix+"Com",                   m_Report.Com(),                   null,               //33
                                 m_FldNamePrefix+"NDSCom",                m_Report.NDSCom(),                null,               //33.1
                                 m_FldNamePrefix+"TaxRashRepRub",         m_Report.TaxPashRepRub(),         null,               //А1 
                                 m_FldNamePrefix+"DifRashRepRub",         m_Report.DifRashRepRub(),         null,               //А1.2 
                                 m_FldNamePrefix+"TaxDohRepRub",          m_Report.TaxDohRepRub(),          null,               //А2
                                 m_FldNamePrefix+"DifDohRepRub",          m_Report.DifDohRepRub(),          null,               //А2.1
                                 m_FldNamePrefix+"VR",                    m_Report.printVR(),               null,               //А3 
                                 m_FldNamePrefix+"PereocAll",             m_Report.printPereocAll(),        null,               //А4 
                                 m_FldNamePrefix+"PereocPrev",            m_Report.printPereocPrev(),       null,               //А5 
                                 m_FldNamePrefix+"PereocDohRep",          m_Report.printPereocDohRep(),     null,               //А6 
                                 m_FldNamePrefix+"PereocRashRep",         m_Report.printPereocRashRep(),    null,               //А7 
                                 m_FldNamePrefix+"PereocAllRub",          m_Report.printPereocAllRub(),     null,               //А8 
                                 m_FldNamePrefix+"PereocPrevRub",         m_Report.printPereocPrevRub(),    null,               //А9 
                                 m_FldNamePrefix+"PereocDohRepRub",       m_Report.PereocDohRepRub(),       null,               //А10
                                 m_FldNamePrefix+"PereocRashRepRub",      m_Report.PereocRashRepRub(),      null,               //А11
                                 m_FldNamePrefix+"PereocDohTek",          m_Report.PereocDohTek(),          null,               //А12
                                 m_FldNamePrefix+"PereocRashTek",         m_Report.PereocRashTek(),         null,               //А13
                                 m_FldNamePrefix+"SumP",                  m_Report.printSumP(),             null,               //А14 
                                 m_FldNamePrefix+"SumP2",                 m_Report.printSumP2(),            null,               //А15
                                 m_FldNamePrefix+"ControlSumP",           m_Report.printControlSumP(),      null,               //А16
                                 m_FldNamePrefix+"CrVP",                  m_Report.printCrVP(),             null,               //А17 
                                 m_FldNamePrefix+"CrVP2_End",             m_Report.printCrVP2_End(),        null,               //А18
                                 m_FldNamePrefix+"Yrepo",                 m_Report.Yrepo(),                 null,               //T1 
                                 m_FldNamePrefix+"MonthRepo",             m_Report.MonthRepo(),             null,               //T2 
                                 m_FldNamePrefix+"ifDone2",               m_Report.ifDone2(),               null,               //T3 
                                 m_FldNamePrefix+"SumCalc2vp",            m_Report.SumCalc2vp(),            null,               //T4 
                                 m_FldNamePrefix+"SumDeal2vp",            m_Report.SumDeal2vp(),            null,               //T5 
                                 m_FldNamePrefix+"ContSum2",              m_Report.ContSum2(),              null,               //T6 
                                 m_FldNamePrefix+"ContD1",                m_Report.ContD1(),                null,               //T7 
                                 m_FldNamePrefix+"ContD2",                m_Report.ContD2(),                null,               //T8 
                                 m_FldNamePrefix+"CoupD1endVN",           m_Report.CoupD1endVN(),           null,               //T9 
                                 m_FldNamePrefix+"CoupBegEndVn",          m_Report.CoupBegEndVn(),          null,               //T10
                                 m_FldNamePrefix+"AmortD1endVn",          m_Report.AmortD1endVn(),          null,               //T11
                                 m_FldNamePrefix+"AmortBegEndVn",         m_Report.AmortBegEndVn(),         null,               //T12
                                 m_FldNamePrefix+"DfixDiv",               m_Report.DfixDiv(),               null,               //T13
                                 m_FldNamePrefix+"DohRub",                m_Report.DohRub(),                null,               //T14
                                 m_FldNamePrefix+"RashRub",               m_Report.RashRub(),               null,               //T15
                                 m_FldNamePrefix+"StRate",                m_Report.printStRate(),           null,               //T16
                                 m_FldNamePrefix+"Kmin",                  m_Report.printKmin(),             null,               //T17 
                                 m_FldNamePrefix+"DifRate",               m_Report.printDifRate(),          null,               //T18
                                 m_FldNamePrefix+"CBchange",              m_Report.CBchange(),              null,               //T19
                                 m_FldNamePrefix+"FRate",                 m_Report.FRate(),                 null,               //T20
                                 m_FldNamePrefix+"IsBlock",               m_Report.IsBlock(),               null,               //T21
                                 m_FldNamePrefix+"ContLand",              m_Report.ContLand(),              null,               //T22
                                 m_FldNamePrefix+"ContCat",               m_Report.ContCat(),               null,               //T23
                                 m_FldNamePrefix+"Dep",                   m_Report.Dep(),                   null,               //T24  
                                 m_FldNamePrefix+"Control",               m_Report.Control(),               null,               //T25
                                 m_FldNamePrefix+"Control_Comment",       m_Report.Control_Comment(),       null,               //T26
                                 m_FldNamePrefix+"SecType",               m_Report.SecType(),               null,               //T27
                                 m_FldNamePrefix+"Prc_Provid",            m_Report.Prc_Provid(),            null,               //T28
                                 m_FldNamePrefix+"Prc_Perform",           m_Report.Prc_Perform(),           null,               //T29
                                 m_FldNamePrefix+"ISIN",                  m_Report.ISIN(),                  null                //R1
                               );

     elif( LineType == m_Report.Строка_Итого() )
       m_Report.SetCopyAutoSumRange("$A$7:CG7");
     elif( LineType == m_Report.Строка_ПустойОтчёт() )
       m_Report.PrintTableLine( m_FldNamePrefix+"SecCode",  NoDataTxt, null );
     end;
  END;         

  /**
   @brief Сформировать конец отчета

   Закрытие таблицы с данными, печать итогов, формирование окончания отчета
  */
  MACRO EndReport();
    if(m_NoDataFlag)
      this.ПечататьСтрокуТаблицы( m_Report.Строка_ПустойОтчёт() );
    end;

    m_Report.EndTable();
    m_Report.ReplaceFormulaAndCalculate();
    m_Report.SetCopyAutoSumRange(null);

    if(not m_NoDataFlag)
      m_Report.SetOnAutoFilter(m_ReportKind, "B13:CG13");
      //m_Report.SetAutoSize();
    end;
  END;         
END;

/**
 @brief Класс отчета по регистрам РЕПО 507-508, 511-514
 
 Класс для создания отчета по регистрам РЕПО 507-508, 511-514. 
 Унаследован от базового класса отчета по регистрам РЕПО. (RepoRegisterBase.mac)
*/
PRIVATE CLASS (SP_RepoRegBase) SP_RepoReg_Report_2014( Form:DL_CPanel, TemplateName:STRING, UseCSV:BOOL, IsWebService:BOOL, ReportHashCode:INTEGER, UsePOI:BOOL, FocreFormatRep:INTEGER )
  /**
   @brief Получить значение поля "код Ц/Б"
   @return Значение поля "код Ц/Б"
  */
  PRIVATE MACRO GetFromForm_AVRCODE()
     return RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_AVRCODE_2014);
  END;

  /**
   @brief Получить значение поля "тип Ц/Б"
   @return Значение поля "тип Ц/Б"
  */
  PRIVATE MACRO GetFromForm_AVRKIND()
     return RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_AVRKIND_2014 );
  END;

  /**
   @brief Получить значение поля "группа Ц/Б"
   @return Значение поля "группа Ц/Б"
  */
  PRIVATE MACRO GetFromForm_AVRGROUP()
     return RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_AVRGROUP_2014 );
  END;

  /**
   @brief Получить значение поля "исключить некоторые Ц/Б"
   @return Значение поля "исключить некоторые Ц/Б"
  */
  PRIVATE MACRO GetFromForm_EXCLUDE()
     return RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_EXCLUDE_2014 );
  END;

  /**
   @brief Получить значение поля "статус сделки"
   @return Значение поля "статус сделки"
  */
  PRIVATE MACRO GetFromForm_DEALSTATUS()
     return RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_DEALSTATUS_2014 );
  END;

  /**
   @brief Получить значение поля "дата: c"
   @return Значение поля "дата: c"
  */
  PRIVATE MACRO GetFromForm_BEGINDATE()
     return RepoRegister_Form.GetFieldValue(PNFLD_REPOREG_BEGINDATE_2014);
  END;

  /**
   @brief Получить значение поля "подвид регистра"
   @return Значение поля "подвид регистра"
  */
  PRIVATE MACRO GetFromForm_SUBKIND()
     return RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_SUBKIND_2014 );
  END;

  /**
   @brief Получить значение поля "дата: по"
   @return Значение поля "дата: по"
  */
  PRIVATE MACRO GetFromForm_ENDDATE()
     return RepoRegister_Form.GetFieldValue(PNFLD_REPOREG_ENDDATE_2014);
  END;

  /**
   @brief Получить значение поля "наименование Ц/Б"
   @return Значение поля "наименование Ц/Б"
  */
  PRIVATE MACRO GetFromForm_AVRNAME()
     return RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_AVRNAME_2014 );
  END;

  /**
   @brief Получить значение поля "Год"
   @return Значение поля "Год"
  */
  PRIVATE MACRO GetFromForm_YEAR()
     return RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_YEAR_2014 );
  END;

  /**
   @brief Получить значение поля "Нарастающим итогом"
   @return Значение поля "Нарастающим итогом"
  */
  PRIVATE MACRO GetFromForm_GROWTH()
    var y, y2;
    RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_GROWTH_2014, @y, @y2 );
    if(y2 == "X")
      return true;
    end;

    return false;
  END;

  /**
   @brief Получить значение поля "Период"
   @return Значение поля "Период"
  */
  PRIVATE MACRO GetFromForm_PERIOD()
    var y, y2;
    RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_PERIOD_2014, @y, @y2 );
    return y2;
  END;

  /**
   @brief Получить исключаемые из отчета ЦБ
   @return Строка с Ц/Б исключенными из отчета через ","
  */
  PRIVATE MACRO ИсключаемыеИзОтчетаЦБ():string
     return ИсключаемыеИзОтчетаЦБ_051;
  END;

  /**
   @brief Получить режим вывода
   @return Номер режима вывода через Excel (1)
  */
  MACRO PrintMode():INTEGER
     return DL_OUTREPORT_EXCEL;
  END;

  /**
   @brief Сформировать конец отчета

   Формирование окончания отчета, установка автофильтра
  */
  PRIVATE MACRO EndReport()
    EndReport();
  END;

  /**
   @brief Получение группы налогового учета
   @return Наименование группы налогового учета
  */
  MACRO H0_9():STRING
     var GroupName = "";
     RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_AVRGROUP_2014, @GroupName );
     return GroupName;
  END;

  /**
   @brief Получение вида ц/б
   @return Вид ц/б
  */
  MACRO H0_10():STRING
     var AvrKindShowValue = "";
     RepoRegister_Form.GetFieldValue( PNFLD_REPOREG_AVRKIND_2014, @AvrKindShowValue );
     return AvrKindShowValue;
  END;

  /**
   @brief Создать отчет по виду регистра
   @param[in] Kind - вид регистра
  */
  PRIVATE MACRO CreateReportByKind( Kind:INTEGER )
     m_ReportKind = Kind;
     if( Kind == REPOREG_0507 )
        ExecuteReport( CRepoReg_507_508(this, SHEET_0507, "N7_") );
     elif( Kind == REPOREG_0508 )
        ExecuteReport( CRepoReg_507_508(this, SHEET_0508, "N8_") );
     elif( Kind == REPOREG_0511 )
        ExecuteReport( CRepoReg_511_512(this, SHEET_0511, "N11_") );
     elif( Kind == REPOREG_0512 )
        ExecuteReport( CRepoReg_511_512(this, SHEET_0512, "N12_") );
     elif( Kind == REPOREG_0513 )
        ExecuteReport( CRepoReg_513_514(this, SHEET_0513, "N13_") );
     elif( Kind == REPOREG_0514 )
        ExecuteReport( CRepoReg_513_514(this, SHEET_0514, "N14_") );
     end;
  END;

  /**
   @brief Создать отчеты по всем регистрам
  */
  PRIVATE MACRO CreateReportByAll()
     CreateReportByKind( REPOREG_0507 );
     CreateReportByKind( REPOREG_0508 );
     CreateReportByKind( REPOREG_0511 );
     CreateReportByKind( REPOREG_0512 );
     CreateReportByKind( REPOREG_0513 );
     CreateReportByKind( REPOREG_0514 );
  END;

  /**
   @brief Вставить формулы итогов по новым регистрам
   @note  Изменение формул по замечаниям банка
  */
  PRIVATE MACRO GetFormulaSummREG_rshb()
    var i = 0, StrSumm = "", BeginRow, CellAddr;
     
    while( i < m_NumCellAutoSumm.Size )

        CellAddr = m_ReportTable.AddressDiapazon.GetCell( 0, NC( m_NumCellAutoSumm[i] ) );

        if( m_ReportTable.AddressDiapazon.GetNumbRow() > 0 )
          StrSumm = m_ReportTable.GetFormulaSummREG( CellAddr, null, m_ReportTable.bRowTable, m_ReportTable.bRowTable+m_ReportTable.AddressDiapazon.GetNumbRow()-1 );
        else
          StrSumm = "";
        end;

        if( m_FormulaSumm[i] == null ) /*для первой вкладки*/
          m_FormulaSumm[i] = "";
        elif( substr(StrSumm, 1,1) == "=" )
          StrSet( StrSumm, 1, "+" );
        end;
        m_FormulaSumm[i] = m_FormulaSumm[i] + StrSumm;
        i = i + 1;
    end;
  END;

  /**
   @brief Вставить формулы итогов
   @note По замечаниям ГПБ убрано наименование листа из формулы итогов
  */
  MACRO GetFormulaSumm()
    if((m_CopyAutoSumRange == null) or (m_CopyAutoSumRange == ""))
      GetFormulaSummREG();
    else
      GetFormulaSummREG_rshb();
    end;
  END;

  initSP_RepoRegBase( Form, TemplateName, UseCSV, IsWebService, ReportHashCode, UsePOI, FocreFormatRep );
  SetRowFlushCount(2000);
END;

/**
 @brief Запуск отчета по сделкам РЕПО
 @param[in] IsWebService - Флаг запуска из WEB
 @param[in] FormData - данные формы отчета (CTxReportForm)
 @param[in] ReportHashCode - хэш код отчета
 @param[in] menuItem - Класс меню WEB (WsMenuItem)
 @return Массив имен файлов отчета

 Запуск отчета по сделкам РЕПО с заданными параметрами в FormData
*/
MACRO ReportRunEx(
  IsWebService    : Bool
 ,FormData      //: CTxReportForm
 ,ReportHashCode  : Integer
 ,menuItem      //: WsMenuItem
)
  var stat = true;
  var FullReportFileNames = TArray();
   
  if( not IsWebService )
    RepoRegister_Form = SP_RepoReg_Panel();
  else
    if( ValType( FormData ) != V_UNDEF )
      RepoRegister_Form = WS_TX_RepoReg_Panel( FormData );
    else
      stat = false;
    end;
  end;

  while( stat )
    if( not IsWebService )
      stat = RepoRegister_Form.Run();
    end;

    if( stat )
      RepoRegister_Report = SP_RepoReg_Report_2014( null, "Report_TxRegisterREPO_2014.xlsx", true, IsWebService, ReportHashCode, POI_MODE, WINREP_FORMAT_XLSX );
      RepoRegister_Report.SetWebMenuItem(menuItem);
      RepoRegister_Report.Run();

      if( IsWebService )
        DL_CallInsertStat( RepoRegister_Report.PrintMode(), menuItem.iCaseItem, menuItem.iIdentProgram, menuItem.szNameItem );
        FullReportFileNames = RepoRegister_Report.GetFullReportFileNames();
        stat = false;
      else
        DL_CallInsertStat( RepoRegister_Report.PrintMode() );
      end;
    end;
  end;

  return FullReportFileNames;
END;
