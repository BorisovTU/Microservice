/** 
 @file nptxslice.mac
 @brief Функции для формирования среза 6-НДФЛ
  
 Функции для формирования среза 6-НДФЛ

 # tag 
 - functional_block:Налоги_НДР
 - code_type:API
 - BIQ-11355


 # changeLog 
 |date       |author         |tasks            |note                            
 |-----------|---------------|-----------------|--------------------------------
 |2024.07.05 |Фаршатов Г. К. |CCBO-4497        | Реализация функций             
 |           |               |                 |                   

*/ 

Import DPInter, SFInter;

CONST NPTXPIT6_2021 = 1; // Отчет 6-НДФЛ 2021
CONST NPTXPIT6_2022 = 2; // Отчет 6-НДФЛ 2022
CONST NPTXPIT6_2023 = 3; // Отчет 6-НДФЛ 2023
CONST NPTXPIT6_2024 = 4; // Отчет 6-НДФЛ 2024
CONST NPTXPIT6_2025 = 5; // Отчет 6-НДФЛ 2025

/**
 @brief Удалить срез данных
 @param[in] pSliceNumDel номер среза
 @param[in] pBeginDate дата начала среза
 @param[in] pEndDate дата окончания среза
 @return 0 - ошибка удаления среза
 @return 1 -  успешное удаление среза
*/
macro delSlice (pSliceNumDel:INTEGER, pBeginDate:DATE, pEndDate:DATE)
    var res = 0;
    var cmd = RsdCommand("begin ? := RSB_NDFLREG.delSlice (?, ?, ?); end;");
    
    cmd.addParam("res", RSDBP_OUT, V_INTEGER);
    cmd.addParam("", RSDBP_IN, pSliceNumDel );
    cmd.addParam("", RSDBP_IN, pBeginDate );
    cmd.addParam("", RSDBP_IN, pEndDate );
    
    SQL_Execute(cmd,"Выполняется удаление среза данных. Ждите...");
    res = cmd.value("res");

    return res;
end;

/**
 @brief Вставить срез данных
 @param[in] pSliceNum номер среза
 @param[in] pBeginDate дата начала среза
 @param[in] pEndDate дата окончания среза
 @param[in] pReportID идентификатор отчета
*/
macro insertSlice (pSliceNum:INTEGER, pBeginDate:DATE, pEndDate:DATE, pReportType:INTEGER)
    var cmd = RsdCommand("begin RSB_NDFLREG.insertSlice (?, ?, ?, ?); end;");
    
    cmd.addParam("", RSDBP_IN, pSliceNum );
    cmd.addParam("", RSDBP_IN, pBeginDate );
    cmd.addParam("", RSDBP_IN, pEndDate );
    cmd.addParam("", RSDBP_IN, pReportType );
    
    SQL_Execute(cmd,"Выполняется вставка среза данных. Ждите...");
end;

