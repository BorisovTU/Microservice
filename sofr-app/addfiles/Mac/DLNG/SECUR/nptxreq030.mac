/*
 $Name: nptxreq030.mac
 $Module: Ценные бумаги
 $Description: Сопровождение заявлений на возврат. Шаг ручной проверки
 */

import DealsInter, "nptxreqfun.mac";

macro ExecuteStep( doc, FDoc, DocKind, ID_Operation, ID_Step )
  var nptxop = TRecHandler("nptxop.dbt");
  var err = 0;
  var retTaxMain = $0, retTaxHigh = $0;
  var calcToRet = $0;
  
  SetBuff( nptxop, FDoc );

  if (GetTRUE(true,"Менять статус заявления на \"Проверено\" разрешено только в случае увеличения НОБ, "+
    "при котором сумма налога по заявлению больше рассчитанной суммы налога к возврату. Продолжить?"))
    DL_RslChangeNptxRetReq(nptxop.rec.Id, "Status", DLNPTXRETREQ_CHECKED);
  else
    err = 1;
  end;

  return err;
end;