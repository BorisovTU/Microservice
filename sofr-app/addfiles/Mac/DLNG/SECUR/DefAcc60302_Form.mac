/*
$Name:        DefAcc60301_Form.mac
$Module:      БО ЦБ
$Description: Форма для отчета Расшифровка по счету 60301
*/
import "DlRepForm_h.mac";

CONST PNFLD_REPDATE      = 0,
      PNFLD_TAX13        = 1,
      PNFLD_TAX15        = 2;

CONST H_PNFLD_DATE         = 100,
      H_PNFLD_TAX13        = 101,
      H_PNFLD_TAX15        = 102;

PRIVATE MACRO FldProc_Date( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT ) /*Установка значения в поле*/
    if( FldRealValue == null ) /*инициализация по умолчанию*/
      FldRealValue = {curdate};
    end;
    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) 
     FldRealValue = FldShowValue;
  elif( (Cmd == DLG_KEY) AND (Key == KEY_F3) )
    FldRealValue = GetDateByCalendar(FldRealValue);
    FldShowValue = FldRealValue;
  end;

  return CM_DEFAULT;
END;

CLASS (DL_CPanel) DefAcc60302_Panel()
  var BeginDate:date;
  var isTax13;
  var isTax15;
  var transferDate:date;

  PRIVATE MACRO Init()        
    AddFieldProc( 0, PNFLD_REPDATE,       H_PNFLD_DATE,          @FldProc_Date,           {curdate}  );
    AddFieldProc( 0, PNFLD_TAX13,         H_PNFLD_TAX13,         @DL_FldProc_CheckBox,    SET_CHAR);
    AddFieldProc( 0, PNFLD_TAX15,         H_PNFLD_TAX15,         @DL_FldProc_CheckBox,    SET_CHAR);
  END;

  PRIVATE MACRO GetFieldValue(fldNum:integer):variant
    var showValue:variant, fldValue:variant;

    GetFieldValue(fldNum, @showValue, @fldValue);
    return fldValue;
  END;

  MACRO Run()
    var stat = Run();

    BeginDate    = GetFieldValue(PNFLD_REPDATE);
    isTax13      = GetFieldValue(PNFLD_TAX13);
    isTax15      = GetFieldValue(PNFLD_TAX15);

    return stat;
  END;

  PRIVATE MACRO Check():BOOL
    if( (GetFieldValue(PNFLD_TAX13) == UNSET_CHAR) AND (GetFieldValue(PNFLD_TAX15) == UNSET_CHAR))
      MsgBox("Должен быть заполнен хотя бы один из признаков основная/повыш. ставка");
      return false;
    end;

    return true;
  END;

  initDL_CPanel("sp_rep.lbr", "DEC60302");
END;