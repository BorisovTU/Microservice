/*
$Name:        nptxhold050.mac
$Module:      Ценные бумаги
$Description: Операция удержания НДФЛ. Шаг "Заполнение полей заявления на возврат налога"
*/
IMPORT "secinter.mac", "nptxcalcfun.mac", "nptxreqfun.mac";

PRIVATE VAR Oper = TRecHandler( "nptxop.dbt" );

PRIVATE MACRO Error( ErrStr:STRING ):INTEGER
  DL_NPTX_PutMsg( ErrStr, 10 );
  MsgBox( ErrStr );
  return 1;
END;


MACRO ExecuteStep( DlDoc, FDoc, DocKind, ID_Operation, ID_Step )
  var query, cmd, DataSet;
  var stat = 0;

  Oper.SetRecordAddr( FDoc );

  stat = DL_NPTX_PutMsg( "Заполнение полей заявления на возврат налога" );
  if( not stat )
    CreateTaxMsg(Oper);

    DL_NPTX_SaveOperLog( Oper.rec.ID, 50 );
  end;

  return stat;
END;


/* Макрос постобработки */
MACRO PostStep (CommitOrRollback, /*1-выполнение шага,2 -отакат шага*/
                errTrn,        /* Статус выполнения шага-!0-произошла ошибка */
                FDoc,          /* Указатель на первичный документ */
                ID_Operation,  /* Номер экземпляра операции */
                Num_Step,      /* Номер шага операции(из настроек) */
                Kind_Operation,/* Вид операции */
                KindDoc,       /* Вид первичного документа */
                KindStep,      /* Вид шага операции */
                ID_Step)       /* Номер шага операции */
  
  if( errTrn OR (CommitOrRollback == 2) ) /* Произошла ошибка или происходит откат */ 
    return 0;
  end;

  Oper.SetRecordAddr( FDoc );
  SendTaxMsg(Oper, 50);
  
  return 0;

END;