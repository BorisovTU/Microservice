/*
$Name:        NPTXADJRES_form.mac
$Module:      Ценные бумаги
$Description: 
*/
import "nptxressumbudg_form.mac";

CONST PNFLD_NPTXADJRES_DATE             = 0,
      PNFLD_NPTXADJRES_PACKNUMB         = 1,
      PNFLD_NPTXADJRES_FIRSTNUM         = 2,
      PNFLD_NPTXADJRES_PROTOCOL         = 3;

PRIVATE CONST
  H_DATE             = 101,
  H_PACKNUMB         = 102,
  H_FIRSTNUM         = 103,
  H_PROTOCOL         = 104;

PRIVATE MACRO Default( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT )
    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) 
    FldRealValue = FldShowValue;
  end;
  return CM_DEFAULT;
END;

PRIVATE MACRO FldProc_Date( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT ) /*Установка значения в поле*/
    if( FldRealValue == null ) /*инициализация по умолчанию*/
      FldRealValue = date();
    end;
    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) 
     FldRealValue = FldShowValue;
  elif( (Cmd == DLG_KEY) AND (Key == KEY_F3) )
    FldRealValue = GetDateByCalendar(FldRealValue);
    FldShowValue = FldRealValue;
  end;

  return CM_DEFAULT;
END;


CLASS (DL_CPanel) Sp_NPTXADJRES_Panel()
  var m_Date;
  var m_PackNumb;
  var m_FirstNum;
  var m_IsProtocol; 

  PRIVATE MACRO Init()
     AddFieldProc( 0, PNFLD_NPTXADJRES_DATE,            H_DATE,             @FldProc_Date,            {curdate});
     AddFieldProc( 0, PNFLD_NPTXADJRES_PACKNUMB,        H_PACKNUMB,         @Default,                 GetNumberPackFromReg());
     AddFieldProc( 0, PNFLD_NPTXADJRES_FIRSTNUM,        H_FIRSTNUM,         @Default,                 1);
     AddFieldProc( 0, PNFLD_NPTXADJRES_PROTOCOL,        H_PROTOCOL,         @DL_FldProc_CheckBox,     SET_CHAR );
  END;

  PRIVATE MACRO Check():BOOL
    return true;
  END;

  MACRO Run()
    var stat = Run();

    m_Date             = GetFieldValue(PNFLD_NPTXADJRES_DATE);
    m_PackNumb         = GetFieldValue(PNFLD_NPTXADJRES_PACKNUMB);
    m_FirstNum         = GetFieldValue(PNFLD_NPTXADJRES_FIRSTNUM);
    m_IsProtocol       = IIF(GetFieldValue(PNFLD_NPTXADJRES_PROTOCOL) == SET_CHAR, true, false);

    return stat;
  END;

  initDL_CPanel( "txctrl.lbr", "nptxadjr" );
END;