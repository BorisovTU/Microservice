/*
$Name:         rtaiown010.mac 
$Module:       Ценные бумаги
$Description:  Операция погашения дополнительного дохода СЭБ. Шаг настройки операции
*/
import "spRetire.mac";

macro executeParamStep( kind_oper, BOf_kind, adr, ID_Operation, ID_Step )
  record  deal( dl_tick );
  var     Group, FD, TaxDepositoryMode;

  SetBuff( deal, adr ); 
  FD = SPFirstDoc( deal, null, true );

  Group = SP_GetOperationGroup (deal); 

  if(FD.tick.rec.flag1 == UNSET_CHAR)
    DefineOprDate( FD.GetKindDate(DATE_DEALDATE),        FD.DateArray[DATE_DEALDATE]   );
    DefineOprDate( FD.GetKindDate(DATE_DEALTRANSFER),    FD.DateArray[DATE_DEALTRANSFER]   );  // Дки (Дата переноса на счета "к исполнению")
    DefineOprDate( FD.GetKindDate(DATE_DEALSETAVOIRISS), FD.DateArray[DATE_DEALSETAVOIRISS] ); // Дп (Дата погашения факт.)
    DefineOprDate( FD.GetKindDate(DATE_DEALPAY),         FD.DateArray[DATE_DEALPAY]  );        // До (Дата платежа)
    DefineOprDate( FD.GetKindDate(DATE_DEALEEND),        maxDate(FD.DateArray[DATE_DEALPAY], FD.DateArray[DATE_DEALSETAVOIRISS]));
  else
    DefineOprDate( FD.GetKindDate(DATE_DEALDATE),        FD.DateArray[DATE_DEALDATE]   );
    DefineOprDate( FD.GetKindDate(DATE_DEALTRANSFER),    FD.DateArray[DATE_DEALDATE]   );  // Дки (Дата переноса на счета "к исполнению")
    DefineOprDate( FD.GetKindDate(DATE_DEALSETAVOIRISS), FD.DateArray[DATE_DEALDATE] ); // Дп (Дата погашения факт.)
    DefineOprDate( FD.GetKindDate(DATE_DEALPAY),         FD.DateArray[DATE_DEALDATE]  );        // До (Дата платежа)
    DefineOprDate( FD.GetKindDate(DATE_DEALEEND),        FD.DateArray[DATE_DEALDATE]  );
  end;

  if( ИнициализироватьОперациюПогашения( FD ) != 0 )
     return 1;
  end;

  return 0;
end;

