/**
  @file nptxsnobver040.mac
  @brief Шаг получение ответа от СНОБ

  #menu
  - БО ЦБ\Налоговый учет\НДФЛ\СНОБ\Операции технической сверки СНОБ

  #tag
  - functional_block: СНОБ
  - code_type: GUI
  - code_type: Operation
  - Сверка
  - Техническая сверка

  #link
  [BIQ-7294. Анализ. Техническая сверка] (https://sdlc.go.rshbank.ru/confluence/pages/viewpage.action?pageId=223940937)

  #changeLog
  |date      |author       |tasks    |note                                                             |
  |----------|-------------|---------|-----------------------------------------------------------------|
  |13.12.2023|Хромеев Д. С.|BOSS-1489|BOSS-48.9 СОФР. Реализация Технической сверки данных. Разработка.|
*/

import "nptxsnobverfun.mac";

/**
  @brief Сообщение об ошибке
  @param [in] ErrStr сообщение об ошибке
  @return 1 Чтобы показать, что возникла ошибка
*/
PRIVATE MACRO Error( ErrStr:STRING ):INTEGER
  DL_NPTX_PutMsg( ErrStr, 10 );
  MsgBox( ErrStr );
  return 1;
END;

MACRO ExecuteStep(doc, FDoc, DocKind, ID_Operation, ID_Step)
   var nptxsnobver = TRecHandler("nptxsnobver.dbt");
   var err = 0;

   SetBuff(nptxsnobver, FDoc);

   if (UpdateSnobverStatus(nptxsnobver, 3) != 0)
     err = Error( "Ошибка при обновлении статуса" );
   end;

   if( not InsertOprStatus(46501, 4)); //Установка статуса Документооборот = Закрытие
      err = Error( "Ошибка при установке статуса вида \"Документооборот\" операции" );
   end;

   return err;
END;