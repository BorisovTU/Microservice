/*
$Name:        settl042.mac
$Module:      Ценные бумаги
$Description: Операция Расчеты на ОРЦБ. Шаг - Пополнение клирингового счета.
*/
import "settl.mac";

/* Глобальная структура с данными для поплнения торгового счета (то, что вводится в панели поплнения счета))*/
PRIVATE VAR TorgAccData = TRecHandler( "dl_comm.dbt");
PRIVATE VAR MoneySourceBase:Integer; // Источник средств в первоначальной операции, при создании (не при изменении на шаге)

/*заполнение суммы "по умолчанию" в форме ввода параметров, вызываемой на данном шаге
  по умолчанию подставляется сумма последнего пополнения счёта на бирже, выполненного на шаге 40 "Пополнение счета на бирже".*/
PRIVATE MACRO CalcRestOnMarketAccounts()
   TorgAccData.rec.hidden_sum = СуммаПоследнегоПополненияСчётаНаБирже( TorgAccData, TorgAccData.rec.Currency ); 
   TorgAccData.rec.Currency_sum = СуммаПоследнегоПополненияСчётаНаБирже( TorgAccData, TorgAccData.rec.FIID ); 
END;

macro ExecuteStep( Doc, adr )

  if( not ПополнитьКлиринговыйСчет( Doc, TorgAccData) )
     return 1;
  end;

  return 0;
end;
