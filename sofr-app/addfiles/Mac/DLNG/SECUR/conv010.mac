/* Операция конвертации ц/б. 
   Шаг настройки операции */
import InsCarryDoc, "sp_categ.mac", "sp_car.mac", "SPQICheckOper.mac";

macro executeParamStep( kind_oper, BOf_kind, FDoc, ID_Operation, ID_Step )

  record  deal(dl_tick);
  var     FD;

  SetBuff( deal, FDoc ); 
  FD = SPFirstDoc( deal, false, true );

  DefineOprDate( FD.GetKindDate(DATE_CONVAVR_BEGIN),  FD.DateArray[DATE_CONVAVR_BEGIN] );
  DefineOprDate( FD.GetKindDate(DATE_CONVAVR_OUT),  FD.DateArray[DATE_CONVAVR_OUT] );

  if(ExistPlanGrDealBeforeDate(FD.dl_leg.rec.PFI, FD.DateArray[DATE_CONVAVR_BEGIN]) == true)
    msgbox( "В строках графиков исполнения сделок по обрабатываемой бумаге есть запланированные действия за более раннюю дату");
    return 1;
  end;  

  if(ПроверитьПринадлежностьКИ( FD ) == false)
     return 1;
  end;

  return 0;
end;
