/*
$Name:             txcheck_all_exec.mac
$Module:           БОЦБ 
$Description:      Проверка данных для репликации
*/
import RSD, txrepl_func;
import "ws_report.mac";
import "ws_txreportform.mac";

var SQL, rs, cmd1, OK = TRUE;

private var useprog = 42; // КОЛИЧЕСТВО ПРОВЕРОК
private var ProgressIndicator;
private var Rep:CMakeReport;
private var Header = 
"┌────────────────────────────────────────────────────────────────────────────────────────────────┐\n"+
"│                                                                                                │\n"+
"│                                         Результат проверки                                     │\n"+
"│                                                                                                │\n"+
"├────────────────────────────────────────────────────────────────────────────────────────────────┤";

private macro PrintLine(str1:String)
   Rep.AddPrintCell( str1, 0, 0, "c:ex_FZ(8)" );
   Rep.AddStr();
end;

private macro ExecuteSelect(SQL, ProgressValue, msg)
   private var cmd;

   Message(msg);

   cmd = RsdCommand(SQL);

   ProgressIndicator.Update(ProgressValue.Current,ProgressValue.Maximum, msg);

   Return RsdRecordSet(cmd);
end;

macro TxRunReportBeforeRepl(isWeb, FullReportFileNames: @FileContainer, MySessID:string)
  {WebID} = MySessID;
  
   var FullReportFileName = "";
   Rep = CMakeReport(Header);

   var ProgressValue = CTxProgressValue();
   ProgressValue.Maximum = useprog;// КОЛИЧЕСТВО ПРОВЕРОК
   ProgressValue.Current = 0;

   ProgressIndicator = CreateProgressIndicator(isWeb);
   ProgressIndicator.Start(ProgressValue.Maximum, "Обработка данных...");

   SQL = "         SELECT txp.t_partyid";
   SQL = SQL +  "   FROM DTXPARTY_DBT txp, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txp.t_action = 1";
   SQL = SQL +  "    AND txp.t_replstate = 0";
   SQL = SQL +  "    AND txp.t_partyid = txro.t_objectid";
   SQL = SQL +  "    AND txro.t_objecttype = 30";
   SQL = SQL +  "    AND txro.t_objstate != 2";
   
   ProgressValue.Current = 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Субъекты");
    
   while (rs.Movenext)
      OK = FALSE;
      printline("Субъект с данными ID не будет вставлен, т.к. он уже существует:"+ rs.Value(0));
   end;

   SQL = " SELECT txp.t_partyid ";
   SQL = SQL + "  FROM DTXPARTY_DBT txp ";
   SQL = SQL + " WHERE (txp.t_action = 2 OR txp.t_action = 3) AND txp.t_replstate = 0 ";
   SQL = SQL + "MINUS ";
   SQL = SQL + "(SELECT txro.t_objectid ";
   SQL = SQL + "   FROM DTXREPLOBJ_DBT txro ";
   SQL = SQL + "  WHERE txro.t_objecttype = 30 AND txro.t_objstate != 2 ";
   SQL = SQL + " UNION ";
   SQL = SQL + " SELECT p.t_partyid ";
   SQL = SQL + "   FROM DTXPARTY_DBT p ";
   SQL = SQL + "  WHERE p.t_action = 1 AND p.t_replstate = 0) ";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Субъекты");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Субъект с данным ID не будет обновлен или удален, т.к. его не существует:"+ rs.Value(0));
   end;
   
   SQL = " SELECT t_partyid";
   SQL = SQL +  "   FROM DTXPARTYKIND_DBT";
   SQL = SQL +  "  WHERE (t_action = 1 or t_action = 3) AND t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " ((SELECT txp.t_partyid";
   SQL = SQL +  "    FROM DTXPARTY_DBT txp";
   SQL = SQL +  "   WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "  UNION";
   SQL = SQL +  "  SELECT txro.t_objectid";
   SQL = SQL +  "    FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "   WHERE txro.t_objecttype = 30 AND txro.t_objstate != 2)";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " SELECT t_partyid";
   SQL = SQL +  "   FROM DTXPARTY_DBT";
   SQL = SQL +  "  WHERE t_action = 3 AND t_replstate = 0)";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Виды субъектов");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Для субъекта с ID = "+ rs.Value(0)+ " невозможно ничего сделать с видом - субъект не существует");
   end;
   
   SQL = " SELECT T_MARKEDID";
   SQL = SQL +  "   FROM DTXMARKSECT_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " ((SELECT txp.t_partyid";
   SQL = SQL +  "    FROM DTXPARTY_DBT txp";
   SQL = SQL +  "   WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "  UNION";
   SQL = SQL +  "  SELECT txro.t_objectid";
   SQL = SQL +  "    FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "   WHERE txro.t_objecttype = 30 AND txro.t_objstate != 2)";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " SELECT t_partyid";
   SQL = SQL +  "   FROM DTXPARTY_DBT";
   SQL = SQL +  "  WHERE t_action = 3 AND t_replstate = 0)";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Секторы биржи");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Для субъекта с ID = " + Trim(String(rs.Value(0):15:0)) + " невозможно вставить сектор - субъект не существует");
   end;
   
   SQL = " SELECT txs.T_MARKETSECTORID";
   SQL = SQL +  "   FROM DTXMARKSECT_DBT txs, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txs.t_action = 1";
   SQL = SQL +  "    AND txs.t_replstate = 0";
   SQL = SQL +  "    AND txs.T_MARKETSECTORID = txro.t_objectid";
   SQL = SQL +  "    AND txro.t_objecttype = 40";
   SQL = SQL +  "    AND txro.t_objstate != 2";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Секторы биржи");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Сектор биржи с данным ID не будет вставлен, т.к. он уже существует:"+ rs.Value(0));
   end;
   
   SQL = " SELECT txs.T_MARKETSECTORID";
   SQL = SQL +  "   FROM DTXMARKSECT_DBT txs";
   SQL = SQL +  "  WHERE (txs.t_action = 2 or txs.t_action = 3) AND txs.t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " (SELECT txro.t_objectid";
   SQL = SQL +  "    FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "   WHERE txro.t_objecttype = 40 AND txro.t_objstate != 2";
   SQL = SQL +  "  UNION ";
   SQL = SQL +  "  SELECT m.T_MARKETSECTORID ";
   SQL = SQL +  "    FROM DTXMARKSECT_DBT m ";
   SQL = SQL +  "    WHERE m.t_action = 1 AND m.t_replstate = 0) ";
   
     
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Секторы биржи");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Сектор биржи с данным ID не будет обновлен или удален, т.к. его не существует:"+ rs.Value(0));
   end;
   
   SQL = " SELECT txc.t_fiid";
   SQL = SQL +  "   FROM DTXCURRENCY_DBT txc, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txc.t_action = 1";
   SQL = SQL +  "    AND txc.t_replstate = 0";
   SQL = SQL +  "    AND txc.t_fiid = txro.t_objectid";
   SQL = SQL +  "    AND txro.t_objecttype = 10";
   SQL = SQL +  "    AND txro.t_objstate != 2";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Валюты");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Валюта с данным ID не будет вставлена, т.к. она уже существует:"+ rs.Value(0));
   end;
   
   SQL = " SELECT txc.t_fiid";
   SQL = SQL +  "   FROM DTXCURRENCY_DBT txc";
   SQL = SQL +  "  WHERE (txc.t_action = 2 or txc.t_action = 3) AND txc.t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " (SELECT txro.t_objectid";
   SQL = SQL +  "   FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txro.t_objecttype = 10 AND txro.t_objstate != 2";
   SQL = SQL +  " UNION ";
   SQL = SQL +  " SELECT txc.t_fiid ";
   SQL = SQL +  "   FROM DTXCURRENCY_DBT txc ";
   SQL = SQL +  "  WHERE txc.t_action = 1 AND txc.t_replstate = 0) ";
   
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Валюты");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Валюта с данным ID не будет обновлена или удалена, т.к. ее не существует:"+ rs.Value(0));
   end;

   SQL = " SELECT txa.T_AVOIRISSID";
   SQL = SQL +  "   FROM DTXAVOIRISS_DBT txa, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txa.t_action = 1";
   SQL = SQL +  "    AND txa.t_replstate = 0";
   SQL = SQL +  "    AND txa.T_AVOIRISSID = txro.t_objectid";
   SQL = SQL +  "    AND txro.t_objecttype = 20";
   SQL = SQL +  "    AND txro.t_objstate != 2";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Ценные бумаги");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Ценная бумага с данным ID не будет вставлена, т.к. она уже существует:"+ rs.Value(0));
   end;
   
   SQL = " SELECT txa.t_avoirissid ";
   SQL = SQL + "  FROM DTXAVOIRISS_DBT txa ";
   SQL = SQL + " WHERE (txa.t_action = 2 OR txa.t_action = 3) AND txa.t_replstate = 0 ";
   SQL = SQL + "MINUS ";
   SQL = SQL + "(SELECT txro.t_objectid ";
   SQL = SQL + "   FROM DTXREPLOBJ_DBT txro ";
   SQL = SQL + "  WHERE txro.t_objecttype = 20 AND txro.t_objstate != 2 ";
   SQL = SQL + " UNION ";
   SQL = SQL + " SELECT a.t_avoirissid ";
   SQL = SQL + "   FROM DTXAVOIRISS_DBT a ";
   SQL = SQL + "  WHERE a.t_action = 1 AND a.t_replstate = 0) ";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Ценные бумаги");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Ценная бумага с данным ID не будет обновлена или удалена, т.к. ее не существует:"+ Trim(String(rs.Value(0):11:0)));
   end;

   SQL = " SELECT distinct t_avoirissid, t_issuerid ";
   SQL = SQL +  "   FROM DTXAVOIRISS_DBT ";
   SQL = SQL +  "  WHERE t_issuerid IN ";
   SQL = SQL +  " (SELECT distinct txa.t_issuerid";
   SQL = SQL +  "              FROM DTXAVOIRISS_DBT txa";
   SQL = SQL +  "             WHERE (txa.t_action = 1 OR txa.t_action = 2)";
   SQL = SQL +  "               AND txa.t_replstate = 0";
   SQL = SQL +  "            MINUS";
   SQL = SQL +  "            ((SELECT txp.t_partyid";
   SQL = SQL +  "                FROM DTXPARTY_DBT txp";
   SQL = SQL +  "               WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "              UNION";
   SQL = SQL +  "              SELECT txro.t_objectid";
   SQL = SQL +  "                FROM DTXREPLOBJ_DBT txro" ;
   SQL = SQL +  "               WHERE txro.t_objecttype = 30 AND txro.t_objstate != 2)";
   SQL = SQL +  "             MINUS";
   SQL = SQL +  "             SELECT t_partyid";
   SQL = SQL +  "               FROM DTXPARTY_DBT";
   SQL = SQL +  "              WHERE t_action = 3 AND t_replstate = 1))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Ценные бумаги");
   
   while (rs.Movenext)
      OK = FALSE;
       printline("Для ценной бумаги с ID="+rs.value(0)+" не существует эмитента с ID="+ rs.Value(1));
   end;
   
   SQL = " SELECT a.t_avoirissid, a.t_facevaluefiid";
   SQL = SQL +  "   FROM DTXAVOIRISS_DBT a,";
   SQL = SQL +  "        (SELECT DISTINCT txa.t_facevaluefiid";
   SQL = SQL +  "                    FROM DTXAVOIRISS_DBT txa";
   SQL = SQL +  "                   WHERE (txa.t_action = 1 OR txa.t_action = 2)";
   SQL = SQL +  "                     AND txa.t_replstate = 0";
   SQL = SQL +  "         MINUS";
   SQL = SQL +  "         ((SELECT txc.t_fiid";
   SQL = SQL +  "             FROM DTXCURRENCY_DBT txc";
   SQL = SQL +  "            WHERE txc.t_action = 1 AND txc.t_replstate = 0";
   SQL = SQL +  "           UNION";
   SQL = SQL +  "           SELECT txro.t_objectid";
   SQL = SQL +  "             FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "            WHERE txro.t_objecttype = 10 AND txro.t_objstate != 2)";
   SQL = SQL +  "          MINUS";
   SQL = SQL +  "          SELECT t_fiid";
   SQL = SQL +  "            FROM DTXCURRENCY_DBT";
   SQL = SQL +  "           WHERE t_action = 3 AND t_replstate = 0)) u";
   SQL = SQL +  "  WHERE a.t_facevaluefiid = u.t_facevaluefiid and a.t_replstate = 0";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Ценные бумаги");

   while (rs.Movenext)
      OK = FALSE;
      printline("Для ценной бумаги с ID = " + Trim(String(rs.value(0):15:0)) + " не существует валюты номинала с ID = " + Trim(String(rs.Value(1):15:0)))
   end;
   
   SQL = " SELECT txs.T_WARRANTID";
   SQL = SQL +  "   FROM DTXFIWARNTS_DBT txs, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txs.t_action = 1";
   SQL = SQL +  "    AND txs.t_replstate = 0";
   SQL = SQL +  "    AND txs.T_WARRANTID = txro.t_objectid";
   SQL = SQL +  "    AND txs.t_type = 50";
   SQL = SQL +  "    AND txro.t_objecttype = 50";
   SQL = SQL +  "    AND txro.t_objstate != 2";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Купоны");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Купон с данным ID не будет вставлен, т.к. он уже существует = "+ rs.Value(0));
   end;
   
   
   SQL = " SELECT txs.T_WARRANTID";
   SQL = SQL +  "   FROM DTXFIWARNTS_DBT txs, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txs.t_action = 1";
   SQL = SQL +  "    AND txs.t_replstate = 0";
   SQL = SQL +  "    AND txs.T_WARRANTID = txro.t_objectid";
   SQL = SQL +  "    AND txs.t_type = 60";
   SQL = SQL +  "    AND txro.t_objecttype = 60";
   SQL = SQL +  "    AND txro.t_objstate != 2";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Амортизации");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Амортизация с данным ID не будет вставлена, т.к. она уже существует = "+ rs.Value(0));
   end;
   
   SQL = " SELECT distinct txs.T_WARRANTID";
   SQL = SQL +  "   FROM DTXFIWARNTS_DBT txs";
   SQL = SQL +  "  WHERE (txs.t_action = 2 or txs.t_action = 3) AND txs.t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " (SELECT txro.t_objectid";
   SQL = SQL +  "   FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txro.t_objecttype in (50, 60) AND txro.t_objstate != 2";
   SQL = SQL +  " UNION SELECT t_warrantid FROM DTXFIWARNTS_DBT WHERE t_action = 1 AND t_replstate = 0)";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Купоны/амортизации");

   while (rs.Movenext)
      OK = FALSE;
      printline("Купон/амортизация с данным ID не будет обновлен или удален+ т.к. его не существует = "+ Trim(String(rs.Value(0):11:0)));
   end;
   
   SQL = "select t_fiid, t_warrantid FROM DTXFIWARNTS_DBT WHERE t_replstate = 0 and t_fiid IN (";
   SQL = SQL +  " SELECT T_FIID";
   SQL = SQL +  "   FROM DTXFIWARNTS_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " ((SELECT txp.T_AVOIRISSID";
   SQL = SQL +  "    FROM DTXAVOIRISS_DBT txp";
   SQL = SQL +  "   WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "  UNION";
   SQL = SQL +  "  SELECT txro.t_objectid";
   SQL = SQL +  "    FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "   WHERE txro.t_objecttype = 20 AND txro.t_objstate != 2)";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " SELECT T_AVOIRISSID";
   SQL = SQL +  "   FROM DTXAVOIRISS_DBT";
   SQL = SQL +  "  WHERE t_action = 3 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Купоны/амортизации");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Для ценной бумаги с ID = " + Trim(String(rs.Value(0):15:0)) + " невозможно вставить купон/амортизацию c ID = " + Trim(String(rs.Value(1):15:0)) + " - ценная бумага не существует");
   end;
   
   SQL = " SELECT T_AVOIRISSID";
   SQL = SQL +  "   FROM DTXAVRATTR_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " ((SELECT txp.T_AVOIRISSID";
   SQL = SQL +  "    FROM DTXAVOIRISS_DBT txp";
   SQL = SQL +  "   WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "  UNION";
   SQL = SQL +  "  SELECT txro.t_objectid";
   SQL = SQL +  "    FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "   WHERE txro.t_objecttype = 20 AND txro.t_objstate != 2)";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " SELECT T_AVOIRISSID";
   SQL = SQL +  "   FROM DTXAVOIRISS_DBT";
   SQL = SQL +  "  WHERE t_action = 3 AND t_replstate = 0)";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Признаки ценной бумаги");

   while (rs.Movenext)
      OK = FALSE;
      printline("Для ценной бумаги с ID="+ rs.Value(0)+ " невозможно вставить признак - ценная бумага не существует");
   end;
   
   SQL = " SELECT DISTINCT t_avoirissid";
   SQL = SQL +  "            FROM DTXAVRCODE_DBT";
   SQL = SQL +  "           WHERE t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " ((SELECT txp.t_avoirissid";
   SQL = SQL +  "     FROM DTXAVOIRISS_DBT txp";
   SQL = SQL +  "    WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "   UNION";
   SQL = SQL +  "   SELECT txro.t_objectid";
   SQL = SQL +  "     FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "    WHERE txro.t_objecttype = 20 AND txro.t_objstate != 2)";
   SQL = SQL +  "  MINUS";
   SQL = SQL +  "  SELECT t_avoirissid";
   SQL = SQL +  "    FROM DTXAVOIRISS_DBT";
   SQL = SQL +  "   WHERE t_action = 3 AND t_replstate = 0)";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Коды ценной бумаги");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Для ценной бумаги с ID = " + rs.Value(0) + " невозможно вставить код - ценная бумага не существует");
   end;
   
   SQL = " SELECT a.t_avoirissid, a.t_marketid";
   SQL = SQL +  "   FROM DTXAVRCODE_DBT a,";
   SQL = SQL +  "        (SELECT DISTINCT t_marketid";
   SQL = SQL +  "                    FROM DTXAVRCODE_DBT";
   SQL = SQL +  "                   WHERE t_replstate = 0";
   SQL = SQL +  "         MINUS";
   SQL = SQL +  "         ((SELECT txp.t_partyid";
   SQL = SQL +  "             FROM DTXPARTY_DBT txp";
   SQL = SQL +  "            WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "           UNION";
   SQL = SQL +  "           SELECT txro.t_objectid";
   SQL = SQL +  "             FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "            WHERE txro.t_objecttype = 30 AND txro.t_objstate != 2)";
   SQL = SQL +  "          MINUS";
   SQL = SQL +  "          SELECT t_partyid";
   SQL = SQL +  "            FROM DTXPARTY_DBT";
   SQL = SQL +  "           WHERE t_action = 3 AND t_replstate = 0)) u";
   SQL = SQL +  "  WHERE a.t_replstate = 0 and a.t_marketid = u.t_marketid";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Коды ценной бумаги");

   while (rs.Movenext)
      OK = FALSE;
      printline("Для ценной бумаги с ID = " + Trim(String(rs.Value(0):15:0)) + " невозможно вставить код - не существует субъект с ID = " + Trim(String(rs.Value(1):15:0)));
   end;
   
   SQL = " SELECT txc.t_courseid";
   SQL = SQL +  "   FROM DTXCOURSE_DBT txc, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txc.t_action = 1";
   SQL = SQL +  "    AND txc.t_replstate = 0";
   SQL = SQL +  "    AND txc.t_courseid = txro.t_objectid";
   SQL = SQL +  "    AND txc.t_type = txro.t_subobjnum";
   SQL = SQL +  "    AND txro.t_objecttype = 70";
   SQL = SQL +  "    AND txro.t_objstate != 2";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Курсы");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Невозможно вставить курс с ID"+ rs.Value(0)+ " курс уже существует");
   end;
   
   SQL = " SELECT txc.t_courseid";
   SQL = SQL +  "   FROM DTXCOURSE_DBT txc";
   SQL = SQL +  "  WHERE (txc.t_action = 2 or txc.t_action = 3) AND txc.t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " (SELECT txro.t_objectid";
   SQL = SQL +  "   FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txro.t_objecttype = 70 AND txro.t_objstate != 2";
   SQL = SQL +  " UNION ";
   SQL = SQL +  " SELECT txc.t_courseid ";
   SQL = SQL +  "   FROM DTXCOURSE_DBT txc ";
   SQL = SQL +  "  WHERE txc.t_action = 1 AND txc.t_replstate = 0) ";
   
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Курсы");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Невозможно обновить или удалить курс с ID"+ rs.Value(0)+ " курс не существует");
   end;
   
   SQL = " UPDATE DTXCOURSE_DBT";
   SQL = SQL +  "    SET t_replstate = 0";
   SQL = SQL +  "  WHERE t_replstate = 2";
   
   //cmd1 = RsdCommand(SQL);
   //cmd1.execute;

   SQL = " UPDATE DTXCOURSE_DBT";
   SQL = SQL +  "    SET t_replstate = 2";
   SQL = SQL +  "  WHERE t_replstate = 0 and t_courseid IN (";
   SQL = SQL +  "           SELECT t_courseid";
   SQL = SQL +  "             FROM DTXCOURSE_DBT";
   SQL = SQL +  "            WHERE t_basefiid IN (";
   SQL = SQL +  "                     SELECT DISTINCT t_basefiid";
   SQL = SQL +  "                                FROM DTXCOURSE_DBT";
   SQL = SQL +  "                               WHERE t_basefiid IS NOT NULL AND t_basefiid > 0 and t_replstate = 0";
   SQL = SQL +  "                     MINUS";
   SQL = SQL +  "                     (SELECT DISTINCT t_objectid";
   SQL = SQL +  "                                 FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "                                WHERE t_objecttype IN (10, 20)";
   SQL = SQL +  "                                  AND t_objstate != 2";
   SQL = SQL +  "                      UNION";
   SQL = SQL +  "                      SELECT DISTINCT t_avoirissid";
   SQL = SQL +  "                                 FROM DTXAVOIRISS_DBT";
   SQL = SQL +  "                                WHERE t_action = 1 AND t_replstate = 0";
   SQL = SQL +  "                      UNION";
   SQL = SQL +  "                      SELECT DISTINCT t_fiid";
   SQL = SQL +  "                                 FROM DTXCURRENCY_DBT";
   SQL = SQL +  "                                WHERE t_action = 1 AND t_replstate = 0)))";
   
   //cmd1 = RsdCommand(SQL);
   //cmd1.execute;
   
   SQL = " SELECT t_courseid, t_basefiid";
   SQL = SQL +  "   FROM DTXCOURSE_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0 and t_basefiid IN (";
   SQL = SQL +  "           SELECT DISTINCT t_basefiid";
   SQL = SQL +  "                      FROM DTXCOURSE_DBT";
   SQL = SQL +  "                     WHERE t_basefiid IS NOT NULL AND t_basefiid > 0 and t_replstate = 0";
   SQL = SQL +  "           MINUS";
   SQL = SQL +  "           (SELECT DISTINCT t_objectid";
   SQL = SQL +  "                       FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "                      WHERE t_objecttype IN (10, 20) AND t_objstate != 2";
   SQL = SQL +  "            UNION";
   SQL = SQL +  "            SELECT DISTINCT t_avoirissid";
   SQL = SQL +  "                       FROM DTXAVOIRISS_DBT";
   SQL = SQL +  "                      WHERE t_action = 1 AND t_replstate = 0";
   SQL = SQL +  "            UNION";
   SQL = SQL +  "            SELECT DISTINCT t_fiid";
   SQL = SQL +  "                       FROM DTXCURRENCY_DBT";
   SQL = SQL +  "                      WHERE t_action = 1 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Курсы");
   
   while (rs.Movenext)
      OK = FALSE;
      printline ("Для курса с ID = " + Trim(String(rs.Value(0):15:0)) + " не найден базовый ФИ с ID = " + Trim(String(rs.Value(1):15:0)));
   end;

   SQL = " SELECT t_courseid, t_fiid";
   SQL = SQL +  "   FROM DTXCOURSE_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0";
   SQL = SQL +  "    AND (   (t_basefikind = 20 AND t_fiid != 0)";
   SQL = SQL +  "         OR (t_basefikind = 10 AND t_fiid = 0)";
   SQL = SQL +  "        )";
   SQL = SQL +  "    AND t_fiid IN (";
   SQL = SQL +  "           SELECT DISTINCT t_fiid";
   SQL = SQL +  "                      FROM DTXCOURSE_DBT";
   SQL = SQL +  "                     WHERE t_fiid IS NOT NULL AND t_basefikind = 10";
   SQL = SQL +  "           MINUS";
   SQL = SQL +  "           (SELECT DISTINCT t_objectid";
   SQL = SQL +  "                       FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "                      WHERE t_objecttype = 10 AND t_objstate != 2";
   SQL = SQL +  "            UNION";
   SQL = SQL +  "            SELECT DISTINCT t_fiid";
   SQL = SQL +  "                       FROM DTXCURRENCY_DBT";
   SQL = SQL +  "                      WHERE t_action = 1 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Курсы");
   
   while (rs.Movenext)
      OK = FALSE;
      printline ("Для курса с ID = " + Trim(String(rs.Value(0):15:0)) + " не найден котируемый ФИ с ID = " + Trim(String(rs.Value(1):15:0)));
   end;
   
   SQL = " SELECT t_courseid, t_ratedate, t_marketid";
   SQL = SQL +  "   FROM DTXCOURSE_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0 and t_marketid IN (";
   SQL = SQL +  "           SELECT DISTINCT txa.t_marketid";
   SQL = SQL +  "                      FROM DTXCOURSE_DBT txa";
   SQL = SQL +  "                     WHERE (txa.t_action = 1 OR txa.t_action = 2)";
   SQL = SQL +  "                       AND txa.t_replstate = 0";
   SQL = SQL +  "                       AND txa.t_marketid != -1";
   SQL = SQL +  "           MINUS";
   SQL = SQL +  "           ((SELECT txp.t_partyid";
   SQL = SQL +  "               FROM DTXPARTY_DBT txp";
   SQL = SQL +  "              WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "             UNION";
   SQL = SQL +  "             SELECT txro.t_objectid";
   SQL = SQL +  "               FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "              WHERE txro.t_objecttype = 30 AND txro.t_objstate != 2)";
   SQL = SQL +  "            MINUS";
   SQL = SQL +  "            SELECT t_partyid";
   SQL = SQL +  "              FROM DTXPARTY_DBT";
   SQL = SQL +  "             WHERE t_action = 3 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Курсы");

   while (rs.Movenext)
      OK = FALSE;
      printline ("Для курса с ID = " + Trim(String(rs.Value(0):15:0)) + " за дату " + DateStamp(rs.Value(1)) + " не найдена торговая площадка с ID = " + Trim(String(rs.Value(2):15:0)));
   end;
   
   SQL = " SELECT txp.T_DEALID";
   SQL = SQL +  "   FROM DTXDEAL_DBT txp, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txp.t_action = 1";
   SQL = SQL +  "    AND txp.t_replstate = 0";
   SQL = SQL +  "    AND txp.T_DEALID = txro.t_objectid";
   SQL = SQL +  "    AND txro.t_objecttype = 80";
   SQL = SQL +  "    AND txro.t_objstate != 2";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Сделка с данным ID не будет вставлена, т.к. она уже существует:"+ rs.Value(0));
   end;
   
   SQL = " SELECT t_dealid";
   SQL = SQL +  "   FROM DTXDEAL_DBT";
   SQL = SQL +  "  WHERE (t_action = 2 OR t_action = 3) AND t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " (SELECT t_objectid";
   SQL = SQL +  "    FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "   WHERE t_objecttype = 80 AND t_objstate != 2";
   SQL = SQL +  "  UNION";
   SQL = SQL +  "  SELECT t_dealid";
   SQL = SQL +  "    FROM DTXDEAL_DBT";
   SQL = SQL +  "   WHERE t_action = 1 AND t_replstate = 0)";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Сделка с данным ID не будет обновлена или удалена, т.к. ее не существует:"+ String(rs.Value(0):11:0));
   end;

   SQL = " SELECT t_dealid, t_marketid";
   SQL = SQL +  "   FROM DTXDEAL_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0 and t_marketid IN (";
   SQL = SQL +  "           SELECT distinct t_marketid";
   SQL = SQL +  "             FROM DTXDEAL_DBT";
   SQL = SQL +  "            WHERE t_marketid IS NOT NULL";
   SQL = SQL +  "           MINUS";
   SQL = SQL +  "           (SELECT t_objectid";
   SQL = SQL +  "              FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "             WHERE t_objecttype = 30 AND t_objstate != 2";
   SQL = SQL +  "            UNION";
   SQL = SQL +  "            SELECT t_partyid";
   SQL = SQL +  "              FROM DTXPARTY_DBT";
   SQL = SQL +  "             WHERE t_action = 1 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("У сделки с ID = "+ rs.Value(0)+ " не найдена биржа с ID = "+ rs.value(1));
   end;
   
   SQL = " SELECT t_dealid, t_partyid";
   SQL = SQL +  "   FROM DTXDEAL_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0 and t_partyid IN (";
   SQL = SQL +  "           SELECT distinct t_partyid";
   SQL = SQL +  "             FROM DTXDEAL_DBT";
   SQL = SQL +  "            WHERE t_partyid IS NOT NULL";
   SQL = SQL +  "           MINUS";
   SQL = SQL +  "           (SELECT t_objectid";
   SQL = SQL +  "              FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "             WHERE t_objecttype = 30 AND t_objstate != 2";
   SQL = SQL +  "            UNION";
   SQL = SQL +  "            SELECT t_partyid";
   SQL = SQL +  "              FROM DTXPARTY_DBT";
   SQL = SQL +  "             WHERE t_action = 1 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("У сделки с ID = "+ String(rs.Value(0):11:0)+ " не найден контрагент с ID = "+ Trim(String(rs.value(1):11:0)));
   end;

   SQL = " SELECT t_dealid, t_brokerid";
   SQL = SQL +  "   FROM DTXDEAL_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0 and t_brokerid IN (";
   SQL = SQL +  "           SELECT distinct t_brokerid";
   SQL = SQL +  "             FROM DTXDEAL_DBT";
   SQL = SQL +  "            WHERE t_brokerid IS NOT NULL and t_brokerid > 0";
   SQL = SQL +  "           MINUS";
   SQL = SQL +  "           (SELECT t_objectid";
   SQL = SQL +  "              FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "             WHERE t_objecttype = 30 AND t_objstate != 2";
   SQL = SQL +  "            UNION";
   SQL = SQL +  "            SELECT t_partyid";
   SQL = SQL +  "              FROM DTXPARTY_DBT";
   SQL = SQL +  "             WHERE t_action = 1 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("У сделки с ID = "+ rs.Value(0)+ " не найден брокер с ID = "+ rs.value(1));
   end;
   
   SQL = " SELECT t_dealid, t_sector";
   SQL = SQL +  "   FROM DTXDEAL_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0 and t_sector IN (";
   SQL = SQL +  "           SELECT distinct t_sector";
   SQL = SQL +  "             FROM DTXDEAL_DBT";
   SQL = SQL +  "            WHERE t_sector IS NOT NULL AND t_sector > 0";
   SQL = SQL +  "           MINUS";
   SQL = SQL +  "           (SELECT t_subobjnum";
   SQL = SQL +  "              FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "             WHERE t_objecttype = 40 AND t_objstate != 2";
   SQL = SQL +  "            UNION";
   SQL = SQL +  "            SELECT t_marketsectorid";
   SQL = SQL +  "              FROM DTXMARKSECT_DBT";
   SQL = SQL +  "             WHERE t_action = 1 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("У сделки с ID = "+ rs.Value(0)+ " не найден сектор биржи с ID = "+ rs.value(1));
   end;

   SQL = "   SELECT t_dealid, T_AVOIRISSID";
   SQL = SQL +  "     FROM DTXDEAL_DBT";
   SQL = SQL +  "    WHERE t_replstate = 0 and T_AVOIRISSID in";
   SQL = SQL +  "                  (SELECT DISTINCT txa.T_AVOIRISSID";
   SQL = SQL +  "                              FROM DTXDEAL_DBT txa";
   SQL = SQL +  "                             WHERE (txa.t_action = 1 OR txa.t_action = 2)";
   SQL = SQL +  "                               AND txa.t_replstate = 0";
   SQL = SQL +  "                   MINUS";
   SQL = SQL +  "                   ((SELECT txp.T_AVOIRISSID";
   SQL = SQL +  "                       FROM DTXAVOIRISS_DBT txp";
   SQL = SQL +  "                      WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "                     UNION";
   SQL = SQL +  "                     SELECT txro.t_objectid";
   SQL = SQL +  "                       FROM DTXREPLOBJ_DBT txro ";
   SQL = SQL +  "                      WHERE txro.t_objecttype = 20";
   SQL = SQL +  "                        AND txro.t_objstate != 2)";
   SQL = SQL +  "                    MINUS";
   SQL = SQL +  "                    SELECT T_AVOIRISSID";
   SQL = SQL +  "                      FROM DTXAVOIRISS_DBT ";
   SQL = SQL +  "                     WHERE t_action = 3 AND t_replstate = 0))";
   SQL = SQL +  "           AND T_AVOIRISSID != 0";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("У сделки с ID = "+ rs.Value(0)+ " не найдена ценная бумага с ID = "+ rs.value(1));
   end;
   
   SQL = " SELECT d.t_dealid, d.t_warrantid";
   SQL = SQL +  "     FROM DTXDEAL_DBT d,(SELECT distinct t_warrantid";
   SQL = SQL +  "               FROM DTXDEAL_DBT";
   SQL = SQL +  "              WHERE t_warrantid IS NOT NULL";
   SQL = SQL +  "                            and t_warrantid != 0";
   SQL = SQL +  "             MINUS";
   SQL = SQL +  "             (SELECT t_objectid";
   SQL = SQL +  "                FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "               WHERE t_objecttype = 50 AND t_objstate != 2";
   SQL = SQL +  "              UNION";
   SQL = SQL +  "              SELECT t_warrantid";
   SQL = SQL +  "                FROM DTXFIWARNTS_DBT";
   SQL = SQL +  "               WHERE t_action = 1 AND t_replstate = 0)) u ";
   SQL = SQL +  "    WHERE d.t_replstate = 0 and d.t_warrantid = u.t_warrantid";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("У сделки с ID = "+ rs.Value(0)+ " не найден купон с ID = "+ rs.value(1));
   end;

   SQL = " SELECT d.t_dealid, d.t_partialid";
   SQL = SQL +  "   FROM DTXDEAL_DBT d,";
   SQL = SQL +  "        (SELECT DISTINCT t_partialid";
   SQL = SQL +  "                    FROM DTXDEAL_DBT";
   SQL = SQL +  "                   WHERE t_partialid IS NOT NULL AND t_partialid != 0";
   SQL = SQL +  "         MINUS";
   SQL = SQL +  "         (SELECT t_objectid";
   SQL = SQL +  "            FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "           WHERE t_objecttype = 60 AND t_objstate != 2";
   SQL = SQL +  "          UNION";
   SQL = SQL +  "          SELECT t_warrantid";
   SQL = SQL +  "            FROM DTXFIWARNTS_DBT";
   SQL = SQL +  "           WHERE t_action = 1 AND t_replstate = 0)) u";
   SQL = SQL +  "  WHERE d.t_replstate = 0 and d.t_partialid = u.t_partialid";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("У сделки с ID = " + Trim(String(rs.value(0):15:0)) + " не найдена амортизация с ID = " + Trim(String(rs.value(1):15:0)));
   end;
   
   SQL = " SELECT t_dealid, t_currencyid";
   SQL = SQL +  "   FROM DTXDEAL_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0 and t_currencyid =";
   SQL = SQL +  "           (SELECT DISTINCT txa.t_currencyid";
   SQL = SQL +  "                       FROM DTXDEAL_DBT txa";
   SQL = SQL +  "                      WHERE (txa.t_action = 1 OR txa.t_action = 2)";
   SQL = SQL +  "                        AND txa.t_replstate = 0";
   SQL = SQL +  "            MINUS";
   SQL = SQL +  "            ((SELECT txp.t_fiid";
   SQL = SQL +  "                FROM DTXCURRENCY_DBT txp";
   SQL = SQL +  "               WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "              UNION";
   SQL = SQL +  "              SELECT txro.t_objectid";
   SQL = SQL +  "                FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "               WHERE txro.t_objecttype = 10 AND txro.t_objstate != 2)";
   SQL = SQL +  "             MINUS";
   SQL = SQL +  "             SELECT t_fiid";
   SQL = SQL +  "               FROM DTXCURRENCY_DBT";
   SQL = SQL +  "              WHERE t_action = 3 AND t_replstate = 0))";
   SQL = SQL +  "    AND t_currencyid != NULL";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Сделки");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("У сделки с ID="+ rs.Value(0)+ " не найдена валюта с ID="+ rs.value(1));
   end;

   SQL = " SELECT txp.T_DEMANDID";
   SQL = SQL +  "   FROM DTXDEMAND_DBT txp, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txp.t_action = 1";
   SQL = SQL +  "    AND txp.t_replstate = 0";
   SQL = SQL +  "    AND txp.T_DEMANDID = txro.t_objectid";
   SQL = SQL +  "    AND txro.t_objecttype = 90";
   SQL = SQL +  "    AND txro.t_objstate != 2 and txro.T_SUBOBJNUM not in (81, 82)";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Требования/обязательства");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Требование/обязательство с данным ID не будет вставлено, т.к. оно уже существует:" + String(rs.Value(0):15:0));
   end;
   
   SQL = " SELECT txp.T_DEMANDID";
   SQL = SQL +  "   FROM DTXDEMAND_DBT txp";
   SQL = SQL +  "  WHERE (txp.t_action = 2 or txp.t_action = 3) AND txp.t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " (SELECT txro.t_objectid";
   SQL = SQL +  "   FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txro.t_objecttype = 90 AND txro.t_objstate != 2";
   SQL = SQL +  "  UNION SELECT t_DEMANDID from DTXDEMAND_DBT where t_action=1 and T_REPLSTATE = 0) ";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Требования/обязательства");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Требование/обязательство с данным ID не будет обновлено или удалено, т.к. его не существует:"+ String(rs.Value(0):11:0));
   end;
   
   SQL = "  SELECT t_demandid, t_dealid";
   SQL = SQL +  "    FROM DTXDEMAND_DBT";
   SQL = SQL +  "   WHERE t_replstate = 0 and t_dealid IN (";
   SQL = SQL +  "            SELECT distinct t_dealid";
   SQL = SQL +  "              FROM DTXDEMAND_DBT";
   SQL = SQL +  "             WHERE t_dealid IS NOT NULL";
   SQL = SQL +  "                    and t_dealid > 0";
   SQL = SQL +  "            MINUS";
   SQL = SQL +  "            (SELECT t_objectid";
   SQL = SQL +  "               FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "              WHERE t_objecttype = 80 AND t_objstate != 2";
   SQL = SQL +  "             UNION";
   SQL = SQL +  "             SELECT t_dealid";
   SQL = SQL +  "               FROM DTXDEAL_DBT";
   SQL = SQL +  "              WHERE t_action = 1 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Требования/обязательства");

   while (rs.Movenext)
      OK = FALSE;
      printline("Для требования/обязательства с ID = " + Trim(String(rs.Value(0):15:0)) + " не найдена сделка с ID = " + Trim(String(rs.value(1):15:0)));
   end;
   
   SQL = " SELECT t_demandid, t_paycurrencyid";
   SQL = SQL +  "   FROM DTXDEMAND_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0 and t_paycurrencyid =";
   SQL = SQL +  "           (SELECT DISTINCT txa.t_paycurrencyid";
   SQL = SQL +  "                       FROM DTXDEMAND_DBT txa";
   SQL = SQL +  "                      WHERE (txa.t_action = 1 OR txa.t_action = 2)";
   SQL = SQL +  "                        AND txa.t_replstate = 0";
   SQL = SQL +  "            MINUS";
   SQL = SQL +  "            ((SELECT txp.t_fiid";
   SQL = SQL +  "                FROM DTXCURRENCY_DBT txp";
   SQL = SQL +  "               WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "              UNION";
   SQL = SQL +  "              SELECT txro.t_objectid";
   SQL = SQL +  "                FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "               WHERE txro.t_objecttype = 10 AND txro.t_objstate != 2)";
   SQL = SQL +  "             MINUS";
   SQL = SQL +  "             SELECT t_fiid";
   SQL = SQL +  "               FROM DTXCURRENCY_DBT";
   SQL = SQL +  "              WHERE t_action = 3 AND t_replstate = 0))";
   SQL = SQL +  "    AND t_paycurrencyid != NULL";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Требования/обязательства");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Для требования/обязательства с ID="+ rs.Value(0)+ " не найдена валюта оплаты с ID="+ rs.value(1));
   end;
   
   SQL = " SELECT txp.T_COMISSID";
   SQL = SQL +  "   FROM DTXCOMISS_DBT txp, DTXREPLOBJ_DBT txro";
   SQL = SQL +  "  WHERE txp.t_action = 1";
   SQL = SQL +  "    AND txp.t_replstate = 0";
   SQL = SQL +  "    AND txp.T_COMISSID = txro.t_objectid";
   SQL = SQL +  "    AND txro.t_objecttype = 100";
   SQL = SQL +  "    AND txro.t_objstate != 2";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Комиссии");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Комиссия с данным ID не будет вставлена, т.к. она уже существует:"+ rs.Value(0));
   end;

   SQL = " SELECT txp.T_COMISSID";
   SQL = SQL +  "   FROM DTXCOMISS_DBT txp";
   SQL = SQL +  "  WHERE (txp.t_action = 2 or txp.t_action = 3) AND txp.t_replstate = 0";
   SQL = SQL +  " MINUS";
   SQL = SQL +  " (SELECT txro.t_objectid";
   SQL = SQL +  "   FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "   WHERE txro.t_objecttype = 100 AND txro.t_objstate != 2";
   SQL = SQL +  "  UNION";
   SQL = SQL +  "   SELECT T_COMISSID";
   SQL = SQL +  "   FROM DTXCOMISS_DBT";
   SQL = SQL +  "   WHERE DTXCOMISS_DBT.t_action = 1 AND DTXCOMISS_DBT.t_replstate = 0)";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Комиссии");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Комиссия с данным ID не будет обновлена или удалена, т.к. ее не существует:"+ rs.Value(0));
   end;
   
   SQL = "   SELECT t_comissid, t_dealid";
   SQL = SQL +  "     FROM DTXCOMISS_DBT";
   SQL = SQL +  "    WHERE t_replstate = 0 and t_dealid IN (";
   SQL = SQL +  "             SELECT distinct t_dealid";
   SQL = SQL +  "               FROM DTXCOMISS_DBT";
   SQL = SQL +  "              WHERE t_dealid IS NOT NULL";
   SQL = SQL +  "                            and t_dealid > 0";
   SQL = SQL +  "             MINUS";
   SQL = SQL +  "             (SELECT t_objectid";
   SQL = SQL +  "                FROM DTXREPLOBJ_DBT";
   SQL = SQL +  "               WHERE t_objecttype = 80 AND t_objstate != 2";
   SQL = SQL +  "              UNION";
   SQL = SQL +  "              SELECT t_dealid";
   SQL = SQL +  "                FROM DTXDEAL_DBT";
   SQL = SQL +  "               WHERE t_action = 1 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Комиссии");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Для комиссии с ID = " + Trim(String(rs.Value(0):15:0)) + " не найдена сделка с ID = " + Trim(String(rs.value(1):15:0)));
   end;

   SQL = " SELECT t_comissid, T_CURRENCYID";
   SQL = SQL +  "   FROM DTXCOMISS_DBT";
   SQL = SQL +  "  WHERE t_replstate = 0 and T_CURRENCYID =";
   SQL = SQL +  "           (SELECT DISTINCT txa.T_CURRENCYID";
   SQL = SQL +  "                       FROM DTXCOMISS_DBT txa";
   SQL = SQL +  "                      WHERE (txa.t_action = 1 OR txa.t_action = 2)";
   SQL = SQL +  "                        AND txa.t_replstate = 0";
   SQL = SQL +  "            MINUS";
   SQL = SQL +  "            ((SELECT txp.T_FIID";
   SQL = SQL +  "                FROM DTXCURRENCY_DBT txp";
   SQL = SQL +  "               WHERE txp.t_action = 1 AND txp.t_replstate = 0";
   SQL = SQL +  "              UNION";
   SQL = SQL +  "              SELECT txro.t_objectid";
   SQL = SQL +  "                FROM DTXREPLOBJ_DBT txro";
   SQL = SQL +  "               WHERE txro.t_objecttype = 10 AND txro.t_objstate != 2)";
   SQL = SQL +  "             MINUS";
   SQL = SQL +  "             SELECT T_FIID";
   SQL = SQL +  "               FROM DTXCURRENCY_DBT";
   SQL = SQL +  "              WHERE t_action = 3 AND t_replstate = 0))";
   
   ProgressValue.Current = ProgressValue.Current + 1;
   rs = ExecuteSelect(SQL, ProgressValue, "Комиссии");
   
   while (rs.Movenext)
      OK = FALSE;
      printline("Для комиссии с ID="+ rs.Value(0)+ " не найдена валюта с ID="+ rs.value(1));
   end;
   
   ProgressIndicator.Stop();
   
   if (OK)
      printline("Проверка прошла успешно");
   end;

   if (isWeb) 
      FullReportFileName = WebReportGenerator(Rep).Generate(true);
   else   
      Rep.PrintWinRep();
      Rep.ShowWinRep();
      Rep.PrintRep();
   end;

   FullReportFileNames = PackWebReport(FullReportFileName);

end;
