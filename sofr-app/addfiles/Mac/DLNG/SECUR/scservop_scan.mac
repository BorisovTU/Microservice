/*                           
$Name:             scservop_scan.mac
$Module:           Ценные бумаги
$Description:      Сервисные операции (операции сопровождения)
*/
import "scservop.mac";

/*Используется только при массовом удалении/перводе в отложенные (Action != 0).
  При массовом выполнении исп. та же ф-я, что и при единичном (Action == 0)
  Action == 0 - массовое выполнение (эта ф-я не использ.)
  Action == 1 - массовое удаление 
  Action == 2 - массовый перевод в отложенные*/
private const Ошибка = 0,
              Первый = 1,
              Последний = 2;

MACRO Печать_ОтчетСканирования( Вызов, firstdoc, Статус, Сообщение, Action )

//   if( Action == 0 ) return; end;
    
   setbuff( ScOprServDoc, firstdoc );

   if( Вызов==Первый )
      if( Action == 1 )  
         Сообщение = "Отчет о массовом удалении сервисных операций."
      elif( Action == 2 ) 
         Сообщение = "Отчет о массовом переводе в отложенные сервисных операций."
      end;

      if( Action != 0 )
[               #
+--------+--------+------------------------------------------------------------+
|   Код  |№ ошибки|                 Сообщение                                  |
|операции|        |                                                            |
+--------+--------+------------------------------------------------------------+]
(Сообщение);
      end;

   elif( Вызов == Ошибка )
      if( Статус == 0 ) 
         if( Action == 1 )  
            Сообщение = "Операция удалена."
         elif( Action == 2 ) 
            Сообщение = "Операция переведена в отложенные."
         elif( Action == 0 ) 

           ScOpIsServiceOper = false;

           if(not ExecMacroFile("spordres.mac", "Print_MemOrder", firstdoc))
              MsgBox("Ошибка при печати протокола резервирования по срочным сделкам");
           end;

           ScOpIsServiceOper = true;

         end;
      elif( Сообщение == "" )
         if( Action == 1 )  
            Сообщение = "Ошибка при удалении."
         elif( Action == 2 ) 
            Сообщение = "Ошибка при переводе в отложенные."
         end;
      end;

      if( Action != 0 )

[|########|########|############################################################|]
( ScOprServDoc.CommCode, Статус, Сообщение );
      end;

   elif( Вызов==Последний )  
      if( Action != 0 )
[+--------+--------+------------------------------------------------------------+];
      end;
   end;

END;
