/*   
$Name:             PaidCouponIncome_Form.mac
$Module:           Ядро Securities
$Description:      Панель "Реестр выплаченных купонных доходов"
*/
import "DlRepForm_h.mac", "dlmisc.mac";

// Номера полей в форме отчета
CONST
    PNFLD_COUPINC_START         = 0,
    PNFLD_COUPINC_END           = 1,
    PNFLD_COUPINC_ISSCODE       = 2,
    PNFLD_COUPINC_ISSNAME       = 3,
    PNFLD_COUPINC_APOSTR        = 4,
    PNFLD_WEEKREP_EXCEL         = 5;

CLASS DlCoupPanelData(pStartDate:date, pEndDate:date, pIssCode:string, pIssName:string, pApostrophe:string, pExcel:string)
    var startDate:date, endDate:date,
        issCode:string, issName: string,  // Ценная бумага
        apostrophe:string,                // С апострофами
        excel:string;                     // отчет Excel

    macro SetValues(pStartDate:date, pEndDate:date, pissCode:string, pissName:string, pApostrophe:string, pexcel:string)  
        startDate  = pStartDate;
        endDate    = pEndDate;
        issCode    = pissCode;
        issName    = pissName;
        apostrophe = pApostrophe;
        excel      = pexcel;
    end;

    private MACRO __init(pStartDate:date, pEndDate:date, pissCode:string, pIssName:string, pApostrophe:string, pExcel:string)
        pStartDate = IIF(ValType(pStartDate) != V_UNDEF, pStartDate, {curdate});
        pEndDate = IIF(ValType(pEndDate) != V_UNDEF, pEndDate, {curdate});
        pIssCode = IIF(ValType(pIssCode) != V_UNDEF, pIssCode, "");
        pIssName = IIF(ValType(pIssName) != V_UNDEF, pIssName, "");
        pApostrophe = IIF(ValType(pApostrophe) != V_UNDEF, pApostrophe, "X");
        pExcel      = IIF(ValType(pExcel) != V_UNDEF, pExcel, "X");

        SetValues(pStartDate, pEndDate, pissCode, pIssName, pApostrophe, pExcel);       
    END;
         
    __init(pStartDate, pEndDate, pissCode, pIssName, pApostrophe, pExcel);
END;
 
private VAR coupPanelData = DlCoupPanelData( /*NULL, NULL, NULL, NULL, NULL, NULL*/ );

PRIVATE CONST
  DL_PNFLD_APOSTR     = 101,
  DL_PNFLD_EXCEL      = 102;

// Инициализация
CLASS (DL_CPanel) DlCoupInc_Panel()

    private MACRO Init()
        AddFieldProc( 0, PNFLD_COUPINC_START,   DL_PNFLD_BEGINDATE, @DL_FldProc_BeginDate, coupPanelData.startDate);
        AddFieldProc( 0, PNFLD_COUPINC_END,     DL_PNFLD_ENDDATE,   @DL_FldProc_EndDate,   coupPanelData.endDate);
        AddFieldProc( 0, PNFLD_COUPINC_ISSCODE, DL_PNFLD_AVRCODE,   @DL_FldProc_AvrCode,   coupPanelData.issCode);
        AddFieldProc( 0, PNFLD_COUPINC_ISSNAME, DL_PNFLD_AVRNAME,   @DL_FldProc_AvrName,   coupPanelData.issName);        
        AddFieldProc( 0, PNFLD_COUPINC_APOSTR,  DL_PNFLD_APOSTR,    @DL_FldProc_CheckBox,  coupPanelData.apostrophe); 
        AddFieldProc( 0, PNFLD_WEEKREP_EXCEL,   DL_PNFLD_EXCEL,     @DL_FldProc_CheckBox,  coupPanelData.excel); 
    END;

    private MACRO Check() : bool
        return (GetFieldValue(PNFLD_WEEKREP_EXCEL) == "X") ;
    END;

    initDL_CPanel( "dlrep.lbr", "DLCOUPIN" );
END;



