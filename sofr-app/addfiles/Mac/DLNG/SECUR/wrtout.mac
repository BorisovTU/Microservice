/****************************************************************************************
 FILE         :   wrtavr.mac
 DESCRIPTION  :   RS-Bank 
 PROGRAMMED BY:   Nikolskaya V.
 CREATION DATE:   Oct 2011
*****************************************************************************************/
IMPORT BankInter, OprInter, RsbDataSet;
/*используется в сишнике*/
macro SP_IsExistsSuchPeriod( PtrDlComm:MEMADDR )
  var dlcomm = TRecHandler("dl_comm.dbt");
  var ret = 0;
  var DataQuery, Query;

  dlcomm.SetRecordAddr( PtrDlComm );

  Query = RSDCommand("SELECT COUNT(1) NRec "+
                     "  FROM ddl_comm_dbt comm "+
                     " WHERE comm.t_DocKind = ? "+
                     "   AND ((comm.t_BeginDate <= ? "+
                     "         AND comm.t_EndDate >= ?)"+
                     "       or(comm.t_BeginDate <= ?"+
                     "         AND comm.t_EndDate >= ?)"+
                     "       or(comm.t_BeginDate > ?"+
                     "         AND comm.t_EndDate < ?)"+
                     "       or "+
                     "       (comm.t_CommDate > ? "+
                     "        AND comm.t_BeginDate <= ?)"+
                     "       )");

  Query.addParam( "", RSDBP_IN, dlcomm.rec.DocKind );
  Query.addParam( "", RSDBP_IN, dlcomm.rec.BeginDate );
  Query.addParam( "", RSDBP_IN, dlcomm.rec.BeginDate );
  Query.addParam( "", RSDBP_IN, dlcomm.rec.EndDate );
  Query.addParam( "", RSDBP_IN, dlcomm.rec.EndDate );
  Query.addParam( "", RSDBP_IN, dlcomm.rec.BeginDate );
  Query.addParam( "", RSDBP_IN, dlcomm.rec.EndDate );
  Query.addParam( "", RSDBP_IN, dlcomm.rec.CommDate );
  Query.addParam( "", RSDBP_IN, dlcomm.rec.CommDate );

  Query.execute();
  DataQuery = TRsbDataSet(Query);

  if( DataQuery.MoveNext() AND (DataQuery.NRec > 0) )
      ret = 1;
  end;

  return ret;
end;
