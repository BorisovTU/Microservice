//SecurOTCMatchRequestsWDealsUI.mac
import oralib, "commonutil.mac";

private macro StartProcess()
  CaptureOutput();
  [
  begin
    secur_deals_utils.math_otc_requests_w_deals(po_cnt_all            => :po_cnt_all,
                                                po_cnt_too_many_deals => :po_cnt_too_many_deals,
                                                po_cnt_not_found_deal => :po_cnt_not_found_deal,
                                                po_cnt_success        => :po_cnt_success);
  end;
  ];
  var query = StopCaptureOutput();
  var params = TArray();
  params(params.size) = SqlParam("po_cnt_all",            V_INTEGER, RSDBP_OUT);
  params(params.size) = SqlParam("po_cnt_too_many_deals", V_INTEGER, RSDBP_OUT);
  params(params.size) = SqlParam("po_cnt_not_found_deal", V_INTEGER, RSDBP_OUT);
  params(params.size) = SqlParam("po_cnt_success",        V_INTEGER, RSDBP_OUT);

  ExecSql(query, params);

  println("Вего обработано: " + params.value(0).value);
  println("Найдено несколько возможных сделок на одну заявку: " + params.value(1).value);
  println("Не найдено сделок на заявку: " + params.value(2).value);
  println("Успешно: " + params.value(3).value);
end;

StartProcess()