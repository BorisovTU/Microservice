/*
$Name:         rtaiown020.mac
$Module:       Ценные бумаги
$Description:  Операция погашения дополнительного дохода СЭБ. Шаг "Расчет погашения"
*/

import "spretownfun.mac";

macro ExecuteStep( Doc, FDoc, DocKind, ID_Operation, ID_Step )
   record deal(dl_tick);
   var FD, dat;
   var SumComiss = $0, SumNDS = $0;

   SetBuff( deal, FDoc );
   FD = SPFirstDoc ( deal, false );

   dat = FD.tick.rec.DealDate;
    
   if((FD.ExistRqPayIncome()) and (FD.tick.rec.Flag1 == UNSET_CHAR))
     if(УстановитьСтатусТО(FD.GetRQ(DLRQ_TYPE_PAYINCOME), DLRQ_STATE_FORPROCESSING, dat) != 0)
       return 1;
     end;
   end;
/*DAN закрываем график */
   if(DL_UpdateGrDealAcc( FD.tick.rec.BOfficeKind, FD.tick.rec.DealID, FD.tick.rec.PFI, DLGR_TEMPL_EXECOWN, DLGR_ACCKIND_BACKOFFICE, date(0,0,0), DLGRACC_STATE_FACTEXEC) != 0 )
     return 1;
   end;

  
   return 0;
end;
