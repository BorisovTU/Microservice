/*
$Name:        nptxcalc101.mac
$Module:      Ценные бумаги
$Description: Запрос СНОБ для операций расчета НОБ
*/
IMPORT "secinter.mac", "nptxcalcfun.mac", "dlcontrsc.mac";

PRIVATE VAR Oper = TRecHandler( "nptxop.dbt" );

PRIVATE MACRO Error( ErrStr:STRING ):INTEGER
  DL_NPTX_PutMsg( ErrStr, 10 );
  MsgBox( ErrStr );
  return 1;
END;

macro ExecuteStep( kind_oper, FDoc, DocKind, ID_Operation, ID_Step )
  record nptxop("nptxop");
  var ErrStr = "";
  var err = 0;

  SetBuff( nptxop, FDoc );

  err = STB_ExecuteGetAmountSNOBOnStep(nptxop.DocKind, nptxop.ID, nptxop.Client, nptxop.OperDate, ID_Operation, ID_Step, @ErrStr, IIF(nptxop.IIS == SET_CHAR, true, false));
  if(ErrStr)
    Error(ErrStr);
  end;

  return err;
end;
