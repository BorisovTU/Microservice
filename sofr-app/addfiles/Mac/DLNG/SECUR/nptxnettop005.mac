/*
 $Name: nptxnettop005.mac
 $Module: Ценные бумаги
 $Description: Операция зачета удержанного НДФЛ. Шаг "Инициализация"
 */

import DealsInter, "nptxstbfun.mac";

PRIVATE MACRO Error( ErrStr:STRING ):INTEGER
  DL_NPTX_PutMsg( ErrStr, 10 );
  MsgBox( ErrStr );
  return 1;
END;

macro ExecuteStep( doc, FDoc, DocKind, ID_Operation, ID_Step )
  var err = 0;
  var nptxop = TRecHandler("nptxop.dbt");
  var query, cmd;

  SetBuff( nptxop, FDoc );

  if( not InsertOprStatus(46491, 4)) //Установить ДО = Зачет
     err = Error( "Ошибка при установке статуса вида \"Документооборот\" операции" );        
  end;

  DL_NPTX_SaveOperLog( nptxop.rec.ID, ID_Step );

  return err;
end;
