/* Операция займа
   шаг перерегистрации ц/б */
import "sp_class.mac", "sp_carcm.mac";

macro ExecuteStep( doc, FDoc)

  record deal(dl_tick);
  var    FD, OldNKD, OldIncome, pmobj, dat;

  SetBuff( deal, FDoc ); 

  FD = SPFirstDoc( deal );
  dat = FD.DateArray[DATE_DEALSETAVOIRISS];

  if( ИзменитьДатуПоставки( FD, dat ) != 0 )
     return 1;
  end;

  if( dat > FD.DateArray[DATE_DEALEEND] ) /*Переинитить дату завершения сделки*/
     if( not OprReplanStepPlanDates( FD.GetKindDate(DATE_DEALEEND), dat ) )
        msgbox("Ошибка при попытке переинициализировать дату завершения операции." );         
        return 1;
     end;
  end;

  return 0;
end;
