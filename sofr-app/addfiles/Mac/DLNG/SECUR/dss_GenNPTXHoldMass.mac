/**
  @file dss_GenNPTXHOLDMass.mac
  @brief Генерация операций удержания НДФЛ с типом "Окончание года" (BOSS-254)

  #link
   - [BOSS-187.5_Автоматический запуск операции "Удержание НДФЛ" с типом "Окончание года" после работы планировщика] (https://sdlc.go.rshbank.ru/confluence/pages/viewpage.action?pageId=176095112)

  #changeLog
  |date      |author       |tasks    |note                                                                                                          |
  |----------|-------------|---------|--------------------------------------------------------------------------------------------------------------|
  |25.12.2023|Хромеев Д. С.|BOSS-1896|Автоматический запуск операции "Удержание НДФЛ" с типом "Окончание года" после работы планировщика. Разработка|
  
*/

import "spserv.mac", "SimpleService.mac", "err_handl.mac";

/**
  @brief Генерация операций удержания НДФЛ и создание задания для FUNCOBJ через планировщик (dss_sheduler_dbt)
*/
MACRO GenNPTXHoldMass()
   var TaxYear, Mon;

   DateSplit({curdate}, NULL, Mon, TaxYear);
   if(Mon < 3)
      TaxYear = TaxYear - 1;
   end;
   ExecMacroFile("genholdopendyear.mac","GenerateHoldTaxOpEndYear", TaxYear, {curdate}, SET_CHAR);
   return SsExecResult(SS_RESPONSE_END);
onError(err)
   return SsExecResult(SS_RESPONSE_FATAL, GetFullErrorMessage(err));
END;