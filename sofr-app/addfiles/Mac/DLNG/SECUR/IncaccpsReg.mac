 /*******************************************************************************
 DESCRIPTION  :   Отчет "Доходы в виде начисленных процентов"
 PROGRAMMED BY:   Chernov Anton 14-01-2008
*******************************************************************************/
import "incaccps.mac";

/* Отчет "Доходы и расходы от реализации ц/б гос. и муниципальных ц\б" */
PRIVATE CLASS (DL_CReportTemplate) SP_TxReg81_Report( _Department:integer,
                                                      _Period:integer, 
                                                      _Year:integer,
                                                      _AvrKind:integer,
                                                      _CirculateInMarket:bool,
                                                      _NotCirculateInMarket:bool,
                                                      _NominateInRUR:bool,
                                                      _NotNominateInRUR:bool, 
                                                      _AvrID:integer, 
                                                      _IsBackRepo:bool,
                                                      _PrintMode:integer)
  PRIVATE VAR m_SheetCount = 0,
              Department           = _Department,
              Period               = _Period, 
              Year                 = _Year,
              AvrKind              = _AvrKind,
              CirculateInMarket    = _CirculateInMarket,
              NotCirculateInMarket = _NotCirculateInMarket,
              NominateInRUR        = _NominateInRUR,
              NotNominateInRUR     = _NotNominateInRUR, 
              AvrID                = _AvrID, 
              IsBackRepo           = _IsBackRepo,
              v_PrintMode          = _PrintMode;

  PRIVATE MACRO PrintMode():INTEGER
     return v_PrintMode;
  END;

  PRIVATE MACRO BeginReport( NumCopy:INTEGER )
     m_SheetCount = 0;
  END;

  PRIVATE MACRO ExecuteReport( ObjReport:OBJECT )
    /* сначала запускаем 8-1 */
    ReportRun( this,
               Department,
               Period,
               Year,
               true,
               AvrKind,
               false,
               CirculateInMarket,
               NotCirculateInMarket,
               NominateInRUR,
               NotNominateInRUR,
               AvrID,
               IsBackRepo );
  END;

  PRIVATE MACRO Create()
    ExecuteReport();
  END;

  initDL_CReportTemplate( NULL, "Report_TXIncaccps81.xls" );
END;


/* Отчет "Доходы и расходы от реализации ц/б (кроме гос. и муниципальных ц\б)" */
PRIVATE CLASS (DL_CReportTemplate) SP_TxReg82_Report( _Department:integer,
                                                      _Period:integer, 
                                                      _Year:integer,
                                                      _CirculateInMarket:bool,
                                                      _NotCirculateInMarket:bool,
                                                      _NominateInRUR:bool,
                                                      _NotNominateInRUR:bool, 
                                                      _AvrID:integer, 
                                                      _IsBackRepo:bool,
                                                      _PrintMode:integer)
  PRIVATE VAR m_SheetCount = 0,
              Department           = _Department,
              Period               = _Period, 
              Year                 = _Year,
              CirculateInMarket    = _CirculateInMarket,
              NotCirculateInMarket = _NotCirculateInMarket,
              NominateInRUR        = _NominateInRUR,
              NotNominateInRUR     = _NotNominateInRUR, 
              AvrID                = _AvrID, 
              IsBackRepo           = _IsBackRepo,
              v_PrintMode          = _PrintMode;

  PRIVATE MACRO PrintMode():INTEGER
     return v_PrintMode;
  END;

  PRIVATE MACRO BeginReport( NumCopy:INTEGER )
     m_SheetCount = 0;
  END;

  PRIVATE MACRO ExecuteReport( ObjReport:OBJECT )
    ReportRun( this,
               Department,
               Period,
               Year,
               false,
               -1,
               true,
               CirculateInMarket,
               NotCirculateInMarket,
               NominateInRUR,
               NotNominateInRUR,
               AvrID,
               IsBackRepo );
  END;

  PRIVATE MACRO Create()
    ExecuteReport();
  END;

  initDL_CReportTemplate( NULL, "Report_TXIncaccps81.xls" );
END;



VAR RepForm = SP_TxReg8_Panel(),
    GosRep,
    NGosRep;

while( RepForm.Run() )
  /* сначала запускаем 8-1 */
  if( RepForm.GetFieldValue( PNFLD_INCACCPS_REG_GOS ) == true )
    GosRep = SP_TxReg81_Report( RepForm.GetFieldValue( PNFLD_INCACCPS_REG_DEPCODE ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_PERIOD ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_YEAR ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_AVRKIND ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_CIRCINMARKET ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_NOTCIRCINMARKET ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_NOMINRUR ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_NOMINCUR ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_AVRCODE ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_BACKREPO ),
                                RepForm.GetFieldValue( PNFLD_INCACCPS_REG_PRINTMETHOD ) );
    GosRep.Run();
  end;

  if( RepForm.GetFieldValue( PNFLD_INCACCPS_REG_NOTGOS ) == true )
    /* затем запускаем 8-2 */
    NGosRep = SP_TxReg82_Report( RepForm.GetFieldValue( PNFLD_INCACCPS_REG_DEPCODE ),
                                 RepForm.GetFieldValue( PNFLD_INCACCPS_REG_PERIOD ),
                                 RepForm.GetFieldValue( PNFLD_INCACCPS_REG_YEAR ),
                                 RepForm.GetFieldValue( PNFLD_INCACCPS_REG_CIRCINMARKET ),
                                 RepForm.GetFieldValue( PNFLD_INCACCPS_REG_NOTCIRCINMARKET ),
                                 RepForm.GetFieldValue( PNFLD_INCACCPS_REG_NOMINRUR ),
                                 RepForm.GetFieldValue( PNFLD_INCACCPS_REG_NOMINCUR ),
                                 RepForm.GetFieldValue( PNFLD_INCACCPS_REG_AVRCODE ),
                                 RepForm.GetFieldValue( PNFLD_INCACCPS_REG_BACKREPO ),
                                 RepForm.GetFieldValue( PNFLD_INCACCPS_REG_PRINTMETHOD ) );
    NGosRep.Run();
  end;
end;

Exit(1);
