/*******************************************************************************
 FILE         :   spretfw.mac 
 COPYRIGHT    :   R-Style, 2001
 DESCRIPTION  :   RS-Bank, БО ЦБ, макрос обслуживания массовых действий 
                  над операциями распределения погашений
 PROGRAMMED BY:   IL 06.10.03
*******************************************************************************/
import Globals;

private record tklnk(dl_tklnk);
private file f_tklnk(dl_tklnk) key 4;
private file Party(party);
private file sfcontr(sfcontr);
private file Retire(dl_tick);

PRIVATE MACRO Печать_ОтчетСканирования( Вызов, firstdoc, Статус, Сообщение, Action )
     var Client = "", Contract = "", RetCode = "", StrAction = "";

     setbuff( tklnk, firstdoc );
     if( Action == 0 )
        StrAction = "создании операций погашения"
     elif( Action == 1 )
        StrAction = "удалении операций распределения"
     end;

     if (Вызов==1)
[             Отчет о массовом #########################################################
 +-------------------+-------------------+-------+------------------------------------------------------------+
 |      Клиент       |      Договор      |№ошибки|                 Сообщение                                  |
 |                   |                   |       |                                                            |
 +-------------------+-------------------+-------+------------------------------------------------------------+]
(StrAction);

     elif( Вызов == 0 )  
        if( Статус == 0 ) 
           if( Action == 0 )

              ClearRecord(f_tklnk);
              f_tklnk.Id = tklnk.Id;
              if( GetEQ(f_tklnk) )
                 ClearRecord(Retire);
                 Retire.DealID = f_tklnk.ChildID;
                 if( GetEQ(Retire) )
                    RetCode = Retire.DealCode;
                 end;
              end;
              Сообщение = "Cоздана отложенная операция погашения " + RetCode;
           elif( Action == 1 )
              Сообщение = "Операция распределения погашения удалена успешно";
           end;
        end;         

        ClearRecord(Party);
        Party.PartyID = tklnk.ClientID;

        if( GetEQ(Party) )
           Client = Party.ShortName;
        end;

        ClearRecord(sfcontr);
        sfcontr.ID = tklnk.ClientContrID;

        if( GetEQ(sfcontr) )
           Contract = sfcontr.Number;
        end;
[|###################|###################|#######|############################################################|]
(Client,Contract,Статус,Сообщение);
     elif (Вызов==2)            
[+-------------------+-------------------+-------+------------------------------------------------------------+];
     end;
END;
