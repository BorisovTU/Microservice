/*
$Name:        nptxshrep.mac
$Module:      ñ•≠≠Î• °„¨†£®
$Description: é‚Á•‚ "ê•£®·‚‡ ØÆ ™Æ‡Æ‚™®¨ ØÆß®Ê®Ô¨" (çÑîã)
*/

IMPORT "nptxshrep_form.mac", "RegistrReport.mac";

PRIVATE CONST ë‚‡Æ™†_à‚Æ£Æ                = 0,
              ë‚‡Æ™†_ë‚‡Æ™†Ñ†≠≠ÎÂ         = 1;

PRIVATE VAR ReportHeader =
"Ä≠†´®‚®Á•·™®© ‡•£®·‚‡ §´Ô ‡†·Á•‚† çÑîã ØÆ ™Æ‡Æ‚™®¨ ØÆß®Ê®Ô¨\n" +
"ß† Ø•‡®Æ§ · ########## ØÆ ##########\n" +
"É‡„ØØ† ≠†´Æ£Æ¢Æ£Æ „Á•‚†: #################################################################\n" +
"Ç®§ Ê/°:                 #################################################################\n" +
"ÇÎØ„·™ Ê/°:              #################################################################\n" +
"à≠¢•·‚Æ‡:                #################################################################\n";

PRIVATE VAR TableHeader =
"⁄ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒø\n" +
"≥            ≥          ≥           ≥                      ≥   äÆ§    ≥   çÆ¨•‡   ≥   Ñ†‚†   ≥   Ñ†‚†   ≥   Ñ†‚†   ≥   Ñ†‚†   ≥äÆ´®Á•·‚¢Æ ≥    ñ•≠†    ≥Ç†´Ó‚†≥Ç†´Ó‚†≥ ä„‡· ñÅêî ≥äÆÌ‰‰®Ê®•≠‚≥      ë‚Æ®¨Æ·‚Ï ‡•†´®ß†Ê®®      ≥      çäÑ ØÆ´„Á•≠≠Î© Ø‡®        ≥     êÎ≠ÆÁ≠†Ô Ê•≠† ØÆ ·§•´™• ‡•†´®ß†Ê®®     ≥   ë„¨¨†    ≥ äÆ¨®··®Ô,  ≥  çÆ¨•‡   ≥   Ñ†‚†   ≥   Ñ†‚†   ≥   Ñ†‚†   ≥    ñ•≠†    ≥Ç†´Ó‚†≥Ç†´Ó‚†≥ ä„‡· ñÅêî ≥äÆÌ‰‰®Ê®•≠‚≥    ë‚Æ®¨Æ·‚Ï Ø‡®Æ°‡•‚•≠®Ô      ≥      çäÑ ØÆ´„Á•≠≠Î© Ø‡®        ≥        êÎ≠ÆÁ≠†Ô Ê•≠† ØÆ ·§•´™• Ø‡®Æ°‡•‚•≠®Ô           ≥å†‚•‡®†´Ï≠†Ô≥  ç†´Æ£ ≠†  ≥ è‡•¢ÎË•≠®• ≥ äÆ¨®··®Ô,   ≥ è‡ÆÊ•≠‚≠Î© ≥ î®≠†≠·Æ¢Î© ≥   ë„¨¨†    ≥              çÆ¨®≠†´ Ê•≠≠Æ© °„¨†£®             ≥    Ñ†‚†    ≥    Ñ†‚†    ≥   ñ•≠†     ≥     Ñ†‚† Ø•‡•™¢†´®‰®™†Ê®®      ≥ äÆ≠‚‡†£•≠‚≥ äÆ≠‚‡†£•≠‚≥ç†´Æ-≥  ë‚†¢™†   ≥   é°È†Ô   ≥\n" +
"≥  à≠¢•·‚Æ‡  ≥  ë‚†‚„·  ≥  äÆ§ Ê/°  ≥ ÇÎØ„·™ Ê•≠≠Æ© °„¨†£® ≥  ¢†´Ó‚Î  ≥   ·§•´™®  ≥ ß†™‡Î‚®Ô ≥ß†™´ÓÁ•≠®Ô≥ Ø•‡•ÂÆ§† ≥ØÆ´„Á•≠®Ô ≥°„¨†£, Ë‚. ≥ ‡•†´®ß†Ê®® ≥ Ê•≠Î ≥‡†·Á•-≥  ≠† §†‚„  ≥ Ø•‡•·Á•‚† ≥                                ≥          ‡•†´®ß†Ê®®            ≥                                            ≥ Æ‚™´Æ≠•≠®Ô ≥ „Ø´†Á•≠≠†Ô ≥  ·§•´™®  ≥ß†™´ÓÁ•≠®Ô≥ Ø•‡•ÂÆ§† ≥  ÆØ´†‚Î  ≥Ø‡®Æ°‡•‚•≠®Ô≥ Ê•≠Î ≥‡†·Á•-≥  ≠† §†‚„  ≥ Ø•‡•·Á•‚† ≥                                ≥         Ø‡®Æ°‡•‚•≠®®           ≥                                                       ≥   ¢Î£Æ§†   ≥¨†‚•‡®†´Ï≠„Ó≥   ·„¨¨Î    ≥ „Ø´†Á•≠≠†Ô  ≥   §ÆÂÆ§    ≥ ‡•ß„´Ï‚†‚, ≥≠†´Æ£ÆÆ°´Æ- ≥                                                ≥ ØÆ£†Ë•≠®Ô  ≥   ¢ÎØ„·™†  ≥ ‡†ß¨•È•≠®Ô ≥       ·§•´™® êÖèé/á†©¨†        ≥ ØÆ ·§•´™• ≥ ØÆ ·§•´™• ≥£Æ¢†Ô≥≠†´Æ£ÆÆ°´†-≥  ·‚†¢™†   ≥\n" +
"≥            ≥          ≥           ≥                      ≥ ≠Æ¨®≠†´† ≥‡•†´®ß†Ê®® ≥ ™Æ‡Æ‚™Æ© ≥  ·§•´™®  ≥   Ø‡†¢†  ≥  ·‡•§·‚¢ ≥           ≥  ¢ ¢†´Ó‚•  ≥·§•´™®≥ ‚Æ¢  ≥ ØÆ´„Á•≠®Ô ≥ ®ß ¢†´Ó‚Î ≥                                ≥                                ≥                                            ≥‰†™‚®Á•·™Æ© ≥    Ø‡®     ≥Ø‡®Æ°‡•‚•-≥  ·§•´™®  ≥   Ø‡†¢†  ≥ØÆ  ·§•´™•≥  ¢ ¢†´Ó‚•  ≥·§•´™®≥ ‚Æ¢  ≥  ÆØ´†‚Î   ≥ ®ß ¢†´Ó‚Î ≥                                ≥                                ≥                                                       ≥            ≥   ¢Î£Æ§„   ≥ØÆ™„Ø™® ≠†§ ≥    Ø‡®      ≥  ØÆ Ê/°    ≥    ‡„°.    ≥   ¶•≠®Ô    ≥                                                ≥ Æ°´®£†Ê®®  ≥ Æ°´®£†Ê®®  ≥ Æ°´®£†Ê®®, ≥                                ≥‡•†´®ß†Ê®® ≥Ø‡®Æ°‡•‚•- ≥£‡„Ø-≥   ¶•≠®Ô   ≥≠†´Æ£ÆÆ°´†-≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥ ØÆß®Ê®®  ≥    ≠†    ≥ ·Æ°·‚¢-‚®≥    Æ‚    ≥           ≥Ê•≠Î ·§•´™® ≥‡•†´®-≥·§•´™®≥  ¢Î‡„Á™®  ≥    Ê•≠Î   ≥                                ≥                                ≥                                            ≥¢Î‡„Á™® ≠®¶•≥ ‡•†´®ß†Ê®®,≥   ≠®Ô    ≥    ≠†    ≥ ·Æ°·‚¢-‚®≥Ø‡®Æ°‡•‚•-≥Ê•≠Î ·§•´™® ≥Ø‡®Æ°-≥·§•´™®≥Ø‡®Æ°‡•‚•- ≥    Ê•≠Î   ≥                                ≥                                ≥                                                       ≥            ≥            ≥  ‡Î≠ÆÁ≠Æ©  ≥Ø‡®Æ°‡•‚•≠®®,≥            ≥            ≥  ØÆ Æ°È•©  ≥                                                ≥            ≥            ≥   ¢ % Æ‚   ≥                                ≥           ≥    ≠®Ô    ≥Ø†   ≥ Ø‡ÆÊ•≠‚Æ¢ ≥   ¶•≠®Ô   ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥‡•†´®ß†Ê®Ó≥    Ø‡®   ≥‡•†´®ß†Ê®®≥           ≥            ≥ß†Ê®® ≥‡•†´®-≥           ≥ ¢ ¢†´Ó‚„  ≥                                ≥                                ≥                                            ≥  ‡Î≠ÆÁ≠Æ©  ≥    ‡„°.    ≥          ≥Ø‡®Æ°‡•‚•-≥    Ø‡®   ≥    ≠®Ô   ≥            ≥‡•‚•- ≥Ø‡®Æ°-≥    ≠®Ô    ≥ ¢ ¢†´Ó‚„  ≥                                ≥                                ≥                                                       ≥            ≥            ≥   Ê•≠Æ©    ≥    ‡„°.     ≥            ≥            ≥ ·‚†¢™•, ‡„°≥                                                ≥            ≥            ≥  ≠Æ¨®≠†´†  ≥                                ≥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥    ñÅ    ≥‡•†´®ß†Ê®®≥          ≥           ≥            ≥      ≥ß†Ê®® ≥           ≥ ≠Æ¨®≠†´†  ≥                                ≥                                ≥                                            ≥(‡†·Á•‚≠Æ©) ≥            ≥          ≥  ≠®• ñÅ  ≥Ø‡®Æ°‡•‚•-≥          ≥            ≥ ≠®Ô  ≥‡•‚•- ≥           ≥ ≠Æ¨®≠†´†  ≥                                ≥                                ≥                                                       ≥            ≥            ≥            ≥             ≥            ≥            ≥            ≥                                                ≥            ≥            ≥            ≥                                ≥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥          ≥     ñÅ   ≥          ≥           ≥            ≥      ≥      ≥           ≥§´Ô ·§•´™® √ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¥ Ê•≠Î, ‡„°. ≥            ≥          ≥          ≥  ≠®® ñÅ  ≥          ≥            ≥      ≥ ≠®Ô  ≥           ≥§´Ô ·§•´™® √ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¥            ≥            ≥            ≥             ≥            ≥            ≥            √ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥            ≥            ≥            √ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥          ≥          ≥          ≥           ≥            ≥      ≥      ≥           ≥‡•†´®ß†Ê®® ≥ ë„¨¨† ¢ ¢†´Ó‚• ≥  ë„¨¨†, ‡„°.  ≥ ë„¨¨† ¢ ¢†´Ó‚• ≥  ë„¨¨†, ‡„°.  ≥  Å„¨†£†   ≥  ç®¶≠ÔÔ  ≥ à·‚ÆÁ≠®™ ≥   Ñ†‚†   ≥            ≥            ≥          ≥          ≥          ≥          ≥            ≥      ≥      ≥           ≥Ø‡®Æ°‡•‚•- ≥ ë„¨¨† ¢ ¢†´Ó‚• ≥  ë„¨¨†, ‡„°.  ≥ ë„¨¨† ¢ ¢†´Ó‚• ≥  ë„¨¨†, ‡„°.  ≥  Å„¨†£†   ≥  ç®¶≠ÔÔ  ≥  Ç•‡Â≠ÔÔ ≥ à·‚ÆÁ≠®™ ≥   Ñ†‚†   ≥            ≥            ≥            ≥             ≥            ≥            ≥            ≥    ≠† §†‚„     ≥    ≠† §†‚„    ≥    ≠† §†‚„    ≥            ≥            ≥            ≥   §´Ô ·§•´™®   ≥  §´Ô ·§•´™®   ≥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥          ≥          ≥          ≥           ≥            ≥      ≥      ≥           ≥           ≥      Ê•≠Î      ≥               ≥    ≠Æ¨®≠†´†    ≥               ≥ Ô¢´Ô•‚·Ô  ≥  £‡†≠®Ê† ≥®≠‰Æ‡¨†Ê®®≥ ™Æ‚®‡Æ¢™®≥            ≥            ≥          ≥          ≥          ≥          ≥            ≥      ≥      ≥           ≥    ≠®Ô    ≥    ≠Æ¨®≠†´†    ≥               ≥    ≠Æ¨®≠†´†    ≥               ≥ Ô¢´Ô•‚·Ô  ≥  £‡†≠®Ê† ≥  £‡†≠®Ê† ≥®≠‰Æ‡¨†Ê®®≥ ™Æ‚®‡Æ¢™®≥            ≥            ≥            ≥             ≥            ≥            ≥            ≥     ·¢Ôß®      ≥ Ø‡®Æ°‡•‚•≠®Ô  ≥ Ø‡®Æ°‡•‚•≠®Ô  ≥            ≥            ≥            ≥   ‡•†´®ß†Ê®®   ≥ Ø‡®Æ°‡•‚•≠®Ô  ≥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥          ≥          ≥          ≥           ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥  Æ°‡†È†-  ≥ ™Æ´•°†≠®©≥          ≥          ≥            ≥            ≥          ≥          ≥          ≥          ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥  Æ°‡†È†-  ≥ ™Æ´•°†≠®©≥ ™Æ´•°†≠®©≥          ≥          ≥            ≥            ≥            ≥             ≥            ≥            ≥            ≥                ≥               ≥               ≥            ≥            ≥            ≥                ≥               ≥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥          ≥          ≥          ≥           ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥  ÓÈ•©·Ô   ≥          ≥          ≥          ≥            ≥            ≥          ≥          ≥          ≥          ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥  ÓÈ•©·Ô   ≥          ≥          ≥          ≥          ≥            ≥            ≥            ≥             ≥            ≥            ≥            ≥                ≥               ≥               ≥            ≥            ≥            ≥                ≥               ≥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥          ≥          ≥          ≥           ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥  ≠† §†‚„  ≥          ≥          ≥          ≥            ≥            ≥          ≥          ≥          ≥          ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥  ≠† §†‚„  ≥          ≥          ≥          ≥          ≥            ≥            ≥            ≥             ≥            ≥            ≥            ≥                ≥               ≥               ≥            ≥            ≥            ≥                ≥               ≥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥          ≥          ≥          ≥           ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥‡•†´®ß†Ê®® ≥          ≥          ≥          ≥            ≥            ≥          ≥          ≥          ≥          ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥Ø‡®Æ°‡•‚•- ≥          ≥          ≥          ≥          ≥            ≥            ≥            ≥             ≥            ≥            ≥            ≥                ≥               ≥               ≥            ≥            ≥            ≥                ≥               ≥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥          ≥          ≥          ≥           ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥           ≥          ≥          ≥          ≥            ≥            ≥          ≥          ≥          ≥          ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥    ≠®Ô    ≥          ≥          ≥          ≥          ≥            ≥            ≥            ≥             ≥            ≥            ≥            ≥                ≥               ≥               ≥            ≥            ≥            ≥                ≥               ≥           ≥           ≥     ≥           ≥           ≥\n" +
"≥            ≥          ≥           ≥                      ≥          ≥           ≥          ≥          ≥          ≥          ≥           ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥           ≥          ≥          ≥          ≥            ≥            ≥          ≥          ≥          ≥          ≥            ≥      ≥      ≥           ≥           ≥                ≥               ≥                ≥               ≥           ≥          ≥          ≥          ≥          ≥            ≥            ≥            ≥             ≥            ≥            ≥            ≥                ≥               ≥               ≥            ≥            ≥            ≥                ≥               ≥           ≥           ≥     ≥           ≥           ≥\n" +
"√ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¥\n" +
"≥      1     ≥     2    ≥     3     ≥          4           ≥     5    ≥     6     ≥     7    ≥     8    ≥     9    ≥    10    ≥     11    ≥     12     ≥  13  ≥  14  ≥     15    ≥     16    ≥       17       ≥      18       ≥       19       ≥      20       ≥    21     ≥    22    ≥    23    ≥    24    ≥     25     ≥     26     ≥    27    ≥    28    ≥    29    ≥    30    ≥     31     ≥  32  ≥  33  ≥     34    ≥     35    ≥       36       ≥      37       ≥       38       ≥      39       ≥    40     ≥    41    ≥    42    ≥    43    ≥    44    ≥     45     ≥     46     ≥     47     ≥      48     ≥     49     ≥     50     ≥     51     ≥       52       ≥      53       ≥      54       ≥     55     ≥     56     ≥     57     ≥       58       ≥      59       ≥     60    ≥     61    ≥  62 ≥     63    ≥     64    ≥\n" +
"√ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒ¥";

  
PRIVATE CLASS (TX_RegistrReport) NPTX_ShRepReg_Report
  VAR m_BeginDate;
  PRIVATE VAR m_IsBond, m_IsDiscBond, m_IsPrivilegedBond;
  PRIVATE VAR m_KZS, m_MainSvp, m_MainSrub, m_NkdSrub, m_NkdBrub, m_ProcSec, m_FRrub, m_TaxLink, m_TaxPM,
              m_TaxRateProc, m_NomLink;
  PRIVATE VAR m_BuyCPm, m_SaleCPm;

  
  PRIVATE MACRO PrintMode():INTEGER
     return m_Form.GetFieldValue( PNFLD_TXSHREP_REG_PRINTMETHOD );
  END;
  
  PRIVATE MACRO BeginReport( NumCopy:INTEGER )
    Dl_CallInsertStat(PrintMode());
  END;

  MACRO è•Á†‚†‚Ïë‚‡Æ™„í†°´®ÊÎ( LineType:INTEGER )

     if( LineType == ë‚‡Æ™†_ë‚‡Æ™†Ñ†≠≠ÎÂ )
        PrintTableLine( "N1_Client",            this.Client(),             null,     /*1  */
                        "N1_ClientStatus",      this.ClientStatus(),       null,     /*2  */
                        "N1_SecCode",           this.SecCode(),            null,     /*3  */
                        "N1_SecName",           this.SecName(),            null,     /*4  */
                        "N1_VN",                this.VN(),                 null,     /*5  */
                        "N1_CodeS",             this.CodeS(),              null,     /*6  */
                        "N1_Dlink",             this.Dlink(),              null,     /*7  */
                        "N1_DZS",               this.DZS(),                null,     /*8  */
                        "N1_DDS",               this.DDS(),                null,     /*9  */
                        "N1_DPS",               iif(((this.DPS() > this.H0_2()) or (this.DPS() == date(0,0,0))), null, this.DPS()), null,     /*10 */
                        "N1_Qnty",              this.Qnty(),               SetPrecisionByFractPart(this.Qnty(), this.QntyPrecision(), 0),     /*11 */
                        "N1_PrSvp",             this.PrSvp(),              null,     /*12 */
                        "N1_ValS",              this.ValSNumber(),         null,     /*13 */
                        "N1_VpS",               this.VpSNumber(),          null,     /*14 */
                        "N1_CrSP",              this.CrSP(),               null,     /*15 */
                        "N1_KZS",               this.KZS(),                null,     /*16 */
                        "N1_MainSvp",           this.MainSvp(),            null,     /*17 */
                        "N1_MainSrub",          this.MainSrub(),           null,     /*18 */
                        "N1_NkdSvn",            this.NkdSvn(),             null,     /*19 */
                        "N1_NkdSrub",           this.NkdSrub(),            null,     /*20 */
                        "N1_bMrktS",            this.bMrktS(),             null,     /*21 */
                        "N1_PriceMrktS",        this.PriceMrktS(),         null,     /*22 */
                        "N1_MrktS",             this.MrktS(),              null,     /*23 */
                        "N1_DMrktS",            this.DMrktS(),             null,     /*24 */
                        "N1_DifS",              this.DifS(),               null,     /*25 */
                        "N1_ComS",              this.ComS(),               null,     /*26 */
                        "N1_CodeB",             this.CodeB(),              null,     /*27 */
                        "N1_DZB",               this.DZB(),                null,     /*28 */
                        "N1_DDB",               this.DDB(),                null,     /*29 */
                        "N1_DPB",               iif(((this.DPB() > this.H0_2()) or (this.DPB() == date(0,0,0))), null, this.DPB()),  null,     /*30 */
                        "N1_PrBvp",             this.PrBvp(),              null,     /*31 */
                        "N1_ValB",              this.ValBNumber(),         null,     /*32 */
                        "N1_VpB",               this.VpBNumber(),          null,     /*33 */
                        "N1_CrBP",              this.CrBP(),               null,     /*34 */
                        "N1_KZB",               this.KZB(),                null,     /*35 */
                        "N1_MainBvp",           this.MainBvp(),            null,     /*36 */
                        "N1_MainBrub",          this.MainBrub(),           null,     /*37 */
                        "N1_NkdBvn",            this.NkdBvn(),             null,     /*38 */
                        "N1_NkdBrub",           this.NkdBrub(),            null,     /*39 */
                        "N1_bMrktB",            this.bMrktB(),             null,     /*40 */
                        "N1_MinMrktB",          this.MinMrktB(),           null,     /*41 */
                        "N1_MaxMrktB",          this.MaxMrktB(),           null,     /*42 */
                        "N1_MrktB",             this.MrktB(),              null,     /*43 */
                        "N1_DMrktB",            this.DMrktB(),             null,     /*44 */
                        "N1_Material",          this.Material(),           null,     /*45 */
                        "N1_TaxPM",             this.TaxPM(),              null,     /*46 */
                        "N1_DifB",              this.DifB(),               null,     /*47 */
                        "N1_ComB",              this.ComB(),               null,     /*48 */
                        "N1_ProcSec",           this.ProcSec(),            null,     /*49 */
                        "N1_FRrub",             this.FRrub(),              null,     /*50 */
                        "N1_GenRub",            this.GenRub(),             null,     /*51 */
                        "N1_NomLink",           this.NomLink(),            null,     /*52 */
                        "N1_NomS",              this.NomS(),               null,     /*53 */
                        "N1_NomB",              this.NomB(),               null,     /*54 */
                        "N1_Dexp",              this.Dexp(),               null,     /*55 */
                        "N1_Dauc",              this.Dauc(),               null,     /*56 */
                        "N1_PrAucNom",          this.PrAucNom(),           null,     /*57 */
                        "N1_DqualS",            this.DqualS(),             null,     /*58 */
                        "N1_DqualB",            this.DqualB(),             null,     /*59 */
                        "N1_ContS",             this.ContS(),              null,     /*60 */
                        "N1_ContB",             this.ContB(),              null,     /*61 */
                        "N1_SecType",           this.SecType(),            null,     /*62 */
                        "N1_TaxRateProcent",    this.TaxRateProcent(),     null,     /*63 */
                        "N1_TaxRateGeneral",    this.TaxRateGeneral(),     null      /*64 */
                      );


     elif( LineType == ë‚‡Æ™†_à‚Æ£Æ )

        SetCurrentLineFont( 10, true, false );
        PrintTableLine( "N1_Client",  "Ç·•£Æ:", null );

        SetCurrentLineFont( 10, false, false );
        PrintTableLine( "N1_Client",  "¢ ‚Æ¨ Á®·´•", null );

     end;
  END;


  PRIVATE MACRO Create()
    var query, DataSet;
    var InvestorID = -1;
    var count = 0, Num = 0;
    var AvrFIID, AvrKind, AvrGroup, Investor;

    m_BeginDate = this.H0_1();
    m_EndDate   = this.H0_2();

    SetActiveSheet( "ê•£®·‚‡äÆ‡Æ‚™®ÂèÆß®Ê®©" );

    PrintFormatString( ReportHeader,
                       "N1_H0_1", this.H0_1(), // ß† Ø•‡®Æ§ ·
                       "N1_H0_2", this.H0_2(), // ØÆ
                       "N1_H0_3", this.H0_3(), // É‡„ØØ† ≠†´Æ£Æ¢Æ£Æ „Á•‚†
                       "N1_H0_4", this.H0_4(), // Ç®§ Ê/°
                       "N1_H0_5", this.H0_5(), // ÇÎØ„·™ Ê/°
                       "N1_H0_6", this.H0_6()  // à≠¢•·‚Æ‡
                     );

    RegisterTable( "N1_MainTable", TableHeader,
         /*1  */   "N1_Client",
         /*2  */   "N1_ClientStatus",
         /*3  */   "N1_SecCode",
         /*4  */   "N1_SecName",
         /*5  */   "N1_VN",
         /*6  */   "N1_CodeS",
         /*7  */   "N1_Dlink",
         /*8  */   "N1_DZS",
         /*9  */   "N1_DDS",
         /*10 */   "N1_DPS",
         /*11 */   "N1_Qnty",
         /*12 */   "N1_PrSvp",
         /*13 */   "N1_ValS",
         /*14 */   "N1_VpS",
         /*15 */   "N1_CrSD",
         /*16 */   "N1_KZS",
         /*17 */   "N1_MainSvp",
         /*18 */   "N1_MainSrub",
         /*19 */   "N1_NkdSvn",
         /*20 */   "N1_NkdSrub",
         /*21 */   "N1_bMrktS",
         /*22 */   "N1_PriceMrktS",
         /*23 */   "N1_MrktS",
         /*24 */   "N1_DMrktS",
         /*25 */   "N1_DifS",
         /*26 */   "N1_ComS",
         /*27 */   "N1_CodeB",
         /*28 */   "N1_DZB",
         /*29 */   "N1_DDB",
         /*30 */   "N1_DPB",
         /*31 */   "N1_PrBvp",
         /*32 */   "N1_ValB",
         /*33 */   "N1_VpB",
         /*34 */   "N1_CrBD",
         /*35 */   "N1_KZB",
         /*36 */   "N1_MainBvp",
         /*37 */   "N1_MainBrub",
         /*38 */   "N1_NkdBvn",
         /*39 */   "N1_NkdBrub",
         /*40 */   "N1_bMrktB",
         /*41 */   "N1_MinMrktB",
         /*42 */   "N1_MaxMrktB",
         /*43 */   "N1_MrktB",
         /*44 */   "N1_DMrktB",
         /*45 */   "N1_Material",
         /*46 */   "N1_TaxPM",
         /*47 */   "N1_DifB",
         /*48 */   "N1_ComB",
         /*49 */   "N1_ProcSec",
         /*50 */   "N1_FRrub",
         /*51 */   "N1_GenRub",
         /*52 */   "N1_NomLink",
         /*53 */   "N1_NomS",
         /*54 */   "N1_NomB",
         /*55 */   "N1_Dexp",
         /*56 */   "N1_Dauc",
         /*57 */   "N1_PrAucNom",
         /*58 */   "N1_DqualS",
         /*59 */   "N1_DqualB",
         /*60 */   "N1_ContS",
         /*61 */   "N1_ContB",
         /*62 */   "N1_SecType",
         /*63 */   "N1_TaxRateProcent",
         /*64 */   "N1_TaxRateGeneral" 
                  );  

    SetCellAutoSummaPoint( "Ç·•£Æ:", 
                      "N1_Qnty",6,
                      "N1_MainSvp",2, 
                      "N1_MainSrub",2,  
                      "N1_NkdSvn",2,    
                      "N1_NkdSrub",2,
                      "N1_DifS",2,    
                      "N1_ComS",2,
                      "N1_MainBvp",2, 
                      "N1_MainBrub",2,  
                      "N1_NkdBvn",2,    
                      "N1_NkdBrub",2,
                      "N1_Material",2,
                      "N1_TaxPM",2,    
                      "N1_DifB",2,  
                      "N1_ComB",2,  
                      "N1_ProcSec",2,   
                      "N1_FRrub",2,
                      "N1_GenRub",2
                      ); 
                            
    this.è•Á†‚†‚Ïë‚‡Æ™„í†°´®ÊÎ( ë‚‡Æ™†_à‚Æ£Æ );


    query =  " select lnk.t_ID as LinkID, "
           + "        lnk.t_Date as DLink, "
           + "        lnk.t_Amount as t_Amount, "
           + "        lnk.t_Client as Investor, "
           + "        client.t_Name as InvestorName, "
           + "        av.t_TaxGroup, "
           + "        FinInstr.t_FIID, "
           + "        FinInstr.t_FI_Code as AvrCode, "
           + "        FinInstr.t_Name as AvrName, "
           + "        FinInstr.t_FaceValueFI, "
           + "        FinInstr.t_AvoirKind, "
           + "        FinInstr.t_DrawingDate, "
           + "        FinInstr.t_Issued, "
           + "        FinInstr.t_SumPrecision, "

           + "        RTRIM(DECODE(DealSale.t_DealCodeTS,CHR(1),DealSale.t_DealCode,DealSale.t_DealCodeTS)) AS DealSaleCodeTS, "/*¢Î¢Æ§®‚·Ô ≠Æ¨•‡ ®·ÂÆ§≠Æ© ·§•´™® Ø‡Æ§†¶®, •·´® ¢ ·¢Ôß® ¢ ØÆß®Ê®® Ø‡Æ§†¶† - ¢®‡‚„†´Ï≠†Ô ·§•´™†*/
           + "        salelot.t_DEALDATE AS DealSaleDate, "
           + "        salelot_real.t_SALEDATE AS SaleDate, "
           + "        salelot_real.t_DocID as DealSaleID, "
           + "        salelot_real.t_DocKind as SaleDocKind, "
           + "        salelot.t_Price as SPrice, "

           + "        buylot.t_DocID as DealBuyID, "
           + "        buylot.t_DEALCODETS AS DealBuyCodeTS, "
           + "        buylot.t_DealDate as DealBuyDate, "
           + "        buylot.t_BuyDate, "
           + "        buylot.t_DocKind as BuyDocKind, "
           + "        buylot.t_Price as BPrice, "

           + Get_PartyName_Query( "DealSale", "PartyNameSale" ) + ", " /*PartyNameSale*/
           + Get_PartyName_Query( "DealBuy",  "PartyNameBuy" )  + ", " /*PartyNameBuy*/

           + "        (case when npto.GetPaperTaxGroupNPTX(FinInstr.t_FIID) in (30, 40, 50) then "+BOND_FAVOUR+" else "+BOND_UNDEF+" end) as TaxGroupType, "
           + "        (case when RSB_FIINSTR.FI_IsCouponAvoiriss(FinInstr.t_FIID) = 1 then 0 else 1 end) as IsDiscountAvoir, " //Ñ®·™Æ≠‚≠Î¨® Æ°´®£†Ê®Ô¨® ·Á®‚†Ó‚·Ô Æ°´®£†Ê®®, ≠• ®¨•ÓÈ®• ™„ØÆ≠Æ¢.
           + "        nptx.IsVirtual(salelot.t_type) as IsVirtualSale, "

           + "        NPTO.GetMinMarketPrice(FinInstr.t_FIID,salelot.t_DEALDATE,-1,salelot.t_ID) SMinMarketPrice, "
           + "        NPTO.GetMinMarket(FinInstr.t_FIID,salelot.t_DEALDATE,-1,salelot.t_ID) SMarket, "
           + "        NPTO.GetMinDateMarket(FinInstr.t_FIID,salelot.t_DEALDATE,-1,salelot.t_ID) SDateMarket, "
           + "        NPTO.IfMarket(FinInstr.t_FIID,salelot.t_DEALDATE) SIfMarket, "

           + "        NPTO.GetMinMarketPrice(FinInstr.t_FIID,buylot.t_DEALDATE,-1,buylot.t_ID) BMinMarketPrice, "
           + "        NPTO.GetMaxMarketPrice(FinInstr.t_FIID,buylot.t_DEALDATE,-1,buylot.t_ID) BMaxMarketPrice, "
           + "        NPTO.GetMarket(FinInstr.t_FIID,buylot.t_DEALDATE,-1,buylot.t_ID) BMarket, "
           + "        NPTO.GetDateMarket(FinInstr.t_FIID,buylot.t_DEALDATE,-1,buylot.t_ID) BDateMarket, "
           + "        NPTO.IfMarket(FinInstr.t_FIID,buylot.t_DEALDATE) BIfMarket, "

           + "        NVL(DataSale.LegKindSale, -1) as LegKindSale, NVL(DataBuy.LegKindBuy,-1) as LegKindBuy"

           + "   from dnptxlnk_dbt  lnk, "
           + "        dnptxlot_dbt  buylot, "
           + "        dnptxlot_dbt  salelot, "
           + "        DDL_TICK_DBT  DealSale," 
           + "        DDL_TICK_DBT  DealBuy," 
           + "        DFININSTR_DBT FinInstr, "  
           + "        DAVOIRISS_DBT av, "
           + "        dparty_dbt    client, "

           + "        dnptxlot_dbt salelot_real, "

           + "        ( Select SaleOper.t_Kind_Operation, SaleOper.t_DocKind, " 
           +       "                 rsb_secur.get_OperationGroup(SaleOper.t_SysTypes) as DealSaleGroup, " 
           +       "                 (CASE WHEN " 
           +       "                            ((Rsb_Secur.IsBuy(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " 
           +       "                          or (Rsb_Secur.IsAvrWrtIn(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " 
           +       "                            ) " 
           +       "                       THEN 2 " 
           +       "                       ELSE 0 END " 
           +       "                 ) as LegKindSale " 
           +       "            From " 
           +       "                 doprkoper_dbt SaleOper "  
           +       "        ) DataSale, " 

           +       "        ( Select BuyOper.t_Kind_Operation, BuyOper.t_DocKind, " 
           +       "                 rsb_secur.get_OperationGroup(BuyOper.t_SysTypes) as DealBuyGroup, " 
           +       "                 (CASE WHEN " 
           +       "                            ((Rsb_Secur.IsSale(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " 
           +       "                          or (Rsb_Secur.IsAvrWrtOut(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " 
           +       "                            ) " 
           +       "                       THEN 2 " 
           +       "                       ELSE 0 END " 
           +       "                 ) as LegKindBuy " 
           +       "            From " 
           +       "                 doprkoper_dbt BuyOper "  
           +       "        ) DataBuy " 

           + "  where lnk.t_Type = " + NPTXLNK_CLPOS
           + "    and lnk.t_Date >= " +GetSQLDate(m_BeginDate)+" and lnk.t_Date <= "+GetSQLDate(m_EndDate)
           + "    and salelot.t_ID = lnk.t_SaleID "
           + "    and salelot_real.t_ID = (case when NPTX.IsVirtual(salelot.t_Type) = 1 then salelot.t_RealID else salelot.t_ID end ) " 
           + "    and buylot.t_ID = lnk.t_BuyID "
           + "    and salelot_real.t_DocID = DealSale.t_DealID " 
           + "    and buylot.t_DocID  = DealBuy.t_DealID "/*Æ‚°®‡†•¨ ‡•†´Ï≠Î• ØÆ™„Ø™®: ç• Æ‚°®‡†Ó‚·Ô ·¢Ôß® áäè, „ ™Æ‚Æ‡ÎÂ ¢ ØÆ™„Ø™• - ¢®‡‚„†´Ï≠†Ô ØÆ™„Ø™†.*/
           + "    and FinInstr.t_FIID = lnk.t_FIID " 
           + "    and av.t_FIID        = lnk.t_FIID " 
           + "    and client.t_PartyID = lnk.t_Client "
           + "    and DataSale.t_Kind_Operation = DealSale.t_DealType " 
           + "    and DataSale.t_DocKind        = DealSale.t_BOfficeKind " 
           + "    and DataBuy.t_Kind_Operation  = DealBuy.t_DealType " 
           + "    and DataBuy.t_DocKind         = DealBuy.t_BOfficeKind ";


    AvrFIID = m_Form.GetFieldValue( PNFLD_TXSHREP_REG_AVRCODE);
    if( (AvrFIID != null) AND (AvrFIID > 0 ) ) /*ß†§†≠† °„¨†£†*/
       query = query + " and lnk.t_FIID = " + string(AvrFIID);
    else

       AvrKind  = m_Form.GetFieldValue( PNFLD_TXSHREP_REG_AVRKIND );
       if( (AvrKind != null) AND (AvrKind > 0 ) ) /*ß†§†≠ ¢®§ °„¨†£®*/
          query = query + " and RSB_FIInstr.FI_AvrKindsEQ(2, " + string(AvrKind) + ", FinInstr.t_AvoirKind) = 1 ";
       end;

       AvrGroup = m_Form.GetFieldValue( PNFLD_TXSHREP_REG_AVRGROUP );
       if( (AvrGroup != null) AND (AvrGroup > 0 ) ) /*ß†§†≠† ™†‚•£Æ‡®Ô °„¨†£®*/
          query = query + " and " + Get_NpTxAvrGroup_Query(AvrGroup,"FinInstr.t_FIID");
       end;
    end;

    Investor = m_Form.GetFieldValue( PNFLD_TXSHREP_REG_INVESTORCODE);
    if( (Investor != null) AND (Investor > 0 ) )
      query = query + " and lnk.t_Client = " + Investor;
    end;
    
    count = SQL_GetNRecs( query );
    if (count > 0)
      InitProgress( count, "ê•£®·‚‡ ØÆ ™Æ‡Æ‚™®¨ ØÆß®Ê®Ô¨", "ê•£®·‚‡ ØÆ ™Æ‡Æ‚™®¨ ØÆß®Ê®Ô¨" );

      m_RS = TRsbDataSet( query );

      m_CacheFinInstr.Clear();

      this.SetCurrentLineFont( 8, false, false );
        
      while( m_RS.MoveNext() )

        this.ClearCacheOneRecord();

        m_IsBond = FI_IsBond(m_RS.FIID);
        if(m_IsBond)
          m_IsDiscBond       = m_RS.IsDiscountAvoir;
          m_IsPrivilegedBond = ãÏ£Æ‚≠†Ôé°´®£†Ê®Ô( m_RS.TaxGroupType );
        end;

        è•Á†‚†‚Ïë‚‡Æ™„í†°´®ÊÎ( ë‚‡Æ™†_ë‚‡Æ™†Ñ†≠≠ÎÂ );

        UseProgress( Num = Num + 1 );
      end;

      RemProgress();
    end;

                
    EndTable();
                
    //Ø‡Æ¨•¶„‚ÆÁ≠Î• ®‚Æ£®
    SetSubtotal(13, 10 + MAXROWSHEET,
                "K7", 
                "Q7",
                "R7",   
                "S7",
                "T7",
                "Y7",
                "Z7",
                "AJ7",   
                "AK7",
                "AL7",
                "AM7",
                "AS7",
                "AT7",
                "AU7",
                "AV7",
                "AW7",
                "AX7",
                "AY7" 
               );

    AddStandardFooter( "N1_" );

  END;

  MACRO ClearCacheOneRecord()
     this.ClearCacheOneRecord();

     m_IsBond = null;
     m_IsDiscBond       = null;
     m_IsPrivilegedBond = null;

     m_KZS   = null;
     m_MainSvp  = null;
     m_MainSrub = null;
     m_NkdSrub = null;
     m_MainBvp  = null;
     m_MainBrub = null;
     m_NkdBrub = null;
     m_Material = null;
     m_ProcSec = null;
     m_FRrub   = null;
     m_TaxPM   = null;
     m_TaxRateProc = null;
     m_TaxRate  = null;
     m_NomLink = null;

     m_BuyCPm = null;
     m_SaleCPm = null;
     m_TaxLink = null;
  END;

  MACRO BuyCPm()
    var query, rsd;
    if( m_BuyCPm == NULL )
        query = RSDCommand(" SELECT t_FIID as FIID, t_FactDate as ValueDate"
                         + " FROM ddlrq_dbt "
                         + " WHERE t_DocKind = ? "
                         + "       AND t_DocID = ? "
                         + "       AND t_Type = ? "
                         + "       AND t_DealPart = ? ");
        query.addParam("", RSDBP_IN, m_RS.BuyDocKind);
        query.addParam("", RSDBP_IN, m_RS.DealBuyID);
        query.addParam("", RSDBP_IN, DLRQ_TYPE_PAYMENT);
        query.addParam("", RSDBP_IN, 1); 
        query.execute();
        rsd = TRsbDataSet(query);

        if( rsd.MoveNext() )
           return rsd;
        end;
    end;
    return m_BuyCPm;
  END;

  MACRO SaleCPm()
    var query, rsd;
    if( m_SaleCPm == NULL )
        query = RSDCommand(" SELECT t_FIID as FIID, t_FactDate as ValueDate"
                         + " FROM ddlrq_dbt "
                         + " WHERE t_DocKind = ? "
                         + "       AND t_DocID = ? "
                         + "       AND t_Type = ? "
                         + "       AND t_DealPart = ? ");
        query.addParam("", RSDBP_IN, m_RS.SaleDocKind);
        query.addParam("", RSDBP_IN, m_RS.DealSaleID);
        query.addParam("", RSDBP_IN, DLRQ_TYPE_PAYMENT);
        query.addParam("", RSDBP_IN, 1);
        query.execute();
        rsd = TRsbDataSet(query);

        if( rsd.MoveNext() )
           return rsd;
        end;
    end;
    return m_SaleCPm;
  END;

  /*ç†Á†´Ï≠†Ô §†‚†*/
  MACRO H0_1():DATE
     return FormData.BeginDate;
  END;

  /*äÆ≠•Á≠†Ô §†‚†*/
  MACRO H0_2():DATE
     return FormData.EndDate;
  END;

  /*É‡„ØØ† ≠†´Æ£Æ¢Æ£Æ „Á•‚†*/
  MACRO H0_3():STRING
     var AttrID = m_Form.GetFieldValue( PNFLD_TXSHREP_REG_AVRGROUP),
         GroupName = "";

     if (AttrID > 0)
        DL_GetObjAttrName( OBJTYPE_AVOIRISS, OBJGROUP_AVRNPTXGROUP, AttrID, @GroupName );
        return GroupName;
     end;

     return STR_ALLVALUE;
  END;

  /*Ç®§ Ê/°*/
  MACRO H0_4():STRING
     return FormData.AvrKind;
  END;

  /*ÇÎØ„·™ Ê/°*/
  MACRO H0_5():STRING
     return FormData.AvrName;
  END;

  /*à≠¢•·‚Æ‡*/
  MACRO H0_6():STRING
     return FormData.InvestorName;
  END;
                                                                                                                                                                                                  
  MACRO Client():STRING
    return m_Rs.InvestorName;
  END;

  MACRO DLink():DATE // Ñ†‚† ·¢Ôß®
    return SQL_ConvTypeDate(m_RS.DLink);
  END;

  MACRO DPS():DATE // Ñ†‚† ÆØ´†‚Î ØÆ ·§•´™• ‡•†´®ß†Ê®®
     return SQL_ConvTypeDate(SaleCPm().ValueDate);
  END;

  MACRO ValS():INTEGER  //¢†´Ó‚† Ê•≠Î
     return LegSale().rec.CFI;
  END;

  MACRO ValSNumber():STRING  //¢†´Ó‚† Ê•≠Î
    if( LegSale().rec.RelativePrice == SET_CHAR )
      return "%";
    else
      return m_CacheFinInstr.GetISO( this.ValS() ).m_Number;
    end;
  END;

  MACRO VpS():INTEGER //¢†´Ó‚† ‡†·Á•‚Æ¢
      return SaleCPm().FIID;
  END;

  MACRO VpSNumber():STRING //¢†´Ó‚† ‡†·Á•‚Æ¢
    return m_CacheFinInstr.GetISO( this.VpS() ).m_Number;      
  END;
  
  MACRO PrSvp():DOUBLE 
      return LegSale().rec.Price;
  END;

  MACRO CrSP():DOUBLE
    if(m_CrSP == NULL)
      m_CrSP = GetRateOnDateCrossDbl( this.DPS(), this.VpS(), NATCUR, true );
    end;
    return m_CrSP;
  END;

  MACRO KZS():DOUBLE
    var Rate = 0;
    if(m_KZS == NULL)
      Rate = GetRateOnDateCrossDbl( this.DZS(), m_RS.FaceValueFI, NATCUR, true );
      if((ValType(Rate) != V_UNDEF) AND (Rate != 0.0))
        m_KZS = GetRateOnDateCrossDbl( this.DZS(), this.ValS(), NATCUR, true )/Rate;
      else
        m_KZS = 0.0;
      end;
    end;

    if((m_CrSP == NULL) or (m_CrSP == 0.0))
      m_CrSP = NULL;
      return 1.0;
    end;

    return m_KZS;
  END;

  MACRO MainSvp():MONEY
    if(m_MainSvp == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_MAINS_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, @m_MainSvp, @m_MainSrub);
    end;
    return m_MainSvp;
  END;
      
  MACRO MainSrub():MONEY
    if(m_MainSrub == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_MAINS_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, @m_MainSvp, @m_MainSrub);
    end;
    return m_MainSrub;
  END;

  MACRO NkdSvn():MONEY
    if(m_NkdSvn == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_NKDS_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, @m_NkdSvn, @m_NkdSrub);
    end;
    return m_NkdSvn;
  END;
      
  MACRO NkdSrub():MONEY
    if(m_NkdSrub == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_NKDS_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, @m_NkdSvn, @m_NkdSrub);
    end;
    return m_NkdSrub;
  END;

  MACRO bMrktS():STRING
     return IIF(m_Rs.SIfMarket == SET_CHAR,"§†","≠•‚");
  END;

  MACRO PriceMrktS():STRING
     return m_Rs.SMinMarketPrice;
  END;

  MACRO MrktS():STRING
     return IIF(m_Rs.SMinMarketPrice>0.,m_Rs.SMarket,"");
  END;
   
  MACRO DMrktS():STRING
     return IIF(m_Rs.SMinMarketPrice>0.,SQL_ConvType(m_Rs.SDateMarket),"");
  END;

  MACRO DifS():MONEY
    if(m_DifS == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_DIFS_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, NULL, @m_DifS);
    end;
    return m_DifS;
  END;

  MACRO ComS():MONEY
    if(m_ComS == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_COMS_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, NULL, @m_ComS);
    end;
    return m_ComS;
  END;

  MACRO DPB():DATE
      return SQL_ConvTypeDate(BuyCPm().ValueDate);
  END;

  MACRO ValB():INTEGER  //¢†´Ó‚† Ê•≠Î
      return LegBuy().rec.CFI;
  END;

  MACRO ValBNumber():STRING  //¢†´Ó‚† Ê•≠Î
    if( LegBuy().rec.RelativePrice == SET_CHAR )
      return "%";
    else
      return m_CacheFinInstr.GetISO( this.ValB() ).m_Number;
    end;
  END;

  MACRO VpB():INTEGER //¢†´Ó‚† ‡†·Á•‚Æ¢
      return BuyCPm().FIID;
  END;

  MACRO VpBNumber():STRING //¢†´Ó‚† ‡†·Á•‚Æ¢
    return m_CacheFinInstr.GetISO( this.VpB() ).m_Number;      
  END;

  MACRO PrBvp():DOUBLE // ñ•≠† Ø‡®Æ°‡•‚•≠®Ô - ¢ ¢†´Ó‚•
      return LegBuy().rec.Price;
  END;

  MACRO CrBP():DOUBLE
    if(m_CrBP == NULL)
      if((m_Rs.DealBuyID > 0) and (this.DPB() > date(0,0,0)))
        m_CrBP = GetRateOnDateCrossDbl( this.DPB(), this.VpB(), NATCUR, true );
      end;
    end;

    if((m_CrBP == NULL) or (m_CrBP == 0.0))
      m_CrBP = NULL;
      return 1.0;
    end;

    return m_CrBP;
  END;

  MACRO KZB():DOUBLE
    var Rate = 0;
    if(m_KZB == NULL)
      if(m_Rs.DealBuyID > 0)
        Rate = GetRateOnDateCrossDbl( this.DZB(), m_RS.FaceValueFI, NATCUR, true );
        if((ValType(Rate) != V_UNDEF) AND (Rate != 0.0))
          m_KZB = GetRateOnDateCrossDbl( this.DZB(), this.ValB(), NATCUR, true )/Rate;
        else
          m_KZB = 0.0;
        end;
      end;
    end;

    if((m_KZB == NULL) or (m_KZB == 0.0))
      m_KZB = NULL;
      return 1.0;
    end;

    return m_KZB;
  END;

  MACRO MainBvp():MONEY
    if(m_MainBvp == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_MAINB_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, @m_MainBvp, @m_MainBrub);
    end;

    if( m_RS.FaceValueFI != 0 )
      SmartConvertSum( m_MainBvp, m_MainBvp, this.DPS(), NATCUR, m_RS.FaceValueFI, false);
    end;

    return m_MainBvp;
  END;
      
  MACRO MainBrub():MONEY
    if(m_MainBrub == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_MAINB_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, @m_MainBvp, @m_MainBrub);
    end;
    return m_MainBrub;
  END;

  MACRO NkdBvn():MONEY
    if(m_NkdBvn == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_NKDB_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, @m_NkdBvn, @m_NkdBrub);
    end;

    if( m_RS.FaceValueFI != 0 )
      SmartConvertSum( m_NkdBvn, m_NkdBvn, this.DPS(), NATCUR, m_RS.FaceValueFI, false);
    end;    

    return m_NkdBvn;
  END;
      
  MACRO NkdBrub():MONEY
    if(m_NkdBrub == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_NKDB_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, @m_NkdBvn, @m_NkdBrub);
    end;
    return m_NkdBrub;
  END;

  MACRO bMrktB():STRING
     return IIF(m_Rs.BIfMarket == SET_CHAR,"§†","≠•‚");
  END;

  MACRO MinMrktB():STRING
     return m_Rs.BMinMarketPrice;
  END;

  MACRO MaxMrktB():STRING
     return m_Rs.BMaxMarketPrice;
  END;

  MACRO MrktB():STRING
     return IIF((m_Rs.BMinMarketPrice>0.)or(m_Rs.BMaxMarketPrice>0.),m_Rs.BMarket,"");
  END;
   
  MACRO DMrktB():STRING
     return IIF((m_Rs.BMinMarketPrice>0.)or(m_Rs.BMaxMarketPrice>0.),SQL_ConvType(m_Rs.BDateMarket),"");
  END;

  MACRO Material():MONEY
    if(m_Material == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_MATERIALB_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, NULL, @m_Material);
    end;
    return m_Material;
  END;

  MACRO TaxPM():MONEY
    if(m_TaxPM == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_TAXPM_LINK_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, NULL, @m_TaxPM);
    end;
    return m_TaxPM;
  END;

  MACRO DifB():MONEY
    if(m_DifB == NULL)
       DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_DIFB_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, NULL, @m_DifB);
       /*m_DifB - ¢·•£§† Æ‚‡®Ê†‚•´Ï≠Î©.
         ä†ßÏ¨®‡„™ Ö´•≠†: è‡•§ØÆ´†£†´Æ·Ï, Á‚Æ DifB °„§•‚ ¢Î¢Æ§®‚Ï·Ô ¢ Æ‚Á•‚ Æ‚‡®Ê†‚•´Ï≠Î¨. 
         íÆ£§† ·´†£†•¨Æ• "- <DifB> " ìÇÖãàóàí ·„¨¨„ §´Ô ≠†´Æ£ÆÆ°´Æ¶•≠®Ô, ™†™ ® §Æ´¶≠Æ °Î‚Ï.*/
    end;
    return m_DifB;
  END;

  MACRO ComB():MONEY
    if(m_ComB == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_COMB_SHORT), NULL, this.H0_2(), TXOBJ_DIR_ALL, NULL, @m_ComB);
    end;
    return m_ComB;
  END;

  MACRO ProcSec():MONEY
    var ProcSecIn = 0.0, ProcSecOut = 0.0;
    if(m_ProcSec == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_DISCOUNT_LINK), NULL, this.H0_2(), TXOBJ_DIR_IN, NULL, @ProcSecIn);
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_DISCOUNT_LINK), NULL, this.H0_2(), TXOBJ_DIR_OUT, NULL, @ProcSecOut);
      m_ProcSec = ProcSecIn - ProcSecOut;
    end;
    return m_ProcSec;
  END;

  MACRO FRrub():MONEY
    var FRrubIn = 0.0, FRrubOut = 0.0;
    if(m_FRrub == NULL)
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_FR_LINK), NULL, this.H0_2(), TXOBJ_DIR_IN, NULL, @FRrubIn);
      DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_FR_LINK), NULL, this.H0_2(), TXOBJ_DIR_OUT, NULL, @FRrubOut);
      m_FRrub = FRrubIn - FRrubOut;
    end;
    return m_FRrub;
  END;

  MACRO NomLink():MONEY                                                                                                                                        
    if(m_NomLink == NULL)
      if(m_IsBond)
        m_NomLink = GetFaceValue( m_RS.t_FIID, this.DLink(), true, false );
      end;
    end;
    return m_NomLink;
  END;

  MACRO NomS():MONEY
    if(m_NomS == NULL)
      if(m_IsBond)
        m_NomS = GetFaceValue( m_RS.t_FIID, this.DDS(), true, false );
      end;
    end;
    return m_NomS;
  END;

  MACRO NomB():MONEY                                                                                                                                        
    if(m_NomB == NULL)
      if(m_IsBond)
        m_NomB = GetFaceValue( m_RS.t_FIID, this.DDB(), true, false );
      end;
    end;
    return m_NomB;
  END;

  MACRO Dexp():DATE //  Ñ†‚† ØÆ£†Ë•≠®Ô Ê/°
    if(m_IsBond)
      return this.Dexp();
    end;
    return NULL;
  END;

  MACRO Dauc():DATE //  Ñ†‚† ‡†ß¨•È•≠®Ô Ê/°
    if((m_IsDiscBond) and (m_IsPrivilegedBond))
      return this.Dauc();
    end;
    return NULL;
  END;

  MACRO PrAucNom():DOUBLE
    if((m_IsDiscBond) and (m_IsPrivilegedBond))
      return this.PrAucNom();
    end;
    return NULL;
  END;

  MACRO SecType():STRING
    return DL_GetNPTXSecType(m_Rs.FIID);
  END;

  MACRO TaxRateProcent():STRING
    if(m_TaxRateProc == NULL)
      m_TaxRateProc = DL_GetClientTaxRateProcent(m_Rs.Investor, m_Rs.FIID, m_EndDate);
      if(m_TaxRateProc == NULL)
        m_TaxRateProc = "≠•‚";
      else
        m_TaxRateProc = string(m_TaxRateProc * 100, "%");
      end;  
    end;
    return m_TaxRateProc;
  END;

  MACRO TaxRateGeneral():STRING
    if(m_TaxRate == NULL)
      m_TaxRate = DL_GetClientTaxRateGeneral(m_Rs.Investor, m_EndDate) * 100.0;
    end;
    return string(m_TaxRate, "%");
  END;

  MACRO DqualB():DATE
    if(m_DqualB == NULL)
      if(m_RS.DealBuyID)
        m_DqualB = readNoteForObject( OBJTYPE_SECDEAL, UniID( this.DealBuy(), OBJTYPE_SECDEAL), NOTEKIND_SECDEAL_REQUALREPO);
        if((ValType(m_DqualB) != V_UNDEF) and (m_DqualB != ""))
          m_DqualB = date(m_DqualB);
        end;
      end;
    end;
    return m_DqualB;
  END;                                                                                    

  MACRO DqualS():DATE
    if(m_DqualS == NULL)
      if(m_RS.DealSaleID)
        m_DqualS = readNoteForObject( OBJTYPE_SECDEAL, UniID( this.DealSale(), OBJTYPE_SECDEAL), NOTEKIND_SECDEAL_REQUALREPO);
        if((ValType(m_DqualS) != V_UNDEF) and (m_DqualS != ""))
          m_DqualS = date(m_DqualS);
        end;
      end;
    end;
    return m_DqualS;
  END;

  MACRO TaxLink():MONEY
    var TaxLink_plus = $0, TaxLink_minus = $0;
    if( m_TaxLink == NULL )
       DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_TAX_LINK), NULL, this.H0_2(), TXOBJ_DIR_IN, NULL, @TaxLink_plus);
       DL_GetNPTXOBJSumByLink(m_Rs.LinkID, string(TXOBJ_TAX_LINK), NULL, this.H0_2(), TXOBJ_DIR_OUT, NULL, @TaxLink_minus);

       m_TaxLink = TaxLink_plus - TaxLink_minus;
    end;
    return m_TaxLink;
  END;

  MACRO GenRub():MONEY /*ë„¨¨† §´Ô ≠†´Æ£ÆÆ°´Æ¶•≠®Ô ØÆ Æ°È•© ·‚†¢™•, ‡„°.*/

    var GenRub = 0;

    if( (SecType() == 50) and (m_RS.SaleDocKind == DL_RETIREMENT) )
       GenRub = this.TaxLink() - this.DifB() - this.MainSrub();
    else
       GenRub = IIF((this.FRrub() < 0), this.TaxLink() + this.DifS() - this.DifB(), this.TaxLink());
    end;

    return GenRub;
  END;

  initTX_RegistrReport( NPTX_ShRepReg_Panel(), "Report_NPTXShRep.xls" );
END;


NPTX_ShRepReg_Report().Run();

exit(1);
