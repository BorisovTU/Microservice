/*
$Name:             ShRep_Reg_Report.mac
$Module:           АРНУ
$Description:      Отчет "Регистры коротких позиций по РЕПО" (НУ)
*/

IMPORT "ShRep_Reg_Form.mac", "RegistrReport.mac", "ws_txreportform.mac";

/*Здесь можно через "," в апострофах указать код (FININSTR.FI_Code) ценных бумаг, которые будут исключаться из отчета.
  Например: 
    ИсключаемыеИзОтчетаЦБ = "'1','2','3'"
*/
PRIVATE CONST ИсключаемыеИзОтчетаЦБ = "";

PRIVATE CONST Строка_Итого                = 0,
              Строка_СтрокаДанных         = 1;

PRIVATE CONST SHEET_0601 = "0601";
PRIVATE CONST SHEET_0602 = "0602";
PRIVATE CONST SHEET_0603 = "0603";
PRIVATE CONST SHEET_0604 = "0604";
PRIVATE CONST SHEET_0605 = "0605";
PRIVATE CONST SHEET_0606 = "0606";

PRIVATE VAR   ShRepReg_Form;
PRIVATE VAR   ShRepReg_Report;
PRIVATE VAR   WebMenuItem; // Информация о запуске отчета из веб

PRIVATE VAR   T_Dep:T_Dep_Collector;

PRIVATE VAR ReportHeader =
"\n\n##############################  ###########################\n" +
"Приложение № ##.## \n" +
"Аналитический регистр налогового учета № 1-02-#####-###-##-000-##-210302-##-##-70102000000000000000\n" +
"                ┌──────────────────────┬─────────────────────────────────────────────────┐\n" +
"                │                    1 │Наименование налоговой базы                      │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   02 │Лист декларации                                  │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                ##### │Номер приложения синтетического регистра         │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                  ### │Код строки в синтетическом регистре              │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   ## │Номер аналитического регистра                    │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                  000 │Код филиала                                      │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   ## │                                                 │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │               210302 │Код структурного подразделения внутри филиала    │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   ## │Номер месяца (последний в отчетном периоде)      │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │                   ## │Две последние цифры года                         │\n" +
"                ├──────────────────────┼─────────────────────────────────────────────────┤\n" +
"                │ 70102000000000000000 │Номер лиц. счета по учету доходов/расходов банка │\n" +
"                └──────────────────────┴─────────────────────────────────────────────────┘\n" +
"#######################################################################################################################################################\n" +
"за период с ########## по ##########\n" +
"Группа налогового учета: #################################################################\n" +
"Вид ц/б:                 #################################################################\n" +
"Выпуск ц/б:              #################################################################\n";

PRIVATE VAR TableHeader_0601 =                                                                                                                                                                                                                                                                   
                                          
"┌──────┬────────────┬────────┬──────┬───────┬──────┬──────┬────────────┬───────────────────┬─────────────────────────┬─────┬──────┬───────┬───────┬────┬───────┬─────────────┬───────────────────┬────────────────────┬────────────┬──────────┬───────┬────────┬────────┬────────┬────────┬──────┬───────┬──────┬──────┬──────────────────┬───────┬───────┬─────────┬─────────┬─────┬─────┬─────┐\n" + 
"│ Код  │   Выпуск   │ Номер  │ Дата │ Дата  │Коли- │ Код  │Цена        │   Стоимость       │Минимальная цена на дату │Сумма│Комис-│ Номер │ Дата  │Дата│  Код  │ Цена        │                   │Максимальная цена на│Сумма       │Cтоимость │Комис- │Дата    │Объяв-  │Начисле-│Расходы │Курс  │Курс ЦБ│ Курс │ Курс │       Дата       │Контра-│Контра-│ГО/филиал│ГО/филиал│Нало-│Вза- │Вза- │\n" + 
"│бумаги│   ценной   │ сделки │заклю-│реали- │чество│валюты│реа-        │   реализации      │заключения сделки,       │отк- │ сия, │сделки │заклю- │зак-│валюты │приоб-       │Стоимость          │  дату заключения   │превышения  │приобрете-│ сия,  │состав- │ленная  │но эми- │  при   │ЦБ РФ │ РФ на │перес-│перес-│ переквалификации │гент по│гент по│по сделке│по сделке│говая│имо- │имо- │\n" + 
"│      │   бумаги   │реализа-│чения │ зации │прода-│ цены │лиза-       │   (стоимость      │сложивш. на ОРЦБ;        │лоне-│упла- │приоб- │ чения │ры- │ цены  │рете-        │приобре-           │ договора, сложивш. │стоимости   │   нных   │уплаче-│ления   │сумма   │тентом -│реализа-│ на   │ дату  │ чета │ чета │ сделки РЕПО/Займа│сделке │сделке │  реали- │ приобре-│груп-│зави-│зави-│\n" + 
"│      │            │  ции   │сделки│ (дата │ нных │реали-│ ции        │   открытия        │расчетная цена для ЦБ    │ ния │ченная│ретения│сделки │тия │приоб- │ ния         │  тения            │ на ОРЦБ; расчетная │приобретения│  ценных  │ нная  │списка  │дивиден-│ всего, │  ции,  │дату  │заклю- │цены/с│цены/с│                  │реали- │приоб- │  зации  │  тения  │ па  │си-  │си-  │\n" + 
"│      │            │        │реали-│откры- │бумаг,│зации │(цена       │   короткой        │не обращ. на ОРЦБ        │фак- │ при  │       │  на   │ко- │ретения│(цена        │ (стои-            │   цена для ЦБ не   │над рыночной│  бумаг,  │  при  │акционе-│дов на 1│ руб.   │  руб.  │зак-  │ чения │ т-ти │ т-ти │                  │ зации │ретения│         │         │     │мость│мость│\n" + 
"│      │            │        │зации │  тия  │ шт.  │      │отк-        │   позиции)        │(расч. цена ЦБ,          │тиче-│реали-│       │приоб- │рот-│       │закры-       │  мость            │   обращ. на ОРЦБ   │(расчетной) │принимае- │приоб- │ров     │ акцию, │        │        │люче- │сделки │реали-│приоб-│                  │       │       │         │         │     │контр│контр│\n" + 
"│      │            │        │  ЦБ  │корот- │      │      │рытия       │                   │реализ.по срочн. сделке),│ской │зации,│       │ретение│кой │       │ тия         │закрытия           │  (расч. цена ЦБ,   │ценой, руб. │ мая для  │ретении│        │в валюте│        │        │ ния  │  на   │зации │рете- │                  │       │       │         │         │     │аген-│аген-│\n" + 
"│      │            │        │      │  кой  │      │      │коро-       │                   │уменьш. на 20%;          │выру-│ руб. │       │  ЦБ   │по- │       │корот-       │короткой           │  приобр.по срочн.  │            │  целей   │, руб. │        │номинала│        │        │сделки│приоб- │  в   │ния в │                  │       │       │         │         │     │та по│та по│\n" + 
"│      │            │        │      │позиции│      │      │ткой        │                   │расчетная цена ПАЯ       │ чки │      │       │       │зи- │       │ кой         │позиции)           │сделке), увелич. на │            │налогооб- │       │        │        │        │        │реа-  │ретение│рубле-│рубле-│                  │       │       │         │         │     │сдел-│сдел-│\n" + 
"│      │            │        │      │   )   │      │      │пози-       │                   │                         │ниже │      │       │       │ции │       │пози-        │                   │  20%; расчетная    │            │ ложения, │       │        │        │        │        │лиза- │       │ вый  │ вый  │                  │       │       │         │         │     │ке   │ке   │\n" + 
"│      │            │        │      │       │      │      │ции)        │                   │                         │рыно-│      │       │       │    │       │ ции)        │                   │    цена ПАЯ        │            │   руб.   │       │        │        │        │        │ ции  │       │экви- │экви- ├─────────┬────────┤       │       │         │         │     │реа- │при- │\n" + 
"│      │            │        │      │       │      │      │            │                   │                         │чной │      │       │       │    │       │             │                   │                    │            │          │       │        │        │        │        │      │       │валент│валент│   для   │для     │       │       │         │         │     │лиза-│обре-│\n" + 
"│      │            │        │      │       │      │      ├─────┬──────┼───────┬───────────┼──────┬──────────┬───────┤(рас-│      │       │       │    │       ├──────┬──────┼─────────┬─────────┼─────┬──────┬───────┤            │          │       │        │        │        │        │      │       │      │      │  сделки │сделки  │       │       │         │         │     │ции с│тения│\n" + 
"│      │            │        │      │       │      │      │  в  │   в  │   в   │  в рублях │Цена, │Источник  │ Дата  │чет- │      │       │       │    │       │   в  │   в  │ в валюте│ в рублях│Цена │Источ-│ Дата  │            │          │       │        │        │        │        │      │       │      │      │реализа- │приобре-│       │       │         │         │     │нашим│с    │\n" + 
"│      │            │        │      │       │      │      │валю-│рублях│валюте │           │руб.  │информации│коти-  │ной) │      │       │       │    │       │валюте│рублях│   цены  │         │     │ ник  │котиро-│            │          │       │        │        │        │        │      │       │      │      │   ции   │тения   │       │       │         │         │     │бан- │нашим│\n" + 
"│      │            │        │      │       │      │      │ те  │      │ цены  │           │      │          │ровки  │цены,│      │       │       │    │       │ цены │      │         │         │     │инфор-│  вки  │            │          │       │        │        │        │        │      │       │      │      │         │        │       │       │         │         │     │ком  │бан- │\n" + 
"│      │            │        │      │       │      │      │цены │      │       │           │      │          │       │руб. │      │       │       │    │       │      │      │         │         │     │мации │       │            │          │       │        │        │        │        │      │       │      │      │         │        │       │       │         │         │     │     │ком  │\n" + 
"├──────┼────────────┼────────┼──────┼───────┼──────┼──────┼─────┼──────┼───────┼───────────┼──────┼──────────┼───────┼─────┼──────┼───────┼───────┼────┼───────┼──────┼──────┼─────────┼─────────┼─────┼──────┼───────┼────────────┼──────────┼───────┼────────┼────────┼────────┼────────┼──────┼───────┼──────┼──────┼─────────┼────────┼───────┼───────┼─────────┼─────────┼─────┼─────┼─────┤\n" + 
"│  1   │     2      │   3    │  4   │   5   │  6   │  7   │  8  │  9   │  10   │    11     │  12  │    13    │   14  │ 15  │  16  │  17   │  18   │ 19 │  20   │  21  │  22  │   23    │   24    │ 25  │  26  │  27   │     28     │    29    │  30   │   31   │   32   │   33   │   34   │  Т1  │  Т2   │  Т3  │  Т4  │   Т5    │   Т6   │  Т7   │  Т8   │    Т9   │    Т10  │ Т11 │ Т12 │ Т13 │\n" + 
"├──────┼────────────┼────────┼──────┼───────┼──────┼──────┼─────┼──────┼───────┼───────────┼──────┼──────────┼───────┼─────┼──────┼───────┼───────┼────┼───────┼──────┼──────┼─────────┼─────────┼─────┼──────┼───────┼────────────┼──────────┼───────┼────────┼────────┼────────┼────────┼──────┼───────┼──────┼──────┼─────────┼────────┼───────┼───────┼─────────┼─────────┼─────┼─────┼─────┤";    

PRIVATE VAR TableHeader_0602 = 
"┌───────┬──────┬────────┬──────────────┬──────┬─────┬───────┬────────┬────────┬─────────────────────┬─────────┬───────┬───────┬───────┬──────┬───────┬──────────┬────────────┬───────────────────────┬────────────┬──────────┬───────┬───────────┬──────────┬───────┬────────┬────────┬─────────┬────────┬─────────┬──────────┬───────────────┬──────────────────┬────────┬────────┬─────────┬─────────┬─────┬─────┬─────┐\n" +
"│  Код  │Выпуск│ Номер  │     Дата     │ Дата │Коли-│ Цена  │ Стои-  │  НКД   │Минимальная цена     │  Сумма  │Комис- │ Номер │ Дата  │ Дата │ Цена  │Стоимость │    НКД,    │ Максимальная цена на  │Сумма       │Cтоимость │Комис- │Сумма      │ Расходы  │ НКД,  │ Сумма  │ Сумма  │Процент- │Процент-│Процент- │Количество│Дата выплаты   │       Дата       │Контра- │Контра- │ГО/филиал│ГО/филиал│Нало-│Вза- │Вза- │\n" +
"│бумаги │ценной│ сделки │  заключения  │реали-│чест-│реали- │ мость  │получен-│на дату заключения   │отклоне- │ сия,  │сделки │заклю- │закры-│приоб- │приобрете-│ уплаченный │    дату заключения    │превышения  │приобрете-│ сия,  │частичного │связанные │причи- │купонов,│купонов,│   ный   │  ный   │   ный   │купонов,  │по последнему  │ переквалификации │гент по │гент по │по сделке│по сделке│говая│имо- │имо- │\n" +
"│       │бумаги│реализа-│    сделки    │зации │ во  │ зации │реализа-│ный при │сделки,              │   ния   │уплаче-│приоб- │ чения │ тия  │ретения│   ния    │при покупке │   договора (гр.15),   │стоимости   │   нных   │уплаче-│погашения  │    с     │тающ. к│выплаче-│выплаче-│расход по│расход, │ расход, │подлежащих│купону         │ сделки РЕПО/Займа│ сделке │ сделке │  реали- │ приобре-│груп-│зави-│зави-│\n" +
"│       │      │  ции   │реализации ЦБ │(дата │бумаг│ (цена │  ции   │реализа-│сложивш. на ОРЦБ;    │фактичес-│ нная  │ретения│сделки │корот-│ (цена │(стоимость│(НКД на дату│   сложивш. на ОРЦБ;   │приобретения│  ценных  │ нная  │номинала,  │закрытием │получе-│  нных  │  нных  │операции,│учтенный│учитывае-│полученнию│в отчетном     │                  │реализа-│приобре-│  зации  │  тения  │ па  │си-  │си-  │\n" +
"│       │      │        │              │откры-│, шт.│откры- │ (стои- │ции (НКД│расчетная цена для ЦБ│   кой   │  при  │       │  на   │ кой  │закры- │ закрытия │  закрытия  │ расчетная цена для ЦБ │над рыночной│  бумаг   │  при  │выплаченная│ короткой │нию от │эмитен- │эмитен- │связанной│  для   │ мый для │в отчетном│периоде        │                  │  ции   │ тения  │         │         │     │мость│мость│\n" +
"│       │      │        │              │ тия  │     │  тия  │ мость  │на дату │не обращ. на ОРЦБ    │ выручки │реали- │       │приоб- │пози- │  тия  │ короткой │  короткой  │   не обращ. на ОРЦБ   │(расчетной) │(стоимость│приоб- │эмитентом  │ позиции  │эмитен-│ том до │ том в  │    с    │ целей  │  целей  │периоде   │в соответствии │                  │        │        │         │         │     │контр│контр│\n" +
"│       │      │        │              │корот-│     │корот- │открытия│открытия│(расч. цена ЦБ,      │  ниже   │зации, │       │ретение│ ции  │корот- │позиции), │  позиции), │    (расч. цена ЦБ,    │ценой, руб. │ закрытия │ретении│за период  │  (кроме  │ та на │ начала │текущем │открытием│налогоо-│налогооб-│          │со справочником│                  │        │        │         │         │     │аген-│аген-│\n" +
"│       │      │        │              │ кой  │     │  кой  │короткой│короткой│реализ.по срочн.     │рыночной │ руб.  │       │  ЦБ   │      │  кой  │   руб.   │    руб.    │   приобр.по срочн.    │            │ короткой │, руб. │от даты    │НКД), руб.│ конец │текущего│отчетном│короткой │бложения│ложения в│          │               │                  │        │        │         │         │     │та по│та по│\n" +
"│       │      │        │              │пози- │     │позиции│позиции)│позиции)│сделке),             │(расчет- │       │       │       │      │позиции│          │            │сделке), увелич. на 20%│            │позиции), │       │открытия   │          │преды- │отчетно-│(налого-│позиции -│   до   │ текущем │          │               │                  │        │        │         │         │     │сдел-│сдел-│\n" +
"│       │      │        │              │ ции) │     │), % от│ , руб. │ , руб. │уменьш. на 20%       │  ной)   │       │       │       │      │), в % │          │            │                       │            │принимае- │       │до даты    │          │дущего │   го   │  вом)  │ всего,  │ начала │отчетном │          │               │                  │        │        │         │         │     │ке   │ке   │\n" +
"│       │      │        │              │      │     │номина-│        │        │                     │  цены,  │       │       │       │      │  от   │          │            │                       │            │ мая для  │       │закрытия   │          │налого-│(налого-│периоде,│  руб.   │текущего│(налого- │          │               ├─────────┬────────┤        │        │         │         │     │реа- │при- │\n" +
"│       │      │        │              │      │     │  ла   │        │        ├──────┬───────┬──────┤  руб.   │       │       │       │      │номина-│          │            ├──────┬────────┬───────┤            │  целей   │       │КП, руб.   │          │ вого  │ вого)  │  руб.  │         │отчетно-│  вом)   │          │               │   для   │для     │        │        │         │         │     │лиза-│обре-│\n" +
"│       │      │        │              │      │     │       │        │        │ Цена,│       │ Дата │         │       │       │       │      │  ла   │          │            │ Цена,│        │  Дата │            │налогооб- │       │           │          │периода│периода,│        │         │   го   │периоде, │          │               │  сделки │сделки  │        │        │         │         │     │ции с│тения│\n" +
"│       │      │        │              │      │     │       │        │        │в % от│Источ- │коти- │         │       │       │       │      │       │          │            │в % от│Источник│котиро-│            │ ложения, │       │           │          │, руб. │  руб.  │        │         │(налого-│  руб.   │          │               │реализа- │приобре-│        │        │         │         │     │нашим│с    │\n" +
"│       │      │        │              │      │     │       │        │        │номи- │  ник  │ровки │         │       │       │       │      │       │          │            │номи- │информа-│  вки  │            │   руб.   │       │           │          │       │        │        │         │ вого)  │         │          │               │   ции   │тения   │        │        │         │         │     │бан- │нашим│\n" +
"│       │      │        │              │      │     │       │        │        │ нала │инфор- │      │         │       │       │       │      │       │          │            │ нала │  ции   │       │            │          │       │           │          │       │        │        │         │периода,│         │          │               │         │        │        │        │         │         │     │ком  │бан- │\n" +
"│       │      │        │              │      │     │       │        │        │      │ мации │      │         │       │       │       │      │       │          │            │      │        │       │            │          │       │           │          │       │        │        │         │  руб.  │         │          │               │         │        │        │        │         │         │     │     │ком  │\n" +
"│       │      │        │              │      │     │       │        │        │      │       │      │         │       │       │       │      │       │          │            │      │        │       │            │          │       │           │          │       │        │        │         │        │         │          │               │         │        │        │        │         │         │     │     │     │\n" +
"├───────┼──────┼────────┼──────────────┼──────┼─────┼───────┼────────┼────────┼──────┼───────┼──────┼─────────┼───────┼───────┼───────┼──────┼───────┼──────────┼────────────┼──────┼────────┼───────┼────────────┼──────────┼───────┼───────────┼──────────┼───────┼────────┼────────┼─────────┼────────┼─────────┼──────────┼───────────────┼─────────┼────────┼────────┼────────┼─────────┼─────────┼─────┼─────┼─────┤\n" +
"│   1   │  2   │   3    │      4       │  5   │  6  │   7   │   8    │   9    │  10  │  11   │  12  │   13    │  14   │  15   │  16   │  17  │  18   │    19    │     20     │  21  │   22   │  23   │     24     │    25    │  26   │     27    │    28    │  29   │   30   │   31   │   32    │   33   │   34    │    T1    │       T2      │   Т3    │   Т4   │   T5   │   T6   │    Т7   │    Т8   │ T9  │ Т10 │ Т11 │\n" +
"├───────┼──────┼────────┼──────────────┼──────┼─────┼───────┼────────┼────────┼──────┼───────┼──────┼─────────┼───────┼───────┼───────┼──────┼───────┼──────────┼────────────┼──────┼────────┼───────┼────────────┼──────────┼───────┼───────────┼──────────┼───────┼────────┼────────┼─────────┼────────┼─────────┼──────────┼───────────────┼─────────┼────────┼────────┼────────┼─────────┼─────────┼─────┼─────┼─────┤"; 

PRIVATE VAR TableHeader_0603 = 
"┌───────────┬────────────────────┬─────────────┬───────────┬──────────┬─────────┬──────────┬─────────┬─────────────────┬───────────┬────────────┬─────────────┬──────────────────────────────┬────────────┬────────────┬────────────┬─────────────┬─────────────┬──────────────┬──────────────┬───────────────────────────────────┬─────────────┬─────────────────┬──────────────┬────────────┬────────────┬───────────────┬───────────────┬──────────────────┬────────────┬───────────┬─────────┬─────────┬─────┬─────┬─────┐\n" +
"│ Код       │Выпуск              │   Номер     │   Дата    │   Дата   │Номинал, │   Дата   │  Дата   │Средневзвешенная │Количество │    Цена    │  Стоимость  │     Минимальная цена         │   Сумма    │ Комиссия,  │Номер сделки│    Дата     │Дата закрытия│     Цена     │  Стоимость   │Максимальная цена на дату          │Сумма        │    Стоимость    │  Комиссия,   │Расходы     │Процентный  │Процентный     │Процентный     │       Дата       │Контрагент  │ Контрагент│ГО/филиал│ГО/филиал│Налог│Вза- │Вза- │\n" +
"│бумаги     │ценной              │  сделки     │заключения │реализации│  руб.   │размещения│погашения│цена размещения, │бумаг, шт. │ реализации │ реализации  │    на дату заключения        │ отклонения │ уплаченная │приобретения│ заключения  │  короткой   │приобретения  │приобретения  │заключения сделки, сложивш.        │превышения   │  приобретенных  │уплаченная при│связанные   │расход      │расход,        │расход,        │ переквалификации │ по сделке  │ по сделке │по сделке│по сделке│овая │имо- │имо- │\n" +
"│           │бумаги              │реализации   │  сделки   │  (дата   │         │          │         │  % от номинала  │           │  (цена     │(стоимость   │         сделки,              │фактической │    при     │            │ сделки на   │  позиции    │(цена закрытия│(стоимость    │на ОРЦБ; расчетная цена для        │стоимости    │  ценных бумаг   │приобретении, │с закрытием │по операции,│учтенный       │учтенный       │ сделки РЕПО/Займа│реализации  │приобрете  │  реали- │ приобре-│груп │зави-│зави-│\n" +
"│           │                    │             │реализации │ открытия │         │          │         │                 │           │ открытия   │ открытия    │     сложивш. на ОРЦБ;        │выручки ниже│реализации, │            │приобретение │             │  короткой    │закрытия      │ЦБ не обращ. на ОРЦБ (расч.        │приобретения │  (стоимость     │     руб.     │короткой    │связанной с │для целей      │для целей      │                  │            │ния        │  зации  │  тения  │па   │си-  │си-  │\n" +
"│           │                    │             │    ЦБ     │ короткой │         │          │         │                 │           │ короткой   │ короткой    │    расчетная цена для ЦБ     │  рыночной  │    руб.    │            │     ЦБ      │             │ позиции),    │короткой      │цена ЦБ, приобр.по срочн.          │над рыночной │   закрытия      │              │позиции,    │открытием   │налогообложения│налогообложения│                  │            │           │         │         │     │мость│мость│\n" +
"│           │                    │             │           │ позиции) │         │          │         │                 │           │ позиции),  │ позиции),   │     не обращ. на ОРЦБ        │(расчетной) │            │            │             │             │ в % от       │позиции),     │сделке), увелич. на 20%            │(расчетной)  │   короткой      │              │руб.        │короткой    │до начала      │в текущем      │                  │            │           │         │         │     │контр│контр│\n" +
"│           │                    │             │           │          │         │          │         │                 │           │   % от     │   руб.      │       (расч. цена ЦБ,        │ цены, руб. │            │            │             │             │ номинала     │руб.          │                                   │ценой, руб.  │   позиции),     │              │            │позиции -   │текущего       │отчетном       │                  │            │           │         │         │     │аген-│аген-│\n" +
"│           │                    │             │           │          │         │          │         │                 │           │ номинала   │             │       реализ.по срочн.       │            │            │            │             │             │              │              │                                   │             │ принимаемая для │              │            │всего, руб. │отчетного      │(налоговом)    │                  │            │           │         │         │     │та по│та по│\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │           сделке),           │            │            │            │             │             │              │              │                                   │             │      целей      │              │            │            │(налогового)   │периоде,       │                  │            │           │         │         │     │сдел-│сдел-│\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │        уменьш. на 20%        │            │            │            │             │             │              │              │                                   │             │налогообложения, │              │            │            │периода,       │руб.           │                  │            │           │         │         │     │ке   │ке   │\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │                              │            │            │            │             │             │              │              │                                   │             │      руб.       │              │            │            │руб.           │               ├─────────┬────────┤            │           │         │         │     │реа- │при- │\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │                              │            │            │            │             │             │              │              │                                   │             │                 │              │            │            │               │               │   для   │для     │            │           │         │         │     │лиза-│обре-│\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │                              │            │            │            │             │             │              │              │                                   │             │                 │              │            │            │               │               │  сделки │сделки  │            │           │         │         │     │ции с│тения│\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │                              │            │            │            │             │             │              │              │                                   │             │                 │              │            │            │               │               │реализа- │приобре-│            │           │         │         │     │нашим│с    │\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │                              │            │            │            │             │             │              │              │                                   │             │                 │              │            │            │               │               │   ции   │тения   │            │           │         │         │     │бан- │нашим│\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │                              │            │            │            │             │             │              │              │                                   │             │                 │              │            │            │               │               │         │        │            │           │         │         │     │ком  │бан- │\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             ├────────┬───────────┬─────────┤            │            │            │             │             │              │              ├─────────────┬───────────┬─────────┤             │                 │              │            │            │               │               │         │        │            │           │         │         │     │     │ком  │\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │Цена, в │ Источник  │  Дата   │            │            │            │             │             │              │              │Цена, в % от │ Источник  │  Дата   │             │                 │              │            │            │               │               │         │        │            │           │         │         │     │     │     │\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │  % от  │информации │котировки│            │            │            │             │             │              │              │  номинала   │информации │котировки│             │                 │              │            │            │               │               │         │        │            │           │         │         │     │     │     │\n" +
"│           │                    │             │           │          │         │          │         │                 │           │            │             │номинала│           │         │            │            │            │             │             │              │              │             │           │         │             │                 │              │            │            │               │               │         │        │            │           │         │         │     │     │     │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼─────────┼──────────┼─────────┼─────────────────┼───────────┼────────────┼─────────────┼────────┼───────────┼─────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼──────────────┼─────────────┼───────────┼─────────┼─────────────┼─────────────────┼──────────────┼────────────┼────────────┼───────────────┼───────────────┼─────────┼────────┼────────────┼───────────┼─────────┼─────────┼─────┼─────┼─────┤\n" +
"│  1        │   2                │     3       │     4     │     5    │    6    │    7     │    8    │        9        │    10     │     11     │     12      │   13   │    14     │   15    │     16     │     17     │     18     │     19      │     20      │      21      │      22      │     23      │    24     │   25    │     26      │       27        │      28      │     29     │     30     │       31      │       32      │   Т1    │   Т2   │    Т3      │     Т4    │    Т5   │    Т6   │ Т7  │ Т8  │ Т9  │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼─────────┼──────────┼─────────┼─────────────────┼───────────┼────────────┼─────────────┼────────┼───────────┼─────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼──────────────┼─────────────┼───────────┼─────────┼─────────────┼─────────────────┼──────────────┼────────────┼────────────┼───────────────┼───────────────┼─────────┼────────┼────────────┼───────────┼─────────┼─────────┼─────┼─────┼─────┤";


PRIVATE VAR TableHeader_0604 = 
"┌───────────┬────────────────────┬─────────────┬───────────┬──────────┬────────┬───────────┬────────────┬─────────────────┬──────────────────────────────┬────────────┬────────────┬────────────┬─────────────┬─────────────┬──────────────┬───────────────────┬──────────────────────────────┬─────────────┬─────────────────┬──────────────┬────────┬────────┬────────┬────────────┬───────────┬───────────┬───────────┬───────────┬───────────┬────────────┬──────────┬────────────┬──────────────────┬────────────┬───────────┬─────────┬─────────┬─────┬─────────┬─────────┐\n" +
"│ Код       │Выпуск              │  Номер      │   Дата    │   Дата   │  Код   │Количество │   Цена     │Стоимость        │     Минимальная цена         │   Сумма    │ Комиссия,  │Номер сделки│    Дата     │Дата закрытия│     Цена     │ Стоимость         │ Максимальная цена на дату    │Сумма        │    Стоимость    │  Комиссия,   │Дата    │Объяв-  │Начисле-│Расходы     │Код валюты │   Цена    │Код валюты │   Цена    │Курс ЦБ РФ │ Курс ЦБ РФ │Курс ЦБ РФ│Курс ЦБ РФ  │       Дата       │Контрагент  │ Контрагент│ГО/филиал│ГО/филиал│Налог│Взаимоза-│Взаимоза-│\n" +
"│бумаги     │ценной              │  сделки     │заключения │реализации│ валюты │бумаг, шт. │реализации  │реализации       │    на дату заключения        │ отклонения │ уплаченная │приобретения│ заключения  │  короткой   │приобретения  │приобретения       │   заключения сделки,         │превышения   │  приобретенных  │уплаченная при│состав- │ленная  │но эми- │связанные   │   цены    │  покупки  │   цены    │  продажи  │  на дату  │  на дату   │ на дату  │на дату     │ переквалификации │ по сделке  │ по сделке │по сделке│по сделке│овая │висимость│висимость│\n" +
"│           │бумаги              │реализации   │  сделки   │  (дата   │номинала│           │ (цена      │(стоимость       │         сделки,              │фактической │    при     │            │ сделки на   │  позиции    │(цена закрытия│(стоимость закрытия│сложивш. на ОРЦБ, расчетная   │стоимости    │  ценных бумаг   │приобретении, │ления   │сумма   │тентом -│с закрытием │  покупки  │  в валюте │  продажи  │  в валюте │заключения │ заключения │реализации│закрытия    │ сделки РЕПО/Займа│реализации  │приобрете  │  реали- │ приобре-│груп │контр-   │контр-   │\n" +
"│           │                    │             │реализации │ открытия │        │           │открытия    │открытия         │     сложивш. на ОРЦБ;        │выручки ниже│реализации, │            │приобретение │             │  короткой    │короткой позиции)  │ цена для ЦБ не обращ. на     │приобретения │  (стоимость     │     руб.     │списка  │дивиден-│ всего, │короткой    │           │   цены    │           │   цены    │сделки на  │сделки на   │          │короткой    │                  │            │ния        │  зации  │  тения  │па   │агента по│агента по│\n" +
"│           │                    │             │    ЦБ     │ короткой │        │           │короткой    │короткой позиции)│    расчетная цена для ЦБ     │  рыночной  │    руб     │            │     ЦБ      │             │ позиции),    │                   │   ОРЦБ (расч. цена ЦБ,       │над рыночной │   закрытия      │              │акционе-│дов на 1│ руб.   │позиции,    │           │           │           │           │реализацию │приобретение│          │позиции     │                  │            │           │         │         │     │сделке   │сделке   │\n" +
"│           │                    │             │           │ позиции) │        │           │позиции),   │                 │     не обращ. на ОРЦБ        │(расчетной) │            │            │             │             │ в валюте     │                   │ приобр.по срочн. сделке),    │(расчетной)  │   короткой      │              │ров     │ акцию, │        │руб.        │           │           │           │           │           │            │          │            │                  │            │           │         │         │     │реализа- │приобре- │\n" +
"│           │                    │             │           │          │        │           │  в валюте  │                 │       (расч. цена ЦБ,        │ цены, руб. │            │            │             │             │ номинала     │                   │      увелич. на 20%          │ценой, руб.  │   позиции),     │              │        │в валюте│        │            │           │           │           │           │           │            │          │            │                  │            │           │         │         │     │ции с    │тения с  │\n" +
"│           │                    │             │           │          │        │           │ номинала   │                 │       реализ.по срочн.       │            │            │            │             │             │              │                   │                              │             │ принимаемая для │              │        │номинала│        │            │           │           │           │           │           │            │          │            │                  │            │           │         │         │     │нашим    │нашим    │\n" +
"│           │                    │             │           │          │        │           │            │                 │           сделке),           │            │            │            │             │             │              │                   │                              │             │      целей      │              │        │        │        │            │           │           │           │           │           │            │          │            │                  │            │           │         │         │     │банком   │банком   │\n" +
"│           │                    │             │           │          │        │           │            │                 │        уменьш. на 20%        │            │            │            │             │             │              │                   │                              │             │налогообложения, │              │        │        │        │            │           │           │           │           │           │            │          │            │                  │            │           │         │         │     │         │         │\n" +
"│           │                    │             │           │          │        │           │            ├──────────┬──────┼────────┬───────────┬─────────┤            │            │            │             │             │              ├────────────┬──────┼─────────┬──────────┬─────────┤             │      руб.       │              │        │        │        │            │           │           │           │           │           │            │          │            ├─────────┬────────┤            │           │         │         │     │         │         │\n" +
"│           │                    │             │           │          │        │           │            │ в валюте │  в   │Цена,   │ Источник  │  Дата   │            │            │            │             │             │              │  в валюте  │  в   │Цена,    │ Источник │  Дата   │             │                 │              │        │        │        │            │           │           │           │           │           │            │          │            │   для   │для     │            │           │         │         │     │         │         │\n" +
"│           │                    │             │           │          │        │           │            │ номинала │рублях│в валюте│информации │котировки│            │            │            │             │             │              │  номинала  │рублях│в валюте │информации│котировки│             │                 │              │        │        │        │            │           │           │           │           │           │            │          │            │  сделки │сделки  │            │           │         │         │     │         │         │\n" +
"│           │                    │             │           │          │        │           │            │          │      │номинала│           │         │            │            │            │             │             │              │            │      │номинала │          │         │             │                 │              │        │        │        │            │           │           │           │           │           │            │          │            │реализа- │приобре-│            │           │         │         │     │         │         │\n" +
"│           │                    │             │           │          │        │           │            │          │      │        │           │         │            │            │            │             │             │              │            │      │         │          │         │             │                 │              │        │        │        │            │           │           │           │           │           │            │          │            │   ции   │тения   │            │           │         │         │     │         │         │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼────────┼───────────┼────────────┼──────────┼──────┼────────┼───────────┼─────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼──────┼─────────┼──────────┼─────────┼─────────────┼─────────────────┼──────────────┼────────┼────────┼────────┼────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼────────────┼──────────┼────────────┼─────────┼────────┼────────────┼───────────┼─────────┼─────────┼─────┼─────────┼─────────┤\n" +
"│  1        │   2                │    3        │     4     │     5    │   6    │     7     │     8      │    9     │  10  │   11   │    12     │   13    │     14     │     15     │     16     │     17      │     18      │      19      │     20     │  21  │    22   │    23    │   24    │     25      │       26        │      27      │   28   │   29   │   30   │     31     │    Т1     │    Т2     │    Т3     │    Т4     │    Т5     │     Т6     │    Т7    │     Т8     │   Т9    │   Т10  │    Т11     │     Т12   │    Т13  │    Т14  │ Т15 │   Т16   │   Т17   │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼────────┼───────────┼────────────┼──────────┼──────┼────────┼───────────┼─────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼──────┼─────────┼──────────┼─────────┼─────────────┼─────────────────┼──────────────┼────────┼────────┼────────┼────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼────────────┼──────────┼────────────┼─────────┼────────┼────────────┼───────────┼─────────┼─────────┼─────┼─────────┼─────────┤";   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          

                                                                                                                                                                                                                                                                                                                                                                         
PRIVATE VAR TableHeader_0605 = 
"┌──────┬─────────────────┬────────┬──────┬──────┬─────┬─────┬──────┬───────────────────┬─────────────────┬─────────────────────┬────────┬───────┬────────┬───────┬───────┬───────┬────────────────┬────────────────┬────────────────────────┬─────────────┬──────────┬────────┬─────────────────────┬─────────┬────────────────┬─────────────────┬─────────────────┬────────┬────────┬─────────┬───────────┬───────────┬───────────┬────────────┬──────────┬────────────┬──────────┬───────────────┬──────────────────┬───────┬─────────┬─────────┬─────────┬──────┬─────┬─────┐\n" +
"│ Код  │  Выпуск ценной  │ Номер  │ Дата │ Дата │ Код │Коли-│ Цена │     Стоимость     │  НКД полученный │ Минимальная цена    │ Сумма  │Комис- │ Номер  │ Дата  │ Дата  │ Цена  │   Стоимость    │НКД, уплаченный │  Максимальная цена на  │Сумма        │Cтоимость │Комиссия│Сумма частичного     │ Расходы │ НКД, причитающ.│  Сумма купонов, │ Сумма купонов,  │Процент-│Процент-│Процент- │Код валюта │Код валюта │Курс ЦБ РФ │ Курс ЦБ РФ │Курс ЦБ РФ│ Курс ЦБ РФ │Количество│Дата выплаты   │       Дата       │Контра-│ Контра- │ГО/филиал│ГО/филиал│Нало- │Вза- │Вза- │\n" +
"│бумаги│     бумаги      │ сделки │заклю-│реали-│валю-│чест-│реали-│    реализации     │ при реализации  │на дату заключения   │отклоне-│ сия,  │ сделки │заклю- │закры- │приоб- │  приобретения  │  при покупке   │    дату заключения     │превышения   │приобрете-│   ,    │погашения номинала,  │связанные│ к получению от │   выплаченных   │   выплаченных   │  ный   │  ный   │   ный   │   цены    │   цены    │  на дату  │  на дату   │ на дату  │  на дату   │купонов,  │по последнему  │ переквалификации │гент по│ гент по │по сделке│по сделке│говая │имо- │имо- │\n" +
"│      │                 │реализа-│чения │зации │ ты  │ во  │зации │(стоимость открытия│  (НКД на дату   │     сделки,         │  ния   │уплаче-│приобре-│ чения │  тия  │ретения│   (стоимость   │  (НКД на дату  │ договора, сложивш. на  │стоимости    │   нных   │уплачен-│выплаченная эмитентом│    с    │  эмитента на   │  эмитентом до   │   эмитентом в   │ расход │расход, │ расход, │  покупки  │  продажи  │заключения │ заключения │реализации│  закрытия  │подлежащих│купону         │ сделки РЕПО/Займа│сделке │ сделке  │  реали- │ приобре-│группа│зави-│зави-│\n" +
"│      │                 │  ции   │сделки│(дата │номи-│бумаг│(цена │ короткой позиции) │открытия короткой│ сложивш. на ОРЦБ;   │фактиче-│ нная  │ тения  │сделки │корот- │ (цена │    закрытия    │    закрытия    │ОРЦБ; расчетная цена для│приобретения │  ценных  │ная при │за период от даты    │закрытием│     конец      │ начала текущего │текущем отчетном │   по   │учтенный│учитывае-│           │           │сделки     │сделки на   │          │  короткой  │полученнию│в отчетном     │                  │реали- │приобре- │  зации  │  тения  │      │си-  │си-  │\n" +
"│      │                 │        │реали-│откры-│нала │, шт.│откры-│                   │    позиции)     │расчетная цена для ЦБ│  ской  │  при  │        │  на   │  кой  │закры- │    короткой    │    короткой    │  ЦБ не обращ. на ОРЦБ  │над рыночной │  бумаг   │приобре-│открытия до даты     │короткой │  предыдущего   │    отчетного    │   (налоговом)   │операции│  для   │ мый для │           │           │реализации │приобретение│          │  позиции   │в отчетном│периоде        │                  │ зации │  тения  │         │         │      │мость│мость│\n" +
"│      │                 │        │зации │ тия  │     │     │ тия  │                   │                 │ не обращ. на ОРЦБ   │выручки │реали- │        │приоб- │позиции│  тия  │    позиции)    │    позиции)    │    (расч. цена ЦБ,     │(расчетной)  │(стоимость│ тении, │закрытия КП          │ позиции │   налогового   │  (налогового)   │  периоде, руб.  │   ,    │ целей  │  целей  │           │           │           │            │          │            │периоде   │в соответствии │                  │       │         │         │         │      │контр│контр│\n" +
"│      │                 │        │  ЦБ  │корот-│     │     │корот-│                   │                 │   (расч. цена ЦБ,   │  ниже  │зации, │        │ретение│       │корот- │                │                │    приобр.по срочн.    │ценой, руб.  │ закрытия │  руб.  │                     │ (кроме  │ периода, руб.  │  периода, руб.  │                 │связан- │налогоо-│налогооб-│           │           │           │            │          │            │          │со справочником│                  │       │         │         │         │      │аген-│аген-│\n" +
"│      │                 │        │      │ кой  │     │     │ кой  │                   │                 │   реализ.по срочн.  │рыночной│ руб.  │        │  ЦБ   │       │  кой  │                │                │сделке), увелич. на 20% │             │ короткой │        │                     │  НКД),  │                │                 │                 │ ной с  │бложения│ложения в│           │           │           │            │          │            │          │               │                  │       │         │         │         │      │та по│та по│\n" +
"│      │                 │        │      │пози- │     │     │пози- │                   │                 │       сделке),      │(расчет-│       │        │       │       │позиции│                │                │                        │             │позиции), │        │                     │  руб.   │                │                 │                 │открыти-│   до   │ текущем │           │           │           │            │          │            │          │               │                  │       │         │         │         │      │сдел-│сдел-│\n" +
"│      │                 │        │      │ ции) │     │     │ции), │                   │                 │    уменьш. на 20%   │  ной)  │       │        │       │       │), в % │                │                │                        │             │принимае- │        │                     │         │                │                 │                 │   ем   │ начала │отчетном │           │           │           │            │          │            │          │               │                  │       │         │         │         │      │ке   │ке   │\n" +
"│      │                 │        │      │      │     │     │ % от │                   │                 │                     │ цены,  │       │        │       │       │  от   │                │                │                        │             │ мая для  │        │                     │         │                │                 │                 │короткой│текущего│(налого- │           │           │           │            │          │            │          │               ├─────────┬────────┤       │         │         │         │      │реа- │при- │\n" +
"│      │                 │        │      │      │     │     │номи- │                   │                 │                     │  руб.  │       │        │       │       │номина-│                │                │                        │             │  целей   │        │                     │         │                │                 │                 │позиции │отчетно-│  вом)   │           │           │           │            │          │            │          │               │   для   │для     │       │         │         │         │      │лиза-│обре-│\n" +
"│      │                 │        │      │      │     │     │ нала │                   │                 │                     │        │       │        │       │       │  ла   │                │                │                        │             │налогооб- │        │                     │         │                │                 │                 │- всего,│   го   │периоде, │           │           │           │            │          │            │          │               │  сделки │сделки  │       │         │         │         │      │ции с│тения│\n" +
"│      │                 │        │      │      │     │     │      │                   │                 │                     │        │       │        │       │       │       │                │                │                        │             │ ложения, │        │                     │         │                │                 │                 │  руб.  │(налого-│  руб.   │           │           │           │            │          │            │          │               │реализа- │приобре-│       │         │         │         │      │нашим│с    │\n" +
"│      │                 │        │      │      │     │     │      │                   │                 │                     │        │       │        │       │       │       │                │                │                        │             │   руб.   │        │                     │         │                │                 │                 │        │ вого)  │         │           │           │           │            │          │            │          │               │   ции   │тения   │       │         │         │         │      │бан- │нашим│\n" +
"│      │                 │        │      │      │     │     │      │                   │                 │                     │        │       │        │       │       │       │                │                │                        │             │          │        │                     │         │                │                 │                 │        │периода,│         │           │           │           │            │          │            │          │               │         │        │       │         │         │         │      │ком  │бан- │\n" +
"│      │                 │        │      │      │     │     │      │                   │                 │                     │        │       │        │       │       │       │                │                │                        │             │          │        │                     │         │                │                 │                 │        │  руб.  │         │           │           │           │            │          │            │          │               │         │        │       │         │         │         │      │     │ком  │\n" +
"│      │                 │        │      │      │     │     │      ├───────┬───────────┼───────┬─────────┼──────┬───────┬──────┤        │       │        │       │       │       ├──────┬─────────┼──────┬─────────┼───────┬────────┬───────┤             │          │        ├─────────┬───────────┤         ├──────┬─────────┼───────┬─────────┼──────┬──────────┤        │        │         │           │           │           │            │          │            │          │               │         │        │       │         │         │         │      │     │     │\n" +
"│      │                 │        │      │      │     │     │      │   в   │  в рублях │   в   │ в рублях│ Цена,│       │ Дата │        │       │        │       │       │       │   в  │ в рублях│   в  │ в рублях│ Цена, │        │  Дата │             │          │        │     в   │ в рублях  │         │   в  │ в рублях│   в   │ в рублях│   в  │ в рублях │        │        │         │           │           │           │            │          │            │          │               │         │        │       │         │         │         │      │     │     │\n" +
"│      │                 │        │      │      │     │     │      │валюте │           │валюте │         │в % от│Источ- │коти- │        │       │        │       │       │       │валюте│         │валюте│         │в % от │Источник│котиро-│             │          │        │  валюте │           │         │валюте│         │валюте │         │валюте│          │        │        │         │           │           │           │            │          │            │          │               │         │        │       │         │         │         │      │     │     │\n" +
"│      │                 │        │      │      │     │     │      │номина-│           │номина-│         │номи- │  ник  │ровки │        │       │        │       │       │       │номи- │         │номи- │         │номина-│информа-│  вки  │             │          │        │  номи-  │           │         │номи- │         │номина-│         │номи- │          │        │        │         │           │           │           │            │          │            │          │               │         │        │       │         │         │         │      │     │     │\n" +
"│      │                 │        │      │      │     │     │      │  ла   │           │  ла   │         │ нала │инфор- │      │        │       │        │       │       │       │ нала │         │ нала │         │  ла   │  ции   │       │             │          │        │   нала  │           │         │ нала │         │  ла   │         │ нала │          │        │        │         │           │           │           │            │          │            │          │               │         │        │       │         │         │         │      │     │     │\n" +
"│      │                 │        │      │      │     │     │      │       │           │       │         │      │ мации │      │        │       │        │       │       │       │      │         │      │         │       │        │       │             │          │        │         │           │         │      │         │       │         │      │          │        │        │         │           │           │           │            │          │            │          │               │         │        │       │         │         │         │      │     │     │\n" +
"│      │                 │        │      │      │     │     │      │       │           │       │         │      │       │      │        │       │        │       │       │       │      │         │      │         │       │        │       │             │          │        │         │           │         │      │         │       │         │      │          │        │        │         │           │           │           │            │          │            │          │               │         │        │       │         │         │         │      │     │     │\n" +
"├──────┼─────────────────┼────────┼──────┼──────┼─────┼─────┼──────┼───────┼───────────┼───────┼─────────┼──────┼───────┼──────┼────────┼───────┼────────┼───────┼───────┼───────┼──────┼─────────┼──────┼─────────┼───────┼────────┼───────┼─────────────┼──────────┼────────┼─────────┼───────────┼─────────┼──────┼─────────┼───────┼─────────┼──────┼──────────┼────────┼────────┼─────────┼───────────┼───────────┼───────────┼────────────┼──────────┼────────────┼──────────┼───────────────┼─────────┼────────┼───────┼─────────┼─────────┼─────────┼──────┼─────┼─────┤\n" +
"│  1   │        2        │   3    │  4   │  5   │  6  │  7  │  8   │   9   │    10     │  11   │   12    │  13  │  14   │  15  │   16   │  17   │   18   │  19   │  20   │  21   │  22  │   23    │  24  │   25    │  26   │   27   │  28   │      29     │    30    │   31   │    32   │    33     │   34    │  35  │   36    │  37   │   38    │  39  │    40    │   41   │   42   │   43    │    Т1     │    Т2     │    Т3     │     Т4     │    Т5    │     Т6     │    T7    │      T8       │   Т9    │   Т10  │  T11  │   T12   │   Т13   │   Т14   │  T15 │ Т16 │ Т17 │\n" +
"├──────┼─────────────────┼────────┼──────┼──────┼─────┼─────┼──────┼───────┼───────────┼───────┼─────────┼──────┼───────┼──────┼────────┼───────┼────────┼───────┼───────┼───────┼──────┼─────────┼──────┼─────────┼───────┼────────┼───────┼─────────────┼──────────┼────────┼─────────┼───────────┼─────────┼──────┼─────────┼───────┼─────────┼──────┼──────────┼────────┼────────┼─────────┼───────────┼───────────┼───────────┼────────────┼──────────┼────────────┼──────────┼───────────────┼─────────┼────────┼───────┼─────────┼─────────┼─────────┼──────┼─────┼─────┤";

PRIVATE VAR TableHeader_0606 = 
"┌───────────┬────────────────────┬─────────────┬───────────┬──────────┬───────┬────────┬──────────┬─────────┬───────────┬────────────┬───────────────────┬───────────────────────────────────┬────────────┬────────────┬────────────┬─────────────┬─────────────┬──────────────┬────────────────────┬───────────────────────────────────┬─────────────┬─────────────────┬──────────────┬────────────┬───────────────────────────┬───────────────────────────┬───────────────┬──────────┬────────────┬──────────────────┬────────────┬───────────┬─────────┬─────────┬─────┬─────┬─────┐\n" +
"│  Код      │Выпуск              │   Номер     │   Дата    │   Дата   │Номинал│ Валюта │   Дата   │  Дата   │Количество │   Цена     │Стоимость          │     Минимальная цена              │   Сумма    │ Комиссия,  │Номер сделки│    Дата     │Дата закрытия│     Цена     │ Стоимость          │Максимальная                       │Сумма        │    Стоимость    │  Комиссия,   │Расходы при │Процентный расход, учтенный│Процентный расход по       │Процентный     │Курс ЦБ РФ│ Курс ЦБ РФ │       Дата       │Контрагент  │ Контрагент│ГО/филиал│ГО/филиал│Налог│Вза- │Вза- │\n" +
"│ценной     │ценной              │  сделки     │заключения │реализации│       │номинала│размещения│погашения│бумаг, шт. │реализации  │реализации         │    на дату заключения             │ отклонения │ уплаченная │приобретения│ заключения  │  короткой   │приобретения, │приобретения        │цена на дату                       │превышения   │  приобретенных  │уплаченная при│реализации, │для целей налогообложения  │операции, связанной с      │расход,        │ на дату  │  на дату   │ переквалификации │ по сделке  │ по сделке │по сделке│по сделке│овая │имо- │имо- │\n" +
"│бумаги     │бумаги              │реализации   │ сделки на │  (дата   │       │        │          │         │           │ (цена      │(стоимость         │         сделки,                   │фактической │    при     │            │ сделки      │   позиции   │    в % от    │                    │ заключения                        │стоимости    │  ценных бумаг,  │приобретении, │    руб.    │    до начала текущего     │открытием короткой         │учтываемый     │реализации│  закрытия  │ сделки РЕПО/Займа│реализации  │приобрете  │  реали- │ приобре-│груп │зави-│зави-│\n" +
"│           │                    │             │реализацию │ открытия │       │        │          │         │           │открытия    │открытия           │     сложивш. на ОРЦБ;             │выручки ниже│реализации, │            │приобретения │             │   номинала   │                    │  сделки,                          │приобретения │ принимаемая для │     руб.     │            │  отчетного (налогового)   │позиции - всего            │для целей      │          │  короткой  │                  │            │ния        │  зации  │  тения  │па   │си-  │си-  │\n" +
"│           │                    │             │    ЦБ     │ короткой │       │        │          │         │           │короткой    │короткой позиции)  │    расчетная цена для ЦБ          │  рыночной  │    руб.    │            │     ЦБ      │             │              │                    │ сложивш. на                       │над рыночной │      целей      │              │            │         периода           │                           │налогообложения│          │  позиции   │                  │            │           │         │         │     │мость│мость│\n" +
"│           │                    │             │           │ позиции) │       │        │          │         │           │позиции),   │                   │     не обращ. на ОРЦБ             │(расчетной) │            │            │             │             │              │                    │    ОРЦБ,                          │(расчетной)  │налогообложения, │              │            │                           │                           │в текущем      │          │            │                  │            │           │         │         │     │контр│контр│\n" +
"│           │                    │             │           │          │       │        │          │         │           │  в % от    │                   │       (расч. цена ЦБ,             │ цены, руб. │            │            │             │             │              │                    │  расчетная                        │ценой, руб.  │      руб.       │              │            │                           │                           │отчетном       │          │            │                  │            │           │         │         │     │аген-│аген-│\n" +
"│           │                    │             │           │          │       │        │          │         │           │ номинала   │                   │       реализ.по срочн.            │            │            │            │             │             │              │                    │ цена для ЦБ                       │             │                 │              │            ├─────────────┬─────────────┼─────────────┬─────────────┤(налоговом)    │          │            │                  │            │           │         │         │     │та по│та по│\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │                   │           сделке),                │            │            │            │             │             │              │                    │не обращ. на                       │             │                 │              │            │   в валюте  │  в рублях   │   в валюте  │  в рублях   │периоде,       │          │            │                  │            │           │         │         │     │сдел-│сдел-│\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │                   │        уменьш. на 20%             │            │            │            │             │             │              │                    │ ОРЦБ (расч.                       │             │                 │              │            │  номинала   │             │  номинала   │             │руб.           │          │            │                  │            │           │         │         │     │ке   │ке   │\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │                   │                                   │            │            │            │             │             │              │                    │  цена ЦБ,                         │             │                 │              │            │             │             │             │             │               │          │            ├─────────┬────────┤            │           │         │         │     │реа- │при- │\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │                   │                                   │            │            │            │             │             │              │                    │  приобр.по                        │             │                 │              │            │             │             │             │             │               │          │            │   для   │для     │            │           │         │         │     │лиза-│обре-│\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │                   │                                   │            │            │            │             │             │              │                    │   срочн.                          │             │                 │              │            │             │             │             │             │               │          │            │  сделки │сделки  │            │           │         │         │     │ции с│тения│\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │                   │                                   │            │            │            │             │             │              │                    │  сделке),                         │             │                 │              │            │             │             │             │             │               │          │            │реализа- │приобре-│            │           │         │         │     │нашим│с    │\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │                   │                                   │            │            │            │             │             │              │                    │ увелич. на                        │             │                 │              │            │             │             │             │             │               │          │            │   ции   │тения   │            │           │         │         │     │бан- │нашим│\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │                   │                                   │            │            │            │             │             │              │                    │     20%                           │             │                 │              │            │             │             │             │             │               │          │            │         │        │            │           │         │         │     │ком  │бан- │\n" +
"│           │                    │             │           │          │       │        │          │         │           │            ├───────────┬───────┼─────────────┬───────────┬─────────┤            │            │            │             │             │              ├────────────┬───────┼─────────────┬───────────┬─────────┤             │                 │              │            │             │             │             │             │               │          │            │         │        │            │           │         │         │     │     │ком  │\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │  Сумма в  │Сумма, │Цена, в % от │ Источник  │  Дата   │            │            │            │             │             │              │  Сумма в   │Сумма, │Цена, в % от │ Источник  │  Дата   │             │                 │              │            │             │             │             │             │               │          │            │         │        │            │           │         │         │     │     │     │\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │  валюте   │ руб.  │  номинала   │информации │котировки│            │            │            │             │             │              │   валюте   │ руб.  │  номинала   │информации │котировки│             │                 │              │            │             │             │             │             │               │          │            │         │        │            │           │         │         │     │     │     │\n" +
"│           │                    │             │           │          │       │        │          │         │           │            │ номинала  │       │             │           │         │            │            │            │             │             │              │  номинала  │       │             │           │         │             │                 │              │            │             │             │             │             │               │          │            │         │        │            │           │         │         │     │     │     │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼───────┼────────┼──────────┼─────────┼───────────┼────────────┼───────────┼───────┼─────────────┼───────────┼─────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼───────┼─────────────┼───────────┼─────────┼─────────────┼─────────────────┼──────────────┼────────────┼─────────────┼─────────────┼─────────────┼─────────────┼───────────────┼──────────┼────────────┼─────────┼────────┼────────────┼───────────┼─────────┼─────────┼─────┼─────┼─────┤\n" +
"│   1       │   2                │     3       │     4     │     5    │   6   │   7    │    8     │    9    │    10     │     11     │    12     │  13   │     14      │    15     │   16    │     17     │     18     │     19     │     20      │     21      │      22      │     23     │  24   │     25      │    26     │   27    │     28      │       29        │      30      │     31     │      32     │      33     │      34     │      35     │       36      │    Т1    │     Т2     │   Т3    │   Т4   │    Т5      │     Т6    │    Т7   │    Т8   │  Т9 │ Т8  │  Т9 │\n" +
"├───────────┼────────────────────┼─────────────┼───────────┼──────────┼───────┼────────┼──────────┼─────────┼───────────┼────────────┼───────────┼───────┼─────────────┼───────────┼─────────┼────────────┼────────────┼────────────┼─────────────┼─────────────┼──────────────┼────────────┼───────┼─────────────┼───────────┼─────────┼─────────────┼─────────────────┼──────────────┼────────────┼─────────────┼─────────────┼─────────────┼─────────────┼───────────────┼──────────┼────────────┼─────────┼────────┼────────────┼───────────┼─────────┼─────────┼─────┼─────┼─────┤";
                                                                                                                                                                                                                                                                                                                                                                                                                   

PRIVATE MACRO WhereCondBond()
  return " RSB_FIInstr.FI_AvrKindsEQ("+FIKIND_AVOIRISS+", "+AVOIRISSKIND_BOND+", FinInstr.t_AvoirKind) > 0 ";
END;

/*Процентной облигацией считается облигация, относящаяся к одной из следующих налоговых групп:*/
PRIVATE MACRO WhereCondPC()
  return WhereCondBond() + " AND Rsb_SCTX.TXIsPercentAvoir(av.t_TaxGroup) = 1 ";
END;

/*Дисконтной облигацией считается облигация, относящаяся к одной из следующих налоговых групп:*/
PRIVATE MACRO WhereCondDiscount()
  return WhereCondBond() + " AND Rsb_SCTX.TXIsDiscountAvoir(av.t_TaxGroup) = 1 ";
END;

/*сделки с акциями, паями и депозитарными расписками*/
PRIVATE MACRO WhereCond601()
  return " FinInstr.t_AvoirKind IN (" + string(AVOIRISSKIND_EQUITY_SHARE)          + "," +
                                        string(AVOIRISSKIND_PREFERENCE_SHARE)      + "," +
                                        string(AVOIRISSKIND_PREFERENCE_CONV_SHARE) + "," +
                                        string(AVOIRISSKIND_DEPOSITORY_RECEIPT)    + "," +
                                        string(AVOIRISSKIND_INVESTMENT_SHARE) +
                                  ")"
END;

PRIVATE MACRO WhereCondNominalRUR()
  return " FinInstr.t_FaceValueFI = 0 ";
END;

PRIVATE CLASS CShRepReg_601( Report:OBJECT )
  VAR m_Report = Report;

  MACRO Where():STRING
     /*0601 отбираются сделки с акциями, паями и депозитарными расписками, номинированными в рублях */
     return WhereCondNominalRUR() + " AND " + WhereCond601();
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( "0601" );

     m_Report.PrintHeader("N1_");

     m_Report.RegisterTable( "N1_MainTable", TableHeader_0601,
                    /*1  */  "N1_SecCode",      
                    /*2  */  "N1_SecName",  
                    /*3  */  "N1_CodeS", 
                    /*4  */  "N1_DZS",   
                    /*5  */  "N1_DDS",    
                    /*6  */  "N1_Qnty",      
                    /*7  */  "N1_VPrS",     
                    /*8  */  "N1_PrSvp", 
                    /*9  */  "N1_PrSrub",    
                    /*10 */  "N1_SumSvp",    
                    /*11 */  "N1_SumSrub",   
                    /*12 */  "N1_MinMrkt",   
                    /*13 */  "N1_MrktS", 
                    /*14 */  "N1_DMrktS",    
                    /*15 */  "N1_DifS",  
                    /*16 */  "N1_ComS",   
                    /*17 */  "N1_CodeB",    
                    /*18 */  "N1_DZB",   
                    /*19 */  "N1_Dlink", 
                    /*20 */  "N1_VPrB",  
                    /*21 */  "N1_PrBvp", 
                    /*22 */  "N1_PrBrub",    
                    /*23 */  "N1_SumBvp",    
                    /*24 */  "N1_SumBrub",   
                    /*25 */  "N1_MaxMrkt",   
                    /*26 */  "N1_MrktB", 
                    /*27 */  "N1_DMrktB",    
                    /*28 */  "N1_DifB",  
                    /*29 */  "N1_SumBtax",   
                    /*30 */  "N1_ComB",  
                    /*31 */  "N1_Dfix",
                    /*32 */  "N1_DivOne",
                    /*33 */  "N1_DivDeal",
                    /*34 */  "N1_RashAll",   
                    /*Т1 */  "N1_CrSZ",  
                    /*Т2 */  "N1_CrBZ",  
                    /*Т3 */  "N1_CrSD",  
                    /*Т4 */  "N1_CrBD",  
                    /*Т5 */  "N1_DqualS",    
                    /*Т6 */  "N1_DqualB",    
                    /*Т7 */  "N1_ContS", 
                    /*Т8 */  "N1_ContB", 
                    /*Т9 */  "N1_FilS",  
                    /*Т10*/  "N1_FilB",  
                    /*Т11*/  "N1_SecType",
                    /*Т12*/  "N1_DepS",
                    /*Т13*/  "N1_DepB"
                           );      

     m_Report.SetCellAutoSummapoint( "Всего:",
                                "N1_Qnty",6, 
                                "N1_SumSvp",2, 
                                "N1_SumSrub",2, 
                                "N1_DifS",2,  
                                "N1_ComS",2,  
                                "N1_SumBvp",2,  
                                "N1_SumBrub",2, 
                                "N1_DifB",2,  
                                "N1_SumBtax",2, 
                                "N1_ComB",2,  
                                "N1_DivDeal",2,
                                "N1_RashAll",2                                                     
                              );

     this.ПечататьСтрокуТаблицы( Строка_Итого );

  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                          "F23",     
                          "J23",   
                          "K23",  
                          "O23",     
                          "P23",     
                          "W23",   
                          "X23",  
                          "AB23",     
                          "AC23",  
                          "AD23",     
                          "AG23",
                          "AH23"  
                    );                                                                      
  END;

  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N1_SecCode",      m_Report.SecCode(),        null,   /*1  */                    
                                 "N1_SecName",      m_Report.SecName(),        null,   /*2  */                    
                                 "N1_CodeS",        m_Report.CodeS(),          null,   /*3  */                    
                                 "N1_DZS",          m_Report.DZS(),            null,   /*4  */                    
                                 "N1_DDS",          m_Report.DDS(),            null,   /*5  */                    
                                 "N1_Qnty",         m_Report.Qnty(),           m_Report.QntyPrecision(),   /*6  */
                                 "N1_VPrS",         m_Report.VPrSNumber(),     null,   /*7  */                    
                                 "N1_PrSvp",        m_Report.PrSvp(),          null,   /*8  */                    
                                 "N1_PrSrub",       m_Report.PrSrub(),         null,   /*9  */                    
                                 "N1_SumSvp",       iif(m_Report.VPrS() != NATCUR, m_Report.SumSvp(), 0.0),         null,   /*10 */                    
                                 "N1_SumSrub",      m_Report.SumSrub(),        null,   /*11 */                    
                                 "N1_MinMrkt",      m_Report.MinMrkt(),        null,   /*12 */                    
                                 "N1_MrktS",        m_Report.MrktS(),          null,   /*13 */                    
                                 "N1_DMrktS",       m_Report.DMrktS(),         null,   /*14 */                    
                                 "N1_DifS",         m_Report.DifS(),           null,   /*15 */                    
                                 "N1_ComS",         m_Report.ComS(),           null,   /*16 */                    
                                 "N1_CodeB",        m_Report.CodeB(),          null,   /*17 */                    
                                 "N1_DZB",          m_Report.DZB(),            null,   /*18 */                    
                                 "N1_Dlink",        m_Report.Dlink(),          null,   /*19 */                    
                                 "N1_VPrB",         m_Report.VPrBNumber(),     null,   /*20 */                    
                                 "N1_PrBvp",        m_Report.PrBvp(),          null,   /*21 */                    
                                 "N1_PrBrub",       m_Report.PrBrub(),         null,   /*22 */                    
                                 "N1_SumBvp",       iif(m_Report.VPrB() != NATCUR, m_Report.SumBvp(), 0.0),         null,   /*23 */                    
                                 "N1_SumBrub",      m_Report.SumBrub(),        null,   /*24 */                    
                                 "N1_MaxMrkt",      m_Report.MaxMrkt(),        null,   /*25 */                    
                                 "N1_MrktB",        m_Report.MrktB(),          null,   /*26 */                    
                                 "N1_DMrktB",       m_Report.DMrktB(),         null,   /*27 */                    
                                 "N1_DifB",         m_Report.DifB(),           null,   /*28 */                    
                                 "N1_SumBtax",      m_Report.SumBtax(),        null,   /*29 */                    
                                 "N1_ComB",         m_Report.ComB(),           null,   /*30 */                    
                                 "N1_Dfix",         m_Report.Dfix(),           null,   /*31 */
                                 "N1_DivOne",       m_Report.printDivOne(),    null,   /*32 */
                                 "N1_DivDeal",      m_Report.printDivDeal(),   null,   /*33 */
                                 "N1_RashAll",      m_Report.RashAll(),        null,   /*34 */                    
                                 "N1_CrSZ",         m_Report.printCrSZ(),      null,   /*Т1 */                    
                                 "N1_CrBZ",         m_Report.printCrBZ(),      null,   /*Т2 */                    
                                 "N1_CrSD",         m_Report.printCrSD(),      null,   /*Т3 */                    
                                 "N1_CrBD",         m_Report.printCrBD(),      null,   /*Т4 */                    
                                 "N1_DqualS",       m_Report.DqualS(),         null,   /*Т5 */                    
                                 "N1_DqualB",       m_Report.DqualB(),         null,   /*Т6 */                    
                                 "N1_ContS",        m_Report.ContS(),          null,   /*Т7 */                    
                                 "N1_ContB",        m_Report.ContB(),          null,   /*Т8 */                    
                                 "N1_FilS",         m_Report.FilS(),           null,   /*Т9 */                    
                                 "N1_FilB",         m_Report.FilB(),           null,   /*Т10*/                    
                                 "N1_SecType",      m_Report.SecType(),        null,   /*Т11*/                    
                                 "N1_DepS",         m_Report.DepS(),           null,   /*Т12*/                    
                                 "N1_DepB",         m_Report.DepB(),           null    /*Т13*/                    
                               );
                               
     elif( LineType == Строка_Итого )

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N1_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N1_SecCode",  "в том числе", null );

     end;
  END;

  MACRO EndReport()
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N1_" );
  END;

END;

PRIVATE CLASS CShRepReg_602( Report:OBJECT )
  VAR m_Report = Report;

  MACRO Where():STRING
     /*0602 отбираются сделки с процентными облигациями, номинированными в рублях */
     return WhereCondNominalRUR() + " AND " + WhereCondPC();
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( "0602" );

     m_Report.PrintHeader("N2_");

     m_Report.RegisterTable( "N2_MainTable", TableHeader_0602,
                   /*1  */   "N2_SecCode",   
                   /*2  */   "N2_SecName",   
                   /*3  */   "N2_CodeS",    
                   /*4  */   "N2_DZS",    
                   /*5  */   "N2_DDS",   
                   /*6  */   "N2_Qnty",     
                   /*7  */   "N2_PrSnom",    
                   /*8  */   "N2_SumSrub",   
                   /*9  */   "N2_NkdSvn",    
                   /*10 */   "N2_MinMrkt",   
                   /*11 */   "N2_MrktS", 
                   /*12 */   "N2_DMrktS",    
                   /*13 */   "N2_DifS",  
                   /*14 */   "N2_ComS",  
                   /*15 */   "N2_CodeB", 
                   /*16 */   "N2_DZB",   
                   /*17 */   "N2_Dlink", 
                   /*18 */   "N2_PrBnom",    
                   /*19 */   "N2_SumBrub",   
                   /*20 */   "N2_NkdCloseVN",    
                   /*21 */   "N2_MaxMrkt",   
                   /*22 */   "N2_MrktB", 
                   /*23 */   "N2_DMrktB",    
                   /*24 */   "N2_DifB",  
                   /*25 */   "N2_SumBtax",   
                   /*26 */   "N2_ComB",
                   /*27 */   "N2_AmortPozVN",  
                   /*28 */   "N2_RashAll",   
                   /*29 */   "N2_NkdPrevVN", 
                   /*30 */   "N2_CoupPrevVN",    
                   /*31 */   "N2_CoupVN",    
                   /*32 */   "N2_ProcRashAllRub",    
                   /*33 */   "N2_ProcRashPrevRub",   
                   /*34 */   "N2_ProcRashRepRub",    
                   /*Т1 */   "N2_CoupCount", 
                   /*Т2 */   "N2_LastCoupDate",  
                   /*Т3 */   "N2_DqualS",    
                   /*Т4 */   "N2_DqualB",    
                   /*Т5 */   "N2_ContS", 
                   /*Т6 */   "N2_ContB", 
                   /*Т7 */   "N2_FilS",  
                   /*Т8 */   "N2_FilB",  
                   /*Т9 */   "N2_SecType",
                   /*Т10 */  "N2_DepS",
                   /*Т11 */  "N2_DepB"
                           );     


     m_Report.SetCellAutoSummaPoint( "Всего:",
                                "N2_Qnty",6,
                                "N2_SumSrub",2,
                                "N2_NkdSvn",2,
                                "N2_DifS",2,
                                "N2_ComS",2,
                                "N2_SumBrub",2,
                                "N2_NkdCloseVN",2,
                                "N2_DifB",2,
                                "N2_SumBtax",2,
                                "N2_ComB",2,
                                "N2_AmortPozVN",2,
                                "N2_RashAll",2,
                                "N2_NkdPrevVN",2,
                                "N2_CoupPrevVN",2,
                                "N2_CoupVN",2,
                                "N2_ProcRashAllRub",2,
                                "N2_ProcRashPrevRub",2,
                                "N2_ProcRashRepRub",2
                              );
     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                          "F23",             
                          "H23",          
                          "I23",           
                          "M23",             
                          "N23",             
                          "S23",          
                          "T23",       
                          "X23",             
                          "Y23",          
                          "Z23",
                          "AA23",             
                          "AB23",          
                          "AC23",        
                          "AD23",       
                          "AE23",           
                          "AF23",   
                          "AG23",  
                          "AH23"
                    );                                                                      
  END;


  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N2_SecCode",           m_Report.SecCode(),           null,   /*1  */                    
                                 "N2_SecName",           m_Report.SecName(),           null,   /*2  */                    
                                 "N2_CodeS",             m_Report.CodeS(),             null,   /*3  */                    
                                 "N2_DZS",               m_Report.DZS(),               null,   /*4  */                    
                                 "N2_DDS",               m_Report.DDS(),               null,   /*5  */                    
                                 "N2_Qnty",              m_Report.Qnty(),              m_Report.QntyPrecision(),   /*6  */
                                 "N2_PrSnom",            m_Report.PrSnom(),            null,   /*7  */                    
                                 "N2_SumSrub",           m_Report.SumSrub(),           null,   /*8  */                    
                                 "N2_NkdSvn",            m_Report.NkdSvn(),            null,   /*9  */                    
                                 "N2_MinMrkt",           m_Report.MinMrkt(),           null,   /*10 */                    
                                 "N2_MrktS",             m_Report.MrktS(),             null,   /*11 */                    
                                 "N2_DMrktS",            m_Report.DMrktS(),            null,   /*12 */                    
                                 "N2_DifS",              m_Report.DifS(),              null,   /*13 */                    
                                 "N2_ComS",              m_Report.ComS(),              null,   /*14 */                    
                                 "N2_CodeB",             m_Report.CodeB(),             null,   /*15 */                    
                                 "N2_DZB",               m_Report.DZB(),               null,   /*16 */                    
                                 "N2_Dlink",             m_Report.Dlink(),             null,   /*17 */                    
                                 "N2_PrBnom",            m_Report.PrBnom(),            null,   /*18 */                    
                                 "N2_SumBrub",           m_Report.SumBrub(),           null,   /*19 */                    
                                 "N2_NkdCloseVN",        m_Report.NkdCloseVN(),        null,   /*20 */                    
                                 "N2_MaxMrkt",           m_Report.MaxMrkt(),           null,   /*21 */                    
                                 "N2_MrktB",             m_Report.MrktB(),             null,   /*22 */                    
                                 "N2_DMrktB",            m_Report.DMrktB(),            null,   /*23 */                    
                                 "N2_DifB",              m_Report.DifB(),              null,   /*24 */                    
                                 "N2_SumBtax",           m_Report.SumBtax(),           null,   /*25 */                    
                                 "N2_ComB",              m_Report.ComB(),              null,   /*26 */                    
                                 "N2_AmortPozVN",        m_Report.AmortPozVN(),        null,   /*27 */
                                 "N2_RashAll",           m_Report.RashAll(),           null,   /*28 */                    
                                 "N2_NkdPrevVN",         m_Report.NkdPrevVN(),         null,   /*29 */                    
                                 "N2_CoupPrevVN",        m_Report.CoupPrevVN(),        null,   /*30 */                    
                                 "N2_CoupVN",            m_Report.CoupVN(),            null,   /*31 */                    
                                 "N2_ProcRashAllRub",    m_Report.ProcRashAllRub(),    null,   /*32 */                    
                                 "N2_ProcRashPrevRub",   m_Report.ProcRashPrevRub(),   null,   /*33 */                    
                                 "N2_ProcRashRepRub",    m_Report.ProcRashRepRub(),    null,   /*34 */                    
                                 "N2_CoupCount",         m_Report.CoupCount(),         null,   /*Т1 */                    
                                 "N2_LastCoupDate",      m_Report.LastCoupDate(),      null,   /*Т2 */                    
                                 "N2_DqualS",            m_Report.DqualS(),            null,   /*Т3 */                    
                                 "N2_DqualB",            m_Report.DqualB(),            null,   /*Т4 */                    
                                 "N2_ContS",             m_Report.ContS(),             null,   /*Т5 */
                                 "N2_ContB",             m_Report.ContB(),             null,   /*Т6 */
                                 "N2_FilS",              m_Report.FilS(),              null,   /*Т7 */
                                 "N2_FilB",              m_Report.FilB(),              null,   /*Т8 */
                                 "N2_SecType",           m_Report.SecType(),           null,   /*Т9 */
                                 "N2_DepS",              m_Report.DepS(),              null,   /*Т10 */
                                 "N2_DepB",              m_Report.DepB(),              null    /*Т11 */
                               );                                          
                                                                           
     elif( LineType == Строка_Итого )                                      

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N2_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N2_SecCode",  "в том числе", null );

     end;
  END;         

  MACRO EndReport()
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N2_" );
  END;

END;

PRIVATE CLASS CShRepReg_603( Report:OBJECT )
  VAR m_Report = Report;

  MACRO Where():STRING
     /*0603 - отбираются сделки с дисконтными облигациями, номинированными в рублях*/
     return WhereCondNominalRUR() + " AND " + WhereCondDiscount();
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( "0603" );

     m_Report.PrintHeader("N3_");

     m_Report.RegisterTable( "N3_MainTable", TableHeader_0603,
                  /*1  */    "N3_SecCode",  
                  /*2  */    "N3_SecName",   
                  /*3  */    "N3_CodeS", 
                  /*4  */    "N3_DZS",   
                  /*5  */    "N3_DDS",   
                  /*6  */    "N3_Nom",   
                  /*7  */    "N3_DAuс",  
                  /*8  */    "N3_Dexp",  
                  /*9  */    "N3_PrAucNom",  
                  /*10 */    "N3_Qnty",  
                  /*11 */    "N3_PrSNom",    
                  /*12 */    "N3_SumSrub",   
                  /*13 */    "N3_MinMrkt",   
                  /*14 */    "N3_MrktS", 
                  /*15 */    "N3_DMrktS",    
                  /*16 */    "N3_DifS",  
                  /*17 */    "N3_ComS",  
                  /*18 */    "N3_CodeB", 
                  /*19 */    "N3_DZB",   
                  /*20 */    "N3_Dlink", 
                  /*21 */    "N3_PrBnom",    
                  /*22 */    "N3_SumBrub",   
                  /*23 */    "N3_MaxMrkt",   
                  /*24 */    "N3_MrktB", 
                  /*25 */    "N3_DMrktB",    
                  /*26 */    "N3_DifB",  
                  /*27 */    "N3_SumBtax",   
                  /*28 */    "N3_ComB",  
                  /*29 */    "N3_RashAll",   
                  /*30 */    "N3_ProcRashAllVN", 
                  /*31 */    "N3_ProcRashPrevVN",    
                  /*32 */    "N3_ProcRashRepVN", 
                  /*Т1 */    "N3_DqualS",    
                  /*Т2 */    "N3_DqualB",    
                  /*Т3 */    "N3_ContS", 
                  /*Т4 */    "N3_ContB", 
                  /*Т5 */    "N3_FilS",  
                  /*Т6 */    "N3_FilB",  
                  /*Т7 */    "N3_SecType",
                  /*Т8 */    "N3_DepS",
                  /*Т9 */    "N3_DepB"
                           );     


     m_Report.SetCellAutoSummaPoint( "Всего:",
                                "N3_Qnty",6,        
                                "N3_SumSrub",2,             
                                "N3_DifS",2,    
                                "N3_ComS",2,                        
                                "N3_SumBrub",2,             
                                "N3_DifB",2,    
                                "N3_SumBtax",2, 
                                "N3_ComB",2,    
                                "N3_RashAll",2, 
                                "N3_ProcRashAllVN",2,   
                                "N3_ProcRashPrevVN",2,  
                                "N3_ProcRashRepVN",2                               
                              );
     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                          "J23",              
                          "L23",           
                          "P23",              
                          "Q23",              
                          "V23",           
                          "Z23",              
                          "AA23",           
                          "AB23",              
                          "AC23",           
                          "AD23",     
                          "AE23",    
                          "AF23"     
                    );                                                                      
  END;


  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N3_SecCode",          m_Report.SecCode(),             null,   /*1  */                      
                                 "N3_SecName",          m_Report.SecName(),             null,   /*2  */                      
                                 "N3_CodeS",            m_Report.CodeS(),               null,   /*3  */                      
                                 "N3_DZS",              m_Report.DZS(),                 null,   /*4  */                      
                                 "N3_DDS",              m_Report.DDS(),                 null,   /*5  */                      
                                 "N3_Nom",              m_Report.Nom(),                 null,   /*6  */  
                                 "N3_DAuс",             m_Report.DAuc(),                null,   /*7  */                      
                                 "N3_Dexp",             m_Report.Dexp(),                null,   /*8  */                      
                                 "N3_PrAucNom",         m_Report.PrAucNom(),            null,   /*9  */                      
                                 "N3_Qnty",             m_Report.Qnty(),                m_Report.QntyPrecision(),   /*10 */                      
                                 "N3_PrSNom",           m_Report.PrSNom(),              null,   /*11 */                      
                                 "N3_SumSrub",          m_Report.SumSrub(),             null,   /*12 */                      
                                 "N3_MinMrkt",          m_Report.MinMrkt(),             null,   /*13 */                      
                                 "N3_MrktS",            m_Report.MrktS(),               null,   /*14 */                      
                                 "N3_DMrktS",           m_Report.DMrktS(),              null,   /*15 */                      
                                 "N3_DifS",             m_Report.DifS(),                null,   /*16 */                      
                                 "N3_ComS",             m_Report.ComS(),                null,   /*17 */                      
                                 "N3_CodeB",            m_Report.CodeB(),               null,   /*18 */                      
                                 "N3_DZB",              m_Report.DZB(),                 null,   /*19 */                      
                                 "N3_Dlink",            m_Report.Dlink(),               null,   /*20 */                      
                                 "N3_PrBnom",           m_Report.PrBnom(),              null,   /*21 */                      
                                 "N3_SumBrub",          m_Report.SumBrub(),             null,   /*22 */                      
                                 "N3_MaxMrkt",          m_Report.MaxMrkt(),             null,   /*23 */                      
                                 "N3_MrktB",            m_Report.MrktB(),               null,   /*24 */                      
                                 "N3_DMrktB",           m_Report.DMrktB(),              null,   /*25 */                      
                                 "N3_DifB",             m_Report.DifB(),                null,   /*26 */                      
                                 "N3_SumBtax",          m_Report.SumBtax(),             null,   /*27 */                      
                                 "N3_ComB",             m_Report.ComB(),                null,   /*29 */                      
                                 "N3_RashAll",          m_Report.RashAll(),             null,   /*29 */                      
                                 "N3_ProcRashAllVN",    m_Report.ProcRashAllVN(),       null,   /*30 */                      
                                 "N3_ProcRashPrevVN",   m_Report.ProcRashPrevVN(),      null,   /*31 */                      
                                 "N3_ProcRashRepVN",    m_Report.ProcRashRepVN(),       null,   /*32 */                      
                                 "N3_DqualS",           m_Report.DqualS(),              null,   /*Т1 */                      
                                 "N3_DqualB",           m_Report.DqualB(),              null,   /*Т2 */                      
                                 "N3_ContS",            m_Report.ContS(),               null,   /*Т3 */                      
                                 "N3_ContB",            m_Report.ContB(),               null,   /*Т4 */                      
                                 "N3_FilS",             m_Report.FilS(),                null,   /*Т5 */                      
                                 "N3_FilB",             m_Report.FilB(),                null,   /*Т6 */                      
                                 "N3_SecType",          m_Report.SecType(),             null,   /*Т7 */                      
                                 "N3_DepS",             m_Report.DepS(),                null,   /*Т8 */                      
                                 "N3_DepB",             m_Report.DepB(),                null    /*Т9 */                      
                               );                                          
                                                                           
     elif( LineType == Строка_Итого )                                      

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N3_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N3_SecCode",  "в том числе", null );

     end;
  END;         

  MACRO EndReport()
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N3_" );
  END;
END;


PRIVATE CLASS CShRepReg_604( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*0604 - отбираются сделки с акциями, паями и депозитарными расписками, номинированными в иностранной валюте */
     return " NOT ( " + WhereCondNominalRUR() + ") AND " + WhereCond601();
  END;
  
  MACRO BeginReport()
     m_Report.SetActiveSheet( "0604" );

     m_Report.PrintHeader("N4_");

     m_Report.RegisterTable( "N4_MainTable", TableHeader_0604,
                    /*1  */  "N4_SecCode",      
                    /*2  */  "N4_SecName",       
                    /*3  */  "N4_CodeS",    
                    /*4  */  "N4_DZS",    
                    /*5  */  "N4_DDS",  
                    /*6  */  "N4_VN",    
                    /*7  */  "N4_Qnty",  
                    /*8  */  "N4_PrSVN", 
                    /*9  */  "N4_SumSvn",    
                    /*10 */  "N4_SumSrub",   
                    /*11 */  "N4_MinMrkt",   
                    /*12 */  "N4_MrktS", 
                    /*13 */  "N4_DMrktS",    
                    /*14 */  "N4_DifS",  
                    /*15 */  "N4_ComS",   
                    /*16 */  "N4_CodeB",    
                    /*17 */  "N4_DZB",   
                    /*18 */  "N4_Dlink", 
                    /*19 */  "N4_PrBVn", 
                    /*20 */  "N4_SumBvn",    
                    /*21 */  "N4_SumBrub",   
                    /*22 */  "N4_MaxMrkt",   
                    /*23 */  "N4_MrktB", 
                    /*24 */  "N4_DMrktB",    
                    /*25 */  "N4_DifB",  
                    /*26 */  "N4_SumBtax",   
                    /*27 */  "N4_ComB",  
                    /*28 */  "N4_Dfix",
                    /*29 */  "N4_DivOne",
                    /*30 */  "N4_DivDeal",
                    /*31 */  "N4_RashAll",   
                    /*T1 */  "N4_VPrB",  
                    /*T2 */  "N4_PrBvp", 
                    /*T3 */  "N4_VPrS",  
                    /*T4 */  "N4_PrSvp", 
                    /*T5 */  "N4_CrSZ",  
                    /*T6 */  "N4_CrBZ",  
                    /*T7 */  "N4_CrSD",  
                    /*Т8 */  "N4_CrBD",  
                    /*Т9 */  "N4_DqualS",    
                    /*Т10 */ "N4_DqualB",    
                    /*Т11 */ "N4_ContS", 
                    /*Т12 */ "N4_ContB", 
                    /*Т13 */ "N4_FilS",  
                    /*Т14 */ "N4_FilB",  
                    /*Т15 */ "N4_SecType",
                    /*Т16 */ "N4_DepS",
                    /*Т17 */ "N4_DepB"
                           );     


     m_Report.SetCellAutoSummaPoint( "Всего:",
                                "N4_Qnty",6,          
                                "N4_SumSvn",2,  
                                "N4_SumSrub",2,             
                                "N4_DifS",2,    
                                "N4_ComS",2,                        
                                "N4_SumBvn",2,  
                                "N4_SumBrub",2,             
                                "N4_DifB",2,    
                                "N4_SumBtax",2, 
                                "N4_ComB",2,    
                                "N4_DivDeal", 2,
                                "N4_RashAll",2                                                                     
                              );
     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                          "G23",          
                          "I23",       
                          "J23",             
                          "N23",         
                          "O23",                        
                          "T23",       
                          "U23",             
                          "Y23",         
                          "Z23",      
                          "AA23",         
                          "AD23",         
                          "AE23"                                                                   
                    );                                                                      
  END;


  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )
        m_Report.PrintTableLine( "N4_SecCode",      m_Report.SecCode(),        null,   /*1  */                     
                                 "N4_SecName",      m_Report.SecName(),        null,   /*2  */                     
                                 "N4_CodeS",        m_Report.CodeS(),          null,   /*3  */                     
                                 "N4_DZS",          m_Report.DZS(),            null,   /*4  */                     
                                 "N4_DDS",          m_Report.DDS(),            null,   /*5  */                     
                                 "N4_VN",           m_Report.VN(),             null,   /*6  */                     
                                 "N4_Qnty",         m_Report.Qnty(),           m_Report.QntyPrecision(),   /*7  */                     
                                 "N4_PrSVN",        m_Report.PrSVN(),          null,   /*8  */                     
                                 "N4_SumSvn",       m_Report.SumSvn(),         null,   /*9  */                     
                                 "N4_SumSrub",      m_Report.SumSrub(),        null,   /*10 */ 
                                 "N4_MinMrkt",      m_Report.MinMrkt(),        null,   /*11 */                     
                                 "N4_MrktS",        m_Report.MrktS(),          null,   /*12 */                     
                                 "N4_DMrktS",       m_Report.DMrktS(),         null,   /*13 */                     
                                 "N4_DifS",         m_Report.DifS(),           null,   /*14 */                     
                                 "N4_ComS",         m_Report.ComS(),           null,   /*15 */                     
                                 "N4_CodeB",        m_Report.CodeB(),          null,   /*16 */                     
                                 "N4_DZB",          m_Report.DZB(),            null,   /*17 */                     
                                 "N4_Dlink",        m_Report.Dlink(),          null,   /*18 */                     
                                 "N4_PrBVn",        m_Report.PrBVn(),          null,   /*19 */                     
                                 "N4_SumBvn",       m_Report.SumBvn(),         null,   /*20 */                     
                                 "N4_SumBrub",      m_Report.SumBrub(),        null,   /*21 */                     
                                 "N4_MaxMrkt",      m_Report.MaxMrkt(),        null,   /*22 */                     
                                 "N4_MrktB",        m_Report.MrktB(),          null,   /*23 */                     
                                 "N4_DMrktB",       m_Report.DMrktB(),         null,   /*24 */                     
                                 "N4_DifB",         m_Report.DifB(),           null,   /*25 */                     
                                 "N4_SumBtax",      m_Report.SumBtax(),        null,   /*26 */                     
                                 "N4_ComB",         m_Report.ComB(),           null,   /*27 */                     
                                 "N4_Dfix",         m_Report.Dfix(),           null,   /*28 */
                                 "N4_DivOne",       m_Report.printDivOne(),    null,   /*29 */
                                 "N4_DivDeal",      m_Report.printDivDeal(),   null,   /*30 */
                                 "N4_RashAll",      m_Report.RashAll(),        null,   /*31 */                     
                                 "N4_VPrB",         m_Report.VPrBNumber(),     null,   /*T1 */                     
                                 "N4_PrBvp",        m_Report.PrBvp(),          null,   /*T2 */                     
                                 "N4_VPrS",         m_Report.VPrSNumber(),     null,   /*T3 */                     
                                 "N4_PrSvp",        m_Report.PrSvp(),          null,   /*T4 */                     
                                 "N4_CrSZ",         m_Report.printCrSZ(),      null,   /*T5 */                     
                                 "N4_CrBZ",         m_Report.printCrBZ(),      null,   /*T6 */                     
                                 "N4_CrSD",         m_Report.printCrSD(),      null,   /*T7 */                     
                                 "N4_CrBD",         m_Report.printCrBD(),      null,   /*Т8 */                     
                                 "N4_DqualS",       m_Report.DqualS(),         null,   /*Т9 */                     
                                 "N4_DqualB",       m_Report.DqualB(),         null,   /*Т10 */                    
                                 "N4_ContS",        m_Report.ContS(),          null,   /*Т11 */                    
                                 "N4_ContB",        m_Report.ContB(),          null,   /*Т12 */                    
                                 "N4_FilS",         m_Report.FilS(),           null,   /*Т13 */                    
                                 "N4_FilB",         m_Report.FilB(),           null,   /*Т14 */                    
                                 "N4_SecType",      m_Report.SecType(),        null,   /*Т15 */                    
                                 "N4_DepS",         m_Report.DepS(),           null,   /*Т16 */                    
                                 "N4_DepB",         m_Report.DepB(),           null    /*Т17 */                    
                                );                                          
                                                                           
     elif( LineType == Строка_Итого )                                      

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N4_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N4_SecCode",  "в том числе", null );

     end;
  END;         

  MACRO EndReport()
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N4_" );
  END;
                           
END;


PRIVATE CLASS CShRepReg_605( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*605 - отбираются сделки с процентными облигациями, номинированными в иностранной валюте*/
     return " NOT ( " + WhereCondNominalRUR() + ") AND " + WhereCondPC();
  END;
  
  MACRO BeginReport()
     m_Report.SetActiveSheet( "0605" );

     m_Report.PrintHeader("N5_");

     m_Report.RegisterTable( "N5_MainTable", TableHeader_0605,
                    /*1  */  "N5_SecCode",    
                    /*2  */  "N5_SecName",    
                    /*3  */  "N5_CodeS",    
                    /*4  */  "N5_DZS",    
                    /*5  */  "N5_DDS",  
                    /*6  */  "N5_VN",    
                    /*7  */  "N5_Qnty",  
                    /*8  */  "N5_PrSnom",    
                    /*9  */  "N5_SumSvn",    
                    /*10 */  "N5_SumSrub",   
                    /*11 */  "N5_NkdSvn",    
                    /*12 */  "N5_NkdSrub",   
                    /*13 */  "N5_MinMrkt",   
                    /*14 */  "N5_MrktS", 
                    /*15 */  "N5_DMrktS",    
                    /*16 */  "N5_DifS",  
                    /*17 */  "N5_ComS",  
                    /*18 */  "N5_CodeB", 
                    /*19 */  "N5_DZB",   
                    /*20 */  "N5_Dlink", 
                    /*21 */  "N5_PrBnom",    
                    /*22 */  "N5_SumBvn",    
                    /*23 */  "N5_SumBrub",   
                    /*24 */  "N5_NkdCloseVN",    
                    /*25 */  "N5_NkdCloseRub",   
                    /*26 */  "N5_MaxMrkt",   
                    /*27 */  "N5_MrktB",
                    /*28 */  "N5_DMrktB",
                    /*29 */  "N5_DifB",
                    /*30 */  "N5_SumBtax",
                    /*31 */  "N5_ComB",
                    /*32 */  "N5_AmortPozVN",    
                    /*33 */  "N5_AmortPozRub",   
                    /*34 */  "N5_RashAll",
                    /*35 */  "N5_NkdPrevVN",
                    /*36 */  "N5_NkdPrevRub",
                    /*37 */  "N5_CoupPrevVN",
                    /*38 */  "N5_CoupPrevRub",
                    /*39 */  "N5_CoupVN",
                    /*40 */  "N5_CoupRub",
                    /*41 */  "N5_ProcRashAllRub",
                    /*42 */  "N5_ProcRashPrevRub",
                    /*43 */  "N5_ProcRashRepRub",
                    /*T1 */  "N5_VPrB",  
                    /*T2 */  "N5_VPrS",  
                    /*T3 */  "N5_CrSZ",  
                    /*T4 */  "N5_CrBZ",  
                    /*Т5 */  "N5_CrSD",  
                    /*Т6 */  "N5_CrBD",   
                    /*Т7 */  "N5_CoupCount", 
                    /*Т8 */  "N5_LastCoupDate",  
                    /*Т9 */  "N5_DqualS",    
                    /*Т10 */ "N5_DqualB",    
                    /*Т11 */ "N5_ContS", 
                    /*Т12 */ "N5_ContB", 
                    /*Т13 */ "N5_FilS",  
                    /*Т14 */ "N5_FilB",  
                    /*Т15 */ "N5_SecType",
                    /*Т16 */ "N5_DepS",  
                    /*Т17 */ "N5_DepB"
                           );  

     m_Report.SetCellAutoSummaPoint( "Всего:",
                                "N5_Qnty",6,        
                                "N5_SumSvn",2,  
                                "N5_SumSrub",2, 
                                "N5_NkdSvn",2,  
                                "N5_NkdSrub",2,             
                                "N5_DifS",2,    
                                "N5_ComS",2,                        
                                "N5_SumBvn",2,  
                                "N5_SumBrub",2, 
                                "N5_NkdCloseVN",2,  
                                "N5_NkdCloseRub",2,             
                                "N5_DifB",2,    
                                "N5_SumBtax",2, 
                                "N5_ComB",2,
                                "N5_AmortPozVN",2, 
                                "N5_AmortPozRub",2,
                                "N5_RashAll",2, 
                                "N5_NkdPrevVN",2,   
                                "N5_NkdPrevRub",2,  
                                "N5_CoupPrevVN",2,  
                                "N5_CoupPrevRub",2, 
                                "N5_CoupVN",2,  
                                "N5_CoupRub",2, 
                                "N5_ProcRashAllRub",2,  
                                "N5_ProcRashPrevRub",2, 
                                "N5_ProcRashRepRub",2                                                                                      
                              );

     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  
  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                          "G23",             
                          "I23",           
                          "J23",          
                          "K23",           
                          "L23",             
                          "P23",             
                          "Q23",                        
                          "V23",           
                          "W23",          
                          "X23",       
                          "Y23",             
                          "AC23",             
                          "AD23",          
                          "AE23",
                          "AF23", 
                          "AG23",
                          "AH23",          
                          "AI23",        
                          "AJ23",       
                          "AK23",       
                          "AL23",      
                          "AM23",           
                          "AN23",          
                          "AO23",   
                          "AP23",  
                          "AQ23"   
                    );                                                                      
  END;


  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )

        m_Report.PrintTableLine( "N5_SecCode",           m_Report.SecCode(),                null,   /*1  */
                                 "N5_SecName",           m_Report.SecName(),                null,   /*2  */
                                 "N5_CodeS",             m_Report.CodeS(),                  null,   /*3  */
                                 "N5_DZS",               m_Report.DZS(),                    null,   /*4  */
                                 "N5_DDS",               m_Report.DDS(),                    null,   /*5  */
                                 "N5_VN",                m_Report.VN(),                     null,   /*6  */
                                 "N5_Qnty",              m_Report.Qnty(),                   m_Report.QntyPrecision(),   /*7  */
                                 "N5_PrSnom",            m_Report.PrSnom(),                 null,   /*8  */
                                 "N5_SumSvn",            m_Report.SumSvn(),                 null,   /*9  */
                                 "N5_SumSrub",           m_Report.SumSrub(),                null,   /*10 */
                                 "N5_NkdSvn",            m_Report.NkdSvn(),                 null,   /*11 */
                                 "N5_NkdSrub",           m_Report.NkdSrub(),                null,   /*12 */
                                 "N5_MinMrkt",           m_Report.MinMrkt(),                null,   /*13 */
                                 "N5_MrktS",             m_Report.MrktS(),                  null,   /*14 */
                                 "N5_DMrktS",            m_Report.DMrktS(),                 null,   /*15 */
                                 "N5_DifS",              m_Report.DifS(),                   null,   /*16 */
                                 "N5_ComS",              m_Report.ComS(),                   null,   /*17 */
                                 "N5_CodeB",             m_Report.CodeB(),                  null,   /*18 */
                                 "N5_DZB",               m_Report.DZB(),                    null,   /*19 */
                                 "N5_Dlink",             m_Report.Dlink(),                  null,   /*20 */
                                 "N5_PrBnom",            m_Report.PrBnom(),                 null,   /*21 */
                                 "N5_SumBvn",            m_Report.SumBvn(),                 null,   /*22 */
                                 "N5_SumBrub",           m_Report.SumBrub(),                null,   /*23 */
                                 "N5_NkdCloseVN",        m_Report.NkdCloseVN(),             null,   /*24 */
                                 "N5_NkdCloseRub",       m_Report.NkdCloseRub(),            null,   /*25 */
                                 "N5_MaxMrkt",           m_Report.MaxMrkt(),                null,   /*26 */
                                 "N5_MrktB",             m_Report.MrktB(),                  null,   /*27 */
                                 "N5_DMrktB",            m_Report.DMrktB(),                 null,   /*28 */
                                 "N5_DifB",              m_Report.DifB(),                   null,   /*29 */
                                 "N5_SumBtax",           m_Report.SumBtax(),                null,   /*30 */
                                 "N5_ComB",              m_Report.ComB(),                   null,   /*31 */
                                 "N5_AmortPozVN",        m_Report.AmortPozVN(),             null,   /*32 */
                                 "N5_AmortPozRub",       m_Report.AmortPozRub(),            null,   /*33 */
                                 "N5_RashAll",           m_Report.RashAll(),                null,   /*34 */
                                 "N5_NkdPrevVN",         m_Report.NkdPrevVN(),              null,   /*35 */
                                 "N5_NkdPrevRub",        m_Report.NkdPrevRub(),             null,   /*36 */
                                 "N5_CoupPrevVN",        m_Report.CoupPrevVN(),             null,   /*37 */
                                 "N5_CoupPrevRub",       m_Report.CoupPrevRub(),            null,   /*38 */
                                 "N5_CoupVN",            m_Report.CoupVN(),                 null,   /*39 */
                                 "N5_CoupRub",           m_Report.CoupRub(),                null,   /*40 */
                                 "N5_ProcRashAllRub",    m_Report.ProcRashAllRub(),         null,   /*41 */
                                 "N5_ProcRashPrevRub",   m_Report.ProcRashPrevRub(),        null,   /*42 */
                                 "N5_ProcRashRepRub",    m_Report.ProcRashRepRub(),         null,   /*43 */
                                 "N5_VPrB",              m_Report.VPrBNumber(),             null,   /*Т1 */
                                 "N5_VPrS",              m_Report.VPrSNumber(),             null,   /*Т2 */
                                 "N5_CrSZ",              m_Report.printCrSZ(),              null,   /*Т3 */
                                 "N5_CrBZ",              m_Report.printCrBZ(),              null,   /*Т4 */
                                 "N5_CrSD",              m_Report.printCrSD(),              null,   /*Т5 */
                                 "N5_CrBD",              m_Report.printCrBD(),              null,   /*Т6 */
                                 "N5_CoupCount",         m_Report.CoupCount(),              null,   /*Т7 */
                                 "N5_LastCoupDate",      m_Report.LastCoupDate(),           null,   /*Т8 */
                                 "N5_DqualS",            m_Report.DqualS(),                 null,   /*Т9 */
                                 "N5_DqualB",            m_Report.DqualB(),                 null,   /*Т10 */
                                 "N5_ContS",             m_Report.ContS(),                  null,   /*Т11 */
                                 "N5_ContB",             m_Report.ContB(),                  null,   /*Т12 */
                                 "N5_FilS",              m_Report.FilS(),                   null,   /*Т13 */
                                 "N5_FilB",              m_Report.FilB(),                   null,   /*Т14 */
                                 "N5_SecType",           m_Report.SecType(),                null,   /*Т15 */
                                 "N5_DepS",              m_Report.Deps(),                   null,   /*Т16 */
                                 "N5_DepB",              m_Report.DepB(),                   null    /*Т17 */
                               );                                          
                                                                           
     elif( LineType == Строка_Итого )                                      

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N5_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N5_SecCode",  "в том числе", null );

     end;
  END;         

  MACRO EndReport()
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N5_" );
  END;
END;


PRIVATE CLASS CShRepReg_606( Report:OBJECT )
  VAR m_Report = Report;
  
  MACRO Where():STRING
     /*606 - отбираются сделки с дисконтными облигациями, номинированными в иностранной валюте*/
     return " NOT ( " + WhereCondNominalRUR() + ") AND " + WhereCondDiscount();
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( "0606" );

     m_Report.PrintHeader("N6_");

     m_Report.RegisterTable( "N6_MainTable", TableHeader_0606,
                    /*1  */  "N6_SecCode",
                    /*2  */  "N6_SecName",
                    /*3  */  "N6_CodeS",
                    /*4  */  "N6_DZS",
                    /*5  */  "N6_DDS",
                    /*6  */  "N6_Nom",
                    /*7  */  "N6_VN",
                    /*8  */  "N6_DAuс",
                    /*9  */  "N6_Dexp",
                    /*10 */  "N6_Qnty",
                    /*11 */  "N6_PrSnom",
                    /*12 */  "N6_SumSvn",
                    /*13 */  "N6_SumSrub",
                    /*14 */  "N6_MinMrkt",
                    /*15 */  "N6_MrktS",
                    /*16 */  "N6_DMrktS",
                    /*17 */  "N6_DifS",
                    /*18 */  "N6_ComS",
                    /*19 */  "N6_CodeB",
                    /*20 */  "N6_DZB",
                    /*21 */  "N6_Dlink",
                    /*22 */  "N6_PrBnom",
                    /*23 */  "N6_SumBvn",
                    /*24 */  "N6_SumBrub",
                    /*25 */  "N6_MaxMrkt",
                    /*26 */  "N6_MrktB",
                    /*27 */  "N6_DMrktB",
                    /*28 */  "N6_DifB",
                    /*29 */  "N6_SumBtax",
                    /*30 */  "N6_ComB",
                    /*31 */  "N6_RashAll",
                    /*32 */  "N6_ProcRashPrevVN",
                    /*33 */  "N6_ProcRashPrevRub",
                    /*34 */  "N6_ProcRashAllVN",
                    /*35 */  "N6_ProcRashAllRub",
                    /*36 */  "N6_ProcRashRepRub",
                    /*T1 */  "N6_CrSD",
                    /*T2 */  "N6_CrBD",
                    /*Т3 */  "N6_DqualS",
                    /*Т4 */  "N6_DqualB",
                    /*Т5 */  "N6_ContS",
                    /*Т6 */  "N6_ContB",
                    /*Т7 */  "N6_FilS",
                    /*Т8 */  "N6_FilB",
                    /*Т9 */  "N6_SecType",
                    /*Т10*/  "N6_DepS",
                    /*Т11*/  "N6_DepB"
                           
                           );  

     m_Report.SetCellAutoSummaPoint( "Всего:",
                                "N6_Qnty",6,        
                                "N6_SumSvn",2, 
                                "N6_SumSrub",2,                
                                "N6_DifS",2,    
                                "N6_ComS",2,                        
                                "N6_SumBvn",2,  
                                "N6_SumBrub",2,             
                                "N6_DifB",2,    
                                "N6_SumBtax",2, 
                                "N6_ComB",2,    
                                "N6_RashAll",2,    
                                "N6_ProcRashPrevVN",2,  
                                "N6_ProcRashPrevRub",2, 
                                "N6_ProcRashAllVN",2,   
                                "N6_ProcRashAllRub",2,  
                                "N6_ProcRashRepRub",2
                              );

     this.ПечататьСтрокуТаблицы( Строка_Итого );
  END;

  
  MACRO ПечататьПромежуточныеИтоги()
     
     m_Report.SetSubtotal(29, 26 + MAXROWSHEET,
                          "J23",               
                          "L23",             
                          "M23",            
                          "Q23",               
                          "R23",               
                          "W23",             
                          "X23",            
                          "AB23",               
                          "AC23",            
                          "AD23",               
                          "AE23",            
                          "AF23",     
                          "AG23",    
                          "AH23",      
                          "AI23",     
                          "AJ23"      
                    );                                                                      
  END;


  MACRO ПечататьСтрокуТаблицы( LineType:INTEGER )

     if( LineType == Строка_СтрокаДанных )

        m_Report.PrintTableLine( "N6_SecCode",              m_Report.SecCode(),               null,   /*1  */ 
                                 "N6_SecName",              m_Report.SecName(),               null,   /*2  */ 
                                 "N6_CodeS",                m_Report.CodeS(),                 null,   /*3  */ 
                                 "N6_DZS",                  m_Report.DZS(),                   null,   /*4  */ 
                                 "N6_DDS",                  m_Report.DDS(),                   null,   /*5  */ 
                                 "N6_Nom",                  m_Report.Nom(),                   null,   /*6  */ 
                                 "N6_VN",                   m_Report.VN(),                    null,   /*7  */ 
                                 "N6_DAuс",                 m_Report.DAuc(),                  null,   /*8  */ 
                                 "N6_Dexp",                 m_Report.Dexp(),                  null,   /*9  */ 
                                 "N6_Qnty",                 m_Report.Qnty(),                  m_Report.QntyPrecision(),   /*10 */ 
                                 "N6_PrSnom",               m_Report.PrSnom(),                null,   /*11 */ 
                                 "N6_SumSvn",               m_Report.SumSvn(),                null,   /*12 */ 
                                 "N6_SumSrub",              m_Report.SumSrub(),               null,   /*13 */ 
                                 "N6_MinMrkt",              m_Report.MinMrkt(),               null,   /*14 */ 
                                 "N6_MrktS",                m_Report.MrktS(),                 null,   /*15 */ 
                                 "N6_DMrktS",               m_Report.DMrktS(),                null,   /*16 */ 
                                 "N6_DifS",                 m_Report.DifS(),                  null,   /*17 */ 
                                 "N6_ComS",                 m_Report.ComS(),                  null,   /*18 */ 
                                 "N6_CodeB",                m_Report.CodeB(),                 null,   /*19 */ 
                                 "N6_DZB",                  m_Report.DZB(),                   null,   /*20 */ 
                                 "N6_Dlink",                m_Report.Dlink(),                 null,   /*21 */ 
                                 "N6_PrBnom",               m_Report.PrBnom(),                null,   /*22 */ 
                                 "N6_SumBvn",               m_Report.SumBvn(),                null,   /*23 */ 
                                 "N6_SumBrub",              m_Report.SumBrub(),               null,   /*24 */ 
                                 "N6_MaxMrkt",              m_Report.MaxMrkt(),               null,   /*25 */ 
                                 "N6_MrktB",                m_Report.MrktB(),                 null,   /*26 */ 
                                 "N6_DMrktB",               m_Report.DMrktB(),                null,   /*27 */ 
                                 "N6_DifB",                 m_Report.DifB(),                  null,   /*28 */ 
                                 "N6_SumBtax",              m_Report.SumBtax(),               null,   /*29 */ 
                                 "N6_ComB",                 m_Report.ComB(),                  null,   /*30 */ 
                                 "N6_RashAll",              m_Report.RashAll(),               null,   /*31 */ 
                                 "N6_ProcRashPrevVN",       m_Report.ProcRashPrevVN(),        null,   /*32 */ 
                                 "N6_ProcRashPrevRub",      m_Report.ProcRashPrevRub(),       null,   /*33 */ 
                                 "N6_ProcRashAllVN",        m_Report.ProcRashAllVN(),         null,   /*34 */ 
                                 "N6_ProcRashAllRub",       m_Report.ProcRashAllRub(),        null,   /*35 */ 
                                 "N6_ProcRashRepRub",       m_Report.ProcRashRepRub(),        null,   /*36 */ 
                                 "N6_CrSD",                 m_Report.printCrSD(),             null,   /*T1 */ 
                                 "N6_CrBD",                 m_Report.printCrBD(),             null,   /*Т2 */ 
                                 "N6_DqualS",               m_Report.DqualS(),                null,   /*Т3 */ 
                                 "N6_DqualB",               m_Report.DqualB(),                null,   /*Т4 */ 
                                 "N6_ContS",                m_Report.ContS(),                 null,   /*Т5 */ 
                                 "N6_ContB",                m_Report.ContB(),                 null,   /*Т6 */ 
                                 "N6_FilS",                 m_Report.FilS(),                  null,   /*Т7 */ 
                                 "N6_FilB",                 m_Report.FilB(),                  null,   /*Т8 */ 
                                 "N6_SecType",              m_Report.SecType(),               null,   /*Т9 */ 
                                 "N6_DepS",                 m_Report.DepS(),                  null,   /*Т10*/ 
                                 "N6_DepB",                 m_Report.DepB(),                  null    /*Т11*/ 
                               );                                          
                                                                           
     elif( LineType == Строка_Итого )                                      

        m_Report.SetCurrentLineFont( 10, true, false );
        m_Report.PrintTableLine( "N6_SecCode",  "Всего:", null );

        m_Report.SetCurrentLineFont( 10, false, false );
        m_Report.PrintTableLine( "N6_SecCode",  "в том числе", null );

     end;
  END;         

  MACRO EndReport()
     m_Report.EndTable();
     ПечататьПромежуточныеИтоги();
     m_Report.AddStandardFooter( "N6_" );
  END;
END;



PRIVATE CLASS (TX_RegistrReport) SP_ShRepReg_Report( Form:DL_CPanel, TemplateName:STRING, UseCSV:BOOL, IsWebService:BOOL, ReportHashCode:INTEGER )
  PRIVATE VAR m_SheetCount = 0, /*m_RS, m_H07, m_H08, m_ReportKind*/;
  PRIVATE VAR m_AvrGroup,
              m_dl_leg   = TRecHandler( "dl_leg.dbt" );
  //PRIVATE VAR m_CacheFinInstr = TX_CacheFinInstr();

  PRIVATE VAR m_IsDataExist = false; /*для Web, если нет данных, то ничего не показываем*/

 /* не показывать пустые отчет в Web*/
  MACRO CReport_DataExist()
    if(m_IsWebService == true )
      return (m_IsDataExist or ReportHasError() );
    else
      return true;                   /*в EW показываем листы всегда*/
    end;
  END; 

  MACRO PrintMode():INTEGER
     return DL_OUTREPORT_EXCEL;
  END;

  PRIVATE MACRO BeginReport( )
     m_SheetCount = 0;
     m_H07 = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_BEGINDATE );
     m_H08 = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_ENDDATE );
  END;

  PRIVATE MACRO SetAutoFilter()
     if( ExistsSheet( SHEET_0601 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AU28", SHEET_0601);
     end;

     if( ExistsSheet( SHEET_0602 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AS28", SHEET_0602);
     end;

     if( ExistsSheet( SHEET_0603 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AO28", SHEET_0603);
     end;

     if( ExistsSheet( SHEET_0604 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AV28", SHEET_0604);
     end;

     if( ExistsSheet( SHEET_0605 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:BH28", SHEET_0605);
     end;

     if( ExistsSheet( SHEET_0606 ) )
        m_ObjTemplateXLS.SetAutoFilter("A28:AU28", SHEET_0606);
     end;
  END;

  PRIVATE MACRO EndReport()
    EndReport();
    SetAutoFilter();
  END;

  MACRO PrintHeader( FldPref:STRING )

     PrintFormatString( ReportHeader,
            FldPref+"H0_A:l" , this.H0_A(),  // Банк
            FldPref+"H0_B:l" , this.H0_B(),  // Инн/КПП
            FldPref+"H0_1"   , this.H0_1(),  // Приложение №
            FldPref+"H0_3"   , this.H0_3(),
            FldPref+"H0_12"  , this.H0_12(), // Аналитический регистр налогового учета №
            FldPref+"H0_2"   , this.H0_2(),
            FldPref+"H0_3"   , this.H0_3(),
            FldPref+"H0_1"   , this.H0_1(),
            FldPref+"H0_4"   , this.H0_4(),
            FldPref+"H0_5"   , this.H0_5(),
            FldPref+"H0_12"  , this.H0_12(), // Номер приложения синтетического регистра
            FldPref+"H0_2"   , this.H0_2(),  // Код строки в синтетическом регистре
            FldPref+"H0_3"   , this.H0_3(),  // Номер аналитического регистра
            FldPref+"H0_1"   , this.H0_1(),
            FldPref+"H0_4"   , this.H0_4(),  // Номер месяца (последний в отчетном периоде)
            FldPref+"H0_5"   , this.H0_5(),  // Две последние цифры года
            FldPref+"H0_6"   , this.H0_6(),  // Имя отчета
            FldPref+"H0_7"   , this.H0_7(),  // за период с
            FldPref+"H0_8"   , this.H0_8(),  // по
            FldPref+"H0_9"   , this.H0_9(),  // Группа налогового учета
            FldPref+"H0_10"  , this.H0_10(), // Вид ц/б
            FldPref+"H0_11"  , this.H0_11()  // Выпуск ц/б
          );
  END;

  PRIVATE MACRO ExecuteReport( ObjReport:OBJECT )

     PRIVATE MACRO Get_Rep_Name()
        if( m_ReportKind == SHREP_REG_0601 )
           return "0601";
        elif( m_ReportKind == SHREP_REG_0602 )
           return "0602";
        elif( m_ReportKind == SHREP_REG_0603 )
           return "0603";
        elif( m_ReportKind == SHREP_REG_0604 )
           return "0604";
        elif( m_ReportKind == SHREP_REG_0605 )
           return "0605";
        elif( m_ReportKind == SHREP_REG_0606 )
           return "0606";
        end;
     END;


     VAR DataQuery, AvrFIID, AvrKind, AddWhere = "", Rep_Name,
         AvrFIIDList = null,
         AvrFIIDCount : Integer = 0,
         AvrFIIDAddWhere : String = "",
         WasSetSecurity : Bool = false,

         AvrKindList = null,
         AvrKindAddWhere : String = "",
         AvrKindCount : Integer = 0,
         
         GNUList = null,
         GNUAddWhere : String = "",
         GNUCount : Integer = 0,
         AvrGroup;
     VAR ProgressValue = CTxProgressValue();

     ObjReport.BeginReport();
     T_Dep.ClearArray();

     /*ценные бумаги в соединенных сделках  должны удовлетворять условиям, заданным панели подготовки отчета*/
     if( not m_IsWebService )
        AvrFIIDList = TArray();
        AvrFIIDList[AvrFIIDList.Size] = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_AVRCODE );
     else
        AvrFIIDList = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_AVRCODE );
     end;
     if( ( ValType( AvrFIIDList ) != V_UNDEF ) and ( AvrFIIDList.Size > 0 ) )
        while( AvrFIIDCount < AvrFIIDList.Size )
           if( ( ValType( AvrFIIDList[AvrFIIDCount] ) == V_INTEGER )
           and ( AvrFIIDList[AvrFIIDCount] > 0 ) )
              if( AvrFIIDAddWhere == "" )
                 AvrFIIDAddWhere = AvrFIIDAddWhere + " AND ( ";
              else
                 AvrFIIDAddWhere = AvrFIIDAddWhere + " OR ";
              end;
              AvrFIIDAddWhere = AvrFIIDAddWhere + " TXLotSale.t_FIID = " + String( AvrFIIDList[AvrFIIDCount] ) + " ";
           end;
           AvrFIIDCount = AvrFIIDCount + 1;
        end;
        if( AvrFIIDAddWhere != "" )
           AvrFIIDAddWhere = AvrFIIDAddWhere + " ) ";
           WasSetSecurity = true;
        end;
        AddWhere = AddWhere + AvrFIIDAddWhere;
     end;

     /*если не задана бумага*/
     if( not WasSetSecurity )
        if( not m_IsWebService )
           AvrKindList = TArray();
           AvrKindList[AvrKindList.Size] = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_AVRKIND );
        else
           AvrKindList = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_AVRKIND );
        end;
        /*задан вид бумаги*/
        if( ( ValType( AvrKindList ) != V_UNDEF ) and ( AvrKindList.Size > 0 ) )
           while( AvrKindCount < AvrKindList.Size )
              if( ( ValType( AvrKindList[AvrKindCount] ) == V_INTEGER )
              and ( AvrKindList[AvrKindCount] > 0 ) )
                 if( AvrKindAddWhere == "" )
                    AvrKindAddWhere = AvrKindAddWhere + " AND ( ";
                 else
                    AvrKindAddWhere = AvrKindAddWhere + " OR ";
                 end;
                 AvrKindAddWhere = AvrKindAddWhere + " RSB_FIInstr.FI_AvrKindsEQ(2, " + String( AvrKindList[AvrKindCount] ) + ", FinInstr.t_AvoirKind) = 1 ";
              end;
              AvrKindCount = AvrKindCount + 1;
           end;
           if( AvrKindAddWhere != "" )
              AvrKindAddWhere = AvrKindAddWhere + " ) ";
           end;
           AddWhere = AddWhere + AvrKindAddWhere;
        end;

        if( not m_IsWebService )
           GNUList = TArray();
           GNUList[GNUList.Size] = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_AVRGROUP );
        else
           GNUList = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_AVRGROUP );
        end;
        /*задана категория бумаги*/
        if( ( ValType( GNUList ) != V_UNDEF ) and ( GNUList.Size > 0 ) )
           while( GNUCount < GNUList.Size )
              if( ( ValType( GNUList[GNUCount] ) == V_INTEGER )
              and ( GNUList[GNUCount] > 0 ) )
               if( GNUAddWhere == "" )
                    GNUAddWhere = GNUAddWhere + " AND ( ";
                 else
                    GNUAddWhere = GNUAddWhere + " OR ";
                 end;
                 GNUAddWhere = GNUAddWhere + " av.t_TaxGroup = " + String( GNUList[GNUCount] ) + " ";
              end;
              GNUCount = GNUCount + 1;
           end;
           if( GNUAddWhere != "" )
              GNUAddWhere = GNUAddWhere + " ) ";
           end;
           AddWhere = AddWhere + GNUAddWhere;
        end;
     end;

     if( (ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_EXCLUDE ) == "X") AND (ИсключаемыеИзОтчетаЦБ != "") )
        AddWhere = AddWhere + " AND FinInstr.t_FI_Code not in (" + ИсключаемыеИзОтчетаЦБ + ")";
     end;

     DataQuery = " SELECT TXLink.t_Date as Dlink, TXLink.t_Amount, TXLink.t_SaleID as SaleID, TXLink.t_BuyID as BuyID," +

                 Get_PartyName_Query( "DealSale", "PartyNameSale" ) + ", " +/*PartyNameSale*/
                 Get_PartyName_Query( "DealBuy",  "PartyNameBuy" )  + ", " +/*PartyNameBuy*/

                 " Rsb_SCTX.TXGetComissionsSum(DealSale.t_DealID, DealSale.t_BOfficeKind, TXLotSale.t_SALEDATE, 0) as CommSale, " +
                 " Rsb_SCTX.TXGetComissionsSum(DealBuy.t_DealID,  DealBuy.t_BOfficeKind,  TXLink.t_Date,   0) as CommBuy, " +

                 IIF ( (m_ReportKind != SHREP_REG_0601),
                        "       Rsb_SCTX.TXGetBondKind(av.t_TaxGroup) TaxGroupType, ", ""
                     ) + 
                 "        FinInstr.t_FIID, FinInstr.t_FI_Code AS AvrCode, FinInstr.t_Name AS AvrName, FinInstr.t_FaceValueFI AS FaceValueFI, FinInstr.t_DrawingDate, FinInstr.t_SumPrecision, FinInstr.t_Issued, av.t_TaxGroup, FinInstr.t_AvoirKind,"+
                 "        TXLotSale.t_DealID AS DealSaleID, TXLotSale.t_DEALDATE AS DealSaleDate, TXLotSale.t_SALEDATE AS SaleDate, TXLotSale.t_DEALCODETS AS DealSaleCodeTS, (CASE WHEN TXLotSale.t_VirtualType <> "+ TXVDEAL_REAL+" THEN TXLotSale.t_PriceFIID ELSE FinInstr.t_FaceValueFI END) AS SalePriceFIID,LegS.t_Price AS SalePrice, LegS.t_Principal AS SaleAmount,"+
                 "        TXLotBuy.t_DealID  AS DealBuyID,  TXLotBuy.t_DEALDATE AS  DealBuyDate,  TXLotBuy.t_BuyDATE   AS BuyDate,  TXLotBuy.t_DEALCODETS  AS DealBuyCodeTS, (CASE WHEN TXLotBuy.t_VirtualType <> "+ TXVDEAL_REAL+" THEN TXLotBuy.t_PriceFIID ELSE FinInstr.t_FaceValueFI END) AS BuyPriceFIID,LegB.t_Price AS BuyPrice, LegB.t_Principal AS BuyAmount,"+
                 "        TXLotSale.t_VirtualType SaleVirtualType, " +
                 "        TXLotBuy.t_VirtualType BuyVirtualType, " +
                 "        Rsb_SCTX.GetMarketPrice( TXLotSale.t_ID, 0, 0, 1 ) AS SaleMarketPrice,"+
                 "        Rsb_SCTX.GetMarket( TXLotSale.t_ID, 0 ) AS SaleMarket,"+
                 "        Rsb_SCTX.GetDateMarket( TXLotSale.t_ID, 0 ) AS SaleDateMarket,"+
                 "        Rsb_SCTX.GetMarketPrice( TXLotBuy.t_ID, 0 ) AS BuyMarketPrice,"+
                 "        Rsb_SCTX.GetMarket( TXLotBuy.t_ID, 0 ) AS BuyMarket,"+
                 "        Rsb_SCTX.GetDateMarket( TXLotBuy.t_ID, 0 ) AS BuyDateMarket, "+
                 "        TXLotBuy.t_VirtualType as VirtualTypeBuy, TXLotSale.t_VirtualType as VirtualTypeSale, "+
                 "        DataBuy.DealBuyGroup AS DealBuyGroup, DealBuy.t_Department AS DealBuyDepartment, "+
                 "        DataSale.DealSaleGroup AS DealSaleGroup, DealSale.t_Department AS DealSaleDepartment, "+
                 "        (CASE WHEN TXLotSale.t_VirtualType = "+ TXVDEAL_REAL+" THEN LegS.t_CFI ELSE FinInstr.t_FaceValueFI END) AS VprS, "
                 "        LegB.t_CFI AS VprB, "
                 "        DataSale.LegKindSale, DataBuy.LegKindBuy, LegB.t_NKD as NKDB, "
                 "        Rsb_SCTX.CheckObjAttrPresenceByNum(3,47,'1',lpad(case when DealSale.t_MarketID <> -1 and DealSale.t_PartyID = -1 then DealSale.t_MarketID else DealSale.t_PartyID end, 10, '0'),TXLotSale.t_DEALDATE) DepS, "
                 "        Rsb_SCTX.CheckObjAttrPresenceByNum(3,47,'1',lpad(case when DealBuy.t_MarketID <> -1 and DealBuy.t_PartyID = -1 then DealBuy.t_MarketID else DealBuy.t_PartyID end, 10, '0'),TXLotBuy.t_DEALDATE) DepB "

                 "   FROM DSCTXLNK_DBT  TXLink,"+
                 "        DSCTXLOT_DBT  TXLotSale," +
                 "        DSCTXLOT_DBT  TXCurLotSale," +
                 "        DSCTXLOT_DBT  TXLotBuy," +
                 "        DSCTXLOT_DBT  TXLotSource," +
                 "        DDL_TICK_DBT  DealSale," +
                 "        DDL_TICK_DBT  DealBuy," +
                 "        DFININSTR_DBT FinInstr, " + 
                 "        DAVOIRISS_DBT av, " + 
                 "        ddl_leg_dbt   LegS, " + 
                 "        ddl_leg_dbt   LegB, " +

                 "        ( Select SaleOper.t_Kind_Operation, SaleOper.t_DocKind, " +
                 "                 rsb_secur.get_OperationGroup(SaleOper.t_SysTypes) as DealSaleGroup, " +
                 "                 (CASE WHEN " +
                 "                            ((Rsb_Secur.IsBuy(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                 "                          or (Rsb_Secur.IsAvrWrtIn(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                 "                            ) " +
                 "                       THEN 2 " +
                 "                       ELSE 0 END " +
                 "                 ) as LegKindSale " +
                 "            From " +
                 "                 doprkoper_dbt SaleOper " + 
                 "        ) DataSale, " +

                 "        ( Select BuyOper.t_Kind_Operation, BuyOper.t_DocKind, " +
                 "                 rsb_secur.get_OperationGroup(BuyOper.t_SysTypes) as DealBuyGroup, " +
                 "                 (CASE WHEN " +
                 "                            ((Rsb_Secur.IsSale(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " +
                 "                          or (Rsb_Secur.IsAvrWrtOut(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " +
                 "                            ) " +
                 "                       THEN 2 " +
                 "                       ELSE 0 END " +
                 "                 ) as LegKindBuy " +
                 "            From " +
                 "                 doprkoper_dbt BuyOper " + 
                 "        ) DataBuy " +

                 "  WHERE TXLink.t_Type in (" + TXLNK_CLSREPO + ", " + TXLNK_CLSLOAN +") AND " +
                 "        ( ( ( TXLink.t_Date BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate(m_H08) + " ) AND " +
                 "            ( TXLink.T_BEGDATE IS NULL OR " +
                 "              TXLink.T_BEGDATE = " + GetSQLDate( DATE(0,0,0) ) + 
                 "            ) " +
                 "          ) OR " +
                 "          ( TXLink.T_BEGDATE BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate( m_H08 ) + 
                 "          ) " +
                 "        ) AND " +
                 "        ( TXLink.T_ENDDATE = to_date('01.01.0001', 'DD.MM.YYYY') OR TXLink.T_ENDDATE > " + GetSQLDate( m_H08 ) + 
                 "        ) AND " +
                 "        TXLink.t_SaleID = TXCurLotSale.t_ID AND " +
                 "        TXLotSale.t_ID = TXCurLotSale.t_BegLotID AND "
                 "        TXLink.t_BuyID  = TXLotBuy.t_ID AND " +
                 "        TXLink.t_SourceID  = TXLotSource.t_ID AND " +
                 "        TXLotBuy.t_VirtualType = " + TXVDEAL_REAL + " AND " +
                 "        TXLotSale.t_DealID = DealSale.t_DealID(+) AND " +
                 "        TXLotBuy.t_DealID  = DealBuy.t_DealID(+) AND " +
                 "        FinInstr.t_FIID = TXLotSale.t_FIID AND " +
                 "        FinInstr.t_FIID = av.t_FIID AND " +
                 "        av.t_TaxGroup not in (35, 919, 943) AND " +
                 "        DataSale.t_Kind_Operation (+)= DealSale.t_DealType AND " +
                 "        DataSale.t_DocKind        (+)= DealSale.t_BOfficeKind AND " +
                 "        DataBuy.t_Kind_Operation  (+)= DealBuy.t_DealType AND " +
                 "        DataBuy.t_DocKind         (+)= DealBuy.t_BOfficeKind AND " +
                 "        LegS.t_DealID             = TXLotSale.t_DealID AND " +
                 "        LegS.t_LegKind            = DataSale.LegKindSale AND " +
                 "        LegS.t_LegID              = 0 AND " +
                 "        LegB.t_DealID             = TXLotBuy.t_DealID AND " +
                 "        LegB.t_LegKind            = DataBuy.LegKindBuy AND " +
                 "        LegB.t_LegID              = 0 " +

                          AddWhere + " AND " + ObjReport.Where();

     Rep_Name = Get_Rep_Name();

     ProgressValue.Maximum = SQL_GetNRecs( DataQuery );
     ProgressValue.Current = 0;

     var ProgressIndicator = CreateProgressIndicator(m_IsWebService);

     if( m_IsWebService and (WebMenuItem != null) )
       ProgressIndicator.Start(ProgressValue.Maximum, WebMenuItem.szNameItem, WebMenuItem.szNameItem);
     else
       ProgressIndicator.Start(ProgressValue.Maximum, Rep_Name, Rep_Name);
     end;

     m_RS = TRsbDataSet( DataQuery );

     this.SetCurrentLineFont( 8, false, false );

     while( m_RS.MoveNext() )

        ClearCacheOneRecord();
        m_IsDataExist = true;
        ObjReport.ПечататьСтрокуТаблицы( Строка_СтрокаДанных );           

        ProgressValue.Current = ProgressValue.Current + 1;
        ProgressIndicator.Update(ProgressValue.Current,ProgressValue.Maximum); // всего 3 парамера Update(index, count, text)
     end; 

     ProgressIndicator.Stop();
     ObjReport.EndReport();
  END;

  PRIVATE MACRO CreateReportByKind( Kind:INTEGER )
     m_ReportKind = Kind;

     if( Kind == SHREP_REG_0601 )
        ExecuteReport( CShRepReg_601(this) );
     elif( Kind == SHREP_REG_0602 )
        ExecuteReport( CShRepReg_602(this) );

     elif( Kind == SHREP_REG_0603 )
        ExecuteReport( CShRepReg_603(this) );
     elif( Kind == SHREP_REG_0604 )
        ExecuteReport( CShRepReg_604(this) );

     elif( Kind == SHREP_REG_0605 )
        ExecuteReport( CShRepReg_605(this) );

     elif( Kind == SHREP_REG_0606 )
        ExecuteReport( CShRepReg_606(this) );
     end;
  END;

  PRIVATE MACRO Create()
     var SubKindList = null;
     var SubKindCount : Integer = 0;
     if( not m_IsWebService )
        SubKindList = TArray();
        SubKindList[SubKindList.Size] = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_SUBKIND );
     else
        SubKindList = ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_SUBKIND );
     end;

     if( ( ValType( SubKindList ) != V_UNDEF )
     and ( SubKindList.Size > 0 )
     and ( ValType( SubKindList[SubKindCount] ) == V_INTEGER )
     and ( SubKindList[SubKindCount] != SHREP_REG_ALL ) )
        while( SubKindCount < SubKindList.Size )
           CreateReportByKind( SubKindList[SubKindCount] );
           SubKindCount = SubKindCount + 1;
        end;
     else
        CreateReportByKind( SHREP_REG_0601 );
        CreateReportByKind( SHREP_REG_0602 );
        CreateReportByKind( SHREP_REG_0603 );
        CreateReportByKind( SHREP_REG_0604 );
        CreateReportByKind( SHREP_REG_0605 );
        CreateReportByKind( SHREP_REG_0606 );
     end;
  END;

  /*Кэшируемые данные для 1 записи отчета */
  PRIVATE VAR  m_CoupPrevVN, 
               m_ProcRashAllRub, m_ProcRashPrevRub, m_ProcRepRub, m_CoupPrevRub, m_NkdCloseRub, m_AmortPozVN, m_AmortPozRub, m_NkdRepRub,
              m_NkdCloseVN, 
              m_DealSaleGroup, m_DealBuyGroup,
              m_SumVn, m_ProcRashAllVN,  m_ProcRashPrevVN, m_DivDeal, m_DivOne, m_printDivOne,
              m_pwrtsumBuy  = TBFile( "pmwrtsum.dbt", "R", 0 ),
              m_pwrtsumSale = TBFile( "pmwrtsum.dbt", "R", 0 );

  MACRO ClearCacheOneRecord()
     this.ClearCacheOneRecord();
     m_DZS   = null;
     m_PrSvn = null;
     m_NkdSvn= null;
     m_NomS  = null;
     m_NomB  = null;
     m_NkdPrevVN = null;
     m_CoupPrevVN= null;
     m_PrAucNom  = null;
     m_CoupVN    = null;
     m_ProcRashAllRub= null;
     m_ProcRashPrevRub= null;
     m_ProcRepRub= null;
     m_CoupRub   = null;
     m_CoupPrevRub= null;
     m_NkdCloseRub= null;
     m_AmortPozVN= null;
     m_AmortPozRub= null;
     m_PrBNom    = null;
     m_SumSrub   = null;
     m_ComS      = null;
     m_pwrtsumBuy.Clear();
     m_pwrtsumSale.Clear();
     m_DealSale.Clear();
     m_DealBuy.Clear();
     m_DealSaleGroup = null;
     m_DealBuyGroup  = null;
     m_DZB       = null;
     m_PrBVN     = null;
     m_PrSNom    = null;
     m_SumSvn    = null;
     m_SumSvp    = null;
     m_SumBvn    = null;
     m_SumBvp    = null;
     m_SumVn     = null;
     m_NkdCloseVN= null;
     m_DifB      = null;
     m_ComB      = null;
     m_CrSZ      = null;
     m_CrBZ      = null;
     m_SumBrub   = null;
     m_CrSD      = null;
     m_CrBD      = null;
     m_ProcRashPrevVN=null;
     m_ProcRashAllVN=null;
     m_DivDeal   = null;
     m_DivOne    = null;
     m_printDivOne = true;
  END;


  /*Наименование нашего банка*/
  MACRO H0_A():STRING
     return ПолучитьКороткоеИмяСубъекта( {OurBank} );
  END;

  /*ИНН / КПП нашего банка*/
  MACRO H0_B()
     VAR INN, KPP;

     SplitFullINN( ПолучитьКодСубъекта({OurBank}, PTCK_INN), INN, KPP );
     return INN + "/" + KPP;
  END;

  /*Константа, задаваемая в макросе формировании отчета. Значение константы - текст "06"*/
  MACRO H0_1():STRING
     return "06";
  END;

  /*Константа, задаваемая в макросе формировании отчета.  Значение константы - текст  "XXX"*/
  MACRO H0_2():STRING
     return "XXX";
  END;

  /*Константа, задаваемая в макросе формировании отчета. Значение константы -текст
       "01" - для подвида 0301
       "02" - для подвида 0302  */
  MACRO H0_3():STRING
     if( m_ReportKind == SHREP_REG_0601 )
        return "01";
     elif( m_ReportKind == SHREP_REG_0602 )
        return "02";
     elif( m_ReportKind == SHREP_REG_0603 )
        return "03";
     elif( m_ReportKind == SHREP_REG_0604 )
        return "04";
     elif( m_ReportKind == SHREP_REG_0605 )
        return "05";
     elif( m_ReportKind == SHREP_REG_0606 )
        return "06";
     end;
  END;

  /*Номер месяца из даты <H0_.8>*/
  MACRO H0_4():STRING
     VAR Month;
     DateSplit( this.H0_8(), null, Month, null );

     return string(Month:2:o);
  END;

  /*Две последние цифры года из даты <H0_.8>*/
  MACRO H0_5():STRING
     VAR Year;
     DateSplit( this.H0_8(), null, null, Year );

     return SubStr( string(Year), strlen(string(Year))-1 );
  END;

  /*Название подвида регистра: */
  MACRO H0_6():STRING
     if( m_ReportKind == SHREP_REG_0601 )
        return "Доходы (расходы) по операциям, связанным с открытием ( закрытием) коротких позиций по акциям (номинированным в валюте РФ), паям и депозитарным распискам";
     elif( m_ReportKind == SHREP_REG_0602 )
        return "Доходы (расходы) по операциям, связанным с открытием ( закрытием) коротких позиций по купонным облигациям (номинированным в валюте РФ)";
     elif( m_ReportKind == SHREP_REG_0603 )
        return "Доходы (расходы) по операциям, связанным с открытием ( закрытием) коротких позиций по дисконтным облигациям (номинированным в валюте РФ)";
     elif( m_ReportKind == SHREP_REG_0604 )
        return "Доходы (расходы) по операциям, связанным с открытием ( закрытием) коротких позиций по акциям (номинированным в валюте) и депозитарным распискам";
     elif( m_ReportKind == SHREP_REG_0605 )
        return "Доходы (расходы) по операциям, связанным с открытием ( закрытием) коротких позиций по купонным облигациям (номинированным в иностранной валюте)";
     elif( m_ReportKind == SHREP_REG_0606 )
        return "Доходы (расходы) по операциям, связанным с открытием ( закрытием) коротких позиций по дисконтным облигациям (номинированным в иностранной валюте)";
     end;
  END;

  /*Начальная дата*/
  MACRO H0_7():DATE
     return ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_BEGINDATE );
  END;

  /*Конечная дата*/
  MACRO H0_8():DATE
     return ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_ENDDATE );
  END;

  /*Группа налогового учета*/
  MACRO H0_9():STRING
     var GroupName = "";
     ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_AVRGROUP, @GroupName );
     return GroupName;
  END;

  /*Вид ц/б*/
  MACRO H0_10():STRING
     var AvrKindShowValue = "";
     ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_AVRKIND, @AvrKindShowValue );
     return AvrKindShowValue;
  END;

  /*Выпуск ц/б*/
  MACRO H0_11():STRING
     return ShRepReg_Form.GetFieldValue( PNFLD_SHREP_REG_AVRNAME );
  END;

  /*Константа, задаваемая в макросе формировании отчета.  Значение константы - текст  "РР"*/
  MACRO H0_12():STRING
     return "PP";
  END;

  MACRO Дк():DATE // дата начала купона, который начинается до <H0.7> включительно, а заканчивается после <H0.7>,
     var Дк;
     //нужно очищать, так как используется другая дата
     m_CacheFinInstr.Clear();
     Дк = m_CacheFinInstr.GetCouponParms( m_RS.FIID, this.H0_7(), date(1,1,9999) ).m_Дк;
     m_CacheFinInstr.Clear();
     return Дк;
  END;

  MACRO Дн2():DATE // максимальная из двух дат: (<H0.7>; <DDS>+1)
     return MAX( this.H0_7(), this.DDS()+1 );
  END;

  MACRO Dlink():DATE // Дата закрытия короткой позиции
     return SQL_ConvTypeDate(m_RS.Dlink);
  END;

  MACRO PrSvp():DOUBLE // Цена реализации - в валюте
     var PrSvp = this.PrSvp();
     if((m_ReportKind == SHREP_REG_0601) and (m_RS.VprS == NATCUR))
       PrSvp = 0.0;
     end;
     return PrSvp;
  END;

  MACRO DBV():DATE
    return this.Dlink();
  END;

  MACRO SumSvp():MONEY //  Стоимость реализации - в валюте  
     if( m_SumSvp == NULL )
        if(m_RS.VirtualTypeSale != TXVDEAL_REAL)  //виртуальная
          m_SumSvp = this.Qnty()*m_RS.SalePrice;
        else
          this.SumSvp();
        end;
     end;
     return m_SumSvp;
  END;

  MACRO NkdSvn():MONEY //  НКД полученный при реализации (погашении)
     if( m_NkdSvn == NULL )

        if(m_RS.VirtualTypeSale != TXVDEAL_REAL) //виртуальная
          m_NkdSvn = НКД( m_RS.t_FIID, this.Qnty(), this.DDS() );
        else
          this.NkdSvn();
        end;
     end;
     return m_NkdSvn;
  END;

  MACRO PrBvp():DOUBLE // Цена приобретения - в валюте
     var PrBvp = this.PrBvp();
     if((m_ReportKind == SHREP_REG_0601) and (m_RS.VprB == NATCUR))
       PrBvp = 0.0;
     end;
     return PrBvp;
  END;

  MACRO CoupPrevVN():MONEY // Сумма купонов, выплаченных эмитентом до начала текущего отчетного (налогового) периода  :
     if( m_CoupPrevVN == NULL )
        m_CoupPrevVN = $0;
        if( this.DDS() < this.H0_7() )
           m_CoupPrevVN = GetCouponSumByPeriod( m_RS.FIID, this.Qnty(), this.DDS()+1, this.H0_7()-1 );
        end;
     end;
     return m_CoupPrevVN;
  END;

  MACRO CoupPrevRub():MONEY // Сумма купонов, выплаченных эмитентом до начала текущего отчетного (налогового) периода - в рублях
     if( m_CoupPrevRub == NULL )
        if( this.DDS() < this.H0_7() )
           m_CoupPrevRub = GetCouponSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.DDS()+1, this.H0_7()-1, m_RS.FaceValueFI );
        else
           m_CoupPrevRub = $0;
        end;
     end;
     return m_CoupPrevRub;
  END;

  MACRO CoupVN():MONEY //  Купонный доход, полученный от эмитента при погашении купонов в отчетном (налоговом) периоде (кроме купона, полученного при погашении бумаги) :
     if( m_CoupVN == NULL )
        if( (m_ReportKind == SHREP_REG_0602) OR (m_ReportKind == SHREP_REG_0605) )
           m_CoupVN = GetCouponSumByPeriod( m_RS.FIID, this.Qnty(), this.Дн2(), this.Dlink() );
        end;
     end;
     return m_CoupVN;
  END;

  MACRO CoupRub():MONEY // Сумма купонов, выплаченных эмитентом в текущем отчетном (налоговом) периоде - в рублях
     if( m_CoupRub == NULL )
        if(m_ReportKind == SHREP_REG_0605)
           m_CoupRub = GetCouponSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.Дн2(), this.Dlink(), m_RS.FaceValueFI );
        end;
     end;
     return m_CoupRub;
  END;

  MACRO Discount(Pr, Dcalc, Dstart, Ddisc, KD)
    return this.Qnty() * this.Nom() * (100 - Pr)*(Dcalc - Ddisc) * KD /((this.Dexp() - Dstart)*100);
  END;

  MACRO ProcRashAllVN():MONEY //Процентный расход по операции, связан-ной с открытием короткой позиции - всего
    var Dcalc, KD, Ddisc, Pr, Dstart;
    if(m_ProcRashAllVN == NULL)
      Dcalc = this.Dlink(); 
      KD = 1; 
      Ddisc = this.DDS();

      if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
        Pr = this.PrAucNom();
        Dstart = this.Dauc();
      else
        Pr = this.PrSNom();
        Dstart = this.DDS();
      end;

      m_ProcRashAllVN = Discount(Pr, Dcalc, Dstart, Ddisc, KD);
    end;
    return m_ProcRashAllVN;
  END;

  MACRO ProcRashAllRub():MONEY // Процентный расход по операции, связанной с открытием короткой позиции - всего, руб.  :
     if( m_ProcRashAllRub == NULL )
        if(m_ReportKind == SHREP_REG_0602)
           m_ProcRashAllRub = this.NkdCloseVN() + this.CoupPrevVN() + this.CoupVN() - this.NkdSvn();
        elif(m_ReportKind == SHREP_REG_0605)
           m_ProcRashAllRub = this.NkdCloseRub() + this.CoupPrevRub() + this.CoupRub() - this.NkdSrub();
        elif(m_ReportKind == SHREP_REG_0606)
           m_ProcRashAllRub = this.ProcRashAllVN() * GetRateOnDateCrossDbl( this.Dlink(), m_RS.FaceValueFI, NATCUR, true );
        end;
     end;
     return m_ProcRashAllRub;
  END;

  MACRO ProcRashPrevVN():MONEY // Процентный расход, учтенный для целей налогообложения до начала текущего от-четного (налогового) периода 
    var Dcalc, KD, Ddisc, Pr, Dstart;
    if(m_ProcRashPrevVN == NULL)
      if(this.DDS() >= this.H0_7())
        m_ProcRashPrevVN = $0;
      else
        Dcalc = this.H0_7()-1; 
        KD = 1; 
        Ddisc = this.DDS();

        if( ЛьготнаяОблигация( m_RS.TaxGroupType ) )
          Pr = this.PrAucNom();
          Dstart = this.Dauc();
        else
          Pr = this.PrSNom();
          Dstart = this.DDS();
        end;

        m_ProcRashPrevVN = Discount(Pr, Dcalc, Dstart, Ddisc, KD);
      end;
    end;
    return m_ProcRashPrevVN;
  END;

  MACRO ProcRashPrevRub():MONEY // Процентный расход, учтенный для целей налогообложения до начала текущего отчетного (налогового) периода, руб. :
     var K, D;
     if( m_ProcRashPrevRub == NULL )
        if( this.DDS() >= this.H0_7() )
           m_ProcRashPrevRub = 0.0;
        else
           if(m_ReportKind == SHREP_REG_0602)
              m_ProcRashPrevRub = this.NkdPrevVN() + this.CoupPrevVN() - this.NkdSvn();
           elif(m_ReportKind == SHREP_REG_0605)
              if (this.CoupPrevVN() == $0)
                 D = this.H0_7()-1;
              else
                 D = this.DDS();
              end;

              SmartConvertSum( K, $1, D, m_RS.FaceValueFI, NATCUR, true );

              m_ProcRashPrevRub = this.NkdPrevRub() + this.CoupPrevRub() - this.NkdSvn()*K;
           elif(m_ReportKind == SHREP_REG_0606)
              m_ProcRashPrevRub = this.ProcRashPrevVN()*GetRateOnDateCrossDbl( this.H0_7()-1, m_RS.FaceValueFI, NATCUR, true );
           end;
        end;
     end;
     return m_ProcRashPrevRub;
  END;

  MACRO ProcRashRepVN():MONEY // Процентный расход, учитываемый для целей налогообложения в текущем отчетном (налоговом) периоде, руб.
    return this.ProcRashAllVN()-this.ProcRashPrevVN();
  END;

  MACRO ProcRashRepRub():MONEY // Процентный расход, учитываемый для целей налогообложения в текущем отчетном (налоговом) периоде, руб.
    return this.ProcRashAllRub()-this.ProcRashPrevRub();
  END;

  MACRO AmortPozVN():MONEY // Доходы, полученные при частичном погашении номинала за период от даты открытия до даты закрытия КП :
     if( m_AmortPozVN == NULL )
        m_AmortPozVN = GetPartialSumByPeriod( m_RS.FIID, this.Qnty(), this.DDS()+1, this.DLink() );
     end;
     return m_AmortPozVN;
  END;

  MACRO AmortPozRub():MONEY // Сумма частичного погашения номинала, выплаченная эмитентом за период от даты открытия до даты закрытия КП, в валюте номинала - в рублях :
     if( m_AmortPozRub == NULL )
        m_AmortPozRub = GetPartialSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.DDS()+1, this.DLink() );
     end;
     return m_AmortPozRub;
  END;


  MACRO RashAll():MONEY // Расходы при реализации
     if( m_ReportKind == SHREP_REG_0602 )
       return this.ComS()+this.SumBtax()+ this.ComB() + this.AmortPozVn();
     elif(m_ReportKind == SHREP_REG_0605)
       return this.ComS()+this.SumBtax()+ this.ComB() + this.AmortPozRub();
     elif( (m_ReportKind == SHREP_REG_0601) or (m_ReportKind == SHREP_REG_0604) )
       return this.ComS() + this.SumBtax() + this.ComB() + this.DivDeal();
     else
       return this.ComS() + this.SumBtax() + this.ComB();
     end;
     return null;
  END;

  MACRO NkdCloseVN():MONEY //  НКД на дату закрытия короткой позиции - сумма в валюте номинала
     if( m_NkdCloseVN == NULL )
        if(this.VprB() == m_RS.FaceValueFI)
          m_NkdCloseVN = m_RS.NKDB * this.Qnty() / m_RS.BuyAmount;
        else
          m_NkdCloseVN = m_RS.NKDB * this.Qnty() / (m_RS.BuyAmount * this.CrBD());
        end;
     end;
     return m_NkdCloseVN;
  END;

  MACRO NkdCloseRub():MONEY // НКД на дату закрытия короткой позиции - в рублях
     if( m_NkdCloseRub == NULL )
        SmartConvertSum( m_NkdCloseRub, this.NkdCloseVN(), this.Dlink(), m_RS.FaceValueFI, NATCUR, true );
     end;
     return m_NkdCloseRub;
  END;

  MACRO SumBmain():MONEY
    if(m_RS.VirtualTypeBuy != TXVDEAL_REAL)  //виртуальная
      return m_RS.BuyAmount;
    else
      return LegBuy().rec.Cost;
    end;
  END;

  MACRO SumSmain():MONEY
    if(m_RS.VirtualTypeSale != TXVDEAL_REAL)  //виртуальная
      return m_RS.SaleAmount;
    else
      return LegSale().rec.Cost;
    end;
  END;

  MACRO DealSalePrice():DOUBLE
    if(m_RS.VirtualTypeSale != TXVDEAL_REAL)  //виртуальная
      return m_RS.SalePrice;
    else
      return LegSale().rec.Price;
    end;
  END;

  MACRO DealBuyPrice():DOUBLE
    if(m_RS.VirtualTypeBuy != TXVDEAL_REAL)  //виртуальная
      return m_RS.BuyPrice;
    else
      return LegBuy().rec.Price;
    end;
  END;

  MACRO FilS():STRING //  Номер сделки реализации - ГО/филиал
     VAR DprtName = "";
     if (m_RS.DealSaleID > 0)
       if((m_RS.VirtualTypeSale != TXVDEAL_REAL) and (SQL_ConvTypeDate(m_RS.DealSaleDate) < date(1,1,2010)))  //виртуальная
         DprtName = "";
       else
         DprtName = this.FilS();
       end;
     end;
     return DprtName;
  END;


  MACRO FilB():STRING //  Номер сделки приобретения - ГО/филиал
     VAR DprtName = "";
     if (m_RS.DealBuyID > 0)
        DprtName = this.FilB();
     end;
     return DprtName;
  END;

  MACRO SecType() // Налоговая группа
     return m_RS.TaxGroup;
  END;

  MACRO ContS():STRING // Контрагент по сделке реализации 
     if (m_RS.DealSaleID > 0)
        if((m_RS.VirtualTypeSale != TXVDEAL_REAL) and (SQL_ConvTypeDate(m_RS.DealSaleDate) < date(1,1,2010)))  //виртуальная
          return "";
        else
          return this.ContS();
        end;
     else
        return "";
     end;
  END;

  MACRO ContB():STRING // Контрагент по сделке приобретения
     if (m_RS.DealBuyID > 0)
        return this.ContB();
     else
        return "";
     end;
  END;

  MACRO DqualB():DATE
     if(m_RS.DealBuyID > 0)
        return this.DqualB();
     end;
  END;

  MACRO DqualS():DATE
     if(m_RS.DealSaleID > 0)
        return this.DqualS();
     end;
  END;

  MACRO NKDSale()
    return LegSale().rec.NKD;
  END;

  MACRO NKDBuy()
    return LegBuy().rec.NKD;
  END;

  MACRO NomB():MONEY // номинал облигации на дату <DDB>
     if( m_NomB == NULL )
        m_NomB = GetFaceValue( m_RS.t_FIID, this.Dlink(), true, false );
     end;
     return m_NomB;
  END;

  MACRO CVB():DOUBLE
    var CVB = 0.0;
    var VBRate = 0.0;
    if((m_RS.FaceValueFI != NATCUR) and (this.VprB() != NATCUR) and (m_RS.FaceValueFI == this.VprB()))
      CVB = GetRateOnDateCrossDbl( this.Dlink(), this.VprB(), NATCUR, true );
    elif((m_RS.FaceValueFI == NATCUR) and (this.VprB() == NATCUR))
      CVB = 1;
    else
      VBRate = GetRateOnDateCrossDbl( this.DZB(), this.VprB(), NATCUR, true );
      if((ValType(VBRate) != V_UNDEF) AND (VBRate != 0.0))
        CVB = GetRateOnDateCrossDbl( this.DZB(), m_RS.FaceValueFI, NATCUR, true )*GetRateOnDateCrossDbl( this.Dlink(), this.VprB(), NATCUR, true )/VBRate;
      end;
    end;
    return CVB;
  END;

  MACRO CVS():DOUBLE
    var CVS = 0.0;
    var VSRate = 0.0;
    if((m_RS.FaceValueFI != NATCUR) and (this.VprS() != NATCUR) and (m_RS.FaceValueFI == this.VprS()))
      CVS = GetRateOnDateCrossDbl( this.Dlink(), this.VprS(), NATCUR, true );
    elif((m_RS.FaceValueFI == NATCUR) and (this.VprS() == NATCUR))
      CVS = 1;
    else
      VSRate = GetRateOnDateCrossDbl( this.DZS(), this.VprS(), NATCUR, true );
      if((ValType(VSRate) != V_UNDEF) AND (VSRate != 0.0))
        CVS = GetRateOnDateCrossDbl( this.DZS(), m_RS.FaceValueFI, NATCUR, true )*GetRateOnDateCrossDbl( this.Dlink(), this.VprS(), NATCUR, true )/VSRate;
      end;
    end;
    return CVS;
  END;

  MACRO CoupCount():INTEGER
    return GetCountCouponInPeriod(m_RS.t_FIID, this.Дн2(), this.Dlink());
  END;

  MACRO LastCoupDate():DATE
    return GetMaxCouponDrawingDateInPeriod(m_RS.t_FIID, this.Дн2(), this.Dlink());
  END;

  MACRO NkdPrevVN():MONEY // Процентный доход, учтенный для целей налогообложения в предыдущем налоговом периоде, но не полученный от эмитента на начало отчетного (налогового) периода  :
    if( m_NkdPrevVN == NULL )
       if( this.DDS() < this.H0_7() )
          m_NkdPrevVN = НКД( m_RS.t_FIID, this.Qnty(), this.H0_7()-1);
       else
          m_NkdPrevVN = $0;
       end;
    end;
    return m_NkdPrevVN;
  END;

  //Дата составления списка акционеров
  MACRO Dfix():DATE
    var v_Dfix = NULL;
    if( H0_7() >= DATE(1,1,2014) )
       v_Dfix = GetMaxListDateInPeriod(m_RS.t_FIID, this.DDS()+1, this.Dlink());
       if( v_Dfix == ZeroDate )
          v_Dfix = NULL;/*не выводим*/
       end;
    end;
    return v_Dfix;
  END;

  //Объявленная сумма дивидендов на 1 акцию, в валюте номинала
  MACRO DivOne():MONEY
    if( m_DivOne == NULL )
       if( H0_7() >= DATE(1,1,2014) )
          m_DivOne = GetSummOnListDateInPeriod(m_RS.t_FIID, m_RS.FaceValueFI, this.DDS()+1, this.Dlink());
       else
          m_DivOne = $0;
          m_printDivOne = false;
       end;
    end;
    return m_DivOne;
  END;

  //Объявленная сумма дивидендов на 1 акцию, в валюте номинала
  MACRO printDivOne():MONEY
    this.DivOne();
    if( m_printDivOne )
       return this.DivOne();
    end;
    return NULL;
  END;

  //Начислено эмитентом - всего, руб
  MACRO DivDeal():MONEY
    if( this.printDivOne() != NULL )
       if( m_DivDeal == NULL )
       if( m_ReportKind == SHREP_REG_0601 )
          m_DivDeal = this.DivOne() * this.Qnty();
       else/*для 604*/
          m_DivDeal = this.Qnty() * GetSummOnListDateInPeriod(m_RS.t_FIID, NATCUR, this.DDS()+1, this.Dlink());
       end;
    end;
    else
       m_DivDeal = $0;
    end;
    return m_DivDeal;
  END;

  //Начислено эмитентом - всего, руб (Графа заполняется, если заполнена графа <DivOne>.)
  MACRO printDivDeal():MONEY
    if( this.printDivOne() != NULL )
       return this.DivDeal();
    end;
    return NULL;
  END;

  initTX_RegistrReport( Form, TemplateName, UseCSV, IsWebService, ReportHashCode );
END;

MACRO ReportRunEx(
  IsWebService    : Bool
 ,FormData      //: CTxReportForm
 ,ReportHashCode  : Integer
 ,menuItem      //: WsMenuItem
)
  var stat = true;
  var FullReportFileNames = TArray();
  WebMenuItem = menuItem;

if( CheckTaxDepositoryMode() == false ) /*если не включен режим хранилища данных для налогового учета*/
  msgbox("Отчет доступен только в режиме хранилища");

    stat = false;
  end;

  if( stat )
    if( not IsWebService )
      ShRepReg_Form = SP_ShRepReg_Panel();
    else
      if( ValType( FormData ) != V_UNDEF )
        ShRepReg_Form = WS_TX_ShRepReg_Panel( FormData );
else
        stat = false;
      end;
    end;
  end;

  while( stat )
    if( not IsWebService )
      stat = ShRepReg_Form.Run();
    end;

    if( stat )
      ShRepReg_Report = SP_ShRepReg_Report( null, "Report_TXShRep.xls", null, IsWebService, ReportHashCode );
      ShRepReg_Report.Run();

      if( IsWebService )
        Dl_CallInsertStat( ShRepReg_Report.PrintMode(), menuItem.iCaseItem, menuItem.iIdentProgram, menuItem.szNameItem );
        FullReportFileNames = ShRepReg_Report.GetFullReportFileNames();
        stat = false;
      else
        Dl_CallInsertStat( ShRepReg_Report.PrintMode() );
      end;
    end;
end;

  return FullReportFileNames;
END;
