/*
$Name:             IndNomBondReg_Report.mac
$Module:           €“
$Description:      Žâç¥â "¥£¨áâàë ¯® Žˆ" (“)
*/
IMPORT "RegistrReport.mac", "ws_txreportform.mac";

/*®¤¢¨¤ë à¥£¨áâà®¢*/
CONST INDNOM_REG_0292  = 1, //292
      INDNOM_REG_0491  = 2, //491
      INDNOM_REG_0692  = 3, //692
      INDNOM_REG_0791  = 4; //791

PRIVATE VAR WebMenuItem; // ˆ­ä®à¬ æ¨ï ® § ¯ãáª¥ ®âç¥â  ¨§ ¢¥¡
PRIVATE VAR WebFormData;
PRIVATE VAR m_AddWhereForAvr = "", m_H0_9_Name = "", m_H0_9_Num = "", m_H0_11 = "";

PRIVATE CONST BLUECOLOR  = RGB(255,255,204);

PRIVATE CONST ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€ = 26;
PRIVATE CONST ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ = 27;

PRIVATE CONST ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€_rshb_header = 13;
PRIVATE CONST ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ_rshb_header = 14;
private const NoDataTxt = "„€›• …’";

PRIVATE CONST ItogsLineName = "‚á¥£®:";

PRIVATE CONST ŽŒ…_Š€’…ƒŽˆˆ_Ÿ‚‹_‚‡€ˆŒŽ‡€‚ˆ‘_‹ˆ–ŽŒ = 74;

PRIVATE CONST SHEET_0292  = "0292";
PRIVATE CONST SHEET_0292s = "0292_‘¢®¤";
PRIVATE CONST SHEET_0491  = "0491";
PRIVATE CONST SHEET_0491s = "0491_‘¢®¤";
PRIVATE CONST SHEET_0692  = "0692";
PRIVATE CONST SHEET_0692s = "0692_‘¢®¤";
PRIVATE CONST SHEET_0791  = "0791";
PRIVATE CONST SHEET_0791s = "0791_‘¢®¤";

/*¨¬¥­  ïç¥¥ª ¯® áâ®«¡æ ¬*/
PRIVATE VAR
            C_SecCode_2     = "",
            C_SecCode       = "",
            C_Fin_Res       = "",
            C_DifB          = "",
            C_DifS          = "",
            C_ComS          = "",
            C_ComB          = "",
            C_Taxe_All      = "",
            C_Taxe_Amort    = "",
            C_Taxe_NKD      = "",
            C_Qnty          = "",
            C_SumAllRub     = "",
            C_RashAll       = "",
            C_SumSvp        = "",
            C_SumBvp        = "",                                 
            C_NkdSvp        = "",
            C_NkdBvp        = "",
            C_Unknown_16    = "",
            C_CoupRub       = "",
            C_NkdPrevRub_   = "",
            C_NkdPrevRub_IN = "",
            C_NKDminusRub   = "",
            C_NkdRepRub     = "",
            C_SumSrub       = "",
            C_Nom_DDS       = "",
            C_Nom_Sec       = "",
            C_NkdRepRub_    = "",
            C_NkdRepRub_IN  = "",
            C_NkdBrepRub    = "",
            C_NkdAllRub_    = "",
            C_NkdRepEndRub  = "",
            C_Nom_DDB       = "",
            C_NkdAllRub_IN  = "",
            C_Nom_H08       = "",
            C_CrBD          = "",
            C_MaxMrkt       = "",
            C_MrktB         = "",
            C_ContB_Dep     = "",
            C_SumBrub       = "",
            C_SumBtax       = "",
            C_PrSNom        = "",
            C_PrBNom        = "",
            C_MinMrkt       = "",
            C_MrktS         = "",
            C_ContS_Dep     = "",
            C_SellType      = "",
            C_CrSD          = "",
            C_CoupPrevRub   = "",
            C_SecType       = "",
            C_TypeB         = "";

macro GetAvoirListAddWhere(RepSubKind)
   return " AND AV.t_TaxGroup in(15,25) ";
end;

PRIVATE MACRO SetAddWhereForAvr()

   VAR AvrFIIDCount : Integer = 0;
   VAR AvrFIIDAddWhere : String = "";
   VAR GNUAddWhere : String = "";
   VAR GNUCount : Integer = 0;

   m_AddWhereForAvr = GetAvoirListAddWhere();

   if( ( ValType( WebFormData.AvrFIIDList ) != V_UNDEF ) and ( WebFormData.AvrFIIDList.Size > 0 ) )
      while( AvrFIIDCount < WebFormData.AvrFIIDList.Size )
         if( AvrFIIDAddWhere == "" )
            AvrFIIDAddWhere = AvrFIIDAddWhere + " AND ( ";
         else
            m_H0_11 = m_H0_11 + ", ";
            AvrFIIDAddWhere = AvrFIIDAddWhere + " OR ";
         end;
         m_H0_11 = m_H0_11 + WebFormData.AvrFIIDList[AvrFIIDCount].Name;

         AvrFIIDAddWhere = AvrFIIDAddWhere + " FI.t_FIID = " + String( WebFormData.AvrFIIDList[AvrFIIDCount].FIID ) + " ";

         AvrFIIDCount = AvrFIIDCount + 1;
      end;
      if( AvrFIIDAddWhere != "" )
         AvrFIIDAddWhere = AvrFIIDAddWhere + " ) ";
      end;
      m_AddWhereForAvr = m_AddWhereForAvr + AvrFIIDAddWhere;
   else
      m_H0_11 = "‚á¥";
   end;

   if( ( ValType( WebFormData.GNUList ) != V_UNDEF ) and ( WebFormData.GNUList.Size > 0 ) )
      while( GNUCount < WebFormData.GNUList.Size )
         if( GNUAddWhere == "" )
            GNUAddWhere = GNUAddWhere + " AND ( ";
         else
            m_H0_9_Name = m_H0_9_Name + ", ";
            m_H0_9_Num = m_H0_9_Num + ", ";

            GNUAddWhere = GNUAddWhere + " OR ";
         end;

         m_H0_9_Name = m_H0_9_Name + String( WebFormData.GNUList[GNUCount].Name );
         m_H0_9_Num = m_H0_9_Num + String( WebFormData.GNUList[GNUCount].Element );

         GNUAddWhere = GNUAddWhere + " AV.t_TaxGroup = " + String( WebFormData.GNUList[GNUCount].Element ) + " ";

         GNUCount = GNUCount + 1;
      end;
      if( GNUAddWhere != "" )
         GNUAddWhere = GNUAddWhere + " ) ";
      end;
      m_AddWhereForAvr = m_AddWhereForAvr + GNUAddWhere;
   else
      m_H0_9_Name = "‚á¥";
      m_H0_9_Num  = "‚á¥";
   end;

END;

private macro Oper_rshb():string
  var fio = GetPersnFIOByID(GetOperRecByID({oper}).PartyID);
  if(fio == "")
     return GetOperRecByID({oper}).Name;
  else
     return ConvetFIO_Report(fio);
  end;  
end;

PRIVATE CLASS CIndNomBond_292( Report:OBJECT )
  VAR m_Report = Report;

  MACRO PaintStr()
     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.SetCellFont("N2_SumSrub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N2_SumAllRub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N2_NkdRepRub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N2_NkdRepRub_", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N2_NkdRepRub_IN", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N2_SumBrub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N2_SumBtax", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N2_RashAll", 8, true, false, null, null, DefaultBkGrColor );

     m_Report.SetCellFont("N2_ControlNomS",8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N2_ControlNomB", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N2_Taxe_All", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N2_Taxe_Amort", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N2_Taxe_NKD", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N2_Fin_Res", 8, true, false, null, null, BLUECOLOR );
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( SHEET_0292 );
   //m_Report.SetActiveSheet( m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ () );

     m_Report.PrintHeader_rshb( "N2_", SHEET_0292, m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ (), "" );

     m_Report.RegisterTable( "N2_MainTable", "",
                             "N2_Dummy1",
                             "N2_SecCode",      "N2_SecName",      "N2_CodeS",            "N2_DZS",              "N2_DDS",              "N2_Qnty",
                             "N2_SumSrub",      "N2_NkdSvp",       "N2_SumAllRub",        "N2_NKDminusRub",      "N2_DifS",             "N2_NkdRepRub",
                             "N2_NkdRepRub_",   "N2_NkdRepRub_IN", "N2_CodeB",            "N2_DZB",              "N2_DDB",              "N2_SumBrub",
                             "N2_NkdBvp",       "N2_DifB",         "N2_SumBtax",          "N2_ComS",             "N2_ComB",             "N2_RashAll",
                             "N2_Nom_DDS",      "N2_Nom_DDB",      "N2_RFISSS",           "N2_RFISSB",           "N2_ContS",            "N2_ContB",
                             "N2_ContS_Dep",    "N2_ContB_Dep",    "N2_SellType",         "N2_DRS",              "N2_CrSD",             "N2_SumSvp",
                             "N2_PrSNom",       "N2_MinMrkt",      "N2_Val_MarketS",      "N2_MrktS",            "N2_DMrktS",           "N2_QuoteValueS",
                             "N2_RCS",          "N2_RC_CommentS",  "N2_K_ControlS",       "N2_Control_CommentS", "N2_DRB",              "N2_CrBD",
                             "N2_SumBvp",       "N2_PrBnom",       "N2_MaxMrkt",          "N2_Val_MarketB",      "N2_MrktB",            "N2_DMrktB",
                             "N2_QuoteValueB",  "N2_RCB",          "N2_RC_CommentB",      "N2_K_ControlB",       "N2_Control_CommentB", "N2_NkdBprevRub",
                             "N2_NkdBrepRub",   "N2_NkdBsellRub",  "N2_ifCoupPrev",       "N2_NkdPrevRub_",      "N2_NkdPrevRub_IN",    "N2_CoupRub",
                             "N2_LastCoupDate", "N2_ControlNomS",
                             "N2_ControlNomB",  "N2_Nom_Sec",      "N2_DqualS",           "N2_DqualB",           "N2_SecType",          "N2_Taxe_All",
                             "N2_Taxe_Amort",   "N2_Taxe_NKD",     "N2_Fin_Res",          "N2_ISIN"
                           );

     m_Report.SetCellAutoSumma( ItogsLineName,
                                "N2_Qnty","N2_SumSrub","N2_NkdSvp","N2_SumAllRub","N2_NKDminusRub","N2_DifS","N2_NkdRepRub","N2_NkdRepRub_","N2_NkdRepRub_IN",
                                "N2_SumBrub","N2_NkdBvp","N2_DifB","N2_SumBtax","N2_ComS","N2_ComB","N2_RashAll","N2_SumSvp","N2_SumBvp","N2_NkdBprevRub",
                                "N2_NkdBrepRub","N2_NkdBsellRub","N2_NkdPrevRub_","N2_NkdPrevRub_IN","N2_CoupRub","N2_ControlNomS","N2_ControlNomB",
                                "N2_Taxe_All","N2_Taxe_Amort","N2_Taxe_NKD","N2_Fin_Res"
                              );
  END;

  MACRO EndReport()
    m_Report.SetCopyAutoSumRange("A7:CA7");
    m_Report.EndTable();
    m_Report.SetCopyAutoSumRange(null);
    m_Report.SetOnAutoFilter(SHEET_0292, "B13:CA13");
    m_Report.SetAutoSize();
  END;

   macro PrintNoData()
     m_Report.PrintTableLine( "N2_SecCode",  NoDataTxt, null );
   end;

  MACRO EndReport_NoData()
    this.PrintNoData();
    m_Report.SetCopyAutoSumRange("A7:CA7");
    m_Report.EndTable();
    m_Report.SetCopyAutoSumRange(null);
  END;

  MACRO ¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨()
     m_Report.SetSubTotalEx(ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€,ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ,
                            "F23","G23","H23","I23","J23","K23","L23","M23","N23","R23",
                            "S23","T23","U23","V23","W23","X23","AJ23","AW23","BH23",
                            "BI23","BJ23","BL23","BM23","BN23","BP23","BQ23",
                            "BV23","BW23","BX23","BY23"
                    );
  END;

  MACRO Print()

     m_Report.SetCurrentStrNumber();

     m_Report.PrintTableLine(
               /* 1  */     "N2_SecCode",           m_Report.SecCode(),         null,
               /* 2  */     "N2_SecName",           m_Report.SecName(),         null,
               /* 3  */     "N2_CodeS",             m_Report.CodeS(),           null,
               /* 4  */     "N2_DZS",               m_Report.DZS(),             null,
               /* 5  */     "N2_DDS",               m_Report.DDS(),             null,
               /* 6  */     "N2_Qnty",              m_Report.printQnty(),       null,
               /* 7  */     "N2_SumSrub",           m_Report.SumSrub(),         null,/*ä-« */
               /* 8  */     "N2_NkdSvp",            m_Report.NkdSvp(),          null,
               /* 9  */     "N2_SumAllRub",         m_Report.SumAllRub(),       null,/*ä-« */
               /* 10 */     "N2_NKDminusRub",       m_Report.NKDminusRub(),     null,
               /* 11 */     "N2_DifS",              m_Report.DifS(),            null,/*¢ § ¢¨á¨¬®áâ¨ ®â ãá«®¢¨© ¨«¨ ã¦¥ ¯®áç¨â ­­®¥ §­ ç¥­¨¥ ¨«¨ !ä®à¬ã« */
               /* 12 */     "N2_NkdRepRub",         m_Report.NkdRepRub(),       null,/*ä-« */
               /* 13 */     "N2_NkdRepRub_",        m_Report.NkdRepRub_(),      null,/*ä-« */
               /* 14 */     "N2_NkdRepRub_IN",      m_Report.NkdRepRub_IN(),    null,/*ä-« */
               /* 15 */     "N2_CodeB",             m_Report.CodeB(),           null,
               /* 16 */     "N2_DZB",               m_Report.DZB(),             null,
               /* 17 */     "N2_DDB",               m_Report.DDB(),             null,
               /* 18 */     "N2_SumBrub",           m_Report.SumBrub(),         null,/*ä-« */
               /* 19 */     "N2_NkdBvp",            m_Report.NkdBvp(),          null,
               /* 20 */     "N2_DifB",              m_Report.DifB(),            null,/*¢ § ¢¨á¨¬®áâ¨ ®â ãá«®¢¨© ¨«¨ ã¦¥ ¯®áç¨â ­­®¥ §­ ç¥­¨¥ ¨«¨ !ä®à¬ã« */
               /* 21 */     "N2_SumBtax",           m_Report.SumBtax(),         null,/*ä-« */
               /* 22 */     "N2_ComS",              m_Report.ComS(),            null,
               /* 23 */     "N2_ComB",              m_Report.ComB(),            null,
               /* 24 */     "N2_RashAll",           m_Report.RashAll(),         null,/*ä-« */
               /* 25 */     "N2_Nom_DDS",           m_Report.printNomS(),       null,
               /* 26 */     "N2_Nom_DDB",           m_Report.printNomBDU(),     null,
               /* 27 */     "N2_RFISSS",            m_Report.RFISSS(),          null,
               /* 28 */     "N2_RFISSB",            m_Report.RFISSB(),          null,
               /* 29 */     "N2_ContS",             m_Report.ContS(),           null,
               /* 30 */     "N2_ContB",             m_Report.ContB(),           null,
               /* C1 */     "N2_ContS_Dep",         m_Report.DepS(),            null,
               /* C2 */     "N2_ContB_Dep",         m_Report.DepB(),            null,
               /* S0 */     "N2_SellType",          m_Report.SellType(),        null,
               /* S1 */     "N2_DRS",               m_Report.DRS(),             null,
               /* S2 */     "N2_CrSD",              m_Report.printCrSD_F(),     null,/*ä-« */
               /* S3 */     "N2_SumSvp",            m_Report.SumSvp(),          null,
               /* S4 */     "N2_PrSNom",            m_Report.printPrSNom(),     null,
               /* S5 */     "N2_MinMrkt",           m_Report.printMinMrkt(),    null,
               /* S6 */     "N2_Val_MarketS",       m_Report.Val_MarketS(),     null,
               /* S7 */     "N2_MrktS",             m_Report.MrktS(),           null,
               /* S8 */     "N2_DMrktS",            m_Report.DMrktS(),          null,
               /* S9 */     "N2_QuoteValueS",       m_Report.printQuoteValueS(),null,
               /* S10*/     "N2_RCS",               m_Report.RCS(),             null,
               /* S11*/     "N2_RC_CommentS",       m_Report.RC_CommentS(),     null,
               /* S12*/     "N2_K_ControlS",        m_Report.K_ControlS(),      null,
               /* S13*/     "N2_Control_CommentS",  m_Report.Control_CommentS(),null,
               /* B1 */     "N2_DRB",               m_Report.DRB(),             null,
               /* B2 */     "N2_CrBD",              m_Report.printCrBD_F(),     null,
               /* B3 */     "N2_SumBvp",            m_Report.SumBvp(),          null,
               /* B4 */     "N2_PrBnom",            m_Report.printPrBnom(),     null,
               /* B5 */     "N2_MaxMrkt",           m_Report.printMaxMrkt(),    null,
               /* B6 */     "N2_Val_MarketB",       m_Report.Val_MarketB(),     null,
               /* B7 */     "N2_MrktB",             m_Report.MrktB(),           null,
               /* B8 */     "N2_DMrktB",            m_Report.DMrktB(),          null,
               /* B9 */     "N2_QuoteValueB",       m_Report.printQuoteValueB(),null,
               /* B10*/     "N2_RCB",               m_Report.RCB(),             null,
               /* B11*/     "N2_RC_CommentB",       m_Report.RC_CommentB(),     null,
               /* B12*/     "N2_K_ControlB",        m_Report.K_ControlB(),      null,
               /* B13*/     "N2_Control_CommentB",  m_Report.Control_CommentB(),null,
               /* Š1 */     "N2_NkdBprevRub",       m_Report.NkdBprevRub(),     null,
               /* Š2 */     "N2_NkdBrepRub",        m_Report.NkdBrepRub(),      null,
               /* Š3 */     "N2_NkdBsellRub",       m_Report.NkdBsellRub(),     null,
               /* Š4 */     "N2_ifCoupPrev",        m_Report.ifCoupPrev(),      null,
               /* Š5 */     "N2_NkdPrevRub_",       m_Report.NkdPrevRub_(),     null,
               /* Š6 */     "N2_NkdPrevRub_IN",     m_Report.NkdPrevRub_IN(),   null,
               /* Š7 */     "N2_CoupRub",           m_Report.CoupRub(),         null,
               /* Š8 */     "N2_LastCoupDate",      m_Report.LastCoupDate(),    null,
               /* N1 */     "N2_ControlNomS",       m_Report.ControlNomS(),     null,/*ä-« */
               /* N2 */     "N2_ControlNomB",       m_Report.ControlNomB(),     null,/*ä-« */
               /* N3 */     "N2_Nom_Sec",           m_Report.printNom_Sec(),    null,
               /* T1 */     "N2_DqualS",            m_Report.DqualS(),          null,
               /* T2 */     "N2_DqualB",            m_Report.DqualB(),          null,
               /* T3 */     "N2_SecType",           m_Report.SecType(),         null,
               /* T4 */     "N2_Taxe_All",          m_Report.Taxe_All(),        null,/*ä-« */
               /* T5 */     "N2_Taxe_Amort",        m_Report.Taxe_Amort(),      null,/*ä-« */
               /* T6 */     "N2_Taxe_NKD",          m_Report.Taxe_NKD(),        null,/*ä-« */
               /* V1 */     "N2_Fin_Res",           m_Report.Fin_Res(),         null,/*ä-«  */
               /* R1 */     "N2_ISIN",              m_Report.ISIN(),            null
                            );
  END;

END;

/*á¢®¤­ ï ¢ª« ¤ª  292*/
PRIVATE CLASS CIndNomBond_292_Cons( Report:OBJECT )
  VAR m_Report = Report;

  MACRO BeginReport()

     m_Report.SetActiveSheet( SHEET_0292s );
   //m_Report.SetActiveSheet( m_Report.ˆ¬ï‘¢®¤­®£®‹¨áâ () );
   
     m_Report.PrintHeader_cons( "N21_", SHEET_0292s, m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ (), "" );

     m_Report.RegisterTable( "N21_MainTable", "",
                  /* a  */   "N21_RegNum",
                  /* b  */   "N21_SecType",
                  /* c  */   "N21_SecCode",
                  /* 1  */   "N21_SecName",
                  /* 2  */   "N21_Fin_Res",
                  /* 3  */   "N21_DifB",
                  /* 4  */   "N21_DifS",
                  /* 5  */   "N21_ComS_ComB",
                  /* 6  */   "N21_Taxe_All",
                  /* 7  */   "N21_Taxe_Amort",
                  /* 8  */   "N21_Taxe_NKD",
                  /* 9  */   "N21_Qnty",
                  /* 10 */   "N21_SumAllRub",
                  /* 11 */   "N21_RashAll",
                  /* 12 */   "N21_SumSvp",
                  /* 13 */   "N21_SumBvp",
                  /* 14 */   "N21_NkdSvp",
                  /* 15 */   "N21_NkdBvp",
                  /* 16 */   "N21_Unknown_16",
                  /* 17 */   "N21_CoupRub",
                  /* 18 */   "N21_NkdPrevRub_",
                  /* 19 */   "N21_NkdPrevRub_IN",
                  /* 20 */   "N21_NKDminusRub",
                  /* 21 */   "N21_NkdRepRub_15",
                  /* 22 */   "N21_NkdRepRub_25",
                  /* d  */   "N21_ISIN"
                           );


     m_Report.SetCellAutoSumma( ItogsLineName,
                     /* 2  */   "N21_Fin_Res",
                     /* 3  */   "N21_DifB",
                     /* 4  */   "N21_DifS",
                     /* 5  */   "N21_ComS_ComB",
                     /* 6  */   "N21_Taxe_All",
                     /* 7  */   "N21_Taxe_Amort",
                     /* 8  */   "N21_Taxe_NKD",
                     /* 9  */   "N21_Qnty",
                     /* 10 */   "N21_SumAllRub",
                     /* 11 */   "N21_RashAll",
                     /* 12 */   "N21_SumSvp",
                     /* 13 */   "N21_SumBvp",
                     /* 14 */   "N21_NkdSvp",
                     /* 15 */   "N21_NkdBvp",
                     /* 16 */   "N21_Unknown_16",
                     /* 17 */   "N21_CoupRub",
                     /* 18 */   "N21_NkdPrevRub_",
                     /* 19 */   "N21_NkdPrevRub_IN",
                     /* 20 */   "N21_NKDminusRub",
                     /* 21 */   "N21_NkdRepRub_15",
                     /* 22 */   "N21_NkdRepRub_25"
                              );

     m_Report.SetCurrentLineFont( 8, true, false, FONTSTYLE_UNDERLINENO, DefaultFontColor, DefaultBkGrColor );
     m_Report.PrintTableLine( "N21_RegNum",   "292",         null,
                              "N21_SecType",  m_Report.H0_9_Num(), null,
                              "N21_SecCode",  m_Report.GetCCons(), null,
                              "N21_SecName",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, true, false, FONTSTYLE_UNDERLINENO, DefaultFontColor, DefaultBkGrColor );
     m_Report.PrintTableLine( "N21_SecName",  "¢ â®¬ ç¨á«¥:", null );
  END;

  MACRO EndReport()
     m_Report.EndTable();
     this.¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨();
     /*¯®¤®è¢ë ¤«ï á¢®¤­®© ­¥â*/
  END;

  MACRO ¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨()
     m_Report.SetSubTotalEx(ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€,ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ,
                        "E22",
                        "F22",
                        "G22",
                        "H22",
                        "I22",
                        "J22",
                        "K22",
                        "L22",
                        "M22",
                        "N22",
                        "O22",
                        "P22",
                        "Q22",
                        "R22",
                        "S22",
                        "T22",
                        "U22",
                        "V22",
                        "W22",
                        "X22",
                        "Y22"
                    );
  END;

  MACRO Print(TaxGroup,FI_Code:string,Name:string,ISIN:string)

     m_Report.SetCurrentStrNumber();

     m_Report.PrintTableLine(
                             "N21_RegNum",          "292",                                                   null,
                             "N21_SecType",         TaxGroup,                                                null,
                             "N21_SecCode",         FI_Code,                                                 null,
                             "N21_SecName",         Name,                                                    null,
                             "N21_Fin_Res",         m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Fin_Res),      null,
                             "N21_DifB",            m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_DifB),         null,
                             "N21_DifS",            m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_DifS),         null,
                             "N21_ComS_ComB",       m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_ComS)+"+"+m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_ComB)),null,
                             "N21_Taxe_All",        m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_All),     null,
                             "N21_Taxe_Amort",      m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_Amort),   null,
                             "N21_Taxe_NKD",        m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_NKD),     null,
                             "N21_Qnty",            m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Qnty),         null,
                             "N21_SumAllRub",       m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_SumAllRub),    null,
                             "N21_RashAll",         m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_RashAll),      null,
                             "N21_SumSvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_SumSvp),       null,
                             "N21_SumBvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_SumBvp),       null,
                             "N21_NkdSvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdSvp),       null,
                             "N21_NkdBvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdBvp),       null,
                             "N21_Unknown_16",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                             "N21_CoupRub",         m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_CoupRub)+"+"+
                                                    m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdSvp,C_SellType,"=1")),null,
                             "N21_NkdPrevRub_",     m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdPrevRub_),  null,
                             "N21_NkdPrevRub_IN",   m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdPrevRub_IN),null,
                             "N21_NKDminusRub",     m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NKDminusRub),  null,
                             "N21_NkdRepRub_15",    m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdRepRub,C_SecType,"=15")), null,
                             "N21_NkdRepRub_25",    m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdRepRub,C_SecType,"=25")), null,
                             "N21_ISIN",            ISIN,                                                    null
                            );
  end;

END;

PRIVATE CLASS CIndNomBond_692( Report:OBJECT )
  VAR m_Report = Report;

  MACRO PaintStr()
     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.SetCellFont("N6_SumSrub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_SumAllRub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_SumBrub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_SumBtax", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_RashAll", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_NkdRepRub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_NkdRepRub_", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_NkdRepRub_IN", 8, true, false, null, null, DefaultBkGrColor );

     m_Report.SetCellFont("N6_NkdAllRub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_NkdAllRub_", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_NkdAllRub_IN", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N6_NkdPrevRub", 8, true, false, null, null, DefaultBkGrColor );

     m_Report.SetCellFont("N6_ControlNomS",8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N6_ControlNomB", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N6_Taxe_All", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N6_Taxe_Amort", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N6_Taxe_NKD", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N6_Fin_Res", 8, true, false, null, null, BLUECOLOR );
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet(SHEET_0692);
   //m_Report.SetActiveSheet( m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ () );

     m_Report.PrintHeader_rshb( "N6_", SHEET_0692, m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ (), "" );

     m_Report.RegisterTable( "N6_MainTable", "",
                             "N6_Dummy1",
                             "N6_SecCode",
                             "N6_SecName",
                             "N6_CodeS",
                             "N6_DZS",
                             "N6_DDS",
                             "N6_Qnty",
                             "N6_SumSrub",
                             "N6_NkdSvp",
                             "N6_SumAllRub",
                             "N6_DifS",
                             "N6_CodeB",
                             "N6_DZB",
                             "N6_DDB",
                             "N6_SumBrub",
                             "N6_NkdBvp",
                             "N6_DifB",
                             "N6_SumBtax",
                             "N6_ComS",
                             "N6_ComB",
                             "N6_RashAll",
                             "N6_NkdRepRub",
                             "N6_NkdRepRub_",
                             "N6_NkdRepRub_IN",
                             "N6_NkdAllRub",
                             "N6_NkdAllRub_",
                             "N6_NkdAllRub_IN",
                             "N6_NkdPrevRub",
                             "N6_NkdPrevRub_",
                             "N6_NkdPrevRub_IN",
                             "N6_NkdPrevEndRub",
                             "N6_CoupRub",
                             "N6_CoupPrevRub",
                             "N6_Nom_DDS",
                             "N6_Nom_DDB",
                             "N6_RFISSS",
                             "N6_RFISSB",
                             "N6_ContS",
                             "N6_ContB",
                             "N6_ContS_Dep",
                             "N6_ContB_Dep",
                             "N6_DRS",
                             "N6_CrSD",
                             "N6_SumSvp",
                             "N6_PrSNom",
                             "N6_MinMrkt",
                             "N6_Val_MarketS",
                             "N6_MrktS",
                             "N6_DMrktS",
                             "N6_QuoteValueS",
                             "N6_RCS",
                             "N6_RC_CommentS",
                             "N6_K_ControlS",
                             "N6_Control_CommentS",
                             "N6_DRB",
                             "N6_CrBD",
                             "N6_SumBvp",
                             "N6_PrBnom",
                             "N6_MaxMrkt",
                             "N6_Val_MarketB",
                             "N6_MrktB",
                             "N6_DMrktB",
                             "N6_QuoteValueB",
                             "N6_RCB",
                             "N6_RC_CommentB",
                             "N6_K_ControlB",
                             "N6_Control_CommentB",
                             "N6_LastCoupDate",
                             "N6_ControlNomS",
                             "N6_ControlNomB",
                             "N6_Nom_Sec",
                             "N6_DqualS",
                             "N6_DqualB",
                             "N6_SecType",
                             "N6_Taxe_All",
                             "N6_Taxe_Amort",
                             "N6_Taxe_NKD",
                             "N6_Fin_Res",
                             "N6_ISIN"
                           );

     m_Report.SetCellAutoSumma( ItogsLineName,
                                "N6_Qnty",          "N6_SumSrub",       "N6_NkdSvp",        "N6_SumAllRub",     "N6_DifS",
                                "N6_SumBrub",       "N6_NkdBvp",        "N6_DifB",          "N6_SumBtax",       "N6_ComS",  "N6_ComB",  "N6_RashAll",
                                "N6_NkdRepRub",     "N6_NkdRepRub_",    "N6_NkdRepRub_IN",  "N6_NkdAllRub",
                                "N6_NkdAllRub_",    "N6_NkdAllRub_IN",  "N6_NkdPrevRub",    "N6_NkdPrevRub_",   "N6_NkdPrevRub_IN",
                                "N6_NkdPrevEndRub", "N6_CoupRub",       "N6_CoupPrevRub",   "N6_SumSvp",        "N6_SumBvp", "N6_ControlNomS",
                                "N6_ControlNomB",   "N6_Taxe_All",      "N6_Taxe_Amort",    "N6_Taxe_NKD",      "N6_Fin_Res"
                              );
  END;

  MACRO EndReport()
    m_Report.SetCopyAutoSumRange("A7:CA7");
    m_Report.EndTable();
    m_Report.SetCopyAutoSumRange(null);
    m_Report.SetOnAutoFilter(SHEET_0692, "B13:CA13");
    m_Report.SetAutoSize();
  END;

  macro PrintNoData()
    m_Report.PrintTableLine( "N6_SecCode",  NoDataTxt, null );
  end;

  MACRO EndReport_NoData()
    this.PrintNoData();
    m_Report.SetCopyAutoSumRange("A7:CA7");
    m_Report.EndTable();
    m_Report.SetCopyAutoSumRange(null);
  END;



  MACRO ¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨()
     m_Report.SetSubTotalEx(ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€,ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ,
                            "F23","G23","H23","I23","J23","N23","O23","P23","Q23","R23","S23","T23","U23","V23","W23","X23","Y23","Z23",
                            "AA23","AB23","AC23","AD23","AE23","AF23","AQ23","BD23","BP23","BQ23","BV23","BW23","BX23","BY23"
                           );
  END;

  MACRO Print()

     m_Report.SetCurrentStrNumber();

     m_Report.PrintTableLine(
               /* 1  */     "N6_SecCode",           m_Report.SecCode(),         null,
               /* 2  */     "N6_SecName",           m_Report.SecName(),         null,
               /* 3  */     "N6_CodeS",             m_Report.CodeS(),           null,
               /* 4  */     "N6_DZS",               m_Report.DZS(),             null,
               /* 5  */     "N6_DDS",               m_Report.DDS(),             null,
               /* 6  */     "N6_Qnty",              m_Report.printQnty(),       null,
               /* 7  */     "N6_SumSrub",           m_Report.SumSrub(),         null,/*ä-« */
               /* 8  */     "N6_NkdSvp",            m_Report.NkdSvp(),          null,
               /* 9  */     "N6_SumAllRub",         m_Report.SumAllRub(),       null,/*ä-« */
               /* 10 */     "N6_DifS",              m_Report.DifS(),            null,/*¢ § ¢¨á¨¬®áâ¨ ®â ãá«®¢¨© ¨«¨ ã¦¥ ¯®áç¨â ­­®¥ §­ ç¥­¨¥ ¨«¨ !ä®à¬ã« */
               /* 11 */     "N6_CodeB",             m_Report.CodeB(),           null,
               /* 12 */     "N6_DZB",               m_Report.DZB(),             null,
               /* 13 */     "N6_DDB",               m_Report.DDB(),             null,
               /* 14 */     "N6_SumBrub",           m_Report.SumBrub(),         null,/*ä-« */
               /* 15 */     "N6_NkdBvp",            m_Report.NkdBvp(),          null,
               /* 16 */     "N6_DifB",              m_Report.DifB(),            null,/*¢ § ¢¨á¨¬®áâ¨ ®â ãá«®¢¨© ¨«¨ ã¦¥ ¯®áç¨â ­­®¥ §­ ç¥­¨¥ ¨«¨ !ä®à¬ã« */
               /* 17 */     "N6_SumBtax",           m_Report.SumBtax(),         null,/*ä-« */
               /* 18 */     "N6_ComS",              m_Report.ComS(),            null,
               /* 19 */     "N6_ComB",              m_Report.ComB(),            null,
               /* 20 */     "N6_RashAll",           m_Report.RashAll(),         null,/*ä-« */
               /* 21 */     "N6_NkdRepRub",         m_Report.NkdRepRub(),       null,/*ä-« */
               /* 22 */     "N6_NkdRepRub_",        m_Report.NkdRepRub_(),      null,/*ä-« */
               /* 23 */     "N6_NkdRepRub_IN",      m_Report.NkdRepRub_IN(),    null,/*ä-« */
               /* 24 */     "N6_NkdAllRub",         m_Report.NkdAllRub(),       null,/*ä-« */
               /* 25 */     "N6_NkdAllRub_",        m_Report.NkdAllRub_(),      null,/*ä-« */
               /* 26 */     "N6_NkdAllRub_IN",      m_Report.NkdAllRub_IN(),    null,/*ä-« */
               /* 27 */     "N6_NkdPrevRub",        m_Report.NkdPrevRub(),      null,/*ä-« */
               /* 28 */     "N6_NkdPrevRub_",       m_Report.NkdPrevRub_(),     null,
               /* 29 */     "N6_NkdPrevRub_IN",     m_Report.NkdPrevRub_IN(),   null,
               /* 30 */     "N6_NkdPrevEndRub",     m_Report.NkdPrevEndRub(),   null,
               /* 31 */     "N6_CoupRub",           m_Report.CoupRub(),         null,
               /* 32 */     "N6_CoupPrevRub",       m_Report.CoupPrevRub(),     null,
               /* 33 */     "N6_Nom_DDS",           m_Report.printNomS(),       null,
               /* 34 */     "N6_Nom_DDB",           m_Report.printNomB(),       null,
               /* 35 */     "N6_RFISSS",            m_Report.RFISSS(),          null,
               /* 36 */     "N6_RFISSB",            m_Report.RFISSB(),          null,
               /* 37 */     "N6_ContS",             m_Report.ContS(),           null,
               /* 38 */     "N6_ContB",             m_Report.ContB(),           null,
               /* C1 */     "N6_ContS_Dep",         m_Report.DepS(),            null,
               /* C2 */     "N6_ContB_Dep",         m_Report.DepB(),            null,
               /* S1 */     "N6_DRS",               m_Report.DRS(),             null,
               /* S2 */     "N6_CrSD",              m_Report.printCrSD_F(),     null,/*ä-« */
               /* S3 */     "N6_SumSvp",            m_Report.SumSvp(),          null,
               /* S4 */     "N6_PrSNom",            m_Report.printPrSNom(),     null,
               /* S5 */     "N6_MinMrkt",           m_Report.printMinMrkt(),    null,
               /* S6 */     "N6_Val_MarketS",       m_Report.Val_MarketS(),     null,
               /* S7 */     "N6_MrktS",             m_Report.MrktS(),           null,
               /* S8 */     "N6_DMrktS",            m_Report.DMrktS(),          null,
               /* S9 */     "N6_QuoteValueS",       m_Report.printQuoteValueS(),null,
               /* S10*/     "N6_RCS",               m_Report.RCS(),             null,
               /* S11*/     "N6_RC_CommentS",       m_Report.RC_CommentS(),     null,
               /* S12*/     "N6_K_ControlS",        m_Report.K_ControlS(),      null,
               /* S13*/     "N6_Control_CommentS",  m_Report.Control_CommentS(),null,
               /* B1 */     "N6_DRB",               m_Report.DRB(),             null,
               /* B2 */     "N6_CrBD",              m_Report.printCrBD_F(),     null,
               /* B3 */     "N6_SumBvp",            m_Report.SumBvp(),          null,
               /* B4 */     "N6_PrBnom",            m_Report.printPrBnom(),     null,
               /* B5 */     "N6_MaxMrkt",           m_Report.printMaxMrkt(),    null,
               /* B6 */     "N6_Val_MarketB",       m_Report.Val_MarketB(),     null,
               /* B7 */     "N6_MrktB",             m_Report.MrktB(),           null,
               /* B8 */     "N6_DMrktB",            m_Report.DMrktB(),          null,
               /* B9 */     "N6_QuoteValueB",       m_Report.printQuoteValueB(),null,
               /* B10*/     "N6_RCB",               m_Report.RCB(),             null,
               /* B11*/     "N6_RC_CommentB",       m_Report.RC_CommentB(),     null,
               /* B12*/     "N6_K_ControlB",        m_Report.K_ControlB(),      null,
               /* B13*/     "N6_Control_CommentB",  m_Report.Control_CommentB(),null,
               /* Š1 */     "N6_LastCoupDate",      m_Report.LastCoupDate(),    null,
               /* N1 */     "N6_ControlNomS",       m_Report.ControlNomS(),     null,/*ä-« */
               /* N2 */     "N6_ControlNomB",       m_Report.ControlNomB(),     null,/*ä-« */
               /* N3 */     "N6_Nom_Sec",           m_Report.printNom_Sec(),    null,
               /* T1 */     "N6_DqualS",            m_Report.DqualS(),          null,
               /* T2 */     "N6_DqualB",            m_Report.DqualB(),          null,
               /* T3 */     "N6_SecType",           m_Report.SecType(),         null,
               /* T4 */     "N6_Taxe_All",          m_Report.Taxe_All(),        null,/*ä-« */
               /* T5 */     "N6_Taxe_Amort",        m_Report.Taxe_Amort(),      null,/*ä-« */
               /* T6 */     "N6_Taxe_NKD",          m_Report.Taxe_NKD(),        null,/*ä-« */
               /* V1 */     "N6_Fin_Res",           m_Report.Fin_Res(),         null,/*ä-«  */
               /* R1 */     "N6_ISIN",              m_Report.ISIN(),            null
                            );
  END;

END;

/*á¢®¤­ ï ¢ª« ¤ª  692*/
PRIVATE CLASS CIndNomBond_692_Cons( Report:OBJECT )
  VAR m_Report = Report;

  MACRO BeginReport()

     m_Report.SetActiveSheet(SHEET_0692s);
   //m_Report.SetActiveSheet( m_Report.ˆ¬ï‘¢®¤­®£®‹¨áâ () );

     m_Report.PrintHeader_cons( "N61_", SHEET_0692s, m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ (), "" );

     m_Report.RegisterTable( "N61_MainTable", "",
                   /* a  */  "N61_RegNum",
                   /* b  */  "N61_SecType",
                   /* c  */  "N61_SecCode",
                   /* 1  */  "N61_SecName",
                   /* 2  */  "N61_Fin_Res",
                   /* 3  */  "N61_DifB",
                   /* 4  */  "N61_DifS",
                   /* 5  */  "N61_ComS_ComB",
                   /* 6  */  "N61_Taxe_All",
                   /* 7  */  "N61_Taxe_Amort",
                   /* 8  */  "N61_Taxe_NKD",
                   /* 9  */  "N61_Qnty",
                   /* 10 */  "N61_SumAllRub",
                   /* 11 */  "N61_RashAll",
                   /* 12 */  "N61_SumSvp",
                   /* 13 */  "N61_SumBvp",
                   /* 14 */  "N61_NkdSvp",
                   /* 15 */  "N61_NkdBvp",
                   /* 16 */  "N61_Unknown_16",
                   /* 17 */  "N61_CoupRub",
                   /* 18 */  "N61_NkdPrevRub_",
                   /* 19 */  "N61_NkdPrevRub_IN",
                   /* 20 */  "N61_Unknown_20",
                   /* 21 */  "N61_Unknown_21",
                   /* 22 */  "N61_Unknown_22",
                   /* 23 */  "N61_NkdRepRub_15",
                   /* 24 */  "N61_NkdRepRub_25",
                   /* d  */  "N61_ISIN"
                           );


     m_Report.SetCellAutoSumma( ItogsLineName,
                   /* 2  */  "N61_Fin_Res",
                   /* 3  */  "N61_DifB",
                   /* 4  */  "N61_DifS",
                   /* 5  */  "N61_ComS_ComB",
                   /* 6  */  "N61_Taxe_All",
                   /* 7  */  "N61_Taxe_Amort",
                   /* 8  */  "N61_Taxe_NKD",
                   /* 9  */  "N61_Qnty",
                   /* 10 */  "N61_SumAllRub",
                   /* 11 */  "N61_RashAll",
                   /* 12 */  "N61_SumSvp",
                   /* 13 */  "N61_SumBvp",
                   /* 14 */  "N61_NkdSvp",
                   /* 15 */  "N61_NkdBvp",
                   /* 16 */  "N61_Unknown_16",
                   /* 17 */  "N61_CoupRub",
                   /* 18 */  "N61_NkdPrevRub_",
                   /* 19 */  "N61_NkdPrevRub_IN",
                   /* 20 */  "N61_Unknown_20",
                   /* 21 */  "N61_Unknown_21",
                   /* 22 */  "N61_Unknown_22",
                   /* 23 */  "N61_NkdRepRub_15",
                   /* 24 */  "N61_NkdRepRub_25"
                              );

     m_Report.SetCurrentLineFont( 8, true, false, FONTSTYLE_UNDERLINENO, DefaultFontColor, DefaultBkGrColor );
     m_Report.PrintTableLine( "N61_RegNum",   "692",         null,
                              "N61_SecType",  m_Report.H0_9_Num(), null,
                              "N61_SecCode",  m_Report.GetCCons(), null,
                              "N61_SecName",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, true, false, FONTSTYLE_UNDERLINENO, DefaultFontColor, DefaultBkGrColor );
     m_Report.PrintTableLine( "N61_SecName",  "¢ â®¬ ç¨á«¥:", null );
  END;

  MACRO EndReport()
     m_Report.EndTable();
     this.¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨();
     /*¯®¤®è¢ë ¤«ï á¢®¤­®© ­¥â*/
  END;

  MACRO ¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨()
     m_Report.SetSubTotalEx(ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€,ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ,
                        "E22",
                        "F22",
                        "G22",
                        "H22",
                        "I22",
                        "J22",
                        "K22",
                        "L22",
                        "M22",
                        "N22",
                        "O22",
                        "P22",
                        "Q22",
                        "R22",
                        "S22",
                        "T22",
                        "U22",
                        "V22",
                        "W22",
                        "X22",
                        "Y22",
                        "Z22",
                        "AA22"
                    );
  END;

  MACRO Print(TaxGroup,FI_Code:string,Name:string,ISIN:string)

     m_Report.SetCurrentStrNumber();

     m_Report.PrintTableLine(
                             "N61_RegNum",          "692",                                                   null,
                             "N61_SecType",         TaxGroup,                                                null,
                             "N61_SecCode",         FI_Code,                                                 null,
                             "N61_SecName",         Name,                                                    null,
                             "N61_Fin_Res",         m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Fin_Res),      null,
                             "N61_DifB",            m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_DifB),         null,
                             "N61_DifS",            m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_DifS),         null,
                             "N61_ComS_ComB",       m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_ComS)+"+"+m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_ComB)),null,
                             "N61_Taxe_All",        m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_All),     null,
                             "N61_Taxe_Amort",      m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_Amort),   null,
                             "N61_Taxe_NKD",        m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_NKD),     null,
                             "N61_Qnty",            m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Qnty),         null,
                             "N61_SumAllRub",       m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_SumAllRub),    null,
                             "N61_RashAll",         m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_RashAll),      null,
                             "N61_SumSvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_SumSvp),       null,
                             "N61_SumBvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_SumBvp),       null,
                             "N61_NkdSvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdSvp),       null,
                             "N61_NkdBvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdBvp),       null,
                             "N61_Unknown_16",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                             "N61_CoupRub",         m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_CoupRub),      null,
                             "N61_NkdPrevRub_",     m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdPrevRub_),  null,
                             "N61_NkdPrevRub_IN",   m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdPrevRub_IN),null,
                             "N61_Unknown_20",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                             "N61_Unknown_21",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                             "N61_Unknown_22",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                             "N61_NkdRepRub_15",    m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdRepRub,C_SecType,"=15")), null,
                             "N61_NkdRepRub_25",    m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdRepRub,C_SecType,"=25")), null,
                             "N61_ISIN",            ISIN,                                                    null
                            );
  end;

END;

PRIVATE CLASS CIndNomBond_491( Report:OBJECT )
  VAR m_Report = Report;

  MACRO PaintStr()
     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.SetCellFont("N4_NkdRepRub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N4_NkdRepRub_", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N4_NkdRepRub_IN", 8, true, false, null, null, DefaultBkGrColor );

     m_Report.SetCellFont("N4_SumBRub",8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N4_ControlNomB",8, true, false, null, null, BLUECOLOR );

     m_Report.SetCellFont("N4_Taxe_NKD", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N4_Fin_Res", 8, true, false, null, null, BLUECOLOR );
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet(SHEET_0491);
   //m_Report.SetActiveSheet( m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ () );

     m_Report.PrintHeader_rshb( "N4_", SHEET_0491, m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ (), "" );

     m_Report.RegisterTable( "N4_MainTable", "",
                             "N4_Dummy1",
                  /* 1  */   "N4_SecCode",
                  /* 2  */   "N4_SecName",
                  /* 3  */   "N4_CodeB",
                  /* 4  */   "N4_DZB",
                  /* 5  */   "N4_TypeB",
                  /* 6  */   "N4_DDB",
                  /* 7  */   "N4_Qnty",
                  /* 8  */   "N4_NkdRepRub",
                  /* 9  */   "N4_NkdRepRub_",
                  /* 10 */   "N4_NkdRepRub_IN",
                  /* 11 */   "N4_StatusSec",
                  /* 12 */   "N4_Nom_DDB",
                  /* 13 */   "N4_ContB",
                  /* Š1 */   "N4_NkdBvp",
                  /* Š2 */   "N4_NkdBprevRub",
                  /* Š3 */   "N4_NkdBrepRub",
                  /* Š4 */   "N4_ifCoupPrev",
                  /* Š5 */   "N4_NkdPrevRub_",
                  /* Š6 */   "N4_NkdPrevRub_IN",
                  /* Š7 */   "N4_CoupRub",
                  /* Š8 */   "N4_NkdRepEndRub",
                  /* Š9 */   "N4_CoupCount",
                  /* Š10*/   "N4_LastCoupDate",
                  /* ‚1 */   "N4_DRB",
                  /* ‚2 */   "N4_CrBD",
                  /* ‚3 */   "N4_SumBvp",
                  /* ‚4 */   "N4_SumBRub",
                  /* ‚5 */   "N4_PrBnom",
                  /* ‚6 */   "N4_K_ControlB",
                  /* ‚7 */   "N4_Control_CommentB",
                  /* ‚8 */   "N4_RFISSB",
                  /* N1 */   "N4_Nom_H08",
                  /* N2 */   "N4_ControlNomB",
                  /* T1 */   "N4_DqualB",
                  /* T2 */   "N4_CodeDR",
                  /* T3 */   "N4_DD1DR",
                  /* T4 */   "N4_Dlink",
                  /* T5 */   "N4_SecType",
                  /* T6 */   "N4_Taxe_NKD",
                  /* V1 */   "N4_Fin_Res",
                  /* R1 */   "N4_ISIN"
                           );

     m_Report.SetCellAutoSumma( ItogsLineName,
                                "N4_Qnty",  "N4_NkdRepRub",     "N4_NkdRepRub_",   "N4_NkdRepRub_IN",
                                "N4_NkdBvp",  "N4_NkdBprevRub",   "N4_NkdBrepRub",  "N4_NkdPrevRub_",
                                "N4_NkdPrevRub_IN", "N4_CoupRub",       "N4_NkdRepEndRub", "N4_SumBvp",
                                "N4_SumBRub", "N4_Taxe_NKD",    "N4_Fin_Res"
                              );
  END;

  MACRO EndReport()
    m_Report.SetCopyAutoSumRange("A7:AP7");
    m_Report.EndTable();
    m_Report.SetCopyAutoSumRange(null);
    m_Report.SetOnAutoFilter(SHEET_0491, "B13:AP13");
    m_Report.SetAutoSize();
  END;
  
   macro PrintNoData()
      m_Report.PrintTableLine( "N4_SecCode",  NoDataTxt, null );

   end;

  MACRO EndReport_NoData()
    this.PrintNoData();
    m_Report.SetCopyAutoSumRange("A7:AP7");
    m_Report.EndTable();
    m_Report.SetCopyAutoSumRange(null);
  END;

  MACRO ¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨()
     m_Report.SetSubTotalEx(ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€,ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ,
                            "G23","H23","I23","J23","N23","O23","P23","R23","S23","T23","U23","Z23","AA23","AM23","AN23"
                           );
  END;

  MACRO Print()

     m_Report.SetCurrentStrNumber();

     m_Report.PrintTableLine(
                   /* 1  */  "N4_SecCode",          m_Report.SecCode(),          null,
                   /* 2  */  "N4_SecName",          m_Report.SecName(),          null,
                   /* 3  */  "N4_CodeB",            m_Report.CodeB(),            null,
                   /* 4  */  "N4_DZB",              m_Report.DZB(),              null,
                   /* 5  */  "N4_TypeB",            m_Report.TypeB(),            null,
                   /* 6  */  "N4_DDB",              m_Report.DDB(),              null,
                   /* 7  */  "N4_Qnty",             m_Report.printQnty(),        null,
                   /* 8  */  "N4_NkdRepRub",        m_Report.NkdRepRub(),        null,/*ä-« */
                   /* 9  */  "N4_NkdRepRub_",       m_Report.NkdRepRub_(),       null,/*ä-« */
                   /* 10 */  "N4_NkdRepRub_IN",     m_Report.NkdRepRub_IN(),     null,/*ä-« */
                   /* 11 */  "N4_StatusSec",        m_Report.StatusSec(),        null,
                   /* 12 */  "N4_Nom_DDB",          m_Report.printNomB(),        null,
                   /* 13 */  "N4_ContB",            m_Report.ContB(),            null,
                   /* Š1 */  "N4_NkdBvp",           m_Report.NkdBvp(),           null,
                   /* Š2 */  "N4_NkdBprevRub",      m_Report.NkdBprevRub(),      null,
                   /* Š3 */  "N4_NkdBrepRub",       m_Report.NkdBrepRub(),       null,
                   /* Š4 */  "N4_ifCoupPrev",       m_Report.ifCoupPrev(),       null,
                   /* Š5 */  "N4_NkdPrevRub_",      m_Report.NkdPrevRub_(),      null,
                   /* Š6 */  "N4_NkdPrevRub_IN",    m_Report.NkdPrevRub_IN(),    null,
                   /* Š7 */  "N4_CoupRub",          m_Report.CoupRub(),          null,
                   /* Š8 */  "N4_NkdRepEndRub",     m_Report.NkdRepEndRub(),     null,
                   /* Š9 */  "N4_CoupCount",        m_Report.CoupCount(),        null,
                   /* Š10*/  "N4_LastCoupDate",     m_Report.LastCoupDate(),     null,
                   /* ‚1 */  "N4_DRB",              m_Report.DRB(),              null,
                   /* ‚2 */  "N4_CrBD",             m_Report.printCrBD_F(),      null,
                   /* ‚3 */  "N4_SumBvp",           m_Report.printSumBvp(),      null, //DEF-85252 m_Report.SumBvp()
                   /* ‚4 */  "N4_SumBRub",          m_Report.SumBrub(),          null,/*ä-« */
                   /* ‚5 */  "N4_PrBnom",           m_Report.printPrBnom(),      null,
                   /* ‚6 */  "N4_K_ControlB",       m_Report.K_ControlB(),       null,
                   /* ‚7 */  "N4_Control_CommentB", m_Report.Control_CommentB(), null,
                   /* ‚8 */  "N4_RFISSB",           m_Report.RFISSB(),           null,
                   /* N1 */  "N4_Nom_H08",          m_Report.printNom_H08(),     null,
                   /* N2 */  "N4_ControlNomB",      m_Report.ControlNomB(),      null,/*ä-« */
                   /* T1 */  "N4_DqualB",           m_Report.DqualB(),           null,
                   /* T2 */  "N4_CodeDR",           m_Report.CodeDR(),           null,
                   /* T3 */  "N4_DD1DR",            m_Report.DD1DR(),            null,
                   /* T4 */  "N4_Dlink",            m_Report.Dlink(),            null,
                   /* T5 */  "N4_SecType",          m_Report.SecType(),          null,
                   /* T6 */  "N4_Taxe_NKD",         m_Report.Taxe_NKD(),         null,/*ä-« */
                   /* V1 */  "N4_Fin_Res",          m_Report.Fin_Res(),          null,/*ä-« */
                   /* R1 */  "N4_ISIN",             m_Report.ISIN(),             null
                            );
  END;

END;

/*á¢®¤­ ï ¢ª« ¤ª  491*/
PRIVATE CLASS CIndNomBond_491_Cons( Report:OBJECT )
  VAR m_Report = Report;

  MACRO BeginReport()

     m_Report.SetActiveSheet( SHEET_0491s );
   //m_Report.SetActiveSheet( m_Report.ˆ¬ï‘¢®¤­®£®‹¨áâ () );

     m_Report.PrintHeader_cons( "N41_", SHEET_0491s, m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ (), "" );

     m_Report.RegisterTable( "N41_MainTable", "",
                   /* a  */  "N41_RegNom",
                   /* b  */  "N41_SecType",
                   /* c  */  "N41_SecCode",
                   /* 1  */  "N41_SecName",
                   /* 2  */  "N41_Fin_Res",
                   /* 3  */  "N41_Unknown_3",
                   /* 4  */  "N41_Unknown_4",
                   /* 5  */  "N41_Unknown_5",
                   /* 6  */  "N41_Taxe_All",
                   /* 7  */  "N41_Unknown_7",
                   /* 8  */  "N41_Taxe_NKD",
                   /* 9  */  "N41_Qnty",
                   /* 10 */  "N41_Unknown_10",
                   /* 11 */  "N41_Unknown_11",
                   /* 12 */  "N41_Unknown_12",
                   /* 13 */  "N41_Unknown_13",
                   /* 14 */  "N41_Unknown_14",
                   /* 15 */  "N41_NkdBvp",
                   /* 16 */  "N41_Unknown_16",
                   /* 17 */  "N41_CoupRub",
                   /* 18 */  "N41_NkdPrevRub_",
                   /* 19 */  "N41_NkdPrevRub_IN",
                   /* 20 */  "N41_Unknown_20",
                   /* 21 */  "N41_NKDrepRub_15",
                   /* 22 */  "N41_NKDrepRub_25",
                   /* d  */  "N41_ISIN"
                           );


     m_Report.SetCellAutoSumma( ItogsLineName,
                   /* 2  */  "N41_Fin_Res",
                   /* 3  */  "N41_Unknown_3",
                   /* 4  */  "N41_Unknown_4",
                   /* 5  */  "N41_Unknown_5",
                   /* 6  */  "N41_Taxe_All",
                   /* 7  */  "N41_Unknown_7",
                   /* 8  */  "N41_Taxe_NKD",
                   /* 9  */  "N41_Qnty",
                   /* 10 */  "N41_Unknown_10",
                   /* 11 */  "N41_Unknown_11",
                   /* 12 */  "N41_Unknown_12",
                   /* 13 */  "N41_Unknown_13",
                   /* 14 */  "N41_Unknown_14",
                   /* 15 */  "N41_NkdBvp",
                   /* 16 */  "N41_Unknown_16",
                   /* 17 */  "N41_CoupRub",
                   /* 18 */  "N41_NkdPrevRub_",
                   /* 19 */  "N41_NkdPrevRub_IN",
                   /* 20 */  "N41_Unknown_20",
                   /* 21 */  "N41_NKDrepRub_15",
                   /* 22 */  "N41_NKDrepRub_25"
                              );

     m_Report.SetCurrentLineFont( 8, true, false, FONTSTYLE_UNDERLINENO, DefaultFontColor, DefaultBkGrColor );
     m_Report.PrintTableLine( "N41_RegNum",   "491",         null,
                              "N41_SecType",  m_Report.H0_9_Num(), null,
                              "N41_SecCode",  m_Report.GetCCons(), null,
                              "N41_SecName",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, true, false, FONTSTYLE_UNDERLINENO, DefaultFontColor, DefaultBkGrColor );
     m_Report.PrintTableLine( "N41_SecName",  "¢ â®¬ ç¨á«¥:", null );
  END;

  MACRO EndReport()
     m_Report.EndTable();
     this.¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨();
     /*¯®¤®è¢ë ¤«ï á¢®¤­®© ­¥â*/
  END;

  MACRO ¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨()
     m_Report.SetSubTotalEx(ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€,ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ,
                        "E22",
                        "F22",
                        "G22",
                        "H22",
                        "I22",
                        "J22",
                        "K22",
                        "L22",
                        "M22",
                        "N22",
                        "O22",
                        "P22",
                        "Q22",
                        "R22",
                        "S22",
                        "T22",
                        "U22",
                        "V22",
                        "W22",
                        "X22",
                        "Y22"
                    );
  END;

  MACRO Print(TaxGroup,FI_Code:string,Name:string,ISIN:string)

     m_Report.SetCurrentStrNumber();

     m_Report.PrintTableLine(
                             "N41_RegNum",          "491",                                                   null,
                             "N41_SecType",         TaxGroup,                                                null,
                             "N41_SecCode",         FI_Code,                                                 null,
                             "N41_SecName",         Name,                                                    null,
                             "N41_Fin_Res",         m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Fin_Res,C_TypeB,"=\"B\"")),      null,
                             "N41_Unknown_3",       0,                                                       null,
                             "N41_Unknown_4",       0,                                                       null,
                             "N41_Unknown_5",       0,                                                       null,
                             "N41_Taxe_All",        m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_NKD,C_TypeB,"=\"B\"")),     null,
                             "N41_Unknown_7",       0,                                                       null,
                             "N41_Taxe_NKD",        m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_NKD,C_TypeB,"=\"B\"")),     null,
                             "N41_Qnty",            m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Qnty,C_TypeB,"=\"B\"")),         null,
                             "N41_Unknown_10",      0,                                                       null,
                             "N41_Unknown_11",      0,                                                       null,
                             "N41_Unknown_12",      0,                                                       null,
                             "N41_Unknown_13",      0,                                                       null,
                             "N41_Unknown_14",      0,                                                       null,
                             "N41_NkdBvp",          m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdBvp,C_TypeB,"=\"B\"")),       null,
                             "N41_Unknown_16",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                             "N41_CoupRub",         m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_CoupRub,C_TypeB,"=\"B\"")),      null,
                             "N41_NkdPrevRub_",     m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdPrevRub_,C_TypeB,"=\"B\"")),  null,
                             "N41_NkdPrevRub_IN",   m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdPrevRub_IN,C_TypeB,"=\"B\"")),null,
                             "N41_Unknown_20",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                             "N41_NkdRepRub_15",    m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdRepRub,C_TypeB,"=\"B\"",C_SecType,"=15")), null,
                             "N41_NkdRepRub_25",    m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdRepRub,C_TypeB,"=\"B\"",C_SecType,"=25")), null,
                             "N41_ISIN",            ISIN,                                                    null
                            );
  end;

END;

PRIVATE CLASS CIndNomBond_791( Report:OBJECT )
  VAR m_Report = Report;

  MACRO PaintStr()
     m_Report.SetCurrentLineFont( 8, true, false );
     m_Report.SetCellFont("N7_SumSrub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N7_NkdRepRub", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N7_NkdRepRub_", 8, true, false, null, null, DefaultBkGrColor );
     m_Report.SetCellFont("N7_NkdRepRub_IN", 8, true, false, null, null, DefaultBkGrColor );

     m_Report.SetCellFont("N7_NkdAllRub", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N7_NkdAllRub_", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N7_NkdAllRub_IN", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N7_NkdPrevRub", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N7_ControlNomS", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N7_Taxe_NKD", 8, true, false, null, null, BLUECOLOR );
     m_Report.SetCellFont("N7_Fin_Res", 8, true, false, null, null, BLUECOLOR );
  END;

  MACRO BeginReport()
     m_Report.SetActiveSheet( SHEET_0791 );
   //m_Report.SetActiveSheet( m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ () );

     m_Report.PrintHeader_rshb( "N7_", SHEET_0791, m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ (), "" );

     m_Report.RegisterTable( "N7_MainTable", "",
                             "N7_Dummy1",
                  /* 1  */   "N7_SecCode",
                  /* 2  */   "N7_SecName",
                  /* 3  */   "N7_CodeS",
                  /* 4  */   "N7_DZS",
                  /* 5  */   "N7_DDS",
                  /* 6  */   "N7_Qnty",
                  /* 7  */   "N7_SumSrub",
                  /* 8  */   "N7_NkdSvp",
                  /* 9  */   "N7_NkdRepRub",
                  /* 10 */   "N7_NkdRepRub_",
                  /* 11 */   "N7_NkdRepRub_IN",
                  /* 12 */   "N7_Nom_DDS",
                  /* 13 */   "N7_ContS",
                  /* Š1 */   "N7_NkdAllRub",
                  /* Š2 */   "N7_NkdAllRub_",
                  /* Š3 */   "N7_NkdAllRub_IN",
                  /* Š4 */   "N7_NkdPrevRub",
                  /* Š5 */   "N7_NkdPrevRub_",
                  /* Š6 */   "N7_NkdPrevRub_IN",
                  /* Š7 */   "N7_NkdRepEndRub",
                  /* Š8 */   "N7_NkdPrevEndRub",
                  /* Š9 */   "N7_CoupRub",
                  /* Š10*/   "N7_CoupPrevRub",
                  /* Š11*/   "N7_LastCoupDate",
                  /* S1 */   "N7_DRS",
                  /* S2 */   "N7_CrSD",
                  /* S3 */   "N7_SumSvp",
                  /* S4 */   "N7_PrSNom",
                  /* S5 */   "N7_K_ControlS",
                  /* S6 */   "N7_Control_CommentS",
                  /* S7 */   "N7_RFISSS",
                  /* N1 */   "N7_Nom_H08",
                  /* N2 */   "N7_Nom_H07_1",
                  /* N3 */   "N7_ControlNomS",
                  /* T1 */   "N7_DqualS",
                  /* T2 */   "N7_CodeOR",
                  /* T3 */   "N7_TypeOR",
                  /* T4 */   "N7_QntyDeal",
                  /* T5 */   "N7_DD1OR",
                  /* T6 */   "N7_DD2OR",
                  /* T7 */   "N7_SecType",
                  /* T8 */   "N7_Taxe_NKD",
                  /* V1 */   "N7_Fin_Res",
                  /* R1 */   "N7_ISIN"
                           );

     m_Report.SetCellAutoSumma( ItogsLineName,
                                "N7_Qnty",  "N7_SumSrub",       "N7_NkdSvp",        "N7_NkdRepRub",     "N7_NkdRepRub_",   "N7_NkdRepRub_IN",
                                "N7_NkdAllRub",     "N7_NkdAllRub_",   "N7_NkdAllRub_IN",  "N7_NkdPrevRub",    "N7_NkdPrevRub_",  "N7_NkdPrevRub_IN",
                                "N7_NkdRepEndRub",  "N7_NkdPrevEndRub", "N7_CoupRub",       "N7_CoupPrevRub",  "N7_SumSvp", "N7_ControlNomS",
                                "N7_Taxe_NKD", "N7_Fin_Res"
                              );
  END;

  MACRO EndReport()
      m_Report.SetCopyAutoSumRange("A7:AS7");
      m_Report.EndTable();
      m_Report.SetCopyAutoSumRange(null);
      m_Report.SetOnAutoFilter(SHEET_0791, "B13:AS13");
      m_Report.SetAutoSize();
  END;

   macro PrintNoData()
      m_Report.PrintTableLine( "N7_SecCode",  NoDataTxt, null );

   end;

  MACRO EndReport_NoData()
    this.PrintNoData();
    m_Report.SetCopyAutoSumRange("A7:AS7");
    m_Report.EndTable();
    m_Report.SetCopyAutoSumRange(null);
  END;

  MACRO ¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨()
     m_Report.SetSubTotalEx(ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€,ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ,
                            "F23","G23","H23","I23","J23","K23","N23","O23","P23","Q23","R23","S23","T23","U23","V23","W23","AA23","AP23","AQ23"
                           );
  END;

  PRIVATE MACRO GetDealFactPaymDate(DealID, Type, DealPart)
     var ValueDate = date(0,0,0);
     var DataSet;
     var PType;

     var sql = RSDCommand( " SELECT (NVL( (SELECT min(pm.t_FactDate) " +
                           "         FROM ddl_tick_dbt tk, DDLRQ_DBT pm " +
                           "         WHERE tk.t_DealID = ? " +
                           "           AND pm.t_DocKind    = tk.t_BOfficeKind " +
                           "           AND pm.t_DocID = tk.t_DealID " +
                           "           AND pm.t_FactDate > TO_DATE('01-01-0001','DD-MM-YYYY') " +
                           "           AND pm.t_Type = ? " +
                           "           AND pm.t_DealPart = ? " +
                           "       ), " +
                           "       (NVL( (SELECT min(pm.t_PlanDate) " +
                           "              FROM ddl_tick_dbt tk, DDLRQ_DBT pm " +
                           "              WHERE tk.t_DealID = ? " +
                           "                 AND pm.t_DocKind    = tk.t_BOfficeKind " +
                           "                 AND pm.t_DocID = tk.t_DealID " +
                           "                 AND pm.t_FactDate = TO_DATE('01-01-0001','DD-MM-YYYY') "+
                           "                 AND pm.t_Type = ? " +
                           "                 AND pm.t_DealPart = ? " +

                           "       ), TO_DATE('01-01-0001','DD-MM-YYYY') ) " +
                           "       )" +
                           "     )" +
                           " ) as FactDate FROM dual"
                         );

     sql.addParam( "", RSDBP_IN, DealID );
     sql.addParam( "", RSDBP_IN, Type );
     sql.addParam( "", RSDBP_IN, DealPart );
     sql.addParam( "", RSDBP_IN, DealID );
     sql.addParam( "", RSDBP_IN, Type );
     sql.addParam( "", RSDBP_IN, DealPart );

     sql.execute();

     DataSet = TRsbDataSet( sql );
     if(DataSet.moveNext())
       ValueDate = SQL_ConvTypeDate(DataSet.FactDate);
     end;

    return ValueDate;
  END;

  PRIVATE MACRO GetDealParms( DealID:INTEGER, DealAmount:@Money, Date1:@Date, Date2:@Date )
     VAR dl_leg = TRecHandler( "dl_leg.dbt" );

     DealAmount = "";
     Date1      = ZeroDate;
     Date2      = ZeroDate;

     if( (DealID != null) AND (DealID > 0) )

        if( FindDL_LEG(LEG_KIND_DL_TICK, DealID, 0, dl_leg) == 0 )
          DealAmount = dl_leg.rec.Principal;
        end;

        Date1 = SQL_ConvTypeDate(GetDealFactPaymDate(DealID, DLRQ_TYPE_DELIVERY, 1));
        Date2 = SQL_ConvTypeDate(GetDealFactPaymDate(DealID, DLRQ_TYPE_DELIVERY, 2));

        if( Date2 == Date(0,0,0) )
           if( FindDL_LEG( LEG_KIND_DL_TICK_BACK, DealID, 0, dl_leg ) == 0 )
           /*â® ¯« ­®¢ ï ¤ â  ¯®áâ ¢ª¨ ¯® 2 ç áâ¨ á¤¥«ª¨ */
              Date2 = GetDealPlanDate( dl_leg.rec, null, false, false );
           end;
        end;
     end;
  END;

  MACRO Print()

     var QntyDeal, DD1OR, DD2OR;
     GetDealParms(m_Report.m_RS.SDealID, @QntyDeal, @DD1OR, @DD2OR);

     m_Report.SetCurrentStrNumber();

     m_Report.PrintTableLine(
                  /* 1  */   "N7_SecCode",           m_Report.SecCode(),                   null,
                  /* 2  */   "N7_SecName",           m_Report.SecName(),                   null,
                  /* 3  */   "N7_CodeS",             m_Report.CodeS(),                     null,
                  /* 4  */   "N7_DZS",               m_Report.DZS(),                       null,
                  /* 5  */   "N7_DDS",               m_Report.DDS(),                       null,
                  /* 6  */   "N7_Qnty",              m_Report.printQnty(),                 null,
                  /* 7  */   "N7_SumSrub",           m_Report.SumSrub(),                   null,
                  /* 8  */   "N7_NkdSvp",            m_Report.NkdSvp(),                    null,
                  /* 9  */   "N7_NkdRepRub",         m_Report.NkdRepRub(),                 null,/*ä-« */
                  /* 10 */   "N7_NkdRepRub_",        m_Report.NkdRepRub_(),                null,/*ä-« */
                  /* 11 */   "N7_NkdRepRub_IN",      m_Report.NkdRepRub_IN(),              null,/*ä-« */
                  /* 12 */   "N7_Nom_DDS",           m_Report.printNomS(),                 null,
                  /* 13 */   "N7_ContS",             m_Report.ContS(),                     null,
                  /* Š1 */   "N7_NkdAllRub",         m_Report.NkdAllRub(),                 null,
                  /* Š2 */   "N7_NkdAllRub_",        m_Report.NkdAllRub_(),                null,
                  /* Š3 */   "N7_NkdAllRub_IN",      m_Report.NkdAllRub_IN(),              null,
                  /* Š4 */   "N7_NkdPrevRub",        m_Report.NkdPrevRub(),                null,
                  /* Š5 */   "N7_NkdPrevRub_",       m_Report.NkdPrevRub_(),               null,
                  /* Š6 */   "N7_NkdPrevRub_IN",     m_Report.NkdPrevRub_IN(),             null,
                  /* Š7 */   "N7_NkdRepEndRub",      m_Report.NkdRepEndRub(),              null,
                  /* Š8 */   "N7_NkdPrevEndRub",     m_Report.NkdPrevEndRub(),             null,
                  /* Š9 */   "N7_CoupRub",           m_Report.CoupRub(),                   null,
                  /* Š10*/   "N7_CoupPrevRub",       m_Report.CoupPrevRub(),               null,
                  /* Š11*/   "N7_LastCoupDate",      m_Report.LastCoupDate(),              null,
                  /* S1 */   "N7_DRS",               m_Report.DRS(),                       null,
                  /* S2 */   "N7_CrSD",              m_Report.printCrSD_F(),               null,
                  /* S3 */   "N7_SumSvp",            m_Report.SumSvp(),                    null,
                  /* S4 */   "N7_PrSNom",            m_Report.printPrSNom(),               null,
                  /* S5 */   "N7_K_ControlS",        m_Report.K_ControlS(),                null,
                  /* S6 */   "N7_Control_CommentS",  m_Report.Control_CommentS(),          null,
                  /* S7 */   "N7_RFISSS",            m_Report.RFISSS(),                    null,
                  /* N1 */   "N7_Nom_H08",           m_Report.printNom_H08(),              null,
                  /* N2 */   "N7_Nom_H07_1",         m_Report.printNom_H07_1(),            null,
                  /* N3 */   "N7_ControlNomS",       m_Report.ControlNomS(),               null,
                  /* T1 */   "N7_DqualS",            m_Report.DqualS(),                    null,
                  /* T2 */   "N7_CodeOR",            m_Report.CodeOR(),                    null,
                  /* T3 */   "N7_TypeOR",            m_Report.TypeOR(),                    null,
                  /* T4 */   "N7_QntyDeal",          m_Report.‚ë¢®¤—¥à¥§”®à¬ã«ã(QntyDeal), null,
                  /* T5 */   "N7_DD1OR",             DD1OR,                                null,
                  /* T6 */   "N7_DD2OR",             DD2OR,                                null,
                  /* T7 */   "N7_SecType",           m_Report.SecType(),                   null,
                  /* T8 */   "N7_Taxe_NKD",          m_Report.Taxe_NKD(),                  null,
                  /* V1 */   "N7_Fin_Res",           m_Report.Fin_Res(),                   null,
                  /* R1 */   "N7_ISIN",              m_Report.ISIN(),                      null
                            );
  END;

END;

/*á¢®¤­ ï ¢ª« ¤ª  791*/
PRIVATE CLASS CIndNomBond_791_Cons( Report:OBJECT )
  VAR m_Report = Report;

  MACRO BeginReport()

     m_Report.SetActiveSheet(SHEET_0791s);
   //m_Report.SetActiveSheet( m_Report.ˆ¬ï‘¢®¤­®£®‹¨áâ () );

     m_Report.PrintHeader_cons( "N71_", SHEET_0791s, m_Report.ˆ¬ïŽá­®¢­®£®‹¨áâ (), "" );

     m_Report.RegisterTable( "N71_MainTable", "",
                   /* a  */  "N71_RegNom",
                   /* b  */  "N71_SecType",
                   /* c  */  "N71_SecCode",
                   /* 1  */  "N71_SecName",
                   /* 2  */  "N71_Fin_Res",
                   /* 3  */  "N71_Unknown_3",
                   /* 4  */  "N71_Unknown_4",
                   /* 5  */  "N71_Unknown_5",
                   /* 6  */  "N71_Taxe_All",
                   /* 7  */  "N71_Unknown_7",
                   /* 8  */  "N71_Taxe_NKD",
                   /* 9  */  "N71_Qnty",
                   /* 10 */  "N71_Unknown_10",
                   /* 11 */  "N71_Unknown_11",
                   /* 12 */  "N71_SumSvp",
                   /* 13 */  "N71_Unknown_13",
                   /* 14 */  "N71_NkdSvp",
                   /* 15 */  "N71_Unknown_15",
                   /* 16 */  "N71_Unknown_16",
                   /* 17 */  "N71_CoupRub",
                   /* 18 */  "N71_NkdPrevRub_",
                   /* 19 */  "N71_NkdPrevRub_IN",
                   /* 20 */  "N71_Unknown_20",
                   /* 21 */  "N71_Unknown_21",
                   /* 22 */  "N71_Unknown_22",
                   /* 23 */  "N71_NkdRepRub_15",
                   /* 24 */  "N71_NkdRepRub_25",
                   /* 25 */  "N71_NkdAllRub_IN_NkdRepEndRub",
                   /* 26 */  "N71_SumSrub",
                   /* d  */  "N71_ISIN"
                           );


     m_Report.SetCellAutoSumma( ItogsLineName,
                   /* 2  */  "N71_Fin_Res",
                   /* 3  */  "N71_Unknown_3",
                   /* 4  */  "N71_Unknown_4",
                   /* 5  */  "N71_Unknown_5",
                   /* 6  */  "N71_Taxe_All",
                   /* 7  */  "N71_Unknown_7",
                   /* 8  */  "N71_Taxe_NKD",
                   /* 9  */  "N71_Qnty",
                   /* 10 */  "N71_Unknown_10",
                   /* 11 */  "N71_Unknown_11",
                   /* 12 */  "N71_SumSvp",
                   /* 13 */  "N71_Unknown_13",
                   /* 14 */  "N71_NkdSvp",
                   /* 15 */  "N71_Unknown_15",
                   /* 16 */  "N71_Unknown_16",
                   /* 17 */  "N71_CoupRub",
                   /* 18 */  "N71_NkdPrevRub_",
                   /* 19 */  "N71_NkdPrevRub_IN",
                   /* 20 */  "N71_Unknown_20",
                   /* 21 */  "N71_Unknown_21",
                   /* 22 */  "N71_Unknown_22",
                   /* 23 */  "N71_NkdRepRub_15",
                   /* 24 */  "N71_NkdRepRub_25",
                   /* 25 */  "N71_NkdAllRub_IN_NkdRepEndRub",
                   /* 26 */  "N71_SumSrub"
                              );

     m_Report.SetCurrentLineFont( 8, true, false, FONTSTYLE_UNDERLINENO, DefaultFontColor, DefaultBkGrColor );
     m_Report.PrintTableLine( "N71_RegNum",   "791",         null,
                              "N71_SecType",  m_Report.H0_9_Num(), null,
                              "N71_SecCode",  m_Report.GetCCons(), null,
                              "N71_SecName",  ItogsLineName, null );
     m_Report.SetCurrentLineFont( 8, true, false, FONTSTYLE_UNDERLINENO, DefaultFontColor, DefaultBkGrColor );
     m_Report.PrintTableLine( "N71_SecName",  "¢ â®¬ ç¨á«¥:", null );
  END;

  MACRO EndReport()
     m_Report.EndTable();
     this.¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨();
     /*¯®¤®è¢ë ¤«ï á¢®¤­®© ­¥â*/
  END;

  MACRO ¥ç â âìà®¬¥¦ãâ®ç­ë¥ˆâ®£¨()
     m_Report.SetSubTotalEx(ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€,ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ,
                        "E22",
                        "F22",
                        "G22",
                        "H22",
                        "I22",
                        "J22",
                        "K22",
                        "L22",
                        "M22",
                        "N22",
                        "O22",
                        "P22",
                        "Q22",
                        "R22",
                        "S22",
                        "T22",
                        "U22",
                        "V22",
                        "W22",
                        "X22",
                        "Y22",
                        "Z22",
                        "AA22",
                        "AB22",
                        "AC22"
                    );
  END;

  MACRO Print(TaxGroup,FI_Code:string,Name:string,ISIN:string)

     m_Report.SetCurrentStrNumber();

     m_Report.PrintTableLine(
                   /* a  */  "N71_RegNum",          "791",                                                   null,
                   /* b  */  "N71_SecType",         TaxGroup,                                                null,
                   /* c  */  "N71_SecCode",         FI_Code,                                                 null,
                   /* 1  */  "N71_SecName",         Name,                                                    null,
                   /* 2  */  "N71_Fin_Res",         m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Fin_Res),      null,
                   /* 3  */  "N71_Unknown_3",       0,                                                       null,
                   /* 4  */  "N71_Unknown_4",       0,                                                       null,
                   /* 5  */  "N71_Unknown_5",       0,                                                       null,
                   /* 6  */  "N71_Taxe_All",        m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_NKD),     null,
                   /* 7  */  "N71_Unknown_7",       0,                                                       null,
                   /* 8  */  "N71_Taxe_NKD",        m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Taxe_NKD),     null,
                   /* 9  */  "N71_Qnty",            m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_Qnty),         null,
                   /* 10 */  "N71_Unknown_10",      0,                                                       null,
                   /* 11 */  "N71_Unknown_11",      0,                                                       null,
                   /* 12 */  "N71_SumSvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_SumSvp),       null,
                   /* 13 */  "N71_Unknown_13",      0,                                                       null,
                   /* 14 */  "N71_NkdSvp",          m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdSvp),       null,
                   /* 15 */  "N71_Unknown_15",      0,                                                       null,
                   /* 16 */  "N71_Unknown_16",      0,                                                       null,
                   /* 17 */  "N71_CoupRub",         m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_CoupRub),      null,
                   /* 18 */  "N71_NkdPrevRub_",     m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdPrevRub_),  null,
                   /* 19 */  "N71_NkdPrevRub_IN",   m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdPrevRub_IN),null,
                   /* 20 */  "N71_Unknown_20",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                   /* 21 */  "N71_Unknown_21",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                   /* 22 */  "N71_Unknown_22",      0,                                                       null,/*­¥ § ¯®«­ï¥âáï ¯®ª */
                   /* 23 */  "N71_NkdRepRub_15",    m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdRepRub,C_SecType,"=15")), null,
                   /* 24 */  "N71_NkdRepRub_25",    m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdRepRub,C_SecType,"=25")), null,
                   /* 25 */  "N71_NkdAllRub_IN_NkdRepEndRub", m_Report.F(m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdAllRub_IN)+"+"+m_Report.’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_NkdRepEndRub)), null,
                   /* 26 */  "N71_SumSrub",         m_Report.”®à¬ã« ®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (C_SumSRub),      null,
                   /* d  */  "N71_ISIN",            ISIN,                                                    null
                            );
  end;

END;

PRIVATE CLASS (TX_RegistrReport) TX_IndNomBondReg_Report( Form:DL_CPanel, TemplateName:STRING, UseCSV:BOOL, IsWebService:BOOL, ReportHashCode:INTEGER, UsePOI:BOOL, FocreFormatRep:INTEGER )

  PRIVATE VAR m_INN, m_KPP;
  PRIVATE VAR m_CurrStrNum = 0;
  PRIVATE VAR m_SHEET_1 = "", m_SHEET_2 = "";/*®á­®¢­ ï ¨ á¢®¤­ ï ¢ª« ¤ª¨*/

  PRIVATE VAR m_IsExistsData = false;

  PRIVATE VAR m_NkdBvp,
              m_NkdSvp,
              m_NkdPrevRub_IN,
              m_CoupPrevRub,
              m_NkdPrevEndRub,
              m_TypeB;

  PRIVATE VAR m_FI_NRecs,
              m_FI_CurNRec;

  private var m_CopyAutoSumRange = null;

  MACRO ClearCacheOneRecord()
    this.ClearCacheOneRecord();
    m_NkdBvp        = null;
    m_NkdSvp        = null;
    m_NkdPrevRub_IN = null;
    m_CoupPrevRub   = null;
    m_NkdPrevEndRub = null;
    m_TypeB         = null;
  END;

  MACRO Fill_Cell_Name()
  END;
  
  PRIVATE MACRO SetAutoFilter()
    if( ExistsSheet( SHEET_0292s ) )
      m_ObjTemplateXLS.SetAutoFilter("A28:Z28", SHEET_0292s);
    end;

    if( ExistsSheet( SHEET_0491s ) )
      m_ObjTemplateXLS.SetAutoFilter("A28:Z28", SHEET_0491s);
    end;
     
    if( ExistsSheet( SHEET_0692s ) )
      m_ObjTemplateXLS.SetAutoFilter("A28:AB28", SHEET_0692s);
    end;
     
    if( ExistsSheet( SHEET_0791s ) )
      m_ObjTemplateXLS.SetAutoFilter("A28:AD28", SHEET_0791s);
    end;
  END;

  PRIVATE MACRO EndReport()
    EndReport();
    SetAutoFilter();
  END;

  /*â®«ìª® ¥ªá¥«ì*/
  PRIVATE MACRO PrintMode():INTEGER
     return DL_OUTREPORT_EXCEL;
  END;

  /* ¨¬¥­®¢ ­¨¥ ­ è¥£® ¡ ­ª */
  MACRO H0_A():STRING
     return ®«ãç¨âìŠ®à®âª®¥ˆ¬ï‘ã¡ê¥ªâ ( {OurBank} );
  END;

  MACRO H0_B_INN()
     if( m_INN == null )
        SplitFullINN( ®«ãç¨âìŠ®¤‘ã¡ê¥ªâ ({OurBank}, PTCK_INN), m_INN, m_KPP );
     end;
     return m_INN;
  END;

  MACRO H0_B_KPP()
     if( m_KPP == null )
        SplitFullINN( ®«ãç¨âìŠ®¤‘ã¡ê¥ªâ ({OurBank}, PTCK_INN), m_INN, m_KPP );
     end;
     return m_KPP;
  END;

  /* ç «® ®âç¥â­®£® ¯¥à¨®¤  */
  MACRO H0_7():DATE
     return date(m_H07);
  END;

  /*Žâç¥â­ ï ¤ â , ãª § ­­ ï ¢ ä®à¬¥ § ¯ãáª  ®âç¥â */
  MACRO H0_8():DATE
     return date(m_H08);
  END;

  /*‚ë¯ãáª æ/¡*/
  MACRO H0_11():STRING
     return m_H0_11;
  END;

  MACRO „¯():DATE // ¬ ªá¨¬ «ì­ ï ¨§ ¤¢ãå ¤ â: ((<H0.7>; <DDS>+1),
     return MAX( this.H0_7(), this.DDS()+1 );
  END;

  /*ƒàã¯¯  ­ «®£®¢®£® ãç¥â */
  MACRO H0_9_Name():STRING
     return m_H0_9_Name;
  END;

  MACRO H0_9_Num():STRING
     return m_H0_9_Num;
  END;

  MACRO PrintHeader( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )
  END;

   macro GetYear():string
     var y, y2;
     y2 = WebFormData.Year;
     return string(y2);

   end;
   
  macro FSummCol(col):STRING
    var sf_summ:string = "";
    var start_row = ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ_rshb_header;
    var end_row = MAXROWSHEET;
    var range = col + start_row + ":" + col + end_row;
    if (m_UseTemplate)
      if (m_ObjTemplateXLS.ExcelLanguageInterface != EXCEL_INTERFACE_RUS) 
        sf_summ = sf_summ + "SUM";
      else
        sf_summ = sf_summ + "‘“ŒŒ";
      end;
      sf_summ = "formula=" + sf_summ + "(" + range + ")";
    end;
    return sf_summ;
  end;
  
   macro GetPeriodCode():string
      //N1_H0_PeriodCode
      var code = "";
      var p, p2;
      var gr:bool = false;

      gr = WebFormData.AddItog;
      p2 = WebFormData.Period;

      if ((p2 == 13)  or (p2 == 3))
         code = "21";
      elif(gr and ((p2 == 14) or (p2 == 6)))
         code = "31";
      elif(gr and ((p2 == 15) or (p2 == 9)))
         code = "33";
      elif(gr and ((p2 == 16) or (p2 == 12)))
         code = "34";
      end;

      return code;
   end;

   macro GetPeriodTxt():string
      //N1_H0_PeriodTxt
      const ytxt = " ƒŽ„€";
      const y2txt = " ƒŽ„";
      const mtxt = " Œ…‘Ÿ–…‚ ";
      const qtxt = " Š‚€’€‹ ";

      var code = "";
      var p, p2;
      var gr:bool = false;
      var y = GetYear();

      gr = WebFormData.AddItog;
      p2 = WebFormData.Period;
      if((p2 == 13) or (gr and (p2 == 3))) // 1 ª¢
         code = "1"+qtxt+y+ytxt;
      elif(gr and ((p2 == 14) or (p2 == 6)))
         code = "I Ž‹“ƒŽ„ˆ… " + y + ytxt;
      elif(gr and ((p2 == 15) or (p2 == 9)))
         code = "9" + mtxt + y + ytxt;
      elif(gr and ((p2 == 16) or (p2 == 12)))
         code = y + y2txt;
      elif(gr and (p2 > 0) and (p2 < 12))
         code = string(p2) + mtxt + y + ytxt;
      elif((not gr) and (p2 > 13) and (p2 < 17))
         code = string(p2-12) + qtxt + y + ytxt;
      elif((not gr) and (p2 > 0) and (p2 < 13))
         code = StrUpr( MonName(p2) ) + " " + y + ytxt;
      end;

      return code;
   end;


  MACRO PrintHeader_rshb( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )
     PrintFormatString( "",
                       FldPref+"Ž¯¥à æ¨®­¨áâ",     Oper_rshb(),//GetOperRecByID({oper}).Name,
                       FldPref+"H0_Year",          GetYear(),
                       FldPref+"H0_PeriodCode",    GetPeriodCode(),
                       FldPref+"H0_PeriodTxt",     GetPeriodTxt()
                     );

    if (FldPref == "N2_")
      PrintFormatString(""
                    , "N2_G7", FSummCol("G")
                    , "N2_H7", FSummCol("H")
                    , "N2_I7", FSummCol("I")
                    , "N2_J7", FSummCol("J")
                    , "N2_K7", FSummCol("K")
                    , "N2_L7", FSummCol("L")
                    , "N2_M7", FSummCol("M")
                    , "N2_N7", FSummCol("N")
                    , "N2_O7", FSummCol("O")
                    , "N2_S7", FSummCol("S")
                    , "N2_T7", FSummCol("T")
                    , "N2_U7", FSummCol("U")
                    , "N2_V7", FSummCol("V")
                    , "N2_W7", FSummCol("W")
                    , "N2_X7", FSummCol("X")
                    , "N2_Y7", FSummCol("Y")
                    , "N2_AK7", FSummCol("AK")
                    , "N2_AX7", FSummCol("AX")
                    , "N2_BI7", FSummCol("BI")
                    , "N2_BJ7", FSummCol("BJ")
                    , "N2_BK7", FSummCol("BK")
                    , "N2_BM7", FSummCol("BM")
                    , "N2_BN7", FSummCol("BN")
                    , "N2_BO7", FSummCol("BO")
                    , "N2_BQ7", FSummCol("BQ")
                    , "N2_BR7", FSummCol("BR")
                    , "N2_BW7", FSummCol("BW")
                    , "N2_BX7", FSummCol("BX")
                    , "N2_BY7", FSummCol("BY")
                    , "N2_BZ7", FSummCol("BZ")
                     );
      return;
    end;
    if (FldPref == "N4_")
      PrintFormatString(""
                  , "N4_H7", FSummCol("H")
                  , "N4_I7", FSummCol("I")
                  , "N4_J7", FSummCol("J")
                  , "N4_K7", FSummCol("K")
                  , "N4_O7", FSummCol("O")
                  , "N4_P7", FSummCol("P")
                  , "N4_Q7", FSummCol("Q")
                  , "N4_S7", FSummCol("S")
                  , "N4_T7", FSummCol("T")
                  , "N4_U7", FSummCol("U")
                  , "N4_V7", FSummCol("V")
                  , "N4_AA7", FSummCol("AA")
                  , "N4_AB7", FSummCol("AB")
                  , "N4_AN7", FSummCol("AN")
                  , "N4_AO7", FSummCol("AO")
                   );
      return;
    end;
    if (FldPref == "N6_")
      PrintFormatString(""
                    , "N6_G7", FSummCol("G")
                    , "N6_H7", FSummCol("H")
                    , "N6_I7", FSummCol("I")
                    , "N6_J7", FSummCol("J")
                    , "N6_K7", FSummCol("K")
                    , "N6_O7", FSummCol("O")
                    , "N6_P7", FSummCol("P")
                    , "N6_Q7", FSummCol("Q")
                    , "N6_R7", FSummCol("R")
                    , "N6_S7", FSummCol("S")
                    , "N6_T7", FSummCol("T")
                    , "N6_U7", FSummCol("U")
                    , "N6_V7", FSummCol("V")
                    , "N6_W7", FSummCol("W")
                    , "N6_X7", FSummCol("X")
                    , "N6_Y7", FSummCol("Y")
                    , "N6_Z7", FSummCol("Z")
                    , "N6_AA7", FSummCol("AA")
                    , "N6_AB7", FSummCol("AB")
                    , "N6_AC7", FSummCol("AC")
                    , "N6_AD7", FSummCol("AD")
                    , "N6_AE7", FSummCol("AE")
                    , "N6_AF7", FSummCol("AF")
                    , "N6_AG7", FSummCol("AG")
                    , "N6_AR7", FSummCol("AR")
                    , "N6_BE7", FSummCol("BE")
                    , "N6_BQ7", FSummCol("BQ")
                    , "N6_BR7", FSummCol("BR")
                    , "N6_BW7", FSummCol("BW")
                    , "N6_BX7", FSummCol("BX")
                    , "N6_BY7", FSummCol("BY")
                    , "N6_BZ7", FSummCol("BZ")
                     );
      return;
    end;
    if (FldPref == "N7_")
      PrintFormatString(""
                    , "N7_G7", FSummCol("G")
                    , "N7_H7", FSummCol("H")
                    , "N7_I7", FSummCol("I")
                    , "N7_J7", FSummCol("J")
                    , "N7_K7", FSummCol("K")
                    , "N7_L7", FSummCol("L")
                    , "N7_O7", FSummCol("O")
                    , "N7_P7", FSummCol("P")
                    , "N7_Q7", FSummCol("Q")
                    , "N7_R7", FSummCol("R")
                    , "N7_S7", FSummCol("S")
                    , "N7_T7", FSummCol("T")
                    , "N7_U7", FSummCol("U")
                    , "N7_V7", FSummCol("V")
                    , "N7_W7", FSummCol("W")
                    , "N7_X7", FSummCol("X")
                    , "N7_AB7", FSummCol("AB")
                    , "N7_AI7", FSummCol("AI")
                    , "N7_AQ7", FSummCol("AQ")
                    , "N7_AR7", FSummCol("AR")
                     );
      return;
    end;
    
  END;
  
  MACRO PrintHeader_cons( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )
     PrintFormatString( "",
                       FldPref+"„ â ‘®áâ ¢«¥­¨ï", string(Date())+" "+string(Time()),
                       FldPref+"®¬¥àŽ¯¥à ",      string({oper}),
                       FldPref+"Ž¯¥à æ¨®­¨áâ",    GetOperRecByID({oper}).Name,
                       FldPref+"H0_A:l",          this.H0_A(),
                       FldPref+"H0_B_INN",        this.H0_B_INN(),
                       FldPref+"H0_B_KPP",        this.H0_B_KPP(),
                       FldPref+"H0_3",            H03,
                       FldPref+"H0_7",            this.H0_7(),
                       FldPref+"H0_8",            this.H0_8(),
                       FldPref+"H0_9",            this.H0_9_Name(),
                       FldPref+"H0_11",           this.H0_11()
                     );
  END;

  macro SetCopyAutoSumRange(r)
     m_CopyAutoSumRange = r;
  end;

  macro SetAutoSize() //€¢â®¬ â¨ç¥áª ï è¨à¨­  ¤«ï áâ®«¡æ®¢
    if( m_ReportKind == INDNOM_REG_0292) 
      m_ObjTemplateXLS.SetAutoFit("C:CA", m_ObjTemplateXLS.SheetName());             
    elif( m_ReportKind == INDNOM_REG_0491)
      m_ObjTemplateXLS.SetAutoFit("C:AP", m_ObjTemplateXLS.SheetName());
    elif( m_ReportKind == INDNOM_REG_0692)
      m_ObjTemplateXLS.SetAutoFit("C:CA", m_ObjTemplateXLS.SheetName());
    elif( m_ReportKind == INDNOM_REG_0791)
      m_ObjTemplateXLS.SetAutoFit("C:AS", m_ObjTemplateXLS.SheetName());
    end;
  end;

  macro PrintLineAutoSumma_rshb()
    var Address;
    var i = 0, OldSheet;
  
    if((m_CopyAutoSumRange == null) or (m_CopyAutoSumRange == ""))
      return;
    end;

    if( not m_UseTemplate )
      return;
    end;

    if( m_ItogLineName != NULL ) // ¢ ¯¥à¢®© áâà®ª¥ â ¡«¨æë
      OldSheet = m_ObjTemplateXLS.SheetName();
      m_ObjTemplateXLS.SheetChange( m_FirstSheetName );
    end;

    while( i < m_NumCellAutoSumm.Size )
      Address = CAddressDiapazon(m_CopyAutoSumRange).GetCell(0, NC( m_NumCellAutoSumm[i] ) );
      m_ObjTemplateXLS.SetValue_NameCell( Address, m_FormulaSumm[i] );
      i = i + 1;
    end;

    if( m_ItogLineName != NULL ) // ¢ ¯¥à¢®© áâà®ª¥ â ¡«¨æë
      m_ObjTemplateXLS.SheetChange( OldSheet );
    end;

  end;

  macro PrintLineAutoSumma()
    if((m_CopyAutoSumRange == null) or (m_CopyAutoSumRange == ""))
        PrintLineAutoSumma();
    else
        PrintLineAutoSumma_rshb();
    end;
  end;

  MACRO DeleteRows(sheet, range)
    if( ExistsSheet( sheet ) )
      m_ObjTemplateXLS.RemoveRow(range, sheet);
    end;
  end;

  MACRO SetOnAutoFilter(sheet, range)
    if( ExistsSheet( sheet ) )
      m_ObjTemplateXLS.SetAutoFilter(range, sheet);
    end;
  end;

  MACRO GetCCons()
    return "";
  END;

  MACRO CReport_DataExist()
    return (m_IsExistsData or ReportHasError());
  END;

  MACRO SetCurrentStrNumber()
     m_CurrStrNum = this.®¬¥à’¥ªãé¥©‘âà®ª¨() + 11;
  END;

  MACRO SaveFIIDForForm_cons(FIID:integer)
     var query, exec;
     query =   " INSERT INTO dspprtcst_tmp ( T_FIID ) VALUES (?) ";
     exec = RSDCommand(query);
     exec.addParam( "", RSDBP_IN, FIID );
     exec.execute();
  END;

  MACRO ˆ¬ïŽá­®¢­®£®‹¨áâ ()
     return m_SHEET_1;
  END;

  MACRO ˆ¬ï‘¢®¤­®£®‹¨áâ ()
     return m_SHEET_2;
  END;

  MACRO ˆ¬ïŠ®¤–Žá­‹¨áâ ()
     return C_SecCode;
  END;

  MACRO ˆ¬ïŠ®¤–‘¢®¤‹¨áâ ()
     return C_SecCode_2;
  END;

  MACRO ®¬¥à ç‘âà®ª¨‘ã¬¬()
     return ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ;
  END;

  MACRO ®¬¥àŠ®­¥ç­‘âà®ª¨‡ £®«®¢ª ()
     return ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€;
  END;

  MACRO ®¬¥à ç‘âà®ª¨‘ã¬¬_rshb_header()
     return ŽŒ…_€—€‹œŽ‰_‘’ŽŠˆ_‘“ŒŒ_rshb_header;
  END;

  MACRO ®¬¥àŠ®­¥ç­‘âà®ª¨‡ £®«®¢ª _rshb_header()
     return ŽŒ…_ŠŽ…—Ž‰_‘’ŽŠˆ_‡€ƒŽ‹Ž‚Š€_rshb_header;
  END;

  /*…á«¨ ªà¨â¥à¨© ®¤¨­ - ¨á¯®«ì§ã¥âáï ä-«  ‘“ŒŒ…‘‹ˆ, ¥á«¨ ¡®«ìè¥ ®¤­®£® - ‘“ŒŒŽˆ‡‚ (¡ë«® ¡ë ¯à®é¥ ¨á¯®«ì§®¢ âì ‘“ŒŒ…‘‹ˆŒ, ­® ¬ë ¯®ª  à ¡®â ¥¬ ¢ à¥¦¨¬¥ á®¢¬¥áâ¨¬®áâ¨ ¤® 2007,   ‘“ŒŒ…‘‹ˆŒ ¯®ï¢¨« áì ¯®á«¥ 2007)
    1 ¯ à ¬¥âà - ¨¬ï ïç¥©ª¨, ¯® ª®âà®© áã¬¬¨à®¢ ­¨¥
    ¤ «¥¥ ¯ àë ¯ à ¬¥âà®¢: ¯¥à¢ë© - ¨¬ï ïç¥©ª¨, ¯® ª®â®à®© ãá«®¢¨¥, ¢â®à®© ¯ à ¬¥âà - á ¬® ãá«®¢¨¥ ¢ ª ¢ëçª å*/
  macro ’¥ªáâ”®à¬ã«ë®‚á¥¬‘¤¥«ª ¬„«ï‚ë¯ãáª (/*...*/)
     VAR k = 1, CellName ="", ColNameCond = "", WhereCond = "";
     VAR i = 0, j = 0, NumSheet1 = 0, NumSheet2 = 0, FormulaStr = "", BeginRow_1 = 0, BeginRow_2 = 0, SummBeginRow_1 = 0, SummBeginRow_2 = 0;
     VAR FormulaSumStr ="", FormulaCondStr = "";

     while( i < m_UsedSheet.Size )
        if( StrUpr(m_UsedSheet[i]) == StrUpr(this.ˆ¬ïŽá­®¢­®£®‹¨áâ ()) )
           NumSheet1 = i;
           break;
        end;
        i = i + 1;
     end;

     i = 0;
     while( i < m_UsedSheet.Size )
        if( StrUpr(m_UsedSheet[i]) == StrUpr(this.ˆ¬ï‘¢®¤­®£®‹¨áâ ()) )
           NumSheet2 = i;
           break;
        end;
        i = i + 1;
     end;

     i = NumSheet1;
     while( i < NumSheet2 )
        if( StrUpr(m_UsedSheet[i]) == StrUpr(this.ˆ¬ïŽá­®¢­®£®‹¨áâ ()) ) /*¤«ï ¯¥à¢®© ¢ª« ¤ª¨*/
           BeginRow_1 = this.®¬¥àŠ®­¥ç­‘âà®ª¨‡ £®«®¢ª _rshb_header();
           SummBeginRow_1 = this.®¬¥à ç‘âà®ª¨‘ã¬¬_rshb_header();
        else
           BeginRow_1 = 1;
           SummBeginRow_1 = 2;
        end;

        if( StrUpr(m_UsedSheet[m_UsedSheet.size-1]) == StrUpr(this.ˆ¬ï‘¢®¤­®£®‹¨áâ ()) )/*¤«ï ¯¥à¢®©(­ ç¨­ ï á m_SHEET_2) ¢ª« ¤ª¨*/
           BeginRow_2 = this.®¬¥àŠ®­¥ç­‘âà®ª¨‡ £®«®¢ª ();
           SummBeginRow_2 = this.®¬¥à ç‘âà®ª¨‘ã¬¬();
        else
           BeginRow_2 = 1;
           SummBeginRow_2 = 2;
        end;

        if( FormulaStr != "" )
           FormulaStr = FormulaStr + "+";
        end;

        FormulaSumStr = "";
        CellName = "";
        k = 1;
        if( GetParm( k, CellName) )
           FormulaSumStr = "'"+m_UsedSheet[i]+"'!$"+CellName+"$"+SummBeginRow_1+":$"+CellName+"$"+string(BeginRow_1+MAXROWSHEET);
        end;

        ColNameCond = "";
        WhereCond = "";
        FormulaCondStr = "";
        k = k + 1;
        while( GetParm( k, ColNameCond) AND GetParm( k+1, WhereCond))
            FormulaCondStr = FormulaCondStr + "('"+m_UsedSheet[i]+"'!$"+this.ˆ¬ïŠ®¤–Žá­‹¨áâ ()+"$"+SummBeginRow_1+":$"+this.ˆ¬ïŠ®¤–Žá­‹¨áâ ()+"$"+string(BeginRow_1+MAXROWSHEET)+"=$"+this.ˆ¬ïŠ®¤–‘¢®¤‹¨áâ ()+"$"+(m_ReportTable.bRowTable + getCurrentRow())+")*('"+
                             m_UsedSheet[i]+"'!$"+ColNameCond+"$"+SummBeginRow_1+":$"+ColNameCond+"$"+string(BeginRow_1+MAXROWSHEET)+WhereCond+");";
            k = k + 2;
            ColNameCond = "";
            WhereCond = "";
        end;

        if( k > 2 )
           FormulaStr = FormulaStr + FormulaSUMPRODUCT()+"("+FormulaCondStr+FormulaSumStr+")";
        else
           FormulaStr = FormulaStr + FormulaSUMIF()+"('"+m_UsedSheet[i]+"'!$"+this.ˆ¬ïŠ®¤–Žá­‹¨áâ ()+"$"+SummBeginRow_1+":$"+this.ˆ¬ïŠ®¤–Žá­‹¨áâ ()+"$"+string(BeginRow_1+MAXROWSHEET)+";\"=\"&$"+this.ˆ¬ïŠ®¤–‘¢®¤‹¨áâ ()+"$"+SummBeginRow_2+":$"+this.ˆ¬ïŠ®¤–‘¢®¤‹¨áâ ()+"$"+string(BeginRow_2+MAXROWSHEET)+";'"+m_UsedSheet[i]+"'!$"+CellName+"$"+SummBeginRow_1+":$"+CellName+"$"+string(BeginRow_1+MAXROWSHEET)+")";
        end;

        i = i + 1;
     end;

     return FormulaStr;
  end;
  
  MACRO GetAddWhereForDeal()
     return "";
  END;

  MACRO GetAddWhereForAvr()
     return m_AddWhereForAvr;
  END;

  PRIVATE MACRO ExecuteReport()
     ExecuteReport();
     SQL_Truncate( "dspprtcst_tmp" );
  END;

  macro PrintForm_Cons(ObjReport:OBJECT)
     VAR header = "", NRecs = 0, Current = 0;
     var exec, DataSet;

     exec = DL_RSDCommand(" select fin.t_FI_Code, fin.t_Name, av.t_TaxGroup, "+
                          "        (case when av.t_ISIN IS null OR av.t_ISIN IN (chr(0), chr(1)) then (case when av.t_LSIN IS null OR av.t_LSIN IN (chr(0), chr(1)) then chr(0) else av.t_LSIN end) else av.t_ISIN end) AS t_ISIN "+
                          "   from dspprtcst_tmp t, dfininstr_dbt fin, DAVOIRISS_DBT av "+
                          "  where fin.t_FIID = t.t_FIID "+
                          "    AND av.t_FIID = fin.t_FIID "+
                          "  group by fin.t_FI_Code, fin.t_Name, av.t_TaxGroup, "+
                          "           (case when av.t_ISIN IS null OR av.t_ISIN IN (chr(0), chr(1)) then (case when av.t_LSIN IS null OR av.t_LSIN IN (chr(0), chr(1)) then chr(0) else av.t_LSIN end) else av.t_ISIN end) "+
                          "  order by av.t_TaxGroup, fin.t_FI_Code");

     NRecs = exec.GetCount();

     if (NRecs > 0)
        header = "¥ç âì áâà®ª á¢®¤­®£® «¨áâ  ¯® ¢ë¯ãáª ¬ æ/¡ ¤«ï à¥£¨áâà  "+ˆ¬ïŽá­®¢­®£®‹¨áâ ();
        m_ProgressIndicator.Start(NRecs, header, header);

        ObjReport.BeginReport();

        DataSet = exec.execute();
        while(DataSet.MoveNext())
           ObjReport.Print(DataSet.TaxGroup,DataSet.FI_Code,DataSet.Name, DataSet.ISIN);
           Current = Current + 1;
           m_ProgressIndicator.Update(Current,NRecs);
        end;

        ObjReport.EndReport();
        ReplaceFormulaAndCalculate();

        m_ProgressIndicator.Stop();
     end;

  end;

  MACRO PrintConsolidated( ObjReport:OBJECT )
     this.PrintForm_Cons(ObjReport);
  END;

  MACRO CreateReport()
  END;

  MACRO Create()
     SetXLSXFormat();
     CreateReport();
     setRecreateSheets(true);
  END;

  PRIVATE MACRO GetFormulaSummREG_rshb()
    var i = 0, StrSumm = "", BeginRow, CellAddr;

    while( i < m_NumCellAutoSumm.Size )

        CellAddr = m_ReportTable.AddressDiapazon.GetCell( 0, NC( m_NumCellAutoSumm[i] ) );

        if( m_ReportTable.AddressDiapazon.GetNumbRow() > 0 )
          StrSumm = m_ReportTable.GetFormulaSummREG( CellAddr, null, m_ReportTable.bRowTable, m_ReportTable.bRowTable+m_ReportTable.AddressDiapazon.GetNumbRow()-1 );
        else
          StrSumm = "";
        end;

        if( m_FormulaSumm[i] == null ) /*¤«ï ¯¥à¢®© ¢ª« ¤ª¨*/
          m_FormulaSumm[i] = "";
        elif( substr(StrSumm, 1,1) == "=" )
          StrSet( StrSumm, 1, "+" );
        end;
        m_FormulaSumm[i] = m_FormulaSumm[i] + StrSumm;
        i = i + 1;
    end;
  END;

  /*® § ¬¥ç ­¨ï¬ ƒ ã¡à ­® ­ ¨¬¥­®¢ ­¨¥ «¨áâ  ¨§ ä®à¬ã«ë ¨â®£®¢*/
  MACRO GetFormulaSumm()
    if((m_CopyAutoSumRange == null) or (m_CopyAutoSumRange == ""))
      GetFormulaSummREG();
    else
      GetFormulaSummREG_rshb();
    end;
  END;

  MACRO GetValueForCalc( pValue, pDefaultVal )
     var vDefaultVal = string(iif(pDefaultVal!=null,pDefaultVal,0));
     return FormulaIF()+"("+FormulaISNUMBER()+"("+pValue+")"+";"+pValue+";"+vDefaultVal+")";
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetSumSvp():STRING
     return (C_SumSvp+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetCrSD():STRING
     return GetValueForCalc(C_CrSD+string(m_CurrStrNum),1);
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetSumSrub():STRING
     return (C_SumSrub+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNom_DDS():STRING
     return (C_Nom_DDS+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNom_Sec():STRING
     return (C_Nom_Sec+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetQnty():STRING
     return (C_Qnty+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdRepRub_():STRING
     return (C_NkdRepRub_+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdRepRub_IN():STRING
     return (C_NkdRepRub_IN+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdSvp():STRING
     return GetValueForCalc(C_NkdSvp+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetCoupRub():STRING
     return GetValueForCalc(C_CoupRub+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdBrepRub():STRING
     return GetValueForCalc(C_NkdBrepRub+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdPrevRub_():STRING
     return GetValueForCalc(C_NkdPrevRub_+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdAllRub_():STRING
     return (C_NkdAllRub_+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdRepEndRub():STRING
     return GetValueForCalc(C_NkdRepEndRub+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNom_DDB():STRING
     return GetValueForCalc(C_Nom_DDB+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdPrevRub_IN():STRING
     return GetValueForCalc(C_NkdPrevRub_IN+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdAllRub_IN():STRING
     return (C_NkdAllRub_IN+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNom_H08():STRING
     return GetValueForCalc(C_Nom_H08+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetCrBD():STRING
     return GetValueForCalc(C_CrBD+string(m_CurrStrNum),1);
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetSumBvp():STRING
     return GetValueForCalc(C_SumBvp+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetMaxMrkt():STRING
     return (C_MaxMrkt+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetMrktB():STRING
     return (C_MrktB+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetContB_Dep():STRING
     return (C_ContB_Dep+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetSumBrub():STRING
     return (C_SumBrub+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetDifB():STRING
     return (C_DifB+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetSumBtax():STRING
     return (C_SumBtax+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetComS():STRING
     return (C_ComS+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetComB():STRING
     return (C_ComB+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetPrSNom():STRING
     return (C_PrSNom+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetPrBNom():STRING
     return (C_PrBNom+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetTaxe_NKD():STRING
     return (C_Taxe_NKD+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetTaxe_Amort():STRING
     return (C_Taxe_Amort+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetRashAll():STRING
     return (C_RashAll+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetDifS():STRING
     return (C_DifS+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetSumAllRub():STRING
     return (C_SumAllRub+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdRepRub():STRING
     return (C_NkdRepRub+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNKDminusRub():STRING
     return GetValueForCalc(C_NKDminusRub+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetMinMrkt():STRING
     return (C_MinMrkt+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetMrktS():STRING
     return (C_MrktS+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetContS_Dep():STRING
     return (C_ContS_Dep+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetSellType():STRING
     return (C_SellType+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetNkdBvp():STRING
     return (C_NkdBvp+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetCoupPrevRub():STRING
     return GetValueForCalc(C_CoupPrevRub+string(m_CurrStrNum));
  END;

  /*¯®«ãç¨âì  ¤à¥á ïç¥©ª¨*/
  MACRO GetTypeB():STRING
     return (C_TypeB+string(m_CurrStrNum));
  END;

  MACRO QuoteValueB()
    if(this.IsDUDealS() == 1)
      return 0;
    end;
    return m_RS.BuyMarketQuoteValue;
  END;

  MACRO QuoteValueS()
    if(this.IsDUDealS() == 1)
      return 0;
    end;
    return m_RS.SaleMarketQuoteValue;
  END;

  MACRO TypeB():STRING /*Š®¤ á¤¥«ª¨ ¯à¨®¡à¥â¥­¨ï*/
     if( m_TypeB == NULL )
        m_TypeB = "";
        if( m_RS.TypeB == TXLOTS_BUY )
           if(m_RS.BBOfficeKind == DL_AVRWRT)
              m_TypeB = "FB";
           else
              m_TypeB = "B";
           end;
        elif( m_RS.TypeB == TXLOTS_SALE )
           m_TypeB = "S";
        elif( m_RS.TypeB == TXLOTS_REPO )
           m_TypeB = "";
        elif( m_RS.TypeB == TXLOTS_BACKREPO )
           m_TypeB = "Ž";
        elif( m_RS.TypeB == TXLOTS_LOANPUT )
           m_TypeB = "‡";
        elif( m_RS.TypeB == TXLOTS_LOANGET )
           m_TypeB = "‡Ž";
        end;
     end;
     return m_TypeB;
  END;

  /*292, 692, 791
    !”®à¬ã« . <SumSrub> = <SumSvp>*<‘rSD> (£à.7 = £à. S3* £à. S2)*/
  MACRO SumSrub() // ‘â®¨¬®áâì à¥ «¨§ æ¨¨ - ¢ àã¡«ïå
    if(this.IsDUDealS() == 1)
      return F(0);
    end;
    return F(GetSumSvp()+"*"+GetCrSD());
  END;

  /*„«ï á¤¥«®ª à¥ «¨§ æ¨¨: <NkdSvp> = Š„ ¨§ á¤¥«ª¨ <CodeS>*<Qnty>/QS.
    „«ï ¯®£ è¥­¨©:
    <NkdSvp> = <Qnty> * ®á«¥¤­¨© ªã¯®­ ¢ ¢ «îâ¥ ­®¬¨­ « */
  MACRO NkdSvp():MONEY
     if( m_NkdSvp == NULL )
        if( m_RS.SBofficeKind == DL_RETIREMENT )
           m_NkdSvp = ‘ã¬¬ Šã¯®­ (m_RS.FIID,this.Qnty(),Dexp());
        else
           m_NkdSvp = this.NkdSvp();
        end;
     end;
     return m_NkdSvp;
  END;

  /*”®à¬ã« ! <SumAllRub> =<SumSrub> - ( <Nom_DDS> -  <Nom_Sec>) * <Qnty>*/
  MACRO SumAllRub()
    if(this.IsDUDealS() == 1)
      return F(0);
    end;
    return F(GetSumSrub()+"-("+GetNom_DDS()+"-"+GetNom_Sec()+")*"+GetQnty());
  END;

  /*‚ëàãçª  ®â à¥ «¨§ æ¨¨ (¯®£ è¥­¨ï) ¤«ï æ¥«¥© ­ «®£®®¡«®¦¥­¨ï, àã¡. - ¢ â®¬ ç¨á«¥: áã¬¬ë % ¤®å®¤ , ãçâ¥­­ë¥ ¯à¨ ­ «®£®®¡«®¦¥­¨¨ ¤® ­ ç «  â¥ªãé¥£® ®âç¥â­®£® (­ «®£®¢®£®) ¯¥à¨®¤ */
  /*¥ § ¯®«­ï¥âáï.*/
  MACRO NKDminusRub():MONEY
  END;

  /*292,692*/
  /*‘ã¬¬  ®âª«®­¥­¨ï ä ªâ¨ç¥áª®© ¢ëàãçª¨ ­¨¦¥ àë­®ç­®© (à áç¥â­®©) æ¥­ë, àã¡.*/
  /*¢ § ¢¨á¨¬®áâ¨ ®â ãá«®¢¨© ¨«¨ ã¦¥ ¯®áç¨â ­­®¥ §­ ç¥­¨¥ ¨«¨ !ä®à¬ã« */
  MACRO DifS()
     var RetVal;

     if ( (m_RS.TechDealSale != 0) OR (this.IsDUDealS() == 1) ) // â¥å­¨ç¥áª ï
          RetVal = $0.0;
     elif( m_RS.IsPriceDifNoteS )/*¥á«¨ § ¯®«­¥­® ¯à¨¬¥ç ­¨¥*/
        if( this.QS() != 0 )
           RetVal = ‚ë¢®¤—¥à¥§”®à¬ã«ã(SQL_ConvTypeSum(m_RS.PriceDifNoteS) / this.QS() * this.Qnty());
        end;
     else
        /*!ä®à¬ã« */
        RetVal = F(FormulaIF()+"("+FormulaOR()+"("+GetMinMrkt()+"=0;"+GetMrktS()+"=\"”€Š’\";"+GetContS_Dep()+"=\"…’\";"+GetMrktS()+"=\"ˆ†…‚€Ÿ ‘„…‹Š€\");0;"+
                   FormulaIF()+"(("+GetMinMrkt()+"*"+GetNom_DDS()+"/100*"+GetQnty()+"-"+GetSumSvp()+"*"+GetCrSD()+") > 0;"+
                   GetMinMrkt()+"*"+GetNom_DDS()+"/100*"+GetQnty()+"-"+GetSumSvp()+"*"+GetCrSD()+";0))");
     end;

     return RetVal;
  END;

  /*! ”®à¬ã«  <NkdRepRub> = <NkdRepRub_%> + <NkdRepRub_IN>*/
  MACRO NkdRepRub()
     return F(GetNkdRepRub_()+"+"+GetNkdRepRub_IN());
  END;

  /*!”®à¬ã«  <SumBrub> = <SumBvp>* <CrBD> */
  MACRO SumBrub()
     return F(GetSumBvp()+"*"+GetCrBD());
  END;

  /*Š„ ã¯« ç¥­­ë© ¯à¨ ¯à¨®¡à¥â¥­¨¨, àã¡*/
  MACRO NkdBvp():MONEY
     if(m_NkdBvp == null)
        m_NkdBvp = money(this.NKDBuy()*this.Qnty()/this.QB());
     end;
     return m_NkdBvp;
  END;

  /*292,692*/
  /*‘ã¬¬  ¯à¥¢ëè¥­¨ï áâ®¨¬®áâ¨ ¯à¨®¡à¥â¥­¨ï ­ ¤ àë­®ç­®© (à áç¥â­®©) æ¥­®©, àã¡.*/
  /*¢ § ¢¨á¨¬®áâ¨ ®â ãá«®¢¨© ¨«¨ ã¦¥ ¯®áç¨â ­­®¥ §­ ç¥­¨¥ ¨«¨ !ä®à¬ã« */
  MACRO DifB()
     var RetVal;

     if ( (m_RS.TechDealBuy != 0) OR (this.IsDUDealB() == 1)) // â¥å­¨ç¥áª ï
        RetVal = $0.0;
     elif( m_RS.IsPriceDifNoteB )/*¥á«¨ § ¯®«­¥­® ¯à¨¬¥ç ­¨¥*/
        if( this.QB() != 0 )
           RetVal = ‚ë¢®¤—¥à¥§”®à¬ã«ã(SQL_ConvTypeSum(m_RS.PriceDifNoteB) / this.QB() * this.Qnty());
        end;
     else
        /*!ä®à¬ã« */
        RetVal = F(FormulaIF()+"("+FormulaOR()+"("+GetMaxMrkt()+"=0;"+GetMrktB()+"=\"”€Š’\";"+GetContB_Dep()+"=\"…’\";"+GetMrktB()+"=\"ˆ†…‚€Ÿ ‘„…‹Š€\");0;"+
                   FormulaIF()+"(("+GetSumBvp()+"*"+GetCrBD()+"-"+GetMaxMrkt()+"*"+GetNom_DDB()+"/100*"+GetQnty()+") > 0;"+
                   GetSumBvp()+"*"+GetCrBD()+"-"+GetMaxMrkt()+"*"+GetNom_DDB()+"/100*"+GetQnty()+";0))");
     end;

     return RetVal;
  END;

  /*! ”®à¬ã«   <SumBtax> = <SumBrub> - <DifB> - (<Nom_DDB>- <Nom_Sec>)*  <Qnty>*/
  MACRO SumBtax()
    if(this.IsDUDealS() == 1)
      return F(0);
    end;
    return F(GetSumBrub()+"-"+GetDifB()+"-"+"("+GetNom_DDB()+"-"+GetNom_Sec()+")*"+GetQnty());
  END;

  /*! ”®à¬ã«   <RashAll> = <SumBtax>+ <ComS> + <ComB>*/
  MACRO RashAll()
     return F(GetSumBtax()+"+"+GetComS()+"+"+GetComB());
  END;

  MACRO NomS():MONEY // ­®¬¨­ « ®¡«¨£ æ¨¨ ­  ¤ âã <DDS>
     if( m_NomS == NULL )
        m_NomS = GetFaceValueOnDate(this.DDS());
     end;
     return m_NomS;
  END;

  MACRO NomB():DOUBLE // ­®¬¨­ « ®¡«¨£ æ¨¨ ­  ¤ âã <DDB>
     if( m_NomB == NULL )
        m_NomB = GetFaceValueOnDate(iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()));
     end;
     return m_NomB;
  END;

  /* Šãàá ¯¥à¥áç¥â  áâ-â¨ à¥ «¨§ æ¨¨ ¢ àã¡«¥¢ë© íª¢¨¢ «¥­â */
  MACRO CrSD():DOUBLE
     if(m_CrSD == NULL)
        if( SubStr(this.K_ControlS(),1,1) == "9" )
           m_CrSD = ®«ãç¨âìŠãàá®áâ ­®¢ª¨  « ­á(DealSale());
        else
           m_CrSD = 1.0;
        end;
     end;

     if( m_CrSD == NULL )
        m_CrSD = 0.0;
     end;

     return m_CrSD;
  END;

  MACRO ComS():MONEY //  Š®¬¨áá¨ï, ã¯« ç¥­­ ï ¯à¨ à¥ «¨§ æ¨¨
    if( m_ComS == NULL )
      if(this.IsDUDealS() == 1)
        m_ComS = 0.0;
      else
        m_ComS = m_RS.CommSale * (this.Qnty()/m_RS.SaleAmount);
      end;
    end;
    return m_ComS;
  END;

  MACRO ComB():MONEY //Š®¬¨áá¨ï, ã¯« ç¥­­ ï ¯à¨ ¯à¨®¡à¥â¥­¨¨  
     if( m_ComB == NULL )
       if(this.IsDUDealS() == 1)
         m_ComB = 0.0;
       else
         m_ComB = m_RS.CommBuy*Qnty()/m_RS.BuyAmount;
       end;
     end;
     return m_ComB;
  END;

  /* à ¬¥âà Val_Market_New ¤«ï á¤¥«®ª <CodeB>*/
  MACRO Val_MarketB()
    if(this.IsDUDealS() == 1) return 0;
    end;
    return SQL_ConvTypeStr(m_RS.BuyVal_Market);
  END;


  MACRO PrSNom():DOUBLE
     if( m_PrSNom == NULL )
       if( m_RS.SBofficeKind == DL_RETIREMENT )
          m_PrSNom = 100;
       else
          m_PrSNom = this.DealSalePrice();
       end;
     end;

     return m_PrSNom;
  END;

  /* Šãàá ¯¥à¥áç¥â  áâ-â¨ ¯à¨®¡à¥â¥­¨ï ¢ àã¡«¥¢ë© íª¢¨¢ «¥­â */
  MACRO CrBD():DOUBLE
     if(m_CrBD == NULL)
        if( SubStr(this.K_ControlB(),1,1) == "9" )
           m_CrBD = ®«ãç¨âìŠãàá®áâ ­®¢ª¨  « ­á(DealBuy());
        else
           m_CrBD = 1.0;
        end;
     end;

     if( m_CrBD == NULL )
        m_CrBD = 0.0;
     end;

     return m_CrBD;
  END;

  MACRO NkdBprevRub():MONEY
     var RetVal;

     if( this.ifCoupPrev() == 1 )
        RetVal = this.NkdBvp();
     else
        RetVal = $0;
     end;

     return RetVal;
  END;

  MACRO ifCoup_( dat:date ):integer
     var RetVal = 0;
     var sql = RSDCommand(" SELECT Count(fiw.t_DrawingDate) Nrec " +
                          "   FROM dfiwarnts_dbt fiw " +
                          "  WHERE fiw.t_FIID         =  ? AND " +
                          "        fiw.t_IsPartial   != 'X' AND " +
                          "        fiw.t_DrawingDate  > ? AND " +
                          "        fiw.t_DrawingDate <= ? "
                         );
     sql.addParam( "", RSDBP_IN, m_RS.FIID );
     sql.addParam( "", RSDBP_IN, iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()) );
     sql.addParam( "", RSDBP_IN, dat );
     sql.execute();

     var vRS = TRsbDataSet( sql );

     if( vRS.MoveNext() and (vRS.Nrec > 0) )
        RetVal = 1;
     end;

     return RetVal;
  END;

  /*Žâ¬¥âª  ® ­ «¨ç¨¨ ¢ë¯« â Š„ ®â í¬¨â¥­â  ¤® ­ ç «  ­ «®£®¢®£® ¯¥à¨®¤  (1 - ¤ , 0 - ­¥â)*/
  MACRO ifCoupPrev():integer
     if( m_ifCoupPrev == null )
        m_ifCoupPrev = ifCoup_(this.H0_7()-1);
     end;

     return m_ifCoupPrev;
  END;

  /*Š„, ã¯« ç¥­­ë© ¯à¨ ¯à¨®¡à¥â¥­¨¨, ã¬¥­ìè îé¨© ¯à®æ¥­â­ë¥ ¤®å®¤ë â¥ªãé¥£® ­ «®£®¢®£® ¯¥à¨®¤ , àã¡*/
  MACRO NkdBrepRub():MONEY
     var RetVal;

     if( this.ifCoupPrev() == 0 )
        RetVal = this.NkdBvp();
     else
        RetVal = $0;
     end;

     return RetVal;
  END;

  MACRO NkdBsellRub():MONEY
     return $0;/*<NkdBsellRub> = 0*/
  END;

  /*…á«¨ <DDS> < <H0.7>, â® <NkdPrevEndRub> = (Š„ ­  ¤ âã <H0.7>-1 ¯® ª®«¨ç¥áâ¢ã <Qnty>), ¨­ ç¥ ­¥ § ¯®«­ï¥âáï.*/
  MACRO NkdPrevEndRub():MONEY
     if( m_NkdPrevEndRub == NULL )
        if( this.DDS() < this.H0_7() )
           m_NkdPrevEndRub = Š„( m_RS.FIID, this.Qnty(), this.H0_7()-1);
        end;
     end;
     return m_NkdPrevEndRub;
  END;

  /*…á«¨ <DDS> < <H0.7>, â® <CoupPrevRub> =<Qnty>* (‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë <DDS> +1
    ¨ ¯® ¤ âã (< H0.7>-1) ¢ª«îç¨â¥«ì­®), ¨­ ç¥ ­¥ § ¯®«­ï¥âáï.*/
  MACRO CoupPrevRub():MONEY
     if( m_CoupPrevRub == NULL )
        if( this.DDS() < this.H0_7() )
           m_CoupPrevRub = GetCouponSumByPeriod_Rub(m_RS.FIID, this.Qnty(), this.DDS()+1, this.H0_7()-1, m_RS.FaceValueFI);
        end;
     end;
     return m_CoupPrevRub;
  END;

  /*!”®à¬ã«  <ControlNomS> = <SumSvp>/ <Qnty>* 100/ <PrSNom> -  <Nom_DDS>*/
  MACRO ControlNomS()
     if(this.IsDUDealS() == 1) return F(0);
     end;
     return F(GetSumSvp()+"/"+GetQnty()+"*100/"+GetPrSNom()+"-"+GetNom_DDS());
  END;

  /*! ”®à¬ã«  <ControlNomB> = <SumBvp>/ <Qnty>*100/<PrBNom> -  <Nom_DDB>*/
  MACRO ControlNomB()
     if(this.IsDUDealS() == 1) return F(0);
     end;
     return F(GetSumBvp()+"/"+GetQnty()+"*100/"+FormulaIF()+"("+FormulaISNUMBER()+"("+GetPrBNom()+");"+GetPrBNom()+";1)"+"-"+GetNom_DDB());
  END;

  /*! ”®à¬ã«  <Taxe_All> = <Taxe_Amort> + <Taxe_NKD>*/
  MACRO Taxe_All()
     return F(GetTaxe_Amort()+"+"+GetTaxe_NKD());
  END;

  /*! ”®à¬ã«  <Taxe_Amort> = <SumAllRub> + <DifS> - <RashAll>*/
  MACRO Taxe_Amort()
     return F(GetSumAllRub()+"+"+GetDifS()+"-"+GetRashAll());
  END;

  /*!”®à¬ã«  <NkdAllRub> = <NkdAllRub_%> +  <NkdAllRub_IN>*/
  MACRO NkdAllRub()
     return F(GetNkdAllRub_()+"+"+GetNkdAllRub_IN());
  END;

  /*!”®à¬ã«  <NkdPrevRub> = <NkdPrevRub_%> +  <NkdPrevRub_IN>*/
  MACRO NkdPrevRub()
     return F(GetNkdPrevRub_()+"+"+GetNkdPrevRub_IN());
  END;

  MACRO StatusSec():STRING
     return m_RS.LinkType;
  END;

  /*<NkdRepEndRub> = (Š„ ­  ¤ âã <H0.8> ¯® ª®«¨ç¥áâ¢ã <Qnty>).
    „«ï 491 -  § ¯®«­ï¥âáï ¯à¨ ãá«®¢¨¨ <TypeB> = B*/
  MACRO NkdRepEndRub():MONEY
     return Š„( m_RS.FIID, this.Qnty(), this.H0_8() );
  END;

  MACRO DqualB():DATE
     if(m_DqualB == NULL)
        m_DqualB = readNoteForObject(OBJTYPE_SECDEAL, UniID(this.DealBuy(), OBJTYPE_SECDEAL), NOTEKIND_SECDEAL_REQUALREPO, date(31,12,9999)); // ­¥ ¨áâ®à¨ç­®¥ ¯à¨¬¥ç ­¨¥
        if((ValType(m_DqualB) != V_UNDEF) and (m_DqualB != ""))
           m_DqualB = date(m_DqualB);
        end;
     end;
     return m_DqualB;
  END;

  MACRO DqualS():DATE
     if(m_DqualS == NULL)
        m_DqualS = readNoteForObject(OBJTYPE_SECDEAL, UniID(this.DealSale(), OBJTYPE_SECDEAL), NOTEKIND_SECDEAL_REQUALREPO, date(31,12,9999)); // ­¥ ¨áâ®à¨ç­®¥ ¯à¨¬¥ç ­¨¥
        if((ValType(m_DqualS) != V_UNDEF) and (m_DqualS != ""))
           m_DqualS = date(m_DqualS);
        end;
     end;
     return m_DqualS;
  END;

  /*‘¤¥«ª  …Ž/§ ©¬ , ¯® ª®â®à®© ®âªàëâ  ª®à®âª ï ¯®§¨æ¨ï-®¬¥à*/
  MACRO CodeOR():STRING
     return m_RS.CodeOR;
  END;

  /*‘¤¥«ª  …Ž/§ ©¬ , ¯® ª®â®à®© ®âªàëâ  ª®à®âª ï ¯®§¨æ¨ï-’¨¯*/
  MACRO TypeOR():STRING
     var RetVal:string = "";
     if( m_RS.TypeOR == TXLOTS_BUY )
        RetVal = "B";
     elif( m_RS.TypeOR == TXLOTS_SALE )
        RetVal = "S";
     elif( m_RS.TypeOR == TXLOTS_REPO )
        RetVal = "";
     elif( m_RS.TypeOR == TXLOTS_BACKREPO )
        RetVal = "Ž";
     elif( m_RS.TypeOR == TXLOTS_LOANPUT )
        RetVal = "‡";
     elif( m_RS.TypeOR == TXLOTS_LOANGET )
        RetVal = "‡Ž";
     end;
     return RetVal;
  END;

  initTX_RegistrReport( Form, TemplateName, UseCSV, IsWebService, ReportHashCode, UsePOI, true, FocreFormatRep );
  SetRowFlushCount(1000);
END;

PRIVATE CLASS (TX_IndNomBondReg_Report) TX_IndNomBondReg_Report_292_692( Form:DL_CPanel, TemplateName:STRING, UseCSV:BOOL, IsWebService:BOOL, ReportHashCode:INTEGER, UsePOI:BOOL, FocreFormatRep:INTEGER, RepKind:integer )

  PRIVATE VAR m_RunByQuoted = false, m_RunByNoQuoted = false, m_RunByTech = false, m_RunByFISS = false;
  PRIVATE VAR m_IsPrintByQuoted = false;
  PRIVATE VAR m_IsPrintByNoQuoted = false;
  PRIVATE VAR m_IsPrintByTech = false;
  PRIVATE VAR m_IsPrintByFISS = false;

  MACRO Fill_Cell_Name()

     if( m_ReportKind == INDNOM_REG_0292 )

        C_SecCode       = "B";
        C_SecCode_2     = "C";
        C_Fin_Res       = "BZ";
        C_DifB          = "U";
        C_DifS          = "L";
        C_ComS          = "W";
        C_ComB          = "X";
        C_Taxe_All      = "BW";
        C_Taxe_Amort    = "BX";
        C_Taxe_NKD      = "BY";
        C_Qnty          = "G";
        C_SumAllRub     = "J";
        C_RashAll       = "Y";
        C_SumSvp        = "AK";
        C_SumBvp        = "AX";
        C_NkdSvp        = "I";
        C_NkdBvp        = "T";
        C_CoupRub       = "BO";
        C_NkdPrevRub_   = "BM";
        C_NkdPrevRub_IN = "BN";
        C_NKDminusRub   = "K";
        C_NkdRepRub     = "M";

        C_SumSrub       = "H";
        C_Nom_DDS       = "Z";
        C_Nom_Sec       = "BS";
        C_NkdRepRub_    = "N";
        C_NkdRepRub_IN  = "O";
        C_NkdBrepRub    = "BJ";
        C_Nom_DDB       = "AA";
        C_CrBD          = "AW";
        C_MaxMrkt       = "AZ";
        C_MrktB         = "BB";
        C_ContB_Dep     = "AG";
        C_SumBrub       = "S";
        C_SumBtax       = "V";
        C_PrSNom        = "AL";
        C_PrBNom        = "AY";
        C_MinMrkt       = "AM";
        C_MrktS         = "AO";
        C_ContS_Dep     = "AF";
        C_SellType      = "AH";
        C_CrSD          = "AJ";

        C_SecType       = "BV";

     else

        C_SecCode       = "B";
        C_SecCode_2     = "C";
        C_Fin_Res       = "BZ";
        C_DifB          = "Q";
        C_DifS          = "K";
        C_ComS          = "S";
        C_ComB          = "T";
        C_Taxe_All      = "BW";
        C_Taxe_Amort    = "BX";
        C_Taxe_NKD      = "BY";
        C_SumAllRub     = "J";
        C_RashAll       = "U";
        C_SumSvp        = "AR";
        C_SumBvp        = "BE";
        C_NkdSvp        = "I";
        C_CoupRub       = "AF";
        C_NkdPrevRub_   = "AC";

        C_SumSrub       = "H";
        C_Nom_Sec       = "BS";
        C_NkdRepRub_    = "W";
        C_NkdRepRub_IN  = "X";
        C_CrBD          = "BD";
        C_MaxMrkt       = "BG";
        C_MrktB         = "BI";
        C_ContB_Dep     = "AO";
        C_SumBrub       = "O";
        C_SumBtax       = "R";
        C_PrSNom        = "AS";
        C_PrBNom        = "BF";
        C_MinMrkt       = "AT";
        C_MrktS         = "AV";
        C_ContS_Dep     = "AN";
        C_CrSD          = "AQ";

        C_Qnty          = "G";
        C_NkdBvp        = "P";
        C_Nom_DDB       = "AI";
        C_Nom_DDS       = "AH";

        C_NkdAllRub_    = "Z";
        C_NkdPrevRub_   = "AC";
        C_NkdAllRub_IN  = "AA";
        C_NkdPrevRub_IN = "AD";
        C_CoupPrevRub   = "AG";

        C_SecType       = "BV";
        C_NkdRepRub     = "V";

     end;

  END;

  MACRO GetCCons()
     var CCons = "";

     if( m_RunByQuoted )
        CCons = "P";
     elif( m_RunByNoQuoted )
        CCons = "N";
     elif( m_RunByFISS )
        CCons = "F";
     elif( m_RunByTech )
        CCons = "T";
     end;

     return CCons;
  END;

  MACRO GetSubKindReg()
     var Quoted = "";

     if( m_RunByQuoted == true )
        Quoted = "Ž¡à é îé¨¥áï ­  ¨à¦¥";
     elif( m_RunByTech == true )
        Quoted = "’¥å­¨ç¥áª¨¥ á¤¥«ª¨ à¥ «¨§ æ¨¨";
     elif( m_RunByNoQuoted == true )
        Quoted = "¥ ®¡à é îé¨¥áï ­  ¨à¦¥";
     elif( m_RunByFISS == true )
        Quoted = "‘¤¥«ª¨ ”ˆ";
     end;

     return Quoted;
  END;

   macro GetCodeNU_0292_J():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "1-070000-ˆ€-07-1/40";
     elif( m_RunByNoQuoted == true )
        Quoted = "1-070000-ˆ€-07-1/41";
     end;
     return Quoted;
   end;

   macro GetCodeNU_0292_M():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "2-010302-ˆ€-07-4/8";
     elif( m_RunByNoQuoted == true )
        Quoted = "2-010302-ˆ€-07-4/9";
     end;
     return Quoted;
   end;

   macro GetCodeNU_0292_Y():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "4-070000-ˆ€-07-7/40";
     elif( m_RunByNoQuoted == true )
        Quoted = "4-070000-ˆ€-07-7/41";
     end;
     return Quoted;
   end;

   macro GetCodeNU_0692_J():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "1-070000-ˆ€-07-1/42";
     elif( m_RunByNoQuoted == true )
        Quoted = "1-070000-ˆ€-07-1/43";
     end;
     return Quoted;
   end;

   macro GetCodeNU_0692_U():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "4-070000-ˆ€-07-7/42";
     elif( m_RunByNoQuoted == true )
        Quoted = "4-070000-ˆ€-07-7/43";
     end;
     return Quoted;
   end;

   macro GetCodeNU_0692_V():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "2-010302-ˆ€-07-4/11";
     elif( m_RunByNoQuoted == true )
        Quoted = "2-010302-ˆ€-07-4/12";
     end;
     return Quoted;
   end;


   macro GetAnRegistrCode_0692():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "€-07-0692-Ž¡à-Žˆ";
     elif( m_RunByNoQuoted == true )
        Quoted = "€-07-0692-­¥Ž¡à-Žˆ";
     end;
     return Quoted;
   end;

   macro GetAnRegistr_0692():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "€­ «¨â¨ç¥áª¨© à¥£¨áâà ü €-07-0692-Ž¡à-Žˆ";
     elif( m_RunByNoQuoted == true )
        Quoted = "€­ «¨â¨ç¥áª¨© à¥£¨áâà ü €-07-0692-­¥Ž¡à-Žˆ";
     end;
     return Quoted;
   end;

   macro GetAnRegistrTxt_0692():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "„®å®¤ë (à áå®¤ë) ¯® ®¯¥à æ¨ï¬, á¢ï§ ­­ë¬ á ®âªàëâ¨¥¬ (§ ªàëâ¨¥¬) ª®à®âª¨å ¯®§¨æ¨© ¯® ªã¯®­­ë¬ ®¡«¨£ æ¨ï¬ á ¨­¤¥ªá¨àã¥¬ë¬ ­®¬¨­ «®¬, ¢ àã¡«ïå (®¡à é îé¨¥áï ­  Ž–)";
     elif( m_RunByNoQuoted == true )
        Quoted = "„®å®¤ë (à áå®¤ë) ¯® ®¯¥à æ¨ï¬, á¢ï§ ­­ë¬ á ®âªàëâ¨¥¬ (§ ªàëâ¨¥¬) ª®à®âª¨å ¯®§¨æ¨© ¯® ªã¯®­­ë¬ ®¡«¨£ æ¨ï¬ á ¨­¤¥ªá¨àã¥¬ë¬ ­®¬¨­ «®¬, ¢ àã¡«ïå (­¥ ®¡à é îé¨¥áï ­  Ž–)";
     end;
     return Quoted;
   end;

   macro GetAnRegistrCode_0292():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "€-07-0292-Ž¡à-Žˆ";
     elif( m_RunByNoQuoted == true )
        Quoted = "€-07-0292-­¥Ž¡à-Žˆ";
     end;
     return Quoted;
   end;

   macro GetAnRegistr_0292():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "€­ «¨â¨ç¥áª¨© à¥£¨áâà ü €-07-0292-Ž¡à-Žˆ";
     elif( m_RunByNoQuoted == true )
        Quoted = "€­ «¨â¨ç¥áª¨© à¥£¨áâà ü €-07-0292-­¥Ž¡à-Žˆ";
     end;
     return Quoted;
   end;

   macro GetAnRegistrTxt_0292():string
     var Quoted = "";
     if( m_RunByQuoted == true )
        Quoted = "¥ «¨§ æ¨ï (¯®£ è¥­¨¥) ªã¯®­­ëå ®¡«¨£ æ¨© á ¨­¤¥ªá¨àã¥¬ë¬ ­®¬¨­ «®¬, ¢ àã¡«ïå (®¡à é îé¨¥áï ­  Ž–)";
     elif( m_RunByNoQuoted == true )
        Quoted = "¥ «¨§ æ¨ï (¯®£ è¥­¨¥) ªã¯®­­ëå ®¡«¨£ æ¨© á ¨­¤¥ªá¨àã¥¬ë¬ ­®¬¨­ «®¬, ¢ àã¡«ïå (­¥ ®¡à é îé¨¥áï ­  Ž–)";
     end;
     return Quoted;
   end;

  MACRO PrintHeader( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )
     PrintFormatString( "",
                       FldPref+"„ â ‘®áâ ¢«¥­¨ï", string(Date())+" "+string(Time()),
                       FldPref+"®¬¥àŽ¯¥à ",      string({oper}),
                       FldPref+"Ž¯¥à æ¨®­¨áâ",    GetOperRecByID({oper}).Name,
                       FldPref+"H0_A:l",          this.H0_A(),
                       FldPref+"H0_B_INN",        this.H0_B_INN(),
                       FldPref+"H0_B_KPP",        this.H0_B_KPP(),
                       FldPref+"H0_3",            H03,
                       FldPref+"H0_7",            this.H0_7(),
                       FldPref+"H0_8",            this.H0_8(),
                       FldPref+"H0_9",            this.H0_9_Name(),
                       FldPref+"H0_11",           this.H0_11(),
                       FldPref+"H0_13",           GetSubKindReg()
                     );
  END;

  MACRO PrintHeader_rshb_supl_0692( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )

      PrintFormatString( "",
                        FldPref+"H0_AnRegistrCode",   GetAnRegistrCode_0692(),
                        FldPref+"H0_AnRegistr",       GetAnRegistr_0692(),
                        FldPref+"H0_AnRegistrTxt",    GetAnRegistrTxt_0692(),
                        FldPref+"H0_CodeNU_J6",       GetCodeNU_0692_J(),
                        FldPref+"H0_CodeNU_U6",       GetCodeNU_0692_U(),
                        FldPref+"H0_CodeNU_V6",       GetCodeNU_0692_V()
                        );
  END;

  MACRO PrintHeader_rshb_supl_0292( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )

      PrintFormatString( "",
                        FldPref+"H0_AnRegistrCode",   GetAnRegistrCode_0292(),
                        FldPref+"H0_AnRegistr",       GetAnRegistr_0292(),
                        FldPref+"H0_AnRegistrTxt",    GetAnRegistrTxt_0292(),
                        FldPref+"H0_CodeNU_J6",       GetCodeNU_0292_J(),
                        FldPref+"H0_CodeNU_M6",       GetCodeNU_0292_M(),
                        FldPref+"H0_CodeNU_Y6",       GetCodeNU_0292_Y()
                        );
  END;


  MACRO PrintHeader_rshb( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )

      PrintHeader_rshb( FldPref, H03, ReportCode, ReportName );

      if(m_ReportKind == INDNOM_REG_0692)
         PrintHeader_rshb_supl_0692( FldPref, H03, ReportCode, ReportName );
      elif(m_ReportKind == INDNOM_REG_0292)
         PrintHeader_rshb_supl_0292( FldPref, H03, ReportCode, ReportName );
      end;
  END;

  MACRO PrintHeader_cons( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )

      PrintHeader_cons( FldPref, H03, ReportCode, ReportName );

      PrintFormatString( "",
                        FldPref+"H0_13",           GetSubKindReg()
                        );
  END;


  PRIVATE MACRO BeginReport( NumCopy:INTEGER )

     if((WebFormData.InORCB) and (m_IsPrintByQuoted == false))
       m_IsPrintByQuoted = true;

       m_RunByQuoted = true;
       m_RunByNoQuoted = false;
       m_RunByTech   = false;
       m_RunByFISS   = false;
     elif((WebFormData.NotORCB) and (m_IsPrintByNoQuoted == false))
       m_IsPrintByNoQuoted = true;

       m_RunByQuoted = false;
       m_RunByNoQuoted = true;
       m_RunByTech   = false;
       m_RunByFISS   = false;
     elif((WebFormData.Detail) and (m_IsPrintByTech == false))
       m_IsPrintByTech = true;

       m_RunByQuoted = false;
       m_RunByNoQuoted = false;
       m_RunByTech   = true;
       m_RunByFISS   = false;
     elif( (WebFormData.DealsFISS) and (m_IsPrintByFISS == false) )
       m_IsPrintByFISS = true;

       m_RunByQuoted = false;
       m_RunByNoQuoted = false;
       m_RunByTech   = false;
       m_RunByFISS   = true;
     end;

     m_H07 = WebFormData.BeginDate;
     m_H08 = WebFormData.EndDate;
  END;

  MACRO GetSaleIsTechDealWhere()
     return " SaleLotData.t_TechDeal > 0 ";
  END;

  MACRO GetSaleIsFISSDealWhere()
     return  " SaleLotData.t_FISSDeal > 0 ";
  END;

  MACRO GetAddWhereForDeal()

     VAR AddWhere = "";
     VAR SaleIsTechDealWhere = "";
     VAR SaleIsFISSDealWhere = "";

     //“ á¤¥«ª¨ ª â¥£®à¨ï "Ÿ¢«ï¥âáï â¥å­¨ç¥áª®© á¤¥«ª®©" ¨¬¥¥â §­ ç¥­¨¥ 2 - ’¥å­¨ç¥áª ï á¤¥«ª  (ƒŽ)
     SaleIsTechDealWhere = GetSaleIsTechDealWhere();

     SaleIsFISSDealWhere = GetSaleIsFISSDealWhere();

     if( m_RunByQuoted == true )
        if( m_ReportKind == INDNOM_REG_0292 )
           AddWhere = AddWhere + " AND SaleLotData.t_ifMarket = 'X' AND NOT (" + SaleIsTechDealWhere + ")"+ " AND NOT (" + SaleIsFISSDealWhere + ")";
        else
           AddWhere = AddWhere + " AND SaleLotData.t_ifMarket = 'X' AND NOT (" + SaleIsFISSDealWhere + ")";
        end;
     end;
     if ( m_RunByTech == true )
        AddWhere = AddWhere + " AND (" + SaleIsTechDealWhere + ")";
     end;
     if ( m_RunByNoQuoted == true )
        if( m_ReportKind == INDNOM_REG_0292 )
           AddWhere = AddWhere + " AND SaleLotData.t_ifMarket != 'X' AND NOT (" + SaleIsTechDealWhere + ")"+ " AND NOT (" + SaleIsFISSDealWhere + ")";
        else
           AddWhere = AddWhere + " AND (SaleLotData.t_ifMarket != 'X' or " + SaleIsFISSDealWhere+ ")";
        end;
     end;

     if ( m_RunByFISS == true )
        /*®â¡¨à îâáï ¢á¥ á¤¥«ª¨, £¤¥ ­  á¤¥«ª¥ ¯à®¤ ¦¨ ãáâ ­®¢«¥­ ª« áá¨ä¨ª â®à "‚¨¤ ”ˆ‘‘".*/
        AddWhere = AddWhere + " AND " + SaleIsFISSDealWhere;
     end;

     return AddWhere;

  END;

  /*‡­ ç¥­¨¥ ¯®«ï <Š®¤> ª â¥£®à¨¨ á¤¥«ª¨ <‚¨¤ ”ˆ‘‘> (äìîç¥àá, ä®à¢ à¤, ®¯æ¨®­) ¯® á¤¥«ª¥ <CodeS>*/
  MACRO RFISSS()
     return SQL_ConvTypeStr(m_RS.RFISSS);
  END;

  /*‡­ ç¥­¨¥ ¯®«ï <Š®¤> ª â¥£®à¨¨ á¤¥«ª¨ <‚¨¤ ”ˆ‘‘> (äìîç¥àá, ä®à¢ à¤, ®¯æ¨®­) ¯® á¤¥«ª¥ <CodeB>*/
  MACRO RFISSB()
     return SQL_ConvTypeStr(m_RS.RFISSB);
  END;

  /*‡­ ç¥­¨¥ ¯à¨¬¥ç ­¨ï "„ â  ¢ ãç¥â¥" á¤¥«ª¨ <CodeS>*/
  MACRO DRS()
    if( SQL_ConvTypeDATE(m_RS.DRS) != Date(0,0,0) )
       return SQL_ConvTypeDATE(m_RS.DRS);
    end;
  END;
 
 /*‡­ ç¥­¨¥ ¯à¨¬¥ç ­¨ï "„ â  ¢ ãç¥â¥" á¤¥«ª¨ <CodeB>*/
  MACRO DRB()
    if( SQL_ConvTypeDATE(m_RS.DRB) != Date(0,0,0) )
       return SQL_ConvTypeDATE(m_RS.DRB);
    end;
  END;

  /*‡­ ç¥­¨¥ ¯®«ï <Š®¤> ª â¥£®à¨¨ <‘¤¥«ª  ¯®¤«¥¦¨â ¤®¯®«­¨â¥«ì­®¬ã ª®­âà®«î> ¯® á¤¥«ª¥ <CodeS>*/
  MACRO K_ControlS():string
    if( m_K_ControlS == null )
       m_K_ControlS = SQL_ConvTypeStr(m_RS.K_ControlS);
    end;
    return m_K_ControlS;
  END;

  /*‡­ ç¥­¨¥ ¯®«ï <Š®¤> ª â¥£®à¨¨ <‘¤¥«ª  ¯®¤«¥¦¨â ¤®¯®«­¨â¥«ì­®¬ã ª®­âà®«î> ¯® á¤¥«ª¥ <CodeB>*/
  MACRO K_ControlB():string
    if( m_K_ControlB == null )
       m_K_ControlB = SQL_ConvTypeStr(m_RS.K_ControlB);
    end;
    return m_K_ControlB;
  END;

  /*‡­ ç¥­¨¥ ¯®«ï <Š®¤> ª â¥£®à¨¨ á¤¥«ª¨ <‘¯®á®¡ ®¯à¥¤¥«¥­¨ï –>*/
  MACRO RCB():string
    return SQL_ConvTypeStr(m_RS.RCB);
  END;

  /*‡­ ç¥­¨¥ ¯®«ï <Š®¤> ª â¥£®à¨¨ á¤¥«ª¨ <‘¯®á®¡ ®¯à¥¤¥«¥­¨ï –>*/
  MACRO RCS():string
    return SQL_ConvTypeStr(m_RS.RCS);
  END;

  /*‡­ ç¥­¨¥ ¯®«ï <à¨¬¥ç ­¨¥> ¤«ï ¢¨¤  ¯à¨¬¥ç ­¨ï á¤¥«ª¨ <Š®¬¬¥­â -à¨© ¤«ï ª â¥£®à¨¨ <‘¤¥«ª  ¯®¤«¥¦¨â ¤®¯®«­¨â¥«ì­®¬ã ª®­âà®«î>>*/
  MACRO Control_CommentB():string
    return SQL_ConvTypeStr(m_RS.Control_CommentB);
  END;

  /*‡­ ç¥­¨¥ ¯®«ï <à¨¬¥ç ­¨¥> ¤«ï ¢¨¤  ¯à¨¬¥ç ­¨ï á¤¥«ª¨ <Š®¬¬¥­â -à¨© ¤«ï ª â¥£®à¨¨ <‘¤¥«ª  ¯®¤«¥¦¨â ¤®¯®«­¨â¥«ì­®¬ã ª®­âà®«î>>*/
  MACRO Control_CommentS():string
    return SQL_ConvTypeStr(m_RS.Control_CommentS);
  END;

  MACRO DqualB():DATE
    if( SQL_ConvTypeDATE(m_RS.DqualB) != Date(0,0,0) )
       return SQL_ConvTypeDATE(m_RS.DqualB);
    end;
  END;                                                                                    

  MACRO DqualS():DATE
    if( SQL_ConvTypeDATE(m_RS.DqualS) != Date(0,0,0) )
       return SQL_ConvTypeDATE(m_RS.DqualS);
    end;
  END;

  /*‡­ ç¥­¨¥ ¯®«ï <à¨¬¥ç ­¨¥> ¤«ï ¢¨¤  ¯à¨¬¥ç ­¨ï á¤¥«ª¨ <Š®¬¬¥­â à¨© ¤«ï ª â¥£®à¨¨ <‘¯®á®¡ ®¯à¥¤¥«¥­¨ï –>*/
  MACRO RC_CommentS():string
     return SQL_ConvTypeStr(m_RS.RC_CommentS);
  END;

  /*‡­ ç¥­¨¥ ¯®«ï <à¨¬¥ç ­¨¥> ¤«ï ¢¨¤  ¯à¨¬¥ç ­¨ï á¤¥«ª¨ <Š®¬¬¥­â à¨© ¤«ï ª â¥£®à¨¨ <‘¯®á®¡ ®¯à¥¤¥«¥­¨ï –>*/
  MACRO RC_CommentB():string
     return SQL_ConvTypeStr(m_RS.RC_CommentB);
  END;

  MACRO DepS():string 
    if(m_ContS_Dep == NULL)
      m_ContS_Dep = iif(SQL_ConvTypeInteger(m_RS.ContS_Dep)>0,"¤ ","­¥â");
    end;
    return m_ContS_Dep;
  END;

  MACRO DepB():string 
    if(m_ContB_Dep == NULL)
      m_ContB_Dep = iif(SQL_ConvTypeInteger(m_RS.ContB_Dep)>0,"¤ ","­¥â");
    end;
    return m_ContB_Dep;
  END;

  PRIVATE MACRO LoadDataInTMP(FI)
    var query = "";
    var header = "Žâ¡®à ¤ ­­ëå ¯® "+GetSQLString(FI.AvrCode)+" ("+m_FI_CurNRec+" ¨§ "+m_FI_NRecs+") ¤«ï à¥£¨áâà  "+ˆ¬ïŽá­®¢­®£®‹¨áâ ()+" ("+GetSubKindReg()+")";

    SQL_Truncate( "DREALIZREG_TMP" );

    query = 
      " DECLARE \n"
    + " PartyID NUMBER; \n"
    + " TYPE realiz_t IS TABLE OF DREALIZREG_TMP%ROWTYPE; \n"
    + "    g_realiz_ins realiz_t := realiz_t(); \n"
    + "    realiz DREALIZREG_TMP%rowtype; \n"
    + " BEGIN \n"
    + " FOR one_rec IN (SELECT DISTINCT TXLotSale.t_ID LotSaleID, "
    + "                        TXLotSale.t_SALEDATE AS SaleDate, "
    + "                        DealSale.t_BofficeKind, DealSale.t_DealID,  DealSale.t_PartyID, DealSale.t_MarketID, DealSale.t_DealType, DealSale.t_DealDate  "
    + "           FROM DSCTXLNK_DBT TXLink, DSCTXLOT_DBT TXLotSale, DDL_TICK_DBT DealSale ";

    if( m_reportkind == INDNOM_REG_0692 )
       query = query + ", DSCTXLOT_DBT TXCurLotSale, DSCTXLOT_DBT TXLotBuy ";
    end;

    query = query + " \n"
    + "          WHERE ";

    if( m_reportkind == INDNOM_REG_0292 )
       query = query
             + "       TXLink.t_Type = " + TXLNK_DELIVER
             + "   AND TXLink.t_FIID = "+SQL_ConvTypeInteger(FI.FIID)+" \n"
             + "   AND ( (TXLink.t_Date BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate(m_H08) 
             + "           AND (TXLink.T_BEGDATE IS NULL OR TXLink.T_BEGDATE = " + GetSQLDate( DATE(0,0,0) ) + ")"
             + "         ) "
             + "         OR (TXLink.T_BEGDATE BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate( m_H08 )+")"
             + "       ) "
             + "   AND TXLotSale.t_ID = TXLink.t_SaleID "
             + "   AND DealSale.t_DealID = CASE TXLotSale.t_VirtualType WHEN 1 THEN TXLotSale.t_DealID ELSE (select t_DealID from dsctxlot_dbt  where t_ID = TXLotSale.t_RealID) END ";
    else
       query = query
             + "       TXLink.t_Type in (" + TXLNK_CLSREPO + ", " + TXLNK_CLSLOAN +") AND "
             + "       TXLink.t_FIID = "+SQL_ConvTypeInteger(FI.FIID)+" AND \n"
             + "       ( ( ( TXLink.t_Date BETWEEN " + GetSQLDate( this.H0_7() ) + " AND " + GetSQLDate( this.H0_8() ) + " ) AND "
             + "           ( TXLink.T_BEGDATE IS NULL OR "
             + "             TXLink.T_BEGDATE = " + GetSQLDate( DATE(0,0,0) )
             + "           ) "
             + "         ) OR "
             + "         ( TXLink.T_BEGDATE BETWEEN " + GetSQLDate( this.H0_7() ) + " AND " + GetSQLDate( this.H0_8() )
             + "         ) "
             + "       ) AND "
             + "       ( TXLink.T_ENDDATE = to_date('01.01.0001', 'DD.MM.YYYY') OR TXLink.T_ENDDATE >= " + GetSQLDate( this.H0_8() )
             + "       ) AND "
             + "       TXCurLotSale.t_ID = TXLink.t_SaleID AND "
             + "       TXLotSale.t_ID = TXCurLotSale.t_BegLotID AND "
             + "       DealSale.t_DealID = CASE TXLotSale.t_VirtualType WHEN 1 THEN TXLotSale.t_DealID ELSE (select t_DealID from dsctxlot_dbt  where t_ID = TXLotSale.t_RealID) END AND " 
             + "       (SELECT COUNT(1) \n"
             + "          FROM dobjatcor_dbt objatcor \n"
             + "         WHERE objatcor.t_ObjectType = 101 \n"
             + "           AND objatcor.t_GroupID = 24 \n" 
             + "           AND objatcor.t_AttrID = 2 \n" 
             + "           AND objatcor.t_Object = LPAD( DealSale.t_DealID, 34, '0' )) = 0 AND "
             + "       TXLotBuy.t_ID = TXLink.t_BuyID AND "
             + "       TXLotBuy.t_VirtualType = " + TXVDEAL_REAL;
    end;

    query = query
    + "                ) \n"
    + "      LOOP \n"
    + "        realiz.t_LotID          := one_rec.LotSaleID; \n"
    + "        realiz.t_ifMarket       := Rsb_SCTX.ifMarket_NEW(realiz.t_LotID); \n"
    + "        realiz.t_MarketPrice    := Rsb_SCTX.GetMarketPrice_New(realiz.t_LotID); \n"
    + "        realiz.t_Val_Market     := Rsb_SCTX.GetVal_Market_New(realiz.t_LotID); \n"
    + "        realiz.t_DateMarket     := Rsb_SCTX.GetDateMarket_New(realiz.t_LotID); \n"
    + "        realiz.t_Market         := Rsb_SCTX.GetMarket_New(realiz.t_LotID); \n"
    + "        realiz.t_QuoteValue     := Rsb_SCTX.GetQuoteValue_New(realiz.t_LotID); \n"
    + "        realiz.t_ComSum         := Rsb_SCTX.TXGetComissionsSum(one_rec.t_DealID, one_rec.t_BOfficeKind, one_rec.SALEDATE, 0); \n"
    + "        if( (one_rec.t_PartyID = -1) and rsb_secur.IsExchange(rsb_secur.get_OperationGroup(rsb_secur.get_OperSysTypes(one_rec.t_DealType,one_rec.t_BofficeKind)))=1 ) then \n"
    + "           PartyID := one_rec.t_MarketID; \n"
    + "        else \n"
    + "           PartyID := one_rec.t_PartyID; \n"
    + "        end if; \n"
    + "        begin  \n"
    + "            Select case when count(1) > 0 then 1 else 0 end into realiz.t_PARTYDEPCAT \n"
    + "              From dobjatcor_dbt AtCor, dobjattr_dbt Attr \n" 
    + "             Where AtCor.t_ObjectType = 3 \n"
    + "               And AtCor.t_GroupID    = "+ŽŒ…_Š€’…ƒŽˆˆ_Ÿ‚‹_‚‡€ˆŒŽ‡€‚ˆ‘_‹ˆ–ŽŒ+" \n"
    + "               And AtCor.t_Object     = LPAD(PartyID, 10, '0' ) \n"
    + "               And Attr.t_AttrID      = AtCor.t_AttrID \n" 
    + "               And Attr.t_ObjectType  = AtCor.t_ObjectType \n"
    + "               And Attr.t_GroupID     = AtCor.t_GroupID \n"
    + "               and ATCOR.T_VALIDFROMDATE <= one_rec.t_DealDate \n"
    + "               and ATCOR.T_VALIDTODATE >= one_rec.t_DealDate  \n"
    + "               and ATTR.T_NUMINLIST = '1'; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_PARTYDEPCAT := 0; \n"
    + "        end; \n"
    + "        begin \n"
    + "             SELECT t_name into realiz.t_PARTYName\n"
    + "               FROM dparty_dbt \n"
    + "              WHERE t_PartyID = PartyID; \n"
    + "        EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_PARTYName := chr(1); \n"
    + "        end; \n";


    if( m_reportkind == INDNOM_REG_0292 )
       query = query
       + "        begin \n"
       + "             SELECT COUNT(1) into realiz.t_TechDeal\n"
       + "               FROM dobjatcor_dbt objatcor \n"
       + "              WHERE objatcor.t_ObjectType = 101 \n"
       + "                AND objatcor.t_GroupID = 24 \n" 
       + "                AND objatcor.t_AttrID = 2 \n" 
       + "                AND objatcor.t_Object = LPAD( one_rec.t_DealID, 34, '0' ); \n"
       + "        EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_TechDeal := 0; \n"
       + "        end; \n";
    else
       query = query
       + "        realiz.t_TechDeal := 0; \n";
    end;

    query = query
    + "        begin  \n"
    + "            Select to_number(ATTR.T_NUMINLIST), ATTR.T_NAME into realiz.t_FISSDeal, realiz.t_FISSDealName \n"
    + "              From dobjatcor_dbt AtCor, dobjattr_dbt Attr \n" 
    + "             Where AtCor.t_ObjectType = 101 \n"
    + "               And AtCor.t_GroupID    = "+OBJGROUP_TICKFIIS+" \n"
    + "               And AtCor.t_Object     = LPAD(one_rec.t_DealID, 34, '0' ) \n"
    + "               And Attr.t_AttrID      = AtCor.t_AttrID \n" 
    + "               And Attr.t_ObjectType  = AtCor.t_ObjectType \n"
    + "               And Attr.t_GroupID     = AtCor.t_GroupID; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_FISSDeal := 0; \n"
    + "                                              realiz.t_FISSDealName := chr(1); \n"
    + "        end; \n"
    + "        begin \n"
    + "            select rsb_struct.getdate(t_Text)  into realiz.t_DR \n"
    + "              from dnotetext_dbt \n"
    + "             where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "               and t_ObjectType = 101 \n"
    + "               and t_NoteKind = "+NOTEKIND_SECDEAL_DATEIN+"; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_DR := TO_DATE ('01.01.0001','DD.MM.YYYY'); \n"
    + "        end; \n"   
    + "        begin \n"                
    + "            Select ATTR.T_NUMINLIST into realiz.t_ControlCat \n"
    + "              From dobjatcor_dbt AtCor, dobjattr_dbt Attr \n" 
    + "             Where AtCor.t_ObjectType = 101 \n"
    + "               And AtCor.t_GroupID    = "+OBJGROUP_TICKCONTROL+" \n"
    + "               And AtCor.t_Object     = LPAD(one_rec.t_DealID, 34, '0' ) \n"
    + "               And Attr.t_AttrID      = AtCor.t_AttrID  \n"
    + "               And Attr.t_ObjectType  = AtCor.t_ObjectType \n"
    + "               And Attr.t_GroupID     = AtCor.t_GroupID ; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_ControlCat := chr(1); \n"
    + "        end; \n"
    + "        begin \n"
    + "            Select ATTR.T_NUMINLIST into realiz.t_RC \n"
    + "                         From dobjatcor_dbt AtCor, dobjattr_dbt Attr \n" 
    + "                        Where AtCor.t_ObjectType = 101 \n"
    + "                          And AtCor.t_GroupID    = "+OBJGROUP_TICKRC+" \n"
    + "                          And AtCor.t_Object     = LPAD(one_rec.t_DealID, 34, '0' ) \n"
    + "                          And Attr.t_AttrID      = AtCor.t_AttrID  \n"
    + "                          And Attr.t_ObjectType  = AtCor.t_ObjectType \n"
    + "                          And Attr.t_GroupID     = AtCor.t_GroupID; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_RC := chr(1); \n"
    + "        end; \n"
    + "        begin \n"
    + "          select rsb_struct.getString(t_Text)  into realiz.t_ControlNote \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101 \n"
    + "             and t_NoteKind = "+NOTEKIND_SECDEAL_CONTROLCOMMENT+"; \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_ControlNote := chr(1); \n"
    + "        end; \n"
    + "        begin \n"
    + "          select rsb_struct.getdate(t_Text) into realiz.t_Dqual \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101  \n"
    + "             and t_NoteKind = "+NOTEKIND_SECDEAL_REQUALREPO+"; \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_Dqual := TO_DATE ('01.01.0001','DD.MM.YYYY'); \n"
    + "        end; \n"
    + "        begin  \n"
    + "          select rsb_struct.getMoney(t_Text) into realiz.t_PriceDifNote \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101 \n"
    + "             and t_NoteKind = 27; \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_PriceDifNote := 0; \n"
    + "        end; \n"
    + "        begin \n"
    + "          select count(1) into realiz.t_IsPriceDifNote \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101 \n"
    + "             and t_NoteKind = 27;  \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_IsPriceDifNote := 0; \n"
    + "        end; \n"
    + "        begin  \n"
    + "          select rsb_struct.getString(t_Text) into realiz.t_RCNote \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101 \n"
    + "             and t_NoteKind = 29; \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_RCNote := chr(1); \n"
    + "        end; \n"
    + "        g_realiz_ins.extend; \n"
    + "        g_realiz_ins(g_realiz_ins.LAST) := realiz; \n"
    + "      END LOOP; \n"    
    + "      FOR one_rec IN (SELECT DISTINCT TXLotBuy.t_ID LotBuyID, TXLotBuy.t_BuyDATE, DealBuy.t_BOfficeKind, DealBuy.t_DealID, DealBuy.t_PartyID, DealBuy.t_MarketID, DealBuy.t_DealType, DealBuy.t_DealDate \n"
    + "           FROM DSCTXLNK_DBT TXLink, DSCTXLOT_DBT TXLotBuy, DDL_TICK_DBT DealBuy ";

    if( m_reportkind == INDNOM_REG_0692 )
       query = query + ", DSCTXLOT_DBT TXCurLotSale, DSCTXLOT_DBT TXLotSale, DDL_TICK_DBT DealSale ";
    end;

    query = query 
             + " WHERE ";

    if( m_reportkind == INDNOM_REG_0292 )
       query = query
            + "        TXLink.t_Type = " + TXLNK_DELIVER
            + "    AND TXLink.t_FIID = "+SQL_ConvTypeInteger(FI.FIID)+" \n"
            + "        AND ( (TXLink.t_Date BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate(m_H08) 
            + "               AND (TXLink.T_BEGDATE IS NULL OR TXLink.T_BEGDATE = " + GetSQLDate( DATE(0,0,0) ) +")\n"
            + "              ) \n"
            + "             OR (TXLink.T_BEGDATE BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate( m_H08 )+")\n"
            + "            ) \n"
            + "        AND TXLotBuy.t_ID = TXLink.t_BuyID \n"
            + "        and DealBuy.t_DealID = TXLotBuy.t_DealID ";
    else
       query = query
            + "        TXLink.t_Type in (" + TXLNK_CLSREPO + ", " + TXLNK_CLSLOAN +") AND "
            + "        TXLink.t_FIID = "+SQL_ConvTypeInteger(FI.FIID)+" AND \n"
            + "        ( ( ( TXLink.t_Date BETWEEN " + GetSQLDate( this.H0_7() ) + " AND " + GetSQLDate( this.H0_8() ) + " ) AND "
            + "            ( TXLink.T_BEGDATE IS NULL OR "
            + "              TXLink.T_BEGDATE = " + GetSQLDate( DATE(0,0,0) )
            + "            ) "
            + "          ) OR "
            + "          ( TXLink.T_BEGDATE BETWEEN " + GetSQLDate( this.H0_7() ) + " AND " + GetSQLDate( this.H0_8() )
            + "          ) "
            + "        ) AND "
            + "        ( TXLink.T_ENDDATE = to_date('01.01.0001', 'DD.MM.YYYY') OR TXLink.T_ENDDATE >= " + GetSQLDate( this.H0_8() )
            + "        ) AND "
            + "        TXCurLotSale.t_ID = TXLink.t_SaleID AND "
            + "        TXLotSale.t_ID = TXCurLotSale.t_BegLotID AND "
            + "        DealSale.t_DealID = CASE TXLotSale.t_VirtualType WHEN 1 THEN TXLotSale.t_DealID ELSE (select t_DealID from dsctxlot_dbt  where t_ID = TXLotSale.t_RealID) END AND " 
            + "        (SELECT COUNT(1) \n"
            + "           FROM dobjatcor_dbt objatcor \n"
            + "          WHERE objatcor.t_ObjectType = 101 \n"
            + "            AND objatcor.t_GroupID = 24 \n" 
            + "            AND objatcor.t_AttrID = 2 \n" 
            + "            AND objatcor.t_Object = LPAD( DealSale.t_DealID, 34, '0' )) = 0 AND "
            + "        TXLotBuy.t_ID = TXLink.t_BuyID AND "
            + "        TXLotBuy.t_VirtualType = " + TXVDEAL_REAL
            + "        and DealBuy.t_DealID = TXLotBuy.t_DealID ";
    end;

    query = query
    + "                     ) \n"
    + "      LOOP \n"
    + "        realiz.t_LotID          := one_rec.LotBuyID; \n"
    + "        realiz.t_ifMarket       := CHR(0); \n"
    + "        realiz.t_MarketPrice    := Rsb_SCTX.GetMarketPrice_New(realiz.t_LotID); \n"
    + "        realiz.t_Val_Market     := Rsb_SCTX.GetVal_Market_New(realiz.t_LotID); \n"
    + "        realiz.t_DateMarket     := Rsb_SCTX.GetDateMarket_New(realiz.t_LotID); \n"
    + "        realiz.t_Market         := Rsb_SCTX.GetMarket_New(realiz.t_LotID); \n"
    + "        realiz.t_QuoteValue     := Rsb_SCTX.GetQuoteValue_New(realiz.t_LotID); \n"
    + "        realiz.t_ComSum         := Rsb_SCTX.TXGetComissionsSum(one_rec.t_DealID, one_rec.t_BOfficeKind, one_rec.t_BuyDATE, 0); \n"
    + "        if( (one_rec.t_PartyID = -1) and rsb_secur.IsExchange(rsb_secur.get_OperationGroup(rsb_secur.get_OperSysTypes(one_rec.t_DealType,one_rec.t_BofficeKind)))=1 ) then \n"
    + "           PartyID := one_rec.t_MarketID; \n"
    + "        else \n"
    + "           PartyID := one_rec.t_PartyID; \n"
    + "        end if; \n"
    + "        begin  \n"
    + "            Select case when count(1) > 0 then 1 else 0 end into realiz.t_PARTYDEPCAT \n"
    + "              From dobjatcor_dbt AtCor, dobjattr_dbt Attr \n" 
    + "             Where AtCor.t_ObjectType = 3 \n"
    + "               And AtCor.t_GroupID    = "+ŽŒ…_Š€’…ƒŽˆˆ_Ÿ‚‹_‚‡€ˆŒŽ‡€‚ˆ‘_‹ˆ–ŽŒ+" \n"
    + "               And AtCor.t_Object     = LPAD(PartyID, 10, '0' ) \n"
    + "               And Attr.t_AttrID      = AtCor.t_AttrID \n" 
    + "               And Attr.t_ObjectType  = AtCor.t_ObjectType \n"
    + "               And Attr.t_GroupID     = AtCor.t_GroupID \n"
    + "               and ATCOR.T_VALIDFROMDATE <= one_rec.t_DealDate \n"
    + "               and ATCOR.T_VALIDTODATE >= one_rec.t_DealDate  \n"
    + "               and ATTR.T_NUMINLIST = '1'; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_PARTYDEPCAT := 0; \n"
    + "        end; \n"
    + "        begin \n"
    + "             SELECT t_name into realiz.t_PARTYName\n"
    + "               FROM dparty_dbt \n"
    + "              WHERE t_PartyID = PartyID; \n"
    + "        EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_PARTYName := chr(1); \n"
    + "        end; \n"
    + "        begin \n"
    + "             SELECT COUNT(1) into realiz.t_TechDeal\n"
    + "               FROM dobjatcor_dbt objatcor \n"
    + "              WHERE objatcor.t_ObjectType = 101 \n"
    + "                AND objatcor.t_GroupID = 24 \n" 
    + "                AND objatcor.t_AttrID = 2 \n" 
    + "                AND objatcor.t_Object = LPAD( one_rec.t_DealID, 34, '0' ); \n"
    + "        EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_TechDeal := 0; \n"
    + "        end; \n"
    + "        begin  \n"
    + "            Select to_number(ATTR.T_NUMINLIST), ATTR.T_NAME into realiz.t_FISSDeal, realiz.t_FISSDealName \n"
    + "              From dobjatcor_dbt AtCor, dobjattr_dbt Attr \n" 
    + "             Where AtCor.t_ObjectType = 101 \n"
    + "               And AtCor.t_GroupID    = "+OBJGROUP_TICKFIIS+" \n"
    + "               And AtCor.t_Object     = LPAD(one_rec.t_DealID, 34, '0' ) \n"
    + "               And Attr.t_AttrID      = AtCor.t_AttrID \n" 
    + "               And Attr.t_ObjectType  = AtCor.t_ObjectType \n"
    + "               And Attr.t_GroupID     = AtCor.t_GroupID; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_FISSDeal := 0; \n"
    + "                                              realiz.t_FISSDealName := chr(1); \n"
    + "        end; \n"
    + "        begin \n"
    + "            select rsb_struct.getdate(t_Text)  into realiz.t_DR \n"
    + "              from dnotetext_dbt \n"
    + "             where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "               and t_ObjectType = 101 \n"
    + "               and t_NoteKind = "+NOTEKIND_SECDEAL_DATEIN+"; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_DR := TO_DATE ('01.01.0001','DD.MM.YYYY'); \n"
    + "        end; \n"   
    + "        begin \n"                
    + "            Select ATTR.T_NUMINLIST into realiz.t_ControlCat \n"
    + "              From dobjatcor_dbt AtCor, dobjattr_dbt Attr \n" 
    + "             Where AtCor.t_ObjectType = 101 \n"
    + "               And AtCor.t_GroupID    = "+OBJGROUP_TICKCONTROL+" \n"
    + "               And AtCor.t_Object     = LPAD(one_rec.t_DealID, 34, '0' ) \n"
    + "               And Attr.t_AttrID      = AtCor.t_AttrID  \n"
    + "               And Attr.t_ObjectType  = AtCor.t_ObjectType \n"
    + "               And Attr.t_GroupID     = AtCor.t_GroupID ; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_ControlCat := chr(1); \n"
    + "        end; \n"
    + "        begin \n"
    + "            Select ATTR.T_NUMINLIST into realiz.t_RC \n"
    + "                         From dobjatcor_dbt AtCor, dobjattr_dbt Attr \n" 
    + "                        Where AtCor.t_ObjectType = 101 \n"
    + "                          And AtCor.t_GroupID    = "+OBJGROUP_TICKRC+" \n"
    + "                          And AtCor.t_Object     = LPAD(one_rec.t_DealID, 34, '0' ) \n"
    + "                          And Attr.t_AttrID      = AtCor.t_AttrID  \n"
    + "                          And Attr.t_ObjectType  = AtCor.t_ObjectType \n"
    + "                          And Attr.t_GroupID     = AtCor.t_GroupID; \n"
    + "            EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_RC := chr(1); \n"
    + "        end; \n"
    + "        begin \n"
    + "          select rsb_struct.getString(t_Text)  into realiz.t_ControlNote \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101 \n"
    + "             and t_NoteKind = "+NOTEKIND_SECDEAL_CONTROLCOMMENT+"; \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_ControlNote := chr(1); \n"
    + "        end; \n"
    + "        begin \n"
    + "          select rsb_struct.getdate(t_Text) into realiz.t_Dqual \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101  \n"
    + "             and t_NoteKind = "+NOTEKIND_SECDEAL_REQUALREPO+"; \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_Dqual := TO_DATE ('01.01.0001','DD.MM.YYYY'); \n"
    + "        end; \n"
    + "        begin  \n"
    + "          select rsb_struct.getMoney(t_Text) into realiz.t_PriceDifNote \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101 \n"
    + "             and t_NoteKind = 27; \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_PriceDifNote := 0; \n"
    + "        end; \n"
    + "        begin \n"
    + "          select count(1) into realiz.t_IsPriceDifNote \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101 \n"
    + "             and t_NoteKind = 27;  \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_IsPriceDifNote := 0; \n"
    + "        end; \n"
    + "        begin  \n"
    + "          select rsb_struct.getString(t_Text) into realiz.t_RCNote \n"
    + "            from dnotetext_dbt \n"
    + "           where t_DocumentID = LPAD( one_rec.t_DealID, 34, '0' ) \n"
    + "             and t_ObjectType = 101 \n"
    + "             and t_NoteKind = 29; \n"
    + "          EXCEPTION WHEN NO_DATA_FOUND THEN realiz.t_RCNote := chr(1); \n"
    + "        end; \n"
    + "        g_realiz_ins.extend; \n"
    + "        g_realiz_ins(g_realiz_ins.LAST) := realiz; \n"
    + "      END LOOP; \n"      
    + "      IF g_realiz_ins IS NOT EMPTY THEN \n"
    + "          FORALL i IN g_realiz_ins.FIRST .. g_realiz_ins.LAST \n"
    + "               INSERT INTO DREALIZREG_TMP \n"
    + "                    VALUES g_realiz_ins(i); \n"
    + "          g_realiz_ins.delete; \n"
    + "      END IF; \n" 
    + " END; \n";

    m_ProgressIndicator.Start(1, header, header);
    m_ProgressIndicator.Update(0,1,header); // ¢á¥£® 3 ¯ à ¬¥à  Update(index, count, text)

    SQL_Execute(query, "®¤£®â®¢ª  ¤ ­­ëå", false);
    m_ProgressIndicator.Stop();

  END;

  PRIVATE MACRO ExecuteReportByAddWhere( ObjReport:OBJECT, FI )

     VAR DataQuery;
     VAR strSelect;
     VAR strSelect0;
     VAR strOrder;
     VAR NRecs = 0, CurNRecs = 0, header = "";

     LoadDataInTMP(FI);

     strSelect0 = " SELECT TXLink.t_Date ";

     strSelect = " SELECT TXLink.t_Date, TXLink.t_Amount," +

                 "        SaleLotData.t_PARTYName as PartyNameSale, " +
                 "        BuyLotData.t_PARTYName as PartyNameBuy, " +

                 "        SaleLotData.t_ComSum as CommSale, " +
                 "        BuyLotData.t_ComSum as CommBuy, " +

                 "        TXLink.t_FIID, "+GetSQLString(FI.AvrCode)+" AvrCode, "+GetSQLString(FI.AvrName)+" AvrName, CAST("+SQL_ConvTypeInteger(FI.FaceValueFI)+" AS NUMBER(10)) t_FaceValueFI, " +
                 "        CAST("+SQL_ConvTypeInteger(FI.TaxGroup)+" AS NUMBER(10)) TaxGroup, " +FI.FaceValue+ " FaceValue, "+
                          GetSQLDate(FI.DrawingDate)+" t_DrawingDate, "+GetSQLString(FI.Issued)+" t_Issued, "+GetSQLString(FI.ISIN)+" t_ISIN, "+
                 "        TXLotSale.t_DealID AS DealSaleID, TXLotSale.t_DEALDATE AS DealSaleDate, "+
                 "        TXLotSale.t_SALEDATE AS SaleDate, "+
                 "        TXLotSale.t_DEALCODETS AS DealSaleCodeTS,TXLotSale.t_PriceFIID AS SalePriceFIID,LegS.t_Price AS SalePrice, LegS.t_Principal AS SaleAmount,"+
                 "        TXLotBuy.t_DealID  AS DealBuyID,  TXLotBuy.t_DEALDATE AS  DealBuyDate,  TXLotBuy.t_BuyDATE AS BuyDate, TXLotBuy.t_DEALCODETS  AS DealBuyCodeTS, TXLotBuy.t_PriceFIID AS BuyPriceFIID,LegB.t_Price AS BuyPrice, LegB.t_Principal AS BuyAmount,"+
                 "        DataSale.DealSaleGroup AS DealSaleGroup, DataBuy.DealBuyGroup AS DealBuyGroup,"+
                 "        SaleLotData.t_MarketPrice AS SaleMarketPrice, " +
                 "        SaleLotData.t_Val_Market AS SaleVal_Market, " +
                 "        SaleLotData.t_DateMarket AS SaleDateMarket, "+
                 "        SaleLotData.t_Market AS SaleMarket, "+
                 "        SaleLotData.t_QuoteValue AS SaleMarketQuoteValue, "+
                 "        BuyLotData.t_MarketPrice AS BuyMarketPrice, " +
                 "        BuyLotData.t_Val_Market AS BuyVal_Market, " +
                 "        BuyLotData.t_DateMarket AS BuyDateMarket, "+
                 "        BuyLotData.t_Market AS BuyMarket, "+
                 "        BuyLotData.t_QuoteValue AS BuyMarketQuoteValue, "+

                 "        LegS.t_NKD as NKDSale, LegS.t_Price as DealSalePrice, LegS.t_Cost as SDealCost, LegS.t_CFI as VprS, LegS.t_RelativePrice as SaleRelativePrice, "+
                 "        LegB.t_NKD as NKDBuy, LegB.t_Price as DealBuyPrice, LegB.t_Cost as BDealCost, LegB.t_CFI as VprB, LegB.t_RelativePrice as BuyRelativePrice, "+

                 "        SaleLotData.t_TechDeal AS TechDealSale, " +
                 "        BuyLotData.t_TechDeal AS TechDealBuy, " +

                 "        DealSale.t_BOfficeKind AS SBOfficeKind, " +
                 "        DealBuy.t_BOfficeKind  AS BBOfficeKind, " +

                 "        SaleLotData.t_FISSDealName as RFISSS, " +
                 "        BuyLotData.t_FISSDealName as RFISSB, " +

                 "        SaleLotData.t_DR as DRS, " +
                 "        BuyLotData.t_DR as DRB, " +

                 "        SaleLotData.t_ControlCat as K_ControlS, " +
                 "        BuyLotData.t_ControlCat as K_ControlB, " +

                 "        SaleLotData.t_RC as RCS, " +
                 "        BuyLotData.t_RC as RCB, " +

                 "        SaleLotData.t_ControlNote as Control_CommentS, " +
                 "        BuyLotData.t_ControlNote as Control_CommentB, " +

                 "        SaleLotData.t_Dqual as DqualS, " +
                 "        BuyLotData.t_Dqual as DqualB, " +

                 "        SaleLotData.t_PriceDifNote as PriceDifNoteS, " +
                 "        BuyLotData.t_PriceDifNote as PriceDifNoteB, " +

                 "        SaleLotData.t_IsPriceDifNote as IsPriceDifNoteS, " +
                 "        BuyLotData.t_IsPriceDifNote as IsPriceDifNoteB, " +

                 "        SaleLotData.t_RCNote RC_CommentS,  " +
                 "        BuyLotData.t_RCNote RC_CommentB,  " + 

                 "        SaleLotData.t_PARTYDEPCAT ContS_Dep,  " +
                 "        BuyLotData.t_PARTYDEPCAT ContB_Dep,  " +
                 "        CASE WHEN(DealSale.t_DealType = 32742) THEN 1 ELSE 0 end as IsDUDealS, " +
                 "        rsb_sctx.GetInAvrWrtStartDate(DealBuy.t_DealId) as ImportDUDate, " +
                 "        CASE WHEN((DealBuy.t_Ofbu = chr(88)) AND (RSB_SECUR.GetMainObjAttrNoDate(101, LPAD (DealBuy.t_DealId, 34, '0'), 117) <> 0)) THEN 1 ELSE 0 end as IsDUDealB ";

     DataQuery = "   FROM DREALIZREG_TMP BuyLotData, " +
                 "        DSCTXLOT_DBT  TXLotBuy," +
                 "        DDL_TICK_DBT  DealBuy," +
                 "        ( Select BuyOper.t_Kind_Operation, BuyOper.t_DocKind, " +
                 "                 rsb_secur.get_OperationGroup(BuyOper.t_SysTypes) as DealBuyGroup, " +
                 "                 (CASE WHEN " +
                 "                            ((Rsb_Secur.IsSale(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " +
                 "                          or (Rsb_Secur.IsAvrWrtOut(rsb_secur.get_OperationGroup(BuyOper.t_SysTypes))=1) " +
                 "                            ) " +
                 "                       THEN 2 " +
                 "                       ELSE 0 END " +
                 "                 ) as LegKindBuy " +
                 "            From " +
                 "                 doprkoper_dbt BuyOper " +
                 "           where BuyOper.t_dockind in(101,117,127,155) "+
                 "        ) DataBuy, " +

                 "        ddl_leg_dbt   LegB, " +
                 "        DSCTXLNK_DBT  TXLink,"+
                 "        DSCTXLOT_DBT  TXLotSale,";

     if( m_reportkind == INDNOM_REG_0692 )
        DataQuery = DataQuery +
                 "        DSCTXLOT_DBT  TXCurLotSale,";
     end;

     DataQuery = DataQuery +
                 "        DDL_TICK_DBT  DealSale," +
                 "        ( Select SaleOper.t_Kind_Operation, SaleOper.t_DocKind, " +
                 "                 rsb_secur.get_OperationGroup(SaleOper.t_SysTypes) as DealSaleGroup, " +
                 "                 (CASE WHEN " +
                 "                            ((Rsb_Secur.IsBuy(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                 "                          or (Rsb_Secur.IsAvrWrtIn(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                 "                            ) " +
                 "                       THEN 2 " +
                 "                       ELSE 0 END " +
                 "                 ) as LegKindSale " +
                 "            From " +
                 "                 doprkoper_dbt SaleOper " +
                 "           where SaleOper.t_dockind in(101,117,127,155) "+
                 "        ) DataSale, " +

                 "        ddl_leg_dbt   LegS, " +
                 "        DREALIZREG_TMP SaleLotData " +
                 "  WHERE ";
 
     if( m_reportkind == INDNOM_REG_0292 )
        DataQuery = DataQuery + 
                 " TXLink.t_Type = " + TXLNK_DELIVER;
     else
        DataQuery = DataQuery + 
                 " TXLink.t_Type in (" + TXLNK_CLSREPO + ", " + TXLNK_CLSLOAN +") ";
     end;

     DataQuery = DataQuery + 
                 "    AND TXLink.t_FIID = "+SQL_ConvTypeInteger(FI.FIID)+ " AND " +
                 "        ( ( TXLink.t_Date BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate(m_H08) + " AND " +
                 "            ( TXLink.T_BEGDATE IS NULL  OR " +
                 "              TXLink.T_BEGDATE = " + GetSQLDate( DATE(0,0,0) ) +
                 "            ) " +
                 "          ) OR " +
                 "          ( TXLink.T_BEGDATE BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate( m_H08 ) +
                 "          ) " +
                 "        ) AND ";

     if( m_reportkind == INDNOM_REG_0292 )
        DataQuery = DataQuery + 
                 "        TXLotSale.t_ID = TXLink.t_SaleID AND ";
     else
        DataQuery = DataQuery + 
                 "        ( TXLink.T_ENDDATE = to_date('01.01.0001', 'DD.MM.YYYY') OR TXLink.T_ENDDATE >= " + GetSQLDate( this.H0_8() ) + " ) AND " +
                 "        TXCurLotSale.t_ID = TXLink.t_SaleID AND " +
                 "        TXLotSale.t_ID = TXCurLotSale.t_BegLotID AND ";
     end;

     DataQuery = DataQuery +
                 "        TXLotBuy.t_ID  = TXLink.t_BuyID AND " +
                 "        SaleLotData.t_LotID = TXLotSale.t_ID AND " +
                 "        BuyLotData.t_LotID = TXLotBuy.t_ID " +
                          GetAddWhereForDeal() +
                 "        AND DealSale.t_DealID = CASE TXLotSale.t_VirtualType WHEN 1 THEN TXLotSale.t_DealID ELSE (select t_DealID from dsctxlot_dbt  where t_ID = TXLotSale.t_RealID) END AND" + //à¥ª®¬¥­¤ æ¨ï ë¦¨ª®¢ 
                 "        TXLotBuy.t_DealID  = DealBuy.t_DealID AND " +
                 "        DataSale.t_Kind_Operation = DealSale.t_DealType AND " +
                 "        DataBuy.t_Kind_Operation  = DealBuy.t_DealType AND " +
                 "        LegS.t_DealID             = TXLotSale.t_DealID AND " +
                 "        LegS.t_LegKind            = DataSale.LegKindSale AND " +
                 "        LegS.t_LegID              = 0 AND " +
                 "        LegB.t_DealID             = TXLotBuy.t_DealID AND " +
                 "        LegB.t_LegKind            = DataBuy.LegKindBuy AND " +
                 "        LegB.t_LegID              = 0 ";

     strOrder = "  order by TaxGroup, AvrCode, SaleDate, DealSaleDate, TXLotSale.t_DEALTIME, DealSaleCodeTS, BuyDate, DealBuyDate, TXLotBuy.t_DEALTIME, DealBuyCodeTS";

     header = "®¤áçñâ ª®«¨ç¥áâ¢  § ¯¨á¥© ¤«ï "+GetSQLString(FI.AvrCode)+" ("+m_FI_CurNRec+" ¨§ "+m_FI_NRecs+") ¤«ï à¥£¨áâà  "+ˆ¬ïŽá­®¢­®£®‹¨áâ ()+" ("+GetSubKindReg()+")";
     m_ProgressIndicator.Start(1, header, header);
     m_ProgressIndicator.Update(0,1,header); // ¢á¥£® 3 ¯ à ¬¥à  Update(index, count, text)
     NRecs = SQL_GetNRecs( strSelect0 + DataQuery );
     m_ProgressIndicator.Stop();

     if (NRecs > 0)
        SaveFIIDForForm_cons(SQL_ConvTypeInteger(FI.FIID));
        CurNRecs = 0;
        header = "”®à¬¨à®¢ ­¨¥ ®âçñâ  ¯® "+GetSQLString(FI.AvrCode)+" ("+m_FI_CurNRec+" ¨§ "+m_FI_NRecs+") ¤«ï à¥£¨áâà  "+ˆ¬ïŽá­®¢­®£®‹¨áâ ()+" ("+GetSubKindReg()+")";
        m_ProgressIndicator.Start(NRecs, header, header);
        m_RS = TRsbDataSet( strSelect + DataQuery + strOrder );
        while( m_RS.MoveNext() )
           ClearCacheOneRecord();
         //   if( m_IsExistsData == false )
         //      ObjReport.BeginReport();
         //   end;
           ObjReport.Print();
           m_IsExistsData = true;
           CurNRecs = CurNRecs + 1;
           m_ProgressIndicator.Update(CurNRecs,NRecs,header); // ¢á¥£® 3 ¯ à ¬¥à  Update(index, count, text)
        end;
        m_ProgressIndicator.Stop();
     end;

  END;

  MACRO ExecuteReport( ObjReport:OBJECT )

     VAR DataQuery;
     VAR cmd, FI;

     ExecuteReport();
     m_IsExistsData = false;

     DataQuery =   "  SELECT distinct FI.t_FI_Code AS AvrCode, "
                 + "         FI.t_Name AS AvrName,  "
                 + "         FI.t_DrawingDate, "
                 + "         FI.t_FIID, "
                 + "         FI.t_FaceValueFI  AS t_FaceValueFi, "
                 + "         FI.t_FaceValue, "
                 + "         FI.t_Issued, "
                 + "         av.t_TaxGroup TaxGroup, "
                 + "         (case when av.t_ISIN IS null OR av.t_ISIN IN (chr(0), chr(1)) then (case when av.t_LSIN IS null OR av.t_LSIN IN (chr(0), chr(1)) then chr(0) else av.t_LSIN end) else av.t_ISIN end) AS t_ISIN "
                 + "   FROM dfininstr_dbt FI, DAVOIRISS_DBT av "
                 + "  WHERE av.t_FIID = FI.t_FIID " + GetAddWhereForAvr()
                 + "    and exists( select TXLink.t_FIId from DSCTXLNK_DBT  TXLink "
                 + "                 where TXLink.t_Type ";

     if( m_reportkind == INDNOM_REG_0292 )
        DataQuery = DataQuery + " = " + TXLNK_DELIVER; 
     else
        DataQuery = DataQuery + " in (" + TXLNK_CLSREPO + ", " + TXLNK_CLSLOAN +") "; 
     end;

     DataQuery = DataQuery
                 + "          AND ( ( TXLink.t_Date BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate(m_H08) + " AND "
                 + "                 ( TXLink.T_BEGDATE IS NULL  OR "
                 + "                   TXLink.T_BEGDATE = " + GetSQLDate( DATE(0,0,0) )
                 + "                 ) "
                 + "                ) OR "
                 + "                ( TXLink.T_BEGDATE BETWEEN " + GetSQLDate( m_H07 ) + " AND " + GetSQLDate( m_H08 )
                 + "                ) "
                 + "              ) ";

     if( m_reportkind == INDNOM_REG_0692 )
        DataQuery = DataQuery + " AND ( TXLink.T_ENDDATE = to_date('01.01.0001', 'DD.MM.YYYY') OR TXLink.T_ENDDATE >= " + GetSQLDate( this.H0_8() ) +") ";
     end;

     DataQuery = DataQuery 
                + "               and TXLink.t_FIId = FI.t_FIID "
                + "              )"
                + "  order by TaxGroup, AvrCode";

     cmd = DL_RSDCommand( DataQuery );

     ObjReport.BeginReport();

     m_FI_NRecs = cmd.GetCount();
     if (m_FI_NRecs > 0)
        m_FI_CurNRec = 1;
        FI = cmd.execute();
        while( FI.MoveNext() )
           ExecuteReportByAddWhere(ObjReport,FI);
           m_FI_CurNRec = m_FI_CurNRec + 1;
        end;
     end;

     if( m_IsExistsData == true )
        ObjReport.EndReport();
        ReplaceFormulaAndCalculate();
     else
        m_IsExistsData = true;
        ObjReport.EndReport_NoData(); 
     end;
  END;

  MACRO CreateReport()

    Fill_Cell_Name();

    if( m_reportkind == INDNOM_REG_0292 )
       m_SHEET_1 = SHEET_0292;
       m_SHEET_2 = SHEET_0292s;

       ExecuteReport(CIndNomBond_292(this));
       PrintConsolidated( CIndNomBond_292_Cons(this) );
    else
       m_SHEET_1 = SHEET_0692;
       m_SHEET_2 = SHEET_0692s;

       ExecuteReport(CIndNomBond_692(this));
       PrintConsolidated( CIndNomBond_692_Cons(this) );
    end;

  END;

  /*! ”®à¬ã« 
  292 - <NkdRepRub_%> = <NkdSvp> + <CoupRub> - <NkdBrepRub> - <NkdPrevRub_%>
  692 - <NkdRepRub_%> = <NkdAllRub_%> - <NkdPrevRub_%>
  491 - <NkdRepRub_%> = <CoupRub> +  <NkdRepEndRub> - <NkdBrepRub> - <NkdPrevRub_%>
  791  - <NkdRepRub_%> = <NkdAllRub_%> - <NkdPrevRub_%>*/
  MACRO NkdRepRub_()
     if( m_reportkind == INDNOM_REG_0292 )
        return F(GetNkdSvp()+"+"+GetCoupRub()+"-"+GetNkdBrepRub()+"-"+GetNkdPrevRub_());
     end;
     return F(GetNkdAllRub_()+"-"+GetNkdPrevRub_());
  END;

  /*! ”®à¬ã« 
  292 - <NkdRepRub_IN> = (<Nom_DDS> - <Nom_DDB>) *<Qnty> - <NkdPrevRub_IN>
  692 - <NkdRepRub_IN> = <NkdAllRub_IN> -  <NkdPrevRub_IN>
  491 - <NkdRepRub_IN> = ( <Nom_ H08> -  <Nom_DDB>) *<Qnty> - <NkdPrevRub_IN>
  791 - <NkdRepRub_IN> = <NkdAllRub_IN> -  <NkdPrevRub_IN>*/
  MACRO NkdRepRub_IN()
     if( m_reportkind == INDNOM_REG_0292 )
        return F("("+GetNom_DDS()+"-"+GetNom_DDB()+")*"+GetQnty()+"-"+GetNkdPrevRub_IN());
     end;
     return F(GetNkdAllRub_IN()+"-"+GetNkdPrevRub_IN());
  END;

  /*292 - …á«¨ <DDB> < <H0.7> :
             …á«¨ Dª-1 > <DDB>, â® <NkdPrevRub_%> = Š„ ­  ¤ âã (<H0.7>-1) ¯® ª®«¨ç¥áâ¢ã <Qnty>)
             ˆ­ ç¥ <NkdPrevRub_%>=(Š„ ­  ¤ âã (<H0.7>-1) ¯® ª®«¨ç¥áâ¢ã <Qnty>) - <NkdBvp>
          ˆ­ ç¥ <NkdPrevRub_%> = 0
    692, 791 - …á«¨ <DDS> < <H0.7>, â® <NkdPrevRub_%> =  <NkdPrevEndRub> + <CoupPrevRub> - <NkdSvp>, ¨­ ç¥ <NkdPrevRub_%> =0
    491 - ¯®  «£®à¨â¬ã ¤«ï 292 ¯à¨ ãá«®¢¨¨ <TypeB> = B*/
  MACRO NkdPrevRub_():MONEY
     if( m_NkdPrevVN == NULL )
        if( m_reportkind == INDNOM_REG_0292 )
           if( iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()) < this.H0_7() )
              if(this.„ª()-1 > iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()))
                 m_NkdPrevVN = Š„( m_RS.FIID, this.Qnty(), this.H0_7()-1);
              else
                 m_NkdPrevVN = Š„( m_RS.FIID, this.Qnty(), this.H0_7()-1) - this.NkdBvp();
              end;
           else
              m_NkdPrevVN = $0;
           end;
        else
           if(this.DDS() < this.H0_7())
              m_NkdPrevVN = this.NkdPrevEndRub() + this.CoupPrevRub() - this.NkdSvp();
           else
              m_NkdPrevVN = $0;
           end;
        end;
     end;
     return m_NkdPrevVN;
  END;

  /*…á«¨ <DDS> < <H0.7>, â® <NkdPrevEndRub> = (Š„ ­  ¤ âã <H0.7>-1 ¯® ª®«¨ç¥áâ¢ã <Qnty>), ¨­ ç¥ ­¥ § ¯®«­ï¥âáï.*/
  MACRO NkdPrevEndRub():MONEY
     if( m_NkdPrevEndRub == NULL )
        if( this.DDS() < this.H0_7() )
           m_NkdPrevEndRub = Š„( m_RS.FIID, this.Qnty(), this.H0_7()-1);
        else
           m_NkdPrevEndRub = "";
        end;
     end;
     return m_NkdPrevEndRub;
  END;

  /*…á«¨ <DDS> < <H0.7>, â® <CoupPrevRub> =<Qnty>* (‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë <DDS> +1
    ¨ ¯® ¤ âã (< H0.7>-1) ¢ª«îç¨â¥«ì­®), ¨­ ç¥ ­¥ § ¯®«­ï¥âáï.*/
  MACRO CoupPrevRub():MONEY
     if( m_CoupPrevRub == NULL )
        if( this.DDS() < this.H0_7() )
           m_CoupPrevRub = GetCouponSumByPeriod_Rub(m_RS.FIID, this.Qnty(), this.DDS()+1, this.H0_7()-1, m_RS.FaceValueFI);
        else
           m_CoupPrevRub = "";
        end;
     end;
     return m_CoupPrevRub;
  END;

  /*292 - …á«¨ <DDB> < <H0.7>, â® <NkdPrevRub_IN> = (­®¬¨­ « ­  ¤ âã (<H0.7>-1) - <Nom_DDB>) * <Qnty> , ¨­ ç¥ <NkdPrevRub_IN> = 0
    692 - …á«¨ <DDS> < <H0.7>, â® <NkdPrevRub_IN> = (­®¬¨­ « ­  ¤ âã  (<H0.7>-1) - <Nom_DDS>)*<Qnty>, ¨­ ç¥ <NkdPrevRub_IN> =0
    491 - ¯®  «£®à¨â¬ã ¤«ï 292 ¯à¨ ãá«®¢¨¨ <TypeB> = B
    791 - …á«¨ <DDS> < <H0.7>, â® <NkdPrevRub_IN> = (<Nom_H07-1> - <Nom_DDS>)*<Qnty>, ¨­ ç¥ <NkdPrevRub_IN> =0 */
  MACRO NkdPrevRub_IN():MONEY
     if( m_NkdPrevRub_IN == NULL )
        if( m_reportkind == INDNOM_REG_0292 )
           if( iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()) < this.H0_7() )
              m_NkdPrevRub_IN = (this.Nom_H07_1()-this.NomB())*this.Qnty();
           else
              m_NkdPrevRub_IN = $0;
           end;
        else
           if(this.DDS() < this.H0_7())
              m_NkdPrevRub_IN = (this.Nom_H07_1()-this.NomS())*this.Qnty();
           else
              m_NkdPrevRub_IN = $0;
           end;
        end;
     end;
     return m_NkdPrevRub_IN;
  END;

  /*292 - <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „­ ¨ ¯® ¤ âã <DDS> ¢ª«îç¨â¥«ì­®, ªà®¬¥ ®á«¥¤­¥£® ªã¯®­ , .
    692-  <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „¯ ¨ ¯® ¤ âã <DDB> ¢ª«îç¨â¥«ì­®)
    791-  <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „¯ ¨ ¯® ¤ âã < H0.8> ¢ª«îç¨â¥«ì­®)
    491 - ‡ ¯®«­ï¥âáï ¯à¨ ãá«®¢¨¨ <TypeB> = B: <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „­ ¨ ¯® ¤ âã < H0.8> ¢ª«îç¨â¥«ì­®*/
  MACRO CoupRub():MONEY // Šã¯®­­ë© ¤®å®¤, ¯®«ãç¥­­ë© ®â í¬¨â¥­â  ¯à¨ ¯®£ è¥­¨¨ ªã¯®­®¢ ¢ ®âç¥â­®¬ (­ «®£®¢®¬) ¯¥à¨®¤¥ (ªà®¬¥ ªã¯®­ , ¯®«ãç¥­­®£® ¯à¨ ¯®£ è¥­¨¨ ¡ã¬ £¨) - áã¬¬ , àã¡
     if( m_reportkind == INDNOM_REG_0292 )
        return GetCouponSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.„­(), this.DDS(), null, null, this.GetDrawingDate() );
     end;
     return GetCouponSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.„¯(), iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()) );
  END;

  /*„ â  ¯®£ è¥­¨ï ¯®á«¥¤­¥£® ªã¯®­  ¢ ¯¥à¨®¤:
       292 - á ¤ âë „­  ¯® ¤ âã <DDS>, ªà®¬¥ ªã¯®­®¢, çìï ¤ â  ¯®£ è¥­¨ï=¤ â¥ ¯®£ è¥­¨ï ¢ë¯ãáª 
       692 - ¤ âë „¯  ¯® ¤ âã <DDB>
       491 - á ¤ âë „­  ¯® ¤ âã  < H0.8>
       791 - á ¤ âë „¯  ¯® ¤ âã < H0.8>
    „«ï ¢á¥å - ¥á«¨ ªã¯®­  ¢ ¯à®¢¥àï¥¬®¬ ¯¥à¨®¤¥ ­¥â, â® ¯®«¥ ­¥ § ¯®«­ï¥âáï.
    „«ï ¢á¥å - ¢ ¯à®¢¥àï¥¬ë© ¯¥à¨®¤ ¢ª«îç îâáï ®¡¥ ¤ âë.
    „«ï 491: ‡ ¯®«­ï¥âáï, â®«ìª® ¥á«¨ <TypeB>= <B>*/
  MACRO LastCoupDate():DATE
    var vLastCoupDate = null;
    if( m_reportkind == INDNOM_REG_0292 )
       vLastCoupDate = GetMaxCouponDrawingDateInPeriod(m_RS.FIID, this.„­(), this.DDS(), this.GetDrawingDate());
    else
       vLastCoupDate = GetMaxCouponDrawingDateInPeriod(m_RS.FIID, this.„¯(), iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()));
    end;
    if( vLastCoupDate != Date(0,0,0) )
       return vLastCoupDate;
    end;
  END;

  /*! ”®à¬ã« 
     292 - <Taxe_NKD> = <NkdRepRub> - <NKDminusRub>
     692, 791  - <Taxe_NKD> = <NkdRepRub> * (-1)
     491 - <Taxe_NKD> = <NkdRepRub>*/
  MACRO Taxe_NKD()
    if( m_reportkind == INDNOM_REG_0292 )
       return F(GetNkdRepRub()+"-"+GetNKDminusRub());
    end;
    return F(GetNkdRepRub()+"*(-1)");
  END;

  /*! ”®à¬ã« 
    292 - <Fin_Res> = <SumAllRub> - <NKDminusRub> + <NkdRepRub> - (<DifB> + <SumBtax>)
    692 - <Fin_Res> =  <SumAllRub> - (<DifB> + <SumBtax>) -  <NkdRepRub>
    491 - <Fin_Res>  = <NkdRepRub>
    791 - <Fin_Res> = <NkdRepRub> * (-1)*/
  MACRO Fin_Res()
    if( m_reportkind == INDNOM_REG_0292 )
       return F(GetSumAllRub()+"-"+GetNKDminusRub()+"+"+GetNkdRepRub()+"-("+GetDifB()+"+"+GetSumBtax()+")");
    end;
    return F(GetSumAllRub()+"-("+GetDifB()+"+"+GetSumBtax()+")"+"-"+GetNkdRepRub());
  END;

  /*!”®à¬ã« 
    692 - <NkdAllRub_%>= <NkdBvp>+ <CoupPrevRub>+ <CoupRub>- <NkdSvp>
    791 -<NkdAllRub_%>= <NkdRepEndRub> + <CoupPrevRub>+ <CoupRub>- <NkdSvp>*/
  MACRO NkdAllRub_()
     return F(GetNkdBvp()+"+"+GetCoupPrevRub()+"+"+GetCoupRub()+"-"+GetNkdSvp());
  END;

  /*!”®à¬ã« 
    692 - <NkdAllRub_IN> = (<Nom_DDB> - <Nom_DDS>) * <Qnty>
    791 - <NkdAllRub_IN> = (<Nom_H08> - <Nom_DDS>) * <Qnty>*/
  MACRO NkdAllRub_IN()
     return F("("+GetNom_DDB()+"-"+GetNom_DDS()+")*"+GetQnty());
  END;
  initTX_IndNomBondReg_Report( Form, TemplateName, UseCSV, IsWebService, ReportHashCode, UsePOI, FocreFormatRep );

  m_reportkind = RepKind;
END;

PRIVATE CLASS (TX_IndNomBondReg_Report) TX_IndNomBondReg_Report_491( Form:DL_CPanel, TemplateName:STRING, UseCSV:BOOL, IsWebService:BOOL, ReportHashCode:INTEGER, UsePOI:BOOL, FocreFormatRep:INTEGER )

  MACRO Fill_Cell_Name()

        C_SecCode       = "B";
        C_SecCode_2     = "C";
        C_Fin_Res       = "AO";
        C_Qnty          = "H";
        C_SumBvp        = "AA";
        C_NkdBvp        = "O";
        C_CoupRub       = "U";
        C_NkdPrevRub_   = "S";
        C_NkdPrevRub_IN = "T";
        C_NkdRepRub     = "I";

        C_NkdRepRub_    = "J";
        C_NkdRepRub_IN  = "K";
        C_NkdBrepRub    = "Q";
        C_Nom_DDB       = "M";
        C_CrBD          = "Z";
        C_SumBrub       = "AB";
        C_PrBNom        = "AC";

        C_NkdRepEndRub  = "V";
        C_Nom_H08       = "AG";

        C_Taxe_NKD      = "AN";
        C_SecType       = "AM";
        C_TypeB         = "F";
  END;

  MACRO GetCCons()
     return "P";
  END;

  MACRO PrintHeader( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )
     PrintFormatString( "",
                       FldPref+"„ â ‘®áâ ¢«¥­¨ï", string(Date())+" "+string(Time()),
                       FldPref+"®¬¥àŽ¯¥à ",      string({oper}),
                       FldPref+"Ž¯¥à æ¨®­¨áâ",    GetOperRecByID({oper}).Name,
                       FldPref+"H0_A:l",          this.H0_A(),
                       FldPref+"H0_B_INN",        this.H0_B_INN(),
                       FldPref+"H0_B_KPP",        this.H0_B_KPP(),
                       FldPref+"H0_3",            H03,
                       FldPref+"H0_7",            this.H0_7(),
                       FldPref+"H0_8",            this.H0_8(),
                       FldPref+"H0_9",            this.H0_9_Name(),
                       FldPref+"H0_11",           this.H0_11()
                     );
  END;

  PRIVATE MACRO BeginReport( NumCopy:INTEGER )
     m_H07 = WebFormData.BeginDate;
     m_H08 = WebFormData.EndDate;
  END;

  PRIVATE MACRO Get_str_PaymDateSale( Type:integer, DealPart:integer )
     var sql_PlanDate:String =
        " (NVL( (SELECT min(dlrq.t_PlanDate) " +
        "          FROM ddlrq_dbt dlrq " +
        "         WHERE dlrq.t_DocKind    = DealSale.t_BOfficeKind " +
        "           AND dlrq.t_DocID = DealSale.t_DealID " +
        "           AND dlrq.t_Type    = " + string(Type) +
        "           AND dlrq.t_DealPart    = " + string(DealPart) +
        "           AND dlrq.t_FactDate > TO_DATE('01-01-0001','DD-MM-YYYY') " +
        "       ), TO_DATE('01-01-0001','DD-MM-YYYY') ) " +
        " ) ";

     var sql_FactDate:String =
        " (NVL( (SELECT min(dlrq.t_FactDate) " +
        "          FROM ddlrq_dbt dlrq " +
        "         WHERE dlrq.t_DocKind    = DealSale.t_BOfficeKind " +
        "           AND dlrq.t_DocID = DealSale.t_DealID " +
        "           AND dlrq.t_Type    = " + string(Type) +
        "           AND dlrq.t_DealPart    = " + string(DealPart) +
        "           AND dlrq.t_State = " + string(DLRQ_STATE_EXEC) +
        "           AND dlrq.t_FactDate > TO_DATE('01-01-0001','DD-MM-YYYY') " +
        "       ), TO_DATE('01-01-0001','DD-MM-YYYY') ) " +
        " ) ";

     return
        " (DECODE( " +
             sql_FactDate + ", " +                   // ‚ëà ¦¥­¨¥
        "    TO_DATE('01-01-0001','DD-MM-YYYY'), " + // search1
             sql_PlanDate + ", " +                   // result1
             sql_FactDate + ") " +                   // default
        " ) ";
  END;

  MACRO ExecuteReport(ObjReport:OBJECT)

     VAR QueryRest, QueryLnk, Head1, Head2, Body1, Body2;
     VAR header = "", NRecs = 0, Current = 0;
     VAR WhereCond = GetAddWhereForAvr();

     ExecuteReport();

     QueryRest = " SELECT NVL(TXRest.T_SourceID,0) AS SourceID, NVL(sum(TXRest.T_AMOUNT),0) AS Amount, TXRest.t_FIID "+
                 "   FROM DSCTXREST_DBT TXRest " +
                 "  WHERE TXRest.T_AMOUNT > 0 AND " +
                 "        TXRest.t_BUYDATE <= " + GetSQLDate( this.H0_8() ) + " AND " +
                 "        TXRest.t_BUYDATE <> " + GetSQLDate( DATE(0,0,0) ) + " AND " +
                 "        ( TXRest.t_SALEDATE IS NULL  OR " +
                 "          TXRest.t_SALEDATE = " + GetSQLDate( DATE(0,0,0) ) + " OR " +
                 "          TXRest.t_SALEDATE > " + GetSQLDate( this.H0_8() ) +
                 "        ) " +
                 " GROUP BY TXRest.t_FIID, TXRest.T_SourceID";

     QueryLnk = " SELECT aLnk.* " +
                "   FROM ( SELECT cLnk.*, NVL(cLnk.t_Amount-cLnk.t_LnAmount, 0) AS t_LnkAmount " +
                "            FROM ( SELECT /*+LEADING(FI, lnk)*/ lnk.t_Amount, lnk.t_ID, lnk.t_BuyID, lnk.t_SaleID, lnk.t_Type, lnk.t_Date, " +
                "                          FI.*, currsalelot.t_BegLotID, " +
                "                          (SELECT nvl(SUM (ls.t_short),0) " +
                "                             FROM dsctxls_dbt ls, dsctxlnk_dbt lk " +
                "                            WHERE ls.t_parentid = lnk.t_ID " +
                "                                  AND lk.t_id = ls.t_childid " +
                "                                  AND lk.t_Date <= " + GetSQLDate(this.H0_8()) + ") t_LnAmount " +
                "                     FROM dsctxlnk_dbt lnk, " +
                "                          ( SELECT FI.t_FIID, " +
                "                                   FI.t_FaceValueFI AS FaceValueFI, " +
                "                                   FI.t_FI_Code AS AvrCode, " +
                "                                   FI.t_Name AS AvrName, " +
                "                                   FI.t_DrawingDate, " +
                "                                   FI.t_Definition, " +
                "                                   FI.t_Issued, " +
                "                                   (case when t_ISIN IS null OR t_ISIN IN (chr(0), chr(1)) then (case when t_LSIN IS null OR t_LSIN IN (chr(0), chr(1)) then chr(0) else t_LSIN end) else t_ISIN end) AS t_ISIN, " +
                "                                   av.t_TaxGroup AS TaxGroup " +
                "                              FROM dfininstr_dbt FI, davoiriss_dbt av " +
                "                             WHERE av.t_FIID = FI.t_FIID " + WhereCond +
                "                          ) FI, " +
                "                          dsctxlot_dbt currsalelot " +
                "                    WHERE lnk.t_Type in (" + string(TXLNK_DELREPO) + "," + string(TXLNK_SUBSTREPO) + "," + string(TXLNK_LOANPUT) + "," + string(TXLNK_SUBSTLOAN) + ") and " +
                "                          lnk.t_Date <= " + GetSQLDate( this.H0_8() ) + " and " +
                "                          (lnk.t_BegDate = to_date('01.01.0001', 'DD.MM.YYYY') or lnk.t_BegDate <= " + GetSQLDate( this.H0_8() ) + ") and " +
                "                          (lnk.t_EndDate = to_date('01.01.0001', 'DD.MM.YYYY') or lnk.t_EndDate > " + GetSQLDate( this.H0_8() ) + ") and " +
                "                          lnk.t_FIID = FI.t_FIID and " +
                "                          lnk.t_Amount > (SELECT nvl(SUM (ls.t_short),0) "
                "                                            FROM dsctxls_dbt ls, dsctxlnk_dbt lk "
                "                                           WHERE ls.t_parentid = lnk.t_ID "
                "                                             AND lk.t_id = ls.t_childid "
                "                                             AND lk.t_Date <= "  + GetSQLDate(this.H0_8()) + ") and "
                "                          currsalelot.t_ID = lnk.t_SaleID and " +
                "                          (    currsalelot.t_BuyDate = to_date('01.01.0001', 'DD.MM.YYYY') " +
                "                            or currsalelot.t_BuyDate > " + GetSQLDate( this.H0_8() ) +
                "                          ) " +
                "                 ) cLnk " +
                "        ) aLnk " +
                " WHERE aLnk.t_LnkAmount > 0 ";

     Head1 = " SELECT /*+LEADING(QueryRest)*/ FI.t_FIID, "+
             "        FI.t_FaceValueFI as FaceValueFI, "+
             "        FI.t_FI_Code as AvrCode, "+
             "        FI.t_Name as AvrName, "+
             "        FI.t_DrawingDate, "+
             "        FI.t_Definition, "+
             "        FI.t_Issued," +
             "        (case when t_ISIN IS null OR t_ISIN IN (chr(0), chr(1)) then (case when t_LSIN IS null OR t_LSIN IN (chr(0), chr(1)) then chr(0) else t_LSIN end) else t_ISIN end) AS t_ISIN, "+
             "        av.t_TaxGroup AS TaxGroup, "+
             "        QueryRest.Amount as t_Amount, "+
             "        TXBuyLot.t_RQID, " +
             "        TXBuyLot.t_BuyDate, " +
             "        TXBuyLot.t_Type AS LotBuyType, " +
             "        TXBuyLot.t_DealCodeTS AS DealBuyCodeTS, " +
             "        TXBuyLot.T_DEALID AS DealBuyID, "+
             "        TXBuyLot.T_DEALDATE AS DealBuyDate, " +
             "        TXBuyLot.t_DealTime AS BuyDealTime, "+
             "        DealBuy.t_BOfficeKind, "+
             "        '' as CodeDR, " +
             "        TO_DATE('01-01-0001','DD-MM-YYYY') as SaleDate, " +
             "        TO_DATE('01-01-0001','DD-MM-YYYY') as DLink, " +
             "        LegBuy.t_CFI as VprB, "+
             "        LegBuy.t_Cost as BDealCost, " +
             "        LegBuy.t_Principal AS BuyAmount, "+
             "        LegBuy.t_Price AS DealBuyPrice, "+
             "        LegBuy.t_NKD NKDBuy, "+
             "        LegBuy.t_LegKind as LegKindBuy, "+
             "        'Ž' as LinkType, "+
             "        TXBuyLot.t_Type as TypeB, " +
             "        DealBuy.t_BOfficeKind as BBOfficeKind, "+
                 Get_PartyName_Query( "DealBuy",  "PartyNameBuy" ) + /*PartyNameBuy*/
             "        , Rsb_SCTX.TXGetComissionsSum(DealBuy.t_DealID, DealBuy.t_BofficeKind, TXBuyLot.t_BuyDATE, 0) as CommBuy, " +
             "        0 as IsDUDealS, " +
             "        rsb_sctx.GetInAvrWrtStartDate(DealBuy.t_DealId) as ImportDUDate, " +
             "        CASE WHEN((DealBuy.t_Ofbu = chr(88)) AND (RSB_SECUR.GetMainObjAttrNoDate(101, LPAD (DealBuy.t_DealId, 34, '0'), 117) <> 0)) THEN 1 ELSE 0 end as IsDUDealB ";

     Head2 = " SELECT QueryLnk.t_FIID, " +
             "        QueryLnk.FaceValueFI, " +
             "        QueryLnk.AvrCode, " +
             "        QueryLnk.AvrName, " +
             "        QueryLnk.t_DrawingDate, " +
             "        QueryLnk.t_Definition, " +
             "        QueryLnk.t_Issued, " +
             "        QueryLnk.t_ISIN, " +
             "        QueryLnk.TaxGroup, " +
             "        QueryLnk.t_LnkAmount AS t_Amount, "+
             "        TXBuyLot.t_RQID, " +
             "        TXBuyLot.t_BuyDate, " +
             "        TXBuyLot.t_Type AS LotBuyType, " +
             "        TXBuyLot.t_DealCodeTS AS DealBuyCodeTS, " +
             "        TXBuyLot.T_DEALID AS DealBuyID, "+
             "        TXBuyLot.T_DEALDATE AS DealBuyDate, " +
             "        TXBuyLot.t_DealTime AS BuyDealTime, "+
             "        DealBuy.t_BOfficeKind, "+
             "        salelot.t_DealCodeTS as CodeDR, " +
                      Get_str_PaymDateSale(DLRQ_TYPE_DELIVERY, 1) + " as SaleDate, "+
             "        QueryLnk.t_Date as DLink, " +
             "        LegBuy.t_CFI as VprB, "+
             "        LegBuy.t_Cost as BDealCost, " +
             "        LegBuy.t_Principal AS BuyAmount, "+
             "        LegBuy.t_Price AS DealBuyPrice, "+
             "        LegBuy.t_NKD NKDBuy, "+
             "        LegBuy.t_LegKind as LegKindBuy, "+
             "        case when (QueryLnk.t_Type = "+ string(TXLNK_DELREPO) + " or QueryLnk.t_Type = " + string(TXLNK_SUBSTREPO) +") then '' else '‡' end as LinkType, " +
             "        TXBuyLot.t_Type as TypeB, " +
             "        DealBuy.t_BOfficeKind as BBOfficeKind, "+
                 Get_PartyName_Query( "DealBuy",  "PartyNameBuy" ) + /*PartyNameBuy*/
             "        , Rsb_SCTX.TXGetComissionsSum(DealBuy.t_DealID, DealBuy.t_BofficeKind, TXBuyLot.t_BuyDATE, 0) as CommBuy, " +
             "        CASE WHEN(DealSale.t_DealType = 32742) THEN 1 ELSE 0 end as IsDUDealS, " +
             "        rsb_sctx.GetInAvrWrtStartDate(DealBuy.t_DealId) as ImportDUDate, " +
             "        CASE WHEN((DealBuy.t_Ofbu = chr(88)) AND (RSB_SECUR.GetMainObjAttrNoDate(101, LPAD (DealBuy.t_DealId, 34, '0'), 117) <> 0)) THEN 1 ELSE 0 end as IsDUDealB ";

     Body1 = "   FROM (" + QueryRest + ") QueryRest," +
             "        DSCTXLOT_DBT currTXBuyLot, DSCTXLOT_DBT TXBuyLot, dfininstr_dbt FI, DAVOIRISS_DBT av, DDL_TICK_DBT DealBuy, DDL_LEG_DBT LegBuy " +
             "  WHERE currTXBuyLot.t_ID = QueryRest.SourceID AND " +
             "        TXBuyLot.t_ID     = currTXBuyLot.t_BegLotID AND " +
             "        FI.t_FIID        = QueryRest.t_FIID AND " +
             "        av.t_FIID         = FI.t_FIID AND " +
             "        DealBuy.t_DealID  = TXBuyLot.t_DealID AND " +
             "        LegBuy.t_DealID   = DealBuy.t_DealID AND" +
             "        LegBuy.t_LegKind  = " + LEG_KIND_DL_TICK + " AND " +
             "        LegBuy.t_LegID    = 0 " + WhereCond;

     Body2 = "   FROM (" + QueryLnk + " ) QueryLnk, " +
             "        dsctxlot_dbt TXBuyLot, " +
             "        dsctxlot_dbt currbuylot, " +
             "        dsctxlot_dbt salelot, " +
             "        ddl_tick_dbt DealSale, " +
             "        ddl_leg_dbt  LegBuy, " +
             "        ddl_tick_dbt DealBuy " +
             "  WHERE currbuylot.t_ID      = QueryLnk.t_BuyID and " +
             "        TXBuyLot.t_ID        = currbuylot.t_BegLotID and " +
             "        salelot.t_ID         = QueryLnk.t_BegLotID and " +
             "        DealSale.t_DealID    = salelot.t_DealID and " +
             "        DealBuy.t_DealID     = TXBuyLot.t_DealID and " +
             "        LegBuy.t_DealID      = DealBuy.t_DealID and " +
             "        LegBuy.t_LegID       = 0 and "+
             "        LegBuy.t_LegKind     = " + LEG_KIND_DL_TICK;

     var cmd = DL_RSDCommand(Head1 + Body1 + " UNION ALL " + Head2 + Body2 + " ORDER BY TypeB, TaxGroup, AvrCode, T_BUYDATE, DealBuyDate, DealBuyCodeTS ");
     NRecs = cmd.GetCount();

      ObjReport.BeginReport();

     if (NRecs > 0)

        header = "”®à¬¨à®¢ ­¨¥ áâà®ª ¯® ¢ë¯ãáª ¬ æ/¡ ¤«ï à¥£¨áâà  "+ˆ¬ïŽá­®¢­®£®‹¨áâ ();
        m_ProgressIndicator.Start(NRecs, header, header);

      //   ObjReport.BeginReport();

        m_RS = cmd.Execute();
        while( m_RS.MoveNext() )

           ClearCacheOneRecord();
           ObjReport.Print();
           if( m_RS.TypeB == TXLOTS_BUY  )
              SaveFIIDForForm_cons(m_RS.FIID);
           end;
           m_IsExistsData = true;
           Current = Current + 1;
           m_ProgressIndicator.Update(Current,NRecs); // ¢á¥£® 3 ¯ à ¬¥à  Update(index, count, text)
        end;

        ObjReport.EndReport();
        ReplaceFormulaAndCalculate();

        m_ProgressIndicator.Stop();
     else
        ObjReport.EndReport_NoData();
        m_IsExistsData = true;

     end;
  END;

  MACRO CreateReport()

    Fill_Cell_Name();

    m_SHEET_1 = SHEET_0491;
    m_SHEET_2 = SHEET_0491s;
    ExecuteReport( CIndNomBond_491(this) );
    PrintConsolidated( CIndNomBond_491_Cons(this) );
  END;

  MACRO NomB():DOUBLE // ­®¬¨­ « ®¡«¨£ æ¨¨ ­  ¤ âã <DDB>
     if( (TypeB() == "B") )
        return this.NomB();
     end;
  END;

  MACRO NkdBvp():MONEY
     if( (TypeB() == "B") )
        return this.NkdBvp();
     end;
  END;


  /*! ”®à¬ã« 
  292 - <NkdRepRub_%> = <NkdSvp> + <CoupRub> - <NkdBrepRub> - <NkdPrevRub_%>
  692 - <NkdRepRub_%> = <NkdAllRub_%> - <NkdPrevRub_%>
  491 - <NkdRepRub_%> = <CoupRub> +  <NkdRepEndRub> - <NkdBrepRub> - <NkdPrevRub_%>
  791  - <NkdRepRub_%> = <NkdAllRub_%> - <NkdPrevRub_%>*/
  MACRO NkdRepRub_()
     return F(GetCoupRub()+"+"+GetNkdRepEndRub()+"-"+GetNkdBrepRub()+"-"+GetNkdPrevRub_());
  END;

  /*! ”®à¬ã« 
  292 - <NkdRepRub_IN> = (<Nom_DDS> - <Nom_DDB>) *<Qnty> - <NkdPrevRub_IN>
  692 - <NkdRepRub_IN> = <NkdAllRub_IN> -  <NkdPrevRub_IN>
  491 - <NkdRepRub_IN> = ( <Nom_ H08> -  <Nom_DDB>) *<Qnty> - <NkdPrevRub_IN>
  791 - <NkdRepRub_IN> = <NkdAllRub_IN> -  <NkdPrevRub_IN>*/
  MACRO NkdRepRub_IN()
     return F("("+GetNom_H08()+"-"+GetNom_DDB()+")*"+GetQnty()+"-"+GetNkdPrevRub_IN());
  END;

  /* Šãàá ¯¥à¥áç¥â  áâ-â¨ ¯à¨®¡à¥â¥­¨ï ¢ àã¡«¥¢ë© íª¢¨¢ «¥­â */
  MACRO CrBD():DOUBLE
     if( (TypeB() == "B") )
        return this.CrBD();
     end;
  END;

  MACRO SumBvp():MONEY
     if( (TypeB() == "B") )
        return this.SumBvp();
     end;
  END;

  MACRO NkdBprevRub():MONEY
     if( (TypeB() == "B") )
        return this.NkdBprevRub();
     end;
  END;

  /*Žâ¬¥âª  ® ­ «¨ç¨¨ ¢ë¯« â Š„ ®â í¬¨â¥­â  ¤® ­ ç «  ­ «®£®¢®£® ¯¥à¨®¤  (1 - ¤ , 0 - ­¥â)*/
  MACRO ifCoupPrev():integer
     if( (TypeB() == "B") )
        return this.ifCoupPrev();
     end;
  END;

  /*Š„, ã¯« ç¥­­ë© ¯à¨ ¯à¨®¡à¥â¥­¨¨, ã¬¥­ìè îé¨© ¯à®æ¥­â­ë¥ ¤®å®¤ë â¥ªãé¥£® ­ «®£®¢®£® ¯¥à¨®¤ , àã¡*/
  MACRO NkdBrepRub():MONEY
     if( (TypeB() == "B") )
        return this.NkdBrepRub();
     end;
  END;

  /*292 - …á«¨ <DDB> < <H0.7> :
             …á«¨ Dª-1 > <DDB>, â® <NkdPrevRub_%> = Š„ ­  ¤ âã (<H0.7>-1) ¯® ª®«¨ç¥áâ¢ã <Qnty>)
             ˆ­ ç¥ <NkdPrevRub_%>=(Š„ ­  ¤ âã (<H0.7>-1) ¯® ª®«¨ç¥áâ¢ã <Qnty>) - <NkdBvp>
          ˆ­ ç¥ <NkdPrevRub_%> = 0
    692, 791 - …á«¨ <DDS> < <H0.7>, â® <NkdPrevRub_%> =  <NkdPrevEndRub> + <CoupPrevRub> - <NkdSvp>, ¨­ ç¥ <NkdPrevRub_%> =0
    491 - ¯®  «£®à¨â¬ã ¤«ï 292 ¯à¨ ãá«®¢¨¨ <TypeB> = B*/
  MACRO NkdPrevRub_():MONEY
     if( m_NkdPrevVN == NULL )
        if( (TypeB() == "B") )
           if( iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()) < this.H0_7() )
              if(this.„ª()-1 > iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()))
                 m_NkdPrevVN = Š„( m_RS.FIID, this.Qnty(), this.H0_7()-1);
              else
                 m_NkdPrevVN = Š„( m_RS.FIID, this.Qnty(), this.H0_7()-1) - this.NkdBvp();
              end;
           else
              m_NkdPrevVN = $0;
           end;
        end;
     end;
     return m_NkdPrevVN;
  END;

  /*292 - …á«¨ <DDB> < <H0.7>, â® <NkdPrevRub_IN> = (­®¬¨­ « ­  ¤ âã (<H0.7>-1) - <Nom_DDB>) * <Qnty> , ¨­ ç¥ <NkdPrevRub_IN> = 0
    692 - …á«¨ <DDS> < <H0.7>, â® <NkdPrevRub_IN> = (­®¬¨­ « ­  ¤ âã  (<H0.7>-1) - <Nom_DDS>)*<Qnty>, ¨­ ç¥ <NkdPrevRub_IN> =0
    491 - ¯®  «£®à¨â¬ã ¤«ï 292 ¯à¨ ãá«®¢¨¨ <TypeB> = B
    791 - …á«¨ <DDS> < <H0.7>, â® <NkdPrevRub_IN> = (<Nom_H07-1> - <Nom_DDS>)*<Qnty>, ¨­ ç¥ <NkdPrevRub_IN> =0 */
  MACRO NkdPrevRub_IN():MONEY
     if( m_NkdPrevRub_IN == NULL )
        if( (TypeB() == "B") )
           if( iif(this.IsDUDealB() == 1, this.ImportDUDate(), this.DDB()) < this.H0_7() )
              m_NkdPrevRub_IN = (this.Nom_H07_1()-this.NomB())*this.Qnty();
           else
              m_NkdPrevRub_IN = $0;
           end;
        end;
     end;
     return m_NkdPrevRub_IN;
  END;

  /*292 - <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „­ ¨ ¯® ¤ âã <DDS> ¢ª«îç¨â¥«ì­®, ªà®¬¥ ®á«¥¤­¥£® ªã¯®­ , .
    692-  <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „¯ ¨ ¯® ¤ âã <DDB> ¢ª«îç¨â¥«ì­®)
    791-  <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „¯ ¨ ¯® ¤ âã < H0.8> ¢ª«îç¨â¥«ì­®)
    491 - ‡ ¯®«­ï¥âáï ¯à¨ ãá«®¢¨¨ <TypeB> = B: <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „­ ¨ ¯® ¤ âã < H0.8> ¢ª«îç¨â¥«ì­®*/
  MACRO CoupRub():MONEY // Šã¯®­­ë© ¤®å®¤, ¯®«ãç¥­­ë© ®â í¬¨â¥­â  ¯à¨ ¯®£ è¥­¨¨ ªã¯®­®¢ ¢ ®âç¥â­®¬ (­ «®£®¢®¬) ¯¥à¨®¤¥ (ªà®¬¥ ªã¯®­ , ¯®«ãç¥­­®£® ¯à¨ ¯®£ è¥­¨¨ ¡ã¬ £¨) - áã¬¬ , àã¡
     if( TypeB() == "B" )
        return GetCouponSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.„­(), this.H0_8() );
     end;
  END;

  /*„ â  ¯®£ è¥­¨ï ¯®á«¥¤­¥£® ªã¯®­  ¢ ¯¥à¨®¤:
       292 - á ¤ âë „­  ¯® ¤ âã <DDS>, ªà®¬¥ ªã¯®­®¢, çìï ¤ â  ¯®£ è¥­¨ï=¤ â¥ ¯®£ è¥­¨ï ¢ë¯ãáª 
       692 - ¤ âë „¯  ¯® ¤ âã <DDB>
       491 - á ¤ âë „­  ¯® ¤ âã  < H0.8>
       791 - á ¤ âë „¯  ¯® ¤ âã < H0.8>
    „«ï ¢á¥å - ¥á«¨ ªã¯®­  ¢ ¯à®¢¥àï¥¬®¬ ¯¥à¨®¤¥ ­¥â, â® ¯®«¥ ­¥ § ¯®«­ï¥âáï.
    „«ï ¢á¥å - ¢ ¯à®¢¥àï¥¬ë© ¯¥à¨®¤ ¢ª«îç îâáï ®¡¥ ¤ âë.
    „«ï 491: ‡ ¯®«­ï¥âáï, â®«ìª® ¥á«¨ <TypeB>= <B>*/
  MACRO LastCoupDate():DATE
    var vLastCoupDate = Date(0,0,0);
    if( (TypeB() == "B") )
       vLastCoupDate = GetMaxCouponDrawingDateInPeriod(m_RS.FIID, this.„­(), this.H0_8());
       if( vLastCoupDate != Date(0,0,0) )
          return vLastCoupDate;
       end;
    end;
  END;

  /*! ”®à¬ã« 
     292 - <Taxe_NKD> = <NkdRepRub> - <NKDminusRub>
     692, 791  - <Taxe_NKD> = <NkdRepRub> * (-1)
     491 - <Taxe_NKD> = <NkdRepRub>*/
  MACRO Taxe_NKD()
     return F(GetNkdRepRub());
  END;

  /*! ”®à¬ã« 
    292 - <Fin_Res> = <SumAllRub> - <NKDminusRub> + <NkdRepRub> - (<DifB> + <SumBtax>)
    692 - <Fin_Res> =  <SumAllRub> - (<DifB> + <SumBtax>) -  <NkdRepRub>
    491 - <Fin_Res>  = <NkdRepRub>
    791 - <Fin_Res> = <NkdRepRub> * (-1)*/
  MACRO Fin_Res()
     return F(GetNkdRepRub());
  END;

  /*<NkdRepEndRub> = (Š„ ­  ¤ âã <H0.8> ¯® ª®«¨ç¥áâ¢ã <Qnty>).
    „«ï 491 -  § ¯®«­ï¥âáï ¯à¨ ãá«®¢¨¨ <TypeB> = B*/
  MACRO NkdRepEndRub():MONEY
     if( TypeB() == "B" )
        return Š„( m_RS.FIID, this.Qnty(), this.H0_8() );
     end;
  END;

  MACRO Nom_H08():MONEY
     if( TypeB() == "B" )
        return this.Nom_H08();
     end;
  END;

  MACRO ContB():STRING // Š®­âà £¥­â ¯® á¤¥«ª¥ ¯à¨®¡à¥â¥­¨ï
     if( TypeB() == "B" )
        return this.ContB();
     end;
  END;

  MACRO DqualB():DATE
     if( TypeB() == "B" )
        return this.DqualB();
     end;
  END;

  /*Š®«¨ç¥áâ¢® ªã¯®­®¢, ¯®«ãç¥­­ëå ¢ ®âç¥â­®¬ ¯¥à¨®¤¥*/
  MACRO CoupCount():INTEGER
     if( TypeB() == "B" )
        return GetCountCouponInPeriod(m_RS.FIID, this.„­(), this.H0_8());
     end;
  END;

  /*®¬¥à á¤¥«ª¨ ¯àï¬®£® …Ž / ‡ ©¬ */
  MACRO CodeDR():STRING
     if( TypeB() == "B" )
        return m_RS.CodeDR;
     end;
  END;

  /*„ â  ¯®áâ ¢ª¨ ¯® 1 ç áâ¨ ¯àï¬®£® …Ž / ‡ ©¬ */
  MACRO DD1DR():DATE
     if( TypeB() == "B" )
        return SQL_ConvTypeDate(m_RS.SaleDate);
     end;
  END;

  /*„ â  à §¬¥é¥­¨ï ¯à¨®¡à¥â¥­¨ï ¢ ¤ ­­®¬ ¯àï¬®¬ …Ž / ‡ ©¬¥*/
  MACRO DLink():DATE
     if( TypeB() == "B" )
        return SQL_ConvTypeDate(m_RS.DLink);
     end;
  END;

  MACRO PrBNom():DOUBLE
     if( TypeB() == "B" )
        return this.PrBNom();
     end;
  END;

  MACRO K_ControlB():STRING
     if( TypeB() == "B" )
        return this.K_ControlB();
     end;
  END;

  MACRO Control_CommentB():STRING
     if( TypeB() == "B" )
        return this.Control_CommentB();
     end;
  END;

  MACRO RFISSB():STRING
     if( TypeB() == "B" )
        return this.RFISSB();
     end;
  END;

  /*! ”®à¬ã«  <ControlNomB> = <SumBvp>/ <Qnty>*100/<PrBNom> -  <Nom_DDB>*/
  MACRO ControlNomB()
     if(this.IsDUDealS() == 1) return F(0);
     end;
     return F(FormulaIF()+"("+GetTypeB()+"=\"B\";"+GetSumBvp()+"/"+GetQnty()+"*100/"+GetPrBNom()+"-"+GetNom_DDB()+";0)");
  END;

  initTX_IndNomBondReg_Report( Form, TemplateName, UseCSV, IsWebService, ReportHashCode, UsePOI, FocreFormatRep );
END;

PRIVATE CLASS (TX_IndNomBondReg_Report) TX_IndNomBondReg_Report_791( Form:DL_CPanel, TemplateName:STRING, UseCSV:BOOL, IsWebService:BOOL, ReportHashCode:INTEGER, UsePOI:BOOL, FocreFormatRep:INTEGER )

   // private var m_CopyAutoSumRange = null;

  MACRO Fill_Cell_Name()

        C_SecCode       = "B";
        C_SecCode_2     = "C";
        C_Fin_Res       = "AR";
        C_Taxe_NKD      = "AQ";
        C_Qnty          = "G";
        C_SumSvp        = "AB";
        C_NkdSvp        = "I";
        C_CoupRub       = "W";
        C_NkdPrevRub_   = "S";
        C_NkdPrevRub_IN = "T";
        C_NkdRepRub     = "J";

        C_SumSrub       = "H";
        C_Nom_DDS       = "M";
        C_NkdRepRub_    = "K";
        C_NkdRepRub_IN  = "L";
        C_PrSNom        = "AC";
        C_CrSD          = "AA";

        C_NkdAllRub_    = "P";
        C_NkdPrevRub_   = "S";
        C_NkdAllRub_IN  = "Q";
        C_NkdPrevRub_IN = "T";
        C_Nom_H08       = "AG";

        C_SecType       = "AP";

        C_NkdRepEndRub  = "U";
        C_CoupPrevRub   = "X";

  END;

  MACRO GetCCons()
     return "P";
  END;

  MACRO PrintHeader( FldPref:STRING, H03:STRING, ReportCode:STRING, ReportName:STRING )
     PrintFormatString( "",
                       FldPref+"„ â ‘®áâ ¢«¥­¨ï", string(Date())+" "+string(Time()),
                       FldPref+"®¬¥àŽ¯¥à ",      string({oper}),
                       FldPref+"Ž¯¥à æ¨®­¨áâ",    GetOperRecByID({oper}).Name,
                       FldPref+"H0_A:l",          this.H0_A(),
                       FldPref+"H0_B_INN",        this.H0_B_INN(),
                       FldPref+"H0_B_KPP",        this.H0_B_KPP(),
                       FldPref+"H0_3",            H03,
                       FldPref+"H0_7",            this.H0_7(),
                       FldPref+"H0_8",            this.H0_8(),
                       FldPref+"H0_9",            this.H0_9_Name(),
                       FldPref+"H0_11",           this.H0_11()
                     );
  END;

  PRIVATE MACRO BeginReport( NumCopy:INTEGER )
     m_H07 = WebFormData.BeginDate;
     m_H08 = WebFormData.EndDate;
  END;

  MACRO ExecuteReport(ObjReport:OBJECT)

     VAR DataQuery;
     VAR strSelect;
     VAR strSelect0;
     VAR header = "", NRecs = 0, Current = 0;
     VAR strOrder, DataSubQuery;

     ExecuteReport();

     DataSubQuery = "select Rest.T_FIID as FIID, Rest.T_SOURCEID as SourceID, Rest.T_SALEID as SaleID, sum(Rest.T_AMOUNT) as Amount " +
                    "  from dsctxrest_dbt Rest " +
                    " where Rest.T_TYPE in ("+TXREST_Open+","+TXREST_Closed+") and " +
                    "       (Rest.T_BUYDATE > " + GetSQLDate(H0_8()) + " or " +
                    "        Rest.T_BUYDATE = TO_DATE('01.01.0001','DD.MM.YYYY')) and " +
                    "       Rest.T_SALEDATE <= " + GetSQLDate(H0_8()) + " and " +
                    "       Rest.T_AMOUNT > 0 " +
                    " group by Rest.T_FIID, Rest.T_SOURCEID, Rest.T_SALEID";

     strSelect0 = "select FI.t_FI_Code ";

     strSelect = "select FI.t_FI_Code           as AvrCode, " +
                 "       FI.t_Name              as AvrName, " +
                 "       FI.t_FaceValueFI       as FaceValueFI, " +
                 "       FI.t_FIID              as FIID, " +
                 "       FI.t_DrawingDate, " +
                 "       FI.t_Issued, " +
                 "       av.t_TaxGroup          as TaxGroup, " +
                 "       (case when av.t_ISIN IS null OR av.t_ISIN IN (chr(0), chr(1)) then (case when av.t_LSIN IS null OR av.t_LSIN IN (chr(0), chr(1)) then chr(0) else av.t_LSIN end) else av.t_ISIN end) AS t_ISIN, " +
                 "       SaleLot.t_DealCodeTS   as DealSaleCodeTS, " +
                 "       SaleLot.t_ID           as SaleID, " +
                 "       SaleLot.t_VirtualType  as VirtualType, " +
                 "       SaleLot.t_DealID       as SaleDealID, " +
                 "       SaleLot.t_Amount       as SaleAmount, " +
                 "       SaleLot.t_RQID, " +
                 "       DataSale.DealSaleGroup as DealSaleGroup, " +
                 "       DealSale.t_DealID      as DealSaleID, " +
                 "       DECODE(SaleLot.t_VirtualType, 1, DealSale.t_PartyID, 0) as SalePartyID, " +
                 "       NVL((select t_BOfficeKind from ddl_tick_dbt where t_DealID = SaleLot.t_DealID), 0) as SBOfficeKind, " +
                 "       SaleLot.t_DealDate     as DealSaleDate, " +
                 "       SaleLot.t_SaleDate     as SaleDate, " +
                 "       Rest.Amount            as t_Amount, " +
                 "       LegS.t_CFI             as VPrS, " +
                 "       LegS.t_Price           as DealSalePrice, " +
                 "       LegS.t_Cost            as SDealCost, " +
                 "       LegS.t_NKD             as NKDSale, " +
                 Get_PartyName_Query("DealSale", "PartyNameSale") + ", " +
                 "       SourceLot.t_ID         as SourceID, " +
                 "       SourceLot.t_DealCodeTS as CodeOR, " +
                 "       SourceLot.t_Type       as TypeOR, " +
                 "       SourceLot.t_DealID     as SDealID ";
     DataQuery =
                 "  from dsctxlot_dbt currSaleLot, dsctxlot_dbt SaleLot, dsctxlot_dbt SourceLot, (" + DataSubQuery + ") Rest," +
                 "       dfininstr_dbt FI, ddl_tick_dbt DealSale, davoiriss_dbt av, ddl_leg_dbt LegS, " +
                 "       ( Select SaleOper.t_Kind_Operation, SaleOper.t_DocKind, " +
                 "                rsb_secur.get_OperationGroup(SaleOper.t_SysTypes) as DealSaleGroup, " +
                 "                (CASE WHEN " +
                 "                           ((Rsb_Secur.IsBuy(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                 "                         or (Rsb_Secur.IsAvrWrtIn(rsb_secur.get_OperationGroup(SaleOper.t_SysTypes))=1) " +
                 "                           ) " +
                 "                      THEN 2 " +
                 "                      ELSE 0 END " +
                 "                ) as LegKindSale " +
                 "           From doprkoper_dbt SaleOper " +
                 "       ) DataSale " +
                 " where FI.t_FIID                 = Rest.FIID and " +
                 "       FI.t_FIID                 = av.t_FIID and " +
                 "       currSaleLot.t_ID          = Rest.SaleID and " +
                 "       SaleLot.t_ID              = currSaleLot.t_BegLotID and " +
                 "       SourceLot.t_ID            = Rest.SourceID and " +
                 "       SaleLot.t_VirtualType     in ( 1, 2 ) and " +
                 "       DealSale.t_DealID         = DECODE( SaleLot.t_VirtualType, 1, SaleLot.t_DealID, (select t_DealID from dsctxlot_dbt where t_ID = SaleLot.t_RealID) ) and " +
                 "       DataSale.t_Kind_Operation = DealSale.t_DealType AND " +
                 "       DataSale.t_DocKind        = DealSale.t_BOfficeKind AND " +
                 "       LegS.t_DealID             = SaleLot.t_DealID AND " +
                 "       LegS.t_LegKind            = DataSale.LegKindSale AND " +
                 "       LegS.t_LegID              = 0 " + GetAddWhereForAvr();

     strOrder =  " order by av.t_TaxGroup, FI.t_FI_Code, SaleLot.t_SaleDate, SaleLot.t_DealDate, SaleLot.t_DealCodeTS ";

     var cmd = DL_RSDCommand( strSelect0 + DataQuery );
     NRecs = cmd.GetCount();

      ObjReport.BeginReport();

     if (NRecs > 0)

        header = "”®à¬¨à®¢ ­¨¥ áâà®ª ¯® ¢ë¯ãáª ¬ æ/¡ ¤«ï à¥£¨áâà  "+ˆ¬ïŽá­®¢­®£®‹¨áâ ();
        m_ProgressIndicator.Start(NRecs, header, header);

      //   ObjReport.BeginReport();

        m_RS = cmd.Execute( strSelect + DataQuery + strOrder );
        while( m_RS.MoveNext() )

           ClearCacheOneRecord();
           ObjReport.Print();
           SaveFIIDForForm_cons(m_RS.FIID);
           m_IsExistsData = true;

           Current = Current + 1;
           m_ProgressIndicator.Update(Current,NRecs); // ¢á¥£® 3 ¯ à ¬¥à  Update(index, count, text)
        end;

        ObjReport.EndReport();
        ReplaceFormulaAndCalculate();

        m_ProgressIndicator.Stop();
     else
        ObjReport.EndReport_NoData();
        m_IsExistsData = true;
     end;
  END;

  MACRO CreateReport()

    Fill_Cell_Name();

    m_SHEET_1 = SHEET_0791;
    m_SHEET_2 = SHEET_0791s;
    ExecuteReport( CIndNomBond_791(this) );
    PrintConsolidated( CIndNomBond_791_Cons(this) );
  END;

  /*! ”®à¬ã« 
  292 - <NkdRepRub_%> = <NkdSvp> + <CoupRub> - <NkdBrepRub> - <NkdPrevRub_%>
  692 - <NkdRepRub_%> = <NkdAllRub_%> - <NkdPrevRub_%>
  491 - <NkdRepRub_%> = <CoupRub> +  <NkdRepEndRub> - <NkdBrepRub> - <NkdPrevRub_%>
  791  - <NkdRepRub_%> = <NkdAllRub_%> - <NkdPrevRub_%>*/
  MACRO NkdRepRub_()
     return F(GetNkdAllRub_()+"-"+GetNkdPrevRub_());
  END;

  /*! ”®à¬ã« 
  292 - <NkdRepRub_IN> = (<Nom_DDS> - <Nom_DDB>) *<Qnty> - <NkdPrevRub_IN>
  692 - <NkdRepRub_IN> = <NkdAllRub_IN> -  <NkdPrevRub_IN>
  491 - <NkdRepRub_IN> = ( <Nom_ H08> -  <Nom_DDB>) *<Qnty> - <NkdPrevRub_IN>
  791 - <NkdRepRub_IN> = <NkdAllRub_IN> -  <NkdPrevRub_IN>*/
  MACRO NkdRepRub_IN()
     return F(GetNkdAllRub_IN()+"-"+GetNkdPrevRub_IN());
  END;

  /*292 - …á«¨ <DDB> < <H0.7> :
             …á«¨ Dª-1 > <DDB>, â® <NkdPrevRub_%> = Š„ ­  ¤ âã (<H0.7>-1) ¯® ª®«¨ç¥áâ¢ã <Qnty>)
             ˆ­ ç¥ <NkdPrevRub_%>=(Š„ ­  ¤ âã (<H0.7>-1) ¯® ª®«¨ç¥áâ¢ã <Qnty>) - <NkdBvp>
          ˆ­ ç¥ <NkdPrevRub_%> = 0
    692, 791 - …á«¨ <DDS> < <H0.7>, â® <NkdPrevRub_%> =  <NkdPrevEndRub> + <CoupPrevRub> - <NkdSvp>, ¨­ ç¥ <NkdPrevRub_%> =0
    491 - ¯®  «£®à¨â¬ã ¤«ï 292 ¯à¨ ãá«®¢¨¨ <TypeB> = B*/
  MACRO NkdPrevRub_():MONEY
     if( m_NkdPrevVN == NULL )
        if(this.DDS() < this.H0_7())
           m_NkdPrevVN = this.NkdPrevEndRub() + this.CoupPrevRub() - this.NkdSvp();
        else
           m_NkdPrevVN = $0;
        end;
     end;
     return m_NkdPrevVN;
  END;

  /*292 - …á«¨ <DDB> < <H0.7>, â® <NkdPrevRub_IN> = (­®¬¨­ « ­  ¤ âã (<H0.7>-1) - <Nom_DDB>) * <Qnty> , ¨­ ç¥ <NkdPrevRub_IN> = 0
    692 - …á«¨ <DDS> < <H0.7>, â® <NkdPrevRub_IN> = (­®¬¨­ « ­  ¤ âã  (<H0.7>-1) - <Nom_DDS>)*<Qnty>, ¨­ ç¥ <NkdPrevRub_IN> =0
    491 - ¯®  «£®à¨â¬ã ¤«ï 292 ¯à¨ ãá«®¢¨¨ <TypeB> = B
    791 - …á«¨ <DDS> < <H0.7>, â® <NkdPrevRub_IN> = (<Nom_H07-1> - <Nom_DDS>)*<Qnty>, ¨­ ç¥ <NkdPrevRub_IN> =0 */
  MACRO NkdPrevRub_IN():MONEY
     if( m_NkdPrevRub_IN == NULL )
        if(this.DDS() < this.H0_7())
           m_NkdPrevRub_IN = (this.Nom_H07_1()-this.NomS())*this.Qnty();
        else
           m_NkdPrevRub_IN = $0;
        end;
     end;
     return m_NkdPrevRub_IN;
  END;

  /*292 - <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „­ ¨ ¯® ¤ âã <DDS> ¢ª«îç¨â¥«ì­®, ªà®¬¥ ®á«¥¤­¥£® ªã¯®­ , .
    692-  <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „¯ ¨ ¯® ¤ âã <DDB> ¢ª«îç¨â¥«ì­®)
    791-  <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „¯ ¨ ¯® ¤ âã < H0.8> ¢ª«îç¨â¥«ì­®)
    491 - ‡ ¯®«­ï¥âáï ¯à¨ ãá«®¢¨¨ <TypeB> = B: <CoupRub> =<Qnty>*(‘ã¬¬  ªã¯®­®¢, ¢ë¯« â  ª®â®àëå ¯à¨å®¤¨âáï ­  ¯¥à¨®¤ á ¤ âë „­ ¨ ¯® ¤ âã < H0.8> ¢ª«îç¨â¥«ì­®*/
  MACRO CoupRub():MONEY // Šã¯®­­ë© ¤®å®¤, ¯®«ãç¥­­ë© ®â í¬¨â¥­â  ¯à¨ ¯®£ è¥­¨¨ ªã¯®­®¢ ¢ ®âç¥â­®¬ (­ «®£®¢®¬) ¯¥à¨®¤¥ (ªà®¬¥ ªã¯®­ , ¯®«ãç¥­­®£® ¯à¨ ¯®£ è¥­¨¨ ¡ã¬ £¨) - áã¬¬ , àã¡
     return GetCouponSumByPeriod_Rub( m_RS.FIID, this.Qnty(), this.„¯(), this.H0_8() );
  END;

  /*„ â  ¯®£ è¥­¨ï ¯®á«¥¤­¥£® ªã¯®­  ¢ ¯¥à¨®¤:
       292 - á ¤ âë „­  ¯® ¤ âã <DDS>, ªà®¬¥ ªã¯®­®¢, çìï ¤ â  ¯®£ è¥­¨ï=¤ â¥ ¯®£ è¥­¨ï ¢ë¯ãáª 
       692 - ¤ âë „¯  ¯® ¤ âã <DDB>
       491 - á ¤ âë „­  ¯® ¤ âã  < H0.8>
       791 - á ¤ âë „¯  ¯® ¤ âã < H0.8>
    „«ï ¢á¥å - ¥á«¨ ªã¯®­  ¢ ¯à®¢¥àï¥¬®¬ ¯¥à¨®¤¥ ­¥â, â® ¯®«¥ ­¥ § ¯®«­ï¥âáï.
    „«ï ¢á¥å - ¢ ¯à®¢¥àï¥¬ë© ¯¥à¨®¤ ¢ª«îç îâáï ®¡¥ ¤ âë.
    „«ï 491: ‡ ¯®«­ï¥âáï, â®«ìª® ¥á«¨ <TypeB>= <B>*/
  MACRO LastCoupDate():DATE
    var vLastCoupDate = GetMaxCouponDrawingDateInPeriod(m_RS.FIID, this.„¯(), this.H0_8());
    if( vLastCoupDate != Date(0,0,0) )
       return vLastCoupDate;
    end;
  END;

  /*! ”®à¬ã« 
     292 - <Taxe_NKD> = <NkdRepRub> - <NKDminusRub>
     692, 791  - <Taxe_NKD> = <NkdRepRub> * (-1)
     491 - <Taxe_NKD> = <NkdRepRub>*/
  MACRO Taxe_NKD()
     return F(GetNkdRepRub()+"*(-1)");
  END;

  /*! ”®à¬ã« 
    292 - <Fin_Res> = <SumAllRub> - <NKDminusRub> + <NkdRepRub> - (<DifB> + <SumBtax>)
    692 - <Fin_Res> =  <SumAllRub> - (<DifB> + <SumBtax>) -  <NkdRepRub>
    491 - <Fin_Res>  = <NkdRepRub>
    791 - <Fin_Res> = <NkdRepRub> * (-1)*/
  MACRO Fin_Res()
     return F(GetNkdRepRub()+"*(-1)");
  END;

  /*!”®à¬ã« 
    692 - <NkdAllRub_%>= <NkdBvp>+ <CoupPrevRub>+ <CoupRub>- <NkdSvp>
    791 -<NkdAllRub_%>= <NkdRepEndRub> + <CoupPrevRub>+ <CoupRub>- <NkdSvp>*/
  MACRO NkdAllRub_()
     return F(GetNkdRepEndRub()+"+"+GetCoupPrevRub()+"+"+GetCoupRub()+"-"+GetNkdSvp());
  END;

  /*!”®à¬ã« 
    692 - <NkdAllRub_IN> = (<Nom_DDB> - <Nom_DDS>) * <Qnty>
    791 - <NkdAllRub_IN> = (<Nom_H08> - <Nom_DDS>) * <Qnty>*/
  MACRO NkdAllRub_IN()
     return F("("+GetNom_H08()+"-"+GetNom_DDS()+")*"+GetQnty());
  END;

  initTX_IndNomBondReg_Report( Form, TemplateName, UseCSV, IsWebService, ReportHashCode, UsePOI, FocreFormatRep);
END;

MACRO ReportRunEx(
  IsWebService    : Bool
 ,FormData      //: CTxReportForm
 ,ReportHashCode  : Integer
 ,menuItem      //: WsMenuItem
)
  var NumCopy = 0;
  var FullReportFileNames = TArray();
  var FullReportFileNames_292 = TArray();
  var FullReportFileNames_692 = TArray();
  var FullReportFileNames_491 = TArray();
  var FullReportFileNames_791 = TArray();
  var ReportKindCount : Integer = 0;
  var IndNomBondReg_Report, i = 0;
  var Print_292 = false, Print_692 = false, Print_491 = false, Print_791 = false;
  var TemplateName = "Report_IndNomBondReg.xlsx";

  m_AddWhereForAvr = "";
  m_H0_9_Name = "";
  m_H0_9_Num = "";
  m_H0_11 = "";

  WebMenuItem = menuItem;
  WebFormData = FormData;

  SetAddWhereForAvr();

  if( ( ValType( FormData.ReportKindList ) != V_UNDEF ) and ( FormData.ReportKindList.Size > 0 ) )
     while( ReportKindCount < FormData.ReportKindList.Size )
        if( FormData.ReportKindList[ReportKindCount].numberalg == INDNOM_REG_0292 )
           Print_292 = true;
        end;
        if( FormData.ReportKindList[ReportKindCount].numberalg == INDNOM_REG_0692 )
           Print_692 = true;
        end;
        if( FormData.ReportKindList[ReportKindCount].numberalg == INDNOM_REG_0491 )
           Print_491 = true;
        end;
        if( FormData.ReportKindList[ReportKindCount].numberalg == INDNOM_REG_0791 )
           Print_791 = true;
        end;
        ReportKindCount = ReportKindCount + 1;
     end;
  else
     Print_292 = true;
     Print_692 = true;
     Print_491 = true;
     Print_791 = true;
  end;

  NumCopy = 0;
  if( Print_292 )
     if( FormData.InORCB )
        NumCopy = NumCopy + 1;
     end;
     if( FormData.NotORCB )
        NumCopy = NumCopy + 1;
     end;
     if( FormData.DealsFISS )
        NumCopy = NumCopy + 1;
     end;
     if( FormData.Detail )
        NumCopy = NumCopy + 1;
     end;
     if( NumCopy > 0 )
        IndNomBondReg_Report = TX_IndNomBondReg_Report_292_692( null, TemplateName, false, IsWebService, ReportHashCode, true, WINREP_FORMAT_XLSX, INDNOM_REG_0292 );
        IndNomBondReg_Report.Run(NumCopy);
        FullReportFileNames_292 = IndNomBondReg_Report.GetFullReportFileNames();
     end;
  end;
  IndNomBondReg_Report = null;
  NumCopy = 0;
  if( Print_692 )
     if( FormData.InORCB )
        NumCopy = NumCopy + 1;
     end;
     if( FormData.NotORCB )
        NumCopy = NumCopy + 1;
     end;
     if( NumCopy > 0 )
        IndNomBondReg_Report = TX_IndNomBondReg_Report_292_692( null, TemplateName, false, IsWebService, ReportHashCode, true, WINREP_FORMAT_XLSX, INDNOM_REG_0692 );
        IndNomBondReg_Report.Run(NumCopy);
        FullReportFileNames_692 = IndNomBondReg_Report.GetFullReportFileNames();
     end;
  end;
  IndNomBondReg_Report = null;
  if( Print_491 )
     IndNomBondReg_Report = TX_IndNomBondReg_Report_491( null, TemplateName, false, IsWebService, ReportHashCode, true, WINREP_FORMAT_XLSX );
     IndNomBondReg_Report.Run();
     FullReportFileNames_491 = IndNomBondReg_Report.GetFullReportFileNames();
  end;
  IndNomBondReg_Report = null;
  if( Print_791 )
     IndNomBondReg_Report = TX_IndNomBondReg_Report_791( null, TemplateName, false, IsWebService, ReportHashCode, true, WINREP_FORMAT_XLSX );
     IndNomBondReg_Report.Run();
     FullReportFileNames_791 = IndNomBondReg_Report.GetFullReportFileNames();
  end;

  Dl_CallInsertStat(DL_OUTREPORT_EXCEL, menuItem.iCaseItem, menuItem.iIdentProgram, menuItem.szNameItem);
  i = 0;
  if( FullReportFileNames_292.Size() > 0 )
     while( i < FullReportFileNames_292.Size() )
        FullReportFileNames[FullReportFileNames.Size()] = FullReportFileNames_292[i];
        i = i + 1;
     end;
  end;
  i = 0;
  if( FullReportFileNames_692.Size() > 0 )
     while( i < FullReportFileNames_692.Size() )
        FullReportFileNames[FullReportFileNames.Size()] = FullReportFileNames_692[i];
        i = i + 1;
     end;
  end;
  i = 0;
  if( FullReportFileNames_491.Size() > 0 )
     while( i < FullReportFileNames_491.Size() )
        FullReportFileNames[FullReportFileNames.Size()] = FullReportFileNames_491[i];
        i = i + 1;
     end;
  end;
  i = 0;
  if( FullReportFileNames_791.Size() > 0 )
     while( i < FullReportFileNames_791.Size() )
        FullReportFileNames[FullReportFileNames.Size()] = FullReportFileNames_791[i];
        i = i + 1;
     end;
  end;

  return FullReportFileNames;
END;