/*
$Name:        npreptax_form.mac
$Module:      Ценные бумаги
$Description: Форма ввода данных для отчета "Рассчитанные и удержанные налоги"
*/
import "DlRepForm_h.mac";

CONST PNFLD_NPREPTAX_PERIOD          = 0,
      PNFLD_NPREPTAX_YEAR            = 1,
      PNFLD_NPREPTAX_GRWITOG         = 2,
      PNFLD_NPREPTAX_BEGDATE         = 3,
      PNFLD_NPREPTAX_ENDDATE         = 4,
      PNFLD_NPREPTAX_INVERSTORCODE   = 5,
      PNFLD_NPREPTAX_INVERSTORNEAME  = 6,
      PNFLD_NPREPTAX_PRINTMETHOD     = 7;

CLASS (DL_CPanel) Sp_NPREPTAX_Panel()

  PRIVATE MACRO Init()
     VAR Year, Period, CurMonth, PrevQuartal;

     DateSplit( {curdate}, null, CurMonth, Year );

     PrevQuartal = (CurMonth - 1)/3; /*текущий квартал-1*/
     if( PrevQuartal == 0 )
        PrevQuartal   = 4;
        Year = Year - 1;
     end;
     Period = PrevQuartal + 12; /*(+12 - для NameAlg.dbt)*/

     AddFieldProc( 0, PNFLD_NPREPTAX_PERIOD,         DL_PNFLD_PERIOD,              @DL_FldProc_Period, Period, 11, 4 ); 
     AddFieldProc( 0, PNFLD_NPREPTAX_YEAR,           DL_PNFLD_YEAR,                @DL_FldProc_Year, Year );
     AddFieldProc( 0, PNFLD_NPREPTAX_GRWITOG,        DL_PNFLD_GROWTH,              @DL_FldProc_Growth );
     AddFieldProc( 0, PNFLD_NPREPTAX_BEGDATE,        DL_PNFLD_BEGINDATE,           @DL_FldProc_BeginDate );
     AddFieldProc( 0, PNFLD_NPREPTAX_ENDDATE,        DL_PNFLD_ENDDATE,             @DL_FldProc_EndDate_NpTx );
     AddFieldProc( 0, PNFLD_NPREPTAX_INVERSTORCODE,  DL_PNFLD_CLIENT_SDD_SVO_CODE, @DL_FldProc_Client_SDD_SVO_Code );
     AddFieldProc( 0, PNFLD_NPREPTAX_INVERSTORNEAME, DL_PNFLD_CLIENT_SDD_SVO_NAME, @DL_FldProc_Client_SDD_SVO_Name );
     AddFieldProc( 0, PNFLD_NPREPTAX_PRINTMETHOD,    DL_PNFLD_PRINTMETHOD,         @DL_FldProc_NpTxPrintMethod, DL_OUTREPORT_EXCEL, 30, 9 );

     DisableFields(this.Data(), PNFLD_NPREPTAX_PRINTMETHOD);
  END;

  PRIVATE MACRO Check():BOOL
     return true;
  END;

  initDL_CPanel( "sp_rep.lbr", "reptax" );
END;