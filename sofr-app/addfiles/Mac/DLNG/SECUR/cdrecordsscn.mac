/**
  @file cdrecordsscn.mac
  @brief Œ áá®¢®¥ ¢ë¯®«­¥­¨¥ ¤¥©áâ¢¨© ­ ¤ ¢ë¯« â ¬¨ Š„ ¨§ „¨ á®äâ 
*/
import DealsInter,"dlquery.mac";

PRIVATE RECORD cdrec( CDRECORDS );

PRIVATE CONST ERROR_EXEC = 0,   ///<ˆ¤¥â ¢ë¯®«­¥­¨¥
              PRINT_HEADER = 1, ///<¥ç âì § £®«®¢ª 
              PRINT_FOOTER = 2; ///<¥ç âì ¯®¤¢ « 

PRIVATE MACRO PrintHead( Head:STRING )
[
                   #
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³            ID            ³  ü   ³                      ‘®®¡é¥­¨¥                                                                    ³
³          ¢ë¯« âë         ³®è¨¡ª¨³                                                                                                   ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´](Head);
END;

PRIVATE MACRO PrintFooter()
[ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
];

END;

PRIVATE MACRO PrintLine( ErrStatus:INTEGER, ErrMessage:STRING )
[³##########################³######³###################################################################################################³]
( cdrec.ID:w, ErrStatus, ErrMessage:w );
END;

PRIVATE MACRO ExecuteRec( NumExec:INTEGER, ErrStatus:INTEGER, ErrMessage:STRING )
  var query, cmd, DataSet;
  var STB = TRecHandler("nptxtotalbase.dbt");
  var MainMes = "", ChildMes = "";

  if( NumExec == PRINT_HEADER )
     PrintHead( "Žâç¥â ® ¬ áá®¢®¬ ¨á¯®­¥­¨¨ ¢ë¯« â." );
  elif( NumExec == PRINT_FOOTER )            
     PrintFooter();
  elif( NumExec == ERROR_EXEC )
     if( ErrStatus == 0 )
        ErrMessage = "‚ë¯« â  ®¡à ¡®â ­  ãá¯¥è­®";
     end;
     PrintLine( ErrStatus, ErrMessage);
  end;
END;

PRIVATE MACRO RejectRec( NumExec:INTEGER, ErrStatus:INTEGER, ErrMessage:STRING )
  if( NumExec == PRINT_HEADER )
     PrintHead( "Žâç¥â ® ¬ áá®¢®¬ ®âª«®­¥­¨¨ ¢ë¯« â." );
  elif( NumExec == PRINT_FOOTER )            
     PrintFooter();
  elif( NumExec == ERROR_EXEC )
     if( ErrStatus == 0 ) 
       ErrMessage = "‚ë¯« â  ®âª«®­¥­  ãá¯¥è­®.";
     end;
     PrintLine( ErrStatus, ErrMessage);
  end;
END;

MACRO ¥ç âì_Žâç¥â‘ª ­¨à®¢ ­¨ï( NumExec:INTEGER, FDoc:VARIANT, ErrStatus:INTEGER, ErrMessage:STRING, Action:INTEGER )

  SetBuff( cdrec, FDoc );   

  if( Action == 1 )
     ExecuteRec( NumExec, ErrStatus, ErrMessage );
  elif( Action == 2 )
     RejectRec( NumExec, ErrStatus, ErrMessage );
  end;

END;
