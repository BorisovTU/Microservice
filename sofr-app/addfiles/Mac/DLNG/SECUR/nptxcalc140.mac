/*
$Name:        nptxcalc140.mac
$Module:      Ценные бумаги
$Description: Операция расчета НОБ для НДФЛ. Шаг "Закрытие"
*/

/* Операция расчета НДФЛ
   Шаг "Закрытие"*/
IMPORT "secinter.mac", "nptxfun.mac", "SpRepFun.mac";

PRIVATE VAR Oper = TRecHandler( "nptxop.dbt" );

PRIVATE MACRO Error( ErrStr:STRING ):INTEGER
  DL_NPTX_PutMsg( ErrStr, 10 );
  MsgBox( ErrStr );
  return 1;
END;

PRIVATE MACRO RunAction()
  VAR stat = DL_SetCalcPeriodDate( NPTXCALC_CALCNDFL, Oper.rec.Client, Oper.rec.OperDate, 0 );

  return stat;
END;

MACRO ExecuteStep( DlDoc, FDoc, DocKind, ID_Operation, ID_Step )

  VAR Stat = 0;

  Oper.SetRecordAddr( FDoc );

  stat = DL_NPTX_PutMsg( "Закрытие операции", 40 );
  if( not stat )
     stat = RunAction();

     DL_NPTX_SaveOperLog( Oper.rec.ID, ID_Step );
  end;

  return stat;
END;
