/*
$Name:             ir_inboundmsg.mac
$Module:           Репозитарий
$Description:      Выполнение сервисной операции обработки входящих сообщений
*/
import  "dlntfd.mac", "irstartinboundmsg.mac";

private macro ExecuteGetIncomingMes( ir_op )
  var err = 0;
  var cnt = 0, i = 0;
  var transactionStarted:bool = false;

    /*Начать транзакцию*/
  RslDefCon.BeginTrans();
  transactionStarted = true;
  var exec;
  var Header = DL_LOG_HEADER_XML(ir_op.rec.DocKind).GetHeaderXML();

  var params:TArray = TArray();
  params[0] = SQLParam( "p_Date"    , {curdate} ); 
  params[1] = SQLParam( "p_IR_OP_ID", ir_op.rec.ID ); 
  params[2] = SQLParam( "p_op_Kind",  ir_op.rec.DocKind ); 
  params[3] = SQLParam( "p_oper",     {oper} ); 
  params[4] = SQLParam( "p_LogHeader",Header ); 
  var stat:integer = execStoredFunc( "RSP_REPOSITORY.GetIncomingSRS", V_INTEGER, params );
/*
  if( (not stat) )
  
    exec = RSDCommand( " INSERT INTO ddlgrdoc_dbt (t_ID, t_GRDEALID, T_DOCKIND, T_DOCID, T_SERVDOCKIND, T_SERVDOCID, T_GRPID, T_SOURCETYPE) "
                     + " VALUES (0,?,0,0,?,?,0,0)   " );
    exec.addParam("", RSDBP_IN, DataSet.GrID);
    exec.addParam("", RSDBP_IN, REPOS_MESSAGEGENERATION);
    exec.addParam("", RSDBP_IN, ir_op.rec.Id);
    exec.execute();
  end;
*/
  RslDefCon.CommitTrans(); /*Завершить транзакцию*/

  transactionStarted = false;

  return stat;

  OnError(er)
  if( transactionStarted )
     RslDefCon.RollbackTrans();
  end;
end;

