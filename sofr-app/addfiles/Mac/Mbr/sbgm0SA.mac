/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*  Генерация подтверждения о доставке СБРФ                                 */
/*                                                                          */
/*  Создан:     12.04.04                                                    */
/*  Программист Бабин А.П.                                                  */
/****************************************************************************/

import "sbgenmes.mac";

RECORD MesInit( wlmes );

macro GenMes( addrMes, addrMesInit )
  var str;

  SetBuff( wlmes,  addrMes );
  SetBuff( MesInit, addrMesInit );  

  PrintLog(2,"Генерация сообщения по 0SA");

  ClearRecord( f_wlmesrls );
  f_wlmesrls.rlsFormID = MesInit.rlsFormID;

  if ( not GetEQ(f_wlmesrls) )
     std.msg( "Ошибка при поиске релиза "+MesInit.rlsFormID );
     return false;
  end;

  str = substr(f_wlmesrls.Name,1,3) + MesInit.TRN + "00";

  /*SB_Tag_0SA и SB_Tag_PIB - одно и тоже, GVR*/
  if ( not SB_ЗаписатьПолеЛог(SB_Tag_PIB, str) )
     std.msg( "Ошибка при записи поля " + SB_Tag_PIB );
     return false;
  end;

  return TRUE; /* успешное завершение */

  OnError(er) /* обработка ошибок */
    std.msg(String(er.Message, "|Модуль: ", er.Module, " Строка: ", er.Line));
    return false;
end;
