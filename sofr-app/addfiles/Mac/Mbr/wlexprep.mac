/*
  $Name:         wlexprep.mac
  $Module:       Œ¥¦¡ ­ª®¢áª¨¥ à áç¥âë
  $Description:  Œ ªà®á ¯¥ç â¨ ®âç¥â  íªá¯®àâ  á®®¡é¥­¨©
*/
import CTInter;
import oralib, likepy;

private const WLD_STATUS_TYPE_RESPRM:integer = 26;

private macro PrintDate( ExportDate )
  [ 
    „ â :  ########### £.
  ]( ExportDate:f );
end;
private macro PrintHead( Time, SessNum, Transp, FileName )
  [ 
    ‚à¥¬ï: ###########   
  ](  Time );

  println("  ç â á¥ ­á íªá¯®àâ  ­®¬¥à " +  SessNum + " ¯® âà ­á¯®àâã " + Transp + " ¢ ä ©« " + FileName);  
  println(" ‚ë£àã¦ ¥¬ë¥ á®®¡é¥­¨ï:");
end;

private macro PrintTableHeadPayment()
  [
    ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
    ³ ‚¨¤ ®¡ê¥ªâ          ³     ”®à¬        ³      ¥«¨§      ³         ¥ä¥à¥­á               ³  ID á®®¡é. ³   Š®«-¢®   ³  ‚ «îâ     ³  ‘ã¬¬                ³ 
    ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
  ];
end;

private macro PrintTableHead()
  [
    ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄ¿
    ³ ‚¨¤ ®¡ê¥ªâ          ³    ”®à¬         ³    ¥«¨§        ³      ¥ä¥à¥­á                  ³ ID á®®¡é.  ³  Š®«-¢®    ³ 
    ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´
  ];
end;

private macro PrintObject( Kind, FormName, RlsName, Ref, MesID, Count, NewObject, FI, Amount )
  
  if((ValType(FI) != V_UNDEF) and (ValType(Amount) != V_UNDEF)) //« â¥¦¨
    [ ³ ################### ³ ############### ³ ############### ³ ############################## ³ ########## ³ ########## ³ ########## ³ #################### ³ 
    ]( Kind,
      FormName,
      RlsName,
      Ref,
      MesID:10:0:r,
      Count:10:0:r,
      FI,
      Amount);

    if(NewObject)
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ]
    end;
  else //‚á¥ ®áâ «ì­ë¥ á®®¡é¥­¨ï
    [ ³ ################### ³ ############### ³ ############### ³ ############################## ³ ########## ³ ########## ³ 
    ]( Kind:w,
     FormName,
     RlsName,
     Ref,
     MesID:10:0:r,
     Count:10:0:r);     

    if(NewObject)
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´
    ]
  end;

  end;
end;

private macro PrintSummaryFIID( PaymCount, FIID, TotalAmount, LastOfSession )
  
  if(LastOfSession)
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ]
  end;
  
    [ ³ ˆâ®£® ¯® ¢ «îâ¥:    ³                 ³                 ³                                ³            ³ ########## ³ ########## ³ #################### ³
    ]( PaymCount:10:0:l,
       FIID,
       TotalAmount:20:2:r);  
  
  if(not LastOfSession)
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ]
  end;

end;

private macro PrintTableBottom( Count, IsPayment )
  
  if(IsPayment == true) //« â¥¦¨
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ ‚á¥£® á®®¡é¥­¨©     ³                 ³                 ³                                ³            ³ ########## ³            ³                      ³
      ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
    ]( Count:10:0:r );
  else //‚á¥ ®áâ «ì­ë¥ á®®¡é¥­¨ï
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ ‚á¥£® á®®¡é¥­¨©     ³                 ³                 ³                                ³            ³ ########## ³
      ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÙ
    ]( Count:10:0:r );
  end;
end;

private macro PrintBottomGisGmp( ResCode, PackageID, ResDescription )
  if( ResCode ) // …á«¨ ®â¯à ¢ª  ¯à®¨§¢®¤¨« áì, â® ¯®«¥ § ¯®«­¥­® ¨ ¢ë¢®¤¨¬ ¤ ­­ë¥ ¯®«ãç¥­­®£® ®â¢¥â .
    [ 
      ˆ¤¥­â¨ä¨ª â®à ¯ ª¥â : ################################
      ®«ãç¥­­ë© ®â¢¥â
              ¥§ã«ìâ â: ##### ##############################################################################################################
    ]( PackageID,
       ResCode,
       ResDescription );
  end;  
end;

private macro PrintBottom( Result )

  [    
    #########################################################################################################################################
  ](Result:w);
  
end;

macro PrintReport()
  
  var query:string =
   "SELECT NVL(wlmes.t_mesID, 0) AS MessageID, " +
   "      EXP.t_SessNumber AS SessionNumber, " +
   "      EXP.t_Time AS SessionTime, " +
   "      LEAD ( " +
   "         EXP.t_SessNumber) " +
   "      OVER ( " +
   "         ORDER BY " +
   "            EXP.T_SessNumber, " +
   "            CASE " +
   "               WHEN wlmeslnk.t_ObjKind = :OBJTYPE_PAYMENT1 " +
   "               THEN " +
   "                  pmpaym.t_BaseFIID " +
   "               ELSE " +
   "                  0 " +
   "            END, " +
   "            wlmeslnk.t_ObjID NULLS FIRST) " +
   "         AS NextSessionNumber, " +
   "      LAG ( " +
   "         EXP.t_SessNumber) " +
   "      OVER ( " +
   "         ORDER BY " +
   "            EXP.T_SessNumber, " +
   "            CASE " +
   "               WHEN wlmeslnk.t_ObjKind = :OBJTYPE_PAYMENT2 " +
   "               THEN " +
   "                  pmpaym.t_BaseFIID " +
   "               ELSE " +
   "                  0 " +
   "            END, " +
   "            wlmeslnk.t_ObjID NULLS FIRST) " +
   "         AS PreviousSessionNumber, " +
   "      LEAD ( " +
   "         fininstr.t_FI_Code) " +
   "      OVER ( " +
   "         ORDER BY " +
   "            EXP.T_SessNumber, " +
   "            CASE " +
   "               WHEN wlmeslnk.t_ObjKind = :OBJTYPE_PAYMENT3 " +
   "               THEN " +
   "                  pmpaym.t_BaseFIID " +
   "               ELSE " +
   "                  0 " +
   "            END, " +
   "            wlmeslnk.t_ObjID NULLS FIRST) " +
   "         AS NextFIIDCode, " +
   "      LAG ( " +
   "         wlmeslnk.t_ObjID) " +
   "      OVER ( " +
   "         ORDER BY " +
   "            EXP.T_SessNumber, " +
   "            CASE " +
   "               WHEN wlmeslnk.t_ObjKind = :OBJTYPE_PAYMENT4 " +
   "               THEN " +
   "                  pmpaym.t_BaseFIID " +
   "               ELSE " +
   "                  0 " +
   "            END, " +
   "            wlmeslnk.t_ObjID NULLS FIRST) " +
   "         AS PreviousObjectID, " +
   "      LEAD ( " +
   "         wlmeslnk.t_ObjID) " +
   "      OVER ( " +
   "         ORDER BY " +
   "            EXP.T_SessNumber, " +
   "            CASE " +
   "               WHEN wlmeslnk.t_ObjKind = :OBJTYPE_PAYMENT5 " +
   "               THEN " +
   "                  pmpaym.t_BaseFIID " +
   "               ELSE " +
   "                  0 " +
   "            END, " +
   "            wlmeslnk.t_ObjID NULLS FIRST) " +
   "         AS NextObjectID, " +
   "      wlmeslnk.t_ObjID AS ObjectID, " +
   "      wltransp.t_Name AS Transport, " +
   "      EXP.t_FileName AS FileName, " +
   "      wlmeslnk.t_ObjKind AS ObjectKind, " +
   "      objects.t_Name AS ObjectName, " +
   "      EXP.t_PackageID AS PackageID, " +
   "      EXP.t_GisGmpCode AS GISGMPCode, " +
   "      EXP.t_GisGmpDescr AS GISGMPDescription, " +
   "      fininstr.t_FI_Code AS FICode, " +
   "      pmpaym.t_BaseAmount AS Amount, " +
   "      SUM (pmpaym.t_BaseAmount) " +
   "         OVER (PARTITION BY EXP.T_SessNumber, pmpaym.t_BaseFIID) " +
   "         AS SumAmount, " +
   "      wlmesrls.t_Name AS RlsName, " +
   "      LAG ( " +
   "         wlmesrls.t_Name) " +
   "      OVER ( " +
   "         ORDER BY " +
   "            EXP.T_SessNumber, " +
   "            CASE " +
   "               WHEN wlmeslnk.t_ObjKind = :OBJTYPE_PAYMENT6 " +
   "               THEN " +
   "                  pmpaym.t_BaseFIID " +
   "               ELSE " +
   "                  0 " +
   "            END NULLS FIRST, " +
   "            wlmeslnk.t_ObjID) " +
   "         AS PreviousRlsName, " +
   "      wlmesfrm.t_Name AS FormName, " +
   "      LAG ( " +
   "         wlmesfrm.t_Name) " +
   "      OVER ( " +
   "         ORDER BY " +
   "            EXP.T_SessNumber, " +
   "            CASE " +
   "               WHEN wlmeslnk.t_ObjKind = :OBJTYPE_PAYMENT7 " +
   "               THEN " +
   "                  pmpaym.t_BaseFIID " +
   "               ELSE " +
   "                  0  " +
   "            END , " +
   "            wlmeslnk.t_ObjID NULLS FIRST) " +
   "         AS PreviousFormName, " +
   "      wlmes.t_TRN AS ReferenceV, " +
   "      COUNT (wlmes.t_mesid) " +
   "         OVER (PARTITION BY EXP.T_SessNumber, wlmeslnk.t_ObjID) " +
   "         AS MessagesCount, " +
   "      COUNT (DISTINCT pmpaym.t_PaymentID) " +
   "         OVER (PARTITION BY EXP.T_SessNumber, pmpaym.t_BaseFIID) " +
   "         AS PaymentsCount, " +
   "      COUNT (wlmes.t_mesid) OVER (PARTITION BY EXP.T_SessNumber) AS CountM, " +
   "      NVL ( " +
   "         LISTAGG (EXP.t_ErrMessage, ',') " +
   "            WITHIN GROUP (ORDER BY 0) " +
   "            OVER (PARTITION BY EXP.T_SessNumber), " +
   "         CHR (1)) " +
   "         AS ErrorMessages " +
   " FROM table(WLD_EXPREP.GetRecExpRepInfo()) EXP " +
   "      LEFT OUTER JOIN dwlmes_dbt wlmes ON wlmes.t_MesID = EXP.T_MesID " +
   "      LEFT OUTER JOIN dwlmeslnk_dbt wlmeslnk " +
   "         ON wlmeslnk.t_MesID = wlmes.T_MesID " +
   "      LEFT OUTER JOIN dwlpm_dbt wlpm ON wlpm.t_WlpmID = wlmeslnk.t_ObjID " +
   "      LEFT OUTER JOIN dpmpaym_dbt pmpaym " +
   "         ON     pmpaym.t_PaymentID = wlpm.t_PaymentID " +
   "            AND wlpm.t_wlpmNum = 0 " +
   "            AND wlpm.t_direct = CHR (0) " +
   "      LEFT OUTER JOIN dwltransp_dbt wltransp ON EXP.t_TpID = wltransp.t_TpID " +
   "      LEFT OUTER JOIN dobjects_dbt objects " +
   "         ON objects.t_ObjectType = wlmeslnk.t_ObjKind " +
   "      LEFT OUTER JOIN dfininstr_dbt fininstr " +
   "         ON fininstr.t_FIID = pmpaym.t_BaseFIID " +
   "      LEFT OUTER JOIN dwlmesrls_dbt wlmesrls " +
   "         ON wlmesrls.t_RlsFormID = wlmes.t_RlsFormID " +
   "      LEFT OUTER JOIN dwlmesfrm_dbt wlmesfrm " +
   "         ON wlmesfrm.t_FormID = wlmesrls.t_FormID " +   
" ORDER BY EXP.T_SessNumber, " +
   "      CASE " +
   "         WHEN wlmeslnk.t_ObjKind = :OBJTYPE_PAYMENT8 THEN pmpaym.t_BaseFIID " +
   "         ELSE 0 " +
   "      END, " +
   "      wlmeslnk.t_ObjID NULLS FIRST; ";

  PrintDate(date);

  var params:TArray = makeArray( SQLParam("OBJTYPE_PAYMENT1", OBJTYPE_PAYMENT),
                                 SQLParam("OBJTYPE_PAYMENT2", OBJTYPE_PAYMENT), 
                                 SQLParam("OBJTYPE_PAYMENT3", OBJTYPE_PAYMENT),
                                 SQLParam("OBJTYPE_PAYMENT4", OBJTYPE_PAYMENT),
                                 SQLParam("OBJTYPE_PAYMENT5", OBJTYPE_PAYMENT),
                                 SQLParam("OBJTYPE_PAYMENT6", OBJTYPE_PAYMENT),
                                 SQLParam("OBJTYPE_PAYMENT7", OBJTYPE_PAYMENT),
                                 SQLParam("OBJTYPE_PAYMENT8", OBJTYPE_PAYMENT) );
  var rs = execSQLselect( query, params );  

  var res = rs.MoveNext();

  while(rs and res)
  

    if(rs.value("MessageID") == 0)
      PrintBottom("‘¥ ­á " + rs.value("SessionNumber") + " § ¢¥àè¨«áï ­¥ã¤ ç­®. ‚ë¯®«­¥­ ®âª â\r " + rs.value("ErrorMessages"));

      while(res and (rs.value("SessionNumber") == rs.value("NextSessionNumber") ) ) // à®«¨áâë¢ ¥¬ ¢á¥ á®®¡é¥­¨ï íâ®£® á¥ ­á 
        res = rs.MoveNext();
      end;
      
      if(res)
        res = rs.MoveNext();
      end;

      continue; // ¥à¥å®¤¨¬ ­  á«¥¤ãîé¨© á¥ ­á
    end;    
    
    var Type = rs.value("ObjectKind");
    if(rs.value("SessionNumber") != rs.value("PreviousSessionNumber"))

      PrintHead(rs.value("SessionTime"), rs.value("SessionNumber"), rs.value("Transport"), rs.value("FileName"));      

      if(Type == OBJTYPE_PAYMENT)
        PrintTableHeadPayment();
      else
        PrintTableHead();
      end;

    end;

    if(Type == OBJTYPE_PAYMENT)
      PrintObject( IfThenElse((rs.value("SessionNumber") != rs.value("PreviousSessionNumber")) or (rs.value("ObjectID") != rs.value("PreviousObjectID")), rs.value("ObjectName"), ""), 
                   rs.value("FormName"), 
                   rs.value("RlsName"), 
                   rs.value("ReferenceV"), 
                   rs.value("MessageID"), 
                   IfThenElse((rs.value("SessionNumber") != rs.value("PreviousSessionNumber")) or (rs.value("ObjectID") != rs.value("PreviousObjectID")), rs.value("MessagesCount"), ""),                    
                   IfThenElse((rs.value("SessionNumber") == rs.value("NextSessionNumber")) and (rs.value("ObjectID") != rs.value("NextObjectID")), true, false),
                   rs.value("FICode"), 
                   rs.value("Amount") );
    else
      PrintObject( IfThenElse((rs.value("SessionNumber") != rs.value("PreviousSessionNumber")) or (rs.value("ObjectID") != rs.value("PreviousObjectID")), rs.value("ObjectName"), ""), 
                   rs.value("FormName"), 
                   rs.value("RlsName"), 
                   rs.value("ReferenceV"), 
                   rs.value("MessageID"), 
                   IfThenElse((rs.value("SessionNumber") != rs.value("PreviousSessionNumber")) or (rs.value("ObjectID") != rs.value("PreviousObjectID")), rs.value("MessagesCount"), ""), 
                   IfThenElse((rs.value("SessionNumber") == rs.value("NextSessionNumber")) and (rs.value("ObjectID") != rs.value("NextObjectID")), true, false)  );
    end;
  
    var CountM = rs.value("CountM");

    if(Type == OBJTYPE_PAYMENT)
      if(rs.value("SessionNumber") != rs.value("NextSessionNumber"))  
        PrintSummaryFIID( rs.value("PaymentsCount"), rs.value("FICode"), rs.value("SumAmount"), true  );
      elif(rs.value("FICode") != rs.value("NextFIIDCode"))  
        PrintSummaryFIID( rs.value("PaymentsCount"), rs.value("FICode"), rs.value("SumAmount")  );
    end;
    
    end;
        
    if(rs.value("SessionNumber") != rs.value("NextSessionNumber"))  
      if(Type == OBJTYPE_PAYMENT)
        PrintTableBottom(rs.value("CountM"), true);
      else
        PrintTableBottom(rs.value("CountM"));
      end;

      if((Type == OBJTYPE_PMGISGMP) or (Type == OBJTYPE_TRGISGMP))
        PrintBottomGisGmp( rs.value("GISGMPCode"), rs.value("PackageID"), rs.value("GISGMPDescription") );
      end;

      var Result = IfThenElse(rs.value("ErrorMessages") == "", "‘¥ ­á " + rs.value("SessionNumber") + " ¡ë« ãá¯¥è­® § ¢¥àè¥­",
                                                               "‘¥ ­á " + rs.value("SessionNumber") + " § ¢¥àè¨«áï ­¥ã¤ ç­®. ‚ë¯®«­¥­ ®âª â\r " + rs.value("ErrorMessages") );
      PrintBottom(Result);
    end;

    res = rs.MoveNext();
   
  end;
end;
