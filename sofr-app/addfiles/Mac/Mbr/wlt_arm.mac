/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*                                                                          */
/*    МАКРОС ШАГА                                                           */
/*                                                                          */
/*    Операция    : прием выписки в казначействе                            */
/*    Шаг         : Выгрузка в АРМ позиционера                              */
/*                                                                          */
/*    Проводка    : Дт:Единый счет бюджета                                  */
/*                : Кт:Неклассифицированные доходы бюджета                  */
/*                                                                          */
/*    Имя файла: wlt_arm.mac                                                */
/*    Создан:  16.11.2000                                Антон А. Бурцев    */
/****************************************************************************/

import  InsCarryDoc, OprInter, BankInter, "wldoc.mac", "wltreas.mac";

macro ExecuteStep( doc, first, KindDoc )
/*
  var stat, accUnclassified;

  RECORD d( document ) ;

  SetBuff( wlpmpaym, first ) ;

  SetBuff( d, doc ) ;
  ClearRecord( d ) ;

  /* Найти свойства платежа */
  stat = FindPayment( wlpmpaym.PaymentID, /* Индентификатор */
                      0,                 /* Purpose    */
                      0,                 /* SubPurpose */
                      0,                 /* DocKind    */
                      0,                 /* DocId      */
                      true,
                      null,              /* буфер платежа            */
                      wlpmpropdeb,       /* буфер дебетовых свойств  */
                      wlpmpropcred,      /* буфер кредитовых свойств */
                      wlpmrmprop         /* свойства R-макета */
                    ) ;
  if ( stat != 0 )
    MsgBox( "Ошибка при поиске платежа" ) ;
    return 1 ;
  end ;

  if ( FindFILinkAccount(OBJROLE_CUR_TREASURY_UNCLASSIFIED,wlpmpaym.PayFIID, accUnclassified) != 0 )
    MsgBox( "Не задан счет 'Неклассифицированные доходы бюджета'" );
    return 1;
  end;

  /* Заполняем поля документа */
  d.Chapter           = 1;
  d.Result_Carry      = AVIZOCARRY;
  d.Code_Currency     = wlpmpaym.PayFIID;
  d.Sum               = wlpmpaym.PayAmount;

  d.Account_Payer        = GetCorAcc( wlpmpaym.PayFIID, wlpmpropdeb.Corschem, CORS_ACC_ACCOUNT );
  d.Account_Receiver     = accUnclassified; /* Неклассифицированные доходы бюджета*/

  d.Kind_Oper  = " 1";
  d.Shifr_Oper = "09";

  d.Date_Carry = {curdate};
  d.Department = wlpmpaym.Department ;

  d.Ground = substr( "Зачисление доходов бюджета/"+wlpmrmprop.Ground, 1, 210 ) ;
  d.Numb_Document = wlpmrmprop.Number ;  

  if( d.Code_Currency == 0 )
    if( InsertRubDocument( NULL, PMMET_ID, wlpmpaym.PaymentID ) == FALSE )
      return 1;
    end;
  else
    if( InsertCurDocument( NULL, PMMET_ID, wlpmpaym.PaymentID ) == FALSE )
      return 1;
    end;
  end;
     */
  return 0 ;

  OnError(er) /* обработка ошибок */
    ExeptionMessage(er);
    return FALSE;

end ;