/*
  $Name:         fns365P_lib.mac
  $Module:       МБР
  $Description:  Функции для сообщений по 365-П
*/

//-----------------------------------------------------------------------------
//          Автоматизированная банковская система RS-Bank               
//                 Copyright (c) R-Style Software Lab
//
// Подсистема   : Межбанковские расчеты
//
// Описание     : Функции для сообщений по 365-П
//
// Программист  : Чукина Т.А.
//
// Создан       : 10.10.2014
//
//-----------------------------------------------------------------------------

import oralib, likepy, "xmlmestools.mac", "wlmnstls.mac";

macro СведенияОБанке(BlockName, PartyID, NewBankCode, NewBankName)

  var ErrMsg = "";

  // Get field values
  var Bank : TBankInfoAccMsg = TBankInfoAccMsg();
  if( not Bank.Fill(PartyID, @ErrMsg, true/*Is365P*/) )
    RunError(ErrMsg, ErrMsg);
  end;

  // Write fields
  StartBlockLogXML(BlockName);

  ЗаписатьПолеЛог("РегНом", Bank.РегНом);
  ЗаписатьПолеЛог("НомФил", Bank.НомФ);
  ЗаписатьПолеЛог("БИК", IfThenElse(strlen(NewBankCode) > 0, NewBankCode, Bank.БИК) );
  ЗаписатьПолеЛог("НаимБанк", IfThenElse(strlen(NewBankName) > 0, NewBankName, Bank.НаимКО) );
  ЗаписатьПолеЛог("ИННБанк", Bank.ИННКО);
  ЗаписатьПолеЛог("КППБанк", Bank.КППКО);

  FinishBlockLogXML(BlockName);
end;
