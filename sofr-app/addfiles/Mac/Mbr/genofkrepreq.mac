/*
  $Name:         genofkrepreq.mac
  $Module:       Œ
  $Description:  à®â®ª®« ¢ë¯®«­¥­¨ï ¯à®æ¥¤ãàë ä®à¬¨à®¢ ­¨ï § ¯à®á®¢ áâ âãá  ®¡à ¡®âª¨ ¯ ª¥â®¢ ¢ ƒˆ‘ ƒŒ
*/

/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : genofkrepreq.mac
  Created     : 11.08.2016
  Programmer  : ’¨¬®­¨­ „.‚.
  Description : à®â®ª®« ¢ë¯®«­¥­¨ï ¯à®æ¥¤ãàë ä®à¬¨à®¢ ­¨ï § ¯à®á®¢ áâ âãá  ®¡à ¡®âª¨ ¯ ª¥â®¢ ¢ ƒˆ‘ ƒŒ

ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
import PaymInter, oralib, likepy, globals;

private macro GetOperName( oper:integer ):string

  var fPerson = Tbfile ("person.dbt");
  var Name:string;

  ClearRecord( fPerson.rec );
  fPerson.rec.Oper = Oper;
  if( not fPerson.getEQ () )
    Name = "¥ ­ ©¤¥­ â¥ªãé¨© ¯®«ì§®¢ â¥«ì";
  else
    Name = fPerson.rec.Name;
  end;

  return Name;
end;

/*‚ë¢¥áâ¨ § £®«®¢®ª*/
private macro PrintHead(fillials, datefrom, dateto, timefrom, timeto)

   var operName:string = GetOperName( {oper} );
[
 Žâç¥â ® à¥§ã«ìâ â å ä®à¬¨à®¢ ­¨ï § ¯à®á®¢ áâ âãá  ®¡à ¡®âª¨ ¯ ª¥â®¢ ¢ ƒˆ‘ ƒŒ

 ˆá¯®«­¨â¥«ì: #### #
 ”¨«¨ «(ë):   #
 ¥à¨®¤:      á ##########£. ¯® ##########£.
 ‚à¥¬ï:       á ##### ¤® #####

 ‘ä®à¬¨à®¢ ­ë § ¯à®áë áâ âãá  ®¡à ¡®âª¨ á«¥¤ãîé¨å ¯ ª¥â®¢:
]
( {oper}, operName, fillials, datefrom, dateto, timefrom, timeto );

end;

/* ¯¥ç â âì ®âçñâ*/
macro PrintGGReport( OutsideAbonentInfoArr )
  
  var fillials, datefrom, dateto, timefrom, timeto, minuts, errmsg;

  errmsg   = pyOR(GetCachedVar( "ErrMsg" ), "");
  fillials = pyOR(GetCachedVar( "Dep" ), "");
  datefrom = pyOR(GetCachedVar( "DateBeg" ), "");
  dateto   = pyOR(GetCachedVar( "DateEnd" ), "");
  timefrom = pyOR(GetCachedVar( "TimeBeg" ), "");
  timeto   = pyOR(GetCachedVar( "TimeEnd" ), "");
  minuts   = pyOR(GetCachedVar( "minuts" ), "");

  if( (ValType( errmsg ) != V_UNDEF) and (strlen(errmsg) > 0) )
    [#](ErrMsg);
  else
    if( (ValType( minuts ) != V_UNDEF) and (int(minuts) > 0) )
      var rs_time:RsdRecordset = execSQLselect( "select ? - 1/24/60*ABS(?) from dual", makeArray(SQLParam("", timeto), SQLParam("", minuts)), FALSE );
      if(rs_time and rs_time.movenext())
        timeto = rs_time.value(0);
      end;
    end;

    PrintHead(fillials, datefrom, dateto, timefrom, timeto);

    if( valtype( OutsideAbonentInfoArr ) == V_GENOBJ )
      for( var OutsideAbonentInfo, OutsideAbonentInfoArr )
        [#]( OutsideAbonentInfo );
      end;
    end;

  end;
end;
