/*  Имя файла:  mod2095.mac                                                  */
/*  Описание:   Функция создания запроса выборки платежей,                   */ 
/*              по которым будет происходить экспорт сообщений               */
/*              Используется в модуле 2095                                   */
/*  Создан:     10.10.08                                                     */

macro СоздатьЗапрос( Corschem, FIID )
 var sql:string;

 /* Основной запрос */
 sql = " SELECT DISTINCT wlpm.t_WlPmID , wlpm.t_PropStatus, rm.t_Priority, rm.t_Instancy " + 
         " FROM dwlpm_dbt wlpm , dpmrmprop_dbt rm " + 
        " WHERE wlpm.t_Direct = chr(0) " + 
          " AND wlpm.t_PaymentID = rm.t_PaymentID " +
       string(" AND wlpm.t_PropStatus = ", 6600 /*PM_PROP_MESCONTROL*/) + " AND wlpm.t_PaymentID >= 3405615 ";
 /* Дополнительные условия */
 if( Corschem != -1 )
   sql = sql + string(" AND wlpm.t_Corschem = ", Corschem) +
               string(" AND wlpm.t_PayFIID = ", FIID);
 end;
 
 /* !!!Сортировка. Для изменения порядка сортировки создания операция, добавлять новые условия ниже */
 sql = sql + string ( " ORDER BY rm.t_Priority ASC, rm.t_Instancy DESC ");
 /*  Для отладки, запишет в файл SQL запрос */
  println (sql);

 /* Вернем созданный запрос  */
 return sql;
end;

