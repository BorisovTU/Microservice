/*
  $Name:         ufInNtf_Rep.mac
  $Module:       МБР
  $Description:  Протокол процедуры обработки уведомлений о зачислении
*/

//-----------------------------------------------------------------------------
//          Автоматизированная банковская система RS-Bank               
//                 Copyright (c) R-Style Software Lab
//
// Подсистема   : Межбанковские расчеты
//
// Описание     : Протокол процедуры обработки уведомлений о зачислении
//
// Программист  : Евграфова Л.Н.
//
// Создан       : 13.06.2018
//
//-----------------------------------------------------------------------------

import "SwitchOutput.mac", "lib_str.mac", "bnk_dttmfrmt.mac", "bnk_common.mac", 
"bnk_dirfile.mac", "wlrqcls.mac", globals;

private macro GetRepFileName : string
  var Directory : string = "..\\txtfile\\";

  macro GetFileName() : string
    var DDDDDD : string = DDMMYY(date()),
        ЧЧMMСС : string = TimeToStr(time(), "HHMISS"),
        NNNN : string = GetLastSymbols( strLpad(string({oper}), 4, "0"), 4 );

    var FName : string = "PROCESS_ED244_" + DDDDDD + "_" + ЧЧMMСС + "_" + NNNN + ".txt";

    return Directory + FName;
  end;

//begin
  var FName : string = GetFileName();

  // если название совпадет с точностью до секунды, пробуем еще раз
  while( FileExists(FName) )
    FName = GetFileName();
  end;

  return FName;
end;


class (TSwitchOutput) TUfInNtfReport
  InitTSwitchOutput( GetRepFileName() );

  macro PrintRepHeader()
     Печать_ОтчетСканирования( 1, NULL, 0, "" )
  end;

  macro PrintTableRow( ReqID, stat )
    var Msg = "";
    if( stat != 0 )
      Msg = GetErrMsg();
    end;    
    f_wlreq.ReqID = ReqID;
    if( GetEQ(f_wlreq) )
       Copy( wlreq, f_wlreq );
    end;
    Печать_ОтчетСканирования( 0, NULL, stat, Msg )
  end;

  macro PrintTableBottom
    Печать_ОтчетСканирования( 2, NULL, 0, "" )
  end;
end;
