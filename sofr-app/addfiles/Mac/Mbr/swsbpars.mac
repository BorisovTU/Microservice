/****************************************************************************/
/*                   R-Style Software Lab, RS-Bank v6                       */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*                      Разбор сообщений SWIFT-SB                           */
/*                                                                          */
/*  Имя файла: swsbpars.mac                                                 */
/*  Создан:  12.03.04                                         Панов А.Б.    */
/****************************************************************************/
import "swsbtls.mac", "swparser.mac";

macro Read32E(stream, Count, MacroFill)
  var Cur;

  if (ReadCur(stream, Count, Cur))
    return ExecMacro2(MacroFill, Cur);
  else
    return FALSE;
  end;
end;

macro Read12(Stream, Count, MacroFill)
  var MesFrm;
  
  if( StrmGetLexeme(Stream, Count, MesFrm, TS_ALPNUM, TL_FIXED, 3))
    PrintLog(3, "Read12: " + MesFrm);
    SetParm(1, Count); /* запись в 1-й аргумент!*/
    return ExecMacro2(MacroFill, MesFrm);
  end;
  return FALSE;
end;

macro ReadDC(Stream, Count, MacroFill)
  var DKFlag;
  
  if( StrmGetLexeme(Stream, Count, DKFlag, TS_ALPHA, TL_FIXED, 1))
    PrintLog(3, "ReadDC: " + DKFlag);
    SetParm(1, Count); /* запись в 1-й аргумент!*/
    return ExecMacro2(MacroFill, DKFlag);
  end;
  return FALSE;
end;

macro ReadRT(Stream, Count, MacroFill)
  var RT;
  
  if( StrmGetLexeme(Stream, Count, RT, TS_ALPNUM, TL_FIXED, 4))
    PrintLog(3, "ReadRT: " + RT);
    SetParm(1, Count); /* запись в 1-й аргумент!*/
    return ExecMacro2(MacroFill, RT);
  end;
  return FALSE;
end;
macro Read11SB(Stream, Count, MacroFill)
  var str = "", InitDate, FormName;
  if( StrmGetLexeme( Stream, Count, str, TS_ALPNUM, TL_MAX, 10 ) )
    PrintLog(3,"Read11: "+str);
    SetParm( 1, Count ); /* запись в 1-й аргумент!*/
    FormName = substr( str, 1, 3 );
    if ( strlen(str)>9 )
       InitDate = YYMMDD2Date( substr(str,5,6) );    
    else
       InitDate = YYMMDD2Date( substr(str,4,6) );    
    end;
    return ExecMacro2( MacroFill, FormName, InitDate );
  end;
  return FALSE;
end;

macro Read77ASB( Stream, Count, MacroFill )
  var Str = "";

  if( StrmGetLexeme( Stream, Count, Str, TS_ALLSET, TL_BLOCK, 20, 35 ) )
    PrintLog(3,"Read77A: "+Str);
    /*Count = 1;*/
    SetParm( 1, Count ); /* запись в 1-й аргумент!*/
    return ExecMacro2( MacroFill, Str );
  end;
  return FALSE;
end;

macro Read70SB( Stream, Count, MacroFill )
  var Str = "";
  if( StrmGetLexeme( Stream, Count, Str, TS_ALLSET, TL_BLOCK, 4, 35 ) )
    PrintLog(3,"Read70: "+Str);
    SetParm( 1, Count ); /* запись в 1-й аргумент!*/
    return ExecMacro2( MacroFill, Str );
  end;
  return FALSE;
end;

macro Read72SB( Stream, Count, MacroFill )
  var Str = "", Narrative = "";

  if( StrmGetLexeme( Stream, Count, Str, TS_ALLSET, TL_BLOCK, 6, 35 ) )
    PrintLog(3,"Read72: "+Str);
    SetParm( 1, Count ); /* запись в 1-й аргумент!*/
    return ExecMacro2( MacroFill, Str, Narrative );
  end;
  return FALSE;
end;
