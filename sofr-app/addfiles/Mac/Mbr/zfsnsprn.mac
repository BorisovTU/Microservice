 /*
 $Name: zfsnsprn.mac
 $Module: МБР
 $Description: Печать справки о наличии счетов для ФСС
 */
import "fnsprzall.mac";

private var FondName = "",
            FondAdress = "",
            BankName = "",
            RecDate,
            RecNum = 0,
            ClientName = "",
            ClientRegNumPFR = "",
            ClientSubCode = "",
            Account = "",
            AccType = 0,
            AccFI = "",
            AccRest = 0.0,
            OpenDate = 0,
            CloseDate = 0,
            AccNotFound = false,
            Op = "",
            AccountNO = 0,
            RepDay = 0,
            RepMonth = 0,
            RepYear = 0,
            OfficerBank = "",
            Name = "",
            Date,
            RDate;

private macro PrintHeader( this:FNSPrint )

  array FondNameArr;
  array BankINN;
  array BankKPP;
  array BIC;
  array RegNum;
  array SubCode;
  array ClientINN;
  array ClientKPP;
  var INN;
  var BankBIC = {MFO_Bank};
  INN = ПолучитьКодСубъекта( this.RepBankID, PTCK_INN );
  StrSplit( FondName, FondNameArr, 50, 50, 2 );
  StrSplit( RemoveKPP( INN ), BankINN, 1, 1, 10 );
  StrSplit( RemoveINN( INN ), BankKPP, 1, 1, 9  );
  StrSplit( BankBIC, BIC, 1, 1, 9 );
  StrSplit( ClientRegNumPFR, RegNum, 1, 1, 13);
  StrSplit( ClientSubCode, SubCode, 1, 1, 5 );
  StrSplit( this.ИНННП, ClientINN, 1, 1, 12 );
  StrSplit( this.КППНП, ClientKPP, 1, 1, 9 );
  
  [                                                                                                                       Приложение №2
                                                                                                                              к приказу
                                                                                                          Фонда социального страхования
                                                                                                                   Российской Федерации
                                                                                                                от 2 ноября 2017г. №539
                                                                                                                
                                                                                      ##################################################          
                                                                                      ──────────────────────────────────────────────────
                                                                                          (наименование территориального органа Фонда
                                                                                      ##################################################
                                                                                      ──────────────────────────────────────────────────
                                                                                           социального страхования Российской Федерации)
  ]( FondNameArr[0], FondNameArr[1] );
                                                                                            
  PrintSplitLine( FondAdress );
  [                                                                                                    (адрес места нахождения)         ];
  [                                                                                            
                                                                                              
                                                          Справка о наличии счетов
                                                        


     Банк (иная кредитная организация) (филиал банка (иной кредитной организации) 
     #######################################################################################################################
     ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                    (полное фирменное или сокращенное фирменное наименование банка (иной кредитной организации)
     (филиала банка (иной кредитной организации) в соответствии с Книгой государственной регистрации кредитных организаций)
          ┌─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐                     ┌─┬─┬─┬─┬─┬─┬─┬─┬─┐
     ИНН  │#│#│#│#│#│#│#│#│#│#│                 КПП │#│#│#│#│#│#│#│#│#│
          └─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘                     └─┴─┴─┴─┴─┴─┴─┴─┴─┘
     
          ┌─┬─┬─┬─┬─┬─┬─┬─┬─┐
     БИК  │#│#│#│#│#│#│#│#│#│
          └─┴─┴─┴─┴─┴─┴─┴─┴─┘
     
     В соответствии с запросом территориального органа Фонда социального страхования Российской
     Федерации от ############ № ###############
                  ────────────   ───────────────
     в отношении #######################################################################################################################
                 ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                                    (полное наименование организации, Ф.И.О. индивидуального предпринимателя)

    Регистрационный номер            ┌─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐                  ┌─┬─┬─┬─┬─┐    
    в территориальном органе Фонда   │#│#│#│#│#│#│#│#│#│#│#│#│#│    Код           │#│#│#│#│#│ 
    социального страхования          └─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘    подчиненности └─┴─┴─┴─┴─┘ 
    Российской Федерации
                                                               
             ┌─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐        ┌─┬─┬─┬─┬─┬─┬─┬─┬─┐
    ИНН/КИО  │#│#│#│#│#│#│#│#│#│#│#│#│    КПП │#│#│#│#│#│#│#│#│#│
             └─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘        └─┴─┴─┴─┴─┴─┴─┴─┴─┘
  ]( BankName,
     BankINN[0],BankINN[1],BankINN[2],BankINN[3],BankINN[4],BankINN[5],BankINN[6],BankINN[7],BankINN[8],BankINN[9],
     BankKPP[0],BankKPP[1],BankKPP[2],BankKPP[3],BankKPP[4],BankKPP[5],BankKPP[6],BankKPP[7],BankKPP[8],
     BIC[0],BIC[1],BIC[2],BIC[3],BIC[4],BIC[5],BIC[6],BIC[7],BIC[8],
     RecDate,
     RecNum,
     ClientName,
     RegNum[0],RegNum[1],RegNum[2],RegNum[3],RegNum[4],RegNum[5],RegNum[6],RegNum[7],RegNum[8],RegNum[9],RegNum[10],RegNum[11],RegNum[12],
     SubCode[0],SubCode[1],SubCode[2],SubCode[3],SubCode[4],
     ClientINN[0],ClientINN[1],ClientINN[2],ClientINN[3],ClientINN[4],ClientINN[5],ClientINN[6],ClientINN[7],ClientINN[8],ClientINN[9],ClientINN[10],ClientINN[11],
     ClientKPP[0],ClientKPP[1],ClientKPP[2],ClientKPP[3],ClientKPP[4],ClientKPP[5],ClientKPP[6],ClientKPP[7],ClientKPP[8]
     )
end;

private macro PrintTableHeader( AccYes )
                                                                                                                   
  [                                                                                                                  ┌─┐
     1. Представляет информацию о счетах, открытых в банке (иной кредитной организации (филиале                      │#│
      банка (иной кредитной организации)) указанному лицу                                                            └─┘
      
     ┌─────────────────────────────────┬─────────────────────────┬────────────────────────────────┬─────────────┬─────────────┐
     │              1                  │            2            │                 3              │      4      │      5      │
     ├─────────────────────────────────┼─────────────────────────┼────────────────────────────────┼─────────────┼─────────────┤
     │                                 │                         │   цифровой код валюты счета    │дата открытия│дата закрытия│
     │          номер счета            │        вид счета        │(в соответствии с Общероссийским│    счета    │    счета    │
     │                                 │                         │     классификатором валют)     │  (дд.мм.гг) │  (дд.мм.гг) │
  ](AccYes);      
  
end;

private macro PrintTableBottom()
  [  └─────────────────────────────────┴─────────────────────────┴────────────────────────────────┴─────────────┴─────────────┘
  ];
end;

private macro PrintTable( this:FNSPrint )
  
  var Account,
      AccType,
      AccFI,
      AccRest;
  var i = 0;
  if( this.Счет.size == 0 )
    PrintTableHeader("");
  
  [  ├─────────────────────────────────┼─────────────────────────┼────────────────────────────────┼─────────────┼─────────────┤  
     │             -                   │           -             │               -                │      -      │      -      │
  ];
    PrintTableBottom();
    return;
  end;

  
  PrintTableHeader("X");
  while( i < this.Счет.size )
  [  ├─────────────────────────────────┼─────────────────────────┼────────────────────────────────┼─────────────┼─────────────┤
     │   #########################     │#########################│              ###               │  ########## │  ########## │
  ](this.Счет[i].rec.Account:c,
    this.Счет[i].rec.TypeAcc:c,
    GetFICode( this.Счет[i].rec.Code_Currency ):c,
    this.Счет[i].rec.Open_Date:c,
    this.Счет[i].rec.Close_Date:c
  );
  i = i + 1;
  end;
  
  PrintTableBottom();

end;

private macro PrintAbsence( this:FNSPrint )
  var AccNo = "";
  if( this.Счет.size == 0 )
    AccNo = "X";
  end;
                                                                                                                   
  [                                                                                                                  ┌─┐
     2. Сообщает об отсутствии счетов в банке (иной кредитной организации) (филиале банка (иной                      │#│
      кредитной организации) у указанного лица                                                                       └─┘
  ](AccNo);
  
end;

private macro PrintBottom( this:FNSPrint )

[ 
  
   Указанная информация предоставляется по состоянию на "##" ######## ####г.
                                                         ──  ──────── ────
   
   Уполномоченный представитель банка (иной кредитной организации) (филиала банка (иной кредитной
   организации)
                            ###################################  ##################################################              ##########
                            ───────────────────────────────────  ──────────────────────────────────────────────────  ──────────  ──────────
                                        (должность)                                   (Ф.И.О)                         (подпись)     (дата)
                                        
                                                                                             М.П. (при наличии)
  ]( substr(YYYYMMDD(Date),7,2):c,
     Месяца(substr(YYYYMMDD(Date),5,2)):c,
     substr(YYYYMMDD(Date),1,4):c,
     OfficerBank:c,
     Name:c,
     Date:c    
    );

end;

macro PrintReportInfoAboutExistenceAccounts( this:FNSPrint, ReqDate:date )
  record wlregdec(wlregdec);
  wlregdec.DecisionID = this.WlRegDecID;
  GetEQ(wlregdec);
  FondName = this.НаимНО;
  FondAdress = ReadNoteForObject(525, makeObjectID(525, NULL, wlregdec), 3 );
  
  var rs = execSQLSelect( "Select t_Name from dparty_dbt where t_PartyID = " + int(this.RepBankID) );
  if( rs.MoveNext() )
    BankName = rs.value(0);
  end;
  RecDate = this.ДатаЗапроса;
  RecNum = this.НомерЗапроса;
  ClientName = this.НаимНП;
  if( strlen(this.ClientRegNum) > 0 )
    ClientRegNumPFR = this.ClientRegNum;
  end;
  if( strlen(this.ClientSubCode) > 0 )
    ClientSubCode = this.ClientSubCode;
  end;
  RDate = ReqDate;
  GetRegistryValue( "PS\\ФОНДЫ_СПРАВКИ_ВЫПИСКИ\\СПРАВКИ_ФОНДЫ_ДОЛЖ", V_STRING, OfficerBank );
  GetRegistryValue( "PS\\ФОНДЫ_СПРАВКИ_ВЫПИСКИ\\СПРАВКИ_ФОНДЫ_ФИО", V_STRING, Name );
  Date = {curdate};
  
  PrintHeader( this );
  PrintTable( this );
  PrintAbsence( this );
  PrintBottom( this );
  return 0;
end;
