/*
 $Name:        wlrqcls.mac
 $Module:      MBR
 $Description: Отчет о групповом перемещении запросов в закрытые
*/
/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*   Печать отчета об обработке запросов                                    */
/*                                                                          */
/*  Имя файла: wlrqback.mac                                                 */
/*  Создан:    27.06.03                                     Бабин А.П.      */
/****************************************************************************/

import "wldoc.mac";

const Ошибка   = 0,
      Первый   = 1,
      Последний= 2;

MACRO Печать_ОтчетСканирования( Вызов, firstdoc, Статус, Сообщение )
  var stat, Номер, note;

  if(firstdoc != NULL)
     setbuff (wlreq, firstdoc);
  end;

  if( Вызов == Первый )
    [                                                                               ];
    [   Отчет о групповой обработке запросов/ответов                                ];
    [   Дата обработки: ##########  ########                                        ](date:f, time);
    [   Операционист:   #####                                                       ]({oper});
    [                                                                               ];
    [+-----------------------------+------+------------------------------------------------------------+];
    [|         Номер               |Номер |                 Сообщение                                  |];
    [|   учетного объекта          |ошибки|                                                            |];
    [+-----------------------------+------+------------------------------------------------------------+];
  elif( Вызов == Ошибка )
    if( Статус == 0 )
      if (wlreq.Kind==MESKIND_ANSWER )
         Сообщение = "Обработка ответа выполнена успешно.";
      else
         note = readNoteForObject( OBJTYPE_REQ, makeObjectID( OBJTYPE_REQ, NULL, wlreq ), 1/*NOTEKIND_WLDREQ_ERRDESCRIPTION*/ );
         Сообщение = note + IfThenElse( note, "", "Обработка запроса выполнена успешно.", "" );
      end;
    end;    
    Сообщение = Сообщение + "\n" + GetFNSInfMassProcessWarning();
    [|#############################|######|############################################################|](wlreq.TRN,Статус,StrSubst(Сообщение, "|", " " ):w);
  elif (Вызов==Последний)
    [+-----------------------------+------+------------------------------------------------------------+];
  end;
end;