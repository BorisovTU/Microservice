/*
  $Name: ufpr807.mac
  $Module: Œ¥¦¡ ­ª®¢áª¨¥ à áç¥âë
  $Description: ¥ç â­ ï ä®à¬  á®®¡é¥­¨ï ED807 âà ­á¯®àâ  “”‘
*/


import oralib, MesInter, wlglobal, wluftool, WLTOOLS, WldInter, rsexts, bnk_common, ufgd807, bnk_dirfile;


private macro GetPrtKindNameKind( numberKind ):string
  var NameKind = "";
  var select = " select t_NameKind " +  
               " from ddprtkind_dbt " +  
               " where t_NumberKind = :numberKind"; 

  var params = makeArray( SQLParam( "numberKind", numberKind ) );
                        
  var rs = execSQLselect( select, params );
  
  if( rs and rs.moveNext() )
    NameKind = rs.value( "t_NameKind" );
  end;

  return NameKind;
end;

private macro PrintTableInfo( ED807MessageFields: TED807MessageFields )
  const MaxInfoTypeCodeDescrRequisiteLength = 70;
  var RepType = "";
  if( ED807MessageFields.InfoTypeCode == "FIRR" )
    RepType = "®«­ë© ‘¯à ¢®ç­¨ª ˆŠ";
  elif( ED807MessageFields.InfoTypeCode == "SIRR" )
    RepType = "ˆ§¬¥­¥­¨ï, ¢­¥á¥­­ë¥ ¢ ‘¯à ¢®ç­¨ª ˆŠ";
  end;

  [
    ED807 ##################################################

    ®¬¥à C:     #########
    „ â  C:     ##########
    ‘®áâ ¢¨â¥«ì: ########## ##################################################
  ]( RepType,
     ED807MessageFields.EDNo, 
     DDpMMpYYYY(ED807MessageFields.EDDate), 
     ED807MessageFields.EDAuthor, 
     Bnk_GetPartyName( ®«ãç¨âìŠ®¤‘ã¡ê¥ªâ ( ED807MessageFields.EDAuthor, PTCK_UIS, null ) )
   );

  if( ED807MessageFields.EDReceiver != "" )
    [ ®«ãç â¥«ì:  ########## ##################################################
    ]( ED807MessageFields.EDReceiver, 
       Bnk_GetPartyName( ®«ãç¨âìŠ®¤‘ã¡ê¥ªâ ( ED807MessageFields.EDReceiver, PTCK_UIS, null ) ) 
     );
  end;

  [ Š®¤ ¯à¨ç¨­ë ä®à¬¨à®¢ ­¨ï: #### ################################################################################
    „ â  ¨ ¢à¥¬ï á®§¤ ­¨ï:  #########################
  ]( ED807MessageFields.CreationReason, 
     GetWlcodeDescription( TYPE_CODE_UFBS_ED807_CREATIONREASON, ED807MessageFields.CreationReason ), 
     ED807MessageFields.CreationDateTime
   );

    var InfoTypeCodeDescr = GetWlcodeDescription( TYPE_CODE_UFBS_ED807_INFOTYPECODE, ED807MessageFields.InfoTypeCode );
    if( strlen( InfoTypeCodeDescr ) <= MaxInfoTypeCodeDescrRequisiteLength )
      [ ‚¨¤ ¯à¥¤áâ ¢«¥­¨ï ¨­ä®à¬ æ¨¨: #### ################################################################################
      ]( ED807MessageFields.InfoTypeCode,
         GetWlcodeDescription( TYPE_CODE_UFBS_ED807_INFOTYPECODE, ED807MessageFields.InfoTypeCode )
       );
    else
      var tmpReqValArr = StrSplit2( InfoTypeCodeDescr, MaxInfoTypeCodeDescrRequisiteLength );
      var arrItr = 0;
      while( arrItr < tmpReqValArr.size )
        if( arrItr == 0 )
          [ ‚¨¤ ¯à¥¤áâ ¢«¥­¨ï ¨­ä®à¬ æ¨¨: #### ################################################################################
          ]( ED807MessageFields.InfoTypeCode,
             tmpReqValArr[ArrItr]:l
           );
        else
          [                                    ################################################################################
          ]( tmpReqValArr[ArrItr]:l
           );
        end;
        arrItr = arrItr + 1;
      end;
    end;

  if( ED807MessageFields.PartInfo != null )
    [

    
      ˆ­ä®à¬ æ¨ï ® ç áâ¨:
           ®¬¥à ç áâ¨: ###### 
           Š®«¨ç¥áâ¢® ç áâ¥©: ###### 
           ˆ¤¥­â¨ä¨ª â®à á®¢®ªã¯­®áâ¨ ç áâ¥©: ##############################
    ]( ED807MessageFields.PartInfo.PartNo :r, 
       ED807MessageFields.PartInfo.PartQuantity :r, 
       ED807MessageFields.PartInfo.PartAggregateID 
     );
  end;

  if( ED807MessageFields.InitialED != null )
    [
      ˆ­ä®à¬ æ¨ï ®¡ ¨áå®¤­®¬ ‘ˆ‘:
           ®¬¥à ‘: #########
           „ â  ‘: ##########
           ‘®áâ ¢¨â¥«ì: ########## ##################################################
    ]( ED807MessageFields.InitialED.EDNo, 
       DDpMMpYYYY(ED807MessageFields.InitialED.EDDate), 
       ED807MessageFields.InitialED.EDAuthor,
       Bnk_GetPartyName( ®«ãç¨âìŠ®¤‘ã¡ê¥ªâ ( ED807MessageFields.InitialED.EDAuthor, PTCK_UIS, null ) ) 
     );
  end;

end;



private macro PrintBICDataElementFromXML( BICDirectoryEntry )
  const MaxRequisiteLength = 56;
  const MaxChangeTypeTextRequisiteLength = 70;
  var arrItr = 0;
  var tmpReqValArr;
  var child : object = null;
  var i : integer = 0;
  var stat : bool = false;

  if( valtype(BICDirectoryEntry) == V_UNDEF )
    return;
  end;


  var ChangeType : string = "";
  var BIC : string = "";

  child = null;
  i = 0;
  while( i < BICDirectoryEntry.attributes.length )
    child = BICDirectoryEntry.attributes.item(i);

    if( child and (child.nodeType == ATTR_NODE) )
      if( GetNodeName( child.NodeName ) == "BIC" )
        BIC = child.NodeValue;
      elif( GetNodeName( child.NodeName ) == "ChangeType" )
        ChangeType = child.NodeValue;
      end;
    end;
    i = i + 1;
  end;

  if( BIC != "" )
    [ “ç áâ­¨ª ˆŠ (BIC):  #########
    ]( BIC );
  end;

  if( ChangeType != "" )
    var ChangeTypeText = Bnk_GetLLValuesName( OBJTYPE_TYPE_LAST_CHANGE_PARTICIPANTS_PS_BR, ChangeType );
    if( strlen( ChangeTypeText ) <= MaxChangeTypeTextRequisiteLength )
      [ ’¨¯ ¨§¬¥­¥­¨ï (ChangeType):  #### ######################################################################
      ]( 
         ChangeType, 
         ChangeTypeText
       );
    else
      tmpReqValArr = StrSplit2( ChangeTypeText, MaxChangeTypeTextRequisiteLength );
      arrItr = 0;
      while( arrItr < tmpReqValArr.size )
        if( arrItr == 0 )
          [ ’¨¯ ¨§¬¥­¥­¨ï (ChangeType):  #### ######################################################################
          ]( 
             ChangeType, 
             tmpReqValArr[ArrItr]:l
           );
        else
          [ ’¨¯ ¨§¬¥­¥­¨ï (ChangeType):  ###########################################################################
          ]( tmpReqValArr[ArrItr]:l );
        end;
        arrItr = arrItr + 1;
      end;
    end;
  end;


  /*ParticipantInfo*/
  var NameP:                       string = "", /* ¨¬¥­®¢ ­¨¥ ãç áâ­¨ª */
      EnglName:                    string = "", /* ¨¬¥­®¢ ­¨¥ ãç áâ­¨ª  ­   ­£«¨©áª®¬ ï§ëª¥*/
      RegN:                        string = "", /*¥£¨áâà æ¨®­­ë© ¯®àï¤ª®¢ë© ­®¬¥à*/
      CntrCd:                      string = "", /*Š®¤ áâà ­ë*/
      Rgn:                         string = "", /*Š®¤ â¥àà¨â®à¨¨*/
      Ind:                         string = "", /*ˆ­¤¥ªá*/
      Tnp:                         string = "", /*’¨¯ ­ á¥«¥­­®£® ¯ã­ªâ */
      Nnp:                         string = "", /* ¨¬¥­®¢ ­¨¥ ­ á¥«¥­­®£® ¯ã­ªâ */
      Adr:                         string = "", /*€¤à¥á*/
      PrntBIC:                     string = "", /*ˆŠ £®«®¢­®© ®à£ ­¨§ æ¨¨*/
      DateIn:                      date = date(0,0,0),   /*„ â  ¢ª«îç¥­¨ï ¢ á®áâ ¢ ãç áâ­¨ª®¢ ¯¥à¥¢®¤ */
      DateOut:                     date = date(0,0,0),   /*„ â  ¨áª«îç¥­¨ï ¨­ä®à¬ æ¨¨ ®¡ ãç áâ­¨ª¥*/
      PtType:                      string = "", /*’¨¯ ãç áâ­¨ª  ¯¥à¥¢®¤ */
      Srvcs:                       string = "", /*„®áâã¯­ë¥ á¥à¢¨áë ¯¥à¥¢®¤  ¤¥­¥¦­ëå áà¥¤áâ¢*/
      XchType:                     string = "", /*“ç áâ­¨ª ®¡¬¥­ */
      UID:                         string = "", /*“ˆ‘*/
      NPSParticipant:              string = "", /*à¨§­ ª ãç áâ¨ï ¢ ‘ */
      ToNPSDate:                   date = date(0,0,0),   /*„ â  ¢ª«îç¥­¨ï ¢ á¯¨á®ª ãç áâ­¨ª®¢ ‘ */
      ParticipantStatus:           string = ""; /*‘â âãá ãç áâ­¨ª */

  var ParticipantInfoNode : object = null;
  var isSWBICSExists = false;
  var isAccountsExists = false;
  var isRstrListExists = false;

  i = 0;
  child = null;
  stat = false;
  while( i < BICDirectoryEntry.childNodes.length )
    child = BICDirectoryEntry.childNodes.item(i);
    if( GetNodeName( child.NodeName ) == "ParticipantInfo" )
      ParticipantInfoNode = child;
      var PIChild = null;
      var piItr = 0;
      while( piItr < ParticipantInfoNode.attributes.length )
        PIChild = ParticipantInfoNode.attributes.item(piItr);
        if( PIChild and (PIChild.nodeType == ATTR_NODE) )
          if( GetNodeName( PIChild.NodeName ) == "NameP" )
            NameP = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "EnglName" )
            EnglName = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "RegN" )
            RegN = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "CntrCd" )
            CntrCd = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "Rgn" )
            Rgn = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "Ind" )
            Ind = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "Tnp" )
            Tnp = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "Nnp" )
            Nnp = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "Adr" )
            Adr = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "PrntBIC" )
            PrntBIC = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "DateIn" )
            DateIn = ToDate( PIChild.NodeValue );
          elif( GetNodeName( PIChild.NodeName ) == "DateOut" )
            DateOut = ToDate( PIChild.NodeValue );
          elif( GetNodeName( PIChild.NodeName ) == "PtType" )
            PtType = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "Srvcs" )
            Srvcs = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "XchType" )
            XchType = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "UID" )
            UID = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "NPSParticipant" )
            NPSParticipant = PIChild.NodeValue;
          elif( GetNodeName( PIChild.NodeName ) == "ToNPSDate" )
            ToNPSDate = ToDate( PIChild.NodeValue );
          elif( GetNodeName( PIChild.NodeName ) == "ParticipantStatus" )
            ParticipantStatus = PIChild.NodeValue;
          end;
        end;
        piItr = piItr + 1;
      end;
    elif( GetNodeName( child.NodeName ) == "SWBICS" )
      isSWBICSExists = true;
    elif( GetNodeName( child.NodeName ) == "Accounts" )
      isAccountsExists = true;
    end;
    i = i + 1;
  end;

  [ ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿ 
    ³ „ ­­ë¥ ®¡ ãç áâ­¨ª¥                                                                                          ³    
  ];

  if( strlen( NameP ) <= MaxRequisiteLength )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ NameP              ³  ¨¬¥­®¢ ­¨¥                 ³ ######################################################## ³    
    ]( NameP );
  else
    tmpReqValArr = StrSplit2( NameP, MaxRequisiteLength );
    arrItr = 0;
    while( arrItr < tmpReqValArr.size )
      if( arrItr == 0 )
        [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
          ³ NameP              ³  ¨¬¥­®¢ ­¨¥                 ³ ######################################################## ³    
        ]( tmpReqValArr[ArrItr]:l );
      else
        [ ³                    ³                              ³ ######################################################## ³    
        ]( tmpReqValArr[ArrItr]:l );
      end;
      arrItr = arrItr + 1;
    end;
  end;

  if( EnglName != "" )
    if( strlen( EnglName ) <= MaxRequisiteLength )
      [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
        ³ EnglName           ³  ¨¬¥­®¢ ­¨¥ ­               ³ ######################################################## ³
        ³                    ³  ­£«¨©áª®¬                   ³                                                          ³      
      ]( EnglName );
    else
      tmpReqValArr = StrSplit2( EnglName, MaxRequisiteLength );
      arrItr = 0;
      while( arrItr < tmpReqValArr.size )
        if( arrItr == 0 )
          [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
            ³ EnglName           ³  ¨¬¥­®¢ ­¨¥ ­               ³ ######################################################## ³
          ]( tmpReqValArr[ArrItr]:l );
        elif( arrItr == 1 )
          [ ³                    ³  ­£«¨©áª®¬                   ³ ######################################################## ³      
          ]( tmpReqValArr[ArrItr]:l );
        else
          [ ³                    ³                              ³ ######################################################## ³    
          ]( tmpReqValArr[ArrItr]:l );
        end;
        arrItr = arrItr + 1;
      end;
    end;
  end;

  if( RegN != "" )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ RegN               ³ ¥£¨áâà æ¨®­­ë© ­®¬¥à        ³ #########                                                ³      
    ]( RegN );
  end;

  [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ³ UID                ³ “ˆ‘                          ³ ##########                                               ³
  ]( UID );

  if( PrntBIC != "" )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ PrntBIC            ³ ˆŠ ƒ                       ³ #########                                                ³
    ]( PrntBIC );
  end;

  [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ 
    ³ „ ­­ë¥ ®¡  ¤à¥á¥ ãç áâ­¨ª                                                                                    ³
    ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
  ];

  if( CntrCD != "" )
    [ ³ CntrCD             ³ Š®¤ áâà ­ë                   ³ ##                                                       ³
      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ]( CntrCD );
  end;

  if( Rgn != "" )
    [ ³ Rgn                ³ Š®¤ â¥àà¨â®à¨¨               ³ ##                                                       ³      
      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ]( Rgn );
  end;

  if( Ind != "" )
    [ ³ Ind                ³ ˆ­¤¥ªá                       ³ ######                                                   ³
      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ]( Ind );
  end;

  if( Tnp != "" )
    [ ³ Tnp                ³ ’¨¯ ­ á¥«¥­­®£® ¯ã­ªâ        ³ #####                                                    ³      
      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ]( Tnp );
  end;

  if( Nnp != "" )
    [ ³ Nnp                ³  ¨¬¥­®¢ ­¨¥                 ³ #########################                                ³
      ³                    ³ ­ á¥«¥­­®£® ¯ã­ªâ            ³                                                          ³      
      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ]( Nnp );
  end;

  if( strlen( Adr ) <= MaxRequisiteLength )
    [ ³ Adr                ³ €¤à¥á                        ³ ######################################################## ³
    ]( Adr );
  else
    tmpReqValArr = StrSplit2( Adr, MaxRequisiteLength );
    arrItr = 0;
    while( arrItr < tmpReqValArr.size )
      if( arrItr == 0 )
        [ ³ Adr                ³ €¤à¥á                        ³ ######################################################## ³
        ]( tmpReqValArr[ArrItr]:l );
      else
        [ ³                    ³                              ³ ######################################################## ³    
        ]( tmpReqValArr[ArrItr]:l );
      end;
      arrItr = arrItr + 1;
    end;
  end;

  [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ 
    ³ “ç áâ¨¥ ¢ ®¡¬¥­¥                                                                                             ³
  ];

  var XchTypeText = Bnk_GetLLValuesName( OBJTYPE_PARTICIPANTS_EXCHANGE, XchType );

  if( strlen( XchTypeText ) <= MaxRequisiteLength )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ XchType            ³ “ç áâ­¨ª ®¡¬¥­               ³ # ###################################################### ³
    ]( XchType,
       XchTypeText );
  else
    tmpReqValArr = StrSplit2( XchTypeText, MaxRequisiteLength );
    arrItr = 0;
    while( arrItr < tmpReqValArr.size )
      if( arrItr == 0 )
        [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
          ³ XchType            ³ “ç áâ­¨ª ®¡¬¥­               ³ # ###################################################### ³
        ]( XchType,
           tmpReqValArr[ArrItr]:l );
      else
        [ ³                    ³                              ³ ######################################################## ³
        ]( tmpReqValArr[ArrItr]:l );
      end;
      arrItr = arrItr + 1;
    end;
  end;
  
  i = 1;
  var PtTypeArr = TArray();
  PtTypeArr = StrSplit2(GetPrtKindNameKind( PtType ), 53);
    
  [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ³ PtType             ³ ’¨¯ ãç áâ­¨ª                 ³ ## ##################################################### ³
  ]( PtType,
     PtTypeArr[0]);
     
  while( i < PtTypeArr.size )
    [ ³                    ³                              ³    ##################################################### ³
    ](PtTypeArr[i]);
    i = i + 1;
  end;
  i = 0;

  [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ³ Srvcs              ³ ‘¥à¢¨áë                      ³ # ###################################################### ³
  ]( Srvcs,
     Bnk_GetLLValuesName( OBJTYPE_AVAIL_TRANSL_SERV_MONEY, Srvcs ) );

  [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ³ DateIn             ³ „ â  ¢ª«îç¥­¨ï               ³ ##########                                               ³
  ]( DDpMMpYYYY( DateIn ) );

  if( DateOut != date(0,0,0) )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ DateOut            ³ „ â  ¨áª«îç¥­¨ï              ³ ##########                                               ³
    ]( DDpMMpYYYY( DateOut ) );
  end;
  
  if ( NPSParticipant != "" )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ NPSParticipant     ³ à¨§­ ª ãç áâ. ¢ ‘        ³ #                                                        ³
    ]( NPSParticipant );
  end;
  
  if( ToNPSDate != date(0,0,0) )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ ToNPSDate          ³ „ â  ¢ª«îç¥­¨ï ¢ ‘        ³ ##########                                               ³
    ]( DDpMMpYYYY( ToNPSDate ) );
  end;

  if( ParticipantStatus != "" )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ ParticipantStatus  ³ ‘â âãá ãç áâ­¨ª              ³ #### ################################################### ³
    ]( ParticipantStatus,
       Bnk_GetLLValuesName( OBJTYPE_STATUS_PARTICIPANT, ParticipantStatus ) );
  end;

  var DirectParticipantAccountBIC = "";
  var DirectParticipantAccountAccount = "";

  i = 0;
  child = null;
  stat = false;
  while( i < ParticipantInfoNode.childNodes.length )
    child = ParticipantInfoNode.childNodes.item(i);
    if( GetNodeName( child.NodeName ) == "DirectParticipantAccount" )
      var dpaChild = null;
      var dpaItr = 0;
      while( dpaItr < child.attributes.length )
        dpaChild = child.attributes.item(dpaItr);
        if( dpaChild and (dpaChild.nodeType == ATTR_NODE) )
          if( GetNodeName( dpaChild.NodeName ) == "BIC" )
            DirectParticipantAccountBIC = dpaChild.NodeValue;
          elif( GetNodeName( dpaChild.NodeName ) == "Account" )
            DirectParticipantAccountAccount = dpaChild.NodeValue;
          end;
        end;
        dpaItr = dpaItr + 1;
      end;
    elif( GetNodeName( child.NodeName ) == "RstrList" )
      isRstrListExists = true;
    end;
    i = i + 1;
  end;

  if( (DirectParticipantAccountBIC != "") or (DirectParticipantAccountAccount != "") )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ 
      ³ „ ­­ë¥ ¯àï¬®£® ãç áâ­¨ª  (DirectParticipantAccount)                                                          ³
      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ BIC                ³ ˆŠ ¯àï¬®£® ãç áâ­¨ª         ³ #########                                                ³
      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³ Account            ³ ‘ç¥â ¯àï¬®£® ãç áâ­¨ª        ³ ####################                                     ³
    ]( DirectParticipantAccountBIC,
       DirectParticipantAccountAccount );
  end;

  if( isRstrListExists or isSWBICSExists or isAccountsExists )
    [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
    ];
  else
    [ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
    ];
  end;

  if( isRstrListExists )
    [ ³ ¥à¥ç¥­ì ®£à ­¨ç¥­¨© ãç áâ­¨ª  (RstrList)                                                                    ³
      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³                Š®¤ ®£à ­¨ç¥­¨ï (Rstr)                ³            „ â  ­ ç «  ¤¥©áâ¢¨ï (RstrDate)            ³
    ];

    i = 0;
    child = null;
    stat = false;
    while( i < ParticipantInfoNode.childNodes.length )
      child = ParticipantInfoNode.childNodes.item(i);
      if( GetNodeName( child.NodeName ) == "RstrList" )
        var rlChild = null;
        var rlItr = 0;
        var Rstr = "";
        var RstrDate = date(0,0,0);
        while( rlItr < child.attributes.length )
          rlChild = child.attributes.item(rlItr);
          if( rlChild and (rlChild.nodeType == ATTR_NODE) )
            if( GetNodeName( rlChild.NodeName ) == "Rstr" )
              Rstr = rlChild.NodeValue;
            elif( GetNodeName( rlChild.NodeName ) == "RstrDate" )
              RstrDate = ToDate( rlChild.NodeValue );
            end;
          end;
          rlItr = rlItr + 1;
        end;
        [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
          ³ #### ############################################### ³ ##########                                            ³       
        ]( Rstr,
           Bnk_GetLLValuesName( OBJTYPE_RESTR_TRANSL_SERV_MONEY, Rstr ),
           DDpMMpYYYY( RstrDate )
         );
      end;
      i = i + 1;
    end;

    if( isSWBICSExists or isAccountsExists )
      [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ];
    else
      [ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
      ];
    end;
  end;

  if( isSWBICSExists )
    [ ³ ¥à¥ç¥­ì ˆŠ (‘”ˆ”’), á®®â¢¥âáâ¢ãîé¨å ãç áâ­¨ªã (SWBICS)                                                     ³
      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
      ³         BIC SWIFT, áâ ­¤ àâ ˆ‘ 9362 (SWBIC)         ³              ® ã¬®«ç ­¨î (DefaultSWBIC)              ³
    ];

    i = 0;
    child = null;
    stat = false;
    var DefaultSWBIC = "";
    var SWBIC = "";
    while( i < BICDirectoryEntry.childNodes.length )
      DefaultSWBIC = "";
      SWBIC = "";
      child = BICDirectoryEntry.childNodes.item(i);
      if( GetNodeName( child.NodeName ) == "SWBICS" )
        var SwbChild : object = null;
        var swbItr = 0;
        while( swbItr < child.attributes.length )
          SwbChild = child.attributes.item(swbItr);
          if( SwbChild and (SwbChild.nodeType == ATTR_NODE) )
            if( GetNodeName( SwbChild.NodeName ) == "SWBIC" )
              SWBIC = SwbChild.NodeValue;
            elif( GetNodeName( SwbChild.NodeName ) == "DefaultSWBIC" )
              DefaultSWBIC = SwbChild.NodeValue;
            end;
          end;
          swbItr = swbItr + 1;
        end;
        [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
          ³ ###########                                          ³ #                                                     ³       
        ]( SWBIC,
           DefaultSWBIC
         );
      end;
      i = i + 1;
    end;
               

    if( isAccountsExists )
      [ ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ ];         
    else
      [ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ ];
    end;
  end;
                         
  if( isAccountsExists )
    var itr = 0;

    var wasAccRstrList = false;

    [ ³ ˆ­ä®à¬ æ¨ï ® áç¥â å ãç áâ­¨ª  (Accounts)                                                                     ³ ];

    var Account:               string = "", /*®¬¥à áç¥â */
        RegulationAccountType: string = "", /*’¨¯ áç¥â */
        CK:                    string = "", /*Š®­âà®«ì­ë© ª«îç*/
        AccountCBRBIC:         string = "", /*ˆŠ , ®¡á«ã¦¨¢ îé¥£® áç¥â ãç áâ­¨ª  ¯¥à¥¢®¤ */
        AccDateIn:             date = date(0,0,0), /*„ â  ®âªàëâ¨ï áç¥â */
        AccDateOut:            date = date(0,0,0), /*„ â  ¨áª«îç¥­¨ï ¨­ä®à¬ æ¨¨ ® áç¥â¥ ãç áâ­¨ª */
        AccountStatus:         string = ""; /*‘â âãá áç¥â */
     
    i = 0;
    child = null;
    stat = false;

    var accsItr = 0;
    
    while( i < BICDirectoryEntry.childNodes.length )
      child = BICDirectoryEntry.childNodes.item(i);
      if( GetNodeName( child.NodeName ) == "Accounts" )
        accsItr = accsItr + 1;
        var accChild : object = null;
        var accItr = 0;
        while( accItr < child.attributes.length )
          accChild = child.attributes.item(accItr);
          if( accChild and (accChild.nodeType == ATTR_NODE) )
            if( GetNodeName( accChild.NodeName ) == "Account" )
              Account = accChild.NodeValue;
            elif( GetNodeName( accChild.NodeName ) == "RegulationAccountType" )
              RegulationAccountType = accChild.NodeValue;
            elif( GetNodeName( accChild.NodeName ) == "CK" )
              CK = accChild.NodeValue;
            elif( GetNodeName( accChild.NodeName ) == "AccountCBRBIC" )
              AccountCBRBIC = accChild.NodeValue;
            elif( GetNodeName( accChild.NodeName ) == "DateIn" )
              AccDateIn = ToDate( accChild.NodeValue );
            elif( GetNodeName( accChild.NodeName ) == "DateOut" )
              AccDateOut = ToDate( accChild.NodeValue );
            elif( GetNodeName( accChild.NodeName ) == "AccountStatus" )
              AccountStatus = accChild.NodeValue;
            end;
          end;
          accItr = accItr + 1;
        end; // while( accItr < child.attributes.length )

        if( accsItr == 1 )
          [ ÀÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ ];
        elif( wasAccRstrList )
          [   ÚÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ ];
        else
          [   ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ ];
        end;

        wasAccRstrList = false;

        [   ³ ‘ç¥â (Account) ####################                                                                        ³
            ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
            ³ RegulationAccountType ³ ‘ç¥â ¯àï¬®£® ãç áâ­¨ª        ³ #### ############################################## ³
        ]( Account,
           RegulationAccountType,
           Bnk_GetLLValuesName( OBJTYPE_TYPE_ACCOUNT_STANDARD, RegulationAccountType )
         );           

        if( CK != "" )
          [   ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
              ³ CK                    ³ Š®­âà®«ì­ë© ª«îç             ³ ##                                                  ³
          ]( CK );           
        end;
        [   ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
            ³ AccountCBRBIC         ³ ˆŠ                       ³ #########                                           ³
            ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
            ³ DateIn                ³ „ â  ®âªàëâ¨ï                ³ ##########                                          ³
        ]( AccountCBRBIC,
           DDpMMpYYYY( AccDateIn ) );

        if( AccDateOut != date(0,0,0) )
          [   ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
              ³ DateOut               ³ „ â  ¨áª«îç¥­¨ï              ³ ##########                                          ³
          ]( DDpMMpYYYY( AccDateOut ) );
        end; 

        if( AccountStatus != "" )
          [   ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
              ³ AccountStatus         ³ ‘â âãá áç¥â                  ³ #### ############################################## ³
          ]( AccountStatus,
             Bnk_GetLLValuesName( OBJTYPE_STATUS_ACCOUNT, AccountStatus ) );

        end;
              
        var isAccRstrListExists = false;
                
        var AccRstr = "";
        var AccRstrDate : date = date(0,0,0);
                     
        accChild = null;
        accItr = 0;
        while( accItr < child.childNodes.length )
          accChild = child.childNodes.item(accItr);
          if( GetNodeName( accChild.NodeName ) == "AccRstrList" )
            isAccRstrListExists = true;
            if( accItr == 0 )
              [   ÀÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´ 
                    ³ ¥à¥ç¥­ì ®£à ­¨ç¥­¨© ®¯¥à æ¨© ¯® áç¥âã (AccRstrList)                                                     ³
                    ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                    ³              Š®¤ ®£à ­¨ç¥­¨ï (AccRstr)             ³         „ â  ­ ç «  ¤¥©áâ¢¨ï (AccRstrDate)          ³
              ];
            end;
            var accAChild : object = null;
            var accAItr = 0;
            while( accAItr < accChild.attributes.length )
              accAChild = accChild.attributes.item(accAItr);

              if( accAChild and (accAChild.nodeType == ATTR_NODE) )
                if( GetNodeName( accAChild.NodeName ) == "AccRstr" )
                  AccRstr = accAChild.NodeValue;
                elif( GetNodeName( accAChild.NodeName ) == "AccRstrDate" )
                  AccRstrDate = ToDate( accAChild.NodeValue );
                end;
              end;
              accAItr = accAItr + 1;
            end; // while( accAItr < accChild.attributes.length )

            var AccRstrText = "";
            GetElementAndNoteLLVALUES(OBJTYPE_SIGN_RESTR_TRANSACTIONS_ACCOUNT, AccRstr, null, AccRstrText, null);

              [     ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                    ³ #################################################  ³ ##########                                          ³       
              ]( AccRstr + " " +
                 AccRstrText : w,
                 DDpMMpYYYY( AccRstrDate ) );

          end; // if( GetNodeName( accChild.NodeName ) == "AccRstrList" )
          accItr = accItr + 1;
          wasAccRstrList = true;
        end; // while( accItr < child.childNodes.length )  
               
      end; // if( GetNodeName( child.NodeName ) == "Accounts" )
      i = i + 1;
    end;  // while( i < BICDirectoryEntry.childNodes.length )

        if( not isAccRstrListExists )
          [   ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ 
          ];
        end;

    if( isAccRstrListExists )
      [     ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ 
      ];
    end;

  end; // if( isAccountsExists )

end;

// ‚¥àá¨ï ¬ ªà®á , ­ ¯àï¬ãî à ¡®â îé ï á XML
private macro PrintTableElementsFromXML( XmlObj )
  var isXmlExists = false;

  var i : integer = 0;
  var child : object = null;
  var stat : bool = false;
  var ED807Node : object = null;


  if( valtype(XmlObj) != V_UNDEF )
    i = 0;
    child = null;
    stat = false;
    while( i < XmlObj.childNodes.length )
      child = XmlObj.childNodes.item(i);
      if( child and (child.nodeType == CHILD_NODE) and (GetNodeName( child.NodeName ) == "ED807") )    
        isXmlExists = true;
        ED807Node = child;
      end;      
      i = i + 1;
    end;
  end;


  if( not isXmlExists )
    [ 
      
      ˆ­ä®à¬ æ¨ï ® § ¯¨áïå ¢ á¯à ¢®ç­¨ª¥ ˆŠ, ¯®áâã¯¨¢è ï ¢ ¡ ­ª á ¤ ­­ë¬ ‘, 
      ­¥ ¬®¦¥â ¡ëâì ¢ë¢¥¤¥­ , â.ª. ã¤ «¥­ xml-ä ©« á®®¡é¥­¨ï
    ];
  else
    [ 
      
      ‡€ˆ‘ˆ ‚ ‘€‚—ˆŠ… ˆŠ
      ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    ];

    i = 0;
    child = null;
    stat = false;

    var isBICDirectoryEntryExists = false;
    var itr = 0;

    while( i < ED807Node.childNodes.length )
      child = ED807Node.childNodes.item(i);
      if( child and (child.nodeType == CHILD_NODE) and (GetNodeName( child.NodeName ) == "BICDirectoryEntry") )    

        Bnk_ToRSTrace( "PrintBICDataElement", "Begin", "EntryID = " + itr );

         PrintBICDataElementFromXML( child );
         [ 

         ];

         itr = itr + 1;

        Bnk_ToRSTrace( "PrintBICDataElement", "End", "EntryID = " + itr );

        isBICDirectoryEntryExists = true;
      end;      
      i = i + 1;
    end;

    if( not isBICDirectoryEntryExists )
      [ ¥â á¢¥¤¥­¨© ®¡ ¨§¬¥­¥­¨ïå ¢ ‘¯à ¢®ç­¨ª¥ ˆŠ ];
    end;

  end;

end;

macro PrintForm( addrMes, MassCopy )

  Bnk_ToRSTrace( "PrintForm807", "Begin", "" );

  var stat = false;
  var FileDirectory = Bnk_GetTxtFileDir();
  var XmlObj : object = ActiveX("Microsoft.XMLDOM");   

  SetBuff( wlmes, addrMes );
  
  FILE MsgTmpFile() txt;
  var MsgTmpFileName, OldName;
  
  // ¥à¥­ ¯à ¢«ï¥¬ ¢ë¢®¤ á®®¡é¥­¨ï ¢ ä ©«, çâ®¡ë ¯à¨ ¬­®£®ªà â­®© ¯¥ç â¨ ¨á¯®«ì§®¢ âì ¤ ­­ë¥
  //------------------------------------------ 
  MsgTmpFileName = GetTxtFileName("tmpmsprn");
  OldName = SetOutPut( MsgTmpFileName );

  if( not open(MsgTmpFile, MsgTmpFileName) )
    std.msg( String("” ©« ­¥ ®âªàëâ:", "|", MsgTmpFileName) );
    return FALSE;
  end;

  var ImageID = 0;
  var sWlMesID : string = makeObjectID( OBJTYPE_MES, null, wlmes );

  ImageID = Bnk_GetImageID( OBJTYPE_MES, sWlMesID, WLD_MES_IMGTYPE_XML_FILE );

  if( ImageID )
    /* ‡ ¯¨áë¢ ¥¬ ¯à¨ªà¥¯«¥­­ë© ED807 ¢® ¢à¥¬¥­­ë© XML-ä ©« */
    var tmpXMLFileName = FileDirectory + "\\" + wlmes.TRN + ".xml";
    stat = WEB_ShowImageByID( ImageID, tmpXMLFileName );
    if( not stat )
      XmlObj = null;
    else
      if ( not XmlObj.load( tmpXMLFileName ) )
        std.msg( "¥¢¥à­ë© ä®à¬ â á®®¡é¥­¨ï" );
        return FALSE;
      end;
    end;
    /* “¤ «ï¥¬ ¢à¥¬¥­­ë© XML-ä ©« á ED807 */
    RemoveFile( tmpXMLFileName );
  else
    XmlObj = null;
  end;

  var ED807MessageFields = TED807MessageFields();

  Bnk_ToRSTrace( "ReadED807MessageFields", "Begin", "" );                                                      

  //ReadED807MessageFields( @ED807MessageFields, XmlObj );
  ReadED807MessageFields( @ED807MessageFields );

  Bnk_ToRSTrace( "ReadED807MessageFields", "End", "" );                                                      

  PrintTableInfo( ED807MessageFields );

  
  Bnk_ToRSTrace( "PrintTableElements", "Begin", "" );                                                      

  // PrintTableElements( ED807MessageFields );
  PrintTableElementsFromXML( XmlObj );

  Bnk_ToRSTrace( "PrintTableElements", "End", "" );                                                      

  // ¥à¥­ ¯à ¢«ï¥¬ ¢ë¢®¤ ®¡à â­®
  //------------------------------------------
  SetOutPut( OldName, true ); 
  while( MassCopy != 0 )
    rewind( MsgTmpFile );
    while( next(MsgTmpFile) )
      println( MsgTmpFile.str );
    end;
    MassCopy = MassCopy - 1;
  end;
  close( MsgTmpFile ); 

  Bnk_ToRSTrace( "PrintForm807", "End", "" );                                                      

  return true;

  OnError(er)
    ExeptionMessage(er);
    return false;
end;
