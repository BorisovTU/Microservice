/*
  $Name:         wlpaym.mac
  $Module:       МБР
  $Description:  Макрофункции для работы с платежами
*/
/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/* Макрофункции для работы с платежами                                      */
/*                                                                          */
/*  Имя файла: wlpaym.mac                                                   */
/*  Создан:  18.08.00                                        Алешин А.В.    */
/****************************************************************************/

import "wldoc.mac";
import "cb_FillFactura.mac";

/*
 return 0;        // никаких действий после работы макросы не делать
 return UPDTREC   // обновить в скролле текущюю запись
 return UPDTPAGE  // обновить страницу скроллла         
*/
macro Функция_Пользователя(Режим)
  if (Режим == UFN_PANEL_INPUT)
    // функция вызвана из панели ввода объекта
  end;
  if (Режим == UFN_PANEL_EDIT)
    // функция вызвана из панели корректировки объекта  
  end;
  if (Режим == UFN_SCROL)
    // функция вызвана из панели скроллинга, единичный вызов (read-only)  
  end;
  return 0;
end;

/* Установка подсказки оптимизатору ORACLE */

private const Hint_ByPropStatus  :string = 
"/*+FIRST_ROWS LEADING(t pmpaym pmrmprop inprop outprop) INDEX(t dwlpm_dbt_idx3) INDEX(pmpaym dpmpaym_dbt_idx0) USE_NL(t pmpaym pmrmprop inprop outprop)*/";

private const Hint_ByValueDate   :string = 
"/*+FIRST_ROWS LEADING(t pmpaym pmrmprop inprop outprop) INDEX(t dwlpm_dbt_idx2) INDEX(pmpaym dpmpaym_dbt_idx0) USE_NL(t pmpaym pmrmprop inprop outprop)*/";

private const Hint_ByTransferDate:string = 
"/*+FIRST_ROWS LEADING(inprop t pmpaym pmrmprop outprop) INDEX(inprop dpmprop_dbt_idx1) INDEX(pmpaym dpmpaym_dbt_idx0) INDEX(t dwlpm_dbt_idx1) USE_NL(inprop t pmpaym pmrmprop outprop)*/";

private const Hint_ByCloseDate   :string = 
"/*+FIRST_ROWS LEADING(pmpaym t pmrmprop inprop outprop) INDEX(pmpaym dpmpaym_dbt_idx15) INDEX(t dwlpm_dbt_idx1) USE_NL(pmpaym t pmrmprop inprop outprop)*/";

MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStates:integer ):string

  /* Возможные значения ScrolStates
     15 - Все
     16 - Принятые
     17 - Проконтролированные
     18 - Сквитованные
     20 - Невыясненные
     21 - Закрытые
  */

  /* Принятые, Сквитованные, Невыясненные */
  if( ( ScrolStates == 16 ) or
      ( ScrolStates == 18 ) or
      ( ScrolStates == 20 ) )
    
    return Hint_ByPropStatus;

  /* Все, Закрытые */
  elif( ( ScrolStates == 15 ) or
        ( ScrolStates == 21 ) )
  
    var dtflt:PMScrolDateFltr = PMScrolDateFltr();

    if( dtflt.IsSet( DTFL_TRANSFERDATE ) )
      return Hint_ByTransferDate;
    elif( dtflt.IsSet( DTFL_VALUEDATE ) )
      return Hint_ByValueDate;
    elif( dtflt.IsSet( DTFL_CLOSEDATE ) )
      return Hint_ByCloseDate;
    else
      return Hint_ByPropStatus;
    end;
    
  end;

  return DefaultHint;

END;