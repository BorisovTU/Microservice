/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank v6                       */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/* Генерация сообщения по SWIFT-SB MTn99                                    */
/*                                                                          */
/*  Имя файла: swsgmn99.mac                                                 */
/*  Создан:  18.03.04                                        Панов А.Б.     */
/****************************************************************************/
import "swsbgmes.mac";

macro GenMes(addrMes, addrInfo)
  var field_value, mes_id:integer, mes_date:date, mes_direct:string;

  SetBuff(wlmes,  addrMes);
  SetBuff(wlInfo, addrInfo);

  PrintLog(2,"Генерация сообщения по МТn99");

  /* SN - уникальный системный номер сообщения в СМФР */
  ЗаписатьПолеЛог(УникальныйНомерСообщенияСМФР, wlmes.TRN);

  /* RN - уникальный системный номер исходного сообщения в СМФР */
  if( (wlInfo.RelatedRef != "") and (wlInfo.RelatedRef != СсылкаОтсутствует) )
    ЗаписатьНомерСвязанногоСообщения_SB( wlinfo.RelatedRef, mes_id, mes_date, mes_direct, false );
  end;

  /* 20 - номер транзакции (документа) */
  ЗаписатьПолеЛог( TransactionReferenceNumberField, wlmes.TRN );

  /* 21 Related Reference */
  if( wlInfo.RelatedRef != "" )
    ЗаписатьПолеЛог( RelatedReferenceField, wlInfo.RelatedRef );  
  else
    ЗаписатьПолеЛог( RelatedReferenceField, СсылкаОтсутствует);
  end;

  /* 79 Narrative Description */
  StrMultyToFormat(ПрочитатьТекстИнфСообщения( wlinfo ), field_value, 50, 35);
  ЗаписатьПолеЛог(NarrativeDescriptionField, field_value);

  return TRUE; /* успешное завершение */

  OnError(er) /* обработка ошибок */
    ExeptionMessage(er);
    return false;
end;