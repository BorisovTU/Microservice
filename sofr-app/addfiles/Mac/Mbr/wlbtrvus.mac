/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*                                                                          */
/* Сканирование Btrieve-файла                                               */
/*                                                                          */
/*  Создан:     15.09.00                                                    */
/*  Программист Бурцев А.А.                                                 */
/****************************************************************************/


const WLD_US_SIMP = 0; /* Не присылать сообщения инициализации/деинициализации */
const WLD_US_COMP = 1; /*    Присылать сообщения Инициализации/деинициализации */

const WLD_US_STDG = 0; /* Использовать стандартную функцию "получить первую/следующую запись" */

/* Сообщения в обработчике */
const WLD_US_INIT = 0; /* Инициализация     */
const WLD_US_HAND = 1; /* Обработать запись */
const WLD_US_DONE = 2; /* Постобработка     */

/*
Если GetFirst == WLD_US_STDG - используется Next(dbt)
Если GetNext  == WLD_US_STDG - используется Next(dbt)
*/
macro WldBtrvUniScan(
                      GetFirst, /* получиь первую запись.    GetFirst(dbt, parm) */
                      GetNext,  /* получиь следующую запись. GetNext (dbt, parm) */
                      Handler,  /* Обработчик Handler( dbt, parm, mes)           */
                      dbt,      /* Btrieve файл                                  */
                      parm,     /* Пользовательские параметры                    */
                      mode      /* Режим. присылать/неприсылать INIT/DONE        */
                    )

   var stat;

   if ( mode == WLD_US_COMP ) ExecMacro2(Handler, dbt, parm, WLD_US_INIT); end;

   if ( ValType(GetFirst) == V_INTEGER )
      stat = Next(dbt);
   else
      stat = ExecMacro2(GetFirst, dbt, parm);
   end;

   if ( stat )
      
      stat = ExecMacro2(Handler, dbt, parm, WLD_US_HAND);
      if ( stat != 0 ) stat = false;
      else stat = true;
      end;

      while(stat and ExecMacro2(GetNext, parm))

         if ( ValType(GetNext) == V_INTEGER )
            stat = Next(dbt);
         else
            stat = ExecMacro2(GetNext, dbt, parm);
         end;

         if ( stat ) 
            stat = ExecMacro2(Handler, dbt, parm, WLD_US_HAND);
            if ( stat != 0 ) stat = false; end;
         end;

      end;

   end;

   if ( mode == WLD_US_COMP ) ExecMacro2(Handler, dbt, parm, WLD_US_DONE); end;
   
end;
