/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*  Пример макроса формирования референса по буферу учетного объекта        */
/*                                                                          */
/*  Имя файла: wlref.mac                                                    */
/*  Создан:  23.03.00                                        Алешин А.В.    */
/****************************************************************************/

record deal (dl_tick);
record dealm (wldlmm);

import "wldoc.mac";

macro GenRef( Value, ObjKind, AddrBuf )
  var Number;

  SetBuff( wlpmpaym, AddrBuf );

  FindPayment( wlpmpaym.PaymentID, 0, 0, 0, 0, true, 0, 0, 0, wlpmrmprop );

  Number = wlpmrmprop.Number;
  if ( ObjKind == 102 )
      SetBuff(deal,AddrBuf);
      return string(deal.dealcode);
  elif ( ObjKind ==512 )
      SetBuff(dealm,AddrBuf);
      return string(dealm.dealcode) ;
  end;
  return string( "MBR-", Number, "-", Value );

end;

