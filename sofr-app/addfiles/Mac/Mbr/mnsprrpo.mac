/*
$Name:               mnsprrpo.mac
$Module:            МБР
$Description:      Сообщение о приостановлении операций по счетам налогоплательщика
*/

import "likepy.mac", "fnsreadmall.mac", "wlglobal.mac";

private class (MessageReader) PrintRPO
  var НаимНП = "",
      ФИОИП = "",
      НаимЮЛ = "",
      Фамилия = "",
      Имя = "",
      Отчество = "",
      ИНННП = "",
      ИННЮЛ = "",
      ИННФЛ = "",
      ИННИП = "",
      КППНП = "",
      КПП = "",
      АдрНП = "",
      НомРешПр = "",
      ДатаРешВзыск = "",
      НомРешВзыск = "",
      ДатаРешПр = "",
      ДатаПодп = "",
      НаимНО = "",
      КласЧинРук = "",
      КласЧин = "",
      ФИОРук = "",
      НаимПрич = "",
      Обстоят = "",
      НаимКО = "",
      НаимБ  = "",
      СумВзыск = 0.0,
      КодОснов = "",
      AccKindList = TArray(),
      AccList = TArray();
  macro ВидСч(value)
    AccKindList[AccKindList.size] = value;
  end;
  macro НомСч(value)
    AccList[AccList.size] = value;
  end;
  macro _ConvertBlock_(name)
    if (name == "ПлИП")
      ФИОИП = Фамилия + " " + Имя + " " + Отчество;
    elif (name == "Руководитель")
      ФИОРук = Фамилия + " " + Имя + " " + Отчество;
    end;
  end;
  macro _Normalize_()
    if (ДатаРешПр == "")
      ДатаРешПр = DDpMMpYYYY(ToDateYYYY_MM_DD(ДатаПодп));
    end;
    if (КласЧинРук == "")
      КласЧинРук = КласЧин;
    end;
    ДатаРешВзыск = ConvertToDDpMMpYYYY(ДатаРешВзыск);
    if (НаимНП == "")
      НаимНП = НаимЮЛ;
    end;
    if (ИНННП == "")
      ИНННП = ИННЮЛ;
    end;
    if (ИНННП == "")
      ИНННП = ИННФЛ;
    end;
    if (ИНННП == "")
      ИНННП = ИННИП;
    end;
    if (КППНП == "")
      КППНП = КПП;
    end;
    if (НаимКО == "")
      НаимКО = НаимБ;
    end;

  end;
end;

macro Draw( RPO : PrintRPO )
  var Client, AccString = "", person;
  var i = 1;

  file wlsess(wlsess);
  file f_person(person);
  
  Client = pyOR(RPO.НаимНП, RPO.ФИОИП) + ", " + RPO.ИНННП + IfThenElse(RPO.КППНП != "", "/"+RPO.КППНП, "") 
           + ", " + RPO.АдрНП;

  if (0 < RPO.AccList.Size)
    AccString = RPO.AccKindList[0] + " " + RPO.AccList[0];
    while( i < RPO.AccList.Size )
      AccString = AccString + ", " + RPO.AccKindList[i] + " " + RPO.AccList[i];
      i = i + 1;
    end;
  end;

  wlsess.SessionID = wlmes.SessionID;
  if( not GetEQ(wlsess) )
    msgbox( "Не найден сеанс: SessionID = " + wlmes.SessionID );
    return false;
  end;

  f_person.Oper = wlsess.UserID;
  if( not GetEQ(f_person) )
    msgbox( "Не найден операционист: Oper = " + wlsess.UserID );
    return false;
  end;

  file f_party(party);
  f_party.PartyID = f_person.PartyID;
  GetEQ(f_party);

  var BankName = substr(RPO.НаимКО, 1, 200);
  var sTaxInsDir : string = RPO.НаимНО + ", " + RPO.КласЧинРук + ", " + RPO.ФИОРук;
  var TaxInsDir : TArray = StrSplit2( sTaxInsDir, 120, 33, 2 );
  var НаимПрич : TArray = StrSplit2( RPO.НаимПрич, 120, 34, 3 );
  
  var M1 = "",
      M2 = "",
      M3 = "",
      M4 = "",
      M5 = "",
      M6 = "";
      
  if(RPO.КодОснов == "01")
    M1 = "X";
  elif(RPO.КодОснов == "02")
    M2 = "X";
  elif(RPO.КодОснов == "03")
    M3 = "X";
  elif(RPO.КодОснов == "04")
    M4 = "X";
  elif(RPO.КодОснов == "05")
    M5 = "X";
  elif(RPO.КодОснов == "06")
    M6 = "X";
  end;

  [ 
                                                    Решение N #
                                                             ────────
                                   о приостановлении операций по счетам налогоплательщика
                             (плательщика сбора, плательщика страховых взносов, налогового агента) в банке,
                                       а также переводов электронных денежных средств

                                                        "##" ######## #### г.
    ────────────────────────────                        ─────────────────────
         (населенный пункт)

    Руководитель (заместитель руководителя) #
                                           ──────────────────────────────────
                                            (наименование налогового органа,
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                                                  классный чин, Ф.И.О.)
  ]
  ( RPO.НомРешПр,
    substr(RPO.ДатаРешПр,9,2),
    Месяца(substr(RPO.ДатаРешПр,6,2)):c,
    substr(RPO.ДатаРешПр,1,4),
    TaxInsDir[0],
    TaxInsDir[1]
  );

  if(TaxInsDir.size > 2)
    for(i, 2, TaxInsDir.size - 1)

  [ #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  ](TaxInsDir[i]);

    end;
  end;
  [ 
    рассмотрев обстоятельства, связанные с
    ┌─┐
    │#│ - неисполнением требования об уплате налога, сбора, страховых взносов, пени, штрафа, процентов;
    └─┘
    ┌─┐
    │#│ - непредставлением налоговой декларации в налоговый орган в течение десяти рабочих дней по ис-
    └─┘ течении установленного срока её представления;
    ┌─┐
    │#│ - обеспечением возможности исполнения решения о привлечении к ответственности за совершение
    └─┘ налогового правонарушения или решения об отказе в привлечении к ответственности за совершение
     налогового правонарушения;    
    ┌─┐
    │#│ - неисполнением налогоплательщиком-организацией установленной пунктом 5.1 статьи 23 Налого-
    └─┘ вого кодекса Российской Федерации обязанности по передаче налоговому органу квитанции о прие-
     ме требования о представлении документов, требования о представлении пояснений и (или) уведомле-
     ния о вызове в налоговый орган - в течение десяти рабочих дней со дня истечения срока, установленно-
     го для передачи налогоплательщиком-организацией квитанции о приеме документов, направленных на-
     логовым органом;
    ┌─┐
    │#│ - неисполнением налогоплательщиком-организацией установленной пунктом 5.1 статьи 23 Налого-
    └─┘ вого кодекса Российской Федерации обязанности по обеспечению получения от налогового органа 
     по месту нахождения организации (по месту учета организации в качестве крупнейшего налогоплатель-
     щика) документов в электронной форме по  телекоммуникационным каналам связи через оператора
     электронного документооборота - в течение десяти рабочих дней со дня установления налоговым орга-
     ном факта неисполнения налогоплательщиком-оргнизацией такой обязанности;
    ┌─┐
    │#│ - непредставление налоговым агентом расчета сумм налога на доходы физических лиц, исчислен-
    └─┘ ных и удержанных налоговым агентом;
  ](M1,
    M2,
    M3,
    M4,
    M5,
    M6);
  [ рассмотрев обстоятельства, связанные с #
                                          ──────────────────────────────────────────────────────────────────────────────────────
                                                  (неисполнением требования об уплате налога, сбора, пени, штрафа;
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    непредставлением налоговой декларации в налоговый орган в течение десяти рабочих дней по истечении установленного срока ее
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    представления; обеспечением возможности исполнения решения о привлечении к ответственности за совершение налогового 
    правонарушения или решения об отказе в привлечении к ответственности за совершение налогового правонарушения)
  ]
  ( НаимПрич[0],
    НаимПрич[1],
    НаимПрич[2]
  );
  [
     #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                                    (полное наименование организации (Ф.И.О индивидуального
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
             предпринимателя, нотариуса, занимающегося частной практикой, адвоката, учредившего адвокатский кабинет) 
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                       - налогоплательщика (плательщика сбора, плательщика страховых взносов, налогового агента), ИНН/КПП, адрес)
                       

                                                           УСТАНОВИЛ:
     #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    (излагаются обстоятельства существа установленного факта нарушения с указанием номера и даты направленного налогоплательщику
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    (плательщику сбора, плательщику страховых взносов, налоговому агенту) требования об уплате налога, сбора, страховых взносов,
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    пени, штрафа, процентов, вынесенного решения налогового органа о взыскании за счет денежных средств на счетах налогоплательщика
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    (плательщика сбора, плательщика страховых взносов, налогового агента) в банках, а также электронных денежных средств, ссылок на
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    нормы законодательства о налогах и сборах, устанавливающие сроки представления налоговой декларации, исполнения обязанности
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    по уплате налогов, сборов, страховых взносов, пеней, штрафов, процентов, а также обязанности по передаче налоговому органу квитанции
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    о приеме требования о представлнеии пояснений и (или) уведомления о вызове в налоговый орган, превышения суммы недоимки, пеней и
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    штрафов, подлежащих уплате на основании решения о привлечении к ответственности за совершение налогового правонарушения или решения
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    об отказе в привлечении к ответственности за совершение налогового правонарушения над совокупной стоимостью имущества по данным
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    бюухгалтерского учета, на которое был наложен запрет на отчуждение, другие обстоятельства по установленнм фактам нарушения)

         Руководствуясь   статьями   31,  76  Налогового  кодекса  Российской Федерации,
         

                                                             РЕШИЛ:

         Приостановить в банке  #
                               ─────────────────────────────────────────────────────────────────────────────────────────────────
                                    (полное наименование банка, БИК)
  ]
  ( substr(Client,1,120),
    substr(Client,121,120),
    substr(Client,242,120),
    substr(RPO.Обстоят,1,120),
    substr(RPO.Обстоят,1*120,120),
    substr(RPO.Обстоят,2*120,120),
    substr(RPO.Обстоят,3*120,120),
    substr(RPO.Обстоят,4*120,120),
    substr(RPO.Обстоят,5*120,120),
    substr(RPO.Обстоят,6*120,120),
    substr(RPO.Обстоят,7*120,120),
    substr(RPO.Обстоят,8*120,120),
    substr(RPO.Обстоят,9*120,120),
    substr(BankName, 1, 45)
  );
  if (strlen(BankName) > 45)
    BankName = substr(BankName, 46);
    while (BankName != "")
  [ #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  ] ( substr(BankName, 1, 120));
      BankName = substr(BankName, 74);
    end;
  end;
  [ все расходные операции по счетам  #
                                     ───────────────────────────────────────────────────────────────────────────────────────────
                                    (указываются вид и номера счетов, реквизиты корпоративного электронного средства платежа
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
              налогоплательщика (плательщика сбора, плательщика страховых взносов, налогового агента), ИНН/КПП
    #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
           
    за исключением платежей, очередность исполнения которых в соответствии с гражданским законода-
    тельством Российской Федерации предшествует исполнению обязанности по уплате налогов, 
    сборов, страховых взносов, а также операций по списанию денежных средств в счет уплаты налогов
    (авансовых   платежей), сборов, страховых взносов, соответствующих пеней и штрафов и по их перечис-
    лению в  бюджетную систему Российской Федерации.
  ]
  (
    substr(AccString,1,90),
    substr(AccString,91,120),
    substr(AccString,201,120)
  );
  if (RPO.СумВзыск != 0.0)
  [
    Сумма,  подлежащая  взысканию  (обеспечению) в целях исполнения 
                                                                    ────────────────────────────────────────────────────────────
                                                                           (указывается наименование решения о привлечении
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    к ответственности за совершение налогового правонарушения, решения об отказе в привлечении к ответственности за совершение
    налогового правонарушения или решения о взыскании  за счет денежных средств на счетах в банках, а также электронных
    денежных средств)
    
    от #          N #         составляет  #             рублей
      ───────────  ──────────            ───────────────
  ]
  ( RPO.ДатаРешВзыск,
    RPO.НомРешВзыск,
    RPO.СумВзыск:l
  );
  end;
  [
    Руководитель (заместитель руководителя)
     #
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                                             (наименование налогового органа)
     #                                                      #
    ─────────────────────────────────────────────────── ──────────────── ───────────────────────────────────────────────────────
                (классный чин)              (подпись)           (Ф.И.О)

          М.П.

  ]
  ( substr(RPO.НаимНо,1,72),
    substr(RPO.КласЧинРук,1,50),
    substr(RPO.ФИОРук,1,50)
  );

  [
  
      Копию настоящего Решение получил:
     
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                    (должность, Ф.И.О. руководителя организации, Ф.И.О. налогоплательщика (плательщика сбора,
   
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                                      плательщика страховых взносов, налогового агента)
    
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
                                                (полное наименование организации
    
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   (Ф.И.О. индивидуального предпринимателя, нотариуса, занимающегося частной практикой, адвоката, учредившего адвокатский кабинет) - 
    
    ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
            налогоплательщика (плательщика сбора, плательщика страховых взносов, налогового агента), ИНН/КПП, адрес)

    ______________________  _______________________ 
          (подпись)                 (дата)               
    (в случае направления настоящего Решения заказным почтовым отправлении с уведомлением о вручении делается отметка налогового органа 
    о вручении налогоплательщику (плательщику сбора, плательщику страховых взносов, налоговому агенту) согласно уведомлению о вручении)
  ];

  return true;
end; 

macro PrintDoc( addrMes, MassCopy )
  var field_name, field_value;
  var MsgTmpFileName, OldName;
  FILE MsgTmpFile() txt;


  SetBuff( wlmes, addrMes );

  /* Перенаправляем вывод сообщения в файл, чтобы при многократной печати использовать данные */
  MsgTmpFileName = GetTxtFileName("tmpmsprn");
  OldName = SetOutPut( MsgTmpFileName );

  if( not open(MsgTmpFile, MsgTmpFileName) )
    std.msg( String("Файл не открыт:", "|", MsgTmpFileName) );
    return FALSE;
  end;

  var RPO = PrintRPO();
  RPO.ReadMessage();

  Draw( RPO );

  close( MsgTmpFile );
  SetOutPut( OldName, true ); /* Перенаправляем вывод обратно */

  while( MassCopy != 0 )
    rewind( MsgTmpFile );
    while( next(MsgTmpFile) )
      println( MsgTmpFile.str );
    end;
    MassCopy = MassCopy - 1;
  end;

  return true;

OnError(er) /* обработка ошибок времени выполнения */
  ExeptionMessage(er);
  return false;
end;
