/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*  Выполняется проводка со счета списания с клиентских счетов  на          */
/*  корреспондентскихй счет, на который был спозиционирован платеж          */
/*  Имя файла: w110_400.mac                                                 */
/*  Создан:  17.05.00                                        Алешин А.В.    */
/****************************************************************************/

import InsCarryDoc, OprInter, BankInter, "wldoc.mac", "wlkvit.mac", "cbsttls.mac";

RECORD Corschem( corschem );

var PaymentObj:RsbPayment;

macro ExecuteStep( doc, first )
  var stat, UnkvitSum = Moneyl(0), kvitSum = Moneyl(0), Cancel:string;

  /* Заполняем поля документа */
  if( Corschem.IsKvitOutPaym == "X" )
  
     if( not ПолучитьСуммуКвитовки( PaymentObj, kvitSum, Cancel ) )
       /* Ошибка создана */
       return 1;
     end;

     if ( Cancel==KVIT_CALL_BACK )
        MsgBox( "Нельзя квитовать с подтвердением отзывом" );
        return 1;
     end;
  end;


     PaymentObj.PropStatus = PM_PROP_KVITED;

     if ( Cancel==KVIT_CANCEL )
       if ( УстановитьСтатусыПлатежа(OPR_PAYM_OUT_KVIT, OPR_PM_ST_CANCEL) )
          MsgBox("Возникла ошибка при смене статусов операции платежа");
          return 1;
       end;
     else
       if ( УстановитьСтатусыПлатежа(OPR_PAYM_OUT_KVIT, OPR_PM_ST_KVIT) )
          MsgBox("Возникла ошибка при смене статусов операции платежа");
          return 1;
       end;
     end;

  return 0 ;
end ;