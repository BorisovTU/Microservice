/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*   Печать отчета группового перемещения платежей из отвергнутых           */
/*                                                                          */
/*  Имя файла: wloupmkv.mac                                                 */
/*  Создан:    8.10.02                                     Бердюкова И.И.   */
/****************************************************************************/

import "wldoc.mac";

const   Ошибка   = 0,
        Первый   = 1,
        Последний= 2;

MACRO Печать_ОтчетСканирования( Вызов, firstdoc, Статус, Сообщение )
  var stat, Номер;

  setbuff( wlpm, firstdoc );

  if( Вызов == Первый )
    [                                                                               ];
    [   Отчет о групповом перемещении отвергнутых платежей                          ];
    [   Дата обработки: ##########  ########                                        ](date:f, time);
    [   Операционист:   #####                                                       ]({oper});
    [                                                                               ];
    [+-----------------------------+------+------------------------------------------------------------+];
    [|         Номер               |Номер |                 Сообщение                                  |];
    [|        платежа              |ошибки|                                                            |];
    [+-----------------------------+------+------------------------------------------------------------+];
  elif( Вызов == Ошибка )
    if( Статус == 0 )
      Сообщение = "Платеж успешно перемещен из отвергнутых";
    end;
    if( FindPayment( wlpm.PaymentID,  /* Индентификатор */
                     0,
                     0,      /* Subpurpose                   */
                     0, /* Вид первичного документа */
                     0,
                     true,   /* Поиск по реальной базе       */
                     null,
                     null,
                     null,
                     wlpmrmprop
                    ) != 0 )
      Статус = 1;
      Сообщение = "Не найден платежный документ";
    else
      Номер = wlpmrmprop.Number;
    end;
    [|#############################|######|############################################################|](Номер,Статус,StrSubst(Сообщение, "|", " " ):w);
         elif (Вызов==Последний)
    [+-----------------------------+------+------------------------------------------------------------+];
  end;
end;
