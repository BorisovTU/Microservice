/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*               Экспорт сообщений по почте ЦАБС                            */
/*                                                                          */
/*  Имя файла: wlcbsout.mac                                                 */
/*  Создан:  23.05.05                                 Фомченкова Л.Н.       */
/****************************************************************************/

import "wlexport.mac";

macro ЗаписатьСообщение()

  return true;
end;


/***************************************************************************/
/* Макрос экспорта                                                         */
/***************************************************************************/
macro ExportMes( fileName, addrSess )
  var continue0 = TRUE, Документов = 0, err;

  SetBuff( wlSess, addrSess );

  if( not СчитатьЗапись( wlmes, err ) )
    if ( not err )
       std.msg("Не найдено ни одного сообщения для отправки");
    else
       std.msg("Ошибка чтения сообщения");
    end;
    return false;
  end; 

  while( continue0 )
    if( not ЗаписатьСообщение( ) )
      return false;
    end;
    if( not СчитатьЗапись( wlmes, err ) )
       if ( not err )
          continue0 = FALSE;
       else
          ErrExport("Ошибка чтения сообщения");
          return false;
       end;
    end;
    Документов = Документов + 1;
    message( "Идет выгрузка документов. Отправлено: ", Документов );
  end;  

  return true;

  OnError(er) /* Обработка ошибок времени выполнения */
    std.msg(String(er.Message, "|Модуль: ", er.Module, " Строка: ", er.Line));
    return FALSE;
end;