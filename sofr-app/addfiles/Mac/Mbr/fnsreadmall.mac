/*
$Name:               fnsreadmall.mac
$Module:            Œ  áç¥âë
$Description:      ¡é¨¥ äã­ªæ¨¨ ¤«ï ®¡à ¡®âª¨ á®®¡é¥­¨©
*/
import MesInter, "wlmnstls.mac", "pmlib.mac";
/*
  Š« áá ª®â®àë© áç¨âë¢ ¥â á®®¡é¥­¨¥ ¢® ¢­ãâà¥­­îî áâàãªâãàã
*/
class MessageReader
  /*
    ¡êï¢¨âì ¯¥à¥¬¥­­ë¥ á â ª¨¬¨ ¦¥ ­ §¢ ­¨ï¬¨ ª ª ¨ ¢ á®®¡é¥­¨¨ (à¥£¨áâà ­¥ ¢ ¦¥­)
    ¤ ­­ë¥ ¯¥à¥¬¥­­ë¥ ¡ã¤ãâ § ¯®«­¥­­ë ¨§ á®®¡é¥­¨ï, ¥á«¨ à¥£¨áâà ¯®«¥© ¢ á®®¡é¥­¨¨ ¢ ¦¥­ - 
    ¤ ­­ë© ª« áá ­¥ ¯®¤®©¤¥â (¯®«ì§ã©â¥áì ’®«¥Œ‘)
  */
  /*
    …á«¨ ¥áâì ¯®«ï ª®â®àëå ¬­®£® ¨ ­ã¦­® ¯à®ç¨â âì ¨å ¢á¥, á®§¤ ¥¬ äã­ªæ¨î á ¨¬¥­¥¬ íâ®£® ¯®«ï
      macro ‚¨¤‘ç(value)
        AccKindList[AccKindList.size] = value;
      end;
  */
  /*
    …á«¨ ¯®«ï ­ å®¤ïâáï ¢ ¡«®ª¥, ­® ¬®£ãâ ¯®¢â®àïâáï ¢ à §­ëå ­¥¢«®¦¥­­ëå ¡«®ª å, â® ¨å ®¡à ¡®âªã ¯à®¢®¤¨âì ¢ íâ®© äã­ªæ¨¨

      macro _ConvertBlock_(name)
        if (name == "«ˆ")
          ”ˆˆ = ” ¬¨«¨ï + " " + ˆ¬ï + " " + âç¥áâ¢®;
        elif (name == "ãª®¢®¤¨â¥«ì")
          ”ˆãª = ” ¬¨«¨ï + " " + ˆ¬ï + " " + âç¥áâ¢®;
        end;
      end;
    „«ï íâ®£® ­ã¦­® ®¡êï¢¨âì ¯®«ï,   ¯® ®ª®­ç ­¨¨ ¡«®ª  § ¯¨áë¢ âì ¨å ®¡à ¡®â ­­ë¥ §­ ç¥­¨ï ¢ ­ã¦­®¥ ¯®«¥,
    â ª®© ¢ à¨ ­â ¯®¤å®¤¨â â®«ìª® ¤«ï xml, £¤¥ ¥áâì ¯®«ï _begin ¨ _end, ¤«ï ®¡ëç­ëå à¥«¨§®¢ ¯®«ï ¨¤ãâ ¢ ¯à ¢¨«ì­®¬ ¯®àï¤ª¥,
    ¯®íâ®¬ã ¬®¦­® ¨å áà §ã ¯¨á âì ª ª ­ã¦­®, á®§¤ ¢ ï äã­ªæ¨î á ¨¬¥­¥¬ ¯®«ï
  */
  macro _ConvertBlock_(name)
    /*¯¥à¥®¯à¥¤¥«¨âì ¢ ­ á«¥¤­¨ª å*/
  end;
  macro _Normalize_()
  /*
    ‡¤¥áì ¬®¦­®, å®âï ¨ ­¥ ®¡ï§ â¥«ì­®, ¯¥à¥­¥áâ¨ §­ ç¥­¨ï ¨§ à §«¨ç­ëå ¯®«¥© ¢ ®¤­®, ª®â®à®¥ ¡ã¤¥â ¨á¯®«ì§®¢ âìáï ¢  «£®à¨â¬ å
  */
  end;
  macro ReadMessage()
    var field_name, field_value, acc;
    var count = GenNumProps(this);
    while( ‘ç¨â âì®«¥( field_name, field_value ) )
      var i = GenPropID(this, field_name);
      if ((i >= 0) and (i < count))
        this(i) = field_value;//¥á«¨ ¥áâì â ª®¥ ¯®«¥, â® § ¯¨è¥¬ ¢ ­¥£® §­ ç¥­¨¥
      elif (field_name == "_end")
        _ConvertBlock_(field_value);//¥á«¨ íâ® ª®­¥æ ¡«®ª , â® ¢ë§®¢¥¬ ¥£® ®¡à ¡®âªã
      else
        CallR2M(R2M(this, field_name), field_value);//¯®¯ëâ ¥¬áï ®¡à ¡®â âì ¯®«¥ ¢ ®¤­®¨¬¥­­®© äã­ªæ¨¨
      end;
    end;
    _Normalize_();
  end;
end;

macro ConvertToDDpMMpYYYY(str: string): string;
  if ((str != "") and (substr(str, 5, 1) == "-"))
    str = DDpMMpYYYY(ToDateYYYY_MM_DD(str));
  end;
  return str;
end;