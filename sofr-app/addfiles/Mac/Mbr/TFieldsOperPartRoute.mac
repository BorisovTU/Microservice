/*
  $Name:         TFieldsOperPartRoute.mac
  $Module:       МБР
  $Description:  Класс для переноса данных из сообщения в данные участников операции из маршрута
*/

//-----------------------------------------------------------------------------
//          Автоматизированная банковская система RS-Bank               
//                 Copyright (c) R-Style Software Lab
//
// Описание     : Класс для переноса данных из сообщения в данные участников операции из маршрута
//
// Программист  : Чукина Т.А.
//
// Создан       : 21.04.2018
//
//-----------------------------------------------------------------------------
import PaymInter, "wlgendoc.mac", "likepy.mac", "wlgenmes.mac";

  CLASS TRoutePartAttrs
    var PayerBank : TRecHandler = TRecHandler("pmroute"), 
        PrevInstrAgent : TRecHandler = TRecHandler("pmroute"), 
        SenderBank : TRecHandler = TRecHandler("pmroute"), 
        ExecutorBank : TRecHandler = TRecHandler("pmroute"), 
        IntermediaryBank : TRecHandler = TRecHandler("pmroute"), 
        ReceiverBank : TRecHandler = TRecHandler("pmroute");
  END;

CLASS TFieldsRoutePart(p_Payment : RsbPayment)

  var OldValues : TRoutePartAttrs = TRoutePartAttrs(),
      NewValues : TRoutePartAttrs = TRoutePartAttrs(),
      IsUpdated   : bool = false,
      Payment : RsbPayment   = p_Payment;

  PRIVATE MACRO CopyDataFromPaym
    var PayerBank : TRecHandler = TRecHandler("pmroute"), 
        PrevInstrAgent : TRecHandler = TRecHandler("pmroute"), 
        SenderBank : TRecHandler = TRecHandler("pmroute"), 
        ExecutorBank : TRecHandler = TRecHandler("pmroute"), 
        IntermediaryBank : TRecHandler = TRecHandler("pmroute"), 
        ReceiverBank : TRecHandler = TRecHandler("pmroute");

    Payment.GetOperationParticipantsFromRoute
      ( PrevInstrAgent, SenderBank, ExecutorBank, 
        IntermediaryBank, PayerBank, ReceiverBank );

    Copy(OldValues.PayerBank, PayerBank);
    Copy(NewValues.PayerBank, PayerBank);
    Copy(OldValues.PrevInstrAgent, PrevInstrAgent);
    Copy(NewValues.PrevInstrAgent, PrevInstrAgent);
    Copy(OldValues.SenderBank, SenderBank);
    Copy(NewValues.SenderBank, SenderBank);
    Copy(OldValues.ExecutorBank, ExecutorBank);
    Copy(NewValues.ExecutorBank, ExecutorBank);
    Copy(OldValues.IntermediaryBank, IntermediaryBank);
    Copy(NewValues.IntermediaryBank, IntermediaryBank);
    Copy(OldValues.ReceiverBank, ReceiverBank);
    Copy(NewValues.ReceiverBank, ReceiverBank);
  END;

  // конструктор
  CopyDataFromPaym();

  MACRO UpdateRouteParticipants : bool
    var stat : bool = Payment.SaveOperationParticipantsToRoute
      ( NewValues.PayerBank, NewValues.PrevInstrAgent, NewValues.SenderBank, 
        NewValues.ExecutorBank, NewValues.IntermediaryBank, NewValues.ReceiverBank );

    if(stat)
      IsUpdated = true;
      //???CopyPaymAttrs(PaymSide.NewValues, Side);
    else
      IsUpdated = false;
    end;

    return IsUpdated;
  END;

  macro destructor()
    Payment = null;
  end;

END;
