import globals;

/*  Функция создания запроса выборки платежей, по которым будут создаваться  */
/*  операции                                                                 */
/*  Используется в модуле 2140                                               */
macro СоздатьЗапрос( RespID , TpID )
 var sql:string;

 /* Основной запрос */
sql = " SELECT DISTINCT wlmes.t_MesID , wlmes.t_RlsFormID , wlmes.t_Kind , wlmes.t_TRN " + 
       " FROM   dwlmes_dbt wlmes , dwltpshem_dbt wltpshem " + 
       " WHERE  wlmes.t_Direct = 'X'  " +
       " AND wlmes.t_department = " + {OperDprt} +
       " AND    wlmes.t_State  = 50 " ;//WLD_STATUS_MES_RECEIV - принято
 /* Дополнительные условия */
 if(RespID != -1 )
   sql = sql + string(" AND wlmes.t_OutsideAbonentID = ",RespID);
 end;     

 if(TpID > 0)
   sql = sql + " AND wlmes.t_TpSchemID = wltpshem.t_TpShemID " + 
        string(" AND wltpshem.t_TpID = ", TpID);
 end;
 
 /* !!!Сортировка. Для изменения порядка сортировки создания операция, добавлять новые условия ниже */
 sql = sql + string ( " ORDER BY wlmes.t_MesID  ");/*<< Сортировка по PaymentID, времени поступления*/
 /*  Для отладки, запишет в файл SQL запрос */
  println (sql);

 /* Вернем созданный запрос  */
 return sql;
end;
