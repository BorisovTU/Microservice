import deprintr;

var day,mon,year,namefile,DayInt,{curdate},{BatchMode}, 
    ARHDIR, DBTDIR, CRYPTER, FullName, CommandLine, retval;

ARHDIR = GetRegVal( "RS-RETAIL\\INI\\ДИРЕКТОРИИ\\ARHFILEDIR", true);       /* Каталог, в который архивируем */
DBTDIR = GetIniString("DATABASEDIR");      /* Каталог, который архивируем */
/*
CRYPTER = GetIniString("EXCELPRG");        /* Программа-шифровщик */
     
CRYPTER = SubStr(CRYPTER, 1, (StrLen(CRYPTER)-1));
*/

macro genName (date1)
  datesplit (date1, DayInt);

  day=substr(string(date1),1,2);
  mon=substr(string(date1),4,2);
  year=substr(string(date1),9,2);
  if (DayInt < 10)
     strset (day, 1, "0");
  end;

  namefile=year+mon+day+"RU.arj";    
  return namefile;
end;


/* MsgBox("DBDIR = ",DBTDIR); */

macro Archive

  var msg = null;
  if ( not {BatchMode} )
    msg = "Архиватор завершил работу. Нажмите ESC для продолжения";
  end;

  FullName = ARHDIR + genName ({curdate});
  CommandLine = " a -r -y -x*.arj -xregistry.dbt " + FullName + " " + DBTDIR + "*.dbt";
  retval = Run ("arj.exe", Commandline, "Начал архивировать ...", msg);
  
  /*         
  if (retval == -1)
  [Архиватор arj.exe не найден];
  elif (retval == 0)     
  
  else
  
  end;
  */
  
  /*
    if(retval == 0)
    msgbox ("Архив: " + FullName + "| успешно создан." +
            "|Вставьте дискету с ключом шифра в дисковод A:" + 
            "|Нажмите ESC для продолжения");
  
    CommandLine = " -e " + FullName + " " + FullName;
    retval = Run (CRYPTER, CommandLine, "Начал зашифровывать ...", 
                  "Шифровщик завершил работу. Нажмите ESC для продолжения");
  
    if(retval == 0)
      msgbox ("Архив успешно зашифрован");                                                        
    else
      msgbox("Ошибка шифрования: "+ retval); 
    end;   
  */
  /*end;*/
  
  return (retval);
  
  /*
  [################] (genName ({curdate}));
  */
end;

macro Extract( ArchFile )

  CommandLine = " x -y " + ArchFile + " " + DBTDIR + "..";
  retval = Run ("arj.exe", Commandline, "Начал распаковывать ...", 
                "Архиватор завершил работу. Нажмите ESC для продолжения");
  return (retval);
end;

