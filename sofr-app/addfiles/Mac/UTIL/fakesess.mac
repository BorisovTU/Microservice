/* "Фальшивая" сессия */

import deprintr;

file Session   ("sb_sesn.dbt" ) write;
file SessInfo  ("sb_infss.dbt") write;
file SendFiles ("sb_senfl.dbt") write;

/* "Транспортируемые" файлы */

file DepDoc    ("sbdepdoc.dbt") key 1000 write;
file Dep       ("depositr.dbt") key 1000 write;
file TrWill    ("sbtrast.dbt")  key 1000 write;
file DepClient ("depclnt.dbt")  key 1000 write;
file AcConGet  ("sb_congt.dbt") key 1000 write;
file DepRest   ("pc_drest.dbt") key 1000 write;
file AuxInfo   ("auxinfo.dbt")  key 1000 write;
file DepStat   ("sb_depst.dbt") key 1000 write;
file PayDoc    ("pay_doc.dbt")  key 1000 write;
file CIRec     ("ci_rec.dbt")   key 1000 write;
file NBData    ("nb_data.dbt")  key 1000 write;
file PcCalc    ("pc__calc.dbt") key 1000 write;
file TextInfo  ("textinfo.dbt") key 1000 write;
file PcEstim   ("pcestim.dbt")  key 1000 write;
file SbCasLN   ("sb_casln.dbt") key 1000 write;
file PcDrest   ("pc_drest.dbt") key 1000 write;
file TrnDoc    ("trn_doc.dbt")  key 1000 write;
file TrnPayf   ("trn_payf")     key 1000 write;
file Compens   ("compens.dbt")  key 1000 write;


const
  I_DepDoc    = 0,
  I_Dep       = 1,
  I_TrWill    = 2,
  I_DepClient = 3,
  I_AcConGet  = 4,
  I_DepRest   = 5,
  I_AuxInfo   = 7,
  I_DepStat   = 8,
  I_PayDoc    = 9,
  I_CIRec     = 10,
  I_NBData    = 11,
  I_PcCalc    = 12,
  I_TextInfo  = 13,
  I_PcEStim   = 14;
  I_SbCasLN   = 15;
  I_PcDrest   = 16;
  I_TrnDoc    = 17;
  I_TrnPayf   = 18;
  I_Compens   = 19;

var FakeSesn = 1;

array F;
 
F(I_DepDoc)    = DepDoc;
F(I_Dep)       = Dep;
F(I_TrWill)    = TrWill;
F(I_DepClient) = DepClient;
F(I_AcConGet)  = AcConGet;
F(I_DepRest)   = DepRest;
F(I_AuxInfo)   = AuxInfo;
F(I_DepStat)   = DepStat;
F(I_PayDoc)    = PayDoc;
F(I_CIRec)     = CIRec;
F(I_NBData)    = NBData;
F(I_PcCalc)    = PcCalc;
F(I_TextInfo)  = TextInfo;
F(I_PcEStim)   = PcEStim;
F(I_SbCasln)   = SbCasLN;
F(I_PcDrest)   = PcDrest;
F(I_TrnDoc)    = TrnDoc;
F(I_TrnPayf)   = TrnPayf;
F(I_Compens)   = Compens;

var
  NRecs = 0;

macro UpdateProc
end;

macro GenUpdProc(i)

  /*F(i).FNCash = NumFNCash;*/
  F(i).NumSession = FakeSesn;
end;

macro CIRecUpdProc(i)

  /*F(i).Branch = NumFNCash;*/
  F(i).SessionNum = FakeSesn;
end;

macro UpdateFile(i, UpdProc)
                     
  if(ValType(UpdProc) == V_STRING)
    ReplaceMacro("UpdateProc", UpdProc);
  else 
    ReplaceMacro("UpdateProc", "GenUpdProc");
  end;
  Rewind(F(i));
  NRecs = 0;
  while(Next(F(i)))  
    UpdateProc(i);
    Update(F(i));
    NRecs = NRecs + 1;
    Message("Обработано записей файла: ", F( i ), " ", NRecs);  
  end;
end;

  GetInt( FakeSesn, "Введите номер фальшивой сессии > 0" );
  if( FakeSesn <= 0 )
    MsgBox( "Неверный номер сессии ", FakeSesn );
    exit( 1 );
  end;
  UpdateFile(I_DepDoc);
  UpdateFile(I_Dep);
  UpdateFile(I_TrWill);
  UpdateFile(I_DepClient);
  UpdateFile(I_AcConGet);
  UpdateFile(I_DepRest);
  UpdateFile(I_AuxInfo);
  UpdateFile(I_DepStat);
  UpdateFile(I_PayDoc);
  UpdateFile(I_CIRec, "CIRecUpdProc");
  UpdateFile(I_NBData);
  UpdateFile(I_PcCalc);
  UpdateFile(I_TextInfo);
  UpdateFile(I_PcEStim);
  UpdateFile(I_SbCasLN);
  UpdateFile(I_PcDrest); 
  UpdateFile(I_TrnDoc);
  UpdateFile(I_TrnPayf);
  UpdateFile(I_Compens);
  if(Clone(Session) and Clone(SessInfo) and Clone(SendFiles))
    if(Open(Session))
      Session.NumSession = FakeSesn;
      Session.FNCash     = NumFNCash;
      Session.SesDate    = Date;
      Session.SesTime    = Time;
      Session.StateSess  = StrFor(1);
      Insert(Session);
    end;
  end;
end;





