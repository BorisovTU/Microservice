/**************************************************************************\
*  ---------------------                                                   *
*  R-Style Software Lab.                                                   *
*  ---------------------                                                   *
*  RS-Retail                                                               *
*                                                                          *
*  Изменения справочников в связи со сменой кода валюты Марки ФРГ          *
*  с 280 на 276                                                            *
*                                                                          *
*  Лебедев С.В.                                                            *
*  05.06.2000                                                              *
\**************************************************************************/

file currency ( currency           ) key    1 write;
file curr     ( curr               ) key    0 write;
file isocur   ( isocur, "bank.def" ) key    1 write;
file cur_rate ( cur_rate           ) key 9999 write;
file sb_casvl ( sb_casvl           ) key    2 write;

record r_isocur (isocur);

var stat;
var flag;


/**************************************************************************\
|                    Г Л А В Н А Я    П Р О Г Р А М М А                    |
\**************************************************************************/

  [ ];
  currency.ExternalCode = "280";
  if (GetEQ(currency))
    currency.Short_Name   = "DEM";
    currency.ExternalCode = "276";
    if (Update(currency))
      [Обновление в файле CURRENCY.DBT прошло УСПЕШНО];
    else
      [Обновление в файле CURRENCY.DBT не прошло - ОШИБКА];
    end;
  else
    currency.ExternalCode = "276";
    if (GetEQ(currency) AND (currency.Short_Name != "DEM"))
      currency.Short_Name = "DEM";
      if (Update(currency))
        [Обновление в файле CURRENCY.DBT прошло УСПЕШНО];
      else
        [Обновление в файле CURRENCY.DBT не прошло - ОШИБКА];
      end;
    end;
  end;

  [ ];
  curr.ID = 280;
  if (GetEQ(curr))
    curr.ID = 276;
    if (Update(curr))
      [Обновление в файле CURR.DBT прошло УСПЕШНО];
    else
      [Обновление в файле CURR.DBT не прошло - ОШИБКА];
    end;
  end;

  [ ];
  isocur.NumberCode = "280";
  if (GetEQ(isocur))
    Copy(r_isocur,isocur);
    if (Delete(isocur))
      Copy(isocur,r_isocur);
      isocur.NumberCode = "276";
      if (Insert(isocur))
        [Обновление в файле ISOCUR.DBT прошло УСПЕШНО];
      else
        [Обновление в файле ISOCUR.DBT не прошло - ОШИБКА (при вставке)];
      end;
    else
      [Обновление в файле ISOCUR.DBT не прошло - ОШИБКА (при удалении)];
    end;
  end;

  [ ];
  stat = TRUE;
  flag = FALSE;
  while (Next(cur_rate))
    if (cur_rate.Curr_Ref == 280)
      flag = TRUE;
      cur_rate.Curr_Ref = 276;
      if (NOT Update(cur_rate))
        stat = FALSE;
      end;
    end;
  end;
  if (flag)
    if (stat)
      [Обновление в файле CUR_RATE.DBT прошло УСПЕШНО];
    else
      [Обновление в файле CUR_RATE.DBT не прошло - ОШИБКА];
    end;
  end;

  [ ];
  sb_casvl.TypeValue    = 1;
  sb_casvl.CodCharValue = "280";
  if (GetEQ(sb_casvl))
    sb_casvl.IdentValue   = "DEM";
    sb_casvl.CodCharValue = "276";
    if (Update(sb_casvl))
      [Обновление в файле SB_CASVL.DBT прошло УСПЕШНО];
    else
      [Обновление в файле SB_CASVL.DBT не прошло - ОШИБКА];
    end;
  end;


end;
