file dic( "dict.def", "def.def" );
record field( "dictfld.rec", "def.def" );

var
  dicName;

macro fileHasMoneyFields( code )

  var           
    retVal = false,
    recFound,
    pos,
    saveKey;         
 
  pos = getPos( dic );                 
  saveKey = keyNum( dic, 2 );

  setRecordAddr( field, dic, 0, 0, true );

  getDirect( dic, pos );
  clearRecord( dic );
  dic.Code_File = code;
  dic.Group = "d"; 
  recFound = getGE( dic );
  while ( recFound and ( not retVal )
    and ( dic.Code_File == code )
    and ( dic.Group == "d" ) )
    if ( ( field.FVt == StrFor( 6 ) ) or ( field.FVt == StrFor( 14 ) ) or ( field.FVt == StrFor( 15 ) ) )
      retVal = true;
    end;
    recFound = next( dic );
  end;

  keyNum( dic, saveKey ); 
  getDirect( dic, pos );
  return retVal;
end;                    

macro treatFile( code )             

  if ( fileHasMoneyFields( code ) )
    SetOutput( "files_to_convert.lst", true );
    printLn( dic.Name, "  ", dicName );                  
  else
    SetOutput( "files_to_copy.lst", true );
    printLn( dic.Name );
  end;
end;
     
macro treatDic

  var
    recFound;

  keyNum( dic, 1 );
  clearRecord( dic );
  dic.Group = "f";
  recFound = getGE( dic );
  while ( recFound and ( dic.Group == "f" ) )
    treatFile( dic.Code );    
    recFound = next( dic );
  end;
end;                    
  
  getString( dicName, "Введите имя словаря" );
  open( dic, dicName, true );
  treatDic;
  setOutput( null );
end;
  