
/* Перевод курсовых разностей в % от номинала */

file OGSZIssue( "ogsz_iss.dbt" ) key 0 write;

macro Convert( Sum )

  return Money( Sum / OGSZIssue.Par * 10000 );
end;

  var
    PrevBuyComm, PrevSellComm;

  [-----------------------------------------------------------];
  [ Серия    Номинал        На продажу        На покупку      ];
  [                       было     стало    было     стало    ]; 
  [-----------------------------------------------------------];

  Rewind( OGSZIssue );
  while( Next( OGSZIssue ) )  
    PrevBuyComm = OGSZIssue.BuyCommission; 
    PrevSellComm = OGSZIssue.SellCommission; 
    OGSZIssue.BuyCommission = Convert( PrevBuyComm );
    OGSZIssue.SellCommission = Convert( PrevSellComm );
    [ ######## ############ ######## ######## ######## ######## ]
    (
      OGSZIssue.Series,
      OGSZIssue.Par,
      PrevSellComm,
      OGSZIssue.SellCommission,
      PrevBuyComm,
      OGSZIssue.BuyCommission
    );                               
    Update( OGSZIssue );
  end;
end;