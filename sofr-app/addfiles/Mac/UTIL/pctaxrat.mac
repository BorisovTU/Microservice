/*
  RS-Retail

  Корректировка дополнительной информации по налоговой карточке
 для модуля 2 "Обслуживание физических лиц- RS-Retail"
 при переходе на 180 сборку
------------------------------------------------------------
  В переменной части файла Pc_Tax.dbt (структура pc_tax2.dbt)
 все ставки делятся на 100
------------------------------------------------------------
  Макрос можно запускать несколько раз
------------------------------------------------------------
 Ромодин Александр Васильевич
 03.11.2000
*/
file   PC_TAX ("pc_tax.dbt") key 0 write;
record PC_TAX2("pc_tax2.dbt");

  var st,
      stat;
  var NumStr  = 0,
      NumErr  = 0,
      NumWork = 0;
  [     Обработка ставок в записях налоговой карточки по счетам вкладчиков];
  [     ------------------------------------------------------------------];
  [ ];
  ClearRecord (PC_TAX);
  SetRecordAddr (PC_TAX2,PC_TAX,0,0,True);
  PC_TAX.CodeModule = 2;  /* Обслуживание физических лиц */
  st = GetGE (PC_TAX);
  while (st AND (PC_TAX.CodeModule == 2))
    NumStr = NumStr + 1;
    if ( (PC_TAX2.RatePercentDepositr > 100)
     AND (PC_TAX2.RateReFin > 100)
     AND (PC_TAX2.TaxRate > 100) )
      NumWork = NumWork + 1;
      Message (NumWork," ",PC_TAX.ObjectTax);
      PC_TAX2.RatePercentDepositr = PC_TAX2.RatePercentDepositr / 100;
      PC_TAX2.RateReFin           = PC_TAX2.RateReFin           / 100;
      PC_TAX2.TaxRate             = PC_TAX2.TaxRate             / 100;
      stat = Update (PC_TAX);
      if (NOT stat)
        NumErr = NumErr + 1;
        [ ОШИБКА при обновлении записи по счету ##########################]
        (PC_TAX.ObjectTax);
      end;
    end;
    st = Next (PC_TAX);
  end;
  U_RESULT = true;
  [ Просмотрено      ############### строк налоговой карточки](NumStr);
  [ Откорректировано ############### строк налоговой карточки](NumWork);
  [ Допущено         ############### ошибок](NumErr);
end;
