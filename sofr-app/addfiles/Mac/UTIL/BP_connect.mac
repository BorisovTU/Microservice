/**************************************************************************\
*  ---------------------                                                   *
*  R-Style Software Lab.                                                   *
*  ---------------------                                                   *
*  RS-Retail                                                               *
*                                                                          *
*  Налично-кассовые операции                                               *
*  Обслуживание переводов БЛИЦ с использование БД ИНФОБАНК                 *
*  Мишин А.Н.                                                              *
*  ...04.2009                                                              *
\**************************************************************************/

private var Ind1;
private var Temp1;                          
private var s;


macro sconnect(s);
   private var cmd: Object;
   private var q: string;
   private var rs;          

   Ind1  = Index(s,";");
   If (Ind1 == 0) Return s End;
   Temp1 = SubStr(s,Ind1+1); 
   q     = "select count(*) as count FROM dperson_dbt Where t_oper="+Temp1; 
   cmd   = RsdCommand(q);
   rs    = RsdRecordSet(cmd); 
   rs.MoveNext();                
   If (rs.Fld("count").Value)
     ClearRecord(rs);
     q   = "select t_name as name,rs_pasw.DecriptPassword0404(t_parol, t_oper) psw FROM dperson_dbt Where t_oper="+Temp1;
     cmd = RsdCommand(q);
     rs  = RsdRecordSet(cmd); 
     rs.MoveNext();                
     return SubStr(s,1,Ind1-1)+";USER ID="+rs.Fld("name").Value+";PASSWORD="+rs.Fld("psw").Value;
     Else
     MsgBox(MsgErr6);
     ERR_RESULT = -1;
     Return CM_CANCEL;
   End;
End;

