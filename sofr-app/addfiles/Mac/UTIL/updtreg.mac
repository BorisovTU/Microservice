/*макрос обновления регистрации договоров. Для регистраций на сумму 0.00
  создается документ и привязывается к операции*/

import SbCrdInter;

const CF_REG = 1;

record Документ("doc_acc.dbt");    /*запись из файла документов на проводку*/
File CrdOP   ("crd_op.dbt") key 0;
File DocAcc  ("doc_acc.dbt");

macro Обновить_Регистрацию()

  ClearRecord(Документ);
  Документ.CarrySum = $1.00;
  Документ.Debit = "912028109000200067";
  Документ.Credit = "99990";
  Документ.CredOperID_Ref = CrdOp.CredOperID;
  СоздатьДокумент(Документ);

end;

rewind( CrdOp );
while( next( CrdOp ) and (CrdOp.Applic == 0))    /*8.02.99 вид приложения КБ*/
  if( (CrdOp.OperTypeNumber_Ref == CF_REG ) and (CrdOp.IsDeleted == 0) )
    KeyNum(DocAcc, 7);
    DocAcc.CredOperID_Ref = CrdOp.CredOperID;
    DocAcc.IsDeleted = CrdOp.IsDeleted;
    if( not GetEQ( DocAcc )) /*нет документа по операции*/
      Обновить_Регистрацию();
    end;
  end;
end;

