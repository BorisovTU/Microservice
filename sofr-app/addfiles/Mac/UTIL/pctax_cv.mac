/*
  RS-Bank 6.0
  RS-Retail
  Чистка переменной части налоговой карточки в связи с ошибкой
 в базе данных
*/
file   TAX_CARD   ("pc_tax.dbt" ) write key 0;
record TAX_CARD_2 ("pc_tax2.dbt");

var st, 
    num     = 0,
    numwork = 0,
    numerr  = 0;
var lenrec;

  [ ];
  [           Налоговая карточка];
  [   Чистка переменной части файла pc_tax];
  [   ------------------------------------];
  [ ];
  TAX_CARD.CodeModule    = 2;
  TAX_CARD.ObjectTax     = "";
  TAX_CARD.ObjectTax_Add = 0;
  TAX_CARD.DateTaxPay    = Date(0,0,0);

  st = GetGE (TAX_CARD);
  while ( st
   AND   (TAX_CARD.CodeModule == 2))
    lenrec = GetVarSize (TAX_CARD);
    num = num + 1;
    Message (" Просмотрено ",num," записей. Обработано ",numwork," записей...");
    SetRecordAddr (TAX_CARD_2,TAX_CARD,0,0,True);
    if ( (lenrec != 84)
     OR  (  (TAX_CARD_2.ObjectType != 2001)
        AND (TAX_CARD_2.ObjectType != 2002)
        AND (TAX_CARD_2.ObjectType != 2003)
        AND (TAX_CARD_2.ObjectType != 2004) ) )
      numwork = numwork + 1;
      TAX_CARD_2.ObjectType          = 2001;    
      TAX_CARD_2.Date_Document       = Date(0,0,0);
      TAX_CARD_2.NumDayDoc           = 0;
      TAX_CARD_2.SummaDepositr       = 0;
      TAX_CARD_2.RatePercentDepositr = 0;
      TAX_CARD_2.SumPercent          = 0;
      TAX_CARD_2.RateReFin           = 0;
      TAX_CARD_2.SumReFin            = 0;
      TAX_CARD_2.BeginConstDate      = Date(0,0,0);
      TAX_CARD_2.EndConstDate        = Date(0,0,0);
      TAX_CARD_2.NumDayConstRate     = 0;
      TAX_CARD_2.TaxRate             = 0;
      TAX_CARD_2.ProgressRate        = 0;
      TAX_CARD_2.Income              = 0;
      TAX_CARD_2.IncomeRUR           = 0;
      if (NOT Update(TAX_CARD,84))
        numerr = numerr + 1;
        [ Ошибка при обновлении записи];
      end;
    end;
    st = Next (TAX_CARD);
  end;         
  [ ];
  [ Просмотрено ######## записей файла](num);
  [ Обработано  ######## записей файла](numwork);
  [ Допущено    ######## ошибок]       (numerr);
end;
