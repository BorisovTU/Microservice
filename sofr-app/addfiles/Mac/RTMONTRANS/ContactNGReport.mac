import ContactNGClient, ContactNGTransfer, Currency, or_rep_h;

class ContactNGReport(transferRec)
  private var transferRec_ = transferRec;
  private var sender_      = TSender(transferRec);
  private var reciever_    = TReciever(transferRec);

  macro setTransfer(transferRec);
    transferRec_ = transferRec;
    sender_      = TSender(transferRec);
    reciever_    = TReciever(transferRec);
  end;
  
  private macro format(inField)
    return inField;
  end;
  
  private macro sumCurrency()
    return TCurrency(transferRec_.curCode).shortName();
  end;
  
  private macro sumInWords(sum)
    var rubWords, copWords;
    var isoCode = Int(TCurrency(transferRec_.curCode).ISOCode());
    return format(CurToStrAlt(sum, rubWords, copWords, isoCode));
  end;
  
  private macro recAddInfo()
  end;
  
  macro show()
  end;
end;

class (ContactNGReport) TxtContactNGReport(transferRec)
  macro format ( inField )
    var outField = "";
    var i = 1;
    while ( i <= StrLen( inField ) )
      if ( SubStr( inField, i, 1 ) == " " )
        outField = outField + "_";
      else
        outField = outField + SubStr( inField, i, 1 );
      end;
      i = i + 1;
    end;
    if ( outField == "" ) outField = "_"; end;
    return outField;
  end;

  private macro recAddInfo()
    return TxtExtraInfo(transferRec_.branch, transferRec_.transCode).toString();
  end;
  
  InitContactNGReport(transferRec);
end;

class (ContactNGReport) TemplateContactNGReport(transferRec)
  private var factory_ = CMakeReport("", SEP_DEFAULT, 99999);
  macro show()
    factory_.createTemplateData();
    factory_.showTemplateRep();
  end;

  private macro recAddInfo()
    return TemplateExtraInfo(transferRec_.recAddInfo, transferRec_.branch, transferRec_.transCode).toString();
  end;
  
  InitContactNGReport(transferRec);
end;
