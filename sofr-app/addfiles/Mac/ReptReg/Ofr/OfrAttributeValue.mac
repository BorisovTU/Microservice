/*
$Name:          OfrAttributeValue.mac
$Module:        Отчеты ЦБ
$Description:   ОФР. Класс значения атрибута.
*/

// 19.11.2015 ABP Если вдруг появятся другие разделы с атрибутами иной структуры, то нужно будет дорабатывать и интерфейс, и базовый класс.
//                И делать отдельные классы атрибута для новых атрибутов.

/**
 * ОФР. Интерфейс классов значения атрибута.
 *
 * @since 16.11.2015
 * @author ABP
 * @version 6.20.031.032
 */
class IOfrAttributeValue()
    macro getStorage() : Object
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::getStorage"));
    end;

    macro getSymbol() : String
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::getSymbol"));
    end;

    macro getRoubleAmount() : Object
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::getRoubleAmount"));
    end;

    macro getEquivalentAmount() : Object
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::getEquivalentAmount"));
    end;

    macro getTotalAmount() : Object
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::getTotalAmount"));
    end;

    macro setSymbol(symbol : String)
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::setSymbol"));
    end;

    macro setRoubleAmount(rouble : Variant)
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::setRoubleAmount"));
    end;

    macro setEquivalentAmount(equivalent : Variant)
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::setEquivalentAmount"));
    end;

    macro setTotalAmount(totalRest : Variant)
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::setTotalAmount"));
    end;

    private macro constructorIOfrAttributeValue()
        throw(TPureVirtualMethodCallException("IOfrAttributeValue::constructorIOfrAttributeValue"));
    end;

    constructorIOfrAttributeValue();
end;

/**
 * ОФР. Базовый класс значения атрибута.
 *
 * @since 16.11.2015
 * @author ABP
 * @version 6.20.031.032
 */
class (IOfrAttributeValue) TOfrAttributeValueBase(storage : RcbCompositeValue)
    private var m_storage : RcbCompositeValue;

    macro getStorage() : RcbCompositeValue
        return m_storage;
    end;

    macro getSymbol() : String
        if (m_storage != null)
            return m_storage.fieldValue("symbol").exact;
        end;

        return null;
    end;

    macro getRoubleAmount() : Object
        if (m_storage != null)
            return m_storage.fieldValue("rouble");
        end;

        return null;
    end;

    macro getEquivalentAmount() : Object
        if (m_storage != null)
            return m_storage.fieldValue("equivalent");
        end;

        return null;
    end;

    macro getTotalAmount() : Object
        if (m_storage != null)
            return m_storage.fieldValue("total");
        end;

        return null;
    end;

    macro isExistsOpenAccount()
        return m_storage.fieldValue("isExistsOpenAccount").exact == "X";
    end;

    macro setSymbol(symbol : String)
        if (parmCount() < 2)
            throw(TInvalidNumberOfParametersException("TOfrAttributeValueBase::setSymbol"));
        end;

        if (symbol == null)
            throw(TUnspecifiedValueException("TOfrAttributeValueBase::setSymbol", "symbol"));
        end;

        if (valType(symbol) != V_STRING)
            throw(TIncorrectParameterTypeException("TOfrAttributeValueBase::setSymbol", "symbol"));
        end;

        if (symbol == "")
            throw(TInvalidValueException("TOfrAttributeValueBase::setSymbol", "symbol"));
        end;

        if (m_storage != null)
            m_storage.fieldValue("symbol").exact = symbol;
            m_storage.fieldValue("symbol").recalculateScaled();
        end;

        return this;
    end;

    macro setRoubleAmount(amount : Variant)
        if (m_storage != null)
            if (amount != null)
                if (isEqClass("TValue", amount))
                    if (amount.exact != null)
                        m_storage.fieldValue("rouble").exact = amount.exact;
                        m_storage.fieldValue("rouble").scaled = amount.scaled;
                    else
                        m_storage.fieldValue("rouble").setUndefined();
                    end;
                else
                    m_storage.fieldValue("rouble").exact = amount;
                    m_storage.fieldValue("rouble").recalculateScaled();
                end;
            else
                m_storage.fieldValue("rouble").setUndefined();
            end;
        end;

        return this;
    end;

    macro setEquivalentAmount(amount : Variant)
        if (m_storage != null)
            if (amount != null)
                if (isEqClass("TValue", amount))
                    if (amount.exact != null)
                        m_storage.fieldValue("equivalent").exact = amount.exact;
                        m_storage.fieldValue("equivalent").scaled = amount.scaled;
                    else
                        m_storage.fieldValue("equivalent").setUndefined();
                    end;
                else
                    m_storage.fieldValue("equivalent").exact = amount;
                    m_storage.fieldValue("equivalent").recalculateScaled();
                end;
            else
                m_storage.fieldValue("equivalent").setUndefined();
            end;
        end;

        return this;
    end;

    macro setTotalAmount(amount : Variant)
        if (m_storage != null)
            if (amount != null)
                if (isEqClass("TValue", amount))
                    if (amount.exact != null)
                        m_storage.fieldValue("total").exact = amount.exact;
                        m_storage.fieldValue("total").scaled = amount.scaled;
                    else
                        m_storage.fieldValue("total").setUndefined();
                    end;
                else
                    m_storage.fieldValue("total").exact = amount;
                    m_storage.fieldValue("total").recalculateScaled();
                end;
            else
                m_storage.fieldValue("total").setUndefined();
            end;
        end;

        return this;
    end;

    macro setExistsOpenAccountFlag(flag : Bool)
        m_storage.fieldValue("isExistsOpenAccount").exact = ternary(flag, "X", "");
        return this;
    end;

//    private macro constructorTOfrAttributeValueBase(symbol : RcbCompositeValue, roubleAmount : Money, equivalentAmount : Money, totalAmount : Money)
    private macro constructorTOfrAttributeValueBase(storage : RcbCompositeValue)
        if (parmCount() < 2)
            throw(TInvalidNumberOfParametersException("TOfrAttributeValueBase::constructorTOfrAttributeValueBase"));
        end;

        if (storage == null)
            throw(TUnspecifiedValueException("TOfrAttributeValueBase::constructorTOfrAttributeValueBase", "storage"));
        end;

        if (    (valType(storage) != V_GENOBJ)
            and (isEqClass("RcbCompositeValue", storage))
           )
            throw(TIncorrectParameterTypeException("TOfrAttributeValueBase::constructorTOfrAttributeValueBase", "storage"));
        end;

        m_storage = storage;
    end;

    constructorTOfrAttributeValueBase(storage);
end;

/**
 * ОФР. Класс значения атрибута для атрибута раздела 1.
 *
 * @since 16.11.2015
 * @author ABP
 * @version 6.20.031.032
 */
class (TOfrAttributeValueBase) TOfrAttributeValuePart1(storage : RcbCompositeValue)
    private macro constructorTOfrAttributeValuePart1(storage : RcbCompositeValue)
        initTOfrAttributeValueBase(storage);
    end;

    constructorTOfrAttributeValuePart1(storage);
end;

/**
 * ОФР со СПОД. Класс значения атрибута для атрибута раздела 1 .
 *
 * @since 04.10.2016
 * @author
 * @version 6.20.031.037
 */
class (TOfrAttributeValueBase) TOfrWithSpodAttributeValuePart1(storage : RcbCompositeValue)
    macro getRoubleSpodAmount() : Object
        if (m_storage != null)
            return m_storage.fieldValue("roubleSpod");
        end;

        return null;
    end;

    macro getEquivalentSpodAmount() : Object
        if (m_storage != null)
            return m_storage.fieldValue("equivalentSpod");
        end;

        return null;
    end;

    macro getTotalSpodAmount() : Object
        if (m_storage != null)
            return m_storage.fieldValue("totalSpod");
        end;

        return null;
    end;

    macro setSymbol(symbol : String)
        if (parmCount() < 2)
            throw(TInvalidNumberOfParametersException("TOfrWithSpodAttributeValueBase::setSymbol"));
        end;

        if (symbol == null)
            throw(TUnspecifiedValueException("TOfrWithSpodAttributeValueBase::setSymbol", "symbol"));
        end;

        if (valType(symbol) != V_STRING)
            throw(TIncorrectParameterTypeException("TOfrWithSpodAttributeValueBase::setSymbol", "symbol"));
        end;

        if (symbol == "")
            throw(TInvalidValueException("TOfrWithSpodAttributeValueBase::setSymbol", "symbol"));
        end;

        if (m_storage != null)
            m_storage.fieldValue("symbol").exact = symbol;
            m_storage.fieldValue("symbol").recalculateScaled();
        end;

        return this;
    end;

    macro setRoubleSpodAmount(amount : Variant)
        if (m_storage != null)
            if (amount != null)
                if (isEqClass("TValue", amount))
                    if (amount.exact != null)
                        m_storage.fieldValue("roubleSpod").exact = amount.exact;
                        m_storage.fieldValue("roubleSpod").scaled = amount.scaled;
                    else
                        m_storage.fieldValue("roubleSpod").setUndefined();
                    end;
                else
                    m_storage.fieldValue("roubleSpod").exact = amount;
                    m_storage.fieldValue("roubleSpod").recalculateScaled();
                end;
            else
                m_storage.fieldValue("roubleSpod").setUndefined();
            end;
        end;

        return this;
    end;

    macro setEquivalentSpodAmount(amount : Variant)
        if (m_storage != null)
            if (amount != null)
                if (isEqClass("TValue", amount))
                    if (amount.exact != null)
                        m_storage.fieldValue("equivalentSpod").exact = amount.exact;
                        m_storage.fieldValue("equivalentSpod").scaled = amount.scaled;
                    else
                        m_storage.fieldValue("equivalentSpod").setUndefined();
                    end;
                else
                    m_storage.fieldValue("equivalentSpod").exact = amount;
                    m_storage.fieldValue("equivalentSpod").recalculateScaled();
                end;
            else
                m_storage.fieldValue("equivalentSpod").setUndefined();
            end;
        end;

        return this;
    end;

    macro setTotalSpodAmount(amount : Variant)
        if (m_storage != null)
            if (amount != null)
                if (isEqClass("TValue", amount))
                    if (amount.exact != null)
                        m_storage.fieldValue("totalSpod").exact = amount.exact;
                        m_storage.fieldValue("totalSpod").scaled = amount.scaled;
                    else
                        m_storage.fieldValue("totalSpod").setUndefined();
                    end;
                else
                    m_storage.fieldValue("totalSpod").exact = amount;
                    m_storage.fieldValue("totalSpod").recalculateScaled();
                end;
            else
                m_storage.fieldValue("totalSpod").setUndefined();
            end;
        end;

        return this;
    end;

    private macro constructorTOfrWithSpodAttributeValuePart1(storage : RcbCompositeValue)
        initTOfrAttributeValueBase(storage);
    end;

    constructorTOfrWithSpodAttributeValuePart1(storage);
end;

/**
 * ОФР. Класс значения атрибута для атрибута раздела 1, не связаннонго с БД.
 * Используется как временное хранилище
 *
 * @since 16.11.2015
 * @author ABP
 * @version 6.20.031.032
 */
class (IOfrAttributeValue) TOfrStandaloneAttributeValuePart1(symbol : String, roubleAmount : Variant, equivalentAmount : Variant, totalAmount : Variant, isExistsOpenAccountFlag : bool)
    private var m_symbol : String;
    private var m_roubleAmount : TValue;
    private var m_currencyAmount : TValue;
    private var m_totalAmount : TValue;
    private var m_isExistsOpenAccount : bool;

    macro getSymbol() : String
        return m_symbol;
    end;

    macro getRoubleAmount() : TValue
        return m_roubleAmount;
    end;

    macro getEquivalentAmount() : TValue
        return m_currencyAmount;
    end;

    macro getTotalAmount() : TValue
        return m_totalAmount;
    end;

    macro isExistsOpenAccount() : bool
        return m_isExistsOpenAccount;
    end;

    macro setSymbol(symbol : String)
        if (parmCount() < 2)
            throw(TInvalidNumberOfParametersException("TOfrStandaloneAttributeValuePart1::setSymbol"));
        end;

        if (symbol == null)
            throw(TUnspecifiedValueException("TOfrStandaloneAttributeValuePart1::setSymbol", "symbol"));
        end;

        if (valType(symbol) != V_STRING)
            throw(TIncorrectParameterTypeException("TOfrStandaloneAttributeValuePart1::setSymbol", "symbol"));
        end;

        if (symbol == "")
            throw(TInvalidValueException("TOfrStandaloneAttributeValuePart1::setSymbol", "symbol"));
        end;

        m_symbol = symbol;

        return this;
    end;

    macro setRoubleAmount(amount : Variant)
        if (amount == null)
            m_roubleAmount.setUndefined();
        else
            if (isEqClass("TValue", amount))
                m_roubleAmount = amount;
            else
                m_roubleAmount = TValue(amount);
            end;
        end;

        return this;
    end;

    macro setEquivalentAmount(amount : Variant)
        if (amount == null)
            m_currencyAmount.setUndefined();
        else
            if (isEqClass("TValue", amount))
                m_currencyAmount = amount;
            else
                m_currencyAmount = TValue(amount);
            end;
        end;

        return this;
    end;

    macro setTotalAmount(amount : Variant)
        if (amount == null)
            m_totalAmount.setUndefined();
        else
            if (isEqClass("TValue", amount))
                m_totalAmount = amount;
            else
                m_totalAmount = TValue(amount);
            end;
        end;

        return this;
    end;

    macro setExistsOpenAccountFlag(flag : Bool)
        if ((flag == null) or (valType(flag) == V_UNDEF))
            m_isExistsOpenAccount = false;
        else
            m_isExistsOpenAccount = flag;
        end;

        return this;
    end;

    private macro constructorTOfrStandaloneAttributeValuePart1(symbol : String, roubleAmount : Variant, equivalentAmount : Variant, totalAmount : Variant, isExistsOpenAccountFlag : bool)
        if (parmCount() < 2)
            throw(TInvalidNumberOfParametersException("TOfrStandaloneAttributeValuePart1::constructorTOfrStandaloneAttributeValuePart1"));
        end;

        if (symbol == null)
            throw(TUnspecifiedValueException("TOfrStandaloneAttributeValuePart1::constructorTOfrStandaloneAttributeValuePart1", "symbol"));
        end;

        if (valType(symbol) != V_STRING)
            throw(TIncorrectParameterTypeException("TOfrStandaloneAttributeValuePart1::constructorTOfrStandaloneAttributeValuePart1", "symbol"));
        end;

        if ((valType(symbol) == V_STRING) and (symbol == ""))
            throw(TInvalidValueException("TOfrStandaloneAttributeValuePart1::constructorTOfrStandaloneAttributeValuePart1", "symbol"));
        end;

        setSymbol(symbol);
        setRoubleAmount(roubleAmount);
        setEquivalentAmount(equivalentAmount);
        setTotalAmount(totalAmount);
        setExistsOpenAccountFlag(isExistsOpenAccountFlag);
    end;

    constructorTOfrStandaloneAttributeValuePart1(symbol, roubleAmount, equivalentAmount, totalAmount, isExistsOpenAccountFlag);
end;

/**
 * ОФР со СПОД. Класс значения атрибута для атрибута раздела 1, не связаннонго с БД.
 * Используется как временное хранилище
 *
 * @since 04.10.2016
 * @author
 * @version 6.20.031.037
 */
class (TOfrStandaloneAttributeValuePart1) TOfrWithSpodStandaloneAttributeValuePart1(symbol : String,
                                                                                    roubleAmount : Variant, equivalentAmount : Variant, totalAmount : Variant,
                                                                                    roubleSpodAmount : Variant, equivalentSpodAmount : Variant, totalSpodAmount : Variant,
                                                                                    isExistsOpenAccountFlag : bool)
    private var m_roubleSpodAmount : TValue;
    private var m_currencySpodAmount : TValue;
    private var m_totalSpodAmount : TValue;

    macro setSymbol(symbol : String)
        if (parmCount() < 2)
            throw(TInvalidNumberOfParametersException("TOfrWithSpodStandaloneAttributeValuePart1::setSymbol"));
        end;

        if (symbol == null)
            throw(TUnspecifiedValueException("TOfrWithSpodStandaloneAttributeValuePart1::setSymbol", "symbol"));
        end;

        if (valType(symbol) != V_STRING)
            throw(TIncorrectParameterTypeException("TOfrWithSpodStandaloneAttributeValuePart1::setSymbol", "symbol"));
        end;

        if (symbol == "")
            throw(TInvalidValueException("TOfrWithSpodStandaloneAttributeValuePart1::setSymbol", "symbol"));
        end;

        m_symbol = symbol;

        return this;
    end;

    macro getRoubleSpodAmount() : TValue
        return m_roubleSpodAmount;
    end;

    macro getEquivalentSpodAmount() : TValue
        return m_currencySpodAmount;
    end;

    macro getTotalSpodAmount() : TValue
        return m_totalSpodAmount;
    end;

     macro setRoubleSpodAmount(amount : Variant)
        if (amount == null)
            m_roubleSpodAmount.setUndefined();
        else
            if (isEqClass("TValue", amount))
                m_roubleSpodAmount = amount;
            else
                m_roubleSpodAmount = TValue(amount);
            end;
        end;

        return this;
    end;

    macro setEquivalentSpodAmount(amount : Variant)
        if (amount == null)
            m_currencySpodAmount.setUndefined();
        else
            if (isEqClass("TValue", amount))
                m_currencySpodAmount = amount;
            else
                m_currencySpodAmount = TValue(amount);
            end;
        end;

        return this;
    end;

    macro setTotalSpodAmount(amount : Variant)
        if (amount == null)
            m_totalSpodAmount.setUndefined();
        else
            if (isEqClass("TValue", amount))
                m_totalSpodAmount = amount;
            else
                m_totalSpodAmount = TValue(amount);
            end;
        end;

        return this;
    end;

    private macro constructorTOfrWithSpodStandaloneAttributeValuePart1(symbol : String,
                                                                       roubleAmount : Variant, equivalentAmount : Variant, totalAmount : Variant,
                                                                       roubleSpodAmount : Variant, equivalentSpodAmount : Variant, totalSpodAmount : Variant,
                                                                       isExistsOpenAccountFlag : bool)
        if (parmCount() < 2)
            throw(TInvalidNumberOfParametersException("TOfrWithSpodStandaloneAttributeValuePart1::constructorTOfrWithSpodStandaloneAttributeValuePart1"));
        end;

        if (symbol == null)
            throw(TUnspecifiedValueException("TOfrWithSpodStandaloneAttributeValuePart1::constructorTOfrWithSpodStandaloneAttributeValuePart1", "symbol"));
        end;

        if (valType(symbol) != V_STRING)
            throw(TIncorrectParameterTypeException("TOfrWithSpodStandaloneAttributeValuePart1::constructorTOfrWithSpodStandaloneAttributeValuePart1", "symbol"));
        end;

        if ((valType(symbol) == V_STRING) and (symbol == ""))
            throw(TInvalidValueException("TOfrWithSpodStandaloneAttributeValuePart1::constructorTOfrWithSpodStandaloneAttributeValuePart1", "symbol"));
        end;

        setSymbol(symbol);
        setRoubleAmount(roubleAmount);
        setEquivalentAmount(equivalentAmount);
        setTotalAmount(totalAmount);
        setRoubleSpodAmount(roubleSpodAmount);
        setEquivalentSpodAmount(equivalentSpodAmount);
        setTotalSpodAmount(totalSpodAmount);
        setExistsOpenAccountFlag(isExistsOpenAccountFlag);

    end;

    constructorTOfrWithSpodStandaloneAttributeValuePart1(symbol, roubleAmount, equivalentAmount, totalAmount, roubleSpodAmount, equivalentSpodAmount, totalSpodAmount, isExistsOpenAccountFlag);
end;