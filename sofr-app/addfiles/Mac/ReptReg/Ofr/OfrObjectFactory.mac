/*
$Name:          OfrObjectFactory.mac
$Module:        Отчеты ЦБ
$Description:   ОФР. Фабрика объектов.
*/

/**
 * ОФР. Фабрика объектов.
 *
 * @since 18.11.2015
 * @author ABP
 * @version 6.20.031.032
 */
private class (RcbObjectFactoryBase) TOfrObjectFactoryImpl()
    macro createReport(report : RcbReport, isLazy : Bool) : RcbReportBase
        defaultParm(isLazy, false);
        return genObject("TOfrReport", report, isLazy);
    end;

    macro createPart(partId : String, compositeValue : Object) : RcbPartBase
        return genObject("TOfrPart", partId, compositeValue);
    end;

    macro createAttribute(id : String, part : RcbPartBase, value : Object, properties : Object) : RcbAttributeBase
        if (part.getId() == TOfrGlobal().getPart1Id())
            return genObject("TOfrAttributePart1", id, part, value, properties);
        else
            return null;
        end;
    end;

    macro createAttributeValue(part : RcbPartBase, storage : RcbCompositeValue) : Object
        if (part.getId() == TOfrGlobal().getPart1Id())
            return genObject("TOfrAttributeValuePart1", storage);
        else
            return null;
        end;
    end;

    macro createStandaloneAttributeValuePart1(symbol : String, roubleAmount : Variant, equivalentAmount : Variant, totalAmount : Variant, isExistsOpenAccountFlag : bool) : Object
        return genObject("TOfrStandaloneAttributeValuePart1", symbol, roubleAmount, equivalentAmount, totalAmount, isExistsOpenAccountFlag);
    end;

    macro createAttributeProperties(part : RcbPartBase, storage : RcbCompositeValue) : Object
        if (part.getId() == TOfrGlobal().getPart1Id())
            return genObject("TOfrAttributePropertiesPart1", storage);
        else
            return null;
        end;
    end;

    macro createDataSources(protocolView : RcbCalculateProtocolView) : RcbDataSources
        return genObject("TOfrDataSources", protocolView);
    end;

    macro createDataSourceFilters() : RcbDataSourceFilters
        return genObject("TOfrDataSourceFilters");
    end;

    macro createCalculateProtocolView(protocolName : String) : RcbCalculateProtocolView
        return genObject("TOfrCalculateProtocolView", protocolName);
    end;

    macro createPart1CalculateController(reportCalculateController : RcbReportCalculateController) : Object
        return genObject("TOfrPart1CalculateController", reportCalculateController);
    end;

    macro createReportCalculateController() : RcbReportCalculateController
        return genObject("TOfrReportCalculateController");
    end;

    macro createTuneTablePart1_5() : RcbTuneTable
        return genObject("TOfrTuneTablePart1_5", RCB_I446_DATE);
    end;

    macro createTuneTablePart7() : RcbTuneTable
        return genObject("TOfrTuneTablePart7", RCB_I446_DATE);
    end;

    macro createPrintProtocolView(protocolName : String)
        return genObject("TOfrPrintProtocolView", protocolName);
    end;

    macro createPartView(id : String, reportView : RcbReportView) : RcbReportView
        if (id == TOfrGlobal().getPart1Id())
            return genObject("TOfrPart1View", reportView);
        else
            return null;
        end;
    end;

    macro createApplicationPartView(id : String, reportView : RcbReportView) : RcbReportView
        if (id == TOfrGlobal().getPart1Id())
            return genObject("TOfrApplicationPart1View", reportView);
        else
            return null;
        end;
    end;

    macro createReportView(protocolView : RcbPrintProtocolView) : RcbReportView
        return genObject("TOfrReportView", protocolView);
    end;

    macro createApplicationReportView(protocolView : RcbPrintProtocolView, mode : integer) : RcbReportView
        return genObject("TOfrApplicationReportView", protocolView, mode);
    end;

    macro createReportExcelView(protocolView : RcbPrintProtocolView) : RcbReportView
        return genObject("TOfrReportExcelView", protocolView);
    end;

    macro createApplicationExcelView(protocolView : RcbPrintProtocolView, mode : integer) : RcbReportView
        return genObject("TOfrApplicationExcelView", protocolView, mode);
    end;

    macro createReportPrintController(format : String) : RcbReportPrintController
        return genObject("TOfrReportPrintController", format);
    end;

    macro createApplicationPrintController(format : String, mode : integer) : RcbReportPrintController
        return genObject("TOfrApplicationPrintController", format, mode);
    end;

    macro createKlikoExportController() : RcbKlikoExportController
        return genObject("TOfrExportKlikoController");
    end;

    macro createMonthDateKlikoExportController() : RcbKlikoExportController
        return genObject("TOfrMonthDateExportKlikoController");
    end;

    macro createXmlExportController()
        return genObject("TOfrExportXmlController");
    end;

    macro createMonthDateXmlExportController()
        return genObject("TOfrMonthDateExportXmlController");
    end;

    macro createPtkPsdExportController()
        return genObject("TOfrExportPtkPsdController");
    end;

    macro createParametersReader(path : String, name : String)
        return genObject("TOfrParametersReader", path, name);
    end;

    macro createPart1RecalculateController(reportRecalculateController : RcbReportCalculateController) : Object
        return genObject("TOfrPart1RecalculateController", reportRecalculateController);
    end;

    macro createReportRecalculateController()
        return genObject("TOfrReportRecalculateController");
    end;

    macro createPart1RecalculateTotalsController(reportRecalculateTotalsController : RcbReportCalculateController) : Object
        return genObject("TOfrPart1RecalculateTotalsController", reportRecalculateTotalsController);
    end;

    macro createReportRecalculateTotalsController()
        return genObject("TOfrReportRecalculateTotalsController");
    end;

    macro createNormalizationController()
        return genObject("TOfrNormalizationController");
    end;

    macro createPart1NormalizationProtocolView() : Object
        return genObject("TOfrPart1NormalizationProtocolView");
    end;

    macro createPart1Normalizer(protocolName)
        return genObject("TOfrPart1Normalizer", protocolName);
    end;

    /**
     * Метод используется при создании RcbReportView
     * Данный класс генериться именно таким образом, т.к. требует инкапсуляции представления
     * шапок(подвалов) печатных форм отчета в RcbReportView
     */
    macro createPrintableView(formName : String, formOkudCode : String, formPeriodicity, periodFormat : Integer)
        return genObject("TOfrPrintableView", formName, formOkudCode, formPeriodicity, periodFormat);
    end;

    private macro constructorTOfrObjectFactoryImpl()
        initRcbObjectFactoryBase();
    end;

    macro createNamesZone(formName : String, formOkudCode : String, formPeriodicity : String, periodFormat : Integer) : TNamesZone
        return genObject("TOfrNamesZone", formName, formOkudCode, formPeriodicity, periodFormat);
    end;

    constructorTOfrObjectFactoryImpl();
end;

private class (TOfrObjectFactoryImpl) TOfrObjectFactoryImpl_Т1_30_1_01_71542()
    initTOfrObjectFactoryImpl();

    macro createKlikoExportController() : RcbKlikoExportController
        return genObject("TOfrExportKlikoController_Т1_30_1_01_71542");
    end;
end;

private class (TOfrObjectFactoryImpl_Т1_30_1_01_71542) TOfrObjectFactoryImpl_Т1_30_1_01_71542M()
    initTOfrObjectFactoryImpl_Т1_30_1_01_71542();

    macro createMonthDateKlikoExportController() : RcbKlikoExportController
        return genObject("TOfrMonthDateExportKlikoController_Т1_30_1_01_71542M");
    end;
end;

class (TOfrObjectFactoryImpl) TOfrObjectFactoryImpl_Spod(concreteObjectFactory)
    initTOfrObjectFactoryImpl(concreteObjectFactory);

    macro createAttribute(id : String, part : RcbPartBase, value : Object, properties : Object) : RcbAttributeBase
        if (part.getId() == TOfrGlobal().getPart1Id())
            return genObject("TOfrWithSpodAttributePart1", id, part, value, properties);
        else
            return null;
        end;
    end;

    macro createAttributeValue(part : RcbPartBase, storage : RcbCompositeValue) : Object
        if (part.getId() == TOfrGlobal().getPart1Id())
            return genObject("TOfrWithSpodAttributeValuePart1", storage);
        else
            return null;
        end;
    end;

    macro createAttributeProperties(part : RcbPartBase, storage : RcbCompositeValue) : Object
        if (part.getId() == TOfrGlobal().getPart1Id())
            return genObject("TOfrWithSpodAttributePropertiesPart1", storage);
        else
            return null;
        end;
    end;

    macro createStandaloneAttributeValuePart1(symbol : String, roubleAmount : Variant, equivalentAmount : Variant, totalAmount : Variant,
                                                               roubleSpodAmount : Variant, equivalentSpodAmount : Variant, totalSpodAmount : Variant,
                                                               isExistsOpenAccountFlag : bool) : Object
        return genObject("TOfrWithSpodStandaloneAttributeValuePart1", symbol, roubleAmount, equivalentAmount, totalAmount, roubleSpodAmount, equivalentSpodAmount, totalSpodAmount,
                                                                      isExistsOpenAccountFlag);
    end;

    macro createPart1CalculateController(reportCalculateController : RcbReportCalculateController) : Object
        return genObject("TOfrSpodPart1CalculateController", reportCalculateController);
    end;

    macro createDataSources(protocolView : RcbCalculateProtocolView) : RcbDataSources
        return genObject("TOfrWithSpodDataSources", protocolView);
    end;

    macro createApplicationPartView(id : String, reportView : RcbReportView, mode : integer) : RcbReportView
        if (id == TOfrGlobal().getPart1Id())
            return genObject("TOfrWithSpodPart1View", reportView, mode);
        else
            return null;
        end;
    end;

    macro createCheckProtocolView(protocolName : String)
        return genObject("TOfrWithSpodCheckProtocolView", protocolName);
    end;

    macro createPart1CheckController(reportCheckController : RcbReportCheckController) : Object
        return genObject("TOfrWithSpodPart1CheckController", reportCheckController);
    end;

    macro createReportCheckController()
        return genObject("TOfrWithSpodReportCheckController");
    end;
end;

class (TOfrObjectFactoryImpl_Spod) TOfrObjectFactoryImpl_Spod_4212(concreteObjectFactory)
    initTOfrObjectFactoryImpl_Spod(concreteObjectFactory);

    macro createNamesZone(formName : String, formOkudCode : String, formPeriodicity : String, periodFormat : Integer) : TNamesZone
        return genObject("TOfrNamesZone_4212", formName, formOkudCode, formPeriodicity, periodFormat);
    end;
end;

private class (TOfrObjectFactoryImpl_Т1_30_1_01_71542M) TOfrObjectFactoryImpl_4212()
    initTOfrObjectFactoryImpl_Т1_30_1_01_71542M();

    /**
     * Метод используется при создании RcbReportView
     * Данный класс генериться именно таким образом, т.к. требует инкапсуляции представления
     * шапок(подвалов) печатных форм отчета в RcbReportView
     */
    macro createPrintableView(formName : String, formOkudCode : String, formPeriodicity, periodFormat : Integer)
        return genObject("TOfrPrintableView_4212", formName, formOkudCode, formPeriodicity, periodFormat);
    end;

    macro createReportPrintController(format : String) : RcbReportPrintController
        return genObject("TOfrReportPrintController_4212", format);
    end;

    macro createNamesZone(formName : String, formOkudCode : String, formPeriodicity : String, periodFormat : Integer) : TNamesZone
        return genObject("TOfrNamesZone_4212", formName, formOkudCode, formPeriodicity, periodFormat);
    end;
end;

private class (TOfrObjectFactoryImpl_4212) TOfrObjectFactoryImpl_Т1_30_1_01_59622()
    initTOfrObjectFactoryImpl_4212();

    macro createXmlExportController()
        return genObject("TOfrExportXmlController_Т1_30_1_01_59622");
    end;

    macro createMonthDateXmlExportController()
        return genObject("TOfrMonthDateExportXmlController_Т1_30_1_01_59622");
    end;
end;

private class (TOfrObjectFactoryImpl_Т1_30_1_01_59622) TOfrObjectFactoryImpl_4556()
    initTOfrObjectFactoryImpl_Т1_30_1_01_59622();

    macro createTuneTablePart1_5() : RcbTuneTable
        return genObject("TOfrTuneTablePart1_5_4556", RCB_I4556_DATE);
    end;

    macro createTuneTablePart7() : RcbTuneTable
        return genObject("TOfrTuneTablePart7_4556", RCB_I4556_DATE);
    end;

    macro createPart1CalculateController(reportCalculateController : RcbReportCalculateController) : Object
        return genObject("TOfrPart1CalculateController_4556", reportCalculateController);
    end;

    macro createPartView(id : String, reportView : RcbReportView) : RcbReportView
        if (id == TOfrGlobal().getPart1Id())
            return genObject("TOfrPart1View_4556", reportView);
        else
            return null;
        end;
    end;

    macro createKlikoExportController() : RcbKlikoExportController
        return genObject("TOfrExportKlikoController_4556");
    end;

    macro createMonthDateKlikoExportController() : RcbKlikoExportController
        return genObject("TOfrMonthDateExportKlikoController_4556");
    end;

    macro createPtkPsdExportController()
        return genObject("TOfrExportPtkPsdController_4556");
    end;
end;

if (objectFactoryInstance == null)
    if   (RcbApplication().currentReport.context.period.endDate >= RCB_I4556_DATE)
        objectFactoryInstance = TOfrObjectFactoryImpl_4556();
    elif (RcbApplication().currentReport.context.period.endDate >= RCB_Т1_30_1_01_59622)
        objectFactoryInstance = TOfrObjectFactoryImpl_Т1_30_1_01_59622();
    elif (RcbApplication().currentReport.context.period.endDate >= RCB_I4212_DATE)
        objectFactoryInstance = TOfrObjectFactoryImpl_4212();
    elif (RcbApplication().currentReport.context.period.endDate >= RCB_Т1_30_1_01_71542M_DATE)
        objectFactoryInstance = TOfrObjectFactoryImpl_Т1_30_1_01_71542M();
    elif (RcbApplication().currentReport.context.period.endDate >= RCB_Т1_30_1_01_71542_DATE)
        objectFactoryInstance = TOfrObjectFactoryImpl_Т1_30_1_01_71542();
    elif (RcbApplication().currentReport.context.period.endDate >= RCB_I446_DATE)
        objectFactoryInstance = TOfrObjectFactoryImpl();
    else
        objectFactoryInstance = null;
    end;

    if (TOfrGlobal().isOfrWithSpodReport()) //ОФР со СПОД
        if   (RcbApplication().currentReport.context.period.endDate >= RCB_I4212_DATE)
            objectFactoryInstance = TOfrObjectFactoryImpl_Spod_4212(objectFactoryInstance);
        else
            objectFactoryInstance = TOfrObjectFactoryImpl_Spod(objectFactoryInstance);
        end;
    end;
end;
