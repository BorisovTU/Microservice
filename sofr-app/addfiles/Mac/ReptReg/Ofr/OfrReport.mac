/*
$Name:          OfrReport.mac
$Module:        Отчеты ЦБ
$Description:   ОФР. Класс отчета.
*/

/**
 * ОФР. Отчет.
 *
 * @since 19.11.2015
 * @author ABP
 * @version 6.20.031.032
 */
class (RcbReportBase) TOfrReport(report : RcbReport, isLazy : Bool)
    private macro initialize()
        addPart(TOfrGlobal().getPart1Id(), getRcbReport().attributeValue("Символы")).initialize();
    end;

    macro isAccumPeriod()
        var dataSet = TRsbDataset("SELECT T_CACCUMPERIOD FROM DCY_FORMS_DBT WHERE T_SZFORMNAME = " + getSqlString(RcbApplication().currentReport.form.id));
        dataSet.setFieldType("T_CACCUMPERIOD",   V_STRING);

        if (dataSet.moveNext())
            if (dataSet.caccumperiod == "X")
                return true;
            end;
        end;

        return false;
    end;

    macro isEmpty()
        m_parts.moveFirst();
        while (m_parts.moveNext())
            if (not m_parts.getCurrentItem().isEmpty())
                return false;
            end;
        end;

        return true;
    end;

    private macro constructorTOfrReport(report : RcbReport, isLazy : Bool)
        initRcbReportBase(report, isLazy);
    end;

    constructorTOfrReport(report, isLazy);
end;
