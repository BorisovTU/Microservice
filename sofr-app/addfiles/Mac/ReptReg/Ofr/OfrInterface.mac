/*
$Name:          OfrInterface.mac
$Module:        Отчеты ЦБ
$Description:   ОФР. Доступ к операциям формы.
*/

import OfrImport;

/**
 *  Запуск операции расчета отчета
 */
macro executeCalculationOperation()
//    var profiler = TSqlProfiler(getTxtFileName("!OfrCalculateProfile"));
//    profiler.clear();
//    profiler.on();

    objectFactoryInstance.createReportCalculateController().calculate();
    RcbApplication().transactionManager.commit();
end;

/**
 *  Запуск операции нормализации
 */
macro executeNormalizationOperation()
    objectFactoryInstance.createNormalizationController().execute();
    RcbApplication().transactionManager.commit();
end;

/**
 * Запуск операции контроля рассчитанных данных
 */
macro executeCalculatedDataCheckoutOperation()
    objectFactoryInstance.createReportCheckController().check();
end;

/**
 *  Запуск операции пересчета после свода
 */
macro executeRecalculationOperation()
    objectFactoryInstance.createReportRecalculateController().calculate();
    RcbApplication().transactionManager.commit();
end;

/**
 *  Запуск операции пересчета итогов
 */
macro executeRecalculationTotalsOperation()
    objectFactoryInstance.createReportRecalculateTotalsController().calculate();
    RcbApplication().transactionManager.commit();
end;

/**
 *  Запуск операции печати отчета
 */
macro executePrintOperation()
    objectFactoryInstance.createReportPrintController().print();
end;

/**
 *  Запуск операции печати приложения к 446-П и ОФР со СПОД
 */
macro executeApplicationPrintOperation()
    const MODE_LABEL   = "-mode:";

    var modeLabelIndex = index(cmdArgs, MODE_LABEL);
    var inThousands    = ternary(substr(cmdArgs, modeLabelIndex + strlen(MODE_LABEL), strlen("inThousands")) == "inThousands", IN_THOUSANDS_MODE, IN_ROUBLE_MODE);

    objectFactoryInstance.createApplicationPrintController(null, inThousands).print();
end;

/**
 *  Запуск операции печати отчета в формате Excel
 */
macro executeExcelPrintOperation()
    objectFactoryInstance.createReportPrintController(WINREP_FORMAT_XLSX).print();
end;

/**
 *  Запуск операции печати приложения к 446-П в формате Excel
 */
macro executeApplicationExcelPrintOperation()
    const MODE_LABEL   = "-mode:";

    var modeLabelIndex = index(cmdArgs, MODE_LABEL);
    var inThousands    = ternary(substr(cmdArgs, modeLabelIndex + strlen(MODE_LABEL), strlen("inThousands")) == "inThousands", IN_THOUSANDS_MODE, IN_ROUBLE_MODE);

    objectFactoryInstance.createApplicationPrintController(WINREP_FORMAT_XLSX, inThousands).print();
end;

/**
 *  Запуск операции экспорта в kliko.exe
 */
macro executeKlikoExportOperation()
    objectFactoryInstance.createKlikoExportController().execute();
end;

/**
 *  Запуск операции экспорта в kliko.exe на месячную и внутримесячную дату
 */
macro executeMonthDateKlikoExportOperation()
    objectFactoryInstance.createMonthDateKlikoExportController().execute();
end;

/**
 *  Запуск операции экспорта в ПТК ПСД
 */
macro executePtkPsdExportOperation()
    objectFactoryInstance.createPtkPsdExportController().execute();
end;

/**
 *  Запуск операции экспорта в XML
 */
macro executeXmlExportController()
    objectFactoryInstance.createXmlExportController().execute();
end;

/**
 *  Запуск операции экспорта в XML на внутриквартальные даты по требованию ТУ
 */
macro executeMonthDateXmlExportController()
    objectFactoryInstance.createMonthDateXmlExportController().execute();
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
