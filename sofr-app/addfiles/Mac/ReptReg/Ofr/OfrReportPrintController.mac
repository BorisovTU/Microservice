/*
$Name:          OfrReportPrintController.mac
$Module:        Отчеты ЦБ
$Description:   ОФР. Контроллер печати отчета.
*/


class (RcbReportPrintController) TOfrReportPrintController(format : Integer)
    private var m_format : Integer;

    private macro printDataZone()
        getReportView().getPartView(TOfrGlobal().getPart1Id()).printData();
    end;

    private macro printAdditionalProtocolData()
        TOfrParameters().printPrintingReport(getProtocolView());
    end;

    private macro destructor()
        if (m_format == WINREP_FORMAT_XLSX)
            var view = getReportView();
            view.printSignatureZone();

            if (not m_protocolView.isEmpty())
                m_protocolView.show();
            end;

            view.resetOutputFile();

            view.createExcel();

            view.showExcel();
        else
            destructor();
        end;
    end;

    private macro constructorTOfrReportPrintController(format : Integer)
        initRcbReportPrintController();

        m_format = nvl(format, WINREP_FORMAT_HTML);

        if (m_format == WINREP_FORMAT_XLSX)
            m_reportView = objectFactoryInstance.createReportExcelView(getProtocolView());
        end;

        m_reportWidth = getReportView().getPartView(TOfrGlobal().getPart1Id()).getWidth();
    end;

    constructorTOfrReportPrintController(format);
end;

class (TOfrReportPrintController) TOfrReportPrintController_4212(format : Integer)
    initTOfrReportPrintController(format);

    macro print()
        checkReport();

        getReportView().setOutputFile();

        getReportView().setReportWidth(m_reportWidth);
        getReportView().printLendingAgencyCodeZone();
        getReportView().printNamesZone("Полное или сокращенное фирменное наименование кредитной организации ");

        if (getReport().isEmpty())
            getReportView().printNullDataZone();
        else
            printDataZone();
        end;
    end;
end;

class (RcbReportPrintController) TOfrApplicationPrintController(format : Integer, mode : integer)
    private var m_format : Integer;

    private macro printDataZone()
        getReportView().getPartView(TOfrGlobal().getPart1Id()).printData();
    end;

    private macro printAdditionalProtocolData()
        TOfrParameters().printPrintingReport(getProtocolView());
    end;

    private macro destructor()
        if (m_format == WINREP_FORMAT_XLSX)
            var view = getReportView();
            view.printSignatureZone();

            if (not m_protocolView.isEmpty())
                m_protocolView.show();
            end;

            view.resetOutputFile();

            view.createExcel();

            view.showExcel();
        else
            destructor();
        end;
    end;

    private macro constructorTOfrApplicationPrintController(format : Integer, mode : integer)
        initRcbReportPrintController();

        m_format = nvl(format, WINREP_FORMAT_HTML);

        if (m_format == WINREP_FORMAT_XLSX)
            m_reportView = objectFactoryInstance.createApplicationExcelView(getProtocolView(), mode);
        else
            m_reportView = objectFactoryInstance.createApplicationReportView(getProtocolView(), mode);
        end;

        m_reportWidth = getReportView().getPartView(TOfrGlobal().getPart1Id()).getWidth();
    end;

    constructorTOfrApplicationPrintController(format, mode);
end;
