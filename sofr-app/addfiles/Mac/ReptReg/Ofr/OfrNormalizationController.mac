/*
$Name:          OfrNormalizationController.mac
$Module:        Регламентируемая отчетность
$Description:   ОФР. Контроллер нормализации
*/

class TOfrNormalizationController()
    private var m_report;
    private var m_protocolView = null;

    macro constructorTOfrNormalizationController()
        m_report       = objectFactoryInstance.createReport();
        m_protocolView = objectFactoryInstance.createPart1NormalizationProtocolView();
    end;

    macro execute()
        if (   (TOfrGlobal().getRcbReport().normalizationAlgorithm == RCB_NA_NONE)
            or (TOfrParameters().getSymbolsMask() != "")
           )
            return;
        end;

        m_protocolView.beginProtocol();

        TOfrParameters().printNormalizationReport(m_protocolView);

        initProgress(null, "Выполнение нормализации данных", "Выполнение нормализации данных");

        objectFactoryInstance.createPart1Normalizer(m_protocolView).execute();

        remProgress();

        RcbApplication.TransactionManager.commit();

        m_protocolView.endProtocol();

        m_protocolView.show();
    end;

    constructorTOfrNormalizationController();
end;
