/*
$Name:          OfrCheckProtocolView.mac
$Module:        Регламентируемая отчетность
$Description:   ОФР со СПОД. Представление протокола контроля.
*/

private class (RcbDataProtocolView) TOfrWithSpodCheckoutProtocolData(id : String)
    private var m_needBottom : Bool;

    macro printBottom(totals : Money)
        if (m_needBottom)
            m_table.printBottom();
        end;
    end;

    macro printSeparator()
        m_table.printSeparator();
    end;

    macro printHead(attribute : RcbAttributeBase, description : String)
        m_table.memHead("\n" + description);
    end;

    macro printString(symbolOfr, ofrSymbolAmount, balanceNumber, balanceAmount, description)
        m_table.printMemStr();
        m_table.resetMemStr();

        m_table.printStringTransferByWord(symbolOfr,
                                          ofrSymbolAmount,
                                          balanceNumber,
                                          balanceAmount,
                                          description
                                         );
        m_needBottom = true;
    end;

    private macro initialize()
        m_table.addColumn("Символ ОФР", 10, STR_ALIGN_LEFT);
        m_table.addColumn("Значение символа ОФР", 16, STR_ALIGN_RIGHT);
        m_table.addColumn("Б/счет", 16, STR_ALIGN_RIGHT);
        m_table.addColumn("Остаток б/с", 16, STR_ALIGN_RIGHT);
        m_table.addColumn("Примечание", 75, STR_ALIGN_LEFT);
    end;

    private macro constructorTOfrWithSpodCheckoutProtocolData(id : String)
        initRcbDataProtocolView(id, true);
        m_needBottom = false;
    end;

    constructorTOfrWithSpodCheckoutProtocolData(id);
end;

class (RcbCheckProtocolView) TOfrWithSpodCheckProtocolView(protocolName : String)
    private macro initialize()
        m_dataProtocolViewPull.push_back(TOfrWithSpodCheckoutProtocolData());
    end;

    /**
     * Вывод в протокол сообщения об неудачном прохождении контроля
     */
    macro printFailedCheckoutProtocolText(message)
        for (var i, strTransferByWord(message, 90))
            printLine(i);
        end;
    end;

    /**
     * Вывод в протокол сообщения об успешном прохождении контроля
     */
    macro printSuccessfulCheckoutProtocolText()
        var message = "Контроль произведен успешно, ошибок в отчете не обнаружено";

        for (var i, strTransferByWord(message, 80))
            printLine(i);
        end;
    end;

    private macro constructorTOfrWithSpodCheckProtocolView(protocolName : String)
        initRcbCheckProtocolView(null, protocolName);
    end;

    constructorTOfrWithSpodCheckProtocolView(protocolName);
end;
