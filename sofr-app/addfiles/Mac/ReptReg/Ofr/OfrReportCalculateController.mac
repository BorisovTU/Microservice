/*
$Name:          OfrReportCalculateController.mac
$Module:        Отчеты ЦБ
$Description:   ОФР. Класс контроллера расчета отчета.
*/

class (RcbReportCalculateController) TOfrReportCalculateController()
    private macro clearValues()
        getReport().getPart(TOfrGlobal().getPart1Id()).getPartCompositeValue().removeAllValues();
        RcbApplication().transactionManager.commit();
        getReport().getPart(TOfrGlobal().getPart1Id()).clear();
        getDataSources().clear();
    end;

    private macro pushControllers()
        m_partCalculateControllers.push_back(objectFactoryInstance.createPart1CalculateController(this));
    end;

    private macro printAdditionalProtocolData()
        TOfrParameters().printCalculationReport(getProtocolView());
    end;

    macro initialize() : Bool
        if (TOfrGlobal().isOfrWithSpodReport() and (ВидПериода != RCB_PK_YEAR))
            m_protocolView.setProtocolOutput();
            m_protocolView.printHead();
            m_protocolView.printLine("Отчет \"ОФР со СПОД\" можно рассчитать только за период = год.");
            m_protocolView.resetProtocolOutput();
            m_protocolView.show();

            УстановитьФлагВозврата(STOP_PROC_FLG);
            exit(1);
        end;

        clearValues();
        pushControllers();

        return m_partCalculateControllers.size > 0;
    end;

    macro calculate()
        var result = calculate();
        for (var i, m_partCalculateControllers)
            i.getDataProtocolView().save();
        end;
        return result;
    end;

    private macro constructorTOfrReportCalculateController()
        initRcbReportCalculateController();
    end;

    constructorTOfrReportCalculateController();
end;
