/*
$Name:          F603PartCalculateController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 603. Контроллер расчета раздела
*/

class (RcbPartCalculateController) F603PartCalculateController(reportCalculateController : Object /*TReportCalculateController*/, partId : String)
    initRcbPartCalculateController(reportCalculateController, partId);

    macro writeAttributeData()
        var dataSourceFilter = m_dataSources.getDataSourceFilters().getFilter("Account");
        dataSourceFilter.accountIsOpened().op("AND").contractorIsBank().op("AND NOT").contractorIsLocked();

        var dataSet = m_dataSources.getDataSource("603DataSource").getData(dataSourceFilter);

        var attribute;
        var number = 1;

        while (dataSet.moveNext())
            attribute = m_report.getPart(1).getAttribute(String(number)+String(dataSet.branchId), dataSet.branchId);

            /*Параметры
            1-ый номер столбца        (column)
            2-ой значение             (value)
            3-ий тип значения         (valueType)
            4-ый валюта               (fiid)
            5-ый б/с                  (balance)
            6-ой краткое наименование (dataSet.shortName)
            7-ой номер субъекта       (partyId)
            */

            attribute.setValue(2,  dataSet.name,                   RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(3,  dataSet.regnumber,              RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(4,  String(dataSet.codecountry),    RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(5,  String(dataSet.balance),        RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(6,  NVL(dataSet.repaccount,""),     RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(7,  dataSet.inrest,                 RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(8,  dataSet.debetsum,               RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(9,  dataSet.creditsum,              RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(10, dataSet.outrest,                RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*1-резидент,2-нерезидент*/
            attribute.setValue(11, String(dataSet.isresident:0:0), RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*номер л/с*/
            attribute.setValue(12, dataSet.account,                RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*А/П л/с*/
            attribute.setValue(13, dataSet.kind,                   RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);

            number = number + 1;
        end;
    end;

    macro getAttributesData()
        return RcbCalculationAttributeData(null,
                                           RcbArray().initialize(RcbCalculationData(r2m(this, "writeAttributeData"),
                                                                                    RcbArray().initialize(/*список параметров*/))));
    end;

    macro execute()
        m_reportCalculateController.addCalculationAttributeData(getAttributesData());
    end;
end;

class (F603PartCalculateController) F603PartCalculateController_2539(reportCalculateController : Object, partId : String)
    initRcbPartCalculateController(reportCalculateController, partId);

    macro writeAttributeData()
        var dataSourceFilter = m_dataSources.getDataSourceFilters().getFilter("Account");
        dataSourceFilter.accountIsOpened().op("AND").contractorIsBank().op("AND NOT").contractorIsLocked();

        var dataSet = m_dataSources.getDataSource("603DataSource").getData(dataSourceFilter);

        var attribute;
        var number = 1;

        while (dataSet.moveNext())
            attribute = m_report.getPart(1).getAttribute(String(number)+String(dataSet.branchId), dataSet.branchId);

            attribute.setValue(2,  dataSet.name,                   RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(3,  dataSet.regnumber,              RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(4,  String(dataSet.codecountry),    RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(5,  NVL(dataSet.repaccount,""),     RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(6,  NVL(dataSet.account,""),        RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(7,  dataSet.inrest,                 RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(8,  dataSet.debetsum,               RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(9,  dataSet.creditsum,              RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(10, dataSet.outrest,                RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*1-резидент,2-нерезидент*/
            attribute.setValue(11, String(dataSet.isresident:0:0), RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*номер л/с*/
            attribute.setValue(12, dataSet.account,                RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*А/П л/с*/
            attribute.setValue(13, dataSet.kind,                   RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(14, String(dataSet.partyId),        RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);

            number = number + 1;
        end;
    end;
end;

class (F603PartCalculateController) F603PartCalculateController_3129(reportCalculateController : Object, partId : String)
    initRcbPartCalculateController(reportCalculateController, partId);

    macro writeAttributeData()
        var dataSourceFilter = m_dataSources.getDataSourceFilters().getFilter("Account");
        dataSourceFilter.accountIsOpened().op("AND").contractorIsBank().op("AND NOT").contractorIsLocked().op("AND").bankIsOpenedAtEndDate("repparty.t_bankCloseDate");

        var dataSet = m_dataSources.getDataSource("603DataSource").getData(dataSourceFilter);

        var attribute;
        var number = 1;

        while (dataSet.moveNext())
            attribute = m_report.getPart(1).getAttribute(String(number)+String(dataSet.branchId), dataSet.branchId);

            attribute.setValue(2,  dataSet.name,                   RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(3,  NVL(dataSet.regnumber, ""),     RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(4,  String(dataSet.codecountry),    RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(5,  NVL(dataSet.repaccount,""),     RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(6,  NVL(dataSet.account,""),        RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(7,  dataSet.inrest,                 RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(8,  dataSet.debetsum,               RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(9,  dataSet.creditsum,              RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(10, dataSet.outrest,                RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*1-резидент,2-нерезидент*/
            attribute.setValue(11, String(dataSet.isresident:0:0), RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*номер л/с*/
            attribute.setValue(12, dataSet.account,                RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*А/П л/с*/
            attribute.setValue(13, dataSet.kind,                   RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(14, String(dataSet.partyId),        RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*категория "Вид актива" со значением "Третье лицо"*/
            attribute.setValue(15, dataSet.isThirdPerson,          RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* НомПП_Сумма */
            attribute.setValue(16, dataSet.amountFunds,            RCB_VT_MONEY, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* НомПП_Срок */
            attribute.setValue(17, dataSet.duration,               RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* НомПП_% */
            attribute.setValue(18, dataSet.interestRate,           RCB_VT_MONEY, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* НомПП_Пояснения */
            attribute.setValue(19, dataSet.explanations,           RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);

            number = number + 1;
        end;
    end;
end;

class (F603PartCalculateController) F603PartCalculateController_4212(reportCalculateController : Object, partId : String)
    initRcbPartCalculateController(reportCalculateController, partId);

    macro writeAttributeData()
        var dataSourceFilter = m_dataSources.getDataSourceFilters().getFilter("Account");
        dataSourceFilter.accountIsOpened().op("AND").contractorIsBank().op("AND NOT").contractorIsLocked().op("AND").bankIsOpenedAtEndDate("repparty.t_bankCloseDate");

        var dataSet = m_dataSources.getDataSource("603DataSource").getData(dataSourceFilter);

        var attribute;
        var number = 1;

        while (dataSet.moveNext())
            attribute = m_report.getPart(1).getAttribute(String(number)+String(dataSet.branchId), dataSet.branchId);

            /*атрибуты, выводимые в печатную форму*/
            attribute.setValue(2,  dataSet.name,                            RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(3,  NVL(dataSet.regnumber, ""),              RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(4,  String(dataSet.codecountry),             RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(5,  NVL(dataSet.repaccount,""),              RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(6,  NVL(dataSet.account,""),                 RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(7,  dataSet.inrest,                          RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(8,  dataSet.debetsum,                        RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(9,  dataSet.creditsum,                       RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(10, dataSet.outrest,                         RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(11, NVL(dataSet.t_onerousClaim, ""),         RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(12, NVL(dataSet.t_identifier, ""),           RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(13, NVL(dataSet.t_onerousClaimCategory, ""), RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(14, dataSet.t_restLinkedAccount,             RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            attribute.setValue(15, NVL(dataSet.t_redemptionDate, ""),       RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);

            /*1-резидент, 2-нерезидент*/
            attribute.setValue(16, String(dataSet.isresident:0:0),          RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*номер л/с*/
            attribute.setValue(17, dataSet.account,                         RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*А/П л/с*/
            attribute.setValue(18, dataSet.kind,                            RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*идентификатор подразделения*/
            attribute.setValue(19, String(dataSet.partyId),                 RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /*категория "Вид актива" со значением "Третье лицо"*/
            attribute.setValue(20, dataSet.isThirdPerson,                   RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* НомПП_Сумма */
            attribute.setValue(21, dataSet.amountFunds,                     RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* НомПП_Срок */
            attribute.setValue(22, dataSet.duration,                        RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* НомПП_% */
            attribute.setValue(23, dataSet.interestRate,                    RCB_VT_MONEY,  dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* НомПП_Пояснения */
            attribute.setValue(24, dataSet.explanations,                    RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);

            /* Филиал_SWIFT_Kliko */
            attribute.setValue(25, dataSet.branchSwiftKliko,                RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* Условн_код_kliko */
            attribute.setValue(26, dataSet.conditionalCodeKliko,            RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);
            /* код страны обременителя */
            attribute.setValue(27, String(dataSet.t_codeCountryClaim),      RCB_VT_STRING, dataSet.fiid, dataSet.balance, dataSet.shortName, dataSet.partyId, dataSet.isCorrect);

            number = number + 1;
        end;
    end;
end;
