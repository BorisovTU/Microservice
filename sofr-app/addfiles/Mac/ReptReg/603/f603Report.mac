class TSorter1()

    macro isLess(v1, v2)

        return (v1.fieldValue("fiid").current < v2.fieldValue("fiid").current)
            or (      (v1.fieldValue("fiid").current == v2.fieldValue("fiid").current)
                 and  (     (v1.fieldValue("balance").current < v2.fieldValue("balance").current)
                         or (      (v1.fieldValue("balance").current  == v2.fieldValue("balance").current)
                              and  (v1.fieldValue("partyId").current  <  v2.fieldValue("partyId").current)
                            )
                      )
               );

    end;

end;

class TSorter2()

    macro isLess(v1, v2)

        return (v1.fieldValue("fiid").current < v2.fieldValue("fiid").current)
                or (      (v1.fieldValue("fiid").current == v2.fieldValue("fiid").current)
                     and  (     (v1.fieldValue("balance").current < v2.fieldValue("balance").current)
                             or (      (v1.fieldValue("balance").current  == v2.fieldValue("balance").current)
                                  and  (v1.fieldValue("shortName").current  <  v2.fieldValue("shortName").current)
                                )
                          )
                   );

    end;

end;

class TSorter3()

    macro isLess(v1, v2)

        return (v1.fieldValue("fiid").current < v2.fieldValue("fiid").current)
                or (      (v1.fieldValue("fiid").current == v2.fieldValue("fiid").current)
                     and  (v1.fieldValue("partyId").current < v2.fieldValue("partyId").current)
                   );

    end;

end;

class TSorter4()

    macro isLess(v1, v2)

        return (v1.fieldValue("fiid").current < v2.fieldValue("fiid").current)
                or (      (v1.fieldValue("fiid").current == v2.fieldValue("fiid").current)
                     and  (v1.fieldValue("shortName").current < v2.fieldValue("shortName").current)
                   );

    end;

end;

class TSorter5()

    macro isLess(v1, v2)

        return (v1.fieldValue("balance").current < v2.fieldValue("balance").current)
                or (      (v1.fieldValue("balance").current == v2.fieldValue("balance").current)
                     and  (v1.fieldValue("partyId").current < v2.fieldValue("partyId").current)
                   );

    end;

end;

class TSorter6()

    macro isLess(v1, v2)

        return (v1.fieldValue("balance").current < v2.fieldValue("balance").current)
                or (      (v1.fieldValue("balance").current == v2.fieldValue("balance").current)
                     and  (v1.fieldValue("shortName").current < v2.fieldValue("shortName").current)
                   );

    end;

end;

class TSorter7()

    macro isLess(v1, v2)

        return (v1.fieldValue("partyId").current < v2.fieldValue("partyId").current);

    end;

end;

class TSorter8()

    macro isLess(v1, v2)

        return (v1.fieldValue("shortName").current < v2.fieldValue("shortName").current)

    end;

end;

class TSorter9()

    macro isLess(v1, v2)

        return (v1.fieldValue("balance").current < v2.fieldValue("balance").current)
                or (      (v1.fieldValue("balance").current == v2.fieldValue("balance").current)
                     and  (v1.fieldValue("fiid").current < v2.fieldValue("fiid").current)
                   );

    end;

end;

class (RcbReportBase) F603Report(report : RcbReport, isLazy : Bool, typeSort : String)

    private var m_attributeValue = null;

    private var m_isEmpty : Bool;

    private var m_typeSort : String = typeSort;

    initRcbReportBase(report, isLazy);

    private macro initializeTypeSort()

        var isPrintRubAccountSeparately;
        var isSortForBalance;
        var typeSortForClient;

        getRegistryValue("REPTREG\\REP_GROUPS\\ФОРМА 603\\ПЕЧАТЬ РУБЛЕВЫХ ОТДЕЛЬНО" , V_BOOL,    isPrintRubAccountSeparately, NULL);
        getRegistryValue("REPTREG\\REP_GROUPS\\ФОРМА 603\\СОРТИРОВКА\\ПО БАЛАНСОВЫМ", V_BOOL,    isSortForBalance,            NULL);
        getRegistryValue("REPTREG\\REP_GROUPS\\ФОРМА 603\\СОРТИРОВКА\\ПО КЛИЕНТАМ"  , V_INTEGER, typeSortForClient,           NULL);


        if (isPrintRubAccountSeparately)

            m_typeSort = "Rub";

            if (isSortForBalance)
                m_typeSort = m_typeSort + "Bal";
            end;
        else
            if (isSortForBalance)
                m_typeSort = "Bal";
            end;
        end;

        if (typeSortForClient == 2)
            if ((not isPrintRubAccountSeparately) and (not isSortForBalance))
                m_typeSort = "Client2";
            else
                m_typeSort = m_typeSort + "Client2";
            end;
        else
            if ((not isPrintRubAccountSeparately) and (not isSortForBalance))
                m_typeSort = "Client1";
            else
                m_typeSort = m_typeSort + "Client1";
            end;
        end;

    end;

    private macro getPartCompositeValue() /*RcbCompositeValue или RcbAttributeValue*/
        if (m_attributeValue == null)
            m_attributeValue = m_rcbReport.attributeValue("ДанныеОтчета");
        end;

        return m_attributeValue;
    end;

    macro initialize()

        m_isEmpty  = true;

        var part = getPart(1);
        var iterator = getPartCompositeValue().createValueIterator();

        if ((m_typeSort == null) or (m_typeSort == ""))
            initializeTypeSort();
        end;
        /*Сначала сортировка по рублевым счетам, потом по балановым счетам, потом по идентификатору субъекта*/
        if (m_typeSort == "RubBalClient1")
            iterator.setSortOrder(TSorter1());
        /*Сначала сортировка по рублевым счетам, потом по балановым счетам, потом по короткому наименованию*/
        elif (m_typeSort == "RubBalClient2")
            iterator.setSortOrder(TSorter2());
        /*Сначала сортировка по рублевым счетам, потом по идентификатору субъекта*/
        elif (m_typeSort == "RubClient1")
            iterator.setSortOrder(TSorter3());
        /*Сначала сортировка по рублевым счетам, потом по короткому наименованию*/
        elif (m_typeSort == "RubClient2")
            iterator.setSortOrder(TSorter4());
        /*Сначала сортировка по балановым счетам, потом по идентификатору субъекта*/
        elif (m_typeSort == "BalClient1")
            iterator.setSortOrder(TSorter5());
        /*Сначала сортировка по балановым счетам, потом по короткому наименованию*/
        elif (m_typeSort == "BalClient2")
            iterator.setSortOrder(TSorter6());
        /*По идентификатору субъекта*/
        elif (m_typeSort == "Client1")
            iterator.setSortOrder(TSorter7());
        /*Сначала по балансовым счетам, потом по идентификатору валюты*/
        elif (m_typeSort == "BalanceFiid")
            iterator.setSortOrder(TSorter9());
        /*По короткому наименованию*/
        else
            iterator.setSortOrder(TSorter8())
        end;

        iterator.moveFirst();
        while (not iterator.isDone())
            part.addAttribute(iterator.currentItem.fieldValue("row").currentAsString+iterator.currentItem.fieldValue("branchId").currentAsString,iterator.currentItem.fieldValue("branchId").currentAsString);

            if (not in(iterator.currentItem.fieldValue("money").current, null, $0.0))
                m_isEmpty = false;
            end;

            iterator.moveNext();
        end;
    end;

    macro isEmpty()
        return m_isEmpty;
    end;
end;