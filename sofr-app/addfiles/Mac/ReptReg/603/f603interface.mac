/*
$Name:          f603interface.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 603. Операции формы
*/
/**
 *  Общебанковские интеры и модули
 */

/**
 *  Интеры и модели подсистемы
 */
import f603import;

/**
 *  Запуск операции расчета отчета
 */
macro executeCalculationOperation()
    var profiler = TSQLProfiler(getTxtFileName("!F603CalculateProfile"));
    profiler.clear();
    profiler.on();

    objectFactoryInstance.createReportCalculateController().calculate();
end;

/**
 *  Запуск операции печати отчета
 */
macro executePrintOperation()
    objectFactoryInstance.createReportPrintController().print();
    RcbApplication.TransactionManager.rollBack();
end;

/**
 *  Запуск операции экспорта в Kliko.exe
 */
macro executeKlikoExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В Kliko.exe").checkCalculateReport("kliko.exe");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createKlikoExportController().execute();
    RcbApplication.TransactionManager.rollBack();
end;

/**
 *  Запуск операции экспорта в ПТК ПСД
 */
macro executePtkPsdExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В АС ПСД").checkCalculateReport("АС ПСД");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createPtkPsdExportController().execute();
    RcbApplication.TransactionManager.rollBack();
end;

/**
 *  Запуск операции нормализации
 */
macro executeNormalizationOperation()                  
    objectFactoryInstance.createNormalizationController().execute();    
end;

/**
 *  Запуск операции контроля исходных данных
 */
macro executeControlBeginDataOperation()                  
    objectFactoryInstance.createBeginDataController().execute();    
end;

/**
 *  Запуск операции печати протокола расчета
 */
macro executePrintCalculateProtocol()                  
    var profiler = TSQLProfiler(getTxtFileName("!F603CalculateProtocolProfile"));
    profiler.clear();
    profiler.on();

    objectFactoryInstance.createPrintProtocolController().printProtocol();    
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
