/*
$Name:          ex_ptkpsd128.mac
$Module:        ¥£« ¬¥­â¨àã¥¬ ï ®âç¥â­®áâì
$Description:   ”®à¬  128. ªá¯®àâ €‘ ‘„
*/

import rcbImport;
import cb_sql;
import rcbCoreInter;
import RcbProtocolView;
import RcbPtkPsdView;
import Š «¥­¤ àì;

class (TPtkPsdView) T128PtkPsdView()
    initTPtkPsdView("128", RcbApplication.currentReport.context.period.endDate + 1); //„+1

    var day, month, year;
    DateSplit(m_reportDate, day, month, year);

    m_stringReportDate =  strLpad(string(day),   2, "0") + "."
                        + strLpad(string(month), 2, "0") + "."
                        + string(year);
end;

class (TPtkPsdView) T128PtkPsdView_0MW5K()
    private macro constructorT128PtkPsdView_0MW5K()
        initTPtkPsdView("128", RcbApplication.currentReport.context.period.endDate + 1, "rsansi");

        setDate(false);

        m_name     = ¯®«ãç¨âìŠ â «®£ªá¯®àâ () + "\\" + strSubst(m_stringReportDate, ".", "")
                                                      + "AsPsd"
                                                      + "." + m_fileExtension;

        setDate(true);
    end;

    constructorT128PtkPsdView_0MW5K();
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ ’Š ‘„ ¤«ï à §¤¥« .
 */
class TPtkPsdExportPartController(view, part, head)

    private var m_view            = view;         //¯à¥¤áâ ¢«¥­¨¥ ¯¥ç â¨
    private var m_part            = part;         //à §¤¥«
    private var m_applicationCode = head;         //§ £®«®¢®ª à §¤¥« 
    private var stringCodeArray : TArray;         //¬ áá¨¢ ¢®§¬®¦­ëå §­ ç¥­¨© ª®¤®¢ áâà®ª¨ (¯¥à¨®¤)

    private macro initStringCodeArray()
        stringCodeArray[stringCodeArray.size] = "M1";
        stringCodeArray[stringCodeArray.size] = "DV";
        stringCodeArray[stringCodeArray.size] = "D1";
        stringCodeArray[stringCodeArray.size] = "2D7";
        stringCodeArray[stringCodeArray.size] = "8D30";
        stringCodeArray[stringCodeArray.size] = "1M3";
        stringCodeArray[stringCodeArray.size] = "3M6";
        stringCodeArray[stringCodeArray.size] = "6M12";
        stringCodeArray[stringCodeArray.size] = "1Y3";
        stringCodeArray[stringCodeArray.size] = "3Y";
        stringCodeArray[stringCodeArray.size] = "summ";
        stringCodeArray[stringCodeArray.size] = "7.1";
        stringCodeArray[stringCodeArray.size] = "7.2";
    end;

    private macro getCbKeyRate()
        var endDate = RcbApplication.currentReport.context.period.endDate;
        var sqlStr = "select t_rate "
             + "\n" + "    from dcbkeyrate_dbt "
             + "\n" + "        where  t_datefrom = "
             + "\n" + "               (select max (t_datefrom) "
             + "\n" + "                    from dcbkeyrate_dbt where t_datefrom <=" + getSqlDate(endDate) + ")";
        var ds = TrsbDataSet(sqlStr);

        if (ds.moveNext())
            return string(ds.rate:0:3);
        end;
        return "0.000";
   end;

    private macro printExportString(varName : String, period : Integer, column)
        var formVariableName = varName;
        var periodNumber     = period;
        var columnNumber     = column;


        if ((formVariableName == "") and (periodNumber == 0) and (columnNumber == 0))
             // §¤¥« "‘¯à ¢®ç­®"
             var rateOfTaxableBase = ternary(RcbFactor("‘â ¢ª  ­ «®£®®¡« £ ¥¬®© ¡ §ë ¤«ï áà¥¤áâ¢ ¢ ¨­®áâà ­­®© ¢ «îâ¥").getValue(rcbApplication.currentReport.context.period.endDate).isDefined(),
                                    RcbFactor("‘â ¢ª  ­ «®£®®¡« £ ¥¬®© ¡ §ë ¤«ï áà¥¤áâ¢ ¢ ¨­®áâà ­­®© ¢ «îâ¥").getValue(rcbApplication.currentReport.context.period.endDate).max, 0);

             m_view.printRow(m_applicationCode,
                             "stav",
                             "rub",
                             getCbKeyRate());
             m_view.printRow(m_applicationCode,
                             "stav",
                             "val",
                             string(rateOfTaxableBase:0:3));
        else
            var curValue;
            var currentValue;
            if (mod(column,2) == 0)
                 currentValue = string(nvl(RcbApplication.CurrentReport.attributeValue(formVariableName).scaled, 0.000) * 100:0:3);
            else
                 currentValue = RcbApplication.CurrentReport.attributeValue(formVariableName).scaledAsString;
                 if (currentValue == stringUndefined)
                     currentValue = "0";
                 end;
            end;
            m_view.printRow(m_applicationCode,                        //ª®¤ ¯à¨«®¦¥­¨ï
                            stringCodeArray[periodNumber],            //ª®¤ áâà®ª¨
                            string(columnNumber),                     //ª®¤ ª®«®­ª¨
                            currentValue);                            //§­ ç¥­¨¥
        end;
    end;

     macro execute()
         stringCodeArray                = TArray();
         var periodIterator  : Integer;

         initStringCodeArray();
         periodIterator = 0;
         if (m_part == 1)
             //¯¥à¨®¤  M1
             printExportString("”128_810_”‹_1___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;  //DV
             printExportString("”128_810_”‹_1_1_%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1_1_‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1_1_%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1_1_‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1_1_%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1_1_‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1_1_%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1_1_‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1_1_%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1_1_‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //D1
             printExportString("”128_810_”‹_1_2_%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1_2_‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1_2_%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1_2_‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1_2_%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1_2_‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1_2_%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1_2_‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1_2_%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1_2_‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //2D7
             printExportString("”128_810_”‹_1_3_%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1_3_‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1_3_%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1_3_‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1_3_%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1_3_‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1_3_%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1_3_‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1_3_%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1_3_‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //8D30
             printExportString("”128_810_”‹_1_4_%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1_4_‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1_4_%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1_4_‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1_4_%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1_4_‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1_4_%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1_4_‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1_4_%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1_4_‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //1M3
             printExportString("”128_810_”‹_2___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_2___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_2___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_2___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_2___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_2___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_2___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_2___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_2___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_2___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //3M6
             printExportString("”128_810_”‹_3___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_3___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_3___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_3___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_3___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_3___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_3___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_3___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_3___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_3___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //6M12
             printExportString("”128_810_”‹_4___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_4___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_4___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_4___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_4___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_4___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_4___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_4___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_4___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_4___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //1Y3
             printExportString("”128_810_”‹_5___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_5___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_5___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_5___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_5___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_5___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_5___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_5___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_5___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_5___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //3Y
             printExportString("”128_810_”‹_6___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_6___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_6___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_6___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_6___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_6___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_6___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_6___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_6___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_6___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //summ
             printExportString("”128_810_”‹_ˆ___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_ˆ___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_ˆ___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_ˆ___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_ˆ___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //7.1
             printExportString("”128_810_”‹_71__‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_71__‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_71__‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //7.2
             printExportString("”128_810_”‹_72__‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_72__‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_72__‘__ŒŠ", periodIterator, 7);
         elif (m_part == 2)
             //¯¥à¨®¤  M1
             printExportString("”128_840_”‹_1___%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_1___‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_1___%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_1___‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_1___%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_1___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;  //DV
             printExportString("”128_840_”‹_1_1_%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_1_1_‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_1_1_%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_1_1_‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_1_1_%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_1_1_‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //D1
             printExportString("”128_840_”‹_1_2_%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_1_2_‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_1_2_%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_1_2_‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_1_2_%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_1_2_‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //2D7
             printExportString("”128_840_”‹_1_3_%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_1_3_‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_1_3_%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_1_3_‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_1_3_%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_1_3_‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //8D30
             printExportString("”128_840_”‹_1_4_%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_1_4_‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_1_4_%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_1_4_‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_1_4_%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_1_4_‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //1M3
             printExportString("”128_840_”‹_2___%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_2___‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_2___%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_2___‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_2___%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_2___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //3M6
             printExportString("”128_840_”‹_3___%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_3___‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_3___%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_3___‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_3___%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_3___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //6M12
             printExportString("”128_840_”‹_4___%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_4___‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_4___%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_4___‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_4___%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_4___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //1Y3
             printExportString("”128_840_”‹_5___%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_5___‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_5___%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_5___‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_5___%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_5___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //3Y
             printExportString("”128_840_”‹_6___%__Š_", periodIterator, 2);
             printExportString("”128_840_”‹_6___‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_6___%__Š_", periodIterator, 4);
             printExportString("”128_840_‹_6___‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_6___%__ŒŠ", periodIterator, 6);
             printExportString("”128_840_Š_6___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //summ
             printExportString("”128_840_”‹_ˆ___‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_ˆ___‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_ˆ___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //7.1
             printExportString("”128_840_”‹_71__‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_71__‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_71__‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //7.2
             printExportString("”128_840_”‹_72__‘__Š_", periodIterator, 3);
             printExportString("”128_840_‹_72__‘__Š_", periodIterator, 5);
             printExportString("”128_840_Š_72__‘__ŒŠ", periodIterator, 7);
         elif (m_part == 3)
             //¯¥à¨®¤  M1
             printExportString("”128_978_”‹_1___%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_1___‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_1___%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_1___‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_1___%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_1___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;  //DV
             printExportString("”128_978_”‹_1_1_%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_1_1_‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_1_1_%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_1_1_‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_1_1_%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_1_1_‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //D1
             printExportString("”128_978_”‹_1_2_%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_1_2_‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_1_2_%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_1_2_‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_1_2_%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_1_2_‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //2D7
             printExportString("”128_978_”‹_1_3_%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_1_3_‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_1_3_%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_1_3_‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_1_3_%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_1_3_‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //8D30
             printExportString("”128_978_”‹_1_4_%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_1_4_‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_1_4_%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_1_4_‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_1_4_%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_1_4_‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //1M3
             printExportString("”128_978_”‹_2___%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_2___‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_2___%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_2___‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_2___%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_2___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //3M6
             printExportString("”128_978_”‹_3___%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_3___‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_3___%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_3___‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_3___%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_3___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //6M12
             printExportString("”128_978_”‹_4___%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_4___‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_4___%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_4___‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_4___%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_4___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //1Y3
             printExportString("”128_978_”‹_5___%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_5___‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_5___%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_5___‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_5___%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_5___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //3Y
             printExportString("”128_978_”‹_6___%__Š_", periodIterator, 2);
             printExportString("”128_978_”‹_6___‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_6___%__Š_", periodIterator, 4);
             printExportString("”128_978_‹_6___‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_6___%__ŒŠ", periodIterator, 6);
             printExportString("”128_978_Š_6___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //summ
             printExportString("”128_978_”‹_ˆ___‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_ˆ___‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_ˆ___‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //7.1
             printExportString("”128_978_”‹_71__‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_71__‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_71__‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //7.2
             printExportString("”128_978_”‹_72__‘__Š_", periodIterator, 3);
             printExportString("”128_978_‹_72__‘__Š_", periodIterator, 5);
             printExportString("”128_978_Š_72__‘__ŒŠ", periodIterator, 7);
         elif (m_part == 4)
             printExportString("", 0, 0);
         end;
     end;
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ ’Š ‘„ ¤«ï à §¤¥«  1 ¯® ãª § ­¨î 2835-“.
 */
class (TPtkPsdExportPartController) TPtkPsdExportPart1Controller2835(view, part, head)

    initTPtkPsdExportPartController(view, part, head);

    private macro initStringCodeArray()
        stringCodeArray[stringCodeArray.size] = "M1";
        stringCodeArray[stringCodeArray.size] = "DV";
        stringCodeArray[stringCodeArray.size] = "D1";
        stringCodeArray[stringCodeArray.size] = "2D7";
        stringCodeArray[stringCodeArray.size] = "8D30";
        stringCodeArray[stringCodeArray.size] = "1M3";
        stringCodeArray[stringCodeArray.size] = "3M6";
        stringCodeArray[stringCodeArray.size] = "6M12";
        stringCodeArray[stringCodeArray.size] = "1Y3";
        stringCodeArray[stringCodeArray.size] = "3Y";
        stringCodeArray[stringCodeArray.size] = "summ";
        stringCodeArray[stringCodeArray.size] = "7.1";
        stringCodeArray[stringCodeArray.size] = "7.2";
        stringCodeArray[stringCodeArray.size] = "7.3";
    end;

    macro execute()
         stringCodeArray                = TArray();
         var periodIterator  : Integer;

         initStringCodeArray();
         periodIterator = 0;
         if (m_part == 1)
             //¯¥à¨®¤  M1
             printExportString("”128_810_”‹_1___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;  //DV
             printExportString("”128_810_”‹_1_1_%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1_1_‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1_1_%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1_1_‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1_1_%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1_1_‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1_1_%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1_1_‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1_1_%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1_1_‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //D1
             printExportString("”128_810_”‹_1_2_%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1_2_‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1_2_%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1_2_‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1_2_%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1_2_‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1_2_%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1_2_‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1_2_%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1_2_‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //2D7
             printExportString("”128_810_”‹_1_3_%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1_3_‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1_3_%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1_3_‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1_3_%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1_3_‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1_3_%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1_3_‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1_3_%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1_3_‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //8D30
             printExportString("”128_810_”‹_1_4_%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_1_4_‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_1_4_%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_1_4_‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_1_4_%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_1_4_‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_1_4_%__“‚", periodIterator, 8);
             printExportString("”128_810_”_1_4_‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_1_4_%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_1_4_‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //1M3
             printExportString("”128_810_”‹_2___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_2___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_2___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_2___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_2___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_2___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_2___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_2___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_2___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_2___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //3M6
             printExportString("”128_810_”‹_3___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_3___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_3___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_3___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_3___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_3___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_3___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_3___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_3___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_3___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //6M12
             printExportString("”128_810_”‹_4___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_4___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_4___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_4___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_4___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_4___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_4___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_4___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_4___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_4___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //1Y3
             printExportString("”128_810_”‹_5___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_5___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_5___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_5___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_5___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_5___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_5___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_5___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_5___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_5___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //3Y
             printExportString("”128_810_”‹_6___%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_6___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_6___%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_6___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_6___%__ŒŠ", periodIterator, 6);
             printExportString("”128_810_Š_6___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_6___%__“‚", periodIterator, 8);
             printExportString("”128_810_”_6___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_6___%__“‚", periodIterator, 10);
             printExportString("”128_810_Š_6___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //summ
             printExportString("”128_810_”‹_ˆ___‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_ˆ___‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_ˆ___‘__ŒŠ", periodIterator, 7);
             printExportString("”128_810_”_ˆ___‘__“‚", periodIterator, 9);
             printExportString("”128_810_Š_ˆ___‘__“‚", periodIterator, 11);
             periodIterator = periodIterator+1;    //7.1
             printExportString("”128_810_”‹_71__‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_71__‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_71__‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //7.2
             printExportString("”128_810_”‹_72__‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_72__‘__Š_", periodIterator, 5);
             printExportString("”128_810_Š_72__‘__ŒŠ", periodIterator, 7);
             periodIterator = periodIterator+1;    //7.3
             printExportString("”128_810_”‹_73__%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_73__‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_73__%__Š_", periodIterator, 4);
             printExportString("”128_810_‹_73__‘__Š_", periodIterator, 5);
        end;
    end;
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ ’Š ‘„ ¤«ï à §¤¥«  1 ¯® ãª § ­¨î 3006-“.
 */
class (TPtkPsdExportPartController) TPtkPsdExportPart1Controller3006(view, part, head)
    var srokShifr    = TArray();

    initTPtkPsdExportPartController(view, part, head);

    private macro initStringCodeArray()
        stringCodeArray[stringCodeArray.size] = "M1";
        stringCodeArray[stringCodeArray.size] = "DV";
        stringCodeArray[stringCodeArray.size] = "D1";
        stringCodeArray[stringCodeArray.size] = "2D7";
        stringCodeArray[stringCodeArray.size] = "8D30";
        stringCodeArray[stringCodeArray.size] = "1M3";
        stringCodeArray[stringCodeArray.size] = "3M6";
        stringCodeArray[stringCodeArray.size] = "6M12";
        stringCodeArray[stringCodeArray.size] = "1Y3";
        stringCodeArray[stringCodeArray.size] = "3Y";
        stringCodeArray[stringCodeArray.size] = "summ";
        stringCodeArray[stringCodeArray.size] = "7.1";
        stringCodeArray[stringCodeArray.size] = "7.2";
        stringCodeArray[stringCodeArray.size] = "7.3";

        srokShifr[srokShifr.size] = "1__";
        srokShifr[srokShifr.size] = "1_1";
        srokShifr[srokShifr.size] = "1_2";
        srokShifr[srokShifr.size] = "1_3";
        srokShifr[srokShifr.size] = "1_4";
        srokShifr[srokShifr.size] = "2__";
        srokShifr[srokShifr.size] = "3__";
        srokShifr[srokShifr.size] = "4__";
        srokShifr[srokShifr.size] = "5__";
        srokShifr[srokShifr.size] = "6__";
    end;

    macro execute()
         stringCodeArray                = TArray();
         var periodIterator  : Integer;

         initStringCodeArray();
         periodIterator = 0;
         if (m_part == 1)
             while (periodIterator < srokShifr.size)
                 printExportString("”128_810_”‹_" + srokShifr[periodIterator] + "_%__Š_", periodIterator, 2);
                 printExportString("”128_810_”‹_" + srokShifr[periodIterator] + "_‘__Š_", periodIterator, 3);
                 printExportString("”128_810_”‹_" + srokShifr[periodIterator] + "_%€_Š_", periodIterator, 4);
                 printExportString("”128_810_”‹_" + srokShifr[periodIterator] + "_‘€_Š_", periodIterator, 5);
                 printExportString("”128_810_‹_" + srokShifr[periodIterator] + "_%__Š_", periodIterator, 6);
                 printExportString("”128_810_‹_" + srokShifr[periodIterator] + "_‘__Š_", periodIterator, 7);
                 printExportString("”128_810_‹_" + srokShifr[periodIterator] + "_%_Š_", periodIterator, 8);
                 printExportString("”128_810_‹_" + srokShifr[periodIterator] + "_‘_Š_", periodIterator, 9);
                 printExportString("”128_810_Š_" + srokShifr[periodIterator] + "_%__ŒŠ", periodIterator, 10);
                 printExportString("”128_810_Š_" + srokShifr[periodIterator] + "_‘__ŒŠ", periodIterator, 11);
                 printExportString("”128_810_”_" + srokShifr[periodIterator] + "_%__“‚", periodIterator, 12);
                 printExportString("”128_810_”_" + srokShifr[periodIterator] + "_‘__“‚", periodIterator, 13);
                 printExportString("”128_810_Š_" + srokShifr[periodIterator] + "_%__“‚", periodIterator, 14);
                 printExportString("”128_810_Š_" + srokShifr[periodIterator] + "_‘__“‚", periodIterator, 15);
                 periodIterator = periodIterator+1;
             end;

            //summ
             printExportString("”128_810_”‹_ˆ___‘__Š_", periodIterator, 3);
             printExportString("”128_810_”‹_ˆ___‘€_Š_", periodIterator, 5);
             printExportString("”128_810_‹_ˆ___‘__Š_", periodIterator, 7);
             printExportString("”128_810_‹_ˆ___‘_Š_", periodIterator, 9);
             printExportString("”128_810_Š_ˆ___‘__ŒŠ", periodIterator, 11);
             printExportString("”128_810_”_ˆ___‘__“‚", periodIterator, 13);
             printExportString("”128_810_Š_ˆ___‘__“‚", periodIterator, 15);
             periodIterator = periodIterator+1;    //7.1
             printExportString("”128_810_”‹_71__‘__Š_", periodIterator, 3);
             printExportString("”128_810_”‹_71__‘€_Š_", periodIterator, 5);
             printExportString("”128_810_‹_71__‘__Š_", periodIterator, 7);
             printExportString("”128_810_‹_71__‘_Š_", periodIterator, 9);
             printExportString("”128_810_Š_71__‘__ŒŠ", periodIterator, 11);
             periodIterator = periodIterator+1;    //7.2
             printExportString("”128_810_”‹_72__‘__Š_", periodIterator, 3);
             printExportString("”128_810_”‹_72__‘€_Š_", periodIterator, 5);
             printExportString("”128_810_‹_72__‘__Š_", periodIterator, 7);
             printExportString("”128_810_‹_72__‘_Š_", periodIterator, 9);
             printExportString("”128_810_Š_72__‘__ŒŠ", periodIterator, 11);
             periodIterator = periodIterator+1;    //7.3
             printExportString("”128_810_”‹_73__%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_73__‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_73__%__Š_", periodIterator, 6);
             printExportString("”128_810_‹_73__‘__Š_", periodIterator, 7);
        end;
    end;
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ ’Š ‘„ ¤«ï à §¤¥«  ¯® ãª § ­¨î 3006-“.
 */
class (TPtkPsdExportPartController) TPtkPsdExportPartController3006(view, part, head)
    var srokShifr    = TArray();

    initTPtkPsdExportPartController(view, part, head);

    private macro initStringCodeArray()
        stringCodeArray[stringCodeArray.size] = "M1";
        stringCodeArray[stringCodeArray.size] = "DV";
        stringCodeArray[stringCodeArray.size] = "D1";
        stringCodeArray[stringCodeArray.size] = "2D7";
        stringCodeArray[stringCodeArray.size] = "8D30";
        stringCodeArray[stringCodeArray.size] = "1M3";
        stringCodeArray[stringCodeArray.size] = "3M6";
        stringCodeArray[stringCodeArray.size] = "6M12";
        stringCodeArray[stringCodeArray.size] = "1Y3";
        stringCodeArray[stringCodeArray.size] = "3Y";
        stringCodeArray[stringCodeArray.size] = "summ";
        stringCodeArray[stringCodeArray.size] = "7.1";
        stringCodeArray[stringCodeArray.size] = "7.2";

        srokShifr[srokShifr.size] = "1__";
        srokShifr[srokShifr.size] = "1_1";
        srokShifr[srokShifr.size] = "1_2";
        srokShifr[srokShifr.size] = "1_3";
        srokShifr[srokShifr.size] = "1_4";
        srokShifr[srokShifr.size] = "2__";
        srokShifr[srokShifr.size] = "3__";
        srokShifr[srokShifr.size] = "4__";
        srokShifr[srokShifr.size] = "5__";
        srokShifr[srokShifr.size] = "6__";
    end;

     macro execute()
        stringCodeArray  = TArray();

        var periodIterator  : Integer;
        var partCode;

        initStringCodeArray();
        periodIterator = 0;

        if (m_part == 2)
            partCode = "840";
        elif (m_part == 3)
            partCode = "978";
        end;

        if (m_part == 4)
             printExportString("", 0, 0);
        else
            while (periodIterator < srokShifr.size)
                printExportString("”128_" + partCode + "_”‹_" + srokShifr[periodIterator] + "_%__Š_", periodIterator, 2);
                printExportString("”128_" + partCode + "_”‹_" + srokShifr[periodIterator] + "_‘__Š_", periodIterator, 3);
                printExportString("”128_" + partCode + "_”‹_" + srokShifr[periodIterator] + "_%€_Š_", periodIterator, 4);
                printExportString("”128_" + partCode + "_”‹_" + srokShifr[periodIterator] + "_‘€_Š_", periodIterator, 5);
                printExportString("”128_" + partCode + "_‹_" + srokShifr[periodIterator] + "_%__Š_", periodIterator, 6);
                printExportString("”128_" + partCode + "_‹_" + srokShifr[periodIterator] + "_‘__Š_", periodIterator, 7);
                printExportString("”128_" + partCode + "_‹_" + srokShifr[periodIterator] + "_%_Š_", periodIterator, 8);
                printExportString("”128_" + partCode + "_‹_" + srokShifr[periodIterator] + "_‘_Š_", periodIterator, 9);
                printExportString("”128_" + partCode + "_Š_" + srokShifr[periodIterator] + "_%__ŒŠ", periodIterator, 10);
                printExportString("”128_" + partCode + "_Š_" + srokShifr[periodIterator] + "_‘__ŒŠ", periodIterator, 11);
                periodIterator = periodIterator+1;
            end;

            printExportString("”128_" + partCode + "_”‹_ˆ___‘__Š_", periodIterator, 3);
            printExportString("”128_" + partCode + "_”‹_ˆ___‘€_Š_", periodIterator, 5);
            printExportString("”128_" + partCode + "_‹_ˆ___‘__Š_", periodIterator, 7);
            printExportString("”128_" + partCode + "_‹_ˆ___‘_Š_", periodIterator, 9);
            printExportString("”128_" + partCode + "_Š_ˆ___‘__ŒŠ", periodIterator, 11);
            periodIterator = periodIterator+1;    //7.1
            printExportString("”128_" + partCode + "_”‹_71__‘__Š_", periodIterator, 3);
            printExportString("”128_" + partCode + "_”‹_71__‘€_Š_", periodIterator, 5);
            printExportString("”128_" + partCode + "_‹_71__‘__Š_", periodIterator, 7);
            printExportString("”128_" + partCode + "_‹_71__‘_Š_", periodIterator, 9);
            printExportString("”128_" + partCode + "_Š_71__‘__ŒŠ", periodIterator, 11);
            periodIterator = periodIterator+1;    //7.2
            printExportString("”128_" + partCode + "_”‹_72__‘__Š_", periodIterator, 3);
            printExportString("”128_" + partCode + "_”‹_72__‘€_Š_", periodIterator, 5);
            printExportString("”128_" + partCode + "_‹_72__‘__Š_", periodIterator, 7);
            printExportString("”128_" + partCode + "_‹_72__‘_Š_", periodIterator, 9);
            printExportString("”128_" + partCode + "_Š_72__‘__ŒŠ", periodIterator, 11);
        end;
     end;
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ ’Š ‘„ ¤«ï à §¤¥«  1 ¯® ãª § ­¨î 4212-“.
 */
class (TPtkPsdExportPartController) TPtkPsdExportPart1Controller4212(view, part, head)
    var srokShifr = TArray();

    initTPtkPsdExportPartController(view, part, head);

    private macro initStringCodeArray()
        stringCodeArray[stringCodeArray.size] = "M1";
        stringCodeArray[stringCodeArray.size] = "DV";
        stringCodeArray[stringCodeArray.size] = "D1";
        stringCodeArray[stringCodeArray.size] = "2D7";
        stringCodeArray[stringCodeArray.size] = "8D30";
        stringCodeArray[stringCodeArray.size] = "1M3";
        stringCodeArray[stringCodeArray.size] = "3M6";
        stringCodeArray[stringCodeArray.size] = "6M12";
        stringCodeArray[stringCodeArray.size] = "1Y3";
        stringCodeArray[stringCodeArray.size] = "3Y";
        stringCodeArray[stringCodeArray.size] = "summ";
        stringCodeArray[stringCodeArray.size] = "7.1";
        stringCodeArray[stringCodeArray.size] = "7.2";
        stringCodeArray[stringCodeArray.size] = "7.3";

        srokShifr[srokShifr.size] = "1__";
        srokShifr[srokShifr.size] = "1_1";
        srokShifr[srokShifr.size] = "1_2";
        srokShifr[srokShifr.size] = "1_3";
        srokShifr[srokShifr.size] = "1_4";
        srokShifr[srokShifr.size] = "2__";
        srokShifr[srokShifr.size] = "3__";
        srokShifr[srokShifr.size] = "4__";
        srokShifr[srokShifr.size] = "5__";
        srokShifr[srokShifr.size] = "6__";
    end;

    macro execute()
         stringCodeArray = TArray();
         var periodIterator  : Integer;

         initStringCodeArray();
         periodIterator = 0;
         if (m_part == 1)
             while (periodIterator < srokShifr.size)
                 printExportString("”128_810_”‹_" + srokShifr[periodIterator] + "_%__Š_", periodIterator, 2);
                 printExportString("”128_810_”‹_" + srokShifr[periodIterator] + "_‘__Š_", periodIterator, 3);
                 printExportString("”128_810_”‹_" + srokShifr[periodIterator] + "_%€_Š_", periodIterator, 4);
                 printExportString("”128_810_”‹_" + srokShifr[periodIterator] + "_‘€_Š_", periodIterator, 5);
                 printExportString("”128_810_‹_" + srokShifr[periodIterator] + "_%__Š_", periodIterator, 6);
                 printExportString("”128_810_‹_" + srokShifr[periodIterator] + "_‘__Š_", periodIterator, 7);
                 printExportString("”128_810_‹_" + srokShifr[periodIterator] + "_%_Š_", periodIterator, 8);
                 printExportString("”128_810_‹_" + srokShifr[periodIterator] + "_‘_Š_", periodIterator, 9);
                 periodIterator = periodIterator+1;
             end;

            //summ
             printExportString("”128_810_”‹_ˆ___‘__Š_", periodIterator, 3);
             printExportString("”128_810_”‹_ˆ___‘€_Š_", periodIterator, 5);
             printExportString("”128_810_‹_ˆ___‘__Š_", periodIterator, 7);
             printExportString("”128_810_‹_ˆ___‘_Š_", periodIterator, 9);
             periodIterator = periodIterator+1;    //7.1
             printExportString("”128_810_”‹_71__‘__Š_", periodIterator, 3);
             printExportString("”128_810_”‹_71__‘€_Š_", periodIterator, 5);
             printExportString("”128_810_‹_71__‘__Š_", periodIterator, 7);
             printExportString("”128_810_‹_71__‘_Š_", periodIterator, 9);
             periodIterator = periodIterator+1;    //7.2
             printExportString("”128_810_”‹_72__‘__Š_", periodIterator, 3);
             printExportString("”128_810_”‹_72__‘€_Š_", periodIterator, 5);
             printExportString("”128_810_‹_72__‘__Š_", periodIterator, 7);
             printExportString("”128_810_‹_72__‘_Š_", periodIterator, 9);
             periodIterator = periodIterator+1;    //7.3
             printExportString("”128_810_”‹_73__%__Š_", periodIterator, 2);
             printExportString("”128_810_”‹_73__‘__Š_", periodIterator, 3);
             printExportString("”128_810_‹_73__%__Š_", periodIterator, 6);
             printExportString("”128_810_‹_73__‘__Š_", periodIterator, 7);
        end;
    end;
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ ’Š ‘„ ¤«ï à §¤¥«®¢ 2, 3 ¨ ‘¯à ¢®ç­® ¯® ãª § ­¨î 4212-“.
 */
class (TPtkPsdExportPartController) TPtkPsdExportPartController4212(view, part, head)
    var srokShifr = TArray();

    initTPtkPsdExportPartController(view, part, head);

    private macro initStringCodeArray()
        stringCodeArray[stringCodeArray.size] = "M1";
        stringCodeArray[stringCodeArray.size] = "DV";
        stringCodeArray[stringCodeArray.size] = "D1";
        stringCodeArray[stringCodeArray.size] = "2D7";
        stringCodeArray[stringCodeArray.size] = "8D30";
        stringCodeArray[stringCodeArray.size] = "1M3";
        stringCodeArray[stringCodeArray.size] = "3M6";
        stringCodeArray[stringCodeArray.size] = "6M12";
        stringCodeArray[stringCodeArray.size] = "1Y3";
        stringCodeArray[stringCodeArray.size] = "3Y";
        stringCodeArray[stringCodeArray.size] = "summ";
        stringCodeArray[stringCodeArray.size] = "7.1";
        stringCodeArray[stringCodeArray.size] = "7.2";

        srokShifr[srokShifr.size] = "1__";
        srokShifr[srokShifr.size] = "1_1";
        srokShifr[srokShifr.size] = "1_2";
        srokShifr[srokShifr.size] = "1_3";
        srokShifr[srokShifr.size] = "1_4";
        srokShifr[srokShifr.size] = "2__";
        srokShifr[srokShifr.size] = "3__";
        srokShifr[srokShifr.size] = "4__";
        srokShifr[srokShifr.size] = "5__";
        srokShifr[srokShifr.size] = "6__";
    end;

    macro execute()
        stringCodeArray  = TArray();

        var periodIterator  : Integer;
        var partCode;

        initStringCodeArray();
        periodIterator = 0;

        if (m_part == 2)
            partCode = "840";
        elif (m_part == 3)
            partCode = "978";
        end;

        if (m_part == 4)
             printExportString("", 0, 0);
        else
            while (periodIterator < srokShifr.size)
                printExportString("”128_" + partCode + "_”‹_" + srokShifr[periodIterator] + "_%__Š_", periodIterator, 2);
                printExportString("”128_" + partCode + "_”‹_" + srokShifr[periodIterator] + "_‘__Š_", periodIterator, 3);
                printExportString("”128_" + partCode + "_”‹_" + srokShifr[periodIterator] + "_%€_Š_", periodIterator, 4);
                printExportString("”128_" + partCode + "_”‹_" + srokShifr[periodIterator] + "_‘€_Š_", periodIterator, 5);
                printExportString("”128_" + partCode + "_‹_" + srokShifr[periodIterator] + "_%__Š_", periodIterator, 6);
                printExportString("”128_" + partCode + "_‹_" + srokShifr[periodIterator] + "_‘__Š_", periodIterator, 7);
                printExportString("”128_" + partCode + "_‹_" + srokShifr[periodIterator] + "_%_Š_", periodIterator, 8);
                printExportString("”128_" + partCode + "_‹_" + srokShifr[periodIterator] + "_‘_Š_", periodIterator, 9);
                periodIterator = periodIterator+1;
            end;

            printExportString("”128_" + partCode + "_”‹_ˆ___‘__Š_", periodIterator, 3);
            printExportString("”128_" + partCode + "_”‹_ˆ___‘€_Š_", periodIterator, 5);
            printExportString("”128_" + partCode + "_‹_ˆ___‘__Š_", periodIterator, 7);
            printExportString("”128_" + partCode + "_‹_ˆ___‘_Š_", periodIterator, 9);
            periodIterator = periodIterator+1;    //7.1
            printExportString("”128_" + partCode + "_”‹_71__‘__Š_", periodIterator, 3);
            printExportString("”128_" + partCode + "_”‹_71__‘€_Š_", periodIterator, 5);
            printExportString("”128_" + partCode + "_‹_71__‘__Š_", periodIterator, 7);
            printExportString("”128_" + partCode + "_‹_71__‘_Š_", periodIterator, 9);
            periodIterator = periodIterator+1;    //7.2
            printExportString("”128_" + partCode + "_”‹_72__‘__Š_", periodIterator, 3);
            printExportString("”128_" + partCode + "_”‹_72__‘€_Š_", periodIterator, 5);
            printExportString("”128_" + partCode + "_‹_72__‘__Š_", periodIterator, 7);
            printExportString("”128_" + partCode + "_‹_72__‘_Š_", periodIterator, 9);
        end;
    end;
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ ’Š ‘„ ¤«ï à §¤¥«®¢ 2, 3 ¨ ‘¯à ¢®ç­® ¯® ãª § ­¨î 4212-“.
 */
class (TPtkPsdExportPartController) TPtkPsdExportPartController_0MW5K(view, part, head)
    private var m_endDate;
    private var m_departmentCode;
    private var m_isCalendarWeekends;

    private macro isWorkDate(day : Date) : Bool
        var serviceKind;
        var isBalance = false;
        var res;

        if (m_isCalendarWeekends == true)
            return isWorkDayBranch(day, m_departmentCode) == 1;
        else
            res = getDateAttr(day, serviceKind, isBalance, m_departmentCode);
            return isBalance;
        end;
    end;

    //„ â  ¯®á«¥¤­¥£®  ¡®ç¥£® ¤­ï ¢ ®âç¥â­®¬ ¯¥à¨®¤¥
    private macro getNearPreviosWorkDay(day : Date)
        var previosWorkDay = day;

        while (not isWorkDate(previosWorkDay))
            previosWorkDay = previosWorkDay - 1;
        end;

        return previosWorkDay;
    end;

    macro execute()
            m_view.printRow(m_applicationCode,                  //ª®¤ ¯à¨«®¦¥­¨ï
                            "1",                                //ª®¤ áâà®ª¨
                            "1",                                //ª®¤ ª®«®­ª¨
                            getNearPreviosWorkDay(m_endDate));  //§­ ç¥­¨¥
    end;

    private macro constructor(view, part, head)
        initTPtkPsdExportPartController(view, part, head);

        getRegistryValue("REPTREG/REP_GROUPS/”/‚›•„. ˆ €. „ˆ  Š€‹…„€", V_BOOL, m_isCalendarWeekends, NULL);
        m_departmentCode = RcbApplication.currentReport.context.departmentCode;
        m_endDate        = RcbApplication.currentReport.context.period.endDate;
    end;

    constructor(view, part, head);
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ €‘ ‘„ ®âç¥â .
 */
class  T128PtkPsdExportController(descriptorInfo : String)

    private var m_ptkPsdExportPartControllers : TArray;
    private var m_ptkPsdView;
    private var m_report;
    private var m_descriptorInfo;


    private macro constructor(descriptorInfo : String)
        m_ptkPsdExportPartControllers = TArray();
        m_ptkPsdView                  = genObject("T128PtkPsdView");
        m_descriptorInfo = nvl(descriptorInfo, "");

        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController(m_ptkPsdView, "1", "F128");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController(m_ptkPsdView, "2", "F128_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController(m_ptkPsdView, "3", "F128_3");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController(m_ptkPsdView, "4", "F128_S");
    end;

    macro getDescriptorInfo()
        return m_descriptorInfo;
    end;

    macro execute()
        var i = 0;
        var protocolView  = TProtocolView("’Š‹ Š‘’€ ‚ €‘ ‘„");

        protocolView.setProtocolOutput();
        protocolView.printHead();

        m_ptkPsdView.setOutputFile();
        while ( i < m_ptkPsdExportPartControllers.size)
            m_ptkPsdExportPartControllers[i].execute();
            i = i + 1;
        end;
        m_ptkPsdView.resetOutputFile();

        protocolView.printLine("€«ì¡®¬ ä®à¬ €‘ ‘„: " + getDescriptorInfo());
        protocolView.printLine("” ©« íªá¯®àâ : " + m_ptkPsdView.getFileName());
        protocolView.printLine("Š®«¨ç¥áâ¢® ¢ë£àã¦¥­­ëå § ¯¨á¥©: " + m_ptkPsdView.getRowsCount()());

        protocolView.resetProtocolOutput();
        protocolView.show();
    end;

    constructor(descriptorInfo);
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ €‘ ‘„ ®âç¥â  ¯® ãª § ­¨î 2835-“.
 */
class (T128PtkPsdExportController) T128PtkPsdExportController2835(descriptorInfo : String)

    initT128PtkPsdExportController(descriptorInfo);

    private macro constructor(descriptorInfo : String)
        m_ptkPsdExportPartControllers = TArray();
        m_ptkPsdView                  = genObject("T128PtkPsdView");
        m_descriptorInfo = nvl(descriptorInfo, "");

        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPart1Controller2835(m_ptkPsdView, "1", "F128");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController(m_ptkPsdView, "2", "F128_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController(m_ptkPsdView, "3", "F128_3");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController(m_ptkPsdView, "4", "F128_S");
    end;

    constructor(descriptorInfo);
end;

/**
 * ¯¥à æ¨ï íªá¯®àâ  ¢ €‘ ‘„ ®âç¥â  ¯® ãª § ­¨î 3006-“.
 */
class (T128PtkPsdExportController) T128PtkPsdExportController3006(descriptorInfo : String)

    initT128PtkPsdExportController(descriptorInfo);

    private macro constructor(descriptorInfo : String)
        m_ptkPsdExportPartControllers = TArray();
        m_ptkPsdView                  = genObject("T128PtkPsdView");
        m_descriptorInfo = nvl(descriptorInfo, "");

        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPart1Controller3006(m_ptkPsdView, "1", "F128");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, "2", "F128_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, "3", "F128_3");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, "4", "F128_S");
    end;

    constructor(descriptorInfo);
end;

class (T128PtkPsdExportController) T128PtkPsdExportController4212(descriptorInfo : String)
    initT128PtkPsdExportController(descriptorInfo);

    private macro constructor(descriptorInfo : String)
        m_ptkPsdExportPartControllers = TArray();
        m_ptkPsdView                  = genObject("T128PtkPsdView");
        m_descriptorInfo              = nvl(descriptorInfo, "");

        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPart1Controller4212(m_ptkPsdView, "1", "F128");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController4212(m_ptkPsdView, "2", "F128_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController4212(m_ptkPsdView, "3", "F128_3");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController4212(m_ptkPsdView, "4", "F128_S");
    end;

    constructor(descriptorInfo);
end;

class (T128PtkPsdExportController) T128PtkPsdExportController0MW5K(descriptorInfo : String)
    macro execute()
        var i            = 0;
        var protocolView = TProtocolView("’Š‹ Š‘’€ ‚ €‘ ‘„");

        protocolView.setProtocolOutput();
        protocolView.printHead();

        m_ptkPsdView.setOutputFile();
        while ( i < m_ptkPsdExportPartControllers.size)
            m_ptkPsdExportPartControllers[i].execute();
            i = i + 1;
        end;
        m_ptkPsdView.resetOutputFile();

        protocolView.printLine("Œ¥â -¤ ­­ë¥: " + getDescriptorInfo());
        protocolView.printLine("” ©« íªá¯®àâ : " + m_ptkPsdView.getFileName());
        protocolView.printLine("Š®«¨ç¥áâ¢® ¢ë£àã¦¥­­ëå § ¯¨á¥©: " + m_ptkPsdView.getRowsCount()());

        protocolView.resetProtocolOutput();
        protocolView.show();
    end;

    private macro constructor(descriptorInfo : String)
        m_ptkPsdExportPartControllers = TArray();
        m_ptkPsdView                  = genObject("T128PtkPsdView_0MW5K");
        m_descriptorInfo              = nvl(descriptorInfo, "");

        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPart1Controller4212(m_ptkPsdView,  "1", "F128");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController4212(m_ptkPsdView,   "2", "F128_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController4212(m_ptkPsdView,   "3", "F128_3");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController4212(m_ptkPsdView,   "4", "F128_S");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController_0MW5K(m_ptkPsdView, "5", "F128_od");
    end;

    constructor(descriptorInfo);
end;

private macro executePtkPsdExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("’Š‹ Š‘’€ ‚ €‘ ‘„").checkCalculateReport("€‘ ‘„");
        ãáâ ­®¢¨âì”« £‚®§¢à â (STOP_PROC_FLG);
        exit(1);
    end;

    if   (rcbApplication.currentReport.context.period.endDate >= RCB_0MW5K_DATE)
        T128PtkPsdExportController0MW5K("0mw5k").execute();
    elif (rcbApplication.currentReport.context.period.endDate >= RCB_I4212_DATE)
        T128PtkPsdExportController4212("ALB2_2_4.doc ®â 01.10.2014").execute();
    elif (rcbApplication.currentReport.context.period.endDate >= RCB_I3006_DATE2)
        T128PtkPsdExportController3006("ALB2_2_4.doc ®â 01.10.2014").execute();
    elif (rcbApplication.currentReport.context.period.endDate >= RCB_I2835_DATE4)
        T128PtkPsdExportController2835().execute();
    else
        T128PtkPsdExportController().execute();
    end;
end;

ãáâ ­®¢¨âì”« £‚®§¢à â (OK_MACRO_FLAG);
exit(1);
