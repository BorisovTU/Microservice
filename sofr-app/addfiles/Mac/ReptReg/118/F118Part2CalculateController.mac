class (F118PartCalculateControllerDecorator) F118Part2CalculateController(partController : Object)
    initF118PartCalculateControllerDecorator(partController);

    private macro getPreprocessAttribute5BoCbData()
        var dataSource = m_dataSources.getDataSource("Account");
        var filter     = m_dataSouceFilters.getFilter("Account");

        const ATRIBUTE_ID = "5";

        filter.countryRating(">=", "2").op("AND").isChapterIn("3").op("AND").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), ATRIBUTE_ID, BOCB).getMasks());

        filter.op("AND").guarantyIssuerIsBank().op("AND").op("NOT").isGuarantyForAccountFirstQuality();

        return getPreprocessAttributeData(ATRIBUTE_ID, dataSource, filter, "_Иное");
    end;

    private macro getPreprocessAttribute6BoCbData()
        var dataSource = m_dataSources.getDataSource("Account");
        var filter     = m_dataSouceFilters.getFilter("Account");

        const ATRIBUTE_ID = "6";

        filter.isChapterIn("1").op("AND").op("(");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.1", BOCB).getMasks()).op(")");

        filter.op("OR");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.2", BOCB).getMasks()).op("AND").contractorIsBank().op(")");
        
        filter.op("OR");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.3", BOCB).getMasks());
            filter.op("AND").hasAccountAssignedCategory(RCB_OBJGROUP_ACTIVEKIND,"В");
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"СубКредит");
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"8934").op(")");
        
        filter.op("OR");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.4", BOCB).getMasks());
            filter.op("AND").hasAccountAssignedCategory(RCB_OBJGROUP_ACTIVEKIND,"В");
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"8934");
            filter.op("AND").contractorIsBank().op(")");
        
        filter.op("OR");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.5", BOCB).getMasks());
            filter.op("AND").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"Вкл");
            filter.op("AND").contractorIsBank().op(")");

        filter.op(")");

        return getPreprocessAttributeData(ATRIBUTE_ID, dataSource, filter);
    end;

    private macro getPreprocessAttribute7BoCbData()
        var dataSource = m_dataSources.getDataSource("Account");
        var filter     = m_dataSouceFilters.getFilter("Account");

        const ATRIBUTE_ID = "7";

        filter.isChapterIn("3").op("AND").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), ATRIBUTE_ID, BOCB).getMasks()).op("AND").contractorIsBank();

        return getPreprocessAttributeData(ATRIBUTE_ID, dataSource, filter);
    end;
    
    private macro getCalculateAttribute5Data()
        const ATRIBUTE_ID = "5";
        return getPrimaryCalculateAttributeData(ATRIBUTE_ID);
    end;

    private macro getCalculateAttribute6Data()
        const ATRIBUTE_ID = "6";
        return getPrimaryCalculateAttributeData(ATRIBUTE_ID);
    end;

    private macro getCalculateAttribute7Data()
        const ATRIBUTE_ID = "7";
        return getPrimaryCalculateAttributeData(ATRIBUTE_ID);
    end;

    macro execute()
        m_reportCalculateController.addPreprocessingAttributeData(getPreprocessAttribute5BoCbData());
        m_reportCalculateController.addPreprocessingAttributeData(getPreprocessAttribute6BoCbData());
        m_reportCalculateController.addPreprocessingAttributeData(getPreprocessAttribute7BoCbData());

        const SUMMARIZE_ATTRIBUTE_ID = "5";

        m_reportCalculateController.addCalculationAttributeData(getCalculateAttribute2Data(SUMMARIZE_ATTRIBUTE_ID));
        m_reportCalculateController.addCalculationAttributeData(getCalculateAttribute3Data(SUMMARIZE_ATTRIBUTE_ID));
        m_reportCalculateController.addCalculationAttributeData(getCalculateRelationsCharacterAttributeData("4", SUMMARIZE_ATTRIBUTE_ID));
        m_reportCalculateController.addCalculationAttributeData(getCalculateAttribute5Data());
        m_reportCalculateController.addCalculationAttributeData(getCalculateAttribute6Data());
        m_reportCalculateController.addCalculationAttributeData(getCalculateAttribute7Data());
        m_reportCalculateController.addCalculationAttributeData(getCalculateUserInputAttributeData("userInput", SUMMARIZE_ATTRIBUTE_ID));
        
        /* рассчет атрибута "Признак заемщика" */
        m_reportCalculateController.addCalculationAttributeData(getCalculateAttributeASignOfTheDebtorData(SUMMARIZE_ATTRIBUTE_ID));
    end;
end;

/**
 * Класс контроллера расчета второго раздела по 2254-У
 */
class (F118Part2CalculateController) F118Part2CalculateController_2254(partController : Object)
    initF118Part2CalculateController(partController);
    
    private macro getPreprocessAttribute6BoCbData()
        var dataSource = m_dataSources.getDataSource("Account");
        var filter     = m_dataSouceFilters.getFilter("Account");

        const ATRIBUTE_ID = "6";

        filter.isChapterIn("1").op("AND").op("(");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.1", BOCB).getMasks()).op(")");

        filter.op("OR");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.2", BOCB).getMasks()).op("AND").contractorIsBank().op(")");
        
        filter.op("OR");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.3", BOCB).getMasks());
            filter.op("AND").hasAccountAssignedCategory(RCB_OBJGROUP_ACTIVEKIND,"В");
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"СубКредит");
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"8934").op(")");
        
        filter.op("OR");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.4", BOCB).getMasks());
            filter.op("AND").hasAccountAssignedCategory(RCB_OBJGROUP_ACTIVEKIND,"В");
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"8934");
            filter.op("AND").contractorIsBank().op(")");
        
        filter.op("OR");
        
        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.5", BOCB).getMasks());
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"Искл");
            filter.op("AND").contractorIsBank().op(")");

        filter.op(")");

        return getPreprocessAttributeData(ATRIBUTE_ID, dataSource, filter);
    end;
end;

/**
 * Класс контроллера расчета второго раздела по 2808-У
 */
class (F118Part2CalculateController_2254) F118Part2CalculateController_2808(partController : Object)
    initF118Part2CalculateController_2254(partController);

    private macro getPreprocessAttribute6BoCbData()
        var dataSource = m_dataSources.getDataSource("Account");
        var filter     = m_dataSouceFilters.getFilter("Account");

        const ATRIBUTE_ID = "6";

        filter.isChapterIn("1").op("AND").op("NOT").hasValidAccessory().op("AND").op("(");

        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.1", BOCB).getMasks()).op(")");

        filter.op("OR");

        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.2", BOCB).getMasks()).op("AND").contractorIsBank().op(")");

        filter.op("OR");

        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.3", BOCB).getMasks());
            filter.op("AND").hasAccountAssignedCategory(RCB_OBJGROUP_ACTIVEKIND,"В");
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"СубКредит");
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"8934").op(")");

        filter.op("OR");

        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.4", BOCB).getMasks());
            filter.op("AND").hasAccountAssignedCategory(RCB_OBJGROUP_ACTIVEKIND,"В");
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"8934");
            filter.op("AND").contractorIsBank().op(")");

        filter.op("OR");

        filter.op("(").isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "6.5", BOCB).getMasks());
            filter.op("AND").op("NOT").hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING,"Искл");
            filter.op("AND").contractorIsBank().op(")");

        filter.op(")");

        return getPreprocessAttributeData(ATRIBUTE_ID, dataSource, filter);
    end;

    private macro getPreprocessAttribute7BoCbData()
        var dataSource = m_dataSources.getDataSource("Account");
        var filter     = m_dataSouceFilters.getFilter("Account");

        const ATRIBUTE_ID = "7";

        filter.isChapterIn("3").op("AND").op("NOT").hasValidAccessory().op("AND").contractorIsBank().op("AND").op("(");
            filter.isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), ATRIBUTE_ID, BOCB).getMasks());
        filter.op("OR").op("(");
            filter.isSatisfiesToMasks(m_tuneTable.setKey(m_part.getId(), "7.1", BOCB).getMasks());
            filter.op("AND").op("NOT").hasAnyAccountAssignedCategory(RCB_OBJGROUP_KRV);
            filter.op("AND").isGoodGuarantyInKRVdate( NOTEKIND_INCLUDE_GUARANTY_KRV);
            filter.op("AND").op("NOT").isGoodGuarantyInKRVdate( NOTEKIND_EXCLUDE_GUARANTY_KRV);
            filter.op(")");
        filter.op(")");

        return getPreprocessAttributeData(ATRIBUTE_ID, dataSource, filter);
    end;
end;

class (F118PartCalculateController) F118Part2FinalCalculateController(reportCalculateController : Object /*TReportCalculateController*/)
    initF118PartCalculateController(reportCalculateController, "2");

    macro execute()
        const SUMMARIZE_ATTRIBUTE_ID = "5";

        m_reportCalculateController.addCalculationAttributeData(getCalculateAttribute1Data(SUMMARIZE_ATTRIBUTE_ID));

        m_reportCalculateController.addCalculationAttributeData(getFinalCalculateRelationsCharacterAttributeData("4", SUMMARIZE_ATTRIBUTE_ID));
        
        m_reportCalculateController.addCalculationAttributeData(getCalculateH6AttributeData("9", SUMMARIZE_ATTRIBUTE_ID));

        m_reportCalculateController.addCalculationAttributeData(getFinalCalculateAttributeData(SUMMARIZE_ATTRIBUTE_ID));

        const KRS_ATTRIBUTE_ID = "8";
        m_reportCalculateController.addCalculationAttributeData(getCalculateKrsAttributeData(KRS_ATTRIBUTE_ID));

        m_reportCalculateController.addCalculationAttributeData(getCalculateInformationAttributeData("10"));
    end;
end;

class (F118PartCalculateController) F118Part2FinalCalculateController_2332(reportCalculateController : Object /*TReportCalculateController*/)
    initF118PartCalculateController(reportCalculateController, "2");

    macro execute()
        const SUMMARIZE_ATTRIBUTE_ID = "5";

        m_reportCalculateController.addCalculationAttributeData(getCalculateAttribute1Data(SUMMARIZE_ATTRIBUTE_ID));
                
        m_reportCalculateController.addCalculationAttributeData(getCalculateH6AttributeData("9", SUMMARIZE_ATTRIBUTE_ID));

        m_reportCalculateController.addCalculationAttributeData(getFinalCalculateAttributeData(SUMMARIZE_ATTRIBUTE_ID));

        const KRS_ATTRIBUTE_ID = "8";
        m_reportCalculateController.addCalculationAttributeData(getCalculateKrsAttributeData(KRS_ATTRIBUTE_ID));

        m_reportCalculateController.addCalculationAttributeData(getCalculateInformationAttributeData("10"));
    end;
end;
