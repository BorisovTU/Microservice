/*
$Name:          f118interface.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 118. Интерфейс операций формы
*/
/* ──────────────────────────────────────────────────────────────────────────┐
   RS-Bank V6                                                 R-Style Softlab
   Файл подсистемы "Регламентированная отчетность"

   Форма 118. Доступ к операциям формы.

   CREATED : 16.12.08 Ser.
└────────────────────────────────────────────────────────────────────────── */
/**
 *  Общебанковские интеры и модули
 */

/**
 *  Интеры и модели подсистемы
 */
import f118import;

/**
 *  Запуск операции расчета отчета
 */
macro executeCalculationOperation()
    var profiler = TSQLProfiler(getTxtFileName("!F118CalculateProfile"));
    profiler.clear();
    profiler.on();

    objectFactoryInstance.createReportCalculateController().calculate();
end;

/**
 *  Запуск операции окончательного расчета отчета
 */
macro executeFinalCalculationOperation()
    var profiler = TSQLProfiler(getTxtFileName("!F118FinalCalculateProfile"));
    profiler.clear();
    profiler.on();

    objectFactoryInstance.createReportFinalCalculateController().calculate();
    objectFactoryInstance.createNormalizationController().normalize();
end;

/**
 *  Запуск операции печати отчета
 */
macro executePrintOperation()
    objectFactoryInstance.createReportPrintController().print();
    RcbApplication.TransactionManager.rollBack();
end;

/**
 *  Пересчет после свода
 */
macro executeReclaculateValuesOperation()
    msgBox("Еще не реализовано!");
    RepErrorsQueue().add(0, "Еще не реализовано!");
end;

/**
 *  Запуск операции экспорта в Kliko.exe
 */
macro executeKlikoExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В kliko").checkCalculateReport("kliko.exe");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createKlikoExportController().execute();
    RcbApplication.TransactionManager.rollBack();
end;

/**
 *  Запуск операции экспорта в АС ПСД
 */
macro executePtkPsdExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В АС ПСД").checkCalculateReport("АС ПСД");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    if (rcbApplication().currentReport.context.period.endDate < RCB_I2539_DATE)
        m_protocolView.setProtocolOutput();
        m_protocolView.printHead();
        m_protocolView.printLine(String("Экспорт отчета в АС ПСД возможен только за период, дата окончания которого больше или равна ", RCB_I2539_DATE));
        m_protocolView.resetProtocolOutput();
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createPtkPsdExportController().execute();
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
