class (RcbDataProtocolView) F118FromDataSetProtocolData(id : String)
    initRcbDataProtocolView(id, false);

    private macro getFiCode(fiId : Integer)
        var dataSet = TRsbDataSet("SELECT t_code"
            +"\n"+                "  FROM drepFinInstrument_vw"
            +"\n"+                " WHERE t_id = " + nvl(fiId, -1));

        if (dataSet.moveNext())
            return dataSet.code;
        end;
        return "???";
    end;

    macro printBottom()
        m_table.printBottom();
    end;

    macro printSeparator()
        m_table.printSeparator();
    end;
end;

class (F118FromDataSetProtocolData) F118LoansDataProtocolView
    initF118FromDataSetProtocolData("Loans");
    
    macro printHead(attribute : RcbAttributeBase, description : String)
        printLn("\nДанные БО \"" + TBackOffice(BOLoans).getFullName() + "\". Раздел " + attribute.getPart().getId() + ". Графа " + attribute.getId() + nvl(description, "") + ".");
        m_table.printHead();
    end;

    macro printString(dataSet : Object)
        m_table.printStringTransferByWord(ternary(int(dataSet.debtorGroupId) == 0, dataSet.debtorGroupId, "-"),
                                          dataSet.debtorId + " " + dataSet.debtorName,
                                          dataSet.creditNumber,
                                          dataSet.registerType,
                                          dataSet.account,
                                          getFiCode(dataSet.fiId),
                                          dataSet.value,
                                          dataSet.kra,
                                          dataSet.krv,
                                          dataSet.coefficient1,
                                          dataSet.roubleSum,
                                          dataSet.reserve);
        
    end;

    macro printItog(dataSet : Object)
        const VALUE_COLUMN_NUMBER = 6;

        if ((dataSet.isDebtorsGroupItog == 1) and (int(dataSet.debtorGroupId) != 0))
            return;
        end;

        var informationString     = "ИТОГО по группе  : " +  dataSet.debtorGroupId;

        if (dataSet.isDebtorItog == 1)
            informationString     = "ИТОГО по заемщику: "  + dataSet.debtorId + " " + dataSet.debtorName;
        end;

        m_table.printStringExt(informationString, 
                                VALUE_COLUMN_NUMBER, 
                                dataSet.value);

        m_table.printString();
    end;

    private macro initialize()
        m_table.addColumn("Группа",               16);
        m_table.addColumn("Заемщик",              40);
        m_table.addColumn("Номер|договора",       15);
        m_table.addColumn("Вид|регистра",         10);
        m_table.addColumn("Номер|л/с|ГК",         25);
        m_table.addColumn("Валюта",               10);
        m_table.addColumn("Значение|для|расчета", 17);
        m_table.addColumn("КРА",                   7);
        m_table.addColumn("КРВ",                   7);
        m_table.addColumn("Коэффициент1",          7);
        m_table.addColumn("Сумма|в|рублях",       17);
        m_table.addColumn("Резерв",               17);
    end;
end;

class (F118LoansDataProtocolView) F118LoansDataProtocolView_2808
    initF118LoansDataProtocolView("Loans");

     macro printString(dataSet : Object)
        m_table.printStringTransferByWord(ternary(int(dataSet.debtorGroupId) == 0, dataSet.debtorGroupId, "-"),
                                          dataSet.debtorId + " " + dataSet.debtorName,
                                          dataSet.creditNumber,
                                          dataSet.registerType,
                                          dataSet.account,
                                          getFiCode(dataSet.fiId),
                                          dataSet.value,
                                          dataSet.kra,
                                          dataSet.krv,
                                          dataSet.roubleSum,
                                          dataSet.reserve);

    end;

    private macro initialize()
        m_table.addColumn("Группа",               16);
        m_table.addColumn("Заемщик",              40);
        m_table.addColumn("Номер|договора",       15);
        m_table.addColumn("Вид|регистра",         10);
        m_table.addColumn("Номер|л/с|ГК",         25);
        m_table.addColumn("Валюта",               10);
        m_table.addColumn("Значение|для|расчета", 17);
        m_table.addColumn("КРА",                   7);
        m_table.addColumn("КРВ",                   7);
        m_table.addColumn("Сумма|в|рублях",       17);
        m_table.addColumn("Резерв",               17);
    end;
end;

class (F118FromDataSetProtocolData) F118AccountDataProtocolView
    initF118FromDataSetProtocolData("Account");
    
    macro printHead(attribute : RcbAttributeBase, description : String)
        printLn("\nДанные БО \"" + TBackOffice(BOCB).getFullName() + "\". Раздел " + attribute.getPart().getId() + ". Графа " + attribute.getId() + nvl(description, "") + ".");
        printLn("Внимание КРА указывается для  общей суммы л/с.");
        m_table.printHead();
    end;

    macro printString(dataSet : Object)
        m_table.printStringTransferByWord(ternary(int(dataSet.debtorGroupId) == 0, dataSet.debtorGroupId, "-"),
                                          dataSet.debtorId + " " + dataSet.debtorName,
                                          int(dataSet.chapter),
                                          dataSet.account,
                                          getFiCode(dataSet.fiId),
                                          dataSet.value,
                                          dataSet.kra,
                                          dataSet.krv,
                                          dataSet.coefficient1,
                                          dataSet.roubleRest,
                                          dataSet.reserve);
        
    end;

    macro printItog(dataSet : Object)
        const VALUE_COLUMN_NUMBER = 5;

        if ((dataSet.isDebtorsGroupItog == 1) and (int(dataSet.debtorGroupId) != 0))
            return;
        end;

        var informationString     = "ИТОГО по группе  : " +  dataSet.debtorGroupId;

        if (dataSet.isDebtorItog == 1)
            informationString     = "ИТОГО по заемщику: "  + dataSet.debtorId + " " + dataSet.debtorName;
        end;

        m_table.printStringExt(informationString, 
                                VALUE_COLUMN_NUMBER, 
                                dataSet.value);
        m_table.printString();

    end;

    private macro initialize()
        m_table.addColumn("Группа",               16);
        m_table.addColumn("Заемщик",              40);
        m_table.addColumn("Глава",                10);
        m_table.addColumn("Номер|л/с",            25);
        m_table.addColumn("Валюта",               10);
        m_table.addColumn("Значение|для|расчета", 17);
        m_table.addColumn("КРА",                   7);
        m_table.addColumn("КРВ",                   7);
        m_table.addColumn("Коэффициент1",          7);
        m_table.addColumn("Сумма|в|рублях",       17);
        m_table.addColumn("Резерв",               17);
    end;
end;

class (F118AccountDataProtocolView) F118AccountDataProtocolView_2808
    initF118AccountDataProtocolView("Account");

    macro printString(dataSet : Object)
        m_table.printStringTransferByWord(ternary(int(dataSet.debtorGroupId) == 0, dataSet.debtorGroupId, "-"),
                                          dataSet.debtorId + " " + dataSet.debtorName,
                                          int(dataSet.chapter),
                                          dataSet.account,
                                          getFiCode(dataSet.fiId),
                                          dataSet.value,
                                          dataSet.kra,
                                          dataSet.krv,
                                          dataSet.roubleRest,
                                          dataSet.reserve);

    end;

    private macro initialize()
        m_table.addColumn("Группа",               16);
        m_table.addColumn("Заемщик",              40);
        m_table.addColumn("Глава",                10);
        m_table.addColumn("Номер|л/с",            25);
        m_table.addColumn("Валюта",               10);
        m_table.addColumn("Значение|для|расчета", 17);
        m_table.addColumn("КРА",                   7);
        m_table.addColumn("КРВ",                   7);
        m_table.addColumn("Сумма|в|рублях",       17);
        m_table.addColumn("Резерв",               17);
    end;
end;

class (RcbDataProtocolView) F118H6DataProtocolView
    initRcbDataProtocolView("H6", false);
    
    macro printHead(attribute : RcbAttributeBase, description : String)
        printLn("\nРасчет показателя H6. Раздел " + attribute.getPart().getId() + ". " + nvl(description, ""));
        m_table.printHead();
    end;

    macro printString(dataSet : Object)
        m_table.printStringTransferByWord(dataSet.debtorId,
                                          Date(dataSet.reportDate),
                                          dataSet.h6Value,
                                          dataSet.krzValue,
                                          Date(dataSet.capitalDate),
                                          dataSet.capitalValue);
        
    end;

    macro printItog(dataSet : Object)
        m_table.printString(); 
        m_table.printStringTransferByWord("Максимальная величина показателя H6 для: " + dataSet.debtorId,
                                          Date(dataSet.reportDate),
                                          dataSet.h6Value,
                                          dataSet.krzValue,
                                          Date(dataSet.capitalDate),
                                          dataSet.capitalValue);
        m_table.printString(); 
    end;

    macro printBottom()
        m_table.printBottom();
        println("\n");
    end;

    macro printSeparator()
        m_table.printSeparator();
    end;

    private macro initialize()
        m_table.addColumn("Группа|\\|Заемщик",    35);
        m_table.addColumn("Дата|отчета",          10);
        m_table.addColumn("Значение|H6",          17);
        m_table.addColumn("Значение|КРЗ",         17);
        m_table.addColumn("Дата|капитала",        10);
        m_table.addColumn("Значение|капитала",    17);
    end;
end;

class (RcbCalculateProtocolView)   F118CalculateProtocolView()
    initRcbCalculateProtocolView();

    private macro initialize()
        m_dataProtocolViewPull.push_back(F118LoansDataProtocolView());
        m_dataProtocolViewPull.push_back(F118AccountDataProtocolView());
        m_dataProtocolViewPull.push_back(F118H6DataProtocolView());
    end;
end;
class (F118CalculateProtocolView)   F118CalculateProtocolView_2808()
    initF118CalculateProtocolView();

    private macro initialize()
        m_dataProtocolViewPull.push_back(F118LoansDataProtocolView_2808());
        m_dataProtocolViewPull.push_back(F118AccountDataProtocolView_2808());
        m_dataProtocolViewPull.push_back(F118H6DataProtocolView());
    end;
end;