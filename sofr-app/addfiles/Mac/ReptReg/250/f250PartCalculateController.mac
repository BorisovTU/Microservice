/*
$Name:          f250PartCalculateController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 250. Контроллеры расчета разделов
*/

/**
 * @since   02.10.2014
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

class (RcbPartCalculateController) TF250Part1SubPart1CalculateController(reportCalculateController : Object, partId : String)

    macro constructorTF250Part1SubPart1CalculateController(reportCalculateController : Object, partId : String)
        initRcbPartCalculateController(reportCalculateController, "1.1");

    end;

    private macro calculatePart()
        var dataSource = m_dataSources.getDataSource("1.1");
        var dataSet = dataSource.getData();

        m_part.savePart(dataSet);
        m_part.saveUserAttribute();
    end;

    macro execute()
        m_reportCalculateController.addCalculationAttributeData(calculatePart());
    end;

    constructorTF250Part1SubPart1CalculateController(reportCalculateController, partId);
end;

class (RcbPartCalculateController) TF250Part1SubPart2CalculateController(reportCalculateController : Object, partId : String)

    macro constructorTF250Part1SubPart2CalculateController(reportCalculateController : Object, partId : String)
        initRcbPartCalculateController(reportCalculateController, "1.2");

    end;

    private macro calculatePart()
        var dataSource = m_dataSources.getDataSource("1.2");
        var dataSet = dataSource.getData(/* filter */);

        m_part.savePart(dataSet, m_part.TOTAL_FOR);

        dataSet = dataSource.getData(/* filter */);
        m_part.savePart(dataSet, m_part.PAYMENT_CARDS);

        dataSet = dataSource.getData(/* filter */);
        m_part.savePart(dataSet, m_part.PAYMENT_CARDS_OVERDRAFT);

        dataSet = dataSource.getData(/* filter */);
        m_part.savePart(dataSet, m_part.CREDIT_CARDS);
    end;

    macro execute()
        m_reportCalculateController.addCalculationAttributeData(calculatePart());
    end;

    constructorTF250Part1SubPart2CalculateController(reportCalculateController, partId);
end;

class (RcbPartCalculateController) TF250Part2CalculateController(reportCalculateController : Object, partId : String)

    macro constructorTF250Part2CalculateController(reportCalculateController : Object, partId : String)
        initRcbPartCalculateController(reportCalculateController, "2");

    end;

    private macro calculatePart()
        var dataSource = m_dataSources.getDataSource("2");

        var dataSet = dataSource.getData(/* filter */);
        m_part.savePart(dataSet);
        m_part.saveUserAttribute();

    end;

    macro execute()
        m_reportCalculateController.addCalculationAttributeData(calculatePart());
    end;

    constructorTF250Part2CalculateController(reportCalculateController, partId);
end;