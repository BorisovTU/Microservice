/*
$Name:          f250Part.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 250. Раздел отчета
*/

/**
 * @since   02.10.2014
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

/**
 * Основной раздел с расчитанными данными
*/
class (RcbPartBase) TF250Part1SubPart1(id : String, compositeValue)
    private var m_userAttributeValue;
    private var m_isEmpty;

    const TOTAL_FOR                                    = "Всего по";
    const PAYMENT_CARDS                                = "расчетные карты";
    const PAYMENT_CARDS_OVERDRAFT                      = "расчетные карты с овердрафтом";
    const CREDIT_CARDS                                 = "кредитные карты";
    const TOTAL_FOR_PHYSICS                            = "Итого по физическим лицам";
    const TOTAL_FOR_OKATO                              = "Итого по ОКАТО";
    const TOTAL_PAYMENT_CARDS_FOR_OKATO                = "расчетные карты по ОКАТО";
    const TOTAL_PAYMENT_CARDS_OVERDRAFT_FOR_OKATO      = "расчетные карты с овердрафтом по ОКАТО";
    const TOTAL_CREDIT_CARDS_FOR_OKATO                 = "кредитные карты по ОКАТО";
    const TOTAL_FOR_CREDIT_ORG                         = "Итого по кредитной организации (ее филиалу)";
    const TOTAL_PAYMENT_CARDS_FOR_CREDIT_ORG           = "расчетные карты по кредитной организации (ее филиалу)";
    const TOTAL_PAYMENT_CARDS_OVERDRAFT_FOR_CREDIT_ORG = "расчетные карты с овердрафтом по кредитной организации (ее филиалу)";
    const TOTAL_CREDIT_CARDS_FOR_CREDIT_ORG            = "кредитные карты по кредитной организации (ее филиалу)";

    private macro getAttributeCompositeValue(okato : String, codePS : String, lineDescribe : String)
        var keyValue = m_compositeValue.createKeyValue();

        keyValue.fieldValue("okato") = okato;
        keyValue.fieldValue("codePaymentSystem") = codePS;
        keyValue.fieldValue("lineDescribe") = lineDescribe;

        var compositeValue = m_compositeValue.findValue(keyValue);

        if (compositeValue != null)
            return compositeValue;
        end;

        compositeValue = m_compositeValue.addValue();

        compositeValue.reset();

        compositeValue.fieldValue("okato").exact = okato;
        compositeValue.fieldValue("codePaymentSystem").exact = codePS;
        compositeValue.fieldValue("lineDescribe").exact = lineDescribe;

        return compositeValue;
    end;

    macro isEmpty()
        var it = m_compositeValue.createValueIterator();

        it.moveFirst();

        while (not it.isDone)
            if (it.currentItem.isDefined())
                if ((it.currentItem.fieldValue("numbClientPaymentSystem").scaled != 0)
                or (it.currentItem.fieldValue("numbPCEndDate").scaled != 0)
                or (it.currentItem.fieldValue("numbPCUsingReportPeriod").scaled != 0)
                or (it.currentItem.fieldValue("sumPCHoldersCash").scaled != 0)
                or (it.currentItem.fieldValue("sumPCHoldersCredit").scaled != 0)
                or (it.currentItem.fieldValue("numbPCObtainCashRF").scaled != 0)
                or (it.currentItem.fieldValue("sumPCObtainCashRF").scaled != 0)
                or (it.currentItem.fieldValue("numbPCObtainCashAbroad").scaled != 0)
                or (it.currentItem.fieldValue("sumPCObtainCashAbroad").scaled != 0)
                or (it.currentItem.fieldValue("totalNumbNonCashOp").scaled != 0)
                or (it.currentItem.fieldValue("totalSumNonCashOp").scaled != 0)
                or (it.currentItem.fieldValue("numbNonCashInternetOp").scaled != 0)
                or (it.currentItem.fieldValue("sumNonCashInternetOp").scaled != 0)
                or (it.currentItem.fieldValue("numbNonCashMobilOp").scaled != 0)
                or (it.currentItem.fieldValue("sumNonCashMobilOp").scaled != 0)
                or (it.currentItem.fieldValue("numbNonCashOpRF").scaled != 0)
                or (it.currentItem.fieldValue("sumNonCashOpRF").scaled != 0)
                or (it.currentItem.fieldValue("numbNonCashOpAbroad").scaled != 0)
                or (it.currentItem.fieldValue("sumNonCashOpAbroad").scaled != 0)
                or (it.currentItem.fieldValue("numbNonCashOpOnlineStore").scaled != 0)
                or (it.currentItem.fieldValue("sumNonCashOpOnlineStore").scaled != 0)
                or (it.currentItem.fieldValue("numbNonCashOpCustoms").scaled != 0)
                or (it.currentItem.fieldValue("sumNonCashOpCustoms").scaled != 0)
                or (it.currentItem.fieldValue("numbNonCashOpOther").scaled != 0)
                or (it.currentItem.fieldValue("sumNonCashOpOther").scaled != 0))
                    return false;
                end;
            end;

            it.moveNext();
        end;

        return true;
    end;

    macro getAttribute(okato : String, codePS : String, lineDescribe : String) : RcbAttributeBase
        m_attributes.moveFirst();
        while (m_attributes.moveNext())
            if ((m_attributes.getCurrentItem().getId() == okato) and (m_attributes.getCurrentItem().getCodePaymentSystem() == codePS) and (m_attributes.getCurrentItem().getLineDescribe() == lineDescribe))
                return m_attributes.getCurrentItem();
            end;
        end;

        return m_attributes.push_back(objectFactoryInstance.createAttributePart1(okato, this, getAttributeCompositeValue(okato, codePS, lineDescribe)));
    end;

    macro getUserAttribute(okato : String, codePS : String, lineDescribe : String) : RcbAttributeBase
        m_attributes.moveFirst();
        while (m_attributes.moveNext())
            if ((m_attributes.getCurrentItem().getId() == okato) and (m_attributes.getCurrentItem().getCodePaymentSystem() == codePS) and (m_attributes.getCurrentItem().getLineDescribe() == lineDescribe))
                return m_attributes.getCurrentItem();
            end;
        end;

        return m_attributes.push_back(objectFactoryInstance.createAttributePart1(okato, this, getAttributeCompositeValue(okato, codePS, lineDescribe)));
    end;

    macro savePart(dataSet)
        var currentValue;
        var rcbCompositeValue;
        var currentCompositeValue;
        var lineDescribe;

        while (not dataSet.EOF)
            if (dataSet.cardKind == "Д")
                dataSet.moveNext();
                continue;
            end;

            if (dataSet.totalPaymentSystem == 1)
                rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_FOR);
                lineDescribe = TOTAL_FOR;
            elif (dataSet.totalOkato == 1)
                rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_FOR_OKATO);
                lineDescribe = TOTAL_FOR_OKATO;
            elif (dataSet.totalCreditOrg == 1)
                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);
                lineDescribe = TOTAL_FOR_CREDIT_ORG;
            elif (dataSet.totalKindOkato == 1)
                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);

                if (dataSet.cardKind == "ДО")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_PAYMENT_CARDS_FOR_OKATO);
                    lineDescribe = TOTAL_PAYMENT_CARDS_FOR_OKATO;
                elif (dataSet.cardKind == "О")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_PAYMENT_CARDS_OVERDRAFT_FOR_OKATO);
                    lineDescribe = TOTAL_PAYMENT_CARDS_OVERDRAFT_FOR_OKATO;
                elif (dataSet.cardKind == "К")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_CREDIT_CARDS_FOR_OKATO);
                    lineDescribe = TOTAL_CREDIT_CARDS_FOR_OKATO;
                end;
            elif (dataSet.totalKindCreditOrganization == 1)
                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);

                if (dataSet.cardKind == "ДО")
                    rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_PAYMENT_CARDS_FOR_CREDIT_ORG);
                    lineDescribe = TOTAL_PAYMENT_CARDS_FOR_CREDIT_ORG;
                elif (dataSet.cardKind == "О")
                    rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_PAYMENT_CARDS_OVERDRAFT_FOR_CREDIT_ORG);
                    lineDescribe = TOTAL_PAYMENT_CARDS_OVERDRAFT_FOR_CREDIT_ORG;
                elif (dataSet.cardKind == "К")
                    rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_CREDIT_CARDS_FOR_CREDIT_ORG);
                    lineDescribe = TOTAL_CREDIT_CARDS_FOR_CREDIT_ORG;
                end;
            else
                if (dataSet.cardKind == "ДО")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", PAYMENT_CARDS);
                    lineDescribe = PAYMENT_CARDS;
                elif (dataSet.cardKind == "О")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", PAYMENT_CARDS_OVERDRAFT);
                    lineDescribe = PAYMENT_CARDS_OVERDRAFT;
                elif (dataSet.cardKind == "К")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", CREDIT_CARDS);
                    lineDescribe = CREDIT_CARDS;
                end;
            end;

            currentCompositeValue = rcbCompositeValue;

            currentValue = currentCompositeValue.addValue();

            currentValue.reset();

            currentValue.fieldValue("okato").exact = nvl(dataSet.okato, "");
            currentValue.fieldValue("nameTerritory").exact = nvl(dataSet.nameTerritory, "");
            currentValue.fieldValue("codePaymentSystem").exact = nvl(dataSet.codePaymentSystem, "");
            currentValue.fieldValue("namePaymentSystem").exact = nvl(dataSet.namePaymentSystem, "");
            currentValue.fieldValue("numbClientPaymentSystem").exact = nvl(dataSet.numbClientPaymentSystem, "");
            currentValue.fieldValue("numbPCEndDate").exact = dataSet.numbPCEndDate;
            currentValue.fieldValue("numbPCUsingReportPeriod").exact = dataSet.numbPCUsingReportPeriod;
            currentValue.fieldValue("sumPCHoldersCash").exact = dataSet.sumPCHoldersCash;
            currentValue.fieldValue("sumPCHoldersCredit").exact = dataSet.sumPCHoldersCredit;
            currentValue.fieldValue("numbPCObtainCashRF").exact = dataSet.numbPCObtainCashRF;
            currentValue.fieldValue("sumPCObtainCashRF").exact = dataSet.sumPCObtainCashRF;
            currentValue.fieldValue("numbPCObtainCashAbroad").exact = dataSet.numbPCObtainCashAbroad;
            currentValue.fieldValue("sumPCObtainCashAbroad").exact = dataSet.sumPCObtainCashAbroad;
            currentValue.fieldValue("numbNonCashInternetOp").exact = dataSet.numbNonCashInternetOp;
            currentValue.fieldValue("sumNonCashInternetOp").exact = dataSet.sumNonCashInternetOp;
            currentValue.fieldValue("numbNonCashMobilOp").exact = dataSet.numbNonCashMobilOp;
            currentValue.fieldValue("sumNonCashMobilOp").exact = dataSet.sumNonCashMobilOp;
            currentValue.fieldValue("numbNonCashOpRF").exact = dataSet.numbNonCashOpRF;
            currentValue.fieldValue("sumNonCashOpRF").exact = dataSet.sumNonCashOpRF;
            currentValue.fieldValue("numbNonCashOpAbroad").exact = dataSet.numbNonCashOpAbroad;
            currentValue.fieldValue("sumNonCashOpAbroad").exact = dataSet.sumNonCashOpAbroad;
            currentValue.fieldValue("numbNonCashOpOnlineStore").exact = dataSet.numbNonCashOpOnlineStore;
            currentValue.fieldValue("sumNonCashOpOnlineStore").exact = dataSet.sumNonCashOpOnlineStore;
            currentValue.fieldValue("numbNonCashOpCustoms").exact = dataSet.numbNonCashOpCustoms;
            currentValue.fieldValue("sumNonCashOpCustoms").exact = dataSet.sumNonCashOpCustoms;
            currentValue.fieldValue("numbNonCashOpOther").exact = dataSet.numbNonCashOpOther;
            currentValue.fieldValue("sumNonCashOpOther").exact = dataSet.sumNonCashOpOther;

            currentValue.fieldValue("totalNumbNonCashOp").exact = dataSet.numbNonCashOpRF + dataSet.numbNonCashOpAbroad + dataSet.numbNonCashOpCustoms + dataSet.numbNonCashOpOther;
            currentValue.fieldValue("totalSumNonCashOp").exact = dataSet.sumNonCashOpRF + dataSet.sumNonCashOpAbroad + dataSet.sumNonCashOpCustoms + dataSet.sumNonCashOpOther;

            currentValue.fieldValue("lineDescribe").exact = lineDescribe;

            currentValue.recalculateScaled();

            if (lineDescribe == TOTAL_FOR_OKATO)
                rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_FOR_PHYSICS);
                currentValue = rcbCompositeValue.addValue();
                currentValue.reset();

                currentValue.fieldValue("okato").exact = nvl(dataSet.okato, "");
                currentValue.fieldValue("nameTerritory").exact = nvl(dataSet.nameTerritory, "");
                currentValue.fieldValue("codePaymentSystem").exact = nvl(dataSet.codePaymentSystem, "");
                currentValue.fieldValue("namePaymentSystem").exact = nvl(dataSet.namePaymentSystem, "");
                currentValue.fieldValue("numbClientPaymentSystem").exact = nvl(dataSet.numbClientPaymentSystem, "");
                currentValue.fieldValue("numbPCEndDate").exact = dataSet.numbPCEndDate;
                currentValue.fieldValue("numbPCUsingReportPeriod").exact = dataSet.numbPCUsingReportPeriod;
                currentValue.fieldValue("sumPCHoldersCash").exact = dataSet.sumPCHoldersCash;
                currentValue.fieldValue("sumPCHoldersCredit").exact = dataSet.sumPCHoldersCredit;
                currentValue.fieldValue("numbPCObtainCashRF").exact = dataSet.numbPCObtainCashRF;
                currentValue.fieldValue("sumPCObtainCashRF").exact = dataSet.sumPCObtainCashRF;
                currentValue.fieldValue("numbPCObtainCashAbroad").exact = dataSet.numbPCObtainCashAbroad;
                currentValue.fieldValue("sumPCObtainCashAbroad").exact = dataSet.sumPCObtainCashAbroad;
                currentValue.fieldValue("numbNonCashInternetOp").exact = dataSet.numbNonCashInternetOp;
                currentValue.fieldValue("sumNonCashInternetOp").exact = dataSet.sumNonCashInternetOp;
                currentValue.fieldValue("numbNonCashMobilOp").exact = dataSet.numbNonCashMobilOp;
                currentValue.fieldValue("sumNonCashMobilOp").exact = dataSet.sumNonCashMobilOp;
                currentValue.fieldValue("numbNonCashOpRF").exact = dataSet.numbNonCashOpRF;
                currentValue.fieldValue("sumNonCashOpRF").exact = dataSet.sumNonCashOpRF;
                currentValue.fieldValue("numbNonCashOpAbroad").exact = dataSet.numbNonCashOpAbroad;
                currentValue.fieldValue("sumNonCashOpAbroad").exact = dataSet.sumNonCashOpAbroad;
                currentValue.fieldValue("numbNonCashOpOnlineStore").exact = dataSet.numbNonCashOpOnlineStore;
                currentValue.fieldValue("sumNonCashOpOnlineStore").exact = dataSet.sumNonCashOpOnlineStore;
                currentValue.fieldValue("numbNonCashOpCustoms").exact = dataSet.numbNonCashOpCustoms;
                currentValue.fieldValue("sumNonCashOpCustoms").exact = dataSet.sumNonCashOpCustoms;
                currentValue.fieldValue("numbNonCashOpOther").exact = dataSet.numbNonCashOpOther;
                currentValue.fieldValue("sumNonCashOpOther").exact = dataSet.sumNonCashOpOther;

                currentValue.fieldValue("totalNumbNonCashOp").exact = dataSet.numbNonCashOpRF + dataSet.numbNonCashOpAbroad + dataSet.numbNonCashOpCustoms + dataSet.numbNonCashOpOther;
                currentValue.fieldValue("totalSumNonCashOp").exact = dataSet.sumNonCashOpRF + dataSet.sumNonCashOpAbroad + dataSet.sumNonCashOpCustoms + dataSet.sumNonCashOpOther;

                currentValue.fieldValue("lineDescribe").exact = TOTAL_FOR_PHYSICS;
                currentValue.recalculateScaled();
            end;

            dataSet.moveNext();
        end;
    end;

    private macro getUserAttributeValue()

        if (m_userAttributeValue == null)
            m_userAttributeValue = global.getRcbReport().attributeValue("Раздел1_Подраздел1_Ввод");
        end;

        return m_userAttributeValue;
    end;

    private macro getPartUserCompositeValue(okato : String, codePaymentSystem : String, lineDescribe : String)
        var keyValue = getUserAttributeValue().createKeyValue();

        keyValue.fieldValue("okato") = okato;
        keyValue.fieldValue("codePaymentSystem") = codePaymentSystem;
        keyValue.fieldValue("lineDescribe") = lineDescribe;

        var compositeValue = getUserAttributeValue().findValue(keyValue);

        if (compositeValue != null)
            return compositeValue;
        end;

        compositeValue = getUserAttributeValue().addValue();
        compositeValue.reset();
        compositeValue.fieldValue("okato").exact = okato;
        compositeValue.fieldValue("codePaymentSystem").exact = codePaymentSystem;
        compositeValue.fieldValue("lineDescribe").exact = lineDescribe;

        return compositeValue;
    end;

    macro defineUserAtribute(dataSet)
        var lineDescribe = "";

        while (not dataSet.EOF)
            lineDescribe = TOTAL_FOR;
            getPartUserCompositeValue(dataSet.okato, dataSet.codePaymentSystem, lineDescribe);
            lineDescribe = PAYMENT_CARDS;
            getPartUserCompositeValue(dataSet.okato, dataSet.codePaymentSystem, lineDescribe);
            lineDescribe = PAYMENT_CARDS_OVERDRAFT;
            getPartUserCompositeValue(dataSet.okato, dataSet.codePaymentSystem, lineDescribe);
            lineDescribe = CREDIT_CARDS;
            getPartUserCompositeValue(dataSet.okato, dataSet.codePaymentSystem, lineDescribe);
            dataSet.moveNext()
        end;
    end;

    macro saveUserAttribute()
        var iterator = getUserAttributeValue().createValueIterator();
        var rcbCompositeValue;

        iterator.moveFirst();
        while (not iterator.isDone())

            rcbCompositeValue = getAttributeCompositeValue(iterator.currentItem.fieldValue("okato").exact, iterator.currentItem.fieldValue("codePaymentSystem").exact, iterator.currentItem.fieldValue("lineDescribe").exact);
            rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
            rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
            rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
            rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
            rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
            rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
            rcbCompositeValue.recalculateScaled();

            if (iterator.currentItem.fieldValue("lineDescribe").exact == TOTAL_FOR)
                rcbCompositeValue = getAttributeCompositeValue(iterator.currentItem.fieldValue("okato").exact, "", TOTAL_FOR_OKATO);
                rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact + iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact + iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact + iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact + iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
                rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
                rcbCompositeValue.recalculateScaled();

                rcbCompositeValue = getAttributeCompositeValue(iterator.currentItem.fieldValue("okato").exact, "", TOTAL_FOR_PHYSICS);
                rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact + iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact + iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact + iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact + iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
                rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
                rcbCompositeValue.recalculateScaled();

                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);
                rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact + iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact + iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact + iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact + iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
                rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
                rcbCompositeValue.recalculateScaled();
            elif (iterator.currentItem.fieldValue("lineDescribe").exact == PAYMENT_CARDS)
                rcbCompositeValue = getAttributeCompositeValue(iterator.currentItem.fieldValue("okato").exact, "", TOTAL_PAYMENT_CARDS_FOR_OKATO);
                rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact + iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact + iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact + iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact + iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
                rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
                rcbCompositeValue.recalculateScaled();

                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_PAYMENT_CARDS_FOR_CREDIT_ORG);
                rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact + iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact + iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact + iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact + iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
                rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
                rcbCompositeValue.recalculateScaled();
            elif (iterator.currentItem.fieldValue("lineDescribe").exact == PAYMENT_CARDS_OVERDRAFT)
                rcbCompositeValue = getAttributeCompositeValue(iterator.currentItem.fieldValue("okato").exact, "", TOTAL_PAYMENT_CARDS_OVERDRAFT_FOR_OKATO);
                rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact + iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact + iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact + iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact + iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
                rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
                rcbCompositeValue.recalculateScaled();

                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_PAYMENT_CARDS_OVERDRAFT_FOR_CREDIT_ORG);
                rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact + iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact + iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact + iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact + iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
                rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
                rcbCompositeValue.recalculateScaled();
            elif (iterator.currentItem.fieldValue("lineDescribe").exact == CREDIT_CARDS)
                rcbCompositeValue = getAttributeCompositeValue(iterator.currentItem.fieldValue("okato").exact, "", TOTAL_CREDIT_CARDS_FOR_OKATO);
                rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact + iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact + iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact + iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact + iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
                rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
                rcbCompositeValue.recalculateScaled();

                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_CREDIT_CARDS_FOR_CREDIT_ORG);
                rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact = rcbCompositeValue.fieldValue("numbNonCashInternetOp").exact + iterator.currentItem.fieldValue("numbNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact = rcbCompositeValue.fieldValue("sumNonCashInternetOp").exact + iterator.currentItem.fieldValue("sumNonCashInternetOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact = rcbCompositeValue.fieldValue("numbNonCashMobilOp").exact + iterator.currentItem.fieldValue("numbNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact = rcbCompositeValue.fieldValue("sumNonCashMobilOp").exact + iterator.currentItem.fieldValue("sumNonCashMobilOp").exact;
                rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("numbNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("numbNonCashOpOnlineStore").exact;
                rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact = rcbCompositeValue.fieldValue("sumNonCashOpOnlineStore").exact + iterator.currentItem.fieldValue("sumNonCashOpOnlineStore").exact;
                rcbCompositeValue.recalculateScaled();
            end;

            iterator.moveNext();
        end;
    end;

    private macro constructorTF250Part1SubPart1(id : String, compositeValue)
        initRcbPartBase(id, compositeValue);

        m_userAttributeValue = global.getRcbReport().attributeValue("Раздел1_Подраздел1_Ввод");

        m_isEmpty = true;
    end;

    constructorTF250Part1SubPart1(id, compositeValue);
end;

class (TF250Part1SubPart1) TF250Part1SubPart1_4212(id : String, compositeValue)
    const TOTAL_CONTACTLESS_CARDS_FOR_CREDIT_ORG      = "справочно бесконтактные карты";
    const TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG = "операции бесконтактная технология";

    macro savePart(dataSet)
        var currentValue;
        var rcbCompositeValue;
        var currentCompositeValue;
        var lineDescribe;

        while (not dataSet.EOF)
            if ((dataSet.cardKind == "Д") or (dataSet.cardKind == "О"))
                dataSet.moveNext();
                continue;
            end;

            if (dataSet.totalPaymentSystem == 1)
                rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_FOR);
                lineDescribe = TOTAL_FOR;
            elif (dataSet.totalOkato == 1)
                rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_FOR_OKATO);
                lineDescribe = TOTAL_FOR_OKATO;
            elif (dataSet.totalCreditOrg == 1)
                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);

                if (dataSet.totalContactlessCards == 1)
                    rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_CONTACTLESS_CARDS_FOR_CREDIT_ORG);
                    lineDescribe = TOTAL_CONTACTLESS_CARDS_FOR_CREDIT_ORG;
                elif (dataSet.totalContactlessTECHNOLOGY == 1)
                    rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG);
                    lineDescribe = TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG;
                else
                    lineDescribe = TOTAL_FOR_CREDIT_ORG;
                end;
            elif (dataSet.totalKindOkato == 1)
                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);

                if (dataSet.cardKind == "ДО")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_PAYMENT_CARDS_FOR_OKATO);
                    lineDescribe = TOTAL_PAYMENT_CARDS_FOR_OKATO;
                elif (dataSet.cardKind == "К")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_CREDIT_CARDS_FOR_OKATO);
                    lineDescribe = TOTAL_CREDIT_CARDS_FOR_OKATO;
                end;
            elif (dataSet.totalKindCreditOrganization == 1)
                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);

                if (dataSet.cardKind == "ДО")
                    rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_PAYMENT_CARDS_FOR_CREDIT_ORG);
                    lineDescribe = TOTAL_PAYMENT_CARDS_FOR_CREDIT_ORG;
                elif (dataSet.cardKind == "К")
                    rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_CREDIT_CARDS_FOR_CREDIT_ORG);
                    lineDescribe = TOTAL_CREDIT_CARDS_FOR_CREDIT_ORG;
                end;
            else
                if (dataSet.cardKind == "ДО")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", PAYMENT_CARDS);
                    lineDescribe = PAYMENT_CARDS;
                elif (dataSet.cardKind == "К")
                    rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", CREDIT_CARDS);
                    lineDescribe = CREDIT_CARDS;
                end;
            end;

            currentCompositeValue = rcbCompositeValue;

            currentValue = currentCompositeValue.addValue();

            currentValue.reset();

            currentValue.fieldValue("okato").exact = nvl(dataSet.okato, "");
            currentValue.fieldValue("nameTerritory").exact = nvl(dataSet.nameTerritory, "");
            currentValue.fieldValue("codePaymentSystem").exact = nvl(dataSet.codePaymentSystem, "");
            currentValue.fieldValue("namePaymentSystem").exact = nvl(dataSet.namePaymentSystem, "");
            currentValue.fieldValue("numbClientPaymentSystem").exact = nvl(dataSet.numbClientPaymentSystem, "");
            currentValue.fieldValue("numbPCEndDate").exact = dataSet.numbPCEndDate;
            currentValue.fieldValue("numbPCUsingReportPeriod").exact = dataSet.numbPCUsingReportPeriod;
            currentValue.fieldValue("sumPCHoldersCash").exact = dataSet.sumPCHoldersCash;
            currentValue.fieldValue("sumPCHoldersCredit").exact = dataSet.sumPCHoldersCredit;
            currentValue.fieldValue("numbPCObtainCashRF").exact = dataSet.numbPCObtainCashRF;
            currentValue.fieldValue("sumPCObtainCashRF").exact = dataSet.sumPCObtainCashRF;
            currentValue.fieldValue("numbPCObtainCashAbroad").exact = dataSet.numbPCObtainCashAbroad;
            currentValue.fieldValue("sumPCObtainCashAbroad").exact = dataSet.sumPCObtainCashAbroad;
            currentValue.fieldValue("numbNonCashInternetOp").exact = dataSet.numbNonCashInternetOp;
            currentValue.fieldValue("sumNonCashInternetOp").exact = dataSet.sumNonCashInternetOp;
            currentValue.fieldValue("numbNonCashMobilOp").exact = dataSet.numbNonCashMobilOp;
            currentValue.fieldValue("sumNonCashMobilOp").exact = dataSet.sumNonCashMobilOp;
            currentValue.fieldValue("numbNonCashOpRF").exact = dataSet.numbNonCashOpRF;
            currentValue.fieldValue("sumNonCashOpRF").exact = dataSet.sumNonCashOpRF;
            currentValue.fieldValue("numbNonCashOpAbroad").exact = dataSet.numbNonCashOpAbroad;
            currentValue.fieldValue("sumNonCashOpAbroad").exact = dataSet.sumNonCashOpAbroad;
            currentValue.fieldValue("numbNonCashOpOnlineStore").exact = dataSet.numbNonCashOpOnlineStore;
            currentValue.fieldValue("sumNonCashOpOnlineStore").exact = dataSet.sumNonCashOpOnlineStore;
            currentValue.fieldValue("numbNonCashOpCustoms").exact = dataSet.numbNonCashOpCustoms;
            currentValue.fieldValue("sumNonCashOpCustoms").exact = dataSet.sumNonCashOpCustoms;
            currentValue.fieldValue("numbNonCashOpOther").exact = dataSet.numbNonCashOpOther;
            currentValue.fieldValue("sumNonCashOpOther").exact = dataSet.sumNonCashOpOther;

            currentValue.fieldValue("totalNumbNonCashOp").exact = dataSet.numbNonCashOpRF + dataSet.numbNonCashOpAbroad + dataSet.numbNonCashOpCustoms + dataSet.numbNonCashOpOther;
            currentValue.fieldValue("totalSumNonCashOp").exact = dataSet.sumNonCashOpRF + dataSet.sumNonCashOpAbroad + dataSet.sumNonCashOpCustoms + dataSet.sumNonCashOpOther;

            currentValue.fieldValue("lineDescribe").exact = lineDescribe;

            currentValue.recalculateScaled();

            if (lineDescribe == TOTAL_FOR_OKATO)
                rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", TOTAL_FOR_PHYSICS);
                currentValue = rcbCompositeValue.addValue();
                currentValue.reset();

                currentValue.fieldValue("okato").exact = nvl(dataSet.okato, "");
                currentValue.fieldValue("nameTerritory").exact = nvl(dataSet.nameTerritory, "");
                currentValue.fieldValue("codePaymentSystem").exact = nvl(dataSet.codePaymentSystem, "");
                currentValue.fieldValue("namePaymentSystem").exact = nvl(dataSet.namePaymentSystem, "");
                currentValue.fieldValue("numbClientPaymentSystem").exact = nvl(dataSet.numbClientPaymentSystem, "");
                currentValue.fieldValue("numbPCEndDate").exact = dataSet.numbPCEndDate;
                currentValue.fieldValue("numbPCUsingReportPeriod").exact = dataSet.numbPCUsingReportPeriod;
                currentValue.fieldValue("sumPCHoldersCash").exact = dataSet.sumPCHoldersCash;
                currentValue.fieldValue("sumPCHoldersCredit").exact = dataSet.sumPCHoldersCredit;
                currentValue.fieldValue("numbPCObtainCashRF").exact = dataSet.numbPCObtainCashRF;
                currentValue.fieldValue("sumPCObtainCashRF").exact = dataSet.sumPCObtainCashRF;
                currentValue.fieldValue("numbPCObtainCashAbroad").exact = dataSet.numbPCObtainCashAbroad;
                currentValue.fieldValue("sumPCObtainCashAbroad").exact = dataSet.sumPCObtainCashAbroad;
                currentValue.fieldValue("numbNonCashInternetOp").exact = dataSet.numbNonCashInternetOp;
                currentValue.fieldValue("sumNonCashInternetOp").exact = dataSet.sumNonCashInternetOp;
                currentValue.fieldValue("numbNonCashMobilOp").exact = dataSet.numbNonCashMobilOp;
                currentValue.fieldValue("sumNonCashMobilOp").exact = dataSet.sumNonCashMobilOp;
                currentValue.fieldValue("numbNonCashOpRF").exact = dataSet.numbNonCashOpRF;
                currentValue.fieldValue("sumNonCashOpRF").exact = dataSet.sumNonCashOpRF;
                currentValue.fieldValue("numbNonCashOpAbroad").exact = dataSet.numbNonCashOpAbroad;
                currentValue.fieldValue("sumNonCashOpAbroad").exact = dataSet.sumNonCashOpAbroad;
                currentValue.fieldValue("numbNonCashOpOnlineStore").exact = dataSet.numbNonCashOpOnlineStore;
                currentValue.fieldValue("sumNonCashOpOnlineStore").exact = dataSet.sumNonCashOpOnlineStore;
                currentValue.fieldValue("numbNonCashOpCustoms").exact = dataSet.numbNonCashOpCustoms;
                currentValue.fieldValue("sumNonCashOpCustoms").exact = dataSet.sumNonCashOpCustoms;
                currentValue.fieldValue("numbNonCashOpOther").exact = dataSet.numbNonCashOpOther;
                currentValue.fieldValue("sumNonCashOpOther").exact = dataSet.sumNonCashOpOther;

                currentValue.fieldValue("totalNumbNonCashOp").exact = dataSet.numbNonCashOpRF + dataSet.numbNonCashOpAbroad + dataSet.numbNonCashOpCustoms + dataSet.numbNonCashOpOther;
                currentValue.fieldValue("totalSumNonCashOp").exact = dataSet.sumNonCashOpRF + dataSet.sumNonCashOpAbroad + dataSet.sumNonCashOpCustoms + dataSet.sumNonCashOpOther;

                currentValue.fieldValue("lineDescribe").exact = TOTAL_FOR_PHYSICS;
                currentValue.recalculateScaled();
            end;

            dataSet.moveNext();
        end;
    end;

    macro constructorTF250Part1SubPart1_4212(id : String, compositeValue)
        initTF250Part1SubPart1(id, compositeValue);
    end;

    constructorTF250Part1SubPart1_4212(id, compositeValue);
end;

class (TF250Part1SubPart1_4212) TF250Part1SubPart1_4637(id : String, compositeValue)
    private var m_userAttributes : RcbArray = RcbArray();

    private macro getPartContactlessUserCompositeValue(id : String)
        var attributeValue = global.getRcbReport().attributeValue(id);
        var keyValue       = attributeValue.createKeyValue();

        keyValue.fieldValue("key") = USER_INPUT_KEY;
        var compositeValue = attributeValue.findValue(keyValue);

        if (compositeValue != null)
            return compositeValue;
        end;

        compositeValue = attributeValue.addValue();
        compositeValue.reset();
        compositeValue.fieldValue("key").exact = USER_INPUT_KEY;

        return compositeValue;
    end;

    macro getContactlessUserAttribute(id : String) : RcbAttributeBase
        if   (id == TOTAL_CONTACTLESS_CARDS_FOR_CREDIT_ORG)
            id = "Бесконтактные_карты_ввод";
        elif (id == TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG)
            id = "Бесконтактные_операции_ввод";
        end;

        m_userAttributes.moveFirst();
        while (m_userAttributes.moveNext())
            if ((m_userAttributes.getCurrentItem().getId() == id))
                return m_userAttributes.getCurrentItem();
            end;
        end;

        return m_userAttributes.push_back(objectFactoryInstance.createTotalUserAttributePart1(id, this, getPartContactlessUserCompositeValue(id)));
    end;

    macro defineUserAtribute(dataSet)
        var lineDescribe = "";

        while (not dataSet.EOF)
            lineDescribe = TOTAL_FOR;
            getPartUserCompositeValue(dataSet.okato, dataSet.codePaymentSystem, lineDescribe);
            lineDescribe = PAYMENT_CARDS;
            getPartUserCompositeValue(dataSet.okato, dataSet.codePaymentSystem, lineDescribe);
            lineDescribe = PAYMENT_CARDS_OVERDRAFT;
            getPartUserCompositeValue(dataSet.okato, dataSet.codePaymentSystem, lineDescribe);
            lineDescribe = CREDIT_CARDS;
            getPartUserCompositeValue(dataSet.okato, dataSet.codePaymentSystem, lineDescribe);
            dataSet.moveNext()
        end;

        getContactlessUserAttribute(TOTAL_CONTACTLESS_CARDS_FOR_CREDIT_ORG);
        getContactlessUserAttribute(TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG);
    end;

    macro constructorTF250Part1SubPart1_4637(id : String, compositeValue)
        initTF250Part1SubPart1_4212(id, compositeValue);
    end;

    constructorTF250Part1SubPart1_4637(id, compositeValue);
end;

class (RcbPartBase) TF250Part1SubPart2(id : String, compositeValue)

    private var m_isEmpty;

    const TOTAL_FOR = "Всего по";
    const PAYMENT_CARDS = "расчетные карты";
    const PAYMENT_CARDS_OVERDRAFT = "расчетные карты с овердрафтом";
    const CREDIT_CARDS = "кредитные карты";

    private macro getAttributeCompositeValue(okato : String, codePS : String, lineDescribe : String)

        var keyValue = m_compositeValue.createKeyValue();

        keyValue.fieldValue("okato") = okato;
        keyValue.fieldValue("codePaymentSystem") = codePS;
        keyValue.fieldValue("lineDescribe") = lineDescribe;

        var compositeValue = m_compositeValue.findValue(keyValue);

        if (compositeValue != null)
            return compositeValue;
        end;

        compositeValue = m_compositeValue.addValue();

        compositeValue.reset();

        compositeValue.fieldValue("okato").exact = okato;
        compositeValue.fieldValue("codePaymentSystem").exact = codePS;
        compositeValue.fieldValue("lineDescribe").exact = lineDescribe;

        return compositeValue;
    end;

    macro getAttribute(okato : String, codePS : String, lineDescribe : String) : RcbAttributeBase
        m_attributes.moveFirst();

        while (m_attributes.moveNext())
            if ((m_attributes.getCurrentItem().getId() == okato) and (m_attributes.getCurrentItem().getCodePaymentSystem() == codePS) and (m_attributes.getCurrentItem().getLineDescribe() == lineDescribe))
                return m_attributes.getCurrentItem();
            end;
        end;

        return m_attributes.push_back(objectFactoryInstance.createAttributePart1(okato, this, getAttributeCompositeValue(okato, codePS, lineDescribe)));
    end;

    macro savePart(dataSet, lineDescribe : String)
        var currentValue;
        var rcbCompositeValue;
        var currentCompositeValue;

        while (not dataSet.EOF)
            rcbCompositeValue = getAttributeCompositeValue(dataSet.okato, "", lineDescribe);
            currentCompositeValue = rcbCompositeValue;

            currentValue = currentCompositeValue.addValue();

            currentValue.reset();

            currentValue.fieldValue("okato").exact = dataSet.okato;
            currentValue.fieldValue("nameTerritory").exact = dataSet.nameTerritory;
            currentValue.fieldValue("codePaymentSystem").exact = dataSet.codePaymentSystem;
            currentValue.fieldValue("namePaymentSystem").exact = dataSet.namePaymentSystem;
            currentValue.fieldValue("numbClientPaymentSystem").exact = dataSet.numbClientPaymentSystem;
            currentValue.fieldValue("numbPCEndDate").exact = dataSet.numbPCEndDate;
            currentValue.fieldValue("numbPCUsingReportPeriod").exact = dataSet.numbPCUsingReportPeriod;
            currentValue.fieldValue("sumPCHoldersCash").exact = dataSet.sumPCHoldersCash;
            currentValue.fieldValue("sumPCHoldersCredit").exact = dataSet.sumPCHoldersCredit;
            currentValue.fieldValue("numbPCObtainCashRF").exact = dataSet.numbPCObtainCashRF;
            currentValue.fieldValue("sumPCObtainCashRF").exact = dataSet.sumPCObtainCashRF;
            currentValue.fieldValue("numbPCObtainCashAbroad").exact = dataSet.numbPCObtainCashAbroad;
            currentValue.fieldValue("sumPCObtainCashAbroad").exact = dataSet.sumPCObtainCashAbroad;
            currentValue.fieldValue("totalNumbNonCashOp").exact = dataSet.totalNumbNonCashOp;
            currentValue.fieldValue("totalSumNonCashOp").exact = dataSet.totalSumNonCashOp;
            currentValue.fieldValue("numbNonCashInternetOp").exact = dataSet.numbNonCashInternetOp;
            currentValue.fieldValue("sumNonCashInternetOp").exact = dataSet.sumNonCashInternetOp;
            currentValue.fieldValue("numbNonCashMobilOp").exact = dataSet.numbNonCashMobilOp;
            currentValue.fieldValue("sumNonCashMobilOp").exact = dataSet.sumNonCashMobilOp;
            currentValue.fieldValue("numbNonCashOpRF").exact = dataSet.numbNonCashOpRF;
            currentValue.fieldValue("sumNonCashOpRF").exact = dataSet.sumNonCashOpRF;
            currentValue.fieldValue("numbNonCashOpAbroad").exact = dataSet.numbNonCashOpAbroad;
            currentValue.fieldValue("sumNonCashOpAbroad").exact = dataSet.sumNonCashOpAbroad;
            currentValue.fieldValue("numbNonCashOpOnlineStore").exact = dataSet.numbNonCashOpOnlineStore;
            currentValue.fieldValue("sumNonCashOpOnlineStore").exact = dataSet.sumNonCashOpOnlineStore;
            currentValue.fieldValue("numbNonCashOpCustoms").exact = dataSet.numbNonCashOpCustoms;
            currentValue.fieldValue("sumNonCashOpCustoms").exact = dataSet.sumNonCashOpCustoms;
            currentValue.fieldValue("numbNonCashOpOther").exact = dataSet.numbNonCashOpOther;
            currentValue.fieldValue("sumNonCashOpOther").exact = dataSet.sumNonCashOpOther;
            currentValue.fieldValue("lineDescribe").exact = lineDescribe;

            currentValue.recalculateScaled();
            dataSet.moveNext();
        end;
    end;

    private macro constructorTF250Part1SubPart2(id : String, compositeValue)
        initRcbPartBase(id, compositeValue);

        m_isEmpty = true;
    end;

    constructorTF250Part1SubPart2(id, compositeValue);
end;

class (RcbPartBase) TF250Part2(id : String, compositeValue)

    private var m_userAttributeValue;
    private var m_isEmpty = true;

    const TOTAL_FOR = "Итого по";
    const TOTAL_FOR_CREDIT_ORG = "Итого по кредитной организации (ее филиалу)";

    private macro getAttributeCompositeValue(codeTerritory : String, codePS : String, lineDescribe : String)

        var keyValue = m_compositeValue.createKeyValue();

        keyValue.fieldValue("codeTerritory") = codeTerritory;
        keyValue.fieldValue("codePaymentSystem") = codePS;
        keyValue.fieldValue("lineDescribe") = lineDescribe;

        var compositeValue = m_compositeValue.findValue(keyValue);

        if (compositeValue != null)
            return compositeValue;
        end;

        compositeValue = m_compositeValue.addValue();

        compositeValue.reset();

        compositeValue.fieldValue("codeTerritory").exact = codeTerritory;
        compositeValue.fieldValue("codePaymentSystem").exact = codePS;
        compositeValue.fieldValue("lineDescribe").exact = lineDescribe;

        return compositeValue;
    end;

    private macro getUserAttributeValue()

        if (m_userAttributeValue == null)
            m_userAttributeValue = global.getRcbReport().attributeValue("Раздел1_Подраздел1_Ввод");
        end;

        return m_userAttributeValue;
    end;

    private macro getPartUserCompositeValue(codeTerritory : String, codePaymentSystem : String, lineDescribe : String)
        var keyValue = getUserAttributeValue().createKeyValue();

        keyValue.fieldValue("codeTerritory") = codeTerritory;
        keyValue.fieldValue("codePaymentSystem") = codePaymentSystem;
        keyValue.fieldValue("lineDescribe") = lineDescribe;

        var compositeValue = getUserAttributeValue().findValue(keyValue);

        if (compositeValue != null)
            return compositeValue;
        end;

        compositeValue = getUserAttributeValue().addValue();
        compositeValue.reset();
        compositeValue.fieldValue("codeTerritory").exact = codeTerritory;
        compositeValue.fieldValue("codePaymentSystem").exact = codePaymentSystem;
        compositeValue.fieldValue("lineDescribe").exact = lineDescribe;

        return compositeValue;
    end;

    macro savePart(dataSet)
        var currentValue;
        var rcbCompositeValue;
        var currentCompositeValue;
        var lineDescribe = "";

        while (not dataSet.EOF)
            if (dataSet.totalCreditOrg == 1)
                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);
                lineDescribe = TOTAL_FOR_CREDIT_ORG;
            elif (dataSet.totalCodeTerritory == 1)
                rcbCompositeValue = getAttributeCompositeValue(nvl(dataSet.codeTerritory, ""), "", TOTAL_FOR);
                lineDescribe = TOTAL_FOR;
            else
                rcbCompositeValue = getAttributeCompositeValue(nvl(dataSet.codeTerritory, ""), "", "");
                lineDescribe = "";
            end;

            currentCompositeValue = rcbCompositeValue;

            currentValue = currentCompositeValue.addValue();

            currentValue.reset();

            currentValue.fieldValue("codeTerritory").exact = nvl(dataSet.codeTerritory, "");
            currentValue.fieldValue("nameTerritory").exact = nvl(dataSet.nameTerritory, "");
            currentValue.fieldValue("codePaymentSystem").exact = nvl(dataSet.codePaymentSystem, "");
            currentValue.fieldValue("namePaymentSystem").exact = nvl(dataSet.namePaymentSystem, "");
            currentValue.fieldValue("totalNumbATM").exact = dataSet.totalNumbATM;
            currentValue.fieldValue("totalNumbAtmCashMoney").exact = dataSet.totalNumbAtmCashMoney;
            currentValue.fieldValue("numbATMFuncPayment").exact = dataSet.numbATMFuncPayment;
            currentValue.fieldValue("totalNumbCashReceipt").exact = dataSet.totalNumbCashReceipt;
            currentValue.fieldValue("numbCashReceiptNonPC").exact = dataSet.numbCashReceiptNonPC;
            currentValue.fieldValue("numbCashReceiptPC").exact = dataSet.numbCashReceiptPC;
            currentValue.fieldValue("numbPOSTermService").exact = dataSet.numbPOSTermService;
            currentValue.fieldValue("numbPOSTermEncashment").exact = dataSet.numbPOSTermEncashment;
            currentValue.fieldValue("numbImprintersService").exact = dataSet.numbImprintersService;
            currentValue.fieldValue("numbImprintersEncashment").exact = dataSet.numbImprintersEncashment;
            currentValue.fieldValue("lineDescribe").exact = lineDescribe;

            currentValue.recalculateScaled();
            dataSet.moveNext();
        end;
    end;

    macro isEmpty()
        var it = m_compositeValue.createValueIterator();

        it.moveFirst();
        while (not it.isDone)
            if (it.currentItem.isDefined())
                if ((it.currentItem.fieldValue("totalNumbATM").scaled != 0)
                 or (it.currentItem.fieldValue("totalNumbAtmCashMoney").scaled != 0)
                 or (it.currentItem.fieldValue("numbATMFuncPayment").scaled != 0)
                 or (it.currentItem.fieldValue("totalNumbCashReceipt").scaled != 0)
                 or (it.currentItem.fieldValue("numbCashReceiptNonPC").scaled != 0)
                 or (it.currentItem.fieldValue("numbCashReceiptPC").scaled != 0)
                 or (it.currentItem.fieldValue("numbPOSTermService").scaled != 0)
                 or (it.currentItem.fieldValue("numbPOSTermRemote").scaled != 0)
                 or (it.currentItem.fieldValue("numbPOSTermEncashment").scaled != 0)
                 or (it.currentItem.fieldValue("numbImprintersService").scaled != 0)
                 or (it.currentItem.fieldValue("numbImprintersEncashment").scaled != 0))
                    return false;
                end;
            end;

            it.moveNext();
        end;

        return true;
    end;

    macro getAttribute(codeTerritory : String, codePS : String, lineDescribe : String) : RcbAttributeBase
        m_attributes.moveFirst();

        while (m_attributes.moveNext())
            if ((m_attributes.getCurrentItem().getId() == codeTerritory) and (m_attributes.getCurrentItem().getCodePaymentSystem() == codePS) and (m_attributes.getCurrentItem().getLineDescribe() == lineDescribe))
                return m_attributes.getCurrentItem();
            end;
        end;

        return m_attributes.push_back(objectFactoryInstance.createAttributePart2(codeTerritory, this, getAttributeCompositeValue(codeTerritory, codePS, lineDescribe)));
    end;

    macro defineUserAtribute(dataSet)
        while (not dataSet.EOF)
            getPartUserCompositeValue(dataSet.codeTerritory, dataSet.codePaymentSystem, "");
            getPartUserCompositeValue(dataSet.codeTerritory, "", TOTAL_FOR);

            dataSet.moveNext()
        end;
    end;

    macro saveUserAttribute()
        var iterator = getUserAttributeValue().createValueIterator();
        var rcbCompositeValue;

        iterator.moveFirst();
        while (not iterator.isDone())
            rcbCompositeValue = getAttributeCompositeValue(iterator.currentItem.fieldValue("codeTerritory").exact, iterator.currentItem.fieldValue("codePaymentSystem").exact, iterator.currentItem.fieldValue("lineDescribe").exact);
            rcbCompositeValue.fieldValue("numbPOSTermRemote").exact = iterator.currentItem.fieldValue("numbPOSTermRemote").exact;

            if (iterator.currentItem.fieldValue("lineDescribe").exact == TOTAL_FOR)
                rcbCompositeValue = getAttributeCompositeValue(iterator.currentItem.fieldValue("codeTerritory").exact, "", TOTAL_FOR);
                rcbCompositeValue.fieldValue("numbPOSTermRemote").exact = iterator.currentItem.fieldValue("numbPOSTermRemote").exact;

                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);
                rcbCompositeValue.fieldValue("numbPOSTermRemote").exact = rcbCompositeValue.fieldValue("numbPOSTermRemote").exact + iterator.currentItem.fieldValue("numbPOSTermRemote").exact;
            end;

            iterator.moveNext();
        end;
    end;

    private macro constructorTF250Part2(id : String, compositeValue)
        initRcbPartBase("2", compositeValue);
        m_userAttributeValue = global.getRcbReport().attributeValue("Раздел2_Ввод");

        m_isEmpty = true;
    end;

    constructorTF250Part2(id, compositeValue);
end;

class (TF250Part2) TF250Part2_4212(id : String, compositeValue)
    const TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG = "Итого по кредитной организации бесконтактно";

    macro savePart(dataSet)
        var currentValue;
        var rcbCompositeValue;
        var currentCompositeValue;
        var lineDescribe = "";

        while (not dataSet.EOF)
            if (dataSet.totalCreditOrg == 1)
                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);

                if (dataSet.totalContactlessTechnology == 1)
                    rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG);
                    lineDescribe = TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG;
                else
                    lineDescribe = TOTAL_FOR_CREDIT_ORG;
                end;
            elif (dataSet.totalCodeTerritory == 1)
                rcbCompositeValue = getAttributeCompositeValue(nvl(dataSet.codeTerritory, ""), "", TOTAL_FOR);
                lineDescribe = TOTAL_FOR;
            else
                rcbCompositeValue = getAttributeCompositeValue(nvl(dataSet.codeTerritory, ""), "", "");
                lineDescribe = "";
            end;

            currentCompositeValue = rcbCompositeValue;

            currentValue = currentCompositeValue.addValue();

            currentValue.reset();

            currentValue.fieldValue("codeTerritory").exact = nvl(dataSet.codeTerritory, "");
            currentValue.fieldValue("nameTerritory").exact = nvl(dataSet.nameTerritory, "");
            currentValue.fieldValue("codePaymentSystem").exact = nvl(dataSet.codePaymentSystem, "");
            currentValue.fieldValue("namePaymentSystem").exact = nvl(dataSet.namePaymentSystem, "");
            currentValue.fieldValue("totalNumbATM").exact = dataSet.totalNumbATM;
            currentValue.fieldValue("totalNumbAtmCashMoney").exact = dataSet.totalNumbAtmCashMoney;
            currentValue.fieldValue("numbATMFuncPayment").exact = dataSet.numbATMFuncPayment;
            currentValue.fieldValue("totalNumbCashReceipt").exact = dataSet.totalNumbCashReceipt;
            currentValue.fieldValue("numbCashReceiptNonPC").exact = dataSet.numbCashReceiptNonPC;
            currentValue.fieldValue("numbCashReceiptPC").exact = dataSet.numbCashReceiptPC;
            currentValue.fieldValue("numbPOSTermService").exact = dataSet.numbPOSTermService;
            currentValue.fieldValue("numbPOSTermEncashment").exact = dataSet.numbPOSTermEncashment;
            currentValue.fieldValue("numbImprintersService").exact = dataSet.numbImprintersService;
            currentValue.fieldValue("numbImprintersEncashment").exact = dataSet.numbImprintersEncashment;
            currentValue.fieldValue("lineDescribe").exact = lineDescribe;

            currentValue.recalculateScaled();
            dataSet.moveNext();
        end;
    end;

    macro constructorTF250Part2_4212(id : String, compositeValue)
        initTF250Part2(id, compositeValue);
    end;

    constructorTF250Part2_4212(id, compositeValue);
end;

class (TF250Part2_4212) TF250Part2_4637(id : String, compositeValue)
    macro savePart(dataSet)
        var currentValue;
        var rcbCompositeValue;
        var currentCompositeValue;
        var lineDescribe = "";

        while (not dataSet.EOF)
            if (dataSet.totalCreditOrg == 1)
                rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_FOR_CREDIT_ORG);

                if (dataSet.totalContactlessTechnology == 1)
                    rcbCompositeValue = getAttributeCompositeValue("", "", TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG);
                    lineDescribe = TOTAL_CONTACTLESS_TECHNOLOGY_FOR_CREDIT_ORG;
                else
                    lineDescribe = TOTAL_FOR_CREDIT_ORG;
                end;
            elif (dataSet.totalCodeTerritory == 1)
                rcbCompositeValue = getAttributeCompositeValue(nvl(dataSet.codeTerritory, ""), "", TOTAL_FOR);
                lineDescribe = TOTAL_FOR;
            else
                rcbCompositeValue = getAttributeCompositeValue(nvl(dataSet.codeTerritory, ""), "", "");
                lineDescribe = "";
            end;

            currentCompositeValue = rcbCompositeValue;

            currentValue = currentCompositeValue.addValue();

            currentValue.reset();

            currentValue.fieldValue("codeTerritory").exact            = nvl(dataSet.codeTerritory, "");
            currentValue.fieldValue("nameTerritory").exact            = nvl(dataSet.nameTerritory, "");
            currentValue.fieldValue("codePaymentSystem").exact        = nvl(dataSet.codePaymentSystem, "");
            currentValue.fieldValue("namePaymentSystem").exact        = nvl(dataSet.namePaymentSystem, "");
            currentValue.fieldValue("totalNumbATM").exact             = dataSet.totalNumbATM;
            currentValue.fieldValue("totalNumbAtmCashMoney").exact    = dataSet.totalNumbAtmCashMoney;
            currentValue.fieldValue("numbATMFuncPayment").exact       = dataSet.numbATMFuncPayment;
            currentValue.fieldValue("totalNumbCashReceipt").exact     = dataSet.totalNumbCashReceipt;
            currentValue.fieldValue("numbCashReceiptNonPC").exact     = dataSet.numbCashReceiptNonPC;
            currentValue.fieldValue("numbCashReceiptPC").exact        = dataSet.numbCashReceiptPC;
            currentValue.fieldValue("numbPosTermBillRecycling").exact = dataSet.numbPosTermBillRecycling;
            currentValue.fieldValue("numbPOSTermService").exact       = dataSet.numbPOSTermService;
            currentValue.fieldValue("numbPOSTermEncashment").exact    = dataSet.numbPOSTermEncashment;
            currentValue.fieldValue("numbImprintersService").exact    = dataSet.numbImprintersService;
            currentValue.fieldValue("numbImprintersEncashment").exact = dataSet.numbImprintersEncashment;
            currentValue.fieldValue("lineDescribe").exact             = lineDescribe;

            currentValue.recalculateScaled();
            dataSet.moveNext();
        end;
    end;

    macro constructorTF250Part2_4637(id : String, compositeValue)
        initTF250Part2_4212(id, compositeValue);
    end;

    constructorTF250Part2_4637(id, compositeValue);
end;
