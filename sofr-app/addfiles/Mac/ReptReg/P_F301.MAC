/*───────────────────────────────────────────────────────────────────────────┐
  RS-Bank v 4.31                                     R-Style Software Lab Ltd
  Файл подсистемы "Отчеты ЦБ"

  Печать формы 301. Сведения об объеме средств, привлеченных кредитной организацией

CREATED : 15.01.98 Дробышевская А.

MODIFICATIONS:
          21.09.01 Зорина
          Итоговые значения рассчитываются исходя из уже округленных значений
          переменных.
└───────────────────────────────────────────────────────────────────────────*/
import BankInter,ReptCBInter, Param, Календарь,Chk_regD, rcb_date, chk_regd;
import rep_lib;/* 24.08.2007 Malakhova 111239*/

VAR Дата1_1660У; 
GetRegistryValue( "REPTREG\\REP_GROUPS\\COMMON\\Дата1_1660У", V_STRING, Дата1_1660У, NULL );

CheckRegDate(Дата1_1660У, Дата1_1660У);

if( (Дата1_1660У == date(0, 0, 0)) or (Дата1_1660У == NULL) )
    Дата1_1660У = date( 1, 4, 2006 );
end;

FILE pers( person );


MACRO Ind(arr, name )
var i=0;
 while(i < arr.size)
  if(arr(i) == name)
   return i;
  end;
  i = i + 1;
 end;       
 return FALSE;
END;

MACRO CorrectValue( A_ )

  if( ValType( A_ ) == V_UNDEF)
   return 0;
  end;

  return A_
END;

MACRO getNameOper
 pers.Oper = {oper};
 if( not getEQ( pers ) )
  return "";
 end;
 return trim( pers.Name );
END;

MACRO around( val )
 var l_coeff;
 if( not РасчетВКопейках )
  l_coeff = 1;
  val = int( floor( ( double( val )/l_coeff + 0.5 ) ) );
 end;
 return val;
END;

MACRO НулеваяФорма( А )
  var i = 13;

  while( i < 61 )
    if( CorrectValue(А(i)) == 0 )
    i = i + 1;
    else
        return false;
    end;
  end;

  return true;
END;

if ( not ПроверитьЕдиницыИзмерения() )
  exit(1);
end;

if( not ( {Название отчета} == "Форма 301" ) )
 msgbox( "Макрос реализован только для приложения \"", "Форма 301", "\"" );
 exit(1);
end;


VAR Атр301_13 = $0,  Атр301_30 = $0,   Атр301_42 = $0,
    Атр301_14 = $0,  Атр301_31 = $0,   Атр301_43 = $0,
    Атр301_15 = $0,  Атр301_32 = $0,   Атр301_44 = $0,
    Атр301_16 = $0,  Атр301_33 = $0,   Атр301_45 = $0,
    Атр301_18 = $0,  Атр301_34 = $0,   Атр301_46 = $0,
    Атр301_19 = $0,  Атр301_35 = $0,   Атр301_47 = $0,
    Атр301_20 = $0,  Атр301_36 = $0,   Атр301_48 = $0,
    Атр301_21 = $0,  Атр301_37 = $0,   Атр301_60 = $0,
    Атр301_27 = $0,  Атр301_39 = $0,   
    Атр301_28 = $0,  Атр301_40 = $0,
    Атр301_29 = $0,  Атр301_41 = $0,

    day,
    ReportDate,

    Об_ДВ____Гр3_ = $0,    Об_ДВ____Гр4_ = $0,
    Об_ДВ____Гр5_ = $0,    Об_ДВ____Гр6_ = $0,
    Об_Срочн_Гр3_ = $0,    Об_Срочн_Гр4_ = $0,
    Об_Срочн_Гр5_ = $0,    Об_Срочн_Гр6_ = $0,
    Об_ИТОГО_Гр3_ = $0,    Об_ИТОГО_Гр4_ = $0,
    Об_ИТОГО_Гр5_ = $0,    Об_ИТОГО_Гр6_ = $0,
    Об_ИТОГО_Гр7_ = $0,    Тр_До____Гр10 = $0,
    Тр_До____Гр11 = $0,    Тр_До____Гр12 = $0,
    Тр_До____Гр13 = $0,    Тр_До____Гр14 = $0,
    Тр_До____Гр15 = $0,    Тр_До____Гр16 = $0,
    Тр_До____Гр17 = $0,    ИА_До____Гр18 = $0,
    ИП_До____Гр19 = $0,    Тр_Свыше_Гр10 = $0,
    Тр_Свыше_Гр11 = $0,    Тр_Свыше_Гр12 = $0,
    Тр_Свыше_Гр13 = $0,    Тр_Свыше_Гр14 = $0,
    Тр_Свыше_Гр15 = $0,    Тр_Свыше_Гр16 = $0,
    Тр_Свыше_Гр17 = $0,    ИА_Свыше_Гр18 = $0,
    ИП_Свыше_Гр19 = $0,    СС_ИТОГО_Гр20 = $0;

var А = TArray;

if( not ПрочитатьЗначенияПеременных(1) )
 exit(1);
end;

if (ДатаОтчета >= Дата1_1660У) 

А( 13 ) = around( Об_ДВ____Гр3_ );
А( 14 ) = around( Об_ДВ____Гр4_ );
А( 15 ) = around( Об_ДВ____Гр5_ );
А( 16 ) = around( Об_ДВ____Гр6_ );

А( 18 ) = around( Об_Срочн_Гр3_ );
А( 19 ) = around( Об_Срочн_Гр4_ );
А( 20 ) = around( Об_Срочн_Гр5_ );
А( 21 ) = around( Об_Срочн_Гр6_ );

А( 27 ) = around( Об_ИТОГО_Гр7_ );
А( 28 ) = around( Тр_До____Гр10 );
А( 29 ) = around( Тр_До____Гр11 );
А( 30 ) = around( Тр_До____Гр12 );
А( 31 ) = around( Тр_До____Гр13 );
А( 32 ) = around( Тр_До____Гр14 );
А( 33 ) = around( Тр_До____Гр15 );
А( 34 ) = around( Тр_До____Гр16 );
А( 35 ) = around( Тр_До____Гр17 );
А( 36 ) = around( ИА_До____Гр18 );
А( 37 ) = around( ИП_До____Гр19 );

А( 39 ) = around( Тр_Свыше_Гр10 );
А( 40 ) = around( Тр_Свыше_Гр11 );
А( 41 ) = around( Тр_Свыше_Гр12 );
А( 42 ) = around( Тр_Свыше_Гр13 );
А( 43 ) = around( Тр_Свыше_Гр14 );
А( 44 ) = around( Тр_Свыше_Гр15 );
А( 45 ) = around( Тр_Свыше_Гр16 );
А( 46 ) = around( Тр_Свыше_Гр17 );
А( 47 ) = around( ИА_Свыше_Гр18 );
А( 48 ) = around( ИП_Свыше_Гр19 );

А( 60 ) = around( СС_ИТОГО_Гр20 );

else

А( 13 ) = around( Атр301_13 );
А( 14 ) = around( Атр301_14 );
А( 15 ) = around( Атр301_15 );
А( 16 ) = around( Атр301_16 );

А( 18 ) = around( Атр301_18 );
А( 19 ) = around( Атр301_19 );
А( 20 ) = around( Атр301_20 );
А( 21 ) = around( Атр301_21 );

А( 27 ) = around( Атр301_27 );
А( 28 ) = around( Атр301_28 );
А( 29 ) = around( Атр301_29 );
А( 30 ) = around( Атр301_30 );
А( 31 ) = around( Атр301_31 );
А( 32 ) = around( Атр301_32 );
А( 33 ) = around( Атр301_33 );
А( 34 ) = around( Атр301_34 );
А( 35 ) = around( Атр301_35 );
А( 36 ) = around( Атр301_36 );
А( 37 ) = around( Атр301_37 );

А( 39 ) = around( Атр301_39 );
А( 40 ) = around( Атр301_40 );
А( 41 ) = around( Атр301_41 );
А( 42 ) = around( Атр301_42 );
А( 43 ) = around( Атр301_43 );
А( 44 ) = around( Атр301_44 );
А( 45 ) = around( Атр301_45 );
А( 46 ) = around( Атр301_46 );
А( 47 ) = around( Атр301_47 );
А( 48 ) = around( Атр301_48 );

А( 60 ) = around( Атр301_60 );
end;

А( 23 ) = А( 13 ) + А( 18 );
А( 24 ) = А( 14 ) + А( 19 );
А( 25 ) = А( 15 ) + А( 20 );
А( 26 ) = А( 16 ) + А( 21 );

А( 50 ) = А( 28 ) + А( 39 );
А( 51 ) = А( 29 ) + А( 40 );
А( 52 ) = А( 30 ) + А( 41 );
А( 53 ) = А( 31 ) + А( 42 );
А( 54 ) = А( 32 ) + А( 43 );
А( 55 ) = А( 33 ) + А( 44 );
А( 56 ) = А( 34 ) + А( 45 );
А( 57 ) = А( 35 ) + А( 46 );
А( 58 ) = А( 36 ) + А( 47 );
А( 59 ) = А( 37 ) + А( 48 );

/* 24.08.2007 Malakhova  */
/*Функция определяет исполнителя в соответствии с ТЗ_Требования к печатным формам.doc:*/
/*ФИО исполнителя из панели задания характеристик формы
По умолчанию - имя пользователя, выпускающего отчет
*/
macro getExecutorName()
    var executorName;

    if (Исполнитель != "")
        executorName = Исполнитель;
    else
        executorName = ИмяОперациониста();
    end;

    return executorName;
end;

  datesplit( GetCorrectPrnRepDate(), day, NULL, NULL);
  ReportDate  = "\"" + string( day ) + "\" " + substr( string( GetCorrectPrnRepDate():m ), 4 );
[                                                                                                                       ];
[                                                                                                 Банковская отчетность ];
[                                     ┌───────────────┬────────────────────────────────────────────────────────────────┐];
[                                     │      Код      │              Код кредитной организации(филиала)                │];
[                                     │   территории  ├─────────┬─────────────────────────┬───────────────┬────────────┤];
[                                     │    по ОКАТО   │ по ОКПО │Основной государственный │Регистрационный│    БИК     │];
[                                     │               │         │  регистрационный номер  │    номер      │            │];
[                                     ├───────────────┼─────────┼─────────────────────────┼───────────────┼────────────┤];
[                                     │       #       │    #    │            #            │       #       │      #     │]( Код_СОАТО:c, Код_ОКПО:c, ОГРН:c, РегНомерБанка:c, {MFO_Bank}:c );
[                                     └───────────────┴─────────┴─────────────────────────┴───────────────┴────────────┘];
[                                                                                                                       ];
[               ОТДЕЛЬНЫЕ ПОКАЗАТЕЛИ, ХАРАКТЕРИЗУЮЩИЕ ДЕЯТЕЛЬНОСТЬ КРЕДИТНОЙ ОРГАНИЗАЦИИ                                ];
[                                     по состоянию на #                                                                 ]( ReportDate );
[                                                                                                                       ];
[#######################################################################################################################]( "Наименование кредитной организации  " + {Name_Bank}:w);
[Почтовый адрес  #                                                                                                      ]( {Post_Addr}:l);
[                                                                                                                       ];
[                                                                                                     Код формы 0409301 ];
[                                                                                                           Пятидневная ];
[                                                                                                             млн. руб. ];
if( not НулеваяФорма( А ))
[┌─────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────┐];
[│Номер│                                      Обязательства кредитных организаций                                      │];
[│ п/п │                                                                                                               │];
[│     ├──────────────┬─────────────────────────────────────┬─────────────────────────────────────┬────────────────────┤];
[│     │              │              в рублях               │        в иностранной валюте         │ Денежные средства  │];
[│     │              │                                     │                                     │                    │];
[│     │              │                                     │                                     │                    │];
[│     │              ├───────────────────┬─────────────────┼───────────────────┬─────────────────┤                    │];
[│     │  по срокам   │перед нефинансовыми│перед физическими│перед нефинансовыми│перед физическими│                    │];
[│     │  размещения  │  организациями    │      лицами     │  организациями    │      лицами     │                    │];
[├─────┼──────────────┼───────────────────┼─────────────────┼───────────────────┼─────────────────┼────────────────────┤];
[│  1  │      2       │         3         │         4       │         5         │         6       │          7         │];
[├─────┼──────────────┼───────────────────┼─────────────────┼───────────────────┼─────────────────┼────────────────────┤];
[│     │      До      │     ##########    │    ##########   │     ##########    │    ##########   │          Х         │
 │     │востребования:│                   │                 │                   │                 │                    │
 ├─────┼──────────────┼───────────────────┼─────────────────┼───────────────────┼─────────────────┼────────────────────┤
 │     │   Срочные:   │     ##########    │    ##########   │     ##########    │    ##########   │          Х         │
 ├─────┼──────────────┼───────────────────┼─────────────────┼───────────────────┼─────────────────┼────────────────────┤
 │     │    ИТОГО     │     ##########    │    ##########   │     ##########    │    ##########   │     ##########     │
 └─────┴──────────────┴───────────────────┴─────────────────┴───────────────────┴─────────────────┴────────────────────┘

]
( CorrectValue( А(13) ), CorrectValue( А(14) ), CorrectValue( А(15) ), CorrectValue( А(16) ), /*CorrectValue( А(17) ),*/
  CorrectValue( А(18) ), CorrectValue( А(19) ), CorrectValue( А(20) ), CorrectValue( А(21) ), /*CorrectValue( А(22) ),*/
  CorrectValue( А(23) ), CorrectValue( А(24) ), CorrectValue( А(25) ), CorrectValue( А(26) ), CorrectValue( А(27) ) );
[
┌─────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬───────────────┬───────────────┬──────────────────┐
│Номер│                                                          Требования кредитных организаций                                                       │  Иностранные  │  Иностранные  │    Собственные   │
│     ├──────────────┬─────────────────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────┤     активы    │    пассивы    │средства кредитной│
│ п/п │              │                             в рублях                            │                    в иностранной валюте                        │               │               │    организации   │
│     │              ├────────────────────────────────────────────────┬────────────────┼────────────────────────────────────────────────┬───────────────┤               │               │    за вычетом    │
│     │              │    к органам государственного управления       │                │      к органам государственного управления     │               │               │               │ вложений в акции │
│     │              │              и внебюджетным фондам             │  нефинансовым  │              и внебюджетным фондам             │ нефинансовым  │               │               │ других кредитных │
│     │              ├───────────────┬────────────────┬───────────────┤ организациям и ├───────────────┬────────────────┬───────────────┤организациям и │               │               │   организаций    │
│     │              │  федеральным  │органам власти  │ внебюджетным  │физическим лицам│ федеральным   │  органам власти│  внебюджетным │   физическим  │               │               │                  │
│     │   по срокам  │    органам    │   субъектов    │    фондам     │                │   органам     │    субъектов   │    фондам     │     лицам     │               │               │                  │
│     │ кредитования │государственной│  Российской    │               │                │государственной│   Российской   │               │               │               │               │                  │
│     │              │     власти    │Федерации и     │               │                │    власти     │  Федерации и   │               │               │               │               │                  │
│     │              │               │органам местного│               │                │               │органам местного│               │               │               │               │                  │
│     │              │               │ самоуправления │               │                │               │ самоуправления │               │               │               │               │                  │
├─────┼──────────────┼───────────────┼────────────────┼───────────────┼────────────────┼───────────────┼────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼──────────────────┤
│  8  │       9      │      10       │       11       │      12       │       13       │      14       │       15       │      16       │      17       │      18       │      19       │        20        │
├─────┼──────────────┼───────────────┼────────────────┼───────────────┼────────────────┼───────────────┼────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼──────────────────┤
│     │  До 1 года:  │   ##########  │   ##########   │   ##########  │   ##########   │   ##########  │   ##########   │   ##########  │   ##########  │   ##########  │   ##########  │         X        │
├─────┼──────────────┼───────────────┼────────────────┼───────────────┼────────────────┼───────────────┼────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼──────────────────┤
│     │ Свыше 1 года:│   ##########  │   ##########   │   ##########  │   ##########   │   ##########  │   ##########   │   ##########  │   ##########  │   ##########  │   ##########  │         X        │
├─────┼──────────────┼───────────────┼────────────────┼───────────────┼────────────────┼───────────────┼────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼──────────────────┤
│     │    ИТОГО     │   ##########  │   ##########   │   ##########  │   ##########   │   ##########  │   ##########   │   ##########  │   ##########  │   ##########  │   ##########  │    ##########    │
└─────┴──────────────┴───────────────┴────────────────┴───────────────┴────────────────┴───────────────┴────────────────┴───────────────┴───────────────┴───────────────┴───────────────┴──────────────────┘
]( CorrectValue( А(28) ), CorrectValue( А(29) ), CorrectValue( А(30) ), CorrectValue( А(31) ), CorrectValue( А(32) ), CorrectValue( А(33) ), CorrectValue( А(34) ), CorrectValue( А(35) ), CorrectValue( А(36) ), CorrectValue( А(37) ),
   CorrectValue( А(39) ), CorrectValue( А(40) ), CorrectValue( А(41) ), CorrectValue( А(42) ), CorrectValue( А(43) ), CorrectValue( А(44) ), CorrectValue( А(45) ), CorrectValue( А(46) ), CorrectValue( А(47) ), CorrectValue( А(48) ),
   CorrectValue( А(50) ), CorrectValue( А(51) ), CorrectValue( А(52) ), CorrectValue( А(53) ), CorrectValue( А(54) ), CorrectValue( А(55) ), CorrectValue( А(56) ), CorrectValue( А(57) ), CorrectValue( А(58) ), CorrectValue( А(59) ), CorrectValue( А(60) ) );
else
[   Данные отсутствуют                                                                   ];
end;
/* 24.08.2007 Malakhova 111239*/
/*Убрала "(Ф.И.О.)"*/
/*Привела подписи в соответствие с ТЗ_Требования к печатным формам.doc*/
[                                                                                        ];
[   #                               ###################################                  ]( {Name_Boss}:l, {FIO_Boss}:l );
[   #                               ###################################                  ]( {Name_Book}:l, {FIO_Book}:l );
[   Исполнитель                     ###################################                  ]( getExecutorName():l );
[   телефон:                        #                                                    ]( ТелефонИсполнителя:l );
[                                                                                        ];
[   ############################                                                         ]( date:m );
[                                                                                        ];

/*═══════════════════════════════╕
│    ЗАВЕРШЕНИЕ ОТЧЕТА
╘═══════════════════════════════*/

/* eof */
