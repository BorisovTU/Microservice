/*
$Name:          CFObjectFactory.mac
$Module:        Регламентируемая отчетность
$Description:   Класс TObjectFactory и его наследники.
*/

/**
 * Класс TObjectFactory и его наследники.
 *
 * @since   09.11.2007
 * @author  Ivkina Olga
 * @version 6.00.004.24
 *
 * Comments:  конструкция TClass() и ей подобные  заменена на GenObject("TClass"),
 *            чтобы избежать ошибок компиляции - "циклический импорт файла N".
 */
import repException;
import rcbconst;
import CFGlobal;
import RcbObjectFactoryBase;
import CFView202;

/**
 * Фабрика объектов.
 * Singleton.
 */
private class (RcbObjectFactoryBase) TObjectFactory()
    /**
     * Создать отчет.
     *
     * @param     okatoCodes коллекция кодов ОКАТО второго раздела
     */
    macro createReport(report : Object, okatoCodes : TArray)
         throw(TPureVirtualMethodCallException("TObjectFactory::createReport"));
    end;

    /**
     * Создать символ.
     *
     * @param     okatoPart  часть отчета по ОКАТО, которой принадлежит символ
     * @param     symbolCode код символа
     */
    macro createSymbol(okatoPart : Object, symbolCode : String)
         throw(TPureVirtualMethodCallException("TObjectFactory::createSymbol"));
    end;

    /**
     * Создать часть отчета по ОКАТО.
     */
    macro createOkatoPart(report : Object, okatoCode : String)
         throw(TPureVirtualMethodCallException("TObjectFactory::createOkatoPart"));
    end;

    /**
     * Создать сервисную часть отчета.
     */
    macro createServicePart(report : Object)
         throw(TPureVirtualMethodCallException("TObjectFactory::createServicePart"));
    end;

    /**
     * Создать объект "Операция расчета".
     */
    macro createCalculationOperation()
         throw(TPureVirtualMethodCallException("TObjectFactory::createCalculationOperation"));
    end;

    /**
     * Создать объект "Операция нормализации".
     */
    macro createNormalizationOperation()
         throw(TPureVirtualMethodCallException("TObjectFactory::createNormalizationOperation"));
    end;

    /**
     * Создать объект "Операция контроля РД".
     */
    macro createCalculatedDataControlOperation()
         throw(TPureVirtualMethodCallException("TObjectFactory::createCalculatedDataControlOperation"));
    end;

    /**
     * Создать операцию печати отчета.
     */
    macro createPrintOperation()
        throw(TPureVirtualMethodCallException("TObjectFactory::createPrintOperation"));
    end;

    /**
     * Создать операцию печати сводного отчета.
     */
    macro createPrintSummaryOperation()
        return GenObject("TPrintSummaryOperation");
    end;

    /**
     * Создать представление отчета по форме 202.
     */
    macro createView202()
        throw(TPureVirtualMethodCallException("TObjectFactory::createView202"));
    end;

    /**
     * Создать представление отчета по форме 744.
     */
    macro createView744()
        throw(TPureVirtualMethodCallException("TObjectFactory::createView744"));
    end;

    /**
     * Создать операцию контроля первичных данных.
     */
    macro createSourceDataControlOperation()
        throw(TPureVirtualMethodCallException("TObjectFactory::createSourceDataControlOperation"));
    end;

    /**
     * Создать операцию контроля первичных данных.
     */
    macro createExportKlikoOperation()
        throw(TPureVirtualMethodCallException("TObjectFactory::createExportKlikoOperation"));
    end;
    /**
     * Создать операцию контроля первичных данных.
     */
    macro createExportPtkPsdOperation()
        throw(TPureVirtualMethodCallException("TObjectFactory::createExportPtkPsdOperation"));
    end;
    /**
     * Создать операцию контроля предыдущего периода.
     */
    macro createCheckPreviousPeriodOperation()
        throw(TPureVirtualMethodCallException("TObjectFactory::createCheckPreviousPeriodOperation"));
    end;

    /**
     * Создать операцию контроля ОКАТО подразделений.
     */
    macro createDepartmentOkatoControlOperation()
        throw(TPureVirtualMethodCallException("TObjectFactory::createDepartmentOkatoControlOperation202"));
    end;

    /**
     * Экспорт в XMl
     */
    macro createXmlExportController()
        return genObject("TObjectFactory::createXmlExportController");
    end;
end;

/**
 * Фабрика объектов для указаний 1881-У.
 */
private class (TObjectFactory) TObjectFactory1881()
    /**
     * Создать отчет.
     *
     * @param     okatoCodes коллекция кодов ОКАТО второго раздела
     */
    macro createReport(report : Object, okatoCodes : TArray)
        return GenObject("TReport", report, okatoCodes);
    end;

    /**
     * Создать символ.
     *
     * @param     okatoPart  часть отчета по ОКАТО, которой принадлежит символ
     * @param     symbolCode код символа
     */
    macro createSymbol(okatoPart : Object, symbolCode : String)
        return GenObject("TSymbol", okatoPart, symbolCode);
    end;

    /**
     * Создать часть отчета по ОКАТО.
     */
    macro createOkatoPart(report, okatoCode : String)
        return GenObject("TOkatoPart1881", report, okatoCode);
    end;

    /**
     * Создать сервисную часть отчета.
     */
    macro createServicePart(report : Object)
        return GenObject("TServicePart1881", report);
    end;

    /**
     * Создать объект "Операция расчета".
     */
    macro createCalculationOperation()
        return GenObject("TCalculationOperation1881");
    end;

    /**
     * Создать объект "Операция нормализации".
     */
    macro createNormalizationOperation()
        return GenObject("TNormalizationOperation1881");
    end;

    /**
     * Создать объект "Операция контроля РД".
     */
    macro createCalculatedDataControlOperation()
        return GenObject("TCalculatedDataControlOperation");
    end;

    /**
     * Создать операцию печати отчета.
     */
    macro createPrintOperation()
        return GenObject("TPrintOperation_b4637");
    end;

    /**
     * Создать представление отчета по форме 202.
     */
    macro createView202()
        return GenObject("TView202");
    end;

    /**
     * Создать представление отчета по форме 744.
     */
    macro createView744()
        return GenObject("TView744");
    end;

    macro createPrintProtocolView(protocolName : String)
        return genObject("TPrintProtocolView", protocolName);
    end;

    /**
     * Создать операцию контроля первичных данных.
     */
    macro createSourceDataControlOperation()
        return GenObject("TSourceDataControlOperation1881");
    end;

    /**
     * Создать операцию контроля первичных данных.
     */
    macro createExportKlikoOperation()
        return GenObject("TExportKlikoOperation");
    end;
    /**
     * Создать операцию контроля первичных данных.
     */
    macro createExportPtkPsdOperation()
        return GenObject("TExportPtkPsdOperation");
    end;
    /**
     * Создать операцию контроля предыдущего периода.
     */
    macro createCheckPreviousPeriodOperation()
        return GenObject("TCheckPreviousPeriodOperation");
    end;

    macro createKlikoView(fileExtension : String, reportDate : Date)
        return genObject("TRcbKlikoViewCash", fileExtension, reportDate);
    end;

    macro createDepartmentOkatoControlOperation202()
        return GenObject("TDepartmentOkatoControlOperation202");
    end;
end;

/**
 * Фабрика объектов для указаний 2332-У.
 */
private class (TObjectFactory1881) TObjectFactory2332()
    initTObjectFactory1881();
    /**
     * Создать часть отчета по ОКАТО.
     */
    macro createOkatoPart(report, okatoCode : String)
        return GenObject("TOkatoPart2332", report, okatoCode);
    end;

    /**
     * Создать объект "Операция расчета".
     */
    macro createCalculationOperation()
        return GenObject("TCalculationOperation2332");
    end;

    /**
     * Создать операцию контроля первичных данных.
     */
    macro createSourceDataControlOperation()
        return GenObject("TSourceDataControlOperation2332");
    end;

    /**
     * Создать объект "Операция нормализации".
     */
    macro createNormalizationOperation()
        return GenObject("TNormalizationOperation2332");
    end;
    /**
     * Создать представление отчета по форме 202.
     */
    macro createView202()
        return GenObject("TView2022332");
    end;

    /**
     * Создать представление отчета по форме 744.
     */
    macro createView744()
        return GenObject("TView7442332");
    end;

    macro createKlikoView(fileExtension : String, reportDate : Date)
        return genObject("TRcbKlikoViewCash2332", fileExtension, reportDate);
    end;

    macro createExportKlikoOperation()
        return GenObject("TExportKlikoOperation_2332");
    end;

    /**
     * Создать операцию экспорта в ПТК ПСД.
     */
    macro createExportPtkPsdOperation()
        return GenObject("TExportPtkPsdOperation_2332");
    end;

    /**
     * Создать объект "Операция контроля РД".
     */
    macro createCalculatedDataControlOperation()
        return GenObject("TCalculatedDataControlOperation2332");
    end;

    macro createDepartmentOkatoControlOperation202()
        return GenObject("TDepartmentOkatoControlOperation202_2332");
    end;

end;

/**
 * Фабрика объектов для указаний 2539-У.
 */
private class (TObjectFactory2332) TObjectFactory2539()
    initTObjectFactory2332();


    /**
     * Создать объект "Операция контроля РД".
     */
    macro createCalculatedDataControlOperation()
        return GenObject("TCalculatedDataControlOperation2539");
    end;

   /**
     * Создать операцию контроля первичных данных.
     */
    macro createSourceDataControlOperation()
        return GenObject("TSourceDataControlOperation2539");
    end;

    /**
     * Создать объект "Операция нормализации".
     */
    macro createNormalizationOperation()
        return GenObject("TNormalizationOperation2539");
    end;
  end;


/**
 * Фабрика объектов для указаний 2627-У.
 */
private class (TObjectFactory2539) TObjectFactory2627()
    initTObjectFactory2539();
    /**
     * Создать часть отчета по ОКАТО.
     */
    macro createOkatoPart(report, okatoCode : String)
        return GenObject("TOkatoPart2627", report, okatoCode);
    end;

    /**
     * Создать объект "Операция расчета".
     */
    macro createCalculationOperation()
        return GenObject("TCalculationOperation2627");
    end;

    /**
     * Создать операцию контроля первичных данных.
     */
    macro createSourceDataControlOperation()
        return GenObject("TSourceDataControlOperation2627");
    end;

    /**
     * Создать объект "Операция нормализации".
     */
    macro createNormalizationOperation()
        return GenObject("TNormalizationOperation2627");
    end;
    /**
     * Создать представление отчета по форме 202.
     */
    macro createView202()
        return GenObject("TView2022627");
    end;

    /**
     * Создать представление отчета по форме 744.
     */
    macro createView744()
        return GenObject("TView7442627");
    end;

    macro createKlikoView(fileExtension : String, reportDate : Date)
        return genObject("TRcbKlikoViewCash2627", fileExtension, reportDate);
    end;

    macro createExportPtkPsdOperation()
        return GenObject("TExportPtkPsdOperation_2627");
    end;

    /**
     * Создать объект "Операция контроля РД".
     */
    macro createCalculatedDataControlOperation()
        return GenObject("TCalculatedDataControlOperation2627");
    end;
end;

/**
 * Фабрика объектов для указаний 2742-У.
 */
private class (TObjectFactory2627) TObjectFactory2742()
    initTObjectFactory2627();
    /**
     * Создать представление отчета по форме 202.
     */
    macro createView202()
        return GenObject("TView2022742");
    end;
end;

/**
 * Фабрика объектов для указаний 2835-У.
 */
private class (TObjectFactory2742) TObjectFactory2835()
    initTObjectFactory2742();
    /**
     * Создать операцию контроля первичных данных.
     */
    macro createSourceDataControlOperation()
        return GenObject("TSourceDataControlOperation2835");
    end;
    /**
     * Создать объект "Операция контроля РД".
     */
    macro createCalculatedDataControlOperation()
        return GenObject("TCalculatedDataControlOperation2835");
    end;
end;

/**
 * Фабрика объектов для указаний 3129-У.
 */
private class (TObjectFactory2835) TObjectFactory3129()
    initTObjectFactory2835();
    /**
     * Создать представление отчета по форме 202.
     */
    macro createView202()
        return GenObject("TView2023129");
    end;

    /**
     * Создать представление отчета по форме 744.
     */
    macro createView744()
        return GenObject("TView7443129");
    end;
end;

/**
 * Фабрика объектов для указаний 3656-У.
 */
private class (TObjectFactory3129) TObjectFactory3656()
    initTObjectFactory3129();
    /**
     * Метод используется при создании RcbReportView
     * Данный класс генериться именно таким образом, т.к. требует инкапсуляции представления
     * шапок(подвалов) печатных форм отчета в RcbReportView
     */
    macro createPrintableView(formName : String, formOkudCode : String, formPeriodicity, periodFormat : Integer)
        return genObject("TF202PrintableView", formName, formOkudCode, formPeriodicity, periodFormat);
    end;
end;

private class (TObjectFactory3656) TObjectFactory4212()
    initTObjectFactory3656();

    macro createPrintableView(formName : String, formOkudCode : String, formPeriodicity, periodFormat : Integer)
        return genObject("TPrintableView_4212", formName, formOkudCode, formPeriodicity, periodFormat);
    end;

    macro createView202()
        return GenObject("TView202_4212");
    end;
end;

private class (TObjectFactory4212) TObjectFactory4637()
    initTObjectFactory4212();

    /**
     * Создать часть отчета по ОКАТО.
     */
    macro createOkatoPart(report, okatoCode : String)
        return GenObject("TOkatoPart4637", report, okatoCode);
    end;

    /**
     * Создать объект "Операция расчета".
     */
    macro createCalculationOperation()
        return GenObject("TCalculationOperation4637");
    end;

    macro createPrintOperation()
        return GenObject("TPrintOperation4637");
    end;

    /**
     * Создать операцию печати отчета.
     */
    macro createPrintSummaryOperation()
        return GenObject("TPrintSummaryOperation4637");
    end;

    /**
     * Создать операцию контроля первичных данных.
     */
    macro createSourceDataControlOperation()
        return GenObject("TSourceDataControlOperation4637");
    end;

    macro createExportKlikoOperation()
        return GenObject("TExportKlikoOperation_4637");
    end;

    macro createExportPtkPsdOperation()
        return GenObject("TExportPtkPsdOperation_4637");
    end;

    macro createPrintableView(formName : String, formOkudCode : String, formPeriodicity, periodFormat : Integer)
        return genObject("TPrintableView_4212", formName, formOkudCode, formPeriodicity, periodFormat);
    end;

    macro createView202()
        return GenObject("TView202_4637");
    end;

    macro createView744()
        return GenObject("TView744_4637");
    end;

    macro createKlikoView(fileExtension : String, reportDate : Date)
        return genObject("TRcbKlikoViewCash4637", fileExtension, reportDate);
    end;
end;

private class (TObjectFactory4637) TObjectFactory_Т1_77_01_01()
    initTObjectFactory4637();

    /**
     * Экспорт в XML
     */
    macro createXmlExportController(periodicity: integer)
        return genObject("TExportXmlController_Т1_77_01_01", periodicity);
    end;
end;

/**
 * Создание фабрики
 */
if (objectFactoryInstance == null)
    /*создание конкретной фабрики в зависимости от даты указания*/
    if   (globalInstance().getRcbReport().context.period.endDate >= RCB_Т1_77_01_01)
        objectFactoryInstance = TObjectFactory_Т1_77_01_01();
    elif   (globalInstance().getRcbReport().context.period.endDate >= RCB_I4637_DATE)
        objectFactoryInstance = TObjectFactory4637();
    elif (globalInstance().getRcbReport().context.period.endDate >= RCB_I4212_DATE)
        objectFactoryInstance = TObjectFactory4212();
    elif (globalInstance().getRcbReport().context.period.endDate >= RCB_I3656_DATE)
        objectFactoryInstance = TObjectFactory3656();
    elif (globalInstance().getRcbReport().context.period.endDate >= RCB_I3129_DATE)
        objectFactoryInstance = TObjectFactory3129();
    elif (globalInstance().getRcbReport().context.period.endDate >= RCB_I2835_DATE)
        objectFactoryInstance = TObjectFactory2835();
    elif (globalInstance().getRcbReport().context.period.endDate >= RCB_I2742_DATE)
        objectFactoryInstance = TObjectFactory2742();
    elif (globalInstance().getRcbReport().context.period.endDate >= RCB_I2627_DATE2)
        objectFactoryInstance = TObjectFactory2627();
    elif (globalInstance().getRcbReport().context.period.endDate >= RCB_I2539_DATE)
        objectFactoryInstance = TObjectFactory2539();
    elif (globalInstance().getRcbReport().context.period.endDate >= RCB_I2332_DATE)
        objectFactoryInstance = TObjectFactory2332();
    else
        objectFactoryInstance = TObjectFactory1881();
    end;
end;
