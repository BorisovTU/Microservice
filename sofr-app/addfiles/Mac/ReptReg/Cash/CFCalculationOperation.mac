/*
$Name:          CFCalculationOperation.mac
$Module:        Регламентируемая отчетность
$Description:   Операция расчета
*/

/**
 * Класс TCalculationOperation и его наследники.
 *
 * @since   09.11.2007
 * @author  Ivkina Olga
 * @version 6.00.004.24
 */
import repException;

import CFDataBank;
import CFPrintProtocolOperation;
import CFOkatoPart;
import CFReport;
import CFTuneTable;

/**
 * Операция расчета.
 */
class TCalculationOperation()

    /**
     * Банк данных.
     */
    var m_dataBank : TDataBank;

    /**
     * Настроечная таблица.
     */
     var m_tuneTable : TuneTable;

    /**
     * Конструктор.
     */
    private macro constructorTCalculationOperation()
        m_dataBank  = NULL;
        m_tuneTable = NULL;
    end;

    /**
     * Получить ссылку на банк данных.
     */
    private macro getDataBank()
         throw(TPureVirtualMethodCallException("TCalculationOperation::getDataBank"));
    end;

    /**
     * Получить маску б/с для расчета символов по документам.
     */
    private macro getBalanceMask()
        throw(TPureVirtualMethodCallException("TCalculationOperation::getBalanceMask"));
    end;

    /**
     * Создать объект операции печати протокола.
     */
    private macro createPrintProtocolOperation()
        throw(TPureVirtualMethodCallException("TCalculationOperation::createPrintProtocolOperation"));
    end;

    /**
     * Создать предствавление протокола расчета.
     */
    private macro createCalculationProtocolView()
        throw(TPureVirtualMethodCallException("TCalculationOperation::createCalculationProtocolView"));
    end;

    /**
     * Рассчитать символы по документам.
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     * @param     dataBank   банк данных
     */
    private macro calculateDocumentSymbols(okatoPart : TOkatoPart, dataBank : TDataBank)
        throw(TPureVirtualMethodCallException("TCalculationOperation::calculateDocumentSymbols"));
    end;

    /**
     * Рассчитать символы по остаткам.
     *
     * @param     dataBank   банк данных
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateRestSymbols(okatoPart : TOkatoPart, dataBank : TDataBank)
        throw(TPureVirtualMethodCallException("TCalculationOperation::calculateRestSymbols"));
    end;

    /**
     * Рассчитать значение символа по оборотам.
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     * @param     dataBank   банк данных
     */
    private macro calculateTurnSymbols(okatoPart : TOkatoPart, dataBank : TDataBank)
         throw(TPureVirtualMethodCallException("TCalculationOperation::calculateTurnSymbols"));
    end;

    /**
     * Рассчитать символ "Итого по доходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateReceiptTotalSymbol(okatoPart : TOkatoPart)
         throw(TPureVirtualMethodCallException("TCalculationOperation::calculateReceiptTotalSymbol"));
    end;

    /**
     * Рассчитать символ "Баланс по доходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateReceiptBalanceSymbol(okatoPart : TOkatoPart)
         throw(TPureVirtualMethodCallException("TCalculationOperation::calculateReceiptBalanceSymbol"));
    end;

    /**
     * Рассчитать символ "Итого по расходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateExpeditureTotalSymbol(okatoPart : TOkatoPart)
         throw(TPureVirtualMethodCallException("TCalculationOperation::calculateExpeditureTotalSymbol"));
    end;

    /**
     * Рассчитать символ "Баланс по расходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateExpeditureBalanceSymbol(okatoPart : TOkatoPart)
         throw(TPureVirtualMethodCallException("TCalculationOperation::calculateExpeditureBalanceSymbol"));
    end;

    /**
     * Рассчитать сервисную часть отчета.
     *
     * @param     dataBank   банк данных
     * @param     okatoPart  часть отчета для расчета
     */
    private macro calculateServicePart(okatoPart : TOkatoPart, dataBank : TDataBank)
         throw(TPureVirtualMethodCallException("TCalculationOperation::calculateServicePart"));
    end;

    /**
     * Рассчитать часть отчета по ОКАТО.
     *
     * @param     dataBank   банк данных
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateOkatoPart(okatoPart : TOkatoPart, dataBank : TDataBank)

        calculateDocumentSymbols(okatoPart, dataBank);
        calculateRestSymbols(okatoPart, dataBank);
        calculateTurnSymbols(okatoPart, dataBank);

        calculateReceiptTotalSymbol(okatoPart);
        calculateReceiptBalanceSymbol(okatoPart);
        calculateExpeditureTotalSymbol(okatoPart);
        calculateExpeditureBalanceSymbol(okatoPart);

    end;

    /**
     * Выполнить расчет.
     */
    macro execute()

        var dataBank : TDataBank;     /*банк данных*/
        var balanceMask : String;     /*маска балансовых*/
        var okatoCodes : TArray;      /*массив кодов ОКАТО*/
        var report : TReport;         /*кассовый отчет*/
        var symbol : TSymbol;         /*символ*/
        var totalPart : TOkatoPart;   /*итоговая часть отчета*/
        var okatoPart : TArray;       /*коллекцию частей отчета по ОКАТО второго раздела*/
        var okatoPartSize : Integer;  /*кол-во частей отчета по ОКАТО второго раздела*/
        var i = 0;

        BegAction(100, "Идет расчет...", false);
        dataBank = getDataBank();
        dataBank.clear();

        balanceMask = getBalanceMask();
        dataBank.cache(balanceMask, m_tuneTable.getMainAccountMasks("80,81"));

        okatoCodes = dataBank.getSortedOkatoCodes();

        report = objectFactoryInstance().createReport(rcbApplication.currentReport, okatoCodes);

        totalPart = report.getTotalPart();

        calculateOkatoPart(totalPart, dataBank);

        okatoPart = report.getOutsideDomainOkatoParts();
        okatoPartSize = okatoPart.size;

        while (i < okatoPartSize)
            calculateOkatoPart(okatoPart(i), m_dataBank);

            if (okatoPart(i).isZeroSymbols())
                okatoPart(i).delete();
            end;

            i = i + 1;
        end;

        calculateServicePart(report.getServicePart(), dataBank);

        rcbApplication().transactionManager.commit();

        endAction(100);

        var printProtocolOperation  = createPrintProtocolOperation();
        var calculationProtocolView = createCalculationProtocolView();

        printProtocolOperation.execute(calculationProtocolView, dataBank, balanceMask);

    end;
end;

/**
 * Операция расчета по 1881-У.
 */
class (TCalculationOperation) TCalculationOperation1881()
    /**
     * Конструктор.
     */
    private macro constructorTCalculationOperation1881()
        initTCalculationOperation();
         m_tuneTable = TTuneTable1881();
    end;

    /**
     * Получить ссылку на банк данных.
     */
    private macro getDataBank()
        if (m_dataBank == null)
            m_dataBank = TDataBank1881();
        end;
        return m_dataBank;
    end;

    /**
     * Получить маску б/с для расчета символов по документам.
     */
    private macro getBalanceMask()
        return m_tuneTable.getMainAccountMasks("02-77,89-98");/*"20202*, 20206*, 20207*"*/
    end;

    /**
     * Создать объект операции печати протокола.
     */
    private macro createPrintProtocolOperation()
        return TPrintProtocolOperation1881();
    end;

    /**
     * Создать представление протокола расчета.
     */
    private macro createCalculationProtocolView()
        return TCalculationProtocolView1881();
    end;


    /**
     * Рассчитать символы по документам.
     *
     * @param     okatoPart
     * @param     dataBank
     */
    private macro calculateDocumentSymbols(okatoPart : TOkatoPart, dataBank : TDataBank)
        /*02-32, 33, 37, 39, 40-62, 72, 75, 77, 89, 96, 97, 98.*/
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("02"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("03"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("11"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("12"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("13"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("14"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("15"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("16"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("17"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("19"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("20"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("21"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("22"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("23"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("30"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("31"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("32"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("33"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("37"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("39"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("40"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("41"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("42"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("46"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("47"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("50"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("51"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("53"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("54"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("55"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("56"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("57"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("58"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("59"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("60"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("61"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("62"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("72"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("75"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("77"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("89"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("96"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("97"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("98"));
    end;


    /**
     * Рассчитать символы по остаткам.
     *
     * @param     dataBank   банк данных
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateRestSymbols(okatoPart : TOkatoPart, dataBank : TDataBank)
        /*Вычислить значение остатков на балансовых счетах, заданных маской:"20202*, 20206*, 20207*"
        для следующих символов:35 - на дату начала периода,70 - за дату конца периода.*/
        dataBank.calculateRestSymbol(okatoPart.getSymbol("35"), getBalanceMask(), globalInstance().getRcbReport().context.period.beginDate - 1);
        dataBank.calculateRestSymbol(okatoPart.getSymbol("70"), getBalanceMask(), globalInstance().getRcbReport().context.period.endDate);
    end;

    /**
     * Рассчитать значение символа по оборотам.
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     * @param     dataBank   банк данных
     */
    private macro calculateTurnSymbols(okatoPart : TOkatoPart, dataBank : TDataBank)
        /*Вычислить значение оборотов по балансовым счетам для символов:
        80: маска дебета "20208*", маска кредита "!202*"
        81: маска дебета "!202*", маска кредита "20208*"*/
        var mainAccountMasks = m_tuneTable.getMainAccountMasks("80,81");
        var corrAccountMasks = m_tuneTable.getCorrAccountMasks("80,81");

        dataBank.calculateTurnSymbol(okatoPart.getSymbol("80"), mainAccountMasks, corrAccountMasks, true);
        dataBank.calculateTurnSymbol(okatoPart.getSymbol("81"), corrAccountMasks, mainAccountMasks, false);
    end;

    /**
     * Рассчитать символ "Итого по доходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateReceiptTotalSymbol(okatoPart : TOkatoPart)
        /*Вычислить значение символа "02-32" как сумму символов, заданных диапазоном 02-32.*/
        okatoPart.getSymbol("02-32").getValue().exact = okatoPart.getSymbol("02").getValue().exact
                                            + okatoPart.getSymbol("03").getValue().exact
                                            + okatoPart.getSymbol("11").getValue().exact
                                            + okatoPart.getSymbol("12").getValue().exact
                                            + okatoPart.getSymbol("13").getValue().exact
                                            + okatoPart.getSymbol("14").getValue().exact
                                            + okatoPart.getSymbol("15").getValue().exact
                                            + okatoPart.getSymbol("16").getValue().exact
                                            + okatoPart.getSymbol("17").getValue().exact
                                            + okatoPart.getSymbol("19").getValue().exact
                                            + okatoPart.getSymbol("20").getValue().exact
                                            + okatoPart.getSymbol("21").getValue().exact
                                            + okatoPart.getSymbol("22").getValue().exact
                                            + okatoPart.getSymbol("23").getValue().exact
                                            + okatoPart.getSymbol("30").getValue().exact
                                            + okatoPart.getSymbol("31").getValue().exact
                                            + okatoPart.getSymbol("32").getValue().exact;
    end;

    /**
     * Рассчитать символ "Баланс по доходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateReceiptBalanceSymbol(okatoPart : TOkatoPart)
        okatoPart.getSymbol("02-39").getValue().exact = okatoPart.getSymbol("02-32").getValue().exact
                                              + okatoPart.getSymbol("33").getValue().exact
                                              + okatoPart.getSymbol("35").getValue().exact
                                              + okatoPart.getSymbol("37").getValue().exact
                                              + okatoPart.getSymbol("39").getValue().exact;
    end;

    /**
     * Рассчитать символ "Итого по расходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateExpeditureTotalSymbol(okatoPart : TOkatoPart)
        okatoPart.getSymbol("40-62").getValue().exact = okatoPart.getSymbol("40").getValue().exact
                                              + okatoPart.getSymbol("41").getValue().exact
                                              + okatoPart.getSymbol("42").getValue().exact
                                              + okatoPart.getSymbol("46").getValue().exact
                                              + okatoPart.getSymbol("47").getValue().exact
                                              + okatoPart.getSymbol("50").getValue().exact
                                              + okatoPart.getSymbol("51").getValue().exact
                                              + okatoPart.getSymbol("53").getValue().exact
                                              + okatoPart.getSymbol("54").getValue().exact
                                              + okatoPart.getSymbol("55").getValue().exact
                                              + okatoPart.getSymbol("56").getValue().exact
                                              + okatoPart.getSymbol("57").getValue().exact
                                              + okatoPart.getSymbol("58").getValue().exact
                                              + okatoPart.getSymbol("59").getValue().exact
                                              + okatoPart.getSymbol("60").getValue().exact
                                              + okatoPart.getSymbol("61").getValue().exact
                                              + okatoPart.getSymbol("62").getValue().exact;
    end;

    /**
     * Рассчитать символ "Баланс по расходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateExpeditureBalanceSymbol(okatoPart : TOkatoPart)
        /*Вычислить значение символа 40-77 как сумму следующих символов: 40-62, 70, 72, 75, 77.*/
        okatoPart.getSymbol("40-77").getValue().exact = okatoPart.getSymbol("40-62").getValue().exact
                                              + okatoPart.getSymbol("70").getValue().exact
                                              + okatoPart.getSymbol("72").getValue().exact
                                              + okatoPart.getSymbol("75").getValue().exact
                                              + okatoPart.getSymbol("77").getValue().exact;
    end;

    /**
     * Рассчитать сервисную часть отчета.
     *
     * @param     dataBank   банк данных
     * @param     okatoPart  часть отчета для расчета
     */
    private macro calculateServicePart(okatoPart : TOkatoPart, dataBank : TDataBank)
        okatoPart.getSymbol("ОбДт").getValue().exact = dataBank.calculateDebetTurns(getBalanceMask());
        okatoPart.getSymbol("ОбКт").getValue().exact = dataBank.calculateCreditTurns(getBalanceMask());

        okatoPart.getSymbol("ОбДт").getValue().recalculateScaled();
        okatoPart.getSymbol("ОбКт").getValue().recalculateScaled();

        dataBank.calculateNullSymbols(okatoPart.getSymbol("БсПр"), okatoPart.getSymbol("БсРс"), getBalanceMask());
    end;

    constructorTCalculationOperation1881();
end;

/**
 * Операция расчета по ХХХХ-У.
 *
 * отличия от 1881У:
 *                  удален   символ  03
 *                  добавлен символ  99
 *                  добавлен символ 100
 */
class (TCalculationOperation1881) TCalculationOperation2332()
    /**
     * Конструктор.
     */
    private macro constructorTCalculationOperation2332()
        initTCalculationOperation1881();
    end;

    /**
     * Создать представление протокола расчета.
     */
    private macro createCalculationProtocolView()
        return TCalculationProtocolView_2332();
    end;

    /**
     * Получить маску б/с для расчета символов по документам.
     */
    private macro getBalanceMask()
        return m_tuneTable.getMainAccountMasks("02-77,89-100");/*"20202*, 20206*, 20207*"*/
    end;

    /**
     * Рассчитать символы по документам.
     *
     * @param     okatoPart
     * @param     dataBank
     */
    private macro calculateDocumentSymbols(okatoPart : TOkatoPart, dataBank : TDataBank)
        /*02-32, 33, 37, 39, 40-62, 72, 75, 77, 89, 96, 97, 98, 99, 100*/
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("02"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("11"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("12"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("13"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("14"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("15"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("16"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("17"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("19"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("20"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("21"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("22"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("23"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("30"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("31"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("32"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("33"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("37"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("39"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("40"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("41"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("42"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("46"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("47"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("50"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("51"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("53"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("54"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("55"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("56"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("57"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("58"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("59"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("60"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("61"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("62"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("72"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("75"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("77"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("89"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("96"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("97"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("98"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("99"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("100"));
    end;


    /**
     * Рассчитать символ "Итого по доходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateReceiptTotalSymbol(okatoPart : TOkatoPart)
        /*Вычислить значение символа "02-32" как сумму символов, заданных диапазоном 02-32.*/
        okatoPart.getSymbol("02-32").getValue().exact = okatoPart.getSymbol("02").getValue().exact
                                            + okatoPart.getSymbol("11").getValue().exact
                                            + okatoPart.getSymbol("12").getValue().exact
                                            + okatoPart.getSymbol("13").getValue().exact
                                            + okatoPart.getSymbol("14").getValue().exact
                                            + okatoPart.getSymbol("15").getValue().exact
                                            + okatoPart.getSymbol("16").getValue().exact
                                            + okatoPart.getSymbol("17").getValue().exact
                                            + okatoPart.getSymbol("19").getValue().exact
                                            + okatoPart.getSymbol("20").getValue().exact
                                            + okatoPart.getSymbol("21").getValue().exact
                                            + okatoPart.getSymbol("22").getValue().exact
                                            + okatoPart.getSymbol("23").getValue().exact
                                            + okatoPart.getSymbol("30").getValue().exact
                                            + okatoPart.getSymbol("31").getValue().exact
                                            + okatoPart.getSymbol("32").getValue().exact;
    end;

    constructorTCalculationOperation2332();
end;


/**
 * Операция расчета по 2627-У.
 *
 * отличия от 2332У:
 *                  удален   символ  23
 *                  удален   символ  62
 *                  добавлен символ  82
 *                  добавлен символ  83
 *                  добавлен символ  85
 *                  добавлен символ  86
 *                  добавлен символ  87
 *                  добавлен символ  88
 */
class (TCalculationOperation2332) TCalculationOperation2627()
    /**
     * Конструктор.
     */
    private macro constructorTCalculationOperation2627()
        initTCalculationOperation2332();
    end;

    /**
     * Получить ссылку на банк данных.
     */
    private macro getDataBank()
        if (m_dataBank == null)
            m_dataBank = TDataBank2627();
        end;
        return m_dataBank;
    end;

    /**
     * Получить маску б/с для расчета символов по документам.
     */
    private macro getBalanceMask()
        return m_tuneTable.getMainAccountMasks("02-77,82-100");
    end;

    /**
     * Рассчитать символы по документам.
     *
     * @param     okatoPart
     * @param     dataBank
     */
    private macro calculateDocumentSymbols(okatoPart : TOkatoPart, dataBank : TDataBank)
        /*02-32, 33, 37, 39, 40-61, 72, 75, 77,82,83,85,86,87,88, 89, 96, 97, 98, 99, 100*/
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("02"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("11"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("12"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("13"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("14"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("15"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("16"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("17"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("19"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("20"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("21"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("22"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("30"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("31"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("32"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("33"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("37"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("39"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("40"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("41"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("42"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("46"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("47"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("50"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("51"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("53"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("54"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("55"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("56"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("57"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("58"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("59"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("60"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("61"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("72"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("75"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("77"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("82"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("83"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("85"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("86"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("87"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("88"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("89"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("96"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("97"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("98"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("99"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("100"));
    end;


    /**
     * Рассчитать символ "Итого по доходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateReceiptTotalSymbol(okatoPart : TOkatoPart)
        /*Вычислить значение символа "02-32" как сумму символов, заданных диапазоном 02-32.*/
        okatoPart.getSymbol("02-32").getValue().exact = okatoPart.getSymbol("02").getValue().exact
                                            + okatoPart.getSymbol("11").getValue().exact
                                            + okatoPart.getSymbol("12").getValue().exact
                                            + okatoPart.getSymbol("13").getValue().exact
                                            + okatoPart.getSymbol("14").getValue().exact
                                            + okatoPart.getSymbol("15").getValue().exact
                                            + okatoPart.getSymbol("16").getValue().exact
                                            + okatoPart.getSymbol("17").getValue().exact
                                            + okatoPart.getSymbol("19").getValue().exact
                                            + okatoPart.getSymbol("20").getValue().exact
                                            + okatoPart.getSymbol("21").getValue().exact
                                            + okatoPart.getSymbol("22").getValue().exact
                                            + okatoPart.getSymbol("30").getValue().exact
                                            + okatoPart.getSymbol("31").getValue().exact
                                            + okatoPart.getSymbol("32").getValue().exact;
    end;

    /**
     * Рассчитать символ "Итого по расходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateExpeditureTotalSymbol(okatoPart : TOkatoPart)
        okatoPart.getSymbol("40-61").getValue().exact = okatoPart.getSymbol("40").getValue().exact
                                              + okatoPart.getSymbol("41").getValue().exact
                                              + okatoPart.getSymbol("42").getValue().exact
                                              + okatoPart.getSymbol("46").getValue().exact
                                              + okatoPart.getSymbol("47").getValue().exact
                                              + okatoPart.getSymbol("50").getValue().exact
                                              + okatoPart.getSymbol("51").getValue().exact
                                              + okatoPart.getSymbol("53").getValue().exact
                                              + okatoPart.getSymbol("54").getValue().exact
                                              + okatoPart.getSymbol("55").getValue().exact
                                              + okatoPart.getSymbol("56").getValue().exact
                                              + okatoPart.getSymbol("57").getValue().exact
                                              + okatoPart.getSymbol("58").getValue().exact
                                              + okatoPart.getSymbol("59").getValue().exact
                                              + okatoPart.getSymbol("60").getValue().exact
                                              + okatoPart.getSymbol("61").getValue().exact;
    end;

    /**
     * Рассчитать символ "Баланс по расходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateExpeditureBalanceSymbol(okatoPart : TOkatoPart)
        /*Вычислить значение символа 40-77 как сумму следующих символов: 40-61, 70, 72, 75, 77.*/
        okatoPart.getSymbol("40-77").getValue().exact = okatoPart.getSymbol("40-61").getValue().exact
                                              + okatoPart.getSymbol("70").getValue().exact
                                              + okatoPart.getSymbol("72").getValue().exact
                                              + okatoPart.getSymbol("75").getValue().exact
                                              + okatoPart.getSymbol("77").getValue().exact;
    end;


    constructorTCalculationOperation2627();
end;

/**
 * Операция расчета по 4637-У.
 */
class (TCalculationOperation2627) TCalculationOperation4637()
    /**
     * Конструктор.
     */
    private macro constructorTCalculationOperation4637()
        initTCalculationOperation2627();
    end;

    /**
     * Получить ссылку на банк данных.
     */
    private macro getDataBank()
        if (m_dataBank == null)
            m_dataBank = TDataBank4637();
        end;
        return m_dataBank;
    end;

    /**
     * Получить маску б/с для расчета символов по документам.
     */
    private macro getBalanceMask()
        return m_tuneTable.getMainAccountMasks("02-77,82-102");
    end;

    /**
     * Рассчитать символы по документам.
     *
     * @param     okatoPart
     * @param     dataBank
     */
    private macro calculateDocumentSymbols(okatoPart : TOkatoPart, dataBank : TDataBank)
        /*02-32, 33, 37, 39, 40-61, 72, 75, 77,82,83,85,86,87,88, 89, 96, 97, 98, 99, 100, 101, 102*/
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("02"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("11"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("12"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("13"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("14"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("15"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("16"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("17"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("19"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("20"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("21"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("22"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("30"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("31"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("32"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("33"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("37"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("39"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("40"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("41"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("42"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("46"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("47"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("50"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("51"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("53"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("54"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("55"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("56"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("57"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("58"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("59"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("60"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("61"));

        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("72"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("75"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("77"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("82"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("83"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("85"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("86"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("87"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("88"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("89"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("96"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("97"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("98"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("99"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("100"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("101"));
        dataBank.calculateDocumentSymbol(okatoPart.getSymbol("102"));
    end;


    /**
     * Рассчитать символ "Итого по доходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateReceiptTotalSymbol(okatoPart : TOkatoPart)
        /*Вычислить значение символа "02-32" как сумму символов, заданных диапазоном 02-32.*/
        okatoPart.getSymbol("02-32").getValue().exact = okatoPart.getSymbol("02").getValue().exact
                                            + okatoPart.getSymbol("11").getValue().exact
                                            + okatoPart.getSymbol("12").getValue().exact
                                            + okatoPart.getSymbol("13").getValue().exact
                                            + okatoPart.getSymbol("14").getValue().exact
                                            + okatoPart.getSymbol("15").getValue().exact
                                            + okatoPart.getSymbol("16").getValue().exact
                                            + okatoPart.getSymbol("17").getValue().exact
                                            + okatoPart.getSymbol("19").getValue().exact
                                            + okatoPart.getSymbol("20").getValue().exact
                                            + okatoPart.getSymbol("21").getValue().exact
                                            + okatoPart.getSymbol("22").getValue().exact
                                            + okatoPart.getSymbol("30").getValue().exact
                                            + okatoPart.getSymbol("31").getValue().exact
                                            + okatoPart.getSymbol("32").getValue().exact;
    end;

    /**
     * Рассчитать символ "Итого по расходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateExpeditureTotalSymbol(okatoPart : TOkatoPart)
        okatoPart.getSymbol("40-61").getValue().exact = okatoPart.getSymbol("40").getValue().exact
                                              + okatoPart.getSymbol("41").getValue().exact
                                              + okatoPart.getSymbol("42").getValue().exact
                                              + okatoPart.getSymbol("46").getValue().exact
                                              + okatoPart.getSymbol("47").getValue().exact
                                              + okatoPart.getSymbol("50").getValue().exact
                                              + okatoPart.getSymbol("51").getValue().exact
                                              + okatoPart.getSymbol("53").getValue().exact
                                              + okatoPart.getSymbol("54").getValue().exact
                                              + okatoPart.getSymbol("55").getValue().exact
                                              + okatoPart.getSymbol("56").getValue().exact
                                              + okatoPart.getSymbol("57").getValue().exact
                                              + okatoPart.getSymbol("58").getValue().exact
                                              + okatoPart.getSymbol("59").getValue().exact
                                              + okatoPart.getSymbol("60").getValue().exact
                                              + okatoPart.getSymbol("61").getValue().exact;
    end;

    /**
     * Рассчитать символ "Баланс по расходу".
     *
     * @param     okatoPart  часть отчета по ОКАТО для расчета
     */
    private macro calculateExpeditureBalanceSymbol(okatoPart : TOkatoPart)
        /*Вычислить значение символа 40-77 как сумму следующих символов: 40-61, 70, 72, 75, 77.*/
        okatoPart.getSymbol("40-77").getValue().exact = okatoPart.getSymbol("40-61").getValue().exact
                                              + okatoPart.getSymbol("70").getValue().exact
                                              + okatoPart.getSymbol("72").getValue().exact
                                              + okatoPart.getSymbol("75").getValue().exact
                                              + okatoPart.getSymbol("77").getValue().exact;
    end;


    constructorTCalculationOperation4637();
end;
