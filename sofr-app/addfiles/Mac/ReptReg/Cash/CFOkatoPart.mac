/*
$Name:          CFOkatoPart.mac
$Module:        Регламентируемая отчетность
$Description:   Часть отчета по заданному коду ОКАТО
*/

/**
 * Класс TOkatoPart и его наследники.
 *
 * @since   09.11.2007
 * @author  Ivkina Olga
 * @version 6.00.004.24
 */

import repException;

import CFObjectFactory;

/**
 * Часть отчета по одному ОКАТО.
 */
class TOkatoPart(report : Object, okatoCode : String)

    /**
     * Ссылка на отчет.
     */
    private var m_report : Object = report;

    /**
     * Коллекция символов, входящих в часть отчета.
     */
    private var m_symbols : TArray;

    /**
     * Код ОКАТО.
     */
    private var m_okatoCode : String;

    /**
     * Выполнить наполнение части отчета символами.
     */
    private macro initializeSymbols()
        throw(TPureVirtualMethodCallException("TOkatoPart::initializeSymbols"));
    end;

    /**
     * Конструктор.
     *
     * @param     okatoCode
     */
    macro constructorTOkatoPart(okatoCode : String)
        m_okatoCode = okatoCode;
        m_symbols   = TArray;
        initializeSymbols();
    end;

    /**
     * Получить ссылку на отчет.
     */
    macro getReport()
        return m_report;
    end;

    /**
     * Получить код ОКАТО.
     */
    macro getOkatoCode()
        return m_okatoCode;
    end;

    /**
     * Получить ссылку на символ.
     *
     * @param     symbolCode код символа
     */
    macro getSymbol(symbolCode : String)
        var i = 0;
        var symbolsSize = m_symbols.size;
        while (i < symbolsSize)
           if (m_symbols(i).getCode() == symbolCode)
               return m_symbols(i);
           end;
           i = i + 1;
        end;
        return null;
    end;

    /**
     * Добавить символ.
     *
     * @param     symbolCode код символа
     */
    macro addSymbol(symbolCode : String)
        m_symbols(m_symbols.size) = objectFactoryInstance().createSymbol(this, symbolCode);
    end;

    /**
     * Возвратить коллекцию символов части отчета.
     */
    macro getSymbols()
        return m_symbols;
    end;

    /**
     * Проверка кода по ОКАТО на ненулевые данные по символам
     * @author ABP
     */
    macro isZeroSymbols()
        var result = true;

        for (var i, m_symbols)
            if (i.getValue().exact != $0)
                result = false;
                break;
            end;
        end;

        return result;
    end;

    /**
     * Удаление символов и их значений, удаление структурного значения
     * @author ABP
     */
    macro delete()
        var attributeValue = m_report.getRcbReport().AttributeValue("Символы");
        var okatoKeyValue = attributeValue.attribute.structure.key.createKeyValue();
        var okatoCompositeValue : Object;

        okatoKeyValue.fieldValue("Код ОКАТО") = m_okatoCode;
        okatoKeyValue.fieldValue("Код символа") = "";

        attributeValue.removeValue(okatoKeyValue);

        m_symbols = null;
        m_okatoCode = null;
    end;

    constructorTOkatoPart(okatoCode);
end;

/**
 * Часть отчета по ОКАТО для указания 1881-У.
 */
class (TOkatoPart) TOkatoPart1881(report : Object, okatoCode : String)
    /**
     * Конструктор.
     *
     * @param     okatoCode  код ОКАТО
     */
    private macro constructorTOkatoPart1881(report : Object, okatoCode : String)
        initTOkatoPart(report, okatoCode);
    end;

    /**
     * Выполнить наполнение части отчета символами.
     */
    private macro initializeSymbols()
        addSymbol("02");    addSymbol("03"); addSymbol("11");    addSymbol("12"); addSymbol("13");
        addSymbol("14");    addSymbol("15"); addSymbol("16");    addSymbol("17"); addSymbol("19");
        addSymbol("20");    addSymbol("21"); addSymbol("22");    addSymbol("23"); addSymbol("30");
        addSymbol("31");    addSymbol("32"); addSymbol("02-32"); addSymbol("35"); addSymbol("33");
        addSymbol("37");    addSymbol("39"); addSymbol("02-39"); addSymbol("40"); addSymbol("41");
        addSymbol("42");    addSymbol("46"); addSymbol("47");    addSymbol("50"); addSymbol("51");
        addSymbol("53");    addSymbol("54"); addSymbol("55");    addSymbol("56"); addSymbol("57");
        addSymbol("58");    addSymbol("59"); addSymbol("60");    addSymbol("61"); addSymbol("62");
        addSymbol("40-62"); addSymbol("70"); addSymbol("72");    addSymbol("75"); addSymbol("77");
        addSymbol("40-77"); addSymbol("80"); addSymbol("81");    addSymbol("89"); addSymbol("96");
        addSymbol("97");    addSymbol("98");
    end;

    constructorTOkatoPart1881(report, okatoCode);
end;

/**
 * Часть отчета по ОКАТО для указания 1881-У.
 */
class (TOkatoPart) TServicePart1881(report : Object)
    /**
     * Конструктор.
     *
     * @param     okatoCode  код ОКАТО
     */
    private macro constructorTServicePart1881(report : Object)
        initTOkatoPart(report, "Серв.");
    end;

    /**
     * Выполнить наполнение части отчета символами.
     */
    private macro initializeSymbols()
        addSymbol("ОбДт");
        addSymbol("ОбКт");
        addSymbol("БсПр");
        addSymbol("БсРс");
    end;

    constructorTServicePart1881(report);
end;


/**
 * Часть отчета по ОКАТО для указания 2332-У.
 *
 * отличия от 1881У:
 *                  удален   символ  03
 *                  добавлен символ  99
 *                  добавлен символ 100
 */
class (TOkatoPart1881) TOkatoPart2332(report : Object, okatoCode : String)
    /**
     * Конструктор.
     *
     * @param     okatoCode  код ОКАТО
     */
    private macro constructorTOkatoPart2332(report : Object, okatoCode : String)
        initTOkatoPart1881(report, okatoCode);
    end;

    /**
     * Выполнить наполнение части отчета символами.
     */
    private macro initializeSymbols()
        addSymbol("02");                     addSymbol("11");    addSymbol("12"); addSymbol("13");
        addSymbol("14");    addSymbol("15"); addSymbol("16");    addSymbol("17"); addSymbol("19");
        addSymbol("20");    addSymbol("21"); addSymbol("22");    addSymbol("23"); addSymbol("30");
        addSymbol("31");    addSymbol("32"); addSymbol("02-32"); addSymbol("35"); addSymbol("33");
        addSymbol("37");    addSymbol("39"); addSymbol("02-39"); addSymbol("40"); addSymbol("41");
        addSymbol("42");    addSymbol("46"); addSymbol("47");    addSymbol("50"); addSymbol("51");
        addSymbol("53");    addSymbol("54"); addSymbol("55");    addSymbol("56"); addSymbol("57");
        addSymbol("58");    addSymbol("59"); addSymbol("60");    addSymbol("61"); addSymbol("62");
        addSymbol("40-62"); addSymbol("70"); addSymbol("72");    addSymbol("75"); addSymbol("77");
        addSymbol("40-77"); addSymbol("80"); addSymbol("81");    addSymbol("89"); addSymbol("96");
        addSymbol("97");    addSymbol("98"); addSymbol("99");    addSymbol("100");
    end;

    constructorTOkatoPart2332(report, okatoCode);
end;


/**
 * Часть отчета по ОКАТО для указания 2627-У.
 *
 * отличия от 1881У:
 *                  удален   символ  23
 *                  удален   символ  62
 *                  добавлен символ  82
 *                  добавлен символ  83
 *                  добавлен символ  85
 *                  добавлен символ  86
 *                  добавлен символ  87
 *                  добавлен символ  88
 */
class (TOkatoPart2332) TOkatoPart2627(report : Object, okatoCode : String)
    /**
     * Конструктор.
     *
     * @param     okatoCode  код ОКАТО
     */
    private macro constructorTOkatoPart2627(report : Object, okatoCode : String)
        initTOkatoPart2332(report, okatoCode);
    end;

    /**
     * Выполнить наполнение части отчета символами.
     */
    private macro initializeSymbols()
        addSymbol("02");    addSymbol("11"); addSymbol("12");    addSymbol("13"); addSymbol("14");
        addSymbol("15");    addSymbol("16"); addSymbol("17");    addSymbol("19"); addSymbol("20");
        addSymbol("21");    addSymbol("22"); addSymbol("30");    addSymbol("31"); addSymbol("32");
        addSymbol("02-32"); addSymbol("35"); addSymbol("33");    addSymbol("37"); addSymbol("39");
        addSymbol("02-39"); addSymbol("40"); addSymbol("41");    addSymbol("42"); addSymbol("46");
        addSymbol("47");    addSymbol("50"); addSymbol("51");    addSymbol("53"); addSymbol("54");
        addSymbol("55");    addSymbol("56"); addSymbol("57");    addSymbol("58"); addSymbol("59");
        addSymbol("60");    addSymbol("61"); addSymbol("40-61"); addSymbol("70"); addSymbol("72");
        addSymbol("75");    addSymbol("77"); addSymbol("40-77"); addSymbol("80"); addSymbol("81");
        addSymbol("82");    addSymbol("83"); addSymbol("85");    addSymbol("86"); addSymbol("87");
        addSymbol("88");    addSymbol("89"); addSymbol("96");    addSymbol("97"); addSymbol("98");
        addSymbol("99");    addSymbol("100");
    end;

    constructorTOkatoPart2627(report, okatoCode);
end;

/**
 * Часть отчета по ОКАТО для 4637-У.
 */
class (TOkatoPart2627) TOkatoPart4637(report : Object, okatoCode : String)
    /**
     * Конструктор.
     *
     * @param     okatoCode  код ОКАТО
     */
    private macro constructorTOkatoPart4637(report : Object, okatoCode : String)
        initTOkatoPart2627(report, okatoCode);
    end;

    /**
     * Выполнить наполнение части отчета символами.
     */
    private macro initializeSymbols()
        addSymbol("02");    addSymbol("11");  addSymbol("12");    addSymbol("13"); addSymbol("14");
        addSymbol("15");    addSymbol("16");  addSymbol("17");    addSymbol("19"); addSymbol("20");
        addSymbol("21");    addSymbol("22");  addSymbol("30");    addSymbol("31"); addSymbol("32");
        addSymbol("02-32"); addSymbol("33");  addSymbol("35");    addSymbol("37"); addSymbol("39");
        addSymbol("02-39"); addSymbol("40");  addSymbol("41");    addSymbol("42"); addSymbol("46");
        addSymbol("47");    addSymbol("50");  addSymbol("51");    addSymbol("53"); addSymbol("54");
        addSymbol("55");    addSymbol("56");  addSymbol("57");    addSymbol("58"); addSymbol("59");
        addSymbol("60");    addSymbol("61");  addSymbol("40-61"); addSymbol("70"); addSymbol("72");
        addSymbol("75");    addSymbol("77");  addSymbol("40-77"); addSymbol("80"); addSymbol("81");
        addSymbol("82");    addSymbol("83");  addSymbol("85");    addSymbol("86"); addSymbol("87");
        addSymbol("88");    addSymbol("89");  addSymbol("96");    addSymbol("97"); addSymbol("98");
        addSymbol("99");    addSymbol("100"); addSymbol("101");   addSymbol("102");
    end;

    constructorTOkatoPart4637(report, okatoCode);
end;
