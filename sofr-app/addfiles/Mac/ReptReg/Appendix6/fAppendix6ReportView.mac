/*
$Name:        fAppendix6ReportView.mac
$Module:      Регламентированная отчетность
$Description: Передставление отчета Приложение 6
*/

private class (RcbPartView) TFAppendix6PartView(id : String, partName : String)
    private var m_isActivePassiveHeaderPrinted = false;
    private var m_partName = partName;

    private macro initialize()
    end;

    macro PrintHead()
        [                                                                                                                                                           ];
        [###########################################################################################################################################################](m_partName : w : l);
        [┌───────────────┬─────────────────────────┬───────────────────────────┬───────────┬───────────────┬───────────────────────────────────────────────────────┐];
        [│  Номер счета  │  Номер лицевого счета   │   Наименование счетов и   │Дата преды-│   Код валют   │                        Остатки                        │];
        [├───────┬───────┤                         │     разделов баланса      │дущей опе- │ (драгоценных  ├───────────────────────────┬───────────────────────────┤];
        [│первого│второго│                         │                           │ рации по  │   металлов)   │      в рублях, ино-       │     в иностранной ва-     │];
        [│порядка│порядка│                         │                           │   счету   │               │     странной валюте и     │      люте в сумме со      │];
        [│       │       │                         │                           │           │               │      драгоценных ме-      │    соответствующей ва-    │];
        [│       │       │                         │                           │           │               │     таллах в рублевом     │     валюты и в драго-     │];
        [│       │       │                         │                           │           │               │        эквиваленте        │     ценных металлах в     │];
        [│       │       │                         │                           │           │               │                           │     натуральных пока-     │];
        [│       │       │                         │                           │           │               │                           │          зателях          │];
        [├───────┼───────┼─────────────────────────┼───────────────────────────┼───────────┼───────────────┼───────────────────────────┼───────────────────────────┤];
        [│   1   │   2   │            3            │             4             │    4а     │       5       │             6             │             7             │];
        [├───────┴───────┴─────────────────────────┴───────────────────────────┴───────────┴───────────────┴───────────────────────────┴───────────────────────────┤];
    end;

    macro getWidth()
        return m_table.GetSumLen();
    end;

    macro PrintSeparator()
        [├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤];
    end;

    macro PrintCentralString(str)
        if (not m_isActivePassiveHeaderPrinted)
        [│                                                                           #                                                                             │](str : c);
            PrintSeparator();
            m_isActivePassiveHeaderPrinted = true;
        end;
    end;

    macro PrintString(balance1 : String, balance2 : String, account : String, accountName : String, lastCarryDate : String, fiCode : String, roubleRest : String, currencyRest : String)
        //печать с апострофами
        if (TFAppendix6Parameters().getPritntingApostrophes() == true)
            var s1 = ternary(roubleRest != "", String(Money(roubleRest) : a), roubleRest);
            var s2 = ternary((currencyRest != "") and (currencyRest != "             X             "), String(Money(currencyRest) : a), currencyRest);
        [│  ###    #####  ######################### ########################### ##########  ############### ########################### ###########################│]
        (balance1, balance2, account, accountName : w, lastCarrydate, fiCode, s1 : r, s2 : r);
        //печать без апострофов
        else
        [│  ###    #####  ######################### ########################### ##########  ############### ########################### ###########################│]
        (balance1, balance2, account, accountName : w, lastCarrydate, fiCode, roubleRest : r, currencyRest : r);
        end;
    end;

    macro PrintResultString(balance1 : String, balance2 : String, resultString1 : String, resultString2 : String, resultName : String, roubleRestTotal : String, isTotalResult: Bool)
        //актив/пассив
        if (isTotalResult)
            //печать с апострофами
            if (TFAppendix6Parameters().getPritntingApostrophes() == true)
                var s1 = ternary(roubleRestTotal != "", String(Money(roubleRestTotal) : a), roubleRestTotal);
        [│                ИТОГО                                                                                                                                    │];
        [│                ##########                                                                        ###########################              X             │] (resultString1, s1: r);
            //печать без апострофов
            else
        [│                ИТОГО                                                                                                                                    │];
        [│                ##########                                                                        ###########################              X             │] (resultString1, roubleRestTotal: r);
            end;
            m_isActivePassiveHeaderPrinted = false;
        //по клиенту, по б/с 2-го порядка, по б/с 1-го порядка
        else
            PrintString("", "", "ИТОГО", "", "", "", "", "");
            PrintString(balance1, balance2, resultString1, resultName, "", "", roubleRestTotal, ternary(resultString1 != "по счету второго порядка", "             X             ", "                           "));
            if (resultString2 != "")
                PrintString("", "", resultString2, "", "", "", "", "");
            end;
        end;

    end;

    macro printBottom(stream)
        [└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘];
    end;

    private macro constructorTFAppendix6PartView(id : String, partName : String)
        initRcbPartView(id);
    end;

    constructorTFAppendix6PartView(id);
end;

class (RcbReportView) TFAppendix6ReportView()

    macro printCapReport()
        [                                                                                                                                               Приложение 6];
        [                                                                                                                    к Правилам ведения бухгалтерского учета];
        [                                                                                                                    в кредитных организациях, расположенных];
        [                                                                                                                         на территории Российской Федерации];
        [                                                                                                                       (Приложение к Положению Банка России];
        [                                                                                                                                 от 16 июля 2012 г. N 385-П];
        [                                                                                                                   "О правилах ведения бухгалтерского учета];
        [                                                                                                                    в кредитных организациях, расположенных];
        [                                                                                                                       на территории Российской Федерации")];
        [                                                                                                                                                           ];
        [                                                                             Ведомость                                                                     ];
        [                                                            остатков по счетам кредитной организации                                                       ];
        [                                                                                 #](String("на ", (RcbApplication().currentReport.context.period.endDate + 1) : m) : c);
    end;

    macro PrintSigns()
        [ ];
        [ ];
        [                                                                                                               #]("Главный бухгалтер");
    end;

    private macro initialize()
        var query =  "SELECT t_chapter, t_name               "
            + "\n" + "  FROM dobchaptr_dbt                   "
            + "\n" + " WHERE t_chapter NOT IN (1, 2, 3, 4, 5)";
        var additionalParts = TRsbDataSet(query);

        m_partViewPool.push_back(TFAppendix6PartView("1", "А. Балансовые счета"));
        m_partViewPool.push_back(TFAppendix6PartView("2", "Б. Счета доверительного управления"));
        m_partViewPool.push_back(TFAppendix6PartView("3", "В. Внебалансовые счета"));
        m_partViewPool.push_back(TFAppendix6PartView("4", "Г. Счета по учету требований и обязательств по производным финансовым инструментам и прочим договорам (сделкам), по которым расчеты и поставка осуществляются не ранее следующего дня после дня заключения договора (сделки)"));
        m_partViewPool.push_back(TFAppendix6PartView("5", "Д. Счета депо"));
        //дополнительные главы плана счетов (если есть)
        while (additionalParts.moveNext())
            m_partViewPool.push_back(TFAppendix6PartView(String(additionalParts.t_chapter), additionalParts.t_name));
        end;

        //исключаем лишние атрибуты из стандартной печатной формы
        m_view.excludeAttribute(AC_FIRST_PERSON);
        m_view.excludeAttribute(AC_SECOND_PERSON);
        m_view.excludeAttribute(AC_EXECUTOR);
        m_view.excludeAttribute(AC_EXECUTOR_PHONE_NUMBER);
    end;

    macro show()
    end;

    private macro constructorTFAppendix6ReportView()
        initRcbReportView("Приложение 6","");
    end;

    constructorTFAppendix6ReportView();
end;

class (RcbReportView) TFAppendix4ReportView()

    macro printCapReport()
        [                                                                                                                                              Приложение 4 ];
        [                                                                                                                     к приложению к Положению Банка России ];
        [                                                                                                                     от 27 февраля 2017 года № 579-П       ];
        [                                                                                                                     "О плане счетов бухгалтерского учета  ];
        [                                                                                                                     в кредитных организациях и порядке его];
        [                                                                                                                     применения"                           ];
        [                                                                                                                                                           ];
        [                                                                             Ведомость                                                                     ];
        [                                                            остатков по счетам кредитной организации                                                       ];
        [                                                                                 #](String("на ", (RcbApplication().currentReport.context.period.endDate + 1) : m) : c);
    end;

    macro PrintSigns()
        [ ];
        [ ];
        [                                                                                                               #]("Главный бухгалтер");
    end;

    private macro initialize()
        var query =  "SELECT t_chapter, t_name               "
            + "\n" + "  FROM dobchaptr_dbt                   "
            + "\n" + " WHERE t_chapter NOT IN (1, 2, 3, 4, 5)";
        var additionalParts = TRsbDataSet(query);

        m_partViewPool.push_back(TFAppendix6PartView("1", "А. Балансовые счета"));
        m_partViewPool.push_back(TFAppendix6PartView("2", "Б. Счета доверительного управления"));
        m_partViewPool.push_back(TFAppendix6PartView("3", "В. Внебалансовые счета"));
        m_partViewPool.push_back(TFAppendix6PartView("4", "Г. Счета по учету требований и обязательств по производным финансовым инструментам и прочим договорам (сделкам), по которым расчеты и поставка осуществляются не ранее следующего дня после дня заключения договора (сделки)"));
        //дополнительные главы плана счетов (если есть)
        while (additionalParts.moveNext())
            m_partViewPool.push_back(TFAppendix6PartView(String(additionalParts.t_chapter), additionalParts.t_name));
        end;

        //исключаем лишние атрибуты из стандартной печатной формы
        m_view.excludeAttribute(AC_FIRST_PERSON);
        m_view.excludeAttribute(AC_SECOND_PERSON);
        m_view.excludeAttribute(AC_EXECUTOR);
        m_view.excludeAttribute(AC_EXECUTOR_PHONE_NUMBER);
    end;

    macro show()
    end;

    private macro constructorTFAppendix4ReportView()
        initRcbReportView("Приложение 4","");
    end;

    constructorTFAppendix4ReportView();
end;