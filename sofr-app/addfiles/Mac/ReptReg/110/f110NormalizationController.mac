/*
$Name:          f110NormalizationController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 110. Контроллер нормализации
*/

class TF110NormalizationController()
    private var m_report;
    private var m_protocolView = null;

    macro constructorTF110NormalizationController()
        m_report       = objectFactoryInstance.createReport();
        m_protocolView = objectFactoryInstance.createNormalizationProtocolView();
    end;

    macro execute()

        m_protocolView.beginProtocol();

        initProgress(null, "Выполнение нормализации данных", "Выполнение нормализации данных");

        m_protocolView.printReportPartNumber("1");
        objectFactoryInstance.createPart1Normalizer(m_protocolView).execute();
        m_protocolView.endPart();

        if (m_report.isAtQuarterlyDate())
            m_protocolView.printReportPartNumber("2");
            objectFactoryInstance.createPart2Normalizer(m_protocolView).execute();
            m_protocolView.endPart();

            m_protocolView.printReportPartNumber("3");
            objectFactoryInstance.createPart3Normalizer(m_protocolView).execute();
            m_protocolView.endPart();
        end;

        m_protocolView.printReportPartNumber("4");
        objectFactoryInstance.createPart4Normalizer(m_protocolView).execute();
        m_protocolView.endPart();

        remProgress();

        RcbApplication.TransactionManager.commit();

        m_protocolView.endProtocol();

        m_protocolView.show();
    end;

    constructorTF110NormalizationController();
end;

class (TF110NormalizationController) TF110NormalizationController_4212()
    initTF110NormalizationController();

    macro execute()
        var mode = global().getExportMode();

        m_protocolView.beginProtocol();

        initProgress(null, "Выполнение нормализации данных", "Выполнение нормализации данных");

        m_protocolView.printReportPartNumber("1");
        objectFactoryInstance.createPart1Normalizer(m_protocolView).execute();
        m_protocolView.endPart();

        if   (mode == 1)
            m_protocolView.printReportPartNumber("4");
            objectFactoryInstance.createPart4Normalizer(m_protocolView).execute();
            m_protocolView.endPart();

        elif ((mode == 2) or (mode == 3))
            m_protocolView.printReportPartNumber("2");
            objectFactoryInstance.createPart2Normalizer(m_protocolView).execute();
            m_protocolView.endPart();

            m_protocolView.printReportPartNumber("3");
            objectFactoryInstance.createPart3Normalizer(m_protocolView).execute();
            m_protocolView.endPart();

            m_protocolView.printReportPartNumber("4");
            objectFactoryInstance.createPart4Normalizer(m_protocolView).execute();
            m_protocolView.endPart();

        elif (mode == 4)
            m_protocolView.printReportPartNumber("2");
            objectFactoryInstance.createPart2Normalizer(m_protocolView).execute();
            m_protocolView.endPart();

            m_protocolView.printReportPartNumber("3");
            objectFactoryInstance.createPart3Normalizer(m_protocolView).execute();
            m_protocolView.endPart();
        end;

        remProgress();

        RcbApplication.TransactionManager.commit();

        m_protocolView.endProtocol();

        m_protocolView.show();
    end;

    constructorTF110NormalizationController();
end;
