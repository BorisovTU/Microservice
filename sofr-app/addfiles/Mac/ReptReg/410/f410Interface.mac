/*
$Name:          f410Interface.mac
$Module:        Отчеты ЦБ
$Description:   Форма 410. Доступ к операциям формы.
*/

import f410Import;

/**
 *  Запуск операции расчета отчета
 */
macro executeCalculationOperation()
    var profiler = TSqlProfiler(getTxtFileName("!F410CalculateProfile"));
    profiler.clear();
    profiler.on();

    objectFactoryInstance.createReportCalculateController().calculate();
    RcbApplication().transactionManager.commit();
end;

/**
 *  Запуск операции печати отчета
 */
macro executePrintOperation()
    objectFactoryInstance.createReportPrintController().print();
end;

/**
 *  Запуск операции печати отчета в Excel
 */
macro executePrintExcelOperation()
    objectFactoryInstance.createReportPrintController(WINREP_FORMAT_XLSX).print();
end;

/**
 *  Запуск операции экспорта в XML
 */
macro executeXmlExportOperation()
    objectFactoryInstance.createXmlExportController().execute();
end;

/**
 *  Запуск операции экспорта в БИС
 */
macro executeBISExportOperation()
    const FORMNAME_LABEL = "-formName:";
    const PART_LABEL  = "-part:";

    var formNameLabelIndex  = index(cmdArgs, FORMNAME_LABEL);
    var partLabelIndex = index(cmdArgs, PART_LABEL);

    if ((formNameLabelIndex == 0) or (partLabelIndex == 0))
        return;
    end;

    var formName  = SubStr(CmdArgs, formNameLabelIndex  + StrLen(FORMNAME_LABEL), 6);
    var part = "part" + SubStr(cmdArgs, partLabelIndex + strlen(PART_LABEL), 1);

    objectFactoryInstance.createBISExportOperation(formName, part).execute();
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
