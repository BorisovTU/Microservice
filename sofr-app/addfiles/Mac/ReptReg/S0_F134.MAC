/*───────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.10                                           R-Style Software Lab
  Файл подсистемы "Отчеты ЦБ"

  Функции для настройки параметов Формы 134 "Расчёт капитала"
  по списку лицевых счетов.

CREATED : 23.09.98 Мол.
FILE_NAME : S0_F134.MAC
MODIFICATIONS:
  05.10.98 Асл.
  19.01.99 Асл.
  30.06.99 Мол.
    Добавлена функция корректировки Corr_Eq2_1_10
  19.06.01 Мол. Файл настроек помещается в текстовом файле
  11.07.01 Мол. Изменился способ вызова функции корректировки.
NOTES:
└───────────────────────────────────────────────────────────────────────────*/

IMPORT BankInter,ReptCBInter, lib_path;

VAR
   AccListFileName = ReturnDirString( "TEXTDIR", "TXTFILE") + "s_f134.txt";

CONST
     СекцияОснКапитала = "Для расчета основного капитала",
     _СекцияОснКапитала = ",|принимающих участие в расчете основного капитала КО в форме АО -|строка 101 (2.1.1)",
     СекцияОснКапитала_ООО = "Для расчета основного капитала - КО в форме ООО",
     _СекцияОснКапитала_ООО = ",|принимающих участие в расчете основного капитала КО в форме ООО -|строка 102 (2.1.2)",
     СекцияОснКапитала_Часть_Фондов = "Для расчета основного капитала - часть фондов",
     _СекцияОснКапитала_Часть_Фондов = ",|принимающих участие в расчете фондов КО -|строки 105 (2.1.5), 107 (2.1.7), 203 (3.3)",
     СекцияОснКапитала_Резервы = "Для расчета основного капитала - резервы",
     _СекцияОснКапитала_Резервы = ",|принимающих участие в расчете основного капитала по учету резервов|под обесценение акций (долей участия) дочерних и зависимых хозяйственных обществ и КО-резидентов| - строка 109 (2.1.9)",
     СекцияОснКапитала_ДопСобСредства = "Для расчета основного капитала - доп. соб. ср-ва",
     _СекцияОснКапитала_ДопСобСредства = "|по учету дополнительных собственных средств,|принимающих участие в расчете основного капитала -|строка 110 (2.1.10)",
     СекцияДопКапитала = "Для расчета дополнительного капитала",
     _СекцияДопКапитала = ",|принимающих участие в расчете дополнительного капитала -|строка 207 (3.7)",
     СекцияПоказУменьшКапитала = "Для расчета показателей, уменьшающих сумму капитала",
     _СекцияПоказУменьшКапитала = "|для расчета показателей, уменьшающих сумму капитала -|строка 305 (4.6)",
     СекцияПоказУменьшКапитала_ДолиУчастников = "Для расчета перешедших к КО долей участников",
     _СекцияПоказУменьшКапитала_ДолиУчастников = "|по учету перешедших к КО долей участников -|строка 115 (2.2.3)";

VAR
   РазделительПолей;

MACRO ИмяФайлаСписковЛицевых134()












  return AccListFileName /*+ ".txt"*/;
END;

/* -- Фильтры для лицевых счетов осн. и доп. капитала -- */

/*
  Макро-функция принимает номер лицевого счёта в качестве 0-го
  параметра. Если указан неотрицательный номер плана счетов, то
  вторым параметров функции передаётся соотв. номер балансового счёта.
  Эта функция возвращает TRUE, если счёт допустимый.
*/

MACRO Ф_ЛицевыеДопКапитала( Лицевой, Балансовый)
  return (SubStr( Балансовый, 1, 3) == "103");

END;

MACRO Ф_ЛицевыеОснКапитала( Лицевой, Балансовый)
  return    (SubStr( Балансовый, 1, 3) == "102")
         or (SubStr( Балансовый, 1, 3) == "103");
END;

MACRO Ф_ЛицевыеОснКапитала_ООО( Лицевой, Балансовый)
  return (SubStr( Балансовый, 1, 3) == "104");
END;

MACRO Ф_ЛицевыеОснКапитала_Часть_Фондов( Лицевой, Балансовый)
  return    (SubStr( Балансовый, 1, 3) == "107");
END;

MACRO Ф_ЛицевыеОснКапитала_Резервы( Лицевой, Балансовый)
  return    (SubStr( Балансовый, 1, 5) == "50612")
        or  (SubStr( Балансовый, 1, 5) == "50709")
        or  (SubStr( Балансовый, 1, 5) == "50809")
        or  (SubStr( Балансовый, 1, 5) == "60206");
END;

MACRO Ф_ЛицевыеОснКапитала_ДопСобСредства( Лицевой, Балансовый)
  return    (SubStr( Балансовый, 1, 5) == "10704");
END;

MACRO Ф_ЛицевыеПоказУменьшКапитала( Лицевой, Балансовый)
  return    (SubStr( Балансовый, 1, 5) == "32009")
         or (SubStr( Балансовый, 1, 5) == "32209");
END;

MACRO Ф_ЛицевыеПоказУменьшКапитала_ДолиУчастников( Лицевой, Балансовый)
  return    (SubStr( Балансовый, 1, 5) == "10502");
END;

/* -·-·- Функции настройки списков счетов -·-·- */

MACRO НастроитьЛицевыеОсновногоКапитала( DoExit)
VAR
  rc = Ред_СписокЛицевыхТекст( AccListFileName,
                               СекцияОснКапитала,
                               0, /* Логический план счетов */
                               "Ф_ЛицевыеОснКапитала",
                               "Лицевые счета, используемые при расчете Формы 134 \"Расчет капитала\"");
  if ( not rc )
    MsgBox( "Ошибка редактирования списка");
  end;

  if ( DoExit )
    Exit( 1);
  end;
END;

MACRO НастроитьЛицевыеОсновногоКапитала_ООО( DoExit)
VAR
  rc = Ред_СписокЛицевыхТекст( AccListFileName,
                               СекцияОснКапитала_ООО,
                               0, /* Логический план счетов */
                               "Ф_ЛицевыеОснКапитала_ООО",
                               "Лицевые счета, используемые при расчете Формы 134 \"Расчет капитала\"");
  if ( not rc )
    MsgBox( "Ошибка редактирования списка");
  end;

  if ( DoExit )
    Exit( 1);
  end;
END;

MACRO НастроитьЛицевыеОсновногоКапитала_Часть_Фондов( DoExit)
VAR
  rc = Ред_СписокЛицевыхТекст( AccListFileName,
                               СекцияОснКапитала_Часть_Фондов,
                               0, /* Логический план счетов */
                               "Ф_ЛицевыеОснКапитала_Часть_Фондов",
                               "Лицевые счета, используемые при расчете Формы 134 \"Расчет капитала\"");
  if ( not rc )
    MsgBox( "Ошибка редактирования списка");
  end;

  if ( DoExit )
    Exit( 1);
  end;
END;

MACRO НастроитьЛицевыеОсновногоКапитала_Резервы( DoExit)
VAR
  rc = Ред_СписокЛицевыхТекст( AccListFileName,
                               СекцияОснКапитала_Резервы,
                               0, /* Логический план счетов */
                               "Ф_ЛицевыеОснКапитала_Резервы",
                               "Лицевые счета, используемые при расчете Формы 134 \"Расчет капитала\"");
  if ( not rc )
    MsgBox( "Ошибка редактирования списка");
  end;

  if ( DoExit )
    Exit( 1);
  end;
END;

MACRO НастроитьЛицевыеОсновногоКапитала_ДопСобСредства( DoExit)
VAR
  rc = Ред_СписокЛицевыхТекст( AccListFileName,
                               СекцияОснКапитала_ДопСобСредства,
                               0, /* Логический план счетов */
                               "Ф_ЛицевыеОснКапитала_ДопСобСредства",
                               "Лицевые счета, используемые при расчете Формы 134 \"Расчет капитала\"");
  if ( not rc )
    MsgBox( "Ошибка редактирования списка");
  end;

  if ( DoExit )
    Exit( 1);
  end;
END;

MACRO НастроитьЛицевыеДополнитКапитала( DoExit)
VAR
  rc = Ред_СписокЛицевыхТекст( AccListFileName,
                               СекцияДопКапитала,
                               0, /* Логический план счетов */
                               "Ф_ЛицевыеДопКапитала",
                               "Лицевые счета, используемые при расчете Формы 134 \"Расчет капитала\"");
  if ( not rc )
    MsgBox( "Ошибка редактирования списка");
  end;

  if ( DoExit )
    Exit( 1);
  end;
END;

MACRO НастроитьЛицевыеПоказУменьшКапитала( DoExit)
VAR
  rc = Ред_СписокЛицевыхТекст( AccListFileName,
                               СекцияПоказУменьшКапитала,
                               0, /* Логический план счетов */
                               "Ф_ЛицевыеПоказУменьшКапитала",
                               "Лицевые счета, используемые при расчете Формы 134 \"Расчет капитала\"");
  if ( not rc )
    MsgBox( "Ошибка редактирования списка");
  end;

  if ( DoExit )
    Exit( 1);
  end;
END;

MACRO НастроитьЛицевыеПоказУменьшКапитала_ДолиУчастников( DoExit)
VAR
  rc = Ред_СписокЛицевыхТекст( AccListFileName,
                               СекцияПоказУменьшКапитала_ДолиУчастников,
                               0, /* Логический план счетов */
                               "Ф_ЛицевыеПоказУменьшКапитала_ДолиУчастников",
                               "Лицевые счета, используемые при расчете Формы 134 \"Расчет капитала\"");
  if ( not rc )
    MsgBox( "Ошибка редактирования списка");
  end;

  if ( DoExit )
    Exit( 1);
  end;
END;


/* -·-·- Утилиты по обслуживанию списка -·-·- */

MACRO ЕстьСекцияСчетов(
  FileRef,  /* Ссылка на открытый файл */
  PartName  /* Имя секции     */
)
/*BEGIN*/
var
   PartNameStr;

  rewind( FileRef);

  while ( Next( FileRef) )
    if ( SubStr( FileRef.str, 1, 1) == "!" )
      PartNameStr = SubStr( FileRef.str, 2);
      Trim( PartNameStr );
      if ( PartNameStr == PartName )
        return true;
      end;
    end;
  end;

  return False;
END;

MACRO УстановитьРазделительПолей( FileRef /* Ссылка на открытый файл */)
  Rewind( FileRef);
  if ( Next( FileRef) )
    РазделительПолей = SubStr( FileRef.Str, 1, 1);
  end;
END;

MACRO ПолучитьИмяСчета( FileRef /* Ссылка на открытый файл */)
var
   sr, i;

  i = Index( FileRef.Str, РазделительПолей);

  if ( i > 0 )
    sr = Trim( SubStr( FileRef.Str, 1, i-1));
  else
    sr = Trim( FileRef.Str);
  end;

  return sr;
END;

/* Функция корректировки значения переменной Eq2_1_13 
MACRO Corr_Eq2_1_13( Значение, ЗначениеT)
VAR
   Eq_ПрибыльПодтверждена;

  if ( not ПрочитатьПеременную( Eq_ПрибыльПодтверждена, ДатаОтчета, ПредДатаОтчета,
                       {Название отчета}, "Eq_ПрибыльПодтверждена") )
    MsgBox( "Ошибка чтения значения переменной Eq_ПрибыльПодтверждена");
    return 0.0;
  end;

  if ( Eq_ПрибыльПодтверждена > 0 )
    Значение  = Max( Значение , $0 );
    ЗначениеT = Max( ЗначениеT, 0.0);
  else
    Значение  = $0;
    ЗначениеT = 0.0;
  end;

  SetParm( 0, Значение);
  SetParm( 1, ЗначениеT);

  return true;
END;

/* Функция корректировки значения переменной Eq3_9 */
MACRO Corr_Eq3_9( Значение, ЗначениеT)
VAR
   Eq_ПрибыльПодтверждена, d, m, y;

  DateSplit( {curdate}, d, m, y);

  if ( not ПрочитатьПеременную( Eq_ПрибыльПодтверждена, ДатаОтчета, ПредДатаОтчета,
                       {Название отчета}, "Eq_ПрибыльПодтверждена") )
    MsgBox( "Ошибка чтения значения переменной Eq_ПрибыльПодтверждена");
    return 0.0;
  end;

  if ( Eq_ПрибыльПодтверждена > 0 )
    Значение  = $0;
    ЗначениеT = 0.0;
  elif ( ДатаОтчета < Date( 1, 7, y) )
    Значение  = Max( Значение , $0 );
    ЗначениеT = Max( ЗначениеT, 0.0);
  end;

  SetParm( 0, Значение);
  SetParm( 1, ЗначениеT);

  return true;
END;
*/
/* eof */
