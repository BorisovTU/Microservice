/*
$Name:          f652ReportPrintController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 652. Контроллер печати отчета
*/

/**
 * Форма 652. Контроллер печати отчета.
 *
 * @since   04.07.2013
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

private CONST MAX_CURRENCY_FOR_EXCEL = 5;

class (RcbReportPrintController) F652ReportPrintController(format)
    private var m_part     : RcbPartBase;
    private var m_partView : RcbPartView;
    private var m_format   : Integer;

    private macro printDataZone()
        var iterator = RcbApplication.currentReport.attributeValue("СписокВалют").createValueIterator();
        iterator.moveFirst();

        m_partView.printDescription("isNullData", "");
        m_partView.endDescription();

        var i = 3;
        var j = 1;

        if (m_format == WINREP_FORMAT_XLSX)
            while(not iterator.isDone())
                if (j == 1)
                    m_partView.printHead();
                    m_partView.beginRows();
                end;

                m_partView.printRow(iterator.currentItem.fieldValue("currencyName").exact, iterator.currentItem.fieldValue("fiCode").exact, i, m_part);
                i = i + 1;

                j = j + 1;
                if (j > MAX_CURRENCY_FOR_EXCEL)
                    i = 3;
                    j = 1;
                    m_partView.endRows();
                end;
                iterator.moveNext()
            end;

            m_partView.endRows();
        else
            m_partView.printHead();
            m_partView.beginRows();

            while(not iterator.isDone())
                m_partView.printRow(iterator.currentItem.fieldValue("currencyName").exact, iterator.currentItem.fieldValue("fiCode").exact, i, m_part);
                i = i + 1;

                iterator.moveNext()
            end;

            m_partView.endRows();
        end;
    end;

    macro print()
        checkReport();

        getReportView().setOutputFile();
        getReportView().setReportWidth(m_reportWidth);
        getReportView().printLendingAgencyCodeZone();
        getReportView().printNamesZone();
        m_partView.beginDescription();
        m_partView.printDescription("unitName", m_partView.getUnitName());

        if (getReport().isEmpty())
            m_partView.printDescription("isNullData", "0");
            m_partView.endDescription();
        else
            printDataZone();
        end;
    end;

    private macro destructor()
        if (m_format == WINREP_FORMAT_XLSX)
            var view = getReportView();
            view.printSignatureZone();

            if (not m_protocolView.isEmpty())
                m_protocolView.show();
            end;

            view.resetOutputFile();
            view.createExcel();
            view.showExcel();
        else
            destructor();
        end;
    end;

    private macro constructorF652ReportPrintController(format)
        initRcbReportPrintController();

        m_format = nvl(format, WINREP_FORMAT_HTML);

        if (m_format == WINREP_FORMAT_XLSX)
            m_reportWidth = 95 + 18 * ternary(RcbApplication().currentReport.attributeValue("СписокВалют").createValueIterator().count > MAX_CURRENCY_FOR_EXCEL,
                                              MAX_CURRENCY_FOR_EXCEL,
                                              RcbApplication().currentReport.attributeValue("СписокВалют").createValueIterator().count);
        else
            m_reportWidth = 95 + 18 * RcbApplication.currentReport.attributeValue("СписокВалют").createValueIterator().count;
        end;

        m_part     = getReport().getPart("");
        m_partView = getReportView().getPartView("")
    end;

    constructorF652ReportPrintController(format)
end;

class (F652ReportPrintController) F652ReportPrintController_3198(format)
    initF652ReportPrintController(format);

    private macro printDataZone()
        var iterator = RcbApplication.currentReport.attributeValue("СписокВалют").createValueIterator();
        iterator.moveFirst();

        m_partView.endDescription();

        var i = 3;
        var j = 1;

        if (m_format == WINREP_FORMAT_XLSX)
            while(not iterator.isDone())
                if (j == 1)
                    m_partView.printHead();
                    m_partView.beginRows();
                end;

                m_partView.printRow(iterator.currentItem.fieldValue("currencyName").exact, iterator.currentItem.fieldValue("fiCode").exact, i, m_part);
                i = i + 1;

                    j = j + 1;
                if (j > MAX_CURRENCY_FOR_EXCEL)
                    i = 3;
                    j = 1;
                    m_partView.endRows();
                end;
                iterator.moveNext()
            end;

            m_partView.endRows();
        else
            m_partView.printHead();
            m_partView.beginRows();

            while(not iterator.isDone())
                m_partView.printRow(iterator.currentItem.fieldValue("currencyName").exact, iterator.currentItem.fieldValue("fiCode").exact, i, m_part);
                i = i + 1;
                iterator.moveNext()
            end;

            m_partView.endRows();
        end;
    end;

    macro print()
        checkReport();

        getReportView().setOutputFile();

        getReportView().setReportWidth(m_reportWidth);
        getReportView().printLendingAgencyCodeZone();
        getReportView().printNamesZone();
        m_partView.beginDescription();
        m_partView.printDescription("unitName", m_partView.getUnitName());

        printDataZone();
    end;

    private macro constructorF652ReportPrintController_3198(format)
        initRcbReportPrintController();

        m_format = nvl(format, WINREP_FORMAT_HTML);

        if (m_format == WINREP_FORMAT_XLSX)
            m_reportWidth = 84 + 22 * ternary(RcbApplication().currentReport.attributeValue("СписокВалют").createValueIterator().count > MAX_CURRENCY_FOR_EXCEL,
                                              MAX_CURRENCY_FOR_EXCEL,
                                              RcbApplication().currentReport.attributeValue("СписокВалют").createValueIterator().count);
        else
            m_reportWidth = 84 + 22 * RcbApplication.currentReport.attributeValue("СписокВалют").createValueIterator().count;
        end;
    end;

    constructorF652ReportPrintController_3198(format);
end;

class (F652ReportPrintController) F652ReportPrintController_4637(format)
    //initF652ReportPrintController();

    private macro printDataZone()
        var iterator = RcbApplication.currentReport.attributeValue("СписокВалют").createValueIterator();
        iterator.moveFirst();

        var i = 3;
        var j = 1;

        if (m_format == WINREP_FORMAT_XLSX)
            while(not iterator.isDone())
                if (j == 1)
                    m_partView.printHead();
                    m_partView.beginRows();
                end;

                m_partView.printRow(iterator.currentItem.fieldValue("currencyName").exact, iterator.currentItem.fieldValue("fiCode").exact, i, m_part);
                i = i + 1;

                    j = j + 1;
                if (j > MAX_CURRENCY_FOR_EXCEL)
                    i = 3;
                    j = 1;
                    m_partView.endRows();
                end;
                iterator.moveNext()
            end;

            m_partView.endRows();
        else
            m_partView.printHead();
            m_partView.beginRows();

            while(not iterator.isDone())
                m_partView.printRow(iterator.currentItem.fieldValue("currencyName").exact, iterator.currentItem.fieldValue("fiCode").exact, i, m_part);
                i = i + 1;
                iterator.moveNext()
            end;

            m_partView.endRows();
        end;
    end;

    macro print()
        checkReport();

        getReportView().setOutputFile();
        getReportView().setReportWidth(m_reportWidth);
        getReportView().printLendingAgencyCodeZone();
        getReportView().printNamesZone();

        printDataZone();
    end;

    private macro constructorF652ReportPrintController_4637(format)
        initF652ReportPrintController(format);

        m_format = nvl(format, WINREP_FORMAT_HTML);

        if (m_format == WINREP_FORMAT_XLSX)
            m_reportWidth = 84 + 22 * ternary(RcbApplication().currentReport.attributeValue("СписокВалют").createValueIterator().count > MAX_CURRENCY_FOR_EXCEL,
                                              MAX_CURRENCY_FOR_EXCEL,
                                              RcbApplication().currentReport.attributeValue("СписокВалют").createValueIterator().count);
        else
            m_reportWidth = 84 + 22 * RcbApplication().currentReport.attributeValue("СписокВалют").createValueIterator().count;
        end;
    end;

    constructorF652ReportPrintController_4637(format);
end;
