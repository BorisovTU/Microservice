/*
$Name:          f652Report.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 652. Отчет
*/

/**
 * Форма 652. Отчет.
 *
 * @since   04.07.2013
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

class (RcbReportBase) F652Report(report : RcbReport, isLazy : Bool)
    private var m_attributeValue;
    private var m_attributeValueListCurrency;
    private var m_partListCurrency;

    private macro getAttributeValue()   

        if (m_attributeValue == null)
            m_attributeValue = m_rcbReport.attributeValue("ДанныеОтчета");
        end;
        
        return m_attributeValue;
    end;

    private macro getAttributeValueListCurrency()   

        if (m_attributeValueListCurrency == null)
            m_attributeValueListCurrency = m_rcbReport.attributeValue("СписокВалют");
        end;
        
        return m_attributeValueListCurrency;
    end;

    private macro getPartCompositeValue(line : String)
        var keyValue = getAttributeValue().createKeyValue();

        keyValue.fieldValue("line") = line;

        var compositeValue = getAttributeValue().findValue(keyValue);

        if (compositeValue != null)
            return compositeValue;
        end;

        compositeValue = getAttributeValue().addValue();
        compositeValue.reset();
        compositeValue.fieldValue("line").exact = line;

        return compositeValue;
    end;

    macro getListCurrency()
        return m_partListCurrency;
    end;

    private macro getPartCompositeValueListCurrency(fiCode : String)
        var keyValue = getAttributeValueListCurrency().createKeyValue();

        keyValue.fieldValue("fiCode") = fiCode;

        var compositeValue = getAttributeValueListCurrency().findValue(keyValue);

        if (compositeValue != null)
            return compositeValue;
        end;

        compositeValue = getAttributeValueListCurrency().addValue();
        compositeValue.reset();
        compositeValue.fieldValue("fiCode").exact = fiCode;

        return compositeValue;
    end;

    macro initialize()
    end;

    macro isEmpty()
        return getPart("").isEmpty;
    end;

    private macro constructorF652Report(report : RcbReport, isLazy : Bool)
        initRcbReportBase(report, isLazy);
        m_attributeValue = m_rcbReport.attributeValue("ДанныеОтчета");
        m_partListCurrency = objectFactoryInstance.createPartListCurrency("", getPartCompositeValueListCurrency(""));
    end;

    constructorF652Report(report, isLazy);
end;
