/*
$Name:          f634Normalizer.mac
$Module:        ê•£´†¨•≠‚®‡„•¨†Ô Æ‚Á•‚≠Æ·‚Ï
$Description:   îÆ‡¨† 634. çÆ‡¨†´®ß†‚Æ‡
*/

import rcbimport;
import ReptcbCommon;
import ReportNormalizer;
import ReportLinearRelation;
import RcbCoreINter;

class (TProtocolView) F634NormalizationProtocolView()
    initTProtocolView("èêéíéäéã èêéñÖÑìêõ çéêåÄãàáÄñàà");

    private var m_isHeadPrinted = false;
    private var m_isSeparatorPrinted = false;

// 27.04.2011 ABP çÆ‡¨†´®ß†Ê®Ô ¢‡•¨•≠≠Æ Æ‚™´ÓÁ•≠†. è‡® ¢™´ÓÁ•≠®® „§†´®‚Ï ¨•‚Æ§
macro printHead()
    printHead();
    println("\tçéêåÄãàáÄñàü éíäãûóÖçÄ");
end;

    macro printNullData()
        [    äÆ‡‡•™‚®‡Æ¢Æ™ Æ™‡„£´•≠≠ÎÂ ß≠†Á•≠®© ·®¨¢Æ´Æ¢ ≠• ØÆ‚‡•°Æ¢†´Æ·Ï.];
    end;

    macro beginProtocol()
        setProtocolOutput();
        printHead();
    end;

    macro printSeparatorLine()
        if(m_isSeparatorPrinted)
            [√ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ¥];
        end;
    end;

    macro endProtocol()
        if (m_isHeadPrinted)
            [¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒŸ];
            [ ];
        end;
        if (m_isEmpty)
            printNullData();
        end;
        resetProtocolOutput();
    end;

    macro printString(str : String, exact : Money, scaled : Money, normalized : Money)
        if (not m_isHeadPrinted)
            [⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø];
            [≥                               ≥                             á≠†Á•≠®•                         ≥];
            [≥   Ç†´Ó‚† / É‡†‰†              √ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¥];
            [≥                               ≥ Ñ•©·‚¢®‚•´Ï≠Æ• ≥ é™‡„£´•≠≠Æ•    ≥ çÆ‡¨†´®ßÆ¢†≠≠Æ• ≥ ê†ß≠Æ·‚Ï ≥];
            [√ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ¥];
            m_isHeadPrinted = true;
            m_isSeparatorPrinted = true;
        end;

        [≥###############################≥################≥################≥#################≥##########≥]
        (str, exact, scaled : 5 : 5, normalized : 5 : 5, abs(scaled - normalized) : 5 : 5);

        m_isEmpty = false;
    end;
end;

class TFilterByReportDate(reportDate : date, fieldName : String)
    private var m_reportDate = reportDate;
    private var m_fieldName  = fieldName;

    macro isSuitable(v)
        return (v.fieldValue(m_fieldName).exact == m_reportDate);
    end;
end;

class  (ReportNormalizer) F634Normalizer(protocolView)
    initReportNormalizer(rcbApplication.currentReport.multiplier);
    private var m_protocolView;
    private var m_report;

    private macro initialize()
        m_protocolView = F634NormalizationProtocolView();
        m_report       = rcbApplication.currentReport;
    end;


    private macro initializeNode(currentNode, id, item, fieldName)

        var node = currentNode.addNode(id + "_" + fieldName);

        node.setExact(Money(item.fieldValue(fieldName).exact) * 10000);
//        node.setScaled(Money(item.fieldValue(fieldName).Scaled) * 10000);

        node.recalculateScaled();

        return node;
    end;

    macro getCapitalValue(capitalDate : date)
        var iteratorCapital;
        iteratorCapital = m_report.attributeValue("Ñ†≠≠Î•ä†Ø®‚†´†").createValueIterator();

        if (not in(m_report.context.period.kind, RCB_PK_TEN_DAYS))
            iteratorCapital.setFilter(TFilterByReportDate(capitalDate, "date"));
        end;

        iteratorCapital.moveFirst();

        if (not iteratorCapital.isDone())
            return iteratorCapital.currentItem.fieldValue("value").scaled;
        else
            return 0.00;
        end;

    end;

    macro addRules()
        var iteratorOCP;
        var iteratorTotal;
        var capital;
        var reportDate;
        var ocp13;
        var ocp14;
        var tempNode;
        var curCode;
        var currencyCount;

        var relation1, relation2, relation3, relation4, relation5, relation6, relation7, relation8, relation9, relation10,
            relation11, relation12, relation13, relation14, relation15, relation16, relation17, relation18, relation19, relation20,
            relation21, relation22, relation23, relation24, relation25, relation26, relation27, relation28, relation29, relation30,
            relation31, relation32, relation33, relation34, relation35, relation36, relation37;
        var node4, // Á®·‚†Ô ØÆß®Ê®Ô ·ØÆ‚
            node5, // Á®·‚†Ô ØÆß®Ê®Ô ·‡ÆÁ≠†Ô
            node6, // Á®·‚†Ô ØÆß®Ê®Ô ÆØÊ®Æ≠≠†Ô
            node7, node3, node8, node9, node11, node12, node13, node14, node15, nodeDP_13, nodeKP_14, nodeDBP_13,
            nodeBOVP_15, nodeKBP_14, nodeDOVP_13, nodeKOVP_14, nodeSumOVP_15;

        reportDate = m_report.context.period.endDate;
        capital = double(getCapitalValue(reportDate)) * 10000;

        iteratorOCP   = m_report.attributeValue("éÇè").createValueIterator();
        iteratorTotal = m_report.attributeValue("à‚Æ£®").createValueIterator();
        iteratorTotal.setFilter(TFilterByReportDate(reportDate, "é‚Á•‚≠†Ô §†‚†"));
        iteratorOCP.setFilter(TFilterByReportDate(reportDate, "é‚Á•‚≠†Ô §†‚†"));

        iteratorTotal.moveFirst();
        iteratorOCP.moveFirst();

        ocp13 = 0;
        ocp14 = 0;
        currencyCount = 0;

        relation18 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
        relation19 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);

        relation20 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
        relation21 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);

        while (not iteratorOCP.isDone())
            curCode = iteratorOCP.currentItem.fieldValue("äÆ§ ¢†´Ó‚Î").currentAsString;

            if (iteratorOCP.currentItem.fieldValue("Ç†´Ó‚†/¨•‚†´´").exact == RCB_FIKIND_METAL)
                iteratorOCP.currentItem.fieldValue("3").scaled  = iteratorOCP.currentItem.fieldValue("3").exact;
                iteratorOCP.currentItem.fieldValue("4").scaled  = iteratorOCP.currentItem.fieldValue("4").exact;
                iteratorOCP.currentItem.fieldValue("5").scaled  = iteratorOCP.currentItem.fieldValue("5").exact;
                iteratorOCP.currentItem.fieldValue("6").scaled  = iteratorOCP.currentItem.fieldValue("6").exact;
                iteratorOCP.currentItem.fieldValue("7").scaled  = iteratorOCP.currentItem.fieldValue("7").exact;
                iteratorOCP.currentItem.fieldValue("8").scaled  = iteratorOCP.currentItem.fieldValue("8").exact;
                iteratorOCP.currentItem.fieldValue("9").scaled  = iteratorOCP.currentItem.fieldValue("9").exact;
                iteratorOCP.currentItem.fieldValue("10").scaled = iteratorOCP.currentItem.fieldValue("10").exact;
                iteratorOCP.currentItem.fieldValue("11").scaled = iteratorOCP.currentItem.fieldValue("11").exact;
            end;

            node8  = initializeNode(this, curCode, iteratorOCP.currentItem, "8");
            node3  = initializeNode(this, curCode, iteratorOCP.currentItem, "3");
            node4  = initializeNode(this, curCode, iteratorOCP.currentItem, "4");
            node5  = initializeNode(this, curCode, iteratorOCP.currentItem, "5");
            node6  = initializeNode(this, curCode, iteratorOCP.currentItem, "6");
            node7  = initializeNode(this, curCode, iteratorOCP.currentItem, "7");
            node9  = initializeNode(this, curCode, iteratorOCP.currentItem, "9");
            node11 = initializeNode(this, curCode, iteratorOCP.currentItem, "11");
            node12 = initializeNode(this, curCode, iteratorOCP.currentItem, "12");
            node13 = initializeNode(this, curCode, iteratorOCP.currentItem, "13");
            node14 = initializeNode(this, curCode, iteratorOCP.currentItem, "14");
            node15 = initializeNode(this, curCode, iteratorOCP.currentItem, "15");

            if (iteratorOCP.currentItem.fieldValue("Ç†´Ó‚†/¨•‚†´´").exact == RCB_FIKIND_CURRENCY)
                if (iteratorOCP.currentItem.fieldValue("13").scaled > 0)
                    relation1 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                    relation1.lhs.plus(node13);
                    relation1.lhs.minus(double(node12.getExact()) / 10000, node11);
                    relation1.rhs.plus(-1.00);
                    addRelation(relation1);

                    relation2 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                    relation2.lhs.plus(node13);
                    relation2.lhs.minus(double(node12.getExact())/ 10000, node11);
                    relation2.rhs.plus(1.00);
                    addRelation(relation2);
                end;

                if (iteratorOCP.currentItem.fieldValue("14").scaled < 0)
                    relation3 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                    relation3.lhs.plus(node14);
                    relation3.lhs.minus(double(node12.getExact())/10000, node11);
                    relation3.rhs.plus(-1.00);
                    this.addRelation(relation3);

                    relation4 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                    relation4.lhs.plus(node14);
                    relation4.lhs.minus(double(node12.getExact())/10000, node11);
                    relation4.rhs.plus(1.00);
                    this.addRelation(relation4);
                end;



                relation5 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                relation5.lhs.plus(node8).minus(node3).minus(node4);
                relation5.rhs.plus(-1);
                this.addRelation(relation5);

                relation6 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                relation6.lhs.plus(node8).minus(node3).minus(node4);
                relation6.rhs.plus(1);
                this.addRelation(relation6);

                relation7 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                relation7.lhs.plus(node11).minus(node8).minus(node9);
                relation7.rhs.plus(-1.00);
                this.addRelation(relation7);

                relation8 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                relation8.lhs.plus(node11).minus(node8).minus(node9);
                relation8.rhs.plus(1.00);
                this.addRelation(relation8);

                relation9 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                relation9.lhs.plus(node9);
                relation9.rhs.plus(node5).plus(node6).plus(node7);
                this.addRelation(relation9);

            elif (iteratorOCP.currentItem.fieldValue("Ç†´Ó‚†/¨•‚†´´").exact == RCB_FIKIND_METAL)
                if (iteratorOCP.currentItem.fieldValue("13").scaled > 0)
                    relation10 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                    relation10.lhs.plus(node13).minus(double(node11.getScaled()) * double(node12.getExact()) / 10000);
                    relation10.rhs.plus(-1.00);
                    this.addRelation(relation10);

                    relation11 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                    relation11.lhs.plus(node13).minus(double(node11.getScaled()) * double(node12.getScaled()) / 10000);
                    relation11.rhs.plus(1.00);
                    this.addRelation(relation11);
                end;

                if (iteratorOCP.currentItem.fieldValue("14").scaled < 0)
                    relation12 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                    relation12.lhs.plus(node14).minus(double(node11.getScaled()) * double(node12.getScaled()) / 10000);
                    relation12.rhs.plus(-1.00);
                    this.addRelation(relation12);

                    relation13 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                    relation13.lhs.plus(node14).minus(double(node11.getScaled()) * double(node12.getScaled()) / 10000);
                    relation13.rhs.plus(1.00);
                    this.addRelation(relation13);
                end;

            end;

            if (capital > 0)
                if (iteratorOCP.currentItem.fieldValue("14").scaled == 0)
                    relation14 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                    relation14.lhs.plus(double(node15.getScaled()));
                    relation14.lhs.minus(100 / capital, node13);
                    relation14.rhs.plus(-1.00);
                    this.addRelation(relation14);

                    relation15 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                    relation15.lhs.plus(double(node15.getScaled()));
                    relation15.lhs.minus(100 / capital, node13);
                    relation15.rhs.plus(1.00);
                    this.addRelation(relation15);
                elif (iteratorOCP.currentItem.fieldValue("13").scaled == 0)
                    relation16 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                    relation16.lhs.plus(double(node15.getScaled()));
                    relation16.lhs.plus(100 / capital, node14);
                    relation16.rhs.plus(-1.00);
                    this.addRelation(relation16);

                    relation17 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                    relation17.lhs.plus(double(node15.getScaled()));
                    relation17.lhs.plus(100 / capital, node14);
                    relation17.rhs.plus(1.00);
                    this.addRelation(relation17);
                end;

            end;

            if (node13.getScaled() != 0)
                relation18.lhs.minus(node13);
                relation19.lhs.minus(node13);
            end;

            if (node14.getScaled() != 0)
                relation20.rhs.plus(node14);
                relation21.rhs.plus(node14);
            end;

            currencyCount = currencyCount + 1;
            iteratorOCP.moveNext();
        end;

        nodeDP_13     = initializeNode(this, "total", iteratorTotal.currentItem, "Ñè_13");
        nodeKP_14     = initializeNode(this, "total", iteratorTotal.currentItem, "äè_14");
        nodeDBP_13    = initializeNode(this, "total", iteratorTotal.currentItem, "ÑÅè_13");
        nodeBOVP_15   = initializeNode(this, "total", iteratorTotal.currentItem, "ÅéÇè_15");
        nodeKBP_14    = initializeNode(this, "total", iteratorTotal.currentItem, "äÅè_14");
        nodeDOVP_13   = initializeNode(this, "total", iteratorTotal.currentItem, "ÑéÇè_13");
        nodeKOVP_14   = initializeNode(this, "total", iteratorTotal.currentItem, "äéÇè_14");
        nodeSumOVP_15 = initializeNode(this, "total", iteratorTotal.currentItem, "ë„¨éÇè_15");

        relation18.lhs.plus(nodeDP_13);
        relation18.rhs.plus(-currencyCount / 2);
        this.addRelation(relation18);

        relation19.lhs.plus(nodeDP_13);
        relation19.rhs.plus(currencyCount / 2);
        this.addRelation(relation19);

//nodeKP_14.exclude();
        relation20.lhs.plus(nodeKP_14);
        relation20.rhs.plus(-currencyCount / 2);
        this.addRelation(relation20);

        relation21.lhs.plus(nodeKP_14);
        relation21.rhs.plus(currencyCount / 2);
        this.addRelation(relation21);

        relation22 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
        relation22.lhs.plus(nodeDOVP_13).minus(nodeDBP_13).minus(nodeDP_13);
        relation22.rhs.plus(-1.00);
        this.addRelation(relation22);

        relation23 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation23.lhs.plus(nodeDOVP_13).minus(nodeDBP_13).minus(nodeDP_13);
        relation23.rhs.plus(1.00);
        this.addRelation(relation23);

        relation24 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
        relation24.lhs.plus(nodeKOVP_14).minus(nodeKBP_14).minus(nodeKP_14);
        relation24.rhs.plus(-1.00);
        this.addRelation(relation24);

        relation25 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation25.lhs.plus(nodeKOVP_14).minus(nodeKBP_14).minus(nodeKP_14);
        relation25.rhs.plus(1.00);
        this.addRelation(relation25);

        relation26 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
        relation26.lhs.plus(nodeDOVP_13).plus(nodeKOVP_14);
        relation26.rhs.plus(-1.00);
        this.addRelation(relation26);

        relation27 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation27.lhs.plus(nodeDOVP_13).plus(nodeKOVP_14);
        relation27.rhs.plus(1.00);
        this.addRelation(relation27);

        if (iteratorTotal.currentItem.fieldValue("Ñè_13").scaled + iteratorTotal.currentItem.fieldValue("äè_14").scaled < 0)
            relation28 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
            relation28.lhs.plus(nodeDBP_13).plus(nodeDP_13).plus(nodeKP_14);
            relation28.rhs.plus(-1.00);
            this.addRelation(relation28);

            relation29 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation29.lhs.plus(nodeDBP_13).plus(nodeDP_13).plus(nodeKP_14);
            relation29.rhs.plus(1.00);
            this.addRelation(relation29);
        elif (iteratorTotal.currentItem.fieldValue("Ñè_13").scaled + iteratorTotal.currentItem.fieldValue("äè_14").scaled > 0)
            relation30 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
            relation30.lhs.plus(nodeKBP_14).plus(nodeDP_13).plus(nodeKP_14);
            relation30.rhs.plus(-1.00);
            this.addRelation(relation30);

            relation31 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation31.lhs.plus(nodeKBP_14).plus(nodeDP_13).plus(nodeKP_14);
            relation31.rhs.plus(1.00);
            this.addRelation(relation31);
        end;

        if (capital > 0)
            if (iteratorTotal.currentItem.fieldValue("äè_14").scaled == 0)
                relation32 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                relation32.lhs.plus(double(nodeBOVP_15.getScaled()));
                relation32.lhs.minus(100 / capital, nodeDBP_13);
                relation32.rhs.plus(-1.00);
                this.addRelation(relation32);

                relation33 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                relation33.lhs.plus(double(nodeBOVP_15.getScaled()));
                relation33.lhs.minus(100 / capital, nodeDBP_13);
                relation33.rhs.plus(1.00);
                this.addRelation(relation33);
            end;

            if (iteratorTotal.currentItem.fieldValue("Ñè_13").scaled == 0)
                relation34 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
                relation34.lhs.plus(double(nodeBOVP_15.getScaled()));
                relation34.lhs.plus(100 / capital, nodeKBP_14);
                relation34.rhs.plus(-1.00);
                this.addRelation(relation34);

                relation35 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                relation34.lhs.plus(double(nodeBOVP_15.getScaled()));
                relation34.lhs.plus(100 / capital, nodeKBP_14);
                relation35.rhs.plus(1.00);
                this.addRelation(relation35);
            end;

            relation36 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
            relation36.lhs.plus(double(nodeSumOVP_15.getScaled()));
            relation36.lhs.minus(100 / capital, nodeDOVP_13);
            relation36.rhs.plus(-1.00);
            this.addRelation(relation36);

            relation37 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation36.lhs.plus(double(nodeSumOVP_15.getScaled()));
            relation36.lhs.minus(100 / capital, nodeDOVP_13);
            relation37.rhs.plus(1.00);
            this.addRelation(relation37);

        end;
    end;

    macro save()
        var iteratorOCP, iteratorTotal, tempNode, curCode, i;
        var reportDate;

        reportDate = m_report.context.period.endDate;

        iteratorOCP   = m_report.attributeValue("éÇè").createValueIterator();
        iteratorTotal = m_report.attributeValue("à‚Æ£®").createValueIterator();
        iteratorTotal.setFilter(TFilterByReportDate(reportDate, "é‚Á•‚≠†Ô §†‚†"));
        iteratorOCP.setFilter(TFilterByReportDate(reportDate, "é‚Á•‚≠†Ô §†‚†"));

        iteratorTotal.moveFirst();
        iteratorOCP.moveFirst();

        while (not iteratorOCP.isDone())
            m_protocolView.printSeparatorLine();
            curCode = iteratorOCP.currentItem.fieldValue("äÆ§ ¢†´Ó‚Î").currentAsString;
            i = 3;

            while (i < 16)
                if ((i != 10) and (i != 12))
                    tempNode = node(curCode + "_" + String(i));
                    m_protocolView.printString(curCode + ": " + string(i), tempNode.getExact() / 10000 , iteratorOCP.currentItem.fieldValue(string(i)).scaled, Money(tempNode.getScaled())/ 10000);
                    iteratorOCP.currentItem.fieldValue(string(i)).scaled = Money(tempNode.scaled()) / 10000 ;
                end;
                i = i + 1;
            end;

            iteratorOCP.moveNext();
        end;

       if (not iteratorTotal.isDone())
            m_protocolView.printSeparatorLine();

           tempNode = node("total_Ñè_13");
           m_protocolView.printString("à‚Æ£Æ : Ñè_13", tempNode.getExact() / 10000, iteratorTotal.currentItem.fieldValue("Ñè_13").scaled, Money(tempNode.getScaled()) / 10000);
           iteratorTotal.currentItem.fieldValue("Ñè_13").scaled = Money(tempNode.getScaled()) / 10000;

           tempNode = node("total_äè_14");
           m_protocolView.printString("à‚Æ£Æ : äè_14", tempNode.getExact() / 10000, iteratorTotal.currentItem.fieldValue("äè_14").scaled, Money(tempNode.getScaled()) / 10000);
           iteratorTotal.currentItem.fieldValue("äè_14").scaled = Money(tempNode.getScaled()) / 10000;

           tempNode = node("total_ÑÅè_13");
           m_protocolView.printString("à‚Æ£Æ : ÑÅè_13", tempNode.getExact() / 10000, iteratorTotal.currentItem.fieldValue("ÑÅè_13").scaled, Money(tempNode.getScaled()) / 10000);
           iteratorTotal.currentItem.fieldValue("ÑÅè_13").scaled = Money(tempNode.getScaled()) / 10000;

           tempNode = node("total_ÅéÇè_15");
           m_protocolView.printString("à‚Æ£Æ : ÅéÇè_15", tempNode.getExact() / 10000, iteratorTotal.currentItem.fieldValue("ÅéÇè_15").scaled, Money(tempNode.getScaled()) / 10000);
           iteratorTotal.currentItem.fieldValue("ÅéÇè_15").scaled = Money(tempNode.getScaled()) / 10000;

           tempNode = node("total_äÅè_14");
           m_protocolView.printString("à‚Æ£Æ : äÅè_14", tempNode.getExact() / 10000, iteratorTotal.currentItem.fieldValue("äÅè_14").scaled, Money(tempNode.getScaled()) / 10000);
           iteratorTotal.currentItem.fieldValue("äÅè_14").scaled = Money(tempNode.getScaled()) / 10000;

           tempNode = node("total_ÑéÇè_13");
           m_protocolView.printString("à‚Æ£Æ : ÑéÇè_13", tempNode.getExact() / 10000, iteratorTotal.currentItem.fieldValue("ÑéÇè_13").scaled, Money(tempNode.getScaled()) / 10000);
           iteratorTotal.currentItem.fieldValue("ÑéÇè_13").scaled = Money(tempNode.getScaled()) / 10000;

           tempNode = node("total_äéÇè_14");
           m_protocolView.printString("à‚Æ£Æ : äéÇè_14", tempNode.getExact() / 10000, iteratorTotal.currentItem.fieldValue("äéÇè_14").scaled, Money(tempNode.getScaled()) / 10000);
           iteratorTotal.currentItem.fieldValue("äéÇè_14").scaled = Money(tempNode.getScaled()) / 10000;

           tempNode = node("total_ë„¨éÇè_15");
           m_protocolView.printString("à‚Æ£Æ : ë„¨éÇè_15", tempNode.getExact() / 10000, iteratorTotal.currentItem.fieldValue("ë„¨éÇè_15").scaled, Money(tempNode.getScaled()) / 10000);
           iteratorTotal.currentItem.fieldValue("ë„¨éÇè_15").scaled = Money(tempNode.getScaled()) / 10000;
        end;

    end;

    macro execute()
        var normilizer;

        RcbApplication().TransactionManager().commit();

        m_protocolView.beginProtocol();
// 27.04.2011 ABP çÆ‡¨†´®ß†Ê®Ô ¢‡•¨•≠≠Æ Æ‚™´ÓÁ•≠†.
m_protocolView.endProtocol();
return;

        addRules();

        normalize();

        if (isNormalized())
            save();
        else
            m_protocolView.printLine("ç• „§†´Æ·Ï ≠Æ‡¨†´®ßÆ¢†‚Ï §†≠≠Î•.");
        end;

        RcbApplication.TransactionManager.commit();

        m_protocolView.endProtocol();

    end;

    initialize();

end;

class  (F634Normalizer) F634Normalizer_3468(protocolView)
    initF634Normalizer(protocolView);

    macro getCapitalValue(capitalDate : date)
        var iteratorCapital;
        iteratorCapital = m_report.attributeValue("Ñ†≠≠Î•ä†Ø®‚†´†").createValueIterator();

        if (not in(m_report.context.period.kind, RCB_PK_MONTH))
            iteratorCapital.setFilter(TFilterByReportDate(capitalDate, "date"));
        end;

        iteratorCapital.moveFirst();

        if (not iteratorCapital.isDone())
            return iteratorCapital.currentItem.fieldValue("value").scaled;
        else
            return 0.00;
        end;

    end;
end;

macro executeNormalizationOperation()
    // 27.04.2011 ABP Ç‡•¨•≠≠Æ Æ‚™´ÓÁ•≠Æ. ë¨. F634NormalizationProtocolView::printHead() ® F634Normalizer::execute()
    if (rcbApplication.currentReport.normalizationAlgorithm == RCB_NA_MMB)
        if (rcbApplication.currentReport.context.period.endDate >= RCB_I3468_DATE)
            F634Normalizer_3468(F634NormalizationProtocolView());
        else
            F634Normalizer(F634NormalizationProtocolView()).execute();
        end;
    end;
end;

„·‚†≠Æ¢®‚Ïî´†£ÇÆß¢‡†‚†(OK_MACRO_FLAG);
exit(1);