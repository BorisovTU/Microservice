 /*
 $Name:  f155ReportView.mac
 $Module:Регламентируемая отчетность
 $Description:   Форма 155. Представление отчетной формы.
 */

/**
* Форма 155. Представление отчетной формы.
*
* @since   08.10.2008
* @author  Ivkina Olga
* @version 6.00.020.29
*/
import treport;
import RcbPrintableView;

class (TNamesZone_2742) TNamesZone_3129(formName, formOkudCode, formPeriodicity, periodFormat)

    private macro constructorTNamesZone_3129(formName, formOkudCode, formPeriodicity, periodFormat)
        initTNamesZone_2742(formName, formOkudCode, formPeriodicity, periodFormat);
    end;

    macro print(reportWidth)

        var i = 0;

        println();

        var formName : TArray;

        formName = strTransferByWord(m_formName, reportWidth, STR_ALIGN_CENTER);
        while (i < formName.size)
            println(strAlign(formName[i], reportWidth, STR_ALIGN_CENTER));
            i = i + 1;
        end;

        println();
        println(strAlign(getPeriodName(), reportWidth, STR_ALIGN_CENTER));
        println();

        printLendingAgencyName(reportWidth);

        var postAddressDescription = "Почтовый адрес ";
        var postAddress : TArray;
        postAddress = strTransferByWord(ternary((m_lendingAgencyPostalAdress == ""), " ", m_lendingAgencyPostalAdress), reportWidth - strLen(postAddressDescription), STR_ALIGN_LEFT);
        i = 1;
        println(strAlign(postAddressDescription + postAddress[0], reportWidth, STR_ALIGN_LEFT));
        while (i < postAddress.size)
            println(strAlign(mkStr(" ", strLen(postAddressDescription)) + postAddress[i], reportWidth, STR_ALIGN_LEFT));
            i = i + 1;
        end;

        println();

        if (not isAttributeExcluded(AC_FORM_OKUD_CODE))
            println(getOkudString(reportWidth));
        end;

        if (not isAttributeExcluded(AC_FORM_PERIODICITY))
            println(strAlign(m_formPeriodicity, reportWidth, STR_ALIGN_RIGHT));
        end;

        println();
    end;

    constructorTNamesZone_3129(formName, formOkudCode, formPeriodicity, periodFormat);
end;

class (TPrintableView_2851) TPrintableView_3129(formName, formOkudCode, formPeriodicity, periodFormat)
    private macro constructorTPrintableReport(formName, formOkudCode, formPeriodicity, periodFormat)

        defineFileName(formOkudCode);

        m_lendingAgencyCodeZone  = TLendingAgencyCodeZone_2851();
        m_namesZone              = TNamesZone_3129(formName, formOkudCode, formPeriodicity, periodFormat);
        m_signatureZone          = TSignatureZone();

        m_standardZoneWidth = 0;
    end;

    /**
     * Напечатать единицы измерения.
     */
    macro printUnitName(reportWidth)
        m_namesZone.printUnitName(reportWidth);
    end;

    initTPrintableView_2851(formName, formOkudCode, formPeriodicity, periodFormat);

end;
/**
* Класс представления отчетной формы.
*/
class TDescriptorPartView()
    /**
    * Описатель строк.
    */
    private var m_stringDescriptor = TArray();

    /**
    * Добавить описание строки.
    */
    macro addStringDescriptor(name, descriptor)
        m_stringDescriptor[m_stringDescriptor.size] = ArrCreate(name, descriptor);
    end;

    /**
    * Получить описание строки.
    */
    macro getStringDescriptor(name)
        var i = 0;
        while (i < m_stringDescriptor.size)
            if (m_stringDescriptor[i][0] == name)
                return m_stringDescriptor[i][1];
            end;
            i = i + 1;
        end;
    end;
end;

/**
* Класс представления отчетной формы.
*/
class (TDescriptorPartView) TDescriptorPart1View()
        initTDescriptorPartView();
        addStringDescriptor("1"      , "Неиспользованные кредитные линии, всего, в том числе:"                                                             );
        addStringDescriptor("1.1"    , "со сроком более 1 года"                                                                                            );
        addStringDescriptor("2"      , "Аккредитивы, всего, в том числе:"                                                                                  );
        addStringDescriptor("2.1"    , "со сроком более 1 года"                                                                                            );
        addStringDescriptor("3"      , "Выданные гарантии и поручительства, всего, в том числе:"                                                           );
        addStringDescriptor("3.1"    , "со сроком более 1 года"                                                                                            );
        addStringDescriptor("4"      , "Выпущенные авали и акцепты, всего, в том числе:"                                                                   );
        addStringDescriptor("4.1"    , "со сроком более 1 года"                                                                                            );
        addStringDescriptor("5"      , "Прочие инструменты, всего, в том числе:"                                                                           );
        addStringDescriptor("5.1"    , "со сроком более 1 года"                                                                                            );
        addStringDescriptor("6"      , "Условные обязательства кредитного характера, всего (стр.1+стр. 2+стр. 3+стр. 4+стр. 5), в том числе:"              );
        addStringDescriptor("6.1"    , "со сроком более 1 года (стр.1.1+ стр.2.1+ стр.3.1+ стр.4.1+ стр.5.1)"                                              );
        addStringDescriptor("7"      , "Условные обязательства кредитного характера, сгруппированные в портфели однородных элементов, всего, в том числе:" );
        addStringDescriptor("7.1"    , "Портфель неиспользованных кредитных линий"                                                                         );
        addStringDescriptor("7.2"    , "Портфель выданных гарантий и поручительств"                                                                        );
        addStringDescriptor("7.3"    , "Портфель акцептов и авалей"                                                                                        );
end;

/**
* Класс представления отчетной формы.
*/
class (TDescriptorPartView) TDescriptorPart2View()
        initTDescriptorPartView();
        addStringDescriptor("1",   "Форвард, всего, в том числе с базисным активом:");
        addStringDescriptor("1.1", "иностранная валюта "                            );
        addStringDescriptor("1.2", "драгоценные металлы"                            );
        addStringDescriptor("1.3", "ценные бумаги"                                  );
        addStringDescriptor("1.4", "другие"                                         );
        addStringDescriptor("2",   "Опцион, всего, в том числе с базисным активом:" );
        addStringDescriptor("2.1", "иностранная валюта"                             );
        addStringDescriptor("2.2", "драгоценные металлы"                            );
        addStringDescriptor("2.3", "ценные бумаги"                                  );
        addStringDescriptor("2.4", "другие"                                         );
        addStringDescriptor("3",   "Своп, всего, в том числе с базисным активом:"   );
        addStringDescriptor("3.1", "иностранная валюта"                             );
        addStringDescriptor("3.2", "драгоценные металлы"                            );
        addStringDescriptor("3.3", "ценные бумаги"                                  );
        addStringDescriptor("3.4", "другие"                                         );
end;


/**
* Класс представления отчетной формы.
*/
class (TDescriptorPartView) TDescriptorPart3View()
        initTDescriptorPartView();
        addStringDescriptor("1",   "Форвард, всего, в том числе с базисным активом:");
        addStringDescriptor("1.1", "иностранная валюта"                             );
        addStringDescriptor("1.2", "драгоценные металлы"                            );
        addStringDescriptor("1.3", "ценные бумаги"                                  );
        addStringDescriptor("1.4", "изменение индексов цен (кроме ценных бумаг)"    );
        addStringDescriptor("1.5", "другие"                                         );
        addStringDescriptor("2",   "Опцион, всего, в том числе с базисным активом:" );
        addStringDescriptor("2.1", "иностранная валюта"                             );
        addStringDescriptor("2.2", "драгоценные металлы"                            );
        addStringDescriptor("2.3", "ценные бумаги"                                  );
        addStringDescriptor("2.4", "изменение индексов цен (кроме ценных бумаг)"    );
        addStringDescriptor("2.5", "другие"                                         );
        addStringDescriptor("3",   "Своп, всего, в том числе с базисным активом:"   );
        addStringDescriptor("3.1", "иностранная валюта"                             );
        addStringDescriptor("3.2", "процентная ставка"                              );
        addStringDescriptor("3.3", "изменение индексов цен (кроме ценных бумаг)"    );
        addStringDescriptor("3.4", "другие"                                         );
end;

class (TDescriptorPartView) TDescriptorPart3View2742()
        initTDescriptorPartView();
        addStringDescriptor("1",   "Форвард, всего, в том числе с базисным активом:");
        addStringDescriptor("1.1", "иностранная валюта"                             );
        addStringDescriptor("1.2", "драгоценные металлы"                            );
        addStringDescriptor("1.3", "ценные бумаги"                                  );
        addStringDescriptor("1.4", "производные финансовые инструменты"             );
        addStringDescriptor("1.5", "другие"                                         );
        addStringDescriptor("2",   "Опцион, всего, в том числе с базисным активом:" );
        addStringDescriptor("2.1", "иностранная валюта"                             );
        addStringDescriptor("2.2", "драгоценные металлы"                            );
        addStringDescriptor("2.3", "ценные бумаги"                                  );
        addStringDescriptor("2.4", "производные финансовые инструменты"             );
        addStringDescriptor("2.5", "другие"                                         );
        addStringDescriptor("3",   "Фьючерс, всего, в том числе с базисным активом:");
        addStringDescriptor("3.1", "иностранная валюта"                             );
        addStringDescriptor("3.2", "драгоценные металлы"                            );
        addStringDescriptor("3.3", "ценные бумаги"                                  );
        addStringDescriptor("3.4", "производные финансовые инструменты"             );
        addStringDescriptor("3.5", "другие"                                         );
        addStringDescriptor("4",   "Своп, всего, в том числе с базисным активом:"   );
        addStringDescriptor("4.1", "иностранная валюта"                             );
        addStringDescriptor("4.2", "драгоценные металлы"                            );
        addStringDescriptor("4.3", "процентная ставка"                              );
        addStringDescriptor("4.4", "ценные бумаги"                                  );
        addStringDescriptor("4.5", "производные финансовые инструменты"             );
        addStringDescriptor("4.6", "другие"                                         );
        addStringDescriptor("5",   "Прочие сделки"                                  );
end;

class (TDescriptorPartView) TDescriptorPart2View3129()
        initTDescriptorPartView();
        addStringDescriptor("1",   "Форвард, всего, в том числе с базисным (базовым) активом:"  );
        addStringDescriptor("1.1", "иностранная валюта"                                         );
        addStringDescriptor("1.2", "драгоценные металлы"                                        );
        addStringDescriptor("1.3", "ценные бумаги"                                              );
        addStringDescriptor("1.4", "производные финансовые инструменты"                         );
        addStringDescriptor("1.5", "другие"                                                     );
        addStringDescriptor("2",   "Опцион, всего, в том числе с базисным (базовым) активом:"   );
        addStringDescriptor("2.1", "иностранная валюта"                                         );
        addStringDescriptor("2.2", "драгоценные металлы"                                        );
        addStringDescriptor("2.3", "ценные бумаги"                                              );
        addStringDescriptor("2.4", "производные финансовые инструменты"                         );
        addStringDescriptor("2.5", "другие"                                                     );
        addStringDescriptor("3",   "Фьючерс, всего, в том числе с базисным (базовым) активом:"  );
        addStringDescriptor("3.1", "иностранная валюта"                                         );
        addStringDescriptor("3.2", "драгоценные металлы"                                        );
        addStringDescriptor("3.3", "ценные бумаги"                                              );
        addStringDescriptor("3.4", "производные финансовые инструменты"                         );
        addStringDescriptor("3.5", "другие"                                                     );
        addStringDescriptor("4",   "Своп, всего, в том числе с базисным (базовым) активом:"     );
        addStringDescriptor("4.1", "иностранная валюта"                                         );
        addStringDescriptor("4.2", "драгоценные металлы"                                        );
        addStringDescriptor("4.3", "процентная ставка"                                          );
        addStringDescriptor("4.4", "иностранная валюта и процентная ставка (валютно-процентные)");
        addStringDescriptor("4.5", "ценные бумаги"                                              );
        addStringDescriptor("4.6", "производные финансовые инструменты"                         );
        addStringDescriptor("4.7", "другие"                                                     );
        addStringDescriptor("5",   "Прочие сделки"                                              );
end;

/**
* Класс представления отчетной формы.
*/
class (TDescriptorPartView) TDescriptorPart4View()
        initTDescriptorPartView();
        addStringDescriptor("1",   ". по срочным сделкам, предусматривающим поставку базисного актива, отраженным в разделе 2: ", " тыс. руб.");
        addStringDescriptor("2",   ". по срочным расчетным (беспоставочным) сделкам, отраженным в разделе 3: ", " тыс. руб.");
end;

class (TDescriptorPartView) TDescriptorPart4View2742()
        initTDescriptorPartView();
        addStringDescriptor("1",   ". по срочным сделкам, отраженным в разделе 2: ", " тыс. руб.");
        addStringDescriptor("2",   ". по производным финансовым инструментам, отраженным в разделе 3: ", " тыс. руб.");
end;

/**
* Класс представления отчетной формы.
*/
private class TPartView(name : String, reportView : TPrintableView)
    /**
    * Название раздела.
    */
    private var m_name;

    /**
    * Ссылка не представление отчетной формы.
    */
    private var m_reportView;

    /**
    * Конструктор.
    */
    private macro constructor(name : String,reportView : TPrintableView)
        m_name       = name;
        m_reportView = reportView;
    end;

    /**
    * Заголовок раздела.
    */
    macro printPartName()
        println();
        println(m_name);
    end;

    /**
    * Разделитель.
    */
    macro printSeparator()
    end;

    /**
    * Строка отчета.
    */
    macro printString()
    end;

    /**
    * Закрывашка.
    */
    macro printBottom()
        println();
    end;

    /**
    * Ширина раздела.
    */
    macro getWidth()
        return 80;
    end;

    constructor(name,reportView);
end;

/**
* Класс представления таблицы отчетной формы.
*/
private class (TPartView) TPartTableView(name : String,reportView : TPrintableView)
    /**
    *
    */
    private var m_stringDescriptor;
    /**
    * Таблица.
    */
    private var m_table = CTableReport();

    /**
    * Конструктор.
    */
    private macro constructor(name : String,reportView : TPrintableView)
        initTPartView(name,reportView);
        m_table = CTableReport();
    end;

    /**
    * Заголовок раздела.
    */
    macro printHeader()
        m_table.printHead();
    end;

    /**
    * Разделитель.
    */
    macro printSeparator()
        m_table.printSeparator();
    end;

    /**
    * Строка отчета.
    */
    macro printString()
    end;

    /**
    * Закрывашка.
    */
    macro printBottom()
        m_table.printBottom();
        println();
    end;

    /**
    * Ширина раздела.
    */
    macro getWidth()
        return  m_table.getSumLen();
    end;

    constructor(name, reportView);
end;

/**
* Класс представления отчетной формы для раздела 1.
*/
class (TPartTableView) TPart1View2055(reportView : TPrintableView)

    private macro constructor(reportView : TPrintableView)
        initTPartTableView("Раздел 1. Условные обязательства кредитного характера",
                            reportView);

        m_table.addColumn("",  3, AL_CENTER);
        m_table.addColumn("", 30, AL_LEFT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);
        m_table.addColumn("", 13, AL_RIGHT);

        m_stringDescriptor = TDescriptorPart1View();
    end;

    macro printString (number,  value3,  value4,  value5,  value6,  value7,  value8,  value9,
                                value10, value11, value12, value13, value14, value15, note)
        m_table.printStringTransferByWord(number, NVL(m_stringDescriptor.getStringDescriptor(number), note),
                                        value3,  value4,  value5, value6,  value7,  value8,
                                        value9, value10, value11, value12, value13, value14, value15 )
    end;

    macro printHeader()
[┌─────┬────────────────────────────────┬───────────────┬───────────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Номер│           Наименование         │    Сумма      │                     Категория качества                                        │                                           Резерв на возможные потери                                          │
│ п/п │           инструмента          │   условных    ├───────────────┬───────────────┬───────────────┬───────────────┬───────────────┼───────────────┬───────────────┬───────────────────────────────────────────────────────────────────────────────┤
│     │                                │ обязательств  │      I        │     II        │     III       │       IV      │       V       │   расчетный   │   расчетный   │                       фактически сформированный                               │
│     │                                │               │               │               │               │               │               │               │   с учетом    ├───────────────┬───────────────────────────────────────────────────────────────┤
│     │                                │               │               │               │               │               │               │               │  обеспечения  │    итого      │                      по категориям качества                   │
│     │                                │               │               │               │               │               │               │               │               │               ├───────────────┬───────────────┬───────────────┬───────────────┤
│     │                                │               │               │               │               │               │               │               │               │               │     II        │      III      │      IV       │     V         │
├─────┼────────────────────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┤];

        m_table.setAllCenter(true);
        m_table.printString("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15");
        m_table.setAllCenter(false);
    end;

    constructor(reportView);
end;

/**
* Класс представления отчетной формы для раздела 2,3.
*/
class (TPartTableView) TPart23View2055(name : String, reportView : TPrintableView)
    private macro constructor(name : String, reportView : TPrintableView)
        initTPartTableView(name, reportView);
    end;

    macro printString(number, value3, value4, value5, value6, value7)
        m_table.printStringTransferByWord(number, m_stringDescriptor.getStringDescriptor(number), value3, value4, value5, value6, value7);
    end;

    macro printHeader()
//        m_reportView.printZone(AC_FORM_UNIT);
        m_table.printHead();
        m_table.setAllCenter(true);
        m_table.printString("1", "2", "3", "4", "5", "6", "7");
        m_table.setAllCenter(false);
    end;

    constructor(name, reportView);
end;

class (TPartTableView) TPart23View3129(name : String, reportView : TPrintableView)
    private macro constructor(name : String, reportView : TPrintableView)
        initTPartTableView(name, reportView);
    end;

    macro printString(number, value3, value4, value5, value6)
        m_table.printStringTransferByWord(number, m_stringDescriptor.getStringDescriptor(number), value3, value4, value5, value6);
    end;

    macro printHeader()
//        m_reportView.printZone(AC_FORM_UNIT);
        m_table.printHead();
        m_table.setAllCenter(true);
        m_table.printString("1", "2", "3", "4", "5", "6");
        m_table.setAllCenter(false);
    end;

    constructor(name, reportView);
end;

/**
* Класс представления отчетной формы для раздела 2.
*/
class (TPart23View2055) TPart2View2055(reportView : TPrintableView)
    private macro constructor(reportView : TPrintableView)
        initTPart23View2055("Раздел 2. Срочные сделки, предусматривающие постановку базисного актива",
                            reportView);

        m_table.addColumn("Ном|ер|п/п",                                         3, AL_CENTER);
        m_table.addColumn("Наименование инструмента",                          30, AL_LEFT);
        m_table.addColumn("Сумма требований",                                  13, AL_RIGHT);
        m_table.addColumn("Сумма обязательств",                                13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(положительные)",  13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(отрицательные)",  13, AL_RIGHT);
        m_table.addColumn("Резерв на|возможные потери",                        13, AL_RIGHT);

        m_stringDescriptor = TDescriptorPart2View();
    end;

    constructor(reportView);
end;

/**
* Класс представления отчетной формы для раздела 3.
*/
class (TPart23View2055) TPart3View2055(reportView : TPrintableView)
    private macro constructor(reportView : TPrintableView)
        initTPart23View2055("Раздел 3. Срочные сделки расчетные (беспоставочные)",
                            reportView);

        m_table.addColumn("Ном|ер|п/п",                                         3, AL_CENTER);
        m_table.addColumn("Виды беспоставочных сделок",                        30, AL_LEFT);
        m_table.addColumn("Сумма требований",                                  13, AL_RIGHT);
        m_table.addColumn("Сумма обязательств",                                13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(положительные)",  13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(отрицательные)",  13, AL_RIGHT);
        m_table.addColumn("Резерв на|возможные потери",                        13, AL_RIGHT);

        m_stringDescriptor = TDescriptorPart3View();
    end;

    constructor(reportView);
end;

/**
* Класс представления отчетной формы для раздела 4.
*/
class (TPartView) TPart4View2055(reportView : TPrintableView)

    private var m_stringDescriptor : TArray;

    private macro addstringDescriptor(name, beginName, endName)
        m_stringDescriptor[m_stringDescriptor.size] = ArrCreate(name, beginName, endName);
    end;

    private macro getStringDescriptor(name)
        var i = 0;
        while (i < m_stringDescriptor.size)
            if (m_stringDescriptor[i][0] == name)
                return m_stringDescriptor[i][1];
            end;
            i = i + 1;
        end;
    end;

    private macro getStringEndDescriptor(name)
        var i = 0;
        while (i < m_stringDescriptor.size)
            if (m_stringDescriptor[i][0] == name)
                return m_stringDescriptor[i][2];
            end;
            i = i + 1;
        end;
    end;

    macro initDescriptor()
        addStringDescriptor("1",   ". по срочным сделкам, предусматривающим поставку базисного актива, отраженным в разделе 2: ", " тыс. руб.");
        addStringDescriptor("2",   ". по срочным расчетным (беспоставочным) сделкам, отраженным в разделе 3: ", " тыс. руб.");
    end;

    private macro constructor(reportView : TPrintableView)
        initTPartView("Раздел \"Справочно:\"",
                        reportView);

        m_stringDescriptor = TArray();
        initDescriptor();
    end;

    macro printString(number, value)
        if (value == stringUndefined)
            value = "";
        end;

        println(number, getStringDescriptor(number), value, getStringEndDescriptor(number))
    end;

    macro printHeader()
        println("Положительная переоценка по хеджирующим сделкам, принятая в уменьшение резервов на возможные потери в соответствии с требованиями главы 5 \nПоложения Банка России № 283-П:");
    end;

    constructor(reportView);
end;

/**
* Класс представления отчетной формы.
*/
class (RcbReportView) TReportView2055(formName, formOkudCode, formPeriodicity, periodFormat)
    initRcbReportView(NVL(formName,      "Сведения о финансовых инструментах, отражаемых на внебалансовых счетах"),
                    NVL(formOkudCode,    "0409155"),
                    NVL(formPeriodicity, RCB_PK_MONTH),
                    NVL(periodFormat,    DATE_OUT_PERIOD_FORMAT));
    changePrintZone(MC_LEADING_AGENCY_NAME_WHITHOUT_BRANCH);
end;

/**
* Класс представления отчетной формы для раздела 1 по 2332.
*/
class (TPart1View2055) TPart1View2332(reportView : TPrintableView)
    initTPart1View2055(reportView);

    macro printHeader(reportWidth)
[┌─────┬────────────────────────────────┬───────────────┬───────────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Номер│           Наименование         │    Сумма      │                     Категория качества                                        │                                           Резерв на возможные потери                                          │
│стро-│           инструмента          │   условных    ├───────────────┬───────────────┬───────────────┬───────────────┬───────────────┼───────────────┬───────────────┬───────────────────────────────────────────────────────────────────────────────┤
│ки   │                                │ обязательств  │      I        │     II        │     III       │       IV      │       V       │   расчетный   │   расчетный   │                       фактически сформированный                               │
│     │                                │               │               │               │               │               │               │               │   с учетом    ├───────────────┬───────────────────────────────────────────────────────────────┤
│     │                                │               │               │               │               │               │               │               │  обеспечения  │    итого      │                      по категориям качества                   │
│     │                                │               │               │               │               │               │               │               │               │               ├───────────────┬───────────────┬───────────────┬───────────────┤
│     │                                │               │               │               │               │               │               │               │               │               │     II        │      III      │      IV       │     V         │
├─────┼────────────────────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┤];

        m_table.setAllCenter(true);
        m_table.printString("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15");
        m_table.setAllCenter(false);
    end;
end;

class (TPart1View2332) TPart1View3129(reportView : TPrintableView)
    initTPart1View2332(reportView);

    macro printHeader(reportWidth)
        m_reportView.printUnitName(reportWidth);
[┌─────┬────────────────────────────────┬───────────────┬───────────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Номер│           Наименование         │    Сумма      │                     Категория качества                                        │                                           Резерв на возможные потери                                          │
│стро-│           инструмента          │   условных    ├───────────────┬───────────────┬───────────────┬───────────────┬───────────────┼───────────────┬───────────────┬───────────────────────────────────────────────────────────────────────────────┤
│ки   │                                │ обязательств  │      I        │     II        │     III       │       IV      │       V       │   расчетный   │   расчетный   │                       фактически сформированный                               │
│     │                                │               │               │               │               │               │               │               │   с учетом    ├───────────────┬───────────────────────────────────────────────────────────────┤
│     │                                │               │               │               │               │               │               │               │  обеспечения  │    итого      │                      по категориям качества                   │
│     │                                │               │               │               │               │               │               │               │               │               ├───────────────┬───────────────┬───────────────┬───────────────┤
│     │                                │               │               │               │               │               │               │               │               │               │     II        │      III      │      IV       │     V         │
├─────┼────────────────────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┤];

        m_table.setAllCenter(true);
        m_table.printString("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15");
        m_table.setAllCenter(false);
    end;
end;

/**
* Класс представления отчетной формы для раздела 2 по 2332У.
* нет наследования от 2055У раздел 2, т.к. нужно переопределить всё что там есть
*/
class (TPart23View2055) TPart2View2332(reportView : TPrintableView)
    private macro constructor(reportView : TPrintableView)
        initTPart23View2055("Раздел 2. Срочные сделки, предусматривающие постановку базисного актива",
                            reportView);

        m_table.addColumn("Но-|мер|стр|оки",                                    3, AL_CENTER);
        m_table.addColumn("Наименование инструмента",                          30, AL_LEFT);
        m_table.addColumn("Сумма требований",                                  13, AL_RIGHT);
        m_table.addColumn("Сумма обязательств",                                13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(положительные)",  13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(отрицательные)",  13, AL_RIGHT);
        m_table.addColumn("Резерв на|возможные потери",                        13, AL_RIGHT);

        m_stringDescriptor = TDescriptorPart2View();
    end;

    constructor(reportView);
end;

class (TPart23View2055) TPart2View2742(reportView : TPrintableView)
    private macro constructor(reportView : TPrintableView)
        initTPart23View2055("Раздел 2. Срочные сделки", reportView);

        m_table.addColumn("Но-|мер|стр|оки",                                    3, AL_CENTER);
        m_table.addColumn("Наименование инструмента",                          30, AL_LEFT);
        m_table.addColumn("Сумма требований",                                  13, AL_RIGHT);
        m_table.addColumn("Сумма обязательств",                                13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(положительные)",  13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(отрицательные)",  13, AL_RIGHT);
        m_table.addColumn("Резерв на|возможные потери",                        13, AL_RIGHT);

        m_stringDescriptor = TDescriptorPart2View();
        m_stringDescriptor.addStringDescriptor("4", "Прочие сделки");
    end;

    constructor(reportView);
end;

/**
* Класс представления отчетной формы для раздела 3 по 2332У.
* нет наследования от 2055У раздел 3, т.к. нужно переопределить всё что там есть
*/
class (TPart23View2055) TPart3View2332(reportView : TPrintableView)
    private macro constructor(reportView : TPrintableView)
        initTPart23View2055("Раздел 3. Срочные расчетные (беспоставочные) сделки",
                            reportView);

        m_table.addColumn("Но-|мер|стр|оки",                                    3, AL_CENTER);
        m_table.addColumn("Виды беспоставочных сделок",                        30, AL_LEFT);
        m_table.addColumn("Сумма требований",                                  13, AL_RIGHT);
        m_table.addColumn("Сумма обязательств",                                13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(положительные)",  13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(отрицательные)",  13, AL_RIGHT);
        m_table.addColumn("Резерв на|возможные потери",                        13, AL_RIGHT);

        m_stringDescriptor = TDescriptorPart3View();
    end;

    constructor(reportView);
end;

class (TPart23View2055) TPart3View2742(reportView : TPrintableView)
    macro printHeader()
[┌─────┬────────────────────────────────┬─────────────────────────────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┐
│Номер│                                │           Справедливая стоимость            │   Сумма требований   │  Сумма обязательств  │ Нереализованные кур- │ Нереализованные кур- │
│стро-│ Наименование инструмента       ├──────────────────────┬──────────────────────┤                      │                      │ совые разницы (поло- │ совые разницы (отри- │
│ки   │                                │        актива        │    обязательства     │                      │                      │      жительные)      │      цательные)      │
├─────┼────────────────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┤];

        m_table.setAllCenter(true);
        m_table.printString("1", "2", "3", "4", "5", "6", "7", "8");
        m_table.setAllCenter(false);
    end;

    macro printString(number, value3, value4, value5, value6, value7, value8)
        m_table.printStringTransferByWord(number, m_stringDescriptor.getStringDescriptor(number), value3, value4, value5, value6, value7, value8);
    end;

    private macro constructor(reportView : TPrintableView)
        initTPart23View2055("Раздел 3. Производные финансовые инструменты",
                            reportView);

        m_table.addColumn("",  3, AL_CENTER);
        m_table.addColumn("", 30, AL_LEFT);
        m_table.addColumn("", 20, AL_RIGHT);
        m_table.addColumn("", 20, AL_RIGHT);
        m_table.addColumn("", 20, AL_RIGHT);
        m_table.addColumn("", 20, AL_RIGHT);
        m_table.addColumn("", 20, AL_RIGHT);
        m_table.addColumn("", 20, AL_RIGHT);

        m_stringDescriptor = TDescriptorPart3View2742();
    end;

    constructor(reportView);
end;

class (TPart23View3129) TPart2View3129(reportView : TPrintableView)
    macro printHeader(reportWidth)
    m_reportView.printUnitName(reportWidth);
[┌─────┬────────────────────────────────┬─────────────────────────────────────────────┬──────────────────────┬──────────────────────┐
│Номер│                                │           Справедливая стоимость            │   Сумма требований   │  Сумма обязательств  │
│стро-│ Наименование инструмента       ├──────────────────────┬──────────────────────┤                      │                      │
│ки   │                                │        актива        │    обязательства     │                      │                      │
├─────┼────────────────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────┼];

        m_table.setAllCenter(true);
        m_table.printString("1", "2", "3", "4", "5", "6");
        m_table.setAllCenter(false);
    end;

    macro printString(number, value3, value4, value5, value6)
        m_table.printStringTransferByWord(number, m_stringDescriptor.getStringDescriptor(number), value3, value4, value5, value6);
    end;

    private macro constructor(reportView : TPrintableView)
        initTPart23View3129("Раздел 2. Производные финансовые инструменты",
                            reportView);

        m_table.addColumn("",  3, AL_CENTER);
        m_table.addColumn("", 30, AL_LEFT);
        m_table.addColumn("", 20, AL_RIGHT);
        m_table.addColumn("", 20, AL_RIGHT);
        m_table.addColumn("", 20, AL_RIGHT);
        m_table.addColumn("", 20, AL_RIGHT);

        m_stringDescriptor = TDescriptorPart2View3129();
    end;

    constructor(reportView);
end;

/**
* Класс представления отчетной формы для раздела 4.
*/
class (TPart4View2055) TPart4View2332(reportView : TPrintableView)

    private macro constructorTPart4View2332(reportView : TPrintableView)
        initTPart4View2055(reportView);
        m_name = "Раздел \"Справочно\"";
    end;

    constructorTPart4View2332(reportView);
end;

class (TPart4View2332) TPart4View2742(reportView : TPrintableView)
    initTPart4View2332(reportView);

    macro initDescriptor()
        addStringDescriptor("1",   ". по срочным сделкам, отраженным в разделе 2: ", " тыс. руб.");
        addStringDescriptor("2",   ". по производным финансовым инструментам, отраженным в разделе 3: ", " тыс. руб.");
    end;
end;

/**
* Класс представления отчетной формы.
*/
class (TReportView2055) TReportView2332(formName, formOkudCode, formPeriodicity, periodFormat)
    initTReportView2055(NVL(formName,        "Сведения о финансовых инструментах, отражаемых на внебалансовых счетах"),
                        NVL(formOkudCode,    "0409155"),
                        NVL(formPeriodicity, arrCreate(RCB_PK_DAY, RCB_PK_MONTH, RCB_PK_QUARTER)),
                        NVL(periodFormat,    DATE_OUT_PERIOD_FORMAT));
end;

class (TReportView2055) TReportView2742(formName, formOkudCode, formPeriodicity, periodFormat)
    initTReportView2055(NVL(formName,        "СВЕДЕНИЯ ОБ УСЛОВНЫХ ОБЯЗАТЕЛЬСТВАХ КРЕДИТНОГО ХАРАКТЕРА И ПРОИЗВОДНЫХ ФИНАНСОВЫХ ИНСТРУМЕНТАХ"),
                        NVL(formOkudCode,    "0409155"),
                        NVL(formPeriodicity, arrCreate(RCB_PK_DAY, RCB_PK_MONTH, RCB_PK_QUARTER)),
                        NVL(periodFormat,    DATE_OUT_PERIOD_FORMAT));
end;

class (TReportView2742) TReportView3129(formName, formOkudCode, formPeriodicity, periodFormat)
    initTReportView2742(NVL(formName,        "СВЕДЕНИЯ ОБ УСЛОВНЫХ ОБЯЗАТЕЛЬСТВАХ КРЕДИТНОГО ХАРАКТЕРА И ПРОИЗВОДНЫХ ФИНАНСОВЫХ ИНСТРУМЕНТАХ"),
                        NVL(formOkudCode,    "0409155"),
                        NVL(formPeriodicity, arrCreate(RCB_PK_DAY, RCB_PK_MONTH, RCB_PK_QUARTER)),
                        NVL(periodFormat,    DATE_OUT_PERIOD_FORMAT));
end;
/**
* Класс представления отчетной формы для раздела 2 по 2835У.
*/
class (TDescriptorPartView) TDescriptorPart2View2835()
        initTDescriptorPartView();
        addStringDescriptor("1",   "Форвард, всего, в том числе с базисным активом:");
        addStringDescriptor("1.1", "иностранная валюта (по отношению к рублю)"      );
        addStringDescriptor("1.2", "иностранная валюта (бивалютные сделки)"         );
        addStringDescriptor("1.3", "драгоценные металлы"                            );
        addStringDescriptor("1.4", "ценные бумаги"                                  );
        addStringDescriptor("1.5", "другие"                                         );
        addStringDescriptor("2",   "Опцион, всего, в том числе с базисным активом:" );
        addStringDescriptor("2.1", "иностранная валюта (по отношению к рублю)"      );
        addStringDescriptor("2.2", "иностранная валюта (бивалютные сделки)"         );
        addStringDescriptor("2.3", "драгоценные металлы"                            );
        addStringDescriptor("2.4", "ценные бумаги"                                  );
        addStringDescriptor("2.5", "другие"                                         );
        addStringDescriptor("3",   "Своп, всего, в том числе с базисным активом:"   );
        addStringDescriptor("3.1", "иностранная валюта (по отношению к рублю)"      );
        addStringDescriptor("3.2", "иностранная валюта (бивалютные сделки)"         );
        addStringDescriptor("3.3", "драгоценные металлы"                            );
        addStringDescriptor("3.4", "ценные бумаги"                                  );
        addStringDescriptor("3.5", "другие"                                         );
        addStringDescriptor("4",   "Прочие сделки"                                  );
end;

class (TPart23View2055) TPart2View2835(reportView : TPrintableView)
    private macro constructor(reportView : TPrintableView)
        initTPart23View2055("Раздел 2. Срочные сделки", reportView);

        m_table.addColumn("Но-|мер|стр|оки",                                    3, AL_CENTER);
        m_table.addColumn("Наименование инструмента",                          30, AL_LEFT);
        m_table.addColumn("Сумма требований",                                  13, AL_RIGHT);
        m_table.addColumn("Сумма обязательств",                                13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(положительные)",  13, AL_RIGHT);
        m_table.addColumn("Нереализованные|курсовые|разницы|(отрицательные)",  13, AL_RIGHT);
        m_table.addColumn("Резерв на|возможные потери",                        13, AL_RIGHT);

        m_stringDescriptor = TDescriptorPart2View2835();
    end;

    constructor(reportView);
end;

/**
* Класс представления отчетной формы для раздела 4.
*/
class (TPart4View2742) TPart4View2835(reportView : TPrintableView)

    /*private var m_table = CTableReport();*/

        initTPart4View2742(reportView);
    /*private macro constructorTPart4View2835(reportView : TPrintableView)*/
        /*initTPart4View2742(reportView);*/
        /*m_table = CTableReport();*/

        /*m_table.addColumn("Но-|мер|стр|оки",                                       3, AL_CENTER);*/
        /*m_table.addColumn("Номер строки",                                         12, AL_CENTER);*/
        /*m_table.addColumn("Наименование | депозитария",                           24, AL_CENTER);*/
        /*m_table.addColumn("ИНН|депозитария",                        13, AL_CENTER);*/
        /*m_table.addColumn("Номер|лицензии|депозитария",             13, AL_CENTER);*/
        /*m_table.addColumn("Количество цен-|ных бумаг,|шт.",                       15, AL_CENTER);*/
        /*m_table.addColumn("Стоимость ценных бумаг,|принятых в обеспечение по|размещенным средствам,|тыс. руб.",                                  25, AL_CENTER);*/
        /*m_table.addColumn("Текущая (справедливая)|стоимость ценных бумаг,|полученных по операциям,|совершаемыи на возвратной|основе, тыс. руб.",  25, AL_CENTER);*/
        /*m_table.addColumn("Сформированный резерв|на возможные потери,|тыс. руб.", 21, AL_CENTER);*/

        /*m_name = "Раздел \"Справочно\"";*/
    /*end;*/

    macro printHeader()
    end;

    macro initDescriptor()
        addStringDescriptor("1",   "   Положительная переоценка по хеджирующим сделкам, принятая в уменьшение резервов на возможные потери по срочным сделкам,\n    отраженным в разделе 2 Отчета, в соответствии с требованиями главы 5 Положения Банка России № 283-П: ", " тыс. руб.");
    end;

    /*constructorTPart4View2835(reportView);*/
end;



/**
* Класс представления отчетной формы для раздела 4.
*/
class (TPart4View2742) TPart4Item2View2835(reportView : TPrintableView)

    private var m_table = CTableReport();

    private macro constructorTPart4Item2View2835(reportView : TPrintableView)
        initTPart4View2742(reportView);
        m_table = CTableReport();

        m_table.addColumn("Но-|мер|стр|оки",                                       3, AL_CENTER);
        m_table.addColumn("Наименование |депозитария",                            24, AL_LEFT);
        m_table.addColumn("ИНН|депозитария",                        13, AL_RIGHT);
        m_table.addColumn("Номер|лицензии|депозитария",             13, AL_RIGHT);
        m_table.addColumn("Количество цен-|ных бумаг,|шт.",                       15, AL_RIGHT);
        m_table.addColumn("Стоимость ценных бумаг,|принятых в обеспечение по|размещенным средствам,|тыс. руб.",                                  25, AL_RIGHT);
        m_table.addColumn("Текущая (справедливая)|стоимость ценных бумаг,|полученных по операциям,|совершаемым на возвратной|основе, тыс. руб.",  25, AL_RIGHT);
        m_table.addColumn("Сформированный резерв|на возможные потери,|тыс. руб.", 21, AL_RIGHT);

        m_name = "Раздел \"Справочно\"";
    end;

    macro printString (value1, value2, value3,  value4,  value5,  value6,  value7,  value8)
        m_table.printStringTransferByWord(value1, NVL(value2, ""), NVL(value3, ""),  NVL(value4, ""),  NVL(value5, 0), NVL(value6, 0.0),  NVL(value7, 0.0),  NVL(value8, 0.0));
    end;

    /**
    * Шапка.
    */
    macro printHeader()
        println("2",   "   Информация о ценных бумагах, принятых в обеспечение по размещенным средствам и полученных по операциям, совершаемым на возвратной основе,\n    права на которые удостоверяются депозитариями", "");
        println();
        m_table.printHead();
        m_table.setAllCenter(true);
        m_table.printString("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15");
        m_table.setAllCenter(false);
        m_table.printSeparator();
    end;

    /**
    * Закрывашка.
    */
    macro printBottom()
        m_table.printBottom();
        println();
    end;

    constructorTPart4Item2View2835(reportView);
end;

class (TPart4Item2View2835) TPart4Item1View3129(reportView : TPrintableView)

    macro printHeader()
        println("1",   "   Информация о ценных бумагах, принятых в обеспечение по размещенным средствам и полученных по операциям, совершаемым на возвратной основе,\n    права на которые удостоверяются депозитариями", "");
        println();
        m_table.printHead();
        m_table.setAllCenter(true);
        m_table.printString("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15");
        m_table.setAllCenter(false);
        m_table.printSeparator();
    end;

    private macro constructorTPart4Item1View3129(reportView : TPrintableView)
        initTPart4Item2View2835(reportView);
    end;

    constructorTPart4Item1View3129(reportView);
end;


class (TPart4Item1View3129) TPart4Item1View4033(reportView : TPrintableView)

    private macro constructorTPart4Item1View4033(reportView : TPrintableView)
        initTPart4Item1View3129(reportView);

        m_table = CTableReport();

        m_table.addColumn("Но-|мер|стр|оки",                                                                                             3, AL_CENTER);
        m_table.addColumn("Наименование |депозитария",                                                                                  24, AL_LEFT);
        m_table.addColumn("ИНН|депозитария",                                                                                            13, AL_RIGHT);
        m_table.addColumn("Номер|лицензии|депозитария",                                                                                 13, AL_RIGHT);
        m_table.addColumn("Количество цен-|ных бумаг,|шт.",                                                                             15, AL_RIGHT);
        m_table.addColumn("Стоимость ценных бумаг,|принятых в обеспечение по|размещенным средствам,|тыс. руб.",                         25, AL_RIGHT);
        m_table.addColumn("Справедливая стоимость ценных|бумаг, полученных по операциям,|совершаемым на возвратной основе,|тыс. руб.",  25, AL_RIGHT);
        m_table.addColumn("Сформированный резерв|на возможные потери,|тыс. руб.",                                                       21, AL_RIGHT);

        m_name = "Раздел \"Справочно\"";
    end;

    constructorTPart4Item1View4033(reportView);
end;

class (TPart4View2835) TPart4Item3View3006(reportView : TPrintableView)

    initTPart4View2742(reportView);

    macro printHeader()
    end;

    macro initDescriptor()
        addStringDescriptor("3",   "   Общая сумма условных обязательств кредитного характера, включая сгруппированные в однородные портфели, которые могут быть безусловно аннулированы в любой момент времени без предварительного уведомления контрагента, по балансовой стоимости: ", " тыс. руб.");
    end;

end;

class (TPart4Item3View3006) TPart4Item2View3129(reportView : TPrintableView)

    initTPart4Item3View3006(reportView);

    macro printHeader()
    end;

    macro initDescriptor()
        addStringDescriptor("2",   "   Общая сумма условных обязательств кредитного характера, включая сгруппированные в однородные портфели, которые могут быть безусловно аннулированы в любой момент времени без предварительного уведомления контрагента, по балансовой стоимости: ", " тыс. руб.");
    end;

end;

class (TPart4View2835) TPart4Item4View3006(reportView : TPrintableView)

    initTPart4View2742(reportView);

    macro printHeader()
    end;

    macro initDescriptor()
        addStringDescriptor("4",   "   Величина фактически сформированного резерва на возможные потери по общей сумме условных обязательств кредитного характера, включая сгруппированные в однородные портфели, которые могут быть безусловно аннулированы в любой момент времени без предварительного уведомления контрагента, по балансовой стоимости: ", " тыс. руб.");
    end;

end;

class (TPart4View2835) TPart4Item3View3129(reportView : TPrintableView)

    initTPart4View2742(reportView);

    macro printHeader()
    end;

    macro initDescriptor()
        addStringDescriptor("3",   "   Величина фактически сформированного резерва на возможные потери по общей сумме условных обязательств кредитного характера, включая сгруппированные в однородные портфели, которые могут быть безусловно аннулированы в любой момент времени без предварительного уведомления контрагента, по балансовой стоимости: ", " тыс. руб.");
    end;

end;

class (TPart4View2835) TPart4Item5View3006(reportView : TPrintableView)

    initTPart4View2742(reportView);

    macro printHeader()
    end;

    macro initDescriptor()
        addStringDescriptor("5",   "   Величина, подверженная кредитному риску по срочным сделкам и производным финансовым инструментам, заключенным на биржевом и внебиржевом рынках, рассчитанная на основании методики, предусмотренной приложением 3 к Инструкции Банка России № 139-И, за исключением положений пункта 1, подпункта 8.1 пункта 8, пунктов 9 - 12 указанного приложения: ", " тыс. руб.");
    end;

end;

class (TPart4Item5View3006) TPart4Item4View3129(reportView : TPrintableView)

    initTPart4View2742(reportView);

    macro printHeader()
    end;

    macro initDescriptor()
        addStringDescriptor("4",   "   Величина, подверженная кредитному риску по производным финансовым инструментам, заключенным на биржевом и внебиржевом рынках, рассчитанная на основании методики, предусмотренной приложением 3 к Инструкции Банка России № 139-И, за исключением положений пункта 1, подпункта 8.1 пункта 8, пунктов 9 - 12 указанного приложения: ", " тыс. руб.");
    end;

end;
