/*
$Name:          F155PrintController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 155. Контроллер печати
*/

/**
 * Форма 155. Контроллер печати.
 *
 * @since   08.10.2008
 * @author  Ivkina Olga
 * @version 6.00.020.29
 */
import f155ObjectFactory;
import f155ReportView;

/**
 * Операция печати.
 */
class TPrintPartController2055(view, part)
    private var m_view = view;
    private var m_part = part;

    private macro printString()
    end;

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttributes();
        var i         = 0;

        m_view.printPartName();

        m_view.printHeader();
        while (i < attribute.size)
            m_view.printSeparator();
            printString(attribute[i]);
            i = i + 1;
        end;
        m_view.printBottom();
    end;

    /**
     * Получить ширину части отчета.
     */
    macro getWidth()
        return m_view.getWidth();
    end;
end;

/**
 * Операция печати.
 */
class (TPrintPartController2055) TPrintPart1Controller2055(view, part)
    private macro printString(attribute)
                m_view.printString(attribute.getName(),
                                                attribute.getSubAttribute( "3").getStringValue(),
                                                attribute.getSubAttribute( "4").getStringValue(),
                                                attribute.getSubAttribute( "5").getStringValue(),
                                                attribute.getSubAttribute( "6").getStringValue(),
                                                attribute.getSubAttribute( "7").getStringValue(),
                                                attribute.getSubAttribute( "8").getStringValue(),
                                                attribute.getSubAttribute( "9").getStringValue(),
                                                attribute.getSubAttribute("10").getStringValue(),
                                                attribute.getSubAttribute("11").getStringValue(),
                                                attribute.getSubAttribute("12").getStringValue(),
                                                attribute.getSubAttribute("13").getStringValue(),
                                                attribute.getSubAttribute("14").getStringValue(),
                                                attribute.getSubAttribute("15").getStringValue(),
                                                attribute.getNote()
                                 );
    end;
    initTPrintPartController2055(view, part)
end;

class (TPrintPartController2055) TPrintPartController3129(view, part)
    macro execute()
        var attribute = m_part.getAttributes();
        var i         = 0;

        m_view.printPartName();
        m_view.printHeader(getWidth());
        while (i < attribute.size)
            m_view.printSeparator();
            printString(attribute[i]);
            i = i + 1;
        end;
        m_view.printBottom();
    end;

    initTPrintPartController2055(view, part)
end;

class (TPrintPartController3129) TPrintPart1Controller3129(view, part)
    private macro printString(attribute)
                m_view.printString(attribute.getName(),
                                                attribute.getSubAttribute( "3").getStringValue(),
                                                attribute.getSubAttribute( "4").getStringValue(),
                                                attribute.getSubAttribute( "5").getStringValue(),
                                                attribute.getSubAttribute( "6").getStringValue(),
                                                attribute.getSubAttribute( "7").getStringValue(),
                                                attribute.getSubAttribute( "8").getStringValue(),
                                                attribute.getSubAttribute( "9").getStringValue(),
                                                attribute.getSubAttribute("10").getStringValue(),
                                                attribute.getSubAttribute("11").getStringValue(),
                                                attribute.getSubAttribute("12").getStringValue(),
                                                attribute.getSubAttribute("13").getStringValue(),
                                                attribute.getSubAttribute("14").getStringValue(),
                                                attribute.getSubAttribute("15").getStringValue(),
                                                attribute.getNote()
                                 );
    end;
    initTPrintPartController3129(view, part)
end;

/**
 * Операция печати.
 */
class (TPrintPartController2055) TPrintPart23Controller2055(view, part)
    private macro printString(attribute)
                m_view.printString(attribute.getName(), attribute.getSubAttribute( "3").getStringValue(),
                                                        attribute.getSubAttribute( "4").getStringValue(),
                                                        attribute.getSubAttribute( "5").getStringValue(),
                                                        attribute.getSubAttribute( "6").getStringValue(),
                                                        attribute.getSubAttribute( "7").getStringValue());
    end;
    initTPrintPartController2055(view, part)
end;

class (TPrintPartController2055) TPrintPart3Controller2742(view, part)
    private macro printString(attribute)
                m_view.printString(attribute.getName(), attribute.getSubAttribute( "3").getStringValue(),
                                                        attribute.getSubAttribute( "4").getStringValue(),
                                                        attribute.getSubAttribute( "5").getStringValue(),
                                                        attribute.getSubAttribute( "6").getStringValue(),
                                                        attribute.getSubAttribute( "7").getStringValue(),
                                                        attribute.getSubAttribute( "8").getStringValue());
    end;
    initTPrintPartController2055(view, part)
end;

class (TPrintPartController3129) TPrintPart2Controller3129(view, part)
    private macro printString(attribute)
                m_view.printString(attribute.getName(), attribute.getSubAttribute( "3").getStringValue(),
                                                        attribute.getSubAttribute( "4").getStringValue(),
                                                        attribute.getSubAttribute( "5").getStringValue(),
                                                        attribute.getSubAttribute( "6").getStringValue());
    end;
    initTPrintPartController3129(view, part)
end;

/**
 * Операция печати.
 */
class (TPrintPartController2055) TPrintPart4Controller2055(view, part)
    private macro printString(attribute)
                m_view.printString(attribute.getName(), attribute.getStringValue());
    end;
    initTPrintPartController2055(view, part)
end;

/**
 * Операция печати.
 */
class (TPrintPartController2055) TPrintPart4Item2Controller2835(view, part)
    initTPrintPartController2055(view, part);

    private macro printString( attribute)
        m_view.printString(attribute.getNumber(),
                           attribute.getName(),
                           attribute.getInn(),
                           attribute.getILicense(),
                           attribute.getNSecurities(),
                           attribute.getValueOfSecurities(),
                           attribute.getPresentValue(),
                           attribute.getMadeReserve());
    end;

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttributes();
        m_view.printHeader();
        var i = 0;
        while (i < attribute.size)
            m_view.printSeparator();
            printString(attribute[i]);
            i = i + 1;
        end;
        m_view.printBottom();
    end;
end;

class (TPrintPart4Item2Controller2835) TPrintPart3Item1Controller3129(view, part)
    initTPrintPart4Item2Controller2835(view, part);

    private macro printString( attribute)
        m_view.printString(attribute.getNumber(),
                           attribute.getName(),
                           attribute.getInn(),
                           attribute.getILicense(),
                           attribute.getNSecurities(),
                           attribute.getValueOfSecurities(),
                           attribute.getPresentValue(),
                           attribute.getMadeReserve());
    end;

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttributes();
        m_view.printPartName();
        m_view.printHeader();
        var i = 0;
        while (i < attribute.size)
            m_view.printSeparator();
            printString(attribute[i]);
            i = i + 1;
        end;
        m_view.printBottom();
    end;
end;

class (TPrintPart4Controller2055) TPrintPart4Controller3006(view, part)

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttribute("1");

        m_view.printPartName();

        m_view.printHeader(getWidth());
        m_view.printSeparator();
        printString(attribute);
        m_view.printBottom();
    end;

    initTPrintPart4Controller2055(view, part)
end;

class (TPrintPart4Controller2055) TPrintPart4Item3Controller3006(view, part)
    initTPrintPart4Controller2055(view, part);

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttribute("3");

        m_view.printSeparator();
        printString(attribute);
        m_view.printBottom();
    end;
end;

class (TPrintPart4Controller2055) TPrintPart4Item4Controller3006(view, part)
    initTPrintPart4Controller2055(view, part);

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttribute("4");

        m_view.printSeparator();
        printString(attribute);
        m_view.printBottom();
    end;
end;

class (TPrintPart4Controller2055) TPrintPart4Item5Controller3006(view, part)
    initTPrintPart4Controller2055(view, part);

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttribute("5");

        m_view.printSeparator();
        printString(attribute);
        m_view.printBottom();
    end;
end;

class (TPrintPart4Item3Controller3006) TPrintPart3Item2Controller3129(view, part)
    initTPrintPart4Item3Controller3006(view, part);

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttribute("2");

        m_view.printSeparator();
        printString(attribute);
        m_view.printBottom();
    end;
end;

class (TPrintPart4Item4Controller3006) TPrintPart3Item3Controller3129(view, part)
    initTPrintPart4Item4Controller3006(view, part);

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttribute("3");

        m_view.printSeparator();
        printString(attribute);
        m_view.printBottom();
    end;
end;

class (TPrintPart4Item5Controller3006) TPrintPart3Item4Controller3129(view, part)
    initTPrintPart4Item5Controller3006(view, part);

    /**
     * Печать раздела.
     */
    macro execute()
        var attribute = m_part.getAttribute("4");

        m_view.printSeparator();
        printString(attribute);
        m_view.printBottom();
    end;
end;

/**
 * Операция печати.
 */
class TPrintController()

    /**
     * Ссылка на отчет
     */
    private var m_report; /* : TReport*/

    /**
     * Ссылка на отчет
     */
    private var m_view; /* Object */

    /**
     * Контроллеры печати.
     */
    private var m_printControllers : TArray;

    /**
     * Конструктор.
     */
    private macro constructor()
        m_view   = objectFactoryInstance.createReportView();
        m_report = objectFactoryInstance.createReport();

        m_printControllers = TArray();
    end;

    /**
     * Печать содержательной части отчета (состоит из таблиц разделов).
     */
    private macro printData()
        var i : Integer = 0;

        while (i < m_printControllers.size)

            BegAction(2000, "Печать отчета " + (i+1) + ".");

            m_printControllers[i].execute();
            i = i + 1;

            EndAction(1);
        end;
    end;

    /**
     * Нахождение максимальной ширины частей отчетной формы.
     */
    private macro getPartsWidthMax() : Integer
        var widthMax : Integer = 0;
        var i        : Integer = 0;

        while(i < m_printControllers.size)
            widthMax = max(widthMax, m_printControllers[i].getWidth());
            i = i + 1;
        end;

        return widthMax;
    end;

    /**
     * Выполнить печать.
     */
    macro execute()

        m_view.setOutputFile();

        m_view.setReportWidth(getPartsWidthMax());
        m_view.printLendingAgencyCodeZone();
        m_view.printNamesZone();

        printData();

        m_view.printSignatureZone();

        m_view.show();

        m_view.resetOutputFile();
    end;

    constructor();
end;

/**
 * Операция печати.
 */
class (TPrintController) TPrintController2055()

    /**
     * Конструктор.
     */
    private macro constructor()
        initTPrintController();

        m_printControllers[m_printControllers.size] = TPrintPart1Controller2055( TPart1View2055(), m_report.getPart(1));
        m_printControllers[m_printControllers.size] = TPrintPart23Controller2055(TPart2View2055(), m_report.getPart(2));
        m_printControllers[m_printControllers.size] = TPrintPart23Controller2055(TPart3View2055(), m_report.getPart(3));
        m_printControllers[m_printControllers.size] = TPrintPart4Controller2055( TPart4View2055(), m_report.getPart(4));
    end;

    constructor();
end;

/**
 * Операция печати.
 */
class (TPrintController) TPrintController2332()

    /**
     * Конструктор.
     */
    private macro constructor()
        initTPrintController();

        m_printControllers[m_printControllers.size] = TPrintPart1Controller2055 (TPart1View2332(), m_report.getPart(1));
        m_printControllers[m_printControllers.size] = TPrintPart23Controller2055(TPart2View2332(), m_report.getPart(2));
        m_printControllers[m_printControllers.size] = TPrintPart23Controller2055(TPart3View2332(), m_report.getPart(3));
        m_printControllers[m_printControllers.size] = TPrintPart4Controller2055 (TPart4View2332(), m_report.getPart(4));
    end;

    constructor();
end;

class (TPrintController) TPrintController2742()

    /**
     * Конструктор.
     */
    private macro constructor()
        initTPrintController();

        m_printControllers[m_printControllers.size] = TPrintPart1Controller2055 (TPart1View2332(), m_report.getPart(1));
        m_printControllers[m_printControllers.size] = TPrintPart23Controller2055(TPart2View2742(), m_report.getPart(2));
        m_printControllers[m_printControllers.size] = TPrintPart3Controller2742(TPart3View2742(), m_report.getPart(3));
        m_printControllers[m_printControllers.size] = TPrintPart4Controller2055 (TPart4View2742(), m_report.getPart(4));
    end;

    constructor();
end;

class (TPrintController) TPrintController2835()

    /**
     * Конструктор.
     */
    private macro constructor()
        initTPrintController();

        m_printControllers[m_printControllers.size] =  TPrintPart1Controller2055(TPart1View2332(),      m_report.getPart(1));
        m_printControllers[m_printControllers.size] = TPrintPart23Controller2055(TPart2View2835(),      m_report.getPart(2));
        m_printControllers[m_printControllers.size] =  TPrintPart3Controller2742(TPart3View2742(),      m_report.getPart(3));
        m_printControllers[m_printControllers.size] =  TPrintPart4Controller2055(TPart4View2835(),      m_report.getPart(4));
        m_printControllers[m_printControllers.size] =  TPrintPart4Item2Controller2835(TPart4Item2View2835(), m_report.getPart(5));
    end;

    constructor();
end;

class (TPrintController) TPrintController3006()

    /**
     * Конструктор.
     */
    private macro constructorTPrintController3006()
        initTPrintController();

        m_printControllers[m_printControllers.size] =  TPrintPart1Controller2055(TPart1View2332(),      m_report.getPart(1));
        m_printControllers[m_printControllers.size] =  TPrintPart23Controller2055(TPart2View2835(),     m_report.getPart(2));
        m_printControllers[m_printControllers.size] =  TPrintPart3Controller2742(TPart3View2742(),      m_report.getPart(3));
        m_printControllers[m_printControllers.size] =  TPrintPart4Controller3006(TPart4View2835(),      m_report.getPart(4));
        m_printControllers[m_printControllers.size] =  TPrintPart4Item2Controller2835(TPart4Item2View2835(), m_report.getPart(5));
        m_printControllers[m_printControllers.size] =  TPrintPart4Item3Controller3006(TPart4Item3View3006(), m_report.getPart(4));
        m_printControllers[m_printControllers.size] =  TPrintPart4Item4Controller3006(TPart4Item4View3006(), m_report.getPart(4));
        m_printControllers[m_printControllers.size] =  TPrintPart4Item5Controller3006(TPart4Item5View3006(), m_report.getPart(4));
    end;

    constructorTPrintController3006();
end;

class (TPrintController) TPrintController3129()

    /**
     * Конструктор.
     */
    private macro constructorTPrintController3129()
        initTPrintController();

        m_printControllers[m_printControllers.size] =  TPrintPart1Controller3129(TPart1View3129(TPrintableView_3129),      m_report.getPart(1));
        m_printControllers[m_printControllers.size] =  TPrintPart2Controller3129(TPart2View3129(TPrintableView_3129),      m_report.getPart(2));
        m_printControllers[m_printControllers.size] =  TPrintPart3Item1Controller3129(TPart4Item1View3129(), m_report.getPart(4));
        m_printControllers[m_printControllers.size] =  TPrintPart3Item2Controller3129(TPart4Item2View3129(), m_report.getPart(3));
        m_printControllers[m_printControllers.size] =  TPrintPart3Item3Controller3129(TPart4Item3View3129(), m_report.getPart(3));
        m_printControllers[m_printControllers.size] =  TPrintPart3Item4Controller3129(TPart4Item4View3129(), m_report.getPart(3));
    end;

    constructorTPrintController3129();
end;

class (TPrintController) TPrintController3468()

    /**
     * Конструктор.
     */
    private macro constructorTPrintController3468()
        initTPrintController();

        m_printControllers[m_printControllers.size] =  TPrintPart1Controller3129(TPart1View3129(TPrintableView_3129),      m_report.getPart(1));
        m_printControllers[m_printControllers.size] =  TPrintPart2Controller3129(TPart2View3129(TPrintableView_3129),      m_report.getPart(2));
        m_printControllers[m_printControllers.size] =  TPrintPart3Item1Controller3129(TPart4Item1View3129(), m_report.getPart(3));
    end;

    constructorTPrintController3468();
end;

class (TPrintController) TPrintController4033()

    /**
     * Конструктор.
     */
    private macro constructorTPrintController4033()
        initTPrintController();

        m_printControllers[m_printControllers.size] =  TPrintPart1Controller3129(TPart1View3129(TPrintableView_3129),      m_report.getPart(1));
        m_printControllers[m_printControllers.size] =  TPrintPart2Controller3129(TPart2View3129(TPrintableView_3129),      m_report.getPart(2));
        m_printControllers[m_printControllers.size] =  TPrintPart3Item1Controller3129(TPart4Item1View4033(), m_report.getPart(3));
    end;

    constructorTPrintController4033();
end;
