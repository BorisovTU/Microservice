/*
$Name:          f155interface.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 155. интерфейс доступа к операциям формы
*/

/**
 * Форма 155. Доступ к операциям формы.
 * 
 * @since   23.09.2008
 * @author  Ivkina Olga
 * @version 6.00.020.29
 */
import ReptCBInter;
import RcbCoreInter;     

import rcbImport;       

import f155Report;       
import f155ObjectFactory;
import f155Global;
import f155CalculationController;
import f155CalculationProtocolView;
import f155DataSource;
import f155TuneTable;   
import f155PrintController;
import f155ReportView;
import f155KlikoExportController;
import f155KlikoView;
import f155NormalizationController;
import f155PtkPsdExportController;
import f155ExportXmlController;
/**
 *  Запуск операции расчета отчета
 */
macro executeCalculationOperation()
     if (rcbApplication().currentReport.context.period.endDate >= RCB_I2055_DATE)
	     global.initializePackages();
    	 objectFactoryInstance.createCalculationController().calculateReport();
     else
	     msgbox("Выпуск отчета возможен только за период, дата окончания которого больше или равна <значение настройки реестра Дата1_2055У>");
	     установитьФлагВозврата(STOP_PROC_FLG);
         exit(1);
     end;
end;

/**
 *  Запуск операции межформенного контроля
 */
macro executeInterFormControlOperation()
    msgbox("Извините, данная операция будет реализована позже.");
end;

/**
 *  Запуск операции печати отчета
 */
macro executePrintOperation()
    objectFactoryInstance.createPrintController().execute();
end;

/**
 *  Запуск операции экспорта в kliko.exe
 */
macro executeKlikoExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В kliko.exe").checkCalculateReport("kliko.exe");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createKlikoExportController().execute();
end;

/**
 *  Запуск операции экспорта в АС ПСД.
 */
macro executePtkPsdExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В АС ПСД").checkCalculateReport("АС ПСД");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    if (rcbApplication().currentReport.context.period.endDate < RCB_I2742_DATE)
         msgbox("Экспорт отчета в АС ПСД возможен только за период, дата окончания которого больше или равна " + RCB_I2742_DATE);
         установитьФлагВозврата(STOP_PROC_FLG);
    else
        objectFactoryInstance.createPtkPsdExportController().execute();
    end; 
end;

/**
 *  Запуск операции экспорта в XML
 */
macro executeXmlExportController()
    objectFactoryInstance.createXmlExportController(RCB_XML_PK_NOT_REGULARLY).execute();
end;

/**
 *  Запуск операции экспорта в XML на внутриквартальные даты по требованию ТУ
 */
macro executeMonthDateXmlExportController()
    objectFactoryInstance.createXmlExportController(RCB_XML_PK_MONTHLY).execute();
end;

/**
 *  Запуск операции нормализации рассчитанных данных.
 */
macro executeNormalizationOperation()
     objectFactoryInstance.createNormalizationController().execute();
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);