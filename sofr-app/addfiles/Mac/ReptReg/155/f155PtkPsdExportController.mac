/*
$Name:          f155PtkPsdExportController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 155. Контроллер экспорта данных отчета в АС ПСД.
*/

/**
 * Форма 155. Контроллер экспорта данных отчета в АС ПСД.
 *
 * @since   26.04.2012
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

import RcbPtkPsdView;

/**
 * Операция экспорта в АС ПСД для раздела.
 */

private class TF155_12(appCode, rCode, colCode, val)
            var applicationCode = appCode;
            var rowCode = rCode;
            var columnCode = colCode;
            var value = val;
end;

private macro formatCodeStr(str : string) : string /* преобразует код строки для раздела 155_12 к требуемому виду (7.4 -> 7.04 и т.д.) */
    if (strLen(str) < 4)
        return strSubst(str, ".", ".0")
    else
        return str;
    end;
end;

private var arrF155_12 = TArray(); /* Массив значений для выгрузки показателей 7.4, 7.5,... раздела 1  отчетной формы */

class TPtkPsdExportPartController2742(view, part, head)
     /**
      * Представление печати.
      */
     private var m_view            = view;
     /**
      * Ссылка на раздел.
      */
     private var m_part            = part;
     /**
      * Заголовок раздела.
      */
     private var m_applicationCode = head;

    /**
     * Печать раздела в файл экспорта.
     */

    macro execute()
        var attributes : TArray  = m_part.getAttributes(); /*атрибуты раздела (строки)*/

        var codePart2 = TArray(); /* Коды строки для Раздела 2 */
        codePart2[1]  = "1";
        codePart2[11] = "1.1";
        codePart2[12] = "1.2";
        codePart2[13] = "1.3";
        codePart2[14] = "1.4";
        codePart2[2]  = "3";
        codePart2[21] = "3.1";
        codePart2[22] = "3.2";
        codePart2[23] = "3.3";
        codePart2[24] = "3.4";
        codePart2[3]  = "4";
        codePart2[31] = "4.1";
        codePart2[32] = "4.2";
        codePart2[33] = "4.3";
        codePart2[34] = "4.4";

        var codePart3 = TArray(); /*Коды строки для Раздела 3 */
        codePart3[1]  = "1";
        codePart3[11] = "1.1";
        codePart3[12] = "1.2";
        codePart3[13] = "1.3";
        codePart3[14] = "1.4";
        codePart3[15] = "1.5";
        codePart3[2]  = "3";
        codePart3[21] = "3.1";
        codePart3[22] = "3.2";
        codePart3[23] = "3.3";
        codePart3[24] = "3.4";
        codePart3[25] = "3.5";
        codePart3[3]  = "4";
        codePart3[31] = "4.1";
        codePart3[32] = "4.2";
        codePart3[33] = "4.3";
        codePart3[34] = "4.4";

        var i          : Integer = 0;
        var j          : Integer = 0;

        const FROM_COLUMN            = 3,     // с какой графы выодить данные
              FROM_COLUMN_PART155_12 = 1,
              TO_COLUMN_PART1        = 16,    // по какую графу выводить данные для Раздела 1
              TO_COLUMN_PART23       = 8;

        if (m_applicationCode == "F155")
            while (i < attributes.size)
                j = FROM_COLUMN_PART155_12;
                while (j < TO_COLUMN_PART1)
                    if ((attributes[i].getSubAttribute(String(j)) != null) and
                        (attributes[i].getName() < "7.4"))
                        m_view.printString(m_applicationCode, attributes[i].getName(), attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    elif (attributes[i].getSubAttribute(String(j)) != null)
                        while (i < attributes.size)
                            j = FROM_COLUMN_PART155_12;
                            while (j < TO_COLUMN_PART1)
                                if (j == 1)
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), "1", attributes[i].getName());
                                elif (j == 2)
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), "2", attributes[i].getNote());
                                else
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                                end;
                                j = j + 1;
                            end;
                            i = i + 1;
                        end;
                    end;
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_2")
            while (i < attributes.size)
                j = FROM_COLUMN;
                while (j < TO_COLUMN_PART23)
                    if (attributes[i].getName() == "4")
                        break;
                    end;
                    m_view.printString(m_applicationCode, codePart2[StrSubst(attributes[i].getName(), ".", "")], attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_3")
            /******************************************** В ТЗ Раздел 3 и его составляющие предлагается пока не выгружать

            while (i < attributes.size)
                if (attributes[i].getName() == "3.5")
                    break;
                end;
                j = FROM_COLUMN;
                while (j < TO_COLUMN_PART23)
                        m_view.printString(m_applicationCode, codePart3[StrSubst(attributes[i].getName(), ".", "")], attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    j = j + 1;
                end;
                i = i + 1;
            end;**********************************************************************************************************/
        elif (m_applicationCode == "F155_9")
            while (i < attributes.size)
                m_view.printString(m_applicationCode, attributes[i].getName(), "1", attributes[i].getStringValue());
                i = i + 1;
            end;
            i = 0;
            while (i < arrF155_12.size)
                m_view.printString(arrF155_12[i].applicationCode, arrF155_12[i].rowCode, arrF155_12[i].columnCode, arrF155_12[i].value);
                i = i + 1;
            end;
        end;
    end;
end;

class (TPtkPsdExportPartController2742) TPtkPsdExportPartController2835(view, part, head)
     initTPtkPsdExportPartController2742(view, part, head);

    /**
     * Печать раздела в файл экспорта.
     */

    macro execute()
        var attributes : TArray  = m_part.getAttributes(); /*атрибуты раздела (строки)*/

        var codePart2 = TArray(); /* Коды строки для Раздела 2 */
        codePart2[1]  = "1";
        codePart2[11] = "1.1";
        codePart2[12] = "1.2";
        codePart2[13] = "1.3";
        codePart2[14] = "1.4";
        codePart2[15] = "1.5";
        codePart2[2]  = "2";
        codePart2[21] = "2.1";
        codePart2[22] = "2.2";
        codePart2[23] = "2.3";
        codePart2[24] = "2.4";
        codePart2[25] = "2.5";
        codePart2[3]  = "3";
        codePart2[31] = "3.1";
        codePart2[32] = "3.2";
        codePart2[33] = "3.3";
        codePart2[34] = "3.4";
        codePart2[35] = "3.5";
        codePart2[4]  = "4";

        var codePart3 = TArray(); /*Коды строки для Раздела 3 */
        codePart3[1]  = "1";
        codePart3[11] = "1.1";
        codePart3[12] = "1.2";
        codePart3[13] = "1.3";
        codePart3[14] = "1.4";
        codePart3[15] = "1.5";
        codePart3[2]  = "2";
        codePart3[21] = "2.1";
        codePart3[22] = "2.2";
        codePart3[23] = "2.3";
        codePart3[24] = "2.4";
        codePart3[25] = "2.5";
        codePart3[3]  = "3";
        codePart3[31] = "3.1";
        codePart3[32] = "3.2";
        codePart3[33] = "3.3";
        codePart3[34] = "3.4";
        codePart3[35] = "3.5";
        codePart3[4] = "4";
        codePart3[41] = "4.1";
        codePart3[42] = "4.2";
        codePart3[43] = "4.3";
        codePart3[44] = "4.4";
        codePart3[45] = "4.5";
        codePart3[46] = "4.6";
        codePart3[5] = "5";

        var i          : Integer = 0;
        var j          : Integer = 0;

        const FROM_COLUMN            = 3,     // с какой графы выодить данные
              FROM_COLUMN_PART155_12 = 1,
              TO_COLUMN_PART1        = 16,    // по какую графу выводить данные для Раздела 1
              TO_COLUMN_PART2        = 8,     // по какую графу выводить данные для Раздела 2
              TO_COLUMN_PART3        = 9;     // по какую графу выводить данные для Раздела 3

        if (m_applicationCode == "F155")
            while (i < attributes.size)
                j = FROM_COLUMN_PART155_12;
                while (j < TO_COLUMN_PART1)
                    if ((attributes[i].getSubAttribute(String(j)) != null) and
                        (attributes[i].getName() < "7.4"))
                        m_view.printString(m_applicationCode, attributes[i].getName(), attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    elif (attributes[i].getSubAttribute(String(j)) != null)
                        while (i < attributes.size)
                            j = FROM_COLUMN_PART155_12;
                            while (j < TO_COLUMN_PART1)
                                if (j == 1)
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), "1", attributes[i].getName());
                                elif (j == 2)
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), "2", attributes[i].getNote());
                                else
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                                end;
                                j = j + 1;
                            end;
                            i = i + 1;
                        end;
                    end;
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_2")
            while (i < attributes.size)
                j = FROM_COLUMN;
                while (j < TO_COLUMN_PART2)
                    m_view.printString(m_applicationCode, codePart2[StrSubst(attributes[i].getName(), ".", "")], attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_3")
            while (i < attributes.size)
                j = FROM_COLUMN;
                while (j < TO_COLUMN_PART3)
                        m_view.printString(m_applicationCode, codePart3[StrSubst(attributes[i].getName(), ".", "")], attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_9")    //раздел справочно, номер строки 1
            while (i < attributes.size)
                m_view.printString(m_applicationCode, attributes[i].getName(), "1", attributes[i].getStringValue());
                i = i + 1;
            end;
            i = 0;
            while (i < arrF155_12.size)
                m_view.printString(arrF155_12[i].applicationCode, arrF155_12[i].rowCode, arrF155_12[i].columnCode, arrF155_12[i].value);
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_91")   //раздел справочно, номер строки 2
            var codeColumn;
            var number;

            while (i < attributes.size)

                //код колонки - дополняем нулями
                codeColumn = attributes[i].getNumber();
                if ( strlen(String(codeColumn)) < 5)
                  codeColumn = MkStr("0", 5 - strlen(String(codeColumn))) + codeColumn;
                end;

                m_view.printString(m_applicationCode, codeColumn, "1", attributes[i].getNumber());
                m_view.printString(m_applicationCode, codeColumn, "2", attributes[i].getName());

                if (attributes[i].getIsNotResident() == 1)
                    m_view.printString(m_applicationCode, codeColumn, "3COUN", attributes[i].getInn());
                else
                    m_view.printString(m_applicationCode, codeColumn, "3",     attributes[i].getInn());
                end;

                m_view.printString(m_applicationCode, codeColumn, "4", attributes[i].getILicense());
                m_view.printString(m_applicationCode, codeColumn, "5", attributes[i].getNSecurities());
                m_view.printString(m_applicationCode, codeColumn, "6", attributes[i].getValueOfSecurities());
                m_view.printString(m_applicationCode, codeColumn, "7", attributes[i].getPresentValue());
                m_view.printString(m_applicationCode, codeColumn, "8", attributes[i].getMadeReserve());

                i = i + 1;
            end;
        end;
    end;
end;

class (TPtkPsdExportPartController2742) TPtkPsdExportPartController3006(view, part, head)
     initTPtkPsdExportPartController2742(view, part, head);

    /**
     * Печать раздела в файл экспорта.
     */

    macro execute()
        var attributes : TArray  = m_part.getAttributes(); /*атрибуты раздела (строки)*/

        var codePart2 = TArray(); /* Коды строки для Раздела 2 */
        codePart2[1]  = "1";
        codePart2[11] = "1.1";
        codePart2[12] = "1.2";
        codePart2[13] = "1.3";
        codePart2[14] = "1.4";
        codePart2[15] = "1.5";
        codePart2[2]  = "2";
        codePart2[21] = "2.1";
        codePart2[22] = "2.2";
        codePart2[23] = "2.3";
        codePart2[24] = "2.4";
        codePart2[25] = "2.5";
        codePart2[3]  = "3";
        codePart2[31] = "3.1";
        codePart2[32] = "3.2";
        codePart2[33] = "3.3";
        codePart2[34] = "3.4";
        codePart2[35] = "3.5";
        codePart2[4]  = "4";

        var codePart3 = TArray(); /*Коды строки для Раздела 3 */
        codePart3[1]  = "1";
        codePart3[11] = "1.1";
        codePart3[12] = "1.2";
        codePart3[13] = "1.3";
        codePart3[14] = "1.4";
        codePart3[15] = "1.5";
        codePart3[2]  = "2";
        codePart3[21] = "2.1";
        codePart3[22] = "2.2";
        codePart3[23] = "2.3";
        codePart3[24] = "2.4";
        codePart3[25] = "2.5";
        codePart3[3]  = "3";
        codePart3[31] = "3.1";
        codePart3[32] = "3.2";
        codePart3[33] = "3.3";
        codePart3[34] = "3.4";
        codePart3[35] = "3.5";
        codePart3[4] = "4";
        codePart3[41] = "4.1";
        codePart3[42] = "4.2";
        codePart3[43] = "4.3";
        codePart3[44] = "4.4";
        codePart3[45] = "4.5";
        codePart3[46] = "4.6";
        codePart3[5] = "5";

        var i          : Integer = 0;
        var j          : Integer = 0;

        var attrPart4;

        const FROM_COLUMN            = 3,     // с какой графы выодить данные
              FROM_COLUMN_PART155_12 = 1,
              TO_COLUMN_PART1        = 16,    // по какую графу выводить данные для Раздела 1
              TO_COLUMN_PART2        = 8,     // по какую графу выводить данные для Раздела 2
              TO_COLUMN_PART3        = 9;     // по какую графу выводить данные для Раздела 3

        if (m_applicationCode == "F155")
            while (i < attributes.size)
                j = FROM_COLUMN_PART155_12;
                while (j < TO_COLUMN_PART1)
                    if ((attributes[i].getSubAttribute(String(j)) != null) and
                        (attributes[i].getName() < "7.4"))
                        m_view.printString(m_applicationCode, attributes[i].getName(), attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    elif (attributes[i].getSubAttribute(String(j)) != null)
                        while (i < attributes.size)
                            j = FROM_COLUMN_PART155_12;
                            while (j < TO_COLUMN_PART1)
                                if (j == 1)
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), "1", attributes[i].getName());
                                elif (j == 2)
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), "2", attributes[i].getNote());
                                else
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                                end;
                                j = j + 1;
                            end;
                            i = i + 1;
                        end;
                    end;
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_2")
            while (i < attributes.size)
                j = FROM_COLUMN;
                while (j < TO_COLUMN_PART2)
                    m_view.printString(m_applicationCode, codePart2[StrSubst(attributes[i].getName(), ".", "")], attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_3")
            while (i < attributes.size)
                j = FROM_COLUMN;
                while (j < TO_COLUMN_PART3)
                        m_view.printString(m_applicationCode, codePart3[StrSubst(attributes[i].getName(), ".", "")], attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_9")    //раздел справочно, номер строки 1
            attrPart4 = m_part.getAttribute("1");
            m_view.printString(m_applicationCode, "1", "1", attrPart4.getStringValue());
        elif (m_applicationCode == "F155_91")   //раздел справочно, номер строки 2
            var codeColumn;
            var number;

            while (i < attributes.size)

                //код колонки - дополняем нулями
                codeColumn = attributes[i].getNumber();
                if ( strlen(String(codeColumn)) < 5)
                  codeColumn = MkStr("0", 5 - strlen(String(codeColumn))) + codeColumn;
                end;

                m_view.printString(m_applicationCode, codeColumn, "1", attributes[i].getNumber());
                m_view.printString(m_applicationCode, codeColumn, "2", attributes[i].getName());

                if (attributes[i].getIsNotResident() == 1)
                    m_view.printString(m_applicationCode, codeColumn, "3COUN", attributes[i].getInn());
                else
                    m_view.printString(m_applicationCode, codeColumn, "3",     attributes[i].getInn());
                end;

                m_view.printString(m_applicationCode, codeColumn, "4", attributes[i].getILicense());
                m_view.printString(m_applicationCode, codeColumn, "5", attributes[i].getNSecurities());
                m_view.printString(m_applicationCode, codeColumn, "6", attributes[i].getValueOfSecurities());
                m_view.printString(m_applicationCode, codeColumn, "7", attributes[i].getPresentValue());
                m_view.printString(m_applicationCode, codeColumn, "8", attributes[i].getMadeReserve());

                i = i + 1;
            end;
        elif (m_applicationCode == "F155_92")    //раздел справочно, номер строки 3
            attrPart4 = m_part.getAttribute("3");
            m_view.printString(m_applicationCode, "1", "1", attrPart4.getStringValue());
        elif (m_applicationCode == "F155_93")    //раздел справочно, номер строки 4
            attrPart4 = m_part.getAttribute("4");
            m_view.printString(m_applicationCode, "1", "1", attrPart4.getStringValue());
        elif (m_applicationCode == "F155_94")    //раздел справочно, номер строки 5
            attrPart4 = m_part.getAttribute("5");
            m_view.printString(m_applicationCode, "1", "1", attrPart4.getStringValue());
            i = 0;
            while (i < arrF155_12.size)
                m_view.printString(arrF155_12[i].applicationCode, arrF155_12[i].rowCode, arrF155_12[i].columnCode, arrF155_12[i].value);
                i = i + 1;
            end;

        end;
    end;
end;

class (TPtkPsdExportPartController2742) TPtkPsdExportPartController3129(view, part, head)
     initTPtkPsdExportPartController2742(view, part, head);

    /**
     * Печать раздела в файл экспорта.
     */

    macro execute()
        var attributes : TArray  = m_part.getAttributes(); /*атрибуты раздела (строки)*/

        var codePart2 = TArray(); /*Коды строки для Раздела 3 */
        codePart2[1]  = "1";
        codePart2[11] = "1.1";
        codePart2[12] = "1.2";
        codePart2[13] = "1.3";
        codePart2[14] = "1.4";
        codePart2[15] = "1.5";
        codePart2[2]  = "2";
        codePart2[21] = "2.1";
        codePart2[22] = "2.2";
        codePart2[23] = "2.3";
        codePart2[24] = "2.4";
        codePart2[25] = "2.5";
        codePart2[3]  = "3";
        codePart2[31] = "3.1";
        codePart2[32] = "3.2";
        codePart2[33] = "3.3";
        codePart2[34] = "3.4";
        codePart2[35] = "3.5";
        codePart2[4] = "4";
        codePart2[41] = "4.1";
        codePart2[42] = "4.2";
        codePart2[43] = "4.3";
        codePart2[44] = "4.4";
        codePart2[45] = "4.5";
        codePart2[46] = "4.6";
        codePart2[47] = "4.7";
        codePart2[5] = "5";

        var i          : Integer = 0;
        var j          : Integer = 0;

        var attrPart4;

        const FROM_COLUMN            = 3,     // с какой графы выодить данные
              FROM_COLUMN_PART155_12 = 1,
              TO_COLUMN_PART1        = 15,    // по какую графу выводить данные для Раздела 1
              TO_COLUMN_PART2        = 6;     // по какую графу выводить данные для Раздела 2

        if (m_applicationCode == "F155")
            while (i < attributes.size)
                j = FROM_COLUMN_PART155_12;
                while (j <= TO_COLUMN_PART1)
                    if ((attributes[i].getSubAttribute(String(j)) != null) and
                        (attributes[i].getName() < "7.4"))
                        m_view.printString(m_applicationCode, attributes[i].getName(), attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    elif (attributes[i].getSubAttribute(String(j)) != null)
                        while (i < attributes.size)
                            j = FROM_COLUMN_PART155_12;
                            while (j <= TO_COLUMN_PART1)
                                if (j == 1)
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), "1", attributes[i].getName());
                                elif (j == 2)
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), "2", attributes[i].getNote());
                                else
                                    arrF155_12[arrF155_12.size] = TF155_12("F155_12", formatCodeStr(attributes[i].getName()), attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                                end;
                                j = j + 1;
                            end;
                            i = i + 1;
                        end;
                    end;
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_2")
            while (i < attributes.size)
                j = FROM_COLUMN;
                while (j <= TO_COLUMN_PART2)
                    m_view.printString(m_applicationCode, codePart2[StrSubst(attributes[i].getName(), ".", "")], attributes[i].getSubAttribute(String(j)).getName(), attributes[i].getSubAttribute(String(j)).getStringValue());
                    j = j + 1;
                end;
                i = i + 1;
            end;
        elif (m_applicationCode == "F155_91")    //раздел справочно, номер строки 2
            attrPart4 = m_part.getAttribute("2");
            m_view.printString(m_applicationCode, "1", "1", attrPart4.getStringValue());
        elif (m_applicationCode == "F155_9")   //раздел справочно, пункт 1
            var codeColumn;
            var number;

            while (i < attributes.size)

                //код колонки - дополняем нулями
                codeColumn = attributes[i].getNumber();
                if ( strlen(String(codeColumn)) < 5)
                  codeColumn = MkStr("0", 5 - strlen(String(codeColumn))) + codeColumn;
                end;

                m_view.printString(m_applicationCode, codeColumn, "1", attributes[i].getNumber());
                m_view.printString(m_applicationCode, codeColumn, "2", attributes[i].getName());

                if (attributes[i].getIsNotResident() == 1)
                    m_view.printString(m_applicationCode, codeColumn, "3COUN", attributes[i].getInn());
                else
                    m_view.printString(m_applicationCode, codeColumn, "3",     attributes[i].getInn());
                end;

                m_view.printString(m_applicationCode, codeColumn, "4", attributes[i].getILicense());
                m_view.printString(m_applicationCode, codeColumn, "5", attributes[i].getNSecurities());
                m_view.printString(m_applicationCode, codeColumn, "6", attributes[i].getValueOfSecurities());
                m_view.printString(m_applicationCode, codeColumn, "7", attributes[i].getPresentValue());
                m_view.printString(m_applicationCode, codeColumn, "8", attributes[i].getMadeReserve());

                i = i + 1;
            end;
        elif (m_applicationCode == "F155_92")    //раздел справочно, номер строки 3
            attrPart4 = m_part.getAttribute("3");
            m_view.printString(m_applicationCode, "1", "1", attrPart4.getStringValue());
        elif (m_applicationCode == "F155_93")    //раздел справочно, номер строки 4
            attrPart4 = m_part.getAttribute("4");
            m_view.printString(m_applicationCode, "1", "1", attrPart4.getStringValue());
        end;
    end;
end;

class (TPtkPsdView) F155PtkPsdView(fileExtension : String, reportDate : Date, encoding : String)
    macro printString(appCode, rowCode, columnCode, value)
        if (value != "")
            insert(m_outFile, m_bic +                      DELIMETER
                            + String(m_stringReportDate) + DELIMETER
                            + appCode +                    DELIMETER
                            + rowCode +                    DELIMETER
                            + columnCode +                 DELIMETER
                            + value +                      DELIMETER
                            + EOL);

            m_rowsCount = m_rowsCount + 1;
        end;
    end;

    private macro constructorF155PtkPsdView(fileExtension : String, reportDate : Date, encoding : String)
        initTPtkPsdView(fileExtension, reportDate, encoding);

        var day, month, year;
        DateSplit(m_reportDate, day, month, year);

        m_stringReportDate =  strLpad(string(day),   2, "0") + "."
                            + strLpad(string(month), 2, "0") + "."
                            + string(year);
    end;

    constructorF155PtkPsdView(fileExtension, reportDate, encoding);
end;

class  TPtkPsdExportController()

    private var m_ptkPsdExportPartControllers : TArray;

    private var m_ptkPsdView;

    private var m_report;


    private macro constructor()
        m_ptkPsdExportPartControllers = TArray();
        m_ptkPsdView                  = F155PtkPsdView("155", rcbApplication().currentReport.context.period.endDate + 1, "rsansi");
        m_report                      = objectFactoryInstance.createReport();
    end;

    private macro getDescriptorInfo()
        return "";
    end;

    macro execute()
        var i = 0;
        var protocolView  = TProtocolView("ПРОТОКОЛ ЭКСПОРТА В АС ПСД");

        protocolView.setProtocolOutput();
        protocolView.printHead();

        m_ptkPsdView.setOutputFile();
        while ( i < m_ptkPsdExportPartControllers.size)
            m_ptkPsdExportPartControllers[i].execute();
            i = i + 1;
        end;
        m_ptkPsdView.resetOutputFile();

        protocolView.printLine("Альбом форм АС ПСД: " + getDescriptorInfo());
        protocolView.printLine("Файл экспорта: " + m_ptkPsdView.getFileName());
        protocolView.printLine("Количество выгруженных записей: " + m_ptkPsdView.getRowsCount()());

        protocolView.resetProtocolOutput();
        protocolView.show();
    end;

    constructor();
end;

/**
 * Операция экспорта в АС ПСД отчета.
 */
class (TPtkPsdExportController)TPtkPsdExportController2742()

    private macro TPtkPsdExportController2742constructor()
        initTPtkPsdExportController();
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController2742(m_ptkPsdView, m_report.getPart(1), "F155");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController2742(m_ptkPsdView, m_report.getPart(2), "F155_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController2742(m_ptkPsdView, m_report.getPart(3), "F155_3");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController2742(m_ptkPsdView, m_report.getPart(4), "F155_9");
    end;

    TPtkPsdExportController2742constructor();
end;

class (TPtkPsdExportController)TPtkPsdExportController2835()

    private macro TPtkPsdExportController2835constructor()
        initTPtkPsdExportController();
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController2835(m_ptkPsdView, m_report.getPart(1), "F155");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController2835(m_ptkPsdView, m_report.getPart(2), "F155_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController2835(m_ptkPsdView, m_report.getPart(3), "F155_3");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController2835(m_ptkPsdView, m_report.getPart(4), "F155_9");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController2835(m_ptkPsdView, m_report.getPart(5), "F155_91");
    end;

    TPtkPsdExportController2835constructor();
end;

class (TPtkPsdExportController)TPtkPsdExportController3006()

    private macro constructorTPtkPsdExportController3006()
        initTPtkPsdExportController();
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, m_report.getPart(1), "F155");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, m_report.getPart(2), "F155_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, m_report.getPart(3), "F155_3");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, m_report.getPart(4), "F155_9");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, m_report.getPart(5), "F155_91");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, m_report.getPart(4), "F155_92");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, m_report.getPart(4), "F155_93");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3006(m_ptkPsdView, m_report.getPart(4), "F155_94");
    end;

    constructorTPtkPsdExportController3006();
end;

class (TPtkPsdExportController)TPtkPsdExportController3129()

    private macro getDescriptorInfo()
        return "";
    end;

    private macro constructorTPtkPsdExportController3129()
        initTPtkPsdExportController();
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3129(m_ptkPsdView, m_report.getPart(1), "F155");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3129(m_ptkPsdView, m_report.getPart(2), "F155_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3129(m_ptkPsdView, m_report.getPart(4), "F155_9");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3129(m_ptkPsdView, m_report.getPart(3), "F155_91");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3129(m_ptkPsdView, m_report.getPart(3), "F155_92");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3129(m_ptkPsdView, m_report.getPart(3), "F155_93");
    end;

    constructorTPtkPsdExportController3129();
end;

class (TPtkPsdExportController)TPtkPsdExportController3468()

    private macro getDescriptorInfo()
        return "Alb2_2_4.doc от 04.02.2015";
    end;

    private macro constructorTPtkPsdExportController3468()
        initTPtkPsdExportController();
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3129(m_ptkPsdView, m_report.getPart(1), "F155");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3129(m_ptkPsdView, m_report.getPart(2), "F155_2");
        m_ptkPsdExportPartControllers[m_ptkPsdExportPartControllers.size] = TPtkPsdExportPartController3129(m_ptkPsdView, m_report.getPart(3), "F155_9");
    end;

    constructorTPtkPsdExportController3468();
end;
