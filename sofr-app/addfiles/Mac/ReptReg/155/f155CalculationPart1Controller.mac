/*
$Name:          f155CalculationPart1Controller.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 155. Контроллер расчета. Раздел 1.
*/


/**
 * Форма 155. Контроллер расчета. Раздел 1.
 *
 * @since   01.09.2008
 * @author  Ivkina Olga
 * @version 6.00.020.29
 */
import Календарь;
import f155CalculationPartController;
import SbCrdInter;

class (TCalculationAttribute) TPart1CalculationAttribute(name : String)

/*    private*/ macro addAttributeValue(attribute : TAttribute, data /*: TDataSet*/, backOffice)

        attribute.addSubAttributeExactValue( "3", NVL(data.column_4, 0) +
                                                  NVL(data.column_5, 0) +
                                                  NVL(data.column_6, 0) +
                                                  NVL(data.column_7, 0) +
                                                  NVL(data.column_8, 0),  backOffice);
        attribute.addSubAttributeExactValue( "4", data.column_4,  backOffice);
        attribute.addSubAttributeExactValue( "5", data.column_5,  backOffice);
        attribute.addSubAttributeExactValue( "6", data.column_6,  backOffice);
        attribute.addSubAttributeExactValue( "7", data.column_7,  backOffice);
        attribute.addSubAttributeExactValue( "8", data.column_8,  backOffice);
        attribute.addSubAttributeExactValue( "9", data.column_9,  backOffice);
        attribute.addSubAttributeExactValue("10", data.column_10, backOffice);

        attribute.addSubAttributeExactValue("11", NVL(data.column_12, 0) +
                                                  NVL(data.column_13, 0) +
                                                  NVL(data.column_14, 0) +
                                                  NVL(data.column_15, 0), backOffice);

        attribute.addSubAttributeExactValue("12", data.column_12, backOffice);
        attribute.addSubAttributeExactValue("13", data.column_13, backOffice);
        attribute.addSubAttributeExactValue("14", data.column_14, backOffice);
        attribute.addSubAttributeExactValue("15", data.column_15, backOffice);
    end;

    macro addAttributeNote(attribute : TAttribute, note : String)
        attribute.setNote(note);
    end;

    /**
     * Выполнить расчет атрибута.
     */
    macro specificCalculationExecute() : BOOL
        var data;
        var j    = 4;
        var line = m_name + j;
        var attribute;

        var totalAttribute = m_part.addAttribute(subStr(m_name, 1, strLen(m_name)-1));

        var i = 0;
        while ( i < m_calculationData.size)
            if (i == 0)
                m_protocol.printCalculationLineMessage(line);
            end;
            m_protocol.print(BO_GetFullName(m_calculationData[i].getBackOffice()) + ". " + m_calculationData[i].getNote());

            data = m_calculationData[i].getData();

            while (not data.EOF)
                attribute = m_part.addAttribute(line);

                addAttributeValue(attribute,
                                  data,
                                  m_calculationData[i].getBackOffice());

                addAttributeValue(totalAttribute,
                                  data /*: TDataSet*/);

                addAttributeNote(attribute, data.name);

                j = j + 1;
                line = m_name + j;
                m_protocol.printCalculationLineMessage(line);
                m_protocol.print(BO_GetFullName(m_calculationData[i].getBackOffice()) + ". " + m_calculationData[i].getNote());
                data = m_calculationData[i].getData();
            end;
            i = i + 1;
        end;

        return true;
    end;

/*    private macro constructor(name : String, calculationData /*: TCalculationData*/)*/
        initTCalculationAttribute();
        m_name = name;

        private var temp;
        private var i = 2;

        while (GetParm(i, temp))
             m_calculationData[m_calculationData.size] = temp;
             i = i + 1;
        end;

/*    end;*/

/*    constructor(name, calculationData);*/
end;

class (TPart1CalculationAttribute) TPart1CalculationAttribute_41_1_3_8_728(name : String)
//    initTPart1CalculationAttribute(name);
    /**
     * Выполнить расчет атрибута.
     */
    macro specificCalculationExecute() : BOOL
        var data;
        var j    = 5;
        var line = m_name + j;
        var attribute;

        var totalAttribute = m_part.addAttribute(subStr(m_name, 1, strLen(m_name)-1));

        var i = 0;
        while ( i < m_calculationData.size)
            if (i == 0)
                m_protocol.printCalculationLineMessage(line);
            end;
            m_protocol.print(BO_GetFullName(m_calculationData[i].getBackOffice()) + ". " + m_calculationData[i].getNote());

            data = m_calculationData[i].getData();

            while (not data.EOF)
                attribute = m_part.addAttribute(line);

                addAttributeValue(attribute,
                                  data,
                                  m_calculationData[i].getBackOffice());

                addAttributeValue(totalAttribute,
                                  data /*: TDataSet*/);

                addAttributeNote(attribute, data.name);

                j = j + 1;
                line = m_name + j;
                m_protocol.printCalculationLineMessage(line);
                m_protocol.print(BO_GetFullName(m_calculationData[i].getBackOffice()) + ". " + m_calculationData[i].getNote());
                data = m_calculationData[i].getData();
            end;
            i = i + 1;
        end;

        return true;
    end;

    initTCalculationAttribute();
    m_name = name;

    i = 2;
    while (GetParm(i, temp))
         m_calculationData[m_calculationData.size] = temp;
         i = i + 1;
    end;
end;

/**
 *  Расчет переменных по 2055-У.
 *
 */
class (TCalculationPartController) TCalculationPart1Controller2055(protocol, report, part)
    /**
     * Источник данных по счетам в ГК.
     */
    private var m_cbAccountsDataSource;

    /**
     * Источник данных по договорам в Loans-е.
     */
    private var m_loansCreditDataSource;

    /**
     * Источник данных по портфелям в ГК.
     */
    private var m_cbCaseDataSource;

    /**
     * Источник данных по портфелям в Loans.
     */
    private var m_loansCaseDataSource;

    private var m_tuneTable;

    private var endDateAfterYear = DateAfterCalenMonths(rcbApplication().currentReport.context.period.endDate, 12);

    /**
     * Конструктор.
     */
    private macro constructor(protocol, report, part)

        initTCalculationPartController(protocol, report, part);

        m_cbAccountsDataSource  =  objectFactoryInstance.createDataSource(BOCb,    1);
        m_loansCreditDataSource =  objectFactoryInstance.createDataSource(BOLoans, 1);

        m_cbCaseDataSource      =  objectFactoryInstance.createDataSource(BOCb,    2);
        m_loansCaseDataSource   =  objectFactoryInstance.createDataSource(BOLoans, 2);

        m_tuneTable = objectFactoryInstance.createTuneTable();
    end;

    private macro calculationAttribute1()
        return TPart1CalculationAttribute("1",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "1", m_cbAccountsDataSource.getBackOffice()))+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase()),
                                   TCalculationData(m_loansCreditDataSource.getBackOffice(),
                                                    r2m(m_loansCreditDataSource,"getContingentLiabilitiesData"),
                                                    m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA) +
                                                    m_loansCreditDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getBackOffice2(m_part.getNumber(), "1", m_loansCreditDataSource.getBackOffice())))
                                  );
    end;

    private macro calculationAttribute1_1()
        return TPart1CalculationAttribute("1.1",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "1", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().hasMaturityDate(endDateAfterYear)+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase()),
                                   TCalculationData(m_loansCreditDataSource.getBackOffice(),
                                                    r2m(m_loansCreditDataSource,"getContingentLiabilitiesData"),
                                                    m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA) +
                                                    m_loansCreditDataSource.getFilter().hasFinishDate(endDateAfterYear)+
                                                    m_loansCreditDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getBackOffice2(m_part.getNumber(), "1", m_loansCreditDataSource.getBackOffice())))
                                  );
    end;

    private macro calculationAttribute2()
        return TPart1CalculationAttribute("2",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "2_покр", m_cbAccountsDataSource.getBackOffice()))+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                    "2_покр"),
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "2_непокр", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Строка 2'")+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                    "2_непокр, \"Категория для отчетности/Для формы 155\" =  \"Строка 2\"")
                                  );
    end;

    private macro calculationAttribute2_1()
        return TPart1CalculationAttribute("2.1",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "2_покр", m_cbAccountsDataSource.getBackOffice()))+
                                                    m_cbAccountsDataSource.getFilter().hasMaturityDate(endDateAfterYear)+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                    "2_покр"),
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "2_непокр", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Строка 2'")+
                                                    m_cbAccountsDataSource.getFilter().hasMaturityDate(endDateAfterYear)+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                    "2_непокр, \"Категория для отчетности/Для формы 155\" =  \"Строка 2\"")
                                  );
    end;

    private macro calculationAttribute3()
        return TPart1CalculationAttribute("3",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "3", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Строка 3'")+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                    " \"Категория для отчетности/Для формы 155\" =  \"Строка 3\""),
                                   TCalculationData(m_loansCreditDataSource.getBackOffice(),
                                                    r2m(m_loansCreditDataSource,"getContingentLiabilitiesData"),
                                                    m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE)+
                                                    m_loansCreditDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getBackOffice2(m_part.getNumber(), "3", m_loansCreditDataSource.getBackOffice())))
                                  );
    end;

    private macro calculationAttribute3_1()
        return TPart1CalculationAttribute("3.1",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "3", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Строка 3'")+
                                                    m_cbAccountsDataSource.getFilter().hasMaturityDate(endDateAfterYear)+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                    " \"Категория для отчетности/Для формы 155\" =  \"Строка 3\""),
                                   TCalculationData(m_loansCreditDataSource.getBackOffice(),
                                                    r2m(m_loansCreditDataSource,"getContingentLiabilitiesData"),
                                                    m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE) +
                                                    m_loansCreditDataSource.getFilter().hasFinishDate(endDateAfterYear)+
                                                    m_loansCreditDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getBackOffice2(m_part.getNumber(), "3", m_loansCreditDataSource.getBackOffice())))
                                  );
    end;

    private macro calculationAttribute4()
        return TPart1CalculationAttribute("4",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "4", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Строка 4'")+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                    " \"Категория для отчетности/Для формы 155\" =  \"Строка 4\"")
                                  );
    end;

    private macro calculationAttribute4_1()
        return TPart1CalculationAttribute("4.1",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "4", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Строка 4'")+
                                                    m_cbAccountsDataSource.getFilter().hasMaturityDate(endDateAfterYear)+
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                    " \"Категория для отчетности/Для формы 155\" =  \"Строка 4\"")
                                  );
    end;

    private macro calculationAttribute5()
        return TPart1CalculationAttribute("5",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "5", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase())
                                  );
    end;

    private macro calculationAttribute5_1()
             return TPart1CalculationAttribute("5.1",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "5", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().hasMaturityDate(endDateAfterYear) +
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase())
                                  );
    end;

    private macro calculationAttribute6()
        var t = TPart1CalculationAttribute("6");
        t.addComponent("1");
        t.addComponent("2");
        t.addComponent("3");
        t.addComponent("4");
        t.addComponent("5");
        return t;
    end;

    private macro calculationAttribute6_1()
        var t = TPart1CalculationAttribute("6.1");
        t.addComponent("1.1");
        t.addComponent("2.1");
        t.addComponent("3.1");
        t.addComponent("4.1");
        t.addComponent("5.1");
        return t;
    end;


    private macro calculationAttribute7()
        var t = TPart1CalculationAttribute("7");
        t.addComponent("7.1");
        t.addComponent("7.2");
        t.addComponent("7.3");
/*        t.addAttributeDependencies("7.4");*/
        return t;
    end;

    private macro calculationAttribute7_1()
        return TPart1CalculationAttribute("7.1",
                                   TCalculationData(m_cbCaseDataSource.getBackOffice(),
                                                    r2m(m_cbCaseDataSource,"getContingentLiabilitiesData"),
                                                    m_cbCaseDataSource.getFilter().hasStringInName("неиспользованные кредитные линии")),
                                   TCalculationData(m_loansCaseDataSource.getBackOffice(),
                                                    r2m(m_loansCaseDataSource,"getContingentLiabilitiesData"),
                                                    m_loansCaseDataSource.getFilter().hasCreditType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)+
                                                    m_loansCreditDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getBackOffice2(m_part.getNumber(), "3", m_loansCreditDataSource.getBackOffice())))
                                  );
    end;

    private macro calculationAttribute7_2()
        return TPart1CalculationAttribute("7.2",
                                   TCalculationData(m_cbCaseDataSource.getBackOffice(),
                                                    r2m(m_cbCaseDataSource,"getContingentLiabilitiesData"),
                                                    m_cbCaseDataSource.getFilter().hasStringInName("выданные гарантии и поручительства")),
                                   TCalculationData(m_loansCaseDataSource.getBackOffice(),
                                                    r2m(m_loansCaseDataSource,"getContingentLiabilitiesData"),
                                                    m_loansCaseDataSource.getFilter().hasCreditType(LO_GUARANTEE)+
                                                    m_loansCreditDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getBackOffice2(m_part.getNumber(), "3", m_loansCreditDataSource.getBackOffice())))
                                  );
    end;

    private macro calculationAttribute7_3()
        return TPart1CalculationAttribute("7.3",
                                   TCalculationData(m_cbCaseDataSource.getBackOffice(),
                                                    r2m(m_cbCaseDataSource,"getContingentLiabilitiesData"),
                                                    m_cbCaseDataSource.getFilter().hasStringInName("акцепты и авали"))
                                  );
    end;

    private macro calculationAttribute7_X()
        return TPart1CalculationAttribute("7.",
                                   TCalculationData(m_cbCaseDataSource.getBackOffice(),
                                                    r2m(m_cbCaseDataSource,"getOtherCaseContingentLiabilitiesData"),
                                                    m_cbCaseDataSource.getFilter().notHasStringInName("акцепты и авали",
                                                                                                      "выданные гарантии и поручительства",
                                                                                                      "неиспользованные кредитные линии") +
                                                    m_cbCaseDataSource.getFilter().isChapter(3))
                                  );
    end;

    private macro initialize()
        m_calc = ArrCreate
        (
         calculationAttribute1(),
         calculationAttribute1_1(),
         calculationAttribute2(),
         calculationAttribute2_1(),
         calculationAttribute3(),
         calculationAttribute3_1(),
         calculationAttribute4(),
         calculationAttribute4_1(),
         calculationAttribute5(),
         calculationAttribute5_1(),
         calculationAttribute6(),
         calculationAttribute6_1(),
         calculationAttribute7(),
         calculationAttribute7_1(),
         calculationAttribute7_2(),
         calculationAttribute7_3()
        );
    end;

    macro calculationExecute()
        calculationExecute();

        var c = calculationAttribute7_X();
        c.setPart(m_part);
        c.setProtocol(m_protocol);
        c.specificCalculationExecute();

        RcbApplication().TransactionManager().commit(); /*на всякий случай*/
    end;

    constructor(protocol, report, part);
end;

/**
 *  Расчет переменных по 41-1-3-8/728
 *
 */
class (TCalculationPart1Controller2055) TCalculationPart1Controller_41_1_3_8_728(protocol, report, part)
    initTCalculationPart1Controller2055(protocol, report, part);

    var m_loansCaseDataSource_74;

    /**
     * Конструктор.
     */
    private macro constructor(protocol, report, part)

        initTCalculationPartController(protocol, report, part);

        m_cbAccountsDataSource    = objectFactoryInstance.createDataSource(BOCb,    1);
        m_loansCreditDataSource   = objectFactoryInstance.createDataSource(BOLoans, 1);

        m_cbCaseDataSource        = objectFactoryInstance.createDataSource(BOCb,    2);
        m_loansCaseDataSource     = objectFactoryInstance.createDataSource(BOLoans, 2);
        m_loansCaseDataSource_74  = objectFactoryInstance.createDataSource(BOLoans, 3);

        m_tuneTable = objectFactoryInstance.createTuneTable();
    end;

    private macro calculationAttribute5()
        return TPart1CalculationAttribute("5",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "5", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase()),
                                   TCalculationData(m_loansCreditDataSource.getBackOffice(),
                                                    r2m(m_loansCreditDataSource,"getContingentLiabilitiesData"),
                                                    m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE)+
                                                    m_loansCreditDataSource.getFilter().hasIssueType(CF_GUARANTEELINE)+                   //Тип выдачи/депозита = "Гарантийная линия"
                                                    m_loansCreditDataSource.getFilter().getRegisters(TDR_NOLIMGUAR))
                                  );
    end;

    private macro calculationAttribute5_1()
             return TPart1CalculationAttribute("5.1",
                                   TCalculationData(m_cbAccountsDataSource.getBackOffice(),
                                                    r2m(m_cbAccountsDataSource,"getContingentLiabilitiesData"),
                                                    m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getAccountMasks(m_part.getNumber(), "5", m_cbAccountsDataSource.getBackOffice())) +
                                                    m_cbAccountsDataSource.getFilter().hasMaturityDate(endDateAfterYear) +
                                                    m_cbAccountsDataSource.getFilter().isAccountNotInСase()),
                                   TCalculationData(m_loansCreditDataSource.getBackOffice(),
                                                    r2m(m_loansCreditDataSource,"getContingentLiabilitiesData"),
                                                    m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE)+
                                                    m_loansCreditDataSource.getFilter().hasIssueType(CF_GUARANTEELINE)+                   //Тип выдачи/депозита = "Гарантийная линия"
                                                    m_loansCreditDataSource.getFilter().getRegisters(TDR_NOLIMGUAR)+
                                                    m_loansCreditDataSource.getFilter().hasFinishDate(endDateAfterYear))
                                  );
    end;

    private macro calculationAttribute7()
        var t = TPart1CalculationAttribute("7");
        t.addComponent("7.1");
        t.addComponent("7.2");
        t.addComponent("7.3");
        t.addComponent("7.4");
        return t;
    end;

    private macro calculationAttribute7_2()
        return TPart1CalculationAttribute("7.2",
                                   TCalculationData(m_cbCaseDataSource.getBackOffice(),
                                                    r2m(m_cbCaseDataSource,"getContingentLiabilitiesData"),
                                                    m_cbCaseDataSource.getFilter().hasStringInName("выданные гарантии и поручительства")),
                                   TCalculationData(m_loansCaseDataSource.getBackOffice(),
                                                    r2m(m_loansCaseDataSource,"getContingentLiabilitiesData"),
                                                    m_loansCaseDataSource.getFilter().hasCreditType(LO_GUARANTEE)+                          //Тип договора = "Гарантия"
                                                    m_loansCaseDataSource.getFilter().hasCreditIssueType(CF_GUARANTEE)+                     //Тип выдачи/депозита = "Разовая гарантия"
                                                    m_loansCreditDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getBackOffice2(m_part.getNumber(), "3", m_loansCreditDataSource.getBackOffice())))
                                  );
    end;

    private macro calculationAttribute7_4()
        return TPart1CalculationAttribute("7.4",
                                   TCalculationData(m_loansCaseDataSource_74.getBackOffice(),
                                                    r2m(m_loansCaseDataSource_74,"getContingentLiabilitiesData"),
                                                    m_loansCaseDataSource_74.getFilter().hasCreditType(LO_GUARANTEE)+
                                                    m_loansCaseDataSource_74.getFilter().hasCreditIssueType(CF_GUARANTEELINE)+                 //Тип выдачи/депозита = "Гарантийная линия"
                                                    m_loansCreditDataSource.getFilter().isSatisfiesToAccountMasks(m_tuneTable.getBackOffice2(m_part.getNumber(), "3", m_loansCreditDataSource.getBackOffice())))
                                  );
    end;

    private macro calculationAttribute7_X()
        return TPart1CalculationAttribute_41_1_3_8_728("7.",
                                   TCalculationData(m_cbCaseDataSource.getBackOffice(),
                                                    r2m(m_cbCaseDataSource,"getOtherCaseContingentLiabilitiesData"),
                                                    m_cbCaseDataSource.getFilter().notHasStringInName("акцепты и авали",
                                                                                                      "выданные гарантии и поручительства",
                                                                                                      "неиспользованные кредитные линии") +
                                                    m_cbCaseDataSource.getFilter().isChapter(3))
                                  );
    end;

    private macro initialize()
        m_calc = ArrCreate
        (
         calculationAttribute1(),
         calculationAttribute1_1(),
         calculationAttribute2(),
         calculationAttribute2_1(),
         calculationAttribute3(),
         calculationAttribute3_1(),
         calculationAttribute4(),
         calculationAttribute4_1(),
         calculationAttribute5(),
         calculationAttribute5_1(),
         calculationAttribute6(),
         calculationAttribute6_1(),
         calculationAttribute7(),
         calculationAttribute7_1(),
         calculationAttribute7_2(),
         calculationAttribute7_3(),
         calculationAttribute7_4()
        );
    end;
end;
