/*
$Name:          f155CalculationController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 155. Контроллер расчета
*/

/**
 * Форма 155. Контроллер расчета.
 *
 * @since   01.09.2008
 * @author  Ivkina Olga
 * @version 6.00.020.29
 */
import f155DataSourceProtocols;

import f155CalculationPart1Controller;
import f155CalculationPart2Controller;
import f155CalculationPart3Controller;
import f155CalculationPart4Controller;

/**
 * Контроллер расчета.
 */
class TCalculationController()
    /**
     * Отчет.
     */
    private var m_report : TReport;

    /**
     * Протокол расчета.
     */
    private var m_protocol;

    /**
     * Массив контроллеров расчета.
     */
    private var m_calculationControllers : TArray;


    private macro constructor()
        m_report     = objectFactoryInstance.createReport();
        m_protocol   = objectFactoryInstance.createPrintCalculationProtocolOperation();

        m_calculationControllers = TArray();

        RcbApplication().TransactionManager().commit();
    end;

    /**
     * Рассчитать отчет.
     */
    macro calculateReport()
        var i = 0;

        m_protocol.setProtocolOutput();
        m_protocol.printHead();

        while(i < m_calculationControllers.size)
            BegAction(2000, "Расчет раздела " + (i+1) + ".");
            m_calculationControllers[i].execute();
            RcbApplication().TransactionManager().commit();
            EndAction(1);
            i = i + 1;
        end;

        m_protocol.resetProtocolOutput();
    end;

    constructor();
end;


/**
 * Контроллер расчета.
 */
class (TCalculationController) TCalculationController2055()
    private macro constructor()
        /**
         * Удаление структурных значений переменной "Разделы".
         * Т.к. системная операция при удалении сносит и переменные пользовательского ввода.
         */
        rcbApplication().currentReport.attributeValue("Раздел1").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел2").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел3").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочно").removeAllValues();

        initTCalculationController();

        m_calculationControllers[m_calculationControllers.size] = TCalculationPart1Controller2055(m_protocol, m_report, m_report.getPart(1));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart2Controller2055(m_protocol, m_report, m_report.getPart(2));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart3Controller2055(m_protocol, m_report, m_report.getPart(3));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart4Controller2055(m_protocol, m_report, m_report.getPart(4));
    end;

    constructor();
end;

class (TCalculationController) TCalculationController2742()
    private macro constructor()
        /**
         * Удаление структурных значений переменной "Разделы".
         * Т.к. системная операция при удалении сносит и переменные пользовательского ввода.
         */
        rcbApplication().currentReport.attributeValue("Раздел1").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел2").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел3").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочно").removeAllValues();

        initTCalculationController();

        m_calculationControllers[m_calculationControllers.size] = TCalculationPart1Controller2055(m_protocol, m_report, m_report.getPart(1));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart2Controller2742(m_protocol, m_report, m_report.getPart(2));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart3Controller2742(m_protocol, m_report, m_report.getPart(3));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart4Controller2055(m_protocol, m_report, m_report.getPart(4));
    end;

    constructor();
end;

class (TCalculationController) TCalculationController2835()
    private macro constructor()
        /**
         * Удаление структурных значений переменной "Разделы".
         * Т.к. системная операция при удалении сносит и переменные пользовательского ввода.
         */
        rcbApplication().currentReport.attributeValue("Раздел1").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел2").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел3").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочно").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочноПункт2").removeAllValues();

        initTCalculationController();

        m_calculationControllers[m_calculationControllers.size] = TCalculationPart1Controller2055(m_protocol, m_report, m_report.getPart(1));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart2Controller2835(m_protocol, m_report, m_report.getPart(2));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart3Controller2742(m_protocol, m_report, m_report.getPart(3));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart4Controller2835(m_protocol, m_report, m_report.getPart(4));
    end;

    /**
     * Рассчитать отчет.
     */
    macro calculateReport()
        var i = 0;

        m_protocol.setProtocolOutput();
        m_protocol.printHead();

        while(i < m_calculationControllers.size)
            BegAction(2000, "Расчет раздела " + (i+1) + ".");
            m_calculationControllers[i].execute();
            RcbApplication().TransactionManager().commit();
            EndAction(1);
            i = i + 1;
        end;
        TCalculationPart4Item2Controller2835(m_protocol, m_report, m_report.getPart(5));
        RcbApplication().TransactionManager().commit();

        m_protocol.resetProtocolOutput();
    end;

    constructor();
end;

class (TCalculationController) TCalculationController3006()
    private macro constructorTCalculationController3006()
        /**
         * Удаление структурных значений переменной "Разделы".
         * Т.к. системная операция при удалении сносит и переменные пользовательского ввода.
         */
        rcbApplication().currentReport.attributeValue("Раздел1").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел2").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел3").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочно").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочноПункт2").removeAllValues();

        initTCalculationController();

        m_calculationControllers[m_calculationControllers.size] = TCalculationPart1Controller2055(m_protocol, m_report, m_report.getPart(1));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart2Controller2835(m_protocol, m_report, m_report.getPart(2));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart3Controller2742(m_protocol, m_report, m_report.getPart(3));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart4Controller3006(m_protocol, m_report, m_report.getPart(4));
    end;

    /**
     * Рассчитать отчет.
     */
    macro calculateReport()
        var i = 0;

        m_protocol.setProtocolOutput();
        m_protocol.printHead();

        while(i < m_calculationControllers.size)
            BegAction(2000, "Расчет раздела " + (i+1) + ".");
            m_calculationControllers[i].execute();
            RcbApplication().TransactionManager().commit();
            EndAction(1);
            i = i + 1;
        end;
        TCalculationPart4Item2Controller2835(m_protocol, m_report, m_report.getPart(5));

        RcbApplication().TransactionManager().commit();

        i = 0;
        while (i < m_calculationControllers.size)
            m_calculationControllers[i].rounding();
            i = i + 1;
        end;

        RcbApplication().TransactionManager().commit();

        m_protocol.resetProtocolOutput();
    end;

    constructorTCalculationController3006();
end;

class (TCalculationController) TCalculationController3129()
    private macro constructorTCalculationController3129()
        /**
         * Удаление структурных значений переменной "Разделы".
         * Т.к. системная операция при удалении сносит и переменные пользовательского ввода.
         */
        rcbApplication().currentReport.attributeValue("Раздел1").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел2").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочно").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочноПункт1").removeAllValues();

        initTCalculationController();

        m_calculationControllers[m_calculationControllers.size] = TCalculationPart1Controller2055(m_protocol, m_report, m_report.getPart(1));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart2Controller3129(m_protocol, m_report, m_report.getPart(2));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart3Controller3129(m_protocol, m_report, m_report.getPart(3));
    end;

    /**
     * Рассчитать отчет.
     */
    macro calculateReport()
        var i = 0;

        m_protocol.setProtocolOutput();
        m_protocol.printHead();

        while(i < m_calculationControllers.size)
            BegAction(2000, "Расчет раздела " + (i+1) + ".");
            m_calculationControllers[i].execute();
            RcbApplication().TransactionManager().commit();
            EndAction(1);
            i = i + 1;
        end;
        TCalculationPart4Item1Controller3129(m_protocol, m_report, m_report.getPart(4));

        RcbApplication().TransactionManager().commit();

        i = 0;
        while (i < m_calculationControllers.size)
            m_calculationControllers[i].rounding();
            i = i + 1;
        end;

        RcbApplication().TransactionManager().commit();

        m_protocol.resetProtocolOutput();
    end;

    constructorTCalculationController3129();
end;


class (TCalculationController) TCalculationController3468()
    private macro constructorTCalculationController3468()
        /**
         * Удаление структурных значений переменной "Разделы".
         * Т.к. системная операция при удалении сносит и переменные пользовательского ввода.
         */
        rcbApplication().currentReport.attributeValue("Раздел1").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел2").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочноПункт1").removeAllValues();

        initTCalculationController();

        m_calculationControllers[m_calculationControllers.size] = TCalculationPart1Controller2055(m_protocol, m_report, m_report.getPart(1));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart2Controller3129(m_protocol, m_report, m_report.getPart(2));
    end;

    /**
     * Рассчитать отчет.
     */
    macro calculateReport()
        var i = 0;

        m_protocol.setProtocolOutput();
        m_protocol.printHead();

        while(i < m_calculationControllers.size)
            BegAction(2000, "Расчет раздела " + (i+1) + ".");
            m_calculationControllers[i].execute();
            RcbApplication().TransactionManager().commit();
            EndAction(1);
            i = i + 1;
        end;
        TCalculationPart4Item1Controller3468(m_protocol, m_report, m_report.getPart(3));

        RcbApplication().TransactionManager().commit();

        i = 0;
        while (i < m_calculationControllers.size)
            m_calculationControllers[i].rounding();
            i = i + 1;
        end;

        RcbApplication().TransactionManager().commit();

        m_protocol.resetProtocolOutput();
    end;

    constructorTCalculationController3468();
end;

class (TCalculationController3468) TCalculationController_41_1_3_8_728()

    private macro constructorTCalculationController_41_1_3_8_728()
        /**
         * Удаление структурных значений переменной "Разделы".
         * Т.к. системная операция при удалении сносит и переменные пользовательского ввода.
         */
        rcbApplication().currentReport.attributeValue("Раздел1").removeAllValues();
        rcbApplication().currentReport.attributeValue("Раздел2").removeAllValues();
        rcbApplication().currentReport.attributeValue("РазделСправочноПункт1").removeAllValues();

        initTCalculationController();

        m_calculationControllers[m_calculationControllers.size] = TCalculationPart1Controller_41_1_3_8_728(m_protocol, m_report, m_report.getPart(1));
        m_calculationControllers[m_calculationControllers.size] = TCalculationPart2Controller3129(m_protocol, m_report, m_report.getPart(2));
    end;

    constructorTCalculationController_41_1_3_8_728();
end;
