/*
$Name:          f129NormalizationProtocol.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 129. Протокол нормализации
*/

class (TProtocolView) T129NormalizationProtocolView()
    initTProtocolView("ПРОТОКОЛ ПРОЦЕДУРЫ НОРМАЛИЗАЦИИ");

    private var m_isHeadPrinted = false;

    macro printNullData()
        [ ];
        [    Корректировок округленных значений символов не потребовалось.];
    end;

    macro printFreeString(str : String)
        println(str);
    end;

    macro beginProtocol()
        setProtocolOutput();
        printHead();
    end;

    macro printSeparatorLine()
            [├───────────────────────────────┼────────────────┼─────────────┼─────────────────┼──────────┤];
    end;

    macro endProtocol()
        if (m_isHeadPrinted)
            [└───────────────────────────────┴────────────────┴─────────────┴─────────────────┴──────────┘];
            [ ];
        end;
        if (m_isEmpty)
            printNullData();
        end;
        resetProtocolOutput();
    end;
	
    macro endProtocolWithoutLine()
        if (m_isEmpty)
            printNullData();
        end;
        resetProtocolOutput();
    end;
	
    macro endProtocolLine()
        if (m_isHeadPrinted)
            [└───────────────────────────────┴────────────────┴─────────────┴─────────────────┴──────────┘];
            [ ];
        end;
    end;
	
    macro printReportAbsence(reportName, report)
        printLine("Отсутствует рассчитанная форма " + reportName + " за период " + report.context.period.beginDate + " - " + report.context.period.endDate,
                  "В процессе нормализации сходимость с данными этой формы не реализована.",
                  "");
    end;

    macro printAuditedReportAbsence(reportName, endDate)
        printLine("Отсутствует рассчитанная форма " + reportName + " за " + endDate,
                  "В процессе нормализации сходимость с данными этой формы не реализована.",
                  "");
    end;

    macro printString(str : String, exact : Money, scaled : Double)
        var floored = round(Double(exact) / rcbApplication.currentReport.multiplier + 0.5, 0, 2);

        if (not m_isHeadPrinted)
            [┌───────────────────────────────┬───────────────────────────────────────────────────────────┐];
            [│                               │                          Значение                         │];
            [│         Номер строки          ├────────────────┬─────────────┬─────────────────┬──────────┤];
            [│                               │ Действительное │ Округленное │ Нормализованное │ Разность │];
            [├───────────────────────────────┼────────────────┼─────────────┼─────────────────┼──────────┤];
            m_isHeadPrinted = true;
        end;

        [│###############################│################│#############│#################│##########│]
        (str, exact, floored : 0 : 0, scaled : 0 : 0, abs(floored - scaled) : 0 : 0);

        m_isEmpty = false;
    end;
end;
