/*
 $Name: f129ReportPrintController.mac
 $Module: Регламентируемая отчетность
 $Description:  Форма 129. Контроллер печати.
 */

/*─────────────────────────────────────────────────────────────────────────────────────────────────┐
  RS-Bank V6.20.030                                                                 R-Style Softlab
  Файл подсистемы "Регламентируемая отчетность"

  Форма 129. Контроллер печати.

  Создан: 17.02.2011 - Shestakov Dmitry
└─────────────────────────────────────────────────────────────────────────────────────────────────*/
import f129ObjectFactory;
import f129ReportView;

/**
 * Операция печати.
 */
class (RcbReportPrintController) T129ReportPrintController2332()
    var m_period : RcbArray;

    private macro printPartData(part : object)
        if (strlen(part.getId()) != 1) // части раздела печатаются вкупе с основным разделом
            return;
        end;

        var partView = m_reportView.getPartView(part.getId());

        var isEmptyPart = true;
        if (part.isEmpty())
            if (part.getId() == "1")
                if (not m_report.getPart("1s").isEmpty())
                    isEmptyPart = false;
                end;
            end;
        else
            isEmptyPart = false;
        end;

        if (isEmptyPart)
            return partView.printNullData();
        end;

        partView.printHead();

        var valuePool;
        var columns;
        if (part.getId() == "1")
            columns = RcbArray().initialize("2", "3", "4", "5", "6", "7", "8", "9");
        else
            columns = RcbArray().initialize("2", "3", "4", "5", "6", "7");
        end;

        m_period.moveFirst();
        while (m_period.moveNext())
            partView.printString(part.getValuePool(rcbArray().initialize(m_period.getCurrentItem()[1]),
                                                   m_period.getCurrentItem()[0],
                                                   columns),
                                 m_period.getCurrentItem()[0]);
        end;

        if (part.getId() == "1")
            partView.printReferenceStrings(
                rcbArray().initialize(
                    m_report.getPart("1s").getValuePool(rcbArray(), "7.1",rcbArray().initialize(null))[0],
                    m_report.getPart("1s").getValuePool(rcbArray(), "7.2",rcbArray().initialize(null))[0]
                )
            );
        end;

        partView.printBottom();
    end;

    macro printDataZone()
        var parts = m_report.getParts();
        parts.moveFirst;

        while (parts.moveNext())
            printPartData(parts.getCurrentItem());
        end;
    end;

    private macro constructorTReportPrintController()
        initRcbReportPrintController();
        m_report      = objectFactoryInstance.createReport(RcbApplication.currentReport);
        m_reportView  = objectFactoryInstance.createReportView();
        m_reportWidth = m_reportView.getWidth();
        m_period      = RcbArray().initialize(arrCreate("1"    , "1. До 30 дней, в том числе:"),
                                              arrCreate("1.1"  , "1.1. До востребования"),
                                              arrCreate("1.2"  , "1.2. На 1 день"),
                                              arrCreate("1.3"  , "1.3. От 2 до 7 дней"),
                                              arrCreate("1.4"  , "1.4. От 8 до 30 дней"),
                                              arrCreate("2"    , "2. От 31 до 90 дней"),
                                              arrCreate("3"    , "3. От 91 до 180 дней"),
                                              arrCreate("4"    , "4. От 181 дня до 1 года"),
                                              arrCreate("5"    , "5. От 1 года до 3 лет"),
                                              arrCreate("6"    , "6. Свыше 3 лет"),
                                              arrCreate("Итого", "Итого: (стр.1 + 2 + 3 + 4 + 5 + 6)")
                                             );
    end;

    constructorTReportPrintController();
end;

class (T129ReportPrintController2332) T129ReportPrintController4212()
    initT129ReportPrintController2332();

    macro print()
        checkReport();

        getReportView().setOutputFile();

        getReportView().setReportWidth(m_reportWidth);
        getReportView().printLendingAgencyCodeZone();
        getReportView().printNamesZone("Полное или сокращенное фирменное наименование кредитной организации (наименование ее филиала) ");

        if (getReport().isEmpty())
            getReportView().printNullDataZone();
        else
            printDataZone();
        end;
    end;

    private macro constructorTReportPrintController()
        initRcbReportPrintController();
        m_report      = objectFactoryInstance.createReport(RcbApplication.currentReport);
        m_reportView  = objectFactoryInstance.createReportView();
        m_reportWidth = m_reportView.getWidth();
        m_period      = RcbArray().initialize(arrCreate("1"    , "1. До 30 дней, в том числе:"),
                                              arrCreate("1.1"  , "1.1. До востребования"),
                                              arrCreate("1.2"  , "1.2. На 1 день"),
                                              arrCreate("1.3"  , "1.3. От 2 до 7 дней"),
                                              arrCreate("1.4"  , "1.4. От 8 до 30 дней"),
                                              arrCreate("2"    , "2. От 31 до 90 дней"),
                                              arrCreate("3"    , "3. От 91 до 180 дней"),
                                              arrCreate("4"    , "4. От 181 дня до 1 года"),
                                              arrCreate("5"    , "5. От 1 года до 3 лет"),
                                              arrCreate("6"    , "6. Свыше 3 лет"),
                                              arrCreate("Итого", "Итого: (сумма строк 1, 2, 3, 4, 5, 6)")
                                             );
    end;
end;

class (T129ReportPrintController4212) T129ReportPrintController4637()
    initT129ReportPrintController4212();

    private macro printPartData(part : object)
        if (strlen(part.getId()) != 1) // части раздела печатаются вкупе с основным разделом
            return;
        end;

        var partView = m_reportView.getPartView(part.getId());

        var isEmptyPart = true;
        if (part.isEmpty())
            if (part.getId() == "1")
                if (not m_report.getPart("1s").isEmpty())
                    isEmptyPart = false;
                end;
            end;
        else
            isEmptyPart = false;
        end;

        if (isEmptyPart)
            return partView.printNullData();
        end;

        partView.printHead();

        var valuePool;

        var columns;
        if (part.getId() == "1")
            columns = RcbArray().initialize("2", "3", "4", "5", "6", "7", "8", "9");
        else
            columns = RcbArray().initialize("2", "3", "4", "5", "6", "7");
        end;

        //печатаем итоговую строку по разделу (Всего по кредитной организации)
        partView.printString(part.getValuePool(rcbArray().initialize(m_period[0][1]),
                                               m_period[0][0],
                                               columns,
                                               "0"),
                             m_period[0][0]);

        //проходим по всем найденным в разделе ОКАТО
        var okatoArray = part.getOkatoArray();
        okatoArray.moveFirst();
        while (okatoArray.moveNext())
            m_period.moveFirst();
            m_period.moveNext();            //пропускаем итоговую строку по разделу
            while (m_period.moveNext())
                partView.printString(part.getValuePool(rcbArray().initialize(m_period.getCurrentItem()[1]),
                                                       m_period.getCurrentItem()[0],
                                                       columns,
                                                       okatoArray.getCurrentItem()
                                                      ),
                                     m_period.getCurrentItem()[0]);
            end;
        end;

        if (part.getId() == "1")
            partView.printReferenceStrings(rcbArray().initialize(m_report.getPart("1").getUserInputPercentValue("8.1")));
        end;

        partView.printBottom();
    end;

    macro print()
        checkReport();

        getReportView().setOutputFile();
        getReportView().setReportWidth(m_reportWidth);
        getReportView().printLendingAgencyCodeZone();
        getReportView().printNamesZone("Полное или сокращенное фирменное наименование кредитной организации ");

        if (getReport().isEmpty())
            getReportView().printNullDataZone();
        else
            printDataZone();
        end;
    end;

    private macro constructorTReportPrintController()
        initRcbReportPrintController();
        m_report      = objectFactoryInstance.createReport(RcbApplication.currentReport);
        m_reportView  = objectFactoryInstance.createReportView();
        m_reportWidth = m_reportView.getWidth();
        m_period      = RcbArray().initialize(arrCreate("1"    , "1. Всего по кредитной организации (сумма строк 2, 3, 4, 5, 6, 7), в том числе:"),
                                              arrCreate("2"    , "2. До 30 дней, в том числе:"),
                                              arrCreate("2.1"  , "2.1. До востребования"),
                                              arrCreate("3"    , "3. От 31 до 90 дней"),
                                              arrCreate("4"    , "4. От 91 до 180 дней"),
                                              arrCreate("5"    , "5. От 181 дня до 1 года"),
                                              arrCreate("6"    , "6. От 1 года до 3 лет"),
                                              arrCreate("7"    , "7. Свыше 3 лет"),
                                              arrCreate("Итого", "Итого: (сумма строк 2, 3, 4, 5, 6, 7)")
                                             );
    end;
end;