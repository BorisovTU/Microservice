/*
$Name:          com_f501.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 501. Служебные процедуры и функции
*/

import cb_sql;

class TF501ThresholdMmDeal()
    macro getThreshold(thresholdDate)
        var query = "SELECT thrsh.t_value"
           + "\n" + "  FROM drepthrshmm_dbt thrsh"
           + "\n" + " WHERE thrsh.t_valueDate = (SELECT MAX(maxDate.t_valueDate)"
           + "\n" + "                              FROM drepthrshmm_dbt maxDate"
           + "\n" + "                             WHERE maxDate.t_valueDate <= " + getSqlDate(thresholdDate)
           + "\n" + "                           )"
                  ;
        var ds = TRsbDataset(query);
        ds.setFieldType("t_value", V_MONEY);
        var threshold = $0;
        if (ds.next())
            threshold = ds.t_value;
        end;
        return threshold;
    end;

    private macro ctorTF501ThresholdMmDeal()
    end;

    ctorTF501ThresholdMmDeal();
end;

var m_is5456RSHBChangesProject;

macro is5456RSHBChangesProject()
    if (m_is5456RSHBChangesProject == NULL)
        m_is5456RSHBChangesProject = ternary(RcbApplication.currentReport.form.name == "Форма 501 по 5456-У", true, false);
    end;

    return m_is5456RSHBChangesProject;
end;