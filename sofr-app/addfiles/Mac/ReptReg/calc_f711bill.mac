/*
$Name:          calc_f711bill.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 711. Расчет второго раздела
*/

/*─────────────────────────────────────────────────────────────────────────────────────────────────┐
  RS-Bank V6                                                                        R-Style Softlab
  Файл подсистемы "Регламентируемая отчетность"

  Расчет формы 711. Раздел 2 по данным подсистем УВ, СВ, ДУ, Депозитарий

  Создан: 24.12.2008 - ABP
└─────────────────────────────────────────────────────────────────────────────────────────────────*/

import DepartmentFilter;
import com_f711;
import com_f711objectFactory;
import dl711bill;

/**
 *  Базовый ИД векселей
 *  @since 6.00.020.29
 *  @author ABP
 */
private class TDataSourceBill(billKind, instruction, dataSourceMode)

    private var m_dataSource : Object;

    private var m_isFirstCall : Bool;

    private var m_billKind : Integer;

    macro counter() : Double               // Номер п/п
        return 0.0;
    end;

    macro issuerName() : String            // Наименование векселедателя
        return nvl(m_dataSource.issuerName, "");
    end;

    macro code711() : String               // Код типа ц/б для ф711
        return nvl(m_dataSource.code711, "");
    end;

    macro issuerInn() : String             // ИНН векселедателя
        return nvl(m_dataSource.issuerInn, "");
    end;

    macro issuerInn_Mark() : String             // для ИНН векселедателя - признак
        return nvl(m_dataSource.IssuerINN_Mark, "");
    end;

    macro issuerInn_Tin() : String             // для ИНН векселедателя - TIN
        return nvl(m_dataSource.IssuerINN_TIN, "");
    end;

    macro issuerInn_CodeKind() : String
        return nvl(m_dataSource.IssuerNotResCode, ""); // Вид кода векселедателя-нерезидента
    end;

    macro issuerOgrn() : String             // ОГРН векселедателя
        return nvl(m_dataSource.IssuerOGRN, "");
    end;

    macro DealAgentOGRN() : String             // ОГРН контрагента
        return nvl(m_dataSource.DealAgentOGRN, "");
    end;

    macro DealAgentCountryCodeOksm() : String             // Код страны ОКСМ контрагента
        return nvl(m_dataSource.DealAgentCountryCode2, "");
    end;

    macro StoragePlaceOGRN() : String             // ОГРН юридического лица либо физического лица (при наличии), у которого находится вексель
        return nvl(m_dataSource.StoragePlaceOGRN, "");
    end;

    macro StoragePlaceCountryCode2() : String             // Код ОКСМ страны юридического лица либо физического лица (при наличии), у которого находится вексель
        return nvl(m_dataSource.StoragePlaceCountryCode2, "");
    end;

    macro firstHolderOGRN() : String             // ОГРН первого векселедержателя
        return nvl(m_dataSource.FirstHolderOGRN, "");
    end;

    macro FirstHolderCountryCode2() : String             // Код ОКСМ страны первого векселедержателя
        return nvl(m_dataSource.FirstHolderCountryCode2, "");
    end;

    macro RepaymentDate() : String             // Дата фактического погашения
        return nvl(m_dataSource.RepaymentDate, "");
    end;

    macro HolderOgrn() : String             // ОГРН векселедержателя (собственника) (при наличии)
        return nvl(m_dataSource.HolderOGRN, "");
    end;

    macro HolderCountryCodeOksm() : String             // Код ОКСМ страны векселедержателя (при наличии)
        return nvl(m_dataSource.HolderCountryCode2, "");
    end;

    macro issuerOksm() : String             // Код страны ОКСМ векселедателя
        return nvl(m_dataSource.IssuerCountryCode2, "");
    end;

    macro issuerCountry() : String         // Код страны векселедателя
        return nvl(m_dataSource.issuerCountryCode, "");
    end;

    macro series() : String                // Серия
        return nvl(m_dataSource.series, "");
    end;

    macro number() : String                // Номер
        return nvl(m_dataSource.number, "");
    end;

    macro formNumber() : String            // Номер бланка
        return nvl(m_dataSource.formNumber, "");
    end;

    macro issueDate() : String             // Дата составления
        return string(nvl(m_dataSource.issueDate, "") : f);
    end;

    macro paymentTerm() : String           // Формулировка срока платежа
        return nvl(m_dataSource.termFormula, "");
    end;

    macro faceValue() : Money              // Номинал
        return nvl(m_dataSource.faceValue, $0.0);
    end;

    macro faceValueFiCode() : String       // Код валюты номинала
        return nvl(m_dataSource.faceValueFiCode, "");
    end;

    macro dealDate() : String              // Дата постановки векселя на учет
        return string(nvl(m_dataSource.dealDate, "") : f);
    end;

    macro dealGround() : String            // Ревизиты документа-основания постановки векселя на учет
        return nvl(m_dataSource.dealGround, "");
    end;

    macro dealAgentName() : String         // Наименование контрагента по сделке
        return nvl(m_dataSource.dealAgentName, "");
    end;

    macro dealAgentInn() : String          // ИНН контрагента по сделке
        return nvl(m_dataSource.dealAgentInn, "");
    end;

    macro dealAgentInn_Mark() : String          // для ИНН контрагента по сделке - признак
        return nvl(m_dataSource.DealAgentINN_Mark, "");
    end;

    macro dealAgentInn_Tin() : String          // для ИНН контрагента по сделке - TIN
        return nvl(m_dataSource.DealAgentINN_TIN, "");
    end;

    macro dealAgentInn_CodeKind() : String
        return nvl(m_dataSource.DealAgentNotResCode, ""); // Вид кода контрагента-нерезидента
    end;

    macro dealAgentCountry() : String      // Код страны контрагента по сделке
        return nvl(m_dataSource.dealAgentCountryCode, "");
    end;

    macro bookValue() : Money              // Балансовая стоимость
        return nvl(m_dataSource.balanceCost, $0.0);
    end;

    macro interest() : Money               // Накопленный дисконт/процент
        return nvl(m_dataSource.interest, $0.0);
    end;

    macro balanceAccount() : String        // Номер балансового счета на котором учитывается вексель
        return nvl(m_dataSource.balanceAccNum, "");
    end;

    macro storagePlaceName() : String      // Наименование места хранения
        return nvl(m_dataSource.storagePlaceName, "");
    end;

    macro storagePlaceInn() : String       // ИНН места хранения
        return nvl(m_dataSource.storagePlaceInn, "");
    end;

    macro storagePlaceInn_Mark() : String       // для ИНН места хранения - признак
        return nvl(m_dataSource.StoragePlaceINN_Mark, "");
    end;

    macro storagePlaceInn_Tin() : String       // для ИНН места хранения - TIN
        return nvl(m_dataSource.StoragePlaceINN_TIN, "");
    end;

    macro storagePlaceInn_CodeKind() : String
        return nvl(m_dataSource.StoragePlaceNotResCode, ""); // Вид кода места хранения-нерезидента
    end;

    macro storagePlaceCountry() : String   // Код страны векселедержателя
        return nvl(m_dataSource.storagePlaceCountryCode, "");
    end;

    macro storageGround() : String         // Основание принятия на хранение
        return nvl(m_dataSource.storageGround, "");
    end;

    macro firstHolderName() : String       // Наименование первого векселедержателя
        return nvl(m_dataSource.firstHolderName, "");
    end;

    macro firstHolderInn() : String        // ИНН первого векселедержателя
        return nvl(m_dataSource.firstHolderInn, "");
    end;

    macro firstHolderInn_Mark() : String        // для ИНН первого векселедержателя - признак
        return nvl(m_dataSource.FirstHolderINN_Mark, "");
    end;

    macro firstHolderInn_Tin() : String        // для ИНН первого векселедержателя - TIN
        return nvl(m_dataSource.FirstHolderINN_TIN, "");
    end;

    macro firstHolderInn_CodeKind() : String
        return nvl(m_dataSource.FirstHolderNotResCode, ""); // Вид кода первого держателя-нерезидента
    end;

    macro firstHolderCountry() : String    // Код страны первого векселедержателя
        return nvl(m_dataSource.firstHolderCountryCode, "");
    end;

    macro state() : String                 // Состояние векселя
        return nvl(m_dataSource.state, "");
    end;

    macro holderName() : String            // Наименование векселедержателя
        return nvl(m_dataSource.holderName, "");
    end;

    macro holderInn() : String             // ИНН векселедержателя
        return nvl(m_dataSource.holderInn, "");
    end;

    macro holderInn_Mark() : String        // для ИНН векселедержателя - признак
        return nvl(m_dataSource.holderInn_Mark, "");
    end;

    macro holderInn_Tin() : String        // для ИНН векселедержателя - TIN
        return nvl(m_dataSource.holderInn_Tin, "");
    end;

    macro holderInn_CodeKind() : String
        return nvl(m_dataSource.HolderNotResCode, ""); // Вид кода держателя-нерезидента
    end;

    macro holderCountry() : String         // Код страны векселедержателя
        return nvl(m_dataSource.holderCountryCode, "");
    end;

    macro note() : String;                  // Примечание
        return nvl(m_dataSource.note, "");
    end;

    macro TermDate1() : String                              // Ф711_Графа_СрокДата1
        return nvl(m_dataSource.TermDate1, "");
    end;

    macro TermDate2() : String                              // Ф711_Графа_СрокДата2
        return nvl(m_dataSource.TermDate2, "");
    end;

    macro HolderState() : String                            // Статус векселедержателя
        return nvl(m_dataSource.HolderState, "");
    end;

    macro PercentRate() : Money                             // Ф711_Графа_Процент
        return nvl(m_dataSource.PercentRate, $0.0);
    end;

    macro SaleCost() : Money                                // Ф711_Графа_ПродажаСумма
        return nvl(m_dataSource.SaleCost, $0.0);
    end;

    macro BuyCost() : Money                                 // Ф711_Графа_БалансСтоимНКД
        return nvl(m_dataSource.BuyCost, $0.0);
    end;

    macro BalanceCost() : Money                             // Ф711_Графа_БалансСтоим
        return nvl(m_dataSource.BalanceCost, $0.0);
    end;

    macro QualityCateg() : Integer                          // Ф711_Графа_Качество
        return nvl(m_dataSource.QualityCateg, 0);
    end;

    macro ReserveSum() : Money                              // Ф711_Графа_Резерв
        return nvl(m_dataSource.ReserveSum, $0.0);
    end;

    macro SaleDate() : String                               // Ф711_Графа_ПродажаДата
        return nvl(m_dataSource.SaleDate, "");
    end;

    macro SaleGround() : String                             // Ф711_Графа_ПродажаОснование
        return nvl(m_dataSource.SaleGround, "");
    end;

    macro SaleAgentName() : String                          // Ф711_Графа_ПродажаКонтр
        return nvl(m_dataSource.SaleAgentName, "");
    end;

    macro SaleAgentINN() : String                           // Ф711_Графа_ПродажаКонтрИНН
        return nvl(m_dataSource.SaleAgentINN, "");
    end;

    macro SaleAgentINN_Mark() : String                      // SaleAgentINN_Mark
        return nvl(m_dataSource.SaleAgentINN_Mark, "");
    end;

    macro SaleAgentINN_TIN() : String                       // SaleAgentINN_TIN
        return nvl(m_dataSource.SaleAgentINN_TIN, "");
    end;

    macro SaleAgentINN_CodeKind() : String
        return nvl(m_dataSource.SaleAgentNotResCode, ""); // Вид кода контрагента-нерезидента
    end;

    macro SaleAgentCountryCode() : String                   // Ф711_Графа_ПродажаКонтрОКМС
        return nvl(m_dataSource.SaleAgentCountryCode, "");
    end;

    macro SaleAgentOGRN() : String                          // Ф711_Графа_ПродажаКонтрОГРН
        return nvl(m_dataSource.SaleAgentOGRN, "");
    end;

    macro OvervalueBill() : Money
        return nvl(m_dataSource.OvervalueBill, $0.0);
    end;

    macro AdjustCost() : Money
        return nvl(m_dataSource.AdjustCost, $0.0);
    end;

    macro AdjustReserv() : Money
        return nvl(m_dataSource.AdjustReserv, $0.0);
    end;

    macro identifiercode() : String
        return nvl(m_dataSource.identifiercode, "");
    end;

    macro avalacept() : String
        return nvl(m_dataSource.avalacept, "");
    end;

    macro next()

        var result = false;

        if (m_isFirstCall)
            m_isFirstCall = false;
            result = m_dataSource.getFirst();
        else
            result = m_dataSource.getNext();
        end;

        return result;

    end;

    private macro configureDataSource(billKind, instruction, dataSourceMode)

        var departmentList = TArray();

        var departmentListDataSource;

        RcbDepartmentList().saveToTable();

        departmentListDataSource = TRsbDataset("SELECT * FROM dbldept_tmp");

        while (departmentListDataSource.next())
            departmentList[departmentList.size] = departmentListDataSource.code;
        end;

        m_dataSource.setFilter(departmentList, RcbApplication().currentReport.context.period.beginDate,
                               RcbApplication().currentReport.context.period.endDate, billKind, instruction, dataSourceMode);

    end;

    private macro constructorTDataSourceBill(billKind, instruction, dataSourceMode)
        m_dataSource = C_711bill();
        m_isFirstCall = true;

        configureDataSource(billKind, instruction, dataSourceMode);
    end;

    constructorTDataSourceBill(billKind, instruction, dataSourceMode);
end;

/**
 *  ИД подраздела 2.1 (учтенные векселя) по 2055-У
 *  @since 6.00.020.29
 *  @author ABP
 */
class (TDataSource) TDataSourcePart21DiscountedBill_I2055()

    private macro constructorTDataSourcePart21DiscountedBill_I2055()

        initTDataSource();

        add("TDiscountedBill", TDataSourceBill(BILLKIND_ACCOUNTED, BILL711_MODE_2055));

    end;

    constructorTDataSourcePart21DiscountedBill_I2055();

end;

/**
 *  ИД подраздела 2.2 (собственные векселя) по 2055-У
 *  @since 6.00.020.29
 *  @author ABP
 */
class (TDataSource) TDataSourcePart22OwnBill_I2055()

    private macro constructorTDataSourcePart22OwnBill_I2055()

        initTDataSource();

        add("TOwnBill", TDataSourceBill(BILLKIND_OUR, BILL711_MODE_2055));

    end;

    constructorTDataSourcePart22OwnBill_I2055();

end;

/**
 *  ИД подраздела 2.3 (прочие векселя) по 2055-У
 *  @since 6.00.020.29
 *  @author ABP
 */
class (TDataSource) TDataSourcePart23OtherBill_I2055()

    private macro constructorTDataSourcePart23OtherBill_I2055()

        initTDataSource();

        add("TOtherBill", TDataSourceBill(BILLKIND_OTHER, BILL711_MODE_2055));

    end;

    constructorTDataSourcePart23OtherBill_I2055();

end;

/**
 *  ИД подраздела 2.1 (учтенные векселя) по 2332-У
 *  @since 6.00.020.29
 *  @author ABP
 */
class (TDataSource) TDataSourcePart21DiscountedBill_I2332()

    private macro constructorTDataSourcePart21DiscountedBill_I2332()

        initTDataSource();

        add("TDiscountedBill", TDataSourceBill(BILLKIND_ACCOUNTED, BILL711_MODE_2332));

    end;

    constructorTDataSourcePart21DiscountedBill_I2332();

end;

/**
 *  ИД подраздела 2.2 (собственные векселя) по 2332-У
 *  @since 6.00.020.29
 *  @author ABP
 */
class (TDataSource) TDataSourcePart22OwnBill_I2332()

    private macro constructorTDataSourcePart22OwnBill_I2332()

        initTDataSource();

        add("TOwnBill", TDataSourceBill(BILLKIND_OUR, BILL711_MODE_2332));

    end;

    constructorTDataSourcePart22OwnBill_I2332();

end;

/**
 *  ИД подраздела 2.3 (прочие векселя) по 2332-У
 *  @since 6.00.020.29
 *  @author ABP
 */
class (TDataSource) TDataSourcePart23OtherBill_I2332()

    private macro constructorTDataSourcePart23OtherBill_I2332()

        initTDataSource();

        add("TOtherBill", TDataSourceBill(BILLKIND_OTHER, BILL711_MODE_2332));

    end;

    constructorTDataSourcePart23OtherBill_I2332();

end;

/**
 *  ИД подраздела 2.2 (собственные векселя) по 2627-У
 *  @since 6.00.020.30
 *  @author SER
 */
class (TDataSource) TDataSourcePart22OwnBill_I2627()

    private macro constructorTDataSourcePart22OwnBill_I2627()

        initTDataSource();

        add("TOwnBill", TDataSourceBill(BILLKIND_OUR, BILL711_MODE_2332, BILL711_MODE_2627));

    end;

    constructorTDataSourcePart22OwnBill_I2627();

end;

/**
 *  ИД подраздела 2.1 (собственные векселя) по 2835-У
 *  @since 6.00.020.30
 *  @author KRR
 */
class (TDataSource) TDataSourcePart21DiscountedBill_I2835()

    private macro constructorTDataSourcePart21DiscountedBill_I2835()
        initTDataSource();

        add("TDiscountedBill", TDataSourceBill(BILLKIND_ACCOUNTED, BILL711_MODE_2835, BILL711_MODE_2835));

    end;

    constructorTDataSourcePart21DiscountedBill_I2835();

end;

/**
 *  ИД подраздела 2.1 (собственные векселя) по 3129-У
 *  @since 6.00.020.30
 *  @author KRR
 */
class (TDataSource) TDataSourcePart21DiscountedBill_I3129()

    private macro constructorTDataSourcePart21DiscountedBill_I3129()
        initTDataSource();

        add("TDiscountedBill", TDataSourceBill(BILLKIND_ACCOUNTED, BILL711_MODE_3129, BILL711_MODE_3129));
    end;

    constructorTDataSourcePart21DiscountedBill_I3129();
end;

class (TDataSource) TDataSourcePart21DiscountedBill_I4212()

    private macro constructorTDataSourcePart21DiscountedBill_I4212()
        initTDataSource();

        add("TDiscountedBill", TDataSourceBill(BILLKIND_ACCOUNTED, BILL711_MODE_4212, BILL711_MODE_4212));
    end;

    constructorTDataSourcePart21DiscountedBill_I4212();
end;

class (TDataSource) TDataSourcePart21DiscountedBill_I4927()

    private macro constructorTDataSourcePart21DiscountedBill_I4927()
        initTDataSource();

        add("TDiscountedBill", TDataSourceBill(BILLKIND_ACCOUNTED, BILL711_MODE_4927, BILL711_MODE_4927));
    end;

    constructorTDataSourcePart21DiscountedBill_I4927();
end;

/**
 *  ИД подраздела 2.2 (собственные векселя) по 2835-У
 *  @since 6.00.020.30
 *  @author KPA
 */
class (TDataSource) TDataSourcePart22OwnBill_I2835()

    private macro constructorTDataSourcePart22OwnBill_I2835()
        initTDataSource();

        add("TOwnBill", TDataSourceBill(BILLKIND_OUR, BILL711_MODE_2835, BILL711_MODE_2835));

    end;

    constructorTDataSourcePart22OwnBill_I2835();

end;

/**
 *  ИД подраздела 2.2 (собственные векселя) по 3129-У
 *  @since 6.00.020.31
 *  @author Kirin
 */
class (TDataSource) TDataSourcePart22OwnBill_I3129()

    private macro constructorTDataSourcePart22OwnBill_I3129()
        initTDataSource();

        add("TOwnBill", TDataSourceBill(BILLKIND_OUR, BILL711_MODE_3129, BILL711_MODE_3129));

    end;

    constructorTDataSourcePart22OwnBill_I3129();

end;

class (TDataSource) TDataSourcePart22OwnBill_I3269()

    private macro constructorTDataSourcePart22OwnBill_I3269()
        initTDataSource();

        add("TOwnBill", TDataSourceBill(BILLKIND_OUR, BILL711_MODE_3269, BILL711_MODE_3269));

    end;

    constructorTDataSourcePart22OwnBill_I3269();

end;

class (TDataSource) TDataSourcePart22OwnBill_I4212()

    private macro constructorTDataSourcePart22OwnBill_I4212()
        initTDataSource();

        add("TOwnBill", TDataSourceBill(BILLKIND_OUR, BILL711_MODE_4212, BILL711_MODE_4212));
    end;

    constructorTDataSourcePart22OwnBill_I4212();
end;

class (TDataSource) TDataSourcePart22OwnBill_I4637()

    private macro constructorTDataSourcePart22OwnBill_I4637()
        initTDataSource();

        add("TOwnBill", TDataSourceBill(BILLKIND_OUR, BILL711_MODE_4637, BILL711_MODE_4637));
    end;

    constructorTDataSourcePart22OwnBill_I4637();
end;

class (TDataSource) TDataSourcePart22OwnBill_I4927()

    private macro constructorTDataSourcePart22OwnBill_I4927()
        initTDataSource();

        add("TOwnBill", TDataSourceBill(BILLKIND_OUR, BILL711_MODE_4927, BILL711_MODE_4927));
    end;

    constructorTDataSourcePart22OwnBill_I4927();
end;

/**
 *  ИД подраздела 2.3 (собственные векселя) по 2835-У
 *  @since 6.00.020.30
 *  @author KRR
 */
class (TDataSource) TDataSourcePart23OtherBill_I2835()

    private macro constructorTDataSourcePart23OtherBill_I2835()
        initTDataSource();

        add("TOtherBill", TDataSourceBill(BILLKIND_OTHER, BILL711_MODE_2835, BILL711_MODE_2835));

    end;

    constructorTDataSourcePart23OtherBill_I2835();

end;

/**
 *  ИД подраздела 2.3 (собственные векселя) по 3129-У
 *  @since 6.00.020.30
 *  @author KRR
 */
class (TDataSource) TDataSourcePart23OtherBill_I3129()

    private macro constructorTDataSourcePart23OtherBill_I3129()
        initTDataSource();

        add("TOtherBill", TDataSourceBill(BILLKIND_OTHER, BILL711_MODE_3129, BILL711_MODE_3129));
    end;

    constructorTDataSourcePart23OtherBill_I3129();
end;

class (TDataSource) TDataSourcePart23OtherBill_I4212()

    private macro constructorTDataSourcePart23OtherBill_I4212()
        initTDataSource();

        add("TOtherBill", TDataSourceBill(BILLKIND_OTHER, BILL711_MODE_4212, BILL711_MODE_4212));
    end;

    constructorTDataSourcePart23OtherBill_I4212();
end;

class (TDataSource) TDataSourcePart23OtherBill_I4637()

    private macro constructorTDataSourcePart23OtherBill_I4637()
        initTDataSource();

        add("TOtherBill", TDataSourceBill(BILLKIND_OTHER, BILL711_MODE_4637, BILL711_MODE_4637));
    end;

    constructorTDataSourcePart23OtherBill_I4637();
end;

class (TDataSource) TDataSourcePart23OtherBill_I4927()

    private macro constructorTDataSourcePart23OtherBill_I4927()
        initTDataSource();

        add("TOtherBill", TDataSourceBill(BILLKIND_OTHER, BILL711_MODE_4927, BILL711_MODE_4927));
    end;

    constructorTDataSourcePart23OtherBill_I4927();
end;

/**
 *  Класс расчета раздела 2 (операции с векселями)
 *  @since 6.00.020.29
 *  @author ABP
 */
class TCalculatorSection2()

    private macro calculatePart(variableName, dataSource)

        var fieldIterator;
        var variable;

        while ((dataSource != null) and dataSource.next())

            variable = RcbApplication().currentReport.attributeValue(variableName).addValue(RCB_NEW_VALUE_ID);

            fieldIterator = RcbApplication().currentReport.form.attribute(variableName).structure.createFieldIterator();

            fieldIterator.first();
            while (not fieldIterator.isDone())
                variable.fieldValue(fieldIterator.currentItem.name).exact = dataSource.getValue(fieldIterator.currentItem.name);
                fieldIterator.next();
            end;

        end;

    end;

    private macro updateCounter(variableName, sorter)

        var counter;
        var iterator = RcbApplication().currentReport.attributeValue(variableName).createValueIterator();

        iterator.setSortOrder(sorter);

        counter = 1;
        iterator.first();
        while (not iterator.isDone())

            iterator.currentItem.fieldValue("counter").exact = counter;
            iterator.currentItem.fieldValue("counter").recalculateScaled();
            counter = counter + 1;

            iterator.next();

        end;
    end;

    macro calculate()

        if (rcbApplication().currentReport.context.period.endDate < RCB_I2055_DATE2)
            return;
        end;

        begAction(1000, "Расчет переменных раздела 2");

        calculatePart("Ф711_Раздел2_Подраздел1", objectFactoryInstance.createDataSourcePart21DiscountedBill());
        updateCounter("Ф711_Раздел2_Подраздел1", TSection2Part1ValuesSorter());

        calculatePart("Ф711_Раздел2_Подраздел2", objectFactoryInstance.createDataSourcePart22OwnBill());
        updateCounter("Ф711_Раздел2_Подраздел2", TSection2Part2ValuesSorter());

        calculatePart("Ф711_Раздел2_Подраздел3", objectFactoryInstance.createDataSourcePart23OtherBill());
        updateCounter("Ф711_Раздел2_Подраздел3", TSection2Part3ValuesSorter());

        RcbApplication().transactionManager.commit();

        endAction();

    end;

end;
