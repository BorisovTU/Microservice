/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank V6                                                                        R-Style Softlab
  ” ©« ¯®¤á¨áâ¥¬ë "¥£« ¬¥­â¨àã¥¬ ï ®âç¥â­®áâì"

   áç¥â ä®à¬ë 664 ¯® ¤ ­­ë¬ Retail.  §¤¥« 2-”.

  ‘®§¤ ­: 04.06.2007 - ABP
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
import calc_f664_b1747u;

/**
 *   à ¬¥âàë ®âç¥â 
 */
private class (TParameters) TParametersRtIssue2()
    
    initTParameters(ACCOUNT_KIND_UF, "", 2);

end;

/**
 *  ˆáâ®ç­¨ª¨ ¤ ­­ëå
 */
private class (TDataSourceRt) TDataSourceRtDepositOperationsStatisticIssue2(parameters : TParameters)
    initTDataSourceRt(parameters, rcbGetObject("RcbDepOperStat664"), TTurnsTempTable());

    setFilter(            RcbBranchFieldFilter().getAsSqlString("fnCash") 
              + " AND " + "dateCarry >= " + parameters.getBeginDate()
              + " AND " + "dateCarry <= " + parameters.getEndDate()
             );
end;

private class (TDataSourceRt) TDataSourceRtDepositIssue2(parameters : TParameters)
    initTDataSourceRt(parameters, rcbGetObject("RcbDeposit664"), TRestsTempTable());

    setFilter(            RcbBranchFieldFilter().getAsSqlString("fnCash") 
              + " AND " + "balanceNumber = $RsbMask('" + getMaskForAccountKind(parameters.getAccountKind()) + "')"
             );
end;

/**
 *  Š®­âà®««¥à à áç¥â 
 */
private class TCalculator(parameters : TParameters)

    private var m_parameters = parameters;

    macro calculate()

        var deposits = TDataSourceRtDepositIssue2(m_parameters);

        var depositOperationsStatistic = TDataSourceRtDepositOperationsStatisticIssue2(m_parameters);

        deposits.fillTempTable();

        depositOperationsStatistic.fillTempTable();

    end;

end;

/**
 *  á­®¢­ ï äã­ªæ¨ï
 */
private macro main()

    var bo_retail = TBackOffice(BORetail);
    
    var tunetable = TTuneTable("dt664_dbt", "t_backOffice");
    
    var parameters = TParametersRtIssue2();
    
    if (tuneTable.hasDataFor(bo_retail))

        BegAction(2000, " áç¥â ¯¥à¥¬¥­­ëå à §¤¥«  2 (”) ¯® ¤ ­­ë¬ RS-Retail");

        TCalculator(parameters).calculate();

        EndAction(1);

    end;

end;

/**
 *  ’®çª  ¢å®¤ 
 */
main();
// 13.02.2007 ABP ®ª  ­¨¦¥á«¥¤ãé¨¥ áâà®ª¨ § ª®¬¬¥­â¨à®¢ ­ë. € ¢®®¡é¥ ®â ¯à ªâ¨ª¨ ¨á¯®«ì§®¢ ­¨ï exit(1) ­ã¦­® ®âª §ë¢ âìáï
//“áâ ­®¢¨âì”« £‚®§¢à â (OK_MACRO_FLAG);
//exit(1);

//OnError(error)
//    exceptionMessage(error);
//    exit(1);
