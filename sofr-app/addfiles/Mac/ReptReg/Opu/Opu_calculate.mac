/*
$Name:        Opu_calculate.mac
$Module:      Регламентируемая отчетность
$Description: Макрос запуска расчета ОФР и "Приложение 4 со СПОД"
*/
/*
*/

import Opu_import;

private var m_protocolView;

if (rcbApplication.currentReport.context.period.endDate > date(31,12,2015))
    m_protocolView = objectFactoryInstance().createCalculateProtocolView(rcbApplication.currentReport.form.name);
    m_protocolView.setProtocolOutput();
    m_protocolView.printHead();
    m_protocolView.printLine("Отчет \"" + rcbApplication.currentReport.form.name + "\" можно рассчитать только за отчетный период, у которого дата окончания меньше или равна 31.12.2015 года");
    m_protocolView.resetProtocolOutput();
    m_protocolView.show();
    установитьФлагВозврата(STOP_PROC_FLG);
else
if ((rcbApplication.currentReport.form.name == "Приложение 4 со СПОД") and (ВидПериода != RCB_PK_YEAR))
    m_protocolView = objectFactoryInstance().createCalculateProtocolView(rcbApplication.currentReport.form.name);
    m_protocolView.setProtocolOutput();
    m_protocolView.printHead();
    m_protocolView.printLine("Отчет \"Приложение 4 со СПОД\" можно рассчитать только за период = год.");
    m_protocolView.resetProtocolOutput();
    m_protocolView.show();
    установитьФлагВозврата(STOP_PROC_FLG);
else
    objectFactoryInstance().createCalculationOperation().execute();

    if ((rcbApplication.currentReport.form.name == "Приложение 4 со СПОД"))
        objectFactoryInstance().createFinalCalculate().execute();
    end;

    установитьФлагВозврата(OK_MACRO_FLAG);
end;
end;

exit(1);
