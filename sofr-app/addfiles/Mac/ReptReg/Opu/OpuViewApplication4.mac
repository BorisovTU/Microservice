/*
$Name:        OpuViewApplication4.mac
$Module:      Регламентируемая отчетность
$Description: классы для печати отчетной формы Приложение 4
*/
/*
*/

class (TView) TViewApplication4Spod()
    initTView();
    private var m_spodSymbols  = m_report.attributeValue("СимволыСПОД");
    private var m_spodKeyValue = m_spodSymbols.attribute.structure.key.createKeyValue();

    private macro getPrintableValue(value : RcbValue) : String
        return ternary(value.exactAsString == "Undefined", "", value.exactAsString);
    end;

    private macro getSpodSymbolValue(symbolCode)
        m_spodKeyValue.fieldValue("code") = symbolCode;
        return m_spodSymbols.findValue(m_spodKeyValue);
    end;

    macro printForm(templateName, symbolMask, repForm)
        var fieldId = 0;
        var currentField;
        var spodSymbolValue;
        var spodRepForm  = TRepForm(templateName, false, "spod");

        if (symbolMask)
            spodSymbolValue = getSpodSymbolValue(symbolMask);
            currentField    = spodRepForm.field(fieldId);
            if (spodSymbolValue)
                while (hasTemplateField(spodRepForm, fieldId))
                    currentField = spodRepForm.field(fieldId);
                    if (strBrk(currentField.name, "R") != 0)
                        currentField.value = getPrintableValue(spodSymbolValue.fieldValue("roubleValue"));
                    elif (strBrk(currentField.name, "C") != 0)
                        if (repForm.index(symbolMask + "C") == -1)
                        currentField.value = string("X":18:c);
                        else
                        currentField.value = getPrintableValue(spodSymbolValue.fieldValue("currencyValue"));
                        end;
                    elif (strBrk(currentField.name, "T") != 0)
                        currentField.value = getPrintableValue(spodSymbolValue.fieldValue("totalValue"));
                    end;
                    fieldId = fieldId + 1;
                end;
                spodRepForm.write;
            end;
        end;
    end;
end;


class (TView) TViewApplication4(spodView)
    initTView("ОТЧЕТ о прибылях и убытках", null, null, DATE_IN_PERIOD_FORMAT);
    private var m_spodView = spodView;

    macro setSpodView(spodView)
        m_spodView = spodView;
    end;

    private macro getPrintableValue(value : RcbValue) : String
        return ternary(value.exactAsString == "Undefined", "", value.exactAsString);
    end;

    macro printDescription()
        var repForm = TRepForm(templateName, false, "Description");

        repForm.field("Period").value     = getNamesZone().getPeriodName();
        repForm.field("BankName").value   = getNamesZone().getLendingAgencyName();
        repForm.field("BankAdress").value = getNamesZone().getLendingAgencyPostalAdress();
        repForm.field("Bic").value        = getLendingAgencyCodeZone().getBic();
        repForm.field("Okpo").value       = getLendingAgencyCodeZone().getOkpo();

        repForm.write;
    end;

    macro printSignatureZone()
        println();
        println(" ", {Name_Boss}, "  ", {FIO_Boss});
        println(" ", {Name_Book}, "  ", {FIO_Book});
        println();
        println(" ", {curdate}:f:m);
    end;

    private macro printForm(repForm)
        var name;
        var symbolMask;

        printForm(repForm);
        if (m_spodView and hasTemplateField(repForm, 0))
            name = repForm.field(0).name;
            symbolMask = substr(name, 1, strlen(name) - 1);
            m_spodView.printForm(templateName, symbolMask, repForm);
        end;
    end;
end;

class (TViewApplication4) TViewApplication42090(spodView)
    initTViewApplication4(spodView);
    templateName = "OPU_resources2090.tpl";
    symbolTplView = "drcbopusymboltpl2090_vw";
end;

class (TViewApplication42090) TViewApplication42332(spodView)
    initTViewApplication42090(spodView);
    templateName = "OPU_resources2332.tpl";
end;

class (TViewApplication4) TViewApplication42477(spodView)
    initTViewApplication4(spodView);
    templateName  = "OPU_resources2477.tpl";
    symbolTplView = "drcbopusymboltpl2477_vw";
end;

class (TViewApplication4) TViewApplication42514(spodView)
    initTViewApplication4(spodView);
    templateName  = "OPU_resources2514.tpl";
    symbolTplView = "drcbopusymboltpl2514_vw";
end;

class (TViewApplication4) TViewApplication42679(spodView)
    initTViewApplication4(spodView);
    templateName  = "OPU_resources2679.tpl";
    symbolTplView = "drcbopusymboltpl2514_vw";
end;

class (TViewApplication4) TViewApplication42654(spodView)
    initTViewApplication4(spodView);
    templateName  = "OPU_resources2654.tpl";
    symbolTplView = "drcbopusymboltpl2514_vw";
end;

class (TViewApplication4) TViewApplication42736(spodView)
    initTViewApplication4(spodView);
    templateName  = "OPU_resources2736.tpl";
    symbolTplView = "drcbopusymboltpl2514_vw";
end;

class (TViewApplication4) TViewApplication42800(spodView)
    initTViewApplication4(spodView);
    templateName  = "OPU_resources2800.tpl";
    symbolTplView = "drcbopusymboltpl2514_vw";
end;

class (TViewApplication4) TViewApplication4385(spodView)
    initTViewApplication4(spodView);
    templateName  = "OPU_resources385.tpl";
    symbolTplView = "drcbopusymboltpl2514_vw";
end;

class (TViewApplication4) TViewApplication43053(spodView)
    initTViewApplication4(spodView);
    templateName  = "OPU_resources3053.tpl";
    symbolTplView = "drcbopusymboltpl3053_vw";
end;

class (TViewApplication4) TViewApplication43468(spodView)
    initTViewApplication4(spodView);
    templateName  = "OPU_resources3468.tpl";
    symbolTplView = "drcbopusymboltpl3053_vw";
end;
