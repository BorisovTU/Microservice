/*
$Name:          ex_kl251.mac
$Module:        Регламентируемая отчетность
$Description:   экспорт значений переменных формы 251 в текстовый файл для программы kliko.exe
*/


/* ──────────────────────────────────────────────────────────────────────────┐
    RS-Bank 6.0                                      R-Style Software Lab Ltd
    Файл подсистемы "Регламентируемая отчетность"

    Назначение: экспорт значений переменных формы 251 в текстовый файл
    для программы kliko.exe

    CREATED : 16.11.2006 Лузгин

    MODIFICATIONS:
    NOTES:

└────────────────────────────────────────────────────────────────────────── */

IMPORT lib_exp, com_f251;

import rcbImport;

class (RcbKlikoExportController) TF251KlikoExportController()

    private macro getDescriptorInfo()
        return "";
    end;

    // Напечатать строку со значениями переменных
    private macro PrintRowString( _row );
         m_view.printRow(Lines[_row], GetVarValue(_row,3), GetVarValue(_row,4), GetVarValue(_row,5), GetVarValue(_row,6) );
    end;

    // Напечатать строку без значений переменных
    private macro PrintEmptyString( _text );
           m_view.printRow(_text, "", "", "", "" );   
    end;

    /* ================== Процедура экспорта ================================== */

    macro ExportData()
        var i = 0;

        if( isEmptyReport() )
            PrintEmptyString( "Данные по форме отсутствуют" );
        else
            message( "Заполнение файла экспорта..." );
            PrintEmptyString( "1" );
            while( i < 4 )
                PrintRowString( i );
                i = i + 1;
            end;
            i = 31;
            while( i < 34 )
                PrintRowString( i );
                i = i + 1;
            end;
            PrintRowString( 36 );
            PrintRowString( 35 );
            PrintRowString( 37 );
            PrintRowString( 4 );
            PrintEmptyString( "2.1" );
            PrintRowString( 5 );
            PrintRowString( 38 );
            i = 6;
            while( i < 11 )
                PrintRowString( i );
                i = i + 1;
            end;
            PrintEmptyString( "2.2" );
            PrintRowString( 11 );
            PrintRowString( 39 );
            PrintRowString( 12 );
            PrintRowString( 40 );
            i = 13;
            while( i < 17 )
                PrintRowString( i );
                i = i + 1;
            end;
            PrintEmptyString( "2.3" );
            i = 17;
            while( i < 22 )
                PrintRowString( i );
                i = i + 1;
            end;
            PrintRowString( 34 );
            PrintRowString( 22 );
            PrintEmptyString( "3" );
            i = 23;
            while( i < 31 )
                PrintRowString( i );
                i = i + 1;
            end;
        end;

    end;


    private macro constructorTF251KlikoExportController()
        initRcbKlikoExportController("251", RcbReportBase(null, true));
    end;

    macro printDataZone()
        m_view.printHead("F251");
        ExportData();
    end;
    
    constructorTF251KlikoExportController();
end;

class (TF251KlikoExportController) TF251KlikoExportController_2332()

    initTF251KlikoExportController();

    // Напечатать строку со значениями переменных
    private macro PrintRowString( _row );
        m_view.printRow(Lines_2332[_row], GetVarValue_2332(_row,3), GetVarValue_2332(_row,4), GetVarValue_2332(_row,5), GetVarValue_2332(_row,6) );
    end;

    MACRO ExportData()

    var i = 0;

        if( isEmptyReport() )
            PrintEmptyString( "Данные по форме отсутствуют" );
        else
            message( "Заполнение файла экспорта..." );
            PrintEmptyString( "1" );
            while( i < 4 )
                PrintRowString( i );
                i = i + 1;
            end;
            i = 34;
            while( i < 37 )
                PrintRowString( i );
                i = i + 1;
            end;
            PrintRowString( 39 );
            PrintRowString( 38 );
            PrintRowString( 40 );
            PrintRowString( 4 );
            PrintEmptyString( "2.1" );
            PrintRowString( 5 );
            PrintRowString( 41 );
            i = 6;
            while( i < 11 )
                PrintRowString( i );
                i = i + 1;
            end;
            PrintEmptyString( "2.2" );
            PrintRowString( 11 );
            PrintRowString( 42 );
            PrintRowString( 12 );
            PrintRowString( 43 );
            i = 13;
            while( i < 17 )
                PrintRowString( i );
                i = i + 1;
            end;
            PrintEmptyString( "2.3" );
            i = 17;
            while( i < 22 )
                PrintRowString( i );
                i = i + 1;
            end;
            PrintRowString( 37 );
            PrintRowString( 44 );
            PrintRowString( 45 );
            PrintRowString( 46 );
            PrintRowString( 47 );
            PrintRowString( 48 );
            PrintRowString( 49 );
            PrintRowString( 50 );
            PrintRowString( 51 );

            PrintRowString( 22 );
            PrintEmptyString( "3" );
            i = 23;
            while( i < 31 )
                PrintRowString( i );
                i = i + 1;
            end;

            PrintEmptyString( "4" );
            PrintRowString( 31 );
            PrintRowString( 32 );
            PrintRowString( 33 );

        end;

    END;

end;


class (TF251KlikoExportController) TF251KlikoExportController_2470()

    initTF251KlikoExportController();

    private macro GetVarValue_2470( _row, _column )  // _row - индекс строки в массиве Lines
        var value1, value2 = $0;
        var varName = "Ф251__" + strSubst(_row, ".", "_") + "__" + _column;
        if( not ПрочитатьПеременную2(value1, value2, ДатаОтчета, ПредДатаОтчета, {Название отчета}, varName))
            return "";
        end;
        if( _column < 5 )
            return value1;
        else
            return value2;
        end;
    end;

    /* Напечатать строку со значениями переменных*/
    private macro PrintRowString( _row );
        m_view.printRow(_row, GetVarValue_2470(_row,3), GetVarValue_2470(_row,4), GetVarValue_2470(_row,5), GetVarValue_2470(_row,6));
    end;

    MACRO ExportData()

        var i = 0;

        if( isEmptyReport() )
            PrintEmptyString( "Данные по форме отсутствуют" );
        else
            message( "Заполнение файла экспорта..." );

            PrintEmptyString("1");
            PrintRowString("1.1");
            PrintRowString("1.1.1");
            PrintRowString("1.1.1.1");
            PrintRowString("1.1.1.1.1");
            PrintRowString("1.2");
            PrintRowString("1.2.1");
            PrintRowString("1.2.2");
            PrintRowString("1.2.2.1");
            PrintRowString("1.2.2.1.1");
            PrintRowString("1.2.2.1.2");
            PrintRowString("1.3");

            PrintEmptyString("2.1");
            PrintRowString("2.1.1");
            PrintRowString("2.1.1.1");
            PrintRowString("2.1.1.1.1");
            PrintRowString("2.1.2");
            PrintRowString("2.1.3");
            PrintRowString("2.1.4");
            PrintRowString("2.1.5");
            PrintEmptyString("2.2");
            PrintRowString("2.2.1");
            PrintRowString("2.2.1.1");
            PrintRowString("2.2.1.1.1");
            PrintRowString("2.2.1.1.2");
            PrintRowString("2.2.2");
            PrintRowString("2.2.3");
            PrintRowString("2.2.4");
            PrintRowString("2.2.5");
            PrintEmptyString("2.3");
            PrintRowString("2.3.1");
            PrintRowString("2.3.2");
            PrintRowString("2.3.3");
            PrintRowString("2.3.4");
            PrintRowString("2.3.5");
            PrintRowString("2.4");
            PrintRowString("2.4.1");
            PrintRowString("2.4.1.1");
            PrintRowString("2.4.1.2");
            PrintRowString("2.4.1.2.1");
            PrintRowString("2.4.2");
            PrintRowString("2.4.2.1");
            PrintRowString("2.4.2.2");
            PrintRowString("2.4.2.2.1");
            PrintRowString("2.5");
            PrintRowString("2.5.1");

            PrintEmptyString("3");
            PrintRowString("3.1");
            PrintRowString("3.1.1");
            PrintRowString("3.2");
            PrintRowString("3.2.1");
            PrintRowString("3.3");
            PrintRowString("3.3.1");
            PrintRowString("3.4");
            PrintRowString("3.4.1");

            PrintEmptyString("4");
            PrintRowString("4.1");
            PrintRowString("4.1.1");
            PrintRowString("4.1.2");
        end;

    END;

end;

class (TF251KlikoExportController_2470) TF251KlikoExportController_2539()

    initTF251KlikoExportController_2470();

    macro ExportData()

        var i = 0;

        if( isEmptyReport() )
            PrintEmptyString( "Данные по форме отсутствуют" );
        else
            message( "Заполнение файла экспорта..." );

            PrintEmptyString("1");
            PrintRowString("1.1");
            PrintRowString("1.1.1");
            PrintRowString("1.1.1.1");
            PrintRowString("1.1.1.1.1");
            PrintRowString("1.2");
            PrintRowString("1.2.1");
            PrintRowString("1.2.2");
            PrintRowString("1.2.2.1");
            PrintRowString("1.2.2.1.1");
            PrintRowString("1.2.2.1.2");
            PrintRowString("1.3");

            PrintEmptyString("2.1");
            PrintRowString("2.1.1");
            PrintRowString("2.1.1.1");
            PrintRowString("2.1.1.1.1");
            PrintRowString("2.1.2");
            PrintRowString("2.1.3");
            PrintRowString("2.1.4");
            PrintRowString("2.1.5");
            PrintRowString("2.1.6");
            PrintRowString("2.1.6.1");
            PrintEmptyString("2.2");
            PrintRowString("2.2.1");
            PrintRowString("2.2.1.1");
            PrintRowString("2.2.1.1.1");
            PrintRowString("2.2.1.1.2");
            PrintRowString("2.2.2");
            PrintRowString("2.2.3");
            PrintRowString("2.2.4");
            PrintRowString("2.2.5");
            PrintRowString("2.2.6");
            PrintRowString("2.2.6.1");
            PrintEmptyString("2.3");
            PrintRowString("2.3.1");
            PrintRowString("2.3.2");
            PrintRowString("2.3.3");
            PrintRowString("2.3.4");
            PrintRowString("2.3.5");
            PrintRowString("2.3.6");
            PrintRowString("2.3.6.1");
            PrintRowString("2.4");
            PrintRowString("2.4.1");
            PrintRowString("2.4.1.1");
            PrintRowString("2.4.1.2");
            PrintRowString("2.4.1.2.1");
            PrintRowString("2.4.2");
            PrintRowString("2.4.2.1");
            PrintRowString("2.4.2.2");
            PrintRowString("2.4.2.2.1");

            PrintEmptyString("3");
            PrintRowString("3.1");
            PrintRowString("3.1.1");
            PrintRowString("3.2");
            PrintRowString("3.2.1");
            PrintRowString("3.3");
            PrintRowString("3.3.1");
            PrintRowString("3.4");
            PrintRowString("3.4.1");

            PrintEmptyString("4");
            PrintRowString("4.1");
            PrintRowString("4.1.1");
            PrintRowString("4.1.2");
            PrintRowString("4.1.3");
        end;

    end;
end;

class (TF251KlikoExportController_2539) TF251KlikoExportController_2742()

    initTF251KlikoExportController_2539();

    macro ExportData()

        var i = 0;

        if( isEmptyReport() )
            PrintEmptyString( "Данные по форме отсутствуют" );
        else
            message( "Заполнение файла экспорта..." );

            PrintEmptyString("1");
            PrintRowString("1.1");
            PrintRowString("1.1.1");
            PrintRowString("1.1.1.1");
            PrintRowString("1.1.1.1.1");
            PrintRowString("1.2");
            PrintRowString("1.2.1");
            PrintRowString("1.2.2");
            PrintRowString("1.2.2.1");
            PrintRowString("1.2.2.1.1");
            PrintRowString("1.2.2.1.2");
            PrintRowString("1.3");

            PrintEmptyString("2.1");
            PrintRowString("2.1.1");
            PrintRowString("2.1.1.1");
            PrintRowString("2.1.1.1.1");
            PrintRowString("2.1.2");
            PrintRowString("2.1.3");
            PrintRowString("2.1.4");
            PrintRowString("2.1.5");
            PrintRowString("2.1.6");
            PrintRowString("2.1.6.1");
            PrintEmptyString("2.2");
            PrintRowString("2.2.1");
            PrintRowString("2.2.1.1");
            PrintRowString("2.2.1.1.1");
            PrintRowString("2.2.1.1.2");
            PrintRowString("2.2.2");
            PrintRowString("2.2.3");
            PrintRowString("2.2.4");
            PrintRowString("2.2.5");
            PrintRowString("2.2.6");
            PrintRowString("2.2.6.1");
            PrintEmptyString("2.3");
            PrintRowString("2.3.1");
            PrintRowString("2.3.2");
            PrintRowString("2.3.3");
            PrintRowString("2.3.4");
            PrintRowString("2.3.5");
            PrintRowString("2.3.6");
            PrintRowString("2.3.6.1");
            PrintRowString("2.4");
            PrintRowString("2.4.1");
            PrintRowString("2.4.1.1");
            PrintRowString("2.4.1.2");
            PrintRowString("2.4.1.2.1");
            PrintRowString("2.4.2");
            PrintRowString("2.4.2.1");
            PrintRowString("2.4.2.2");
            PrintRowString("2.4.2.2.1");

            PrintEmptyString("3");
            PrintRowString("3.1");
            PrintRowString("3.1.1");
            PrintRowString("3.2");
            PrintRowString("3.2.1");
            PrintRowString("3.3");
            PrintRowString("3.3.1");
            PrintRowString("3.4");
            PrintRowString("3.4.1");

            PrintEmptyString("4");
            PrintRowString("4.1");
            PrintRowString("4.1.1");
            PrintRowString("4.1.2");
            PrintRowString("4.1.3");
        end;

    end;
end;


class (TF251KlikoExportController_2742) TF251KlikoExportController_2926()

    initTF251KlikoExportController_2742();

    private macro getDescriptorInfo()
        return "f251_06.pak от 30.03.2011";
    end;

    macro ExportData()

        var i = 0;

        if( isEmptyReport() )
            PrintEmptyString( "Данные по форме отсутствуют" );
        else
            message( "Заполнение файла экспорта..." );

            PrintEmptyString("1");
            PrintRowString("1.1");
            PrintRowString("1.1.1");
            PrintRowString("1.1.1.1");
            PrintRowString("1.1.1.1.1");
            PrintRowString("1.1.2");
            PrintRowString("1.1.3");
            PrintRowString("1.2");
            PrintRowString("1.2.1");
            PrintRowString("1.2.2");
            PrintRowString("1.2.2.1");
            PrintRowString("1.2.2.1.1");
            PrintRowString("1.2.2.1.2");
            PrintRowString("1.3");

            PrintEmptyString("2.1");
            PrintRowString("2.1.1");
            PrintRowString("2.1.1.1");
            PrintRowString("2.1.1.1.1");
            PrintRowString("2.1.2");
            PrintRowString("2.1.2.1");
            PrintRowString("2.1.3");
            PrintRowString("2.1.3.1");
            PrintRowString("2.1.3.1.1");
            PrintRowString("2.1.4");
            PrintRowString("2.1.4.1");
            PrintRowString("2.1.5");
            PrintRowString("2.1.6");
            PrintRowString("2.1.6.1");
            PrintRowString("2.1.6.2");
            PrintRowString("2.1.6.2.1");
            PrintEmptyString("2.2");
            PrintRowString("2.2.1");
            PrintRowString("2.2.1.1");
            PrintRowString("2.2.1.1.1");
            PrintRowString("2.2.1.1.2");
            PrintRowString("2.2.2");
            PrintRowString("2.2.2.1");
            PrintRowString("2.2.3");
            PrintRowString("2.2.3.1");
            PrintRowString("2.2.3.1.1");
            PrintRowString("2.2.4");
            PrintRowString("2.2.4.1");
            PrintRowString("2.2.5");
            PrintRowString("2.2.6");
            PrintRowString("2.2.6.1");
            PrintRowString("2.2.6.2");
            PrintRowString("2.2.6.2.1");
            PrintEmptyString("2.3");
            PrintRowString("2.3.1");
            PrintRowString("2.3.1.1");
            PrintRowString("2.3.1.1.1");
            PrintRowString("2.3.2");
            PrintRowString("2.3.2.1");
            PrintRowString("2.3.3");
            PrintRowString("2.3.3.1");
            PrintRowString("2.3.3.1.1");
            PrintRowString("2.3.4");
            PrintRowString("2.3.4.1");
            PrintRowString("2.3.5");
            PrintRowString("2.3.6");
            PrintRowString("2.3.6.1");
            PrintRowString("2.3.6.2");
            PrintRowString("2.3.6.2.1");
            PrintRowString("2.4");
            PrintRowString("2.4.1");
            PrintRowString("2.4.1.1");
            PrintRowString("2.4.1.1.1");
            PrintRowString("2.4.1.1.2");
            PrintRowString("2.4.1.1.2.1");
            PrintRowString("2.4.1.2");
            PrintRowString("2.4.1.2.1");
            PrintRowString("2.4.1.2.2");
            PrintRowString("2.4.2");
            PrintRowString("2.4.2.1");
            PrintRowString("2.4.2.1.1");
            PrintRowString("2.4.2.1.2");
            PrintRowString("2.4.2.1.2.1");
            PrintRowString("2.4.2.2");
            PrintRowString("2.4.2.2.1");
            PrintRowString("2.4.2.2.2");

            PrintEmptyString("3");
            PrintRowString("3.1");
            PrintRowString("3.1.1");
            PrintRowString("3.2");
            PrintRowString("3.2.1");
            PrintRowString("3.3");
            PrintRowString("3.3.1");
            PrintRowString("3.4");
            PrintRowString("3.4.1");

            PrintEmptyString("4");
            PrintRowString("4.1");
            PrintRowString("4.1.1");
        end;

    end;
end;

class (TF251KlikoExportController_2926) TF251KlikoExportController_3269()

    initTF251KlikoExportController_2926();

    private macro getDescriptorInfo()
        return "F251_08.PAK от 27.06.2012";
    end;

    macro ExportData()
        
        var i = 0;

        if( isEmptyReport() )
            PrintEmptyString( "Данные по форме отсутствуют" );
        else
            message( "Заполнение файла экспорта..." );

            PrintEmptyString("1");
            PrintRowString("1.1");
            PrintRowString("1.1.1");
            PrintRowString("1.1.1.1");
            PrintRowString("1.1.1.1.1");
            PrintRowString("1.1.2");
            PrintRowString("1.1.3");
            PrintRowString("1.2");
            PrintRowString("1.2.1");
            PrintRowString("1.2.2");
            PrintRowString("1.2.2.1");
            PrintRowString("1.2.2.1.1");
            PrintRowString("1.2.2.1.2");
            PrintRowString("1.3");

            PrintEmptyString("2.1");
            PrintRowString("2.1.1");
            PrintRowString("2.1.1.1");
            PrintRowString("2.1.1.1.1");
            PrintRowString("2.1.2");
            PrintRowString("2.1.2.1");
            PrintRowString("2.1.3");
            PrintRowString("2.1.3.1");
            PrintRowString("2.1.3.1.1");
            PrintRowString("2.1.4");
            PrintRowString("2.1.4.1");
            PrintRowString("2.1.5");
            PrintRowString("2.1.6");
            PrintRowString("2.1.6.1");
            PrintEmptyString("2.2");
            PrintRowString("2.2.1");
            PrintRowString("2.2.1.1");
            PrintRowString("2.2.1.1.1");
            PrintRowString("2.2.1.1.2");
            PrintRowString("2.2.2");
            PrintRowString("2.2.2.1");
            PrintRowString("2.2.3");
            PrintRowString("2.2.3.1");
            PrintRowString("2.2.3.1.1");
            PrintRowString("2.2.4");
            PrintRowString("2.2.4.1");
            PrintRowString("2.2.5");
            PrintRowString("2.2.6");
            PrintRowString("2.2.6.1");
            PrintEmptyString("2.3");
            PrintRowString("2.3.1");
            PrintRowString("2.3.1.1");
            PrintRowString("2.3.1.1.1");
            PrintRowString("2.3.2");
            PrintRowString("2.3.2.1");
            PrintRowString("2.3.3");
            PrintRowString("2.3.3.1");
            PrintRowString("2.3.3.1.1");
            PrintRowString("2.3.4");
            PrintRowString("2.3.4.1");
            PrintRowString("2.3.5");
            PrintRowString("2.3.6");
            PrintRowString("2.3.6.1");
            PrintRowString("2.4");
            PrintRowString("2.4.1");
            PrintRowString("2.4.1.1");
            PrintRowString("2.4.1.1.1");
            PrintRowString("2.4.1.1.2");
            PrintRowString("2.4.1.1.2.1");
            PrintRowString("2.4.1.2");
            PrintRowString("2.4.1.2.1");
            PrintRowString("2.4.1.2.2");
            PrintRowString("2.4.2");
            PrintRowString("2.4.2.1");
            PrintRowString("2.4.2.1.1");
            PrintRowString("2.4.2.1.2");
            PrintRowString("2.4.2.1.2.1");
            PrintRowString("2.4.2.2");
            PrintRowString("2.4.2.2.1");
            PrintRowString("2.4.2.2.2");

            PrintEmptyString("3");
            PrintRowString("3.1");
            PrintRowString("3.1.1");
            PrintRowString("3.2");
            PrintRowString("3.2.1");
            PrintRowString("3.3");
            PrintRowString("3.3.1");
            PrintRowString("3.4");
            PrintRowString("3.4.1");

            PrintEmptyString("4");
            PrintRowString("4.1");
            PrintRowString("4.1.1");
        end;

    end;
end;


private class TExportController()
    private var m_exportController : Object;

    macro export()
        var m_protocolView  = TProtocolView("ПРОТОКОЛ ЭКСПОРТА В Kliko.exe");

        if (not rcbApplication().currentReport.isCalculated);
            m_protocolView.checkCalculateReport("kliko.exe");
            установитьФлагВозврата(STOP_PROC_FLG);
            exit(1);
        end;

        m_exportController.execute(1);
    end;

    private macro constructorTExportController()
        if (rcbApplication().currentReport.context.period.endDate >= RCB_I3269_DATE)
            m_exportController = TF251KlikoExportController_3269();
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2926_DATE)
            m_exportController = TF251KlikoExportController_2926();
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2742_DATE)
            m_exportController = TF251KlikoExportController_2742();
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2539_DATE)
            m_exportController = TF251KlikoExportController_2539();
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2470_DATE1)
            m_exportController = TF251KlikoExportController_2470();
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2332_DATE)
            m_exportController = TF251KlikoExportController_2332();
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2055_DATE)
            m_exportController = TF251KlikoExportController();
        end;
    end;

    constructorTExportController();
end;

macro showKlikoExportProtocol(commandLineArguments : String)
    TExportController().showProtocol();
end;

macro exportToKliko()
    var controller = TExportController();
    controller.export();
end;

УстановитьФлагВозврата(OK_MACRO_FLAG);
    exit(1);
