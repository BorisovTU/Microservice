/*
$Name:          f601interface.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 601. Доступ к операциям формы.
*/

/* ──────────────────────────────────────────────────────────────────────────┐
   RS-Bank V6                                                 R-Style Softlab
   Файл подсистемы "Регламентированная отчетность"

   Форма 601. Доступ к операциям формы.

   CREATED : 13.12.07 Ser.
└────────────────────────────────────────────────────────────────────────── */
/**
 *  Общебанковские интеры и модули
 */
import testLib;
import ReptCBInter;
import RcbCoreInter;
import rcbconst;
import RcbLibrary;
/**
 *  Интеры и модели подсистемы
 */
import f601ObjectFactory;
import f601CalculationOperation;
import f601PrintOperation;
import f601SourceDataControlOperation;
import f601InterFormControlOperation;
import f601KlikoExportoperation;
import RcbDepartmentOkatoControlOperation;
import f601PtkPsdExportController;

import F601NormalizationController;
import F601NormalizationProtocolView;
import F601Normalizer;

/**
 *  Запуск операции расчета отчета
 */
macro executeCalculationOperation()
  /*var profiler = TSqlProfiler(getTxtFileName("!F601CalculateProfile"));
    profiler.clear();
    profiler.on();*/
    objectFactoryInstance.createCalculationOperation().execute();
end;

/**
 *  Запуск операции печати отчета
 */
macro executePrintOperation()
    objectFactoryInstance.createPrintOperation().execute(objectFactoryInstance.createView601());
end;

/**
 *  Запуск операции печати отчета в формате Excel
 */
macro executePrintOperationExcel()
    objectFactoryInstance.createPrintOperation().execute(objectFactoryInstance.createView601Excel());
end;

/**
 *  Запуск операции контроля исходных данных
 */
macro executeSourceDataControlOperation()
    objectFactoryInstance.createSourceDataControlOperation().execute();
end;

/**
 *  Запуск операции нормализации
 */
macro executeNormalizationOperation()                  
    objectFactoryInstance.createNormalizationController().execute();    
end;

/**
 *  Запуск операции межформенного контроля
 */
macro executeInterFormControlOperation()
    objectFactoryInstance.createInterFormControlOperation().execute();
end;

/**
 *  Запуск операции межформенного контроля
 */
macro executeDepartmentOkatoControlOperation()
    objectFactoryInstance.createDepartmentOkatoControlOperation().execute();
end;

/**
 *  Запуск операции экспорта в kliko.exe
 */
macro executeKlikoExportOperation()

    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В Kliko.exe").checkCalculateReport("kliko.exe");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;
    
    objectFactoryInstance.createKlikoExportOperation().execute();
end;

/**
 *  Запуск операции экспорта в АС ПСД.
 */
macro executePtkPsdExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В АС ПСД").checkCalculateReport("АС ПСД");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    if (rcbApplication().currentReport.context.period.endDate < RCB_I2742_DATE)
         RepErrorsQueue().add(0, "Экспорт отчета в АС ПСД возможен только за период, дата окончания которого больше или равна\n " + RCB_I2742_DATE);
         msgbox("Экспорт отчета в АС ПСД возможен только за период, дата окончания которого больше или равна " + RCB_I2742_DATE);
         установитьФлагВозврата(STOP_PROC_FLG);
    else
        objectFactoryInstance.createPtkPsdExportController().execute();
    end;
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
