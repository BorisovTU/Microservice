/*
$Name:          f601NormalizationProtocolView.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 601. Протокол нормализации
*/

class (TProtocolView) F601NormalizationProtocolView()
    initTProtocolView("ПРОТОКОЛ ПРОЦЕДУРЫ НОРМАЛИЗАЦИИ");

    private var m_isHeadPrinted = false;

    macro printNullData()
        [    Корректировок округленных значений символов не потребовалось.];
    end;

    macro beginProtocol()
        setProtocolOutput();
        printHead();
    end;
    
    macro printSeparatorLine()
            [├───────────────────────────────┼────────────────┼─────────────┼─────────────────┼──────────┤];    
    end;
        
    macro endProtocol()
        if (m_isHeadPrinted)
            [└───────────────────────────────┴────────────────┴─────────────┴─────────────────┴──────────┘];
            [ ];
        end;
        if (m_isEmpty)
            printNullData();
        end;
        resetProtocolOutput();
    end;
    
    macro printReportAbsence(report)
        printLine("Отсутствует рассчитанная форма 601 за предыдущий период" /*+ report.context.period.beginDate + " - " + report.context.period.endDate*/,
                  "В процессе нормализации сходимость с данными этой формы не реализована.",
                  "");
    end;    
  
    macro printString(str : String, exact, scaled)

        var floored = floor(Double(exact) / rcbApplication.currentReport.multiplier + 0.5);

        if (not m_isHeadPrinted)
            printLine("Расшифровка  № <пункт округления>__<номер строки>_<валюта>");
            [┌───────────────────────────────┬───────────────────────────────────────────────────────────┐];
            [│                               │                          Значение                         │];
            [│               №               ├────────────────┬─────────────┬─────────────────┬──────────┤];
            [│                               │ Действительное │ Округленное │ Нормализованное │ Разность │];
            [├───────────────────────────────┼────────────────┼─────────────┼─────────────────┼──────────┤];
            m_isHeadPrinted = true;                
        end;                                       

        [│###############################│################│#############│#################│##########│]
        (str, exact : 0 : 0, floored : 0 : 0, scaled : 0 : 0, abs(floored - scaled) : 0 : 0);

        m_isEmpty = false;
    end;
end;
