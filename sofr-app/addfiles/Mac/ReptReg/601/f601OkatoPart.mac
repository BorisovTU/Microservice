/*
$Name:          f601OkatoPart.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 601. Классы части отчета по одному ОКАТО
*/

/* ──────────────────────────────────────────────────────────────────────────┐
   RS-Bank V6                                                 R-Style Softlab
   Файл подсистемы "Регламентированная отчетность"

   Форма 601. Классы части отчета по одному ОКАТО.

   CREATED : 13.12.07 Ser.
└─────────────────────────────────────────────────────────────────────────- */
/**
 *  Общебанковские интеры и модули
 */

/**
 *  Интеры и модели подсистемы
 */
import rcbCoreInter;
import f601Global;
import f601ObjectFactory;

/**
 * Часть отчета по одному ОКАТО.
 */
class TOkatoPart(okatoCode : String, isTotal_ : Bool, prevReport : Object)
    /**
     * код ОКАТО
     */
    private var m_okatoCode  : String = okatoCode;

    private var m_isTotal    : Bool   = isTotal_;

    /**
     * Ссылка на составное значение Core-модели.
     */
    private var m_rcbCompositeValue : RcbCompositeValue = null;

    /*
     * Коллекция атрибутов части отчета
     */

    private var m_attributesCollection : TArray = TArray();
    /**
     * Получить код ОКАТО.
     */
    macro getOkatoCode() : String
        return m_okatoCode;
    end;

    /**
     * Инициализировать атрибуты отчета.
     */
    private macro initializeAttributes()
        throw(TPureVirtualMethodCallException("TOkatoPart::initializeAttributes"));
    end;

    /**
     * Конструктор.
     *
     * @param     okatoCode код по ОКАТО
     * @param     isTotal   итоговая часть?
     */
    private macro constructor(okatoCode : String, isTotal : Bool, prevReport : object)
        // Спецификация:
        //     См. диаграмму TReport::TReport.
        //     После получения ссылки на атрибут отчета, соответствующий данной части отчета,
        //     необходимо найти составное значение, соответствующее заданному коду ОКАТО.
        //     Инициализировать поля ключа:
        //         "okatoCode"  = getOkatoCode()
        //         "part"       = ""
        //         "code"       = ""
        //         "fiCode"     = ""
        //         "backOffice" = 0
        //     Если значение не найдено, то создать его.

        var attributeId = "ИтоговаяЧасть";

        if (not isTotal)
            attributeId = "ЧастьПоОКАТО";
        end;

        var attributeValue;

        if (prevReport != null)
            attributeValue = prevReport.attributeValue(attributeId);
        else 
            attributeValue = global.getRcbReport().attributeValue(attributeId);
        end;

        var keyValue       = attributeValue.createKeyValue();
        keyValue.fieldValue("okatoCode")  = getOkatoCode();
        keyValue.fieldValue("part")       = "";
        keyValue.fieldValue("code")       = "";
        keyValue.fieldValue("fiCode")     = "";
        keyValue.fieldValue("backOffice") = 0;

        m_rcbCompositeValue = attributeValue.findValue(keyValue);

        if (m_rcbCompositeValue == NULL)
            m_rcbCompositeValue = attributeValue.addValue();
            m_rcbCompositeValue.reset();
            m_rcbCompositeValue.fieldValue("okatoCode").exact  = getOkatoCode();
            m_rcbCompositeValue.fieldValue("part").exact       = "";
            m_rcbCompositeValue.fieldValue("code").exact       = "";
            m_rcbCompositeValue.fieldValue("fiCode").exact     = "";
            m_rcbCompositeValue.fieldValue("backOffice").exact = 0;
        end;

        initializeAttributes();
    end;

    /**
     * Итоговая часть?
     */
    macro isTotal() : Bool
        return m_isTotal;
    end;

    macro getCompositeValue() : RcbCompositeValue
        return m_rcbCompositeValue;
    end;

    /**
     * Получить ссылку на атрибут.
     *
     * @param     part  раздел
     * @param     code  код атрибута: для первого раздела - строка, для второго - графа
     */
    macro getAttribute(part : String, code : String)// : TAttribute
        var attribute : Object  = null;
        var i         : Integer = 0;

        while (i < m_attributesCollection.size)

            if ((m_attributesCollection[i].getPart() == part) and (m_attributesCollection[i].getCode() == code))
                return m_attributesCollection[i];
            end;

            i = i + 1;
        end;

        return null;
    end;

    constructor(okatoCode, isTotal, prevReport);
end;

/**
 * Часть отчета по ОКАТО по 1881-У.
 */
class (TOkatoPart) TOkatoPart1881(okatoCode : String, isTotal_ : Bool, prevReport : object)
    /**
     * Конструктор базового объекта
     */
    initTOkatoPart(okatoCode, isTotal_, prevReport);

    /**
     * Инициализировать атрибуты отчета.
     */
    private macro initializeAttributes()
        // Спецификация:
        //     Выполнить добавление атрибутов в часть отчета по схеме,
        //     описанной на TReport::TReport.
        //
        //     Раздел "1".
        //     Атрибуты: "1", "1.1","2" "2.1", "2.2", "2.3","2.4" "2.4.1", "2.4.2", "2.5", "2.6", "2.7",
        //     "2.8", "2.9","3" "3.1", "3.2", "3.3","4" "4.1", "4.2", "4.3","4.4" "4.4.1", "4.4.2", "4.5",
        //     "4.6", "4.7", "4.8", "4.9","5" "5.1", "5.2", "5.3", "6", "6.1".

        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "1.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.4");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.4.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.4.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.5");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.6");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.7");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.8");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.9");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "3.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "3.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "3.3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.4");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.4.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.4.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.5");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.6");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.7");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.8");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.9");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "5");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "5.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "5.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "5.3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "6");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "6.1");

        //     Раздел "2.1".
        //     Атрибуты: "4", "5", "6", "7", "8", "9".

        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "4");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "5");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "6");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "7");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "8");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "9");

        //     Раздел "2.2".
        //     Атрибуты: "10", "11", "12", "13", "14", "15".

        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "10");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "11");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "12");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "13");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "14");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "15");
    end;
end;

/**
 * Часть отчета по ОКАТО по 2539-У.
 */
class (TOkatoPart1881) TOkatoPart2539(okatoCode : String, isTotal_ : Bool, prevReport : object)
    /**
     * Конструктор базового объекта
     */
    initTOkatoPart1881(okatoCode, isTotal_, prevReport);

    /**
     * Инициализировать атрибуты отчета.
     */
    private macro initializeAttributes()
        // Спецификация:
        //     Выполнить добавление атрибутов в часть отчета по схеме,
        //     описанной на TReport::TReport.
        //
        //     Раздел "1".
        //     Атрибуты: "1", "1.1","2" "2.1", "2.2", "2.3","2.4" "2.4.1", "2.4.2", "2.5", "2.6", "2.7.1",
        //     "2.7.2", "2.8","3" "3.1", "3.2", "3.3","4" "4.1", "4.2", "4.3","4.4" "4.4.1", "4.4.2", "4.5",
        //     "4.6", "4.7.1", "4.7.2", "4.8","5" "5.1", "5.2", "5.3", "6", "6.1".

        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "1.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.4");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.4.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.4.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.5");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.6");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.7");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.7.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.7.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "2.8");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "3.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "3.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "3.3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.4");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.4.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.4.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.5");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.6");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.7");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.7.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.7.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "4.8");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "5");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "5.1");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "5.2");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "5.3");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "6");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "1", "6.1");

        //     Раздел "2.1".
        //     Атрибуты: "4", "5", "6", "7", "8", "9".

        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "4");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "5");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "6");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "7");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "8");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.1", "9");

        //     Раздел "2.2".
        //     Атрибуты: "10", "11", "12", "13", "14", "15".

        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "10");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "11");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "12");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "13");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "14");
        m_attributesCollection[m_attributesCollection.size] = objectFactoryInstance.createAttribute(this, "2.2", "15");
    end;
end;
