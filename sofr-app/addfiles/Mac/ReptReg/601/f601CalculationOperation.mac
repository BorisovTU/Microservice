/*
$Name:          f601CalculationOperation.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 601. Классы операции расчета отчета
*/

/* ──────────────────────────────────────────────────────────────────────────┐
   RS-Bank V6                                                 R-Style Softlab
   Файл подсистемы "Регламентированная отчетность"

   Форма 601. Классы операции расчета отчета

   CREATED : 13.12.07 Ser.
└─────────────────────────────────────────────────────────────────────────- */
/**
 *  Общебанковские интеры и модули
 */

/**
 *  Интеры и модели подсистемы
 */
import f601DataBank;
import f601Report;
import f601PrintCalculationProtocolOperation;

/**
 * Операция расчета.
 */
class TCalculationOperation()
    /**
     * Ссылка на банк данных.
     */
    private var m_dataBank : TDataBank = null;

    /**
     * Ссылка на отчет.
     */
    private var m_report   : TReport   = null;

    /**
     * Конструктор.
     */
    private macro constructor()
    end;

    /**
     * Заполнить вспомогательный атрибут "Коды ФИ".
     * @param     reportFiCodes список кодов ФИ, вошедших в отчет
     */
    private macro setReportFiCodes(reportFiCodes : TArray)
        // Спецификация:
        //     В атрибут отчета "Коды ФИ" вставить составные значения из массива
        //     reportFiCodes, инициализировав поле "code" значением элемента массива.

        var attributeValue = global.getRcbReport().attributeValue("КодыФИ");

        var i : Integer = 0;
        while (i < reportFiCodes.size)

            attributeValue.addValue().fieldValue("code").exact = reportFiCodes[i];

            i = i + 1;
        end;
    end;

    /*
    * Рассчитать количество ВСП
    */
    private macro calculateBranchCount(okatoPart : TOkatoPart)
        var okatoCode = okatoPart.getOkatoCode();
        var attributeValue = global.getRcbReport().attributeValue("ПользовательскийВвод");
        var attrValue;
        var keyValue = attributeValue.createKeyValue();
            keyValue.fieldValue("okatoCode") = okatoCode;

        var cmd =    "SELECT COUNT(t_okatoCode) branchCount"
            + "\n" + "  FROM drepdepcode_vw depcode"
            + "\n" + " WHERE EXISTS(SELECT 1"
            + "\n" + "                    FROM ddp_dep_dbt ddp_dep"
            + "\n" + "                   WHERE ddp_dep.t_partyid = depcode.t_partyid"
            + "\n" + "                     AND ddp_dep.t_nodetype = 2)";

            if (not okatoPart.isTotal)
                cmd = cmd + "              AND depcode.t_okatoCode = " + getSqlString(okatoCode)
            end;

            cmd = cmd + "\n" + "   AND (   EXISTS(SELECT 1"
                      + "\n" + "                    FROM df601cb_tmp"
                      + "\n" + "                   WHERE t_fnCash = depcode.t_departmentCode)"
                      + "\n" + "        OR EXISTS(SELECT 1"
                      + "\n" + "                    FROM drcbExchangeStat_tmp"
                      + "\n" + "                   WHERE t_fnCash = depcode.t_departmentCode)"
                      + "\n" + "        OR EXISTS(SELECT 1"
                      + "\n" + "                    FROM drcbTransferStat_tmp"
                      + "\n" + "                   WHERE t_fnCash = depcode.t_departmentCode)"
                      + "\n" + "        OR EXISTS(SELECT 1"
                      + "\n" + "                    FROM drcbDepositOperStat_tmp"
                      + "\n" + "                   WHERE t_fnCash = depcode.t_departmentCode))";

        var dataSet = TRsbDataSet(cmd);
        var branchCount = 0;

        if (dataSet.moveNext())
            branchCount = dataSet.branchCount;
        end;

        attrValue = attributeValue.findValue(keyValue);

        if (attrValue == null)
            attrValue = attributeValue.addValue();
            attrValue.reset();
            attrValue.fieldValue("okatoCode").current = okatoCode;
            attrValue.fieldValue("nExchPoints").setUndefined();
//            attrValue.fieldValue("nOperCash").setUndefined();
            attrValue.fieldValue("nOperCash").exact = 1;
        else
            if (not attrValue.fieldValue("nOperCash").isDefined())
                attrValue.fieldValue("nOperCash").exact = 1;
            end;
        end;

        branchCount = branchCount - NVL(attrValue.fieldValue("nExchPoints").exact,0);
        if (branchCount <= 0)
//            attrValue.fieldValue("nVsp").setUndefined();
            attrValue.fieldValue("nVsp").exact = 0;
        else
            attrValue.fieldValue("nVsp").exact = branchCount;
        end;

    end;

    /**
     * Задать значение вспомогательному атрибуту "Коды ОКАТО".
     * @param     totalOkatoCode    код ОКАТО итоговой части отчета
     */
    private macro setTotalOkatoCode(totalOkatoCode : String)
        // Спецификация:
        //     Для атрибута отчета "Коды ОКАТО" задать значение поля "code" равным
        //     totalOkatoCode. Значение должно располагаться на нулевом уровне.

        global.getRcbReport().attributeValue("КодыОКАТО").fieldValue("code").exact = totalOkatoCode;
    end;

    /**
     * Задать значения кодов ОКАТО, вошедших во вторуя часть отчета.
     * @param     outsideDomainOkatoCodes   коллекция ОКАТО-кодов второй части отчета
     */
    private macro setOutsideDomainOkatoCodes(outsideDomainOkatoCodes : TArray)
        // Спецификация:
        //     Для атрибута "Коды ОКАТО" отчета задать подчиненные составные значения,
        //     поле "code", которых заполнить значениями из коллекции outsideDomainOkatoCodes.
        //     Подчиненные значения должны находится на первом уровне.

        var attributeValue = global.getRcbReport().attributeValue("КодыОКАТО");

        var i : Integer = 0;
        while (i < outsideDomainOkatoCodes.size)
            if (outsideDomainOkatoCodes[i] != null)
                attributeValue.addValue().fieldValue("code").exact = outsideDomainOkatoCodes[i];
            end;

            i = i + 1;
        end;
    end;

    /**
     * Создать экземпляр банка данных.
     */
    private macro createDataBank() : TDataBank
        throw(TPureVirtualMethodCallException("TCalculationOperation::createDataBank"));
    end;

    /**
     * Вычислить атрибуты отчета по остаткам.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateRestAttributes(okatoPart : TOkatoPart)
        throw(TPureVirtualMethodCallException("TCalculationOperation::calculateRestAttributes"));
    end;

    /**
     * Рассчитать атрибуты по проводкам.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateDocumentAttributes(okatoPart : TOkatoPart)
        throw(TPureVirtualMethodCallException("TCalculationOperation::calculateDocumentAttributes"));
    end;

    /**
     * Рассчитать атрибуты по статистике по операциям по договору.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateDepositOperationsStatisticsAttributes(okatoPart : TOkatoPart)
        throw(TPureVirtualMethodCallException("TCalculationOperation::calculateDepositOperationsStatisticsAttributes"));
    end;

    /**
     * Рассчитать атрибут по статистике по валютно-обменным операциям.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateExchangeStatisticsAttributes(okatoPart : TOkatoPart)
        throw(TPureVirtualMethodCallException("TCalculationOperation::calculateExchangeStatisticsAttributes"));
    end;

    /**
     * Рассчитать атрибут по статистике по переводам без открытия счета.
     * @param     attribute атрибут отчета
     */
    private macro calculateTransferStatisticsAttributes(attribute : TAttribute)
        throw(TPureVirtualMethodCallException("TCalculationOperation::calculateTransferStatisticsAttributes"));
    end;
    /**
     * Рассчитать итоговые атрибуты.
     *
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateItogAttributes(okatoPart : TOkatoPart)
        throw(TPureVirtualMethodCallException("TCalculationOperation::calculateItogAttributes"));
    end;

     /**
     * Рассчитать атрибуты отчета по одному ОКАТО.
     *
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateOkatoPart(okatoPart : TOkatoPart)
        calculateRestAttributes(okatoPart);
        calculateDocumentAttributes(okatoPart);
        calculateDepositOperationsStatisticsAttributes(okatoPart);
        calculateExchangeStatisticsAttributes(okatoPart);
        calculateTransferStatisticsAttributes(okatoPart);
        calculateItogAttributes(okatoPart);
        calculateBranchCount(okatoPart);
    end;

    /**
     * Выполнить расчет.
     */
    macro execute()
        m_dataBank = createDataBank();

        setReportFiCodes(m_dataBank.getReportFiCodes());
        setTotalOkatoCode(m_dataBank.getTotalOkatoCode());

        setOutsideDomainOkatoCodes(m_dataBank.getOutsideDomainOkatoCodesSortedCollection());

        m_report = objectFactoryInstance.createReport();

        calculateOkatoPart(m_report.getTotalPart());

        var outsideDomainOkatoParts = m_report.getOutsideDomainOkatoParts();

        var i : Integer = 0;

        while (i < outsideDomainOkatoParts.size)
            calculateOkatoPart(outsideDomainOkatoParts[i]);
            i = i + 1;
        end;

        objectFactoryInstance.createPrintCalculationProtocolOperation().execute(m_dataBank);

        RcbApplication().TransactionManager().commit();
    end;

    constructor();
end;

/**
 * Операция расчета по 1881-У.
 */
class (TCalculationOperation) TCalculationOperation1881()
    /**
     * Конструктор базового объекта
     */
    initTCalculationOperation();

    /**
     * Создать экземпляр банка данных.
     */
    private macro createDataBank() : TDataBank
        // Спецификация:
        //     Создать банк данных для указания 1881-У.
        m_dataBank = TDataBank1881();
        m_dataBank.constructor();

        return m_dataBank;
    end;

    /**
     * Вычислить атрибуты отчета по остаткам.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateRestAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Для атрибутов "1" и "1.1" раздела "1" вычислить остатки (используя банк
        //     данных) на дату начала отчетного периода: global.getRcbReport().context.beginDate.

        m_dataBank.calculateRestAttribute(okatoPart.getAttribute("1", "1"),   global.getRcbReport().context.period.beginDate - 1);
        m_dataBank.calculateRestAttribute(okatoPart.getAttribute("1", "1.1"), global.getRcbReport().context.period.beginDate - 1);

        //     Для атрибутов "6" и "6.1" раздела "1" вычислить остатки (используя банк
        //     данных) на дату конца отчетного периода: global.getRcbReport().context.endDate.

        m_dataBank.calculateRestAttribute(okatoPart.getAttribute("1", "6"),   global.getRcbReport().context.period.endDate);
        m_dataBank.calculateRestAttribute(okatoPart.getAttribute("1", "6.1"), global.getRcbReport().context.period.endDate);
    end;

    /**
     * Рассчитать атрибуты по проводкам.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateDocumentAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Раздел "1".
        //     Для атрибутов "2.1", "2.2", "2.3", "2.4.1", "2.4.2", "2.5", "2.6", "2.7",
        //     "2.8", "2.9", "3.1", "3.2", "3.3" с использованием банка данных вычислить
        //     дебетовые обороты (не МВП).

        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.1"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.2"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.3"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.4.1"), true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.4.2"), true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.5"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.6"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.7"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.8"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.9"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "3.1"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "3.2"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "3.3"),   true, false);

        //     Для атрибутов "4.1", "4.2", "4.3", "4.4.1", "4.4.2", "4.5", "4.6", "4.7",
        //     "4.8", "4.9", "5.1", "5.2", "5.3" с использованием банка данных вычислить
        //     кредитовые обороты (не МВП).

        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.1"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.2"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.3"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.4.1"), false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.4.2"), false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.5"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.6"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.7"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.8"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.9"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "5.1"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "5.2"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "5.3"),   false, false);

        //     Разделы "2.1" и "2.2".
        //     Для атрибутов "8", "9" с использованием банка данных вычислить
        //     дебетовые обороты (не МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "8"), true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "9"), true, false);

        //     Для атрибутов "14", "15" с использованием банка данных вычислить
        //     кредитовые обороты (не МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "14"), false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "15"), false, false);

        //     Для атрибутов "4", "5", "6" с использованием банка данных вычислить
        //     дебетовые обороты (МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "4"), true, true);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "5"), true, true, true);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "6"), true, true);

        //     Для атрибутов "10", "11", "12" с использованием банка данных вычислить
        //     кредитовые обороты (МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "10"), false, true);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "11"), false, true, true);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "12"), false, true);
    end;

    /**
     * Рассчитать атрибуты по Retail.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateDepositOperationsStatisticsAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Расчет с использованием метода TDataBank::calculateDepositOperationsStatisticsAttribute.
        //     Далее в разрезе разделов указываются коды атрибутов с фильтром.

        var filter = "";

        //     Раздел "1".
        //     "2.5": t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'
        //     "2.6": t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)
        //     "4.5": t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'
        //     "4.6": t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)

        filter = "t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("1", "2.5"), filter);

        filter = "t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("1", "2.6"), filter);

        filter = "t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("1", "4.5"), filter);

        filter = "t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("1", "4.6"), filter);


        //     Раздел "2".
        //     "8":  t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'
        //     "9":  t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)
        //     "14": t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'
        //     "15": t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)

        filter = "t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("2.1", "8"), filter);

        filter = "t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("2.1", "9"), filter);

        filter = "t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("2.2", "14"), filter);

        filter = "t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("2.2", "15"), filter);
    end;

    /**
     * Рассчитать атрибут по статистике по валютно-обменным операциям.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateExchangeStatisticsAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Расчет с использованием метода TDataBank::calculateExchangeStatisticsAttribute.
        //     Далее в разрезе разделов указываются коды атрибутов, признак дохода,
        //     признак вычисляемой суммы, фильтр.

        var filter = "";

        //     Раздел "1".
        //     "2.4.1", true,  true,  t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = 'X'
        //     "2.4.2", true,  true,  t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = CHR(0)
        //     "4.4.1", false, false, t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = 'X'
        //     "4.4.2", false, false, t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = CHR(0)
        //     "2.5",   true,  true,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)
        //     "2.6",   true,  true,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'
        //     "4.5",   false, false, t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)
        //     "4.6",   false, false, t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'
        //     "3.1",   true,  true,  t_isCircularChequeOperation = 'X' AND t_isClientNotResident = 'X'
        //     "3.2",   true,  true,  t_isCircularChequeOperation = 'X' AND t_isClientNotResident = CHR(0)
        //     "5.1",   false, false, t_isCircularChequeOperation = 'X' AND t_isClientNotResident = 'X'
        //     "5.2",   false, false, t_isCircularChequeOperation = 'X' AND t_isClientNotResident = CHR(0)


        filter = "t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "2.4.1"), true, true, filter);

        filter = "t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "2.4.2"), true, true, filter);

        filter = "t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "4.4.1"), false, false, filter);

        filter = "t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "4.4.2"), false, false, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "2.5"), true, true, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "2.6"), true, true, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "4.5"), false, false, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "4.6"), false, false, filter);

        filter = "t_isCircularChequeOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "3.1"), true, true, filter);

        filter = "t_isCircularChequeOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "3.2"), true, true, filter);

        filter = "t_isCircularChequeOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "5.1"), false, false, filter);

        filter = "t_isCircularChequeOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "5.2"), false, false, filter);

        //     Раздел "2".
        //     "4",  true,  true,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_expenditureCurrencyCode = '810'
        //     "5",  true,  false,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_expenditureCurrencyCode = '810'
        //     "6",  true,  null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_expenditureCurrencyCode = '810'
        //     "7",  true,  true,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_receiptsCurrencyCode <> '810' AND t_expenditureCurrencyCode <> '810'
        //     "8",  true,  null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'
        //     "9",  true,  null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)
        //     "10", false, false,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode = '810'
        //     "11", false, true,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode = '810'
        //     "12", false, null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode = '810'
        //     "13", false, false,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_receiptsCurrencyCode <> '810' AND t_expenditureCurrencyCode <> '810'
        //     "14", false, null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'
        //     "15", false, null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_expenditureCurrencyCode = '810'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "4"), true, true,  filter);
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "5"), true, false, filter);
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "6"), true, null,  filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_receiptsCurrencyCode <> '810' AND t_expenditureCurrencyCode <> '810'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "7"), true, true, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "8"), true, null, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "9"), true, null, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode = '810'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "10"), false, false, filter);
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "11"), false, true,  filter);
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "12"), false, null,  filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_receiptsCurrencyCode <> '810' AND t_expenditureCurrencyCode <> '810'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "13"), false, false, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "14"), false, null, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "15"), false, null, filter);
    end;

    /**
     * Рассчитать атрибут по статистике по переводам без открытия счета.
     *
     * @param     attribute атрибут отчета
     */
    private macro calculateTransferStatisticsAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Расчет с использованием метода TDataBank::calculateTransferStatisticsAttribute.
        //     Далее в разрезе разделов указываются коды атрибутов с фильтром.

        var filter = "";

        //     Раздел "1".
        //     "2.7": t_isReceipts = 'X' AND t_isClientNotResident = 'X'
        //     "2.8": t_isReceipts = 'X' AND t_isClientNotResident = CHR(0)
        //     "4.7": t_isReceipts = CHR(0)  AND t_isClientNotResident = 'X'
        //     "4.8": t_isReceipts = CHR(0)  AND t_isClientNotResident = CHR(0)

        filter = "t_isReceipts = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateTransferStatisticsAttribute(okatoPart.getAttribute("1", "2.7"), filter);

        filter = "t_isReceipts = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateTransferStatisticsAttribute(okatoPart.getAttribute("1", "2.8"), filter);

        filter = "t_isReceipts = CHR(0) AND t_isClientNotResident = 'X'";
        m_dataBank.calculateTransferStatisticsAttribute(okatoPart.getAttribute("1", "4.7"), filter);

        filter = "t_isReceipts = CHR(0) AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateTransferStatisticsAttribute(okatoPart.getAttribute("1", "4.8"), filter);
    end;
    /*Фильтр составных переменных для раздела 1*/
    class TFilter1(str : String)
        var findStr = str;
        macro isSuitable(curValOfIterator)
            return (index(curValOfIterator.fieldValue("code").exact, findStr) != 0)
            and ((StrLen(curValOfIterator.fieldValue("code").exact) == 3)
            or (StrLen(curValOfIterator.fieldValue("code").exact) == 5)
            and ((findStr == "2.4.") or (findStr == "4.4.")))
    end;
    end;
    /*Фильтр составных переменных для раздела 2*/
    class TFilter2(str : String)
        var findStr = str;
        macro isSuitable(curValOfIterator)
            return (curValOfIterator.fieldValue("code").exact  == findStr)
                   and ((curValOfIterator.fieldValue("part").exact  == "2.1")
                   or (curValOfIterator.fieldValue("part").exact  == "2.2"))
    end;
    end;
    /**
     * Выборка атрибутов по маске и подсчёт итоговых атрибутов.
     */
    private macro calculateSelectedAttributes(attributeMasks : String,okatoPart : TOkatoPart, attribute : TAttribute, isMinus : Bool)
        var okatoCompositeValue = okatoPart.getCompositeValue();

        var iterator = okatoCompositeValue.createValueIterator();

        if (not isMinus)
            iterator.setFilter(TFilter1(attributeMasks));
        else
            iterator.setFilter(TFilter2(attributeMasks));
        end;

        iterator.moveFirst();
        while (not iterator.isDone())

            if (not isMinus)
                attribute.plus(iterator.currentItem.fieldValue("fiCode").exact, iterator.currentItem.fieldValue("backOffice").exact, iterator.currentItem.fieldValue("moneyValue").exact);
            else
                attribute.minus(iterator.currentItem.fieldValue("fiCode").exact, iterator.currentItem.fieldValue("backOffice").exact, iterator.currentItem.fieldValue("moneyValue").exact);
            end;

            iterator.moveNext();
        end;

    end;
    /**
     * Рассчитать итоговые атрибуты.
     *
    */
    private macro calculateItogAttributes(okatoPart : TOkatoPart)
        calculateSelectedAttributes("2.4.",okatoPart, okatoPart.getAttribute("1",  "2.4"),false);
        calculateSelectedAttributes("2.",  okatoPart, okatoPart.getAttribute("1",  "2"),  false);
        calculateSelectedAttributes("3.",  okatoPart, okatoPart.getAttribute("1",  "3"),  false);
        calculateSelectedAttributes("4.4.",okatoPart, okatoPart.getAttribute("1",  "4.4"),false);
        calculateSelectedAttributes("4.",  okatoPart, okatoPart.getAttribute("1",  "4"),  false);
        calculateSelectedAttributes("5.",  okatoPart, okatoPart.getAttribute("1",  "5"),  false);

// переменные уже вычислены, альтернативный способ - графа  7(II) = строка 2,4(I) - графа  4(II)
//                                                   графа 13(II) = строка 4,4(I) - графа 10(II)
//      calculateSelectedAttributes("2.4.", okatoPart, okatoPart.getAttribute("2.1", "7"), false);
//      calculateSelectedAttributes("4",    okatoPart, okatoPart.getAttribute("2.1", "7"), true);
//      calculateSelectedAttributes("4.4.", okatoPart, okatoPart.getAttribute("2.2", "13"),false);
//      calculateSelectedAttributes("10",   okatoPart, okatoPart.getAttribute("2.2", "13"),true);
    end;

    /**
     * Конструктор.
     */
    macro constructor()
    end;

    constructor();
end;


/**
 * Операция расчета по 2539-У.
 */
class (TCalculationOperation1881) TCalculationOperation2539()
    /**
     * Конструктор базового объекта
     */
    initTCalculationOperation1881();

    /**
     * Создать экземпляр банка данных.
     */
    private macro createDataBank() : TDataBank
        // Спецификация:
        //     Создать банк данных для указания 2539-У.
        m_dataBank = TDataBank2539();
        m_dataBank.constructor();

        return m_dataBank;
    end;

    /**
     * Вычислить атрибуты отчета по остаткам.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateRestAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Для атрибутов "1" и "1.1" раздела "1" вычислить остатки (используя банк
        //     данных) на дату начала отчетного периода: global.getRcbReport().context.beginDate.

        m_dataBank.calculateRestAttribute(okatoPart.getAttribute("1", "1"),   global.getRcbReport().context.period.beginDate - 1);
        m_dataBank.calculateRestAttribute(okatoPart.getAttribute("1", "1.1"), global.getRcbReport().context.period.beginDate - 1);

        //     Для атрибутов "6" и "6.1" раздела "1" вычислить остатки (используя банк
        //     данных) на дату конца отчетного периода: global.getRcbReport().context.endDate.

        m_dataBank.calculateRestAttribute(okatoPart.getAttribute("1", "6"),   global.getRcbReport().context.period.endDate);
        m_dataBank.calculateRestAttribute(okatoPart.getAttribute("1", "6.1"), global.getRcbReport().context.period.endDate);
    end;

    /**
     * Рассчитать атрибуты по проводкам.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateDocumentAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Раздел "1".
        //     Для атрибутов "2.1", "2.2", "2.3", "2.4.1", "2.4.2", "2.5", "2.6", "2.7",
        //     "2.8", "2.9", "3.1", "3.2", "3.3" с использованием банка данных вычислить
        //     дебетовые обороты (не МВП).

        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.1"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.2"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.3"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.4.1"), true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.4.2"), true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.5"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.6"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.7.1"), true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.7.2"), true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.8"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "3.1"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "3.2"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "3.3"),   true, false);

        //     Для атрибутов "4.1", "4.2", "4.3", "4.4.1", "4.4.2", "4.5", "4.6", "4.7",
        //     "4.8", "4.9", "5.1", "5.2", "5.3" с использованием банка данных вычислить
        //     кредитовые обороты (не МВП).

        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.1"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.2"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.3"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.4.1"), false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.4.2"), false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.5"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.6"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.7.1"), false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.7.2"), false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.8"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "5.1"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "5.2"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "5.3"),   false, false);

        //     Разделы "2.1" и "2.2".
        //     Для атрибутов "8", "9" с использованием банка данных вычислить
        //     дебетовые обороты (не МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "8"), true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "9"), true, false);

        //     Для атрибутов "14", "15" с использованием банка данных вычислить
        //     кредитовые обороты (не МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "14"), false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "15"), false, false);

        //     Для атрибутов "4", "5", "6" с использованием банка данных вычислить
        //     дебетовые обороты (МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "4"), true, true);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "5"), true, true, true);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "6"), true, true);

        //     Для атрибутов "10", "11", "12" с использованием банка данных вычислить
        //     кредитовые обороты (МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "10"), false, true);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "11"), false, true, true);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "12"), false, true);
    end;

    /**
     * Рассчитать атрибуты по Retail.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateDepositOperationsStatisticsAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Расчет с использованием метода TDataBank::calculateDepositOperationsStatisticsAttribute.
        //     Далее в разрезе разделов указываются коды атрибутов с фильтром.

        var filter = "";

        //     Раздел "1".
        filter = "t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("1", "2.5"), filter);

        filter = "t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("1", "2.6"), filter);

        filter = "t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("1", "4.5"), filter);

        filter = "t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("1", "4.6"), filter);

        //     Раздел "2".
        filter = "t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("2.1", "8"), filter);

        filter = "t_isReceipts = 'X' AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("2.1", "9"), filter);

        filter = "t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = 'X'";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("2.2", "14"), filter);

        filter = "t_isReceipts = CHR(0)  AND t_isCashPayments = 1 AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateDepositOperationsStatisticsAttribute(okatoPart.getAttribute("2.2", "15"), filter);
    end;

    /**
     * Рассчитать атрибут по статистике по валютно-обменным операциям.
     * @param     okatoPart часть отчета по ОКАТО
     */
    private macro calculateExchangeStatisticsAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Расчет с использованием метода TDataBank::calculateExchangeStatisticsAttribute.
        //     Далее в разрезе разделов указываются коды атрибутов, признак дохода,
        //     признак вычисляемой суммы, фильтр.

        var filter = "";

        //     Раздел "1".
        //     "2.4.1", true,  true,  t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = 'X'
        //     "2.4.2", true,  true,  t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = CHR(0)
        //     "4.4.1", false, false, t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = 'X'
        //     "4.4.2", false, false, t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = CHR(0)
        //     "2.5",   true,  true,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)
        //     "2.6",   true,  true,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'
        //     "4.5",   false, false, t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)
        //     "4.6",   false, false, t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'
        //     "3.1",   true,  true,  t_isCircularChequeOperation = 'X' AND t_isClientNotResident = 'X'
        //     "3.2",   true,  true,  t_isCircularChequeOperation = 'X' AND t_isClientNotResident = CHR(0)
        //     "5.1",   false, false, t_isCircularChequeOperation = 'X' AND t_isClientNotResident = 'X'
        //     "5.2",   false, false, t_isCircularChequeOperation = 'X' AND t_isClientNotResident = CHR(0)

        filter = "t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "2.4.1"), true, true, filter);

        filter = "t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "2.4.2"), true, true, filter);

        filter = "t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "4.4.1"), false, false, filter);

        filter = "t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_isCircularChequeOperation = CHR(0) AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "4.4.2"), false, false, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "2.5"), true, true, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "2.6"), true, true, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "4.5"), false, false, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "4.6"), false, false, filter);

        filter = "t_isCircularChequeOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "3.1"), true, true, filter);

        filter = "t_isCircularChequeOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "3.2"), true, true, filter);

        filter = "t_isCircularChequeOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "5.1"), false, false, filter);

        filter = "t_isCircularChequeOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("1", "5.2"), false, false, filter);

        //     Раздел "2".
        //     "4",  true,  true,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_expenditureCurrencyCode = '810'
        //     "5",  true,  false,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_expenditureCurrencyCode = '810'
        //     "6",  true,  null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_expenditureCurrencyCode = '810'
        //     "7",  true,  true,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_receiptsCurrencyCode <> '810' AND t_expenditureCurrencyCode <> '810'
        //     "8",  true,  null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'
        //     "9",  true,  null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)
        //     "10", false, false,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode = '810'
        //     "11", false, true,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode = '810'
        //     "12", false, null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode = '810'
        //     "13", false, false,  t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode <> t_expenditureCurrencyCode AND t_receiptsCurrencyCode <> '810' AND t_expenditureCurrencyCode <> '810'
        //     "14", false, null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'
        //     "15", false, null,   t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_expenditureCurrencyCode = '810'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "4"), true, true,  filter);
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "5"), true, false, filter);
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "6"), true, null,  filter);

        calculateSelectedAttributes("2.4.", okatoPart, okatoPart.getAttribute("2.1", "7"),false);
        calculateSelectedAttributes("4",    okatoPart, okatoPart.getAttribute("2.1", "7"), true);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "8"), true, null, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.1", "9"), true, null, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = CHR(0)  AND t_receiptsCurrencyCode = '810'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "10"), false, false, filter);
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "11"), false, true,  filter);
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "12"), false, null,  filter);

        calculateSelectedAttributes("4.4.", okatoPart, okatoPart.getAttribute("2.2", "13"),false);
        calculateSelectedAttributes("10",   okatoPart, okatoPart.getAttribute("2.2", "13"),true);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "14"), false, null, filter);

        filter = "t_isCircularChequeOperation = CHR(0)  AND t_isPlasticCardOperation = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateExchangeStatisticsAttribute(okatoPart.getAttribute("2.2", "15"), false, null, filter);
    end;

    /**
     * Рассчитать атрибут по статистике по переводам без открытия счета.
     * @param     attribute атрибут отчета
     */
    private macro calculateTransferStatisticsAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Расчет с использованием метода TDataBank::calculateTransferStatisticsAttribute.
        //     Далее в разрезе разделов указываются коды атрибутов с фильтром.

        var filter = "";

        //     Раздел "1".
        //     "2.7": t_isReceipts = 'X' AND t_isClientNotResident = 'X'
        //     "2.8": t_isReceipts = 'X' AND t_isClientNotResident = CHR(0)
        //     "4.7": t_isReceipts = CHR(0)  AND t_isClientNotResident = 'X'
        //     "4.8": t_isReceipts = CHR(0)  AND t_isClientNotResident = CHR(0)

        filter = "t_isReceipts = 'X' AND t_isClientNotResident = 'X'";
        m_dataBank.calculateTransferStatisticsAttribute(okatoPart.getAttribute("1", "2.7.1"), filter);

        filter = "t_isReceipts = 'X' AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateTransferStatisticsAttribute(okatoPart.getAttribute("1", "2.7.2"), filter);

        filter = "t_isReceipts = CHR(0) AND t_isClientNotResident = 'X'";
        m_dataBank.calculateTransferStatisticsAttribute(okatoPart.getAttribute("1", "4.7.1"), filter);

        filter = "t_isReceipts = CHR(0) AND t_isClientNotResident = CHR(0)";
        m_dataBank.calculateTransferStatisticsAttribute(okatoPart.getAttribute("1", "4.7.2"), filter);
    end;

    /*Фильтр составных переменных для раздела 1*/
    class TFilter1_2539(str : String)
        var findStr = str;
        macro isSuitable(curValOfIterator)
            return (index(curValOfIterator.fieldValue("code").exact, findStr) != 0)
            and ((StrLen(curValOfIterator.fieldValue("code").exact) == 3)
            or (StrLen(curValOfIterator.fieldValue("code").exact) == 5)
            and ((findStr == "2.4.") or (findStr == "4.4.") or (findStr == "2.7.") or (findStr == "4.7.")))
        end;
    end;

    /*Фильтр составных переменных для раздела 1*/
    class TFilter1_2539_IndependentString(str : String)
        var findStr = str;
        macro isSuitable(curValOfIterator)
            return (curValOfIterator.fieldValue("code").exactAsString == findStr)
            and ((curValOfIterator.fieldValue("backOffice").exact == BOCB) or ((curValOfIterator.fieldValue("backOffice").exact == BORETAIL)))
        end;
    end;
    /**
     * Выборка атрибутов по маске и подсчёт итоговых атрибутов.
     */
    private macro calculateSelectedAttributes(attributeMasks : String,okatoPart : TOkatoPart, attribute : TAttribute, isMinus : Bool)
        var okatoCompositeValue = okatoPart.getCompositeValue();

        var iterator = okatoCompositeValue.createValueIterator();

        if (not isMinus)
            iterator.setFilter(TFilter1_2539(attributeMasks));
        else
            iterator.setFilter(TFilter2(attributeMasks));
        end;

        iterator.moveFirst();
        while (not iterator.isDone())

            if (not isMinus)
                attribute.plus(iterator.currentItem.fieldValue("fiCode").exact, iterator.currentItem.fieldValue("backOffice").exact, iterator.currentItem.fieldValue("moneyValue").exact);
            else
                attribute.minus(iterator.currentItem.fieldValue("fiCode").exact, iterator.currentItem.fieldValue("backOffice").exact, iterator.currentItem.fieldValue("moneyValue").exact);
            end;

            iterator.moveNext();
        end;
    end;

    private macro calculatePartSelectedAttributes(attributeMasks : String,okatoPart : TOkatoPart, attribute : TAttribute)
        var okatoCompositeValue = okatoPart.getCompositeValue();
        var iterator            = okatoCompositeValue.createValueIterator();

        iterator.setFilter(TFilter1_2539_IndependentString(attributeMasks));

        iterator.moveFirst();
        while (not iterator.isDone())
            if (attribute.getType() == RCB_VT_MONEY)
                attribute.plus(iterator.currentItem.fieldValue("fiCode").exact, BONothing, iterator.currentItem.fieldValue("moneyValue").exact);
            elif (iterator.currentItem.fieldValue("itemValue").current != 0)
                    attribute.plus(iterator.currentItem.fieldValue("fiCode").currentAsString, BONothing, iterator.currentItem.fieldValue("itemValue").current);
            end;

            iterator.moveNext();
        end;
    end;

    /**
     * Рассчитать итоговые атрибуты.
     *
    */
    private macro calculateItogAttributes(okatoPart : TOkatoPart)
        //сначала суммы по ГК и ритейлу по независимым строкам
        calculatePartSelectedAttributes("1",    okatoPart, okatoPart.getAttribute("1",  "1"));
        calculatePartSelectedAttributes("1.1",  okatoPart, okatoPart.getAttribute("1",  "1.1"));
        calculatePartSelectedAttributes("2.1",  okatoPart, okatoPart.getAttribute("1",  "2.1"));
        calculatePartSelectedAttributes("2.2",  okatoPart, okatoPart.getAttribute("1",  "2.2"));
        calculatePartSelectedAttributes("2.3",  okatoPart, okatoPart.getAttribute("1",  "2.3"));
        calculatePartSelectedAttributes("2.4",  okatoPart, okatoPart.getAttribute("1",  "2.4"));
        calculatePartSelectedAttributes("2.4.1",okatoPart, okatoPart.getAttribute("1",  "2.4.1"));
        calculatePartSelectedAttributes("2.4.2",okatoPart, okatoPart.getAttribute("1",  "2.4.2"));
        calculatePartSelectedAttributes("2.5",  okatoPart, okatoPart.getAttribute("1",  "2.5"));
        calculatePartSelectedAttributes("2.6",  okatoPart, okatoPart.getAttribute("1",  "2.6"));
        calculatePartSelectedAttributes("2.7",  okatoPart, okatoPart.getAttribute("1",  "2.7"));
        calculatePartSelectedAttributes("2.7.1",okatoPart, okatoPart.getAttribute("1",  "2.7.1"));
        calculatePartSelectedAttributes("2.7.2",okatoPart, okatoPart.getAttribute("1",  "2.7.2"));
        calculatePartSelectedAttributes("2.8",  okatoPart, okatoPart.getAttribute("1",  "2.8"));
        calculatePartSelectedAttributes("3.1",  okatoPart, okatoPart.getAttribute("1",  "3.1"));
        calculatePartSelectedAttributes("3.2",  okatoPart, okatoPart.getAttribute("1",  "3.2"));
        calculatePartSelectedAttributes("3.3",  okatoPart, okatoPart.getAttribute("1",  "3.3"));
        calculatePartSelectedAttributes("4.1",  okatoPart, okatoPart.getAttribute("1",  "4.1"));
        calculatePartSelectedAttributes("4.2",  okatoPart, okatoPart.getAttribute("1",  "4.2"));
        calculatePartSelectedAttributes("4.3",  okatoPart, okatoPart.getAttribute("1",  "4.3"));
        calculatePartSelectedAttributes("4.4",  okatoPart, okatoPart.getAttribute("1",  "4.4"));
        calculatePartSelectedAttributes("4.4.1",okatoPart, okatoPart.getAttribute("1",  "4.4.1"));
        calculatePartSelectedAttributes("4.4.2",okatoPart, okatoPart.getAttribute("1",  "4.4.2"));
        calculatePartSelectedAttributes("4.5",  okatoPart, okatoPart.getAttribute("1",  "4.5"));
        calculatePartSelectedAttributes("4.6",  okatoPart, okatoPart.getAttribute("1",  "4.6"));
        calculatePartSelectedAttributes("4.7",  okatoPart, okatoPart.getAttribute("1",  "4.7"));
        calculatePartSelectedAttributes("4.7.1",okatoPart, okatoPart.getAttribute("1",  "4.7.1"));
        calculatePartSelectedAttributes("4.7.2",okatoPart, okatoPart.getAttribute("1",  "4.7.2"));
        calculatePartSelectedAttributes("4.8",  okatoPart, okatoPart.getAttribute("1",  "4.8"));
        calculatePartSelectedAttributes("5.1",  okatoPart, okatoPart.getAttribute("1",  "5.1"));
        calculatePartSelectedAttributes("5.2",  okatoPart, okatoPart.getAttribute("1",  "5.2"));
        calculatePartSelectedAttributes("5.3",  okatoPart, okatoPart.getAttribute("1",  "5.3"));
        calculatePartSelectedAttributes("6",    okatoPart, okatoPart.getAttribute("1",  "6"));
        calculatePartSelectedAttributes("6.1",  okatoPart, okatoPart.getAttribute("1",  "6.1"));

        calculatePartSelectedAttributes("4",    okatoPart, okatoPart.getAttribute("2.1", "4"));
        calculatePartSelectedAttributes("5",    okatoPart, okatoPart.getAttribute("2.1", "5"));
        calculatePartSelectedAttributes("6",    okatoPart, okatoPart.getAttribute("2.1", "6"));
        calculatePartSelectedAttributes("7",    okatoPart, okatoPart.getAttribute("2.1", "7"));
        calculatePartSelectedAttributes("8",    okatoPart, okatoPart.getAttribute("2.1", "8"));
        calculatePartSelectedAttributes("9",    okatoPart, okatoPart.getAttribute("2.1", "9"));

        calculatePartSelectedAttributes("10",   okatoPart, okatoPart.getAttribute("2.2", "10"));
        calculatePartSelectedAttributes("11",   okatoPart, okatoPart.getAttribute("2.2", "11"));
        calculatePartSelectedAttributes("12",   okatoPart, okatoPart.getAttribute("2.2", "12"));
        calculatePartSelectedAttributes("13",   okatoPart, okatoPart.getAttribute("2.2", "13"));
        calculatePartSelectedAttributes("14",   okatoPart, okatoPart.getAttribute("2.2", "14"));
        calculatePartSelectedAttributes("15",   okatoPart, okatoPart.getAttribute("2.2", "15"));

        //итоговые суммы
        calculateSelectedAttributes("2.4.",okatoPart, okatoPart.getAttribute("1",  "2.4"),false);
        calculateSelectedAttributes("2.7.",okatoPart, okatoPart.getAttribute("1",  "2.7"),false);
        calculateSelectedAttributes("2.",  okatoPart, okatoPart.getAttribute("1",  "2"),  false);
        calculateSelectedAttributes("3.",  okatoPart, okatoPart.getAttribute("1",  "3"),  false);
        calculateSelectedAttributes("4.4.",okatoPart, okatoPart.getAttribute("1",  "4.4"),false);
        calculateSelectedAttributes("4.7.",okatoPart, okatoPart.getAttribute("1",  "4.7"),false);
        calculateSelectedAttributes("4.",  okatoPart, okatoPart.getAttribute("1",  "4"),  false);
        calculateSelectedAttributes("5.",  okatoPart, okatoPart.getAttribute("1",  "5"),  false);
    end;

    /**
     * Конструктор.
     */
    macro constructor()
    end;

    constructor();
end;

class (TCalculationOperation2539) TCalculationOperation2835()
    /**
     * Создать экземпляр банка данных.
     */
    private macro createDataBank() : TDataBank
        // Спецификация:
        //     Создать банк данных для указания 2835-У.
        m_dataBank = TDataBank2835();
        m_dataBank.constructor();

        return m_dataBank;
    end;

    /**
     * Рассчитать атрибуты по проводкам.
     * @param okatoPart часть отчета по ОКАТО
     */
    private macro calculateDocumentAttributes(okatoPart : TOkatoPart)
        // Спецификация:
        //     Раздел "1".
        //     Для атрибутов "2.1", "2.2", "2.3", "2.4.1", "2.4.2", "2.5", "2.6", "2.7",
        //     "2.8", "2.9", "3.1", "3.2", "3.3" с использованием банка данных вычислить
        //     дебетовые обороты (не МВП).
        /**
         * Необходима проверка на наличие документа в подсистеме Retail
         */
        const NEED_CHECK_DOUCUMENT_FROM_RETAIL = TRUE;
        /**
         * Не национальная валюта
         */
        const NOT_NATIONAL_CURRENCY = FALSE;
        /**
         * Национальная валюта
         */
        const NATIONAL_CURRENCY = FALSE;

        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.1"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.2"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.3"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.8"),   true, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "3.3"),   true, false);

        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.4"),   true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.4.1"), true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.4.2"), true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.5"),   true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.6"),   true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.7"),   true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.7.1"), true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "2.7.2"), true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "3.1"),   true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "3.2"),   true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);

        //     Для атрибутов "4.1", "4.2", "4.3", "4.4.1", "4.4.2", "4.5", "4.6", "4.7",
        //     "4.8", "4.9", "5.1", "5.2", "5.3" с использованием банка данных вычислить
        //     кредитовые обороты (не МВП).

        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.1"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.2"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.3"),   false, false);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.8"),   false, false);

        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.4"),   false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.4.1"), false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.4.2"), false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.5"),   false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.6"),   false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.7"),   false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.7.1"), false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "4.7.2"), false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "5.1"),   false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "5.2"),   false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("1", "5.3"),   false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);

        //     Разделы "2.1" и "2.2".
        //     Для атрибутов "8", "9" с использованием банка данных вычислить
        //     дебетовые обороты (не МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "8"), true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "9"), true, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);

        //     Для атрибутов "14", "15" с использованием банка данных вычислить
        //     кредитовые обороты (не МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "14"), false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "15"), false, false, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);

        //     Для атрибутов "4", "5", "6" с использованием банка данных вычислить
        //     дебетовые обороты (МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "4"), true, true, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "5"), true, true, NATIONAL_CURRENCY,     NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.1", "6"), true, true, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);

        //     Для атрибутов "10", "11", "12" с использованием банка данных вычислить
        //     кредитовые обороты (МВП).
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "10"), false, true, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "11"), false, true, NATIONAL_CURRENCY,     NEED_CHECK_DOUCUMENT_FROM_RETAIL);
        m_dataBank.calculateDocumentAttribute(okatoPart.getAttribute("2.2", "12"), false, true, NOT_NATIONAL_CURRENCY, NEED_CHECK_DOUCUMENT_FROM_RETAIL);
    end;

    /**
     * Конструктор.
     */
    macro constructorTCalculationOperation2835()
        initTCalculationOperation2539();
    end;

    constructorTCalculationOperation2835();
end;
