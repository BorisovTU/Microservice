/*
$Name:          f601NormalizationController.mac
$Module:        –егламентируема€ отчетность
$Description:   ‘орма 601.  онтроллер нормализации.
*/

class F601NormalizationController()
    private var m_protocolView;

    private macro initialize()
        m_protocolView   = objectFactoryInstance.createNormalizationProtocolView();  
    end;

    macro showProtocol()
        var protocol = TSummaryProtocolView();
        var protocolDescription = "ПРОТОКОЛ ПРОЦЕДУРЫ НОРМАЛИЗАЦИИ";

        protocol.add(TProtocolView(protocolDescription));
        protocol.show();        
    end;

    macro execute()
        var normilizer;

        if (rcbApplication.currentReport.normalizationAlgorithm != RCB_NA_NONE) 
            m_protocolView.beginProtocol();

            normilizer = objectFactoryInstance.createNormalizer(m_protocolView);                       

            normilizer.checkReports();

            normilizer.normalize();

            RcbApplication.TransactionManager.commit();

            m_protocolView.endProtocol();

            showProtocol();        
        end;                             
    end;
    
    initialize();
    
end;

