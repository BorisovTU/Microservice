/*
$Name:          calc_f251cb.mac
$Module:        Регламентируемая отчетность
$Description:   Расчет формы 251 по данным ГК.
*/


/*─────────────────────────────────────────────────────────────────────────────────────────────────┐
  RS-Bank V6                                                                        R-Style Softlab
  Файл подсистемы "Регламентируемая отчетность"

  Расчет формы 251 по данным ГК.

  19.11.2008 ABP Стоит подумать об использовании DocInfo для этой формы
└─────────────────────────────────────────────────────────────────────────────────────────────────*/
import calc_f251;
import PaymInter;
import testLib;

/***************************************************************************************************
 *  Константы
 **************************************************************************************************/
private const PMLINK_CARRY = 1;

private const INTERNET_ORIGIN = 3;

macro hasAccountAssignedCategory(categoryId : Integer, categoryValue : String, alias : String)
    var filter = "";

    filter = "EXISTS(SELECT 1"
        +"\n"+ "  FROM drepcategory_vw"
        +"\n"+ " WHERE drepcategory_vw.t_isForAccount          = 1"
        +"\n"+ "   AND drepcategory_vw.t_isInstalledForEndDate = 1"
        +"\n"+ "   AND drepcategory_vw.t_objectId              = " + alias
        +"\n"+ "   AND drepcategory_vw.t_id                    = " + categoryId
        +"\n"+ "   AND drepcategory_vw.t_value                 = " + getSqlString(categoryValue) + ")";

    return filter;
end;

macro hasPartyAssignedCategory(categoryId : Integer, categoryValue : String, alias : String)
    var filter = "";

    filter = "EXISTS(SELECT 1"
        +"\n"+ "  FROM drepcategory_vw"
        +"\n"+ " WHERE drepcategory_vw.t_isForParty            = 1"
        +"\n"+ "   AND drepcategory_vw.t_isInstalledForEndDate = 1"
        +"\n"+ "   AND drepcategory_vw.t_objectId              = " + alias
        +"\n"+ "   AND drepcategory_vw.t_id                    = " + categoryId
        +"\n"+ "   AND drepcategory_vw.t_shortName             = " + getSqlString(categoryValue) + ")";

    return filter;
end;

/***************************************************************************************************
 *  Параметры отчета
 **************************************************************************************************/
class (TParameters) TCbparameters
    private macro getPlanNumberMap()
        var planNumber = getPlanNumber();
        var planNumberMap = TArray(30);
        var i;

        i = 0;
        while (i < planNumberMap.size)
            planNumberMap[i] = planNumber;
            i = i + 1;
        end;

        return planNumberMap;
    end;

    initTParameters();
end;

private var parameters = TCbParameters();

/***************************************************************************************************
 *  Классы для создания запросов
 **************************************************************************************************/
private class TAccountQueryBuilder(line : String, errorKind : Integer)
    defaultParm(errorKind, ERROR_KIND_NONE);

    private var m_line      = line;
    private var m_errorKind = errorKind;

    private var m_query = "SELECT " + BOCB + " t_backOffice,"
                 + "\n" + "       " + getSqlString(m_line) + " t_line,"
                 + "\n" + "       DECODE(accountData.t_fiid, 0, 3, 4) t_column,"
                 + "\n" + "       accountData.t_number t_account,"
                 + "\n" + "       NULL t_creditAccount,"
                 + "\n" + "       accountData.t_clientCode t_clientCode,"
                 + "\n" + "       NULL t_documentNumber,"
                 + "\n" + "       NULL t_documentReferenceNumber,"
                 + "\n" + "       NULL t_carryDate,"
                 + "\n" + "       accountData.t_fiid t_fiid,"
                 + "\n" + "       accountData.t_roublesum,"
                 + "\n" + "       DECODE(t_fiid, 0, 0, accountData.t_sum) t_currencySum,"
                 + "\n" + "       NULL t_sendingMode,"
                 + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
                 + "\n" + "       1 t_docCount,"
                 + "\n" + "       " + m_errorKind + " t_errorKind,"
                 + "\n" + "       NULL t_isInternetOrigin,"
                 + "\n" + "       NULL t_autoKey"
                 + "\n" + "  FROM df251acc_tmp accountData"
                 + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0");

    macro build()
        return m_query;
    end;
end;

class (TAccountQueryBuilder) TAccountQueryBuilder_1_1(line : String)
    defaultParm(line, "1.1");

    initTAccountQueryBuilder(line);

    macro getAccountFilterFor_1_1()
            return "(((accountData.t_balance BETWEEN '401' AND '40700') OR (accountData.t_balance BETWEEN '40702' AND '408')) OR (accountData.t_balance LIKE '408%')"
            + "\n" + "   OR (((accountData.t_balance LIKE '40701')) AND EXISTS(SELECT 1"
            + "\n" + "   FROM drepcategory_vw, df251doc_tmp documentData"
            + "\n" + "   WHERE drepcategory_vw.t_isForAccount          = 1"
            + "\n" + "   AND drepcategory_vw.t_isInstalledForEndDate   = 1"
            + "\n" + "   AND drepcategory_vw.t_id  = 1"
            + "\n" + "   AND documentData.T_PAYERACCOUNT (+)= accountData.t_number"
            + "\n" + "   AND drepcategory_vw.t_objectId (+)= documentData.t_payerObjectId"
            + "\n" + "   AND drepcategory_vw.t_value = 'Счет не ДУ КО')"
            + "\n" + "   ))"
    end;

    macro getAccountFilter(offset : String)
        return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance") + ")";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilterFor_1_1()
            + "\n" + "   AND (    (     (accountData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_hasBankPartyKind = 0)"
            + "\n" + "              AND (NOT EXISTS(SELECT 1"
            + "\n" + "                                FROM drepourbank_tmp"
            + "\n" + "                               WHERE t_partyId = accountData.t_clientCode)))"
            + "\n" + "         OR (     (accountData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_isClientEmployer = 1)"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*, 40821*", "accountData.t_balance") + ")))";
    end;
end;

class (TAccountQueryBuilder) TAccountQueryBuilder_1_1_2742(line : String)
    defaultParm(line, "1.1");

    initTAccountQueryBuilder(line);

    macro getAccountFilterFor_1_1()
            return "(((accountData.t_balance BETWEEN '401' AND '40700') OR (accountData.t_balance BETWEEN '40702' AND '408')) OR (accountData.t_balance LIKE '408%')"
            + "\n" + "   OR (((accountData.t_balance LIKE '40701')) AND EXISTS(SELECT 1"
            + "\n" + "   FROM drepcategory_vw, df251doc_tmp documentData"
            + "\n" + "   WHERE drepcategory_vw.t_isForAccount          = 1"
            + "\n" + "   AND drepcategory_vw.t_isInstalledForEndDate   = 1"
            + "\n" + "   AND drepcategory_vw.t_id  = 1"
            + "\n" + "   AND documentData.T_PAYERACCOUNT (+)= accountData.t_number"
            + "\n" + "   AND drepcategory_vw.t_objectId (+)= documentData.t_payerObjectId"
            + "\n" + "   AND drepcategory_vw.t_value = 'Счет не ДУ КО')"
            + "\n" + "   ))"
    end;

    macro getAccountFilter(offset : String)
        return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance") + ")";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilterFor_1_1()
            + "\n" + "   AND (    (     (accountData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_hasBankPartyKind = 0)"
            + "\n" + "              AND (NOT EXISTS(SELECT 1"
            + "\n" + "                                FROM drepourbank_tmp"
            + "\n" + "                               WHERE t_partyId = accountData.t_clientCode)))"
            + "\n" + "         OR (     (accountData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_isClientEmployer = 1)"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*", "accountData.t_balance") + "))"
            + "\n" + "         OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", "LPAD (accountData.t_clientCode, 10, '0')") + ")"
            + "\n" + "                   OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (accountData.t_clientCode, 10, '0')") + "))"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*", "accountData.t_balance") + ")))";

    end;
end;

class (TAccountQueryBuilder) TAccountQueryBuilder_1_1_3875(line : String)
    defaultParm(line, "1.1");

    initTAccountQueryBuilder(line);

    macro getAccountFilter(offset : String)
        return convertMaskToSqlFormat(tuneTable.getMaskForLine("1.1", BOCB), "accountData.t_balance");
    end;

    macro getAccountFilterFor_1_1()
            return "(" + getAccountFilter() + " AND accountData.t_balance NOT LIKE '40701%'"
            + "\n" + "   OR (    accountData.t_balance LIKE '40701%'"
            + "\n" + "       AND EXISTS(SELECT 1"
            + "\n" + "                    FROM drepcategory_vw, df251doc_tmp documentData"
            + "\n" + "                   WHERE drepcategory_vw.t_isForAccount          = 1"
            + "\n" + "                     AND drepcategory_vw.t_isInstalledForEndDate = 1"
            + "\n" + "                     AND drepcategory_vw.t_id                    = 1"
            + "\n" + "                     AND drepcategory_vw.t_value                 = 'Счет не ДУ КО'"
            + "\n" + "                     AND documentData.T_PAYERACCOUNT (+)= accountData.t_number"
            + "\n" + "                     AND drepcategory_vw.t_objectId  (+)= documentData.t_payerObjectId)"
            + "\n" + "      ))"
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilterFor_1_1()
            + "\n" + "   AND (    (     (accountData.t_clientLegalForm  = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_hasBankPartyKind = 0)"
            + "\n" + "              AND (NOT EXISTS(SELECT 1"
            + "\n" + "                                FROM drepourbank_tmp"
            + "\n" + "                               WHERE t_partyId = accountData.t_clientCode)))"
            + "\n" + "         OR (     (accountData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_isClientEmployer = 1)"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*, 42309*", "accountData.t_balance") + "))"
            + "\n" + "         OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", "LPAD (accountData.t_clientCode, 10, '0')") + ")"
            + "\n" + "                   OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (accountData.t_clientCode, 10, '0')") + "))"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*", "accountData.t_balance") + ")))";
    end;
end;

class (TAccountQueryBuilder) TAccountQueryBuilder_1_1_4212(line : String)
    defaultParm(line, "1.1");

    initTAccountQueryBuilder(line);

    macro getAccountFilter(offset : String)
        return convertMaskToSqlFormat(tuneTable.getMaskForLine("1.1", BOCB), "accountData.t_balance");
    end;

    macro getAccountFilterFor_1_1()
            return "(" + getAccountFilter() + " AND accountData.t_balance NOT LIKE '40701%'"
            + "\n" + "   OR (    accountData.t_balance LIKE '40701%'"
            + "\n" + "       AND EXISTS(SELECT 1"
            + "\n" + "                    FROM drepcategory_vw, df251doc_tmp documentData"
            + "\n" + "                   WHERE drepcategory_vw.t_isForAccount          = 1"
            + "\n" + "                     AND drepcategory_vw.t_isInstalledForEndDate = 1"
            + "\n" + "                     AND drepcategory_vw.t_id                    = 1"
            + "\n" + "                     AND drepcategory_vw.t_value                 = 'Счет не ДУ КО'"
            + "\n" + "                     AND documentData.T_PAYERACCOUNT (+)= accountData.t_number"
            + "\n" + "                     AND drepcategory_vw.t_objectId  (+)= documentData.t_payerObjectId)"
            + "\n" + "      ))"
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilterFor_1_1()
            + "\n" + "   AND (    (     (accountData.t_clientLegalForm  = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_hasBankPartyKind = 0)"
            + "\n" + "              AND (NOT EXISTS(SELECT 1"
            + "\n" + "                                FROM drepourbank_tmp"
            + "\n" + "                               WHERE t_partyId = accountData.t_clientCode)))"
            + "\n" + "         OR (     (accountData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_isClientEmployer = 1)"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*, 42108*, 42309*", "accountData.t_balance") + "))"
            + "\n" + "         OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", "LPAD (accountData.t_clientCode, 10, '0')") + ")"
            + "\n" + "                   OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (accountData.t_clientCode, 10, '0')") + "))"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*", "accountData.t_balance") + ")))";
    end;
end;

class (TAccountQueryBuilder) TAccountQueryBuilder_1_1_2742Dop(line : String)
    defaultParm(line, "1.1");

    initTAccountQueryBuilder("1.1");

    macro getAccountFilterFor_1_1()
            return "(((accountData.t_balance BETWEEN '401' AND '40700') OR (accountData.t_balance BETWEEN '40702' AND '408')) OR (accountData.t_balance LIKE '408%')"
            + "\n" + "   OR (((accountData.t_balance LIKE '40701')) AND EXISTS(SELECT 1"
            + "\n" + "   FROM drepcategory_vw, df251doc_tmp documentData"
            + "\n" + "   WHERE drepcategory_vw.t_isForAccount          = 1"
            + "\n" + "   AND drepcategory_vw.t_isInstalledForEndDate   = 1"
            + "\n" + "   AND drepcategory_vw.t_id  = 1"
            + "\n" + "   AND documentData.T_PAYERACCOUNT (+)= accountData.t_number"
            + "\n" + "   AND drepcategory_vw.t_objectId (+)= documentData.t_payerObjectId"
            + "\n" + "   AND drepcategory_vw.t_value = 'Счет не ДУ КО')"
            + "\n" + "   ))"
    end;

    macro getAccountFilter(offset : String)
        return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance") + ")";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilterFor_1_1()
            + "\n" + "   AND (    (     (accountData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_hasBankPartyKind = 0)"
            + "\n" + "              AND (NOT EXISTS(SELECT 1"
            + "\n" + "                                FROM drepourbank_tmp"
            + "\n" + "                               WHERE t_partyId = accountData.t_clientCode)))"
            + "\n" + "         OR (     (accountData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_isClientEmployer = 1)"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*, 40821*", "accountData.t_balance") + "))"
            + "\n" + "         OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", "LPAD (accountData.t_clientCode, 10, '0')") + ")"
            + "\n" + "                   OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (accountData.t_clientCode, 10, '0')") + "))"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*", "accountData.t_balance") + ")))";
    end;
end;

class (TAccountQueryBuilder) TAccountQueryBuilder_1_1_3875Dop(line : String)
    defaultParm(line, "1.1");

    initTAccountQueryBuilder("1.1");

    macro getAccountFilter(offset : String)
        return convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance");
    end;

    macro getAccountFilterFor_1_1()
        return "(" + getAccountFilter() + " AND accountData.t_balance NOT LIKE '40701%'"
            + "\n" + "   OR (    accountData.t_balance LIKE '40701%'"
            + "\n" + "       AND EXISTS(SELECT 1"
            + "\n" + "                    FROM drepcategory_vw,"
            + "\n" + "                         df251doc_tmp documentData"
            + "\n" + "                   WHERE drepcategory_vw.t_isForAccount          = 1"
            + "\n" + "                     AND drepcategory_vw.t_isInstalledForEndDate = 1"
            + "\n" + "                     AND drepcategory_vw.t_id                    = 1"
            + "\n" + "                     AND drepcategory_vw.t_value                 = 'Счет не ДУ КО'"
            + "\n" + "                     AND documentData.t_payerAccount (+)= accountData.t_number"
            + "\n" + "                     AND drepcategory_vw.t_objectId  (+)= documentData.t_payerObjectId)"
            + "\n" + "   ))"
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilterFor_1_1()
            + "\n" + "   AND (    (     (accountData.t_clientLegalForm  = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_hasBankPartyKind = 0)"
            + "\n" + "              AND (NOT EXISTS(SELECT 1"
            + "\n" + "                                FROM drepourbank_tmp"
            + "\n" + "                               WHERE t_partyId = accountData.t_clientCode)))"
            + "\n" + "         OR (     (accountData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_isClientEmployer = 1)"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*, 40821*, 42309*", "accountData.t_balance") + "))"
            + "\n" + "         OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", "LPAD (accountData.t_clientCode, 10, '0')") + ")"
            + "\n" + "                   OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (accountData.t_clientCode, 10, '0')") + "))"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*", "accountData.t_balance") + ")))";
    end;
end;

class (TAccountQueryBuilder) TAccountQueryBuilder_1_1_4212Dop(line : String)
    defaultParm(line, "1.1");

    initTAccountQueryBuilder("1.1");

    macro getAccountFilter(offset : String)
        return convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance");
    end;

    macro getAccountFilterFor_1_1()
        return "(" + getAccountFilter() + " AND accountData.t_balance NOT LIKE '40701%'"
            + "\n" + "   OR (    accountData.t_balance LIKE '40701%'"
            + "\n" + "       AND EXISTS(SELECT 1"
            + "\n" + "                    FROM drepcategory_vw,"
            + "\n" + "                         df251doc_tmp documentData"
            + "\n" + "                   WHERE drepcategory_vw.t_isForAccount          = 1"
            + "\n" + "                     AND drepcategory_vw.t_isInstalledForEndDate = 1"
            + "\n" + "                     AND drepcategory_vw.t_id                    = 1"
            + "\n" + "                     AND drepcategory_vw.t_value                 = 'Счет не ДУ КО'"
            + "\n" + "                     AND documentData.t_payerAccount (+)= accountData.t_number"
            + "\n" + "                     AND drepcategory_vw.t_objectId  (+)= documentData.t_payerObjectId)"
            + "\n" + "   ))"
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilterFor_1_1()
            + "\n" + "   AND (    (     (accountData.t_clientLegalForm  = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_hasBankPartyKind = 0)"
            + "\n" + "              AND (NOT EXISTS(SELECT 1"
            + "\n" + "                                FROM drepourbank_tmp"
            + "\n" + "                               WHERE t_partyId = accountData.t_clientCode)))"
            + "\n" + "         OR (     (accountData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_isClientEmployer = 1)"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*, 40821*, 42108*, 42309*", "accountData.t_balance") + "))"
            + "\n" + "         OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", "LPAD (accountData.t_clientCode, 10, '0')") + ")"
            + "\n" + "                   OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (accountData.t_clientCode, 10, '0')") + "))"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*", "accountData.t_balance") + ")))";
    end;
end;

//для строк 1.1.2 и 1.1.3 Раздела 1 по ГК
class (TAccountQueryBuilder) TAccountQueryBuilder_1_1_4212Dop_for_1_1_23(line : String)
    defaultParm(line, "1.1");

    initTAccountQueryBuilder("1.1");

    macro getAccountFilterFor_1_1()
            return "(((accountData.t_balance BETWEEN '401' AND '40700') OR (accountData.t_balance BETWEEN '40702' AND '408')) OR (accountData.t_balance LIKE '408%')"
            + "\n" + "   OR (((accountData.t_balance LIKE '40701')) AND EXISTS(SELECT 1"
            + "\n" + "   FROM drepcategory_vw, df251doc_tmp documentData"
            + "\n" + "   WHERE drepcategory_vw.t_isForAccount          = 1"
            + "\n" + "   AND drepcategory_vw.t_isInstalledForEndDate   = 1"
            + "\n" + "   AND drepcategory_vw.t_id  = 1"
            + "\n" + "   AND documentData.T_PAYERACCOUNT (+)= accountData.t_number"
            + "\n" + "   AND drepcategory_vw.t_objectId (+)= documentData.t_payerObjectId"
            + "\n" + "   AND drepcategory_vw.t_value = 'Счет не ДУ КО')"
            + "\n" + "   ))"
    end;

    macro getAccountFilter(offset : String)
        return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance") + ")";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilterFor_1_1()
            + "\n" + "   AND (    (     (accountData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_hasBankPartyKind = 0)"
            + "\n" + "              AND (NOT EXISTS(SELECT 1"
            + "\n" + "                                FROM drepourbank_tmp"
            + "\n" + "                               WHERE t_partyId = accountData.t_clientCode)))"
            + "\n" + "         OR (     (accountData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + "              AND (accountData.t_isClientEmployer = 1)"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*, 40821*, 42108*", "accountData.t_balance") + "))"
            + "\n" + "         OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", "LPAD (accountData.t_clientCode, 10, '0')") + ")"
            + "\n" + "                   OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (accountData.t_clientCode, 10, '0')") + "))"
            + "\n" + "              AND (" + convertMaskToSqlFormat("40802*", "accountData.t_balance") + ")))";
    end;
end;

class (TAccountQueryBuilder) TAccountQueryBuilder_1_2(line : String)
    defaultParm(line, "1.2");

    initTAccountQueryBuilder(line);

    macro getAccountFilter(offset : String)
        return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance") + ")";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilter(mkStr(" ", 7))
            + "\n" + "   AND CASE"
            + "\n" + "           WHEN accountData.t_balance IN ('40806', '40809', '40812', '40814', '40815', '40823', '40824')"
            + "\n" + "               THEN CASE"
            + "\n" + "                        WHEN accountData.t_clientLegalForm = " + RCB_NATURAL_PERSON
            + "\n" + "                             THEN 1"
            + "\n" + "                        ELSE 0"
            + "\n" + "                    END"
            + "\n" + "           ELSE 1"
            + "\n" + "       END = 1";
    end;
end;

class (TAccountQueryBuilder) TAccountQueryBuilder_1_2_3875(line : String)
    defaultParm(line, "1.2");

    initTAccountQueryBuilder(line);

    macro getAccountFilter(offset : String)
        return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance") + ")";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getAccountFilter(mkStr(" ", 7))
            + "\n" + "   AND (accountData.t_clientLegalForm = " + RCB_NATURAL_PERSON + ")";
    end;
end;

private class TDocumentQueryBuilder(line : String, errorKind : Integer, isNoTuneTable : bool)
    defaultParm(errorKind, ERROR_KIND_NONE);

    private var m_isNoTuneTable = ternary(isNoTuneTable, true, false) ;
    private var m_line      = line;
    private var m_errorKind = errorKind;

    private var m_beforeI2055Mask =
        ternary(parameters.getEndDate() < RCB_I2055_DATE,
                "\n" + "   AND NOT (" + convertMaskToSqlFormat("202*", "documentData.t_debetBalance")  + ")" +
                "\n" + "   AND NOT (" + convertMaskToSqlFormat("202*", "documentData.t_creditBalance") + ")"
                , "");

    private var m_query = "SELECT " + BOCB + " t_backOffice,"
                 + "\n" + "       " + getSqlString(m_line) + " t_line,"
                 + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
                 + "\n" + "       documentData.t_payerAccount t_account,"
                 + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
                 + "\n" + "       documentData.t_clientCode t_clientCode,"
                 + "\n" + "       documentData.t_number t_documentNumber,"
                 + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
                 + "\n" + "       documentData.t_carryDate t_carryDate,"
                 + "\n" + "       documentData.t_fiid t_fiid,"
                 + "\n" + "       documentData.t_roubleSum,"
                 + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
                 + "\n" + "       documentData.t_sendingMode t_sendingMode,"
                 + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
                 + "\n" + "       1 t_docCount,"
                 + "\n" + "       " + m_errorKind + " t_errorKind,"
                 + "\n" + "       documentData.t_isInternetOrigin,";
        if (rcbApplication().currentReport.context.period.endDate >= RCB_I2742_DATE)
            m_query = m_query
                 + "\n" + "       documentData.t_isRemoteConnection,"
                 + "\n" + "       documentData.t_isConnection,"
                 + "\n" + "       documentData.t_isMobilePhoneConnection,"
                 + "\n" + "       documentData.t_result_carry,";
        end;
            m_query = m_query
                 + "\n" + "       documentData.t_autoKey t_autoKey"
                 + "\n" + "  FROM df251doc_tmp documentData"
                 + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line) or (isNoTuneTable), "1 = 1", "1 = 0")
                 +                m_beforeI2055Mask;

    /**
     *  Исключение проводок "Погашение векселей"
     */
    macro excludeRepaymentBill()
        return           "              AND NOT (     (NOT EXISTS(SELECT 1"
                + "\n" + "                                          FROM drepourbank_tmp"
                + "\n" + "                                         WHERE t_partyId = documentData.t_clientCode"
                + "\n" + "                                       )"
                + "\n" + "                             AND " + convertMaskToSqlFormat("47422*", "documentData.t_creditBalance")
                + "\n" + "                            )"
                + "\n" + "                        AND (EXISTS(SELECT 1"
                + "\n" + "                                      FROM drepourbank_tmp"
                + "\n" + "                                     WHERE t_partyId = documentData.t_clientCode"
                + "\n" + "                                   )"
                + "\n" + "                             AND (" + convertMaskToSqlFormat("523*",   "documentData.t_debetBalance")
                + "\n" + "                              OR  " + convertMaskToSqlFormat("52406*", "documentData.t_debetBalance")
                + "\n" + "                                 )"
                + "\n" + "                            )"
                + "\n" + "                      )";
    end;

    /**
     *  Установлена категория.
     */
    private macro hasAssignedCategory(objectId, listCategory : String) : String
        var filter = "";
        filter = "EXISTS(SELECT 1"
          +"\n"+ "         FROM dobjatcor_dbt atc"
          +"\n"+ "        WHERE atc.t_ObjectType = " + RCB_OBJTYPE_ACCOUNT
          +"\n"+ "          AND atc.t_GroupID    = " + RCB_OBJGROUP_REPORT
          +"\n"+ "          AND atc.t_Object     = " + objectId
          +"\n"+ "          AND atc.t_AttrID IN (SELECT att.t_AttrID"
          +"\n"+ "                                 FROM dobjattr_dbt att"
          +"\n"+ "                                WHERE att.t_ObjectType = atc.t_ObjectType"
          +"\n"+ "                                  AND att.t_GroupID    = atc.t_GroupID"
          +"\n"+ "                                  " + ternary((listCategory != null)and(listCategory != ""),
                                                                "AND att.t_numInList  IN ( " + listCategory + ")",
                                                                ""
                                                               )
               + "                              )   "
          +"\n"+ "          AND " + getSqlDate(rcbApplication().currentReport.context.period.endDate) + " BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate)";
        return filter;
    end;

    macro build()
        return m_query;
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_1(line : String, debetBalanceMaskLine : String)
    defaultParm(line, "2.1");
    defaultParm(debetBalanceMaskLine, line);

    private var m_debetBalanceMaskLine = debetBalanceMaskLine;

    initTDocumentQueryBuilder(line);

    macro getDocumentFilter(offset : String)
        return                "(    (     (documentData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + offset + "       AND (NOT EXISTS(SELECT 1"
            + "\n" + offset + "                         FROM drepourbank_tmp"
            + "\n" + offset + "                        WHERE t_partyId = documentData.t_clientCode))"
            + "\n" + offset + "       AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + "))"
            + "\n" + offset + "  OR (     (documentData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + offset + "       AND (documentData.t_isClientEmployer = 1)"
            + "\n" + offset + "       AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*, 40821*", "documentData.t_balance") + ")))";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7));
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_1_2742(line : String, debetBalanceMaskLine : String)
    defaultParm(line, "2.1");
    defaultParm(debetBalanceMaskLine, line);

    private var m_debetBalanceMaskLine = debetBalanceMaskLine;

    initTDocumentQueryBuilder(line);

    macro getDocumentFilter(offset : String)
        return                "(    (     (documentData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
            + "\n" + offset + "       AND (NOT EXISTS(SELECT 1"
            + "\n" + offset + "                         FROM drepourbank_tmp"
            + "\n" + offset + "                        WHERE t_partyId = documentData.t_clientCode))"
            + "\n" + offset + "       AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + "))"
            + "\n" + offset + "  OR (     (documentData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
            + "\n" + offset + "       AND (documentData.t_isClientEmployer = 1)"
            + "\n" + offset + "       AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*", "documentData.t_debetBalance") + "))"
            + "\n" + offset + "        OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", " LPAD (documentData.t_clientCode, 10, '0')") + ")"
            + "\n" + offset + "              OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (documentData.t_clientCode, 10, '0')") + "))"
            + "\n" + offset + "                 AND (" + convertMaskToSqlFormat("40802*", "documentData.t_debetBalance") + ")))";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7));
    end;
end;

class (TDocumentQueryBuilder_2_1) TDocumentQueryBuilder_2_1_1(line : String, debetBalanceMaskLine : String)
    defaultParm(line, "2.1.1");
    defaultParm(debetBalanceMaskLine, line);

    initTDocumentQueryBuilder_2_1(debetBalanceMaskLine);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('01', '16'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '01'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '01'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_1_1_1_1(line : String)
    defaultParm(line, "2.1.1.1.1");

    initTDocumentQueryBuilder(line);

    macro build()
        return            "SELECT t_bo,"
                 + "\n" + "       '2.1.1.1.1' t_line,"
                 + "\n" + "       t_column,"
                 + "\n" + "       t_account,"
                 + "\n" + "       t_accountCredit,"
                 + "\n" + "       t_clientCode,"
                 + "\n" + "       t_numbDocument,"
                 + "\n" + "       t_shifrDocument,"
                 + "\n" + "       t_dateCarry,"
                 + "\n" + "       t_fiid,"
                 + "\n" + "       t_sumRub,"
                 + "\n" + "       t_sumCurrency,"
                 + "\n" + "       t_kindA,"
                 + "\n" + "       t_chapter,"
                 + "\n" + "       t_docCount,"
                 + "\n" + "       t_errorKind,"
                 + "\n" + "       t_isInternetOrigin,"
                 + "\n" + "       t_autoKey"
                 + "\n" + "  FROM df251_tmp documentData"
                 + "\n" + " WHERE t_line = '2.1.1'"
                 + "\n" + "   AND documentData.t_isInternetOrigin = 1";
    end;
end;

class (TDocumentQueryBuilder_2_1) TDocumentQueryBuilder_2_1_2(line : String)
    defaultParm(line, "2.1.2");

    initTDocumentQueryBuilder_2_1(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('08'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '08'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '08'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder_2_1) TDocumentQueryBuilder_2_1_3(line : String)
    defaultParm(line, "2.1.3");

    initTDocumentQueryBuilder_2_1(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('02'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '02'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '02'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder_2_1) TDocumentQueryBuilder_2_1_4(line : String)
    defaultParm(line, "2.1.4");

    initTDocumentQueryBuilder_2_1(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('06'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '06'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '06'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder_2_1) TDocumentQueryBuilder_2_1_5(line : String)
    defaultParm(line, "2.1.5");

    initTDocumentQueryBuilder_2_1(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('07'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '07'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '07'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_2(line : String, debetBalanceMaskLine : String)
    defaultParm(line, "2.2");
    defaultParm(debetBalanceMaskLine, line);

    private var m_debetBalanceMaskLine = debetBalanceMaskLine;

    initTDocumentQueryBuilder(line);

    macro getDocumentFilter(offset : String)
        return                "(     (    (documentData.t_clientLegalForm = " + RCB_NATURAL_PERSON + "))"
            + "\n" + offset + "  AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + "))";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7));
    end;
end;

class (TDocumentQueryBuilder_2_2) TDocumentQueryBuilder_2_2_1(line : String, debetBalanceMaskLine : String)
    defaultParm(line, "2.2.1");
    defaultParm(debetBalanceMaskLine, line);

    initTDocumentQueryBuilder_2_2(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('01'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '01'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '01'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_2_1_1_1(line : String)
    defaultParm(line, "2.2.1.1.1");

    initTDocumentQueryBuilder(line);

    macro build()
        return            "SELECT t_bo,"
                 + "\n" + "       '2.2.1.1.1' t_line,"
                 + "\n" + "       t_column,"
                 + "\n" + "       t_account,"
                 + "\n" + "       t_accountCredit,"
                 + "\n" + "       t_clientCode,"
                 + "\n" + "       t_numbDocument,"
                 + "\n" + "       t_shifrDocument,"
                 + "\n" + "       t_dateCarry,"
                 + "\n" + "       t_fiid,"
                 + "\n" + "       t_sumRub,"
                 + "\n" + "       t_sumCurrency,"
                 + "\n" + "       t_kindA,"
                 + "\n" + "       t_chapter,"
                 + "\n" + "       t_docCount,"
                 + "\n" + "       t_errorKind,"
                 + "\n" + "       t_isInternetOrigin,"
                 + "\n" + "       t_autoKey"
                 + "\n" + "  FROM df251_tmp documentData"
                 + "\n" + " WHERE t_line = '2.2.1'"
                 + "\n" + "   AND documentData.t_isInternetOrigin = 1";
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_2_2(line : String)
    defaultParm(line, "2.2.2");

    initTDocumentQueryBuilder(line);

    private var m_creditBalanceMaskLine = line;

    macro getDocumentFilter(offset : String)
        return                "(     (    (documentData.t_clientLegalForm = " + RCB_NATURAL_PERSON + ")"
                            + "       AND (documentData.t_isClientEmployer != 1))"
            + "\n" + offset + "  AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_creditBalanceMaskLine, BOCB), "documentData.t_creditBalance") + "))";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7))
            + "\n" + "   AND (documentData.t_referenceNumber IN ('08'))";
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_2_2_1(line : String, debetBalanceMaskLine : String)
    defaultParm(line, "2.2.2.1");
    defaultParm(debetBalanceMaskLine, "2.2.2");

    initTDocumentQueryBuilder(line, ERROR_KIND_NONE, true);

    private var m_creditBalanceMaskLine = "2.2.2";

    macro getDocumentFilter(offset : String)
        return                "(     (    (documentData.t_clientLegalForm = " + RCB_NATURAL_PERSON + ")"
                            + "       AND (documentData.t_isClientEmployer != 1))"
            + "\n" + offset + "  AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_creditBalanceMaskLine, BOCB), "documentData.t_creditBalance") + "))"
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
    end;

    macro build()
        return build()
            + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7))
            + "\n" + "   AND (documentData.t_referenceNumber IN ('08'))";
    end;
end;

class (TDocumentQueryBuilder_2_2) TDocumentQueryBuilder_2_2_3(line : String, debetBalanceMaskLine : String)
    defaultParm(line, "2.2.3");
    defaultParm(debetBalanceMaskLine, "2.2.3");

    initTDocumentQueryBuilder_2_2(line, debetBalanceMaskLine);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('02'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '02'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '02'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder_2_2) TDocumentQueryBuilder_2_2_4(line : String, debetBalanceMaskLine : String)
    defaultParm(line, "2.2.4");
    defaultParm(debetBalanceMaskLine, "2.2.4");

    initTDocumentQueryBuilder_2_2(line, debetBalanceMaskLine);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('06'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '06'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '06'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder_2_2) TDocumentQueryBuilder_2_2_5(line : String)
    defaultParm(line, "2.2.5");

    initTDocumentQueryBuilder_2_2(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('07'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '07'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '07'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_3(line : String)
    defaultParm(line, "2.3");

    initTDocumentQueryBuilder(line);

    macro getDocumentFilter(offset : String)
        var balanceMasks = "30102*, " + tuneTable.getMaskForLine("2.1.2", BOCB) + "," + tuneTable.getMaskForLine("2.2.1", BOCB) + "," + tuneTable.getMaskForLine("3.1", BOCB);

        return       "       EXISTS(SELECT 1"
            + "\n" + "               FROM drepourbank_tmp"
            + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
            + "\n" + "   AND (    (    (" + convertMaskToSqlFormat("30221*", "documentData.t_debetBalance") + ")"
            + "\n" + "             AND (" + convertMaskToSqlFormat("30102*", "documentData.t_creditBalance") + "))"
            + "\n" + "         OR"
            + "\n" + "            (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "documentData.t_debetBalance") + ")"
            + "\n" + "             AND (" + convertMaskToSqlFormat(balanceMasks, "documentData.t_creditBalance") + ")))";
    end;

    macro build()
        return build()
            + "\n" + "  AND " + getDocumentFilter("");
    end;
end;

class (TDocumentQueryBuilder_2_3) TDocumentQueryBuilder_2_3_1(line : String)
    defaultParm(line, "2.3.1");

    initTDocumentQueryBuilder_2_3(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('01'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '01'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '01'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder_2_3) TDocumentQueryBuilder_2_3_2(line : String)
    defaultParm(line, "2.3.2");

    initTDocumentQueryBuilder_2_3(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('08'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '08'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '08'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder_2_3) TDocumentQueryBuilder_2_3_3(line : String)
    defaultParm(line, "2.3.3");

    initTDocumentQueryBuilder_2_3(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('02'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '02'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '02'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder_2_3) TDocumentQueryBuilder_2_3_4(line : String)
    defaultParm(line, "2.3.4");

    initTDocumentQueryBuilder_2_3(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('06'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '06'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '06'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder_2_3) TDocumentQueryBuilder_2_3_5(line : String)
    defaultParm(line, "2.3.5");

    initTDocumentQueryBuilder_2_3(line);

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber IN ('07'))";
        else
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '07'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '07'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_5(line : String)
    defaultParm(line, "2.5");

    initTDocumentQueryBuilder(line);

    macro getCondition()
        return       "   (   documentData.t_referenceNumber = '09'"
            + "\n" + "        OR (documentData.t_referenceNumber = '16'"
            + "\n" + "            AND documentData.t_referenceNumberPd = '09'"
            + "\n" + "           )"
            + "\n" + "       )"
            + "\n" + "    AND (   ((" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5уплач", BOCB), "documentData.t_debetBalance")  + ")"
            + "\n" + "              AND (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_creditBalance") + ")"
            + "\n" + "                   OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_creditBalance") + ")"
            + "\n" + "                  )"
            + "\n" + "              AND ( NOT (" + convertMaskToSqlFormat("706*", "documentData.t_debetBalance")  + ")"
            + "\n" + "                     OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.5уплач", BOCB), "documentData.t_payerOpuSymbol") + ")))"
            + "\n" + "         OR ((" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5получ", BOCB), "documentData.t_creditBalance") + ")"
            + "\n" + "              AND (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance") + ")"
            + "\n" + "                   OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
            + "\n" + "                  )"
            + "\n" + "              AND ( NOT (" + convertMaskToSqlFormat("706*", "documentData.t_creditBalance")  + ")"
            + "\n" + "                     OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.5получ", BOCB), "documentData.t_receiverOpuSymbol") + "))))"
    end;

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (documentData.t_referenceNumber = '09')"
                + "\n" + "   AND (   ((" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5уплач", BOCB), "documentData.t_debetBalance")  + ")"
                + "\n" + "             AND (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "                  OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "                 )"
                + "\n" + "             AND ( NOT (" + convertMaskToSqlFormat("706*", "documentData.t_debetBalance")  + ")"
                + "\n" + "                    OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.5уплач", BOCB), "documentData.t_payerOpuSymbol") + ")))"
                + "\n" + "        OR ((" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5получ", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "             AND (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "                  OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "                 )"
                + "\n" + "             AND ( NOT (" + convertMaskToSqlFormat("706*", "documentData.t_creditBalance")  + ")"
                + "\n" + "                    OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.5получ", BOCB), "documentData.t_receiverOpuSymbol") + "))))";
        else
            return build()
                + "\n" + "   AND " + getCondition();
        end;
    end;
end;

class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_1()

    macro build()
        if (parameters.getEndDate() < RCB_I2055_DATE)
            return build()
                + "\n" + "   AND (    (    documentData.t_payerKindAccount = 'П'"
                + "\n" + "             AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + "         OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB), "documentData.t_creditBalance") + "))";
        else
            return build()
                + "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_payerAccount")  + ")"
                + "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_receiverAccount") + ")"
                + "\n" + "   AND (    (    documentData.t_payerKindAccount = 'П'"
                + "\n" + "             AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + "         OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB), "documentData.t_creditBalance") + "))";
        end;
    end;

    initTDocumentQueryBuilder("3.1");
end;
/***************************************************************************************************
 *  Источники данных
 **************************************************************************************************/
private class (TDataSource) TDataSourceCbAccounts()

    private class TAccountTempTableInserter()
        var m_accountTableName  = "drepaccount_vw";
        var m_documentTableName = "drepdocumentwithcorrection_vw";

        private macro makeCommandText()
            var beginDate = parameters.getBeginDate();
            var endDate   = parameters.getEndDate();
            var year      = 0;

            dateSplit(endDate, null, null, year);
            beginDate = Date(01, 01, year);

            /*Необходимо для инициализации вьюхи drepdocumentwithcorrection_vw*/
            sql_execute("CALL rep_data.setBeginDate(" + getSqlDate(beginDate) + ")");
            sql_execute("CALL rep_data.setEndDate("   + getSqlDate(endDate)   + ")");
            sql_execute("CALL rep_data.initCorrectDocumentParameters(1,"+ getSqlDate(beginDate) + ","+ getSqlDate(endDate) +")");

            var commandText =
                         "INSERT INTO df251acc_tmp(t_number,"
                + "\n" + "                         t_balance,"
                + "\n" + "                         t_fiid,"
                + "\n" + "                         t_clientCode,"
                + "\n" + "                         t_sum,"
                + "\n" + "                         t_roublesum,"
                + "\n" + "                         t_hasBankPartyKind,"
                + "\n" + "                         t_clientLegalForm,"
                + "\n" + "                         t_isClientEmployer,"
                + "\n" + "                         t_hasCreditDocumentNot202,"
                + "\n" + "                         t_hasConnection,"
                + "\n" + "                         t_hasInternetConnection)"
                + "\n" + "    WITH category AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM dobjatcor_dbt objatcor"
                + "\n" + "                       WHERE objatcor.t_objecttype = 4"
                + "\n" + "                         AND objatcor.t_groupid = 14"
                + "\n" + "                         AND rep_data.getEndDate() BETWEEN t_validfromdate AND t_validtodate)"
                + "\n" + "    SELECT account.t_account t_number,"
                + "\n" + "           account.t_balance,"
                + "\n" + "           account.t_fiid,"
                + "\n" + "           account.t_partyid t_clientCode,"
                + "\n" + "           account.t_outrest t_sum,"
                + "\n" + "           account.t_outcoverrest t_roublesum,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM dpartyown_dbt partyown"
                + "\n" + "                            WHERE partyown.t_partyId = account.t_partyid"
                + "\n" + "                              AND partyown.t_partykind = " + RCB_PTK_BANK + ")"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasBankPartyKind,"
                + "\n" + "           NVL((SELECT party.t_legalForm"
                + "\n" + "                  FROM dparty_dbt party"
                + "\n" + "                 WHERE party.t_partyId = account.t_partyId), -1) t_legalForm,"
                + "\n" + "           NVL((SELECT DECODE(persn.t_isEmployer, CHR(0), 0, 1)"
                + "\n" + "                  FROM dpersn_dbt persn"
                + "\n" + "                 WHERE persn.t_personId = account.t_partyId), 0) t_isEmployer,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM " + m_documentTableName +" repdocument"
                + "\n" + "                            WHERE repdocument.t_chapter = account.t_chapter"
                + "\n" + "                              AND repdocument.t_debetfiid = account.t_fiid"
                + "\n" + "                              AND repdocument.t_debetaccount = account.t_account"
                + "\n" + "                              AND repdocument.t_creditaccount NOT LIKE '202%'"
                + "\n" + "                              AND repdocument.t_creditaccount NOT LIKE 'ОВП%'"
                + "\n" + "                              AND repdocument.t_date BETWEEN rep_data.getBeginDate() AND rep_data.getEndDate()"
                + "\n" + "                              AND repdocument.t_chapter = 1"
                + "\n" + "                              AND repdocument.t_isRevaluation = 0"
                + "\n" + "                              AND repdocument.t_incoversum <> 0)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasCreditDocumentNot202,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM category"
                + "\n" + "                            WHERE category.t_object = account.t_objectid)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasConnection,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM category"
                + "\n" + "                            WHERE category.t_attrID = " + RCB_OBJATTR_CONNECTION_INTERNET
                + "\n" + "                              AND category.t_object = account.t_objectid)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasInternetConnection"
                + "\n" + "      FROM " + m_accountTableName + " account"
                + "\n" + "     WHERE account.t_chapter = 1"
                + "\n" + "       AND INSTR(account.t_type, 'Щ') = 0"
                + "\n" + "       AND account.t_isOpened = 1"
                + "\n" + "       AND ( account.t_closeDate >= " + getSqlDate(RcbApplication().currentReport.context.period.endDate)
                + "\n" + "            OR account.t_closeDate = " + getSqlDate(Date(0,0,0)) +")"
                + "\n" + "       AND ("     + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.1", BOCB), "account.t_balance")
                + "\n" + "             OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.3", BOCB), "account.t_balance") + ")";

            return commandText;
        end;

        macro insert()
            SQL_truncate("df251acc_tmp");
            SQL_execute(makeCommandText());
        end;
    end;

    class (TAccountQueryBuilder_1_1) TAccountQueryBuilder_1_1_1(line : String)
        defaultParm(line, "1.1.1");

        initTAccountQueryBuilder_1_1(line);

        macro build()
            return build()
                + "\n" + "   AND (accountData.t_hasCreditDocumentNot202 = 1)";
        end;
    end;

    class (TAccountQueryBuilder_1_1_1) TAccountQueryBuilder_1_1_1_1(line : String)
        defaultParm(line, "1.1.1.1");

        initTAccountQueryBuilder_1_1_1(line);

        macro build()
            return build()
                + "\n" + "   AND (   accountData.t_hasRemoteConnection      = 1"
                + "\n" + "        OR accountData.t_hasInternetConnection    = 1"
                + "\n" + "        OR accountData.t_hasMobilePhoneConnection = 1"
                + "\n" + "       )";
        end;
    end;

    class (TAccountQueryBuilder_1_1_1_1) TAccountQueryBuilder_1_1_1_1_1(line : String)
        defaultParm(line, "1.1.1.1.1");

        initTAccountQueryBuilder_1_1_1_1(line);

        macro build()
            return build()
                + "\n" + "   AND (accountData.t_hasInternetConnection = 1)";
        end;
    end;

    class (TAccountQueryBuilder) TAccountQueryBuilder_1_1_Error(line : String)
        defaultParm(line, "1.1");

        initTAccountQueryBuilder(line, ERROR_KIND_WRONG_ACCOUNT_KIND);

        macro build()
            return build()
                + "\n" + "   AND " + TAccountQueryBuilder_1_1().getAccountFilter(mkStr(" ", 11))
                + "\n" + "   AND NOT EXISTS(SELECT 1"
                + "\n" + "                    FROM df251_tmp"
                + "\n" + "                   WHERE t_account = accountData.t_number"
                + "\n" + "                     AND t_fiid    = accountData.t_fiid"
                + "\n" + "                     AND t_line LIKE '1.1%')";
        end;
    end;

    class (TAccountQueryBuilder) TAccountQueryBuilder_1_3(line : String)
        defaultParm(line, "1.3");

        initTAccountQueryBuilder(line);

        macro build()
            return build()
                + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance") + ")";
        end;
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(accountTempTableInserter)
            accountTempTableInserter.insert();

            sql_execute(insertClause + TAccountQueryBuilder_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_3().build());

            sql_execute(insertClause + TAccountQueryBuilder_1_1_Error().build());
        end;

        fill(TAccountTempTableInserter());
    end;

    initTDataSource(BOCB);
end;

private class (TDataSource) TDataSourceCbAccounts2742()

    private class TAccountTempTableInserter()
        var m_accountTableName  = "drepaccount_vw";
        var m_documentTableName = "drepdocumentwithcorrection_vw";

        private macro makeCommandText()
            var beginDate = parameters.getBeginDate();
            var endDate   = parameters.getEndDate();
            var year      = 0;

            dateSplit(endDate, null, null, year);
            beginDate = Date(01, 01, year);

            /*Необходимо для инициализации вьюхи drepdocumentwithcorrection_vw*/
            sql_execute("CALL rep_data.setBeginDate(" + getSqlDate(beginDate) + ")");
            sql_execute("CALL rep_data.setEndDate("   + getSqlDate(endDate)   + ")");
            sql_execute("CALL rep_data.initCorrectDocumentParameters(1,"+ getSqlDate(beginDate) + ","+ getSqlDate(endDate) +")");


            var commandText =
                         "INSERT INTO df251acc_tmp(t_number,"
                + "\n" + "                         t_balance,"
                + "\n" + "                         t_fiid,"
                + "\n" + "                         t_clientCode,"
                + "\n" + "                         t_sum,"
                + "\n" + "                         t_roublesum,"
                + "\n" + "                         t_hasBankPartyKind,"
                + "\n" + "                         t_clientLegalForm,"
                + "\n" + "                         t_isClientEmployer,"
                + "\n" + "                         t_hasCreditDocumentNot202,"
                + "\n" + "                         t_hasConnection,"
                + "\n" + "                         t_hasInternetConnection,"
                + "\n" + "                         t_hasMobilePhoneConnection)"
                + "\n" + "    WITH category AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM dobjatcor_dbt objatcor"
                + "\n" + "                       WHERE objatcor.t_objecttype = 4"
                + "\n" + "                         AND objatcor.t_groupid = 14"
                + "\n" + "                         AND rep_data.getEndDate() BETWEEN t_validfromdate AND t_validtodate)"
                + "\n" + "    SELECT account.t_account t_number,"
                + "\n" + "           account.t_balance,"
                + "\n" + "           account.t_fiid,"
                + "\n" + "           account.t_partyid t_clientCode,"
                + "\n" + "           account.t_outrest t_sum,"
                + "\n" + "           account.t_outcoverrest t_roublesum,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM dpartyown_dbt partyown"
                + "\n" + "                            WHERE partyown.t_partyId = account.t_partyid"
                + "\n" + "                              AND partyown.t_partykind = " + RCB_PTK_BANK + ")"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasBankPartyKind,"
                + "\n" + "           NVL((SELECT party.t_legalForm"
                + "\n" + "                  FROM dparty_dbt party"
                + "\n" + "                 WHERE party.t_partyId = account.t_partyId), -1) t_legalForm,"
                + "\n" + "           NVL((SELECT DECODE(persn.t_isEmployer, CHR(0), 0, 1)"
                + "\n" + "                  FROM dpersn_dbt persn"
                + "\n" + "                 WHERE persn.t_personId = account.t_partyId), 0) t_isEmployer,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM " + m_documentTableName +" repdocument"
                + "\n" + "                            WHERE repdocument.t_chapter = account.t_chapter"
                + "\n" + "                              AND repdocument.t_debetfiid = account.t_fiid"
                + "\n" + "                              AND repdocument.t_debetaccount = account.t_account"
                + "\n" + "                              AND repdocument.t_creditaccount NOT LIKE '202%'"
                + "\n" + "                              AND repdocument.t_creditaccount NOT LIKE 'ОВП%'"
                + "\n" + "                              AND repdocument.t_date BETWEEN rep_data.getBeginDate() AND rep_data.getEndDate()"
                + "\n" + "                              AND repdocument.t_chapter = 1"
                + "\n" + "                              AND repdocument.t_isRevaluation = 0"
                + "\n" + "                              AND repdocument.t_incoversum <> 0)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasCreditDocumentNot202,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM category"
                + "\n" + "                            WHERE category.t_object = account.t_objectid)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasConnection,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM category"
                + "\n" + "                            WHERE category.t_attrID = " + RCB_OBJATTR_CONNECTION_INTERNET
                + "\n" + "                              AND category.t_object = account.t_objectid)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasInternetConnection,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM category"
                + "\n" + "                            WHERE category.t_attrID = " + RCB_OBJATTR_CONNECTION_MOBILEPHONE
                + "\n" + "                              AND category.t_object = account.t_objectid)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasMobilePhoneConnection"
                + "\n" + "      FROM " + m_accountTableName + " account"
                + "\n" + "     WHERE account.t_chapter = 1"
                + "\n" + "       AND INSTR(account.t_type, 'Щ') = 0"
                + "\n" + "       AND (   (account.t_fiId = " + NATCUR + ")"
                + "\n" + "            OR (INSTR(account.t_type, 'Y') = 0))"
                + "\n" + "       AND account.t_isOpened = 1"
                + "\n" + "       AND ( account.t_closeDate >= " + getSqlDate(RcbApplication().currentReport.context.period.endDate)
                + "\n" + "             OR account.t_closeDate = " + getSqlDate(Date(0,0,0)) + ")"
                + "\n" + "       AND NOT EXISTS(SELECT 1"
                + "\n" + "                        FROM df251_tmp tmp251"
                + "\n" + "                       WHERE tmp251.t_bo = 3"
                + "\n" + "                         AND tmp251.t_accountCredit = account.t_account)"
                + "\n" + "       AND ("     + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.1", BOCB), "account.t_balance")
                + "\n" + "             OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.2", BOCB), "account.t_balance")
                + "\n" + "             OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.3", BOCB), "account.t_balance") + ")";

            return commandText;
        end;

        macro insert()
            SQL_truncate("df251acc_tmp");
            SQL_execute(makeCommandText());
        end;
    end;

    class (TAccountQueryBuilder_1_1_2742) TAccountQueryBuilder_1_1_1(line : String)
        defaultParm(line, "1.1.1");

        initTAccountQueryBuilder_1_1_2742(line);

        macro build()
            return build()
                + "\n" + "   AND (accountData.t_hasCreditDocumentNot202 = 1)";
        end;
    end;

    class (TAccountQueryBuilder_1_1_1) TAccountQueryBuilder_1_1_1_1(line : String)
        defaultParm(line, "1.1.1.1");

        initTAccountQueryBuilder_1_1_1(line);

        macro build()
            return build()
                + "\n" + "   AND (accountData.t_hasConnection = 1)";
        end;
    end;

    class (TAccountQueryBuilder_1_1_1_1) TAccountQueryBuilder_1_1_1_1_1(line : String)
        defaultParm(line, "1.1.1.1.1");

        initTAccountQueryBuilder_1_1_1_1(line);

        macro build()
            return build()
                + "\n" + "   AND (accountData.t_hasInternetConnection = 1)";
        end;
    end;

    class (TAccountQueryBuilder_1_2) TAccountQueryBuilder_1_2_1(line : String)
        defaultParm(line, "1.2.1");

        initTAccountQueryBuilder_1_2(line);
    end;

    class (TAccountQueryBuilder_1_2) TAccountQueryBuilder_1_2_2(line : String)
        defaultParm(line, "1.2.2");

        initTAccountQueryBuilder_1_2(line);

        macro build()
            return build()
                + "\n" + "   AND (accountData.t_hasCreditDocumentNot202 = 1)"
                + "\n" + "   AND EXISTS (SELECT 1"
                + "\n" + "                 FROM df251doc_tmp trn"
                + "\n" + "                WHERE accountData.t_number = trn.t_payeraccount"
                + "\n" + "                   OR accountData.t_number = trn.t_receiveraccount"
                + "\n" + "              )";
        end;
    end;

    class (TAccountQueryBuilder_1_2_1) TAccountQueryBuilder_1_2_2_1(line : String)
        defaultParm(line, "1.2.2.1");

        initTAccountQueryBuilder_1_2_1(line);

        macro build()
            return build()
                + "\n" + "   AND (   accountData.t_hasRemoteConnection      = 1"
                + "\n" + "        OR accountData.t_hasInternetConnection    = 1"
                + "\n" + "        OR accountData.t_hasMobilePhoneConnection = 1"
                + "\n" + "       )"
                + "\n" + "   AND (accountData.t_hasCreditDocumentNot202 = 1)"
                + "\n" + "   AND EXISTS (SELECT 1"
                + "\n" + "                 FROM df251doc_tmp trn"
                + "\n" + "                WHERE accountData.t_number = trn.t_payeraccount"
                + "\n" + "                   OR accountData.t_number = trn.t_receiveraccount"
                + "\n" + "              )";
        end;
    end;

    class (TAccountQueryBuilder_1_2_2_1) TAccountQueryBuilder_1_2_2_1_1(line : String)
        defaultParm(line, "1.2.2.1.1");

        initTAccountQueryBuilder_1_2_2_1(line);

        macro build()
            return build()
                + "\n" + "   AND (accountData.t_hasInternetConnection = 1)"
                + "\n" + "   AND (accountData.t_hasCreditDocumentNot202 = 1)";
        end;
    end;

    class (TAccountQueryBuilder_1_2_2_1) TAccountQueryBuilder_1_2_2_1_2(line : String)
        defaultParm(line, "1.2.2.1.2");

        initTAccountQueryBuilder_1_2_2_1(line);

        macro build()
            return build()
                + "\n" + "   AND (accountData.t_hasMobilePhoneConnection = 1)"
                + "\n" + "   AND (accountData.t_hasCreditDocumentNot202 = 1)";
        end;
    end;


    class (TAccountQueryBuilder) TAccountQueryBuilder_1_1_Error(line : String)
        defaultParm(line, "1.1");

        initTAccountQueryBuilder(line, ERROR_KIND_WRONG_ACCOUNT_KIND);

        macro build()
            return build()
                + "\n" + "   AND " + TAccountQueryBuilder_1_1().getAccountFilter(mkStr(" ", 11))
                + "\n" + "   AND NOT EXISTS(SELECT 1"
                + "\n" + "                    FROM df251_tmp"
                + "\n" + "                   WHERE t_account = accountData.t_number"
                + "\n" + "                     AND t_fiid    = accountData.t_fiid"
                + "\n" + "                     AND t_line LIKE '1.1%')";
        end;
    end;

    class (TAccountQueryBuilder) TAccountQueryBuilder_1_3(line : String)
        defaultParm(line, "1.3");

        initTAccountQueryBuilder(line);

        macro build()
            return build()
                + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "accountData.t_balance") + ")";
        end;
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(accountTempTableInserter)
            accountTempTableInserter.insert();

            sql_execute(insertClause + TAccountQueryBuilder_1_1_2742().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1_2().build());

            sql_execute(insertClause + TAccountQueryBuilder_1_3().build());

            sql_execute(insertClause + TAccountQueryBuilder_1_1_Error().build());
        end;

        fill(TAccountTempTableInserter());
    end;

    initTDataSource(BOCB);
end;

private class (TDataSourceCbAccounts2742) TDataSourceCbAccounts2926()

    class (TAccountQueryBuilder_1_1_2742Dop) TAccountQueryBuilder_1_1_2_2926(line : String)
        defaultParm(line, "1.1.2");

        initTAccountQueryBuilder(line);

        macro getAccountFilter(offset : String)
            return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.1", BOCB), "accountData.t_balance") + ")";
        end;

        macro build()
            return build()
                + "\n" + "AND (EXISTS (SELECT 1                                      "
                + "\n" + "               FROM dRepParty_vw party                     "
                + "\n" + "              WHERE party.t_id = accountData.t_clientCode  "
                + "\n" + "                AND party.t_isPaymentAgent = 1))           ";
        end;
    end;

    class (TAccountQueryBuilder_1_1_2742Dop) TAccountQueryBuilder_1_1_3_2926(line : String)
        defaultParm(line, "1.1.3");

        initTAccountQueryBuilder(line);

        macro getAccountFilter(offset : String)
            return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.1", BOCB), "accountData.t_balance") + ")";
        end;

        macro build()
            return build()
                + "\n" + "AND (EXISTS (SELECT 1                                          "
                + "\n" + "               FROM dRepParty_vw party                         "
                + "\n" + "              WHERE party.t_id = accountData.t_clientCode      "
                + "\n" + "                AND (party.t_isBankPaymentAgent = 1            "
                + "\n" + "                     OR party.t_isBankPaymentSubagent = 1) ))  ";
        end;
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(accountTempTableInserter)
            accountTempTableInserter.insert();

            sql_execute(insertClause + TAccountQueryBuilder_1_1_2742Dop().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_2_2926().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_3_2926().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1_2().build());

            sql_execute(insertClause + TAccountQueryBuilder_1_3().build());

            sql_execute(insertClause + TAccountQueryBuilder_1_1_Error().build());
        end;

        fill(TAccountTempTableInserter());
    end;

    initTDataSourceCbAccounts2742(BOCB);
end;

private class (TDataSourceCbAccounts2926) TDataSourceCbAccounts3875()
    private class TAccountTempTableInserter3875()
        var m_accountTableName  = "drepaccount_vw";
        var m_documentTableName = "drepdocumentwithcorrection_vw";

        private macro makeCommandText()
            var beginDate = parameters.getBeginDate();
            var endDate   = parameters.getEndDate();
            var year      = 0;

            dateSplit(endDate, null, null, year);
            beginDate = Date(01, 01, year);

            /*Необходимо для инициализации вьюхи drepdocumentwithcorrection_vw*/
            sql_execute("CALL rep_data.setBeginDate(" + getSqlDate(beginDate) + ")");
            sql_execute("CALL rep_data.setEndDate("   + getSqlDate(endDate)   + ")");
            sql_execute("CALL rep_data.initCorrectDocumentParameters(1,"+ getSqlDate(beginDate) + ","+ getSqlDate(endDate) +")");

            var commandText =
                         "INSERT INTO df251acc_tmp(t_number,"
                + "\n" + "                         t_balance,"
                + "\n" + "                         t_fiid,"
                + "\n" + "                         t_clientCode,"
                + "\n" + "                         t_sum,"
                + "\n" + "                         t_roublesum,"
                + "\n" + "                         t_hasBankPartyKind,"
                + "\n" + "                         t_clientLegalForm,"
                + "\n" + "                         t_isClientEmployer,"
                + "\n" + "                         t_hasCreditDocumentNot202,"
                + "\n" + "                         t_hasConnection,"
                + "\n" + "                         t_hasInternetConnection,"
                + "\n" + "                         t_hasMobilePhoneConnection,"
                + "\n" + "                         t_hasRemoteConnection)"
                + "\n" + "    WITH category AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM dRepCategory_vw objatcor"
                + "\n" + "                       WHERE objatcor.t_objectType   = " + OBJTYPE_ACCOUNT
                + "\n" + "                         AND objatcor.t_id           = " + RCB_OBJGROUP_CONNECTION
                + "\n" + "                         AND t_isInstalledOverPeriod = 1)"
                + "\n" + "    SELECT account.t_account t_number,"
                + "\n" + "           account.t_balance,"
                + "\n" + "           account.t_fiid,"
                + "\n" + "           account.t_partyid t_clientCode,"
                + "\n" + "           account.t_outrest t_sum,"
                + "\n" + "           account.t_outcoverrest t_roublesum,"
                + "\n" + "           (SELECT party.t_isBank"
                + "\n" + "              FROM dRepParty_vw party"
                + "\n" + "             WHERE party.t_id = account.t_partyId) t_hasBankPartyKind,"
                + "\n" + "           (SELECT CASE"
                + "\n" + "                       WHEN party.t_isPhisical = 0"
                + "\n" + "                            THEN  1"
                + "\n" + "                       WHEN party.t_isPhisical = 1"
                + "\n" + "                            THEN  2"
                + "\n" + "                       ELSE -1"
                + "\n" + "                   END"
                + "\n" + "              FROM dRepParty_vw party"
                + "\n" + "             WHERE party.t_id = account.t_partyId) t_legalForm,"
                + "\n" + "           (SELECT party.t_isEmployer"
                + "\n" + "              FROM dRepParty_vw party"
                + "\n" + "             WHERE party.t_id = account.t_partyId) t_isEmployer,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM " + m_documentTableName +" repdocument"
                + "\n" + "                            WHERE repdocument.t_chapter = account.t_chapter"
                + "\n" + "                              AND repdocument.t_debetfiid = account.t_fiid"
                + "\n" + "                              AND repdocument.t_debetaccount = account.t_account"
                + "\n" + "                              AND repdocument.t_creditaccount NOT LIKE '202%'"
                + "\n" + "                              AND repdocument.t_creditaccount NOT LIKE 'ОВП%'"
                + "\n" + "                              AND repdocument.t_date BETWEEN rep_data.getBeginDate() AND rep_data.getEndDate()"
                + "\n" + "                              AND repdocument.t_chapter = 1"
                + "\n" + "                              AND repdocument.t_isRevaluation = 0"
                + "\n" + "                              AND repdocument.t_incoversum <> 0)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasCreditDocumentNot202,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM category"
                + "\n" + "                            WHERE category.t_objectId = account.t_objectid)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasConnection,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM category"
                + "\n" + "                            WHERE category.t_value    = 'И'"
                + "\n" + "                              AND category.t_objectId = account.t_objectid)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasInternetConnection,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM category"
                + "\n" + "                            WHERE category.t_value    = 'МТ'"
                + "\n" + "                              AND category.t_objectId = account.t_objectid)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasMobilePhoneConnection,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS(SELECT 1"
                + "\n" + "                             FROM category"
                + "\n" + "                            WHERE category.t_value    = 'Д'"
                + "\n" + "                              AND category.t_objectId = account.t_objectid)"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_hasRemoteConnection"
                + "\n" + "      FROM " + m_accountTableName + " account"
                + "\n" + "     WHERE account.t_chapter = 1"
                + "\n" + "       AND INSTR(account.t_type, 'Щ') = 0"
                + "\n" + "       AND (   (account.t_fiId = " + NATCUR + ")"
                + "\n" + "            OR (INSTR(account.t_type, 'Y') = 0))"
                + "\n" + "       AND account.t_isOpened = 1"
                + "\n" + "       AND (   account.t_closeDate >= " + getSqlDate(RcbApplication().currentReport.context.period.endDate)
                + "\n" + "            OR account.t_closeDate  = " + getSqlDate(Date(0,0,0)) + ")"
                + "\n" + "       AND NOT EXISTS(SELECT 1"
                + "\n" + "                        FROM df251_tmp tmp251"
                + "\n" + "                       WHERE tmp251.t_bo            = 3"
                + "\n" + "                         AND tmp251.t_accountCredit = account.t_account)"
                + "\n" + "       AND ("     + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.1", BOCB), "account.t_balance")
                + "\n" + "             OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.2", BOCB), "account.t_balance")
                + "\n" + "             OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.3", BOCB), "account.t_balance") + ")";

            return commandText;
        end;

        macro insert()
            SQL_truncate("df251acc_tmp");
            SQL_execute(makeCommandText());
        end;
    end;

    class (TAccountQueryBuilder_1_1_3875) TAccountQueryBuilder_1_1_1_3875(line : String)
        defaultParm(line, "1.1.1");

        initTAccountQueryBuilder_1_1_3875(line);

        macro build()
            return build()
            + "\n" + "   AND (accountData.t_hasCreditDocumentNot202 = 1)";
        end;
    end;

    class (TAccountQueryBuilder_1_1_1_3875) TAccountQueryBuilder_1_1_1_1_3875(line : String)
        defaultParm(line, "1.1.1.1");

        initTAccountQueryBuilder_1_1_1_3875(line);

        macro build()
            return build()
            + "\n" + "   AND (accountData.t_hasConnection = 1)";
        end;
    end;

    class (TAccountQueryBuilder_1_1_1_1_3875) TAccountQueryBuilder_1_1_1_1_1_3875(line : String)
        defaultParm(line, "1.1.1.1.1");

        initTAccountQueryBuilder_1_1_1_1_3875(line);

        macro build()
            return build()
            + "\n" + "   AND (accountData.t_hasInternetConnection = 1)";
        end;
    end;

    class (TAccountQueryBuilder_1_2_3875) TAccountQueryBuilder_1_2_1_3875(line : String)
        defaultParm(line, "1.2.1");

        initTAccountQueryBuilder_1_2_3875(line);

        macro build()
            return build()
            + "\n" + "   AND CASE"
            + "\n" + "           WHEN accountData.t_balance IN ('40806', '40809', '40812', '40814', '40815', '40823', '40824')"
            + "\n" + "               THEN CASE"
            + "\n" + "                        WHEN accountData.t_clientLegalForm = " + RCB_NATURAL_PERSON
            + "\n" + "                             THEN 1"
            + "\n" + "                        ELSE 0"
            + "\n" + "                    END"
            + "\n" + "           ELSE 1"
            + "\n" + "       END = 1"
            + "\n" + "   AND (accountData.t_hasRemoteConnection = 1)";
        end;
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(accountTempTableInserter)
            accountTempTableInserter.insert();

            sql_execute(insertClause + TAccountQueryBuilder_1_1_3875Dop().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_3875().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1_3875().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1_1_3875().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_2_2926().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_3_2926().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_1_3875().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1_2().build());

            sql_execute(insertClause + TAccountQueryBuilder_1_3().build());

            sql_execute(insertClause + TAccountQueryBuilder_1_1_Error().build());
        end;

        fill(TAccountTempTableInserter3875());
    end;

    initTDataSourceCbAccounts2926(BOCB);
end;

private class (TDataSourceCbAccounts3875) TDataSourceCbAccounts4212()
    class (TAccountQueryBuilder_1_1_4212) TAccountQueryBuilder_1_1_1_4212(line : String)
        defaultParm(line, "1.1.1");

        initTAccountQueryBuilder_1_1_4212(line);

        macro build()
            return build()
            + "\n" + "   AND (accountData.t_hasCreditDocumentNot202 = 1)"
            + "\n" + "   AND EXISTS (SELECT 1"
            + "\n" + "                 FROM df251doc_tmp trn"
            + "\n" + "                WHERE accountData.t_number = trn.t_payeraccount"
            + "\n" + "                   OR accountData.t_number = trn.t_receiveraccount"
            + "\n" + "              )";
        end;
    end;

    class (TAccountQueryBuilder_1_1_1_4212) TAccountQueryBuilder_1_1_1_1_4212(line : String)
        defaultParm(line, "1.1.1.1");

        initTAccountQueryBuilder_1_1_1_4212(line);

        macro build()
            return build()
                + "\n" + "   AND (   accountData.t_hasRemoteConnection      = 1"
                + "\n" + "        OR accountData.t_hasInternetConnection    = 1"
                + "\n" + "        OR accountData.t_hasMobilePhoneConnection = 1"
                + "\n" + "       )";
        end;
    end;

    class (TAccountQueryBuilder_1_1_1_1_4212) TAccountQueryBuilder_1_1_1_1_1_4212(line : String)
        defaultParm(line, "1.1.1.1.1");

        initTAccountQueryBuilder_1_1_1_1_4212(line);

        macro build()
            return build()
            + "\n" + "   AND (accountData.t_hasInternetConnection = 1)";
        end;
    end;

    class (TAccountQueryBuilder_1_1_4212Dop_for_1_1_23) TAccountQueryBuilder_1_1_2_4212(line : String)
        defaultParm(line, "1.1.2");

        initTAccountQueryBuilder(line);

        macro getAccountFilter(offset : String)
            return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.1", BOCB), "accountData.t_balance") + ")";
        end;

        macro build()
            return build()
                + "\n" + "AND (EXISTS (SELECT 1                                      "
                + "\n" + "               FROM dRepParty_vw party                     "
                + "\n" + "              WHERE party.t_id = accountData.t_clientCode  "
                + "\n" + "                AND party.t_isPaymentAgent = 1))           ";
        end;
    end;

    class (TAccountQueryBuilder_1_1_4212Dop_for_1_1_23) TAccountQueryBuilder_1_1_3_4212(line : String)
        defaultParm(line, "1.1.3");

        initTAccountQueryBuilder(line);

        macro getAccountFilter(offset : String)
            return "(" + convertMaskToSqlFormat(tuneTable.getMaskForLine("1.1", BOCB), "accountData.t_balance") + ")";
        end;

        macro build()
            return build()
                + "\n" + "AND (EXISTS (SELECT 1                                          "
                + "\n" + "               FROM dRepParty_vw party                         "
                + "\n" + "              WHERE party.t_id = accountData.t_clientCode      "
                + "\n" + "                AND (party.t_isBankPaymentAgent = 1            "
                + "\n" + "                     OR party.t_isBankPaymentSubagent = 1) ))  ";
        end;
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(accountTempTableInserter)
            accountTempTableInserter.insert();

            sql_execute(insertClause + TAccountQueryBuilder_1_1_4212Dop().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_4212().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1_4212().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_1_1_1_4212().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_2_4212().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_1_3_4212().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_1_3875().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1_1().build());
            sql_execute(insertClause + TAccountQueryBuilder_1_2_2_1_2().build());

            sql_execute(insertClause + TAccountQueryBuilder_1_3().build());

            sql_execute(insertClause + TAccountQueryBuilder_1_1_Error().build());
        end;

        fill(TAccountTempTableInserter3875());
    end;

    initTDataSourceCbAccounts3875(BOCB);
end;

private class (TDataSource) TDataSourceCbDocuments()

    private class TDocumentTempTableInserter()
        var m_payerAccountTableName    = "drepaccount_vw";
        var m_receiverAccountTableName = "drepaccount_vw";
        var m_paymentOrderTableName    = "dpspayord_dbt";
        var m_documentTableName        = "drepdocumentwithcorrection_vw";

        private macro makeCommandText()
            var beginDate = parameters.getBeginDate();
            var endDate   = parameters.getEndDate();

            /*Необходимо для инициализации вьюхи drepdocumentwithcorrection_vw*/
            sql_execute("CALL rep_data.setBeginDate(" + getSqlDate(beginDate) + ")");
            sql_execute("CALL rep_data.setEndDate("   + getSqlDate(endDate)   + ")");
            sql_execute("CALL rep_data.initCorrectDocumentParameters(1,"+ getSqlDate(beginDate) + ","+ getSqlDate(endDate) +")");

            var commandText =
                         " INSERT INTO df251doc_tmp(t_autoKey,"
                + "\n" + "                         t_fiid,"
                + "\n" + "                         t_payerAccount,"
                + "\n" + "                         t_receiverAccount,"
                + "\n" + "                         t_clientCode,"
                + "\n" + "                         t_payerAccountDepartment,"
                + "\n" + "                         t_receiverAccountDepartment,"
                + "\n" + "                         t_number,"
                + "\n" + "                         t_referenceNumber,"
                + "\n" + "                         t_referenceNumberPd,"
                + "\n" + "                         t_carryDate,"
                + "\n" + "                         t_sum,"
                + "\n" + "                         t_roublesum,"
                + "\n" + "                         t_balance,"
                + "\n" + "                         t_debetBalance,"
                + "\n" + "                         t_creditBalance,"
                + "\n" + "                         t_isInternetOrigin,"
                + "\n" + "                         t_sendingMode,"
                + "\n" + "                         t_clientLegalForm,"
                + "\n" + "                         t_isClientEmployer,"
                + "\n" + "                         t_payerObjectId,"
                + "\n" + "                         t_receiverObjectId,"
                + "\n" + "                         t_payerOpuSymbol,"
                + "\n" + "                         t_receiverOpuSymbol,"
                + "\n" + "                         t_isDifferentClients,"
                + "\n" + "                         t_payerKindAccount,"
                + "\n" + "                         t_paymentId)"
                + "\n" + "    WITH pspayord AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM " + m_paymentOrderTableName
                + "\n" + "                       WHERE (t_docKind = " + PS_PAYORDER + " OR t_docKind = " + PS_CPORDER + ")"
                + "\n" + "                         AND t_origin = " + INTERNET_ORIGIN + "),"
                + "\n" + "    payerAccount  AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM " + m_payerAccountTableName
                + "\n" + "                       WHERE t_chapter = 1"
                + "\n" + "                         AND  ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB),      "t_account")
                + "\n" + "                               OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB),      "t_account")
                + "\n" + "                               OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.3", BOCB),      "t_account")  + ")"
                + "\n" + "                         AND INSTR(t_type, 'Щ') = 0),"
                + "\n" + "    receiverAccount  AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM " + m_receiverAccountTableName
                + "\n" + "                       WHERE t_chapter = 1"
                + "\n" + "                         AND NOT (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("000", BOCB), "t_account") + ")"
                + "\n" + "                         AND INSTR(t_type, 'Щ') = 0)"
                + "\n" + "    SELECT document.t_id t_autoKey,"
                + "\n" + "           document.t_debetfiid t_fiid,"
                + "\n" + "           document.t_debetaccount t_payerAccount,"
                + "\n" + "           document.t_creditaccount t_receiverAccount,"
                + "\n" + "           payerAccount.t_partyId t_clientCode,"
                + "\n" + "           payerAccount.t_departmentId t_payerAccountDepartment,"
                + "\n" + "           '' t_receiverAccountDepartment,"
                + "\n" + "           document.t_number t_number,"
                + "\n" + "           TRIM(document.t_shifr_oper) t_referenceNumber,"
                + "\n" + "           TRIM(payment.t_partpaymshifrmain) t_referenceNumberPd,"
                + "\n" + "           document.t_date t_carryDate,"
                + "\n" + "           document.t_debetsum t_sum,"
                + "\n" + "           document.t_incoversum t_incoversum,"
                + "\n" + "           payerAccount.t_balance t_balance,"
                + "\n" + "           payerAccount.t_balance t_debetBalance,"
                + "\n" + "           receiverAccount.t_balance t_creditBalance,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS (SELECT 1"
                + "\n" + "                              FROM pspayord"
                + "\n" + "                             WHERE payment.t_paymentId IS NOT NULL"
                + "\n" + "                               AND pspayord.t_orderId = payment.t_documentId"
                + "\n" + "                           )"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "            END t_isInternetOrigin," // 14.11.2008 ABP очень мне сомнительно, что нужно ПД привлекать к этому вопросу,
                                                               //                в принципе, достаточно того, что есть в платеже.
                                                               //                но аналитики этот алгоритм признали в корне неверным
                                                               //                а потому ждем исправления в ТЗ (SCR 134264)
                + "\n" + "           NVL((SELECT paymentRmodelProperty.t_paymentKind"
                + "\n" + "                  FROM dpmrmprop_dbt paymentRmodelProperty"
                + "\n" + "                 WHERE paymentRmodelProperty.t_paymentId = document.t_paymentId) , CHR(1)) t_sendingMode,"
                + "\n" + "           NVL((SELECT party.t_legalForm"
                + "\n" + "                  FROM dparty_dbt party"
                + "\n" + "                 WHERE party.t_partyId = payerAccount.t_partyId), -1) t_clientLegalForm,"
                + "\n" + "           NVL((SELECT DECODE(persn.t_isEmployer, CHR(0), 0, 1)"
                + "\n" + "                  FROM dpersn_dbt persn"
                + "\n" + "                 WHERE persn.t_personId = payerAccount.t_partyId), 0) t_isClientEmployer,"
                + "\n" + "           payerAccount.t_objectId,"
                + "\n" + "           receiverAccount.t_objectId,"
                + "\n" + "           payerAccount.t_OpuSymbol,"
                + "\n" + "           receiverAccount.t_OpuSymbol,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN payerAccount.t_partyId <> receiverAccount.t_partyId"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_isDifferentClients,"
                + "\n" + "           payerAccount.t_kind t_payerKindAccount,"
                + "\n" + "           '' t_paymentId"
                + "\n" + "      FROM " + m_documentTableName + " document,"
                + "\n" + "           payerAccount,"
                + "\n" + "           receiverAccount,"
                + "\n" + "           dpmpaym_dbt payment"
                + "\n" + "     WHERE document.t_chapter = 1"
                + "\n" + "       AND document.t_isRevaluation = 0"
                + "\n" + "       AND document.t_date BETWEEN " + getSqlDate(beginDate)
                + "\n" + "                               AND " + getSqlDate(endDate)
                + "\n" + "       AND NOT (   (" + convertMaskToSqlFormat("30110*,30114*", "document.t_debetaccount") + ")"
                + "\n" + "               AND (" + convertMaskToSqlFormat("30110*,30114*", "document.t_creditaccount") + ")"
                + "\n" + "               )"
                + "\n" + "       AND receiverAccount.t_account = document.t_creditaccount"
                + "\n" + "       AND receiverAccount.t_fiid = document.t_creditfiid"
                + "\n" + "       AND receiverAccount.t_chapter = document.t_chapter"
                + "\n" + "       AND payerAccount.t_account = document.t_debetaccount"
                + "\n" + "       AND payerAccount.t_fiid = document.t_debetfiid"
                + "\n" + "       AND payerAccount.t_chapter = document.t_chapter"
                + "\n" + "       AND payment.t_paymentId(+) = document.t_paymentId"
                + "\n" + "       AND NOT (    payment.t_paymentId IS NOT NULL"
                + "\n" + "                AND payment.t_payer = payment.t_receiver"
                + "\n" + "                AND NOT EXISTS(SELECT 1"
                + "\n" + "                                 FROM drepourbank_tmp ourBank"
                + "\n" + "                                WHERE payerAccount.t_partyId = ourBank.t_partyId"
                + "\n" + "                                  AND receiverAccount.t_partyId = ourBank.t_partyId"
                + "\n" + "                              )"
                + "\n" + "               )";
                //производим отсев счетов по дебету, все указанные ниже строки покрывают все
                //необходимые для отбора счета
                //+ "\n" + "       AND  ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1"),      "document.t_debetaccount")
                //+ "\n" + "             OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2"),      "document.t_debetaccount")
                //+ "\n" + "             OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.3"),      "document.t_debetaccount")  + ")";


            return commandText;
        end;

        macro insert()
            SQL_truncate("df251doc_tmp");
            SQL_execute(makeCommandText());
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_Error()
        initTDocumentQueryBuilder("2", ERROR_KIND_WRONG_DOCUMENT_REFERENCE, true);

        macro build()
            return build()
                + "\n" + "   AND (    " + TDocumentQueryBuilder_2_1_1().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_1_2().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_1_3().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_1_4().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_1_5().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_2_1().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_2_2().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_2_3().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_2_4().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_2_5().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_3_1().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_3_2().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_3_3().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_3_4().getDocumentFilter(mkStr(" ", 12))
                + "\n" + "         OR " + TDocumentQueryBuilder_2_3_5().getDocumentFilter(mkStr(" ", 12)) + ")"
                + "\n" + "   AND NOT EXISTS(SELECT 1"
                + "\n" + "                    FROM df251_tmp"
                + "\n" + "                   WHERE t_autokey = documentData.t_autokey"
                + "\n" + "                     AND t_fiid    = documentData.t_fiid"
                + "\n" + "                     AND (    t_line LIKE '2.1%'"
                + "\n" + "                           OR t_line LIKE '2.2%'"
                + "\n" + "                           OR t_line LIKE '2.3%'))";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_1_Error()
        initTDocumentQueryBuilder("3.1", ERROR_KIND_WRONG_DOCUMENT_CLIENT, true);

        macro build()
            return build()
                + "\n" + "   AND " + TDocumentQueryBuilder_3_1().getDocumentFilter()
                + "\n" + "   AND NOT EXISTS(SELECT 1"
                + "\n" + "                    FROM df251_tmp"
                + "\n" + "                   WHERE t_autokey = documentData.t_autokey"
                + "\n" + "                     AND t_fiid    = documentData.t_fiid"
                + "\n" + "                     AND t_line    = '3.1')";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_1_1()
        private macro getCorrectCondition(offset : String)
            return getCorrectCondition(offset)
                + "\n" + offset + "AND (NOT EXISTS(SELECT 1"
                + "\n" + offset + "                  FROM drepourbank_tmp"
                + "\n" + offset + "                 WHERE t_partyId = documentData.t_clientCode))"
        end;

        macro build()
            return build()
                       + ternary(parameters.getEndDate() < RCB_I2055_DATE, "",
                  "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_payerAccount")  + ")"
                + "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_receiverAccount") + ")"
                                )
                + "\n" + "   AND (     (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1.1", BOCB), "documentData.t_creditBalance") + "))";
        end;

        initTDocumentQueryBuilder("3.1.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_1_2()
        private macro getCorrectCondition(offset : String)
            return getCorrectCondition(offset)
                + "\n" + offset + "AND (NOT EXISTS(SELECT 1"
                + "\n" + offset + "                  FROM drepourbank_tmp"
                + "\n" + offset + "                 WHERE t_partyId = documentData.t_clientCode))"
        end;

        macro build()
            return build()
                       + ternary(parameters.getEndDate() < RCB_I2055_DATE, "",
                  "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_payerAccount")  + ")"
                + "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_receiverAccount") + ")"
                                )
                + "\n" + "   AND (documentData.t_sendingMode = " + getSqlString(parameters.getSendingMode()) + ")"
                + "\n" + "   AND (    (    documentData.t_payerKindAccount = 'П'"
                + "\n" + "             AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1.2", BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + "         OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1.2", BOCB), "documentData.t_creditBalance") + "))";
        end;

        initTDocumentQueryBuilder("3.1.2");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_2()
        macro build()
            return build()
                       + ternary(parameters.getEndDate() < RCB_I2055_DATE, "",
                  "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_payerAccount")  + ")"
                + "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_receiverAccount") + ")"
                                )
                + "\n" + "   AND (     (    (" + convertMaskToSqlFormat("!30301*", "documentData.t_debetBalance") + ")"
                + "\n" + "               OR (" + convertMaskToSqlFormat("!30302*", "documentData.t_creditBalance") + "))"
                + "\n" + "         AND (    (" + convertMaskToSqlFormat("!30302*", "documentData.t_debetBalance") + ")"
                + "\n" + "               OR (" + convertMaskToSqlFormat("!30301*", "documentData.t_creditBalance") + "))"
                + "\n" + "         AND (    (" + convertMaskToSqlFormat("!30303*", "documentData.t_debetBalance") + ")"
                + "\n" + "               OR (" + convertMaskToSqlFormat("!30304*", "documentData.t_creditBalance") + "))"
                + "\n" + "         AND (    (" + convertMaskToSqlFormat("!30304*", "documentData.t_debetBalance") + ")"
                + "\n" + "               OR (" + convertMaskToSqlFormat("!30303*", "documentData.t_creditBalance") + ")))"
                + "\n" + "   AND ((SELECT corschem.t_corAccount"
                + "\n" + "           FROM dcorschem_dbt corschem"
                + "\n" + "          WHERE corschem.t_account    = documentData.t_payerAccount"
                + "\n" + "            AND corschem.t_fiid       = documentData.t_fiid"
                + "\n" + "            AND corschem.t_department = documentData.t_payerAccountDepartment) <> documentData.t_receiverAccount)"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "documentData.t_creditBalance") + "))";
        end;

        initTDocumentQueryBuilder("3.2");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_2_1()
        macro build()
            return build()
                       + ternary(parameters.getEndDate() < RCB_I2055_DATE, "",
                  "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_payerAccount")  + ")"
                + "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_receiverAccount") + ")"
                                )
                + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2.1", BOCB), "documentData.t_debetBalance")  + ")"
                + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2.1", BOCB), "documentData.t_creditBalance") + ")";
        end;

        initTDocumentQueryBuilder("3.2.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_2_2()
        macro build()
            return build()
                       + ternary(parameters.getEndDate() < RCB_I2055_DATE, "",
                  "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_payerAccount")  + ")"
                + "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_receiverAccount") + ")"
                                )
                + "\n" + "   AND (documentData.t_sendingMode = " + getSqlString(parameters.getSendingMode()) + ")"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2.2", BOCB), "documentData.t_debetBalance")  + ")"
                + "\n" + "         OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2.2", BOCB), "documentData.t_creditBalance") + "))";
        end;

        initTDocumentQueryBuilder("3.2.2");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_3(line : String)
        defaultParm(line, "3.3");

        initTDocumentQueryBuilder(line);

        macro build()
            if (parameters.getEndDate() < RCB_I2055_DATE)
                return build()
                    + "\n" + "   AND documentData.t_isDifferentClients = 1"
                    + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.3", BOCB), "documentData.t_debetBalance")  + ")"
                    + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.3", BOCB), "documentData.t_creditBalance") + ")";
            else
                return build()
                    + "\n" + "   AND (   (    NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_payerAccount")  + ")"
                    + "\n" + "            AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_receiverAccount") + ")"
                    + "\n" + "            AND documentData.t_isDifferentClients = 1"
                    + "\n" + "            AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.3", BOCB), "documentData.t_debetBalance")  + ")"
                    + "\n" + "            AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.3", BOCB), "documentData.t_creditBalance") + ")"
                    + "\n" + "            AND (   documentData.t_referenceNumber IN ('01','02','06','07','08')"
                    + "\n" + "                 OR (documentData.t_referenceNumber = '16'"
                    + "\n" + "                     AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                    + "\n" + "                    )"
                    + "\n" + "                )"
                    + "\n" + "           )"
                    + "\n" + "       )"
                    + "\n" + " UNION ALL"
                    + "\n" + "SELECT t_bo,"
                    + "\n" + "       '3.3' t_line,"
                    + "\n" + "       t_column,"
                    + "\n" + "       t_account,"
                    + "\n" + "       t_accountCredit,"
                    + "\n" + "       t_clientCode,"
                    + "\n" + "       t_numbDocument,"
                    + "\n" + "       t_shifrDocument,"
                    + "\n" + "       t_dateCarry,"
                    + "\n" + "       t_fiid,"
                    + "\n" + "       t_sumRub,"
                    + "\n" + "       t_sumCurrency,"
                    + "\n" + "       t_kindA,"
                    + "\n" + "       '3',"
                    + "\n" + "       t_docCount,"
                    + "\n" + "       t_errorKind,"
                    + "\n" + "       t_isInternetOrigin,"
                    + "\n" + "       t_autoKey"
                    + "\n" + "  FROM df251_tmp documentData"
                    + "\n" + " WHERE t_line = '2.5'";
            end;
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_3_1(line : String)
        defaultParm(line, "3.3.1");

        initTDocumentQueryBuilder(line);

        macro build()
            return build()
                       + ternary(parameters.getEndDate() < RCB_I2055_DATE, "",
                  "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_payerAccount")  + ")"
                + "\n" + "   AND NOT (" + convertMaskToSqlFormat("30102*", "documentData.t_receiverAccount") + ")"
                                )
                + "\n" + "   AND (    (    (documentData.t_isInternetOrigin = 1)"
                + "\n" + "             AND documentData.t_isDifferentClients = 1"
                + "\n" + "             AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.3.1", BOCB), "documentData.t_debetBalance")  + ")"
                + "\n" + "             AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.3.1", BOCB), "documentData.t_creditBalance") + "))"
                + "\n" + "         OR (documentData.t_sendingMode = " + getSqlString(parameters.getSendingMode()) + "))";
        end;
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(documentTempTableInserter)
            documentTempTableInserter.insert();

            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_1().build());

            sql_execute(insertClause + TDocumentQueryBuilder_2_Error().build());
        end;

        fill(TDocumentTempTableInserter());
    end;

    initTDataSource(BOCB);
end;

private class (TDataSourceCbDocuments) TDataSourceCbDocuments_2332()
    initTDataSourceCbDocuments();

    private class TDocumentTempTableInserter_2332()
        var m_payerAccountTableName    = "drepaccount_vw";
        var m_receiverAccountTableName = "drepaccount_vw";
        var m_paymentOrderTableName    = "dpspayord_dbt";
        var m_documentTableName        = "drepdocumentwithcorrection_vw";

        private macro makeCommandText()
            var beginDate = parameters.getBeginDate();
            var endDate   = parameters.getEndDate();

            /*Необходимо для инициализации вьюхи drepdocumentwithcorrection_vw*/
            sql_execute("CALL rep_data.setBeginDate(" + getSqlDate(beginDate) + ")");
            sql_execute("CALL rep_data.setEndDate("   + getSqlDate(endDate)   + ")");
            sql_execute("CALL rep_data.initCorrectDocumentParameters(1,"+ getSqlDate(beginDate) + ","+ getSqlDate(endDate) +")");

            var commandText =
                         " INSERT INTO df251doc_tmp(t_autoKey,"
                + "\n" + "                         t_fiid,"
                + "\n" + "                         t_payerAccount,"
                + "\n" + "                         t_receiverAccount,"
                + "\n" + "                         t_clientCode,"
                + "\n" + "                         t_payerAccountDepartment,"
                + "\n" + "                         t_receiverAccountDepartment,"
                + "\n" + "                         t_number,"
                + "\n" + "                         t_referenceNumber,"
                + "\n" + "                         t_referenceNumberPd,"
                + "\n" + "                         t_carryDate,"
                + "\n" + "                         t_sum,"
                + "\n" + "                         t_roublesum,"
                + "\n" + "                         t_balance,"
                + "\n" + "                         t_debetBalance,"
                + "\n" + "                         t_creditBalance,"
                + "\n" + "                         t_isInternetOrigin,"
                + "\n" + "                         t_sendingMode,"
                + "\n" + "                         t_clientLegalForm,"
                + "\n" + "                         t_isClientEmployer,"
                + "\n" + "                         t_payerObjectId,"
                + "\n" + "                         t_receiverObjectId,"
                + "\n" + "                         t_payerOpuSymbol,"
                + "\n" + "                         t_receiverOpuSymbol,"
                + "\n" + "                         t_isDifferentClients,"
                + "\n" + "                         t_payerKindAccount,"
                + "\n" + "                         t_paymentId)"
                + "\n" + "    WITH pspayord AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM " + m_paymentOrderTableName
                + "\n" + "                       WHERE (t_docKind = " + PS_PAYORDER + " OR t_docKind = " + PS_CPORDER + ")"
                + "\n" + "                         AND t_origin = " + INTERNET_ORIGIN + ")"
                + "\n" + "    SELECT document.t_id t_autoKey,"
                + "\n" + "           document.t_debetfiid t_fiid,"
                + "\n" + "           document.t_debetaccount t_payerAccount,"
                + "\n" + "           document.t_creditaccount t_receiverAccount,"
                + "\n" + "           payerAccount.t_partyId t_clientCode,"
                + "\n" + "           payerAccount.t_departmentId t_payerAccountDepartment,"
                + "\n" + "           receiverAccount.t_departmentId t_receiverAccountDepartment,"
                + "\n" + "           document.t_number t_number,"
                + "\n" + "           TRIM(document.t_shifr_oper) t_referenceNumber,"
                + "\n" + "           TRIM(payment.t_partpaymshifrmain) t_referenceNumberPd,"
                + "\n" + "           document.t_date t_carryDate,"
                + "\n" + "           document.t_debetsum t_sum,"
                + "\n" + "           document.t_incoversum t_incoversum,"
                + "\n" + "           payerAccount.t_balance t_balance,"
                + "\n" + "           payerAccount.t_balance t_debetBalance,"
                + "\n" + "           receiverAccount.t_balance t_creditBalance,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS (SELECT 1"
                + "\n" + "                              FROM pspayord"
                + "\n" + "                             WHERE payment.t_paymentId IS NOT NULL"
                + "\n" + "                               AND pspayord.t_orderId = payment.t_documentId"
                + "\n" + "                           )"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "            END t_isInternetOrigin," // 14.11.2008 ABP очень мне сомнительно, что нужно ПД привлекать к этому вопросу,
                                                               //                в принципе, достаточно того, что есть в платеже.
                                                               //                но аналитики этот алгоритм признали в корне неверным
                                                               //                а потому ждем исправления в ТЗ (SCR 134264)
                + "\n" + "           NVL((SELECT paymentRmodelProperty.t_paymentKind"
                + "\n" + "                  FROM dpmrmprop_dbt paymentRmodelProperty"
                + "\n" + "                 WHERE paymentRmodelProperty.t_paymentId = document.t_paymentId) , CHR(1)) t_sendingMode,"
                + "\n" + "           NVL((SELECT party.t_legalForm"
                + "\n" + "                  FROM dparty_dbt party"
                + "\n" + "                 WHERE party.t_partyId = payerAccount.t_partyId), -1) t_clientLegalForm,"
                + "\n" + "           NVL((SELECT DECODE(persn.t_isEmployer, CHR(0), 0, 1)"
                + "\n" + "                  FROM dpersn_dbt persn"
                + "\n" + "                 WHERE persn.t_personId = payerAccount.t_partyId), 0) t_isClientEmployer,"
                + "\n" + "           payerAccount.t_objectId,"
                + "\n" + "           receiverAccount.t_objectId,"
                + "\n" + "           payerAccount.t_OpuSymbol,"
                + "\n" + "           receiverAccount.t_OpuSymbol,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN payerAccount.t_partyId <> receiverAccount.t_partyId"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_isDifferentClients,"
                + "\n" + "           payerAccount.t_kind t_payerKindAccount,"
                + "\n" + "           document.t_paymentId"
                + "\n" + "      FROM " + m_documentTableName + " document,"
                + "\n" + "           " + m_payerAccountTableName     + " payerAccount,"
                + "\n" + "           " + m_receiverAccountTableName  + " receiverAccount,"
                + "\n" + "           dpmpaym_dbt payment"
                + "\n" + "     WHERE document.t_chapter = 1"
                + "\n" + "       AND document.t_isRevaluation = 0"
                + "\n" + "       AND document.t_date BETWEEN " + getSqlDate(beginDate)
                + "\n" + "                               AND " + getSqlDate(endDate)
                + "\n" + "       AND NOT (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("000", BOCB), "document.t_debetaccount")  + ")"
                + "\n" + "       AND NOT (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("000", BOCB), "document.t_creditaccount") + ")"
                + "\n" + "       AND NOT (   (" + convertMaskToSqlFormat("30110*,30114*", "document.t_debetaccount") + ")"
                + "\n" + "               AND (" + convertMaskToSqlFormat("30110*,30114*", "document.t_creditaccount") + ")"
                + "\n" + "               )"
                + "\n" + "       AND payerAccount.t_chapter = 1"
                + "\n" + "       AND receiverAccount.t_chapter = 1"
                + "\n" + "       AND receiverAccount.t_account = document.t_creditaccount"
                + "\n" + "       AND receiverAccount.t_fiid = document.t_creditfiid"
                + "\n" + "       AND receiverAccount.t_chapter = document.t_chapter"
                + "\n" + "       AND payerAccount.t_account = document.t_debetaccount"
                + "\n" + "       AND payerAccount.t_fiid = document.t_debetfiid"
                + "\n" + "       AND payerAccount.t_chapter = document.t_chapter"
                + "\n" + "       AND INSTR(payerAccount.t_type, 'Щ') = 0"
                + "\n" + "       AND INSTR(receiverAccount.t_type, 'Щ') = 0"
                + "\n" + "       AND payment.t_paymentId(+) = document.t_paymentId"
                + "\n" + "       AND NOT (    payerAccount.t_partyId = receiverAccount.t_partyId"
                + "\n" + "                AND NOT EXISTS(SELECT 1"
                + "\n" + "                                 FROM drepourbank_tmp ourBank"
                + "\n" + "                                WHERE payerAccount.t_partyId = ourBank.t_partyId"
                + "\n" + "                              )"
                + "\n" + "               )"
                + "\n" + "       AND NOT (     (    ((document.t_debetaccount LIKE ' 30301%') AND (document.t_creditaccount LIKE ' 30302%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30302%') AND (document.t_creditaccount LIKE ' 30301%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30303%') AND (document.t_creditaccount LIKE ' 30304%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30304%') AND (document.t_creditaccount LIKE ' 30303%'))"
                + "\n" + "                     )"
                + "\n" + "                AND  (payerAccount.t_contrAgentId = receiverAccount.t_contrAgentId))";


            return commandText;
        end;

        macro insert()
            SQL_truncate("df251doc_tmp");
            SQL_execute(makeCommandText());
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_3_2332(line : String)
        defaultParm(line, "2.3");

        initTDocumentQueryBuilder(line);

        macro getDocumentFilter(offset : String)
            var balanceMasks = tuneTable.getMaskForLine("2.1.1", BOCB) + "," + tuneTable.getMaskForLine("2.2.1", BOCB) + "," + tuneTable.getMaskForLine("3.1", BOCB)+ "," + tuneTable.getMaskForLine("3.2", BOCB) + "," + tuneTable.getMaskForLine("3.4", BOCB);

            return       "       EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "        AND (" + convertMaskToSqlFormat(balanceMasks, "documentData.t_creditBalance") + "))";
        end;


        macro build()
            return build()
                + "\n" + "  AND " + getDocumentFilter("");
        end;
    end;

    class (TDocumentQueryBuilder_2_3_2332) TDocumentQueryBuilder_2_3_1_2332(line : String)
        defaultParm(line, "2.3.1");

        initTDocumentQueryBuilder_2_3_2332(line);

        macro build()
            return build()
                    + "\n" + "   AND (   documentData.t_referenceNumber = '01'"
                    + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                    + "\n" + "            AND documentData.t_referenceNumberPd = '01'"
                    + "\n" + "           )"
                    + "\n" + "       )";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_3_2_2332(line : String)
        defaultParm(line, "2.3.2");

        initTDocumentQueryBuilder(line);

        macro getDocumentFilter(offset : String)
            var balanceMasks = tuneTable.getMaskForLine("2.1.1", BOCB) + "," + tuneTable.getMaskForLine("2.2.1", BOCB) + "," +
                               tuneTable.getMaskForLine("3.1", BOCB) + "," + tuneTable.getMaskForLine("3.2", BOCB) + "," + tuneTable.getMaskForLine("3.4", BOCB);

            return       "       EXISTS(SELECT 1"
                + "\n" + "                FROM drepourbank_tmp"
                + "\n" + "               WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "        AND (" + convertMaskToSqlFormat(balanceMasks, "documentData.t_creditBalance") + "))";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7))
                    + "\n" + "   AND (documentData.t_referenceNumber = '08')";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_3_2_1_2332(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.3.2.1");
        defaultParm(debetBalanceMaskLine, "2.3.2");

        var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder(line, ERROR_KIND_NONE, true);

        macro getDocumentFilter(offset : String)
            var balanceMasks = tuneTable.getMaskForLine("2.1.1", BOCB) + "," + tuneTable.getMaskForLine("2.2.1", BOCB) + "," +
                               tuneTable.getMaskForLine("3.1", BOCB) + "," + tuneTable.getMaskForLine("3.2", BOCB) + "," + tuneTable.getMaskForLine("3.4", BOCB);

            return       "       EXISTS(SELECT 1"
                + "\n" + "                FROM drepourbank_tmp"
                + "\n" + "               WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "        AND (" + convertMaskToSqlFormat(balanceMasks, "documentData.t_creditBalance") + "))"
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7))
                    + "\n" + "   AND (documentData.t_referenceNumber = '08')";
        end;
    end;

    class (TDocumentQueryBuilder_2_3_2332) TDocumentQueryBuilder_2_3_3_2332(line : String)
        defaultParm(line, "2.3.3");

        initTDocumentQueryBuilder_2_3_2332(line);

        macro build()
                return build()
                    + "\n" + "   AND (   documentData.t_referenceNumber = '02'"
                    + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                    + "\n" + "            AND documentData.t_referenceNumberPd = '02'"
                    + "\n" + "           )"
                    + "\n" + "       )";
        end;
    end;

    class (TDocumentQueryBuilder_2_3_2332) TDocumentQueryBuilder_2_3_4_2332(line : String)
        defaultParm(line, "2.3.4");

        initTDocumentQueryBuilder_2_3_2332(line);

        macro build()
            return build()
                    + "\n" + "   AND (   documentData.t_referenceNumber = '06'"
                    + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                    + "\n" + "            AND documentData.t_referenceNumberPd = '06'"
                    + "\n" + "           )"
                    + "\n" + "       )";
        end;
    end;

    class (TDocumentQueryBuilder_2_3_2332) TDocumentQueryBuilder_2_3_5_2332(line : String)
        defaultParm(line, "2.3.5");

        initTDocumentQueryBuilder_2_3_2332(line);

        macro build()
            return build()
                    + "\n" + "   AND (   documentData.t_referenceNumber = '07'"
                    + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                    + "\n" + "            AND documentData.t_referenceNumberPd = '07'"
                    + "\n" + "           )"
                    + "\n" + "       )";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_5_2332(line : String)
        defaultParm(line, "2.5");

        initTDocumentQueryBuilder(line);

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '09'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '09'"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + "    AND (   ((" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5уплач", BOCB), "documentData.t_debetBalance")  + ")"
                + "\n" + "              AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5клиент", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "              AND ( NOT (" + convertMaskToSqlFormat("706*", "documentData.t_debetBalance")  + ")"
                + "\n" + "                     OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.5уплач", BOCB), "documentData.t_payerOpuSymbol") + ")))"
                + "\n" + "         OR ((" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5получ", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "              AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5клиент", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "              AND ( NOT (" + convertMaskToSqlFormat("706*", "documentData.t_creditBalance")  + ")"
                + "\n" + "                     OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.5получ", BOCB), "documentData.t_receiverOpuSymbol") + "))))"


        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_1_2332()

        macro build()
            return build()
                + "\n" + "   AND (     (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.1", BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + "   AND (    documentData.t_referenceNumber IN ('01','02','06','07','08')"
                + "\n" + "         OR (    documentData.t_referenceNumber = '16'"
                + "\n" + "             AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                + "\n" + "            )"
                + "\n" + "       )"
                + "\n" + "   AND (  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "         OR (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "documentData.t_creditBalance")
                + "\n" + excludeRepaymentBill()
                + "\n" + "             AND (EXISTS(SELECT 1 FROM dpmpaym_dbt paymentTable"
                + "\n" + "                          WHERE documentData.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                            AND (EXISTS(SELECT 1 FROM df251doc_tmp doc "
                + "\n" + "                                         WHERE doc.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "doc.t_debetBalance") + ")"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB), "doc.t_creditBalance") + ")"
                + "\n" + "                                 ))"
                + "\n" + "                 ))"
                + "\n" + "            )"
                + "\n" + "       )";

        end;

        initTDocumentQueryBuilder("3.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_1_1_2332()

        macro build()
            return build()
                + "\n" + "   AND (     (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.1", BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + "   AND (    documentData.t_referenceNumber IN ('01','02','06','07','08')"
                + "\n" + "         OR (    documentData.t_referenceNumber = '16'"
                + "\n" + "             AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                + "\n" + "            )"
                + "\n" + "       )"
                + "\n" + "   AND (  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1.1", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "         OR (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + excludeRepaymentBill()
                + "\n" + "             AND (EXISTS(SELECT 1 FROM dpmpaym_dbt paymentTable"
                + "\n" + "                          WHERE documentData.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                            AND (EXISTS(SELECT 1 FROM df251doc_tmp doc "
                + "\n" + "                                         WHERE doc.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "doc.t_debetBalance") + ")"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1.1", BOCB), "doc.t_creditBalance") + ")"
                + "\n" + "                                 ))"
                + "\n" + "                 ))"
                + "\n" + "            )"
                + "\n" + "       )"
                + "\n" + "   AND INSTR(" + getSqlString(parameters.getSendingMode()) + ", documentData.t_sendingMode) != 0";
        end;

        initTDocumentQueryBuilder("3.1.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_2_2332()
        macro build()
            return build()
                + "\n" + "   AND (     (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.1", BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + "   AND (    documentData.t_referenceNumber IN ('01','02','06','07','08')"
                + "\n" + "         OR (    documentData.t_referenceNumber = '16'"
                + "\n" + "             AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                + "\n" + "            )"
                + "\n" + "       )"
                + "\n" + "   AND (  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "         OR (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + excludeRepaymentBill()
                + "\n" + "             AND (EXISTS(SELECT 1 FROM dpmpaym_dbt paymentTable"
                + "\n" + "                          WHERE documentData.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                            AND (EXISTS(SELECT 1 FROM df251doc_tmp doc "
                + "\n" + "                                         WHERE doc.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "doc.t_debetBalance") + ")"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "doc.t_creditBalance") + ")"
                + "\n" + "                                 ))"
                + "\n" + "                 ))"
                + "\n" + "            )"
                + "\n" + "       )"
        end;

        initTDocumentQueryBuilder("3.2");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_2_1_2332()
        macro build()
            return build()
                + "\n" + "   AND (     (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.1", BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + "   AND (    documentData.t_referenceNumber IN ('01','02','06','07','08')"
                + "\n" + "         OR (    documentData.t_referenceNumber = '16'"
                + "\n" + "             AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                + "\n" + "            )"
                + "\n" + "       )"
                + "\n" + "   AND (  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2.1", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "         OR (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + excludeRepaymentBill()
                + "\n" + "             AND (EXISTS(SELECT 1 FROM dpmpaym_dbt paymentTable"
                + "\n" + "                          WHERE documentData.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                            AND (EXISTS(SELECT 1 FROM df251doc_tmp doc "
                + "\n" + "                                         WHERE doc.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "doc.t_debetBalance") + ")"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2.1", BOCB), "doc.t_creditBalance") + ")"
                + "\n" + "                                 ))"
                + "\n" + "                 ))"
                + "\n" + "            )"
                + "\n" + "       )"
                + "\n" + "   AND INSTR(" + getSqlString(parameters.getSendingMode()) + ", documentData.t_sendingMode) != 0";
        end;

        initTDocumentQueryBuilder("3.2.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_3_2332()

        macro build()
            return build()
                + "\n" + "   AND ("
                + "\n" + "                ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance")
                + "\n" + "                 OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "            AND NOT ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB), "documentData.t_creditBalance")
                + "\n" + "                     OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "documentData.t_creditBalance")
                + "\n" + "                     OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.4", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "        OR"
                + "\n" + "                ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "            AND ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_creditBalance")
                + "\n" + "                 OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "       )"
                + "\n" + "   AND (   documentData.t_referenceNumber IN ('01','02','06','07','08')"
                + "\n" + "        OR (    documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + " UNION ALL"
                + "\n" + "SELECT t_bo,"
                + "\n" + "       '3.3' t_line,"
                + "\n" + "       t_column,"
                + "\n" + "       t_account,"
                + "\n" + "       t_accountCredit,"
                + "\n" + "       t_clientCode,"
                + "\n" + "       t_numbDocument,"
                + "\n" + "       t_shifrDocument,"
                + "\n" + "       t_dateCarry,"
                + "\n" + "       t_fiid,"
                + "\n" + "       t_sumRub,"
                + "\n" + "       t_sumCurrency,"
                + "\n" + "       t_kindA,"
                + "\n" + "       '3',"
                + "\n" + "       t_docCount,"
                + "\n" + "       t_errorKind,"
                + "\n" + "       t_isInternetOrigin,"
                + "\n" + "       t_autoKey"
                + "\n" + "  FROM df251_tmp documentData"
                + "\n" + " WHERE t_line = '2.5'";
        end;

        initTDocumentQueryBuilder("3.3");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_3_1_2332()
        macro build()
            return       "SELECT t_bo,"
                + "\n" + "       '3.3.1' t_line,"
                + "\n" + "       t_column,"
                + "\n" + "       t_account,"
                + "\n" + "       t_accountCredit,"
                + "\n" + "       t_clientCode,"
                + "\n" + "       t_numbDocument,"
                + "\n" + "       t_shifrDocument,"
                + "\n" + "       t_dateCarry,"
                + "\n" + "       t_fiid,"
                + "\n" + "       t_sumRub,"
                + "\n" + "       t_sumCurrency,"
                + "\n" + "       t_kindA,"
                + "\n" + "       '3',"
                + "\n" + "       t_docCount,"
                + "\n" + "       t_errorKind,"
                + "\n" + "       t_isInternetOrigin,"
                + "\n" + "       t_autoKey"
                + "\n" + "  FROM df251_tmp documentData"
                + "\n" + " WHERE t_line = '3.3'"
                + "\n" + "   AND ((documentData.t_isInternetOrigin = 1) OR (documentData.t_kindA = " + getSqlString(parameters.getSendingMode()) + "))";
        end;

        initTDocumentQueryBuilder("3.3.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_4_2332()
        macro build()
            return build()
                + "\n" + "   AND (     (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.1", BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + "   AND (    documentData.t_referenceNumber IN ('01','02','06','07','08')"
                + "\n" + "         OR (    documentData.t_referenceNumber = '16'"
                + "\n" + "             AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                + "\n" + "            )"
                + "\n" + "       )"
                + "\n" + "   AND (  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.4", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "         OR (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + excludeRepaymentBill()
                + "\n" + "             AND (EXISTS(SELECT 1 FROM dpmpaym_dbt paymentTable"
                + "\n" + "                          WHERE documentData.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                            AND (EXISTS(SELECT 1 FROM df251doc_tmp doc "
                + "\n" + "                                         WHERE doc.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "doc.t_debetBalance") + ")"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.4", BOCB), "doc.t_creditBalance") + ")"
                + "\n" + "                                 ))"
                + "\n" + "                 ))"
                + "\n" + "            )"
                + "\n" + "       )"
        end;

        initTDocumentQueryBuilder("3.4");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_4_1_2332()
        macro build()
            return build()
                + "\n" + "   AND (     (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "         OR  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.1", BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + "   AND (    documentData.t_referenceNumber IN ('01','02','06','07','08')"
                + "\n" + "         OR (    documentData.t_referenceNumber = '16'"
                + "\n" + "             AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                + "\n" + "            )"
                + "\n" + "       )"
                + "\n" + "   AND (  (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.4.1", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "         OR (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + excludeRepaymentBill()
                + "\n" + "             AND (EXISTS(SELECT 1 FROM dpmpaym_dbt paymentTable"
                + "\n" + "                          WHERE documentData.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                            AND (EXISTS(SELECT 1 FROM df251doc_tmp doc "
                + "\n" + "                                         WHERE doc.t_paymentId =  paymentTable.t_paymentId"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "doc.t_debetBalance") + ")"
                + "\n" + "                                           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.4.1", BOCB), "doc.t_creditBalance") + ")"
                + "\n" + "                                 ))"
                + "\n" + "                 ))"
                + "\n" + "            )"
                + "\n" + "       )"
                + "\n" + "   AND INSTR(" + getSqlString(parameters.getSendingMode()) + ", documentData.t_sendingMode) != 0";
        end;

        initTDocumentQueryBuilder("3.4.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_2332()
        macro build()
            return build()
                + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1", BOCB), "documentData.t_debetBalance") + ")";
        end;

        initTDocumentQueryBuilder("4.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_1_2332()
        initTDocumentQueryBuilder("4.1.1");

        m_query = "SELECT " + BOCB + " t_backOffice,"
                 + "\n" + "       " + getSqlString(m_line) + " t_line,"
                 + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
                 + "\n" + "       documentData.t_payerAccount t_account,"
                 + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
                 + "\n" + "       documentData.t_clientCode t_clientCode,"
                 + "\n" + "       documentData.t_number t_documentNumber,"
                 + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
                 + "\n" + "       documentData.t_carryDate t_carryDate,"
                 + "\n" + "       documentData.t_fiid t_fiid,"
                 + "\n" + "       documentData.t_roubleSum,"
                 + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
                 + "\n" + "       documentData.t_sendingMode t_sendingMode,"
                 + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
                 + "\n" + "       1 t_docCount,"
                 + "\n" + "       " + m_errorKind + " t_errorKind,"
                 + "\n" + "       documentData.t_isInternetOrigin,"
                 + "\n" + "       documentData.t_autoKey t_autoKey"
                 + "\n" + "  FROM df251doc_tmp documentData,"
                 + "\n" + "       (SELECT paymentTable.t_paymentId"
                 + "\n" + "          FROM dpmpaym_dbt paymentTable,"
                 + "\n" + "               dpmprop_dbt outCorshemLinkPaymentTable,"
                 + "\n" + "               dpmprop_dbt inCorshemLinkPaymentTable,"
                 + "\n" + "               dcorschem_dbt outCorshemTable,"
                 + "\n" + "               dcorschem_dbt inCorshemTable"
                 + "\n" + "         WHERE paymentTable.t_startDepartment = paymentTable.t_endDepartment"
                 + "\n" + "           AND (    paymentTable.t_paymentId = outCorshemLinkPaymentTable.t_paymentId"
                 + "\n" + "                AND outCorshemLinkPaymentTable.t_isSender <> 'X'"
                 + "\n" + "                AND outCorshemLinkPaymentTable.t_corschem <> -1)"
                 + "\n" + "           AND (    paymentTable.t_paymentId = inCorshemLinkPaymentTable.t_paymentId"
                 + "\n" + "                AND inCorshemLinkPaymentTable.t_isSender = 'X'"
                 + "\n" + "                AND inCorshemLinkPaymentTable.t_corschem <> -1)"
                 + "\n" + "           AND outCorshemLinkPaymentTable.t_transferDate BETWEEN " + getSqlDate(parameters.getBeginDate() - parameters.getDPP) + " AND " + getSqlDate(parameters.getEndDate() + parameters.getDPP)
                 + "\n" + "           AND (    outCorshemTable.t_number = outCorshemLinkPaymentTable.t_corschem"
                 + "\n" + "                AND outCorshemTable.t_fiid = outCorshemLinkPaymentTable.t_payFiid)"
                 + "\n" + "           AND (    inCorshemTable.t_number = inCorshemLinkPaymentTable.t_corschem"
                 + "\n" + "                AND inCorshemTable.t_fiid = inCorshemLinkPaymentTable.t_payFiid)"
                 + "\n" + "           AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "outCorshemTable.t_account")  + ")"
                 + "\n" + "           AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "inCorshemTable.t_account")  + ")"
                 + "\n" + "           AND outCorshemTable.t_corrId <> inCorshemTable.t_corrId) paymentIdTable"
                 + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0")
                 + "\n" + "   AND documentdata.t_paymentid = paymentidtable.t_paymentid (+)"
                 + "\n" + "   AND  (     (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "documentData.t_debetBalance")  + ")"
                 + "\n" + "          AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "documentData.t_creditBalance") + ")"
                 + "\n" + "           OR documentData.t_paymentId =  paymentIdTable.t_paymentId"
                 + "\n" + "        )";
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_2_2332()
        initTDocumentQueryBuilder("4.1.2");

        m_query = "SELECT " + BOCB + " t_backOffice,"
                 + "\n" + "       " + getSqlString(m_line) + " t_line,"
                 + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
                 + "\n" + "       documentData.t_payerAccount t_account,"
                 + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
                 + "\n" + "       documentData.t_clientCode t_clientCode,"
                 + "\n" + "       documentData.t_number t_documentNumber,"
                 + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
                 + "\n" + "       documentData.t_carryDate t_carryDate,"
                 + "\n" + "       documentData.t_fiid t_fiid,"
                 + "\n" + "       documentData.t_roubleSum,"
                 + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
                 + "\n" + "       documentData.t_sendingMode t_sendingMode,"
                 + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
                 + "\n" + "       1 t_docCount,"
                 + "\n" + "       " + m_errorKind + " t_errorKind,"
                 + "\n" + "       documentData.t_isInternetOrigin,"
                 + "\n" + "       documentData.t_autoKey t_autoKey"
                 + "\n" + "  FROM df251doc_tmp documentData,"
                 + "\n" + "       (SELECT paymentTable.t_paymentId"
                 + "\n" + "          FROM dpmpaym_dbt paymentTable,"
                 + "\n" + "               dpmprop_dbt outCorshemLinkPaymentTable,"
                 + "\n" + "               dpmprop_dbt inCorshemLinkPaymentTable,"
                 + "\n" + "               dcorschem_dbt outCorshemTable,"
                 + "\n" + "               dcorschem_dbt inCorshemTable"
                 + "\n" + "         WHERE paymentTable.t_startDepartment <> paymentTable.t_endDepartment"
                 + "\n" + "           AND (    paymentTable.t_paymentId = outCorshemLinkPaymentTable.t_paymentId"
                 + "\n" + "                AND outCorshemLinkPaymentTable.t_isSender <> 'X'"
                 + "\n" + "                AND outCorshemLinkPaymentTable.t_corschem <> -1)"
                 + "\n" + "           AND (    paymentTable.t_paymentId = inCorshemLinkPaymentTable.t_paymentId"
                 + "\n" + "                AND inCorshemLinkPaymentTable.t_isSender = 'X'"
                 + "\n" + "                AND inCorshemLinkPaymentTable.t_corschem <> -1)"
                 + "\n" + "           AND outCorshemLinkPaymentTable.t_transferDate BETWEEN " + getSqlDate(parameters.getBeginDate() - parameters.getDPP) + " AND " + getSqlDate(parameters.getEndDate() + parameters.getDPP)
                 + "\n" + "           AND (    outCorshemTable.t_number = outCorshemLinkPaymentTable.t_corschem"
                 + "\n" + "                AND outCorshemTable.t_fiid = outCorshemLinkPaymentTable.t_payFiid)"
                 + "\n" + "           AND (    inCorshemTable.t_number = inCorshemLinkPaymentTable.t_corschem"
                 + "\n" + "                AND inCorshemTable.t_fiid = inCorshemLinkPaymentTable.t_payFiid)"
                 + "\n" + "           AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.2", BOCB), "outCorshemTable.t_account")  + ")"
                 + "\n" + "           AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.2", BOCB), "inCorshemTable.t_account")  + ")"
                 + "\n" + "           AND outCorshemTable.t_corrId <> inCorshemTable.t_corrId) paymentIdTable"
                 + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0")
                 + "\n" + "   AND  documentData.t_paymentId =  paymentIdTable.t_paymentId";
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(documentTempTableInserter)
            documentTempTableInserter.insert();

            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_5_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_5_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2_2332().build());

            sql_execute(insertClause + TDocumentQueryBuilder_2_Error().build());
        end;

        fill(TDocumentTempTableInserter_2332());
    end;
end;

private class (TDataSourceCbDocuments_2332) TDataSourceCbDocuments_2470()
    initTDataSourceCbDocuments_2332();

    private class TDocumentTempTableInserter_2470()
        var m_payerAccountTableName    = "drepaccount_vw";
        var m_receiverAccountTableName = "drepaccount_vw";
        var m_paymentOrderTableName    = "dpspayord_dbt";
        var m_documentTableName        = "drepdocumentwithcorrection_vw";

        private macro makeCommandText()
            var beginDate = parameters.getBeginDate();
            var endDate   = parameters.getEndDate();

            /*Необходимо для инициализации вьюхи drepdocumentwithcorrection_vw*/
            sql_execute("CALL rep_data.setBeginDate(" + getSqlDate(beginDate) + ")");
            sql_execute("CALL rep_data.setEndDate("   + getSqlDate(endDate)   + ")");
            sql_execute("CALL rep_data.initCorrectDocumentParameters(1,"+ getSqlDate(beginDate) + ","+ getSqlDate(endDate) +")");

            var commandText =
                         "INSERT INTO df251doc_tmp(t_autoKey,"
                + "\n" + "                         t_fiid,"
                + "\n" + "                         t_payerAccount,"
                + "\n" + "                         t_receiverAccount,"
                + "\n" + "                         t_clientCode,"
                + "\n" + "                         t_payerAccountDepartment,"
                + "\n" + "                         t_receiverAccountDepartment,"
                + "\n" + "                         t_number,"
                + "\n" + "                         t_referenceNumber,"
                + "\n" + "                         t_referenceNumberPd,"
                + "\n" + "                         t_carryDate,"
                + "\n" + "                         t_sum,"
                + "\n" + "                         t_roublesum,"
                + "\n" + "                         t_balance,"
                + "\n" + "                         t_debetBalance,"
                + "\n" + "                         t_creditBalance,"
                + "\n" + "                         t_isInternetOrigin,"
                + "\n" + "                         t_sendingMode,"
                + "\n" + "                         t_clientLegalForm,"
                + "\n" + "                         t_isClientEmployer,"
                + "\n" + "                         t_payerObjectId,"
                + "\n" + "                         t_receiverObjectId,"
                + "\n" + "                         t_payerOpuSymbol,"
                + "\n" + "                         t_receiverOpuSymbol,"
                + "\n" + "                         t_isDifferentClients,"
                + "\n" + "                         t_payerKindAccount,"
                + "\n" + "                         t_paymentId)"
                + "\n" + "    WITH pspayord AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM " + m_paymentOrderTableName
                + "\n" + "                       WHERE (t_docKind = " + PS_PAYORDER + " OR t_docKind = " + PS_CPORDER + ")"
                + "\n" + "                         AND t_origin = " + INTERNET_ORIGIN + ")"
                + "\n" + "    SELECT document.t_id t_autoKey,"
                + "\n" + "           document.t_debetfiid t_fiid,"
                + "\n" + "           document.t_debetaccount t_payerAccount,"
                + "\n" + "           document.t_creditaccount t_receiverAccount,"
                + "\n" + "           payerAccount.t_partyId t_clientCode,"
                + "\n" + "           payerAccount.t_departmentId t_payerAccountDepartment,"
                + "\n" + "           receiverAccount.t_departmentId t_receiverAccountDepartment,"
                + "\n" + "           document.t_number t_number,"
                + "\n" + "           TRIM(document.t_shifr_oper) t_referenceNumber,"
                + "\n" + "           TRIM(payment.t_partpaymshifrmain) t_referenceNumberPd,"
                + "\n" + "           document.t_date t_carryDate,"
                + "\n" + "           document.t_debetsum t_sum,"
                + "\n" + "           document.t_incoversum t_incoversum,"
                + "\n" + "           payerAccount.t_balance t_balance,"
                + "\n" + "           payerAccount.t_balance t_debetBalance,"
                + "\n" + "           receiverAccount.t_balance t_creditBalance,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS (SELECT 1"
                + "\n" + "                              FROM pspayord"
                + "\n" + "                             WHERE payment.t_paymentId IS NOT NULL"
                + "\n" + "                               AND pspayord.t_orderId = payment.t_documentId"
                + "\n" + "                           )"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "            END t_isInternetOrigin," // 14.11.2008 ABP очень мне сомнительно, что нужно ПД привлекать к этому вопросу,
                                                               //                в принципе, достаточно того, что есть в платеже.
                                                               //                но аналитики этот алгоритм признали в корне неверным
                                                               //                а потому ждем исправления в ТЗ (SCR 134264)
                + "\n" + "           NVL((SELECT paymentRmodelProperty.t_paymentKind"
                + "\n" + "                  FROM dpmrmprop_dbt paymentRmodelProperty"
                + "\n" + "                 WHERE paymentRmodelProperty.t_paymentId = document.t_paymentId) , CHR(1)) t_sendingMode,"
                + "\n" + "           NVL((SELECT party.t_legalForm"
                + "\n" + "                  FROM dparty_dbt party"
                + "\n" + "                 WHERE party.t_partyId = payerAccount.t_partyId), -1) t_clientLegalForm,"
                + "\n" + "           NVL((SELECT DECODE(persn.t_isEmployer, CHR(0), 0, 1)"
                + "\n" + "                  FROM dpersn_dbt persn"
                + "\n" + "                 WHERE persn.t_personId = payerAccount.t_partyId), 0) t_isClientEmployer,"
                + "\n" + "           payerAccount.t_objectId,"
                + "\n" + "           receiverAccount.t_objectId,"
                + "\n" + "           payerAccount.t_OpuSymbol,"
                + "\n" + "           receiverAccount.t_OpuSymbol,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN payerAccount.t_partyId <> receiverAccount.t_partyId"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_isDifferentClients,"
                + "\n" + "           payerAccount.t_kind t_payerKindAccount,"
                + "\n" + "           document.t_paymentId"
                + "\n" + "      FROM " + m_documentTableName + " document,"
                + "\n" + "           " + m_payerAccountTableName     + " payerAccount,"
                + "\n" + "           " + m_receiverAccountTableName  + " receiverAccount,"
                + "\n" + "           dpmpaym_dbt payment"
                + "\n" + "     WHERE document.t_chapter = 1"
                + "\n" + "       AND document.t_isdeltarate = 0"
                + "\n" + "       AND document.t_date BETWEEN " + getSqlDate(beginDate)
                + "\n" + "                               AND " + getSqlDate(endDate)
                + "\n" + "       AND payerAccount.t_chapter = 1"
                + "\n" + "       AND receiverAccount.t_chapter = 1"
                + "\n" + "       AND receiverAccount.t_account = document.t_creditaccount"
                + "\n" + "       AND receiverAccount.t_fiid = document.t_creditfiid"
                + "\n" + "       AND receiverAccount.t_chapter = document.t_chapter"
                + "\n" + "       AND payerAccount.t_account = document.t_debetaccount"
                + "\n" + "       AND payerAccount.t_fiid = document.t_debetfiid"
                + "\n" + "       AND payerAccount.t_chapter = document.t_chapter"
                + "\n" + "       AND INSTR(payerAccount.t_type, 'Щ') = 0"
                + "\n" + "       AND INSTR(receiverAccount.t_type, 'Щ') = 0"
                + "\n" + "       AND payment.t_paymentId(+) = document.t_paymentId"
                + "\n" + "       AND (("
                + "\n" + "                 NOT (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("000", BOCB), "document.t_debetaccount")  + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("000", BOCB), "document.t_creditaccount") + ")"
                + "\n" + "             AND NOT (    (" + convertMaskToSqlFormat("30110*,30114*", "document.t_debetaccount")  + ")"
                + "\n" + "                      AND (" + convertMaskToSqlFormat("30110*,30114*", "document.t_creditaccount") + ")"
                + "\n" + "                     )"
                + "\n" + "             AND NOT (    payerAccount.t_partyId = receiverAccount.t_partyId"
                + "\n" + "                      AND NOT EXISTS(SELECT 1"
                + "\n" + "                                       FROM drepourbank_tmp ourBank"
                + "\n" + "                                      WHERE payerAccount.t_partyId = ourBank.t_partyId"
                + "\n" + "                                    )"
                + "\n" + "                     )"
                + "\n" + "             AND NOT ((    ((document.t_debetaccount LIKE ' 30301%') AND (document.t_creditaccount LIKE ' 30302%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30302%') AND (document.t_creditaccount LIKE ' 30301%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30303%') AND (document.t_creditaccount LIKE ' 30304%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30304%') AND (document.t_creditaccount LIKE ' 30303%'))"
                + "\n" + "                      )"
                + "\n" + "             AND  (payerAccount.t_contrAgentId = receiverAccount.t_contrAgentId))"
                + "\n" + "            )"
                + "\n" + "            OR "
                + "\n" + "            ("
                + "\n" + "                 NOT (" + convertMaskToSqlFormat("202*", "document.t_debetaccount")  + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat("202*", "document.t_creditaccount") + ")"
                + "\n" + "            )"
                + "\n" + "           )";

            return commandText;
        end;

        macro insert()
            SQL_truncate("df251doc_tmp");
            SQL_execute(makeCommandText());
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_5_2470(line : String)
        defaultParm(line, "2.5");

        initTDocumentQueryBuilder(line);

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "   ) ";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_5_1_2470(line : String)
        defaultParm(line, "2.5.1");

        initTDocumentQueryBuilder(line);

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + "    AND (   ((" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5.1уплач", BOCB), "documentData.t_debetBalance")  + ")"
                + "\n" + "              AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5.1клиент", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "              AND ( NOT (" + convertMaskToSqlFormat("706*", "documentData.t_debetBalance")  + ")"
                + "\n" + "                     OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.5.1уплач", BOCB), "documentData.t_payerOpuSymbol") + ")))"
                + "\n" + "         OR ((" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5.1получ", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "              AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.5.1клиент", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "              AND ( NOT (" + convertMaskToSqlFormat("706*", "documentData.t_creditBalance")  + ")"
                + "\n" + "                     OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.5.1получ", BOCB), "documentData.t_receiverOpuSymbol") + "))))"

        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_2470()
        macro build()
            return build()
                + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "   AND ( NOT " + hasAssignedCategory("documentData.t_payerObjectId", "'Счет не ДУ КО'") + ")";
        end;

        initTDocumentQueryBuilder("4.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_1_2470()
        initTDocumentQueryBuilder("4.1.1");

        m_query =    "SELECT " + BOCB + " t_backOffice,"
            + "\n" + "       " + getSqlString(m_line) + " t_line,"
            + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
            + "\n" + "       documentData.t_payerAccount t_account,"
            + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
            + "\n" + "       documentData.t_clientCode t_clientCode,"
            + "\n" + "       documentData.t_number t_documentNumber,"
            + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
            + "\n" + "       documentData.t_carryDate t_carryDate,"
            + "\n" + "       documentData.t_fiid t_fiid,"
            + "\n" + "       documentData.t_roubleSum,"
            + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
            + "\n" + "       documentData.t_sendingMode t_sendingMode,"
            + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
            + "\n" + "       1 t_docCount,"
            + "\n" + "       " + m_errorKind + " t_errorKind,"
            + "\n" + "       documentData.t_isInternetOrigin,"
            + "\n" + "       documentData.t_autoKey t_autoKey"
            + "\n" + "  FROM df251doc_tmp documentData LEFT JOIN"
            + "\n" + "       (SELECT paymentTable.t_paymentId, doc.t_clientCode"
            + "\n" + "          FROM dpmpaym_dbt paymentTable,"
            + "\n" + "               df251doc_tmp doc "
            + "\n" + "         WHERE doc.t_paymentId =  paymentTable.t_paymentId"
            + "\n" + "           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "doc.t_creditBalance") + ")"
            + "\n" + "           AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "doc.t_receiverObjectId") + ")"
            + "\n" + "           AND NOT EXISTS(SELECT 1 FROM df251doc_tmp doc "
            + "\n" + "                           WHERE doc.t_paymentId =  paymentTable.t_paymentId"
            + "\n" + "                             AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "doc.t_creditBalance") + "))"
            + "\n" + "           ) paymentIdTable"
            + "\n" + "        ON documentData.t_paymentId = paymentIdTable.t_paymentId"
            + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0")
            + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "documentData.t_debetBalance")  + ")"
            + "\n" + "   AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "documentData.t_payerObjectId") + ")"
            + "\n" + "   AND (   (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "documentData.t_creditBalance") + ")"
            + "\n" + "            AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "documentData.t_receiverObjectId") + ")"
            + "\n" + "            AND (documentData.t_isDifferentClients = 1)"
            + "\n" + "           )"
            + "\n" + "        OR (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "documentData.t_creditBalance") + ")"
            + "\n" + "            AND (documentData.t_paymentId   = paymentIdTable.t_paymentId)"
            + "\n" + "            AND (documentData.t_clientCode != paymentIdTable.t_clientCode)"
            + "\n" + "           )"
            + "\n" + "       )";
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_2_2470()
        initTDocumentQueryBuilder("4.1.2");

        m_query =    "SELECT " + BOCB + " t_backOffice,"
            + "\n" + "       " + getSqlString(m_line) + " t_line,"
            + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
            + "\n" + "       documentData.t_payerAccount t_account,"
            + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
            + "\n" + "       documentData.t_clientCode t_clientCode,"
            + "\n" + "       documentData.t_number t_documentNumber,"
            + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
            + "\n" + "       documentData.t_carryDate t_carryDate,"
            + "\n" + "       documentData.t_fiid t_fiid,"
            + "\n" + "       documentData.t_roubleSum,"
            + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
            + "\n" + "       documentData.t_sendingMode t_sendingMode,"
            + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
            + "\n" + "       1 t_docCount,"
            + "\n" + "       " + m_errorKind + " t_errorKind,"
            + "\n" + "       documentData.t_isInternetOrigin,"
            + "\n" + "       documentData.t_autoKey t_autoKey"
            + "\n" + "  FROM df251doc_tmp documentData,"
            + "\n" + "       (SELECT paymentTable.t_paymentId"
            + "\n" + "          FROM dpmpaym_dbt paymentTable"
            + "\n" + "         WHERE (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.2", BOCB), "paymentTable.t_receiverAccount")
            + "\n" + "                    AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "TO_CHAR(paymentTable.t_chapter, 'FM0x') || TO_CHAR(paymentTable.t_payFiId, 'FM0xxxxxx') || paymentTable.t_receiverAccount") + ")"
            + "\n" + "                   )"
            + "\n" + "                OR EXISTS(SELECT 1 FROM df251doc_tmp doc"
            + "\n" + "                           WHERE doc.t_paymentId =  paymentTable.t_paymentId"
            + "\n" + "                             AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.2", BOCB), "doc.t_creditBalance") + ")"
            + "\n" + "                             AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "doc.t_receiverObjectId") + ")"
            + "\n" + "                          )"
            + "\n" + "               )"
            + "\n" + "           AND EXISTS(SELECT 1 FROM df251doc_tmp doc "
            + "\n" + "                       WHERE doc.t_paymentId =  paymentTable.t_paymentId"
            + "\n" + "                         AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "doc.t_creditBalance") + "))"
            + "\n" + "       ) paymentIdTable"
            + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0")
            + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.2", BOCB), "documentData.t_debetBalance")  + ")"
            + "\n" + "   AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "documentData.t_payerObjectId") + ")"
            + "\n" + "   AND documentData.t_paymentId = paymentIdTable.t_paymentId";
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(documentTempTableInserter)
            documentTempTableInserter.insert();

            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_5_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_5_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_5_1_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_1_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2_2470().build());

            sql_execute(insertClause + TDocumentQueryBuilder_2_Error().build());
        end;

        fill(TDocumentTempTableInserter_2470());
    end;
end;

class (TDataSourceCbDocuments_2470) TDataSourceCbDocuments_2539()
    initTDataSourceCbDocuments_2470();

    private class TDocumentTempTableInserter_2539()
        var m_payerAccountTableName    = "drepaccount_vw";
        var m_receiverAccountTableName = "drepaccount_vw";
        var m_paymentOrderTableName    = "dpspayord_dbt";
        var m_documentTableName        = "drepdocumentwithcorrection_vw";

        private macro makeCommandText()
            var beginDate = parameters.getBeginDate();
            var endDate   = parameters.getEndDate();

            /*Необходимо для инициализации вьюхи drepdocumentwithcorrection_vw*/
            sql_execute("CALL rep_data.setBeginDate(" + getSqlDate(beginDate) + ")");
            sql_execute("CALL rep_data.setEndDate("   + getSqlDate(endDate)   + ")");
            sql_execute("CALL rep_data.initCorrectDocumentParameters(1,"+ getSqlDate(beginDate) + ","+ getSqlDate(endDate) +")");

            var commandText =
                         " INSERT INTO df251doc_tmp(t_autoKey,"
                + "\n" + "                         t_fiid,"
                + "\n" + "                         t_payerAccount,"
                + "\n" + "                         t_receiverAccount,"
                + "\n" + "                         t_clientCode,"
                + "\n" + "                         t_payerAccountDepartment,"
                + "\n" + "                         t_receiverAccountDepartment,"
                + "\n" + "                         t_number,"
                + "\n" + "                         t_referenceNumber,"
                + "\n" + "                         t_referenceNumberPd,"
                + "\n" + "                         t_carryDate,"
                + "\n" + "                         t_sum,"
                + "\n" + "                         t_roublesum,"
                + "\n" + "                         t_balance,"
                + "\n" + "                         t_debetBalance,"
                + "\n" + "                         t_creditBalance,"
                + "\n" + "                         t_isInternetOrigin,"
                + "\n" + "                         t_sendingMode,"
                + "\n" + "                         t_clientLegalForm,"
                + "\n" + "                         t_isClientEmployer,"
                + "\n" + "                         t_payerObjectId,"
                + "\n" + "                         t_receiverObjectId,"
                + "\n" + "                         t_payerOpuSymbol,"
                + "\n" + "                         t_receiverOpuSymbol,"
                + "\n" + "                         t_isDifferentClients,"
                + "\n" + "                         t_payerKindAccount,"
                + "\n" + "                         t_paymentId)"
                + "\n" + "    WITH pspayord AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM " + m_paymentOrderTableName
                + "\n" + "                       WHERE (t_docKind = " + PS_PAYORDER + " OR t_docKind = " + PS_CPORDER + ")"
                + "\n" + "                         AND t_origin = " + INTERNET_ORIGIN + ")"
                + "\n" + "    SELECT document.t_id t_autoKey,"
                + "\n" + "           document.t_debetfiid t_fiid,"
                + "\n" + "           document.t_debetaccount t_payerAccount,"
                + "\n" + "           document.t_creditaccount t_receiverAccount,"
                + "\n" + "           payerAccount.t_partyId t_clientCode,"
                + "\n" + "           payerAccount.t_departmentId t_payerAccountDepartment,"
                + "\n" + "           receiverAccount.t_departmentId t_receiverAccountDepartment,"
                + "\n" + "           document.t_number t_number,"
                + "\n" + "           TRIM(document.t_shifr_oper) t_referenceNumber,"
                + "\n" + "           TRIM(payment.t_partpaymshifrmain) t_referenceNumberPd,"
                + "\n" + "           document.t_date t_carryDate,"
                + "\n" + "           document.t_debetsum t_sum,"
                + "\n" + "           document.t_incoversum t_incoversum,"
                + "\n" + "           payerAccount.t_balance t_balance,"
                + "\n" + "           payerAccount.t_balance t_debetBalance,"
                + "\n" + "           receiverAccount.t_balance t_creditBalance,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN EXISTS (SELECT 1"
                + "\n" + "                              FROM pspayord"
                + "\n" + "                             WHERE payment.t_paymentId IS NOT NULL"
                + "\n" + "                               AND pspayord.t_orderId = payment.t_documentId"
                + "\n" + "                           )"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "            END t_isInternetOrigin,"
                + "\n" + "           NVL((SELECT paymentRmodelProperty.t_paymentKind"
                + "\n" + "                  FROM dpmrmprop_dbt paymentRmodelProperty"
                + "\n" + "                 WHERE paymentRmodelProperty.t_paymentId = document.t_paymentId) , CHR(1)) t_sendingMode,"
                + "\n" + "           NVL((SELECT party.t_legalForm"
                + "\n" + "                  FROM dparty_dbt party"
                + "\n" + "                 WHERE party.t_partyId = payerAccount.t_partyId), -1) t_clientLegalForm,"
                + "\n" + "           NVL((SELECT DECODE(persn.t_isEmployer, CHR(0), 0, 1)"
                + "\n" + "                  FROM dpersn_dbt persn"
                + "\n" + "                 WHERE persn.t_personId = payerAccount.t_partyId), 0) t_isClientEmployer,"
                + "\n" + "           payerAccount.t_objectId,"
                + "\n" + "           receiverAccount.t_objectId,"
                + "\n" + "           payerAccount.t_OpuSymbol,"
                + "\n" + "           receiverAccount.t_OpuSymbol,"
                + "\n" + "           CASE"
                + "\n" + "               WHEN payerAccount.t_partyId <> receiverAccount.t_partyId"
                + "\n" + "                   THEN 1"
                + "\n" + "               ELSE 0"
                + "\n" + "           END t_isDifferentClients,"
                + "\n" + "           payerAccount.t_kind t_payerKindAccount,"
                + "\n" + "           document.t_paymentId"
                + "\n" + "      FROM " + m_documentTableName + " document,"
                + "\n" + "           " + m_payerAccountTableName     + " payerAccount,"
                + "\n" + "           " + m_receiverAccountTableName  + " receiverAccount,"
                + "\n" + "           dpmpaym_dbt payment"
                + "\n" + "     WHERE document.t_chapter = 1"
                + "\n" + "       AND document.t_isdeltarate = 0"
                + "\n" + "       AND document.t_date BETWEEN " + getSqlDate(beginDate)
                + "\n" + "                               AND " + getSqlDate(endDate)
                + "\n" + "       AND payerAccount.t_chapter = 1"
                + "\n" + "       AND receiverAccount.t_chapter = 1"
                + "\n" + "       AND receiverAccount.t_account = document.t_creditaccount"
                + "\n" + "       AND receiverAccount.t_fiid = document.t_creditfiid"
                + "\n" + "       AND receiverAccount.t_chapter = document.t_chapter"
                + "\n" + "       AND payerAccount.t_account = document.t_debetaccount"
                + "\n" + "       AND payerAccount.t_fiid = document.t_debetfiid"
                + "\n" + "       AND payerAccount.t_chapter = document.t_chapter"
                + "\n" + "       AND INSTR(payerAccount.t_type, 'Щ') = 0"
                + "\n" + "       AND INSTR(receiverAccount.t_type, 'Щ') = 0"
                + "\n" + "       AND payment.t_paymentId(+) = document.t_paymentId"
                + "\n" + "       AND (("
                + "\n" + "                 NOT (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("000", BOCB), "document.t_debetaccount")  + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("000", BOCB), "document.t_creditaccount") + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat("47416*", "document.t_debetaccount") + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat("47417*", "document.t_creditaccount") + ")"
                + "\n" + "             AND NOT (    (" + convertMaskToSqlFormat("30110*,30114*", "document.t_debetaccount")  + ")"
                + "\n" + "                      AND (" + convertMaskToSqlFormat("30110*,30114*", "document.t_creditaccount") + ")"
                + "\n" + "                     )"
                + "\n" + "             AND NOT (    payerAccount.t_partyId = receiverAccount.t_partyId"
                + "\n" + "                      AND NOT EXISTS(SELECT 1"
                + "\n" + "                                       FROM drepourbank_tmp ourBank"
                + "\n" + "                                      WHERE payerAccount.t_partyId = ourBank.t_partyId"
                + "\n" + "                                    )"
                + "\n" + "                     )"
                + "\n" + "             AND NOT ((    ((document.t_debetaccount LIKE ' 30301%') AND (document.t_creditaccount LIKE ' 30302%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30302%') AND (document.t_creditaccount LIKE ' 30301%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30303%') AND (document.t_creditaccount LIKE ' 30304%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30304%') AND (document.t_creditaccount LIKE ' 30303%'))"
                + "\n" + "                      )"
                + "\n" + "             AND  (payerAccount.t_contrAgentId = receiverAccount.t_contrAgentId))"
                + "\n" + "            )"
                + "\n" + "            OR "
                + "\n" + "            ("
                + "\n" + "                 NOT (" + convertMaskToSqlFormat("202*", "document.t_debetaccount")  + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat("202*", "document.t_creditaccount") + ")"
                + "\n" + "            )"
                + "\n" + "           )";

            return commandText;
        end;

        macro insert()
            SQL_truncate("df251doc_tmp");
            SQL_execute(makeCommandText());
        end;
    end;

    class (TDocumentQueryBuilder_2_1) TDocumentQueryBuilder_2_1_6_2539(line : String)
        defaultParm(line, "2.1.6");

        initTDocumentQueryBuilder_2_1(line);

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "   ) ";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder_2_1) TDocumentQueryBuilder_2_1_6_1_2539(line : String)
        defaultParm(line, "2.1.6.1");
        initTDocumentQueryBuilder_2_1("2.1.6.1", "2.1.6");

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + "    AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.6.1", BOCB), "documentData.t_creditBalance")  + ")"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("70601*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.1.6.1", BOCB), "documentData.t_receiverOpuSymbol") + "))"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("47423*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + hasAccountAssignedCategory(RCB_OBJGROUP_COMISSION, "Комиссии", "documentData.t_receiverObjectId") + "))";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder_2_2) TDocumentQueryBuilder_2_2_6_2539(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.2.6");
        defaultParm(debetBalanceMaskLine, "2.2.6");

        initTDocumentQueryBuilder_2_2(line, debetBalanceMaskLine);

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "   )";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder_2_2) TDocumentQueryBuilder_2_2_6_1_2539(line : String)
        defaultParm(line, "2.2.6.1");

        initTDocumentQueryBuilder_2_2("2.2.6.1", "2.2.6");

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + "    AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.6.1", BOCB), "documentData.t_creditBalance")  + ")"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("70601*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.2.6.1", BOCB), "documentData.t_receiverOpuSymbol") + "))"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("47423*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + hasAccountAssignedCategory(RCB_OBJGROUP_COMISSION, "Комиссии", "documentData.t_receiverObjectId") + "))";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_3_6_2539()
        initTDocumentQueryBuilder("2.3.6", ERROR_KIND_NONE, true);

        macro getCondition()
            return       "    EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "   )";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_3_6_1_2539()
        initTDocumentQueryBuilder("2.3.6.1");

        macro getCondition()
            return       "   EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "   )"
                + "\n" + "   AND(" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.6.1", BOCB), "documentData.t_debetBalance")  + ")"
                + "\n" + "   AND ( NOT (" + convertMaskToSqlFormat("70606*", "documentData.t_debetBalance")  + ")"
                + "\n" + "          OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.3.6.1", BOCB), "documentData.t_payerOpuSymbol") + "))"
                + "\n" + "   AND ( NOT (" + convertMaskToSqlFormat("47422*", "documentData.t_debetBalance")  + ")"
                + "\n" + "          OR (" + hasAccountAssignedCategory(RCB_OBJGROUP_COMISSION, "Комиссии", "documentData.t_payerObjectId") + "))";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_3_2539()

        macro build()
            return build()
                + "\n" + "   AND ("
                + "\n" + "                ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance")
                + "\n" + "                 OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "            AND NOT ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB), "documentData.t_creditBalance")
                + "\n" + "                     OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "documentData.t_creditBalance")
                + "\n" + "                     OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.4", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "        OR"
                + "\n" + "                ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "            AND ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_creditBalance")
                + "\n" + "                 OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "       )"
                + "\n" + "   AND (   documentData.t_referenceNumber IN ('01','02','06','07','08')"
                + "\n" + "        OR (    documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + " UNION ALL"
                + "\n" + "SELECT t_bo,"
                + "\n" + "       '3.3' t_line,"
                + "\n" + "       t_column,"
                + "\n" + "       t_account,"
                + "\n" + "       t_accountCredit,"
                + "\n" + "       t_clientCode,"
                + "\n" + "       t_numbDocument,"
                + "\n" + "       t_shifrDocument,"
                + "\n" + "       t_dateCarry,"
                + "\n" + "       t_fiid,"
                + "\n" + "       t_sumRub,"
                + "\n" + "       t_sumCurrency,"
                + "\n" + "       t_kindA,"
                + "\n" + "       '3',"
                + "\n" + "       t_docCount,"
                + "\n" + "       t_errorKind,"
                + "\n" + "       t_isInternetOrigin,"
                + "\n" + "       t_autoKey"
                + "\n" + "  FROM df251_tmp documentData"
                + "\n" + " WHERE t_line IN ('2.1.6', '2.2.6', '2.3.6')";
        end;

        initTDocumentQueryBuilder("3.3");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_3_2539()
        initTDocumentQueryBuilder("4.1.3");

        m_query =    "SELECT " + BOCB + " t_backOffice,"
            + "\n" + "       " + getSqlString(m_line) + " t_line,"
            + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
            + "\n" + "       documentData.t_payerAccount t_account,"
            + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
            + "\n" + "       documentData.t_clientCode t_clientCode,"
            + "\n" + "       documentData.t_number t_documentNumber,"
            + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
            + "\n" + "       documentData.t_carryDate t_carryDate,"
            + "\n" + "       documentData.t_fiid t_fiid,"
            + "\n" + "       documentData.t_roubleSum,"
            + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
            + "\n" + "       documentData.t_sendingMode t_sendingMode,"
            + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
            + "\n" + "       1 t_docCount,"
            + "\n" + "       " + m_errorKind + " t_errorKind,"
            + "\n" + "       documentData.t_isInternetOrigin,"
            + "\n" + "       documentData.t_autoKey t_autoKey"
            + "\n" + "  FROM df251doc_tmp documentData"
            + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0")
            + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1", BOCB), "documentData.t_debetBalance")  + ")"
            + "\n" + "   AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "documentData.t_payerObjectId") + ")"
            + "\n" + "   AND EXISTS(SELECT 1"
            + "\n" + "                FROM dpartyown_dbt partyown"
            + "\n" + "               WHERE partyown.t_partyId = documentData.t_clientCode"
            + "\n" + "                 AND partyown.t_partykind = " + RCB_PTK_BANK + ")"
            + "\n" + "   AND NOT EXISTS(SELECT 1"
            + "\n" + "                     FROM drepourbank_tmp"
            + "\n" + "                    WHERE t_partyId = documentData.t_clientCode)"
            + "\n" + "   AND (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.3", BOCB), "documentData.t_creditBalance")  + ")"
            + "\n" + "        OR (    documentData.t_paymentId IS NOT NULL"
            + "\n" + "            AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.3незав", BOCB), "documentData.t_creditBalance")  + ")"
            + "\n" + "            AND EXISTS(SELECT 1"
            + "\n" + "                         FROM dpmpaym_dbt paymentTable,"
            + "\n" + "                              df251doc_tmp bdoc"
            + "\n" + "                        WHERE paymentTable.t_paymentId = documentData.t_paymentId"
            + "\n" + "                          AND bdoc.t_paymentId = paymentTable.t_paymentId"
            + "\n" + "                          AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.3незав", BOCB), "bdoc.t_debetBalance") + ")"
            + "\n" + "                          AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.3", BOCB), "bdoc.t_creditBalance") + "))"
            + "\n" + "           )"
            + "\n" + "       )";
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(documentTempTableInserter)
            documentTempTableInserter.insert();

            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_1_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_1().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_1_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_5_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_1_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_1_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_3_2539().build());

            sql_execute(insertClause + TDocumentQueryBuilder_2_Error().build());
        end;

        fill(TDocumentTempTableInserter_2539());
    end;

end;


class (TDataSourceCbDocuments_2539) TDataSourceCbDocuments_2742()
    initTDataSourceCbDocuments_2539();

    private class TDocumentTempTableInserter_2742()
        var m_paymentOrderTableName = "dpspayord_dbt";
        var m_documentTableName     = "dRepDocumentWithCorrection_vw";

        private macro isAccredoPosting()
            return "(document.t_debetaccount LIKE '40901%' OR document.t_debetaccount LIKE '40902%') AND (document.t_creditaccount LIKE '47431%' OR document.t_creditaccount LIKE '47410%')";
        end;

        private macro makeCommandText()
            var beginDate = parameters.getBeginDate();
            var endDate   = parameters.getEndDate();

            /*Необходимо для инициализации вьюхи drepdocumentwithcorrection_vw*/
            sql_execute("CALL rep_data.setBeginDate(" + getSqlDate(beginDate) + ")");
            sql_execute("CALL rep_data.setEndDate("   + getSqlDate(endDate)   + ")");
            sql_execute("CALL rep_data.initCorrectDocumentParameters(1,"+ getSqlDate(beginDate) + ","+ getSqlDate(endDate) +")");

            var commandText =
                         " INSERT INTO df251doc_tmp(t_autoKey,                                                                                                                          "
                + "\n" + "                          t_fiid,                                                                                                                             "
                + "\n" + "                          t_payerAccountId,                                                                                                                   "
                + "\n" + "                          t_clientCode,                                                                                                                       "
                + "\n" + "                          t_receiverAccountId,                                                                                                                "
                + "\n" + "                          t_number,                                                                                                                           "
                + "\n" + "                          t_referenceNumber,                                                                                                                  "
                + "\n" + "                          t_referenceNumberPd,                                                                                                                "
                + "\n" + "                          t_carryDate,                                                                                                                        "
                + "\n" + "                          t_sum,                                                                                                                              "
                + "\n" + "                          t_roublesum,                                                                                                                        "
                + "\n" + "                          t_result_carry,                                                                                                                     "
                + "\n" + "                          t_sendingMode,                                                                                                                      "
                + "\n" + "                          t_paymentId)                                                                                                                        "
                + "\n" + "    SELECT document.t_id                                                                                                                 t_autoKey,           "
                + "\n" + "           document.t_debetfiid                                                                                                          t_fiid,              "
                + "\n" + "           CASE                                                                                                                                               "
                                         //проводка по аккредитиву
                + "\n" + "               WHEN " + isAccredoPosting()
                + "\n" + "                   THEN (SELECT /*++ FIRST_ROWS */                                                                                                            "
                + "\n" + "                                doc.t_debetAccountId                                                                                                          "
                + "\n" + "                           FROM " + m_documentTableName + " doc "
                + "\n" + "                          WHERE doc.t_creditAccountId = document.t_debetAccountId                                                                             "
                + "\n" + "                            AND rownum < 2)                                                                                                                   "
                + "\n" + "               ELSE document.t_debetAccountId                                                                                                                 "
                + "\n" + "           END                                                                                                                           t_payerAccountId,    "
                + "\n" + "           (SELECT acc.t_partyId FROM drepaccount_vw acc WHERE acc.t_accountId = document.t_debetAccountId)                              t_clientCode,        "
                + "\n" + "           CASE                                                                                                                                               "
                                         //проводка по аккредитиву
                + "\n" + "               WHEN " + isAccredoPosting()
                + "\n" + "                   THEN document.t_debetAccountId                                                                                                             "
                + "\n" + "               ELSE document.t_creditAccountId                                                                                                                "
                + "\n" + "           END                                                                                                                           t_receiverAccountId, "
                + "\n" + "           document.t_number                                                                                                             t_number,            "
                + "\n" + "           TRIM(document.t_shifr_oper)                                                                                                   t_referenceNumber,   "
                + "\n" + "           TRIM(NVL((SELECT payment.t_partpaymshifrmain FROM dpmpaym_dbt payment WHERE payment.t_paymentId = document.t_paymentId), '')) t_referenceNumberPd, "
                + "\n" + "           document.t_date                                                                                                               t_carryDate,         "
                + "\n" + "           document.t_debetsum                                                                                                           t_sum,               "
                + "\n" + "           document.t_incoversum                                                                                                         t_incoversum,        "
                + "\n" + "           NVL((SELECT payms.t_primDocOrigin                                                                                                                  "
                + "\n" + "                  FROM dPmDocs_dbt pmdocs,                                                                                                                    "
                + "\n" + "                       dPmPaym_dbt payms                                                                                                                      "
                + "\n" + "                 WHERE pmdocs.t_accTrnId = document.t_id                                                                                                      "
                + "\n" + "                   and payms.t_paymentId = pmdocs.t_paymentId),                                                                                               "
                + "\n" + "               -1)                                                                                                                       t_result_carry,      "
                + "\n" + "           NVL((SELECT paymentRmodelProperty.t_paymentKind                                                                                                    "
                + "\n" + "                  FROM dpmrmprop_dbt paymentRmodelProperty                                                                                                    "
                + "\n" + "                 WHERE paymentRmodelProperty.t_paymentId = document.t_paymentId) , CHR(1))                                               t_sendingMode,       "
                + "\n" + "           document.t_paymentId                                                                                                                               "
                + "\n" + "      FROM " + m_documentTableName + " document "
                + "\n" + "     WHERE document.t_chapter = 1"
                + "\n" + "       AND document.t_isdeltarate = 0"
                + "\n" + "       AND document.t_date BETWEEN " + getSqlDate(beginDate)
                + "\n" + "                               AND " + getSqlDate(endDate)
                + "\n" + "       AND INSTR((SELECT payerAccount.t_type FROM dRepAccount_vw payerAccount WHERE payerAccount.t_accountId = document.t_debetAccountId), 'Щ') = 0"
                + "\n" + "       AND (   ((SELECT payerAccount.t_fiId FROM dRepAccount_vw payerAccount WHERE payerAccount.t_accountId = document.t_debetAccountId) = " + NATCUR + ")"
                + "\n" + "            OR (INSTR((SELECT payerAccount.t_type FROM dRepAccount_vw payerAccount WHERE payerAccount.t_accountId = document.t_debetAccountId), 'Y') = 0))"
                + "\n" + "       AND INSTR((SELECT receiverAccount.t_type FROM dRepAccount_vw receiverAccount WHERE receiverAccount.t_accountId = document.t_creditAccountId), 'Щ') = 0"
                + "\n" + "       AND NOT EXISTS(SELECT 1"
                + "\n" + "                        FROM df251_tmp tmp251"
                + "\n" + "                       WHERE tmp251.t_bo = 3"
                + "\n" + "                         AND tmp251.t_accountCredit = document.t_creditaccount)"
                + "\n" + "       AND NOT ((SELECT payerAccount.t_contragentId FROM dRepAccount_vw payerAccount WHERE payerAccount.t_accountId = document.t_debetAccountId) = "
                + "\n" + "                (SELECT receiverAccount.t_contragentId FROM dRepAccount_vw receiverAccount WHERE receiverAccount.t_accountId = document.t_creditAccountId))"
                + "\n" + "       AND (("
                + "\n" + "                 NOT (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("000", BOCB), "document.t_debetaccount")  + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("000", BOCB), "document.t_creditaccount") + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat("47416*", "document.t_debetaccount") + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat("47417*", "document.t_creditaccount") + ")"
                + "\n" + "             AND NOT (    (" + convertMaskToSqlFormat("30110*,30114*", "document.t_debetaccount")  + ")"
                + "\n" + "                      AND (" + convertMaskToSqlFormat("30110*,30114*", "document.t_creditaccount") + ")"
                + "\n" + "                     )"

                + "\n" + "             AND NOT (    (SELECT payerAccount.t_partyId FROM dRepAccount_vw payerAccount WHERE payerAccount.t_accountId = document.t_debetAccountId) = "
                + "\n" + "                          (SELECT receiverAccount.t_partyId FROM dRepAccount_vw receiverAccount WHERE receiverAccount.t_accountId = document.t_creditAccountId)"
                + "\n" + "                      AND NOT EXISTS(SELECT 1"
                + "\n" + "                                       FROM drepourbank_tmp ourBank"
                + "\n" + "                                      WHERE ourBank.t_partyId = (SELECT payerAccount.t_partyId FROM dRepAccount_vw payerAccount WHERE payerAccount.t_accountId = document.t_debetAccountId)"
                + "\n" + "                                    )"
                + "\n" + "                     )"
                + "\n" + "             AND NOT (    ((document.t_debetaccount LIKE ' 30301%') AND (document.t_creditaccount LIKE ' 30302%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30302%') AND (document.t_creditaccount LIKE ' 30301%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30303%') AND (document.t_creditaccount LIKE ' 30304%'))"
                + "\n" + "                       OR ((document.t_debetaccount LIKE ' 30304%') AND (document.t_creditaccount LIKE ' 30303%'))"
                + "\n" + "                      )"
                + "\n" + "            )"
                + "\n" + "            OR "
                + "\n" + "            ("
                + "\n" + "                 NOT (" + convertMaskToSqlFormat("202*", "document.t_debetaccount")  + ")"
                + "\n" + "             AND NOT (" + convertMaskToSqlFormat("202*", "document.t_creditaccount") + ")"
                + "\n" + "            )"
                + "\n" + "           )";

            return commandText;
        end;

        macro insert()
            var commandText;

            SQL_truncate("df251doc_tmp");
            SQL_execute(makeCommandText());

            commandText =  "MERGE INTO df251doc_tmp tmp "
                + "\n" + "       USING (WITH category AS (SELECT --+inline"
                + "\n" + "                             *"
                + "\n" + "                        FROM dRepCategory_vw objatcor"
                + "\n" + "                       WHERE objatcor.t_objectType   = " + OBJTYPE_ACCOUNT
                + "\n" + "                         AND objatcor.t_id           = " + RCB_OBJGROUP_CONNECTION
                + "\n" + "                         AND t_isInstalledOverPeriod = 1)"
                + "\n" + "              SELECT payerAccount.t_accountId                                                 t_payerAccountId, "
                + "\n" + "                     payerAccount.t_account                                                   t_account_payer,"
                + "\n" + "                     receiverAccount.t_accountId                                              t_receiverAccountId,"
                + "\n" + "                     receiverAccount.t_account                                                t_account_receiver,"
                + "\n" + "                     payerAccount.t_partyId                                                   t_partyId, "
                + "\n" + "                     payerAccount.t_contragentId                                              t_contragentId_payer, "
                + "\n" + "                     payerAccount.t_departmentId                                              t_departmentId_payer, "
                + "\n" + "                     payerAccount.t_departmentId                                              t_departmentId_receiver, "
                + "\n" + "                     payerAccount.t_balance                                                   t_balance_payer, "
                + "\n" + "                     receiverAccount.t_balance                                                t_balance_receiver, "
                + "\n" + "                     CASE"
                + "\n" + "                         WHEN EXISTS(SELECT 1"
                + "\n" + "                                       FROM category"
                + "\n" + "                                      WHERE category.t_objectId = payerAccount.t_objectid)"
                + "\n" + "                             THEN 1"
                + "\n" + "                         ELSE 0"
                + "\n" + "                     END                                                                      t_isConnection,"
                + "\n" + "                     CASE"
                + "\n" + "                         WHEN EXISTS(SELECT 1"
                + "\n" + "                                       FROM category"
                + "\n" + "                                      WHERE category.t_value    = 'И'"
                + "\n" + "                                        AND category.t_objectId = payerAccount.t_objectid)"
                + "\n" + "                             THEN 1"
                + "\n" + "                         ELSE 0"
                + "\n" + "                     END                                                                      t_isInternetOrigin,"
                + "\n" + "                     CASE"
                + "\n" + "                         WHEN EXISTS(SELECT 1"
                + "\n" + "                                       FROM category"
                + "\n" + "                                      WHERE category.t_value    = 'МТ'"
                + "\n" + "                                        AND category.t_objectId = payerAccount.t_objectid)"
                + "\n" + "                             THEN 1"
                + "\n" + "                         ELSE 0"
                + "\n" + "                     END                                                                      t_isMobilePhoneConnection,"
                + "\n" + "                     CASE"
                + "\n" + "                         WHEN EXISTS(SELECT 1"
                + "\n" + "                                       FROM category"
                + "\n" + "                                      WHERE category.t_value    = 'Д'"
                + "\n" + "                                        AND category.t_objectId = payerAccount.t_objectid)"
                + "\n" + "                             THEN 1"
                + "\n" + "                         ELSE 0"
                + "\n" + "                     END                                                                      t_isRemoteConnection,"
                + "\n" + "                     NVL((SELECT party.t_legalForm"
                + "\n" + "                            FROM dparty_dbt party"
                + "\n" + "                           WHERE party.t_partyId = payerAccount.t_partyId), -1)               t_clientLegalForm,"
                + "\n" + "                     NVL((SELECT DECODE(persn.t_isEmployer, CHR(0), 0, 1)"
                + "\n" + "                            FROM dpersn_dbt persn"
                + "\n" + "                           WHERE persn.t_personId = payerAccount.t_partyId), 0)               t_isClientEmployer,"
                + "\n" + "                     payerAccount.t_objectId                                                  t_payerObjectId,"
                + "\n" + "                     receiverAccount.t_objectId                                               t_receiverObjectId,"
                + "\n" + "                     payerAccount.t_OpuSymbol                                                 t_opuSymbol_payer,"
                + "\n" + "                     receiverAccount.t_OpuSymbol                                              t_opuSymbol_receiver,"
                + "\n" + "                     CASE"
                + "\n" + "                         WHEN payerAccount.t_partyId <> receiverAccount.t_partyId"
                + "\n" + "                             THEN 1"
                + "\n" + "                         ELSE 0"
                + "\n" + "                     END                                                                      t_isDifferentClients,"
                + "\n" + "                     CASE"
                + "\n" + "                         WHEN payerAccount.t_contragentId <> receiverAccount.t_contragentId"
                + "\n" + "                             THEN 1"
                + "\n" + "                         ELSE 0"
                + "\n" + "                     END                                                                      t_isDifferentContragents,"
                + "\n" + "                     payerAccount.t_kind                                                      t_payerKindAccount"
                + "\n" + "                FROM drepAccount_vw payerAccount,             "
                + "\n" + "                     drepAccount_vw receiverAccount) updSql   "
                + "\n" + "          ON (    tmp.t_payerAccountId    = updSql.t_payeraccountId "
                + "\n" + "              AND tmp.t_receiverAccountId = updSql.t_receiveraccountId)  "
                + "\n" + "  WHEN MATCHED THEN UPDATE SET    "
                + "\n" + "              tmp.t_payerAccount              = updSql.t_account_payer,"
                + "\n" + "              tmp.t_receiverAccount           = updSql.t_account_receiver,"
                + "\n" + "              tmp.t_clientCode                = updSql.t_partyId,"
                + "\n" + "              tmp.t_contragentId              = updSql.t_contragentId_payer,"
                + "\n" + "              tmp.t_payerAccountDepartment    = updSql.t_departmentId_payer,"
                + "\n" + "              tmp.t_receiverAccountDepartment = updSql.t_departmentId_receiver,"
                + "\n" + "              tmp.t_balance                   = updSql.t_balance_payer,"
                + "\n" + "              tmp.t_debetBalance              = updSql.t_balance_payer,"
                + "\n" + "              tmp.t_creditBalance             = updSql.t_balance_receiver,"
                + "\n" + "              tmp.t_isConnection              = updSql.t_isConnection,"
                + "\n" + "              tmp.t_isInternetOrigin          = updSql.t_isInternetOrigin,"
                + "\n" + "              tmp.t_isMobilePhoneConnection   = updSql.t_isMobilePhoneConnection,"
                + "\n" + "              tmp.t_clientLegalForm           = updSql.t_clientLegalForm,"
                + "\n" + "              tmp.t_isClientEmployer          = updSql.t_isClientEmployer,"
                + "\n" + "              tmp.t_payerObjectId             = updSql.t_payerObjectId,"
                + "\n" + "              tmp.t_receiverObjectId          = updSql.t_receiverObjectId,"
                + "\n" + "              tmp.t_payerOpuSymbol            = updSql.t_OpuSymbol_payer,"
                + "\n" + "              tmp.t_receiverOpuSymbol         = updSql.t_OpuSymbol_receiver,"
                + "\n" + "              tmp.t_isDifferentClients        = updSql.t_isDifferentClients,"
                + "\n" + "              tmp.t_isDifferentContragents    = updSql.t_isDifferentContragents,"
                + "\n" + "              tmp.t_payerKindAccount          = updSql.t_payerKindAccount";

           SQL_execute(commandText);
        end;
    end;

    class (TDocumentQueryBuilder_2_1_2742) TDocumentQueryBuilder_2_1_1_2742(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.1");
        defaultParm(debetBalanceMaskLine, line);

        initTDocumentQueryBuilder_2_1_2742(debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '01'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '01'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_1_1_1_2742(line : String)
        defaultParm(line, "2.1.1.1");

        initTDocumentQueryBuilder(line);

        macro build()
            return            "SELECT t_bo,"
                     + "\n" + "       '2.1.1.1' t_line,"
                     + "\n" + "       t_column,"
                     + "\n" + "       t_account,"
                     + "\n" + "       t_accountCredit,"
                     + "\n" + "       t_clientCode,"
                     + "\n" + "       t_numbDocument,"
                     + "\n" + "       t_shifrDocument,"
                     + "\n" + "       t_dateCarry,"
                     + "\n" + "       t_fiid,"
                     + "\n" + "       t_sumRub,"
                     + "\n" + "       t_sumCurrency,"
                     + "\n" + "       t_kindA,"
                     + "\n" + "       t_chapter,"
                     + "\n" + "       t_docCount,"
                     + "\n" + "       t_errorKind,"
                     + "\n" + "       t_isInternetOrigin,"
                     + "\n" + "       t_isRemoteConnection,"
                     + "\n" + "       t_isConnection,"
                     + "\n" + "       t_isMobilePhoneConnection,"
                     + "\n" + "       t_result_carry,"
                     + "\n" + "       t_autoKey"
                     + "\n" + "  FROM df251_tmp documentData"
                     + "\n" + " WHERE t_line = '2.1.1'"
                     + "\n" + "   AND (   documentData.t_isRemoteConnection      = 1"
                     + "\n" + "        OR documentData.t_isInternetOrigin        = 1"
                     + "\n" + "        OR documentData.t_isMobilePhoneConnection = 1"
                     + "\n" + "       )"
                     + "\n" + "   AND documentData.t_result_carry IN (" + parameters.getElectronicDocOrigin() + ")";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_1_1_1_1_2742(line : String)
        defaultParm(line, "2.1.1.1.1");

        initTDocumentQueryBuilder(line);
        macro build()
            return            "SELECT t_bo,"
                     + "\n" + "       '2.1.1.1.1' t_line,"
                     + "\n" + "       t_column,"
                     + "\n" + "       t_account,"
                     + "\n" + "       t_accountCredit,"
                     + "\n" + "       t_clientCode,"
                     + "\n" + "       t_numbDocument,"
                     + "\n" + "       t_shifrDocument,"
                     + "\n" + "       t_dateCarry,"
                     + "\n" + "       t_fiid,"
                     + "\n" + "       t_sumRub,"
                     + "\n" + "       t_sumCurrency,"
                     + "\n" + "       t_kindA,"
                     + "\n" + "       t_chapter,"
                     + "\n" + "       t_docCount,"
                     + "\n" + "       t_errorKind,"
                     + "\n" + "       t_isInternetOrigin,"
                     + "\n" + "       t_isRemoteConnection,"
                     + "\n" + "       t_isConnection,"
                     + "\n" + "       t_isMobilePhoneConnection,"
                     + "\n" + "       t_result_carry,"
                     + "\n" + "       t_autoKey"
                     + "\n" + "  FROM df251_tmp documentData"
                     + "\n" + " WHERE t_line = '2.1.1'"
                     + "\n" + "   AND documentData.t_isInternetOrigin = 1"
                     + "\n" + "   AND documentData.t_result_carry IN (" + parameters.getElectronicDocOrigin() + ")";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_1_2_2742(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.2");
        defaultParm(debetBalanceMaskLine, line);

        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder(line);

        macro getDocumentFilter(offset : String)
            return                "(    (     (documentData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
                + "\n" + offset + "       AND (NOT EXISTS(SELECT 1"
                + "\n" + offset + "                         FROM drepourbank_tmp"
                + "\n" + offset + "                        WHERE t_partyId = documentData.t_clientCode))"
                + "\n" + offset + "     )"
                + "\n" + offset + "  OR (     (documentData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
                + "\n" + offset + "       AND (documentData.t_isClientEmployer = 1)"
                + "\n" + offset + "       AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*", "documentData.t_debetBalance") + "))"
                + "\n" + offset + "        OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", " LPAD (documentData.t_clientCode, 10, '0')") + ")"
                + "\n" + offset + "              OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (documentData.t_clientCode, 10, '0')") + "))"
                + "\n" + offset + "                 AND (" + convertMaskToSqlFormat("40802*", "documentData.t_debetBalance") + ")))"
                + "\n" +          "   AND " + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_creditBalance");
        end;

        macro build()
            return build()
                + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7))
                + "\n" + "   AND (   documentData.t_referenceNumber = '08'"
                + "\n" + "       )";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_1_2_1_2742(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.2.1");
        defaultParm(debetBalanceMaskLine, "2.1.2");

        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder(line, ERROR_KIND_NONE, true);

        macro getDocumentFilter(offset : String)
            return                "(    (     (documentData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
                + "\n" + offset + "       AND (NOT EXISTS(SELECT 1"
                + "\n" + offset + "                         FROM drepourbank_tmp"
                + "\n" + offset + "                        WHERE t_partyId = documentData.t_clientCode))"
                + "\n" + offset + "     )"
                + "\n" + offset + "  OR (     (documentData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
                + "\n" + offset + "       AND (documentData.t_isClientEmployer = 1)"
                + "\n" + offset + "       AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*", "documentData.t_debetBalance") + "))"
                + "\n" + offset + "        OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", " LPAD (documentData.t_clientCode, 10, '0')") + ")"
                + "\n" + offset + "              OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (documentData.t_clientCode, 10, '0')") + "))"
                + "\n" + offset + "                 AND (" + convertMaskToSqlFormat("40802*", "documentData.t_debetBalance") + ")))"
                + "\n" +          "   AND " + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_creditBalance")
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
        end;

        macro build()
            return build()
                + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7))
                + "\n" + "   AND (   documentData.t_referenceNumber = '08'"
                + "\n" + "       )";
        end;
    end;

    class (TDocumentQueryBuilder_2_1_2742) TDocumentQueryBuilder_2_1_3_2742(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.3");
        defaultParm(debetBalanceMaskLine, line);

        initTDocumentQueryBuilder_2_1_2742(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '02'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '02'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;

     class (TDocumentQueryBuilder_2_1_2742) TDocumentQueryBuilder_2_1_4_2742(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.4");
        defaultParm(debetBalanceMaskLine, line);

        initTDocumentQueryBuilder_2_1_2742(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + "   AND (   documentData.t_referenceNumber = '06'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '06'"
                + "\n" + "           )"
                + "\n" + "       )";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_1_5_2742(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.5");
        defaultParm(debetBalanceMaskLine, line);

        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder(line);

        macro getDocumentFilter(offset : String)
            return                "(    (     (documentData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
                + "\n" + offset + "       AND (NOT EXISTS(SELECT 1"
                + "\n" + offset + "                         FROM drepourbank_tmp"
                + "\n" + offset + "                        WHERE t_partyId = documentData.t_clientCode))"
                + "\n" + offset + "       AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + offset + "  OR (     (documentData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
                + "\n" + offset + "       AND (documentData.t_isClientEmployer = 1)"
                + "\n" + offset + "       AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*", "documentData.t_debetBalance") + ")))"
                + "\n" + offset + " AND (   documentData.t_referenceNumber = '07'"
                + "\n" + offset + "      OR (documentData.t_referenceNumber = '16'"
                + "\n" + offset + "          AND documentData.t_referenceNumberPd = '07'"
                + "\n" + offset + "         )"
                + "\n" + offset + "     )";
         end;

        macro build()
            return build()
                + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7));
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_1_6_2742(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.6");
        defaultParm(debetBalanceMaskLine, line);

        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder(line);

        macro getDocumentFilter(offset : String)
            return                "(    (     (documentData.t_clientLegalForm = " + RCB_JURIDICAL_PERSON + ")"
                + "\n" + offset + "       AND (NOT EXISTS(SELECT 1"
                + "\n" + offset + "                         FROM drepourbank_tmp"
                + "\n" + offset + "                        WHERE t_partyId = documentData.t_clientCode))"
                + "\n" + offset + "       AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + "))"
                + "\n" + offset + "  OR (     (documentData.t_clientLegalForm  = " + RCB_NATURAL_PERSON + ")"
                + "\n" + offset + "       AND (documentData.t_isClientEmployer = 1)"
                + "\n" + offset + "       AND (" + convertMaskToSqlFormat("40802*, 40804*, 40805*, 40821*", "documentData.t_debetBalance") + "))"
                + "\n" + offset + "        OR (     (   (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Нотариус", "LPAD (documentData.t_clientCode, 10, '0')") + ")"
                + "\n" + offset + "              OR (" + hasPartyAssignedCategory(RCB_OBJGROUP_PT_TYPE, "Адвокат", "LPAD (documentData.t_clientCode, 10, '0')") + "))"
                + "\n" + offset + "                 AND (" + convertMaskToSqlFormat("40802*", "documentData.t_debetBalance") + ")))"
                + "\n" + offset + " AND (   documentData.t_referenceNumber = '17'"
                + "\n" + offset + "      OR (documentData.t_referenceNumber = '16'"
                + "\n" + offset + "          AND documentData.t_referenceNumberPd = '17'"
                + "\n" + offset + "         )"
                + "\n" + offset + "     )";
        end;

        macro build()
            return build()
                + "\n" + "   AND " + getDocumentFilter(mkStr(" ", 7));
        end;
    end;

    class (TDocumentQueryBuilder_2_1_2742) TDocumentQueryBuilder_2_1_6_1_2742(line : String)
        defaultParm(line, "2.1.6.1");
        initTDocumentQueryBuilder_2_1_2742("2.1.6.1", "2.1.6");

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + "    AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.6.1", BOCB), "documentData.t_creditBalance")  + ")"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("70601*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.1.6.1", BOCB), "documentData.t_receiverOpuSymbol") + "))"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("47423*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + hasAccountAssignedCategory(RCB_OBJGROUP_COMISSION, "Комиссии", "documentData.t_receiverObjectId") + "))";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_2_1_1_2742(line : String)
        defaultParm(line, "2.2.1.1");

        initTDocumentQueryBuilder(line);

        macro build()
            return            "SELECT t_bo,"
                     + "\n" + "       '2.2.1.1' t_line,"
                     + "\n" + "       t_column,"
                     + "\n" + "       t_account,"
                     + "\n" + "       t_accountCredit,"
                     + "\n" + "       t_clientCode,"
                     + "\n" + "       t_numbDocument,"
                     + "\n" + "       t_shifrDocument,"
                     + "\n" + "       t_dateCarry,"
                     + "\n" + "       t_fiid,"
                     + "\n" + "       t_sumRub,"
                     + "\n" + "       t_sumCurrency,"
                     + "\n" + "       t_kindA,"
                     + "\n" + "       t_chapter,"
                     + "\n" + "       t_docCount,"
                     + "\n" + "       t_errorKind,"
                     + "\n" + "       t_isInternetOrigin,"
                     + "\n" + "       t_isRemoteConnection,"
                     + "\n" + "       t_isConnection,"
                     + "\n" + "       t_isMobilePhoneConnection,"
                     + "\n" + "       t_result_carry,"
                     + "\n" + "       t_autoKey"
                     + "\n" + "  FROM df251_tmp documentData"
                     + "\n" + " WHERE t_line = '2.2.1'"
                     + "\n" + "   AND (SELECT party.t_isPhisical"
                     + "\n" + "          FROM dRepParty_vw party"
                     + "\n" + "         WHERE party.t_id = documentData.t_clientCode) = 1"
                     + "\n" + "   AND documentData.t_shifrDocument                    = '01'"
                     + "\n" + "   AND (   documentData.t_isRemoteConnection      = 1"
                     + "\n" + "        OR documentData.t_isInternetOrigin        = 1"
                     + "\n" + "        OR documentData.t_isMobilePhoneConnection = 1"
                     + "\n" + "       )"
                     + "\n" + "   AND documentData.t_result_carry IN (" + parameters.getElectronicDocOrigin() + ")";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_2_1_1_1_2742(line : String)
        defaultParm(line, "2.2.1.1.1");

        initTDocumentQueryBuilder(line);

        macro build()
            return            "SELECT t_bo,"
                     + "\n" + "       '2.2.1.1.1' t_line,"
                     + "\n" + "       t_column,"
                     + "\n" + "       t_account,"
                     + "\n" + "       t_accountCredit,"
                     + "\n" + "       t_clientCode,"
                     + "\n" + "       t_numbDocument,"
                     + "\n" + "       t_shifrDocument,"
                     + "\n" + "       t_dateCarry,"
                     + "\n" + "       t_fiid,"
                     + "\n" + "       t_sumRub,"
                     + "\n" + "       t_sumCurrency,"
                     + "\n" + "       t_kindA,"
                     + "\n" + "       t_chapter,"
                     + "\n" + "       t_docCount,"
                     + "\n" + "       t_errorKind,"
                     + "\n" + "       t_isInternetOrigin,"
                     + "\n" + "       t_isRemoteConnection,"
                     + "\n" + "       t_isConnection,"
                     + "\n" + "       t_isMobilePhoneConnection,"
                     + "\n" + "       t_result_carry,"
                     + "\n" + "       t_autoKey"
                     + "\n" + "  FROM df251_tmp documentData"
                     + "\n" + " WHERE t_line = '2.2.1'"
                     + "\n" + "   AND (SELECT party.t_isPhisical"
                     + "\n" + "          FROM dRepParty_vw party"
                     + "\n" + "         WHERE party.t_id = documentData.t_clientCode) = 1"
                     + "\n" + "   AND documentData.t_isInternetOrigin                 = 1"
                     + "\n" + "   AND documentData.t_shifrDocument                    = '01'"
                     + "\n" + "   AND documentData.t_result_carry IN (" + parameters.getElectronicDocOrigin() + ")";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_2_1_1_2_2742(line : String)
        defaultParm(line, "2.2.1.1.2");

        initTDocumentQueryBuilder(line);

        macro build()
            return            "SELECT t_bo,"
                     + "\n" + "       '2.2.1.1.2' t_line,"
                     + "\n" + "       t_column,"
                     + "\n" + "       t_account,"
                     + "\n" + "       t_accountCredit,"
                     + "\n" + "       t_clientCode,"
                     + "\n" + "       t_numbDocument,"
                     + "\n" + "       t_shifrDocument,"
                     + "\n" + "       t_dateCarry,"
                     + "\n" + "       t_fiid,"
                     + "\n" + "       t_sumRub,"
                     + "\n" + "       t_sumCurrency,"
                     + "\n" + "       t_kindA,"
                     + "\n" + "       t_chapter,"
                     + "\n" + "       t_docCount,"
                     + "\n" + "       t_errorKind,"
                     + "\n" + "       t_isInternetOrigin,"
                     + "\n" + "       t_isRemoteConnection,"
                     + "\n" + "       t_isConnection,"
                     + "\n" + "       t_isMobilePhoneConnection,"
                     + "\n" + "       t_result_carry,"
                     + "\n" + "       t_autoKey"
                     + "\n" + "  FROM df251_tmp documentData"
                     + "\n" + " WHERE t_line = '2.2.1'"
                     + "\n" + "   AND (SELECT party.t_isPhisical"
                     + "\n" + "          FROM dRepParty_vw party"
                     + "\n" + "         WHERE party.t_id = documentData.t_clientCode) = 1"
                     + "\n" + "   AND documentData.t_isMobilePhoneConnection          = 1"
                     + "\n" + "   AND documentData.t_shifrDocument                    = '01'"
                     + "\n" + "   AND documentData.t_result_carry IN (" + parameters.getElectronicDocOrigin() + ")";
        end;
    end;

    class (TDocumentQueryBuilder_2_2_1) TDocumentQueryBuilder_2_2_1_2742(line : String)
        InitTDocumentQueryBuilder_2_2_1(Line);

        m_query =         "SELECT " + BOCB + " t_backOffice,"
                 + "\n" + "       " + getSqlString(m_line) + " t_line,"
                 + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
                 + "\n" + "       documentData.t_payerAccount t_account,"
                 + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
                 + "\n" + "       documentData.t_clientCode t_clientCode,"
                 + "\n" + "       documentData.t_number t_documentNumber,"
                 + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
                 + "\n" + "       documentData.t_carryDate t_carryDate,"
                 + "\n" + "       documentData.t_fiid t_fiid,"
                 + "\n" + "       documentData.t_roubleSum,"
                 + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
                 + "\n" + "       documentData.t_sendingMode t_sendingMode,"
                 + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
                 + "\n" + "       1 t_docCount,"
                 + "\n" + "       " + m_errorKind + " t_errorKind,"
                 + "\n" + "       documentData.t_isInternetOrigin,"
                 + "\n" + "       documentData.t_isRemoteConnection,"
                 + "\n" + "       documentData.t_isConnection,"
                 + "\n" + "       documentData.t_isMobilePhoneConnection,"
                 + "\n" + "       documentData.t_result_carry,"
                 + "\n" + "       documentData.t_autoKey t_autoKey"
                 + "\n" + "  FROM df251doc_tmp documentData"
                 + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line) or (m_isNoTuneTable), "1 = 1", "1 = 0")
                 +                m_beforeI2055Mask;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_3_2742()

        macro build()
            return build()
                + "\n" + "   AND ("
                + "\n" + "                ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_debetBalance")
                + "\n" + "                 OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "            AND NOT ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.1", BOCB), "documentData.t_creditBalance")
                + "\n" + "                     OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "documentData.t_creditBalance")
                + "\n" + "                     OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("3.4", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "        OR"
                + "\n" + "                ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.3.1", BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "            AND ("    + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.1", BOCB), "documentData.t_creditBalance")
                + "\n" + "                 OR " + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.1", BOCB), "documentData.t_creditBalance") + ")"
                + "\n" + "       )"
                + "\n" + "   AND (   documentData.t_referenceNumber IN ('01','02','06','07','08')"
                + "\n" + "        OR (    documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd  IN ('01','02','06','07','08')"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + " UNION ALL"
                + "\n" + "SELECT t_bo,"
                + "\n" + "       '3.3' t_line,"
                + "\n" + "       t_column,"
                + "\n" + "       t_account,"
                + "\n" + "       t_accountCredit,"
                + "\n" + "       t_clientCode,"
                + "\n" + "       t_numbDocument,"
                + "\n" + "       t_shifrDocument,"
                + "\n" + "       t_dateCarry,"
                + "\n" + "       t_fiid,"
                + "\n" + "       t_sumRub,"
                + "\n" + "       t_sumCurrency,"
                + "\n" + "       t_kindA,"
                + "\n" + "       '3',"
                + "\n" + "       t_docCount,"
                + "\n" + "       t_errorKind,"
                + "\n" + "       t_isInternetOrigin,"
                + "\n" + "       t_isRemoteConnection,"
                + "\n" + "       t_isConnection,"
                + "\n" + "       t_isMobilePhoneConnection,"
                + "\n" + "       t_result_carry,"
                + "\n" + "       t_autoKey"
                + "\n" + "  FROM df251_tmp documentData"
                + "\n" + " WHERE t_line IN ('2.1.6', '2.2.6', '2.3.6')"
                + "\n" + "   AND t_bo = 1";
        end;

        initTDocumentQueryBuilder("3.3");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_3_3_1_2742()
        macro build()
            return       "SELECT t_bo,"
                + "\n" + "       '3.3.1' t_line,"
                + "\n" + "       t_column,"
                + "\n" + "       t_account,"
                + "\n" + "       t_accountCredit,"
                + "\n" + "       t_clientCode,"
                + "\n" + "       t_numbDocument,"
                + "\n" + "       t_shifrDocument,"
                + "\n" + "       t_dateCarry,"
                + "\n" + "       t_fiid,"
                + "\n" + "       t_sumRub,"
                + "\n" + "       t_sumCurrency,"
                + "\n" + "       t_kindA,"
                + "\n" + "       '3',"
                + "\n" + "       t_docCount,"
                + "\n" + "       t_errorKind,"
                + "\n" + "       t_isInternetOrigin,"
                + "\n" + "       t_isRemoteConnection,"
                + "\n" + "       t_isConnection,"
                + "\n" + "       t_isMobilePhoneConnection,"
                + "\n" + "       t_result_carry,"
                + "\n" + "       t_autoKey"
                + "\n" + "  FROM df251_tmp documentData"
                + "\n" + " WHERE t_line = '3.3'"
                + "\n" + "   AND (   documentData.t_result_carry IN (" + parameters.getElectronicDocOrigin() + ")"
                + "\n" + "        OR INSTR(" + getSqlString(parameters.getSendingMode()) + ", documentData.t_kindA) != 0"
                + "\n" + "       )";
        end;

        initTDocumentQueryBuilder("3.3.1");
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_1_2742()
        initTDocumentQueryBuilder("4.1.1");

        m_query =    "SELECT " + BOCB + " t_backOffice,"
            + "\n" + "       " + getSqlString(m_line) + " t_line,"
            + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
            + "\n" + "       documentData.t_payerAccount t_account,"
            + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
            + "\n" + "       documentData.t_contragentId t_clientCode,"
            + "\n" + "       documentData.t_number t_documentNumber,"
            + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
            + "\n" + "       documentData.t_carryDate t_carryDate,"
            + "\n" + "       documentData.t_fiid t_fiid,"
            + "\n" + "       documentData.t_roubleSum,"
            + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
            + "\n" + "       documentData.t_sendingMode t_sendingMode,"
            + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
            + "\n" + "       1 t_docCount,"
            + "\n" + "       " + m_errorKind + " t_errorKind,"
            + "\n" + "       documentData.t_isInternetOrigin,"
            + "\n" + "       documentData.t_isConnection,"
            + "\n" + "       documentData.t_isMobilePhoneConnection,"
            + "\n" + "       documentData.t_result_carry,"
            + "\n" + "       documentData.t_autoKey t_autoKey"
            + "\n" + "  FROM df251doc_tmp documentData LEFT JOIN"
            + "\n" + "       (SELECT paymentTable.t_paymentId, doc.t_contragentId"
            + "\n" + "          FROM dpmpaym_dbt paymentTable,"
            + "\n" + "               df251doc_tmp doc "
            + "\n" + "         WHERE doc.t_paymentId =  paymentTable.t_paymentId"
            + "\n" + "           AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "doc.t_creditBalance") + ")"
            + "\n" + "           AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "doc.t_receiverObjectId") + ")"
            + "\n" + "           AND NOT EXISTS(SELECT 1 FROM df251doc_tmp doc "
            + "\n" + "                           WHERE doc.t_paymentId =  paymentTable.t_paymentId"
            + "\n" + "                             AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "doc.t_creditBalance") + "))"
            + "\n" + "           ) paymentIdTable"
            + "\n" + "        ON documentData.t_paymentId = paymentIdTable.t_paymentId"
            + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0")
            + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "documentData.t_debetBalance")  + ")"
            + "\n" + "   AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "documentData.t_payerObjectId") + ")"
            + "\n" + "   AND (   (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.1", BOCB), "documentData.t_creditBalance") + ")"
            + "\n" + "            AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "documentData.t_receiverObjectId") + ")"
            + "\n" + "            AND (documentData.t_isDifferentContragents = 1)"
            + "\n" + "           )"
            + "\n" + "        OR (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("СНР", BOCB), "documentData.t_creditBalance") + ")"
            + "\n" + "            AND (documentData.t_paymentId   = paymentIdTable.t_paymentId)"
            + "\n" + "            AND (documentData.t_contragentId != paymentIdTable.t_contragentId)"
            + "\n" + "           )"
            + "\n" + "       )";
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_2_2742()
        initTDocumentQueryBuilder("4.1.2");

        m_query =    "SELECT " + BOCB + " t_backOffice,"
            + "\n" + "       " + getSqlString(m_line) + " t_line,"
            + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
            + "\n" + "       documentData.t_payerAccount t_account,"
            + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
            + "\n" + "       documentData.t_clientCode t_clientCode,"
            + "\n" + "       documentData.t_number t_documentNumber,"
            + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
            + "\n" + "       documentData.t_carryDate t_carryDate,"
            + "\n" + "       documentData.t_fiid t_fiid,"
            + "\n" + "       documentData.t_roubleSum,"
            + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
            + "\n" + "       documentData.t_sendingMode t_sendingMode,"
            + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
            + "\n" + "       1 t_docCount,"
            + "\n" + "       " + m_errorKind + " t_errorKind,"
            + "\n" + "       documentData.t_isInternetOrigin,"
            + "\n" + "       documentData.t_isConnection,"
            + "\n" + "       documentData.t_isMobilePhoneConnection,"
            + "\n" + "       documentData.t_result_carry,"
            + "\n" + "       documentData.t_autoKey t_autoKey"
            + "\n" + "  FROM df251doc_tmp documentData,"
            + "\n" + "       (SELECT paymentTable.t_paymentId"
            + "\n" + "          FROM dpmpaym_dbt paymentTable"
            + "\n" + "         WHERE (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.2", BOCB), "paymentTable.t_receiverAccount")
            + "\n" + "                    AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "TO_CHAR(paymentTable.t_chapter, 'FM0x') || TO_CHAR(paymentTable.t_payFiId, 'FM0xxxxxx') || paymentTable.t_receiverAccount") + ")"
            + "\n" + "                   )"
            + "\n" + "                OR EXISTS(SELECT 1 FROM df251doc_tmp doc"
            + "\n" + "                           WHERE doc.t_paymentId =  paymentTable.t_paymentId"
            + "\n" + "                             AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.2", BOCB), "doc.t_creditBalance") + ")"
            + "\n" + "                             AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "doc.t_receiverObjectId") + ")"
            + "\n" + "                          )"
            + "\n" + "               )"
            + "\n" + "           AND EXISTS(SELECT 1 FROM df251doc_tmp doc "
            + "\n" + "                       WHERE doc.t_paymentId =  paymentTable.t_paymentId"
            + "\n" + "                         AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("3.2", BOCB), "doc.t_creditBalance") + "))"
            + "\n" + "       ) paymentIdTable"
            + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0")
            + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.2", BOCB), "documentData.t_debetBalance")  + ")"
            + "\n" + "   AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "documentData.t_payerObjectId") + ")"
            + "\n" + "   AND documentData.t_paymentId = paymentIdTable.t_paymentId";
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_3_2742()
        initTDocumentQueryBuilder("4.1.3");

        m_query =    "SELECT " + BOCB + " t_backOffice,"
            + "\n" + "       " + getSqlString(m_line) + " t_line,"
            + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
            + "\n" + "       documentData.t_payerAccount t_account,"
            + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
            + "\n" + "       documentData.t_contragentId t_clientCode,"
            + "\n" + "       documentData.t_number t_documentNumber,"
            + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
            + "\n" + "       documentData.t_carryDate t_carryDate,"
            + "\n" + "       documentData.t_fiid t_fiid,"
            + "\n" + "       documentData.t_roubleSum,"
            + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
            + "\n" + "       documentData.t_sendingMode t_sendingMode,"
            + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
            + "\n" + "       1 t_docCount,"
            + "\n" + "       " + m_errorKind + " t_errorKind,"
            + "\n" + "       documentData.t_isInternetOrigin,"
            + "\n" + "       documentData.t_isConnection,"
            + "\n" + "       documentData.t_isMobilePhoneConnection,"
            + "\n" + "       documentData.t_result_carry,"
            + "\n" + "       documentData.t_autoKey t_autoKey"
            + "\n" + "  FROM df251doc_tmp documentData"
            + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0")
            + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1", BOCB), "documentData.t_debetBalance")  + ")"
            + "\n" + "   AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "documentData.t_payerObjectId") + ")"
            + "\n" + "   AND EXISTS(SELECT 1"
            + "\n" + "                FROM dpartyown_dbt partyown"
            + "\n" + "               WHERE partyown.t_partyId = documentData.t_contragentId"
            + "\n" + "                 AND partyown.t_partykind = " + RCB_PTK_BANK + ")"
            + "\n" + "   AND NOT EXISTS(SELECT 1"
            + "\n" + "                     FROM drepourbank_tmp"
            + "\n" + "                    WHERE t_partyId = documentData.t_contragentId)"
            + "\n" + "   AND (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.3", BOCB), "documentData.t_creditBalance")  + ")"
            + "\n" + "        OR (    documentData.t_paymentId IS NOT NULL"
            + "\n" + "            AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.3незав", BOCB), "documentData.t_creditBalance")  + ")"
            + "\n" + "            AND EXISTS(SELECT 1"
            + "\n" + "                         FROM dpmpaym_dbt paymentTable,"
            + "\n" + "                              df251doc_tmp bdoc"
            + "\n" + "                        WHERE paymentTable.t_paymentId = documentData.t_paymentId"
            + "\n" + "                          AND bdoc.t_paymentId = paymentTable.t_paymentId"
            + "\n" + "                          AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.3незав", BOCB), "bdoc.t_debetBalance") + ")"
            + "\n" + "                          AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1.3", BOCB), "bdoc.t_creditBalance") + "))"
            + "\n" + "           )"
            + "\n" + "       )";
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(documentTempTableInserter)
            documentTempTableInserter.insert();

            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_2_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_4_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_5_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_2_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_1_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_5_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_1_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_3_2742().build());

            sql_execute(insertClause + TDocumentQueryBuilder_2_Error().build());
        end;

        fill(TDocumentTempTableInserter_2742());
    end;
end;

class (TDataSourceCbDocuments_2742) TDataSourceCbDocuments_2926()
    initTDataSourceCbDocuments_2742();

    class (TDocumentQueryBuilder_2_1_3_2742) TDocumentQueryBuilder_2_1_3_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.3.1");
        defaultParm(debetBalanceMaskLine, "2.1.3");

        initTDocumentQueryBuilder_2_1_3_2742(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )"
                + "\n" + " AND documentData.t_result_carry IN (" + parameters.getElectronicDocOrigin() + ")";
        end;
    end;

    class (TDocumentQueryBuilder_2_1_3_2742) TDocumentQueryBuilder_2_1_3_1_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.3.1.1");
        defaultParm(debetBalanceMaskLine, "2.1.3");

        initTDocumentQueryBuilder_2_1_3_2742(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + " AND (EXISTS(SELECT 1                                                                       "
                + "\n" + "               FROM drepcategory_vw                                                         "
                + "\n" + "              WHERE drepcategory_vw.t_isForAccount          = 1                             "
                + "\n" + "                AND drepcategory_vw.t_isInstalledForEndDate = 1                             "
                + "\n" + "                AND drepcategory_vw.t_id                    = " + RCB_OBJGROUP_CONNECTION        //категория л/с Вид связи
                + "\n" + "                AND drepcategory_vw.t_value                 = 'И'                           "
                + "\n" + "                AND drepcategory_vw.t_objectId              = documentData.t_payerObjectId))"
                + "\n" + " AND documentData.t_result_carry IN (" + parameters.getElectronicDocOrigin() + ")";
        end;
    end;

    class (TDocumentQueryBuilder_2_1_4_2742) TDocumentQueryBuilder_2_1_4_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.4.1");
        defaultParm(debetBalanceMaskLine, "2.1.4");

        initTDocumentQueryBuilder_2_1_4_2742(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )"
                + "\n" + " AND documentData.t_result_carry IN (" + parameters.getElectronicDocOrigin() + ")";
        end;
    end;

    class (TDocumentQueryBuilder_2_1_6_2742) TDocumentQueryBuilder_2_1_6_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.6.1");
        defaultParm(debetBalanceMaskLine, "2.1.6");

        initTDocumentQueryBuilder_2_1_6_2742(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
        end;
    end;

    class (TDocumentQueryBuilder_2_1_2742) TDocumentQueryBuilder_2_1_6_2_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.6.2");
        initTDocumentQueryBuilder_2_1_2742(line, "2.1.6");

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "    OR (    documentData.t_referenceNumber   = '16'"
                + "\n" + "        AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + "    AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.1.6.2", BOCB), "documentData.t_creditBalance")  + ")"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("70601*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.1.6.2", BOCB), "documentData.t_receiverOpuSymbol") + "))"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("47423*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + hasAccountAssignedCategory(RCB_OBJGROUP_COMISSION, "Комиссии", "documentData.t_receiverObjectId") + "))";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder_2_1_6_2_2926) TDocumentQueryBuilder_2_1_6_2_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.1.6.2.1");
        initTDocumentQueryBuilder_2_1_6_2_2926(line, "2.1.6");

        macro build()
            return build()
                + "\n" + " AND (EXISTS(SELECT 1                                     "
                + "\n" + "       FROM                                               "
                + "\n" + "           drepcategory_vw                                "
                + "\n" + "      WHERE                                               "
                + "\n" + "           drepcategory_vw.t_isForAccount            = 1  "
                + "\n" + "       AND drepcategory_vw.t_isInstalledForEndDate   = 1  "
                + "\n" + "       AND drepcategory_vw.t_id                      = 14 "
                + "\n" + "       AND documentData.t_payerObjectId = drepcategory_vw.t_objectId)) ";
        end;
    end;

    class (TDocumentQueryBuilder_2_2_3) TDocumentQueryBuilder_2_2_3_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.2.3.1");
        defaultParm(debetBalanceMaskLine, "2.2.3");

        initTDocumentQueryBuilder_2_2_3(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )"
        end;
    end;

    class (TDocumentQueryBuilder_2_2_3) TDocumentQueryBuilder_2_2_3_1_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.2.3.1.1");
        defaultParm(debetBalanceMaskLine, "2.2.3");

        initTDocumentQueryBuilder_2_2_3(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + " AND (EXISTS(SELECT 1                                     "
                + "\n" + "       FROM                                               "
                + "\n" + "           drepcategory_vw                                "
                + "\n" + "      WHERE                                               "
                + "\n" + "           drepcategory_vw.t_isForAccount            = 1  "
                + "\n" + "       AND drepcategory_vw.t_isInstalledForEndDate   = 1  "
                + "\n" + "       AND drepcategory_vw.t_id                      = 14 "
                + "\n" + "       AND drepcategory_vw.t_value                   = 'И'"
                + "\n" + "       AND documentData.t_payerObjectId = drepcategory_vw.t_objectId)) ";

        end;
    end;

    class (TDocumentQueryBuilder_2_2_4) TDocumentQueryBuilder_2_2_4_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.2.4.1");
        defaultParm(debetBalanceMaskLine, "2.2.4");

        initTDocumentQueryBuilder_2_2_4(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
        end;
    end;

    class (TDocumentQueryBuilder_2_2_6_2539) TDocumentQueryBuilder_2_2_6_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.2.6.1");
        defaultParm(debetBalanceMaskLine, "2.2.6");

        initTDocumentQueryBuilder_2_2_6_2539(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
        end;
    end;

    class (TDocumentQueryBuilder_2_2) TDocumentQueryBuilder_2_2_6_2_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.2.6.2");
        defaultParm(debetBalanceMaskLine, "2.2.6");

        initTDocumentQueryBuilder_2_2(line, debetBalanceMaskLine);

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + "    AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.6.2", BOCB), "documentData.t_creditBalance")  + ")"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("70601*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.2.6.2", BOCB), "documentData.t_receiverOpuSymbol") + "))"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("47423*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + hasAccountAssignedCategory(RCB_OBJGROUP_COMISSION, "Комиссии", "documentData.t_receiverObjectId") + "))";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder_2_2) TDocumentQueryBuilder_2_2_6_2_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.2.6.2.1");
        defaultParm(debetBalanceMaskLine, "2.2.6");

        initTDocumentQueryBuilder_2_2(line, debetBalanceMaskLine);

        macro getCondition()
            return       "   (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "       )"
                + "\n" + "    AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("2.2.6.2", BOCB), "documentData.t_creditBalance")  + ")"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("70601*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine("2.2.6.2", BOCB), "documentData.t_receiverOpuSymbol") + "))"
                + "\n" + "    AND ( NOT (" + convertMaskToSqlFormat("47423*", "documentData.t_creditBalance")  + ")"
                + "\n" + "           OR (" + hasAccountAssignedCategory(RCB_OBJGROUP_COMISSION, "Комиссии", "documentData.t_receiverObjectId") + "))"
                + "\n" + "    AND (EXISTS(SELECT 1                                  "
                + "\n" + "       FROM                                               "
                + "\n" + "           drepcategory_vw                                "
                + "\n" + "      WHERE                                               "
                + "\n" + "           drepcategory_vw.t_isForAccount            = 1  "
                + "\n" + "       AND drepcategory_vw.t_isInstalledForEndDate   = 1  "
                + "\n" + "       AND drepcategory_vw.t_id                      = 14 "
                + "\n" + "       AND documentData.t_payerObjectId = drepcategory_vw.t_objectId)) " ;
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder_2_3_1_2332) TDocumentQueryBuilder_2_3_1_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.3.1.1");
        defaultParm(debetBalanceMaskLine, "2.3.1");
        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder_2_3_1_2332(line);

        macro getDocumentFilter(offset : String)
            var balanceMasks = tuneTable.getMaskForLine("2.1.1", BOCB) + "," + tuneTable.getMaskForLine("2.2.1", BOCB) + "," + tuneTable.getMaskForLine("3.1", BOCB)+ "," + tuneTable.getMaskForLine("3.2", BOCB) + "," + tuneTable.getMaskForLine("3.4", BOCB);

            return       "       EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "        AND (" + convertMaskToSqlFormat(balanceMasks, "documentData.t_creditBalance") + "))";
        end;

        macro build()
            return build()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
        end;
    end;

    class (TDocumentQueryBuilder_2_3_1_2332) TDocumentQueryBuilder_2_3_1_1_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.3.1.1.1");
        defaultParm(debetBalanceMaskLine, "2.3.1");
        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder_2_3_1_2332(line);

        macro getDocumentFilter(offset : String)
            var balanceMasks = tuneTable.getMaskForLine("2.1.1", BOCB) + "," + tuneTable.getMaskForLine("2.2.1", BOCB) + "," + tuneTable.getMaskForLine("3.1", BOCB)+ "," + tuneTable.getMaskForLine("3.2", BOCB) + "," + tuneTable.getMaskForLine("3.4", BOCB);

            return       "       EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "        AND (" + convertMaskToSqlFormat(balanceMasks, "documentData.t_creditBalance") + "))";
        end;

        macro build()
            return build()
                + "\n" + " AND (EXISTS(SELECT 1                                     "
                + "\n" + "       FROM                                               "
                + "\n" + "           drepcategory_vw                                "
                + "\n" + "      WHERE                                               "
                + "\n" + "           drepcategory_vw.t_isForAccount            = 1  "
                + "\n" + "       AND drepcategory_vw.t_isInstalledForEndDate   = 1  "
                + "\n" + "       AND drepcategory_vw.t_id                      = 14 "
                + "\n" + "       AND drepcategory_vw.t_value                   = 'И'"
                + "\n" + "       AND documentData.t_payerObjectId = drepcategory_vw.t_objectId)) ";
        end;
    end;

    class (TDocumentQueryBuilder_2_3_3_2332) TDocumentQueryBuilder_2_3_3_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.3.3.1");
        defaultParm(debetBalanceMaskLine, "2.3.3");
        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder_2_3_3_2332(line);

        macro getDocumentFilter(offset : String)
            var balanceMasks = tuneTable.getMaskForLine("2.1.1", BOCB) + "," + tuneTable.getMaskForLine("2.2.1", BOCB) + "," + tuneTable.getMaskForLine("3.1", BOCB)+ "," + tuneTable.getMaskForLine("3.2", BOCB) + "," + tuneTable.getMaskForLine("3.4", BOCB);

            return       "       EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "        AND (" + convertMaskToSqlFormat(balanceMasks, "documentData.t_creditBalance") + "))";
        end;

        macro build()
                return build()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
        end;
    end;

    class (TDocumentQueryBuilder_2_3_3_2332) TDocumentQueryBuilder_2_3_3_1_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.3.3.1.1");
        defaultParm(debetBalanceMaskLine, "2.3.3");
        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder_2_3_3_2332(line);

        macro getDocumentFilter(offset : String)
            var balanceMasks = tuneTable.getMaskForLine("2.1.1", BOCB) + "," + tuneTable.getMaskForLine("2.2.1", BOCB) + "," + tuneTable.getMaskForLine("3.1", BOCB)+ "," + tuneTable.getMaskForLine("3.2", BOCB) + "," + tuneTable.getMaskForLine("3.4", BOCB);

            return       "       EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "        AND (" + convertMaskToSqlFormat(balanceMasks, "documentData.t_creditBalance") + "))";
        end;

        macro build()
                return build()
                + "\n" + " AND (EXISTS(SELECT 1                                     "
                + "\n" + "       FROM                                               "
                + "\n" + "           drepcategory_vw                                "
                + "\n" + "      WHERE                                               "
                + "\n" + "           drepcategory_vw.t_isForAccount            = 1  "
                + "\n" + "       AND drepcategory_vw.t_isInstalledForEndDate   = 1  "
                + "\n" + "       AND drepcategory_vw.t_id                      = 14 "
                + "\n" + "       AND drepcategory_vw.t_value                   = 'И'"
                + "\n" + "       AND documentData.t_payerObjectId = drepcategory_vw.t_objectId)) ";
        end;
    end;

    class (TDocumentQueryBuilder_2_3_4_2332) TDocumentQueryBuilder_2_3_4_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.3.4.1");
        defaultParm(debetBalanceMaskLine, "2.3.4");
        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder_2_3_4_2332(line);

        macro getDocumentFilter(offset : String)
            var balanceMasks = tuneTable.getMaskForLine("2.1.1", BOCB) + "," + tuneTable.getMaskForLine("2.2.1", BOCB) + "," + tuneTable.getMaskForLine("3.1", BOCB)+ "," + tuneTable.getMaskForLine("3.2", BOCB) + "," + tuneTable.getMaskForLine("3.4", BOCB);

            return       "       EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (    (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance") + ")"
                + "\n" + "        AND (" + convertMaskToSqlFormat(balanceMasks, "documentData.t_creditBalance") + "))";
        end;

        macro build()
            return build()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_3_6_1_2926(line : String)
        defaultParm(line, "2.3.6.1");
        initTDocumentQueryBuilder(line);

        macro getCondition()
            return       "    EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "   )";
        end;

        macro build()
            return build()
                + "\n" + "   AND " + getCondition()
                + "\n" + " AND (   documentData.t_isRemoteConnection      = 1"
                + "\n" + "      OR documentData.t_isInternetOrigin        = 1"
                + "\n" + "      OR documentData.t_isMobilePhoneConnection = 1"
                + "\n" + "     )";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_2_3_6_2_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.3.6.2");
        defaultParm(debetBalanceMaskLine, line);
        private var m_debetBalanceMaskLine = debetBalanceMaskLine;

        initTDocumentQueryBuilder(line);

        macro getCondition()
            return       "   EXISTS(SELECT 1"
                + "\n" + "               FROM drepourbank_tmp"
                + "\n" + "              WHERE t_partyId = documentData.t_clientCode)"
                + "\n" + "   AND (   documentData.t_referenceNumber = '17'"
                + "\n" + "        OR (documentData.t_referenceNumber = '16'"
                + "\n" + "            AND documentData.t_referenceNumberPd = '17'"
                + "\n" + "           )"
                + "\n" + "   )"
                + "\n" + "   AND(" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_debetBalance")  + ")"
                + "\n" + "   AND ( NOT (" + convertMaskToSqlFormat("70606*", "documentData.t_debetBalance")  + ")"
                + "\n" + "          OR (" + convertMaskToSqlFormat(tuneTable.getSymbolMaskForLine(m_debetBalanceMaskLine, BOCB), "documentData.t_payerOpuSymbol") + "))"
                + "\n" + "   AND ( NOT (" + convertMaskToSqlFormat("47422*", "documentData.t_debetBalance")  + ")"
                + "\n" + "          OR (" + hasAccountAssignedCategory(RCB_OBJGROUP_COMISSION, "Комиссии", "documentData.t_payerObjectId") + "))";
        end;

        macro build()
            return build()
                    + "\n" + "   AND " + getCondition();
        end;
    end;

    class (TDocumentQueryBuilder_2_3_6_2_2926) TDocumentQueryBuilder_2_3_6_2_1_2926(line : String, debetBalanceMaskLine : String)
        defaultParm(line, "2.3.6.2.1");
        defaultParm(debetBalanceMaskLine, "2.3.6.2");

        initTDocumentQueryBuilder_2_3_6_2_2926(line, debetBalanceMaskLine);

        macro build()
            return build()
                + "\n" + "   AND (EXISTS(SELECT 1                                   "
                + "\n" + "       FROM                                               "
                + "\n" + "           drepcategory_vw                                "
                + "\n" + "      WHERE                                               "
                + "\n" + "           drepcategory_vw.t_isForAccount            = 1  "
                + "\n" + "       AND drepcategory_vw.t_isInstalledForEndDate   = 1  "
                + "\n" + "       AND drepcategory_vw.t_id                      = 14 "
                + "\n" + "       AND documentData.t_payerObjectId = drepcategory_vw.t_objectId)) ";
        end;
    end;

    class (TDocumentQueryBuilder) TDocumentQueryBuilder_4_1_1_2926()
        initTDocumentQueryBuilder("4.1.1");

        m_query =    "SELECT " + BOCB + " t_backOffice,"
            + "\n" + "       " + getSqlString(m_line) + " t_line,"
            + "\n" + "       DECODE(documentData.t_fiid, 0, 3, 4) t_column,"
            + "\n" + "       documentData.t_payerAccount t_account,"
            + "\n" + "       documentData.t_receiverAccount t_creditAccount,"
            + "\n" + "       documentData.t_contragentId t_contragentId,"
            + "\n" + "       documentData.t_number t_documentNumber,"
            + "\n" + "       DECODE (documentdata.t_referencenumber, 16, documentdata.t_referencenumberpd, documentdata.t_referencenumber) t_documentreferencenumber,"
            + "\n" + "       documentData.t_carryDate t_carryDate,"
            + "\n" + "       documentData.t_fiid t_fiid,"
            + "\n" + "       documentData.t_roubleSum,"
            + "\n" + "       DECODE(t_fiid, 0, 0, documentData.t_sum) t_currencySum,"
            + "\n" + "       documentData.t_sendingMode t_sendingMode,"
            + "\n" + "       SUBSTR(" + getSqlString(m_line) + ", 1, 1) t_part,"
            + "\n" + "       1 t_docCount,"
            + "\n" + "       " + m_errorKind + " t_errorKind,"
            + "\n" + "       documentData.t_isInternetOrigin,"
            + "\n" + "       documentData.t_isRemoteConnection,"
            + "\n" + "       documentData.t_isConnection,"
            + "\n" + "       documentData.t_isMobilePhoneConnection,"
            + "\n" + "       documentData.t_result_carry,"
            + "\n" + "       documentData.t_autoKey t_autoKey"
            + "\n" + "  FROM df251doc_tmp documentData"
            + "\n" + " WHERE " + ternary(tuneTable.isOn(BOCB, m_line), "1 = 1", "1 = 0")
            + "\n" + "   AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine("4.1", BOCB), "documentData.t_debetBalance")  + ")"
            + "\n" + "   AND NOT (" + hasAccountAssignedCategory(RCB_OBJGROUP_FOR_REPORTING, "Счет не ДУ КО", "documentData.t_payerObjectId") + ")"
            + "\n" + "   AND EXISTS(SELECT 1"
            + "\n" + "                FROM dpartyown_dbt partyown"
            + "\n" + "               WHERE partyown.t_partyId = documentData.t_contragentId"
            + "\n" + "                 AND partyown.t_partykind = " + RCB_PTK_BANK + ")"
            + "\n" + "   AND NOT EXISTS(SELECT 1"
            + "\n" + "                     FROM drepourbank_tmp"
            + "\n" + "                    WHERE t_partyId = documentData.t_contragentId)"
            + "\n" + "   AND (   (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "documentData.t_creditBalance")  + ")"
            + "\n" + "        OR (    documentData.t_paymentId IS NOT NULL"
            + "\n" + "            AND (" + convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line + "незав", BOCB), "documentData.t_creditBalance")  + ")"
            + "\n" + "            AND EXISTS(SELECT 1"
            + "\n" + "                         FROM dpmpaym_dbt paymentTable,"
            + "\n" + "                              df251doc_tmp bdoc"
            + "\n" + "                        WHERE paymentTable.t_paymentId = documentData.t_paymentId"
            + "\n" + "                          AND bdoc.t_paymentId = paymentTable.t_paymentId"
            + "\n" + "                          AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line + "незав", BOCB), "bdoc.t_debetBalance") + ")"
            + "\n" + "                          AND (" +convertMaskToSqlFormat(tuneTable.getMaskForLine(m_line, BOCB), "bdoc.t_creditBalance") + "))"
            + "\n" + "           )"
            + "\n" + "       )";
    end;

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(documentTempTableInserter)
            documentTempTableInserter.insert();

            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_2_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_2_1_2742("2.1.2.1","2.1.2").build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_4_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_4_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_5_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_2_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_2_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_2_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_2_1("2.2.2.1","2.2.2").build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_4_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_2_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_2_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_2_1_2332("2.3.2.1","2.3.2").build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_4_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_5_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_1_2926.build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_2_2926.build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_2_1_2926.build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_1_2926().build());

            sql_execute(insertClause + TDocumentQueryBuilder_2_Error().build());
        end;

        fill(TDocumentTempTableInserter_2742());
    end;
end;

class (TDataSourceCbDocuments_2926) TDataSourceCbDocuments_3269()
    initTDataSourceCbDocuments_2926();

    macro fillTempTable(tempTable)
        var insertClause = tempTable.getInsertClause();

        macro fill(documentTempTableInserter)
            documentTempTableInserter.insert();

            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_1_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_2_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_2_1_2742("2.1.2.1","2.1.2").build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_3_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_4_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_4_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_5_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_1_6_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_1_1_2_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_2().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_2_1("2.2.2.1","2.2.2").build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_3_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_4().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_4_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_5().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_2_6_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_1_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_2_1_2332("2.3.2.1","2.3.2").build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_3_1_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_4_1_2926().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_5_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_2539().build());
            sql_execute(insertClause + TDocumentQueryBuilder_2_3_6_1_2926.build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_1_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_2_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_3_1_2742().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_3_4_1_2332().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_2470().build());
            sql_execute(insertClause + TDocumentQueryBuilder_4_1_1_2926().build());

            sql_execute(insertClause + TDocumentQueryBuilder_2_Error().build());
        end;

        fill(TDocumentTempTableInserter_2742());
    end;
end;

/***************************************************************************************************
 *  Контроллеры расчета
 **************************************************************************************************/

private class TCalculator()
    private var m_tempTable = TTempTable();

    macro execute()
        /*var timeMarker_account = TTimeMarker(getTxtFileName("F251CalculateTimeMarker_GK_account"));
        timeMarker_account.clearFile();*/
        if   (rcbApplication().currentReport.context.period.endDate >= RCB_I4212_DATE)
            TDataSourceCbAccounts4212().fillTempTable(m_tempTable);
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I3875_DATE)
            TDataSourceCbAccounts3875().fillTempTable(m_tempTable);
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2926_DATE)
            TDataSourceCbAccounts2926().fillTempTable(m_tempTable);
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2742_DATE)
            TDataSourceCbAccounts2742().fillTempTable(m_tempTable);
        else
            TDataSourceCbAccounts().fillTempTable(m_tempTable);
        end;
        /*timeMarker_account.setMark("Расчет по счетам");*/

        /*var timeMarker_document = TTimeMarker(getTxtFileName("F251CalculateTimeMarker_GK_document"));
        timeMarker_document.clearFile();*/
        if (rcbApplication().currentReport.context.period.endDate >= RCB_I3269_DATE)
            m_tempTable = TTempTable_2742();
            TDataSourceCbDocuments_3269().fillTempTable(m_tempTable);
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2926_DATE)
            m_tempTable = TTempTable_2742();
            TDataSourceCbDocuments_2926().fillTempTable(m_tempTable);
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2742_DATE)
            m_tempTable = TTempTable_2742();
            TDataSourceCbDocuments_2742().fillTempTable(m_tempTable);
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2539_DATE)
            TDataSourceCbDocuments_2539().fillTempTable(m_tempTable);
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2470_DATE1)
            TDataSourceCbDocuments_2470().fillTempTable(m_tempTable);
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2332_DATE)
            TDataSourceCbDocuments_2332().fillTempTable(m_tempTable);
        elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2055_DATE)
            TDataSourceCbDocuments().fillTempTable(m_tempTable);
        end;
        /*timeMarker_document.setMark("Расчет по документам");*/
    end;
end;

/***************************************************************************************************
 *  Основная функция
 **************************************************************************************************/
private macro main()
    var bo_cb     = TBackOffice(BOCB);
    var tuneTable = RcbTuneTable("dt251_dbt");

    if   (rcbApplication().currentReport.context.period.endDate >= RCB_I4212_DATE)
        tuneTable.setInstructionFilter(RCB_I4212_DATE);
    elif (rcbApplication().currentReport.context.period.endDate >= RCB_I3875_DATE)
        tuneTable.setInstructionFilter(RCB_I3875_DATE2);
    elif (rcbApplication().currentReport.context.period.endDate >= RCB_I3269_DATE)
        tuneTable.setInstructionFilter(RCB_I3269_DATE);
    elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2926_DATE)
        tuneTable.setInstructionFilter(RCB_I2926_DATE);
    elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2742_DATE)
        tuneTable.setInstructionFilter(RCB_I2742_DATE);
    elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2470_DATE1)
        tuneTable.setInstructionFilter(RCB_I2470_DATE1);
    elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2332_DATE)
        tuneTable.setInstructionFilter(RCB_I2332_DATE);
    elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2055_DATE)
        tuneTable.setInstructionFilter(RCB_I2332_DATE - 1);
    end;

    if (tuneTable.hasDataFor(bo_cb, "t_backOfice"))
        TCalculator().execute();
    end;
end;

/***************************************************************************************************
 *  Точка входа
 **************************************************************************************************/

var sqlProfiler = TSqlProfiler(getTxtFileName("!sqlProfileCalc_f251cb"));
sqlProfiler.clear();
sqlProfiler.on();

/*var timeMarker = TTimeMarker(getTxtFileName("F251CalculateTimeMarker_GK"));
timeMarker.clearFile();*/
main();
/*timeMarker.setMark("Расчет по ГК");*/

УстановитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
