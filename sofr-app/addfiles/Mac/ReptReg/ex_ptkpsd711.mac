/*
$Name:          ex_ptkpsd711.mac
$Module:        Регламентируемая отчетность
$Description:   Экспорт значений переменных формы 711 в текстовый файл для ПТК ПСД
*/

/* ──────────────────────────────────────────────────────────────────────────┐
   RS-Bank 6.0                                      R-Style Software Lab Ltd
   Файл подсистемы "Регламентируемая отчетность"

   Экспорт значений переменных формы 711 в текстовый файл для ПТК ПСД

   CREATED : ДАТА ФИО

   MODIFICATIONS:
   NOTES:

└────────────────────────────────────────────────────────────────────────── */
import rcbimport;
import com_f711;
//import RcbProtocolView;
//import RcbPtkPsdExportController;
//import RcbPtkPsdView;
//import rcbConst;

/* -------------------------- Классы и переменные ------------------------- */

/**
 *  Неверное количество параметров
 */
private class (TException) TWrongParmCountException()
    initTException("Неверное количество параметров", true);
end;

/**
 *  Сортировка данных по "fieldName"
 */
class TSerialValuesSorter(fieldName)
    var m_fieldName = fieldName;
    macro isLess(val1, val2)
        return val1.fieldValue(m_fieldName).exact < val2.fieldValue(m_fieldName).exact;
    end;
end;

/**
 * Фильтр данных разделов 1.3.1 и 1.3.2 по эмитенту
 */
class TIssuerFilter(id, inn)
    var m_id = id;
    var m_inn = inn;
    macro isSuitable(val)
        return (    (m_id  == val.fieldValue("ID эмитента").current)
                and (m_inn == val.fieldValue("ИНН эмитента").current)
               );
    end;
end;

/**
 * Экспорт ф.711 в соответствии с указанием 2055-У
 */
class (TPtkPsdView) TPtkPsdExport()

    private class TIssuer(v_id : integer, v_inn : string, v_number : integer)
        var id     = v_id;
        var inn    = v_inn;
        var number = v_number;
    end;

    const TYPE_DATE   = 1;
    const TYPE_STRING = 2;
    const TYPE_NUMBER = 3;

    private var m_report : RcbReport;
    private var m_protocolView;

    private var m_rowData;   // [0] - appCode, [1] - rowCode, [2] - columnCode, [3] - value
    private var m_issuer : object;        // порядковые номера и ИНН эмитентов раздела 1.3

//    private var m_issuerId_shift;  // смещение номеров эмитентов подраздела 1.3.2

    /**
     * Установка формата экспорта даты в "ДД.ММ.ГГГГ".
     */
    macro setFullYearDateFormat()
        var day, month, year;

        DateSplit(m_reportDate, day, month, year);
        m_stringReportDate =  strLpad(string(day),   2, "0") + "."
                            + strLpad(string(month), 2, "0") + "."
                            +         string(year);
    end;

    /**
     * Получение имени файла экспорта.
     * перегруженная функция класса TPtkPsdView для доступа к "m_name"
     */
    macro getFileName()
        var day;
        var month;
        var year;

        dateSplit(m_reportDate, day, month, year);

        m_name = получитьКаталогЭкспорта() + "\\" + "711" + strLpad(String(day),   2, "0")
                                                          + strLpad(String(month), 2, "0")
                                                          + substr(string(year), 3)
                                                          + toAnsi("." + m_fileExtension);
    end;

    /**
     * Декодирование значения.
     * @param value - исходное значение.
     * @param arrFrom - массив данных с исходными значениями.
     * @param arrTo - массив данных с требуемыми значениями.
     * @param defVal - значение по умолчанию (в случае несовпадения value ни с одним из значений arrFrom), если параметр отсутствует - значение value.
     */
    private macro decode(value, arrFrom : TArray, arrTo : TArray, defVal)

        var i = 0;

        if (valType(defVal) == V_UNDEF)
            defVal = value;
        end;

        if (    (valType(arrFrom) != V_UNDEF)
            and (valType(arrTo) != V_UNDEF)
            and (arrFrom.size == arrTo.size))

            while (i < arrFrom.size)
                if (value == arrFrom[i])
                    return arrTo[i];
                end;
                i = i + 1;
            end;

            return defVal;
        else

            throw(TWrongParmCountException());
        end;
    end;

    /**
     * Форматирование даты
     * @param str - форматируемая строка
     */
    macro formatDate(str, emptyValue) : String

        var day, month, year;
        var dayStr, monthStr, yearStr;

        if (str == date(0,0,0))
            return nvl(emptyValue, "");
        end;

        dateSplit(date(str), day, month, year);
        dayStr   = string(day:2:o);
        monthStr = string(month:2:o);
        yearStr  = string(year:4:o);

        return dayStr + "." + monthStr + "." + yearStr;
    end;

    /**
     * Форматирование строки
     * @param str - форматируемая строка
     */
    macro formatString(str, emptyValue) : String
        var result;

        if ((str == null) or (str == 0) or (str == ""))
            result = nvl(emptyValue, "");
        else
            result = string(str);
        end;

        return result;
    end;

    /**
     * Форматирование числа
     * @param str - форматируемая строка
     * @param parm1 - количество знаков всего
     * @param parm2 - количество знаков после запятой (если 0 - выводится как целое)
     */
    macro formatNumber(str, parm1 : Integer, parm2 : Integer, emptyValue) : String
        var result;
        var suff = "";
        var expr = "";

        if (valType(parm1) != V_UNDEF)
            suff = suff + ":" + String(parm1);
        end;
        if (valType(parm2) != V_UNDEF)
            if (str != 0)
            suff = suff + ":" + String(parm2);
            else
                suff = suff + ":" + String(4);
            end;
        end;
        suff = suff + ")";


        if ((str != null) and (str != 0))
            expr = "string(str" + suff;
        elif (emptyValue == NULL)
            expr = "string(0.0" + suff;
        else
            return emptyValue;
        end;

        result = trim(execExp(expr));

        return result;
    end;

    macro formatNumberInt(str, parm1 : Integer, parm2 : Integer, emptyValue) : String
        var result;
        var suff = "";
        var expr = "";

        if (valType(parm1) != V_UNDEF)
            suff = suff + ":" + String(parm1);
        end;
        if (valType(parm2) != V_UNDEF)
            if (str != 0)
            suff = suff + ":" + String(parm2);
            else
                suff = suff + ":" + String(4);
            end;
        end;
        suff = suff + ")";


        if ((str != null) and (str != 0))
            expr = "string(str" + suff;
        elif (str == 0)
            expr = "string(0" + suff;
        elif (emptyValue == NULL)
            expr = "string(0.0" + suff;
        else
            return emptyValue;
        end;

        result = trim(execExp(expr));

        return result;
    end;

    /**
     * Форматирование строки для экспорта
     * @param str - форматируемая строка
     * @param type - тип формата
     * @param parm1 - количество знаков всего/длина строки для экспорта
     * @param parm2 - количество знаков после запятой (если 0 - выводится как целое)
     */
    macro format(str, type : Integer, parm1 : Integer, parm2 : Integer, emptyValue) : String

        var result;

        if (type == TYPE_DATE)
            result = formatDate(str, emptyValue);
        elif (type == TYPE_STRING)
            result = formatString(str, emptyValue);
        elif (type == TYPE_NUMBER)
            result = formatNumber(str, parm1, parm2, emptyValue);
        end;
        return result;
    end;

    macro formatInt(str, type : Integer, parm1 : Integer, parm2 : Integer, emptyValue) : String

        var result;

        result = formatNumberInt(str, parm1, parm2, emptyValue);
        return result;
    end;

    macro isResident(str)
        var data = TRsbDataset("SELECT t_isResident FROM drepparty_vw WHERE t_name = '" + str + "' AND t_isResident = 1");
        data.next;
        if (data.t_isResident != null)
            return true;
        else
            return false;
        end;

    end;

    macro processIssuer(valueIterator)

        var issuerId  = valueIterator.currentItem.fieldValue("ID эмитента").current;
        var issuerInn = valueIterator.currentItem.fieldValue("ИНН эмитента").current;
        var i = 0;

        while(i < m_issuer.size)
            if ((m_issuer[i].id == issuerId) and (m_issuer[i].inn == issuerInn))
                return m_issuer[i].number;
            end;
            i = i + 1;
        end;

        m_issuer[i] = TIssuer(issuerId, issuerInn, i + 1);
        return i + 1;
    end;

    macro findIssuer(valueIterator) // возвращаемое значение -true(найден) -false(не найден)

        var issuerId  = valueIterator.currentItem.fieldValue("ID эмитента").current;
        var issuerInn = valueIterator.currentItem.fieldValue("ИНН эмитента").current;
        var i = 0;

        while(i < m_issuer.size)
            if ((m_issuer[i].id == issuerId) and (m_issuer[i].inn == issuerInn))
                return true;
            end;
            i = i + 1;
        end;
        return false;
    end;

    macro releaseIssuerNumber(valueIterator : Object, columnCode)

        m_rowData[2] = columnCode;
        m_rowData[3] = processIssuer(valueIterator);
        printRowFromArray(m_rowData);

    end;

    macro printPureAttribute(valueIterator : Object, columnCode, fieldName, fieldType, length, digits, emptyValue)
        m_rowData[2] = columnCode;
        m_rowData[3] = format(valueIterator.currentItem.fieldValue(fieldName).current, fieldType, length, digits, emptyValue);
        printRowFromArray(m_rowData);
    end;

    macro printPureAttributeInt(valueIterator : Object, columnCode, fieldName, fieldType, length, digits, emptyValue)
        m_rowData[2] = columnCode;
        m_rowData[3] = formatInt(valueIterator.currentItem.fieldValue(fieldName).current, fieldType, length, digits, emptyValue);
        printRowFromArray(m_rowData);
    end;

    macro depo_kln()
        var i = 1;

        m_rowData[0] = "F711_11";
        m_rowData[1] = "1";

        m_rowData[2] = "npp";
        m_rowData[3] = "1";
        printRowFromArray(m_rowData);

        while (i < 10)
            m_rowData[2] = String(i);
            m_rowData[3] = m_report.attributeValue("Ф711_Гр"+String(i)).current;
            printRowFromArray(m_rowData);
            i = i + 1;
        end;
    end;

    macro depo_kon()
        var i = 10;

        m_rowData[0] = "F711_12";
        m_rowData[1] = "1";

        m_rowData[2] = "npp";
        m_rowData[3] = "1";
        printRowFromArray(m_rowData);

        while (i < 16)
            m_rowData[2] = String(i);
            m_rowData[3] = m_report.attributeValue("Ф711_Гр"+String(i)).current;
            printRowFromArray(m_rowData);
            i = i + 1;
        end;
    end;

    macro loron()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_2_1").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("Номер п/п"));

        valueIterator.moveFirst();

        m_rowData[0] = "F711_21";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = i; //String(i:5:o);

            printPureAttribute(valueIterator, "nom", "Номер п/п",                TYPE_NUMBER);
            printPureAttribute(valueIterator, "16",  "Наименование депозитария", TYPE_STRING);
            printPureAttribute(valueIterator, "17",  "Лицензия участника ОРЦБ",  TYPE_STRING);

            m_rowData[2] = "18";
            m_rowData[3] = decode(valueIterator.currentItem.fieldValue("Признак депозитария").currentAsString,
                                  arrCreate("И", "Э", "К", "Н", "Р", "Undefined"),
                                  arrCreate("0", "9", "1", "2", "3", ""));
            printRowFromArray(m_rowData);

            printPureAttribute(valueIterator, "19",  "Междепозитарный счет",     TYPE_STRING);
            printPureAttribute(valueIterator, "20",  "Количество ц/б на счете",  TYPE_NUMBER, 0, 4);

            valueIterator.moveNext();
        end;
    end;

    macro nostron()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_2_2").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("Номер п/п"));

        valueIterator.moveFirst();

        m_rowData[0] = "F711_22";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = String(i:5:o);

            printPureAttribute(valueIterator, "nom", "Номер п/п",                TYPE_NUMBER);
            printPureAttribute(valueIterator, "21",  "Наименование депозитария", TYPE_STRING);
            printPureAttribute(valueIterator, "22",  "Лицензия участника ОРЦБ",  TYPE_STRING);

            m_rowData[2] = "23";
            m_rowData[3] = decode(valueIterator.currentItem.fieldValue("Признак депозитария").currentAsString,
                                  arrCreate("И", "Э", "К", "Н", "Р", "Undefined"),
                                  arrCreate("0", "9", "1", "2", "3", ""));
            printRowFromArray(m_rowData);

            printPureAttribute(valueIterator, "24",  "Междепозитарный счет",     TYPE_STRING,NULL,NULL,"0");
            printPureAttribute(valueIterator, "25",  "Количество ц/б на счете",  TYPE_NUMBER, 0, 4);

            valueIterator.moveNext();
        end;
    end;

    macro secl_kln()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_3_1").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("Номер п/п"));

        valueIterator.first();

        m_rowData[0] = "F711_31";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = String(i:5:o);

            printPureAttribute(valueIterator,  "pn",      "Номер п/п",                TYPE_NUMBER);
            releaseIssuerNumber(valueIterator, "nom");
            printPureAttribute(valueIterator,  "26",      "Эмитент",                  TYPE_STRING);
            printPureAttribute(valueIterator,  "27",      "ИНН эмитента",             TYPE_STRING);
            printPureAttribute(valueIterator,  "28",      "Код типа ц/б",             TYPE_STRING);
            printPureAttribute(valueIterator,  "kod_idf", "Способ заполнения номера", TYPE_STRING);
            printPureAttribute(valueIterator,  "29",      "Идентификатор ц/б",        TYPE_STRING);

            m_rowData[2] = "30";
            m_rowData[3] = decode(valueIterator.currentItem.fieldValue("Валюта ц/б").currentAsString,
                                  arrCreate("810", "0"), arrCreate("643", ""));
            printRowFromArray(m_rowData);

            printPureAttribute(valueIterator,  "31",      "Номинал ц/б",              TYPE_NUMBER, 0,
                               valueIterator.currentItem.fieldValue("Точность номинала ц/б").current,"");
            printPureAttribute(valueIterator,  "32",      "Графа 32",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "33",      "Графа 33",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "34",      "Графа 34",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "35",      "Графа 35",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "36",      "Графа 36",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "37",      "Графа 37",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "38",      "Графа 38",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "39",      "Графа 39",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "40",      "Графа 40",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "41",      "Графа 41",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "42",      "Графа 42",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "43",      "Графа 43",                 TYPE_NUMBER);

            valueIterator.next();
        end;
    end;

    macro secl_kon()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_3_2").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("Номер п/п"));

        valueIterator.first();

        m_rowData[0] = "F711_32";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = String(i:5:o);

            printPureAttribute(valueIterator,  "pn",      "Номер п/п",                TYPE_NUMBER);
            releaseIssuerNumber(valueIterator, "nom");
            printPureAttribute(valueIterator,  "44",      "Эмитент",                  TYPE_STRING);
            printPureAttribute(valueIterator,  "45",      "ИНН эмитента",             TYPE_STRING);
            printPureAttribute(valueIterator,  "46",      "Код типа ц/б",             TYPE_STRING);
            printPureAttribute(valueIterator,  "kod_idf", "Способ заполнения номера", TYPE_STRING);
            printPureAttribute(valueIterator,  "47",      "Идентификатор ц/б",        TYPE_STRING);

            m_rowData[2] = "48";
            m_rowData[3] = decode(valueIterator.currentItem.fieldValue("Валюта ц/б").currentAsString,
                                  arrCreate("810", "0"), arrCreate("643", ""));
            printRowFromArray(m_rowData);

            printPureAttribute(valueIterator,  "49",      "Номинал ц/б",              TYPE_NUMBER, 0,
                               valueIterator.currentItem.fieldValue("Точность номинала ц/б").current, "");
            printPureAttribute(valueIterator,  "50",      "Графа 50",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "51",      "Графа 51",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "52",      "Графа 52",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "53",      "Графа 53",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "54",      "Графа 54",                 TYPE_NUMBER);
            printPureAttribute(valueIterator,  "55",      "Графа 55",                 TYPE_NUMBER);

            valueIterator.next();
        end;
    end;

    macro filialn()
        var valueIterator = m_report.attributeValue("Ф711_4").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("counter"));

        valueIterator.first();

        m_rowData[0] = "F711_4";
        while (not valueIterator.isDone())
            m_rowData[1] = valueIterator.currentItem.fieldValue("okatoCode").current;

            printPureAttribute(valueIterator, "npp",  "counter",     TYPE_STRING);
            printPureAttribute(valueIterator, "name", "regionName",  TYPE_STRING);
            printPureAttribute(valueIterator, "code", "okatoCode",   TYPE_STRING);
            printPureAttribute(valueIterator, "kol",  "nDepartment", TYPE_STRING);

            valueIterator.next();
        end;
    end;

    macro vek_ko_u()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_Раздел2_Подраздел1").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("counter"));

        valueIterator.first();

        m_rowData[0] = "F711_221";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = String(i:5:o);

            printPureAttribute(valueIterator,  "pn",  "counter",             TYPE_STRING);
            printPureAttribute(valueIterator,  "67",  "issuerName",          TYPE_STRING);
            printPureAttribute(valueIterator,  "68",  "code711",             TYPE_STRING);
            printPureAttribute(valueIterator,  "69",  "issuerInn",           TYPE_STRING);
            printPureAttribute(valueIterator,  "691", "issuerCountry",       TYPE_STRING);
            printPureAttribute(valueIterator,  "70",  "series",              TYPE_STRING);
            printPureAttribute(valueIterator,  "71",  "number",              TYPE_STRING);
            printPureAttribute(valueIterator,  "72",  "formNumber",          TYPE_STRING);
            printPureAttribute(valueIterator,  "73",  "issueDate",           TYPE_DATE, NULl, NULl, "00.00.0000");
            printPureAttribute(valueIterator,  "74",  "paymentTerm",         TYPE_STRING);
            printPureAttribute(valueIterator,  "75",  "faceValue",           TYPE_NUMBER);
            printPureAttribute(valueIterator,  "76",  "faceValueFiCode",     TYPE_STRING);
            printPureAttribute(valueIterator,  "77",  "dealDate",            TYPE_DATE, NULl, NULl, "00.00.0000");
            printPureAttribute(valueIterator,  "78",  "dealGround",          TYPE_STRING);
            printPureAttribute(valueIterator,  "79",  "dealAgentName",       TYPE_STRING);
            printPureAttribute(valueIterator,  "80",  "dealAgentInn",        TYPE_STRING);
            printPureAttribute(valueIterator,  "801", "dealAgentCountry",    TYPE_STRING);
            printPureAttribute(valueIterator,  "81",  "bookValue",           TYPE_NUMBER);
            printPureAttribute(valueIterator,  "82",  "interest",            TYPE_NUMBER);
            printPureAttribute(valueIterator,  "83",  "balanceAccount",      TYPE_STRING);
            printPureAttribute(valueIterator,  "84",  "storagePlaceName",    TYPE_STRING);
            printPureAttribute(valueIterator,  "85",  "storagePlaceInn",     TYPE_STRING);
            printPureAttribute(valueIterator,  "851", "storagePlaceCountry", TYPE_STRING);
            printPureAttribute(valueIterator,  "86",  "storageGround",       TYPE_STRING);
            printPureAttribute(valueIterator,  "87",  "note",                TYPE_STRING);

            valueIterator.next();
        end;
    end;

    macro vek_ko_v()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_Раздел2_Подраздел2").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("counter"));

        valueIterator.first();

        m_rowData[0] = "F711_222";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = String(i:5:o);

            printPureAttribute(valueIterator,  "pn",   "counter",            TYPE_STRING);
            printPureAttribute(valueIterator,  "89",   "series",             TYPE_STRING);
            printPureAttribute(valueIterator,  "90",   "number",             TYPE_STRING);
            printPureAttribute(valueIterator,  "91",   "formNumber",         TYPE_STRING);
            printPureAttribute(valueIterator,  "92",   "issueDate",          TYPE_DATE, NULl, NULl, "00.00.0000");
            printPureAttribute(valueIterator,  "93",   "paymentTerm",        TYPE_STRING, NULl, NULl, "00.00.0000");
            printPureAttribute(valueIterator,  "94",   "faceValue",          TYPE_NUMBER);
            printPureAttribute(valueIterator,  "95",   "faceValueFiCode",    TYPE_STRING);
            printPureAttribute(valueIterator,  "96",   "firstHolderName",    TYPE_STRING);
            printPureAttribute(valueIterator,  "97",   "firstHolderInn",     TYPE_STRING);
            printPureAttribute(valueIterator,  "971",  "firstHolderCountry", TYPE_STRING);
            printPureAttribute(valueIterator,  "98",   "state",              TYPE_STRING);
            printPureAttribute(valueIterator,  "99",   "holderName",         TYPE_STRING);
            printPureAttribute(valueIterator,  "100",  "holderInn",          TYPE_STRING);
            printPureAttribute(valueIterator,  "1001", "holderCountry",      TYPE_STRING);
            printPureAttribute(valueIterator,  "101",  "note",               TYPE_STRING);

            valueIterator.next();
        end;
    end;

    macro vek_stl()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_Раздел2_Подраздел3").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("counter"));

        valueIterator.first();

        m_rowData[0] = "F711_223";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = String(i:5:o);

            printPureAttribute(valueIterator,  "pn",   "counter",          TYPE_STRING);
            printPureAttribute(valueIterator,  "103",  "issuerName",       TYPE_STRING);
            printPureAttribute(valueIterator,  "104",  "code711",          TYPE_STRING);
            printPureAttribute(valueIterator,  "105",  "issuerInn",        TYPE_STRING);
            printPureAttribute(valueIterator,  "1051", "issuerCountry",    TYPE_STRING);
            printPureAttribute(valueIterator,  "106",  "series",           TYPE_STRING);
            printPureAttribute(valueIterator,  "107",  "number",           TYPE_STRING);
            printPureAttribute(valueIterator,  "108",  "formNumber",       TYPE_STRING);
            printPureAttribute(valueIterator,  "109",  "issueDate",        TYPE_DATE, NULl, NULl, "00.00.0000");
            printPureAttribute(valueIterator,  "110",  "paymentTerm",      TYPE_STRING);
            printPureAttribute(valueIterator,  "111",  "faceValue",        TYPE_NUMBER);
            printPureAttribute(valueIterator,  "112",  "faceValueFiCode",  TYPE_STRING);
            printPureAttribute(valueIterator,  "113",  "dealDate",         TYPE_DATE, NULl, NULl, "00.00.0000");
            printPureAttribute(valueIterator,  "114",  "dealGround",       TYPE_STRING);
            printPureAttribute(valueIterator,  "115",  "holderName",       TYPE_STRING);
            printPureAttribute(valueIterator,  "116",  "holderInn",        TYPE_STRING);
            printPureAttribute(valueIterator,  "1161", "holderCountry",    TYPE_STRING);
            printPureAttribute(valueIterator,  "117",  "note",             TYPE_STRING);

            valueIterator.next();
        end;
    end;

    // Ведомость эмитентов
    macro issuers_list();
        var i;
        var valueIterator;
        var issuerId;

        m_rowData[0] = "F711_3";

        i = 0;
        while (i < m_issuer.size)

            m_rowData[1] = "";

            // Ищем эмитента среди данных 1.3.1
            valueIterator = m_report.attributeValue("Ф711_3_1").createValueIterator();
            valueIterator.setFilter(TIssuerFilter(m_issuer[i].id, m_issuer[i].inn));
            valueIterator.first();
            if (not valueIterator.isDone())
                m_rowData[1] = string(m_issuer[i].number : 5 : o);
            end;

            // Ищем эмитента среди данных 1.3.2, если его вдруг не оказалось в 1.3.1
            if (m_rowData[1] == "")
                valueIterator = m_report.attributeValue("Ф711_3_2").createValueIterator();
                valueIterator.setFilter(TIssuerFilter(m_issuer[i].id, m_issuer[i].inn));
                valueIterator.first();
                if (not valueIterator.isDone())
                    m_rowData[1] = string(m_issuer[i].number : 5 : o);
                end;
            end;

            if (m_rowData[1] != "")
                m_rowData[2] = "nom";
                m_rowData[3] = m_issuer[i].number;
                printRowFromArray(m_rowData);

                printPureAttribute(valueIterator, "$name$", "Эмитент",      TYPE_STRING);
                printPureAttribute(valueIterator, "kod",    "ИНН эмитента", TYPE_STRING);
                printPureAttribute(valueIterator, "tip",    "Тип эмитента", TYPE_STRING);
            else
                println("Не найден эмитент Id: ", m_issuer[i].id, ", ИНН: '", m_issuer[i].inn, "', номер: ", m_issuer[i].number);
            end;

            i = i + 1;
        end;
    end;

    private macro getDescriptorInfo()
        return "";
    end;

    private macro getProtocolView()
        m_protocolView = TProtocolView("ПРОТОКОЛ ЭКСПОРТА В АС ПСД", "Форма 711. Депозитарный отчет");
        m_protocolView.setProtocolOutput(false);

        m_protocolView.printHead();
        m_protocolView.printLine("Альбом форм АС ПСД: " + getDescriptorInfo());
        m_protocolView.printLine("Файл экспорта: " + String(m_name));
        m_protocolView.printLine("Выгружено строк: " + String(m_RowsCount));

        m_protocolView.resetProtocolOutput();

        m_protocolView.show();
    end;

    macro export()

/*Раздел 1.1*/
        depo_kln();
        depo_kon();
        /*Раздел 1.2*/
        loron();
        nostron();
        /*Раздел 1.3*/
        secl_kln();
        secl_kon();
        /*Раздел 1.4*/
        filialn();
/*Раздел 2.1*/
        vek_ko_u();
        /*Раздел 2.2*/
        vek_ko_v();
        /*Раздел 2.3*/
        vek_stl();
/*Ведомость эмитентов*/
        issuers_list();

        resetOutputFile();
        getProtocolView();
    end;

    macro constructor()
        m_report = RcbApplication().currentReport;

        initTPtkPsdView("txt", m_report.context.period.endDate + 1); //ДООП + 1
        setFullYearDateFormat();
        getFileName();

        m_rowData = TArray(4);   // [0] - appCode, [1] - rowCode, [2] - columnCode, [3] - value
        m_issuer = TArray;

        setOutputFile();
    end;

    constructor()
end;

/**
 * Экспорт ф.711 в соответствии с указанием 2627-У
 *
 * @author SER
 * @since 6.00.020.30
 */
class (TPtkPsdExport) TPtkPsdExport_I2627()
    initTPtkPsdExport();

    private macro getDescriptorInfo()
        return "";
    end;

    macro constructor()
        m_report = RcbApplication().currentReport;

        initTPtkPsdView("txt", m_report.context.period.endDate + 1, "rsansi"); //ДООП + 1
        setFullYearDateFormat();
        getFileName();

        m_rowData = TArray(4);   // [0] - appCode, [1] - rowCode, [2] - columnCode, [3] - value
        m_issuer = TArray;

        setOutputFile();
    end;

    macro depo_kln()
        var i = 1;

        m_rowData[0] = "F711_11";
        m_rowData[1] = "1";

        m_rowData[3] = "1";

        while (i < 10)
            m_rowData[2] = String(i);
            m_rowData[3] = m_report.attributeValue("Ф711_Гр"+String(i)).current;
            printRowFromArray(m_rowData);
            i = i + 1;
        end;
    end;

    macro depo_kon()
        var i = 10;

        m_rowData[0] = "F711_12";
        m_rowData[1] = "1";

        m_rowData[3] = "1";

        while (i < 16)
            m_rowData[2] = String(i);
            m_rowData[3] = m_report.attributeValue("Ф711_Гр"+String(i)).current;
            printRowFromArray(m_rowData);
            i = i + 1;
        end;
    end;

    macro loron()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_2_1").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("Номер п/п"));

        valueIterator.moveFirst();

        m_rowData[0] = "F711_21";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = i;

            printPureAttribute(valueIterator, "nom", "Номер п/п",                TYPE_NUMBER);
            printPureAttribute(valueIterator, "16",  "Наименование депозитария", TYPE_STRING);
            printPureAttribute(valueIterator, "17",  "Лицензия участника ОРЦБ",  TYPE_STRING);

            m_rowData[2] = "18";
            m_rowData[3] = decode(valueIterator.currentItem.fieldValue("Признак депозитария").currentAsString,
                                  arrCreate("И", "Э", "К", "Н", "Р", "Undefined"),
                                  arrCreate("0", "9", "1", "2", "3", ""));
            printRowFromArray(m_rowData);

            printPureAttribute(valueIterator, "19",  "Междепозитарный счет",     TYPE_STRING);
            printPureAttributeInt(valueIterator, "20",  "Количество ц/б на счете",  TYPE_NUMBER);

            valueIterator.moveNext();
        end;
    end;

    macro nostron()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_2_2").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("Номер п/п"));

        valueIterator.moveFirst();

        m_rowData[0] = "F711_22";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = String(i:5:o);

            printPureAttribute(valueIterator, "nom", "Номер п/п",                TYPE_NUMBER);
            printPureAttribute(valueIterator, "21",  "Наименование депозитария", TYPE_STRING);
            printPureAttribute(valueIterator, "22",  "Лицензия участника ОРЦБ",  TYPE_STRING);

            m_rowData[2] = "23";
            m_rowData[3] = decode(valueIterator.currentItem.fieldValue("Признак депозитария").currentAsString,
                                  arrCreate("И", "Э", "К", "Н", "Р", "Undefined"),
                                  arrCreate("0", "9", "1", "2", "3", ""));
            printRowFromArray(m_rowData);

            printPureAttribute(valueIterator, "24",  "Междепозитарный счет",     TYPE_STRING,NULL,NULL,"0");
            printPureAttributeInt(valueIterator, "25",  "Количество ц/б на счете",  TYPE_NUMBER);

            valueIterator.moveNext();
        end;
    end;

    macro secl_kln()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_3_1").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("Номер п/п"));

        valueIterator.first();

        m_rowData[0] = "F711_31";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = String(i:5:o);

            printPureAttribute(valueIterator,  "pn",      "Номер п/п",                TYPE_NUMBER);
            releaseIssuerNumber(valueIterator, "nom");
            printPureAttribute(valueIterator,  "26",      "Эмитент",                  TYPE_STRING);
            printPureAttribute(valueIterator,  "27",      "ИНН эмитента",             TYPE_STRING);
            printPureAttribute(valueIterator,  "28",      "Код типа ц/б",             TYPE_STRING);
            printPureAttribute(valueIterator,  "kod_idf", "Способ заполнения номера", TYPE_STRING);
            printPureAttribute(valueIterator,  "29",      "Идентификатор ц/б",        TYPE_STRING);

            m_rowData[2] = "30";
            m_rowData[3] = decode(valueIterator.currentItem.fieldValue("Валюта ц/б").currentAsString,
                                  arrCreate("810", "0"), arrCreate("643", ""));
            printRowFromArray(m_rowData);

            if (valueIterator.currentItem.fieldValue("Номинал ц/б").current != 0)
                printPureAttribute(valueIterator,  "31",      "Номинал ц/б",              TYPE_NUMBER, 0,
                                   valueIterator.currentItem.fieldValue("Точность номинала ц/б").current,"");
            end;

            printPureAttributeInt(valueIterator,  "32",      "Графа 32",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "33",      "Графа 33",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "34",      "Графа 34",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "35",      "Графа 35",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "36",      "Графа 36",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "37",      "Графа 37",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "38",      "Графа 38",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "39",      "Графа 39",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "40",      "Графа 40",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "41",      "Графа 41",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "42",      "Графа 42",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "43",      "Графа 43",                 TYPE_NUMBER);

            valueIterator.next();
        end;
    end;

    macro secl_kon()
        var i = 0;
        var valueIterator = m_report.attributeValue("Ф711_3_2").createValueIterator();
        valueIterator.setSortOrder(TSerialValuesSorter("Номер п/п"));

        valueIterator.first();

        m_rowData[0] = "F711_32";
        while (not valueIterator.isDone())
            i = i + 1;
            m_rowData[1] = String(i:5:o);

            printPureAttribute(valueIterator,  "pn",      "Номер п/п",                TYPE_NUMBER);
            releaseIssuerNumber(valueIterator, "nom");
            printPureAttribute(valueIterator,  "44",      "Эмитент",                  TYPE_STRING);
            printPureAttribute(valueIterator,  "45",      "ИНН эмитента",             TYPE_STRING);
            printPureAttribute(valueIterator,  "46",      "Код типа ц/б",             TYPE_STRING);
            printPureAttribute(valueIterator,  "kod_idf", "Способ заполнения номера", TYPE_STRING);
            printPureAttribute(valueIterator,  "47",      "Идентификатор ц/б",        TYPE_STRING);

            m_rowData[2] = "48";
            m_rowData[3] = decode(valueIterator.currentItem.fieldValue("Валюта ц/б").currentAsString,
                                  arrCreate("810", "0"), arrCreate("643", ""));
            printRowFromArray(m_rowData);

            if (valueIterator.currentItem.fieldValue("Номинал ц/б").current != 0)
                printPureAttribute(valueIterator,  "49",      "Номинал ц/б",              TYPE_NUMBER, 0,
                                    valueIterator.currentItem.fieldValue("Точность номинала ц/б").current, "");
            end;

            printPureAttributeInt(valueIterator,  "50",      "Графа 50",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "51",      "Графа 51",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "52",      "Графа 52",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "53",      "Графа 53",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "54",      "Графа 54",                 TYPE_NUMBER);
            printPureAttributeInt(valueIterator,  "55",      "Графа 55",                 TYPE_NUMBER);

            printPureAttribute(valueIterator,  "62",      "Графа 62",                 TYPE_STRING);

            if (isResident(valueIterator.currentItem.fieldValue("Графа 62").current))
                printPureAttribute(valueIterator,  "63",      "Графа 63",                 TYPE_NUMBER);
            else
                printPureAttribute(valueIterator,  "63С",      "Графа 63",                 TYPE_NUMBER);
            end;

            if (valueIterator.currentItem.fieldValue("Графа 64").current != "")
                printPureAttribute(valueIterator,  "64",      "Графа 64",                 TYPE_NUMBER);
            end;

            printPureAttribute(valueIterator,  "65",      "Графа 65",                 TYPE_STRING);
            valueIterator.next();
        end;

    end;

    macro export()

/*Раздел 1.1*/
        depo_kln();
        depo_kon();
        /*Раздел 1.2*/
        loron();
        nostron();
        /*Раздел 1.3*/
        secl_kln();
        secl_kon();
/*Раздел 2.1*/
        vek_ko_u();
        /*Раздел 2.2*/
        vek_ko_v();
        /*Раздел 2.3*/
        vek_stl();
/*Ведомость эмитентов*/
        issuers_list();

        resetOutputFile();
        getProtocolView();
    end;
end;

class (TPtkPsdExport) TPtkPsdExport_I3269()
    initTPtkPsdExport();

    private class TSyncSorterPart()
        macro isLess(lhs : Object, rhs : Object)
            return nvl(lhs.fieldValue("counter").exact, -1) < nvl(rhs.fieldValue("counter").exact, -1);
        end;
    end;

    private macro getDescriptorInfo()
        return "Alb2_2_4 от 12.01.2015";
    end;

    macro constructor()
        m_report = RcbApplication().currentReport;

        initTPtkPsdView("txt", m_report.context.period.endDate + 1, "rsansi"); //ДООП + 1
        setFullYearDateFormat();
        getFileName();

        m_rowData = TArray(4);   // [0] - appCode, [1] - rowCode, [2] - columnCode, [3] - value
        m_issuer = TArray;

        setOutputFile();
    end;

    macro printPart11()
        var it = m_report.attributeValue("Ф711_Раздел1_Подраздел_1_1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0101";
        var rowCode = "1.1.00001";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "1", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "2", it.currentItem.fieldValue("КорреспНаим").current);
                printString(appCode, rowCode, "2PZ", it.currentItem.fieldValue("КорреспИНН_Признак").current);
                if (it.currentItem.fieldValue("КорреспИНН_Признак").current == "1")
                    printString(appCode, rowCode, "3", it.currentItem.fieldValue("КорреспИНН").current);
                else
                    printString(appCode, rowCode, "3", "");
                end;
                if (it.currentItem.fieldValue("КорреспИНН_Признак").current == "2")
                    printString(appCode, rowCode, "3TIN", it.currentItem.fieldValue("КорреспИНН_TIN").current);
                else
                    printString(appCode, rowCode, "3TIN", "");
                end;
                printString(appCode, rowCode, "4", it.currentItem.fieldValue("КорреспКПП").current);
                printString(appCode, rowCode, "5", it.currentItem.fieldValue("КорреспОГРН").current);
                printString(appCode, rowCode, "6", it.currentItem.fieldValue("КорреспОКСМ").current);
                printString(appCode, rowCode, "7", it.currentItem.fieldValue("КорреспНомерЛицензии").current);
                printString(appCode, rowCode, "8", it.currentItem.fieldValue("КорреспПризнак").current);
                printString(appCode, rowCode, "9", it.currentItem.fieldValue("КорреспНомерСчета").current);
                printString(appCode, rowCode, "10", it.currentItem.fieldValue("ЭмитентНаименование").current);
                printString(appCode, rowCode, "10PZ", it.currentItem.fieldValue("ЭмитентИНН_Признак").current);
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "1") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "3"))
                    printString(appCode, rowCode, "11", it.currentItem.fieldValue("ЭмитентИНН").current);
                else
                    printString(appCode, rowCode, "11", "");
                end;
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "2") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "4"))
                    printString(appCode, rowCode, "11TIN", it.currentItem.fieldValue("ЭмитентИНН_TIN").current);
                else
                    printString(appCode, rowCode, "11TIN", "");
                end;
                printString(appCode, rowCode, "12", it.currentItem.fieldValue("ЭмитентКПП").current);
                printString(appCode, rowCode, "13", it.currentItem.fieldValue("ЭмитентОГРН").current);
                printString(appCode, rowCode, "14", it.currentItem.fieldValue("ЭмитентОКСМ").current);
                printString(appCode, rowCode, "15", it.currentItem.fieldValue("ЦБКодТипа").current);
                printString(appCode, rowCode, "16", it.currentItem.fieldValue("ЦБНомерГосРег").current);
                printString(appCode, rowCode, "17", it.currentItem.fieldValue("ЦБISIN").current);
                printString(appCode, rowCode, "18", it.currentItem.fieldValue("ЦБВалюта").current);
                printString(appCode, rowCode, "19", it.currentItem.fieldValue("ЦБНоминал").current);
                printString(appCode, rowCode, "20", String(it.currentItem.fieldValue("КоличествоПоСчету").current:0:6));
                printString(appCode, rowCode, "21", it.currentItem.fieldValue("МХНаименование").current);
                printString(appCode, rowCode, "21PZ", it.currentItem.fieldValue("МХИНН_Признак").current);
                printString(appCode, rowCode, "22", it.currentItem.fieldValue("МХПризнак").current);
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "1")
                    printString(appCode, rowCode, "23", it.currentItem.fieldValue("МХИНН").current);
                else
                    printString(appCode, rowCode, "23", "");
                end;
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "2")
                    printString(appCode, rowCode, "23TIN", it.currentItem.fieldValue("МХИНН_TIN").current);
                else
                    printString(appCode, rowCode, "23TIN", "");
                end;
                printString(appCode, rowCode, "24", it.currentItem.fieldValue("МХКПП").current);
                printString(appCode, rowCode, "25", it.currentItem.fieldValue("МХОГРН").current);
                printString(appCode, rowCode, "26", it.currentItem.fieldValue("МХОКСМ").current);
                printString(appCode, rowCode, "27", it.currentItem.fieldValue("МХНомерЛицензии").current);
                printString(appCode, rowCode, "28", it.currentItem.fieldValue("МХНомерСчёта").current);

                it.moveNext();
            end;
        end;
    end;

    macro printPart12()
        var it = m_report.attributeValue("Ф711_Раздел1_Подраздел_1_2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0102";
        var rowCode = "1.2.00029";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "29", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "30", it.currentItem.fieldValue("ЭмитентНаименование").current);
                printString(appCode, rowCode, "30PZ", it.currentItem.fieldValue("ЭмитентИНН_Признак").current);
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "1") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "3"))
                    printString(appCode, rowCode, "31", it.currentItem.fieldValue("ЭмитентИНН").current);
                else
                    printString(appCode, rowCode, "31", "");
                end;
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "2") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "4"))
                    printString(appCode, rowCode, "31TIN", it.currentItem.fieldValue("ЭмитентИНН_TIN").current);
                else
                    printString(appCode, rowCode, "31TIN", "");
                end;
                printString(appCode, rowCode, "32", it.currentItem.fieldValue("ЭмитентКПП").current);
                printString(appCode, rowCode, "33", it.currentItem.fieldValue("ЭмитентОГРН").current);
                printString(appCode, rowCode, "34", it.currentItem.fieldValue("ЭмитентОКСМ").current);
                printString(appCode, rowCode, "35", it.currentItem.fieldValue("ЦБКодТипа").current);
                printString(appCode, rowCode, "36", it.currentItem.fieldValue("ЦБНомерГосРег").current);
                printString(appCode, rowCode, "37", it.currentItem.fieldValue("ЦБISIN").current);
                printString(appCode, rowCode, "38", it.currentItem.fieldValue("ЦБВалюта").current);
                printString(appCode, rowCode, "39", it.currentItem.fieldValue("ЦБНоминал").current);
                printString(appCode, rowCode, "40", it.currentItem.fieldValue("ВидСчётаДепо").current);
                printString(appCode, rowCode, "41", String(it.currentItem.fieldValue("КоличествоПоСчету").current:0:6));
                printString(appCode, rowCode, "42", it.currentItem.fieldValue("Владелец_СекторЭкономики").current);
                printString(appCode, rowCode, "43", it.currentItem.fieldValue("МХНаименование").current);
                printString(appCode, rowCode, "43PZ", it.currentItem.fieldValue("МХИНН_Признак").current);
                printString(appCode, rowCode, "44", it.currentItem.fieldValue("МХПризнак").current);
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "1")
                    printString(appCode, rowCode, "45", it.currentItem.fieldValue("МХИНН").current);
                else
                    printString(appCode, rowCode, "45", "");
                end;
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "2")
                    printString(appCode, rowCode, "45TIN", it.currentItem.fieldValue("МХИНН_TIN").current);
                else
                    printString(appCode, rowCode, "45TIN", "");
                end;
                printString(appCode, rowCode, "46", it.currentItem.fieldValue("МХКПП").current);
                printString(appCode, rowCode, "47", it.currentItem.fieldValue("МХОГРН").current);
                printString(appCode, rowCode, "48", it.currentItem.fieldValue("МХОКСМ").current);
                printString(appCode, rowCode, "49", it.currentItem.fieldValue("МХНомерЛицензии").current);

                it.moveNext();
            end;
        end;
    end;

    macro printPart13()
        var it = m_report.attributeValue("Ф711_Раздел1_Подраздел_1_3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0103";
        var rowCode = "1.3.00050";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "50", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "51", it.currentItem.fieldValue("ЭмитентНаименование").current);
                printString(appCode, rowCode, "51PZ", it.currentItem.fieldValue("ЭмитентИНН_Признак").current);
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "1") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "3"))
                    printString(appCode, rowCode, "52", it.currentItem.fieldValue("ЭмитентИНН").current);
                else
                    printString(appCode, rowCode, "52", "");
                end;
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "2") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "4"))
                    printString(appCode, rowCode, "52TIN", it.currentItem.fieldValue("ЭмитентИНН_TIN").current);
                else
                    printString(appCode, rowCode, "52TIN", "");
                end;
                printString(appCode, rowCode, "53", it.currentItem.fieldValue("ЭмитентКПП").current);
                printString(appCode, rowCode, "54", it.currentItem.fieldValue("ЭмитентОГРН").current);
                printString(appCode, rowCode, "55", it.currentItem.fieldValue("ЭмитентОКСМ").current);
                printString(appCode, rowCode, "56", it.currentItem.fieldValue("ЦБКодТипа").current);
                printString(appCode, rowCode, "57", it.currentItem.fieldValue("ЦБНомерГосРег").current);
                printString(appCode, rowCode, "58", it.currentItem.fieldValue("ЦБISIN").current);
                printString(appCode, rowCode, "59", it.currentItem.fieldValue("ЦБВалюта").current);
                printString(appCode, rowCode, "60", it.currentItem.fieldValue("ЦБНоминал").current);
                printString(appCode, rowCode, "61", String(it.currentItem.fieldValue("СвоиЦБ_Всего").current:0:6));
                printString(appCode, rowCode, "62", String(it.currentItem.fieldValue("СвоиЦБ_ОснБаланс").current:0:6));
                printString(appCode, rowCode, "63", String(it.currentItem.fieldValue("СвоиЦБ_РЕПО_БПП").current:0:6));
                printString(appCode, rowCode, "64", String(it.currentItem.fieldValue("СвоиЦБ_Займ").current:0:6));
                printString(appCode, rowCode, "65", String(it.currentItem.fieldValue("СвоиЦБ_ОбязОтсутств").current:0:6));
                printString(appCode, rowCode, "66", String(it.currentItem.fieldValue("СвоиЦБ_Безнадежн").current:0:6));
                printString(appCode, rowCode, "67", String(it.currentItem.fieldValue("СвоиЦБ_ЗачислОшибочно").current:0:6));
                printString(appCode, rowCode, "68", String(it.currentItem.fieldValue("СвоиЦБ_ИныеПричины").current:0:6));
                printString(appCode, rowCode, "69", String(it.currentItem.fieldValue("СвоиЦБ_ДУ").current:0:6));
                printString(appCode, rowCode, "70", String(it.currentItem.fieldValue("СвоиЦБ_КазнСчета").current:0:6));
                printString(appCode, rowCode, "71", String(it.currentItem.fieldValue("СвоиЦБ_Залог").current:0:6));
                printString(appCode, rowCode, "72", String(it.currentItem.fieldValue("СвоиЦБ_Эмисс").current:0:6));
                printString(appCode, rowCode, "73", it.currentItem.fieldValue("МХНаименование").current);
                printString(appCode, rowCode, "73PZ", it.currentItem.fieldValue("МХИНН_Признак").current);
                printString(appCode, rowCode, "74", it.currentItem.fieldValue("МХПризнак").current);
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "1")
                    printString(appCode, rowCode, "75", it.currentItem.fieldValue("МХИНН").current);
                else
                    printString(appCode, rowCode, "75", "");
                end;
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "2")
                    printString(appCode, rowCode, "75TIN", it.currentItem.fieldValue("МХИНН_TIN").current);
                else
                    printString(appCode, rowCode, "75TIN", "");
                end;
                printString(appCode, rowCode, "76", it.currentItem.fieldValue("МХКПП").current);
                printString(appCode, rowCode, "77", it.currentItem.fieldValue("МХОГРН").current);
                printString(appCode, rowCode, "78", it.currentItem.fieldValue("МХОКСМ").current);
                printString(appCode, rowCode, "79", it.currentItem.fieldValue("МХНомерЛицензии").current);

                it.moveNext();
            end;
        end;
    end;

    macro printPart14()
        var it = m_report.attributeValue("Ф711_Раздел1_Подраздел_1_4").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0104";
        var rowCode = "1.4.00080";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "80", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "81", it.currentItem.fieldValue("ЭмитентНаименование").current);
                printString(appCode, rowCode, "81PZ", it.currentItem.fieldValue("ЭмитентИНН_Признак").current);
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "1") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "3"))
                    printString(appCode, rowCode, "82", it.currentItem.fieldValue("ЭмитентИНН").current);
                else
                    printString(appCode, rowCode, "82", "");
                end;
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "2") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "4"))
                    printString(appCode, rowCode, "82TIN", it.currentItem.fieldValue("ЭмитентИНН_TIN").current);
                else
                    printString(appCode, rowCode, "82TIN", "");
                end;
                printString(appCode, rowCode, "83", it.currentItem.fieldValue("ЭмитентОГРН").current);
                printString(appCode, rowCode, "84", it.currentItem.fieldValue("ЭмитентКПП").current);
                printString(appCode, rowCode, "85", it.currentItem.fieldValue("ЭмитентОКСМ").current);
                printString(appCode, rowCode, "86", it.currentItem.fieldValue("ЦБКодТипа").current);
                printString(appCode, rowCode, "87", it.currentItem.fieldValue("ЦБНомерГосРег").current);
                printString(appCode, rowCode, "88", it.currentItem.fieldValue("ЦБISIN").current);
                printString(appCode, rowCode, "89", String(it.currentItem.fieldValue("ОбъемВложений").current / 1000 : 0 : *, 4));

                it.moveNext();
            end;
        end;
    end;

    macro printPart21()
        var it = m_report.attributeValue("Ф711_Раздел2_Подраздел1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0201";
        var rowCode = "2.1.00090";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "90", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "91", it.currentItem.fieldValue("issuerName").current);
                printString(appCode, rowCode, "91PZ", it.currentItem.fieldValue("IssuerINN_Mark").current);
                if ((it.currentItem.fieldValue("IssuerINN_Mark").current == "1") or (it.currentItem.fieldValue("IssuerINN_Mark").current == "3"))
                    printString(appCode, rowCode, "92", it.currentItem.fieldValue("issuerInn").current);
                else
                    printString(appCode, rowCode, "92", "");
                end;
                if ((it.currentItem.fieldValue("IssuerINN_Mark").current == "2") or (it.currentItem.fieldValue("IssuerINN_Mark").current == "4"))
                    printString(appCode, rowCode, "92TIN", it.currentItem.fieldValue("IssuerINN_TIN").current);
                else
                    printString(appCode, rowCode, "92TIN", "");
                end;
                printString(appCode, rowCode, "93", it.currentItem.fieldValue("issuerOgrn").current);
                printString(appCode, rowCode, "94", it.currentItem.fieldValue("issuerOksm").current);
                printString(appCode, rowCode, "95", it.currentItem.fieldValue("code711").current);
                printString(appCode, rowCode, "96", it.currentItem.fieldValue("series").current);
                printString(appCode, rowCode, "97", it.currentItem.fieldValue("number").current);
                printString(appCode, rowCode, "98", it.currentItem.fieldValue("formNumber").current);
                printString(appCode, rowCode, "99", it.currentItem.fieldValue("issueDate").current);
                printString(appCode, rowCode, "100", it.currentItem.fieldValue("paymentTerm").current);
                printString(appCode, rowCode, "101", it.currentItem.fieldValue("faceValueFiCode").current);
                printString(appCode, rowCode, "102", String(it.currentItem.fieldValue("faceValue").current:0:4));
                printString(appCode, rowCode, "103", it.currentItem.fieldValue("dealDate").current);
                printString(appCode, rowCode, "104", it.currentItem.fieldValue("dealGround").current);
                printString(appCode, rowCode, "105", it.currentItem.fieldValue("dealAgentName").current);
                printString(appCode, rowCode, "105PZ", it.currentItem.fieldValue("DealAgentINN_Mark").current);
                if ((it.currentItem.fieldValue("DealAgentINN_Mark").current == "1") or (it.currentItem.fieldValue("DealAgentINN_Mark").current == "3"))
                    printString(appCode, rowCode, "106", it.currentItem.fieldValue("dealAgentInn").current);
                else
                    printString(appCode, rowCode, "106", "");
                end;
                if ((it.currentItem.fieldValue("DealAgentINN_Mark").current == "2") or (it.currentItem.fieldValue("DealAgentINN_Mark").current == "4"))
                    printString(appCode, rowCode, "106TIN", it.currentItem.fieldValue("DealAgentINN_TIN").current);
                else
                    printString(appCode, rowCode, "106TIN", "");
                end;
                printString(appCode, rowCode, "107", it.currentItem.fieldValue("dealAgentOGRN").current);
                printString(appCode, rowCode, "108", it.currentItem.fieldValue("dealAgentCountryCodeOksm").current);
                printString(appCode, rowCode, "109", String(it.currentItem.fieldValue("bookValue").current:0:4));
                printString(appCode, rowCode, "110", String(it.currentItem.fieldValue("interest").current:0:4));
                printString(appCode, rowCode, "111", it.currentItem.fieldValue("balanceAccount").current);
                printString(appCode, rowCode, "112", it.currentItem.fieldValue("storagePlaceName").current);
                if ((it.currentItem.fieldValue("StoragePlaceINN_Mark").current == "1") or (it.currentItem.fieldValue("StoragePlaceINN_Mark").current == "3"))
                    printString(appCode, rowCode, "113", it.currentItem.fieldValue("storagePlaceInn").current);
                else
                    printString(appCode, rowCode, "113", "");
                end;
                printString(appCode, rowCode, "113PZ", it.currentItem.fieldValue("StoragePlaceINN_Mark").current);
                if ((it.currentItem.fieldValue("StoragePlaceINN_Mark").current == "2") or (it.currentItem.fieldValue("StoragePlaceINN_Mark").current == "4"))
                    printString(appCode, rowCode, "113TIN", it.currentItem.fieldValue("StoragePlaceINN_TIN").current);
                else
                    printString(appCode, rowCode, "113TIN", "");
                end;
                printString(appCode, rowCode, "114", it.currentItem.fieldValue("storagePlaceOGRN").current);
                printString(appCode, rowCode, "115", it.currentItem.fieldValue("StoragePlaceCountryCode2").current);
                printString(appCode, rowCode, "116", it.currentItem.fieldValue("storageGround").current);
                printString(appCode, rowCode, "117", it.currentItem.fieldValue("note").current);

                it.moveNext();
            end;
        end;
    end;

    macro printPart22()
        var it = m_report.attributeValue("Ф711_Раздел2_Подраздел2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0202";
        var rowCode = "2.2.00118";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "118", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "119", it.currentItem.fieldValue("series").current);
                printString(appCode, rowCode, "120", it.currentItem.fieldValue("number").current);
                printString(appCode, rowCode, "121", it.currentItem.fieldValue("formNumber").current);
                printString(appCode, rowCode, "122", it.currentItem.fieldValue("issueDate").current);
                printString(appCode, rowCode, "123", it.currentItem.fieldValue("paymentTerm").current);
                printString(appCode, rowCode, "124", String(it.currentItem.fieldValue("faceValue").current:0:4));
                printString(appCode, rowCode, "125", it.currentItem.fieldValue("faceValueFiCode").current);
                printString(appCode, rowCode, "126", it.currentItem.fieldValue("firstHolderName").current);
                printString(appCode, rowCode, "126PZ", it.currentItem.fieldValue("FirstHolderINN_Mark").current);
                if ((it.currentItem.fieldValue("FirstHolderINN_Mark").current == "1") or (it.currentItem.fieldValue("FirstHolderINN_Mark").current == "3"))
                    printString(appCode, rowCode, "127", it.currentItem.fieldValue("firstHolderInn").current);
                else
                    printString(appCode, rowCode, "127", "");
                end;
                if ((it.currentItem.fieldValue("FirstHolderINN_Mark").current == "2") or (it.currentItem.fieldValue("FirstHolderINN_Mark").current == "4"))
                    printString(appCode, rowCode, "127TIN", it.currentItem.fieldValue("FirstHolderINN_TIN").current);
                else
                    printString(appCode, rowCode, "127TIN", "");
                end;
                printString(appCode, rowCode, "128", it.currentItem.fieldValue("firstHolderOGRN").current);
                printString(appCode, rowCode, "129", it.currentItem.fieldValue("firstHolderCountryCode2").current);
                printString(appCode, rowCode, "130", it.currentItem.fieldValue("state").current);
                printString(appCode, rowCode, "131", it.currentItem.fieldValue("repaymentDate").current);
                printString(appCode, rowCode, "132", it.currentItem.fieldValue("holderName").current);
                printString(appCode, rowCode, "132PZ", it.currentItem.fieldValue("HolderINN_Mark").current);
                if ((it.currentItem.fieldValue("HolderINN_Mark").current == "1") or (it.currentItem.fieldValue("HolderINN_Mark").current == "3"))
                    printString(appCode, rowCode, "133", it.currentItem.fieldValue("holderInn").current);
                else
                    printString(appCode, rowCode, "133", "");
                end;
                if ((it.currentItem.fieldValue("HolderINN_Mark").current == "2") or (it.currentItem.fieldValue("HolderINN_Mark").current == "4"))
                    printString(appCode, rowCode, "133TIN", it.currentItem.fieldValue("HolderINN_TIN").current);
                else
                    printString(appCode, rowCode, "133TIN", "");
                end;
                printString(appCode, rowCode, "134", it.currentItem.fieldValue("holderOgrn").current);
                printString(appCode, rowCode, "135", it.currentItem.fieldValue("holderCountryCodeOksm").current);
                printString(appCode, rowCode, "136", it.currentItem.fieldValue("note").current);

                it.moveNext();
            end;
        end;
    end;

    macro printPart23()
        var it = m_report.attributeValue("Ф711_Раздел2_Подраздел3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0203";
        var rowCode = "2.3.00137";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "137", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "138", it.currentItem.fieldValue("issuerName").current);
                printString(appCode, rowCode, "138PZ", it.currentItem.fieldValue("IssuerINN_Mark").current);
                if ((it.currentItem.fieldValue("IssuerINN_Mark").current == "1") or (it.currentItem.fieldValue("IssuerINN_Mark").current == "3"))
                    printString(appCode, rowCode, "139", it.currentItem.fieldValue("issuerInn").current);
                else
                    printString(appCode, rowCode, "139", "");
                end;
                if ((it.currentItem.fieldValue("IssuerINN_Mark").current == "2") or (it.currentItem.fieldValue("IssuerINN_Mark").current == "4"))
                    printString(appCode, rowCode, "139TIN", it.currentItem.fieldValue("IssuerINN_TIN").current);
                else
                    printString(appCode, rowCode, "139TIN", "");
                end;
                printString(appCode, rowCode, "140", it.currentItem.fieldValue("issuerOgrn").current);
                printString(appCode, rowCode, "141", it.currentItem.fieldValue("issuerOksm").current);
                printString(appCode, rowCode, "142", it.currentItem.fieldValue("code711").current);
                printString(appCode, rowCode, "143", it.currentItem.fieldValue("series").current);
                printString(appCode, rowCode, "144", it.currentItem.fieldValue("number").current);
                printString(appCode, rowCode, "145", it.currentItem.fieldValue("formNumber").current);
                printString(appCode, rowCode, "146", it.currentItem.fieldValue("issueDate").current);
                printString(appCode, rowCode, "147", it.currentItem.fieldValue("paymentTerm").current);
                printString(appCode, rowCode, "148", String(it.currentItem.fieldValue("faceValue").current:0:4));
                printString(appCode, rowCode, "149", it.currentItem.fieldValue("faceValueFiCode").current);
                printString(appCode, rowCode, "150", it.currentItem.fieldValue("dealDate").current);
                printString(appCode, rowCode, "151", it.currentItem.fieldValue("dealGround").current);
                printString(appCode, rowCode, "152", it.currentItem.fieldValue("holderName").current);
                printString(appCode, rowCode, "152PZ", it.currentItem.fieldValue("HolderINN_Mark").current);
                if ((it.currentItem.fieldValue("HolderINN_Mark").current == "1") or (it.currentItem.fieldValue("HolderINN_Mark").current == "3"))
                    printString(appCode, rowCode, "153", it.currentItem.fieldValue("holderInn").current);
                else
                    printString(appCode, rowCode, "153", "");
                end;
                if ((it.currentItem.fieldValue("HolderINN_Mark").current == "2") or (it.currentItem.fieldValue("HolderINN_Mark").current == "4"))
                    printString(appCode, rowCode, "153TIN", it.currentItem.fieldValue("HolderINN_TIN").current);
                else
                    printString(appCode, rowCode, "153TIN", "");
                end;
                printString(appCode, rowCode, "154", it.currentItem.fieldValue("HolderOgrn").current);
                printString(appCode, rowCode, "155", it.currentItem.fieldValue("HolderCountryCodeOksm").current);
                printString(appCode, rowCode, "156", it.currentItem.fieldValue("note").current);

                it.moveNext();
            end;
        end;
    end;

    macro export()
        printPart11();
        printPart12();
        printPart13();
        printPart14();
        printPart21();
        printPart22();
        printPart23();

        resetOutputFile();
        getProtocolView();
    end;
end;

class (TPtkPsdExport_I3269) TPtkPsdExport_I4212()
    initTPtkPsdExport_I3269();

    private macro getDescriptorInfo()
        return "Формат экспорта доработан по метаданным 0mvht в соответствии с Указанием № 4212-У";
    end;

    macro printPart11()
        var it = m_report.attributeValue("Ф711_Раздел1_Подраздел_1_1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0101";
        var rowCode = "1.1.00001";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "1", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "2", it.currentItem.fieldValue("КорреспНаим").current);
                printString(appCode, rowCode, "2PZ", it.currentItem.fieldValue("КорреспИНН_Признак").current);
                if (it.currentItem.fieldValue("КорреспИНН_Признак").current == "1")
                    printString(appCode, rowCode, "3", it.currentItem.fieldValue("КорреспИНН").current);
                else
                    printString(appCode, rowCode, "3", "");
                end;
                if (it.currentItem.fieldValue("КорреспИНН_Признак").current == "2")
                    printString(appCode, rowCode, "3TIN", it.currentItem.fieldValue("КорреспИНН_TIN").current);
                else
                    printString(appCode, rowCode, "3TIN", "");
                end;
                printString(appCode, rowCode, "4", it.currentItem.fieldValue("КорреспКПП").current);
                printString(appCode, rowCode, "5", it.currentItem.fieldValue("КорреспОГРН").current);
                printString(appCode, rowCode, "6", it.currentItem.fieldValue("КорреспОКСМ").current);
                printString(appCode, rowCode, "7", it.currentItem.fieldValue("КорреспНомерЛицензии").current);
                printString(appCode, rowCode, "8", it.currentItem.fieldValue("КорреспПризнак").current);
                printString(appCode, rowCode, "9", it.currentItem.fieldValue("КорреспНомерСчета").current);
                printString(appCode, rowCode, "10", it.currentItem.fieldValue("ЭмитентНаименование").current);
                printString(appCode, rowCode, "10PZ", it.currentItem.fieldValue("ЭмитентИНН_Признак").current);
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "1") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "3"))
                    printString(appCode, rowCode, "11", it.currentItem.fieldValue("ЭмитентИНН").current);
                else
                    printString(appCode, rowCode, "11", "");
                end;
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "2") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "4"))
                    printString(appCode, rowCode, "11TIN", it.currentItem.fieldValue("ЭмитентИНН_TIN").current);
                else
                    printString(appCode, rowCode, "11TIN", "");
                end;
                printString(appCode, rowCode, "12", it.currentItem.fieldValue("ЭмитентКПП").current);
                printString(appCode, rowCode, "13", it.currentItem.fieldValue("ЭмитентОГРН").current);
                printString(appCode, rowCode, "14", it.currentItem.fieldValue("ЭмитентОКСМ").current);
                printString(appCode, rowCode, "15", it.currentItem.fieldValue("ЦБКодТипа").current);
                printString(appCode, rowCode, "16", it.currentItem.fieldValue("ЦБНомерГосРег").current);
                printString(appCode, rowCode, "17", it.currentItem.fieldValue("ЦБISIN").current);
                printString(appCode, rowCode, "18", it.currentItem.fieldValue("ЦБВалюта").current);
                printString(appCode, rowCode, "19", it.currentItem.fieldValue("ЦБНоминал").current);
                printString(appCode, rowCode, "20", String(it.currentItem.fieldValue("КоличествоПоСчету").current:0:6));
                printString(appCode, rowCode, "21", String(it.currentItem.fieldValue("ВсегоОбрем").current:0:6));
                printString(appCode, rowCode, "22", String(it.currentItem.fieldValue("Залог").current:0:6));
                printString(appCode, rowCode, "23", String(it.currentItem.fieldValue("ТогрСчета").current:0:6));
                printString(appCode, rowCode, "24", String(it.currentItem.fieldValue("ОгранКД").current:0:6));
                printString(appCode, rowCode, "25", String(it.currentItem.fieldValue("ЗапретОпер").current:0:6));
                printString(appCode, rowCode, "26", String(it.currentItem.fieldValue("Арест").current:0:6));
                printString(appCode, rowCode, "27", it.currentItem.fieldValue("МХНаименование").current);
                printString(appCode, rowCode, "27PZ", it.currentItem.fieldValue("МХИНН_Признак").current);
                printString(appCode, rowCode, "28", it.currentItem.fieldValue("МХПризнак").current);
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "1")
                    printString(appCode, rowCode, "29", it.currentItem.fieldValue("МХИНН").current);
                else
                    printString(appCode, rowCode, "29", "");
                end;
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "2")
                    printString(appCode, rowCode, "29TIN", it.currentItem.fieldValue("МХИНН_TIN").current);
                else
                    printString(appCode, rowCode, "29TIN", "");
                end;
                printString(appCode, rowCode, "30", it.currentItem.fieldValue("МХКПП").current);
                printString(appCode, rowCode, "31", it.currentItem.fieldValue("МХОГРН").current);
                printString(appCode, rowCode, "32", it.currentItem.fieldValue("МХОКСМ").current);
                printString(appCode, rowCode, "33", it.currentItem.fieldValue("МХНомерЛицензии").current);
                printString(appCode, rowCode, "34", it.currentItem.fieldValue("МХНомерСчёта").current);

                it.moveNext();
            end;
        end;
    end;

    macro printPart12()
        var it = m_report.attributeValue("Ф711_Раздел1_Подраздел_1_2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0102";
        var rowCode = "1.2.00086";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "35", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "36", it.currentItem.fieldValue("ЭмитентНаименование").current);
                printString(appCode, rowCode, "36PZ", it.currentItem.fieldValue("ЭмитентИНН_Признак").current);
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "1") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "3"))
                    printString(appCode, rowCode, "37", it.currentItem.fieldValue("ЭмитентИНН").current);
                else
                    printString(appCode, rowCode, "37", "");
                end;
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "2") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "4"))
                    printString(appCode, rowCode, "37TIN", it.currentItem.fieldValue("ЭмитентИНН_TIN").current);
                else
                    printString(appCode, rowCode, "37TIN", "");
                end;
                printString(appCode, rowCode, "38", it.currentItem.fieldValue("ЭмитентКПП").current);
                printString(appCode, rowCode, "39", it.currentItem.fieldValue("ЭмитентОГРН").current);
                printString(appCode, rowCode, "40", it.currentItem.fieldValue("ЭмитентОКСМ").current);
                printString(appCode, rowCode, "41", it.currentItem.fieldValue("ЦБКодТипа").current);
                printString(appCode, rowCode, "42", it.currentItem.fieldValue("ЦБНомерГосРег").current);
                printString(appCode, rowCode, "43", it.currentItem.fieldValue("ЦБISIN").current);
                printString(appCode, rowCode, "44", it.currentItem.fieldValue("ЦБВалюта").current);
                printString(appCode, rowCode, "45", it.currentItem.fieldValue("ЦБНоминал").current);
                printString(appCode, rowCode, "46", it.currentItem.fieldValue("ВидСчётаДепо").current);
                printString(appCode, rowCode, "47", String(it.currentItem.fieldValue("КоличествоПоСчету").current:0:6));
                printString(appCode, rowCode, "48", String(it.currentItem.fieldValue("ВсегоОбрем").current:0:6));
                printString(appCode, rowCode, "49", String(it.currentItem.fieldValue("Залог").current:0:6));
                printString(appCode, rowCode, "50", String(it.currentItem.fieldValue("ТогрСчета").current:0:6));
                printString(appCode, rowCode, "51", String(it.currentItem.fieldValue("ОгранКД").current:0:6));
                printString(appCode, rowCode, "52", String(it.currentItem.fieldValue("ЗапретОпер").current:0:6));
                printString(appCode, rowCode, "53", String(it.currentItem.fieldValue("Арест").current:0:6));
                printString(appCode, rowCode, "54", it.currentItem.fieldValue("Владелец_СекторЭкономики").current);
                printString(appCode, rowCode, "55", it.currentItem.fieldValue("СВ_ОКМС").current);
                printString(appCode, rowCode, "56", it.currentItem.fieldValue("МХНаименование").current);
                printString(appCode, rowCode, "56PZ", it.currentItem.fieldValue("МХИНН_Признак").current);
                printString(appCode, rowCode, "57", it.currentItem.fieldValue("МХПризнак").current);
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "1")
                    printString(appCode, rowCode, "58", it.currentItem.fieldValue("МХИНН").current);
                else
                    printString(appCode, rowCode, "58", "");
                end;
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "2")
                    printString(appCode, rowCode, "58TIN", it.currentItem.fieldValue("МХИНН_TIN").current);
                else
                    printString(appCode, rowCode, "58TIN", "");
                end;
                printString(appCode, rowCode, "59", it.currentItem.fieldValue("МХКПП").current);
                printString(appCode, rowCode, "60", it.currentItem.fieldValue("МХОГРН").current);
                printString(appCode, rowCode, "61", it.currentItem.fieldValue("МХОКСМ").current);
                printString(appCode, rowCode, "62", it.currentItem.fieldValue("МХНомерЛицензии").current);

                it.moveNext();
            end;
        end;
    end;

    macro printPart13()
        var it = m_report.attributeValue("Ф711_Раздел1_Подраздел_1_3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0103";
        var rowCode = "1.3.00001";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "63", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "64", it.currentItem.fieldValue("ЭмитентНаименование").current);
                printString(appCode, rowCode, "64PZ", it.currentItem.fieldValue("ЭмитентИНН_Признак").current);
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "1") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "3"))
                    printString(appCode, rowCode, "65", it.currentItem.fieldValue("ЭмитентИНН").current);
                else
                    printString(appCode, rowCode, "65", "");
                end;
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "2") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "4"))
                    printString(appCode, rowCode, "65TIN", it.currentItem.fieldValue("ЭмитентИНН_TIN").current);
                else
                    printString(appCode, rowCode, "65TIN", "");
                end;
                printString(appCode, rowCode, "66", it.currentItem.fieldValue("ЭмитентКПП").current);
                printString(appCode, rowCode, "67", it.currentItem.fieldValue("ЭмитентОГРН").current);
                printString(appCode, rowCode, "68", it.currentItem.fieldValue("ЭмитентОКСМ").current);
                printString(appCode, rowCode, "69", it.currentItem.fieldValue("ЦБКодТипа").current);
                printString(appCode, rowCode, "70", it.currentItem.fieldValue("ЦБНомерГосРег").current);
                printString(appCode, rowCode, "71", it.currentItem.fieldValue("ЦБISIN").current);
                printString(appCode, rowCode, "72", it.currentItem.fieldValue("ЦБВалюта").current);
                printString(appCode, rowCode, "73", it.currentItem.fieldValue("ЦБНоминал").current);
                printString(appCode, rowCode, "74", String(it.currentItem.fieldValue("СвоиЦБ_Всего").current:0:6));
                printString(appCode, rowCode, "75", String(it.currentItem.fieldValue("СвоиЦБ_ОснБаланс").current:0:6));
                printString(appCode, rowCode, "76", String(it.currentItem.fieldValue("СвоиЦБ_РЕПО_БПП").current:0:6));
                printString(appCode, rowCode, "77", String(it.currentItem.fieldValue("СвоиЦБ_Займ").current:0:6));
                printString(appCode, rowCode, "78", String(it.currentItem.fieldValue("СвоиЦБ_ОбязОтсутств").current:0:6));
                printString(appCode, rowCode, "79", String(it.currentItem.fieldValue("СвоиЦБ_Безнадежн").current:0:6));
                printString(appCode, rowCode, "80", String(it.currentItem.fieldValue("СвоиЦБ_ЗачислОшибочно").current:0:6));
                printString(appCode, rowCode, "81", String(it.currentItem.fieldValue("СвоиЦБ_ИныеПричины").current:0:6));
                printString(appCode, rowCode, "82", String(it.currentItem.fieldValue("СвоиЦБ_ДУ").current:0:6));
                printString(appCode, rowCode, "83", String(it.currentItem.fieldValue("СвоиЦБ_КазнСчета").current:0:6));
                printString(appCode, rowCode, "84", String(it.currentItem.fieldValue("СвоиЦБ_Залог").current:0:6));
                printString(appCode, rowCode, "85", String(it.currentItem.fieldValue("СвоиЦБ_Эмисс").current:0:6));
                printString(appCode, rowCode, "86", it.currentItem.fieldValue("МХНаименование").current);
                printString(appCode, rowCode, "86PZ", it.currentItem.fieldValue("МХИНН_Признак").current);
                printString(appCode, rowCode, "87", it.currentItem.fieldValue("МХПризнак").current);
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "1")
                    printString(appCode, rowCode, "88", it.currentItem.fieldValue("МХИНН").current);
                else
                    printString(appCode, rowCode, "88", "");
                end;
                if (it.currentItem.fieldValue("МХИНН_Признак").current == "2")
                    printString(appCode, rowCode, "88TIN", it.currentItem.fieldValue("МХИНН_TIN").current);
                else
                    printString(appCode, rowCode, "88TIN", "");
                end;
                printString(appCode, rowCode, "89", it.currentItem.fieldValue("МХКПП").current);
                printString(appCode, rowCode, "90", it.currentItem.fieldValue("МХОГРН").current);
                printString(appCode, rowCode, "91", it.currentItem.fieldValue("МХОКСМ").current);
                printString(appCode, rowCode, "92", it.currentItem.fieldValue("МХНомерЛицензии").current);

                it.moveNext();
            end;
        end;
    end;

    macro printPart14()
        var it = m_report.attributeValue("Ф711_Раздел1_Подраздел_1_4").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0104";
        var rowCode = "1.4.00001";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "93", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "94", it.currentItem.fieldValue("ЭмитентНаименование").current);
                printString(appCode, rowCode, "94PZ", it.currentItem.fieldValue("ЭмитентИНН_Признак").current);
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "1") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "3"))
                    printString(appCode, rowCode, "95", it.currentItem.fieldValue("ЭмитентИНН").current);
                else
                    printString(appCode, rowCode, "95", "");
                end;
                if ((it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "2") or (it.currentItem.fieldValue("ЭмитентИНН_Признак").current == "4"))
                    printString(appCode, rowCode, "95TIN", it.currentItem.fieldValue("ЭмитентИНН_TIN").current);
                else
                    printString(appCode, rowCode, "95TIN", "");
                end;
                printString(appCode, rowCode, "96", it.currentItem.fieldValue("ЭмитентОГРН").current);
                printString(appCode, rowCode, "97", it.currentItem.fieldValue("ЭмитентКПП").current);
                printString(appCode, rowCode, "98", it.currentItem.fieldValue("ЭмитентОКСМ").current);
                printString(appCode, rowCode, "99", it.currentItem.fieldValue("ЦБКодТипа").current);
                printString(appCode, rowCode, "100", it.currentItem.fieldValue("ЦБНомерГосРег").current);
                printString(appCode, rowCode, "101", it.currentItem.fieldValue("ЦБISIN").current);
                printString(appCode, rowCode, "102", String(it.currentItem.fieldValue("ОбъемВложений").current / 1000 : 0 : *, 4));

                it.moveNext();
            end;
        end;
    end;

    macro printPart21()
        var it = m_report.attributeValue("Ф711_Раздел2_Подраздел1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0201";
        var rowCode = "1.4.00001";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "104", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "105", it.currentItem.fieldValue("issuerName").current);
                printString(appCode, rowCode, "105PZ", it.currentItem.fieldValue("IssuerINN_Mark").current);
                if ((it.currentItem.fieldValue("IssuerINN_Mark").current == "1") or (it.currentItem.fieldValue("IssuerINN_Mark").current == "3"))
                    printString(appCode, rowCode, "106", it.currentItem.fieldValue("issuerInn").current);
                else
                    printString(appCode, rowCode, "106", "");
                end;
                if ((it.currentItem.fieldValue("IssuerINN_Mark").current == "2") or (it.currentItem.fieldValue("IssuerINN_Mark").current == "4"))
                    printString(appCode, rowCode, "106TIN", it.currentItem.fieldValue("IssuerINN_TIN").current);
                else
                    printString(appCode, rowCode, "106TIN", "");
                end;
                printString(appCode, rowCode, "107", it.currentItem.fieldValue("issuerOgrn").current);
                printString(appCode, rowCode, "108", it.currentItem.fieldValue("issuerOksm").current);
                printString(appCode, rowCode, "109", it.currentItem.fieldValue("code711").current);
                printString(appCode, rowCode, "110", it.currentItem.fieldValue("series").current);
                printString(appCode, rowCode, "111", it.currentItem.fieldValue("number").current);
                printString(appCode, rowCode, "112", it.currentItem.fieldValue("formNumber").current);
                printString(appCode, rowCode, "113", it.currentItem.fieldValue("issueDate").current);
                printString(appCode, rowCode, "114", it.currentItem.fieldValue("paymentTerm").current);
                printString(appCode, rowCode, "115", it.currentItem.fieldValue("TermDate1").current);
                printString(appCode, rowCode, "116", it.currentItem.fieldValue("TermDate2").current);
                printString(appCode, rowCode, "117", String(it.currentItem.fieldValue("PercentRate").current:0:3));
                printString(appCode, rowCode, "118", String(it.currentItem.fieldValue("faceValue").current:0:4));
                printString(appCode, rowCode, "119", it.currentItem.fieldValue("faceValueFiCode").current);
                printString(appCode, rowCode, "120", String(it.currentItem.fieldValue("BuyCost").current:0:4));
                printString(appCode, rowCode, "121", String(it.currentItem.fieldValue("BalanceCost").current:0:4));
                printString(appCode, rowCode, "122", String(it.currentItem.fieldValue("interest").current:0:4));
                printString(appCode, rowCode, "123", it.currentItem.fieldValue("QualityCateg").current);
                printString(appCode, rowCode, "124", String(it.currentItem.fieldValue("ReserveSum").current:0:4));
                printString(appCode, rowCode, "125", it.currentItem.fieldValue("dealDate").current);
                printString(appCode, rowCode, "126", it.currentItem.fieldValue("dealGround").current);
                printString(appCode, rowCode, "127", it.currentItem.fieldValue("dealAgentName").current);
                printString(appCode, rowCode, "127PZ", it.currentItem.fieldValue("DealAgentINN_Mark").current);
                if ((it.currentItem.fieldValue("DealAgentINN_Mark").current == "1") or (it.currentItem.fieldValue("DealAgentINN_Mark").current == "3"))
                    printString(appCode, rowCode, "128", it.currentItem.fieldValue("dealAgentInn").current);
                else
                    printString(appCode, rowCode, "128", "");
                end;
                if ((it.currentItem.fieldValue("DealAgentINN_Mark").current == "2") or (it.currentItem.fieldValue("DealAgentINN_Mark").current == "4"))
                    printString(appCode, rowCode, "128TIN", it.currentItem.fieldValue("DealAgentINN_TIN").current);
                else
                    printString(appCode, rowCode, "128TIN", "");
                end;
                printString(appCode, rowCode, "129", it.currentItem.fieldValue("dealAgentOGRN").current);
                printString(appCode, rowCode, "130", it.currentItem.fieldValue("dealAgentCountryCodeOksm").current);
                printString(appCode, rowCode, "131", it.currentItem.fieldValue("balanceAccount").current);
                printString(appCode, rowCode, "132", it.currentItem.fieldValue("storagePlaceName").current);
                if ((it.currentItem.fieldValue("StoragePlaceINN_Mark").current == "1") or (it.currentItem.fieldValue("StoragePlaceINN_Mark").current == "3"))
                    printString(appCode, rowCode, "133", it.currentItem.fieldValue("storagePlaceInn").current);
                else
                    printString(appCode, rowCode, "133", "");
                end;
                printString(appCode, rowCode, "133PZ", it.currentItem.fieldValue("StoragePlaceINN_Mark").current);
                if ((it.currentItem.fieldValue("StoragePlaceINN_Mark").current == "2") or (it.currentItem.fieldValue("StoragePlaceINN_Mark").current == "4"))
                    printString(appCode, rowCode, "133TIN", it.currentItem.fieldValue("StoragePlaceINN_TIN").current);
                else
                    printString(appCode, rowCode, "133TIN", "");
                end;
                printString(appCode, rowCode, "134", it.currentItem.fieldValue("storagePlaceOGRN").current);
                printString(appCode, rowCode, "135", it.currentItem.fieldValue("StoragePlaceCountryCode2").current);
                printString(appCode, rowCode, "136", it.currentItem.fieldValue("storageGround").current);
                printString(appCode, rowCode, "137", it.currentItem.fieldValue("SaleCost").current);
                printString(appCode, rowCode, "138", it.currentItem.fieldValue("SaleDate").current);
                printString(appCode, rowCode, "139", it.currentItem.fieldValue("SaleGround").current);
                printString(appCode, rowCode, "140", it.currentItem.fieldValue("SaleAgentName").current);
                printString(appCode, rowCode, "140PZ", it.currentItem.fieldValue("SaleAgentINN_Mark").current);
                if ((it.currentItem.fieldValue("SaleAgentINN_Mark").current == "1") or (it.currentItem.fieldValue("SaleAgentINN_Mark").current == "3"))
                    printString(appCode, rowCode, "141", it.currentItem.fieldValue("SaleAgentINN").current);
                else
                    printString(appCode, rowCode, "141", "");
                end;
                if ((it.currentItem.fieldValue("SaleAgentINN_Mark").current == "2") or (it.currentItem.fieldValue("SaleAgentINN_Mark").current == "4"))
                    printString(appCode, rowCode, "141TIN", it.currentItem.fieldValue("SaleAgentINN_TIN").current);
                else
                    printString(appCode, rowCode, "141TIN", "");
                end;
                printString(appCode, rowCode, "142", it.currentItem.fieldValue("SaleAgentOGRN").current);
                printString(appCode, rowCode, "143", it.currentItem.fieldValue("SaleAgentCountryCode").current);
                printString(appCode, rowCode, "144", it.currentItem.fieldValue("note").current);

                it.moveNext();
            end;
        end;
    end;
    macro printPart22()
        var it = m_report.attributeValue("Ф711_Раздел2_Подраздел2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0202";
        var rowCode = "2.2.00118";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "145", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "146", it.currentItem.fieldValue("series").current);
                printString(appCode, rowCode, "147", it.currentItem.fieldValue("number").current);
                printString(appCode, rowCode, "148", it.currentItem.fieldValue("formNumber").current);
                printString(appCode, rowCode, "149", it.currentItem.fieldValue("issueDate").current);
                printString(appCode, rowCode, "150", it.currentItem.fieldValue("paymentTerm").current);
                printString(appCode, rowCode, "151", it.currentItem.fieldValue("TermDate1").current);
                printString(appCode, rowCode, "152", it.currentItem.fieldValue("TermDate2").current);
                printString(appCode, rowCode, "153", String(it.currentItem.fieldValue("PercentRate").current:0:3));
                printString(appCode, rowCode, "154", String(it.currentItem.fieldValue("faceValue").current:0:4));
                printString(appCode, rowCode, "155", it.currentItem.fieldValue("faceValueFiCode").current);
                printString(appCode, rowCode, "156", it.currentItem.fieldValue("SaleCost").current);
                printString(appCode, rowCode, "157", it.currentItem.fieldValue("firstHolderName").current);
                printString(appCode, rowCode, "157PZ", it.currentItem.fieldValue("FirstHolderINN_Mark").current);
                if ((it.currentItem.fieldValue("FirstHolderINN_Mark").current == "1") or (it.currentItem.fieldValue("FirstHolderINN_Mark").current == "3"))
                    printString(appCode, rowCode, "158", it.currentItem.fieldValue("firstHolderInn").current);
                else
                    printString(appCode, rowCode, "158", "");
                end;
                if ((it.currentItem.fieldValue("FirstHolderINN_Mark").current == "2") or (it.currentItem.fieldValue("FirstHolderINN_Mark").current == "4"))
                    printString(appCode, rowCode, "158TIN", it.currentItem.fieldValue("FirstHolderINN_TIN").current);
                else
                    printString(appCode, rowCode, "158TIN", "");
                end;
                printString(appCode, rowCode, "159", it.currentItem.fieldValue("firstHolderOGRN").current);
                printString(appCode, rowCode, "160", it.currentItem.fieldValue("firstHolderCountryCode2").current);
                printString(appCode, rowCode, "161", it.currentItem.fieldValue("state").current);
                printString(appCode, rowCode, "162", it.currentItem.fieldValue("repaymentDate").current);
                printString(appCode, rowCode, "163", it.currentItem.fieldValue("holderName").current);
                printString(appCode, rowCode, "163PZ", it.currentItem.fieldValue("HolderINN_Mark").current);
                if ((it.currentItem.fieldValue("HolderINN_Mark").current == "1") or (it.currentItem.fieldValue("HolderINN_Mark").current == "3"))
                    printString(appCode, rowCode, "164", it.currentItem.fieldValue("holderInn").current);
                else
                    printString(appCode, rowCode, "164", "");
                end;
                if ((it.currentItem.fieldValue("HolderINN_Mark").current == "2") or (it.currentItem.fieldValue("HolderINN_Mark").current == "4"))
                    printString(appCode, rowCode, "164TIN", it.currentItem.fieldValue("HolderINN_TIN").current);
                else
                    printString(appCode, rowCode, "164TIN", "");
                end;
                printString(appCode, rowCode, "165", it.currentItem.fieldValue("holderOgrn").current);
                printString(appCode, rowCode, "166", it.currentItem.fieldValue("holderCountryCodeOksm").current);
                printString(appCode, rowCode, "167", it.currentItem.fieldValue("note").current);

                it.moveNext();
            end;
        end;
    end;

    macro printPart23()
        var it = m_report.attributeValue("Ф711_Раздел2_Подраздел3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0203";
        var rowCode = "2.3.00001";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                printString(appCode, rowCode, "168", it.currentItem.fieldValue("counter").current);
                printString(appCode, rowCode, "169", it.currentItem.fieldValue("issuerName").current);
                printString(appCode, rowCode, "169PZ", it.currentItem.fieldValue("IssuerINN_Mark").current);
                if ((it.currentItem.fieldValue("IssuerINN_Mark").current == "1") or (it.currentItem.fieldValue("IssuerINN_Mark").current == "3"))
                    printString(appCode, rowCode, "170", it.currentItem.fieldValue("issuerInn").current);
                else
                    printString(appCode, rowCode, "170", "");
                end;
                if ((it.currentItem.fieldValue("IssuerINN_Mark").current == "2") or (it.currentItem.fieldValue("IssuerINN_Mark").current == "4"))
                    printString(appCode, rowCode, "170TIN", it.currentItem.fieldValue("IssuerINN_TIN").current);
                else
                    printString(appCode, rowCode, "170TIN", "");
                end;
                printString(appCode, rowCode, "171", it.currentItem.fieldValue("issuerOgrn").current);
                printString(appCode, rowCode, "172", it.currentItem.fieldValue("issuerOksm").current);
                printString(appCode, rowCode, "173", it.currentItem.fieldValue("code711").current);
                printString(appCode, rowCode, "174", it.currentItem.fieldValue("series").current);
                printString(appCode, rowCode, "175", it.currentItem.fieldValue("number").current);
                printString(appCode, rowCode, "176", it.currentItem.fieldValue("formNumber").current);
                printString(appCode, rowCode, "177", it.currentItem.fieldValue("issueDate").current);
                printString(appCode, rowCode, "178", it.currentItem.fieldValue("paymentTerm").current);
                printString(appCode, rowCode, "179", it.currentItem.fieldValue("TermDate1").current);
                printString(appCode, rowCode, "180", it.currentItem.fieldValue("TermDate2").current);
                printString(appCode, rowCode, "181", String(it.currentItem.fieldValue("faceValue").current:0:4));
                printString(appCode, rowCode, "182", it.currentItem.fieldValue("faceValueFiCode").current);
                printString(appCode, rowCode, "183", it.currentItem.fieldValue("dealDate").current);
                printString(appCode, rowCode, "184", it.currentItem.fieldValue("dealGround").current);
                printString(appCode, rowCode, "185", it.currentItem.fieldValue("holderName").current);
                printString(appCode, rowCode, "185PZ", it.currentItem.fieldValue("HolderINN_Mark").current);
                printString(appCode, rowCode, "186", it.currentItem.fieldValue("HolderState").current);
                if ((it.currentItem.fieldValue("HolderINN_Mark").current == "1") or (it.currentItem.fieldValue("HolderINN_Mark").current == "3"))
                    printString(appCode, rowCode, "187", it.currentItem.fieldValue("holderInn").current);
                else
                    printString(appCode, rowCode, "187", "");
                end;
                if ((it.currentItem.fieldValue("HolderINN_Mark").current == "2") or (it.currentItem.fieldValue("HolderINN_Mark").current == "4"))
                    printString(appCode, rowCode, "187TIN", it.currentItem.fieldValue("HolderINN_TIN").current);
                else
                    printString(appCode, rowCode, "187TIN", "");
                end;
                printString(appCode, rowCode, "188", it.currentItem.fieldValue("HolderOgrn").current);
                printString(appCode, rowCode, "189", it.currentItem.fieldValue("HolderCountryCodeOksm").current);
                printString(appCode, rowCode, "190", it.currentItem.fieldValue("note").current);

                it.moveNext();
            end;
        end;
    end;
    macro export()
        printPart11();
        printPart12();
        printPart13();
        printPart14();
        printPart21();
        printPart22();
        printPart23();

        resetOutputFile();
        getProtocolView();
    end;
end;

/******************************************************************************************************************************************/
/**
 *  Обращение к полю неизвестного типа
 */
private class (TException) TIllegalFieldTypeException(type : Integer)
    initTException("Неизвестный тип поля: " + string(type), true);
end;

private class (RcbPtkPsdExportController) TPsdExportController()
    private const TYPE_DATE      = 1;
    private const TYPE_STRING    = 2;
    private const TYPE_NUMBER    = 3;

    private var m_jvm;

    macro getValue(value, name)
        var result;

        if (value != null)
            // 09.08.2014 ABP Здесь хорошо бы сделать вывод ошибок поиска значений в протокол,
            //                чтоб отслеживать атрибуты, не выводящиеся в печатную фому.
            result = value.fieldValue(name);
        end;

        if (result != null)
            // 09.08.2014 ABP Здесь хорошо бы сделать вывод ошибок поиска значений в протокол,
            //                чтоб отслеживать атрибуты, не выводящиеся в печатную фому.
            result = result.exact;
        else
            msgbox("Не найдено значение поля \"" + name + "\"");
        end;

        return result;
    end;

    private macro getFaceValue(it, faceValName, codeName) : Money
        var value = getValue(it, faceValName);

//        if (value == 0.0)
//            return null;
//        end;
//
//        var code711 = getValue(it, codeName);
//
//        if (in(code711, "OPN", "SHS7", "SHS71", "SHS8", "DR"))
//            value = null;
//        else
//            if (value < 0.000001)
//                value = 0.000001;
//            end;
//        end;

        return value;
    end;

    /**
     * Поле типа "Ч(n.m)"
     * @param value - форматируемое число
     * @param width - ширина поля вывода
     * @param precision - точность
     */
    private macro formatNumber(value : Variant, width : Integer, precision : Integer) : String
        var result;

        if ((value != null) and (value != 0))
// 16.01.2015 ABP Если вдруг в RSL отвалится округление при преобразовании строки в число, то нужно использовать нижеследующий код
//            value = TValue(value, value, 1, precision);
//            value.recalculateScaled();
//            result = trim(string(value.scaled : * : *, width, precision));
            result = trim(string(value : * : *, width, precision));
        else
            result = "0";
        end;

        return result;
    end;

    /**
     * Поле типа "Дата"
     * @param value - форматируемая дата
     */
    private macro formatDate(value : String) : String
        var day, month, year;

        if ((value == null) or (value == "") or (date(value) == date(0,0,0)))
            return "01.01.0001";
        end;

        dateSplit(date(value), day, month, year);

        return string(day:2:o) + "." + string(month:2:o) + "." + string(year:4:o);
    end;

    /**
     * Поле типа "С(n.m)"
     * @param value - форматируемая строка или число
     * @param width - ширина поля вывода
     * @param precision - точность
     */
    private macro formatString(value : Variant, width : Integer, precision : Integer) : String
        defaultParm(precision, 0);
        defaultParm(width, 0);

        var result;

        if (value == null)
            result = "";
        else
            if (precision == 0)
                if ((width != 0) and (strlen(value) > width))
                    result = substr(value, 1, width);
                else
                    result = value;
                end;
            else
// 16.01.2015 ABP Если вдруг в RSL отвалится округление при преобразовании строки в число, то нужно использовать нижеследующий код
//                value = TValue(value, value, 1, precision);
//                value.recalculateScaled();
//                result = trim(string(value.scaled : * : *, width, precision));
                result = trim(string(value : * : *, width, precision));
            end;
        end;

        return result;//strsubst(result, "\"", "~^");
    end;

    /**
     * Форматирование строки для экспорта
     * @param value - форматируемая значение
     * @param type - тип формата
     * @param parm1 - количество знаков всего/длина строки для экспорта
     * @param parm2 - количество знаков после запятой (если 0 - выводится как целое)
     */
    private macro format(value : Variant, type : Integer, parm1 : Integer, parm2 : Integer) : String
        var result;

        if (type == TYPE_DATE)
            result = formatDate(value);
        elif (type == TYPE_STRING)
            result = formatString(value, parm1, parm2);
        elif (type == TYPE_NUMBER)
            result = formatNumber(value, parm1, parm2);
        else
            throw(TIllegalFieldTypeException(type));
        end;

        return result;
    end;

    private macro getInnValue(value, innField, tinField, nameField)
        if ((nameField != null) and (getValue(value, nameField) == ""))
            return "";
        end;

        var innValue = getValue(value, innField);
        return ternary(innValue == getValue(value, tinField), "", innValue);
    end;

    private macro getTinValue(value, innField, tinField, nameField)
        if ((nameField != null) and (getValue(value, nameField) == ""))
            return "";
        end;

        var tinValue = getValue(value, tinField);
        return ternary(getValue(value, innField) == tinValue, tinValue, "");
    end;

    private macro constructorTPsdExportController()
        initRcbPtkPsdExportController("txt", RcbReportBase(null, true), null, RcbReportBase(null, true).getPeriod().endDate+1);
        m_jvm = createObject("rsjvm", "TJavaHost", "GlobalJavaHost");
    end;

    constructorTPsdExportController();
end;

class (TPsdExportController) TPsdExportController_I4637()
    private class TSyncSorterPart()
        macro isLess(lhs : Object, rhs : Object)
            return nvl(lhs.fieldValue("counter").exact, -1) < nvl(rhs.fieldValue("counter").exact, -1);
        end;
    end;

    private macro getDescriptorInfo()
        return "";
    end;

    private macro getMetaDataVersion()
        return "0mx6r";
    end;

    private macro printPart11()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0101";
        var rowCode = "1.1.00001";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                m_view.printRow(appCode, rowCode, "1", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "2", format(getValue(value, "КорреспНаим"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "2PZ", format(getValue(value, "КорреспИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "3", format(getInnValue(value, "КорреспИНН", "КорреспИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "3TIN", format(getTinValue(value, "КорреспИНН", "КорреспИНН_TIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "4", format(getValue(value, "КорреспКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "5", format(getValue(value, "КорреспОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "6", format(getValue(value, "КорреспОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "7", format(getValue(value, "КорреспНомерЛицензии"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "8", format(getValue(value, "КорреспПризнак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "9", format(getValue(value, "КорреспНомерСчета"), TYPE_STRING, 40));
                m_view.printRow(appCode, rowCode, "10", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "10PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "11", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "11TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "12", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "13", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "14", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "15", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "16", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "17", format(getValue(value, "ЦБISIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "18", format(getValue(value, "ЦБВалюта"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "19", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                m_view.printRow(appCode, rowCode, "20", format(getValue(value, "КоличествоПоСчету"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "21", format(getValue(value, "ВсегоОбрем"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "22", format(getValue(value, "Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "23", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "24", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "25", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "26", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "27", format(getValue(value, "МХНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "27PZ", format(getValue(value, "МХИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "28", format(getValue(value, "МХПризнак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "29", format(getInnValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "29TIN", format(getTinValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "30", format(getValue(value, "МХКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "31", format(getValue(value, "МХОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "32", format(getValue(value, "МХОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "33", format(getValue(value, "МХНомерЛицензии"), TYPE_STRING, 14));
                m_view.printRow(appCode, rowCode, "34", format(getValue(value, "МХНомерСчёта"), TYPE_STRING, 40));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart12()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0102";
        var rowCode = "1.2.00086";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                m_view.printRow(appCode, rowCode, "35", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "36", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "36PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "37", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "37TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "38", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "39", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "40", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "41", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "42", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "43", format(getValue(value, "ЦБISIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "44", format(getValue(value, "ЦБВалюта"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "45", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                m_view.printRow(appCode, rowCode, "46", format(getValue(value, "ВидСчётаДепо"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "47", format(getValue(value, "КоличествоПоСчету"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "48", format(getValue(value, "ВсегоОбрем"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "49", format(getValue(value, "Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "50", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "51", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "52", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "53", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "54", format(getValue(value, "Владелец_СекторЭкономики"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "55", format(getValue(value, "СВ_ОКМС"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "56", format(getValue(value, "МХНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "56PZ", format(getValue(value, "МХИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "57", format(getValue(value, "МХПризнак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "58", format(getInnValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "58TIN", format(getTinValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "59", format(getValue(value, "МХКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "60", format(getValue(value, "МХОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "61", format(getValue(value, "МХОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "62", format(getValue(value, "МХНомерЛицензии"), TYPE_STRING, 14));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart13()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0103";
        var rowCode = "1.3.00001";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                m_view.printRow(appCode, rowCode, "63", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "64", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "64PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "65", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "65TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "66", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "67", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "68", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "69", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "70", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "71", format(getValue(value, "ЦБISIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "72", format(getValue(value, "ЦБВалюта"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "73", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                m_view.printRow(appCode, rowCode, "74", format(getValue(value, "СвоиЦБ_Всего"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "75", format(getValue(value, "СвоиЦБ_ОснБаланс"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "76", format(getValue(value, "СвоиЦБ_РЕПО_БПП"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "77", format(getValue(value, "СвоиЦБ_Займ"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "78", format(getValue(value, "СвоиЦБ_ОбязОтсутств"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "79", format(getValue(value, "СвоиЦБ_Безнадежн"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "80", format(getValue(value, "СвоиЦБ_ЗачислОшибочно"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "81", format(getValue(value, "СвоиЦБ_ИныеПричины"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "82", format(getValue(value, "СвоиЦБ_ДУ"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "83", format(getValue(value, "СвоиЦБ_КазнСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "84", format(getValue(value, "СвоиЦБ_Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "85", format(getValue(value, "СвоиЦБ_Эмисс"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "86", format(getValue(value, "ВсегоОбрем"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "87", format(getValue(value, "Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "88", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "89", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "90", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "91", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "92", format(getValue(value, "МХНаименование"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "92PZ", format(getValue(value, "МХИНН_Признак"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "93", format(getValue(value, "МХПризнак"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "94", format(getInnValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "94TIN", format(getTinValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "95", format(getValue(value, "МХКПП"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "96", format(getValue(value, "МХОГРН"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "97", format(getValue(value, "МХОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "98", format(getValue(value, "МХНомерЛицензии"), TYPE_STRING, 3));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart14()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_4").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0104";
        var rowCode = "1.4.00001";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                m_view.printRow(appCode, rowCode, "99", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "100", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "100PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "101", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "101TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "102", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "103", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "104", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "105", format(getValue(value, "ЭмитентОКВЭД"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "106", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "107", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "108", format(getValue(value, "ЦБISIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "109", format(getValue(value, "ЦБВалюта"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "110", format(getValue(value, "КоличествоЦБ"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "111", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "112", format(getValue(value, "ОбъемВложений")/1000.0, TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "113", format(getValue(value, "БалансСчет"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "114", format(getValue(value, "НКД"), TYPE_STRING));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "115", format(getValue(value, "ОтрицПереоценка")/1000.0, TYPE_STRING, 0, 4));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "116", format(getValue(value, "ПоложПереоценка")/1000.0, TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "117", format(getValue(value, "УровеньИДвиерархииСС"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "118", format(getValue(value, "КатКачества"), TYPE_STRING));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "119", format(getValue(value, "Резерв")/1000.0, TYPE_STRING, 0, 4));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart21()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел2_Подраздел1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0201";
        var rowCode = "1.4.00021";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                m_view.printRow(appCode, rowCode, "120", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "121", format(getValue(value, "issuerName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "121PZ", format(getValue(value, "IssuerINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "122", format(getInnValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "122TIN", format(getTinValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "123", format(getValue(value, "issuerOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "124", format(getValue(value, "issuerOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "125", format(getValue(value, "code711"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "126", format(getValue(value, "series"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "127", format(getValue(value, "number"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "128", format(getValue(value, "formNumber"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "129", format(getValue(value, "issueDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "130", format(getValue(value, "paymentTerm"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "131", format(getValue(value, "TermDate1"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "132", format(getValue(value, "TermDate2"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "133", format(getValue(value, "PercentRate"), TYPE_STRING, 0, 3));
                m_view.printRow(appCode, rowCode, "134", format(getValue(value, "faceValue"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "135", format(getValue(value, "faceValueFiCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "136", format(getValue(value, "BuyCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "137", format(getValue(value, "BalanceCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "138", format(getValue(value, "interest"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "139", format(getValue(value, "QualityCateg"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "140", format(getValue(value, "ReserveSum"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "141", format(getValue(value, "dealDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "142", format(getValue(value, "dealGround"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "143", format(getValue(value, "dealAgentName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "143PZ", format(getValue(value, "DealAgentINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "144", format(getInnValue(value, "dealAgentInn", "DealAgentINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "144TIN", format(getTinValue(value, "dealAgentInn", "DealAgentINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "145", format(getValue(value, "dealAgentOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "146", format(getValue(value, "dealAgentCountryCodeOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "147", format(getValue(value, "balanceAccount"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "148", format(getValue(value, "storagePlaceName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "149", format(getInnValue(value, "storagePlaceInn", "StoragePlaceINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "149PZ", format(getValue(value, "StoragePlaceINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "149TIN", format(getTinValue(value, "storagePlaceInn", "StoragePlaceINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "150", format(getValue(value, "storagePlaceOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "151", format(getValue(value, "StoragePlaceCountryCode2"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "152", format(getValue(value, "storageGround"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "153", format(getValue(value, "SaleCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "154", format(getValue(value, "SaleDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "155", format(getValue(value, "SaleGround"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "156", format(getValue(value, "SaleAgentName"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "156PZ", format(getValue(value, "SaleAgentINN_Mark"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "157", format(getInnValue(value, "SaleAgentINN", "SaleAgentINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "157TIN", format(getTinValue(value, "SaleAgentINN", "SaleAgentINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "158", format(getValue(value, "SaleAgentOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "159", format(getValue(value, "SaleAgentCountryCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "160", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart22()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел2_Подраздел2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0202";
        var rowCode = "2.2.00061";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                m_view.printRow(appCode, rowCode, "161", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "162", format(getValue(value, "series"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "163", format(getValue(value, "number"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "164", format(getValue(value, "formNumber"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "165", format(getValue(value, "issueDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "166", format(getValue(value, "paymentTerm"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "167", format(getValue(value, "TermDate1"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "168", format(getValue(value, "TermDate2"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "169", format(getValue(value, "PercentRate"), TYPE_STRING, 0, 3));
                m_view.printRow(appCode, rowCode, "170", format(getValue(value, "faceValue"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "171", format(getValue(value, "faceValueFiCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "172", format(getValue(value, "SaleCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "173", format(getValue(value, "firstHolderName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "173PZ", format(getValue(value, "FirstHolderINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "174", format(getInnValue(value, "firstHolderInn", "FirstHolderINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "175TIN", format(getTinValue(value, "firstHolderInn", "FirstHolderINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "176", format(getValue(value, "firstHolderOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "177", format(getValue(value, "firstHolderCountryCode2"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "178", format(getValue(value, "balanceAccount"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "179", format(getValue(value, "state"), TYPE_STRING, 2));
                m_view.printRow(appCode, rowCode, "180", format(getValue(value, "repaymentDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "181", format(getValue(value, "holderName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "181PZ", format(getValue(value, "HolderINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "182", format(getInnValue(value, "holderInn", "HolderINN_Mark"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "183TIN", format(getTinValue(value, "holderInn", "HolderINN_Mark"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "184", format(getValue(value, "holderOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "185", format(getValue(value, "holderCountryCodeOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "186", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart23()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел2_Подраздел3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0203";
        var rowCode = "2.3.00085";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                m_view.printRow(appCode, rowCode, "185", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "186", format(getValue(value, "issuerName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "186PZ", format(getValue(value, "IssuerINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "187", format(getInnValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "187TIN", format(getTinValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "188", format(getValue(value, "issuerOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "189", format(getValue(value, "issuerOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "190", format(getValue(value, "code711"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "191", format(getValue(value, "series"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "192", format(getValue(value, "number"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "193", format(getValue(value, "formNumber"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "194", format(getValue(value, "issueDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "195", format(getValue(value, "paymentTerm"), TYPE_STRING, 2));
                m_view.printRow(appCode, rowCode, "196", format(getValue(value, "TermDate1"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "197", format(getValue(value, "TermDate2"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "198", format(getValue(value, "PercentRate"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "199", format(getValue(value, "faceValue"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "faceValueFiCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "201", format(getValue(value, "dealDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "202", format(getValue(value, "dealGround"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "203", format(getValue(value, "holderName"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "203PZ", format(getValue(value, "HolderINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "204", format(getValue(value, "HolderState"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "205", format(getInnValue(value, "holderInn", "HolderINN_TIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "205TIN", format(getTinValue(value, "holderInn", "HolderINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "206", format(getValue(value, "HolderOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "207", format(getValue(value, "HolderCountryCodeOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "208", format(getValue(value, "state"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "209", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart3()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0300";
        var rowCode = "3.0.00021";

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                m_view.printRow(appCode, rowCode, "185", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "186", format(getValue(value, "IssuerName"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "186PZ", format(getValue(value, "IssuerINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "187", format(getInnValue(value, "IssuerINN", "IssuerINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "187TIN", format(getTinValue(value, "IssuerINN", "IssuerINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "186PZ", format(getValue(value, "IssuerKPP"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "188", format(getValue(value, "IssuerOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "189", format(getValue(value, "IssuerCountryCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "190", format(getValue(value, "Code711"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "190", format(getValue(value, "LSIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "190", format(getValue(value, "ISIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "FaceValueFICode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "200", format(getFaceValue(value, "FaceValue", "Code711"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "SaleREPOAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "TransLoanAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "BuyREPOAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "AcceptLoanAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "TransDUAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "TransRightsDUAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "TransPledgeBOAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "TransPledgeAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "AcceptPledgeAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "209", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart1IssuerList()
        macro getIssuerType(type)
            var result = "";

            if (type == "1") //юр. лицо - резидент
                result = "11";
            elif (type == "2") //юр. лицо - нерезидент
                result = "01";
            elif (type == "3") //физ. лицо - резидент
                result = "12";
            elif (type == "4") //физ. лицо - нерезидент
                result = "02";
            else
                result = "";
            end;

            return result;
        end;

        var issuerList = m_jvm.createJavaObject("java.util.HashMap", "<init>");

        var appCode = "F711_3";
        var counter = 0;
        var parts = RcbArray().initialize(m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_1").createValueIterator(),
                                          m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_2").createValueIterator(),
                                          m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_3").createValueIterator(),
                                          m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_4").createValueIterator()
                                         );
        for (var it, parts)
            it.moveFirst();
            while (not it.isDone())
                var value = it.currentItem;
                var issuerName = getValue(value, "ЭмитентНаименование");
                if (issuerList.get(issuerName) != null)
                    it.moveNext();
                    continue;
                end;
                counter = counter + 1;
                issuerList.put(issuerName, counter);

                m_view.printRow(appCode, format(counter, TYPE_STRING, 5), "nom", format(counter, TYPE_STRING, 5));
                m_view.printRow(appCode, format(counter, TYPE_STRING, 5), "$name$", format(issuerName, TYPE_STRING, 255));
                var issuerType = getIssuerType(getValue(value, "ЭмитентИНН_Признак"));
                m_view.printRow(appCode, format(counter, TYPE_STRING, 5), "tip", format(issuerType, TYPE_STRING, 2));
                var issuerCode = ternary(in(issuerType, "11", "12"), getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), getValue(value, "ЭмитентОКСМ"));
                m_view.printRow(appCode, format(counter, TYPE_STRING, 5), "kod", format(issuerCode, TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart3IssuerList()
        macro getIssuerType(type)
            var result = "";

            if (type == "1") //юр. лицо - резидент
                result = "11";
            elif (type == "2") //юр. лицо - нерезидент
                result = "01";
            elif (type == "3") //физ. лицо - резидент
                result = "12";
            elif (type == "4") //физ. лицо - нерезидент
                result = "02";
            else
                result = "";
            end;

            return result;
        end;

        var issuerList = m_jvm.createJavaObject("java.util.HashMap", "<init>");

        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел3").createValueIterator();
        var appCode = "F711_31N";
        var counter = 0;
        it.moveFirst();
        while (not it.isDone())
            var value = it.currentItem;
            var issuerName = getValue(value, "IssuerName");
            if (issuerList.get(issuerName) != null)
                it.moveNext();
                continue;
            end;
            counter = counter + 1;
            issuerList.put(issuerName, counter);

            m_view.printRow(appCode, format(counter, TYPE_STRING, 5), "nom", format(counter, TYPE_STRING, 5));
            m_view.printRow(appCode, format(counter, TYPE_STRING, 5), "$name$", format(issuerName, TYPE_STRING, 255));
            var issuerType = getIssuerType(getValue(value, "IssuerINN_Mark"));
            m_view.printRow(appCode, format(counter, TYPE_STRING, 5), "tip", format(issuerType, TYPE_STRING, 2));
            var issuerCode = ternary(in(issuerType, "11", "12"), getInnValue(value, "IssuerINN", "IssuerINN_TIN"), getValue(value, "IssuerCountryCode"));
            m_view.printRow(appCode, format(counter, TYPE_STRING, 5), "kod", format(issuerCode, TYPE_STRING));

            it.moveNext();
        end;
    end;

    private macro printDataZone()
        printPart11();
        printPart12();
        printPart13();
        printPart14();
        printPart21();
        printPart22();
        printPart23();
        printPart3();
        printPart1IssuerList();
        printPart3IssuerList();
    end;

    local macro constructorTPsdExportController_I4637()
        initTPsdExportController();
    end;

    constructorTPsdExportController_I4637();
end;

class (TPsdExportController_I4637) TPsdExportController_I4927()
    private macro getDescriptorInfo()
        return "ОСБР_0409711 от 21.05.2019";
    end;

    private macro printPart11()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0101";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "1.1." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "1", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "2", format(getValue(value, "КорреспНаим"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "2PZ", format(getValue(value, "КорреспИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "3", format(getInnValue(value, "КорреспИНН", "КорреспИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "3TIN", format(getTinValue(value, "КорреспИНН", "КорреспИНН_TIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "4", format(getValue(value, "КорреспКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "5", format(getValue(value, "КорреспОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "6", format(getValue(value, "КорреспОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "7", format(getValue(value, "КорреспНомерЛицензии"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "8", format(getValue(value, "КорреспПризнак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "9", format(getValue(value, "КорреспНомерСчета"), TYPE_STRING, 40));
                m_view.printRow(appCode, rowCode, "10", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "10PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "11", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "11TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "12", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "13", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "14", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "15", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "16", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "17", format(getValue(value, "ЦБISIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "18", format(getValue(value, "ЦБВалюта"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "19", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                m_view.printRow(appCode, rowCode, "20", format(getValue(value, "КоличествоПоСчету"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "21", format(getValue(value, "ВсегоОбрем"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "22", format(getValue(value, "Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "23", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "24", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "25", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "26", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "27", format(getValue(value, "МХНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "27PZ", format(getValue(value, "МХИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "28", format(getValue(value, "МХПризнак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "29", format(getInnValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "29TIN", format(getTinValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "30", format(getValue(value, "МХКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "31", format(getValue(value, "МХОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "32", format(getValue(value, "МХОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "33", format(getValue(value, "МХНомерЛицензии"), TYPE_STRING, 14));
                m_view.printRow(appCode, rowCode, "34", format(getValue(value, "МХНомерСчёта"), TYPE_STRING, 40));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart12()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0102";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "1.2." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "35", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "36", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "36PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "37", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "37TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "38", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "39", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "40", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "41", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "42", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "43", format(getValue(value, "ЦБISIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "44", format(getValue(value, "ЦБВалюта"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "45", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                m_view.printRow(appCode, rowCode, "46", format(getValue(value, "ВидСчётаДепо"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "47", format(getValue(value, "КоличествоПоСчету"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "48", format(getValue(value, "ВсегоОбрем"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "49", format(getValue(value, "Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "50", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "51", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "52", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "53", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "54", format(getValue(value, "Владелец_СекторЭкономики"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "55", format(getValue(value, "СВ_ОКМС"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "56", format(getValue(value, "МХНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "56PZ", format(getValue(value, "МХИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "57", format(getValue(value, "МХПризнак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "58", format(getInnValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "58TIN", format(getTinValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "59", format(getValue(value, "МХКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "60", format(getValue(value, "МХОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "61", format(getValue(value, "МХОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "62", format(getValue(value, "МХНомерЛицензии"), TYPE_STRING, 14));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart13()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0103";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "1.3." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "63", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "64", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "64PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "65", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "65TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "66", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "67", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "68", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "69", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "70", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "71", format(getValue(value, "ЦБISIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "72", format(getValue(value, "ЦБВалюта"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "73", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                m_view.printRow(appCode, rowCode, "74", format(getValue(value, "СвоиЦБ_Всего"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "75", format(getValue(value, "СвоиЦБ_ОснБаланс"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "76", format(getValue(value, "СвоиЦБ_РЕПО_БПП"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "77", format(getValue(value, "СвоиЦБ_Займ"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "78", format(getValue(value, "СвоиЦБ_ОбязОтсутств"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "79", format(getValue(value, "СвоиЦБ_Безнадежн"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "80", format(getValue(value, "СвоиЦБ_ЗачислОшибочно"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "81", format(getValue(value, "СвоиЦБ_ИныеПричины"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "82", format(getValue(value, "СвоиЦБ_ДУ"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "83", format(getValue(value, "СвоиЦБ_КазнСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "84", format(getValue(value, "СвоиЦБ_Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "85", format(getValue(value, "СвоиЦБ_Эмисс"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "86", format(getValue(value, "ВсегоОбрем"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "87", format(getValue(value, "Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "88", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "89", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "90", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "91", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "92", format(getValue(value, "МХНаименование"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "92PZ", format(getValue(value, "МХИНН_Признак"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "93", format(getValue(value, "МХПризнак"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "94", format(getInnValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "94TIN", format(getTinValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "95", format(getValue(value, "МХКПП"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "96", format(getValue(value, "МХОГРН"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "97", format(getValue(value, "МХОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "98", format(getValue(value, "МХНомерЛицензии"), TYPE_STRING, 3));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart14()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_4").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0104";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "1.4." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "99", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "100", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "100PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "101", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "101TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "102", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "103", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "104", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "105", format(getValue(value, "ЭмитентОКВЭД"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "106", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "107", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "108", format(getValue(value, "ЦБISIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "109", format(getValue(value, "ЦБВалюта"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "110", format(getValue(value, "КоличествоЦБ"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "111", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "112", format(getValue(value, "ОбъемВложений")/1000.0, TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "113", format(getValue(value, "БалансСчет"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "114", format(getValue(value, "НКД"), TYPE_STRING));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "115", format(getValue(value, "ОтрицПоложПереоценка")/1000.0, TYPE_STRING, 0, 4));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "116", format(getValue(value, "Корр_СС_ПП")/1000.0, TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "117", format(getValue(value, "УровеньИДвиерархииСС"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "118", format(getValue(value, "КатКачества"), TYPE_STRING));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "119", format(getValue(value, "Резерв")/1000.0, TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "120", format(getValue(value, "Корр_резерва_ВП")/1000.0, TYPE_STRING, 0, 4));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart21()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел2_Подраздел1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0201";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "2.1." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "121", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "122", format(getValue(value, "issuerName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "122PZ", format(getValue(value, "IssuerINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "123", format(getInnValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "123TIN", format(getTinValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "124", format(getValue(value, "issuerOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "125", format(getValue(value, "issuerOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "126", format(getValue(value, "code711"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "127", format(getValue(value, "series"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "128", format(getValue(value, "number"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "129", format(getValue(value, "formNumber"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "130", format(getValue(value, "issueDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "131", format(getValue(value, "paymentTerm"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "132", format(getValue(value, "TermDate1"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "133", format(getValue(value, "TermDate2"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "134", format(getValue(value, "PercentRate"), TYPE_STRING, 0, 3));
                m_view.printRow(appCode, rowCode, "135", format(getValue(value, "faceValue"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "136", format(getValue(value, "faceValueFiCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "137", format(getValue(value, "BuyCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "138", format(getValue(value, "BalanceCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "139", format(getValue(value, "interest"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "140", format(getValue(value, "OvervalueBill"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "141", format(getValue(value, "AdjustCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "142", format(getValue(value, "QualityCateg"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "143", format(getValue(value, "ReserveSum"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "144", format(getValue(value, "AdjustReserv"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "145", format(getValue(value, "dealDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "146", format(getValue(value, "dealGround"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "147", format(getValue(value, "dealAgentName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "147PZ", format(getValue(value, "DealAgentINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "148", format(getInnValue(value, "dealAgentInn", "DealAgentINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "148TIN", format(getTinValue(value, "dealAgentInn", "DealAgentINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "149", format(getValue(value, "dealAgentOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "150", format(getValue(value, "dealAgentCountryCodeOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "151", format(getValue(value, "balanceAccount"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "152", format(getValue(value, "storagePlaceName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "153", format(getInnValue(value, "storagePlaceInn", "StoragePlaceINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "153PZ", format(getValue(value, "StoragePlaceINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "153TIN", format(getTinValue(value, "storagePlaceInn", "StoragePlaceINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "154", format(getValue(value, "storagePlaceOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "155", format(getValue(value, "StoragePlaceCountryCode2"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "156", format(getValue(value, "storageGround"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "157", format(getValue(value, "SaleCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "158", format(getValue(value, "SaleDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "159", format(getValue(value, "SaleGround"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "160", format(getValue(value, "SaleAgentName"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "160PZ", format(getValue(value, "SaleAgentINN_Mark"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "161", format(getInnValue(value, "SaleAgentINN", "SaleAgentINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "161TIN", format(getTinValue(value, "SaleAgentINN", "SaleAgentINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "162", format(getValue(value, "SaleAgentOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "163", format(getValue(value, "SaleAgentCountryCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "164", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart22()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел2_Подраздел2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0202";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "2.2." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "165", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "166", format(getValue(value, "series"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "167", format(getValue(value, "number"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "168", format(getValue(value, "formNumber"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "169", format(getValue(value, "issueDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "170", format(getValue(value, "paymentTerm"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "171", format(getValue(value, "TermDate1"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "172", format(getValue(value, "TermDate2"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "173", format(getValue(value, "PercentRate"), TYPE_STRING, 0, 3));
                m_view.printRow(appCode, rowCode, "174", format(getValue(value, "faceValue"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "175", format(getValue(value, "faceValueFiCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "176", format(getValue(value, "SaleCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "177", format(getValue(value, "firstHolderName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "177PZ", format(getValue(value, "FirstHolderINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "178", format(getInnValue(value, "firstHolderInn", "FirstHolderINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "178TIN", format(getTinValue(value, "firstHolderInn", "FirstHolderINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "179", format(getValue(value, "firstHolderOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "181", format(getValue(value, "firstHolderCountryCode2"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "180", format(getValue(value, "balanceAccount"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "182", format(getValue(value, "state"), TYPE_STRING, 2));
                m_view.printRow(appCode, rowCode, "183", format(getValue(value, "repaymentDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "184", format(getValue(value, "holderName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "184PZ", format(getValue(value, "HolderINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "185", format(getInnValue(value, "holderInn", "HolderINN_Mark"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "185TIN", format(getTinValue(value, "holderInn", "HolderINN_Mark"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "186", format(getValue(value, "holderOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "187", format(getValue(value, "holderCountryCodeOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "188", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart23()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел2_Подраздел3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0203";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "2.3." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "189", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "190", format(getValue(value, "issuerName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "190PZ", format(getValue(value, "IssuerINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "191", format(getInnValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "191TIN", format(getTinValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "192", format(getValue(value, "issuerOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "193", format(getValue(value, "issuerOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "194", format(getValue(value, "code711"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "195", format(getValue(value, "series"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "196", format(getValue(value, "number"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "197", format(getValue(value, "formNumber"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "198", format(getValue(value, "issueDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "199", format(getValue(value, "paymentTerm"), TYPE_STRING, 2));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "TermDate1"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "201", format(getValue(value, "TermDate2"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "202", format(getValue(value, "PercentRate"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "203", format(getValue(value, "faceValue"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "204", format(getValue(value, "faceValueFiCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "205", format(getValue(value, "dealDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "206", format(getValue(value, "dealGround"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "207", format(getValue(value, "holderName"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "207PZ", format(getValue(value, "HolderINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "208", format(getValue(value, "HolderState"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "209", format(getInnValue(value, "holderInn", "HolderINN_TIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "209TIN", format(getTinValue(value, "holderInn", "HolderINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "210", format(getValue(value, "HolderOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "211", format(getValue(value, "HolderCountryCodeOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "212", format(getValue(value, "state"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "213", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart3()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0300";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "3.0." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "214", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "215", format(getValue(value, "IssuerName"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "215PZ", format(getValue(value, "IssuerINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "216", format(getInnValue(value, "IssuerINN", "IssuerINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "216TIN", format(getTinValue(value, "IssuerINN", "IssuerINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "217", format(getValue(value, "IssuerKPP"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "218", format(getValue(value, "IssuerOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "219", format(getValue(value, "IssuerCountryCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "220", format(getValue(value, "Code711"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "221", format(getValue(value, "LSIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "222", format(getValue(value, "ISIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "223", format(getValue(value, "FaceValueFICode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "224", format(getFaceValue(value, "FaceValue", "Code711"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "225", format(getValue(value, "SaleREPOAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "226", format(getValue(value, "TransLoanAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "227", format(getValue(value, "BuyREPOAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "228", format(getValue(value, "AcceptLoanAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "229", format(getValue(value, "TransDUAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "230", format(getValue(value, "TransRightsDUAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "231", format(getValue(value, "TransPledgeBOAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "232", format(getValue(value, "TransPledgeAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "233", format(getValue(value, "AcceptPledgeAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "234", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "235", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "236", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "237", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "238", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    local macro constructorTPsdExportController_I4927()
        initTPsdExportController_I4637();
    end;

    constructorTPsdExportController_I4927();
end;

class (TPsdExportController_I4927) TPsdExportController_I5456()
    private macro getDescriptorInfo()
        return "ОСБР_0409711 от 21.05.2019";
    end;

    private macro printPart11()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0101";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "1.1." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "1", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "2", format(getValue(value, "КорреспНаим"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "2PZ", format(getValue(value, "КорреспИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "3", format(getInnValue(value, "КорреспИНН", "КорреспИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "3TIN", format(getTinValue(value, "КорреспИНН", "КорреспИНН_TIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "4", format(getValue(value, "КорреспКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "5", format(getValue(value, "КорреспОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "6", format(getValue(value, "КорреспОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "7", format(getValue(value, "КорреспНомерЛицензии"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "8", format(getValue(value, "КорреспПризнак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "9", format(getValue(value, "КорреспНомерСчета"), TYPE_STRING, 40));
                m_view.printRow(appCode, rowCode, "10", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "10PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "11", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "11TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "12", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "13", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "14", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "15", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "16", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "17", format(getValue(value, "ЦБISIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "18", format(getValue(value, "ЦБВалюта"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "19", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                m_view.printRow(appCode, rowCode, "20", format(getValue(value, "КоличествоПоСчету"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "21", format(getValue(value, "ВсегоОбрем"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "22", format(getValue(value, "Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "23", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "24", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "25", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "26", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "27", format(getValue(value, "МХНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "27PZ", format(getValue(value, "МХИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "28", format(getValue(value, "МХПризнак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "29", format(getInnValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "29TIN", format(getTinValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "30", format(getValue(value, "МХКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "31", format(getValue(value, "МХОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "32", format(getValue(value, "МХОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "33", format(getValue(value, "МХНомерЛицензии"), TYPE_STRING, 14));
                m_view.printRow(appCode, rowCode, "34", format(getValue(value, "МХНомерСчёта"), TYPE_STRING, 40));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart12()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0102";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "1.2." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "35", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "36", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "36PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "37", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "37TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "38", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "39", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "40", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "41", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "42", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "43", format(getValue(value, "ЦБISIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "44", format(getValue(value, "ЦБВалюта"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "45", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                m_view.printRow(appCode, rowCode, "46", format(getValue(value, "ВидСчётаДепо"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "47", format(getValue(value, "КоличествоПоСчету"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "48", format(getValue(value, "ВсегоОбрем"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "49", format(getValue(value, "Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "50", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "51", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "52", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "53", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "54", format(getValue(value, "Владелец_СекторЭкономики"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "55", format(getValue(value, "СВ_ОКМС"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "56", format(getValue(value, "МХНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "56PZ", format(getValue(value, "МХИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "57", format(getValue(value, "МХПризнак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "58", format(getInnValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "58TIN", format(getTinValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "59", format(getValue(value, "МХКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "60", format(getValue(value, "МХОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "61", format(getValue(value, "МХОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "62", format(getValue(value, "МХНомерЛицензии"), TYPE_STRING, 14));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart13()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0103";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "1.3." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "63", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "64", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "64PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "65", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "65TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "66", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "67", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "68", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "69", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "70", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "71", format(getValue(value, "ЦБISIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "72", format(getValue(value, "ЦБВалюта"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "73", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                m_view.printRow(appCode, rowCode, "74", format(getValue(value, "СвоиЦБ_Всего"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "75", format(getValue(value, "СвоиЦБ_ОснБаланс"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "76", format(getValue(value, "СвоиЦБ_РЕПО_БПП"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "77", format(getValue(value, "СвоиЦБ_Займ"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "78", format(getValue(value, "СвоиЦБ_ОбязОтсутств"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "79", format(getValue(value, "СвоиЦБ_Безнадежн"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "80", format(getValue(value, "СвоиЦБ_ЗачислОшибочно"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "81", format(getValue(value, "СвоиЦБ_ИныеПричины"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "82", format(getValue(value, "СвоиЦБ_ДУ"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "83", format(getValue(value, "СвоиЦБ_КазнСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "84", format(getValue(value, "СвоиЦБ_Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "85", format(getValue(value, "СвоиЦБ_Эмисс"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "86", format(getValue(value, "ВсегоОбрем"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "87", format(getValue(value, "Залог"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "88", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "89", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "90", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "91", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "92", format(getValue(value, "МХНаименование"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "92PZ", format(getValue(value, "МХИНН_Признак"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "93", format(getValue(value, "МХПризнак"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "94", format(getInnValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "94TIN", format(getTinValue(value, "МХИНН", "МХИНН_TIN", "МХНаименование"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "95", format(getValue(value, "МХКПП"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "96", format(getValue(value, "МХОГРН"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "97", format(getValue(value, "МХОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "98", format(getValue(value, "МХНомерЛицензии"), TYPE_STRING, 3));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart14()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел1_Подраздел_1_4").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0104";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "1.4." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "99", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "100", format(getValue(value, "ЭмитентНаименование"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "100PZ", format(getValue(value, "ЭмитентИНН_Признак"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "101", format(getInnValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "101TIN", format(getTinValue(value, "ЭмитентИНН", "ЭмитентИНН_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "102", format(getValue(value, "ЭмитентОГРН"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "103", format(getValue(value, "ЭмитентКПП"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "104", format(getValue(value, "ЭмитентОКСМ"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "105", format(getValue(value, "ЭмитентОКВЭД"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "106", format(getValue(value, "ЦБКодТипа"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "107", format(getValue(value, "ЦБНомерГосРег"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "108", format(getValue(value, "ЦБISIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "109", format(getValue(value, "ЦБВалюта"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "110", format(getValue(value, "КоличествоЦБ"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "111", format(getFaceValue(value, "ЦБНоминал", "ЦБКодТипа"), TYPE_STRING, 30, 6));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "112", format(getValue(value, "ОбъемВложений")/1000.0, TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "113", format(getValue(value, "БалансСчет"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "114", format(getValue(value, "НКД"), TYPE_STRING));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "115", format(getValue(value, "ОтрицПоложПереоценка")/1000.0, TYPE_STRING, 0, 4));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "116", format(getValue(value, "Корр_СС_ПП")/1000.0, TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "117", format(getValue(value, "УровеньИДвиерархииСС"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "118", format(getValue(value, "КатКачества"), TYPE_STRING));
                // 05.09.2014 ABP Изменяя правила вычисления значения не забываем
                //                о соответствующих изменений в процедуре печати ф.711
                m_view.printRow(appCode, rowCode, "119", format(getValue(value, "Резерв")/1000.0, TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "120", format(getValue(value, "Корр_резерва_ВП")/1000.0, TYPE_STRING, 0, 4));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart21()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел2_Подраздел1").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0201";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "2.1." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "121", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "122", format(getValue(value, "issuerName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "122PZ", format(getValue(value, "IssuerINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "123", format(getInnValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "123TIN", format(getTinValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "124", format(getValue(value, "issuerOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "125", format(getValue(value, "issuerOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "126", format(getValue(value, "code711"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "127", format(getValue(value, "series"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "128", format(getValue(value, "number"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "129", format(getValue(value, "formNumber"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "130", format(getValue(value, "issueDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "131", format(getValue(value, "paymentTerm"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "132", format(getValue(value, "TermDate1"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "133", format(getValue(value, "TermDate2"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "134", format(getValue(value, "PercentRate"), TYPE_STRING, 0, 3));
                m_view.printRow(appCode, rowCode, "135", format(getValue(value, "faceValue"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "136", format(getValue(value, "faceValueFiCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "137", format(getValue(value, "BuyCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "138", format(getValue(value, "BalanceCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "139", format(getValue(value, "interest"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "140", format(getValue(value, "OvervalueBill"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "141", format(getValue(value, "AdjustCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "142", format(getValue(value, "QualityCateg"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "143", format(getValue(value, "ReserveSum"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "144", format(getValue(value, "AdjustReserv"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "145", format(getValue(value, "dealDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "146", format(getValue(value, "dealGround"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "147", format(getValue(value, "dealAgentName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "147PZ", format(getValue(value, "DealAgentINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "148", format(getInnValue(value, "dealAgentInn", "DealAgentINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "148TIN", format(getTinValue(value, "dealAgentInn", "DealAgentINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "149", format(getValue(value, "dealAgentOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "150", format(getValue(value, "dealAgentCountryCodeOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "151", format(getValue(value, "balanceAccount"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "152", format(getValue(value, "storagePlaceName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "153", format(getInnValue(value, "storagePlaceInn", "StoragePlaceINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "153PZ", format(getValue(value, "StoragePlaceINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "153TIN", format(getTinValue(value, "storagePlaceInn", "StoragePlaceINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "154", format(getValue(value, "storagePlaceOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "155", format(getValue(value, "StoragePlaceCountryCode2"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "156", format(getValue(value, "storageGround"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "157", format(getValue(value, "SaleCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "158", format(getValue(value, "SaleDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "159", format(getValue(value, "SaleGround"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "160", format(getValue(value, "SaleAgentName"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "160PZ", format(getValue(value, "SaleAgentINN_Mark"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "161", format(getInnValue(value, "SaleAgentINN", "SaleAgentINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "161TIN", format(getTinValue(value, "SaleAgentINN", "SaleAgentINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "162", format(getValue(value, "SaleAgentOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "163", format(getValue(value, "SaleAgentCountryCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "164", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart22()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел2_Подраздел2").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0202";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "2.2." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "165", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "166", format(getValue(value, "series"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "167", format(getValue(value, "number"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "168", format(getValue(value, "formNumber"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "169", format(getValue(value, "issueDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "170", format(getValue(value, "paymentTerm"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "171", format(getValue(value, "TermDate1"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "172", format(getValue(value, "TermDate2"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "173", format(getValue(value, "PercentRate"), TYPE_STRING, 0, 3));
                m_view.printRow(appCode, rowCode, "174", format(getValue(value, "faceValue"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "175", format(getValue(value, "faceValueFiCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "176", format(getValue(value, "SaleCost"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "177", format(getValue(value, "firstHolderName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "177PZ", format(getValue(value, "FirstHolderINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "178", format(getInnValue(value, "firstHolderInn", "FirstHolderINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "178TIN", format(getTinValue(value, "firstHolderInn", "FirstHolderINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "179", format(getValue(value, "firstHolderOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "181", format(getValue(value, "firstHolderCountryCode2"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "180", format(getValue(value, "balanceAccount"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "182", format(getValue(value, "state"), TYPE_STRING, 2));
                m_view.printRow(appCode, rowCode, "183", format(getValue(value, "repaymentDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "184", format(getValue(value, "holderName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "184PZ", format(getValue(value, "HolderINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "185", format(getInnValue(value, "holderInn", "HolderINN_Mark"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "185TIN", format(getTinValue(value, "holderInn", "HolderINN_Mark"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "186", format(getValue(value, "holderOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "187", format(getValue(value, "holderCountryCodeOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "188", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart23()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел2_Подраздел3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0203";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "2.3." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "189", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "190", format(getValue(value, "issuerName"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "190PZ", format(getValue(value, "IssuerINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "191", format(getInnValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "191TIN", format(getTinValue(value, "issuerInn", "IssuerINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "192", format(getValue(value, "issuerOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "193", format(getValue(value, "issuerOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "194", format(getValue(value, "code711"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "195", format(getValue(value, "series"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "196", format(getValue(value, "number"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "197", format(getValue(value, "formNumber"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "198", format(getValue(value, "issueDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "199", format(getValue(value, "paymentTerm"), TYPE_STRING, 2));
                m_view.printRow(appCode, rowCode, "200", format(getValue(value, "TermDate1"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "201", format(getValue(value, "TermDate2"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "202", format(getValue(value, "PercentRate"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "203", format(getValue(value, "faceValue"), TYPE_STRING, 0, 4));
                m_view.printRow(appCode, rowCode, "204", format(getValue(value, "faceValueFiCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "205", format(getValue(value, "dealDate"), TYPE_DATE));
                m_view.printRow(appCode, rowCode, "206", format(getValue(value, "dealGround"), TYPE_STRING, 255));
                m_view.printRow(appCode, rowCode, "207", format(getValue(value, "holderName"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "207PZ", format(getValue(value, "HolderINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "208", format(getValue(value, "HolderState"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "209", format(getInnValue(value, "holderInn", "HolderINN_TIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "209TIN", format(getTinValue(value, "holderInn", "HolderINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "210", format(getValue(value, "HolderOgrn"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "211", format(getValue(value, "HolderCountryCodeOksm"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "212", format(getValue(value, "state"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "213", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    private macro printPart3()
        var it = m_report.getRcbReport().attributeValue("Ф711_Раздел3").createValueIterator();
        it.setSortOrder(TSyncSorterPart());

        var appCode = "F711_0300";
        var rowCode;

        if (it.count() > 0)
            it.moveFirst();

            while (not it.isDone())
                var value = it.currentItem;

                rowCode = "3.0." + strLpad(format(getValue(value, "counter"), TYPE_STRING, 5), 5, "0");

                m_view.printRow(appCode, rowCode, "214", format(getValue(value, "counter"), TYPE_STRING, 5));
                m_view.printRow(appCode, rowCode, "215", format(getValue(value, "IssuerName"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "215PZ", format(getValue(value, "IssuerINN_Mark"), TYPE_STRING, 1));
                m_view.printRow(appCode, rowCode, "216", format(getInnValue(value, "IssuerINN", "IssuerINN_TIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "216TIN", format(getTinValue(value, "IssuerINN", "IssuerINN_TIN"), TYPE_STRING, 30));
                m_view.printRow(appCode, rowCode, "217", format(getValue(value, "IssuerKPP"), TYPE_STRING, 9));
                m_view.printRow(appCode, rowCode, "218", format(getValue(value, "IssuerOGRN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "219", format(getValue(value, "IssuerCountryCode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "220", format(getValue(value, "Code711"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "221", format(getValue(value, "LSIN"), TYPE_STRING));
                m_view.printRow(appCode, rowCode, "222", format(getValue(value, "ISIN"), TYPE_STRING, 12));
                m_view.printRow(appCode, rowCode, "223", format(getValue(value, "FaceValueFICode"), TYPE_STRING, 3));
                m_view.printRow(appCode, rowCode, "224", format(getFaceValue(value, "FaceValue", "Code711"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "225", format(getValue(value, "SaleREPOAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "226", format(getValue(value, "TransLoanAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "227", format(getValue(value, "BuyREPOAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "228", format(getValue(value, "AcceptLoanAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "229", format(getValue(value, "TransDUAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "230", format(getValue(value, "TransRightsDUAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "231", format(getValue(value, "TransPledgeBOAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "232", format(getValue(value, "TransPledgeAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "233", format(getValue(value, "AcceptPledgeAmount"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "234", format(getValue(value, "ТогрСчета"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "235", format(getValue(value, "ОгранКД"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "236", format(getValue(value, "ЗапретОпер"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "237", format(getValue(value, "Арест"), TYPE_STRING, 0, 6));
                m_view.printRow(appCode, rowCode, "238", format(getValue(value, "note"), TYPE_STRING));

                it.moveNext();
            end;
        end;
    end;

    local macro constructorTPsdExportController_I5456()
        initTPsdExportController_I4927();
    end;

    constructorTPsdExportController_I5456();
end;

/* ============================= Точка входа ============================== */

class TExportController()
    // 24.08.2018 ABP Каждый класс экспорта должен наследоваться от TPsdExportController
    macro export()
        if   ((rcbApplication().currentReport.context.period.endDate >= RCB_I5456_DATE) or is4927ChangesProject())
            TPsdExportController_I5456().execute();
        elif (RcbApplication().currentReport.context.period.endDate >= RCB_I4927_DATE)
            TPsdExportController_I4927().execute();
        else
            if (not RcbApplication().currentReport.isCalculated)
                TProtocolView("ПРОТОКОЛ ЭКСПОРТА В АС ПСД").checkCalculateReport("АС ПСД");
                установитьФлагВозврата(STOP_PROC_FLG);
                exit(1);
            end;
            if   (RcbApplication().currentReport.context.period.endDate >= RCB_I4637_DATE2)
                TPsdExportController_I4637().execute();
            elif (RcbApplication().currentReport.context.period.EndDate >= RCB_I4212_DATE)
                TPtkPsdExport_I4212().export();
            elif  (RcbApplication().currentReport.context.period.endDate >= RCB_I3269_DATE)
                TPtkPsdExport_I3269().export();
            elif  (RcbApplication().currentReport.context.period.endDate >= RCB_I2627_DATE)
                TPtkPsdExport_I2627().export();
            else
                TPtkPsdExport().export();
            end;
        end;
    end;
end;

macro executePtkPsdExportOperation()
    TExportController().export();
end;

УстановитьФлагВозврата( OK_MACRO_FLAG );
exit(1);

/* EoF */
