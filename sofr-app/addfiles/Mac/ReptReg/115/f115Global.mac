/**
 * Форма 115. Глобальные переменные для формы.
 * 
 * @since   01.06.2008
 * @author  Ivkina Olga
 * @version 6.00.020.28
 */
import RcbGlobal;
import globals;
import f115Parameters;


private var m_global = null;

class (TGlobalBase) TGlobal

    var parameters       : Object = NULL;  

    parameters = TParameters();

    /**
     * Инициализация пакета с датами периода и пакета с символами ОПУ.
     *
     */
    macro initializePackages(report : RcbReport)
        defaultParm(report, rcbApplication.currentReport);

        initializeRepDataPackage(report);

        var m_topSelfId;
        var dataSet = TRsbDataSet("SELECT rsb_rep_pt.get_top_superior_id(" + {OurBank} + ") t_topSelfId FROM DUAL");
        if (dataSet.next())
            m_topSelfId = dataSet.topSelfId;
            sql_truncate("dfforourbank_tmp");
            sql_execute("INSERT INTO dfforourbank_tmp"
                +"\n" + "    SELECT t_partyid"
                +"\n" + "      FROM dparty_dbt party"
                +"\n" + "     WHERE rsb_rep_pt.is_our_bank(party.t_partyId, " + m_topSelfId + ") = 1");

        end;
    end;
end;

macro global() : TGlobal
    if (m_global == null)
        m_global = TGlobal();
    end;
    
    return m_global;
end;