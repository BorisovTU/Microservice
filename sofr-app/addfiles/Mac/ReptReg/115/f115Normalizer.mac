/*
$Name:          f115Normalizer.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 115. Нормализатор.
*/

import f115NormalizationProtocolView;
import ReportNormalizer;
import balanceAttribute;

CONST RCB_RS_PLUS  =  1;
CONST RCB_RS_MINUS = -1;
const CHAPTER_3 = 3;

/**
 * Пара(коэффициент - узел)
 */
private class pair(coefficient, pObject)
    var m_coefficient;
    var m_pObject;

    if (   (valType(coefficient) == V_DOUBLE)
        or (valType(coefficient) == V_MONEY)
       )
        m_coefficient = coefficient;
        m_pObject     = null;
    elif (IsEqClass("RcbNode", coefficient))
        m_coefficient = 1.0;
        m_pObject     = coefficient;
    end;

    if (IsEqClass("RcbNode", pObject))
        m_pObject     = pObject;
    end;
end;

/**
 * Линейная комбинация.
 */
private class LinearCombination(linearRelation)
    var m_linearRelation = linearRelation;
    var m_listRelation   = TArray();

    macro plus(coefficient, pObject)
        m_listRelation[m_listRelation.size] = pair(coefficient, pObject);
    end;

    macro formatting(v)
        v = String(v);
        while ((subStr(v,strLen(v)) == "0") and (strLen(v) > 3))
            v = substr(v,1, strLen(v)-1);
        end;
        return v;
    end;

    macro toNameString()
        var i = 0;
        var lineCombString = "";
        while ( i < m_listRelation.size)
            if (valType(m_listRelation[i].m_pObject) != V_UNDEF)
                lineCombString = lineCombString+" + "+formatting(m_listRelation[i].m_coefficient)+" * "+m_listRelation[i].m_pObject.code;
            else
                lineCombString = lineCombString+" + "+formatting(m_listRelation[i].m_coefficient*rcbApplication.currentReport.multiplier);
            end;
            i = i + 1;
        end;
        return lineCombString;
    end;

    macro toExactString()
        var i = 0;
        var lineCombString = "";
        while ( i < m_listRelation.size)
            lineCombString = lineCombString + " + " + (m_listRelation[i].m_coefficient + "* " + m_listRelation[i].m_pObject.exact);
            i = i + 1;
        end;
        return lineCombString;
    end;

    macro exactResult()
        var i = 0;
        var result = 0;
        while ( i < m_listRelation.size)
            if (valType(m_listRelation[i].m_pObject) != V_UNDEF)
                result = result + (m_listRelation[i].m_coefficient * m_listRelation[i].m_pObject.exact);
            else
                result = result + m_listRelation[i].m_coefficient * rcbApplication.currentReport.multiplier;
            end;
            i = i + 1;
        end;
        return result;
    end;
end;

/**
 * Линейная комбинация левой части.
 */
private class (LinearCombination) LinearCombinationL(linearRelation)
    initLinearCombination(linearRelation);

    macro plus(coefficient, pObject)
        plus(coefficient, pObject);
        if(valtype(pObject) != V_UNDEF)
            m_linearRelation.lhs.plus(coefficient, pObject);
        else
            m_linearRelation.lhs.plus(coefficient);
        end;
        return this;
    end;
end;

/**
 * Линейная комбинация правой части.
 */
private class (LinearCombination) LinearCombinationR(linearRelation)
    initLinearCombination(linearRelation);

    macro plus(coefficient, pObject)
        plus(coefficient, pObject);
        if(valtype(pObject) != V_UNDEF)
            m_linearRelation.rhs.plus(coefficient, pObject);
        else
            m_linearRelation.rhs.plus(coefficient);
        end;
        return this;
    end;
end;

/**
 * Линейная связь.
 */
class linearRelation(relationSign)
    var m_linearRelation = RcbLinearRelation(relationSign);
    var m_relationSign   = relationSign;

    var lhs = LinearCombinationL(m_linearRelation);
    var rhs = LinearCombinationR(m_linearRelation);

    private macro getSign()
       if (m_relationSign == RCB_RS_EQUAL)
              return " == ";
       elif(m_relationSign == RCB_RS_GREATER_OR_EQUAL)
              return " >= ";
       elif(m_relationSign == RCB_RS_LESS_OR_EQUAL)
              return " <= ";
       else
              return "";
       end;
    end;

    macro linearRelationExactCheck(protocolView)
        var expression = string(lhs.exactResult) + getSign() + string(rhs.exactResult);
        if (not execExp(expression))
            protocolView.printRelationError(lhs.toNameString, getSign(), rhs.toNameString);
        end;
    end;

    macro getLinearRelation()
        return m_linearRelation;
    end;
end;

/**
 * Формирование имени узла.
 */
private macro getName(line, column)
    return "Стр" + line + ternary((column != null) and (column != 0), "Гр" + column, "");
end;

/**
 * нормализатор.
 */
class (RcbNormalizer) TNormalizer(protocolView)
    initRcbNormalizer(rcbApplication.currentReport.multiplier);

    /**
     * Ссылка на протокол нормализации.
     */
    private var m_protocolView = protocolView;

    /**
     * Ссылка на отчет.
     */
    private var m_report = objectFactoryInstance.createReport();

    /**
     * Ссылка на значения атрибута.
     */
    private var m_attributeValue;

    /**
     * Начальный номер графы для строки.
     */
    private var m_beginColumn = 0;
    /**
     * Конечный номер графы для строки.
     */
    private var m_endColumn   = 0;

    /**
     * Получить
     * @param     line    код строки
     */
    private macro getValue(line) : TAttribute
        return m_attributeValue.getAttribute(line);
    end;

    /**
     * Добавить узел.
     * @param     parentLine    код родительской строки
     * @param     line          код строки
     * @param     column        код графы
     */
    macro addNode(parentLine, line, column)
        var node  = null;
        var value = getValue(line);
        var relation;

        if (parentLine == line)
            node = _extObj.addNode(getName(line, column));
            node.exclude();
        else
            node = _extObj.node(getName(parentLine, column)).addNode(getName(line, column));
        end;

        if (value.getValue(column) != null)
            node.exact = nvl(value.getValue(column).exact, 0);
        else
            node.exact = 0;
        end;
        node.recalculateScaled();

        return node;
    end;

    /**
     * Загрузить строку значений.
     * @param     parentLine    код родительской строки
     * @param     line          код строки
     */
    private macro loadLine(parentLine, line)
        throw(TPureVirtualMethodCallException("TNormalizer::loadLine"));
    end;

    /**
     * Загрузить данные для нормализации.
     */
    macro load()
        throw(TPureVirtualMethodCallException("TNormalizer::load"));
    end;

    /**
     * Загрузить связь строк.
     */
    private macro loadLinesRelation()
        var i = 1;/*т.к. первый параметр обязателен*/
        var temp;
        var rLines = TArray();
        var lLines = TArray();
        var sign   = null;

        var relation;

        while (GetParm(i, temp))
             if (valType(temp) == V_STRING)
                 if (sign == null)
                       lLines[lLines.size] = temp;
                 else
                     rLines[rLines.size] = temp;
                 end;
             else
                sign = temp;
             end;
             i = i + 1;
        end;

        var column = m_beginColumn;
        while (column <= m_endColumn)
            relation = LinearRelation(sign);

            i = 0;
            while (i < lLines.size)
                relation.lhs.plus(node(getName(lLines[i],  column)));
                i = i + 1;
            end;

            i = 0;
            while (i < rLines.size)
                relation.rhs.plus(node(getName(rLines[i],  column)));
                i = i + 1;
            end;
            relation.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation.getLinearRelation);
            column = column + 1;
        end;
    end;

    /**
     * Сохранить строку значений.
     * @param     line    код строки
     *
     */
    private macro saveLine(line)
        var value = getValue(line);

        macro valueSave(line, column)
            var node = this.node(getName(line, column));
            if (node and (value.getValue(column) != null))
              value.getValue(column).exact  = node.exact;
              value.getValue(column).scaled = node.scaled;
            end;
        end;

        var i = m_beginColumn;
        var columnValue;
        var column;

        while (i <= m_endColumn)
               column = ternary((i==0), "", string(i));
            valueSave(line, column);

            columnValue = value.getValue(column);
            if (columnValue != null)
                if ((columnValue.exact != null) and (columnValue.scaled != floor(columnValue.exact) / rcbApplication.currentReport.multiplier + 0.5))
                    m_protocolView.printSymbol(line, column, columnValue.exact, columnValue.scaled);
                end;
            end;
            i = i + 1;
        end;
    end;

    /**
     * Сохранить атрибуты.
     */
    macro save()
        var attributes = m_attributeValue.getAttributes;
        var i = 0;
        while (i < attributes.size)
            saveLine(attributes[i].getName());
            i = i + 1;
        end;
           m_protocolView.printEnd();
    end;

    macro execute()
        load();
        m_protocolView.endRelErrHeadPrinted();
        normalize();

        if (isNormalized())
            save();
        else
            m_protocolView.printLine("Не удалось провести нормализацию.");
        end;
    end;
end;

//базовый (абстрактный) класс строки протокола нормализации
class TMmbProtocolData()
    private var m_sign;                           //знак
    private var m_indicator;                      //строка с наименованием Показателя
    private var m_condition;                      //строка с наименованием Сравниваемого показателя
    private var m_leftExactBeforeNormalization;   //точное значение левой части выражения до нормализации
    private var m_leftScaledBeforeNormalization;  //округленное значение левой части выражения до нормализации
    private var m_leftScaledAfterNormalization;   //округленное значение левой части выражения после нормализации
    private var m_rightExactBeforeNormalization;  //округленно значение правой части выражения (не меняется при нормализации)
    private var m_delta;                          //Разность
    private var m_note;                           //Примечание

    //строка со знаком сравнения по коду операции сравнения
    private macro getSignString(signCode)
        if (signCode == RCB_RS_EQUAL)
            return "=";
        elif (signCode == RCB_RS_GREATER)
            return ">";
        elif (signCode == RCB_RS_GREATER_OR_EQUAL)
            return ">=";
        elif (signCode == RCB_RS_LESS)
            return "<";
        elif (signCode == RCB_RS_LESS_OR_EQUAL)
            return "<=";
        elif (signCode == RCB_RS_NOT_EQUAL)
            return "<>";
        else
            return "";
        end;
    end;

    private macro getSignStringForNote(signCode)
        if (signCode == RCB_RS_EQUAL)
            return "==";
        elif (signCode == RCB_RS_GREATER)
            return ">";
        elif (signCode == RCB_RS_GREATER_OR_EQUAL)
            return ">=";
        elif (signCode == RCB_RS_LESS)
            return "<";
        elif (signCode == RCB_RS_LESS_OR_EQUAL)
            return "<=";
        elif (signCode == RCB_RS_NOT_EQUAL)
            return "!";
        else
            return "";
        end;
    end;

    //удаление конечных нулей за запятой
    private macro zeroTrim(number : String) : String
        if (Index(number, ".") != 0)
            while (SubStr(number, StrLen(number)) == "0")
                number = SubStr(number, 1, StrLen(number) - 1);
            end;
        end;

        return number;
    end;

    private macro indicatorCalculateBeforeNormalization()
    end;

    private macro indicatorCalculateAfterNormalization()
    end;

    private macro conditionCalculate()
    end;

    //пересчет после нормализации (интерфейс)
    macro recalculateAfterNormalization()
        indicatorCalculateAfterNormalization();
        m_delta = m_leftScaledAfterNormalization - m_leftScaledBeforeNormalization;

        if (execExp("m_leftScaledAfterNormalization" + getSignStringForNote(m_sign) + "m_rightExactBeforeNormalization") == true)
            m_note = ""
        else m_note = "Не удалось провести нормализацию."
        end;
    end;

    macro getSign()
        return getSignString(m_sign);
    end;

    macro getIndicatorString()
        return m_indicator;
    end;

    macro getConditionString()
        return m_condition;
    end;

    macro getLeftExactBeforeNormalization()
        return m_leftExactBeforeNormalization;
    end;

    macro getLeftScaledBeforeNormalization()
        return m_leftScaledBeforeNormalization;
    end;

    macro getLeftScaledAfterNormalization()
        return m_leftScaledAfterNormalization;
    end;

    macro getDelta()
        return m_delta;
    end;

    macro getRightExact()
        return m_rightExactBeforeNormalization;
    end;

    macro getComment()
        return m_note;
    end;

    private macro constructor()
        m_indicator                     = "";
        m_condition                     = "";
        m_sign                          = 0;
        m_leftExactBeforeNormalization  = $0.0;
        m_leftScaledBeforeNormalization = $0.0;
        m_leftScaledAfterNormalization  = $0.0;
        m_rightExactBeforeNormalization = $0.0;
        m_delta                         = $0.0;
        m_note                          = "";
    end;

    constructor();
end;

//класс строки протокола нормализации при сравнении данных разных строк по одним графам
class (TMmbProtocolData) TMmbProtocolDataForOutsideRow(report, part, column, indicatorString, conditionString, rLines : TArray, lLines : TArray, sign : Integer)
    InitTMmbProtocolData();

    private var m_report;
    private var m_rLines;
    private var m_lLines;
    private var m_attributeValue;
    private var m_column;

    private macro getValue(line) : TAttribute
        return m_attributeValue.getAttribute(line);
    end;

    private macro indicatorCalculateBeforeNormalization()
        var value;
        var i = 0;

        while (i < m_lLines.size)
            value = getValue(m_lLines[i]);

            if (value.getValue(m_column) != null)
                if (value.getValue(m_column).exact != null)
                    m_leftExactBeforeNormalization  = m_leftExactBeforeNormalization  + value.getValue(m_column).exact;
                end;
                if (value.getValue(m_column).scaled != null)
                    m_leftScaledBeforeNormalization = m_leftScaledBeforeNormalization + value.getValue(m_column).scaled;
                end;
            end;

            i = i + 1;
        end;
    end;

    private macro indicatorCalculateAfterNormalization()
        var value;
        var i = 0;

        while (i < m_lLines.size)
            value = getValue(m_lLines[i]);

            if (    (value.getValue(m_column) != null)
                and (value.getValue(m_column).scaled != null))
                m_leftScaledAfterNormalization = m_leftScaledAfterNormalization + value.getValue(m_column).scaled;
            end;

            i = i + 1;
        end;
    end;

    private macro conditionCalculate()
        var value;
        var i = 0;

        while (i < m_rLines.size)
            value = getValue(m_rLines[i]);

            if (    (value.getValue(m_column) != null)
                and (value.getValue(m_column).scaled != null))
                m_rightExactBeforeNormalization = m_rightExactBeforeNormalization + value.getValue(m_column).scaled;
            end;

            i = i + 1;
        end;
    end;

    private macro constructorTMmbProtocolDataForOutsideRow(report, part, column, indicatorString, conditionString, rLines : TArray, lLines : TArray, sign : Integer)
        m_indicator      = indicatorString;
        m_condition      = conditionString;
        m_rLines         = rLines;
        m_lLines         = lLines;
        m_sign           = sign;
        m_report         = report;
        m_attributeValue = m_report.getPart(part);
        m_column         = column;

        //выполняем расчет ненормализованных величин
        indicatorCalculateBeforeNormalization();
        conditionCalculate();
    end;

    constructorTMmbProtocolDataForOutsideRow(report, part, column, indicatorString, conditionString, rLines, lLines, sign);
end;

//структура для хранения данных, используемых при нормализации
class TAttributeDataForProtocol(line, column, multiplier, sign, part)
    var m_line       = line;
    var m_column     = column;
    var m_multiplier = multiplier;
    var m_sign       = sign;
    var m_part       = part;
end;

//класс строки протокола нормализации при сравнении данных разных граф по одной строке
class (TMmbProtocolData) TMmbProtocolDataForInsideRow(report, part, lSideData : RcbArray, rSideData : RcbArray, sign : Integer)
    InitTMmbProtocolData();

    private var m_rSideData : RcbArray;     //данные по правой части равества
    private var m_lSideData : RcbArray;     //данные по левой части равества
    private var m_report;
    private var m_part;

    private macro getValue(line) : TAttribute
        return m_part.getAttribute(line);
    end;

    private macro indicatorCalculateBeforeNormalization()
        var value;

        m_lSideData.moveFirst();
        while (m_lSideData.moveNext())
            value = getValue(m_lSideData.getCurrentItem().m_line);

            if (    (value != null)
                and (value.getValue(m_lSideData.getCurrentItem().m_column) != null))
                if (value.getValue(m_lSideData.getCurrentItem().m_column).exact != null)
                    m_leftExactBeforeNormalization  = m_leftExactBeforeNormalization  + value.getValue(m_lSideData.getCurrentItem().m_column).exact * m_lSideData.getCurrentItem().m_multiplier * m_lSideData.getCurrentItem().m_sign;
                end;
                if (value.getValue(m_lSideData.getCurrentItem().m_column).scaled != null)
                    m_leftScaledBeforeNormalization = m_leftScaledBeforeNormalization + value.getValue(m_lSideData.getCurrentItem().m_column).scaled * m_lSideData.getCurrentItem().m_multiplier * m_lSideData.getCurrentItem().m_sign;
                end;
            end;
        end;
    end;

    private macro indicatorCalculateAfterNormalization()
        var value;

        m_lSideData.moveFirst();
        while (m_lSideData.moveNext())
            value = getValue(m_lSideData.getCurrentItem().m_line);

            if (    (value != null)
                and (value.getValue(m_lSideData.getCurrentItem().m_column) != null)
                and (value.getValue(m_lSideData.getCurrentItem().m_column).scaled != null))
                m_leftScaledAfterNormalization = m_leftScaledAfterNormalization + value.getValue(m_lSideData.getCurrentItem().m_column).scaled * m_lSideData.getCurrentItem().m_multiplier * m_lSideData.getCurrentItem().m_sign;
            end;
        end;
    end;

    private macro conditionCalculate()
        var value;

        m_rSideData.moveFirst();
        while (m_rSideData.moveNext())

            //если раздел не задан, значит текущий
            if (m_rSideData.getCurrentItem().m_part == null)
                value = getValue(m_rSideData.getCurrentItem().m_line);
            else
                value = m_report.getPart(m_rSideData.getCurrentItem().m_part).getAttribute(m_rSideData.getCurrentItem().m_line);
            end;

            if (    (value != null)
                and (value.getValue(m_rSideData.getCurrentItem().m_column) != null)
                and (value.getValue(m_rSideData.getCurrentItem().m_column).scaled != null))
                m_rightExactBeforeNormalization = m_rightExactBeforeNormalization + value.getValue(m_rSideData.getCurrentItem().m_column).scaled * m_rSideData.getCurrentItem().m_multiplier * m_rSideData.getCurrentItem().m_sign;
            end;
        end;
    end;

    private macro constructorTMmbProtocolDataForInsideRow(report, part, lSideData : RcbArray, rSideData : RcbArray, sign : Integer)
        m_rSideData = rSideData;
        m_lSideData = lSideData;
        m_sign      = sign;
        m_report    = report;
        m_part      = m_report.getPart(part);

        m_rSideData.moveFirst();
        while (m_rSideData.moveNext())
            if (m_condition == "")
                m_condition = ternary(m_rSideData.getCurrentItem().m_multiplier != 1, zeroTrim(String(m_rSideData.getCurrentItem().m_multiplier)) + "*", "")
                            + ternary(m_rSideData.getCurrentItem().m_part != null, "Разд" + m_rSideData.getCurrentItem().m_part, "")
                            + "Стр" + m_rSideData.getCurrentItem().m_line
                            + ternary(m_rSideData.getCurrentItem().m_column != null, "Гр" + m_rSideData.getCurrentItem().m_column, "");                                    //для некоторрых разделов Графа может отсутствовать
            else
                m_condition = m_condition + ternary(m_rSideData.getCurrentItem().m_sign == RCB_RS_PLUS, "+", "-")
                                          + ternary(m_rSideData.getCurrentItem().m_multiplier != 1, zeroTrim(String(m_rSideData.getCurrentItem().m_multiplier)) + "*", "")
                                          + ternary(m_rSideData.getCurrentItem().m_part != null, "Разд" + m_rSideData.getCurrentItem().m_part, "")
                                          + "Стр" + m_rSideData.getCurrentItem().m_line
                                          + ternary(m_rSideData.getCurrentItem().m_column != null, "Гр" + m_rSideData.getCurrentItem().m_column, "");                      //для некоторрых разделов Графа может отсутствовать
            end;
        end;

        m_lSideData.moveFirst();
        while (m_lSideData.moveNext())
            if (m_indicator == "")
                m_indicator = ternary(m_lSideData.getCurrentItem().m_multiplier != 1, zeroTrim(String(m_lSideData.getCurrentItem().m_multiplier)) + "*", "")
                            + "Стр" + m_lSideData.getCurrentItem().m_line
                            + ternary(m_lSideData.getCurrentItem().m_column != null, "Гр" + m_lSideData.getCurrentItem().m_column, "");                                    //для некоторрых разделов Графа может отсутствовать
            else
                m_indicator = m_indicator + ternary(m_lSideData.getCurrentItem().m_sign == RCB_RS_PLUS, "+", "-")
                                          + ternary(m_lSideData.getCurrentItem().m_multiplier != 1, zeroTrim(String(m_lSideData.getCurrentItem().m_multiplier)) + "*", "")
                                          + ternary(m_lSideData.getCurrentItem().m_part != null, "Разд" + m_lSideData.getCurrentItem().m_part, "")
                                          + "Стр" + m_lSideData.getCurrentItem().m_line
                                          + ternary(m_lSideData.getCurrentItem().m_column != null, "Гр" + m_lSideData.getCurrentItem().m_column, "");                      //для некоторрых разделов Графа может отсутствовать
            end;
        end;

        //выполняем расчет ненормализованных величин
        indicatorCalculateBeforeNormalization();
        conditionCalculate();
    end;

    constructorTMmbProtocolDataForInsideRow(report, part, lSideData, rSideData, sign);
end;

/**
 * нормализатор ММБ
 */
class (ReportNormalizer) TNormalizer_MMB(protocolView)
    initReportNormalizer(rcbApplication.currentReport.multiplier);

    private var m_part;
    private var m_report = objectFactoryInstance.createReport();
    private var m_stringsForProtocol = TArray();  //массив типа TMmbProtocolData

    /**
     * Ссылка на протокол нормализации.
     */
    private var m_protocolView = protocolView;

    /**
     * Ссылка на значения атрибута.
     */
    private var m_attributeValue;

    /**
     * Начальный номер графы для строки.
     */
    private var m_beginColumn = 0;
    /**
     * Конечный номер графы для строки.
     */
    private var m_endColumn   = 0;

    /**
     * Получить
     * @param     line    код строки
     */
    private macro getValue(line) : TAttribute
        return m_attributeValue.getAttribute(line);
    end;

    /**
     * Добавить узел.
     * @param     parentLine    код родительской строки
     * @param     line          код строки
     * @param     column        код графы
     */
    macro addNode(parentLine, line, column)
        var node  = null;
        var value = getValue(line);
        var relation;

        if (parentLine == line)
            node = normalizer.addNode(getName(line, column));
            node.exclude();
        else
            node = normalizer.node(getName(parentLine, column)).addNode(getName(line, column));
        end;

        if (value.getValue(column) != null)
            node.exact = nvl(value.getValue(column).exact, 0);
        else
            node.exact = 0;
        end;
        node.recalculateScaled();

        return node;
    end;

    /**
     * Загрузить строку значений.
     * @param     parentLine    код родительской строки
     * @param     line          код строки
     */
    private macro loadLine(parentLine, line)
        throw(TPureVirtualMethodCallException("TNormalizer::loadLine"));
    end;

    /**
     * Загрузить данные для нормализации.
     */
    macro load()
        throw(TPureVirtualMethodCallException("TNormalizer::load"));
    end;

    /**
     * Загрузить связь строк.
     */
    private macro loadLinesRelation()
        var i = 1;/*т.к. первый параметр обязателен*/
        var temp;
        var rLines = TArray();
        var lLines = TArray();
        var sign   = null;
        var indicator = "";
        var condition = "";
        var name;
        var relation;

        while (GetParm(i, temp))
             if (valType(temp) == V_STRING)
                 if (sign == null)
                     lLines[lLines.size] = temp;
                 else
                     rLines[rLines.size] = temp;
                 end;
             else
                sign = temp;
             end;
             i = i + 1;
        end;

        var column = m_beginColumn;
        while (column <= m_endColumn)
            relation = ReportLinearRelation(sign);
            indicator = "";
            condition = "";

            i = 0;
            while (i < lLines.size)
                name = getName(lLines[i],  column);

                if (indicator == "")
                    indicator = name;
                else
                    indicator = indicator + "+" + name;
                end;

                relation.lhs.plus(node(name));
                i = i + 1;
            end;

            i = 0;
            while (i < rLines.size)
                name = getName(rLines[i],  column);

                if (condition == "")
                    condition = name;
                else
                    condition = condition + "+" + name;
                end;

                relation.rhs.plus(node(name));
                i = i + 1;
            end;

            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForOutsideRow(m_report, m_part, column, indicator, condition, rLines, lLines, sign);

            addRelation(relation);
            column = column + 1;
        end;
    end;

    /**
     * Сохранить строку значений.
     * @param     line    код строки
     *
     */
    private macro saveLine(line)
        var value = getValue(line);

        macro valueSave(line, column)
            var node = this.node(getName(line, column));

            if (    (node != null)
                and (value.getValue(column) != null)
               )
                if (node.exact != null)
                    value.getValue(column).exact  = node.exact;
                end;
                if (node.scaled != null)
                    value.getValue(column).scaled = node.scaled;
                end;
            end;
        end;

        var i = m_beginColumn;
        var columnValue;
        var column;

        while (i <= m_endColumn)
            column = ternary((i==0), "", string(i));
            valueSave(line, column);
            i = i + 1;
        end;
    end;

    /**
     * Сохранить атрибуты.
     */
    macro save()
        var attributes = m_attributeValue.getAttributes;
        var i = 0;
        while (i < attributes.size)
            saveLine(attributes[i].getName());
            i = i + 1;
        end;
           m_protocolView.printEnd();
    end;

    macro execute()
        var i = 0;

        load();
        normalize();
        save();

        while (i < m_stringsForProtocol.size)
            m_stringsForProtocol[i].recalculateAfterNormalization();
            m_protocolView.printSymbol(m_stringsForProtocol[i].getIndicatorString(),
                                       m_stringsForProtocol[i].getLeftExactBeforeNormalization(),
                                       m_stringsForProtocol[i].getLeftScaledBeforeNormalization(),
                                       m_stringsForProtocol[i].getLeftScaledAfterNormalization(),
                                       m_stringsForProtocol[i].getDelta(),
                                       m_stringsForProtocol[i].getSign(),
                                       m_stringsForProtocol[i].getConditionString(),
                                       m_stringsForProtocol[i].getRightExact(),
                                       m_stringsForProtocol[i].getComment()
                                      );
            i = i + 1;
        end;

        m_protocolView.printEnd();
    end;
end;

/**
 * Нормализация раздела 1.
 */
class (TNormalizer) TPart1Normalizer(protocolView)
    initTNormalizer(protocolView);
    m_attributeValue = m_report.getPart("1");
    m_beginColumn    =  3;
    m_endColumn      = 19;

    /**
     * Загрузить строку значений.
     * @param     parentLine    код родительской строки
     * @param     line          код строки
     */
    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");
        var node5  = addNode(parentLine, line, "5");
        var node6  = addNode(parentLine, line, "6");
        var node7  = addNode(parentLine, line, "7");
        var node8  = addNode(parentLine, line, "8");
        var node9  = addNode(parentLine, line, "9");
        var node10 = addNode(parentLine, line, "10");
        var node11 = addNode(parentLine, line, "11");
        var node12 = addNode(parentLine, line, "12");
        var node13 = addNode(parentLine, line, "13");
        var node14 = addNode(parentLine, line, "14");
        var node15 = addNode(parentLine, line, "15");
        var node16 = addNode(parentLine, line, "16");
        var node17 = addNode(parentLine, line, "17");
        var node18 = addNode(parentLine, line, "18");
        var node19 = addNode(parentLine, line, "19");

        var relation;
        if ((line != "4.1.1")   and
            (line != "4.1.2")   and
            (line != "4.1.1.1") and
            (line != "4.1.2.1"))
            relation = LinearRelation(RCB_RS_EQUAL);
            relation.lhs.plus(node4).plus(node5).plus(node6).plus(node7).plus(node8);
            relation.rhs.plus(node3);
        else
            relation = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation.lhs.plus(node4).plus(node5);
            relation.rhs.plus(node3);
        end;
        relation.linearRelationExactCheck(m_protocolView);
        this.addRelation(relation.getLinearRelation);


        var relation2;
        if ((line != "1.1")     and
            (line != "4.1.1")   and
            (line != "4.1.2")   and
            (line != "4.1.1.1") and
            (line != "4.1.2.1"))
            relation2 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation2.lhs.plus(node9).plus(node10).plus(node11).plus(node12);
            relation2.rhs.plus(node3);
            relation2.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation2.getLinearRelation);
        end;

        var relation3;
        if ((line != "1.1") and
            (line != "1.8") and
            (line != "2.7") and
            (line != "3.6"))
            relation3 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation3.lhs.plus(node14);
            relation3.rhs.plus(node13);
            relation3.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation3.getLinearRelation);
        end;

        var relation4;
        if ((line != "1")   and
            (line != "2")   and
            (line != "3")   and
            (line != "4")   and
            (line != "1.1") and
            (line != "1.8") and
            (line != "2.7") and
            (line != "3.6"))
            relation4 = LinearRelation(RCB_RS_EQUAL);
            relation4.lhs.plus(node14);
            relation4.rhs.plus(node15);
            relation4.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation4.getLinearRelation);
        end;

        var relation5;
        var relation7;
        var relation8;
        var relation9;

        if ((line != "4.1.1")   and
            (line != "4.1.2")   and
            (line != "4.1.1.1") and
            (line != "4.1.2.1"))
            relation5 = LinearRelation(RCB_RS_EQUAL);
            relation5.lhs.plus(node16).plus(node17).plus(node18).plus(node19);
            relation5.rhs.plus(node15);
            relation5.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation5.getLinearRelation);

            relation8 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation8.lhs.plus(node18);
            relation8.rhs.plus(node7);
            relation8.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation8.getLinearRelation);

            relation9 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation9.lhs.plus(node19);
            relation9.rhs.plus(node8);
            relation9.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation9.getLinearRelation);
        end;
    end;

    macro load()
        loadLine("4", "4");

        loadLine("4", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");
        loadLine("1", "1.6");
        loadLine("1", "1.7");
        loadLine("1", "1.8");

        loadLine("4", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");
        loadLine("2", "2.3");
        loadLine("2", "2.4");
        loadLine("2", "2.5");
        loadLine("2", "2.6");
        loadLine("2", "2.7");

        loadLine("4", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");
        loadLine("3", "3.6");

        loadLine("4.1",     "4.1");
        loadLine("4.1.1",   "4.1.1");
        loadLine("4.1.1.1", "4.1.1.1");
        loadLine("4.1.2",   "4.1.2");
        loadLine("4.1.2.1", "4.1.2.1");

        loadLinesRelation("4",     RCB_RS_GREATER_OR_EQUAL, "4.1");
        loadLinesRelation("4.1",   RCB_RS_GREATER_OR_EQUAL, "4.1.1", "4.1.2");
        loadLinesRelation("4.1.1", RCB_RS_GREATER_OR_EQUAL, "4.1.1.1");
        loadLinesRelation("4.1.2", RCB_RS_GREATER_OR_EQUAL, "4.1.2.1");
    end;
end;

/**
 * Нормализация раздела 2.
 */
class (TNormalizer) TPart2Normalizer(protocolView)
    initTNormalizer(protocolView);
    m_attributeValue = m_report.getPart("2");
    m_beginColumn    = 3;
    m_endColumn      = 4;

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        private macro conditionLoad(nodeL, condition, nodeR, coefficientR, miscalculation)
            var relation = LinearRelation(condition);

            relation.lhs.plus(nodeL);

            if(coefficientR == null)
                relation.rhs.plus(nodeR);
            else
                relation.rhs.plus(coefficientR, nodeR);
            end;

            if ((miscalculation != null) and  not((nodeR.exact == $0) and (nodeL.exact == $0)))
                  relation.rhs.plus(miscalculation/* * multiplier*/);
            end;

            relation.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation.getLinearRelation);
        end;

        if ((line != "1.1") and
            (line != "2.1") and
            (line != "3.1"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;
    end;

    macro load()
        loadLine("1", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");

        loadLine("2", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");
        loadLine("2", "2.3");
        loadLine("2", "2.4");
        loadLine("2", "2.5");

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");

        loadLine("4",  "4");
        loadLine("4.1","4.1");

        loadLinesRelation("4",     RCB_RS_GREATER_OR_EQUAL, "4.1");
    end;
end;

/**
 * Нормализация раздела 3.
 */
class (TNormalizer) TPart3Normalizer(protocolView)
    initTNormalizer(protocolView);
    m_attributeValue = m_report.getPart("3");
    m_beginColumn    = 3;
    m_endColumn      = 4;

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        private macro conditionLoad(nodeL, condition, nodeR, coefficientR, miscalculation)
            var relation = LinearRelation(condition);

            relation.lhs.plus(nodeL);
            if (coefficientR == null)
                 relation.rhs.plus(nodeR);
            else
                relation.rhs.plus(coefficientR, nodeR);
            end;

            if ((miscalculation != null) and  not((nodeR.exact == $0) and (nodeL.exact == $0)))
                 relation.rhs.plus(miscalculation);
            end;
            relation.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation.getLinearRelation);
        end;

        if ((line != "2") and
            (line != "3.1"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;
    end;

    macro load()
        loadLine("1",   "1");

        loadLine("1.1", "1.1");
        loadLine("1.1", "1.1.1");
        loadLine("1.1", "1.1.2");
        loadLine("1.1", "1.1.3");
        loadLine("1.1", "1.1.4");
        loadLine("1.1", "1.1.5");

        loadLine("1.2", "1.2");
        loadLine("1.2", "1.2.1");
        loadLine("1.2", "1.2.2");
        loadLine("1.2", "1.2.3");
        loadLine("1.2", "1.2.4");
        loadLine("1.2", "1.2.5");

        loadLine("1.3", "1.3");
        loadLine("1.3", "1.3.1");
        loadLine("1.3", "1.3.2");
        loadLine("1.3", "1.3.3");
        loadLine("1.3", "1.3.4");
        loadLine("1.3", "1.3.5");

        loadLine("1.4", "1.4");
        loadLine("1.4", "1.4.1");
        loadLine("1.4", "1.4.2");
        loadLine("1.4", "1.4.3");
        loadLine("1.4", "1.4.4");
        loadLine("1.4", "1.4.5");

        loadLine("1", "2.1");
        loadLine("1", "2.2");
        loadLine("1", "2.3");
        loadLine("1", "2.4");

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");

        loadLine("4",  "4");
        loadLine("4.1","4.1");

        loadLinesRelation("1", RCB_RS_GREATER_OR_EQUAL, "1.1", "1.2", "1.3", "1.4");
        loadLinesRelation("4", RCB_RS_GREATER_OR_EQUAL, "4.1");
    end;
end;

/**
 * Нормализация раздела Справочно.
 */
class (TNormalizer) TPart4Normalizer(protocolView)
    initTNormalizer(protocolView);
    m_attributeValue = m_report.getPart("4");

    private macro loadLine(parentLine, line)
        var node  = addNode(parentLine, line);
    end;

    macro load()
        loadLine("1",   "1");
        loadLine("1",   "1.1");
        loadLine("1",   "1.2");
        loadLine("1",   "1.3");
        loadLine("1",   "1.4");

        loadLine("2",   "2");
        loadLine("2",   "2.1");
        loadLine("2",   "2.2");
        loadLine("2",   "2.3");
        loadLine("2",   "2.4");

        loadLine("3.1", "3.1");
        loadLine("3.2", "3.2");
        loadLine("3.3", "3.3");
        loadLine("3.4", "3.4");

        var relation = LinearRelation(RCB_RS_LESS_OR_EQUAL);
           relation.lhs.plus(node(getName("3.1")));
           relation.rhs.plus(m_report.getPart("1").getAttribute("4.1").getValue("13").scaled);
        relation.linearRelationExactCheck(m_protocolView);
        this.addRelation(relation.getLinearRelation);

        relation = LinearRelation(RCB_RS_LESS_OR_EQUAL);
           relation.lhs.plus(node(getName("3.2")));
           relation.rhs.plus(m_report.getPart("1").getAttribute("4.1").getValue("14").scaled);
        relation.linearRelationExactCheck(m_protocolView);
        this.addRelation(relation.getLinearRelation);

        loadLinesRelation("3.1", RCB_RS_GREATER_OR_EQUAL, "3.2");
    end;
end;

/**
 * Нормализация раздела 1.
 */
class (TNormalizer) TPart1Normalizer2332(protocolView)
    initTNormalizer(protocolView);
    m_attributeValue = m_report.getPart("1");
    m_beginColumn    =  3;
    m_endColumn      = 19;

    /**
     * Загрузить строку значений.
     * @param     parentLine    код родительской строки
     * @param     line          код строки
     */
    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");
        var node5  = addNode(parentLine, line, "5");
        var node6  = addNode(parentLine, line, "6");
        var node7  = addNode(parentLine, line, "7");
        var node8  = addNode(parentLine, line, "8");
        var node9  = addNode(parentLine, line, "9");
        var node10 = addNode(parentLine, line, "10");
        var node11 = addNode(parentLine, line, "11");
        var node12 = addNode(parentLine, line, "12");
        var node13 = addNode(parentLine, line, "13");
        var node14 = addNode(parentLine, line, "14");
        var node15 = addNode(parentLine, line, "15");
        var node16 = addNode(parentLine, line, "16");
        var node17 = addNode(parentLine, line, "17");
        var node18 = addNode(parentLine, line, "18");
        var node19 = addNode(parentLine, line, "19");

        var relation;
        if ((line != "4.1.1.1") and
            (line != "4.1.2.1"))
            relation = LinearRelation(RCB_RS_EQUAL);
            relation.lhs.plus(node4).plus(node5).plus(node6).plus(node7).plus(node8);
            relation.rhs.plus(node3);
        else
            relation = LinearRelation(RCB_RS_EQUAL);
            relation.lhs.plus(node4).plus(node5).plus(node6).plus(node7);
            relation.rhs.plus(node3);
        end;
        relation.linearRelationExactCheck(m_protocolView);
        this.addRelation(relation.getLinearRelation);


        var relation2;
        if ((line != "1.1"))
            if ((line != "4.1.1.1") and
                (line != "4.1.2.1"))
                relation2 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
                relation2.lhs.plus(node9).plus(node10).plus(node11).plus(node12);
                relation2.rhs.plus(node3);
            else
                relation2 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
                relation2.lhs.plus(node9).plus(node10).plus(node11);
                relation2.rhs.plus(node3);
            end;
            relation2.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation2.getLinearRelation);
        end;

        var relation3;
        if ((line != "1.1") and
            (line != "1.8") and
            (line != "2.7") and
            (line != "3.6"))
            relation3 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation3.lhs.plus(node14);
            relation3.rhs.plus(node13);
            relation3.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation3.getLinearRelation);
        end;

        var relation4;
        if ((line != "1")   and
            (line != "2")   and
            (line != "3")   and
            (line != "4")   and
            (line != "1.1") and
            (line != "1.8") and
            (line != "2.7") and
            (line != "3.6"))
            relation4 = LinearRelation(RCB_RS_EQUAL);
            relation4.lhs.plus(node14);
            relation4.rhs.plus(node15);
            relation4.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation4.getLinearRelation);
        end;

        var relation5;
        if ((line != "4.1.1.1") and
            (line != "4.1.2.1"))
            relation5 = LinearRelation(RCB_RS_EQUAL);
            relation5.lhs.plus(node16).plus(node17).plus(node18).plus(node19);
            relation5.rhs.plus(node15);
            relation5.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation5.getLinearRelation);
        else
            relation5 = LinearRelation(RCB_RS_EQUAL);
            relation5.lhs.plus(node16).plus(node17).plus(node18);
            relation5.rhs.plus(node15);
            relation5.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation5.getLinearRelation);
        end;


        var relation6 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation6.lhs.plus(node16);
        relation6.rhs.plus(0.2, node5);
        this.addRelation(relation6.getLinearRelation);

        var relation7 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation7.lhs.plus(node17);
        relation7.rhs.plus(0.5, node6);
        this.addRelation(relation7.getLinearRelation);

        var relation8 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation8.lhs.plus(node18);
        relation8.rhs.plus(node7);
        relation8.linearRelationExactCheck(m_protocolView);
        this.addRelation(relation8.getLinearRelation);

        var relation9;
        if ((line != "4.1.1.1") and
            (line != "4.1.2.1"))
            relation9 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation9.lhs.plus(node19);
            relation9.rhs.plus(node8);
            relation9.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation9.getLinearRelation);
        end;
    end;

    macro load()
        loadLine("4", "4");

        loadLine("4", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");
        loadLine("1", "1.6");
        loadLine("1", "1.7");
        loadLine("1", "1.8");

        loadLine("4", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");
        loadLine("2", "2.3");
        loadLine("2", "2.4");
        loadLine("2", "2.5");
        loadLine("2", "2.6");
        loadLine("2", "2.7");
        loadLine("2", "2.8");

        loadLine("4", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");
        loadLine("3", "3.6");

        loadLine("4.1",     "4.1");
        loadLine("4.1.1",   "4.1.1");
        loadLine("4.1.1.1", "4.1.1.1");
        loadLine("4.1.2",   "4.1.2");
        loadLine("4.1.2.1", "4.1.2.1");

        loadLinesRelation("4",     RCB_RS_GREATER_OR_EQUAL, "4.1");
        loadLinesRelation("4.1",   RCB_RS_GREATER_OR_EQUAL, "4.1.1", "4.1.2");
        loadLinesRelation("4.1.1", RCB_RS_GREATER_OR_EQUAL, "4.1.1.1");
        loadLinesRelation("4.1.2", RCB_RS_GREATER_OR_EQUAL, "4.1.2.1");
    end;
end;

/**
 * Нормализация раздела 2.
 */
class (TNormalizer) TPart2Normalizer2332(protocolView)
    initTNormalizer(protocolView);
    m_attributeValue = m_report.getPart("2");
    m_beginColumn    = 3;
    m_endColumn      = 4;

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        private macro conditionLoad(nodeL, condition, nodeR, coefficientR, miscalculation)
            var relation = LinearRelation(condition);

            relation.lhs.plus(nodeL);

            if(coefficientR == null)
                relation.rhs.plus(nodeR);
            else
                relation.rhs.plus(coefficientR, nodeR);
            end;

            if ((miscalculation != null) and  not((nodeR.exact == $0) and (nodeL.exact == $0)))
                  relation.rhs.plus(miscalculation/* * multiplier*/);
            end;

            relation.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation.getLinearRelation);
        end;

        if ((line != "1.1") and
            (line != "3")   and
            (line != "4.1") and
            (line != "5.1"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;

        if ((line == "1.2") or
            (line == "3.1") or
            (line == "4.2") or
            (line == "5.2"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3, 0.03, 1.0);

        elif ((line == "1.3") or
              (line == "3.2") or
              (line == "4.3") or
              (line == "5.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.2,   1.0);

        elif ((line == "1.4") or
              (line == "3.3") or
              (line == "4.4") or
              (line == "5.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.5, 1.0);

        elif ((line == "1.5") or
              (line == "3.4") or
              (line == "4.5") or
              (line == "5.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5, -1.0);

        elif ((line == "2.1.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif ((line == "2.1.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "2.1.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.1);

        elif ((line == "2.1.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.35);

        elif ((line == "2.2.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif ((line == "2.2.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03);

        elif ((line == "2.2.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2);

        elif ((line == "2.2.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5);

        elif ((line == "2.1.5") or
              (line == "2.2.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.75);
        end;
    end;

    macro load()
        loadLine("1", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");

        loadLine("2", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");

        loadLine("2.1", "2.1.1");
        loadLine("2.1", "2.1.2");
        loadLine("2.1", "2.1.3");
        loadLine("2.1", "2.1.4");
        loadLine("2.1", "2.1.5");

        loadLine("2.2", "2.2.1");
        loadLine("2.2", "2.2.2");
        loadLine("2.2", "2.2.3");
        loadLine("2.2", "2.2.4");
        loadLine("2.2", "2.2.5");

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLinesRelation("3", RCB_RS_LESS_OR_EQUAL, "3.1", "3.2", "3.3", "3.4");

        loadLine("4", "4");
        loadLine("4", "4.1");
        loadLine("4", "4.2");
        loadLine("4", "4.3");
        loadLine("4", "4.4");
        loadLine("4", "4.5");

        loadLine("5", "5");
        loadLine("5", "5.1");
        loadLine("5", "5.2");
        loadLine("5", "5.3");
        loadLine("5", "5.4");
        loadLine("5", "5.5");

        loadLine("6",  "6");
        loadLine("6.1","6.1");
        loadLinesRelation("6",     RCB_RS_GREATER_OR_EQUAL, "6.1");
    end;
end;

/**
 * Нормализация раздела 2 по 2926-У.
 */
class (TPart2Normalizer2332) TPart2Normalizer2926(protocolView)
    initTPart2Normalizer2332(protocolView);
    m_attributeValue = m_report.getPart("2");
    m_beginColumn    = 3;
    m_endColumn      = 4;

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        private macro conditionLoad(nodeL, condition, nodeR, coefficientR, miscalculation)
            var relation = LinearRelation(condition);

            relation.lhs.plus(nodeL);

            if(coefficientR == null)
                relation.rhs.plus(nodeR);
            else
                relation.rhs.plus(coefficientR, nodeR);
            end;

            if ((miscalculation != null) and  not((nodeR.exact == $0) and (nodeL.exact == $0)))
                  relation.rhs.plus(miscalculation/* * multiplier*/);
            end;

            relation.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation.getLinearRelation);
        end;

        if ((line != "1.1") and
            (line != "3")   and
            (line != "4.1") and
            (line != "5.1"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;

        if ((line == "1.2") or
            (line == "3.1") or
            (line == "4.2") or
            (line == "5.2"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3, 0.03, 1.0);

        elif ((line == "1.3") or
              (line == "3.2") or
              (line == "4.3") or
              (line == "5.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.2,   1.0);

        elif ((line == "1.4") or
              (line == "3.3") or
              (line == "4.4") or
              (line == "5.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.5, 1.0);

        elif ((line == "1.5") or
              (line == "3.4") or
              (line == "4.5") or
              (line == "5.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5, -1.0);

        elif ((line == "2.1.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif ((line == "2.1.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "2.1.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.1);

        elif ((line == "2.1.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.35);

        elif ((line == "2.2.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif ((line == "2.2.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03);

        elif ((line == "2.2.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2);

        elif ((line == "2.2.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5);

        elif ((line == "2.1.5") or
              (line == "2.2.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.75);
        elif ((line == "2.1.6") or
              (line == "2.2.6"))
            conditionLoad(node4, RCB_RS_EQUAL, node3, 1.0);
        end;
    end;

    macro load()
        loadLine("1", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");

        loadLine("2", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");

        loadLine("2.1", "2.1.1");
        loadLine("2.1", "2.1.2");
        loadLine("2.1", "2.1.3");
        loadLine("2.1", "2.1.4");
        loadLine("2.1", "2.1.5");
        loadLine("2.1", "2.1.6");

        loadLine("2.2", "2.2.1");
        loadLine("2.2", "2.2.2");
        loadLine("2.2", "2.2.3");
        loadLine("2.2", "2.2.4");
        loadLine("2.2", "2.2.5");
        loadLine("2.2", "2.2.6");

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLinesRelation("3", RCB_RS_LESS_OR_EQUAL, "3.1", "3.2", "3.3", "3.4");

        loadLine("4", "4");
        loadLine("4", "4.1");
        loadLine("4", "4.2");
        loadLine("4", "4.3");
        loadLine("4", "4.4");
        loadLine("4", "4.5");

        loadLine("5", "5");
        loadLine("5", "5.1");
        loadLine("5", "5.2");
        loadLine("5", "5.3");
        loadLine("5", "5.4");
        loadLine("5", "5.5");

        loadLine("6",  "6");
        loadLine("6.1","6.1");
        loadLinesRelation("6",     RCB_RS_GREATER_OR_EQUAL, "6.1");
    end;
end;

/**
 * Нормализация раздела 2 по 3006-У.
 */
class (TPart2Normalizer2926) TPart2Normalizer3006(protocolView)
    initTPart2Normalizer2926(protocolView);
    m_attributeValue = m_report.getPart("2");
    m_beginColumn    = 3;
    m_endColumn      = 4;

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        private macro conditionLoad(nodeL, condition, nodeR, coefficientR, miscalculation)
            var relation = LinearRelation(condition);

            relation.lhs.plus(nodeL);

            if(coefficientR == null)
                relation.rhs.plus(nodeR);
            else
                relation.rhs.plus(coefficientR, nodeR);
            end;

            if ((miscalculation != null) and  not((nodeR.exact == $0) and (nodeL.exact == $0)))
                  relation.rhs.plus(miscalculation/* * multiplier*/);
            end;

            relation.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation.getLinearRelation);
        end;

        if ((line != "1.1")   and
            (line != "2.1.6") and
            (line != "2.2.6") and
            (line != "3")     and
            (line != "4.1")   and
            (line != "5.1"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;

        if ((line == "1.2") or
            (line == "3.1") or
            (line == "4.2") or
            (line == "5.2"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3, 0.03, 1.0);

        elif ((line == "1.3") or
              (line == "3.2") or
              (line == "4.3") or
              (line == "5.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.2,   1.0);

        elif ((line == "1.4") or
              (line == "3.3") or
              (line == "4.4") or
              (line == "5.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.5, 1.0);

        elif ((line == "1.5") or
              (line == "3.4") or
              (line == "4.5") or
              (line == "5.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5, -1.0);

        elif ((line == "2.1.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif ((line == "2.1.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "2.1.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.1);

        elif ((line == "2.1.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.35);

        elif ((line == "2.2.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif ((line == "2.2.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03);

        elif ((line == "2.2.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2);

        elif ((line == "2.2.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5);

        elif ((line == "2.1.5") or
              (line == "2.2.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.75);
        elif ((line == "2.1.6") or
              (line == "2.2.6"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 1.0);
        end;
    end;

    macro load()
        loadLine("1", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");

        loadLine("2", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");

        loadLine("2.1", "2.1.1");
        loadLine("2.1", "2.1.2");
        loadLine("2.1", "2.1.3");
        loadLine("2.1", "2.1.4");
        loadLine("2.1", "2.1.5");
        loadLine("2.1", "2.1.6");

        loadLine("2.2", "2.2.1");
        loadLine("2.2", "2.2.2");
        loadLine("2.2", "2.2.3");
        loadLine("2.2", "2.2.4");
        loadLine("2.2", "2.2.5");
        loadLine("2.2", "2.2.6");

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");

        loadLine("4", "4");
        loadLine("4", "4.1");
        loadLine("4", "4.2");
        loadLine("4", "4.3");
        loadLine("4", "4.4");
        loadLine("4", "4.5");

        loadLine("5", "5");
        loadLine("5", "5.1");
        loadLine("5", "5.2");
        loadLine("5", "5.3");
        loadLine("5", "5.4");
        loadLine("5", "5.5");

        loadLine("6",  "6");
        loadLine("6.1","6.1");
        loadLinesRelation("6",     RCB_RS_GREATER_OR_EQUAL, "6.1");
    end;
end;

/**
 * Нормализация раздела 2 по 3129-У.
 */
class (TNormalizer_MMB) TPart2Normalizer3129(protocolView)
    initTNormalizer_MMB(protocolView);

    m_part           = "2";
    m_attributeValue = m_report.getPart(m_part);
    m_beginColumn    = 3;
    m_endColumn      = 4;

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        private macro conditionLoad(nodeL, condition, nodeR, coefficientR, miscalculation)
            var relation = ReportLinearRelation(condition);

            relation.lhs.plus(nodeL);

            if(coefficientR == null)
                relation.rhs.plus(nodeR);
            else
                relation.rhs.plus(coefficientR, nodeR);
            end;

            if ((miscalculation != null) and  not((nodeR.exact == $0) and (nodeL.exact == $0)))
                  relation.rhs.plus(miscalculation/* * multiplier*/);
            end;

            relation.checkExactValue(m_protocolView);
            addRelation(relation);
        end;

        if ((line != "1.1")   and
            (line != "2.1.6") and
            (line != "2.2.6") and
            (line != "4.1")   and
            (line != "5.1"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;

        if ((line == "1.2") or
            (line == "3.1") or
            (line == "4.2") or
            (line == "5.2"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.03, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3, 0.03, 1.0);

        elif ((line == "1.3") or
              (line == "3.2") or
              (line == "4.3") or
              (line == "5.3"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.03, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03, -1.0);

            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.2, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.2,   1.0);

        elif ((line == "1.4") or
              (line == "3.3") or
              (line == "4.4") or
              (line == "5.4"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.2, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2, -1.0);

            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.5, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.5, 1.0);

        elif ((line == "1.5") or
              (line == "3.4") or
              (line == "4.5") or
              (line == "5.5"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.5, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5, -1.0);

        elif ((line == "2.1.1"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.005, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif ((line == "2.1.2"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.015, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "2.1.3"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.1, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.1);

        elif ((line == "2.1.4"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.35, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.35);

        elif ((line == "2.2.1"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.01, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif ((line == "2.2.2"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.03, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03);

        elif ((line == "2.2.3"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.2, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2);

        elif ((line == "2.2.4"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.5, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5);

        elif ((line == "2.1.5") or
              (line == "2.2.5"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.75, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.75);
        elif ((line == "2.1.6") or
              (line == "2.2.6"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 1.0);
        end;
    end;

    /**
     * Загрузить данные для нормализации.
     */
    macro load()
        var column;

        loadLine("1", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("2", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("2.1", "2.1.1");
        loadLine("2.1", "2.1.2");
        loadLine("2.1", "2.1.3");
        loadLine("2.1", "2.1.4");
        loadLine("2.1", "2.1.5");
        loadLine("2.1", "2.1.6");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.1",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.1.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.6", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("2.2", "2.2.1");
        loadLine("2.2", "2.2.2");
        loadLine("2.2", "2.2.3");
        loadLine("2.2", "2.2.4");
        loadLine("2.2", "2.2.5");
        loadLine("2.2", "2.2.6");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.2",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.2.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.6", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.4", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("4", "4");
        loadLine("4", "4.1");
        loadLine("4", "4.2");
        loadLine("4", "4.3");
        loadLine("4", "4.4");
        loadLine("4", "4.5");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("4",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("4.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("4.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("4.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("4.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("4.5", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("5", "5");
        loadLine("5", "5.1");
        loadLine("5", "5.2");
        loadLine("5", "5.3");
        loadLine("5", "5.4");
        loadLine("5", "5.5");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("5",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("5.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("5.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("5.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("5.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("5.5", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("6",  "6");
        loadLine("6.1","6.1");
        loadLinesRelation("6", RCB_RS_GREATER_OR_EQUAL, "6.1");

        loadLine("7",  "7");
        loadLine("7.1","7.1");
        loadLinesRelation("7", RCB_RS_GREATER_OR_EQUAL, "7.1");

        loadLine("8",  "8");
        loadLine("8.1","8.1");
        loadLinesRelation("8", RCB_RS_GREATER_OR_EQUAL, "8.1");

        loadLine("9",  "9");
        loadLine("9.1","9.1");
        loadLinesRelation("9", RCB_RS_GREATER_OR_EQUAL, "9.1");

        loadLinesRelation("7", "8", "9", RCB_RS_EQUAL, "1", "2", "4");
    end;
end;

class (TPart2Normalizer3129) TPart2NormalizerMMB_4212(protocolView)
    initTPart2Normalizer3129(protocolView);

    macro load()
        var column;

        loadLine("1", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("2", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("2.1", "2.1.1");
        loadLine("2.1", "2.1.2");
        loadLine("2.1", "2.1.3");
        loadLine("2.1", "2.1.4");
        loadLine("2.1", "2.1.5");
        loadLine("2.1", "2.1.6");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.1",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.1.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.1.6", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("2.2", "2.2.1");
        loadLine("2.2", "2.2.2");
        loadLine("2.2", "2.2.3");
        loadLine("2.2", "2.2.4");
        loadLine("2.2", "2.2.5");
        loadLine("2.2", "2.2.6");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.2",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.2.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2.6", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.4", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("4", "4");
        loadLine("4", "4.1");
        loadLine("4", "4.2");
        loadLine("4", "4.3");
        loadLine("4", "4.4");
        loadLine("4", "4.5");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("4",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("4.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("4.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("4.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("4.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("4.5", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("5", "5");
        loadLine("5", "5.1");
        loadLine("5", "5.2");
        loadLine("5", "5.3");
        loadLine("5", "5.4");
        loadLine("5", "5.5");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("5",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("5.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("5.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("5.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("5.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("5.5", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("6",  "6");
        loadLine("6.1","6.1");
        loadLinesRelation("6", RCB_RS_GREATER_OR_EQUAL, "6.1");

        loadLine("7",  "7");
        loadLine("7.1","7.1");
        loadLinesRelation("7", RCB_RS_GREATER_OR_EQUAL, "7.1");

        loadLine("8",  "8");
        loadLine("8.1","8.1");
        loadLinesRelation("8", RCB_RS_GREATER_OR_EQUAL, "8.1");

        loadLine("9",  "9");
        loadLine("9.1","9.1");
        loadLinesRelation("9", RCB_RS_GREATER_OR_EQUAL, "9.1");

        loadLinesRelation("7", "8", "9", RCB_RS_LESS_OR_EQUAL, "1", "3", "4");

        loadLine("10",  "10");
        loadLine("10.1","10.1");
        loadLinesRelation("10", RCB_RS_GREATER_OR_EQUAL, "10.1");

        loadLinesRelation("5", RCB_RS_GREATER_OR_EQUAL, "10");
    end;
end;

/**
 * Нормализация раздела 3.
 */
class (TNormalizer) TPart3Normalizer2332(protocolView)
    initTNormalizer(protocolView);
    m_attributeValue = m_report.getPart("3");
    m_beginColumn    = 3;
    m_endColumn      = 4;

    private macro conditionLoad(nodeL, condition, nodeR, coefficientR, miscalculation)
        var relation = LinearRelation(condition);

        relation.lhs.plus(nodeL);
        if (coefficientR == null)
             relation.rhs.plus(nodeR);
        else
            relation.rhs.plus(coefficientR, nodeR);
        end;

        if ((miscalculation != null) and  not((nodeR.exact == $0) and (nodeL.exact == $0)))
             relation.rhs.plus(miscalculation);
        end;
        relation.linearRelationExactCheck(m_protocolView);
        this.addRelation(relation.getLinearRelation);
    end;

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        if ((line != "2") and
            (line != "3.1")and
            (line != "1.1.1.1") and
            (line != "1.2.1.1") and
            (line != "1.3.1.1") and
            (line != "1.4.1.1") )
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;

        if ((line == "1.1.1") or
            (line == "1.4.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "1.1.2") or
              (line == "1.4.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif ((line == "1.1.3") or
              (line == "1.4.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.3);

        elif ((line == "1.1.4") or
              (line == "1.4.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2);

        elif ((line == "1.1.5") or
              (line == "1.4.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5);

        elif ((line == "1.2.1") or
              (line == "1.3.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.0075);

        elif ((line == "1.2.2") or
              (line == "1.3.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif ((line == "1.2.3") or
              (line == "1.3.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "1.2.4") or
              (line == "1.3.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.1);

        elif ((line == "1.2.5") or
              (line == "1.3.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.35);

        elif ((line == "1.1.6") or
              (line == "1.2.6") or
              (line == "1.3.6") or
              (line == "1.4.6"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.75);

        elif ((line == "2.1") or
              (line == "3.2"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3, 0.03, 1.0);

        elif ((line == "2.2") or
              (line == "3.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.2,   1.0);

        elif ((line == "2.3") or
              (line == "3.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.5,  1.0);

        elif ((line == "2.4") or
              (line == "3.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5, -1.0);
        end;
    end;

    macro load()
        loadLine("1",   "1");

        loadLine("1.1", "1.1");
        loadLine("1.1", "1.1.1");
        loadLine("1.1", "1.1.2");
        loadLine("1.1", "1.1.3");
        loadLine("1.1", "1.1.4");
        loadLine("1.1", "1.1.5");
        loadLine("1.1", "1.1.6");

        loadLine("1.1.1", "1.1.1.1");

        loadLine("1.2", "1.2");
        loadLine("1.2", "1.2.1");
        loadLine("1.2", "1.2.2");
        loadLine("1.2", "1.2.3");
        loadLine("1.2", "1.2.4");
        loadLine("1.2", "1.2.5");
        loadLine("1.2", "1.2.6");

        loadLine("1.2.1", "1.2.1.1");

        loadLine("1.3", "1.3");
        loadLine("1.3", "1.3.1");
        loadLine("1.3", "1.3.2");
        loadLine("1.3", "1.3.3");
        loadLine("1.3", "1.3.4");
        loadLine("1.3", "1.3.5");
        loadLine("1.3", "1.3.6");

        loadLine("1.3.1", "1.3.1.1");

        loadLine("1.4", "1.4");
        loadLine("1.4", "1.4.1");
        loadLine("1.4", "1.4.2");
        loadLine("1.4", "1.4.3");
        loadLine("1.4", "1.4.4");
        loadLine("1.4", "1.4.5");
        loadLine("1.4", "1.4.6");

        loadLine("1.4.1", "1.4.1.1");

        loadLine("1", "2.1");
        loadLine("1", "2.2");
        loadLine("1", "2.3");
        loadLine("1", "2.4");

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");

        loadLine("4",  "4");
        loadLine("4.1","4.1");

        loadLinesRelation("1", RCB_RS_GREATER_OR_EQUAL, "1.1", "1.2", "1.3", "1.4");
        loadLinesRelation("4", RCB_RS_GREATER_OR_EQUAL, "4.1");
    end;
end;


/**
 * Нормализация раздела 1.
 */
class (TPart1Normalizer2332) TPart1Normalizer2539(protocolView)
    initTPart1Normalizer2332(protocolView);

    macro load()
        load();
        loadLine("2.8", "2.8.1");
    end;
end;

/**
 * Нормализация раздела 1 по 3129-У.
 */
class (TNormalizer_MMB) TPart1Normalizer3129(protocolView)
    initTNormalizer_MMB(protocolView);
    m_part           = "1";
    m_attributeValue = m_report.getPart(m_part);
    m_beginColumn    =  3;
    m_endColumn      = 19;

    /**
     * Загрузить строку значений.
     * @param     parentLine    код родительской строки
     * @param     line          код строки
     */
    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");
        var node5  = addNode(parentLine, line, "5");
        var node6  = addNode(parentLine, line, "6");
        var node7  = addNode(parentLine, line, "7");
        var node8  = addNode(parentLine, line, "8");
        var node9  = addNode(parentLine, line, "9");
        var node10 = addNode(parentLine, line, "10");
        var node11 = addNode(parentLine, line, "11");
        var node12 = addNode(parentLine, line, "12");
        var node13 = addNode(parentLine, line, "13");
        var node14 = addNode(parentLine, line, "14");
        var node15 = addNode(parentLine, line, "15");
        var node16 = addNode(parentLine, line, "16");
        var node17 = addNode(parentLine, line, "17");
        var node18 = addNode(parentLine, line, "18");
        var node19 = addNode(parentLine, line, "19");

        var relation;
        if ((line != "4.1.1.1") and
            (line != "4.1.2.1"))
            relation = ReportLinearRelation(RCB_RS_EQUAL);
            relation.lhs.plus(node4).plus(node5).plus(node6).plus(node7).plus(node8);
            relation.rhs.plus(node3);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 5, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 6, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 7, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 8, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        else
            relation = ReportLinearRelation(RCB_RS_EQUAL);
            relation.lhs.plus(node4).plus(node5).plus(node6).plus(node7);
            relation.rhs.plus(node3);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 5, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 6, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 7, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;
        relation.checkExactValue();
        addRelation(relation);

        var relation2;
        if ((line != "1.1"))
            if ((line != "4.1.1.1") and
                (line != "4.1.2.1"))
                relation2 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                relation2.lhs.plus(node9).plus(node10).plus(node11).plus(node12);
                relation2.rhs.plus(node3);
                m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                               RcbArray().initialize(TAttributeDataForProtocol(line,  9, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol(line, 10, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol(line, 11, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol(line, 12, 1, RCB_RS_PLUS)),
                                                                                               RcbArray().initialize(TAttributeDataForProtocol(line,  3, 1, RCB_RS_PLUS)),
                                                                                               RCB_RS_LESS_OR_EQUAL);
            else
                relation2 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
                relation2.lhs.plus(node9).plus(node10).plus(node11);
                relation2.rhs.plus(node3);
                m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                               RcbArray().initialize(TAttributeDataForProtocol(line,  9, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol(line, 10, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol(line, 11, 1, RCB_RS_PLUS)),
                                                                                               RcbArray().initialize(TAttributeDataForProtocol(line,  3, 1, RCB_RS_PLUS)),
                                                                                               RCB_RS_LESS_OR_EQUAL);
            end;
            relation2.checkExactValue();
            addRelation(relation2);
        end;

        var relation3;
        if ((line != "1.1") and
            (line != "1.8") and
            (line != "2.7") and
            (line != "3.6"))
            relation3 = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
            relation3.lhs.plus(node13);
            relation3.rhs.plus(node14);
            relation3.checkExactValue();
            addRelation(relation3);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 13, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 14, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
        end;

        var relation4;
        if ((line != "1")   and
            (line != "2")   and
            (line != "3")   and
            (line != "4")   and
            (line != "1.1") and
            (line != "1.8") and
            (line != "2.7") and
            (line != "3.6"))
            relation4 = ReportLinearRelation(RCB_RS_EQUAL);
            relation4.lhs.plus(node14);
            relation4.rhs.plus(node15);
            relation4.checkExactValue();
            addRelation(relation4);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 14, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 15, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        var relation5;
        if ((line != "4.1.1.1") and
            (line != "4.1.2.1"))
            relation5 = ReportLinearRelation(RCB_RS_EQUAL);
            relation5.lhs.plus(node15);
            relation5.rhs.plus(node16).plus(node17).plus(node18).plus(node19);
            relation5.checkExactValue();
            addRelation(relation5);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 15, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 16, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 17, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 18, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 19, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        else
            relation5 = ReportLinearRelation(RCB_RS_EQUAL);
            relation5.lhs.plus(node16).plus(node17).plus(node18);
            relation5.rhs.plus(node15);
            relation5.checkExactValue();
            addRelation(relation5);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 16, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 17, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol(line, 18, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 15, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        var relation6 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation6.lhs.plus(node16);
        relation6.rhs.plus(0.2, node5);
        addRelation(relation6);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol(line, 16,   1, RCB_RS_PLUS)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol(line,  5, 0.2, RCB_RS_PLUS)),
                                                                                       RCB_RS_LESS_OR_EQUAL);

        var relation7 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation7.lhs.plus(node17);
        relation7.rhs.plus(0.5, node6);
        addRelation(relation7);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol(line, 17,   1, RCB_RS_PLUS)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol(line,  6, 0.5, RCB_RS_PLUS)),
                                                                                       RCB_RS_LESS_OR_EQUAL);

        var relation8 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation8.lhs.plus(node18);
        relation8.rhs.plus(node7);
        relation8.checkExactValue();
        addRelation(relation8);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol(line, 18, 1, RCB_RS_PLUS)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol(line,  7, 1, RCB_RS_PLUS)),
                                                                                       RCB_RS_LESS_OR_EQUAL);

        var relation9;
        if ((line != "4.1.1.1") and
            (line != "4.1.2.1"))
            relation9 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation9.lhs.plus(node19);
            relation9.rhs.plus(node8);
            relation9.checkExactValue();
            addRelation(relation9);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 19, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line,  8, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
        end;
    end;

    /**
     * Загрузить данные для нормализации.
     */
    macro load()
        var column;

        loadLine("4", "4");

        loadLine("1", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");
        loadLine("1", "1.6");
        loadLine("1", "1.7");
        loadLine("1", "1.8");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.7", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.8", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("2", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");
        loadLine("2", "2.3");
        loadLine("2", "2.4");
        loadLine("2", "2.5");
        loadLine("2", "2.6");
        loadLine("2", "2.7");
        loadLine("2", "2.8");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.7", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.8", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");
        loadLine("3", "3.6");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.6", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("1.7",     "1.7");
        loadLine("1.7.1",   "1.7.1");
        loadLinesRelation("1.7",   RCB_RS_GREATER_OR_EQUAL, "1.7.1");

        loadLine("2.6",     "2.6");
        loadLine("2.6.1",   "2.6.1");
        loadLinesRelation("2.6",   RCB_RS_GREATER_OR_EQUAL, "2.6.1");

        loadLine("2.8",     "2.8");
        loadLine("2.8.1",   "2.8.1");
        loadLinesRelation("2.8",   RCB_RS_GREATER_OR_EQUAL, "2.8.1");

        loadLine("3.5",     "3.5");
        loadLine("3.5.1",   "3.5.1");
        loadLinesRelation("3.5",   RCB_RS_GREATER_OR_EQUAL, "3.5.1");

        loadLine("4.1",     "4.1");
        loadLine("4.1.1",   "4.1.1");
        loadLine("4.1.1.1", "4.1.1.1");
        loadLine("4.1.2",   "4.1.2");
        loadLine("4.1.2.1", "4.1.2.1");
        loadLine("4.1.3",   "4.1.3");
        loadLine("4.1.3.1", "4.1.3.1");

        loadLinesRelation("4",     RCB_RS_GREATER_OR_EQUAL, "4.1");
        loadLinesRelation("4.1",   RCB_RS_GREATER_OR_EQUAL, "4.1.1", "4.1.2", "4.1.3");
        loadLinesRelation("4.1.1", RCB_RS_GREATER_OR_EQUAL, "4.1.1.1");
        loadLinesRelation("4.1.2", RCB_RS_GREATER_OR_EQUAL, "4.1.2.1");
        loadLinesRelation("4.1.3", RCB_RS_GREATER_OR_EQUAL, "4.1.3.1");
    end;
end;

class (TPart1Normalizer3129) TPart1NormalizerMMB_4212(protocolView)
    initTPart1Normalizer3129(protocolView);

    macro load()
        var column;

        loadLine("4", "4");

        loadLine("1", "1");
        loadLine("1", "1.1");
        loadLine("1", "1.2");
        loadLine("1", "1.3");
        loadLine("1", "1.4");
        loadLine("1", "1.5");
        loadLine("1", "1.6");
        loadLine("1", "1.7");
        loadLine("1", "1.8");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.7", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.8", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("2", "2");
        loadLine("2", "2.1");
        loadLine("2", "2.2");
        loadLine("2", "2.3");
        loadLine("2", "2.4");
        loadLine("2", "2.5");
        loadLine("2", "2.6");
        loadLine("2", "2.7");
        loadLine("2", "2.8");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.7", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("2.8", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");
        loadLine("3", "3.6");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.6", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("1.7",     "1.7");
        loadLine("1.7.1",   "1.7.1");
        loadLinesRelation("1.7",   RCB_RS_GREATER_OR_EQUAL, "1.7.1");

        loadLine("2.6",     "2.6");
        loadLine("2.6.1",   "2.6.1");
        loadLinesRelation("2.6",   RCB_RS_GREATER_OR_EQUAL, "2.6.1");

        loadLine("2.8",     "2.8");
        loadLine("2.8.1",   "2.8.1");
        loadLinesRelation("2.8",   RCB_RS_GREATER_OR_EQUAL, "2.8.1");

        loadLine("3.5",     "3.5");
        loadLine("3.5.1",   "3.5.1");
        loadLinesRelation("3.5",   RCB_RS_GREATER_OR_EQUAL, "3.5.1");

        loadLine("4.1",     "4.1");
        loadLine("4.1.1",   "4.1.1");
        loadLine("4.1.1.1", "4.1.1.1");
        loadLine("4.1.2",   "4.1.2");
        loadLine("4.1.2.1", "4.1.2.1");
        loadLine("4.1.3",   "4.1.3");
        loadLine("4.1.3.1", "4.1.3.1");

        loadLinesRelation("4",     RCB_RS_GREATER_OR_EQUAL, "4.1");
        loadLinesRelation("4.1",   RCB_RS_GREATER_OR_EQUAL, "4.1.1", "4.1.2", "4.1.3");
        loadLinesRelation("4.1.1", RCB_RS_GREATER_OR_EQUAL, "4.1.1.1");
        loadLinesRelation("4.1.2", RCB_RS_GREATER_OR_EQUAL, "4.1.2.1");
        loadLinesRelation("4.1.3", RCB_RS_GREATER_OR_EQUAL, "4.1.3.1");

        loadLine("4.2",     "4.2");
        loadLine("4.2.1",   "4.2.1");
        loadLine("4.2.2",   "4.2.2");
        loadLinesRelation("4.2",   RCB_RS_GREATER_OR_EQUAL, "4.2.1");
        loadLinesRelation("4.2.1", RCB_RS_GREATER_OR_EQUAL, "4.2.2");
    end;
end;

/**
 * Нормализация раздела 3.
 */
class (TPart3Normalizer2332) TPart3Normalizer2539(protocolView)
    initTPart3Normalizer2332(protocolView);

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        if ((line != "2") and
            (line != "3.1")and
            (line != "1.1.1.1") and
            (line != "1.2.1.1") and
            (line != "1.3.1.1") and
            (line != "1.4.1.1") )
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;

        if ((line == "1.1.1") or
            (line == "1.4.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "1.1.2") or
              (line == "1.4.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif ((line == "1.1.3") or
              (line == "1.4.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.3);

        elif ((line == "1.1.4") or
              (line == "1.4.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2);

        elif ((line == "1.1.5") or
              (line == "1.4.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5);

        elif ((line == "1.2.7.1") or
              (line == "1.3.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.0075);

        elif ((line == "1.2.7.2") or
              (line == "1.3.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif ((line == "1.2.7.3") or
              (line == "1.3.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "1.2.7.4") or
              (line == "1.3.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.1);

        elif ((line == "1.2.7.5") or
              (line == "1.3.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.35);

        elif ((line == "1.1.6") or
              (line == "1.2.6") or
              (line == "1.2.7.6") or
              (line == "1.3.6") or
              (line == "1.4.6"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.75);

        elif ((line == "2.1") or
              (line == "3.2"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3, 0.03, 1.0);

        elif ((line == "2.2") or
              (line == "3.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.2,   1.0);

        elif ((line == "2.3") or
              (line == "3.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.5,  1.0);

        elif ((line == "2.4") or
              (line == "3.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5, -1.0);
        end;
    end;

    private macro loadLines(parentLine1, line1, condition, parentLine2, line2, coefficientR)

        var relation = LinearRelation(condition);

        var line1Node3  = addNode(parentLine1, line1, "3");
        var line1Node4  = addNode(parentLine1, line1, "4");

        var line2Node3  = addNode(parentLine2, line2, "3");
        var line2Node4  = addNode(parentLine2, line2, "4");

        coefficientR = NVL(coefficientR, 1);

           relation.lhs.plus(line1Node3).plus(-1.0, line2Node3);
           relation.rhs.plus(coefficientR, line1Node4).plus(-1.0 * coefficientR, line2Node4);
        relation.linearRelationExactCheck(m_protocolView);
        this.addRelation(relation.getLinearRelation);
    end;

    macro load()

        loadLine("1",   "1");

        loadLine("1.1", "1.1");
        loadLine("1.1", "1.1.1");
        loadLine("1.1", "1.1.2");
        loadLine("1.1", "1.1.3");
        loadLine("1.1", "1.1.4");
        loadLine("1.1", "1.1.5");
        loadLine("1.1", "1.1.6");

        loadLine("1.1.1", "1.1.1.1");

        loadLine("1.2", "1.2");
        loadLine("1.2", "1.2.1");
        loadLine("1.2", "1.2.2");
        loadLine("1.2", "1.2.3");
        loadLine("1.2", "1.2.4");
        loadLine("1.2", "1.2.5");
        loadLine("1.2", "1.2.6");
        loadLine("1.2", "1.2.7");

        loadLine("1.2.1", "1.2.1.1");

        loadLine("1.2.7", "1.2.7.1");
        loadLine("1.2.7", "1.2.7.2");
        loadLine("1.2.7", "1.2.7.3");
        loadLine("1.2.7", "1.2.7.4");
        loadLine("1.2.7", "1.2.7.5");
        loadLine("1.2.7", "1.2.7.6");

        loadLine("1.3", "1.3");
        loadLine("1.3", "1.3.1");
        loadLine("1.3", "1.3.2");
        loadLine("1.3", "1.3.3");
        loadLine("1.3", "1.3.4");
        loadLine("1.3", "1.3.5");
        loadLine("1.3", "1.3.6");

        loadLine("1.3.1", "1.3.1.1");

        loadLine("1.4", "1.4");
        loadLine("1.4", "1.4.1");
        loadLine("1.4", "1.4.2");
        loadLine("1.4", "1.4.3");
        loadLine("1.4", "1.4.4");
        loadLine("1.4", "1.4.5");
        loadLine("1.4", "1.4.6");

        loadLine("1.4.1", "1.4.1.1");

        loadLine("1", "2.1");
        loadLine("1", "2.2");
        loadLine("1", "2.3");
        loadLine("1", "2.4");

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");

        loadLine("4",  "4");
        loadLine("4.1","4.1");

        loadLinesRelation("1", RCB_RS_GREATER_OR_EQUAL, "1.1", "1.2", "1.3", "1.4");
        loadLinesRelation("4", RCB_RS_GREATER_OR_EQUAL, "4.1");

        loadLines("1.2", "1.2.1", RCB_RS_GREATER_OR_EQUAL, "1.2.7", "1.2.7.1", 0.015);
        loadLines("1.2", "1.2.2", RCB_RS_GREATER_OR_EQUAL, "1.2.7", "1.2.7.2", 0.01);
        loadLines("1.2", "1.2.3", RCB_RS_GREATER_OR_EQUAL, "1.2.7", "1.2.7.3", 0.03);
        loadLines("1.2", "1.2.4", RCB_RS_GREATER_OR_EQUAL, "1.2.7", "1.2.7.4", 0.20);
        loadLines("1.2", "1.2.5", RCB_RS_GREATER_OR_EQUAL, "1.2.7", "1.2.7.5", 0.50);
    end;
end;

/**
 * Нормализация раздела 3 по 2926-У.
 */
class (TPart3Normalizer2539) TPart3Normalizer2926(protocolView)
    initTPart3Normalizer2539(protocolView);

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        if ((line != "2") and
            (line != "3.1")and
            (line != "1.1.1.1") and
            (line != "1.2.1.1") and
            (line != "1.3.1.1") and
            (line != "1.4.1.1") )
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;

        if ((line == "1.1.1") or
            (line == "1.4.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "1.1.2") or
              (line == "1.4.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif ((line == "1.1.3") or
              (line == "1.4.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.3);

        elif ((line == "1.1.4") or
              (line == "1.4.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2);

        elif ((line == "1.1.5") or
              (line == "1.4.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5);

        elif ((line == "1.1.6") or
              (line == "1.2.6") or
              (line == "1.3.6") or
              (line == "1.4.6"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.75);

        elif ((line == "1.1.7") or
              (line == "1.2.7") or
              (line == "1.3.7") or
              (line == "1.4.7"))
            conditionLoad(node4, RCB_RS_EQUAL, node3, 0.1);

        elif (line == "1.3.1")
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.0075);

        elif (line == "1.3.2")
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif (line == "1.3.3")
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif (line == "1.3.4")
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.1);

        elif (line == "1.3.5")
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.35);

        elif ((line == "2.1") or
              (line == "3.2"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3, 0.03, 1.0);

        elif ((line == "2.2") or
              (line == "3.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.2,   1.0);

        elif ((line == "2.3") or
              (line == "3.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.5,  1.0);

        elif ((line == "2.4") or
              (line == "3.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5, -1.0);
        end;
    end;

    macro load()
        loadLine("1",   "1");

        loadLine("1.1", "1.1");
        loadLine("1.1", "1.1.1");
        loadLine("1.1", "1.1.2");
        loadLine("1.1", "1.1.3");
        loadLine("1.1", "1.1.4");
        loadLine("1.1", "1.1.5");
        loadLine("1.1", "1.1.6");
        loadLine("1.1", "1.1.7");

        loadLine("1.1.1", "1.1.1.1");

        loadLine("1.2", "1.2");
        loadLine("1.2", "1.2.1");
        loadLine("1.2", "1.2.2");
        loadLine("1.2", "1.2.3");
        loadLine("1.2", "1.2.4");
        loadLine("1.2", "1.2.5");
        loadLine("1.2", "1.2.6");
        loadLine("1.2", "1.2.7");

        loadLine("1.3", "1.3");
        loadLine("1.3", "1.3.1");
        loadLine("1.3", "1.3.2");
        loadLine("1.3", "1.3.3");
        loadLine("1.3", "1.3.4");
        loadLine("1.3", "1.3.5");
        loadLine("1.3", "1.3.6");
        loadLine("1.3", "1.3.7");

        loadLine("1.3.1", "1.3.1.1");

        loadLine("1.4", "1.4");
        loadLine("1.4", "1.4.1");
        loadLine("1.4", "1.4.2");
        loadLine("1.4", "1.4.3");
        loadLine("1.4", "1.4.4");
        loadLine("1.4", "1.4.5");
        loadLine("1.4", "1.4.6");
        loadLine("1.4", "1.4.7");

        loadLine("1.4.1", "1.4.1.1");

        loadLine("1", "2.1");
        loadLine("1", "2.2");
        loadLine("1", "2.3");
        loadLine("1", "2.4");

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");

        loadLine("4",  "4");
        loadLine("4.1","4.1");

        loadLinesRelation("1", RCB_RS_GREATER_OR_EQUAL, "1.1", "1.2", "1.3", "1.4");
        loadLinesRelation("4", RCB_RS_GREATER_OR_EQUAL, "4.1");
    end;
end;

/**
 * Нормализация раздела 3 по 3006-У.
 */
class (TPart3Normalizer2926) TPart3Normalizer3006(protocolView)
    initTPart3Normalizer2926(protocolView);

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        if ((line != "1.1.7") and
            (line != "1.2.7") and
            (line != "1.3.7") and
            (line != "1.4.7"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;

        if ((line == "1.1.1") or
            (line == "1.4.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "1.1.2") or
              (line == "1.4.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif ((line == "1.1.3") or
              (line == "1.4.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.3);

        elif ((line == "1.1.4") or
              (line == "1.4.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2);

        elif ((line == "1.1.5") or
              (line == "1.4.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5);

        elif ((line == "1.1.6") or
              (line == "1.2.6") or
              (line == "1.3.6") or
              (line == "1.4.6"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.75);

        elif ((line == "1.1.7") or
              (line == "1.2.7") or
              (line == "1.3.7") or
              (line == "1.4.7"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 1.0);

        elif ((line == "1.2.1") or
              (line == "1.3.1"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.0075);

        elif ((line == "1.2.2") or
              (line == "1.3.2"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif ((line == "1.2.3") or
              (line == "1.3.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "1.2.4") or
              (line == "1.3.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.1);

        elif ((line == "1.2.5") or
              (line == "1.3.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.35);

        elif ((line == "2.1") or
              (line == "3.2"))
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3, 0.03, 1.0);

        elif ((line == "2.2") or
              (line == "3.3"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.2,   1.0);

        elif ((line == "2.3") or
              (line == "3.4"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2, -1.0);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.5,  1.0);

        elif ((line == "2.4") or
              (line == "3.5"))
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5, -1.0);
        end;
    end;

    macro load()
        loadLine("1",   "1");

        loadLine("1.1", "1.1");
        loadLine("1.1", "1.1.1");
        loadLine("1.1", "1.1.2");
        loadLine("1.1", "1.1.3");
        loadLine("1.1", "1.1.4");
        loadLine("1.1", "1.1.5");
        loadLine("1.1", "1.1.6");
        loadLine("1.1", "1.1.7");

        loadLine("1.1.1", "1.1.1.1");

        loadLine("1.2", "1.2");
        loadLine("1.2", "1.2.1");
        loadLine("1.2", "1.2.2");
        loadLine("1.2", "1.2.3");
        loadLine("1.2", "1.2.4");
        loadLine("1.2", "1.2.5");
        loadLine("1.2", "1.2.6");
        loadLine("1.2", "1.2.7");

        loadLine("1.3", "1.3");
        loadLine("1.3", "1.3.1");
        loadLine("1.3", "1.3.2");
        loadLine("1.3", "1.3.3");
        loadLine("1.3", "1.3.4");
        loadLine("1.3", "1.3.5");
        loadLine("1.3", "1.3.6");
        loadLine("1.3", "1.3.7");

        loadLine("1.3.1", "1.3.1.1");

        loadLine("1.4", "1.4");
        loadLine("1.4", "1.4.1");
        loadLine("1.4", "1.4.2");
        loadLine("1.4", "1.4.3");
        loadLine("1.4", "1.4.4");
        loadLine("1.4", "1.4.5");
        loadLine("1.4", "1.4.6");
        loadLine("1.4", "1.4.7");

        loadLine("1.4.1", "1.4.1.1");

        loadLine("1", "2.1");
        loadLine("1", "2.2");
        loadLine("1", "2.3");
        loadLine("1", "2.4");

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");

        loadLine("4",  "4");
        loadLine("4.1","4.1");

        loadLinesRelation("1", RCB_RS_GREATER_OR_EQUAL, "1.1", "1.2", "1.3", "1.4");
        loadLinesRelation("1.2", RCB_RS_GREATER_OR_EQUAL, "1.2.7");
        loadLinesRelation("4", RCB_RS_GREATER_OR_EQUAL, "4.1");
    end;
end;

/**
 * Нормализация раздела 3 по 3129-У.
 */
class (TPart3Normalizer3006) TPart3Normalizer3129(protocolView)
    initTPart3Normalizer3006(protocolView);

    /**
     * Загрузить данные для нормализации.
     */
    macro load()
        load();

        loadLine("5",  "5");
        loadLine("5.1","5.1");
        loadLinesRelation("5", RCB_RS_GREATER_OR_EQUAL, "5.1");

        loadLine("6",  "6");
        loadLine("6.1","6.1");
        loadLinesRelation("6", RCB_RS_GREATER_OR_EQUAL, "6.1");
    end;
end;

/**
 * Нормализация раздела 3 по 3468-У.
 */
class (TNormalizer_MMB) TPart3Normalizer3468(protocolView)
    initTNormalizer_MMB(protocolView);

    m_report         = objectFactoryInstance.createReport();
    m_part           = "3";
    m_attributeValue = m_report.getPart(m_part);
    m_beginColumn    = 3;
    m_endColumn      = 4;

    private macro conditionLoad(nodeL, condition, nodeR, coefficientR, miscalculation)
        var relation = ReportLinearRelation(condition);

        relation.lhs.plus(nodeL);
        if (coefficientR == null)
            relation.rhs.plus(nodeR);
        else
            relation.rhs.plus(coefficientR, nodeR);
        end;

        if ((miscalculation != null) and  not((nodeR.exact == $0) and (nodeL.exact == $0)))
             relation.rhs.plus(miscalculation);
        end;
        relation.checkExactValue(m_protocolView);
        addRelation(relation);
    end;

    private macro loadLine(parentLine, line)
        var node3 = addNode(parentLine, line, "3");
        var node4 = addNode(parentLine, line, "4");

        if ((line != "1.1.7") and
            (line != "1.2.7") and
            (line != "1.3.8") and
            (line != "1.4.7") and
            (line != "1.4.8") and
            (line != "1.5.7") and
            (line != "1.6.7"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3);
        end;

        if ((line == "1.1.1") or
            (line == "1.6.1"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1,     RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.015, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "1.1.2") or
              (line == "1.6.2"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.01, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif ((line == "1.1.3") or
              (line == "1.6.3"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.03, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03);

        elif ((line == "1.1.4") or
              (line == "1.6.4"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.2, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2);

        elif ((line == "1.1.5") or
              (line == "1.6.5"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.5, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5);

        elif ((line == "1.1.6") or
              (line == "1.2.6") or
              (line == "1.4.6") or
              (line == "1.5.6") or
              (line == "1.6.6"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.75, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.75);

        elif ((line == "1.1.7") or
              (line == "1.2.7") or
              (line == "1.3.8") or
              (line == "1.4.7") or
              (line == "1.4.8") or
              (line == "1.5.7") or
              (line == "1.6.7"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 1.0);

        elif ((line == "1.2.1") or
              (line == "1.5.1"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.0075, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.0075);

        elif (line == "1.2.2")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.0035, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.0035);

        elif (line == "1.5.2")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.005, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif ((line == "1.2.3") or
              (line == "1.5.3"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.015, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.015);

        elif ((line == "1.2.4") or
              (line == "1.5.4"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.1, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.1);

        elif ((line == "1.2.5") or
              (line == "1.5.5"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.35, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.35);

        elif (line == "1.3.1")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.006, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.006);

        elif (line == "1.3.2")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.002, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.002);

        elif (line == "1.3.3")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.01, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif (line == "1.3.4")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.07, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.07);

        elif (line == "1.3.5")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.20, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.20);

        elif (line == "1.3.6")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.60, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.60);

        elif (line == "1.3.7")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.80, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.80);

        elif (line == "1.4.1")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.01, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.01);

        elif (line == "1.4.2")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.005, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.005);

        elif (line == "1.4.3")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.02, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.02);

        elif (line == "1.4.4")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.15, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.15);

        elif (line == "1.4.5")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.45, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.45);

        elif ((line == "2.1") or
              (line == "5.2"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.03, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL, node3, 0.03, 1.0);

        elif ((line == "2.2") or
              (line == "5.3"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.03, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.03, -1.0);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.2, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.2,   1.0);

        elif ((line == "2.3") or
              (line == "5.4"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.2, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.2, -1.0);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.5, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            conditionLoad(node4, RCB_RS_LESS_OR_EQUAL,    node3, 0.5,  1.0);

        elif ((line == "2.4") or
              (line == "2.5") or
              (line == "5.5"))
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.5, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER_OR_EQUAL);
            conditionLoad(node4, RCB_RS_GREATER_OR_EQUAL, node3, 0.5, -1.0);
        end;
    end;

    /**
     * Загрузить данные для нормализации.
     */
    macro load()
        var column;

        loadLine("1",   "1");

        loadLine("1.1", "1.1");
        loadLine("1.1", "1.1.1");
        loadLine("1.1", "1.1.2");
        loadLine("1.1", "1.1.3");
        loadLine("1.1", "1.1.4");
        loadLine("1.1", "1.1.5");
        loadLine("1.1", "1.1.6");
        loadLine("1.1", "1.1.7");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.1",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.1.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.1.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.1.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.1.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.1.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.1.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.1.7", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("1.1.1", "1.1.1.1");

        loadLine("1.2", "1.2");
        loadLine("1.2", "1.2.1");
        loadLine("1.2", "1.2.2");
        loadLine("1.2", "1.2.3");
        loadLine("1.2", "1.2.4");
        loadLine("1.2", "1.2.5");
        loadLine("1.2", "1.2.6");
        loadLine("1.2", "1.2.7");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.2",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.2.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.2.7", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("1.2.1", "1.2.1.1");

        loadLine("1.3", "1.3");
        loadLine("1.3", "1.3.1");
        loadLine("1.3", "1.3.2");
        loadLine("1.3", "1.3.3");
        loadLine("1.3", "1.3.4");
        loadLine("1.3", "1.3.5");
        loadLine("1.3", "1.3.6");
        loadLine("1.3", "1.3.7");
        loadLine("1.3", "1.3.8");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.3",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.3.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3.7", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.3.8", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("1.3.1", "1.3.1.1");

        loadLine("1.4", "1.4");
        loadLine("1.4", "1.4.1");
        loadLine("1.4", "1.4.2");
        loadLine("1.4", "1.4.3");
        loadLine("1.4", "1.4.4");
        loadLine("1.4", "1.4.5");
        loadLine("1.4", "1.4.6");
        loadLine("1.4", "1.4.7");
        loadLine("1.4", "1.4.8");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.4",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.4.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4.7", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.4.8", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("1.4.1", "1.4.1.1");

        loadLine("1.5", "1.5");
        loadLine("1.5", "1.5.1");
        loadLine("1.5", "1.5.2");
        loadLine("1.5", "1.5.3");
        loadLine("1.5", "1.5.4");
        loadLine("1.5", "1.5.5");
        loadLine("1.5", "1.5.6");
        loadLine("1.5", "1.5.7");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.5",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.5.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.5.7", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("1.5.1", "1.5.1.1");

        loadLine("1.6", "1.6");
        loadLine("1.6", "1.6.1");
        loadLine("1.6", "1.6.2");
        loadLine("1.6", "1.6.3");
        loadLine("1.6", "1.6.4");
        loadLine("1.6", "1.6.5");
        loadLine("1.6", "1.6.6");
        loadLine("1.6", "1.6.7");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.6",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("1.6.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.6.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.6.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.6.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.6.5", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.6.6", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("1.6.7", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("1.6.1", "1.6.1.1");

        loadLine("1", "2.1");
        loadLine("1", "2.2");
        loadLine("1", "2.3");
        loadLine("1", "2.4");
        loadLine("1", "2.5");
        for (column, m_beginColumn, m_endColumn)
            if  (column != "4")
                m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                               RcbArray().initialize(TAttributeDataForProtocol("2.1", column, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol("2.2", column, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol("2.3", column, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol("2.4", column, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol("2.5", column, 1, RCB_RS_PLUS)),
                                                                                               RcbArray().initialize(TAttributeDataForProtocol("1",   column, 1, RCB_RS_PLUS)),
                                                                                               RCB_RS_EQUAL);
            else
                m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                               RcbArray().initialize(TAttributeDataForProtocol("2.2", column, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol("2.3", column, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol("2.4", column, 1, RCB_RS_PLUS),
                                                                                                                     TAttributeDataForProtocol("2.5", column, 1, RCB_RS_PLUS)),
                                                                                               RcbArray().initialize(TAttributeDataForProtocol("1",   column, 1, RCB_RS_PLUS)),
                                                                                               RCB_RS_EQUAL);
            end;
        end;

        loadLine("3", "3");
        loadLine("3", "3.1");
        loadLine("3", "3.2");
        loadLine("3", "3.3");
        loadLine("3", "3.4");
        loadLine("3", "3.5");
        for (column, m_beginColumn, m_endColumn)
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3",   column, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3.1", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.2", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.3", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.4", column, 1, RCB_RS_PLUS),
                                                                                                                 TAttributeDataForProtocol("3.5", column, 1, RCB_RS_PLUS)),
                                                                                           RCB_RS_EQUAL);
        end;

        loadLine("4",  "4");
        loadLine("4.1","4.1");

        loadLinesRelation("1", RCB_RS_GREATER_OR_EQUAL, "1.1", "1.2", "1.3", "1.4", "1.5", "1.6");
        loadLinesRelation("4", RCB_RS_GREATER_OR_EQUAL, "4.1");

        loadLine("5",  "5");
        loadLine("5.1","5.1");
        loadLinesRelation("5", RCB_RS_GREATER, "5.1");

        loadLine("6",  "6");
        loadLine("6.1","6.1");
        loadLinesRelation("6", RCB_RS_GREATER, "6.1");

        loadLinesRelation("5", "6", RCB_RS_LESS, "1");
    end;
end;

/**
 * Нормализация раздела Справочно.
 */
class (TPart4Normalizer) TPart4Normalizer2539(protocolView)
    initTPart4Normalizer(protocolView);

    macro load()
        load();

        loadLine("1.2", "1.2.1");
        loadLine("2.2", "2.2.1");
    end;
end;

/**
 * Нормализация раздела 4 по 2835-У
 */
class (TNormalizer) TPart4Normalizer2835(protocolView)
    initTNormalizer(protocolView);
    m_attributeValue = m_report.getPart("4");

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        var relation;
        if (line == "1")
            relation = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation.lhs.plus(0.1, node3);
            relation.rhs.plus(node4);
            relation.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation.getLinearRelation);
        end;

        var relation2;
        if (line == "2")
            relation2 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation2.lhs.plus(0.2, node3);
            relation2.rhs.plus(node4);
            relation2.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation2.getLinearRelation);
        end;

        var relation3;
        if (line == "3")
            relation3 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation3.lhs.plus(0.35, node3);
            relation3.rhs.plus(node4);
            relation3.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation3.getLinearRelation);
        end;

        var relation4;
        if (line == "4")
            relation4 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation4.lhs.plus(0.5, node3);
            relation4.rhs.plus(node4);
            relation4.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation4.getLinearRelation);
        end;

        var relation5;
        if (line == "5")
            relation5 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation5.lhs.plus(0.75, node3);
            relation5.rhs.plus(node4);
            relation5.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation5.getLinearRelation);
        end;

    end;

    macro load()
        var i = 0;
        var j = 1;
        if (rcbApplication().currentReport.context.period.endDate >= Date(01, 02, 2013))
            i = 1;
        end;
        if (rcbApplication().currentReport.context.period.endDate >= Date(01, 02, 2014))
            i = 2;
        end;
        if (rcbApplication().currentReport.context.period.endDate >= Date(01, 02, 2015))
            i = 3;
        end;
        if (rcbApplication().currentReport.context.period.endDate >= Date(01, 02, 2016))
            i = 4;
        end;

        var attributes = m_report.getPart(4).getAttributes();
        while (j < attributes.size)
            if (i < 1)
                attributes[j].setValue(0.0, "3", BOCb);
                attributes[j].setValue(0.0, "4", BOCb);
            end;
            i = i - 1;
            j = j + 1;
        end;
        var test1 = m_attributeValue;
        m_report.getPart(4).getValue().summarizeDependentValues(RCB_SU_EXACT);

        loadLine("1", "1");
        loadLine("2", "2");
        loadLine("3", "3");
        loadLine("4", "4");
        loadLine("5", "5");
    end;
end;

/**
 * Нормализация раздела 4 по 2926-У
 */
class (TPart4Normalizer2835) TPart4Normalizer2926(protocolView)
    initTPart4Normalizer2835(protocolView);

    CONST RCB_RS_GREATER = 2;

    private macro loadLine(parentLine, line)
        var node3  = addNode(parentLine, line, "3");
        var node4  = addNode(parentLine, line, "4");

        var relation;
        if (line == "1")
            relation = LinearRelation(RCB_RS_GREATER);
            relation.lhs.plus(0.1, node3);
            relation.rhs.plus(node4);
            relation.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation.getLinearRelation);
        end;

        var relation2;
        if (line == "2")
            relation2 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation2.lhs.plus(0.1, node3);
            relation2.rhs.plus(node4);
            relation2.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation2.getLinearRelation);
        end;

        var relation3;
        if (line == "3")
            relation3 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation3.lhs.plus(0.2, node3);
            relation3.rhs.plus(node4);
            relation3.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation3.getLinearRelation);
        end;

        var relation4;
        if (line == "4")
            relation4 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation4.lhs.plus(0.35, node3);
            relation4.rhs.plus(node4);
            relation4.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation4.getLinearRelation);
        end;

        var relation5;
        if (line == "5")
            relation5 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation5.lhs.plus(0.5, node3);
            relation5.rhs.plus(node4);
            relation5.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation5.getLinearRelation);
        end;

        var relation6;
        if (line == "6")
            relation6 = LinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation6.lhs.plus(0.75, node3);
            relation6.rhs.plus(node4);
            relation6.linearRelationExactCheck(m_protocolView);
            this.addRelation(relation6.getLinearRelation);
        end;
    end;

    macro load()
        var attributes = m_report.getPart(4).getAttributes();

        var valueString7Column3 = attributes[6].getExactValue("3", BOCb);
        var valueString7Column4 = attributes[6].getExactValue("4", BOCb);

        //исключаем строки 1,2,3,7
        if (rcbApplication().currentReport.context.period.endDate < Date(01, 02, 2013))

            attributes[0].setValue(0.0, "3", BOCb);
            attributes[0].setValue(0.0, "4", BOCb);

            attributes[1].setValue(0.0, "3", BOCb);
            attributes[1].setValue(0.0, "4", BOCb);

            attributes[2].setValue(0.0, "3", BOCb);
            attributes[2].setValue(0.0, "4", BOCb);

            valueString7Column3 = 0;
            valueString7Column4 = 0;

            println("Строка 1 графа 3: 0.0");
            println("Строка 1 графа 4: 0.0");
            println("Строка 2 графа 3: 0.0");
            println("Строка 2 графа 4: 0.0");
            println("Строка 3 графа 3: 0.0");
            println("Строка 3 графа 4: 0.0");
        end;

        //исключаем строку 4
        if (rcbApplication().currentReport.context.period.endDate < Date(01, 02, 2014))

            if ((valueString7Column3 != 0) and (valueString7Column4 != 0))
                valueString7Column3 = valueString7Column3 - attributes[3].getExactValue("3", BOCb);
                valueString7Column4 = valueString7Column4 - attributes[3].getExactValue("4", BOCb);
            end;

            attributes[3].setValue(0.0, "3", BOCb);
            attributes[3].setValue(0.0, "4", BOCb);

            println("Строка 4 графа 3: 0.0");
            println("Строка 4 графа 4: 0.0");
        end;

        //исключаем строку 5
        if (rcbApplication().currentReport.context.period.endDate < Date(01, 02, 2015))
            if ((valueString7Column3 != 0) and (valueString7Column4 != 0))
                valueString7Column3 = valueString7Column3 - attributes[4].getExactValue("3", BOCb);
                valueString7Column4 = valueString7Column4 - attributes[4].getExactValue("4", BOCb);
            end;

            attributes[4].setValue(0.0, "3", BOCb);
            attributes[4].setValue(0.0, "4", BOCb);
            println("Строка 5 графа 3: 0.0");
            println("Строка 5 графа 4: 0.0");
        end;

        //исключаем строку 6
        if (rcbApplication().currentReport.context.period.endDate < Date(01, 02, 2016))
            if ((valueString7Column3 != 0) and (valueString7Column4 != 0))
                valueString7Column3 = valueString7Column3 - attributes[5].getExactValue("3", BOCb);
                valueString7Column4 = valueString7Column4 - attributes[5].getExactValue("4", BOCb);
            end;

            attributes[5].setValue(0.0, "3", BOCb);
            attributes[5].setValue(0.0, "4", BOCb);
            println("Строка 6 графа 3: 0.0");
            println("Строка 6 графа 4: 0.0");
        end;

        if ((attributes[6].getexactvalue("3", bocb) != valuestring7column3) or
            (attributes[6].getexactvalue("4", bocb) != valuestring7column4))

            println("Строка 7 графа 3: ", valueString7Column3);
            println("Строка 7 графа 4: ", valueString7Column4);

            attributes[6].setValue(valueString7Column3, "3", BOCb);
            attributes[6].setValue(valueString7Column4, "4", BOCb);
        end;

        m_report.getPart(4).getValue().summarizeDependentValues(RCB_SU_EXACT);

        if ((attributes[0].getExactValue("3", BOCb) != 0) AND
            (attributes[0].getExactValue("4", BOCb) != 0))

            loadLine("1", "1");
        end;

        loadLine("2", "2");
        loadLine("3", "3");
        loadLine("4", "4");
        loadLine("5", "5");
        loadLine("6", "6");
        loadLine("7", "7");

        m_beginColumn      = 4;
        m_endColumn        = 4;
        loadLinesRelation("7",RCB_RS_LESS_OR_EQUAL,"3","4","5","6");
    end;
end;

/**
 * Нормализация раздела 4 по 3006-У
 */
class (TNormalizer_MMB) TPart4Normalizer3006(protocolView)
    initTNormalizer_MMB(protocolView);

    CONST RCB_RS_GREATER = 2;

    m_part           = "4";
    m_attributeValue = m_report.getPart(m_part);

    private macro loadLine(parentLine, line)
        private macro conditionLoad(nodeL, condition, nodeR, coefficientR, miscalculation)
            var relation = ReportLinearRelation(condition);

            relation.lhs.plus(nodeL);

            if (coefficientR == null)
                relation.rhs.plus(nodeR);
            else
                relation.rhs.plus(coefficientR, nodeR);
            end;

            if ((miscalculation != null) and  not((nodeR.exact == $0) and (nodeL.exact == $0)))
                relation.rhs.plus(miscalculation);
            end;

            relation.checkExactValue();
            addRelation(relation);
        end;

        var node3 = addNode(parentLine, line, "3");
        var node4 = addNode(parentLine, line, "4");

        var relation1;
        if (line == "1")
            if (node3.exact == $0.0)
                relation1 = ReportLinearRelation(RCB_RS_EQUAL);
                relation1.lhs.plus(node4);
                relation1.rhs.plus(0.0);
                relation1.checkExactValue();
                //m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part, m_lSideData, m_rSideData, RCB_RS_GREATER_OR_EQUAL);
                addRelation(relation1);
            end;
            if (node3.exact > $0.0)
                relation1 = ReportLinearRelation(RCB_RS_GREATER);
                relation1.lhs.plus(node4);
                relation1.rhs.plus(0.0);
                relation1.checkExactValue();
                //m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part, m_lSideData, m_rSideData, RCB_RS_GREATER_OR_EQUAL);
                addRelation(relation1);
            end;
        end;

        var relation2;
        if (line == "2")
            relation2 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation2.lhs.plus(0.1, node3);
            relation2.rhs.plus(node4);
            relation2.checkExactValue();
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.1, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            addRelation(relation2);
        end;

        var relation3;
        if (line == "3")
            relation3 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation3.lhs.plus(0.2, node3);
            relation3.rhs.plus(node4);
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.2, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            addRelation(relation3);
        end;

        var relation4;
        if (line == "4")
            relation4 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation4.lhs.plus(0.35, node3);
            relation4.rhs.plus(node4);
            relation4.checkExactValue();
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.35, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            addRelation(relation4);
        end;

        var relation5;
        if (line == "5")
            relation5 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation5.lhs.plus(0.5, node3);
            relation5.rhs.plus(node4);
            relation5.checkExactValue();
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.5, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            addRelation(relation5);
        end;

        var relation6;
        if (line == "6")
            relation6 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation6.lhs.plus(0.75, node3);
            relation6.rhs.plus(node4);
            relation6.checkExactValue();
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.75, RCB_RS_PLUS)),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            addRelation(relation6);
        end;

        if (line == "7")
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 4, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol(line, 3, 0.2, RCB_RS_PLUS)),
                                                                                           RCB_RS_GREATER);
            conditionLoad(node4, RCB_RS_GREATER, node3, 0.2, -1.0);
        end;
    end;

    macro load()
        loadLine("1", "1");
        loadLine("2", "2");
        loadLine("3", "3");
        loadLine("4", "4");
        loadLine("5", "5");
        loadLine("6", "6");
        loadLine("7", "7");

        m_beginColumn = 4;
        m_endColumn   = 4;
    end;
end;

/**
 * Нормализация раздела Справочно по 2835-У
 */
class (TNormalizer) TPart5Normalizer2835(protocolView)
    initTNormalizer(protocolView);
    m_attributeValue = m_report.getPart("5");

    private macro loadLine(parentLine, line)
        var node  = addNode(parentLine, line);
    end;

    macro load()
        loadLine("1",   "1");
        loadLine("1",   "1.1");
        loadLine("1",   "1.2");
        loadLine("1",   "1.3");
        loadLine("1",   "1.4");

        loadLine("2",   "2");
        loadLine("2",   "2.1");
        loadLine("2",   "2.2");
        loadLine("2",   "2.3");
        loadLine("2",   "2.4");

        loadLine("3.1", "3.1");
        loadLine("3.2", "3.2");
        loadLine("3.3", "3.3");
        loadLine("3.4", "3.4");

        var relation = LinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation.lhs.plus(node(getName("3.1")));
        relation.rhs.plus(m_report.getPart("1").getAttribute("4.1").getValue("13").scaled);
        relation.linearRelationExactCheck(m_protocolView);
        this.addRelation(relation.getLinearRelation);

        relation = LinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation.lhs.plus(node(getName("3.2")));
        relation.rhs.plus(m_report.getPart("1").getAttribute("4.1").getValue("14").scaled);
        relation.linearRelationExactCheck(m_protocolView);
        this.addRelation(relation.getLinearRelation);

        loadLinesRelation("3.1", RCB_RS_GREATER_OR_EQUAL, "3.2");
    end;
end;

/**
 * Нормализация раздела Справочно по 3006-У
 */
class (TNormalizer_MMB) TPart5Normalizer3006(protocolView)
    initTNormalizer_MMB(protocolView);
    m_part           = "5";
    m_attributeValue = m_report.getPart(m_part);

    private macro loadLine(parentLine, line)
        var node  = addNode(parentLine, line);
    end;

    macro load()
        var column;

        loadLine("1",   "1");
        loadLine("1",   "1.1");
        loadLine("1",   "1.2");
        loadLine("1",   "1.3");
        loadLine("1",   "1.4");
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1",   null, 1, RCB_RS_PLUS)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.1", null, 1, RCB_RS_PLUS),
                                                                                                             TAttributeDataForProtocol("1.2", null, 1, RCB_RS_PLUS),
                                                                                                             TAttributeDataForProtocol("1.3", null, 1, RCB_RS_PLUS),
                                                                                                             TAttributeDataForProtocol("1.4", null, 1, RCB_RS_PLUS)),
                                                                                       RCB_RS_EQUAL);

        loadLine("2",   "2");
        loadLine("2",   "2.1");
        loadLine("2",   "2.2");
        loadLine("2",   "2.3");
        loadLine("2",   "2.4");
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("2",   null, 1, RCB_RS_PLUS)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("2.1", null, 1, RCB_RS_PLUS),
                                                                                                             TAttributeDataForProtocol("2.2", null, 1, RCB_RS_PLUS),
                                                                                                             TAttributeDataForProtocol("2.3", null, 1, RCB_RS_PLUS),
                                                                                                             TAttributeDataForProtocol("2.4", null, 1, RCB_RS_PLUS)),
                                                                                       RCB_RS_EQUAL);

        loadLine("3.1", "3.1");
        loadLine("3.2", "3.2");
        loadLine("3.3", "3.3");
        loadLine("3.4", "3.4");

        var relation = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation.lhs.plus(node(getName("3.1")));
        relation.rhs.plus(m_report.getPart("1").getAttribute("4.1").getValue("13").scaled);
        relation.checkExactValue();
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("3.1", null, 1, RCB_RS_PLUS)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("4.1", 13,   1, RCB_RS_PLUS, "1")),
                                                                                       RCB_RS_LESS_OR_EQUAL);
        addRelation(relation);

        relation = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation.lhs.plus(node(getName("3.2")));
        relation.rhs.plus(m_report.getPart("1").getAttribute("4.1").getValue("14").scaled);
        relation.checkExactValue();
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("3.2", null, 1, RCB_RS_PLUS)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("4.1", 14,   1, RCB_RS_PLUS, "1")),
                                                                                       RCB_RS_LESS_OR_EQUAL);
        addRelation(relation);

        loadLinesRelation("3.2", RCB_RS_LESS_OR_EQUAL, "3.1");

        if (rcbApplication().currentReport.context.period.kind == RCB_PK_MONTH)
            relation = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
            relation.lhs.plus(node(getName("2")));
            relation.rhs.plus(m_report.getPart("1").getAttribute("3.1").getValue("9").scaled +
                              m_report.getPart("1").getAttribute("3.2").getValue("9").scaled +
                              m_report.getPart("1").getAttribute("3.3").getValue("9").scaled +
                              m_report.getPart("1").getAttribute("3.4").getValue("9").scaled +
                              m_report.getPart("1").getAttribute("3.5.1").getValue("9").scaled +

                              m_report.getPart("1").getAttribute("3.1").getValue("10").scaled +
                              m_report.getPart("1").getAttribute("3.2").getValue("10").scaled +
                              m_report.getPart("1").getAttribute("3.3").getValue("10").scaled +
                              m_report.getPart("1").getAttribute("3.4").getValue("10").scaled +
                              m_report.getPart("1").getAttribute("3.5.1").getValue("10").scaled +

                              m_report.getPart("1").getAttribute("3.1").getValue("11").scaled +
                              m_report.getPart("1").getAttribute("3.2").getValue("11").scaled +
                              m_report.getPart("1").getAttribute("3.3").getValue("11").scaled +
                              m_report.getPart("1").getAttribute("3.4").getValue("11").scaled +
                              m_report.getPart("1").getAttribute("3.5.1").getValue("11").scaled +

                              m_report.getPart("1").getAttribute("3.1").getValue("12").scaled +
                              m_report.getPart("1").getAttribute("3.2").getValue("12").scaled +
                              m_report.getPart("1").getAttribute("3.3").getValue("12").scaled +
                              m_report.getPart("1").getAttribute("3.4").getValue("12").scaled +
                              m_report.getPart("1").getAttribute("3.5.1").getValue("12").scaled +

                              m_report.getPart("3").getAttribute("2.1").getValue("3").scaled
                             );
            relation.checkExactValue();
            m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("2",   null, 1, RCB_RS_PLUS)),
                                                                                           RcbArray().initialize(TAttributeDataForProtocol("3.1", "9",  1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.2", "9",  1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.3", "9",  1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.4", "9",  1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.5.1", "9",  1, RCB_RS_PLUS, "1"),

                                                                                                                 TAttributeDataForProtocol("3.1", "10", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.2", "10", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.3", "10", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.4", "10", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.5.1", "10", 1, RCB_RS_PLUS, "1"),

                                                                                                                 TAttributeDataForProtocol("3.1", "11", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.2", "11", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.3", "11", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.4", "11", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.5.1", "11", 1, RCB_RS_PLUS, "1"),

                                                                                                                 TAttributeDataForProtocol("3.1", "12", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.2", "12", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.3", "12", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.4", "12", 1, RCB_RS_PLUS, "1"),
                                                                                                                 TAttributeDataForProtocol("3.5.1", "12", 1, RCB_RS_PLUS, "1"),

                                                                                                                 TAttributeDataForProtocol("2.1", "3",  1, RCB_RS_PLUS, "3")),
                                                                                           RCB_RS_LESS_OR_EQUAL);
            addRelation(relation);
        end;
    end;
end;

/**
 * Нормализация раздела справочно пункта 4 по 2835-У
 */
class (TNormalizer_MMB) TPart5Item4Normalizer2835(protocolView)
    initTNormalizer_MMB(protocolView);
    private var iteratorPart5Item4    = RcbApplication().currentReport.attributeValue("РазделСправочноПункт4").createValueIterator();
    private var m_attributeItem4Value = RcbApplication().currentReport.attributeValue("РазделСправочноПункт4");

    m_part = "6";

    /**
     * Сохранить строку значений.
     * @param     line    код строки
     *
     */
    private macro saveValue(number, field, fieldName, inn, column)
        var keyValue               = m_attributeItem4Value.createKeyValue();
        keyValue.fieldValue("inn") = iteratorPart5Item4.currentItem.fieldValue("inn").current;
        var lineCompositeValue     = m_attributeItem4Value.findValue(keyValue);
        var valueExact = 0;
        var valueScaled = 0;
        var node = this.node("Гр" + column + "ИНН" + inn);
        if (node and lineCompositeValue.fieldValue(field).exact != 0)
            valueExact  = lineCompositeValue.fieldValue(field).exact  = node.exact;
            valueScaled = lineCompositeValue.fieldValue(field).scaled = node.scaled;
        end;
        var isNormalizedValue = ((valueExact != null) and
                                 (valueScaled != floor(valueExact) / rcbApplication.currentReport.multiplier + 0.5));
        if (isNormalizedValue)
            m_protocolView.printSymbolPart5Item4(number, fieldName, valueExact, valueScaled);
        end;
    end;

    /**
     * Сохранить атрибуты.
     */
    macro save()
        var i = 1;

        iteratorPart5Item4.moveFirst();
        while (not iteratorPart5Item4.isDone())
            saveValue(i, "madeReserve283", "Сформ. резерв по 283П", iteratorPart5Item4.currentItem.fieldValue("inn").current, "8");
            saveValue(i, "madeReserve2732", "Сформ. резерв по 2732У", iteratorPart5Item4.currentItem.fieldValue("inn").current, "9");
            saveValue(i, "madeReserve", "Сформ. резерв. Итог", iteratorPart5Item4.currentItem.fieldValue("inn").current, "10");
            i = i + 1;
            iteratorPart5Item4.moveNext();
        end;
        m_protocolView.printEndPart5Item4();
    end;

    /**
     * Формирование имени узла.
     */
    private macro getName(inn, column)
        return "Гр" + column + "ИНН" + inn;
    end;

    private macro addNode2(column, inn, value)
        var node   = null;
        node       =  normalizer.addNode(getName(inn, column));
        node.exact = NVL(value, 0);
        node.recalculateScaled();
        return node;
    end;

    macro load()
        iteratorPart5Item4.moveFirst();
        var line = 1;
        while (not iteratorPart5Item4.isDone())
            var node8  = addNode2("8", iteratorPart5Item4.currentItem.fieldValue("inn").current, iteratorPart5Item4.currentItem.fieldValue("madeReserve283").exact);
            var node9  = addNode2("9", iteratorPart5Item4.currentItem.fieldValue("inn").current, iteratorPart5Item4.currentItem.fieldValue("madeReserve2732").exact);
            var node10 = addNode2("10",iteratorPart5Item4.currentItem.fieldValue("inn").current, iteratorPart5Item4.currentItem.fieldValue("madeReserve").exact);

            var relation;
            relation = ReportLinearRelation(RCB_RS_EQUAL);
            relation.lhs.plus(node8).plus(node9);
            relation.rhs.plus(node10);
            relation.checkExactValue();
            addRelation(relation);
            iteratorPart5Item4.moveNext();
            line = line + 1;
        end;
    end;
end;

class (TNormalizer_MMB) TPart5Item6Normalizer3129_2(protocolView)
    initTNormalizer_MMB(protocolView);

    private var iteratorPart5Item6_1   = RcbApplication().currentReport.attributeValue("РазделСправочноПункт6_1").createValueIterator();
    private var iteratorPart5Item6_1_1 = RcbApplication().currentReport.attributeValue("РазделСправочноПункт6_1_1").createValueIterator();
    private var iteratorPart5Item6_1_2 = RcbApplication().currentReport.attributeValue("РазделСправочноПункт6_1_2").createValueIterator();
    var m_part6_1_1 = "8";
    var m_part6_1_2 = "9";

    m_part = "7";

    /**
     * Сохранить строку значений.
     * @param     line    код строки
     *
     */
    private macro saveValue(line, field, fieldName, value, column)
        var valueExact  = 0;
        var valueScaled = 0;
        var node = this.node(getName(line, column));
        if (node and iteratorPart5Item6_1.currentItem.fieldValue(field).exact != 0)
            valueExact  = iteratorPart5Item6_1.currentItem.fieldValue(field).exact  = node.exact;
            valueScaled = iteratorPart5Item6_1.currentItem.fieldValue(field).scaled = node.scaled;
        end;
     end;

    /**
     * Сохранить атрибуты.
     */
    macro save()
        saveValue("1", "demandAmount", "Сумма требования", iteratorPart5Item6_1.currentItem.fieldValue("demandAmount").current, "3");
        saveValue("1", "reserve", "Сформированный резерв на возможные потери", iteratorPart5Item6_1.currentItem.fieldValue("reserve").current, "4");
    end;

    private macro addNode2(line, column, value)
        var node  = null;
        node = normalizer.addNode(getName(line, column));
        node.exact = NVL(value, 0);
        node.recalculateScaled();
        return node;
    end;

    macro load()
        iteratorPart5Item6_1.moveFirst();
        iteratorPart5Item6_1_1.moveFirst();
        iteratorPart5Item6_1_2.moveFirst();

        var node6_1_col3 = addNode2("1", "3", iteratorPart5Item6_1.currentItem.fieldValue("demandAmount").exact);
        var node6_1_col4 = addNode2("1", "4", iteratorPart5Item6_1.currentItem.fieldValue("reserve").exact);

        var relationDemandAmount;
        relationDemandAmount = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
        relationDemandAmount.lhs.plus(node6_1_col3);
        relationDemandAmount.rhs.plus(iteratorPart5Item6_1_1.currentItem.fieldValue("demandAmount").scaled).plus(iteratorPart5Item6_1_2.currentItem.fieldValue("demandAmount").scaled);
        relationDemandAmount.checkExactValue();
        addRelation(relationDemandAmount);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1", 3, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.1", 3, 1, RCB_RS_PLUS),
                                                                                                             TAttributeDataForProtocol("1.2", 3, 1, RCB_RS_PLUS)),
                                                                                       RCB_RS_GREATER_OR_EQUAL);

        var relationReserve;
        relationReserve = ReportLinearRelation(RCB_RS_GREATER_OR_EQUAL);
        relationReserve.lhs.plus(node6_1_col4);
        relationReserve.rhs.plus(iteratorPart5Item6_1_1.currentItem.fieldValue("reserve").scaled).plus(iteratorPart5Item6_1_2.currentItem.fieldValue("reserve").scaled);
        relationReserve.checkExactValue();
        addRelation(relationReserve);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1", 4, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.1", 4, 1, RCB_RS_PLUS),
                                                                                                             TAttributeDataForProtocol("1.2", 4, 1, RCB_RS_PLUS)),
                                                                                       RCB_RS_GREATER_OR_EQUAL);

        var relation1 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation1.lhs.plus(node6_1_col3);
        relation1.rhs.plus(m_report.getPart("1").getAttribute("1.4").getValue("3").scaled +
                           m_report.getPart("1").getAttribute("1.8").getValue("3").scaled +
                           m_report.getPart("1").getAttribute("2.4").getValue("3").scaled +
                           m_report.getPart("1").getAttribute("2.7").getValue("3").scaled
                          );
        relation1.checkExactValue();
        addRelation(relation1);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1", 3, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.4", 3, 1, RCB_RS_PLUS,"1"),
                                                                                                             TAttributeDataForProtocol("1.8", 3, 1, RCB_RS_PLUS,"1"),
                                                                                                             TAttributeDataForProtocol("2.4", 3, 1, RCB_RS_PLUS,"1"),
                                                                                                             TAttributeDataForProtocol("2.7", 3, 1, RCB_RS_PLUS,"1")),
                                                                                       RCB_RS_LESS_OR_EQUAL);

        var relation2 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation2.lhs.plus(node6_1_col4);
        relation2.rhs.plus(m_report.getPart("1").getAttribute("1.4").getValue("15").scaled +
                           m_report.getPart("1").getAttribute("1.8").getValue("15").scaled +
                           m_report.getPart("1").getAttribute("2.4").getValue("15").scaled +
                           m_report.getPart("1").getAttribute("2.7").getValue("15").scaled
                          );
        relation2.checkExactValue();
        addRelation(relation2);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1", 4, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.4", 15, 1, RCB_RS_PLUS,"1"),
                                                                                                             TAttributeDataForProtocol("1.8", 15, 1, RCB_RS_PLUS,"1"),
                                                                                                             TAttributeDataForProtocol("2.4", 15, 1, RCB_RS_PLUS,"1"),
                                                                                                             TAttributeDataForProtocol("2.7", 15, 1, RCB_RS_PLUS,"1")),
                                                                                       RCB_RS_LESS_OR_EQUAL);

        var relation3 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation3.lhs.plus(iteratorPart5Item6_1_1.currentItem.fieldValue("demandAmount").scaled);
        relation3.rhs.plus(node6_1_col3);
        relation3.checkExactValue();
        addRelation(relation3);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part6_1_1,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.1",null, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1", 3, 1)),
                                                                                       RCB_RS_LESS_OR_EQUAL);

        var relation4 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation4.lhs.plus(iteratorPart5Item6_1_1.currentItem.fieldValue("reserve").scaled);
        relation4.rhs.plus(node6_1_col4);
        relation4.checkExactValue();
        addRelation(relation4);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part6_1_1,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.1",null, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1", 4, 1)),
                                                                                       RCB_RS_LESS_OR_EQUAL);
        var relation5 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation5.lhs.plus(iteratorPart5Item6_1_2.currentItem.fieldValue("demandAmount").scaled);
        relation5.rhs.plus(node6_1_col3);
        relation5.checkExactValue();
        addRelation(relation5);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part6_1_2,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.2",null, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1", 3, 1)),
                                                                                       RCB_RS_LESS_OR_EQUAL);

        var relation6 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation6.lhs.plus(iteratorPart5Item6_1_2.currentItem.fieldValue("reserve").scaled);
        relation6.rhs.plus(node6_1_col4);
        relation6.checkExactValue();
        addRelation(relation6);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part6_1_2,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.2",null, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1", 4, 1)),
                                                                                       RCB_RS_LESS_OR_EQUAL);

        var relation7 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation7.lhs.plus(node6_1_col3);
        relation7.rhs.plus(m_report.getPart("1").getAttribute("1.4").getValue("3").scaled +
                           m_report.getPart("1").getAttribute("2.4").getValue("3").scaled
                          );
        relation7.checkExactValue();
        addRelation(relation7);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1",   3, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.4", 3, 1, RCB_RS_PLUS, "1"),
                                                                                                             TAttributeDataForProtocol("2.4", 3, 1, RCB_RS_PLUS, "1")),
                                                                                       RCB_RS_LESS_OR_EQUAL);

        var relation8 = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);
        relation8.lhs.plus(node6_1_col4);
        relation8.rhs.plus(m_report.getPart("1").getAttribute("1.4").getValue("15").scaled +
                           m_report.getPart("1").getAttribute("2.4").getValue("15").scaled
                          );
        relation8.checkExactValue();
        addRelation(relation8);
        m_stringsForProtocol[m_stringsForProtocol.size] = TMmbProtocolDataForInsideRow(m_report, m_part,
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1",    4, 1)),
                                                                                       RcbArray().initialize(TAttributeDataForProtocol("1.4", 15, 1, RCB_RS_PLUS, "1"),
                                                                                                             TAttributeDataForProtocol("2.4", 15, 1, RCB_RS_PLUS, "1")),
                                                                                       RCB_RS_LESS_OR_EQUAL);
    end;
end;

class (TNormalizer_MMB) TPart5Item5Normalizer(protocolView)
    var m_balanceReport;

    private macro setBalanceReport()
        var currentReport = RcbApplication().currentReport;
        var beginDateBalance = currentReport.context.period.beginDate;
        var endDateBalance   = currentReport.context.period.endDate;
        var contextBalance   = RcbReportContext(RcbPeriod(beginDateBalance, endDateBalance),
                                                currentReport.context.departmentCode,
                                                currentReport.context.issueMode,
                                                currentReport.context.organizationStructure,
                                                currentReport.context.isSummaryMode);
        m_balanceReport = RcbApplication().objectFactory.createReport("Балансовые счета", contextBalance).createBalanceReport();

        if (not TBaseBalanceAttribute("БАЛАНС", m_balanceReport).isBalanceCalculated(CHAPTER_3, currentReport.dimension))
            m_balanceReport = null;
        end;
    end;

    private macro isExistsBalanceReport()
        return m_balanceReport != null;
    end;

    private macro getBalanceReport()
        return m_balanceReport;
    end;

    macro getBalanceSum(balanceReport, balanceArray : RcbArray)
        var sum = 0;
        var currentBalance;
        var balanceAttribute;

        balanceArray.moveFirst();

        balanceAttribute = TBalanceAttribute("БАЛАНС", balanceReport);

        while (balanceArray.moveNext())
            currentBalance = balanceArray.getCurrentItem();

            if (balanceAttribute.getBalanceAttribute(CHAPTER_3, currentBalance, false) != null)
                    sum = sum + balanceAttribute.getOutRest().scaled;
            end;
        end;

        return sum;
    end;

    private macro saveValue(line)
        var valueExact  = 0;
        var valueScaled = 0;
        var node = this.node(getName(line));

        if (node and m_attributeValue.getAttribute("5").getValue().exact != 0)
            valueExact  = m_attributeValue.getAttribute("5").getValue().exact  = node.exact;
            valueScaled = m_attributeValue.getAttribute("5").getValue().scaled = node.scaled;
        end;

        var isNormalizedValue = ((valueExact != null) and
                                 (valueScaled != floor(valueExact / rcbApplication.currentReport.multiplier + 0.5)));
        if (isNormalizedValue)
            m_protocolView.printSymbolPart5Item5(line, valueExact, valueScaled);
        end;
    end;

    /**
     * Сохранить атрибуты.
     */
    macro save()
        saveValue("5");

        m_protocolView.printEndPart5Item5();
    end;

    macro load()
        if (isExistsBalanceReport())
            var balanceSum   = getBalanceSum(getBalanceReport(), RcbArray().initialize("91603", "91604", "91605", "91606"));
            var attributeSum = m_attributeValue.getAttribute("5");
            var relation;
            var node;
            var attribute;
            relation = ReportLinearRelation(RCB_RS_LESS_OR_EQUAL);

            node = normalizer.addNode(getName("5"));

            node.exact = attributeSum.getValue().exact;
            node.recalculateScaled();

            relation.lhs.plus(node);

            relation.rhs.plus(double(nvl(balanceSum, 0)));

            this.addRelation(relation);
        else
            m_protocolView.printReportAbsence(RcbApplication().currentReport.context.period.beginDate, RcbApplication().currentReport.context.period.endDate);
        end;
    end;

    macro constructorTPart5Item5Normalizer(protocolView)
        initTNormalizer_MMB(protocolView);

        m_part           = "5";
        m_attributeValue = objectFactoryInstance.createReport().getPart(m_part);

        setBalanceReport();
    end;

    constructorTPart5Item5Normalizer(protocolView);
end;