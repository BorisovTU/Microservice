/**
 * Форма 115. Контроллер расчета.
 *
 * @since   01.06.2008
 * @author  Ivkina Olga
 * @version 6.00.020.28
 */


import res_const;/*ядерные константы для работы по резервам*/
import rcb_bo;
import rcbconst;

import f115ObjectFactory;
import f115Attribute;
import f115Part;
import f115Report;
import f115DataSource;

import SbCrdInter;

/**
 * Контроллер расчета.
 */
class TCalculationPartController(dataSource, tuneTable, protocol, report)

    /**
     * Источник данных.
     */
    private var m_dataSource: TDataSource;

    /**
     * Настроечная таблица.
     */
    private var m_tuneTable;

    /**
     * Протокол расчета.
     */
    private var m_protocol;

    private var m_report;

    /**
     * конструктор.
     */
    macro constructor(dataSource, tuneTable, protocol, report)
        m_dataSource = dataSource;
        m_tuneTable  = tuneTable;
        m_protocol   = protocol;
        m_report     = report;
    end;

    /**
     * Сложение масок.
     */
    macro masksMerger()

        var filter = "";
        var temp;
        var i = 1;

        while (GetParm(i, temp))
            if ((ValType(temp) == V_STRING) and (string(temp) != "EMPTY_MASKS"))
                filter = filter + ternary(filter!="", ",", "") + String(temp);
            end;
            i = i + 1;
        end;

        return filter;
    end;


    /**
     * Расчитать атрибут отчета.
     * @param     attribute
     */
    macro calculateAttribute(attribute : TAttribute)
        throw(TPureVirtualMethodCallException("TCalculationController::calculateAttribute"));
    end;

    /**
     * Добавить один атрибут отчета к другому.
     * @param     attribute
     */
    macro addAttribute(attribute : TAttribute, additionAttribute : TAttribute, bo)
        m_protocol.printAddDataAttribute(additionAttribute.getName(), NVL(bo, BONothing));
        attribute.plus(additionAttribute);
    end;


    /**
     * Расчитать раздел отчета.
     * @param     part
     */
    macro calculate(part : TPart)
        throw(TPureVirtualMethodCallException("TCalculationController::calculatePart"));
    end;

    constructor(dataSource, tuneTable, protocol, report);
end;
