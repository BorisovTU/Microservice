/*
$Name:          f115CalculationPart1Controller.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 115. Контроллер расчета. Раздел 1.
*/

/**
 * Форма 115. Контроллер расчета. Раздел 1.
 *
 * @since   01.06.2008
 * @author  Ivkina Olga
 * @version 6.00.020.28
 */
import f115CalculationPartController;

/**
 *  Расчет переменных по 2061-У.
 */
class (TCalculationPartController) TCalculationPart1Controller2061(dataSource, tuneTable, protocol, report)

    /**
     * Источник данных по счетам в ГК.
     */
    private var m_cbAccountsDataSource;

    /**
     * Источник данных по договорам в Loans-е.
     */
    private var m_loansCreditDataSource;
    private var accountFilter;

    private var overdueAccountFilter;
    private var termAccountFilter;

    private var hasDataloansFilter;

    /**
     * Конструктор.
     */
    private macro constructor(dataSource, tuneTable, protocol, report)

        initTCalculationPartController(dataSource, tuneTable, protocol, report);

        m_cbAccountsDataSource  =  m_dataSource.getCbAccountsDataSource();
        m_loansCreditDataSource =  m_dataSource.getLoansCreditDataSource();
    end;

    private macro setLineValue(attribute : TAttribute, dataSet, backOffice)
         var column_3;
         var column_15;

         if ((dataSet != null) and (not dataSet.EOF))
            /* сумма требований по категориям качества*/
            column_3 = dataSet.column_4 +
                       dataSet.column_5 +
                       dataSet.column_6 +
                       dataSet.column_7 +
                       dataSet.column_8;
            attribute.setValue(column_3,           "3", backOffice);
            attribute.setValue(dataSet.column_4,   "4", backOffice);
            attribute.setValue(dataSet.column_5,   "5", backOffice);
            attribute.setValue(dataSet.column_6,   "6", backOffice);
            attribute.setValue(dataSet.column_7,   "7", backOffice);
            attribute.setValue(dataSet.column_8,   "8", backOffice);
            /* просроченная задолженность */
            attribute.setValue(dataSet.column_9,   "9", backOffice);
            attribute.setValue(dataSet.column_10, "10", backOffice);
            attribute.setValue(dataSet.column_11, "11", backOffice);
            attribute.setValue(dataSet.column_12, "12", backOffice);
            /* резерв на возможные потери */
            /* расчетные */
            attribute.setValue(dataSet.column_13, "13", backOffice);
            attribute.setValue(dataSet.column_14, "14", backOffice);
            /* фактический */
            column_15 = dataSet.column_16 +
                        dataSet.column_17 +
                        dataSet.column_18 +
                        dataSet.column_19;
            attribute.setValue(column_15,         "15", backOffice);
            attribute.setValue(dataSet.column_16, "16", backOffice);
            attribute.setValue(dataSet.column_17, "17", backOffice);
            attribute.setValue(dataSet.column_18, "18", backOffice);
            attribute.setValue(dataSet.column_19, "19", backOffice);
         else
            attribute.setValue(0,  "3", backOffice);
            attribute.setValue(0,  "4", backOffice);
            attribute.setValue(0,  "5", backOffice);
            attribute.setValue(0,  "6", backOffice);
            attribute.setValue(0,  "7", backOffice);
            attribute.setValue(0,  "8", backOffice);
            attribute.setValue(0,  "9", backOffice);
            attribute.setValue(0, "10", backOffice);
            attribute.setValue(0, "11", backOffice);
            attribute.setValue(0, "12", backOffice);
            attribute.setValue(0, "13", backOffice);
            attribute.setValue(0, "14", backOffice);
            attribute.setValue(0, "15", backOffice);
            attribute.setValue(0, "16", backOffice);
            attribute.setValue(0, "17", backOffice);
            attribute.setValue(0, "18", backOffice);
            attribute.setValue(0, "19", backOffice);
         end;
    end;

    private macro setLineUserValue(attribute : TAttribute, userAttributeName)
         defaultParm(userAttributeName, attribute.getName());

         var column_3;
         var column_15;

         private macro setValue(columnnumber : string)
             attribute.setValue(m_report.getUserAttributeValue(userAttributeName, columnNumber), columnnumber, BOUser);
         end;

           m_protocol.printUserDataCopyMessage(userAttributeName);
         column_3 = m_report.getUserAttributeValue(userAttributeName, "4") +
                    m_report.getUserAttributeValue(userAttributeName, "5") +
                    m_report.getUserAttributeValue(userAttributeName, "6") +
                    m_report.getUserAttributeValue(userAttributeName, "7") +
                    m_report.getUserAttributeValue(userAttributeName, "8");
         attribute.setValue(column_3, "3", BOUser);
         setValue("4");
         setValue("5");
         setValue("6");
         setValue("7");
         setValue("8");
         /*просроченная задолженность */
         setValue("9");
         setValue("10");
         setValue("11");
         setValue("12");
         /*резерв на возможные потери */
         /* расчетные */
         setValue("13");
         setValue("14");
         /* фактический */
         column_15 = m_report.getUserAttributeValue(userAttributeName, "16") +
                     m_report.getUserAttributeValue(userAttributeName, "17") +
                     m_report.getUserAttributeValue(userAttributeName, "18") +
                     m_report.getUserAttributeValue(userAttributeName, "19");
         attribute.setValue(column_15, "15", BOUser);
         setValue("16");
         setValue("17");
         setValue("18");
         setValue("19");
    end;

    private macro addLineValue(attribute : TAttribute, dataSet, backOffice)
         var column_3;
         var column_15;

         if ((dataSet != null) and (not dataSet.EOF))
            /* сумма требований по категориям качества */
            column_3 = dataSet.column_4 +
                       dataSet.column_5 +
                       dataSet.column_6 +
                       dataSet.column_7 +
                       dataSet.column_8;
            attribute.plus(column_3,           "3", backOffice);
            attribute.plus(dataSet.column_4,   "4", backOffice);
            attribute.plus(dataSet.column_5,   "5", backOffice);
            attribute.plus(dataSet.column_6,   "6", backOffice);
            attribute.plus(dataSet.column_7,   "7", backOffice);
            attribute.plus(dataSet.column_8,   "8", backOffice);
            /* просроченная задолженность */
            attribute.plus(dataSet.column_9,   "9", backOffice);
            attribute.plus(dataSet.column_10, "10", backOffice);
            attribute.plus(dataSet.column_11, "11", backOffice);
            attribute.plus(dataSet.column_12, "12", backOffice);
            /* резерв на возможные потери */
            /* расчетные */
            attribute.plus(dataSet.column_13, "13", backOffice);
            attribute.plus(dataSet.column_14, "14", backOffice);
            /* фактический */
            column_15 = dataSet.column_16 +
                        dataSet.column_17 +
                        dataSet.column_18 +
                        dataSet.column_19;
            attribute.plus(column_15,         "15", backOffice);
            attribute.plus(dataSet.column_16, "16", backOffice);
            attribute.plus(dataSet.column_17, "17", backOffice);
            attribute.plus(dataSet.column_18, "18", backOffice);
            attribute.plus(dataSet.column_19, "19", backOffice);
        end;
    end;

    /**
     *
     */
    private macro setAccountMasks(line : String)
        var accountMasks        = m_tuneTable.getAccountMasks("1", line,  BOCB);
        var overdueAccountMasks = m_tuneTable.getDelayAccountMasks("1", line, BOCB);

        var temp;
        var i = 2;
        while (GetParm(i, temp))
            accountMasks        = masksMerger(accountMasks,        m_tuneTable.getAccountMasks("1", temp, BOCB));
            overdueAccountMasks = masksMerger(overdueAccountMasks, m_tuneTable.getDelayAccountMasks("1", temp, BOCB));
            i = i + 1;
        end;
        overdueAccountFilter = m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(overdueAccountMasks);
        accountFilter        = m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(masksMerger(overdueAccountMasks, accountMasks));

/*!!!! исправить*/
        hasDataLoansFilter   = m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", line,  BOLoans));
    end;


    /*1.1*/
    private macro calculateAttribute1_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                    BOCB);
    end;

    /*1.2*/
    private macro calculateAttribute1_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
    end;

    /*1.3*/
    private macro calculateAttribute1_3(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'В'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
    end;

    /*1.4*/
    private macro calculateAttribute1_4(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'В'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().isBank(),
                                                   overdueAccountFilter),
                     BOCB);
    end;

    /*1.5*/
    private macro calculateAttribute1_5(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Отсрочка'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
    end;

    /*1.6*/
    private macro calculateAttribute1_6(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'РЕПО'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
    end;

    /*1.7*/
    private macro calculateAttribute1_7(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   overdueAccountFilter),
                     BOCB);
        setLineUserValue(attribute);
    end;

    /*1.8*/
    private macro calculateAttribute1_8(attribute)
        /*1.8_кредит*/
        setAccountMasks(attribute.getName() + "_кредит");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isPercentAccounts(),
                                                   overdueAccountFilter),
                     BOCB);
        /* + 1.8_цб*/
        setAccountMasks(attribute.getName() + "_цб");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'П/Д'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isBank(),
                                                  overdueAccountFilter),
                     BOCB);
        /* + 1.8_УВ*/
        setAccountMasks(attribute.getName() + "_УВ");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'П/Д'", RCB_OBJGROUP_ACTIVEKIND),
                                                   overdueAccountFilter),
                     BOCB);

        /* + 1.8_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                    /*учет принадлежит ли счет портфелю не нужен,
                      т.к. резерв сразу расчитывается как часть резерва портфеля
                      или берется полная сумма резерва, если счет не в портфеле*/
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isBank(),
                                                   overdueAccountFilter,
                                                   false),/*не учитывать просрочку в требованиях*/
                     BOCB);

        setLineUserValue(attribute);
    end;

    /*2.1*/
    private macro calculateAttribute2_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                   accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);
    end;

    /*2.2*/
    private macro calculateAttribute2_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'В'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                  overdueAccountFilter),
                     BOCB);
    end;

    /*2.3*/
    private macro calculateAttribute2_3(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Отсрочка'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
     end;

    /*2.4*/
    private macro calculateAttribute2_4(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'В'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isNotBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
    end;

    /*2.5*/
    private macro calculateAttribute2_5(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'РЕПО'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
    end;

    /*2.6*/
    private macro calculateAttribute2_6(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   overdueAccountFilter),
                     BOCB);
        setLineUserValue(attribute);
    end;

    /*2.7*/
    private macro calculateAttribute2_7(attribute)
        /*+ 2.7_кредит*/
        setAccountMasks(attribute.getName() + "_кредит");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isPercentAccounts(),
                                                   overdueAccountFilter),
                     BOCB);
        /*+ 2.7_цб*/
        setAccountMasks(attribute.getName() + "_цб");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'П/Д'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isNotBank(),
                                                   overdueAccountFilter),
                     BOCB);
        /*+ 2.7_УВ*/
        setAccountMasks(attribute.getName() + "_УВ");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'П/Д'", RCB_OBJGROUP_ACTIVEKIND),
                                                   overdueAccountFilter),
                     BOCB);

        /* + 2.7_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                    /*учет принадлежит ли счет портфелю не нужен,
                      т.к. резерв сразу расчитывается как часть резерва портфеля
                      или берется полная сумма резерва, если счет не в портфеле*/
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson(),
                                                   overdueAccountFilter,
                                                   false),/*не учитывать просрочку в требованиях*/
                     BOCB);

        setAccountMasks(attribute.getName());

        setLineValue(attribute,
                     m_loansCreditDataSource.getPercentRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
         setLineUserValue(attribute);
     end;

    /*3.1*/
    private macro calculateAttribute3_1(attribute)
        setAccountMasks(attribute.getName());

        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Покупка'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("Ж"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                         ),
                     BOLoans);
    end;

    /*3.2*/
    private macro calculateAttribute3_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Ипотека'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("И"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
    end;

    /*3.3*/
    private macro calculateAttribute3_3(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Автокредит'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                      BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("А"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
    end;

    /*3.4*/
    private macro calculateAttribute3_4(attribute)
        /*+ 3.4_потр*/
        setAccountMasks(attribute.getName() + "_потр");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Потребительская ссуда'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
        /*+ 3.4_овер*/
        setAccountMasks(attribute.getName() + "_овер");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                accountFilter
                              + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD)
                              + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                              overdueAccountFilter),
                     BOCB);

        /*3.4*/
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + "AND (   ( 1 = 1 "+m_loansCreditDataSource.getFilter().hasType(LO_KARTA)
                                                         + "        )"
                                                         + "     OR ( 1 = 1 "+m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         +             m_loansCreditDataSource.getFilter().hasAim("Н")
                                                         + "        )"
                                                         + "    )",
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /*3.5*/
    private macro calculateAttribute3_5(attribute)
        /*3.5*/
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   overdueAccountFilter),
                     BOCB);

        setLineUserValue(attribute);
    end;

    /*3.6*/
    private macro calculateAttribute3_6(attribute)
        /*3.6_проц*/
        setAccountMasks(attribute.getName() + "_проц");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isPercentAccounts(),
                                                   overdueAccountFilter),
                     BOCB);
        /*+3.6_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isPhysicalPerson(),
                                                   overdueAccountFilter,
                                                   false),/*не учитывать просрочку в требованиях*/
                     BOCB);

        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getPercentRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);

         setLineUserValue(attribute);
    end;

    /*4.1.1*/
    private macro calculateAttribute4_1_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.10'", RCB_OBJGROUP_FOR_REPORTING)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.10'"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);

    end;

    /*4.1.1.1*/
    private macro calculateAttribute4_1_1_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.10'", RCB_OBJGROUP_FOR_REPORTING, global.parameters.getBeginDate())
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.10'", global.parameters.getBeginDate()),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /*4.1.2*/
    private macro calculateAttribute4_1_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.14.3'", RCB_OBJGROUP_FOR_REPORTING)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.14.3'"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
     end;

    /*4.1.2.1*/
    private macro calculateAttribute4_1_2_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.14.3'", RCB_OBJGROUP_FOR_REPORTING, global.parameters.getBeginDate())
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.14.3'", global.parameters.getBeginDate()),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /*1*/
    private macro calculateAttribute1(attribute)
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.1"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.2"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.3"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.4"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.5"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.6"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.7"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.8"));
    end;

    /*2*/
    private macro calculateAttribute2(attribute)
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.1"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.2"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.3"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.4"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.5"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.6"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.7"));
    end;

    /*3*/
    private macro calculateAttribute3(attribute)
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.1"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.2"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.3"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.4"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.5"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.6"));
    end;

    /*4*/
    private macro calculateAttribute4(attribute)
        addAttribute(attribute, m_report.getPart("1").getAttribute("1"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3"));
    end;

    /*4.1*/
    private macro calculateAttribute4_1(attribute)
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.2"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.3"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.5"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("1.6"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.1"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.2"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.3"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.5"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.1"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.2"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.3"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("3.4"));
    end;

    macro calculate(part : TPart)

        if (part.getNumber() == 1)
            m_protocol.printReportLineNumber("1.1");
            calculateAttribute1_1(part.getAttribute("1.1"));
            m_protocol.printReportLineNumber("1.2");
            calculateAttribute1_2(part.getAttribute("1.2"));
            m_protocol.printReportLineNumber("1.3");
            calculateAttribute1_3(part.getAttribute("1.3"));
            m_protocol.printReportLineNumber("1.4");
            calculateAttribute1_4(part.getAttribute("1.4"));
            m_protocol.printReportLineNumber("1.5");
            calculateAttribute1_5(part.getAttribute("1.5"));
            m_protocol.printReportLineNumber("1.6");
            calculateAttribute1_6(part.getAttribute("1.6"));
            m_protocol.printReportLineNumber("1.7");
            calculateAttribute1_7(part.getAttribute("1.7"));
            m_protocol.printReportLineNumber("1.8");
            calculateAttribute1_8(part.getAttribute("1.8"));

            m_protocol.printReportLineNumber("2.1");
            calculateAttribute2_1(part.getAttribute("2.1"));
            m_protocol.printReportLineNumber("2.2");
            calculateAttribute2_2(part.getAttribute("2.2"));
            m_protocol.printReportLineNumber("2.3");
            calculateAttribute2_3(part.getAttribute("2.3"));
            m_protocol.printReportLineNumber("2.4");
            calculateAttribute2_4(part.getAttribute("2.4"));
            m_protocol.printReportLineNumber("2.5");
            calculateAttribute2_5(part.getAttribute("2.5"));
            m_protocol.printReportLineNumber("2.6");
            calculateAttribute2_6(part.getAttribute("2.6"));
            m_protocol.printReportLineNumber("2.7");
            calculateAttribute2_7(part.getAttribute("2.7"));

            m_protocol.printReportLineNumber("3.1");
            calculateAttribute3_1(part.getAttribute("3.1"));
            m_protocol.printReportLineNumber("3.2");
            calculateAttribute3_2(part.getAttribute("3.2"));
            m_protocol.printReportLineNumber("3.3");
            calculateAttribute3_3(part.getAttribute("3.3"));
            m_protocol.printReportLineNumber("3.4");
            calculateAttribute3_4(part.getAttribute("3.4"));
            m_protocol.printReportLineNumber("3.5");
            calculateAttribute3_5(part.getAttribute("3.5"));
            m_protocol.printReportLineNumber("3.6");
            calculateAttribute3_6(part.getAttribute("3.6"));

            m_protocol.printReportLineNumber("4.1.1.1");
            calculateAttribute4_1_1_1(part.getAttribute("4.1.1.1"));
            m_protocol.printReportLineNumber("4.1.1");
            calculateAttribute4_1_1  (part.getAttribute("4.1.1"));
            m_protocol.printReportLineNumber("4.1.2.1");
            calculateAttribute4_1_2_1(part.getAttribute("4.1.2.1"));
            m_protocol.printReportLineNumber("4.1.2");
            calculateAttribute4_1_2  (part.getAttribute("4.1.2"));

            /*это переменные, которые не должны были расчитываться*/
            part.getAttribute("1.1").setUndefinedValue(  "9", "10",  "11", "12",  "14");
            part.getAttribute("1.8").setUndefinedValue( "13", "14");
            part.getAttribute("2.7").setUndefinedValue( "13", "14");
            part.getAttribute("3.6").setUndefinedValue( "13", "14");

            part.getAttribute("4.1.1"  ).setUndefinedValue("6", "7", "8", "9", "10", "11", "12", "17", "18", "19");
            part.getAttribute("4.1.1.1").setUndefinedValue("6", "7", "8", "9", "10", "11", "12", "17", "18", "19");
            part.getAttribute("4.1.2"  ).setUndefinedValue("6", "7", "8", "9", "10", "11", "12", "17", "18", "19");
            part.getAttribute("4.1.2.1").setUndefinedValue("6", "7", "8", "9", "10", "11", "12", "17", "18", "19");

            part.getValue().summarizeDependentValues(RCB_SU_EXACT);

            m_protocol.printReportLineNumber("1");
            calculateAttribute1  (part.getAttribute("1"));

            m_protocol.printReportLineNumber("2");
            calculateAttribute2  (part.getAttribute("2"));

            m_protocol.printReportLineNumber("3");
            calculateAttribute3  (part.getAttribute("3"));

            m_protocol.printReportLineNumber("4.1");
            calculateAttribute4_1    (part.getAttribute("4.1"));
            m_protocol.printReportLineNumber("4");
            calculateAttribute4      (part.getAttribute("4"));
        end;
    end;

    constructor(dataSource, tuneTable, protocol, report);
end;



/**
 *  Расчет переменных по 2332-У.
 *
 */
class (TCalculationPart1Controller2061) TCalculationPart1Controller2332(dataSource, tuneTable, protocol, report)
    initTCalculationPart1Controller2061(dataSource, tuneTable, protocol, report);

    /*1.2*/
    private macro calculateAttribute1_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter,
                                                   ADD_AC_DEBT),
                     BOCB);
    end;

    /*1.8*/
    private macro calculateAttribute1_8(attribute)
        /*1.8_кредит*/
        setAccountMasks(attribute.getName() + "_кредит");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isPercentAccounts(),
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);
        /* + 1.8_цб*/
        setAccountMasks(attribute.getName() + "_цб");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'П/Д'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isBank(),
                                                  overdueAccountFilter,
                                                  ADD_AC_ACCRUED_INTEREST),
                     BOCB);
        /* + 1.8_УВ*/
        setAccountMasks(attribute.getName() + "_УВ");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'П/Д'", RCB_OBJGROUP_ACTIVEKIND),
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

        /* + 1.8_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                    /*учет принадлежит ли счет портфелю не нужен,
                      т.к. резерв сразу расчитывается как часть резерва портфеля
                      или берется полная сумма резерва, если счет не в портфеле*/
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isBank(),
                                                   overdueAccountFilter,
                                                   false),/*не учитывать просрочку в требованиях*/
                     BOCB);

        setLineUserValue(attribute);
    end;

    /*2.1*/
    private macro calculateAttribute2_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                   accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter,
                                                   ADD_AC_DEBT),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);
    end;

    /*2.7*/
    private macro calculateAttribute2_7(attribute)
        /*+ 2.7_кредит*/
        setAccountMasks(attribute.getName() + "_кредит");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isPercentAccounts(),
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);
        /*+ 2.7_цб*/
        setAccountMasks(attribute.getName() + "_цб");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'П/Д'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isNotBank(),
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);
        /*+ 2.7_УВ*/
        setAccountMasks(attribute.getName() + "_УВ");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'П/Д'", RCB_OBJGROUP_ACTIVEKIND),
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

        /* + 2.7_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                    /*учет принадлежит ли счет портфелю не нужен,
                      т.к. резерв сразу расчитывается как часть резерва портфеля
                      или берется полная сумма резерва, если счет не в портфеле*/
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson(),
                                                   overdueAccountFilter,
                                                   false),/*не учитывать просрочку в требованиях*/
                     BOCB);

        setAccountMasks(attribute.getName());

        setLineValue(attribute,
                     m_loansCreditDataSource.getPercentRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
         setLineUserValue(attribute);
     end;


    /*2.8*/
    private macro calculateAttribute2_8(attribute)
        /* + 2.8*/
        setAccountMasks("2.1", "2.3", "2.5");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().isEmployer(),
                                                   overdueAccountFilter),
                     BOCB);

        setAccountMasks("2.2");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'В'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().isEmployer(),
                                                  overdueAccountFilter),
                     BOCB);


        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", "2.1",  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + m_loansCreditDataSource.getFilter().contragentIsEmployer(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", "2.1", BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", "2.1", BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", "2.1", BOLoans))
                                                        ),
                     BOLoans);
     end;

    /*3.1*/
    private macro calculateAttribute3_1(attribute)
        setAccountMasks(attribute.getName());

        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Покупка'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter,
                                                   ADD_AC_DEBT),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("Ж"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                         ),
                     BOLoans);
    end;

    /*3.2*/
    private macro calculateAttribute3_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Ипотека'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter,
                                                   ADD_AC_DEBT),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("И"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
    end;

    /*3.3*/
    private macro calculateAttribute3_3(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Автокредит'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter,
                                                   ADD_AC_DEBT),
                      BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("А"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
    end;

    /*3.4*/
    private macro calculateAttribute3_4(attribute)
        /*+ 3.4_потр*/
        setAccountMasks(attribute.getName() + "_потр");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Потребительская ссуда'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter,
                                                   ADD_AC_DEBT),
                     BOCB);
        /*+ 3.4_овер*/
        setAccountMasks(attribute.getName() + "_овер");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                      accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD)
                                                      + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter,
                                                    ADD_AC_DEBT),
                     BOCB);

        /*3.4*/
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + "AND (   ( 1 = 1 "+m_loansCreditDataSource.getFilter().hasType(LO_KARTA)
                                                         + "        )"
                                                         + "     OR ( 1 = 1 "+m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         +             m_loansCreditDataSource.getFilter().hasAim("Н")
                                                         + "        )"
                                                         + "    )",
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /*3.5*/
    private macro calculateAttribute3_5(attribute)
        /*3.5*/
        setAccountMasks(attribute.getName() + "_хоз");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   overdueAccountFilter),
                     BOCB);

        /*3.5*/
        setAccountMasks(attribute.getName() + "_иное");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   overdueAccountFilter),
                     BOCB);


        setLineUserValue(attribute);
    end;


    /*3.6*/
    private macro calculateAttribute3_6(attribute)
        /*3.6_проц*/
        setAccountMasks(attribute.getName() + "_проц");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isPercentAccounts(),
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);
        /*+3.6_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isPhysicalPerson(),
                                                   overdueAccountFilter,
                                                   false),/*не учитывать просрочку в требованиях*/
                     BOCB);

        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getPercentRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);

         setLineUserValue(attribute);
    end;

    /*4.1.1*/
    private macro calculateAttribute4_1_1(attribute)
        setAccountMasks("1.2", "1.3", "1.5", "1.6",
                        "2.1", "2.2", "2.3", "2.4", "2.5",
                        "3.1", "3.2", "3.3", "3.4", "3.5");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.10'", RCB_OBJGROUP_FOR_REPORTING)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.10'"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);

    end;

    /*4.1.1.1*/
    private macro calculateAttribute4_1_1_1(attribute)
        setAccountMasks("1.2", "1.3", "1.5", "1.6",
                        "2.1", "2.2", "2.3", "2.4", "2.5",
                        "3.1", "3.2", "3.3", "3.4", "3.5");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.10'", RCB_OBJGROUP_FOR_REPORTING, global.parameters.getBeginDate())
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                                                                                      m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.10'", global.parameters.getBeginDate()),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /*4.1.2*/
    private macro calculateAttribute4_1_2(attribute)
        setAccountMasks("1.2", "1.3", "1.5", "1.6",
                        "2.1", "2.2", "2.3", "2.4", "2.5",
                        "3.1", "3.2", "3.3", "3.4", "3.5");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.14.3'", RCB_OBJGROUP_FOR_REPORTING)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.14.3'"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
     end;

    /*4.1.2.1*/
    private macro calculateAttribute4_1_2_1(attribute)
        setAccountMasks("1.2", "1.3", "1.5", "1.6",
                        "2.1", "2.2", "2.3", "2.4", "2.5",
                        "3.1", "3.2", "3.3", "3.4", "3.5");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.14.3'", RCB_OBJGROUP_FOR_REPORTING, global.parameters.getBeginDate())
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.14.3'", global.parameters.getBeginDate()),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(masksMerger(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans),
                                                                                                                         m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;




    macro calculate(part : TPart)

        if (part.getNumber() == 1)
            m_protocol.printReportLineNumber("1.1");
            calculateAttribute1_1(part.getAttribute("1.1"));
            m_protocol.printReportLineNumber("1.2");
            calculateAttribute1_2(part.getAttribute("1.2"));
            m_protocol.printReportLineNumber("1.3");
            calculateAttribute1_3(part.getAttribute("1.3"));
            m_protocol.printReportLineNumber("1.4");
            calculateAttribute1_4(part.getAttribute("1.4"));
            m_protocol.printReportLineNumber("1.5");
            calculateAttribute1_5(part.getAttribute("1.5"));
            m_protocol.printReportLineNumber("1.6");
            calculateAttribute1_6(part.getAttribute("1.6"));
            m_protocol.printReportLineNumber("1.7");
            calculateAttribute1_7(part.getAttribute("1.7"));
            m_protocol.printReportLineNumber("1.8");
            calculateAttribute1_8(part.getAttribute("1.8"));

            m_protocol.printReportLineNumber("2.1");
            calculateAttribute2_1(part.getAttribute("2.1"));
            m_protocol.printReportLineNumber("2.2");
            calculateAttribute2_2(part.getAttribute("2.2"));
            m_protocol.printReportLineNumber("2.3");
            calculateAttribute2_3(part.getAttribute("2.3"));
            m_protocol.printReportLineNumber("2.4");
            calculateAttribute2_4(part.getAttribute("2.4"));
            m_protocol.printReportLineNumber("2.5");
            calculateAttribute2_5(part.getAttribute("2.5"));
            m_protocol.printReportLineNumber("2.6");
            calculateAttribute2_6(part.getAttribute("2.6"));
            m_protocol.printReportLineNumber("2.7");
            calculateAttribute2_7(part.getAttribute("2.7"));
            m_protocol.printReportLineNumber("2.8");
            calculateAttribute2_8(part.getAttribute("2.8"));


            m_protocol.printReportLineNumber("3.1");
            calculateAttribute3_1(part.getAttribute("3.1"));
            m_protocol.printReportLineNumber("3.2");
            calculateAttribute3_2(part.getAttribute("3.2"));
            m_protocol.printReportLineNumber("3.3");
            calculateAttribute3_3(part.getAttribute("3.3"));
            m_protocol.printReportLineNumber("3.4");
            calculateAttribute3_4(part.getAttribute("3.4"));
            m_protocol.printReportLineNumber("3.5");
            calculateAttribute3_5(part.getAttribute("3.5"));
            m_protocol.printReportLineNumber("3.6");
            calculateAttribute3_6(part.getAttribute("3.6"));

            m_protocol.printReportLineNumber("4.1.1.1");
            calculateAttribute4_1_1_1(part.getAttribute("4.1.1.1"));
            m_protocol.printReportLineNumber("4.1.1");
            calculateAttribute4_1_1  (part.getAttribute("4.1.1"));
            m_protocol.printReportLineNumber("4.1.2.1");
            calculateAttribute4_1_2_1(part.getAttribute("4.1.2.1"));
            m_protocol.printReportLineNumber("4.1.2");
            calculateAttribute4_1_2  (part.getAttribute("4.1.2"));

            /*это переменные, которые не должны были расчитываться*/
            part.getAttribute("1.1").setUndefinedValue(  "9", "10",  "11", "12",  "14");
            part.getAttribute("1.8").setUndefinedValue( "13", "14");
            part.getAttribute("2.7").setUndefinedValue( "13", "14");
            part.getAttribute("3.6").setUndefinedValue( "13", "14");

            part.getAttribute("4.1.1.1").setUndefinedValue("8", "12", "19");
            part.getAttribute("4.1.2.1").setUndefinedValue("8", "12", "19");

            part.getValue().summarizeDependentValues(RCB_SU_EXACT);

            m_protocol.printReportLineNumber("1");
            calculateAttribute1  (part.getAttribute("1"));

            m_protocol.printReportLineNumber("2");
            calculateAttribute2  (part.getAttribute("2"));

            m_protocol.printReportLineNumber("3");
            calculateAttribute3  (part.getAttribute("3"));

            m_protocol.printReportLineNumber("4.1");
            calculateAttribute4_1    (part.getAttribute("4.1"));
            m_protocol.printReportLineNumber("4");
            calculateAttribute4      (part.getAttribute("4"));
        end;
    end;
end;


/**
 *  Расчет переменных по 2539-У.
 *  !!!переопределины абсолютно все функции
 */
class (TCalculationPart1Controller2332) TCalculationPart1Controller2539(dataSource, tuneTable, protocol, report)
    initTCalculationPart1Controller2332(dataSource, tuneTable, protocol, report);

    /**
     *
     */
    private macro setAccountMasks(line : String)
        var accountMasks        = m_tuneTable.getAccountMasks("1", line,  BOCB);
        var overdueAccountMasks = m_tuneTable.getDelayAccountMasks("1", line, BOCB);

        var temp;
        var i = 2;
        while (GetParm(i, temp))
            accountMasks        = masksMerger(accountMasks,        m_tuneTable.getAccountMasks("1", temp, BOCB));
            overdueAccountMasks = masksMerger(overdueAccountMasks, m_tuneTable.getDelayAccountMasks("1", temp, BOCB));
            i = i + 1;
        end;

        termAccountFilter    = m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(accountMasks);
        overdueAccountFilter = m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(overdueAccountMasks);

        accountFilter        = m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks(masksMerger(overdueAccountMasks, accountMasks));

/*!!!! исправить*/
        hasDataLoansFilter   = m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", line,  BOLoans));
    end;


    /*1.1*/
    private macro calculateAttribute1_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                   m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                    BOCB);
    end;

    /*1.2*/
    private macro calculateAttribute1_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);
    end;

    /*1.3*/
    private macro calculateAttribute1_3(attribute)
        setLineUserValue(attribute);
    end;

    /*1.4*/
    private macro calculateAttribute1_4(attribute)
        setLineUserValue(attribute);
    end;

    /*1.5*/
    private macro calculateAttribute1_5(attribute)
        setLineUserValue(attribute);
    end;

    /*1.6*/
    private macro calculateAttribute1_6(attribute)
        setLineUserValue(attribute);
    end;

    /*1.7*/
    private macro calculateAttribute1_7(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   null,
                                                   true/*не учитывать просрочку в требованиях*/
                                                   ),
                     BOCB);
        setLineUserValue(attribute);
    end;


    /*1.8*/
    private macro calculateAttribute1_8(attribute)
        /*1.8_проц*/
        setAccountMasks("1.1");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                   m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                    BOCB);

        setAccountMasks("1.2");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                    BOCB);

        setAccountMasks("1.7");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST,
                                                   true/*не учитывать просрочку в требованиях*/
                                                   ),
                    BOCB);

        /* + 1.8_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                    /*учет принадлежит ли счет портфелю не нужен,
                      т.к. резерв сразу расчитывается как часть резерва портфеля
                      или берется полная сумма резерва, если счет не в портфеле*/
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isBank(),
                                                   overdueAccountFilter
                                                                    ),
                     BOCB);

        setLineUserValue(attribute);
    end;

    /*2.1*/
    private macro calculateAttribute2_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedContragentCategory(RCB_OBJGROUP_PT_EMPLOYER, "'МСП'"),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + m_loansCreditDataSource.getFilter().contragentIsNotEmployer(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);

    end;

    /*2.2*/
    private macro calculateAttribute2_2(attribute)
        setLineUserValue(attribute);
    end;

    /*2.3*/
    private macro calculateAttribute2_3(attribute)
        setLineUserValue(attribute);
    end;

    /*2.4*/
    private macro calculateAttribute2_4(attribute)
        setLineUserValue(attribute);
    end;

    /*2.5*/
    private macro calculateAttribute2_5(attribute)
        setLineUserValue(attribute);
    end;

    /*2.6*/
    private macro calculateAttribute2_6(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isJuridicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedContragentCategory(RCB_OBJGROUP_PT_EMPLOYER, "'МСП'")
                                                   ,
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   null,
                                                   true/*учитывать просрочку в требованиях*/
                                                   ),
                     BOCB);
        setLineUserValue(attribute);
    end;

    /*2.7*/
    private macro calculateAttribute2_7(attribute)
        /*+ 2.7_проц*/
        setAccountMasks("2.1");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

        setAccountMasks("2.6");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isJuridicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST,
                                                   true/*учитывать просрочку в требованиях*/
                                                   ),
                     BOCB);

        setAccountMasks("2.8");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'П/Д'", RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

        /* + 2.7_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                    /*учет принадлежит ли счет портфелю не нужен,
                      т.к. резерв сразу расчитывается как часть резерва портфеля
                      или берется полная сумма резерва, если счет не в портфеле*/
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson(),
                                                   overdueAccountFilter),
                     BOCB);

        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getPercentRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);

         setLineUserValue(attribute);
     end;

    /*2.8*/
    private macro calculateAttribute2_8(attribute)
        /* 2.8*/
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().isEmployer(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineUserValue(attribute, "2.8.1");


        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + m_loansCreditDataSource.getFilter().contragentIsEmployer(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", "2.8", BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", "2.8", BOLoans))
                                                        ),
                     BOLoans);
     end;

    /*2.8.1*/
    private macro calculateAttribute2_8_1(attribute)
        setLineUserValue(attribute);
    end;

    /*3.1*/
    private macro calculateAttribute3_1(attribute)
        setAccountMasks(attribute.getName());

        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Покупка','Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isNotRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("Ж,И,З")
                                                         + m_loansCreditDataSource.getFilter().isNotRegisteredHypothec(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                         ),
                     BOLoans);
    end;

    /*3.2*/
    private macro calculateAttribute3_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("И,З")
                                                         + m_loansCreditDataSource.getFilter().isRegisteredHypothec(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
    end;

    /*3.3*/
    private macro calculateAttribute3_3(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Автокредит'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                      BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("А"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
    end;

    /*3.4*/
    private macro calculateAttribute3_4(attribute)
        /*+ 3.4_потр*/
        setAccountMasks(attribute.getName() + "_потр");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Потребительская ссуда'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        /*+ 3.4_овер*/
        setAccountMasks(attribute.getName() + "_овер");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                    "AND ( (1 = 1 " + termAccountFilter
                                                                     + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD)
                                                   + "     ) OR   "
                                                   + "     (1 = 1 " + overdueAccountFilter
                                                                    + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Овердрафт'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + "     )      "
                                                   + "   )        "
                                                      + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);



        /*3.4*/
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + "AND (   ( 1 = 1 "+m_loansCreditDataSource.getFilter().hasType(LO_KARTA)
                                                         + "        )"
                                                         + "     OR ( 1 = 1 "+m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         +             m_loansCreditDataSource.getFilter().hasAim("Н")
                                                         + "        )"
                                                         + "    )",
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /*3.5*/
    private macro calculateAttribute3_5(attribute)
        /*3.5*/
        setAccountMasks(attribute.getName() + "_хоз");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Предоплата ценностей','Недостача'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);


        /*3.5*/
        setAccountMasks(attribute.getName() + "_иное");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   null,
                                                   true/*учитывать просрочку в требованиях*/
                                                   ),
                     BOCB);


        setLineUserValue(attribute);
    end;

    /*3.6*/
    private macro calculateAttribute3_6(attribute)

        /*3.1*/
        setAccountMasks("3.1");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Покупка','Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isNotRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

        /*3.2*/
        setAccountMasks("3.2");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

         /*3.3*/
        setAccountMasks("3.3");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Автокредит'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                      BOCB);

        /*+ 3.4_потр*/
        setAccountMasks("3.4_потр");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Потребительская ссуда'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

        /*+ 3.4_овер*/
        setAccountMasks("3.4_овер");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                    "AND ( (1 = 1 " + termAccountFilter
                                                                     + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD)
                                                   + "     ) OR   "
                                                   + "     (1 = 1 " + overdueAccountFilter
                                                                    + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Овердрафт'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + "     )      "
                                                   + "   )        "
                                                      + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);


        /*3.5*/
        setAccountMasks("3.5_хоз");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Предоплата ценностей','Недостача'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

        /*3.5*/
        setAccountMasks("3.5_иное");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

        /*+3.6_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isPhysicalPerson(),
                                                   overdueAccountFilter),
                     BOCB);

        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getPercentRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);

         setLineUserValue(attribute);
    end;

    /*4.1.1*/
    private macro calculateAttribute4_1_1(attribute)
        setAccountMasks("1.2",
                        "2.1",
                        "3.1", "3.2", "3.3", "3.4_потр", "3.4_овер", "3.5_хоз", "3.5_иное");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.10'", RCB_OBJGROUP_FOR_REPORTING)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.10'"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);

    end;

    /*4.1.1.1*/
    private macro calculateAttribute4_1_1_1(attribute)
        setAccountMasks("1.2",
                        "2.1",
                        "3.1", "3.2", "3.3", "3.4_потр", "3.4_овер", "3.5_хоз", "3.5_иное");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.10'", RCB_OBJGROUP_FOR_REPORTING, global.parameters.getBeginDate())
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.10'", global.parameters.getBeginDate()),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /*4.1.2*/
    private macro calculateAttribute4_1_2(attribute)
        setAccountMasks("1.2",
                        "2.1",
                        "3.1", "3.2", "3.3", "3.4_потр", "3.4_овер", "3.5_хоз", "3.5_иное");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.14.3'", RCB_OBJGROUP_FOR_REPORTING)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.14.3'"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
     end;

    /*4.1.2.1*/
    private macro calculateAttribute4_1_2_1(attribute)
        setAccountMasks("1.2",
                        "2.1",
                        "3.1", "3.2", "3.3", "3.4_потр", "3.4_овер", "3.5_хоз", "3.5_иное");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.14.3'", RCB_OBJGROUP_FOR_REPORTING, global.parameters.getBeginDate())
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.14.3'", global.parameters.getBeginDate()),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /*2*/
    private macro calculateAttribute2(attribute)
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.1"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.2"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.3"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.4"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.5"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.6"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.7"));
        addAttribute(attribute, m_report.getPart("1").getAttribute("2.8"));
    end;

    macro calculate(part : TPart)

        if (part.getNumber() == 1)
            m_protocol.printReportLineNumber("1.1");
            calculateAttribute1_1(part.getAttribute("1.1"));
            m_protocol.printReportLineNumber("1.2");
            calculateAttribute1_2(part.getAttribute("1.2"));
            m_protocol.printReportLineNumber("1.3");
            calculateAttribute1_3(part.getAttribute("1.3"));
            m_protocol.printReportLineNumber("1.4");
            calculateAttribute1_4(part.getAttribute("1.4"));
            m_protocol.printReportLineNumber("1.5");
            calculateAttribute1_5(part.getAttribute("1.5"));
            m_protocol.printReportLineNumber("1.6");
            calculateAttribute1_6(part.getAttribute("1.6"));
            m_protocol.printReportLineNumber("1.7");
            calculateAttribute1_7(part.getAttribute("1.7"));
            m_protocol.printReportLineNumber("1.8");
            calculateAttribute1_8(part.getAttribute("1.8"));

            m_protocol.printReportLineNumber("2.1");
            calculateAttribute2_1(part.getAttribute("2.1"));
            m_protocol.printReportLineNumber("2.2");
            calculateAttribute2_2(part.getAttribute("2.2"));
            m_protocol.printReportLineNumber("2.3");
            calculateAttribute2_3(part.getAttribute("2.3"));
            m_protocol.printReportLineNumber("2.4");
            calculateAttribute2_4(part.getAttribute("2.4"));
            m_protocol.printReportLineNumber("2.5");
            calculateAttribute2_5(part.getAttribute("2.5"));
            m_protocol.printReportLineNumber("2.6");
            calculateAttribute2_6(part.getAttribute("2.6"));
            m_protocol.printReportLineNumber("2.7");
            calculateAttribute2_7(part.getAttribute("2.7"));
            m_protocol.printReportLineNumber("2.8");
            calculateAttribute2_8(part.getAttribute("2.8"));
            m_protocol.printReportLineNumber("2.8.1");
            calculateAttribute2_8_1(part.getAttribute("2.8.1"));


            m_protocol.printReportLineNumber("3.1");
            calculateAttribute3_1(part.getAttribute("3.1"));
            m_protocol.printReportLineNumber("3.2");
            calculateAttribute3_2(part.getAttribute("3.2"));
            m_protocol.printReportLineNumber("3.3");
            calculateAttribute3_3(part.getAttribute("3.3"));
            m_protocol.printReportLineNumber("3.4");
            calculateAttribute3_4(part.getAttribute("3.4"));
            m_protocol.printReportLineNumber("3.5");
            calculateAttribute3_5(part.getAttribute("3.5"));
            m_protocol.printReportLineNumber("3.6");
            calculateAttribute3_6(part.getAttribute("3.6"));

            m_protocol.printReportLineNumber("4.1.1.1");
            calculateAttribute4_1_1_1(part.getAttribute("4.1.1.1"));
            m_protocol.printReportLineNumber("4.1.1");
            calculateAttribute4_1_1  (part.getAttribute("4.1.1"));
            m_protocol.printReportLineNumber("4.1.2.1");
            calculateAttribute4_1_2_1(part.getAttribute("4.1.2.1"));
            m_protocol.printReportLineNumber("4.1.2");
            calculateAttribute4_1_2  (part.getAttribute("4.1.2"));

            /*это переменные, которые не должны были расчитываться*/
            part.getAttribute("1.1").setUndefinedValue(  "9", "10",  "11", "12",  "14");
            part.getAttribute("1.8").setUndefinedValue( "13", "14");
            part.getAttribute("2.7").setUndefinedValue( "13", "14");
            part.getAttribute("3.6").setUndefinedValue( "13", "14");

            part.getAttribute("4.1.1.1").setUndefinedValue("8", "12", "19");
            part.getAttribute("4.1.2.1").setUndefinedValue("8", "12", "19");

            part.getValue().summarizeDependentValues(RCB_SU_EXACT);

            m_protocol.printReportLineNumber("1");
            calculateAttribute1  (part.getAttribute("1"));

            m_protocol.printReportLineNumber("2");
            calculateAttribute2  (part.getAttribute("2"));

            m_protocol.printReportLineNumber("3");
            calculateAttribute3  (part.getAttribute("3"));

            m_protocol.printReportLineNumber("4.1");
            calculateAttribute4_1    (part.getAttribute("4.1"));
            m_protocol.printReportLineNumber("4");
            calculateAttribute4      (part.getAttribute("4"));
        end;
    end;
end;

/**
 * Расчет переменных по 2627-У
 */
class (TCalculationPart1Controller2539) TCalculationPart1Controller2627(dataSource, tuneTable, protocol, report)
    initTCalculationPart1Controller2539(dataSource, tuneTable, protocol, report);

    /*1.5*/
    private macro calculateAttribute1_5(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                   accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Отсрочка'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_NONE,
                                                   false),
                     BOCB);
    end;

    /*2.3*/
    private macro calculateAttribute2_3(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Отсрочка'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + " AND ((1=1" +  m_cbAccountsDataSource.getFilter().isJuridicalPerson() + ") AND (1=1 " +  m_cbAccountsDataSource.getFilter().isNotBank() +  "))"
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_NONE,
                                                   false
                                                   ),
                     BOCB);
    end;

    /*3.5*/
    private macro calculateAttribute3_5(attribute)
        /*3.5*/
        setAccountMasks(attribute.getName() + "_хоз");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Предоплата ценностей','Недостача','Отсрочка'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);


        /*3.5*/
        setAccountMasks(attribute.getName() + "_иное");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   null,
                                                   true/*учитывать просрочку в требованиях*/
                                                   ),
                     BOCB);


        setLineUserValue(attribute);
    end;
end;

/**
 *  Расчет переменных по 2742-У.
 */
class (TCalculationPart1Controller2627) TCalculationPart1Controller2742(dataSource, tuneTable, protocol, report)
    initTCalculationPart1Controller2627(dataSource, tuneTable, protocol, report);

    /* 1.5 */
    private macro calculateAttribute1_5(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                   accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Отсрочка'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);
    end;

    /*1.7*/
    private macro calculateAttribute1_7(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);
        setLineUserValue(attribute);
    end;

    /*1.7.1*/
    private macro calculateAttribute1_7_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);
        setLineUserValue(attribute);
    end;

    /*2.1*/
    private macro calculateAttribute2_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedContragentCategory(RCB_OBJGROUP_PT_EMPLOYER, "'МСП'"),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + m_loansCreditDataSource.getFilter().contragentIsNotEmployer()
                                                         + m_loansCreditDataSource.getFilter().isNotExistsRightsOfClaimContractId(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);

    end;

    /*2.3*/
    private macro calculateAttribute2_3(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Отсрочка'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + " AND (((1=1" +  m_cbAccountsDataSource.getFilter().isJuridicalPerson() + ") AND (1=1 " +  m_cbAccountsDataSource.getFilter().isNotBank() +  ")) OR (1=1 " +  m_cbAccountsDataSource.getFilter().isEmployer()+  "))"
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter
                                                   ),
                     BOCB);
     end;

    /*2.6*/
    private macro calculateAttribute2_6(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     " AND ((1=1" +  m_cbAccountsDataSource.getFilter().isJuridicalPerson() + ") OR (1=1 " +  m_cbAccountsDataSource.getFilter().isEmployer()+  "))"
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + m_loansCreditDataSource.getFilter().isExistsRightsOfClaimContractId(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);

        addLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + " AND " + m_loansCreditDataSource.getFilter().hasAccount("60315*", true),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);
        setLineUserValue(attribute);
    end;

    /*2.6.1*/
    private macro calculateAttribute2_6_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     " AND ((1=1" +  m_cbAccountsDataSource.getFilter().isJuridicalPerson() + ") OR (1=1" +  m_cbAccountsDataSource.getFilter().isEmployer()+  "))"
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   ,
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + m_loansCreditDataSource.getFilter().isExistsRightsOfClaimContractId(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);

        addLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + " AND " + m_loansCreditDataSource.getFilter().hasAccount("60315*", true),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);
        setLineUserValue(attribute);
    end;

    /*2.7*/
    private macro calculateAttribute2_7(attribute)
        /*+ 2.7_проц*/
        setAccountMasks("2.1");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getPercentRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Кредит'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedContragentCategory(RCB_OBJGROUP_PT_EMPLOYER, "'МСП'"),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setAccountMasks("2.6");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getPercentRequirementsData(
                                                     " AND ((1=1" +  m_cbAccountsDataSource.getFilter().isJuridicalPerson() + m_cbAccountsDataSource.getFilter().isNotBank() + " ) OR (1=1 " +  m_cbAccountsDataSource.getFilter().isEmployer()+  "))"
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + "AND ("
                                                   + "       ( " + m_cbAccountsDataSource.getFilter().isSatisfiesToMasks("acc.t_account", "60401*") + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'ОС в аренде'", RCB_OBJGROUP_ACTIVEKIND) + ")"
                                                   + "    OR ( NOT " + m_cbAccountsDataSource.getFilter().isSatisfiesToMasks("acc.t_account", "60401*") + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND) + ")"
                                                   + "    )",
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setAccountMasks("2.8");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getPercentRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().isEmployer(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        /* + 2.7_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                    /*учет принадлежит ли счет портфелю не нужен,
                      т.к. резерв сразу расчитывается как часть резерва портфеля
                      или берется полная сумма резерва, если счет не в портфеле*/
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isJuridicalPerson(),
                                                   overdueAccountFilter
                                                   ),
                     BOCB);

        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getPercentRequirementsData(
                                                           hasDataLoansFilter
                                                         + " AND ((1=1" + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + "     )OR (" + m_loansCreditDataSource.getFilter().hasAccount("60315*", true)
                                                                        + m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE) + "))"
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);

         setLineUserValue(attribute);
     end;

    /*2.8*/
    private macro calculateAttribute2_8(attribute)
        /* 2.8*/
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().isEmployer(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineUserValue(attribute, "2.8.1");

        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + m_loansCreditDataSource.getFilter().isNotExistsRightsOfClaimContractId()
                                                         + m_loansCreditDataSource.getFilter().contragentIsEmployer(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", "2.8", BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", "2.8", BOLoans))
                                                        ),
                     BOLoans);
     end;

    /*3.1*/
    private macro calculateAttribute3_1(attribute)
        setAccountMasks(attribute.getName());

        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Покупка','Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isNotRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("Ж,И,З")
                                                         + m_loansCreditDataSource.getFilter().isNotExistsRightsOfClaimContractId()
                                                         + m_loansCreditDataSource.getFilter().isNotRegisteredHypothec(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                         ),
                     BOLoans);
    end;

    /*3.2*/
    private macro calculateAttribute3_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("И,З")
                                                         + m_loansCreditDataSource.getFilter().isNotExistsRightsOfClaimContractId()
                                                         + m_loansCreditDataSource.getFilter().isRegisteredHypothec(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
    end;

    /*3.3*/
    private macro calculateAttribute3_3(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Автокредит'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                      BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().isNotExistsRightsOfClaimContractId()
                                                         + m_loansCreditDataSource.getFilter().hasAim("А"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
    end;

    /*3.4*/
    private macro calculateAttribute3_4(attribute)
        /*+ 3.4_потр*/
        setAccountMasks(attribute.getName() + "_потр");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Потребительская ссуда'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        /*+ 3.4_овер*/
        setAccountMasks(attribute.getName() + "_овер");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                    "AND ( (1 = 1 " + termAccountFilter
                                                                     + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD)
                                                   + "     ) OR   "
                                                   + "     (1 = 1 " + overdueAccountFilter
                                                                    + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Овердрафт'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + "     )      "
                                                   + "   )        "
                                                      + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        /*3.4*/
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().isNotExistsRightsOfClaimContractId()
                                                         + "AND (   ( 1 = 1 "+m_loansCreditDataSource.getFilter().hasType(LO_KARTA)
                                                         + "        )"
                                                         + "     OR ( 1 = 1 "+m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         +             m_loansCreditDataSource.getFilter().hasAim("Н")
                                                         + "        )"
                                                         + "    )",
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /*3.5*/
    private macro calculateAttribute3_5(attribute)
        /*3.5*/
        setAccountMasks(attribute.getName() + "_хоз");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     "AND (   (1=1 " + m_cbAccountsDataSource.getFilter().isPhysicalPerson() + ")"
                                                   + "     OR (    1=1" + m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks("60323*")
                                                   + "         " + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Недостача'", RCB_OBJGROUP_ACTIVEKIND) + "))"
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Предоплата ценностей','Недостача','Отсрочка'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        /*3.5*/
        setAccountMasks(attribute.getName() + "_иное");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        /*3.5*/
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().isExistsRightsOfClaimContractId(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);

        setAccountMasks(attribute.getName());
        addLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + " AND" + m_loansCreditDataSource.getFilter().hasAccount("60315*", true),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);

        setLineUserValue(attribute);
    end;

    /*3.5.1*/
    private macro calculateAttribute3_5_1(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        /*3.5.1*/
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().isExistsRightsOfClaimContractId(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);

        setAccountMasks(attribute.getName());
        addLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + " AND" + m_loansCreditDataSource.getFilter().hasAccount("60315*", true),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);


        setLineUserValue(attribute);
    end;

    /*3.6*/
    private macro calculateAttribute3_6(attribute)

        /*3.1*/
        setAccountMasks("3.1");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Покупка','Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isNotRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

        /*3.2*/
        setAccountMasks("3.2");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST),
                     BOCB);

         /*3.3*/
        setAccountMasks("3.3");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Автокредит'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST
                                                   ),
                      BOCB);

        /*+ 3.4_потр*/
        setAccountMasks("3.4_потр");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Потребительская ссуда'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST
                                                   ),
                     BOCB);

        /*+ 3.4_овер*/
        setAccountMasks("3.4_овер");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                    "AND ( (1 = 1 " + termAccountFilter
                                                                     + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD)
                                                   + "     ) OR   "
                                                   + "     (1 = 1 " + overdueAccountFilter
                                                                    + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Овердрафт'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + "     )      "
                                                   + "   )        "
                                                      + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter,
                                                   ADD_AC_ACCRUED_INTEREST
                                                   ),
                     BOCB);

        /*3.5*/
        setAccountMasks(attribute.getName() + "_хоз");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     "AND (   (1=1 " + m_cbAccountsDataSource.getFilter().isPhysicalPerson() + ")"
                                                   + "     OR (    1=1" + m_cbAccountsDataSource.getFilter().isSatisfiesToAccountMasks("60323*")
                                                   + "         " + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Недостача'", RCB_OBJGROUP_ACTIVEKIND) + "))"
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Предоплата ценностей','Недостача','Отсрочка'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_CLASSIFCRD),
                                                   termAccountFilter,
                                                   overdueAccountFilter
                                                   ),
                     BOCB);


        /*3.5*/
        setAccountMasks(attribute.getName() + "_иное");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isPhysicalPerson()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND),
                                                   termAccountFilter,
                                                   overdueAccountFilter
                                                   ),
                     BOCB);

        /*+3.6_комисс*/
        setAccountMasks(attribute.getName() + "_комисс");
        addLineValue(attribute,
                     m_cbAccountsDataSource.getOtherRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Комиссия'", RCB_OBJGROUP_ACTIVEKIND)
                                                   + m_cbAccountsDataSource.getFilter().isPhysicalPerson(),
                                                   overdueAccountFilter
                                                   ),
                     BOCB);

        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_loansCreditDataSource.getPercentRequirementsData(
                                                           hasDataLoansFilter
                                                         + " AND ((1=1" + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + "     )OR (" + m_loansCreditDataSource.getFilter().hasAccount("60315*", true)
                                                                        + m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE) + "))"
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);

         setLineUserValue(attribute);
    end;

    macro calculate(part : TPart)
        if (part.getNumber() == 1)
            m_protocol.printReportLineNumber("1.1");
            calculateAttribute1_1(part.getAttribute("1.1"));
            m_protocol.printReportLineNumber("1.2");
            calculateAttribute1_2(part.getAttribute("1.2"));
            m_protocol.printReportLineNumber("1.3");
            calculateAttribute1_3(part.getAttribute("1.3"));
            m_protocol.printReportLineNumber("1.4");
            calculateAttribute1_4(part.getAttribute("1.4"));
            m_protocol.printReportLineNumber("1.5");
            calculateAttribute1_5(part.getAttribute("1.5"));
            m_protocol.printReportLineNumber("1.6");
            calculateAttribute1_6(part.getAttribute("1.6"));
            m_protocol.printReportLineNumber("1.7");
            calculateAttribute1_7(part.getAttribute("1.7"));
            m_protocol.printReportLineNumber("1.7.1");
            calculateAttribute1_7_1(part.getAttribute("1.7.1"));
            m_protocol.printReportLineNumber("1.8");
            calculateAttribute1_8(part.getAttribute("1.8"));

            m_protocol.printReportLineNumber("2.1");
            calculateAttribute2_1(part.getAttribute("2.1"));
            m_protocol.printReportLineNumber("2.2");
            calculateAttribute2_2(part.getAttribute("2.2"));
            m_protocol.printReportLineNumber("2.3");
            calculateAttribute2_3(part.getAttribute("2.3"));
            m_protocol.printReportLineNumber("2.4");
            calculateAttribute2_4(part.getAttribute("2.4"));
            m_protocol.printReportLineNumber("2.5");
            calculateAttribute2_5(part.getAttribute("2.5"));
            m_protocol.printReportLineNumber("2.6");
            calculateAttribute2_6(part.getAttribute("2.6"));
            m_protocol.printReportLineNumber("2.6.1");
            calculateAttribute2_6_1(part.getAttribute("2.6.1"));
            m_protocol.printReportLineNumber("2.7");
            calculateAttribute2_7(part.getAttribute("2.7"));
            m_protocol.printReportLineNumber("2.8");
            calculateAttribute2_8(part.getAttribute("2.8"));
            m_protocol.printReportLineNumber("2.8.1");
            calculateAttribute2_8_1(part.getAttribute("2.8.1"));


            m_protocol.printReportLineNumber("3.1");
            calculateAttribute3_1(part.getAttribute("3.1"));
            m_protocol.printReportLineNumber("3.2");
            calculateAttribute3_2(part.getAttribute("3.2"));
            m_protocol.printReportLineNumber("3.3");
            calculateAttribute3_3(part.getAttribute("3.3"));
            m_protocol.printReportLineNumber("3.4");
            calculateAttribute3_4(part.getAttribute("3.4"));
            m_protocol.printReportLineNumber("3.5");
            calculateAttribute3_5(part.getAttribute("3.5"));
            m_protocol.printReportLineNumber("3.5.1");
            calculateAttribute3_5_1(part.getAttribute("3.5.1"));
            m_protocol.printReportLineNumber("3.6");
            calculateAttribute3_6(part.getAttribute("3.6"));

            m_protocol.printReportLineNumber("4.1.1.1");
            calculateAttribute4_1_1_1(part.getAttribute("4.1.1.1"));
            m_protocol.printReportLineNumber("4.1.1");
            calculateAttribute4_1_1  (part.getAttribute("4.1.1"));
            m_protocol.printReportLineNumber("4.1.2.1");
            calculateAttribute4_1_2_1(part.getAttribute("4.1.2.1"));
            m_protocol.printReportLineNumber("4.1.2");
            calculateAttribute4_1_2  (part.getAttribute("4.1.2"));

            /*это переменные, которые не должны были расчитываться*/
            part.getAttribute("1.1").setUndefinedValue(  "9", "10",  "11", "12",  "14");
            part.getAttribute("1.8").setUndefinedValue( "13", "14");
            part.getAttribute("2.7").setUndefinedValue( "13", "14");
            part.getAttribute("3.6").setUndefinedValue( "13", "14");

            part.getAttribute("4.1.1.1").setUndefinedValue("8", "12", "19");
            part.getAttribute("4.1.2.1").setUndefinedValue("8", "12", "19");

            part.getValue().summarizeDependentValues(RCB_SU_EXACT);

            m_protocol.printReportLineNumber("1");
            calculateAttribute1  (part.getAttribute("1"));

            m_protocol.printReportLineNumber("2");
            calculateAttribute2  (part.getAttribute("2"));

            m_protocol.printReportLineNumber("3");
            calculateAttribute3  (part.getAttribute("3"));

            m_protocol.printReportLineNumber("4.1");
            calculateAttribute4_1    (part.getAttribute("4.1"));
            m_protocol.printReportLineNumber("4");
            calculateAttribute4      (part.getAttribute("4"));
        end;
    end;
end;

class (TCalculationPart1Controller2742) TCalculationPart1Controller3006(dataSource, tuneTable, protocol, report)
    initTCalculationPart1Controller2742(dataSource, tuneTable, protocol, report);

    /*1.7*/
    private macro calculateAttribute1_7(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().isBank()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + "AND ("
                                                   + "       ( " + m_cbAccountsDataSource.getFilter().isSatisfiesToMasks("acc.t_account", "60401*") + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'ОС в аренде'", RCB_OBJGROUP_ACTIVEKIND) + ")"
                                                   + "    OR ( (NOT " + m_cbAccountsDataSource.getFilter().isSatisfiesToMasks("acc.t_account", "60401*") + "AND NOT " + m_cbAccountsDataSource.getFilter().isSatisfiesToMasks("acc.t_account", "202*") + ")" + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND) + ")"
                                                   + "    OR ( " + m_cbAccountsDataSource.getFilter().isSatisfiesToMasks("acc.t_account", "202*") + m_cbAccountsDataSource.getFilter().hasAccountReserve() + ")"
                                                   + "    )",
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);
        setLineUserValue(attribute);
    end;

    /*2.6*/
    private macro calculateAttribute2_6(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     " AND ((1=1" +  m_cbAccountsDataSource.getFilter().isJuridicalPerson() + m_cbAccountsDataSource.getFilter().isNotBank() + " ) OR (1=1 " +  m_cbAccountsDataSource.getFilter().isEmployer()+  "))"
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase()
                                                   + "AND ("
                                                   + "       ( " + m_cbAccountsDataSource.getFilter().isSatisfiesToMasks("acc.t_account", "60401*") + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'ОС в аренде'", RCB_OBJGROUP_ACTIVEKIND) + ")"
                                                   + "    OR ( NOT " + m_cbAccountsDataSource.getFilter().isSatisfiesToMasks("acc.t_account", "60401*") + m_cbAccountsDataSource.getFilter().hasNotAssignedAccountCategory(RCB_OBJGROUP_ACTIVEKIND) + ")"
                                                   + "    )",
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + m_loansCreditDataSource.getFilter().isExistsRightsOfClaimContractId(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);

        addLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_GUARANTEE)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_INST)
                                                         + " AND " + m_loansCreditDataSource.getFilter().hasAccount("60315*", true),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                           ),
                     BOLoans);

        setLineUserValue(attribute);
    end;
end;

/**
 * Контроллер разсчета первого раздела. Указание 3129.
 */
class (TCalculationPart1Controller3006) TCalculationPart1Controller3129(dataSource, tuneTable, protocol, report)
    /**
     * Конструктор базового класса.
     */
    initTCalculationPart1Controller3006(dataSource, tuneTable, protocol, report);

    /*4.1.3*/
    private macro calculateAttribute4_1_3(attribute)
        setAccountMasks("1.2", "1.5",
                        "2.1", "2.3",
                        "3.1", "3.2", "3.3", "3.4_потр", "3.4_овер", "3.5_хоз", "3.5_иное");

        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.12.3'", RCB_OBJGROUP_FOR_REPORTING)
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.12.3'"),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
     end;

    /*4.1.3.1*/
    private macro calculateAttribute4_1_3_1(attribute)
        setAccountMasks("1.2", "1.5",
                        "2.1", "2.3",
                        "3.1", "3.2", "3.3", "3.4_потр", "3.4_овер", "3.5_хоз", "3.5_иное");
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'3.12.3'", RCB_OBJGROUP_FOR_REPORTING, global.parameters.getBeginDate())
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           m_loansCreditDataSource.getFilter().hasDataTuneTable(m_tuneTable.getRegisterNumber("1", attribute.getName(),  BOLoans))
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT, LO_OVERDRAFT, LO_KARTA)
                                                         + m_loansCreditDataSource.getFilter().hasHigherKks("'3.12.3'", global.parameters.getBeginDate()),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                                                               ),
                     BOLoans);
    end;

    /**
     * Расчет атрибутов.
     */
    macro calculate(part : TPart)

        if (part.getNumber() == 1)
            m_protocol.printReportLineNumber("1.1");
            calculateAttribute1_1(part.getAttribute("1.1"));
            m_protocol.printReportLineNumber("1.2");
            calculateAttribute1_2(part.getAttribute("1.2"));
            m_protocol.printReportLineNumber("1.3");
            calculateAttribute1_3(part.getAttribute("1.3"));
            m_protocol.printReportLineNumber("1.4");
            calculateAttribute1_4(part.getAttribute("1.4"));
            m_protocol.printReportLineNumber("1.5");
            calculateAttribute1_5(part.getAttribute("1.5"));
            m_protocol.printReportLineNumber("1.6");
            calculateAttribute1_6(part.getAttribute("1.6"));
            m_protocol.printReportLineNumber("1.7");
            calculateAttribute1_7(part.getAttribute("1.7"));
            m_protocol.printReportLineNumber("1.7.1");
            calculateAttribute1_7_1(part.getAttribute("1.7.1"));
            m_protocol.printReportLineNumber("1.8");
            calculateAttribute1_8(part.getAttribute("1.8"));

            m_protocol.printReportLineNumber("2.1");
            calculateAttribute2_1(part.getAttribute("2.1"));
            m_protocol.printReportLineNumber("2.2");
            calculateAttribute2_2(part.getAttribute("2.2"));
            m_protocol.printReportLineNumber("2.3");
            calculateAttribute2_3(part.getAttribute("2.3"));
            m_protocol.printReportLineNumber("2.4");
            calculateAttribute2_4(part.getAttribute("2.4"));
            m_protocol.printReportLineNumber("2.5");
            calculateAttribute2_5(part.getAttribute("2.5"));
            m_protocol.printReportLineNumber("2.6");
            calculateAttribute2_6(part.getAttribute("2.6"));
            m_protocol.printReportLineNumber("2.6.1");
            calculateAttribute2_6_1(part.getAttribute("2.6.1"));
            m_protocol.printReportLineNumber("2.7");
            calculateAttribute2_7(part.getAttribute("2.7"));
            m_protocol.printReportLineNumber("2.8");
            calculateAttribute2_8(part.getAttribute("2.8"));
            m_protocol.printReportLineNumber("2.8.1");
            calculateAttribute2_8_1(part.getAttribute("2.8.1"));

            m_protocol.printReportLineNumber("3.1");
            calculateAttribute3_1(part.getAttribute("3.1"));
            m_protocol.printReportLineNumber("3.2");
            calculateAttribute3_2(part.getAttribute("3.2"));
            m_protocol.printReportLineNumber("3.3");
            calculateAttribute3_3(part.getAttribute("3.3"));
            m_protocol.printReportLineNumber("3.4");
            calculateAttribute3_4(part.getAttribute("3.4"));
            m_protocol.printReportLineNumber("3.5");
            calculateAttribute3_5(part.getAttribute("3.5"));
            m_protocol.printReportLineNumber("3.5.1");
            calculateAttribute3_5_1(part.getAttribute("3.5.1"));
            m_protocol.printReportLineNumber("3.6");
            calculateAttribute3_6(part.getAttribute("3.6"));

            m_protocol.printReportLineNumber("4.1.1.1");
            calculateAttribute4_1_1_1(part.getAttribute("4.1.1.1"));
            m_protocol.printReportLineNumber("4.1.1");
            calculateAttribute4_1_1  (part.getAttribute("4.1.1"));
            m_protocol.printReportLineNumber("4.1.2.1");
            calculateAttribute4_1_2_1(part.getAttribute("4.1.2.1"));
            m_protocol.printReportLineNumber("4.1.2");
            calculateAttribute4_1_2  (part.getAttribute("4.1.2"));

            m_protocol.printReportLineNumber("4.1.3.1");
            calculateAttribute4_1_3_1(part.getAttribute("4.1.3.1"));
            m_protocol.printReportLineNumber("4.1.3");
            calculateAttribute4_1_3  (part.getAttribute("4.1.3"));

            /*это переменные, которые не должны были расчитываться*/
            part.getAttribute("1.1").setUndefinedValue(  "9", "10",  "11", "12",  "14");
            part.getAttribute("1.8").setUndefinedValue( "13", "14");
            part.getAttribute("2.7").setUndefinedValue( "13", "14");
            part.getAttribute("3.6").setUndefinedValue( "13", "14");

            part.getAttribute("4.1.1.1").setUndefinedValue("8", "12", "19");
            part.getAttribute("4.1.2.1").setUndefinedValue("8", "12", "19");

            part.getValue().summarizeDependentValues(RCB_SU_EXACT);

            m_protocol.printReportLineNumber("1");
            calculateAttribute1  (part.getAttribute("1"));

            m_protocol.printReportLineNumber("2");
            calculateAttribute2  (part.getAttribute("2"));

            m_protocol.printReportLineNumber("3");
            calculateAttribute3  (part.getAttribute("3"));

            m_protocol.printReportLineNumber("4.1");
            calculateAttribute4_1    (part.getAttribute("4.1"));
            m_protocol.printReportLineNumber("4");
            calculateAttribute4      (part.getAttribute("4"));
        end;
    end;
end;

class (TCalculationPart1Controller3129) TCalculationPart1Controller4212(dataSource, tuneTable, protocol, report)
    initTCalculationPart1Controller3129(dataSource, tuneTable, protocol, report);

    /*4.2*/
    private macro calculateAttribute4_2(attribute)
        setLineUserValue(attribute);
    end;

    /*4.2.1*/
    private macro calculateAttribute4_2_1(attribute)
        setLineUserValue(attribute);
    end;

    /*4.2.2*/
    private macro calculateAttribute4_2_2(attribute)
        setLineUserValue(attribute);
    end;

    macro calculate(part : TPart)
        if (part.getNumber() == 1)
            m_protocol.printReportLineNumber("1.1");
            calculateAttribute1_1(part.getAttribute("1.1"));
            m_protocol.printReportLineNumber("1.2");
            calculateAttribute1_2(part.getAttribute("1.2"));
            m_protocol.printReportLineNumber("1.3");
            calculateAttribute1_3(part.getAttribute("1.3"));
            m_protocol.printReportLineNumber("1.4");
            calculateAttribute1_4(part.getAttribute("1.4"));
            m_protocol.printReportLineNumber("1.5");
            calculateAttribute1_5(part.getAttribute("1.5"));
            m_protocol.printReportLineNumber("1.6");
            calculateAttribute1_6(part.getAttribute("1.6"));
            m_protocol.printReportLineNumber("1.7");
            calculateAttribute1_7(part.getAttribute("1.7"));
            m_protocol.printReportLineNumber("1.7.1");
            calculateAttribute1_7_1(part.getAttribute("1.7.1"));
            m_protocol.printReportLineNumber("1.8");
            calculateAttribute1_8(part.getAttribute("1.8"));

            m_protocol.printReportLineNumber("2.1");
            calculateAttribute2_1(part.getAttribute("2.1"));
            m_protocol.printReportLineNumber("2.2");
            calculateAttribute2_2(part.getAttribute("2.2"));
            m_protocol.printReportLineNumber("2.3");
            calculateAttribute2_3(part.getAttribute("2.3"));
            m_protocol.printReportLineNumber("2.4");
            calculateAttribute2_4(part.getAttribute("2.4"));
            m_protocol.printReportLineNumber("2.5");
            calculateAttribute2_5(part.getAttribute("2.5"));
            m_protocol.printReportLineNumber("2.6");
            calculateAttribute2_6(part.getAttribute("2.6"));
            m_protocol.printReportLineNumber("2.6.1");
            calculateAttribute2_6_1(part.getAttribute("2.6.1"));
            m_protocol.printReportLineNumber("2.7");
            calculateAttribute2_7(part.getAttribute("2.7"));
            m_protocol.printReportLineNumber("2.8");
            calculateAttribute2_8(part.getAttribute("2.8"));
            m_protocol.printReportLineNumber("2.8.1");
            calculateAttribute2_8_1(part.getAttribute("2.8.1"));

            m_protocol.printReportLineNumber("3.1");
            calculateAttribute3_1(part.getAttribute("3.1"));
            m_protocol.printReportLineNumber("3.2");
            calculateAttribute3_2(part.getAttribute("3.2"));
            m_protocol.printReportLineNumber("3.3");
            calculateAttribute3_3(part.getAttribute("3.3"));
            m_protocol.printReportLineNumber("3.4");
            calculateAttribute3_4(part.getAttribute("3.4"));
            m_protocol.printReportLineNumber("3.5");
            calculateAttribute3_5(part.getAttribute("3.5"));
            m_protocol.printReportLineNumber("3.5.1");
            calculateAttribute3_5_1(part.getAttribute("3.5.1"));
            m_protocol.printReportLineNumber("3.6");
            calculateAttribute3_6(part.getAttribute("3.6"));

            m_protocol.printReportLineNumber("4.1.1.1");
            calculateAttribute4_1_1_1(part.getAttribute("4.1.1.1"));
            m_protocol.printReportLineNumber("4.1.1");
            calculateAttribute4_1_1(part.getAttribute("4.1.1"));
            m_protocol.printReportLineNumber("4.1.2.1");
            calculateAttribute4_1_2_1(part.getAttribute("4.1.2.1"));
            m_protocol.printReportLineNumber("4.1.2");
            calculateAttribute4_1_2(part.getAttribute("4.1.2"));

            m_protocol.printReportLineNumber("4.1.3.1");
            calculateAttribute4_1_3_1(part.getAttribute("4.1.3.1"));
            m_protocol.printReportLineNumber("4.1.3");
            calculateAttribute4_1_3(part.getAttribute("4.1.3"));

            /*это переменные, которые не должны были расчитываться*/
            part.getAttribute("1.1").setUndefinedValue( "9", "10", "11", "12", "14");
            part.getAttribute("1.8").setUndefinedValue("13", "14");
            part.getAttribute("2.7").setUndefinedValue("13", "14");
            part.getAttribute("3.6").setUndefinedValue("13", "14");

            part.getAttribute("4.1.1.1").setUndefinedValue("8", "12", "19");
            part.getAttribute("4.1.2.1").setUndefinedValue("8", "12", "19");

            part.getValue().summarizeDependentValues(RCB_SU_EXACT);

            m_protocol.printReportLineNumber("1");
            calculateAttribute1(part.getAttribute("1"));

            m_protocol.printReportLineNumber("2");
            calculateAttribute2(part.getAttribute("2"));

            m_protocol.printReportLineNumber("3");
            calculateAttribute3(part.getAttribute("3"));

            m_protocol.printReportLineNumber("4.1");
            calculateAttribute4_1(part.getAttribute("4.1"));
            m_protocol.printReportLineNumber("4.2");
            calculateAttribute4_2(part.getAttribute("4.2"));
            m_protocol.printReportLineNumber("4.2.1");
            calculateAttribute4_2_1(part.getAttribute("4.2.1"));
            m_protocol.printReportLineNumber("4.2.2");
            calculateAttribute4_2_2(part.getAttribute("4.2.2"));
            m_protocol.printReportLineNumber("4");
            calculateAttribute4(part.getAttribute("4"));
        end;
    end;
end;

class (TCalculationPart1Controller4212) TCalculationPart1Controller4637(dataSource, tuneTable, protocol, report)
    initTCalculationPart1Controller4212(dataSource, tuneTable, protocol, report);

    /*3.1*/
    private macro calculateAttribute3_1(attribute)
        setAccountMasks(attribute.getName());

        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Покупка','Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isNotRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + "\nAND (   (1=1 " + m_loansCreditDataSource.getFilter().hasAim("Ж")
                                                         + "\n         "     + m_loansCreditDataSource.getFilter().isNotRegisteredHypothec() + ")"
                                                         + "\n     OR (1=1 " + m_loansCreditDataSource.getFilter().hasAim("И,З,B") + "))"
                                                         + m_loansCreditDataSource.getFilter().isNotExistsRightsOfClaimContractId()
                                                         + m_loansCreditDataSource.getFilter().isNotRegisteredHypothec(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                         ),
                     BOLoans);
    end;

    /*3.2*/
    private macro calculateAttribute3_2(attribute)
        setAccountMasks(attribute.getName());
        setLineValue(attribute,
                     m_cbAccountsDataSource.getBasicRequirementsData(
                                                     accountFilter
                                                   + m_cbAccountsDataSource.getFilter().hasAssignedAccountCategory("'Ипотека п/залог жилой','Ипотека п/залог нежилой'", RCB_OBJGROUP_CLASSIFCRD)
                                                   + m_cbAccountsDataSource.getFilter().isRegisteredHypothec()
                                                   + m_cbAccountsDataSource.getFilter().isAccountNotInСase(),
                                                   termAccountFilter,
                                                   overdueAccountFilter),
                     BOCB);

        setLineValue(attribute,
                     m_loansCreditDataSource.getBasicRequirementsData(
                                                           hasDataLoansFilter
                                                         + m_loansCreditDataSource.getFilter().hasType(LO_CREDIT)
                                                         + m_loansCreditDataSource.getFilter().hasClientType(RCB_PTLEGF_PERSN)
                                                         + m_loansCreditDataSource.getFilter().hasAim("И,З,B")
                                                         + m_loansCreditDataSource.getFilter().isNotExistsRightsOfClaimContractId()
                                                         + m_loansCreditDataSource.getFilter().isRegisteredHypothec(),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getRegisterNumber("1", attribute.getName(), BOLoans)),
                                                         m_loansCreditDataSource.getFilter().hasKindRegister(m_tuneTable.getDelayRegisterNumber("1", attribute.getName(), BOLoans))
                                                        ),
                     BOLoans);
    end;

    /*4.2*/
    private macro calculateAttribute4_2(attribute)
        setLineUserValue(attribute);
    end;

    /*4.2.1*/
    private macro calculateAttribute4_2_1(attribute)
        setLineUserValue(attribute);
    end;

    /*4.2.2*/
    private macro calculateAttribute4_2_2(attribute)
        setLineUserValue(attribute);
    end;

    macro calculate(part : TPart)
        if (part.getNumber() == 1)
            m_protocol.printReportLineNumber("1.1");
            calculateAttribute1_1(part.getAttribute("1.1"));
            m_protocol.printReportLineNumber("1.2");
            calculateAttribute1_2(part.getAttribute("1.2"));
            m_protocol.printReportLineNumber("1.3");
            calculateAttribute1_3(part.getAttribute("1.3"));
            m_protocol.printReportLineNumber("1.4");
            calculateAttribute1_4(part.getAttribute("1.4"));
            m_protocol.printReportLineNumber("1.5");
            calculateAttribute1_5(part.getAttribute("1.5"));
            m_protocol.printReportLineNumber("1.6");
            calculateAttribute1_6(part.getAttribute("1.6"));
            m_protocol.printReportLineNumber("1.7");
            calculateAttribute1_7(part.getAttribute("1.7"));
            m_protocol.printReportLineNumber("1.7.1");
            calculateAttribute1_7_1(part.getAttribute("1.7.1"));
            m_protocol.printReportLineNumber("1.8");
            calculateAttribute1_8(part.getAttribute("1.8"));

            m_protocol.printReportLineNumber("2.1");
            calculateAttribute2_1(part.getAttribute("2.1"));
            m_protocol.printReportLineNumber("2.2");
            calculateAttribute2_2(part.getAttribute("2.2"));
            m_protocol.printReportLineNumber("2.3");
            calculateAttribute2_3(part.getAttribute("2.3"));
            m_protocol.printReportLineNumber("2.4");
            calculateAttribute2_4(part.getAttribute("2.4"));
            m_protocol.printReportLineNumber("2.5");
            calculateAttribute2_5(part.getAttribute("2.5"));
            m_protocol.printReportLineNumber("2.6");
            calculateAttribute2_6(part.getAttribute("2.6"));
            m_protocol.printReportLineNumber("2.6.1");
            calculateAttribute2_6_1(part.getAttribute("2.6.1"));
            m_protocol.printReportLineNumber("2.7");
            calculateAttribute2_7(part.getAttribute("2.7"));
            m_protocol.printReportLineNumber("2.8");
            calculateAttribute2_8(part.getAttribute("2.8"));
            m_protocol.printReportLineNumber("2.8.1");
            calculateAttribute2_8_1(part.getAttribute("2.8.1"));

            m_protocol.printReportLineNumber("3.1");
            calculateAttribute3_1(part.getAttribute("3.1"));
            m_protocol.printReportLineNumber("3.2");
            calculateAttribute3_2(part.getAttribute("3.2"));
            m_protocol.printReportLineNumber("3.3");
            calculateAttribute3_3(part.getAttribute("3.3"));
            m_protocol.printReportLineNumber("3.4");
            calculateAttribute3_4(part.getAttribute("3.4"));
            m_protocol.printReportLineNumber("3.5");
            calculateAttribute3_5(part.getAttribute("3.5"));
            m_protocol.printReportLineNumber("3.5.1");
            calculateAttribute3_5_1(part.getAttribute("3.5.1"));
            m_protocol.printReportLineNumber("3.6");
            calculateAttribute3_6(part.getAttribute("3.6"));

            m_protocol.printReportLineNumber("4.1.1.1");
            calculateAttribute4_1_1_1(part.getAttribute("4.1.1.1"));
            m_protocol.printReportLineNumber("4.1.1");
            calculateAttribute4_1_1(part.getAttribute("4.1.1"));
            m_protocol.printReportLineNumber("4.1.2.1");
            calculateAttribute4_1_2_1(part.getAttribute("4.1.2.1"));
            m_protocol.printReportLineNumber("4.1.2");
            calculateAttribute4_1_2(part.getAttribute("4.1.2"));

            m_protocol.printReportLineNumber("4.1.3.1");
            calculateAttribute4_1_3_1(part.getAttribute("4.1.3.1"));
            m_protocol.printReportLineNumber("4.1.3");
            calculateAttribute4_1_3(part.getAttribute("4.1.3"));

            /*это переменные, которые не должны были расчитываться*/
            part.getAttribute("1.1").setUndefinedValue( "9", "10", "11", "12", "14");
            part.getAttribute("4.1.1.1").setUndefinedValue("8", "12", "19");
            part.getAttribute("4.1.2.1").setUndefinedValue("8", "12", "19");

            part.getValue().summarizeDependentValues(RCB_SU_EXACT);

            m_protocol.printReportLineNumber("1");
            calculateAttribute1(part.getAttribute("1"));

            m_protocol.printReportLineNumber("2");
            calculateAttribute2(part.getAttribute("2"));

            m_protocol.printReportLineNumber("3");
            calculateAttribute3(part.getAttribute("3"));

            m_protocol.printReportLineNumber("4.1");
            calculateAttribute4_1(part.getAttribute("4.1"));
            m_protocol.printReportLineNumber("4.2");
            calculateAttribute4_2(part.getAttribute("4.2"));
            m_protocol.printReportLineNumber("4.2.1");
            calculateAttribute4_2_1(part.getAttribute("4.2.1"));
            m_protocol.printReportLineNumber("4.2.2");
            calculateAttribute4_2_2(part.getAttribute("4.2.2"));
            m_protocol.printReportLineNumber("4");
            calculateAttribute4(part.getAttribute("4"));
        end;
    end;
end;