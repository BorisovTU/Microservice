/*
$Name:          f115CalculationController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 115. Контроллер расчета.
*/

/**
 * Форма 115. Контроллер расчета.
 *
 * @since   01.06.2008
 * @author  Ivkina Olga
 * @version 6.00.020.28
 */
import SbCrdInter;

import f115CalculationPart1Controller;
import f115CalculationPart2Controller;
import f115CalculationPart3Controller;
import f115CalculationPart4Controller;
import f115CalculationPart5Controller;

/**
 * Контроллер расчета.
 */
class TCalculationController()

    /**
     * Отчет.
     */
    private var m_report: TReport;

    /**
     * Источник данных.
     */
    private var m_dataSource: TDataSource;

    /**
     * конструктор.
     */
    macro constructor()
        m_dataSource = objectFactoryInstance.createDataSource();
        m_report     = objectFactoryInstance.createReport();
    end;

    /**
     * Расчитать атрибут отчета.
     * @param     attribute
     */
    macro calculateAttribute(attribute : TAttribute)
        throw(TPureVirtualMethodCallException("TCalculationController::calculateAttribute"));
    end;

    /**
     * Расчитать раздел отчета.
     * @param     part
     */
    macro calculatePart(part : TPart)
        var attributes = part.getAttributes();
        var i : Integer = 0;
        while (i < attributes.size)
            calculateAttribute(attributes[i]);
            i = i + 1;
        end;
    end;

    /**
     * Расчитать отчет.
     * @param     report
     * @param     dataSource
     */
    macro calculateReport()

        var parts = m_report.getParts();
        var i : Integer = 0;
        while (i < parts.size)

            BegAction(0, "Расчет раздела " + (i+1) + ".");

            calculatePart(parts[i]);
            i = i + 1;

            EndAction(0);
        end;
    end;


    constructor();
end;

/**
 *  Расчет переменных по 2061-У.
 *
 */
class (TCalculationController) TCalculationController2061()

    /**
     * Настроечная таблица.
     */
    private var m_tuneTable;

    /**
     * Протокол расчета.
     */
    private var m_protocol;

    private macro cacheData()
        begAction(0, "Кэширование данных");
            m_dataSource.cacheData(m_tuneTable);
        endAction(1);
    end;

    /**
     * Конструктор.
     */
    macro constructorTCalculationController2061()
        m_tuneTable  = objectFactoryInstance.createTuneTable();
        m_protocol   = objectFactoryInstance.createPrintCalculationProtocolOperation();

        initTCalculationController();
        cacheData();
    end;

    /**
     * Расчитать раздел отчета.
     */
    private macro calculatePart(part : TPart)

        m_protocol.printReportPartNumber(part.getNumber());

        if (part.getNumber() == 1)  /*перенести в фабрику*/
            TCalculationPart1Controller2061(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller2061(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller2061(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2061(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;

    private macro printRegistry(registry)
           m_protocol.printLine(string(registry.getName():60) + string(registry.getValue()));
    end;

    private macro printRegistries()
        printRegistry(global.parameters.getRegistry().getOldDebtAllowances());
        printRegistry(global.parameters.getRegistry().getConsolidateLoans());
        printRegistry(global.parameters.getRegistry().getLendingAgencyLoans());
        printRegistry(global.parameters.getRegistry().getIncludeOffBalance());
        printRegistry(global.parameters.getRegistry().getChargeCommission());
    end;

    /**
     * Рассчитать отчет.
     */
    macro calculateReport()
        m_protocol.setProtocolOutput();
        m_protocol.printHead();
        printRegistries();
        calculateReport();
        m_protocol.resetProtocolOutput();
    end;

    constructorTCalculationController2061();
end;


/**
 *  Расчет переменных по 2332-У.
 *
 */
class (TCalculationController2061) TCalculationController2332()
    initTCalculationController2061();

    /**
     * Расчитать раздел отчета.
     */
    private macro calculatePart(part : TPart)

        m_protocol.printReportPartNumber(part.getNumber());

        if (part.getNumber() == 1)  /*перенести в фабрику*/
            TCalculationPart1Controller2332(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller2332(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller2332(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2061(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;

    macro printRegistries()
        printRegistry(global.parameters.getRegistry().getOldDebtAllowances());
        printRegistry(global.parameters.getRegistry().getConsolidateLoans());
        printRegistry(global.parameters.getRegistry().getLendingAgencyLoans());
        printRegistry(global.parameters.getRegistry().getIncludeOffBalance());
        printRegistry(global.parameters.getRegistry().getChargeCommission());
        printRegistry(global.parameters.getRegistry().getIncludeTermInDelayAmount());
    end;
end;


/**
 *  Расчет переменных по 2539-У.
 *
 */
class (TCalculationController2332) TCalculationController2539()
    initTCalculationController2332();

    /**
     * Расчитать раздел отчета.
     */
    private macro calculatePart(part : TPart)

        m_protocol.printReportPartNumber(part.getNumber());

        if (part.getNumber() == 1)  /*перенести в фабрику*/
            TCalculationPart1Controller2539(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller2332(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller2539(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2539(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;

    end;

    macro printRegistries()
        printRegistry(global.parameters.getRegistry().getOldDebtAllowances());
        printRegistry(global.parameters.getRegistry().getConsolidateLoans());
        printRegistry(global.parameters.getRegistry().getLendingAgencyLoans());
        printRegistry(global.parameters.getRegistry().getChargeCommission());
    end;
end;

/**
 *  Расчет переменных по 2627-У.
 *
 */
class (TCalculationController2539) TCalculationController2627()
    initTCalculationController2539();

    /**
     * Расчитать раздел отчета.
     */
    private macro calculatePart(part : TPart)

        m_protocol.printReportPartNumber(part.getNumber());

        if (part.getNumber() == 1)  /*перенести в фабрику*/
            TCalculationPart1Controller2627(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller2332(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller2539(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2539(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;

    end;
end;

/**
 *  Расчет переменных по 2742-У.
 *
 */
class (TCalculationController2627) TCalculationController2742()
    initTCalculationController2627();

    /**
     * Расчитать раздел отчета.
     */
    private macro calculatePart(part : TPart)

        m_protocol.printReportPartNumber(part.getNumber());

        if (part.getNumber() == 1)  /*перенести в фабрику*/
            TCalculationPart1Controller2742(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller2332(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller2539(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2742(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;

    end;
end;


/**
 *  Расчет переменных по 2835-У.
 */
class (TCalculationController2742) TCalculationController2835()
    initTCalculationController2742();

    private macro getProtocolPartName(part) : String
        if (part < 5)
            return String(part);
        else
            return "Справочно";
        end;
    end;

    /**
     * Расчитать раздел отчета.
     */
    private macro calculatePart(part : TPart)

        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if (part.getNumber() == 1)
            TCalculationPart1Controller2742(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller2332(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller2539(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2835(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6))
            TCalculationPart5Controller2835(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;
end;

/**
 *  Расчет переменных по 2926-У.
 */
class (TCalculationController2835) TCalculationController2926()
    initTCalculationController2835();

    /**
     * Расчитать раздел отчета.
     */
    private macro calculatePart(part : TPart)

        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if (part.getNumber() == 1)
            TCalculationPart1Controller2742(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6))
            TCalculationPart5Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;
end;

class (TCalculationController2926) TCalculationController3006()
    initTCalculationController2926();

    /**
     * Расчитать раздел отчета.
     */
    private macro calculatePart(part : TPart)

        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if (part.getNumber() == 1)
            TCalculationPart1Controller3006(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6))
            TCalculationPart5Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;
end;

class (TCalculationController3006) TCalculationController3129()
    /**
     * Конструктор базового класса
     */
    initTCalculationController3006();

    /**
     * Расчитать раздел отчета.
     * @param parm TPart Раздел отчета
     */
    private macro calculatePart(part: TPart)
        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if (part.getNumber() == 1)
            TCalculationPart1Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6))
            TCalculationPart5Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;

end;

class (TCalculationController3129) TCalculationController3129_2()
    /**
     * Конструктор базового класса
     */
    initTCalculationController3129();

    /**
     * Расчитать раздел отчета.
     * @param parm TPart Раздел отчета
     */
    private macro calculatePart(part: TPart)
        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if (part.getNumber() == 1)
            TCalculationPart1Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6) or (part.getNumber() == 7) or (part.getNumber() == 8) or (part.getNumber() == 9))
            TCalculationPart5Controller3129_2(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;

end;

class (TCalculationController3129) TCalculationController3468()

    macro printRegistries()
        printRegistry(global.parameters.getRegistry().getOldDebtAllowances());
        printRegistry(global.parameters.getRegistry().getConsolidateLoans());
        printRegistry(global.parameters.getRegistry().getLendingAgencyLoans());
        printRegistry(global.parameters.getRegistry().getChargeCommission());
        printRegistry(global.parameters.getRegistry().getIncludeOffBalance());
        printRegistry(global.parameters.getRegistry().getIncludeTermInDelayAmount());
        printRegistry(global.parameters.getRegistry().getMortgageReducedRisk());
    end;

    /**
     * Конструктор базового класса
     */
    initTCalculationController3129();

    /**
     * Расчитать раздел отчета.
     * @param parm TPart Раздел отчета
     */
    private macro calculatePart(part: TPart)
        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if (part.getNumber() == 1)
            TCalculationPart1Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller3468(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6) or (part.getNumber() == 7) or (part.getNumber() == 8) or (part.getNumber() == 9))
            TCalculationPart5Controller3129_2(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;

end;

class (TCalculationController3468) TCalculationControllerF115_43_PAK()
    /**
     * Конструктор базового класса
     */
    initTCalculationController3468();

    /**
     * Расчитать раздел отчета.
     * @param parm TPart Раздел отчета
     */
    private macro calculatePart(part: TPart)
        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if (part.getNumber() == 1)
            TCalculationPart1Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller3468(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller2926(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6) or (part.getNumber() == 7) or (part.getNumber() == 8) or (part.getNumber() == 9))
            TCalculationPart5ControllerF115_43_PAK(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;

end;

class (TCalculationControllerF115_43_PAK) TCalculationController4099()

    /**
     * Конструктор базового класса
     */
    initTCalculationControllerF115_43_PAK();

    /**
     * Расчитать раздел отчета.
     * @param parm TPart Раздел отчета
     */
    private macro calculatePart(part: TPart)
        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if (part.getNumber() == 1)
            TCalculationPart1Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller3129(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller3468(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller4099(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6) or (part.getNumber() == 7) or (part.getNumber() == 8) or (part.getNumber() == 9))
            TCalculationPart5ControllerF115_43_PAK(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;
end;

class (TCalculationController4099) TCalculationController4212()
    initTCalculationController4099();

    private macro calculatePart(part: TPart)
        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if (part.getNumber() == 1)
            TCalculationPart1Controller4212(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller4212(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller3468(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller4099(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6) or (part.getNumber() == 7) or (part.getNumber() == 8) or (part.getNumber() == 9))
            TCalculationPart5ControllerF115_43_PAK(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;
end;

class (TCalculationController4212) TCalculationController4637()
    initTCalculationController4212();

    private macro calculatePart(part: TPart)
        if (part.getNumber() < 6)
            m_protocol.printReportPartNumber(getProtocolPartName(part.getNumber()));
        end;

        if   (part.getNumber() == 1)
            TCalculationPart1Controller4637(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 2)
            TCalculationPart2Controller4212(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 3)
            TCalculationPart3Controller3468(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif (part.getNumber() == 4)
            TCalculationPart4Controller4099(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        elif ((part.getNumber() == 5) or (part.getNumber() == 6) or (part.getNumber() == 7) or (part.getNumber() == 8) or (part.getNumber() == 9))
            TCalculationPart5ControllerF115_43_PAK(m_dataSource, m_tuneTable, m_protocol, m_report).calculate(part);
        end;
    end;
end;
