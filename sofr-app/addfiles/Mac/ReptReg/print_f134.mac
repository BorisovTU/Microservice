/* ──────────────────────────────────────────────────────────────────────────┐
   RS-Bank V6                                                 R-Style Softlab
   Файл подсистемы "Регламентированная отчетность"

   Печать отчета. Форма 134

   CREATED : 10.10.07 Ser.
└─────────────────────────────────────────────────────────────────────────- */
/*
 *  Общебанковские интеры и модули
 */
import reptcbInter;
import param;
import lib_str;
/*
 *  Интеры и модели подсистемы
 */
import rcb_date;
import rcbCoreInter;
import treport;
import rcbconst;
import rcbimport;

/***************************************************************************************************
 *  Класс печати отчета
 **************************************************************************************************/
private class TReportPrinter()
    private var m_report      = RcbApplication().currentReport;
    private var m_tableReport = CTableReport();
    const NUMBER_ROW_LENGTH      = 6;
    const DESCRIPTION_ROW_LENGTH = 64;
    const SUM_ROW_LENGTH         = 16;

    private macro printReportHeader()
        [                                                                                Банковская отчетность ];
        [                              ┌───────────────┬──────────────────────────────────────────────────────┐];
        [                              │      Код      │          Код кредитной организации (филиала)         │];
        [                              │   территории  ├─────────┬───────────────┬───────────────┬────────────┤];
        [                              │    по ОКАТО   │ по ОКПО │   Основной    │Регистрационный│    БИК     │];
        [                              │               │         │государственный│    номер      │            │];
        [                              │               │         │регистрационный│(/порядковый   │            │];
        [                              │               │         │    номер      │    номер)     │            │];
        [                              ├───────────────┼─────────┼───────────────┼───────────────┼────────────┤];
        [                              │        #      │     #   │       #       │       #       │      #     │]( Код_СОАТО:c, Код_ОКПО:c, ОГРН:c, РегНомерБанка:c, {MFO_Bank}:c );
        [                              └───────────────┴─────────┴───────────────┴───────────────┴────────────┘];
        [                                                                                                      ];
        [                                                                                                      ];
        [                                 РАСЧЕТ СОБСТВЕННЫХ СРЕДСТВ (КАПИТАЛА)                                ];
        [                                    по состоянию на #                                                 ]( GetCorrectPrnRepDate():m );
        [                                                                                                      ];
        [######################################################################################################]( "Наименование кредитной организации  " + {Name_Bank}:w);
        [Почтовый адрес  #                                                                                     ]( {Post_Addr}:l);
        [                                                                                                      ];
        [                                                                                    Код формы 0409134 ];
        [                                                                                             Месячная ];
        [                                                                                             тыс. руб.];
    end;

    private macro printReportFooter()
        [                                                                                      ];
        [ #                               ###################################    (Ф.И.О.)      ]({NAME_BOSS}:l, {FIO_BOSS}:l);
        [ #                               ###################################    (Ф.И.О.)      ]({NAME_BOOK}:l, {FIO_BOOK}:l);
        [ М.П.                                                                                 ];
        [ Исполнитель                     ###################################    (Ф.И.О.)      ](Исполнитель:l );
        [ Телефон:                        ###################################                  ](Номер_телефона:l );
        [ #                                                                                    ](trim( string({CURDATE}:m)));
    end;

    private macro  alignCenter(str : String, length : Integer)
        return strAlign(str, length, STR_ALIGN_CENTER, " ");
    end;

    private macro constructor()
        printReportHeader();
        m_tableReport.addColumn("Номер строки",             NUMBER_ROW_LENGTH,      AL_CENTER);
        m_tableReport.addColumn("Наименование показателя",  DESCRIPTION_ROW_LENGTH, AL_LEFT);
        m_tableReport.addColumn("остаток|на|отчетную дату", SUM_ROW_LENGTH,         AL_RIGHT);
        m_tableReport.printHead();
        m_tableReport.printstringTransferByWord(alignCenter("1", NUMBER_ROW_LENGTH),
                                                alignCenter("2", DESCRIPTION_ROW_LENGTH),
                                                alignCenter("3", SUM_ROW_LENGTH));
        m_tableReport.printSeparator();
    end;

    private macro getValue(attributeId : String)
        return m_report.attributeValue(attributeId).scaledAsString;
    end;

    private macro printRow000()
        m_tableReport.printStringTransferByWord("000",
                                                "Собственные средства (капитал), итого, в том числе:",
                                                getValue("EqК"));
       m_tableReport.printSeparator();
    end;

    private macro printRow100()
        m_tableReport.printStringTransferByWord("100",
                                                "Основной капитал",
                                                alignCenter("X", SUM_ROW_LENGTH));
       m_tableReport.printSeparator();
    end;

    private macro printRow101()
        m_tableReport.printStringTransferByWord("101",
                                                "Уставный капитал кредитной организации",
                                                getValue("Eq2_1_1__2_1_2"));
       m_tableReport.printSeparator();
    end;

    private macro printRow102()
        m_tableReport.printStringTransferByWord("102",
                                                "Эмиссионный доход кредитной организации",
                                                getValue("Eq2_1_3__2_1_4"));
       m_tableReport.printSeparator();
    end;

    private macro printRow103()
        m_tableReport.printStringTransferByWord("103",
                                                "Часть резервного фонда кредитной организации, сформированного за счет прибыли предшествующих лет",
                                                getValue("Eq2_1_5"));
       m_tableReport.printSeparator();
    end;

    private macro printRow104()
        m_tableReport.printStringTransferByWord("104",
                                                "Часть нераспределенной прибыли текущего года",
                                                getValue("Eq2_1_6"));
       m_tableReport.printSeparator();
    end;

    private macro printRow104_1()
        m_tableReport.printStringTransferByWord("104.1",
                                                "в т.ч. переоценка ценных бумаг, имеющихся в наличии для продажи",
                                                getValue("Eq2_1_6переоценка"));
       m_tableReport.printSeparator();
    end;

    private macro printRow105()
        m_tableReport.printStringTransferByWord("105",
                                                "Часть резервного фонда кредитной организации, сформированного из прибыли текущего года",
                                                getValue("Eq2_1_7"));
       m_tableReport.printSeparator();
    end;

    private macro printRow106()
        m_tableReport.printStringTransferByWord("106",
                                                "Нераспределенная прибыль предшествующих лет  (или ее часть)",
                                                getValue("Eq2_1_11"));
       m_tableReport.printSeparator();
    end;

    private macro printRow107()
        m_tableReport.printStringTransferByWord("107",
                                                "Источники основного капитала, итого",
                                                getValue("EqИстОсн"));
       m_tableReport.printSeparator();
    end;

    private macro printRow108()
        m_tableReport.printStringTransferByWord("108",
                                                "Нематериальные активы",
                                                getValue("Eq2_2_1"));
       m_tableReport.printSeparator();
    end;

    private macro printRow109()
        m_tableReport.printStringTransferByWord("109",
                                                "Собственные акции (доли участия), приобретенные (выкупленные) кредитной организации у акционеров (участников)",
                                                getValue("Eq2_2_2__2_2_3"));
       m_tableReport.printSeparator();
    end;

    private macro printRow110()
        m_tableReport.printStringTransferByWord("110",
                                                "Непокрытые убытки предшествующих лет",
                                                getValue("Eq2_2_4"));
       m_tableReport.printSeparator();
    end;

    private macro printRow111()
        m_tableReport.printStringTransferByWord("111",
                                                "Убыток текущего года",
                                                getValue("Eq2_2_5"));
       m_tableReport.printSeparator();
    end;

    private macro printRow111_1()
        m_tableReport.printStringTransferByWord("111.1",
                                                "в т.ч. переоценка ценных бумаг, имеющихся в наличии для продажи",
                                                getValue("Eq2_2_5переоценка"));
       m_tableReport.printSeparator();
    end;

    private macro printRow112()
        m_tableReport.printStringTransferByWord("112",
                                                "Вложения кредитной организации в акции (доли) дочерних и зависимых юридических лиц и кредитных организаций-резидентов",
                                                getValue("Eq2_2_6"));
       m_tableReport.printSeparator();
    end;

    private macro printRow113()
        m_tableReport.printStringTransferByWord("113",
                                                "Уставный капитал (его часть) и иные источники собственных средств (эмиссионный доход, нераспределеннвя прибыль, резервный фонд) (их часть), для формирования которых инвесторами использованы ненадлежащие активы",
                                                getValue("Eq2_2_8"));
       m_tableReport.printSeparator();
    end;

    private macro printRow114()
        m_tableReport.printStringTransferByWord("114",
                                                "Отрицательная величина дополнительного капитала",
                                                getValue("Eq2_2_9"));
       m_tableReport.printSeparator();
    end;

    private macro printRow115()
        m_tableReport.printStringTransferByWord("115",
                                                "Основной капитал, итого",
                                                getValue("EqОсн"));
       m_tableReport.printSeparator();
    end;

    private macro printRow200()
        m_tableReport.printStringTransferByWord("200",
                                                "Дополнительный капитал",
                                                alignCenter("X", SUM_ROW_LENGTH));
       m_tableReport.printSeparator();
    end;

    private macro printRow201()
        m_tableReport.printStringTransferByWord("201",
                                                "Прирост стоимости имущества кредитной организации за счет переоценки",
                                                 getValue("Eq3_1"));
       m_tableReport.printSeparator();
    end;

    private macro printRow202()
        m_tableReport.printStringTransferByWord("202",
                                                "Часть резервного фонда, сформированного из прибыли текущего года",
                                                 getValue("Eq3_3"));
       m_tableReport.printSeparator();
    end;

    private macro printRow203()
        m_tableReport.printStringTransferByWord("203",
                                                "Нераспределенная прибыль текущего года (или ее часть)",
                                                 getValue("Eq3_4"));
       m_tableReport.printSeparator();
    end;

    private macro printRow203_1()
        m_tableReport.printStringTransferByWord("203.1",
                                                "в т.ч. переоценка ценных бумаг, имеющихся в наличии для продажи",
                                                 getValue("Eq3_4переоценка"));
       m_tableReport.printSeparator();
    end;

    private macro printRow204()
        m_tableReport.printStringTransferByWord("204",
                                                "Субординированный кредит (займ, депозит, облигационный заем) по остаточной стоимости",
                                                 getValue("Eq3_5"));
       m_tableReport.printSeparator();
    end;

    private macro printRow205()
        m_tableReport.printStringTransferByWord("205",
                                                "Часть уставного капитала, сформированного за счет капитализации прироста стоимости имущества при переоценке",
                                                 getValue("Eq3_6"));
       m_tableReport.printSeparator();
    end;

    private macro printRow206()
        m_tableReport.printStringTransferByWord("206",
                                                "Часть привилегированных (включая кумулятивные) акций",
                                                 getValue("Eq3_7"));
       m_tableReport.printSeparator();
    end;

    private macro printRow207()
        m_tableReport.printStringTransferByWord("207",
                                                "Нераспределенная прибыль предшествующих лет",
                                                 getValue("Eq3_9"));
       m_tableReport.printSeparator();
    end;

    private macro printRow208()
        m_tableReport.printStringTransferByWord("208",
                                                "Источники (часть источников) дополнительного капитала (уставного капитала, нераспределенной прибыли, резервного фонда, субординированного кредита), для формирования которых инвесторами использованы ненадлежащие активы",
                                                 getValue("Eq3_10"));
       m_tableReport.printSeparator();
    end;

    private macro printRow209()
        m_tableReport.printStringTransferByWord("209",
                                                "Источники дополнительного капитала, итого",
                                                 getValue("EqИстДоп"));
       m_tableReport.printSeparator();
    end;

    private macro printRow210()
        m_tableReport.printStringTransferByWord("210",
                                                "Дополнительный капитал, итого",
                                                 getValue("EqДоп"));
       m_tableReport.printSeparator();
    end;

    private macro printRow300()
        m_tableReport.printStringTransferByWord("300",
                                                "Показатели, уменьшающие сумму основного и дополнительного капитала",
                                                 alignCenter("X", SUM_ROW_LENGTH));
       m_tableReport.printSeparator();
    end;

    private macro printRow301()
        m_tableReport.printStringTransferByWord("301",
                                                "Величина недосозданного резерва на возможные  потери по ссудам II - V-й категорий качества",
                                                 getValue("Eq4_1"));
       m_tableReport.printSeparator();
    end;

    private macro printRow302()
        m_tableReport.printStringTransferByWord("302",
                                                "Величина недосозданного резерва на возможные потери",
                                                 getValue("Eq4_2"));
       m_tableReport.printSeparator();
    end;

    private macro printRow303()
        m_tableReport.printStringTransferByWord("303",
                                                "Величина недосозданного резерва под операции с резидентам офшорных зон",
                                                 getValue("Eq4_3"));
       m_tableReport.printSeparator();
    end;

    private macro printRow304()
        m_tableReport.printStringTransferByWord("304",
                                                "Просроченная дебиторская задолженность длительностью свыше 30 календарных дней",
                                                 getValue("Eq4_5"));
       m_tableReport.printSeparator();
    end;

    private macro printRow305()
        m_tableReport.printStringTransferByWord("305",
                                                "Субординированные кредиты (депозиты, займы, облигационные займы), предоставленные кредитным организациям-резидентам",
                                                 getValue("Eq4_6"));
       m_tableReport.printSeparator();
    end;

    private macro printRow400()
        m_tableReport.printStringTransferByWord("400",
                                                "Промежуточный итог",
                                                 getValue("EqПром"));
       m_tableReport.printSeparator();
    end;

    private macro printRow501()
        m_tableReport.printStringTransferByWord("501",
                                                "Величина превышения совокупной суммы кредитов, банковских гарантий и поручительств, предоставленных кредитной организацией своим участникам (акционерам) и инсайдерам, над ее максимальным размером, предусмотренным федеральными законами и нормативными актами Банка России",
                                                 getValue("Eq5_1"));
       m_tableReport.printSeparator();
    end;

    private macro printRow502()
        m_tableReport.printStringTransferByWord("502",
                                                "Превышающие сумму источников основного и дополнительного капитала вложения в сооружение (строительство), создание (изготовление) и приобретение основных средств, стоимость основных средств, а также материальных запасов",
                                                 getValue("Eq5_2"));
       m_tableReport.printSeparator();
    end;

    private macro printRow503()
        m_tableReport.printStringTransferByWord("503",
                                                "Разница между действительной стоимостью доли, причитающейся вышедшим из общества участникам, и стоимостью, по которой доля была реализована другому участнику",
                                                 getValue("Eq5_3"));
       m_tableReport.printBottom();
    end;

    macro print()

       printRow000();
       printRow100();
       printRow101();
       printRow102();
       printRow103();
       printRow104();
       printRow104_1();
       printRow105();
       printRow106();
       printRow107();
       printRow108();
       printRow109();
       printRow110();
       printRow111();
       printRow111_1();
       printRow112();
       printRow113();
       printRow114();
       printRow115();
       printRow200();
       printRow201();
       printRow202();
       printRow203();
       printRow203_1();
       printRow204();
       printRow205();
       printRow206();
       printRow207();
       printRow208();
       printRow209();
       printRow210();
       printRow300();
       printRow301();
       printRow302();
       printRow303();
       printRow304();
       printRow305();
       printRow400();
       printRow501();
       printRow502();
       printRow503();

       printReportFooter();
    end;
    constructor();
end;

private class (TReportPrinter) TReportPrinter2055()

    private macro constructorTReportPrinter2055()
        initTReportPrinter();
    end;

    private macro printRow104_1()
        m_tableReport.printStringTransferByWord("104.1",
                                                  "в т.ч. переоценка ценных бумаг, текущая (справедливая) стоимость которых определяется как"
                                                + " средневзвешенная цена, раскрываемая организатором торговли на рынке ценных бумаг",
                                                getValue("Eq2_1_6переоценка"));
       m_tableReport.printSeparator();
    end;

    private macro printRow111_1()
        m_tableReport.printStringTransferByWord("111.1",
                                                  "в т.ч. переоценка ценных бумаг, текущая (справедливая) стоимость которых определяется как"
                                                + " средневзвешенная цена, раскрываемая организатором торговли на рынке ценных бумаг",
                                                getValue("Eq2_2_5переоценка"));
       m_tableReport.printSeparator();
    end;

    private macro printRow203_1()
        m_tableReport.printStringTransferByWord("203.1",
                                                  "в т.ч. переоценка ценных бумаг, текущая (справедливая) стоимость которых определяется как"
                                                + " средневзвешенная цена, раскрываемая организатором торговли на рынке ценных бумаг",
                                                 getValue("Eq3_4переоценка"));
       m_tableReport.printSeparator();
    end;

    constructorTReportPrinter2055();
end;

private class (TReportPrinter2055) TReportPrinter2332()
    private macro printReportHeader()
        var objectFactoryInstance = RcbObjectFactoryBase();

        var m_view = RcbReportView("РАСЧЕТ СОБСТВЕННЫХ СРЕДСТВ (КАПИТАЛА)","0409134", arrCreate(RCB_PK_MONTH, RCB_PK_DAY), DATE_IN_PERIOD_FORMAT);

        m_view.setReportWidth(102);

        m_view.changePrintZone(MC_LEADING_AGENCY_NAME_WHITHOUT_BRANCH);

        m_view.printLendingAgencyCodeZone();

        m_view.printNamesZone();


    end;

    private macro printRow104()
        m_tableReport.printStringTransferByWord("104",
                                                "Часть нераспределенной прибыли текущего года, в том числе:",
                                                getValue("Eq2_1_6"));
       m_tableReport.printSeparator();
    end;

    private macro printRow104_1()
        m_tableReport.printStringTransferByWord("104.1",
                                                  "переоценка ценных бумаг, текущая (справедливая) стоимость которых определяется как"
                                                + " средневзвешенная цена, раскрываемая организатором торговли на рынке ценных бумаг",
                                                getValue("Eq2_1_6переоценка"));
       m_tableReport.printSeparator();
    end;

    private macro printRow106()
        m_tableReport.printStringTransferByWord("106",
                                                "Нераспределенная прибыль предшествующих лет (ее часть)",
                                                getValue("Eq2_1_11"));
       m_tableReport.printSeparator();
    end;

    private macro printRow107()
        m_tableReport.printStringTransferByWord("107",
                                                "Субординированный заем с дополнительными условиями",
                                                getValue("Eq2_1_12"));
       m_tableReport.printSeparator();
    end;

    private macro printRow108()
        m_tableReport.printStringTransferByWord("108",
                                                "Источники основного капитала, итого",
                                                getValue("EqИстОсн"));
       m_tableReport.printSeparator();
    end;

    private macro printRow109()
        m_tableReport.printStringTransferByWord("109",
                                                "Нематериальные активы",
                                                getValue("Eq2_2_1"));
       m_tableReport.printSeparator();
    end;

    private macro printRow110()
        m_tableReport.printStringTransferByWord("110",
                                                "Собственные акции (доли участия), приобретенные (выкупленные) кредитной организации у акционеров (участников)",
                                                getValue("Eq2_2_2__2_2_3"));
       m_tableReport.printSeparator();
    end;

    private macro printRow111()
        m_tableReport.printStringTransferByWord("111",
                                                "Непокрытые убытки предшествующих лет",
                                                getValue("Eq2_2_4"));
       m_tableReport.printSeparator();
    end;

    private macro printRow112()
        m_tableReport.printStringTransferByWord("112",
                                                "Убыток текущего года",
                                                getValue("Eq2_2_5"));
       m_tableReport.printSeparator();
    end;

    private macro printRow112_1()
        m_tableReport.printStringTransferByWord("112.1",
                                                "переоценка ценных бумаг, текущая (справедливая) стоимость которых определяется как средневзвешенная цена, раскрываемая организатором торговли на рынке ценных бумаг",
                                                getValue("Eq2_2_5переоценка"));
       m_tableReport.printSeparator();
    end;

    private macro printRow113()
        m_tableReport.printStringTransferByWord("113",
                                                "Вложения кредитной организации в акции (доли) дочерних и зависимых юридических лиц и уставный капитал кредитных организаций-резидентов",
                                                getValue("Eq2_2_6"));
       m_tableReport.printSeparator();
    end;

    private macro printRow114()
        m_tableReport.printStringTransferByWord("114",
                                                "Уставный капитал (его часть) и иные источники собственных средств (эмиссионный доход, нераспределеннвя прибыль, резервный фонд) (их часть), для формирования которых инвесторами использованы ненадлежащие активы",
                                                getValue("Eq2_2_8"));
       m_tableReport.printSeparator();
    end;

    private macro printRow115()
        m_tableReport.printStringTransferByWord("115",
                                                "Отрицательная величина дополнительного капитала",
                                                getValue("Eq2_2_9"));
       m_tableReport.printSeparator();
    end;

    private macro printRow116()
        m_tableReport.printStringTransferByWord("116",
                                                "Основной капитал, итого",
                                                getValue("EqОсн"));
       m_tableReport.printSeparator();
    end;

    private macro printRow202()
        m_tableReport.printStringTransferByWord("202",
                                                "Часть резервного фонда, сформированного за счет отчислений из прибыли текущего года",
                                                 getValue("Eq3_3"));
       m_tableReport.printSeparator();
    end;

    private macro printRow203()
        m_tableReport.printStringTransferByWord("203",
                                                "Нераспределенная прибыль текущего года (ее часть),в том числе:",
                                                 getValue("Eq3_4"));
       m_tableReport.printSeparator();
    end;

    private macro printRow203_1()
        m_tableReport.printStringTransferByWord("203.1",
                                                "переоценка ценных бумаг, текущая (справедливая) стоимость которых определяется как средневзвешенная цена, раскрываемая организатором торговли на рынке ценных бумаг",
                                                 getValue("Eq3_4переоценка"));
       m_tableReport.printSeparator();
    end;

    private macro printRow305()
        m_tableReport.printStringTransferByWord("305",
                                                "Субординированные кредиты (депозиты, займы, облигационные займы), в том числе субординированные займы с дополнительными условиями, предоставленные кредитным организациям-резидентам",
                                                 getValue("Eq4_6"));
       m_tableReport.printSeparator();
    end;

    macro print()

       printRow000();
       printRow100();
       printRow101();
       printRow102();
       printRow103();
       printRow104();
       printRow104_1();
       printRow105();
       printRow106();
       printRow107();
       printRow108();
       printRow109();
       printRow110();
       printRow111();
       printRow112();
       printRow112_1();
       printRow113();
       printRow114();
       printRow115();
       printRow116();
       printRow200();
       printRow201();
       printRow202();
       printRow203();
       printRow203_1();
       printRow204();
       printRow205();
       printRow206();
       printRow207();
       printRow208();
       printRow209();
       printRow210();
       printRow300();
       printRow301();
       printRow302();
       printRow303();
       printRow304();
       printRow305();
       printRow400();
       printRow501();
       printRow502();
       printRow503();

       printReportFooter();
    end;

    initTReportPrinter2055();
end;

private class (TReportPrinter2332) TReportPrinter2742()
    private macro printReportHeader()
        objectFactoryInstance = RcbObjectFactoryBase();

        var m_view = RcbReportView("РАСЧЕТ СОБСТВЕННЫХ СРЕДСТВ (КАПИТАЛА)","0409134", arrCreate(RCB_PK_HALFYEAR, RCB_PK_QUARTER, RCB_PK_MONTH, RCB_PK_DAY), DATE_IN_PERIOD_FORMAT);

        m_view.setReportWidth(102);

        m_view.changePrintZone(MC_LEADING_AGENCY_NAME_WHITHOUT_BRANCH);

        m_view.printLendingAgencyCodeZone();

        m_view.printNamesZone();
    end;

    initTReportPrinter2332();
end;
/***************************************************************************************************
 *  основная функция
 **************************************************************************************************/
private macro main()

    if (RcbApplication().currentReport.context.period.endDate >= RCB_I2742_DATE)
        TReportPrinter2742().print();
    elif (RcbApplication().currentReport.context.period.endDate >= RCB_I2332_DATE)
        TReportPrinter2332().print();
    elif (RcbApplication().currentReport.context.period.endDate >= RCB_I2055_DATE)
        TReportPrinter2055().print();
    elif (RcbApplication().currentReport.context.period.endDate >= RCB_I1881_DATE)
        TReportPrinter().print();
    else
        execMacroFile("p_f134n.mac");
    end;
end;

/***************************************************************************************************
 *  точка входа
 **************************************************************************************************/
main();
