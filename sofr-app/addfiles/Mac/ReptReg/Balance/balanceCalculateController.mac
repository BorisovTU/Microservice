/*
$Name:          balanceCalculateController.mac
$Module:        Регламентируемая отчетность
$Description:   Контроллер расчета.
*/
/**
 * Форма Балансовый отчет. Контроллер расчета.
 *
 * @since 07.03.2013
 * @author  gww
 * @version 6.00.020.31
 */
/**
 * Контроллер расчета.
 */

import balanceChapterCalculateController;

class (RcbReportCalculateController) TBalanceReportCalculateController(chapter)
    private var m_chapter = chapter;

    initRcbReportCalculateController();

    private macro clearValues(chapter)

    end;


    /**
     *
     */
    private macro initializeDepartmentFilter()
        balanceParameters().getDepartmentList().saveToTable();
    end;

    macro initialize() : Bool
        var chapterNumber     = 1;

        sql_execute("BEGIN rsb_balance.clear(); END;");

        initializeDepartmentFilter();

        if (m_chapter > 0)
            clearValues(m_chapter);
            m_partCalculateControllers.push_back(TBalanceChapterCalculateController(this, m_chapter));
        else
            while (chapterNumber <= TBalanceParameters().getChaptersCountForCalculate())
                clearValues(chapterNumber);
                m_partCalculateControllers.push_back(TBalanceChapterCalculateController(this, chapterNumber));

                chapterNumber = chapterNumber + 1;
            end;
        end;
        return m_partCalculateControllers.size > 0;
    end;
end;