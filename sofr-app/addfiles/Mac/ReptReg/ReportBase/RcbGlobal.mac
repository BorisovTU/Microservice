import RcbCoreInter;

import cb_sql;
import lib_lang;

import departmentFilter;

class TGlobalBase
    macro initializeRepDataPackage(report : RcbReport)
        defaultParm(report, rcbApplication.currentReport);

        sql_truncate("drepdepartment_tmp");

        sql_execute("CALL rep_data.setBalancePlanNumber(" + rcbApplication.parameters.balancePlanNumber + ")");

        sql_execute("CALL rep_data.setBeginDate(" + getSqlDate(report.context.period.beginDate) + ")");
        sql_execute("CALL rep_data.setEndDate("   + getSqlDate(report.context.period.endDate)   + ")");

        sql_execute("CALL rep_data.setDepartmentCode(" + getSqlString(rcbDepartmentList.getAsSqlSetFilial()) + ", "
                                                       + getSqlString(rcbDepartmentList.getAsSqlSetVsp()) + ")");

        sql_execute("CALL rsvoxprm.setPrmVal('BeginDate', UTL_RAW.CAST_TO_RAW(TO_CHAR("+getSqlDate(report.context.period.beginDate)+", 'DD.MM.YYYY')))");
        sql_execute("CALL rsvoxprm.setPrmVal('EndDate',   UTL_RAW.CAST_TO_RAW(TO_CHAR("+getSqlDate(report.context.period.endDate)+", 'DD.MM.YYYY')))");
    end;
end;

var v_global : TGlobalBase = null;