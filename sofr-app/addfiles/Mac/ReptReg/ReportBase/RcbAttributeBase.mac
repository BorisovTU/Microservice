/*
$Name:          RcbAttributeBase.mac
$Module:        Регламентируемая отчетность
$Description:   ReportBase. Класс атрибута
*/

import RcbCoreInter;
import RcbLibrary;
import repException;

class RcbAttributeBase(id : String, part : Object/*RcbPartBase*/, compositeValue : Object /*RcbCompositeValue или RcbAttributeValue*/)
    /**
     * Идентификатор атрибута
     */
    private var m_id : String;

    /**
     * Ссылка на раздел
     */
    private var m_part : Object;

    /*Составное значение атрибута*/
    private var m_attributeCompositeValue : Object;

    /**
     * Так как атрибут может состоять из нескольких значений,
     * а значения в свою очередь так же могут быть составными,
     * то для хранения заводим специальный контейнер
     */
    private var m_compositeValuePool : RcbArray;

    private macro getRcbValue() : RcbVAlue
        throw(TPureVirtualMethodCallException("RcbAttributeBase::getRcbValue"));
    end;

    /**
     * Вернуть точное значение атрибута, если значение не найдено, то создать новое
     */
    macro getValue() : Money
        throw(TPureVirtualMethodCallException("RcbAttributeBase::getValue"));
    end;

    /**
     * Вернуть значение атрибута, если значение не найдено, то создать новое
     */
    macro getScaledValue() : Variant
        throw(TPureVirtualMethodCallException("RcbAttributeBase::getScaledValue"));
    end;

    /**
     * Вернуть значение атрибута, если значение не найдено, то вернуть null
     */
    macro findValue() : Money
        throw(TPureVirtualMethodCallException("RcbAttributeBase::findValue"));
    end;

    /**
     * Вернуть значение атрибута, если значение не найдено, то вернуть null
     */
    macro findScaledValue() : Variant
        throw(TPureVirtualMethodCallException("RcbAttributeBase::findScaledValue"));
    end;

    /**
     * Вернуть значение атрибута, если значение не найдено, то вернуть null
     */
    macro getValueAsString() : String
        throw(TPureVirtualMethodCallException("RcbAttributeBase::getValueAsString"));
    end;

    /**
     * Установить новое значение атрибута, вернуть ссылку на себя
     */
    macro setValue() : RcbAttributeBase
        throw(TPureVirtualMethodCallException("RcbAttributeBase::setValue"));
    end;

    /**
     * Добавить новое значение к значению атрибута, вернуть ссылку на себя
     */
    macro plus() : RcbAttributeBase
        throw(TPureVirtualMethodCallException("RcbAttributeBase::plus"));
    end;

    /**
     * Вычесть новое значение из значения атрибута, вернуть ссылку на себя
     */
    macro minus() : RcbAttributeBase
        throw(TPureVirtualMethodCallException("RcbAttributeBase::minus"));
    end;


    /**
     * Вернуть идентификатор атрибута
     */
    macro getId() : String
        return m_id;
    end;

    /**
     * Вернуть ссылку на раздел
     */
    macro getPart()
        return m_part;
    end;

    /**
     * Метод определяющий соответствие атрибутов
     */
    macro isEquial(attribute : RcbAttributeBase) : Bool
        return (getPart().getId() == attribute.getPart().getId()) and (getId() == attribute.getId());
    end;

    /**
     * Проверка существования значения атрибута
     */
    macro isDefined() : Bool
        throw(TPureVirtualMethodCallException("RcbAttributeBase::isDefined"));
    end;

    private macro constructorRcbAttributeBase(id : String, part : Object, compositeValue : Object)
        m_id = id;
        if (part != null)
            m_part = weakRef(part);
        else
            m_part = null;
        end;
        m_attributeCompositeValue = compositeValue;
        m_compositeValuePool = RcbArray();
    end;

    constructorRcbAttributeBase(id, part, compositeValue);
end;
