/*
$Name:          RcbArTuneTable.mac
$Module:        Регламентируемая отчетность
$Description:   Настроечная таблица кодов по ОКАТО для автономных областей.
*/
import XmlRpcInter, ServiceAction;
import RcbConst;
import RcbGeneratedDataSource;

import RcbTuneTable;
import rcb_bo;

/**
 * Настроечная таблица для формы.
 */
class (RcbTuneTable) RcbArTuneTable(instructionDate)
    private const FIELD_NAME_CODE = "t_okato";
    private const FIELD_NAME_MASK = "t_okatoMasks";

    /**
     * Получить список полей настроечной таблицы.
     *
     * @return Массив объектов TMetaInformation.
     */
    macro getMetadataTuneTableWeb() : Object
        //TMetaInformation(id, name, nameHead, isReadOnly, isVisible)
        //Названия полей и колонок смотреть в словаре rs-bank с помощью утилиты ExploreFMT.exe. Поля t_instructiondate и t_isclosed не добавлять
        //Порядок добавления в массив см. в RcbTuneTable.cpp в соотв. функции либо в ТЗ, если НТ делается "с нуля"
        var result : Object = TArray();
        result[result.size] = TMetaInformation(result.size, FIELD_NAME_CODE, "Код ОКАТО",            true,  true);
        result[result.size] = TMetaInformation(result.size, FIELD_NAME_MASK, "Маска кодов ОКАТО АО", false, true);

        return result;
    end;

    /**
     * Получить значение в настроечной таблице.
     *
     * @param   code    код ОКАТО
     */
    macro getMask(code : String)
        var oldFilter = m_userFilter;
        clearFilter();
        setUserFilter(FIELD_NAME_CODE + " = " + getSqlString(code));
        var mask = getMasks(FIELD_NAME_MASK);
        setUserFilter(oldFilter);
        return mask;
    end;

    macro getWebName()
        return "ОКАТО АО";
    end;

    private macro constructorRcbArTuneTable(instructionDate)
        initRcbTuneTable("dtAoOkatoCodes_dbt");

        if (instructionDate == null)
            instructionDate = RcbApplication().currentReport.context.period.endDate;
        end;

        setInstructionFilter(instructionDate);
    end;

    constructorRcbArTuneTable(instructionDate);
end;

/**
 * Настроечная таблица по 4637-У
 */
class (RcbArTuneTable) RcbArTuneTable_4637()
    private macro constructorRcbArTuneTable_4637()
        initRcbArTuneTable(RCB_I4637_DATE);
    end;

    constructorRcbArTuneTable_4637();
end;
