/*
$Name:          f501Interface.mac
$Module:        Отчеты ЦБ
$Description:   Форма 501. Доступ к операциям формы.
*/

import f501import;

/**
 *  Запуск операции расчета отчета
 */
macro calculate()
    var profiler;
    profiler = TSqlProfiler(getTxtFileName("!f501CalculationProfile"));
    profiler.clear();
    profiler.on();

    objectFactoryInstance.createReportCalculateController().calculate();
end;

/**
 *  Запуск операции нормализации
 */
macro normalize()
    objectFactoryInstance.createNormalizationController().execute();
    RcbApplication().transactionManager.commit();
end;

/**
 *  Запуск операции пересчета после свода
 */
macro recalculateAfterSummation()
    var profiler;
    if (TF501Settings().isUseSqlProfilerDuringRecalculation())
        profiler = TSqlProfiler(getTxtFileName("!f501RecalculationProfile"));
        profiler.clear();
        profiler.on();
    end;
    objectFactoryInstance.createReportRecalculateController().calculate();
    RcbApplication().transactionManager.commit();
end;

/**
 *  Запуск операции печати отчета в plain text
 */
macro printReport()
    objectFactoryInstance.createReportPrintController().print("txt");
end;

/**
 *  Запуск операции печати отчета в excel
 */
macro printReportExcel()
    objectFactoryInstance.createReportPrintController(WINREP_FORMAT_XLSX).print("xls");
end;

/**
 *  Запуск операции экспорта в kliko.exe
 */
macro exportToKliko()
    objectFactoryInstance.createExportKlikoController().execute();
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
