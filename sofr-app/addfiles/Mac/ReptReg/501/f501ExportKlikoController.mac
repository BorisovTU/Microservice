/*
$Name:          f501ExportKlikoController.mac
$Module:        Отчеты ЦБ
$Description:   Форма 501. Контроллер экспорта в kliko.exe.
*/

/**
 * Форма 501. Контроллер экспорта в kliko.exe.
 *
 * @since 17.12.2018
 * @author ABP
 * @version 6.20.031.054
 */
class (RcbKlikoExportController) TF501ExportKlikoController()
    private macro getDescriptorInfo()
        return "F501_30.pak от 26.03.2018";
    end;

    private macro createView()
        return TF501KlikoView(m_fileExtension, m_report.getPeriod().endDate);
    end;

    private macro printAdditionalProtocolData(protocol)
//        TF501Settings().printExportationReport(protocol);
    end;

    private macro printDataZone()
        var i = 0;
        for (var partId, RcbArray().init(TF501Global().getPart1Id(), TF501Global().getPart2Id()))
            i = i + 1;
            message("Раздел " + i);

            m_view.printHead(partId);
            var nrCode = null;
            var currencyCode = null;
            for (var attribute, m_report.getPart(partId).getAttributes(true))
                var value = attribute.getValue();
                if (nrCode != value.getNrCode())
                    nrCode = value.getNrCode();
                    m_view.printNrCode(nrCode);
                end;
                if (currencyCode != value.getCurrencyCode())
                    currencyCode = value.getCurrencyCode();
                    m_view.printCurrencyCode(nrCode, currencyCode);
                end;
                m_view.printRowData(value);
            end;
        end;
    end;

    private macro constructorTF501ExportKlikoController()
        initRcbKlikoExportController("501", objectFactoryInstance.createReport());
    end;

    constructorTF501ExportKlikoController();
end;
