/*
$Name:          f501NormalizationController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 501. Контроллер нормализации
*/

class TF501NormalizationController()
    private var m_protocolView = null;

    private macro check()
        if (TF501Global().getRcbReport().normalizationAlgorithm == RCB_NA_NONE)
            m_protocolView.printNormalizationDisabled(); // "Нормализация отключена в настройках отчетного периода"
            return false;
        elif(rcbApplication.currentReport.normalizationAlgorithm == RCB_NA_SM)
            m_protocolView.printNormalizationAlgorithmNotRealised();
            return false;
        end;

        if (   (TF501Global().getRcbReport().dimension == RCB_DIM_NATIONAL)
            or (TF501Global().getRcbReport().dimension == RCB_DIM_ROUBLE))
            m_protocolView.printNormalizationNotRequired();
            return false;
        end;

        return true;
    end;

    macro execute()
        m_protocolView.beginProtocol();

        var isNormalizable : Bool;
        isNormalizable = check();

        if (not isNormalizable)
            m_protocolView.endProtocol();
            return;
        end;

        var isNormalized = false;

        var normalizer = objectFactoryInstance.createNormalizer(m_protocolView);

        isNormalized = normalizer.execute();

        m_protocolView.endProtocol();
    end;

    private macro constructorTF501NormalizationController()
        m_protocolView = objectFactoryInstance.createNormalizationProtocolView();
    end;

    constructorTF501NormalizationController();
end;
