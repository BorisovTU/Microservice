/*
$Name:          f501ReportPrintController.mac
$Module:        Отчеты ЦБ
$Description:   Форма 501. Контроллер печати отчета.
*/

class (RcbReportPrintController) TF501ReportPrintController(format : Integer)
    private var m_format : Integer;

    private macro printDataZone()
        var view = getReportView();

        var isPartEmpty = RcbArray().init(null,
                                          getReport().getPart(TF501Global().getPart1Id()).isEmpty(),
                                          getReport().getPart(TF501Global().getPart2Id()).isEmpty(),
                                          true
                                         );

         view.printSignatureZone();

        var i = 0;
        for (var partId, RcbArray().init(TF501Global().getPart1Id(), TF501Global().getPart2Id()))
            i = i + 1;
            message("Раздел " + i);

            var part = getReport().getPart(partId);
            var partView = view.getPartView(partId);

            partView.printHead();
			for (var attribute, part.getAttributes(true))
                var value = attribute.getValue();

				partView.printString(value.getRowCode(), value);
            end;
			partView.printBottom();
        end;
    end;

    private macro printAdditionalProtocolData()
//        TF501Parameters().printPrintingReport(getProtocolView());
    end;

    private macro destructor()
        if (m_format == WINREP_FORMAT_XLSX)
            if (not m_protocolView.isEmpty())
                m_protocolView.show();
            end;
        else
			var view = getReportView();
			if (not m_protocolView.isEmpty())
                m_protocolView.show();
            end;
			view.resetOutputFile();
            destructor();
        end;
    end;

    private macro constructorTF501ReportPrintController(format : Integer)
        initRcbReportPrintController();

		m_format = nvl(format, WINREP_FORMAT_HTML);

		if (m_format == WINREP_FORMAT_XLSX)
			m_reportView = objectFactoryInstance.createReportExcelView(m_protocolView);
        else
			var view = getReportView();
		end;


    end;

    constructorTF501ReportPrintController(format);
end;
