/*
$Name:          f501ObjectFactory.mac
$Module:        Отчеты ЦБ
$Description:   Форма 501. Фабрика объектов.
*/

/**
 * Форма 501. Фабрика объектов.
 */
private class (RcbObjectFactoryBase) TF501ObjectFactoryImpl()
    macro createReport(report : RcbReport, isLazy : Bool) : RcbReportBase
        defaultParm(isLazy, false);
        return genObject("TF501Report", report, isLazy);
    end;

    macro createPart(partId : String, compositeValue : Object) : RcbPartBase
        if (partId == TF501Global().getPart1Id())
            return genObject("TF501Part1", partId, compositeValue);
        elif (partId == TF501Global().getPart2Id())
            return genObject("TF501Part2", partId, compositeValue);
        else
            return null;
        end;
    end;

    macro createAttribute(id : String, part : RcbPartBase, value : Object, properties : Object) : RcbAttributeBase
        if (part.getId() == TF501Global().getPart1Id())
            return genObject("TF501AttributePart1", id, part, value, properties);
        elif (part.getId() == TF501Global().getPart2Id())
            return genObject("TF501AttributePart2", id, part, value, properties);
        else
            return null;
        end;
    end;

    macro createAttributeValue(part : RcbPartBase, storage : RcbCompositeValue) : Object
        if (part.getId() == TF501Global().getPart1Id())
            return genObject("TF501AttributeValuePart1", storage);
        elif (part.getId() == TF501Global().getPart2Id())
            return genObject("TF501AttributeValuePart2", storage);
        else
            return null;
        end;
    end;

    macro createStandaloneAttributeValue(part : RcbPartBase, account : String) : Object
        if (part.getId() == TF501Global().getPart1Id())
            return genObject("TF501StandaloneAttributeValuePart1", account);
        elif (part.getId() == TF501Global().getPart2Id())
            return genObject("TF501StandaloneAttributeValuePart2", account);
        else
            return null;
        end;
    end;

    macro createAttributeProperties(part : RcbPartBase, storage : RcbCompositeValue) : Object
        if (part.getId() == TF501Global().getPart1Id())
            return genObject("TF501AttributePropertiesPart1", storage);
        elif (part.getId() == TF501Global().getPart2Id())
            return genObject("TF501AttributePropertiesPart2", storage);
        else
            return null;
        end;
    end;

    macro createDataSources(protocolView : RcbCalculateProtocolView) : RcbDataSources
        return genObject("TF501DataSources", protocolView);
    end;

    macro createDataSourceFilters() : RcbDataSourceFilters
        return genObject("TF501DataSourceFilters");
    end;

    macro createCalculateProtocolView(protocolName : String) : RcbCalculateProtocolView
        return genObject("TF501CalculateProtocolView", protocolName);
    end;

    macro createPartCalculateController(part : RcbPartBase, reportCalculateController : RcbReportCalculateController) : Object
        if (part.getId() == TF501Global().getPart1Id())
            return genObject("TF501Part1CalculateController", reportCalculateController);
        elif (part.getId() == TF501Global().getPart2Id())
            return genObject("TF501Part2CalculateController", reportCalculateController);
        else
            return null;
        end;
    end;

    macro createReportCalculateController() : RcbReportCalculateController
        return genObject("TF501ReportCalculateController");
    end;

    macro createTuneTable() : RcbTuneTable
        return genObject("TF501TuneTable", RCB_I4212_DATE);
    end;

    macro createPartView(id : String, reportView : RcbReportView) : RcbReportView
        if (id == TF501Global().getPart1Id())
            return genObject("TF501Part1View", reportView);
        elif (id == TF501Global().getPart2Id())
            return genObject("TF501Part2View", reportView);
        else
            return null;
        end;
    end;

    macro createReportView(protocolView : RcbPrintProtocolView) : RcbReportView
        return genObject("TF501ReportView", protocolView);
    end;

    macro createPrintProtocolView(protocolName)
        return genObject("TF501PrintProtocolView", protocolName);
    end;

    macro createReportPrintController(format : Integer) : RcbReportPrintController
        return genObject("TF501ReportPrintController", format);
    end;

    macro createExportKlikoController() : RcbKlikoExportController
        return genObject("TF501ExportKlikoController");
    end;

    macro createSettingsContainer(attributeName : String)
        return genObject("TRcbSettingsContainer", attributeName);
    end;

    macro createReportRecalculateController()
        return genObject("TF501ReportRecalculateController");
    end;

    macro createNormalizationController()
        return genObject("TF501NormalizationController");
    end;

    macro createNormalizationProtocolView() : Object
        return genObject("TF501NormalizationProtocolView");
    end;

    macro createNormalizer(protocolView : Object) : Object
        return genObject("TF501Normalizer", protocolView);
    end;

    /**
     * Метод используется при создании RcbReportView
     * Данный класс генериться именно таким образом, т.к. требует инкапсуляции представления
     * шапок(подвалов) печатных форм отчета в RcbReportView
     */
    macro createPrintableView(formName : String, formOkudCode : String, formPeriodicity, periodFormat : Integer)
        return genObject("TF501PrintableView", formName, formOkudCode, formPeriodicity, periodFormat);
    end;

    macro createNamesZone(formName : String, formOkudCode : String, formPeriodicity : String, periodFormat : Integer) : TNamesZone
        return genObject("TF501NamesZone", formName, formOkudCode, formPeriodicity, periodFormat);
    end;

    macro createPartRowsData(id : String) : Object
        if (id == TF501Global().getPart1Id())
            return genObject("TF501Part1RowsData");
        elif (id == TF501Global().getPart2Id())
            return genObject("TF501Part2RowsData");
        else
            return null;
        end;
    end;

    private macro constructorTF501ObjectFactoryImpl()
        initRcbObjectFactoryBase();
    end;

    constructorTF501ObjectFactoryImpl();
end;

if (objectFactoryInstance == null)
    if (RcbApplication().currentReport.context.period.endDate >= RCB_I4212_DATE)
        objectFactoryInstance = TF501ObjectFactoryImpl();
    else
        objectFactoryInstance = null;
    end;
end;
