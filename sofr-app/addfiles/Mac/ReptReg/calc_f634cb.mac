/*
$Name:        calc_f634cb.mac
$Module:      Регламентируемая отчетность
$Description: Формирование данных по ГК
*/
/*─────────────────────────────────────────────────────────────────────────────────────────────────┐
  RS-Bank V6                                                                        R-Style Softlab
  Файл подсистемы "Регламентируемая отчетность"

  Расчет формы 634. ГКБО

  Создан: 25.07.2007 - ABP
└─────────────────────────────────────────────────────────────────────────────────────────────────*/

import FIInter;
import calc_f634com;
import acc_lib;
import testLib;

/**
 *  Не найден лицевой счет
 */
private class (TException) TAccountNotFoundException(accountNumber, chapter, fiId)
    initTException("Не найден лицевой счет " + accountNumber + ", глава " + chapter + ", Id ФИ " + fiId);
end;

/**
 *  Параметры расчета по ГКБО
 */
private class (TParameters) TParametersCb(report : Object)

    private var m_accountFilter;

    private var m_ocpAccountServer;

    private var m_optionType;

    private var m_reserveMaskArray;

    macro getAccountFilter()
        return m_accountFilter;
    end;

    macro getOcpAccountServer()
        return m_ocpAccountServer;
    end;

    macro getOptionType()
        return getSqlChar(m_optionType);
    end;

    macro getReserveMask(element : Integer)
        var returnValue;

        if (element != null)
            if ((element < m_reserveMaskArray.size) and (element >= 0))
                returnValue = m_reserveMaskArray[element];
            else
                returnValue = "";
            end;
        else
            returnValue = m_reserveMaskArray;
        end;

        return returnValue;
    end;

    macro getPlanNumberMap()

        var planNumber = getPlanNumber();

        var planNumberMap = TArray(30);

        var i;

        i = 0;
        while (i < planNumberMap.size)
            planNumberMap[i] = planNumber;
            i = i + 1;
        end;

        return planNumberMap;

    end;

    private macro fillReserveMask()
        var dataSet;
        var query;

        query =          "SELECT t_accountMask"
                + "\n" + "  FROM drsvprm_dbt"
                + "\n" + " WHERE t_accountChapter = 1"
                + "\n" + "   AND t_backOffice != " + rcbSqlBool(true)
                + "\n" + "   AND t_accountMask != " + getSqlString("");

        dataSet = TRsbDataset(query);

        m_reserveMaskArray = TArray(300);
        while (dataSet.next())
            m_reserveMaskArray[m_reserveMaskArray.size] = dataSet.accountMask;
        end;
    end;

    private macro constructorTParametersCb(report : Object)

        initTParameters(report);

        var error = 0;

        m_accountFilter    = RcbAccountFilter();

        m_ocpAccountServer = RepOcpAccountServer(0, ALLFININSTR, RcbDepartmentList());

        GetRegistryValue("REPTREG\\REP_GROUPS\\USER_SYMBOLS\\ACCOUNTS\\ОПЦИОНЫ", V_STRING, m_optionType, error);
        if (error != 0)
            m_optionType = "";
        end;

        fillReserveMask();

    end;

    constructorTParametersCb(report);

end;

/**
 *  Класс построения текста SQL-запроса для источника данных
 */
private class TDataSourceCbQueryTextMaker(parameters : TParameters)

    private const TA_RUB    = 6;
    private const TA_MULTIR = 12;
    private const TA_ESTIM  = 4;

    private const TA_NVPI_STR = "В";

    private var KA_A;
    private var KA_P;

    private var TYPE_MAIN;
    private var TYPE_PERCENT;
    private var TYPE_SECURITY;
    private var TYPE_GUARANTEE;

    private var m_parameters;

    private var m_reportDate;

    private var m_queryText;

    private var m_percentRoleClause;
    private var m_securityRoleClause;

    private var m_standardFilterClause;

    private var m_optionClause;

    private var m_nvpiClause;
    private var m_linkedNvpiClause;

    private var m_fiIdClause;
    private var m_linkedFiIdClause;

    private macro getParameters()
        return m_parameters;
    end;

    /**
     *  SQL-выражение для проверки открытости счета за заданную дату
     */
    private macro getIsAccountOpenAsSqlString(alias : String)

        var dateOpen  = alias + ".t_openDate",
            dateClose = alias + ".t_closeDate",
            endDate   = getSqlDate(m_reportDate),
            dateZero  = getSqlDate(Date(0,0,0));

        return "(" + dateOpen + " <= " + endDate + ") AND ((" + dateClose + " > " + endDate + ") OR (" + dateClose + " = " + dateZero + "))";

    end;

    /**
     *  Создание SQL-выражения для фильтрации по значению группы связанного объекта
     */
    private macro getRoleClause(roleStartValue, quantity)
        var i;
        var roleClause = "";

        i = 0;
        while (i < quantity)
            roleClause = roleClause + string(roleStartValue + i) + ",";
            i = i + 1;
        end;
        roleClause = subStr(roleClause, 1, strLen(roleClause) - 1);

        roleClause = "objlink.t_role IN " + "(" + roleClause + ")";

        return roleClause;
    end;

    /**
     *  Создание SQL-выражения стандартного фильтра
     */
    private macro getStandartFilterClause(parameters)
        return   "("
        + "\n" + " " + getIsAccountOpenAsSqlString("account")
        + "\n" + " AND NOT " + parameters.getOcpAccountServer().getAsSqlString("account")
        + "\n" + " AND " + parameters.getAccountFilter().getAsSqlString("account")
        + "\n" + " AND account.t_isTechnical = 0"
        + "\n" + " AND account.t_balance NOT LIKE '20308%'"
        + "\n" + ")";
    end;

    /**
     *  Создание SQL-выражения для определения признака опциона
     */
    private macro getOptionClause(parameters)
        return   "("
        + "\n" + " CASE"
        + "\n" + "     WHEN INSTR(account.t_type," + parameters.getOptionType() + ") = 0"
        + "\n" + "         THEN " + rcbSqlBool(false)
        + "\n" + "     ELSE " + rcbSqlBool(true)
        + "\n" + "  END"
        + "\n" + ")";
    end;

    /**
     *  Создание SQL-выражения для определения признака НВПИ
     */
    private macro getNvpiClause()
        return   "("
        + "\n" + " CASE"
        + "\n" + "     WHEN INSTR(account.t_type," + getSqlChar(TA_NVPI_STR) + ") = 0"
        + "\n" + "         THEN " + rcbSqlBool(false)
        + "\n" + "     ELSE " + rcbSqlBool(true)
        + "\n" + "  END"
        + "\n" + ")";
    end;

    /**
     *  Создание SQL-выражения для определения признака НВПИ для связанных объектов (счетов)
     */
    private macro getLinkedNvpiClause()
        return   "("
        + "\n" + " CASE"
        + "\n" + "     WHEN INSTR(linkedAccount.t_type," + getSqlChar(TA_NVPI_STR) + ") = 0"
        + "\n" + "         THEN " + rcbSqlBool(false)
        + "\n" + "     ELSE " + rcbSqlBool(true)
        + "\n" + "  END"
        + "\n" + ")";
    end;

    /**
     *  Создание SQL-выражения для определения id фин. инструмента
     */
    private macro getFiIdClause()
        return   "("
        + "\n" + " CASE"
        + "\n" + "     WHEN INSTR(account.t_type," + getSqlChar(TA_NVPI_STR) + ") = 0"
        + "\n" + "         THEN account.t_fiId"
        + "\n" + "     ELSE account.t_equivalentFiId"
        + "\n" + "  END"
        + "\n" + ")";
    end;

    /**
     *  Создание SQL-выражения для определения id фин. инструмента для связанных объектов (счетов)
     */
    private macro getLinkedFiIdClause()
        return   "("
        + "\n" + " CASE"
        + "\n" + "     WHEN INSTR(linkedAccount.t_type," + getSqlChar(TA_NVPI_STR) + ") = 0"
        + "\n" + "         THEN linkedAccount.t_fiId"
        + "\n" + "     ELSE linkedAccount.t_equivalentFiId"
        + "\n" + "  END"
        + "\n" + ")";
    end;

    /**
     *  Текст запроса для отбора валютных счетов 1 главы (VVV_3, VVV_рез_бал_ГК)
     */
    macro getQueryText_VVV_3_VVV_rez_bal_gk()

        return          "/*Вал. счета 1 главы (VVV_3, VVV_рез_бал_ГК)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               // Счет с резервом, являющийся непереоцениваемым покрытием в VVV_3 не включается
               + "\n" + "           WHEN reserve.t_reserveDate IS NOT NULL"
               + "\n" + "            AND INSTR(account.t_type, cnst.getTA(" + TA_ESTIM + ")) != 0"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_rez_bal_gk())
               // Счет без резерва, являющийся непереоцениваемым покрытием в отчет не включается
               + "\n" + "           WHEN reserve.t_reserveDate IS NULL"
               + "\n" + "            AND INSTR(account.t_type, cnst.getTA(" + TA_ESTIM + ")) != 0"
               + "\n" + "           THEN CHR(0)"
               + "\n" + "           WHEN reserve.t_reserveDate IS NOT NULL"
               + "\n" + "            AND account.t_kind = " + getSqlChar(KA_A)
               + "\n" + "           THEN " + getSqlString(  getParameters().getCode_vvv_3()
                                                          + getParameters().getCode_vvv_rez_bal_gk()
                                                         )
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_3())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 1"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора валютных счетов 4 главы (VVV_4, VVV_5)
     */
    macro getQueryText_VVV_4_VVV_5()
        return          "/*Вал. счета 4 главы (VVV_4, VVV_5)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("930*,931*,932*,960*,961*,962*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 4"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("930*,931*,932*,933*,934*,935*,960*,961*,962*,963*,964*,965*", "account.t_balance") + ")"
               + "\n" + "   AND " + m_optionClause + " = " + rcbSqlBool(false);
    end;

    /**
     *  Текст запроса для отбора валютных счетов 3 главы (VVV_Гар_ГК, VVV_ГарРез_ГК)
     */
    macro getQueryText_VVV_gar_gk_VVV_garrez_gk()
        return          "/*Вал. счета 3 главы (VVV_Гар_ГК, VVV_ГарРез_ГК)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN reserve.t_reserveDate IS NOT NULL"
               + "\n" + "           THEN " + getSqlString(  getParameters().getCode_vvv_gar_gk()
                                                          + getParameters().getCode_vvv_garrez_gk()
                                                         )
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_gar_gk())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepcategory_vw category"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 3"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("91315*", "account.t_balance") + ")"
               + "\n" + "   AND category.t_objectId = account.t_objectId"
               + "\n" + "   AND category.t_objectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND category.t_isInstalledForEndDate = 1"
               + "\n" + "   AND category.t_value = " + getSqlString("БЕЗОТЗ")
               + "\n" + "   AND account.t_qualityCategory IN (4, 5)"
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountID";
    end;

    /**
     *  Текст запроса для отбора валютных счетов 3 главы (VVV_Аккредитив)
     */
    macro getQueryText_VVV_akkreditiv()
        return          "/*Вал. счета 3 главы (VVV_Аккредитив)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NVL(reserve.t_endDateReserveAmount, 0)                                t_factReserve,"
               + "\n" + "       NVL(reserve.t_reserveDate," + getSqlDate(m_reportDate) + ")           t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_akkreditiv()) + "            t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepcategory_vw category"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 3"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("90907*, 90908*", "account.t_balance") + ")"
               + "\n" + "   AND category.t_objectId = account.t_objectId"
               + "\n" + "   AND category.t_objectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND category.t_isInstalledForEndDate = 1"
               + "\n" + "   AND category.t_value = " + getSqlString("БЕЗОТЗ")
               + "\n" + "   AND account.t_qualityCategory IN (4, 5)"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(false)
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора валютных счетов процентов (VVV_10)
     */
    macro getQueryText_VVV_10()
        return          "/*Вал. счета процентов с вал. осн. счетом (VVV_10)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "       linkedAccount.t_fiId                                                  t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_PERCENT) + "                                          t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NVL(reserve.t_endDateReserveAmount, 0)                                t_factReserve,"
               + "\n" + "       NVL(reserve.t_reserveDate," + getSqlDate(m_reportDate) + ")           t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_10()) + "                    t_usedByPosition"
               + "\n" + "  FROM drepaccountpercentaccounts_vw prcContract,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND prcContract.t_accounttypeid IN (5, 6)"
               + "\n" + "   AND prcContract.t_isOpened != 0"
               + "\n" + "   AND linkedAccount.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_fiId <> " + NATCUR
               + "\n" + "   AND " + m_linkedNvpiClause + " = " + rcbSqlBool(false)
               + "\n" + "   AND prcContract.t_connectChapter = account.t_chapter"
               + "\n" + "   AND prcContract.t_connectFiId    = account.t_fiId"
               + "\n" + "   AND prcContract.t_connectAccount = account.t_account"
               + "\n" + "   AND linkedAccount.t_chapter = prcContract.t_chapter"
               + "\n" + "   AND linkedAccount.t_fiId    = prcContract.t_fiId"
               + "\n" + "   AND linkedAccount.t_account = prcContract.t_account"
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора валютных счетов обеспечения (VVV_ГарантииПолуч_ГК)
     */
    macro getQueryText_VVV_garantiipolu4()
        return          "/*Вал. счета обеспечения с вал. осн. счетом (VVV_ГарантииПолуч_ГК)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "   " + m_linkedFiIdClause + "                                                t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_SECURITY) + "                                         t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       linkedAccount.t_outEquivalentRest                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_garantiipolu4()) + "         t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 1"
               + "\n" + "   AND linkedAccount.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_balance = '91414'"
               + "\n" + "   AND linkedAccount.t_fiId <> " + NATCUR
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountID"
               + "\n" + "   AND reserve.t_endDatereserveamount != 0";
    end;

    /**
     *  Текст запроса для отбора валютных счетов залога (VVV_Залог_ГК)
     */
    macro getQueryText_VVV_zalog_gk()
        return          "/*Вал. счета залога с вал. осн. счетом (vvv_Залог_ГК)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "   " + m_linkedFiIdClause + "                                                t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_GUARANTEE) + "                                        t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       linkedAccount.t_outEquivalentRest                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_zalog_gk()) + "              t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND account.t_outRest != 0"
                + "\n" + "   AND account.t_chapter = 1"
               + "\n" + "   AND linkedAccount.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_fiId <> " + NATCUR
               + "\n" + "   AND linkedAccount.t_balance IN ('91311', '91312', '91313')"
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountId"
               + "\n" + "   AND reserve.t_endDateReserveAmount != 0";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 1 без НВПИ (VVV_3_810, VVV_рез_бал_810)
     */
    macro getQueryText_VVV_3_810_VVV_rez_bal_810()
        return          "/*Руб. счета без НВПИ из 1 главы (VVV_3_810, VVV_рез_бал_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       fininstr.t_faceValueFi                                                t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN reserve.t_reserveDate IS NOT NULL"
               + "\n" + "            AND account.t_kind = " + getSqlChar(KA_A)
               + "\n" + "           THEN " + getSqlString(  getParameters().getCode_vvv_3_810()
                                                          + getParameters().getCode_vvv_rez_bal_gk_810()
                                                         )
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_3_810())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       dfininstr_dbt fininstr,"
               + "\n" + "       v_rcb_f634_fininstr f634_fininstr"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink.t_role = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi = f634_fininstr.t_id"
               + "\n" + "   AND account.t_chapter = 1"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(false)
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 1 с НВПИ (VVV_3_810, VVV_рез_бал_810)
     */
    macro getQueryText_VVV_3_810_VVV_rez_bal_810_nvpi()
        return          "/*Руб. счета с НВПИ из 1 главы (VVV_3_810, VVV_рез_бал_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN reserve.t_reserveDate IS NOT NULL"
               + "\n" + "            AND account.t_kind = " + getSqlChar(KA_A)
               + "\n" + "           THEN " + getSqlString(  getParameters().getCode_vvv_3_810_eq()
                                                          + getParameters().getCode_vvv_rez_bal_gk_810()
                                                         )
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_3_810_eq())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 1"
               + "\n" + "   AND account.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 4 без НВПИ (VVV_4_810, VVV_5_810)
     */
    macro getQueryText_VVV_4_810_VVV_5_810()
        return          "/*Руб. счета без НВПИ из 4 главы (VVV_4_810, VVV_5_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       fininstr.t_faceValueFi                                                t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("930*,931*,932*,960*,961*,962*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4_810())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5_810())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       dfininstr_dbt fininstr,"
               + "\n" + "       v_rcb_f634_fininstr f634_fininstr"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink.t_role = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi = f634_fininstr.t_id"
               + "\n" + "   AND account.t_chapter = 4"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("930*,931*,932*,933*,934*,935*,960*,961*,962*,963*,964*,965*", "account.t_balance") + ")"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(false)
               + "\n" + "   AND " + m_optionClause + " = " + rcbSqlBool(false);
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 4 с НВПИ (VVV_4_810, VVV_5_810)
     */
    macro getQueryText_VVV_4_810_VVV_5_810_nvpi()
        return          "/*Руб. счета с НВПИ из 4 главы (VVV_4_810, VVV_5_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("930*,931*,932*,960*,961*,962*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4_810_eq())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5_810_eq())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 4"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND account.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("930*,931*,932*,933*,934*,935*,960*,961*,962*,963*,964*,965*", "account.t_balance") + ")"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND " + m_optionClause + " = " + rcbSqlBool(false);
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Аккредитив_810)
     */
    macro getQueryText_VVV_akkreditiv_810()
        return          "/*Руб. счета с НВПИ из 3 главы (VVV_Аккредитив_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NVL(reserve.t_endDateReserveAmount, 0)                                t_factReserve,"
               + "\n" + "       NVL(reserve.t_reserveDate," + getSqlDate(m_reportDate) + ")           t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_akkreditiv_810()) + "        t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepcategory_vw category"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 3"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND account.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("90907*, 90908*", "account.t_balance") + ")"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND category.t_objectId = account.t_objectId"
               + "\n" + "   AND category.t_objectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND category.t_isInstalledForEndDate = 1"
               + "\n" + "   AND category.t_value = " + getSqlString("БЕЗОТЗ")
               + "\n" + "   AND account.t_qualityCategory IN (4, 5)"
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов обеспечения без НВПИ (VVV_ГарПолуч_810_ГК)
     */
    macro getQueryText_VVV_garpolu4_810_gk()
        return          "/*Руб. счета обеспечения с вал. осн. счетом (VVV_ГарПолуч_810_ГК)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "       linkedAccount.t_fiId                                                  t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_SECURITY) + "                                         t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       fininstr.t_faceValueFi                                                t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_garpolu4_810()) + "          t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       dreplinkedobjects_vw objlink_fi,"
               + "\n" + "       dfininstr_dbt fininstr,"
               + "\n" + "       v_rcb_f634_fininstr f634_fininstr,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND account.t_outCoverRest != 0"
               + "\n" + "   AND linkedAccount.t_outCoverRest != 0"
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_balance = '91414'"
               + "\n" + "   AND linkedAccount.t_fiId = " + NATCUR
               + "\n" + "   AND objlink.t_id = objlink_fi.t_connectObjectId"
               + "\n" + "   AND objlink_fi.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId = objlink_fi.t_id"
               + "\n" + "   AND objlink_fi.t_type = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink_fi.t_role = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink_fi.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi = f634_fininstr.t_id"
               + "\n" + "   AND " + m_linkedNvpiClause + " = " + rcbSqlBool(false)
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountId"
               + "\n" + "   AND reserve.t_endDateReserveAmount != 0";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов обеспечения с НВПИ (VVV_ГарПолуч_810_ГК)
     */
    macro getQueryText_VVV_garpolu4_810_gk_nvpi()
        return          "/*Руб. счета обеспечения с НВПИ с вал. осн. счетом (VVV_ГарПолуч_810_ГК)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "       linkedAccount.t_fiId                                                  t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_SECURITY) + "                                         t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       linkedAccount.t_outEquivalentRest                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       linkedAccount.t_equivalentFiId                                        t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_garpolu4_810_eq()) + "       t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND " + m_linkedNvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND account.t_outCoverRest != 0"
               + "\n" + "   AND linkedAccount.t_outCoverRest != 0"
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_balance = '91414'"
               + "\n" + "   AND linkedAccount.t_fiId = " + NATCUR
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountId"
               + "\n" + "   AND reserve.t_endDateReserveAmount != 0";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов залога с НВПИ (VVV_Залог_810)
     */
    macro getQueryText_VVV_zalog_810()
        return          "/*Руб. счета залога с НВПИ с вал. осн. счетом (VVV_Залог_810)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "   " + m_linkedFiIdClause + "                                                t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_GUARANTEE) + "                                        t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       linkedAccount.t_outEquivalentRest                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       linkedaccount.t_equivalentFiId                                        t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_zalog_810()) + "             t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND " + m_linkedNvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_fiId = " + NATCUR
               + "\n" + "   AND linkedAccount.t_balance IN ('91311', '91312', '91313')"
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountId"
               + "\n" + "   AND reserve.t_endDateReserveAmount != 0";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Гар_810)
     */
    macro getQueryText_VVV_gar_810()
        return          "/*Руб. счета с НВПИ из 3 главы (VVV_Гар_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NVL(reserve.t_endDateReserveAmount, 0)                                t_factReserve,"
               + "\n" + "       NVL(reserve.t_reserveDate," + getSqlDate(m_reportDate) + ")           t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_gar_810()) + "               t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepcategory_vw category"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 3"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("91315*", "account.t_balance") + ")"
               + "\n" + "   AND category.t_objectId = account.t_objectId"
               + "\n" + "   AND category.t_objectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND category.t_isInstalledForEndDate = 1"
               + "\n" + "   AND category.t_value = " + getSqlString("БЕЗОТЗ")
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND account.t_qualityCategory IN (4, 5)"
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    macro makeQueryText(queryText, needBackOfficeAccountCheck)

        defaultParm(needBackOfficeAccountCheck, false);

        var backOfficeAccountCheckerQuery = "";

        if (needBackOfficeAccountCheck)

            backOfficeAccountCheckerQuery = " WHERE NOT EXISTS (SELECT 1"
                                   + "\n" + "                     FROM dRcbBackOfficeAccount_tmp"
                                   + "\n" + "                    WHERE t_chapter = (SELECT obchaptr.t_symbol"
                                   + "\n" + "                                         FROM dobchaptr_dbt obchaptr"
                                   + "\n" + "                                        WHERE t_chapter = data.t_mainChapterNumber"
                                   + "\n" + "                                      )"
                                   + "\n" + "                      AND t_fiId = data.t_mainFiId"
                                   + "\n" + "                      AND t_cbAccountNumber = data.t_mainAccountNumber"
                                   + "\n" + "                  )";

        end;

        return   "SELECT data.t_accountNumber           AS t_accountNumber,"
        + "\n" + "       data.t_chapterNumber           AS t_chapterNumber,"
        + "\n" + "       data.t_fiId                    AS t_fiId,"
        + "\n" + "       data.t_accountKind             AS t_accountKind,"
        + "\n" + "       data.t_accountType             AS t_accountType,"
        + "\n" + "       data.t_rest                    AS t_rest,"
        + "\n" + "       data.t_roubleRest              AS t_roubleRest,"
        + "\n" + "       data.t_equivalentRest          AS t_equivalentRest,"
        + "\n" + "       data.t_isOption                AS t_isOption,"
        + "\n" + "       data.t_hasNvpi                 AS t_hasNvpi,"
        + "\n" + "       data.t_balanceNumber           AS t_balanceNumber,"
        + "\n" + "       data.t_fiIdLinked              AS t_fiIdLinked,"
        + "\n" + "       data.t_mainAccountNumber       AS t_accountNumberMain,"
        + "\n" + "       data.t_mainChapterNumber       AS t_chapterNumberMain,"
        + "\n" + "       data.t_mainFiId                AS t_fiIdMain,"
        + "\n" + "       data.t_mainAccountKind         AS t_accountKindMain,"
        + "\n" + "       data.t_mainRest                AS t_restMain,"
        + "\n" + "       data.t_mainRoubleRest          AS t_roubleRestMain,"
        + "\n" + "       data.t_reserveDate             AS t_reserveDate,"
        + "\n" + "       data.t_factReserve             AS t_reserveAmount,"
        + "\n" + "       data.t_calcReserve             AS t_calcReserve,"
        + "\n" + "       data.t_isHardFinancialState    AS t_isHardFinancialState,"
        + "\n" + "       data.t_termHardState           AS t_termHardState,"
        + "\n" + "       data.t_usedByPosition          AS t_usedByPosition"
        + "\n" + "  FROM (" + queryText + ") data"
        + "\n" + backOfficeAccountCheckerQuery;
    end;

    private macro constructorTDataSourceCbQueryTextMaker(parameters : TParameters)

        m_parameters = parameters;

        m_reportDate = parameters.getEndDate();

        TYPE_MAIN      = parameters.getAccountTypeMain();
        TYPE_PERCENT   = parameters.getAccountTypePercent();
        TYPE_SECURITY  = parameters.getAccountTypeSecurity();
        TYPE_GUARANTEE = parameters.getAccountTypeGuarantee();

        KA_A = parameters.getAccountKindActive();
        KA_P = parameters.getAccountKindPassive();

        m_percentRoleClause   = getRoleClause(OBJROLE_ACC_PERCENT,    3);
        m_securityRoleClause  = getRoleClause(OBJROLE_ACC_SECURITY,  10);

        m_standardFilterClause = getStandartFilterClause(parameters);

        m_optionClause = getOptionClause(parameters);

        m_nvpiClause = getNvpiClause();

        m_linkedNvpiClause = getLinkedNvpiClause();

        m_fiIdClause = getFiIdClause();

        m_linkedFiIdClause = getLinkedFiIdClause();

    end;

    constructorTDataSourceCbQueryTextMaker(parameters);

end;


private class (TDataSourceCbQueryTextMaker) TDataSourceCbQueryTextMaker_2811(parameters : TParameters)
    initTDataSourceCbQueryTextMaker(parameters);

    /**
     *  Текст запроса для отбора валютных счетов 1 главы (VVV_3, VVV_рез_бал_ГК)
     */
    macro getQueryText_VVV_3_VVV_rez_bal_gk()

        return          "/*Вал. счета 1 главы (VVV_3, VVV_рез_бал_ГК)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               // Счет с резервом, являющийся непереоцениваемым покрытием в VVV_3 не включается
               + "\n" + "           WHEN reserve.t_reserveDate IS NOT NULL"
               + "\n" + "            AND INSTR(account.t_type, cnst.getTA(" + TA_ESTIM + ")) != 0"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_rez_bal_gk())
               // Счет без резерва, являющийся непереоцениваемым покрытием в отчет не включается
               + "\n" + "           WHEN reserve.t_reserveDate IS NULL"
               + "\n" + "            AND INSTR(account.t_type, cnst.getTA(" + TA_ESTIM + ")) != 0"
               + "\n" + "           THEN CHR(0)"
               + "\n" + "           WHEN reserve.t_reserveDate IS NOT NULL"
               + "\n" + "            AND account.t_kind = " + getSqlChar(KA_A)
               + "\n" + "           THEN " + getSqlString(  getParameters().getCode_vvv_3()
                                                          + getParameters().getCode_vvv_rez_bal_gk()
                                                         )
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_3())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 1"
               + "\n" + "   AND NOT (account.t_balance IN ('52601', '52602'))"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    macro getQueryText_VVV_3_810_VVV_rez_bal_810()
        return          "/*Руб. счета без НВПИ из 1 главы (VVV_3_810, VVV_рез_бал_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       fininstr.t_faceValueFi                                                t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN reserve.t_reserveDate IS NOT NULL"
               + "\n" + "            AND account.t_kind = " + getSqlChar(KA_A)
               + "\n" + "           THEN " + getSqlString(  getParameters().getCode_vvv_3_810()
                                                          + getParameters().getCode_vvv_rez_bal_gk_810()
                                                         )
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_3_810())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       dfininstr_dbt fininstr,"
               + "\n" + "       v_rcb_f634_fininstr f634_fininstr"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink.t_role = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi = f634_fininstr.t_id"
               + "\n" + "   AND account.t_chapter = 1"
               + "\n" + "   AND NOT (account.t_balance IN ('52601', '52602'))"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(false)
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 1 с НВПИ (VVV_3_810, VVV_рез_бал_810)
     */
    macro getQueryText_VVV_3_810_VVV_rez_bal_810_nvpi()
        return          "/*Руб. счета с НВПИ из 1 главы (VVV_3_810, VVV_рез_бал_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN reserve.t_reserveDate IS NOT NULL"
               + "\n" + "            AND account.t_kind = " + getSqlChar(KA_A)
               + "\n" + "           THEN " + getSqlString(  getParameters().getCode_vvv_3_810_eq()
                                                          + getParameters().getCode_vvv_rez_bal_gk_810()
                                                         )
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_3_810_eq())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 1"
               + "\n" + "   AND NOT (account.t_balance IN ('52601', '52602'))"
               + "\n" + "   AND account.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 4 без НВПИ (VVV_4_810, VVV_5_810)
     */
    macro getQueryText_VVV_4_810_VVV_5_810()
        return          "/*Руб. счета без НВПИ из 4 главы (VVV_4_810, VVV_5_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       fininstr.t_faceValueFi                                                t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("930*,931*,932*,960*,961*,962*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4_810())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5_810())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       dfininstr_dbt fininstr,"
               + "\n" + "       v_rcb_f634_fininstr f634_fininstr"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink.t_role = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi = f634_fininstr.t_id"
               + "\n" + "   AND account.t_chapter = 4"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("930*,931*,932*,933*,934*,935*,936*,960*,961*,962*,963*,964*,965*,966*", "account.t_balance") + ")"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(false)
               + "\n" + "   AND " + m_optionClause + " = " + rcbSqlBool(false);
    end;

    /**
     *  Текст запроса для отбора валютных счетов 4 главы (VVV_4, VVV_5)
     */
    macro getQueryText_VVV_4_VVV_5()
        return          "/*Вал. счета 4 главы (VVV_4, VVV_5)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("930*,931*,932*,960*,961*,962*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 4"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("930*,931*,932*,933*,934*,935*,936*,960*,961*,962*,963*,964*,965*,966*", "account.t_balance") + ")"
               + "\n" + "   AND " + m_optionClause + " = " + rcbSqlBool(false);
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 4 с НВПИ (VVV_4_810, VVV_5_810)
     */
    macro getQueryText_VVV_4_810_VVV_5_810_nvpi()
        return          "/*Руб. счета с НВПИ из 4 главы (VVV_4_810, VVV_5_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("930*,931*,932*,960*,961*,962*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4_810_eq())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5_810_eq())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 4"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND account.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("930*,931*,932*,933*,934*,935*,936*,960*,961*,962*,963*,964*,965*,966*", "account.t_balance") + ")"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND " + m_optionClause + " = " + rcbSqlBool(false);
    end;
end;

private class (TDataSourceCbQueryTextMaker_2811) TDataSourceCbQueryTextMaker_3107(parameters : TParameters)
    initTDataSourceCbQueryTextMaker_2811(parameters);

    /**
     *  Текст запроса для отбора рублевых счетов главы 4 без НВПИ (VVV_4_810, VVV_5_810)
     */
    macro getQueryText_VVV_4_810_VVV_5_810()
        return          "/*Руб. счета без НВПИ из 4 главы (VVV_4_810, VVV_5_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       fininstr.t_faceValueFi                                                t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("939*,940*,941*,969*,970*,971*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4_810())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5_810())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       dfininstr_dbt fininstr,"
               + "\n" + "       v_rcb_f634_fininstr f634_fininstr"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink.t_role = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi = f634_fininstr.t_id"
               + "\n" + "   AND account.t_chapter = 4"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("939*,940*,941*,933*,934*,935*,936*,969*,970*,971*,963*,964*,965*,966*", "account.t_balance") + ")"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(false);
    end;

    /**
     *  Текст запроса для отбора валютных счетов 4 главы (VVV_4, VVV_5)
     */
    macro getQueryText_VVV_4_VVV_5()
        return          "/*Вал. счета 4 главы (VVV_4, VVV_5)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("939*,940*,941*,969*,970*,971*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 4"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("939*,940*,941*,933*,934*,935*,936*,969*,970*,971*,963*,964*,965*,966*", "account.t_balance") + ")";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 4 с НВПИ (VVV_4_810, VVV_5_810)
     */
    macro getQueryText_VVV_4_810_VVV_5_810_nvpi()
        return          "/*Руб. счета с НВПИ из 4 главы (VVV_4_810, VVV_5_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("939*,940*,941*,969*,970*,971*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4_810_eq())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5_810_eq())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter = 4"
               + "\n" + "   AND account.t_fiId = " + NATCUR
               + "\n" + "   AND account.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("939*,940*,941*,933*,934*,935*,936*,969*,970*,971*,963*,964*,965*,966*", "account.t_balance") + ")"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true);
    end;
end;

private class (TDataSourceCbQueryTextMaker_3107) TDataSourceCbQueryTextMaker_XXXX1(parameters : TParameters)
    initTDataSourceCbQueryTextMaker_3107(parameters);

    private macro getCategoryClause(objectType, categoryId, categoryValue)
        return   "EXISTS (SELECT 1"
        + "\n" + "          FROM drepcategory_vw category"
        + "\n" + "         WHERE account.t_objectid    = category.t_objectid"
        + "\n" + "           AND category.t_objectType = " + objectType
        + "\n" + "           AND category.t_id         = " + categoryId
        + "\n" + "           AND category.t_value      = " + getSqlString(categoryValue) + ")";
    end;

    /**
     *  Текст запроса для отбора валютных счетов 1 главы (VVV_3)
     */
    macro getQueryText_VVV_3()
        return          "/*Вал. счета 1 главы (VVV_3)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       0                                                                     t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       TO_DATE('01.01.0001', 'dd.mm.yyyy')                                   t_reserveDate,"
               + "\n" + "       " + getSqlString(getParameters().getCode_vvv_3()) + "                 t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter  = 1"
               + "\n" + "   AND NOT (account.t_balance IN ('52601', '52602'))"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND INSTR(account.t_type, cnst.getTA(4)) = 0"
               + "\n" + "   AND NOT (    (account.t_balance = '47410' OR account.t_balance = '47431')"
               + "\n" + "            AND (account.t_qualitycategory IN (4, 5)"
               + "\n" + "             OR " + getCategoryClause(4, 1, "Покрытые аккредитивы") + "))";
    end;

    /**
     *  Текст запроса для отбора валютных счетов 1 главы (VVV_рез_бал_ГК)
     */
    macro getQueryText_VVV_rez_bal_gk()
        return          "/*Вал. счета 1 главы (VVV_рез_бал_ГК)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_rez_bal_gk()) + "            t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter  = 1"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND reserve.t_reserveDate IS NOT NULL"
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    macro getQueryText_VVV_3_810()
        return          "/*Руб. счета без НВПИ из 1 главы (VVV_3_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + rcbSqlBool(false) + "                                                 t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       fininstr.t_faceValueFi                                                t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       0                                                                     t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlDate("01.01.0001") + "                                          t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_3_810()) + "                 t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       dfininstr_dbt fininstr,"
               + "\n" + "       v_rcb_f634_fininstr f634_fininstr"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId              = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType     = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId                 = objlink.t_id"
               + "\n" + "   AND objlink.t_type                  = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink.t_role                  = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi          = f634_fininstr.t_id"
               + "\n" + "   AND account.t_chapter               = 1"
               + "\n" + "   AND account.t_outRest              != 0"
               + "\n" + "   AND account.t_fiId                  = " + NATCUR
               + "\n" + "   AND (    account.t_kind     = " + getSqlChar(KA_A)
               + "\n" + "        AND account.t_balance != '52601')"
               + "\n" + "   AND (    account.t_kind     = " + getSqlChar(KA_P)
               + "\n" + "        AND account.t_balance != '52602')"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(false);
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 1 с НВПИ (VVV_3_810)
     */
    macro getQueryText_VVV_3_810_nvpi()
        return          "/*Руб. счета с НВПИ из 1 главы (VVV_3_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + rcbSqlBool(true) + "                                                  t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       0                                                                     t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlDate("01.01.0001") + "                                          t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_3_810_eq()) + "              t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest        != 0"
               + "\n" + "   AND account.t_chapter         = 1"
               + "\n" + "   AND account.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND account.t_fiId            = " + NATCUR
               + "\n" + "   AND NOT (account.t_balance IN ('52601', '52602'))"
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true);
    end;

    macro getQueryText_VVV_3_810_revaluation()
        return          "/*Руб. счета из 1 главы (VVV_3_810_переоценка)*/"
               + "\n" + "SELECT DISTINCT                                                                                            "
               + "\n" + "       account.t_account                                                     t_accountNumber,              "
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       TO_NUMBER(SUBSTR(linkedObjects.t_connectObjectId, 3, 7), 'FM0xxxxxx') t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       rsb_fiinstr.convSumType(account.t_outRest, account.t_fiId, "
               + "\n" + "                                     TO_NUMBER(SUBSTR(linkedObjects.t_connectObjectId, 3, 7), 'FM0xxxxxx'),  "
               + "\n" + "                                   " + RATETYPE_CB + ","
               + "\n" + "                                     account.t_lastMovementDate)             t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       0                                                                     t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "   " + getSqlDate("01.01.0001") + "                                          t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_3_810_reval()) + "           t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account, "
               + "\n" + "       drepLinkedObjects_vw linkedObjects "
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectid = linkedObjects.t_id"
               + "\n" + "   AND linkedObjects.t_type = rep_const.get().cb.objectTypes.account"
               + "\n" + "   AND t_role IN (rep_const.get().cb.objectRoles.account.positiveRevaluation,"
               + "\n" + "                  rep_const.get().cb.objectRoles.account.negativeRevaluation)"
               + "\n" + "   AND linkedObjects.t_isInstalledForEndDate = 1     "
               + "\n" + "   AND account.t_chapter  = 1"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_fiId     = " + NATCUR;
    end;

    macro getQueryText_VVV_rez_bal_810()
        return          "/*Руб. счета без НВПИ из 1 главы (VVV_рез_бал_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + rcbSqlBool(false) + "                                                 t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       fininstr.t_faceValueFi                                                t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_rez_bal_gk_810()) + "        t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       dfininstr_dbt fininstr,"
               + "\n" + "       v_rcb_f634_fininstr f634_fininstr"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId              = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType     = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId                 = objlink.t_id"
               + "\n" + "   AND objlink.t_type                  = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink.t_role                  = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi          = f634_fininstr.t_id"
               + "\n" + "   AND account.t_chapter               = 1"
               + "\n" + "   AND account.t_outRest              != 0"
               + "\n" + "   AND account.t_fiId                  = " + NATCUR
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(false)
               + "\n" + "   AND reserve.t_reserveDate IS NOT NULL"
               + "\n" + "   AND reserve.t_connectAccountId(+)   = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 1 с НВПИ (VVV_рез_бал_810)
     */
    macro getQueryText_VVV_rez_bal_810_nvpi()
        return          "/*Руб. счета с НВПИ из 1 главы (VVV_рез_бал_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + rcbSqlBool(true) + "                                                  t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_rez_bal_gk_810()) + "        t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest        != 0"
               + "\n" + "   AND account.t_chapter         = 1"
               + "\n" + "   AND account.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND account.t_fiId            = " + NATCUR
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND reserve.t_reserveDate IS NOT NULL"
               + "\n" + "   AND reserve.t_connectAccountId(+) = account.t_accountId";
    end;

    /**
     *  Текст запроса для отбора валютных счетов 4 главы (VVV_4, VVV_5)
     */
    macro getQueryText_VVV_4_VVV_5()
        return          "/*Вал. счета 4 главы (VVV_4, VVV_5)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "   " + m_fiIdClause + "                                                      t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_nvpiClause + "                                                      t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("939*,940*,941*,969*,970*,971*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND account.t_chapter  = 4"
               + "\n" + "   AND account.t_fiId <> " + NATCUR
               + "\n" + "   AND NOT " + getCategoryClause(4, 1, "Счет не вкл. в ОВП")
               + "\n" + "   AND (" + convertMaskToSqlFormat("939*,940*,941*,933*,934*,935*,936*,969*,970*,971*,963*,964*,965*,966*", "account.t_balance") + ")";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 4 без НВПИ (VVV_4_810, VVV_5_810)
     */
    macro getQueryText_VVV_4_810_VVV_5_810()
        return          "/*Руб. счета без НВПИ из 4 главы (VVV_4_810, VVV_5_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       0                                                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + rcbSqlBool(false) + "                                                 t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       fininstr.t_faceValueFi                                                t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("939*,940*,941*,969*,970*,971*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4_810())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5_810())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       dfininstr_dbt fininstr,"
               + "\n" + "       v_rcb_f634_fininstr f634_fininstr"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId              = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType     = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId                 = objlink.t_id"
               + "\n" + "   AND objlink.t_type                  = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink.t_role                  = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi          = f634_fininstr.t_id"
               + "\n" + "   AND account.t_chapter               = 4"
               + "\n" + "   AND account.t_outRest              != 0"
               + "\n" + "   AND account.t_fiId                  = " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("939*,940*,941*,933*,934*,935*,936*,969*,970*,971*,963*,964*,965*,966*", "account.t_balance") + ")"
               + "\n" + "   AND NOT " + getCategoryClause(4, 1, "Счет не вкл. в ОВП")
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(false);
    end;

    /**
     *  Текст запроса для отбора рублевых счетов главы 4 с НВПИ (VVV_4_810, VVV_5_810)
     */
    macro getQueryText_VVV_4_810_VVV_5_810_nvpi()
        return          "/*Руб. счета с НВПИ из 4 главы (VVV_4_810, VVV_5_810)*/"
               + "\n" + "SELECT account.t_account                                                     t_accountNumber,"
               + "\n" + "       account.t_chapter                                                     t_chapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_fiId,"
               + "\n" + "       account.t_kind                                                        t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_MAIN) + "                                             t_accountType,"
               + "\n" + "       account.t_outRest                                                     t_rest,"
               + "\n" + "       account.t_outCoverRest                                                t_roubleRest,"
               + "\n" + "       account.t_outEquivalentRest                                           t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + rcbSqlBool(true) + "                                                  t_hasNvpi,"
               + "\n" + "       account.t_balance                                                     t_balanceNumber,"
               + "\n" + "       account.t_equivalentFiId                                              t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       NULL                                                                  t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       NULL                                                                  t_reserveDate,"
               + "\n" + "       CASE"
               + "\n" + "           WHEN (" + convertMaskToSqlFormat("939*,940*,941*,969*,970*,971*", "account.t_balance") + ")"
               + "\n" + "           THEN " + getSqlString(getParameters().getCode_vvv_4_810_eq())
               + "\n" + "           ELSE " + getSqlString(getParameters().getCode_vvv_5_810_eq())
               + "\n" + "        END                                                                  t_usedByPosition"
               + "\n" + "  FROM drepaccount_vw account"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_outRest        != 0"
               + "\n" + "   AND account.t_chapter         = 4"
               + "\n" + "   AND account.t_fiId            = " + NATCUR
               + "\n" + "   AND account.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND (" + convertMaskToSqlFormat("939*,940*,941*,933*,934*,935*,936*,969*,970*,971*,963*,964*,965*,966*", "account.t_balance") + ")"
               + "\n" + "   AND NOT " + getCategoryClause(4, 1, "Счет не вкл. в ОВП")
               + "\n" + "   AND " + m_nvpiClause + " = " + rcbSqlBool(true);
    end;

    /**
     *  Текст запроса для отбора валютных счетов обеспечения (VVV_ГарантииПолуч_ГК)
     */
    macro getQueryText_VVV_garantiipolu4()
        return          "/*Вал. счета обеспечения с вал. осн. счетом (VVV_ГарантииПолуч_ГК)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "   " + m_linkedFiIdClause + "                                                t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_SECURITY) + "                                         t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       linkedAccount.t_outEquivalentRest                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       account.t_calcReserveSecAmount                                        t_calcReserve,"
               + "\n" + "       NVL((SELECT t_value"
               + "\n" + "              FROM drepcategory_vw"
               + "\n" + "             WHERE t_objectType = 3"
               + "\n" + "               AND t_id = 22"
               + "\n" + "               AND t_isInstalledForEndDate = 1"
               + "\n" + "               AND t_objectid = rsb_rep_pt.makepartyid(linkedAccount.t_partyId)),"
               + "\n" + "           0)                                                                t_isHardFinancialState,"
               + "\n" + "       " + getSqlDate(m_reportDate) + " -"
               + "\n" + "       NVL((SELECT t_validFromDate"
               + "\n" + "             FROM drepcategory_vw"
               + "\n" + "            WHERE t_objectType = 3"
               + "\n" + "              AND t_id = 22"
               + "\n" + "              AND t_isInstalledForEndDate = 1"
               + "\n" + "              AND t_objectid = rsb_rep_pt.makepartyid(linkedAccount.t_partyId)),"
               + "\n" + "           " + getSqlDate(m_reportDate) + ")                                 t_termHardState,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_garantiipolu4()) + "         t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountID"
               + "\n" + "   AND (   account.t_chapter = 1"
               + "\n" + "        OR (    account.t_chapter = 3"
               + "\n" + "            AND account.t_balance = '91315'))"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_balance = '91414'"
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_fiId <> " + NATCUR
               + "\n" + "   AND reserve.t_endDatereserveamount != 0";
    end;

    /**
     *  Текст запроса для отбора валютных счетов залога (VVV_Залог_ГК)
     */
    macro getQueryText_VVV_zalog_gk()
        return          "/*Вал. счета залога с вал. осн. счетом (vvv_Залог_ГК)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "   " + m_linkedFiIdClause + "                                                t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_GUARANTEE) + "                                        t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       linkedAccount.t_outEquivalentRest                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       account.t_calcReserveSecAmount                                        t_calcReserve,"
               + "\n" + "       NVL((SELECT t_value"
               + "\n" + "              FROM drepcategory_vw"
               + "\n" + "             WHERE t_objectType = 3"
               + "\n" + "               AND t_id = 22"
               + "\n" + "               AND t_isInstalledForEndDate = 1"
               + "\n" + "               AND t_objectid = rsb_rep_pt.makepartyid(linkedAccount.t_partyId)),"
               + "\n" + "           0)                                                                t_isHardFinancialState,"
               + "\n" + "       " + getSqlDate(m_reportDate) + " -"
               + "\n" + "       NVL((SELECT t_validFromDate"
               + "\n" + "             FROM drepcategory_vw"
               + "\n" + "            WHERE t_objectType = 3"
               + "\n" + "              AND t_id = 22"
               + "\n" + "              AND t_isInstalledForEndDate = 1"
               + "\n" + "              AND t_objectid = rsb_rep_pt.makepartyid(linkedAccount.t_partyId)),"
               + "\n" + "           " + getSqlDate(m_reportDate) + ")                                 t_termHardState,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_zalog_gk()) + "              t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountID"
               + "\n" + "   AND (   account.t_chapter = 1"
               + "\n" + "        OR (    account.t_chapter = 3"
               + "\n" + "            AND account.t_balance = '91315'))"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_balance IN ('91311', '91312', '91313')"
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_fiId <> " + NATCUR
               + "\n" + "   AND reserve.t_endDatereserveamount != 0";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов обеспечения без НВПИ (VVV_ГарПолуч_810_ГК)
     */
    macro getQueryText_VVV_garpolu4_810_gk()
        return          "/*Руб. счета обеспечения с вал. осн. счетом (VVV_ГарантииПолуч_810_ГК)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "   " + m_linkedFiIdClause + "                                                t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_SECURITY) + "                                         t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       linkedAccount.t_outEquivalentRest                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       account.t_calcReserveSecAmount                                        t_calcReserve,"
               + "\n" + "       NVL((SELECT t_value"
               + "\n" + "              FROM drepcategory_vw"
               + "\n" + "             WHERE t_objectType = 3"
               + "\n" + "               AND t_id = 22"
               + "\n" + "               AND t_isInstalledForEndDate = 1"
               + "\n" + "               AND t_objectid = rsb_rep_pt.makepartyid(linkedAccount.t_partyId)),"
               + "\n" + "           0)                                                                t_isHardFinancialState,"
               + "\n" + "       " + getSqlDate(m_reportDate) + " -"
               + "\n" + "       NVL((SELECT t_validFromDate"
               + "\n" + "             FROM drepcategory_vw"
               + "\n" + "            WHERE t_objectType = 3"
               + "\n" + "              AND t_id = 22"
               + "\n" + "              AND t_isInstalledForEndDate = 1"
               + "\n" + "              AND t_objectid = rsb_rep_pt.makepartyid(linkedAccount.t_partyId)),"
               + "\n" + "           " + getSqlDate(m_reportDate) + ")                                 t_termHardState,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_garpolu4_810()) + "          t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountID"
               + "\n" + "   AND (   account.t_chapter = 1"
               + "\n" + "        OR (    account.t_chapter = 3"
               + "\n" + "            AND account.t_balance = '91315'))"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_balance = '91414'"
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_isOpenedAtEndDate = 1"
               + "\n" + "   AND linkedAccount.t_outRest != 0"
               + "\n" + "   AND (   (    linkedAccount.t_fiId = " + NATCUR
               + "\n" + "            AND EXISTS(SELECT 1 "
               + "\n" + "                         FROM dreplinkedobjects_vw objlink_fi,"
               + "\n" + "                              dfininstr_dbt fininstr,"
               + "\n" + "                              v_rcb_f634_fininstr f634_fininstr"
               + "\n" + "                        WHERE linkedAccount.t_objectId = objlink_fi.t_connectObjectId"
               + "\n" + "   AND objlink_fi.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND fininstr.t_fiId = objlink_fi.t_id"
               + "\n" + "   AND objlink_fi.t_type = " + RCB_OBJTYPE_AVOIRISS
               + "\n" + "   AND objlink_fi.t_role = " + RCB_OBJROLE_FININSTR
               + "\n" + "   AND objlink_fi.t_isInstalledForEndDate = 1"
               + "\n" + "   AND fininstr.t_faceValueFi = f634_fininstr.t_id"
               + "\n" + "                       )"
               + "\n" + "            )"
               + "\n" + "        OR (   linkedAccount.t_equivalentFiId != " + NATCUR
               + "\n" + "           AND ("
               + "\n" + "                CASE"
               + "\n" + "                    WHEN INSTR(linkedAccount.t_type,'В') = 0"     //счета НВПИ
               + "\n" + "                    THEN " + rcbSqlBool(false)
               + "\n" + "                    ELSE " + rcbSqlBool(true)
               + "\n" + "                END"
               + "\n" + "               ) = " + rcbSqlBool(true)
               + "\n" + "           )"
               + "\n" + "       )"
               + "\n" + "   AND reserve.t_endDatereserveamount != 0";    end;

    /**
     *  Текст запроса для отбора рублевых счетов обеспечения с НВПИ (VVV_ГарПолуч_810_ГК)
     */
    macro getQueryText_VVV_garpolu4_810_gk_nvpi()
        return          "/*Руб. счета обеспечения с НВПИ с вал. осн. счетом (VVV_ГарПолуч_810_ГК)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "       linkedAccount.t_fiId                                                  t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_SECURITY) + "                                         t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       linkedAccount.t_outEquivalentRest                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       linkedAccount.t_equivalentFiId                                        t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       0                                                                     t_calcReserve,"
               + "\n" + "       0                                                                     t_isHardFinancialState,"
               + "\n" + "       0                                                                     t_termHardState,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_garpolu4_810_eq()) + "       t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND " + m_linkedNvpiClause + " = " + rcbSqlBool(true)
               + "\n" + "   AND account.t_outCoverRest != 0"
               + "\n" + "   AND linkedAccount.t_outCoverRest != 0"
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_balance = '91414'"
               + "\n" + "   AND linkedAccount.t_fiId = " + NATCUR
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountId"
               + "\n" + "   AND reserve.t_endDateReserveAmount != 0";
    end;

    /**
     *  Текст запроса для отбора рублевых счетов залога с НВПИ (VVV_Залог_810)
     */
    macro getQueryText_VVV_zalog_810()
        return          "/*Вал. счета обеспечения с вал. осн. счетом (VVV_Залог_810)*/"
               + "\n" + "SELECT linkedAccount.t_account                                               t_accountNumber,"
               + "\n" + "       linkedAccount.t_chapter                                               t_chapterNumber,"
               + "\n" + "   " + m_linkedFiIdClause + "                                                t_fiId,"
               + "\n" + "       linkedAccount.t_kind                                                  t_accountKind,"
               + "\n" + "   " + getSqlChar(TYPE_GUARANTEE) + "                                        t_accountType,"
               + "\n" + "       linkedAccount.t_outRest                                               t_rest,"
               + "\n" + "       linkedAccount.t_outCoverRest                                          t_roubleRest,"
               + "\n" + "       linkedAccount.t_outEquivalentRest                                     t_equivalentRest,"
               + "\n" + "   " + m_optionClause + "                                                    t_isOption,"
               + "\n" + "   " + m_linkedNvpiClause + "                                                t_hasNvpi,"
               + "\n" + "       linkedAccount.t_balance                                               t_balanceNumber,"
               + "\n" + "       0                                                                     t_fiIdLinked,"
               + "\n" + "       account.t_account                                                     t_mainAccountNumber,"
               + "\n" + "       account.t_chapter                                                     t_mainChapterNumber,"
               + "\n" + "       account.t_fiId                                                        t_mainFiId,"
               + "\n" + "       account.t_kind                                                        t_mainAccountKind,"
               + "\n" + "       account.t_outRest                                                     t_mainRest,"
               + "\n" + "       account.t_outCoverRest                                                t_mainRoubleRest,"
               + "\n" + "       reserve.t_endDateReserveAmount                                        t_factReserve,"
               + "\n" + "       account.t_calcReserveSecAmount                                        t_calcReserve,"
               + "\n" + "       NVL((SELECT t_value"
               + "\n" + "              FROM drepcategory_vw"
               + "\n" + "             WHERE t_objectType = 3"
               + "\n" + "               AND t_id = 22"
               + "\n" + "               AND t_isInstalledForEndDate = 1"
               + "\n" + "               AND t_objectid = rsb_rep_pt.makepartyid(linkedAccount.t_partyId)),"
               + "\n" + "           0)                                                                t_isHardFinancialState,"
               + "\n" + "       " + getSqlDate(m_reportDate) + " -"
               + "\n" + "       NVL((SELECT t_validFromDate"
               + "\n" + "             FROM drepcategory_vw"
               + "\n" + "            WHERE t_objectType = 3"
               + "\n" + "              AND t_id = 22"
               + "\n" + "              AND t_isInstalledForEndDate = 1"
               + "\n" + "              AND t_objectid = rsb_rep_pt.makepartyid(linkedAccount.t_partyId)),"
               + "\n" + "           " + getSqlDate(m_reportDate) + ")                                 t_termHardState,"
               + "\n" + "       reserve.t_reserveDate                                                 t_reserveDate,"
               + "\n" + "   " + getSqlString(getParameters().getCode_vvv_zalog_810()) + "             t_usedByPosition"
               + "\n" + "  FROM dreplinkedobjects_vw objlink,"
               + "\n" + "       drepaccount_vw account,"
               + "\n" + "       drepreserveaccount_vw reserve,"
               + "\n" + "       drepaccount_vw linkedAccount"
               + "\n" + " WHERE " + m_standardFilterClause
               + "\n" + "   AND account.t_objectId = objlink.t_connectObjectId"
               + "\n" + "   AND linkedAccount.t_objectId = objlink.t_id"
               + "\n" + "   AND reserve.t_connectAccountId = account.t_accountID"
               + "\n" + "   AND (   account.t_chapter = 1"
               + "\n" + "        OR (    account.t_chapter = 3"
               + "\n" + "            AND account.t_balance = '91315'))"
               + "\n" + "   AND objlink.t_connectObjectType = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND objlink.t_type = " + RCB_OBJTYPE_ACCOUNT
               + "\n" + "   AND " + m_securityRoleClause
               + "\n" + "   AND linkedAccount.t_chapter = 3"
               + "\n" + "   AND linkedAccount.t_balance IN('91311', '91312', '91313')"
               + "\n" + "   AND objlink.t_isInstalledForEndDate = 1"
               + "\n" + "   AND account.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_outRest != 0"
               + "\n" + "   AND linkedAccount.t_fiId = " + NATCUR
               + "\n" + "   AND linkedAccount.t_equivalentFiId != " + NATCUR
               + "\n" + "   AND ("
               + "\n" + "        CASE"
               + "\n" + "            WHEN INSTR(linkedAccount.t_type,'В') = 0"     //счета НВПИ
               + "\n" + "            THEN " + rcbSqlBool(false)
               + "\n" + "            ELSE " + rcbSqlBool(true)
               + "\n" + "        END"
               + "\n" + "       ) = " + rcbSqlBool(true)
               + "\n" + "   AND reserve.t_endDatereserveamount != 0";
    end;
end;

/**
 *  Источник данных ГКБО
 */
private class (TDataSourceBase) TDataSourceCb(parameters : TParameters)

    private macro constructorTDataSourceCb(parameters : TParameters)

        initTDataSourceBase(BoCb, parameters);

        var queryText = TDataSourceCbQueryTextMaker(parameters);

        // Текст запроса для отбора валютных счетов 1 главы (VVV_3, VVV_рез_бал_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_VVV_rez_bal_gk());

        // Текст запроса для отбора валютных счетов 4 главы (VVV_4, VVV_5)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_VVV_5());

        // Текст запроса для отбора валютных счетов 3 главы (VVV_Гар_ГК, VVV_ГарРез_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_gar_gk_VVV_garrez_gk(), true);

        // Текст запроса для отбора валютных счетов 3 главы (VVV_Аккредитив)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_akkreditiv());

        // Текст запроса для отбора валютных счетов процентов (VVV_10)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_10(), true);

        // Текст запроса для отбора валютных счетов обеспечения (VVV_ГарантииПолуч_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garantiipolu4(), true);

        // Текст запроса для отбора валютных счетов залога (VVV_Залог_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_zalog_gk());

        // Текст запроса для отбора рублевых счетов главы 1 без НВПИ (VVV_3_810, VVV_рез_бал_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_810_VVV_rez_bal_810());

        // Текст запроса для отбора рублевых счетов главы 1 с НВПИ (VVV_3_810, VVV_рез_бал_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_810_VVV_rez_bal_810_nvpi());

        // Текст запроса для отбора рублевых счетов главы 4 без НВПИ (VVV_4_810, VVV_5_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_810_VVV_5_810());

        // Текст запроса для отбора рублевых счетов главы 4 с НВПИ (VVV_4_810, VVV_5_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_810_VVV_5_810_nvpi());

        // Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Аккредитив_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_akkreditiv_810());

        // Текст запроса для отбора рублевых счетов обеспечения (VVV_ГарПолуч_810_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garpolu4_810_gk(), true);

        // Текст запроса для отбора рублевых счетов обеспечения с НВПИ (VVV_ГарПолуч_810_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garpolu4_810_gk_nvpi(), true);

        // Текст запроса для отбора рублевых счетов залога с НВПИ (VVV_Залог_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_zalog_810());

        // Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Гар_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_gar_810());

    end;

    constructorTDataSourceCb(parameters);

end;

private class (TDataSourceCb) TDataSourceCb_2811(parameters : TParameters)

    initTDataSourceCb(parameters);

    private macro constructorTDataSourceCb(parameters : TParameters)

        initTDataSourceBase(BoCb, parameters);

        var queryText = TDataSourceCbQueryTextMaker_2811(parameters);

        // Текст запроса для отбора валютных счетов 1 главы (VVV_3, VVV_рез_бал_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_VVV_rez_bal_gk());

        // Текст запроса для отбора валютных счетов 4 главы (VVV_4, VVV_5)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_VVV_5());

        // Текст запроса для отбора валютных счетов 3 главы (VVV_Гар_ГК, VVV_ГарРез_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_gar_gk_VVV_garrez_gk(), true);

        // Текст запроса для отбора валютных счетов 3 главы (VVV_Аккредитив)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_akkreditiv());

        // Текст запроса для отбора валютных счетов процентов (VVV_10)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_10(), true);

        // Текст запроса для отбора валютных счетов обеспечения (VVV_ГарантииПолуч_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garantiipolu4(), true);

        // Текст запроса для отбора валютных счетов залога (VVV_Залог_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_zalog_gk());

        // Текст запроса для отбора рублевых счетов главы 1 без НВПИ (VVV_3_810, VVV_рез_бал_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_810_VVV_rez_bal_810());

        // Текст запроса для отбора рублевых счетов главы 1 с НВПИ (VVV_3_810, VVV_рез_бал_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_810_VVV_rez_bal_810_nvpi());

        // Текст запроса для отбора рублевых счетов главы 4 без НВПИ (VVV_4_810, VVV_5_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_810_VVV_5_810());

        // Текст запроса для отбора рублевых счетов главы 4 с НВПИ (VVV_4_810, VVV_5_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_810_VVV_5_810_nvpi());

        // Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Аккредитив_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_akkreditiv_810());

        // Текст запроса для отбора рублевых счетов обеспечения (VVV_ГарПолуч_810_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garpolu4_810_gk(), true);

        // Текст запроса для отбора рублевых счетов обеспечения с НВПИ (VVV_ГарПолуч_810_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garpolu4_810_gk_nvpi(), true);

        // Текст запроса для отбора рублевых счетов залога с НВПИ (VVV_Залог_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_zalog_810());

        // Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Гар_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_gar_810());

    end;
end;

private class (TDataSourceCb) TDataSourceCb_3107(parameters : TParameters)

    initTDataSourceCb(parameters);

    private macro constructorTDataSourceCb(parameters : TParameters)

        initTDataSourceBase(BoCb, parameters);

        var queryText = TDataSourceCbQueryTextMaker_3107(parameters);

        // Текст запроса для отбора валютных счетов 1 главы (VVV_3, VVV_рез_бал_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_VVV_rez_bal_gk());

        // Текст запроса для отбора валютных счетов 4 главы (VVV_4, VVV_5)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_VVV_5());

        // Текст запроса для отбора валютных счетов 3 главы (VVV_Гар_ГК, VVV_ГарРез_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_gar_gk_VVV_garrez_gk(), true);

        // Текст запроса для отбора валютных счетов 3 главы (VVV_Аккредитив)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_akkreditiv());

        // Текст запроса для отбора валютных счетов процентов (VVV_10)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_10(), true);

        // Текст запроса для отбора валютных счетов обеспечения (VVV_ГарантииПолуч_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garantiipolu4(), true);

        // Текст запроса для отбора валютных счетов залога (VVV_Залог_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_zalog_gk());

        // Текст запроса для отбора рублевых счетов главы 1 без НВПИ (VVV_3_810, VVV_рез_бал_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_810_VVV_rez_bal_810());

        // Текст запроса для отбора рублевых счетов главы 1 с НВПИ (VVV_3_810, VVV_рез_бал_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_810_VVV_rez_bal_810_nvpi());

        // Текст запроса для отбора рублевых счетов главы 4 без НВПИ (VVV_4_810, VVV_5_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_810_VVV_5_810());

        // Текст запроса для отбора рублевых счетов главы 4 с НВПИ (VVV_4_810, VVV_5_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_810_VVV_5_810_nvpi());

        // Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Аккредитив_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_akkreditiv_810());

        // Текст запроса для отбора рублевых счетов обеспечения (VVV_ГарПолуч_810_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garpolu4_810_gk(), true);

        // Текст запроса для отбора рублевых счетов обеспечения с НВПИ (VVV_ГарПолуч_810_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garpolu4_810_gk_nvpi(), true);

        // Текст запроса для отбора рублевых счетов залога с НВПИ (VVV_Залог_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_zalog_810());

        // Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Гар_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_gar_810());

    end;
end;

private class (TDataSourceCb) TDataSourceCb_XXXX1(parameters : TParameters)

    initTDataSourceCb(parameters);

    private macro constructorTDataSourceCb(parameters : TParameters)

        initTDataSourceBase(BoCb, parameters);

        var queryText = TDataSourceCbQueryTextMaker_XXXX1(parameters);

        // Текст запроса для отбора валютных счетов 1 главы (VVV_3)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3());

        // Текст запроса для отбора валютных счетов 1 главы (VVV_рез_бал_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_rez_bal_gk());

        // Текст запроса для отбора валютных счетов 4 главы (VVV_4, VVV_5)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_VVV_5());

        // Текст запроса для отбора валютных счетов 3 главы (VVV_Гар_ГК, VVV_ГарРез_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_gar_gk_VVV_garrez_gk(), true);

        // Текст запроса для отбора валютных счетов 3 главы (VVV_Аккредитив)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_akkreditiv());

        // Текст запроса для отбора валютных счетов процентов (VVV_10)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_10(), true);

        // Текст запроса для отбора валютных счетов обеспечения (VVV_ГарантииПолуч_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garantiipolu4(), true);

        // Текст запроса для отбора валютных счетов залога (VVV_Залог_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_zalog_gk());

        // Текст запроса для отбора рублевых счетов главы 1 без НВПИ (VVV_3_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_810());

        // Текст запроса для отбора рублевых счетов главы 1 без НВПИ (VVV_рез_бал_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_rez_bal_810());

        // Текст запроса для отбора рублевых счетов главы 1 с НВПИ (VVV_3_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_810_nvpi());

        // Текст запроса для отбора рублевых счетов главы 1 с НВПИ (VVV_рез_бал_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_rez_bal_810_nvpi());

        // Текст запроса для отбора рублевых счетов главы 4 без НВПИ (VVV_4_810, VVV_5_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_810_VVV_5_810());

        // Текст запроса для отбора рублевых счетов главы 4 с НВПИ (VVV_4_810, VVV_5_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_4_810_VVV_5_810_nvpi());

        // Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Аккредитив_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_akkreditiv_810());

        // Текст запроса для отбора рублевых счетов обеспечения (VVV_ГарПолуч_810_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garpolu4_810_gk(), true);

        // Текст запроса для отбора рублевых счетов обеспечения с НВПИ (VVV_ГарПолуч_810_ГК)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_garpolu4_810_gk_nvpi(), true);

        // Текст запроса для отбора рублевых счетов залога с НВПИ (VVV_Залог_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_zalog_810());

        // Текст запроса для отбора рублевых счетов главы 3 с НВПИ (VVV_Гар_810)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_gar_810());

        // Текст запроса для отбора рублевых счетов главы 1 (VVV_3_810_переоценка)
        m_container[m_container.size] = queryText.makeQueryText(queryText.getQueryText_VVV_3_810_revaluation());
    end;
end;

/**
 *  Контроллер извлечения данных
 */
private class TDataExtractionController(parameters : TParametersCb)

    private var m_extractant;

    macro process()
        m_extractant.extract();
    end;

    private macro constructor(parameters : TParametersCb)
        m_extractant = TDataExtractant(TTempTableCb(), TDataSourceCb(parameters));
    end;

    constructor(parameters);

end;

/**
 *  Контроллер извлечения данных по указанию 2811
 */
private class (TDataExtractionController) TDataExtractionController_2811(parameters : TParametersCb)
    initTDataExtractionController(parameters);

    private macro constructor(parameters : TParametersCb)
        m_extractant = TDataExtractant(TTempTableCb(), TDataSourceCb_2811(parameters));
    end;

end;

/**
 *  Контроллер извлечения данных по указанию 3107
 */
private class (TDataExtractionController) TDataExtractionController_3107(parameters : TParametersCb)
    initTDataExtractionController(parameters);

    private macro constructor(parameters : TParametersCb)
        m_extractant = TDataExtractant(TTempTableCb(), TDataSourceCb_3107(parameters));
    end;

end;

/**
 *  Контроллер извлечения данных по указанию XXXX-У1
 */
private class (TDataExtractionController) TDataExtractionController_XXXX1(parameters : TParametersCb)
    initTDataExtractionController(parameters);

    private macro constructor(parameters : TParametersCb)
        m_extractant = TDataExtractant(TTempTableCb(), TDataSourceCb_XXXX1(parameters));
    end;

end;

/**
 *  Основная функция
 */
macro main(report : Object)

    var profiler = TSQLProfiler(getTxtFileName("!calc_f634cb_profile"));
    profiler.clear();
    profiler.on();

    var parameters = TParametersCb(report);

    begAction(2000, "Получение данных ГКБО (" + string(parameters.getEndDate() : f) + ")");

    if (rcbApplication().currentReport().context.period.EndDate >= RCB_016_41_4_4786_DATE)
        TDataExtractionController_XXXX1(parameters).process();
    elif (rcbApplication().currentReport().context.period.EndDate >= RCB_I3107_DATE)
        TDataExtractionController_3107(parameters).process();
    elif (rcbApplication().currentReport().context.period.EndDate >= RCB_I2811_DATE)
        TDataExtractionController_2811(parameters).process();
    else
        TDataExtractionController(parameters).process();
    end;

    endAction(1);

    onError(error)
        exceptionMessage(error);
        exit(1);
end;
