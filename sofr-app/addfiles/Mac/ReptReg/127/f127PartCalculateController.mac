/*
$Name: f127PartCalculateController.mac
$Module: Регламентируемая отчетность
$Description: Форма 127. Классы контроллеров расчета разделов.
*/

private class (RcbPartCalculateController) TF127PartCalculateController(reportCalculateController: Object, partIdentifier: String)
    private var m_protocolView;
    private var m_dataProtocolView;
    private var m_datasource: Object;

    private macro getCalculateAttributeData(identifier: String, functionName: String, dependencesAttributeIdPool: RcbArray)
        var result: Object = NULL;
        var dependencesAttributePool = RcbArray();

        if (dependencesAttributeIdPool == null)
            dependencesAttributeIdPool = RcbArray();
        end;

        dependencesAttributeIdPool.moveFirst();

        while (dependencesAttributeIdPool.moveNext())
            dependencesAttributePool.push_back(m_part.getAttribute(dependencesAttributeIdPool.getCurrentItem()));
        end;

        result = RcbCalculationAttributeData(m_part.getAttribute(identifier),
                                             RcbArray().initialize(RcbCalculationData(r2m(this, functionName), 
                                                                                      RcbArray().initialize(identifier)
                                                                                     )
                                                                  ),
                                             RcbDependencesData(dependencesAttributePool)
                                             );

        return result;
    end;

    /**
     * Рассчитать атрибут
     *
     * @param identifier String Строка
     */
    macro calculateAttribute(identifier: String)
        throw(TPureVirtualMethodCallException("TF127PartCalculateController::calculateAttribute"));
    end;

    macro execute()
        throw(TPureVirtualMethodCallException("TF127PartCalculateController::execute"));
    end;

    macro getDataProtocolView()
        return m_dataProtocolView;
    end;

    private macro constructorTF127PartCalculateController(reportCalculateController: Object, partIdentifier: String)
        initRcbPartCalculateController(reportCalculateController, partIdentifier);
        m_protocolView = m_dataSources.getProtocolView();
        // m_dataProtocolView = m_protocolView.getDataProtocolView("lines");
    end;

    constructorTF127PartCalculateController(reportCalculateController, partIdentifier);
end;

class (TF127PartCalculateController) TF127PartDataCalculateController(reportCalculateController: Object)
    private macro getBasisPoints()
        return 0.04;
    end;

    private macro calculateRow_1_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForOneColumn(row, m_report.getLastColumn(), null, row, m_report.getLastColumn());
    end;

    private macro calculateRow_1_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForActive(row, m_report.getLastColumn(), m_report.getLastColumn(), null, row, m_report.getLastColumn());

        dataSource.insertRowDataForActive(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, null, row, "3-15");

    end;

    private macro calculateRow_1_3_1(row : String)
    end;

    private macro calculateRow_1_3_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("AND").isJuridical("credit"), row, "3-16");
    end;

    private macro calculateRow_1_3_2_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        filter.op("AND").isJuridical("credit");
        filter.op("AND").op("(").creditType("credit", LO_GUARANTEE);
                    filter.op("OR").creditType("credit", LO_OVERDRAFT);
                    filter.op("OR").op("(").creditType("credit", LO_CREDIT).op("AND").issueType("credit", 6 /* LoansConst.cf_posterestante - до востребования */).op(")");
                    filter.op(")");

        dataSource.insertRowData(row, filter, row, "3-16");
    end;

    private macro calculateRow_1_3_3(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("AND").isPhisical("credit"), row, "3-16");
    end;

    private macro calculateRow_1_3_3_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("AND").isPhisical("credit").op("AND").creditType("credit", LO_KARTA), row, "3-16");
    end;

    private macro calculateRow_1_3_3_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("AND").isPhisical("credit").op("AND").creditType("credit", LO_KARTA).op("AND").aim("credit", "Ж"), row, "3-16");
    end;

    private macro calculateRow_1_4(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_1_4);
    end;

    private macro calculateRow_1_5(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_1_5);
    end;

    private macro calculateRow_1_6(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);

        dataSource.insertRowData_1_6(row, m_report.getFirstColumn(), m_report.getFirstColumn(), NULL, row, "3");

        dataSource.insertRowData_1_6(row, m_report.getFirstColumn() + 1, m_report.getLastColumn(), NULL, row, "4-16");


        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filter = dataSource.getFilter();

        filter.clear();
        filter.isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_LOANS);

        dataSource.insertRowDataForActive(row, m_report.getFirstColumn(), m_report.getLastColumn(), null, row, "3-16");
    end;

    private macro calculateRow_1_7(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForActive(row, m_report.getFirstColumn(), m_report.getLastColumn(), null, row, "3-16");
    end;

    private macro calculateRow_4_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filter = dataSource.getFilter();

        filter.clear();
        filter.isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_MBK);

        dataSource.insertRowDataForPassive(row, filter, true, row, "3-16", 1);
    end;

    private macro calculateRow_4_1_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForPassive(row, NULL, true, row, "3-16", 1);
    end;

    private macro calculateRow_4_1_2(row : String)
    end;

    private macro calculateRow_4_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_RETAIL);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("NOT").isBank("deposit"), row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_DEPOSITS);

        dataSource.insertRowData(row, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        filter = dataSource.getFilter();

        filter.clear();
        filter.isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_DEPOSITS + ","
                                             + f127Constant.backOffice.BACKOFFICE_RETAIL);

        dataSource.insertRowDataForPassive(row, filter, false, row, "3-16", 1);
    end;

    private macro calculateRow_4_2_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForPassive(row, NULL, false, row, "3-16", 1);
    end;

    private macro calculateRow_4_2_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_DEPOSITS);

        dataSource.insertRowData(row, row, "3-16");
    end;

    private macro calculateRow_4_2_3(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_RETAIL);

        dataSource.insertRowData(row, dataSource.getFilter().clear().isPhisical("deposit"), row, "3-16");
    end;

    private macro calculateRow_4_3(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_RETAIL);
        var filter = dataSource.getFilter();

        dataSource.insertRowData(row, filter, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        filter = dataSource.getFilter();

        filter.clear();
        filter.isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_RETAIL);

        dataSource.insertRowDataForPassive(row, filter, NULL, row, "3-16", 1);
    end;

    private macro calculateRow_4_4(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_RETAIL);
        var filter = dataSource.getFilter();

        dataSource.insertRowData(row, filter, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        filter = dataSource.getFilter();

        filter.clear();
        filter.isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_RETAIL);

        dataSource.insertRowDataForPassive(row, filter, NULL, row, "3-16", 1);
    end;

    private macro calculateRow_4_5(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForPassive(row, NULL, NULL, "4.5_плюс", "3-16", 1);
        dataSource.insertRowDataForPassive(row, NULL, NULL, "4.5_минус", "3-16", -1);
    end;

    private macro calculateTotalValues(rowTo : String, rowsFrom : RcbArray, columnFrom : integer, columnTo : integer)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);

        dataSource.insertTotalsRow(rowTo, rowsFrom, columnFrom, columnTo);
    end;

    private macro calculateTotalValues_Minus(rowTo : String, rowFrom1 : String, rowFrom2 : String, columnFrom : integer, columnTo : integer)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);

        dataSource.insertTotalsRowMinus(rowTo, rowFrom1, rowFrom2, columnFrom, columnTo);
    end;

    private macro calculateTimeFactor(row : String, termFrom : integer, termTo : integer, column : integer)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);

        var value = round(double((f127Constant.dataSource.NUMBER_DAYS_IN_YEAR - int((termTo + termFrom) / 2))) / f127Constant.dataSource.NUMBER_DAYS_IN_YEAR, 4);

        var i;
        var codeCurrency = TF127Parameters().getCodeCurrencyArray();

        for (i, 0, codeCurrency.size - 1)
            dataSource.setValue(row, column, value, codeCurrency[i]);
        end;
    end;

    private macro calculateTotalValues_Multiply(rowTo : String, rowFrom1 : String, rowFrom2 : String,  multiplier : double, columnFrom : integer, columnTo : integer);
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);

        dataSource.insertTotalsRowMultyplay(rowTo, rowFrom1, rowFrom2,  multiplier, columnFrom, columnTo);
    end;

    // Создать нулевые значения для всех переменных отчета
    private macro initValues()
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);

        dataSource.initValues(RcbArray().initialize("1.1",
                                                    "1.2", "1.3", "1.3.1", "1.3.2", "1.3.2.1", "1.3.3", "1.3.3.1", "1.3.3.2", "1.4", "1.5", "1.6", "1.7",
                                                    "2.1", "2.2", "2.3", "2.4", "2.5", "2.6", "2.7", "3",
                                                    "4.1", "4.1.1", "4.1.2", "4.2", "4.2.1", "4.2.2", "4.2.3", "4.3", "4.4", "4.5",
                                                    "5.1", "5.2", "5.3", "5.4", "5.5", "5.6", "5.7", "6",
                                                    "7", "8", "8.1", "8.2", "8.3"
                                                   ));
    end;

    private macro setRowUndefined(row : String, columnFrom : integer, columnTo : Integer, currency : String)
        var i;

        for (i, columnFrom, columnTo)
            m_part.getAttribute(TF127StandaloneAttributeValue(row, i, null, currency)).getValue.setValue(NULL);
        end;
    end;

    private macro setUndefined(currency : String)
        setRowUndefined("1.1", 3, 15, currency);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.1", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.2", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.3", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.4", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.5", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.6", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.7", "16", null, currency)).getValue.setValue(NULL);

        m_part.getAttribute(TF127StandaloneAttributeValue("5.1", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.2", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.3", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.4", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.5", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.6", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.7", "16", null, currency)).getValue.setValue(NULL);

        m_part.getAttribute(TF127StandaloneAttributeValue("7", "16", null, currency)).getValue.setValue(NULL);

        setRowUndefined("8", 3, 16, currency);
        setRowUndefined("8.1", 7, 16, currency);
        setRowUndefined("8.2", 7, 16, currency);
        setRowUndefined("8.3", 7, 16, currency);
    end;

    // Сохранение рассчитанных данных в переменных
    private macro saveValues()
        // Получаем все рассчитанные значения
        var dataSet =  m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY).getSummaryData();

        while(dataSet.next())

            m_part.addAttribute(TF127StandaloneAttributeValue(dataSet.row,
                                                              dataSet.column,
                                                              dataSet.value,
                                                              dataSet.currency));
            m_part.getAttribute(TF127StandaloneAttributeValue(dataSet.row, dataSet.column, dataSet.value, dataSet.currency)).getValue.setValue(dataSet.value);
        end;
    end;

    macro execute()
        // Инициализация значений
        initValues();

        // Расчет строк
        // Актив
        calculateRow_1_1("1.1");
        calculateRow_1_2("1.2");
        calculateRow_1_3_1("1.3.1");
        calculateRow_1_3_2("1.3.2");
        calculateRow_1_3_2_1("1.3.2.1");
        calculateRow_1_3_3("1.3.3");
        calculateRow_1_3_3_1("1.3.3.1");
        calculateRow_1_3_3_2("1.3.3.2");
        calculateRow_1_4("1.4");
        calculateRow_1_5("1.5");
        calculateRow_1_6("1.6");
        calculateRow_1_7("1.7");

        //Пассив
        calculateRow_4_1("4.1");
        calculateRow_4_1_1("4.1.1");
        calculateRow_4_1_2("4.1.2");
        calculateRow_4_2("4.2");
        calculateRow_4_2_1("4.2.1");
        calculateRow_4_2_2("4.2.2");
        calculateRow_4_2_3("4.2.3");
        calculateRow_4_3("4.3");
        calculateRow_4_4("4.4");
        calculateRow_4_5("4.5");

        // Расчет Итоговых строк
            // Актив
        calculateTotalValues("1.3", RcbArray().initialize("1.3.1", "1.3.2", "1.3.3"), m_report.getFirstColumn(), m_report.getLastColumn());
        calculateTotalValues("3",   RcbArray().initialize("1.2", "1.3", "1.6", "1.7"), m_report.getFirstColumn(), m_report.getLastColumn() - 1);
        calculateTotalValues("3",   RcbArray().initialize("1.1", "1.2", "1.3", "1.6", "1.7"), m_report.getLastColumn(), m_report.getLastColumn());

            // Пассив
        calculateTotalValues("4.1", RcbArray().initialize("4.1.1", "4.1.2"), m_report.getFirstColumn(), m_report.getLastColumn());
        calculateTotalValues("4.2", RcbArray().initialize("4.2.1", "4.2.2", "4.2.3"), m_report.getFirstColumn(), m_report.getLastColumn());
        calculateTotalValues("6",   RcbArray().initialize("4.1", "4.2", "4.3", "4.4", "4.5"), m_report.getFirstColumn(), m_report.getLastColumn());

            // Совокупный ГЭП
        calculateTotalValues_Minus("7", "3", "6", m_report.getFirstColumn(), m_report.getLastColumn() - 1);
        calculateTimeFactor("8.3", 0,   30,  3);
        calculateTimeFactor("8.3", 30,  90,  4);
        calculateTimeFactor("8.3", 90,  180, 5);
        calculateTimeFactor("8.3", 180, 360, 6);

        calculateTotalValues_Multiply("8.1", "7", "8.3",  getBasisPoints(), 3, 6);
        calculateTotalValues_Multiply("8.2", "7", "8.3", -getBasisPoints(), 3, 6);

        // Сохранение рассчитанных данных
        saveValues();

        var codeCurrency = TF127Parameters().getCodeCurrencyArray();
        var i;

        for (i, 0, codeCurrency.size - 1)
            setUndefined(codeCurrency[i]);
        end;

    end;

    private macro constructorTF127PartDataCalculateController
    (
        reportCalculateController : Object
    )

        initTF127PartCalculateController
        (
            reportCalculateController,
            f127Constant.part.PART_DATA
        );

    end;

    constructorTF127PartDataCalculateController(reportCalculateController);
end;

class (TF127PartDataCalculateController) TF127PartDataCalculateController_4212(reportCalculateController: Object)
    initTF127PartDataCalculateController(reportCalculateController);

    private macro getBasisPoints()
        return 0.02;
    end;

    macro execute()
        execute();
        m_dataProtocolView = m_protocolView.getDataProtocolView("cb");
        m_protocolView.printLine("Данные ГК для балансовых активов и пассивов, и внебалансовых требований " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("loans");
        m_protocolView.printLine("Для модуля Кредитование сформирован csv-файл с данными: " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("mbk");
        m_protocolView.printLine("Для модуля Межбанковские кредиты для строк Балансовые активы сформирован csv-файл с данными: " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("retail");
        m_protocolView.printLine("Для модуля Вклады сформирован csv-файл с данными: " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("deposit");
        m_protocolView.printLine("Для модуля Депозиты сформирован csv-файл с данными: " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("deposit");
        m_protocolView.printСsvInExcelInstructions();
    end;
end;

class (TF127PartDataCalculateController_4212) TF127PartDataCalculateController_4637(reportCalculateController: Object)
    private macro getBasisPoints()
        return 0.02;
    end;

    private macro calculateRow_1_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForOneColumn(row, m_report.getLastColumn(), null, row, m_report.getLastColumn());
    end;

    private macro calculateRow_1_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForRow1_2(row, m_report.getLastColumn(), m_report.getLastColumn(), null, row, m_report.getLastColumn());

        dataSource.insertRowDataForRow1_2(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, null, row, "3-15");
    end;

    private macro calculateRow_1_3_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_MBK);
        var filter     = dataSource.getFilter().clear();

        filter.op("AND").isBank("deals.t_contragentId");

        dataSource.insertRowData(row, m_report.getLastColumn(), m_report.getLastColumn(), filter, row, "3-16", "Размещение ");

        dataSource.insertRowData(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-16", "Размещение ");

        dataSource            = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        filter                = dataSource.getFilter().clear();
        var filterLastColumn  = dataSource.getFilter().clear(); 

        filterLastColumn.op("AND").isBank().op("AND").isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_MBK).op("AND").getfilterRow1_3_1();

        dataSource.insertRowDataForRow1_3(row, m_report.getLastColumn(), m_report.getLastColumn(), filterLastColumn, row, "3-16");

        filter  = dataSource.getFilter().clear();  
        filter.op("AND").isBank().op("AND").isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_MBK).op("AND").getfilterRow1_3_1();

        dataSource.insertRowDataForRow1_3(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_1_3_1);

    end;

    private macro calculateRow_1_3_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("AND").isJuridical("credit"), row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filterLastColumn  = dataSource.getFilter().clear(); 

        filterLastColumn.op("AND").op("NOT").op("(").isPhisical().op(")").isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_LOANS);

        dataSource.insertRowDataForRow1_3(row, m_report.getLastColumn(), m_report.getLastColumn(), filterLastColumn, row, m_report.getLastColumn());

        filter = dataSource.getFilter().clear();
        filter.op("AND").op("NOT").op("(").isPhisical().op(")").isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_LOANS);

        dataSource.insertRowDataForRow1_3(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-15");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_1_3_2);
    end;

    private macro calculateRow_1_3_2_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        filter.op("AND").isJuridical("credit");
        filter.op("AND").op("(").creditType("credit", LO_GUARANTEE);
                    filter.op("OR").creditType("credit", LO_OVERDRAFT);
                    filter.op("OR").op("(").creditType("credit", LO_CREDIT).op("AND").issueType("credit", 6 /* LoansConst.cf_posterestante - до востребования */).op(")");
                    filter.op(")");

        dataSource.insertRowData(row, filter, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filterLastColumn  = dataSource.getFilter().clear(); 

        filterLastColumn.op("AND").op("NOT").op("(").isPhisical().op(")").op("AND").isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_LOANS);

        dataSource.insertRowDataForRow1_3(row, m_report.getLastColumn(), m_report.getLastColumn(), filterLastColumn, row, m_report.getLastColumn());

        filter = dataSource.getFilter().clear();
        filter.op("AND").op("NOT").op("(").isPhisical().op(")").op("AND").isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_LOANS);

        dataSource.insertRowDataForRow1_3(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-15");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_1_3_2_1);
    end;

    private macro calculateRow_1_3_3(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("AND").isPhisical("credit"), row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filterLastColumn  = dataSource.getFilter().clear(); 

        filterLastColumn.op("AND").op("NOT").op("(").isPhisical().op(")").op("AND").isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_LOANS);

        dataSource.insertRowDataForRow1_3(row, m_report.getLastColumn(), m_report.getLastColumn(), filterLastColumn, row, m_report.getLastColumn());

        filter = dataSource.getFilter().clear();
        filter.op("AND").isPhisical().op("AND").op("NOT").isEmployer().op("AND").isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_LOANS);

        dataSource.insertRowDataForRow1_3(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-15");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_1_3_3);
    end;

    private macro calculateRow_1_3_3_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("AND").isPhisical("credit").op("AND").creditType("credit", LO_KARTA), row, "3-16");
    end;

    private macro calculateRow_1_3_3_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("AND").isPhisical("credit").op("AND").creditType("credit", LO_KARTA).op("AND").aim("credit", "Ж"), row, "3-16");
    end;

    private macro calculateRow_1_4(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_1_4);
    end;

    private macro calculateRow_1_5(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_1_5);
    end;

    private macro calculateRow_1_6(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_LOANS);

        dataSource.insertRowData_1_6(row, NULL, row, "16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filter = dataSource.getFilter();

        filter.clear();
        filter.isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_LOANS);

        dataSource.insertRowDataForRow1_6(row, m_report.getFirstColumn(), m_report.getLastColumn(), null, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_1_6, "16");
    end;

    private macro calculateRow_1_7(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForRow1_7(row, m_report.getLastColumn(), m_report.getLastColumn(), null, row, m_report.getLastColumn());

        dataSource.insertRowDataForRow1_7(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, null, row, "3-15");
     end;

    private macro calculateRow_2_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_2_1, "3-15");
    end;

    private macro calculateRow_2_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_2_2, "3-15");
    end;

     private macro calculateRow_2_3(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_2_3, "3-15");
    end;

      private macro calculateRow_2_4(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_2_4, "3-15");
    end;

    private macro calculateRow_2_5(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_2_5, "3-15");
    end;

    private macro calculateRow_2_6(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_2_6, "3-15");
    end;

    private macro calculateRow_2_7(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForOffBalance(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, null, row, "3-15");
    end;

    private macro calculateRow_4_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filter = dataSource.getFilter().clear();

        filter.isBank().isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_MBK);

        dataSource.insertRowDataForRow4_N(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-16");

        dataSource.insertRowDataForRow4_N(row, m_report.getLastColumn(), m_report.getLastColumn(), filter, row, "3-16");
    end;

    private macro calculateRow_4_1_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filter = dataSource.getFilter().clear();

        filter.isBank();

        dataSource.insertRowDataForRow4_N_1(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-16");

        dataSource.insertRowDataForRow4_N_1(row, m_report.getLastColumn(), m_report.getLastColumn(), filter, row, "3-16");
    end;

    private macro calculateRow_4_1_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_MBK);
        var filter     = dataSource.getFilter().clear();

        dataSource.insertRowData(row, m_report.getLastColumn(), m_report.getLastColumn(), filter, row, "3-16", "Привлечение");

        dataSource.insertRowData(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-16", "Привлечение");
    end;

    private macro calculateRow_4_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_RETAIL);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowData(row, filter.op("NOT").isBank("deposit"), row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        filter = dataSource.getFilter().clear();

        filter.op("NOT").isBank().isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_DEPOSITS + ","
                                             + f127Constant.backOffice.BACKOFFICE_RETAIL);

        dataSource.insertRowDataForRow4_N(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-16");

        dataSource.insertRowDataForRow4_N(row, m_report.getLastColumn(), m_report.getLastColumn(), filter, row, "3-16");

    end;

    private macro calculateRow_4_2_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filter = dataSource.getFilter().clear();

        filter.op("NOT").isBank();

        dataSource.insertRowDataForRow4_N_1(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-16");

        dataSource.insertRowDataForRow4_N_1(row, m_report.getLastColumn(), m_report.getLastColumn(), filter, row, "3-16");
    end;

    private macro calculateRow_4_2_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_DEPOSITS);

        dataSource.insertRowData(row, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filter = dataSource.getFilter().clear();

        filter.op("NOT").isPhisical().isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_DEPOSITS);

        dataSource.insertRowDataForRow4_2_2(row, m_report.getLastColumn(), m_report.getLastColumn(), filter, row+"_ОМС", "3-16");

        dataSource.insertRowDataForRow4_2_2(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row+"_ОМС", "3-16");
    end;

    private macro calculateRow_4_2_3(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_RETAIL);

        dataSource.insertRowData(row, dataSource.getFilter().clear().isPhisical("deposit"), row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filter = dataSource.getFilter().clear();

        filter.isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_RETAIL);        

         dataSource.insertRowDataForOneColumn(row, m_report.getLastColumn(), null, row, m_report.getLastColumn());
    end;

    private macro calculateRow_4_3(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_RETAIL);
        var filter = dataSource.getFilter();

        dataSource.insertRowData(row, filter, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        filter = dataSource.getFilter();

        filter.clear();
        filter.isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_RETAIL);

        dataSource.insertRowDataForRow4_3(row, m_report.getLastColumn(), m_report.getLastColumn(), filter, row, "3-16");

        dataSource.insertRowDataForRow4_3(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_4_3);
    end;

    private macro calculateRow_4_4(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_RETAIL);
        var filter = dataSource.getFilter();

        dataSource.insertRowData(row, filter, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        filter = dataSource.getFilter().clear();

        filter.isNotCalculateInBackOffice(row, f127Constant.backOffice.BACKOFFICE_RETAIL );

        dataSource.insertRowDataForRow4_N(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, row, "3-16");

        dataSource.insertRowDataForRow4_N(row, m_report.getLastColumn(), m_report.getLastColumn(), filter, row, "3-16");

        dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_4_4, "16");
    end;

    private macro calculateRow_4_5(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);
        var filter = dataSource.getFilter().clear();

        dataSource.insertRowDataForRow4_5(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, filter, "4.5", "3-15");
        dataSource.insertRowDataForRow4_5(row, m_report.getLastColumn(),  m_report.getLastColumn(),     filter, "4.5_плюс", "16");
        dataSource.insertRowDataForRow4_5(row, m_report.getLastColumn(), m_report.getLastColumn(),     filter, "4.5_минус", "16");
    end;

    
    private macro calculateRow_5_1(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_5_1, "3-15");
    end;

    private macro calculateRow_5_2(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_5_2, "3-15");
    end;

    private macro calculateRow_5_3(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_5_3, "3-15");
    end;

    private macro calculateRow_5_4(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_5_4, "3-15");
    end;

    private macro calculateRow_5_5(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_5_5, "3-15");
    end;

    private macro calculateRow_5_6(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SECURITIES);

        dataSource.insertRowData(row, SECURITIS_ROW_CODE_5_6, "3-15");
    end;

    private macro calculateRow_5_7(row : String)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_CB);

        dataSource.insertRowDataForOffBalance(row, m_report.getFirstColumn(), m_report.getLastColumn() - 1, null, row, "3-15");
    end;

    private macro calculateTotalValues(rowTo : String, rowsFrom : RcbArray, columnFrom : integer, columnTo : integer)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);

        dataSource.insertTotalsRow(rowTo, rowsFrom, columnFrom, columnTo);
    end;

    private macro calculateTotalValues_Minus(rowTo : String, rowFrom1 : String, rowFrom2 : String, columnFrom : integer, columnTo : integer)
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);

        dataSource.insertTotalsRowMinus(rowTo, rowFrom1, rowFrom2, columnFrom, columnTo);
    end;

    private macro calculateTimeFactor(row : String, termFrom : integer, termTo : integer, column : integer)
        var dataSource   = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);
        var value        = round(double((f127Constant.dataSource.NUMBER_DAYS_IN_YEAR - int((termTo + termFrom) / 2))) / f127Constant.dataSource.NUMBER_DAYS_IN_YEAR, 4);
        var codeCurrency = TF127Parameters().getCodeCurrencyArray();

        for (var i, 0, codeCurrency.size - 1)
            dataSource.setValue(row, column, value, codeCurrency[i]);
        end;
    end;

    private macro calculateTotalValues_Multiply(rowTo : String, rowFrom1 : String, rowFrom2 : String,  multiplier : double, columnFrom : integer, columnTo : integer);
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);

        dataSource.insertTotalsRowMultyplay(rowTo, rowFrom1, rowFrom2,  multiplier, columnFrom, columnTo);
    end;

    // Создать нулевые значения для всех переменных отчета
    private macro initValues()
        var dataSource = m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY);

        dataSource.initValues(RcbArray().initialize("1.1",
                                                    "1.2", "1.3", "1.3.1", "1.3.2", "1.3.2.1", "1.3.3", "1.3.3.1", "1.3.3.2", "1.4", "1.5", "1.6", "1.7",
                                                    "2.1", "2.2", "2.3", "2.4", "2.5", "2.6", "2.7", "3",
                                                    "4.1", "4.1.1", "4.1.2", "4.2", "4.2.1", "4.2.2", "4.2.3", "4.3", "4.4", "4.5",
                                                    "5.1", "5.2", "5.3", "5.4", "5.5", "5.6", "5.7", "6",
                                                    "7", "8", "8.1", "8.2", "8.3"
                                                   )
                             );
    end;

    private macro setRowUndefined(row : String, columnFrom : integer, columnTo : Integer, currency : String)
        var i;

        for (i, columnFrom, columnTo)
            m_part.getAttribute(TF127StandaloneAttributeValue(row, i, null, currency)).getValue.setValue(NULL);
        end;
    end;

    private macro setUndefined(currency : String)
        setRowUndefined("1.1", 3, 15, currency);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.1", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.2", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.3", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.4", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.5", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.6", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("2.7", "16", null, currency)).getValue.setValue(NULL);

        m_part.getAttribute(TF127StandaloneAttributeValue("5.1", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.2", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.3", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.4", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.5", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.6", "16", null, currency)).getValue.setValue(NULL);
        m_part.getAttribute(TF127StandaloneAttributeValue("5.7", "16", null, currency)).getValue.setValue(NULL);

        m_part.getAttribute(TF127StandaloneAttributeValue("7", "16", null, currency)).getValue.setValue(NULL);

        setRowUndefined("8", 3, 16, currency);
        setRowUndefined("8.1", 7, 16, currency);
        setRowUndefined("8.2", 7, 16, currency);
        setRowUndefined("8.3", 7, 16, currency);
    end;

    // Сохранение рассчитанных данных в переменных
    private macro saveValues()
        // Получаем все рассчитанные значения
        var dataSet =  m_datasources.getDatasource(f127Constant.dataSource.IDENTIFIER_SUMMARY).getSummaryData();

        while(dataSet.next())

            m_part.addAttribute(TF127StandaloneAttributeValue(dataSet.row,
                                                              dataSet.column,
                                                              dataSet.value,
                                                              dataSet.currency));
            m_part.getAttribute(TF127StandaloneAttributeValue(dataSet.row, dataSet.column, dataSet.value, dataSet.currency)).getValue.setValue(dataSet.value);
        end;
    end;

    macro execute()
        // Инициализация значений
        initValues();

        // Расчет строк
        // Актив
        calculateRow_1_1("1.1");
        calculateRow_1_2("1.2");
        calculateRow_1_3_1("1.3.1");
        calculateRow_1_3_2("1.3.2");
        calculateRow_1_3_2_1("1.3.2.1");
        calculateRow_1_3_3("1.3.3");
        calculateRow_1_3_3_1("1.3.3.1");
        calculateRow_1_3_3_2("1.3.3.2");
        calculateRow_1_4("1.4");
        calculateRow_1_5("1.5");
        calculateRow_1_6("1.6");
        calculateRow_1_7("1.7");

        //Внебалансовые требования
        calculateRow_2_1("2.1");
        calculateRow_2_2("2.2");
        calculateRow_2_3("2.3");
        calculateRow_2_4("2.4");
        calculateRow_2_5("2.5");
        calculateRow_2_6("2.6");
        calculateRow_2_7("2.7");

        //Внебалансовые обязательства
        calculateRow_5_1("5.1");
        calculateRow_5_2("5.2");
        calculateRow_5_3("5.3");
        calculateRow_5_4("5.4");
        calculateRow_5_5("5.5");
        calculateRow_5_6("5.6");
        calculateRow_5_7("5.7");

        //Пассив
        calculateRow_4_1("4.1");
        calculateRow_4_1_1("4.1.1");
        calculateRow_4_1_2("4.1.2");
        calculateRow_4_2("4.2");
        calculateRow_4_2_1("4.2.1");
        calculateRow_4_2_2("4.2.2");
        calculateRow_4_2_3("4.2.3");
        calculateRow_4_3("4.3");
        calculateRow_4_4("4.4");
        calculateRow_4_5("4.5");

        // Расчет Итоговых строк
        // Актив
        calculateTotalValues("1.3", RcbArray().initialize("1.3.1", "1.3.2", "1.3.3"), m_report.getFirstColumn(), m_report.getLastColumn());
        calculateTotalValues("3",   RcbArray().initialize("1.2", "1.3", "1.6", "1.7"), m_report.getFirstColumn(), m_report.getLastColumn() - 1);
        calculateTotalValues("3",   RcbArray().initialize("1.1", "1.2", "1.3", "1.6", "1.7"), m_report.getLastColumn(), m_report.getLastColumn());

        // Пассив
        calculateTotalValues("4.1", RcbArray().initialize("4.1.1", "4.1.2"), m_report.getFirstColumn(), m_report.getLastColumn());
        calculateTotalValues("4.2", RcbArray().initialize("4.2.1", "4.2.2", "4.2.3"), m_report.getFirstColumn(), m_report.getLastColumn());
        calculateTotalValues("6",   RcbArray().initialize("4.1", "4.2", "4.3", "4.4", "4.5"), m_report.getFirstColumn(), m_report.getLastColumn());

        // Совокупный ГЭП
        calculateTotalValues_Minus("7", "3", "6", m_report.getFirstColumn(), m_report.getLastColumn() - 1);
        calculateTimeFactor("8.3", 0,   30,  3);
        calculateTimeFactor("8.3", 30,  90,  4);
        calculateTimeFactor("8.3", 90,  180, 5);
        calculateTimeFactor("8.3", 180, 360, 6);

        calculateTotalValues_Multiply("8.1", "7", "8.3",  getBasisPoints(), 3, 6);
        calculateTotalValues_Multiply("8.2", "7", "8.3", -getBasisPoints(), 3, 6);

        // Сохранение рассчитанных данных
        saveValues();

        var codeCurrency = TF127Parameters().getCodeCurrencyArray();
        var i;

        for (i, 0, codeCurrency.size - 1)
            setUndefined(codeCurrency[i]);
        end;

        m_dataProtocolView = m_protocolView.getDataProtocolView("cb");
        m_protocolView.printLine("Данные ГК для балансовых активов и пассивов, и внебалансовых требований " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("loans");
        m_protocolView.printLine("Для модуля Кредитование сформирован csv-файл с данными: " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("mbk");
        m_protocolView.printLine("Для модуля Межбанковские кредиты для строк Балансовые активы сформирован csv-файл с данными: " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("retail");
        m_protocolView.printLine("Для модуля Вклады сформирован csv-файл с данными: " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("deposit");
        m_protocolView.printLine("Для модуля Депозиты сформирован csv-файл с данными: " + getDataProtocolView().getFileName());
        m_dataProtocolView = m_protocolView.getDataProtocolView("deposit");
        m_protocolView.printСsvInExcelInstructions();
    end;

    private macro constructorTF127PartDataCalculateController_4637(reportCalculateController : Object)
        initTF127PartDataCalculateController_4212(reportCalculateController, f127Constant.part.PART_DATA);
    end;

    constructorTF127PartDataCalculateController_4637(reportCalculateController);
end;