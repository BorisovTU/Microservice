/*
$Name:          TApplicationRow6_507.mac
$Module:        Регламентируемая отчетность
$Description:   Классы строк приложения 6 ФОР по 507-П
*/
import rcw;

/***************************************************************************************************
 *  Класc строки 1 приложения6
 **************************************************************************************************/
private class (TDataSourceFilter) TDataSourceFilter6_1(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory("N")
            +"\n"+ "AND  NOT " + hasAssignedCategory("Строка 2.2")
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isNotZeroForAtLeastOneDay();
    end;

    initTDataSourceFilter(balanceMasks, category);
end;

class (TApplicationRow507_6) TApplicationRow507_6_1(applicationName : String)
    macro getFilter()
        return TDataSourceFilter6_1(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых",      true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств, выраженных", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в неденежной форме, балансовых счетов:",   false, true, beginDateInBlock, numberDatesInBlock);
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V1");
        else
            global.klikoExportFile.printID("F_P6N1");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter507_6("OR6_1", this, "ФОР", "RV", m_exportFilter).export();
    end;

    private macro constructorTApplicationRow507_6_1(applicationName : String)
        initTApplicationRow507_6(applicationName);

        m_code = "1";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNotDataZeroFilter_6(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBalanceInBwpFilter_6(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllFilter_6(this.getCode(), "ФОР");
        end;
    end;

    constructorTApplicationRow507_6_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2 приложения6
 **************************************************************************************************/
private class (TDataSourceFilter) TDataSourceFilter6_2(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " NOT " + hasAssignedCategory("N")
            +"\n"+ "     AND NOT " + hasAssignedCategory("Искл. из П6")
            +"\n"+ "     AND NOT " + hasAssignedCategory("Строка 2.2")
            +"\n"+ "     AND NOT " + hasAssignedCategory("ДУ", RCB_OBJGROUP_REPORTKIND)
            +"\n"+ "     AND (   " + hasAssignedCategory("КО")
            +"\n"+ "          OR (    " + isBank("account.t_contractorId")
            +"\n"+ "              AND NOT " + isNotResident("account.t_contractorId")
            +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_contractorId")
            +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_contractorId") + ")"
            +"\n"+ "          OR (    " + isBank("account.t_clientCode")
            +"\n"+ "              AND NOT " + isNotResident("account.t_clientCode")
            +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_clientCode")
            +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_clientCode") + "))"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND " + isNotZeroForAtLeastOneDay();
    end;
    initTDataSourceFilter(balanceMasks, category);
end;

class (TApplicationRow507_6) TApplicationRow507_6_2(applicationName : String)
    macro getFilter()
        return TDataSourceFilter6_2(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    private macro printRow(beginDateInBlock : Date, numberDatesInBlock : Integer, iterator : Object, isPrintRowNumber : Bool, isPrintRouble : Bool, isPrintCurrency : Bool, description : String)
        var compositeValue     : Object  = NULL;
        var currentBalance     : String  = "no balance";
        var str                : String  = "";
        var numberColumnString : String  = "";
        var dateCount          : Integer = global.parameters.getEndDate() - global.parameters.getBeginDate() + 2;
        var i                  : Integer = 0;
        var isNeedPrint                  = false;
        var daysInRow                    = numberDatesInBlock; /* Фактическое количество дат в блоке */

        if (isPrintRowNumber)
            numberColumnString = getNumberColumnString();
        else
            numberColumnString = "│      │";
        end;

        if (beginDateInBlock + numberDatesInBlock > global.parameters.getEndDate() + 1)
            daysInRow = NDays(beginDateInBlock - 1, global.parameters.getEndDate() + 2);
        end;

        iterator.moveFirst();
        while (not iterator.isDone)

            compositeValue = iterator.currentItem;
            if (currentBalance != global.exportBalanceProcessor.getBalanceNumber(compositeValue))

                if (str != "")
                    while (i < daysInRow)
                    str = str + getSumColumnString(0, isPrintRouble);
                    str = str + getSumColumnString(0, isPrintCurrency);
                    i = i + 1;
                    end;

                    i = 0;
                    if (isNeedPrint)
                    printLn(str);
                        isNeedPrint = false;
                    end;
                end;

                currentBalance = global.exportBalanceProcessor.getBalanceNumber(compositeValue);
                if (description == NULL)
                    str = numberColumnString + getDiscriptionColumnString(currentBalance, STR_ALIGN_CENTER);
                else
                    str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
                end;
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            else
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            end;

            if (description == NULL)
                if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
                    if (isNotDataZero(compositeValue) and (not isNeedPrint))
                        isNeedPrint = true;
                    end;
                elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
                    if (isBalanceInBwp(compositeValue) and (not isNeedPrint))
                        isNeedPrint = true;
                    end;
                else
                    isNeedPrint = true;
                end;
            else
                isNeedPrint = true;
            end;

            i = i + 1;
            iterator.moveNext();
        end;

        i = 0;
        if ((iterator.count == 0) and (description != NULL))
            str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
            while (i < dateCount)
                str = str + getSumColumnString(0, isPrintRouble);
                str = str + getSumColumnString(0, isPrintCurrency);
                i = i + 1;
            end;
            printLn(str);
        end;

        if (iterator.count > 0)
            if (isNeedPrint)
                printLn(str);
            end;
        end;
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых   ", true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" другой кредитной организацией,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" зарегистрированной в установленном    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" порядке и действующей на основании    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выданной Банком России лицензии на    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществление банковских операций     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" кредитной организацией, выступающей в ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" качестве доверительного управляющего),", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед международной финансовой        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" орагнизацией, осуществляющей свою     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" деятельность на основе международного ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" договора (соглашения) о ее создании   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" с участием Российской Федерации,      ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед Внешэкономбанком, перед         ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Банком России, возникающих в          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" результате заключения договоров       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств по       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выпущенным долговым ценным бумагам    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" и процентам по ним), а также          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств перед АСВ и (или)        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств перед инвесторами,       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" не являющимися кредитными             ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" организациями, возникающих в рамках  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" оказания финансовой помощи по планам  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" участия АСВ в осуществении мер по пре-", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" дупреждению банкротства банка,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов:                    ", false, true, beginDateInBlock, numberDatesInBlock);

        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(beginDateInBlock, numberDatesInBlock, iterator, false, true, true);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V2");
        else
            global.klikoExportFile.printID("F_P6N2");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);

        //формируем
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter507_6("OR6_3", this, "ФОР", "RV", m_exportFilter).export();
    end;

    private macro constructorTApplicationRow507_6_2(applicationName : String)
        initTApplicationRow507_6(applicationName);

        m_code = "2";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNotDataZeroFilter_6(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBalanceInBwpFilter_6(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllFilter_6(this.getCode(), "ФОР");
        end;
    end;

    constructorTApplicationRow507_6_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3 приложения6
 **************************************************************************************************/
private class (TDataSourceFilter) TDataSourceFilter6_3(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " NOT " + hasAssignedCategory("Строка 2.2")
            +"\n"+ "    AND  (   " + hasAssignedCategory("З")
            +"\n"+ "          OR (    " + isClientInDepartmentReference("account.t_contractorId")
            +"\n"+ "              AND NOT " + isDepartmentOwnFunds("account.t_contractorId") + "))"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND " + isNotZeroForAtLeastOneDay();
    end;

    initTDataSourceFilter(balanceMasks, category);
end;

class (TApplicationRow507_6) TApplicationRow507_6_3(applicationName : String)
    private macro printRow(beginDateInBlock : Date, numberDatesInBlock : Integer, iterator : Object, isPrintRowNumber : Bool, isPrintRouble : Bool, isPrintCurrency : Bool, description : String)
        var compositeValue     : Object  = NULL;
        var currentBalance     : String  = "no balance";
        var str                : String  = "";
        var numberColumnString : String  = "";
        var dateCount          : Integer = global.parameters.getEndDate() - global.parameters.getBeginDate() + 2;
        var i                  : Integer = 0;
        var isNeedPrint                  = false;
        var daysInRow                    = numberDatesInBlock; /* Фактическое количество дат в блоке */

        if (isPrintRowNumber)
            numberColumnString = getNumberColumnString();
        else
            numberColumnString = "│      │";
        end;

        if (beginDateInBlock + numberDatesInBlock > global.parameters.getEndDate() + 1)
            daysInRow = NDays(beginDateInBlock - 1, global.parameters.getEndDate() + 2);
        end;

        iterator.moveFirst();
        while (not iterator.isDone)

            compositeValue = iterator.currentItem;
            if (currentBalance != global.exportBalanceProcessor.getBalanceNumber(compositeValue))

                if (str != "")
                    while (i < daysInRow)
                    str = str + getSumColumnString(0, isPrintRouble);
                    str = str + getSumColumnString(0, isPrintCurrency);
                    i = i + 1;
                    end;

                    i = 0;
                    if (isNeedPrint)
                    printLn(str);
                        isNeedPrint = false;
                    end;
                end;

                currentBalance = global.exportBalanceProcessor.getBalanceNumber(compositeValue);
                if (description == NULL)
                    str = numberColumnString + getDiscriptionColumnString(currentBalance, STR_ALIGN_CENTER);
                else
                    str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
                end;
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            else
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            end;

            if (description == NULL)
                if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
                    if (isNotDataZero(compositeValue) and (not isNeedPrint))
                        isNeedPrint = true;
                    end;
                elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
                    if (isBalanceInBwp(compositeValue) and (not isNeedPrint))
                        isNeedPrint = true;
                    end;
                else
                    isNeedPrint = true;
                end;
            else
                isNeedPrint = true;
            end;

            i = i + 1;
            iterator.moveNext();
        end;

        i = 0;
        if ((iterator.count == 0) and (description != NULL))
            str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
            while (i < dateCount)
                str = str + getSumColumnString(0, isPrintRouble);
                str = str + getSumColumnString(0, isPrintCurrency);
                i = i + 1;
            end;
            printLn(str);
        end;

        if (iterator.count > 0)
            if (isNeedPrint)
                printLn(str);
            end;
        end;
    end;

    macro getFilter()
        return TDataSourceFilter6_3(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);

        printDescriptionRow(" Пассивные остатки отдельных лицевых", true,  true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету задолженности,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" возникающей между обособленными", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" подразделениями кредитной организации,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов: ", false, true, beginDateInBlock, numberDatesInBlock);
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(beginDateInBlock, numberDatesInBlock, iterator, false, true, true);
        printBottom(true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V3");
        else
            global.klikoExportFile.printID("F_P6N3");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter507_6("OR6_5", this, "ФОР", "RV", m_exportFilter).export();
    end;

    private macro constructorTApplicationRow507_6_3(applicationName : String)
        initTApplicationRow507_6(applicationName);

        m_code = "3";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNotDataZeroFilter_6(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBalanceInBwpFilter_6(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllFilter_6(this.getCode(), "ФОР");
        end;
    end;

    constructorTApplicationRow507_6_3(applicationName);
end;

// Базовый класс строк Приложения 6 по 4217-У
private class (TApplicationRow2_7_4217) TApplicationRow6_4217(applicationName : String)
    private var m_exportFilter;  //фильтр для экспорта Приложения 6 в клико и ПТК ПСД
    private var m_printIterator;

    private macro printRow(beginDateInBlock : Date, numberDatesInBlock : Integer, iterator : Object, isPrintRowNumber : Bool, isPrintRouble : Bool, isPrintCurrency : Bool, description : String)
        var compositeValue     : Object  = NULL;
        var currentBalance     : String  = "no balance";
        var str                : String  = "";
        var numberColumnString : String  = "";
        var i                  : Integer = 0;
        var daysInRow                    = numberDatesInBlock; /* Фактическое количество дат в блоке */

        const endDateInBlock = beginDateInBlock + numberDatesInBlock - 1;

        if (isPrintRowNumber)
            numberColumnString = getNumberColumnString();
        else
            numberColumnString = "│      │";
        end;

        if (beginDateInBlock + numberDatesInBlock > global.parameters.getEndDate())
            daysInRow = NDays(beginDateInBlock, global.parameters.getEndDate()) + 2;
        end;

        iterator.moveFirst();
        while (not iterator.isDone())
            compositeValue = iterator.currentItem;
            var currentDate = Date(trim(compositeValue.fieldValue("date").currentAsString));
            if ((currentDate < beginDateInBlock) or (currentDate > endDateInBlock))
                iterator.moveNext();
                continue;
            end;

            if (currentBalance != global.exportBalanceProcessor.getBalanceNumber(compositeValue))
                if (str != "")
                    while (i < daysInRow)
                        str = str + getSumColumnString(0, isPrintRouble);
                        str = str + getSumColumnString(0, isPrintCurrency);
                        i = i + 1;
                    end;
                    i = 0;
                    println(str);
                end;

                currentBalance = global.exportBalanceProcessor.getBalanceNumber(compositeValue);
                if (description == NULL)
                    str = numberColumnString + getDiscriptionColumnString(currentBalance, STR_ALIGN_CENTER);
                else
                    str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
                end;
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            else
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            end;

            i = i + 1;
            iterator.moveNext();
        end;

        if ((iterator.count > 0) and (str != ""))
            while (i < daysInRow)
                str = str + getSumColumnString(0, isPrintRouble);
                str = str + getSumColumnString(0, isPrintCurrency);
                i = i + 1;
            end;
            println(str);
        end;
    end;

    private macro printDescriptionRow(description : String, isPrintRowNumber : Bool, isPrintDelimeter: Bool, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var delimeter   : String  = "";
        var str         : String  = "";
        var dateCount   : Integer = numberDatesInBlock;

        if (isPrintRowNumber)
            str = getNumberColumnString();
        else
            str = "│      │";
        end;

        if (isPrintDelimeter)
            delimeter = "│";
        else
            delimeter = " ";
        end;

        str = str + getDiscriptionColumnString(description, STR_ALIGN_LEFT);

        var i = 0;
        while ((i < dateCount) and (beginDateInBlock + i < global.parameters.getEndDate() + 1))
            str = str + mkStr(" ", columnWidth) + delimeter + mkStr(" ", columnWidth) + delimeter;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "│");
    end;

    private macro printSeparator(separatorKind : Integer, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var str         : String  = "├──────┼─────────────────────────────────────────┼";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;
        var cross       : String;

        if (separatorKind == 0)
            cross = "┬";
        elif (separatorKind == 1)
            cross = "┼";
        elif (separatorKind == 2)
            cross = "┴";
        elif (separatorKind == 3)
            cross = "─";
        end;

        while ((i < dateCount) and (beginDateInBlock + i < global.parameters.getEndDate() + 1))
            str = str + mkStr("─", columnWidth) + cross + mkStr("─", columnWidth) + cross;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "┤");
    end;

    private macro printBottom(isDelimeter : Bool, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var str         : String  = "└──────┴─────────────────────────────────────────┴";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;
        var delimeter   : String  = "";
        if (isDelimeter)
            delimeter = "┴";
        else
            delimeter = "─";
        end;

        while ((i < dateCount) and (beginDateInBlock + i < global.parameters.getEndDate() + 1))
            str = str + mkStr("─", columnWidth) + delimeter + mkStr("─", columnWidth) + delimeter;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "┘");
    end;

    private macro constructorTApplicationRow6_4217(applicationName : String)
        initTApplicationRow2_7_4217(applicationName);
        m_printIterator = null;
    end;

    constructorTApplicationRow6_4217(applicationName);
end;

// Фильтр б/с с ненулевыми данными
private class TNonZeroBalancesFilter(rowCode, balanceGroup)
    private var m_rowCode;
    private var m_balanceGroup;
    private var m_nonZeroBalanceList : Object;

    macro isSuitable(v : Object)
        const isSuitableRow = (v.fieldValue("row").current == m_rowCode)
                          and (v.fieldValue("balanceGroup").currentAsString == m_balanceGroup);

        if (isSuitableRow)
            if (m_nonZeroBalanceList.contains(v.fieldValue("balance").currentAsString))
                return true;
            end;
            if (   (v.fieldValue("roubleRest").current != 0.0)
                or (v.fieldValue("currencyRest").current != 0.0)
               )
                m_nonZeroBalanceList.add(v.fieldValue("balance").currentAsString);
                return true;
            end;
        end;

        return false;
    end;

    private macro ctor(rowCode, balanceGroup)
        m_rowCode = rowCode;
        m_balanceGroup = balanceGroup;
        m_nonZeroBalanceList = CreateObject("rsjvm", "TJavaHost", "GlobalJavaHost").createJavaObject("java.util.HashSet", "<init>");
    end;

    ctor(rowCode, balanceGroup);
end;

// Фильтр б/с по строке
class TAllBalancesFilter(rowCode, balanceGroup)
    private var m_rowCode = rowCode;
    private var m_balanceGroup = balanceGroup;

    macro isSuitable(v : Object)
        return (v.fieldValue("row").current == m_rowCode)
           and (v.fieldValue("balanceGroup").currentAsString == m_balanceGroup);
    end;

    private macro ctor(rowCode, balanceGroup)
        m_rowCode = rowCode;
        m_balanceGroup = balanceGroup;
    end;

    ctor(rowCode, balanceGroup);
end;

// Фильтр б/с, принадлежащих РПС
class TBwpBalancesFilter(rowCode, balanceGroup)
    private var m_rowCode;
    private var m_balanceGroup;
    private var m_bwpBalanceList : Object;

    macro isSuitable(v : Object)
        const isSuitableRow = (v.fieldValue("row").current == m_rowCode)
                          and (v.fieldValue("balanceGroup").currentAsString == m_balanceGroup);

        if (isSuitableRow)
            if (m_bwpBalanceList.contains(v.fieldValue("balance").currentAsString))
                return true;
            end;

            var dataSet = TRsbDataSet("SELECT 1"
                + "\n" +              "  FROM dbalance_dbt"
                + "\n" +              " WHERE t_chapter = 1"
                + "\n" +              "   AND t_balance = " + getSqlString(substr(v.fieldValue("balance").currentAsString, 1, 5))
                + "\n" +              "   AND t_bdIncludeBWP <= " + getSqlDate(global.parameters.getEndDate())
                + "\n" +              "   AND t_bdExcludeBWP >= " + getSqlDate(global.parameters.getBeginDate())
                                     );

            if (dataSet.moveNext())
                m_bwpBalanceList.add(v.fieldValue("balance").currentAsString);
                return true;
            end;
        end;

        return false;
    end;

    private macro ctor(rowCode, balanceGroup)
        m_rowCode = rowCode;
        m_balanceGroup = balanceGroup;
        m_bwpBalanceList = CreateObject("rsjvm", "TJavaHost", "GlobalJavaHost").createJavaObject("java.util.HashSet", "<init>");
    end;

    ctor(rowCode, balanceGroup);
end;

// Строка 1 Приложения 6
private class (TDataSourceFilter_4217) TDataSourceFilter1(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory("N")
            +"\n"+ "AND  NOT " + hasAssignedCategory("Строка 2.2")
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isNotZeroForAtLeastOneDay();
    end;

    initTDataSourceFilter_4217(balanceMasks, category);
end;

class (TApplicationRow6_4217) TApplicationRow6_1_4217(applicationName : String)
    macro getFilter()
        return TDataSourceFilter1(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых",      true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств, выраженных", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в неденежной форме, балансовых счетов:",   false, true, beginDateInBlock, numberDatesInBlock);
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRow(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V1");
        else
            global.klikoExportFile.printID("F_P6N1");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter507_6("OR6_1", this, "ФОР", "RV", m_exportFilter).export();
    end;

    private macro constructorTApplicationRow6_1_4217(applicationName : String)
        initTApplicationRow6_4217(applicationName);

        m_code = "1";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNonZeroBalancesFilter(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBwpBalancesFilter(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllBalancesFilter(this.getCode(), "ФОР");
        end;
    end;

    constructorTApplicationRow6_1_4217(applicationName);
end;

// Строка 2 Приложения 6
private class (TDataSourceFilter_4217) TDataSourceFilter2(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " NOT " + hasAssignedCategory("N")
            +"\n"+ "     AND NOT " + hasAssignedCategory("Искл. из П6")
            +"\n"+ "     AND NOT " + hasAssignedCategory("Строка 2.2")
            +"\n"+ "     AND NOT " + hasAssignedCategory("ДУ", RCB_OBJGROUP_REPORTKIND)
            +"\n"+ "     AND (   " + hasAssignedCategory("КО")
            +"\n"+ "          OR (    " + isBank("account.t_contractorId")
            +"\n"+ "              AND NOT " + isNotResident("account.t_contractorId")
            +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_contractorId")
            +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_contractorId") + ")"
            +"\n"+ "          OR (    " + isBank("account.t_clientCode")
            +"\n"+ "              AND NOT " + isNotResident("account.t_clientCode")
            +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_clientCode")
            +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_clientCode") + "))"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND " + isNotZeroForAtLeastOneDay();
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

class (TApplicationRow6_4217) TApplicationRow6_2_4217(applicationName : String)
    macro getFilter()
        return TDataSourceFilter2(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых   ", true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" другой кредитной организацией,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" зарегистрированной в установленном    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" порядке и действующей на основании    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выданной Банком России лицензии на    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществление банковских операций     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" кредитной организацией, выступающей в ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" качестве доверительного управляющего),", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед международной финансовой        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" орагнизацией, осуществляющей свою     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" деятельность на основе международного ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" договора (соглашения) о ее создании   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" с участием Российской Федерации,      ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед Внешэкономбанком, перед         ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Банком России, возникающих в          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" результате заключения договоров       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств по       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выпущенным долговым ценным бумагам    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" и процентам по ним), а также          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств перед АСВ и (или)        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств перед инвесторами,       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" не являющимися кредитными             ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" организациями, возникающих в рамках  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" оказания финансовой помощи по планам  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" участия АСВ в осуществении мер по пре-", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" дупреждению банкротства банка,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов:                    ", false, true, beginDateInBlock, numberDatesInBlock);

        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRow(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V2");
        else
            global.klikoExportFile.printID("F_P6N2");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);

        //формируем
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter507_6("OR6_3", this, "ФОР", "RV", m_exportFilter).export();
    end;

    private macro constructorTApplicationRow6_2_4217(applicationName : String)
        initTApplicationRow6_4217(applicationName);

        m_code = "2";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNonZeroBalancesFilter(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBwpBalancesFilter(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllBalancesFilter(this.getCode(), "ФОР");
        end;
    end;

    constructorTApplicationRow6_2_4217(applicationName);
end;

class (TApplicationRow6_2_4217) TApplicationRow6_2_507_I4605(applicationName : String)
    initTApplicationRow6_2_4217(applicationName);

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых   ", true,  true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" другой кредитной организацией,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" зарегистрированной в установленном    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" порядке и действующей на основании    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выданной Банком России лицензии на    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществление банковских операций     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" кредитной организацией, выступающей в ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" качестве доверительного управляющего),", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед международной финансовой        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" орагнизацией, осуществляющей свою     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" деятельность на основе международного ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" договора (соглашения) о ее создании   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" с участием Российской Федерации,      ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед Внешэкономбанком, перед         ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Банком России, возникающих в          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" результате заключения договоров       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств по       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выпущенным долговым ценным бумагам    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" и процентам по ним), а также          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств перед Банком России,     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" или АСВ, и (или) перед инвесторами, не", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" являющимися кредитными организациями, ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" возникающих в рамках оказания финансо-", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" вой помощи по планам участия Банка    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" России или АСВ в осуществлении мер по ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" предупреждению банкротства банка,     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов:                    ", false, true, beginDateInBlock, numberDatesInBlock);

        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRow(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
    end;
end;

// Строка 3 Приложения 6
private class (TDataSourceFilter_4217) TDataSourceFilter3(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " NOT " + hasAssignedCategory("Строка 2.2")
            +"\n"+ "    AND  (   " + hasAssignedCategory("З")
            +"\n"+ "          OR (    " + isClientInDepartmentReference("account.t_contractorId")
            +"\n"+ "              AND NOT " + isDepartmentOwnFunds("account.t_contractorId") + "))"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND " + isNotZeroForAtLeastOneDay();
    end;

    initTDataSourceFilter_4217(balanceMasks, category);
end;

class (TApplicationRow6_4217) TApplicationRow6_3_4217(applicationName : String)
    macro getFilter()
        return TDataSourceFilter3(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);

        printDescriptionRow(" Пассивные остатки отдельных лицевых", true,  true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету задолженности,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" возникающей между обособленными", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" подразделениями кредитной организации,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов: ", false, true, beginDateInBlock, numberDatesInBlock);
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRow(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
        printBottom(true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V3");
        else
            global.klikoExportFile.printID("F_P6N3");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter507_6("OR6_5", this, "ФОР", "RV", m_exportFilter).export();
    end;

    private macro constructorTApplicationRow6_3_4217(applicationName : String)
        initTApplicationRow6_4217(applicationName);

        m_code = "3";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNonZeroBalancesFilter(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBwpBalancesFilter(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllBalancesFilter(this.getCode(), "ФОР");
        end;
    end;

    constructorTApplicationRow6_3_4217(applicationName);
end;

// Базовый класс строк Приложения 6 по 5036-У
private class (TApplicationRow2_7_5036) TApplicationRow6_5036(applicationName : String, xlsView)
    private var m_exportFilter;  //фильтр для экспорта Приложения 6 в клико и ПТК ПСД
    private var m_printIterator;

    private macro printRow(beginDateInBlock : Date, numberDatesInBlock : Integer, iterator : Object, isPrintRowNumber : Bool, isPrintRouble : Bool, isPrintCurrency : Bool, description : String)
        var compositeValue     : Object  = NULL;
        var currentBalance     : String  = "no balance";
        var str                : String  = "";
        var numberColumnString : String  = "";
        var i                  : Integer = 0;
        var daysInRow                    = numberDatesInBlock; /* Фактическое количество дат в блоке */

        const endDateInBlock = beginDateInBlock + numberDatesInBlock - 1;

        if (isPrintRowNumber)
            numberColumnString = getNumberColumnString();
        else
            numberColumnString = "│      │";
        end;

        if (beginDateInBlock + numberDatesInBlock > global.parameters.getEndDate())
            daysInRow = NDays(beginDateInBlock, global.parameters.getEndDate()) + 2;
        end;

        iterator.moveFirst();
        while (not iterator.isDone())
            compositeValue = iterator.currentItem;
            var currentDate = Date(trim(compositeValue.fieldValue("date").currentAsString));
            if ((currentDate < beginDateInBlock) or (currentDate > endDateInBlock))
                iterator.moveNext();
                continue;
            end;

            if (currentBalance != global.exportBalanceProcessor.getBalanceNumber(compositeValue))
                if (str != "")
                    while (i < daysInRow)
                        str = str + getSumColumnString(0, isPrintRouble);
                        str = str + getSumColumnString(0, isPrintCurrency);
                        i = i + 1;
                    end;
                    i = 0;
                    println(str);
                end;

                currentBalance = global.exportBalanceProcessor.getBalanceNumber(compositeValue);
                if (description == NULL)
                    str = numberColumnString + getDiscriptionColumnString(currentBalance, STR_ALIGN_CENTER);
                else
                    str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
                end;
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            else
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            end;

            i = i + 1;
            iterator.moveNext();
        end;

        if ((iterator.count > 0) and (str != ""))
            while (i < daysInRow)
                str = str + getSumColumnString(0, isPrintRouble);
                str = str + getSumColumnString(0, isPrintCurrency);
                i = i + 1;
            end;
            println(str);
        end;
    end;
	
	private macro printRowExcel(beginDateInBlock : Date, numberDatesInBlock : Integer, iterator : Object, isPrintRowNumber : Bool, isPrintRouble : Bool, isPrintCurrency : Bool, description : String)
        var compositeValue     : Object  = NULL;
        var currentBalance     : String  = "no balance";
        var str                : String  = "";
        var numberColumnString : String  = "";
        var i                  : Integer = 0;
        var daysInRow                    = numberDatesInBlock; /* Фактическое количество дат в блоке */

		var rowArray           : RcbArray = RcbArray();
		
        const endDateInBlock = beginDateInBlock + numberDatesInBlock - 1;

        if (isPrintRowNumber)
            numberColumnString = m_code;
        else
            numberColumnString = " ";
        end;

        if (beginDateInBlock + numberDatesInBlock > global.parameters.getEndDate())
            daysInRow = NDays(beginDateInBlock, global.parameters.getEndDate()) + 2;
        end;

        iterator.moveFirst();
        while (not iterator.isDone())
            compositeValue = iterator.currentItem;
            var currentDate = Date(trim(compositeValue.fieldValue("date").currentAsString));
            if ((currentDate < beginDateInBlock) or (currentDate > endDateInBlock))
                iterator.moveNext();
                continue;
            end;

            if (currentBalance != global.exportBalanceProcessor.getBalanceNumber(compositeValue))
                if (rowArray.size != 0)
                    while (i < daysInRow)
						rowArray[rowArray.size] = ternary(isPrintRouble,   "0", "X");
				        rowArray[rowArray.size] = ternary(isPrintCurrency, "0", "X");
                        i = i + 1;
                    end;
                    i = 0;
					m_xlsView.printRow(rowArray);
                    rowArray.clear();
                end;

                currentBalance = global.exportBalanceProcessor.getBalanceNumber(compositeValue);
                if (description == NULL)
					rowArray[rowArray.size] = numberColumnString;
			        rowArray[rowArray.size] = currentBalance;
                else
					rowArray[rowArray.size] = numberColumnString;
			        rowArray[rowArray.size] = description;
                end;
                rowArray[rowArray.size] = ternary(isPrintRouble,   compositeValue.fieldValue("roubleRest").currentAsString,   "X");
				rowArray[rowArray.size] = ternary(isPrintCurrency, compositeValue.fieldValue("currencyRest").currentAsString, "X");

			else
                rowArray[rowArray.size] = ternary(isPrintRouble,   compositeValue.fieldValue("roubleRest").currentAsString,   "X");
				rowArray[rowArray.size] = ternary(isPrintCurrency, compositeValue.fieldValue("currencyRest").currentAsString, "X");
			end;

            i = i + 1;
            iterator.moveNext();
        end;

        if ((iterator.count > 0) and (str != ""))
            while (i < daysInRow)
                rowArray[rowArray.size] = ternary(isPrintRouble,   "0", "X");
				rowArray[rowArray.size] = ternary(isPrintCurrency, "0", "X");
                i = i + 1;
            end;
            m_xlsView.printRow(rowArray);
        end;
    end;

    private macro printDescriptionRow(description : String, isPrintRowNumber : Bool, isPrintDelimeter: Bool, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var delimeter   : String  = "";
        var str         : String  = "";
        var dateCount   : Integer = numberDatesInBlock;

        if (isPrintRowNumber)
            str = getNumberColumnString();
        else
            str = "│      │";
        end;

        if (isPrintDelimeter)
            delimeter = "│";
        else
            delimeter = " ";
        end;

        str = str + getDiscriptionColumnString(description, STR_ALIGN_LEFT);

        var i = 0;
        while ((i < dateCount) and (beginDateInBlock + i < global.parameters.getEndDate() + 1))
            str = str + mkStr(" ", columnWidth) + delimeter + mkStr(" ", columnWidth) + delimeter;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "│");
    end;
	
	private macro printDescriptionRowExcel(description : Variant, isPrintRowNumber : Bool, isPrintDelimeter: Bool, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var delimeter   : String  = "";
        var str         : String  = "";
        var dateCount   : Integer = numberDatesInBlock;

		var rowArray    : RcbArray = RcbArray();
			
        if (isPrintRowNumber)
            rowArray[rowArray.size] = m_code;
        else
            rowArray[rowArray.size] = " ";
        end;

        rowArray[rowArray.size] = description;
      
        m_xlsView.printRow(rowArray);
    end;

    private macro printSeparator(separatorKind : Integer, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var str         : String  = "├──────┼─────────────────────────────────────────┼";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;
        var cross       : String;

        if (separatorKind == 0)
            cross = "┬";
        elif (separatorKind == 1)
            cross = "┼";
        elif (separatorKind == 2)
            cross = "┴";
        elif (separatorKind == 3)
            cross = "─";
        end;

        while ((i < dateCount) and (beginDateInBlock + i < global.parameters.getEndDate() + 1))
            str = str + mkStr("─", columnWidth) + cross + mkStr("─", columnWidth) + cross;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "┤");
    end;

    private macro printBottom(isDelimeter : Bool, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var str         : String  = "└──────┴─────────────────────────────────────────┴";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;
        var delimeter   : String  = "";
        if (isDelimeter)
            delimeter = "┴";
        else
            delimeter = "─";
        end;

        while ((i < dateCount) and (beginDateInBlock + i < global.parameters.getEndDate() + 1))
            str = str + mkStr("─", columnWidth) + delimeter + mkStr("─", columnWidth) + delimeter;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "┘");
    end;

    private macro constructorTApplicationRow6_5036(applicationName : String, xlsView)
        initTApplicationRow2_7_5036(applicationName, xlsView);
        m_printIterator = null;
    end;

    constructorTApplicationRow6_5036(applicationName, xlsView);
end;

// Строка 1 Приложения 6
private class (TDataSourceFilter_5036) TDataSourceFilter1_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory("N")
            +"\n"+ "AND  NOT " + hasAssignedCategory("Строка 2.2")
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isNotZeroForAtLeastOneDay();
    end;

    initTDataSourceFilter_5036(balanceMasks, category);
end;

class (TApplicationRow6_5036) TApplicationRow6_1_5036(applicationName : String, xlsView)
    macro getFilter()
        return TDataSourceFilter1_5036(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых",      true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств, выраженных", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в неденежной форме, балансовых счетов:",   false, true, beginDateInBlock, numberDatesInBlock);
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRow(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
    end;
	
	macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        
        printDescriptionRowExcel(RcbArray().initialize(" Пассивные остатки отдельных лицевых",
		                                               " счетов по учету обязательств, выраженных",
													   " в неденежной форме, балансовых счетов:"),      true, true, beginDateInBlock, numberDatesInBlock);
        
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRowExcel(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V1");
        else
            global.klikoExportFile.printID("F_P6N1");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter507_6("OR6_1", this, "ФОР", "RV", m_exportFilter).export();
    end;

    private macro constructorTApplicationRow6_1_5036(applicationName : String, xlsView)
        initTApplicationRow6_5036(applicationName, xlsView);

        m_code = "1";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNonZeroBalancesFilter(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBwpBalancesFilter(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllBalancesFilter(this.getCode(), "ФОР");
        end;
    end;

    constructorTApplicationRow6_1_5036(applicationName, xlsView);
end;

// Строка 2 Приложения 6
private class (TDataSourceFilter_5036) TDataSourceFilter2_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " NOT " + hasAssignedCategory("N")
            +"\n"+ "     AND NOT " + hasAssignedCategory("Искл. из П6")
            +"\n"+ "     AND NOT " + hasAssignedCategory("Строка 2.2")
            +"\n"+ "     AND NOT " + hasAssignedCategory("ДУ", RCB_OBJGROUP_REPORTKIND)
            +"\n"+ "     AND (   " + hasAssignedCategory("КО")
            +"\n"+ "          OR (    " + isBank("account.t_contractorId")
            +"\n"+ "              AND NOT " + isVnesheconombank("account.t_contractorId")
            +"\n"+ "              AND NOT " + isInternalFinanceCorporation("account.t_contractorId")
            +"\n"+ "              AND NOT " + isNotResident("account.t_contractorId")
            +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_contractorId")
            +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_contractorId") + ")"
            +"\n"+ "          OR (    " + isBank("account.t_clientCode")
            +"\n"+ "              AND NOT " + isVnesheconombank("account.t_clientCode")
            +"\n"+ "              AND NOT " + isInternalFinanceCorporation("account.t_clientCode")
            +"\n"+ "              AND NOT " + isNotResident("account.t_clientCode")
            +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_clientCode")
            +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_clientCode") + "))"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND " + isNotZeroForAtLeastOneDay();
    end;
    initTDataSourceFilter_5036(balanceMasks, category);
end;

class (TApplicationRow6_5036) TApplicationRow6_2_5036(applicationName : String, xlsView)
    macro getFilter()
        return TDataSourceFilter2_5036(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых   ", true,  true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" другой кредитной организацией,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" зарегистрированной в установленном    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" порядке и действующей на основании    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выданной Банком России лицензии на    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществление банковских операций     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" кредитной организацией, выступающей в ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" качестве доверительного управляющего),", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед Банком России, возникающих в    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" результате заключения договоров       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств по       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выпущенным долговым ценным бумагам    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" и процентам по ним), а также          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств перед Банком России,     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" или АСВ, и (или) перед инвесторами, не", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" являющимися кредитными организациями, ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" возникающих в рамках оказания финансо-", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" вой помощи по планам участия Банка    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" России или АСВ в осуществлении мер по ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" предупреждению банкротства банка,     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов:                    ", false, true, beginDateInBlock, numberDatesInBlock);

        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRow(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
    end;
	
	macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        
        printDescriptionRowExcel(RcbArray().initialize(" Пассивные остатки отдельных лицевых   ",
		                                               " счетов по учету обязательств перед    ",
                                                       " другой кредитной организацией,        ",
                                                       " зарегистрированной в установленном    ",
                                                       " порядке и действующей на основании    ",
                                                       " выданной Банком России лицензии на    ",
                                                       " осуществление банковских операций     ",
                                                       " (за исключением обязательств перед    ",
                                                       " кредитной организацией, выступающей в ",
                                                       " качестве доверительного управляющего),",
                                                       " перед Банком России, возникающих в    ",
                                                       " результате заключения договоров       ",
                                                       " (за исключением обязательств по       ",
                                                       " выпущенным долговым ценным бумагам    ",
                                                       " и процентам по ним), а также          ",
                                                       " обязательств перед Банком России,     ",
                                                       " или АСВ, и (или) перед инвесторами, не",
                                                       " являющимися кредитными организациями, ",
                                                       " возникающих в рамках оказания финансо-",
                                                       " вой помощи по планам участия Банка    ",
                                                       " России или АСВ в осуществлении мер по ",
                                                       " предупреждению банкротства банка,     ",
                                                       " балансовых счетов:                    "), true,  true, beginDateInBlock, numberDatesInBlock);
        

        
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRowExcel(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V2");
        else
            global.klikoExportFile.printID("F_P6N2");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);

        //формируем
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter507_6("OR6_3", this, "ФОР", "RV", m_exportFilter).export();
    end;

    private macro constructorTApplicationRow6_2_5036(applicationName : String, xlsView)
        initTApplicationRow6_5036(applicationName, xlsView);

        m_code = "2";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNonZeroBalancesFilter(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBwpBalancesFilter(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllBalancesFilter(this.getCode(), "ФОР");
        end;
    end;

    constructorTApplicationRow6_2_5036(applicationName, xlsView);
end;

// Строка 3 Приложения 6
private class (TDataSourceFilter_5036) TDataSourceFilter3_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " NOT " + hasAssignedCategory("Строка 2.2")
            +"\n"+ "    AND  (   " + hasAssignedCategory("З")
            +"\n"+ "          OR (    " + isClientInDepartmentReference("account.t_contractorId")
            +"\n"+ "              AND NOT " + isDepartmentOwnFunds("account.t_contractorId") + "))"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND " + isNotZeroForAtLeastOneDay();
    end;

    initTDataSourceFilter_5036(balanceMasks, category);
end;

class (TApplicationRow6_5036) TApplicationRow6_3_5036(applicationName : String, xlsView)
    macro getFilter()
        return TDataSourceFilter3_5036(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);

        printDescriptionRow(" Пассивные остатки отдельных лицевых", true,  true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету задолженности,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" возникающей между обособленными", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" подразделениями кредитной организации,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов: ", false, true, beginDateInBlock, numberDatesInBlock);
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRow(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
        printBottom(true, beginDateInBlock, numberDatesInBlock);
    end;
	
	macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        
        printDescriptionRowExcel(RcbArray().initialize(" Пассивные остатки отдельных лицевых",
													   " счетов по учету задолженности,", 
													   " возникающей между обособленными", 
													   " подразделениями кредитной организации,",
													   " балансовых счетов: "), true,  true, beginDateInBlock, numberDatesInBlock);
        
        
        if (m_printIterator == null)
            m_printIterator = getAttributeValueIterator(m_applicationName);
            m_printIterator.setFilter(m_exportFilter);
            m_printIterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        end;
        printRowExcel(beginDateInBlock, numberDatesInBlock, m_printIterator, false, true, true);
        
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V3");
        else
            global.klikoExportFile.printID("F_P6N3");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter507_6("OR6_5", this, "ФОР", "RV", m_exportFilter).export();
    end;

    private macro constructorTApplicationRow6_3_5036(applicationName : String, xlsView)
        initTApplicationRow6_5036(applicationName, xlsView);

        m_code = "3";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNonZeroBalancesFilter(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBwpBalancesFilter(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllBalancesFilter(this.getCode(), "ФОР");
        end;
    end;

    constructorTApplicationRow6_3_5036(applicationName, xlsView);
end;
