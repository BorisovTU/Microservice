/*
$Name:          TForm507.mac
$Module:        Регламентируемая отчетность
$Description:   Класс формы ФОР по 507-П
*/

import or_rep_h;
import fForExcelView;

class (TForm) TForm507()
    private var m_application4;
    private var m_balanceMasksSetForApplication4;

    macro getApplication4()
        return m_application4;
    end;

    private macro makeBalanceMasks()
        var set = TRcbSet();

        macro fillSet(masks : TRcbSet)
            var iterator = masks.createIterator();

            iterator.moveFirst();
            while (not iterator.isDone())
                var mask = iterator.getCurrentItem();
                if (mask != "")
                    set.insert(mask);
                end;
                iterator.moveNext();
            end;
        end;

        macro makeString()
            var iterator = set.createIterator();
            var masksString  : String = "";

            iterator.moveFirst();
            while (not iterator.isDone())
                masksString = masksString + "," + iterator.getCurrentItem();
                iterator.moveNext();
            end;

            return subStr(masksString, 2);
        end;

        var masksString = "";

        fillSet(m_balanceMasksSetForApplication1);
        fillSet(m_balanceMasksSetForApplication2);
        fillSet(m_balanceMasksSetForApplication3);
        fillSet(m_balanceMasksSetForApplication4);
        fillSet(m_balanceMasksSetForApplication5);
        fillSet(m_balanceMasksSetForApplication6);
        m_balanceMasks = makeString();
    end;

    private macro initializeMasksSet()
        m_balanceMasksSetForApplication1 = m_application1.getBalanceMasksSet();
        m_balanceMasksSetForApplication2 = m_application2.getBalanceMasksSet();
        m_balanceMasksSetForApplication3 = m_application3.getBalanceMasksSet();
        m_balanceMasksSetForApplication4 = m_application4.getBalanceMasksSet();
        m_balanceMasksSetForApplication5 = m_application5.getBalanceMasksSet();
        m_balanceMasksSetForApplication6 = m_application6.getBalanceMasksSet();
    end;

    macro getMasksSetForApplication(applicationName : String)
        if (    (m_balanceMasksSetForApplication1 == NULL)
            and (m_balanceMasksSetForApplication2 == NULL)
            and (m_balanceMasksSetForApplication3 == NULL)
            and (m_balanceMasksSetForApplication4 == NULL)
            and (m_balanceMasksSetForApplication5 == NULL)
            and (m_balanceMasksSetForApplication6 == NULL))
            initializeMasksSet();
        end;

        if (applicationName == "Приложение1")
            return m_balanceMasksSetForApplication1;
        elif (applicationName == "Приложение2")
            return m_balanceMasksSetForApplication2;
        elif (applicationName == "Приложение3")
            return m_balanceMasksSetForApplication3;
        elif (applicationName == "Приложение4")
            return m_balanceMasksSetForApplication4;
        elif (applicationName == "Приложение5")
            return m_balanceMasksSetForApplication5;
        elif (applicationName == "Приложение6")
            return m_balanceMasksSetForApplication6;
        end;
    end;

    private macro fillTempTable(tempTable : TTempTable)
        m_application6.fillTempTableForBalanceData(tempTable);
        m_application2.fillTempTableForBalanceData(tempTable);
        m_application3.fillTempTableForBalanceData(tempTable);
        m_application4.fillTempTableForBalanceData(tempTable);
        m_application5.fillTempTableForBalanceData(tempTable);
    end;

    private macro saveAttributes()
        m_application1.saveAttributes();

        m_application2.saveAttributes();
        if (not m_isRecalculationInProcess)
            m_application2.completeAttributes();
        end;

        m_application4.saveAttributes();

        m_application3.saveAttributes();
        if (not m_isRecalculationInProcess)
            m_application3.completeAttributes();
        end;

        m_application5.saveAttributes();
        if (not m_isRecalculationInProcess)
            m_application5.completeAttributes();
        end;

        m_application6.saveAttributes();
        if (not m_isRecalculationInProcess)
            m_application6.completeAttributes();
        end;

        m_application8.saveAttributes();

        RcbApplication().TransactionManager().commit();
    end;

    private macro initializeSourceRows()
        m_sourceRows[m_sourceRows.size] = m_application1.getRow("5.1");
        m_sourceRows[m_sourceRows.size] = m_application1.getRow("5.2");
        m_sourceRows[m_sourceRows.size] = m_application1.getRow("5.3");
        m_sourceRows[m_sourceRows.size] = m_application2.getRow("1");
        m_sourceRows[m_sourceRows.size] = m_application2.getRow("2");
        m_sourceRows[m_sourceRows.size] = m_application2.getRow("3");
        m_sourceRows[m_sourceRows.size] = m_application2.getRow("3.2");
        m_sourceRows[m_sourceRows.size] = m_application3.getRow("1.1");
        m_sourceRows[m_sourceRows.size] = m_application3.getRow("1.3");
        m_sourceRows[m_sourceRows.size] = m_application4.getRow("1");
        m_sourceRows[m_sourceRows.size] = m_application5.getRow("1");
        m_sourceRows[m_sourceRows.size] = m_application6.getRow("1");
        m_sourceRows[m_sourceRows.size] = m_application6.getRow("2");
        m_sourceRows[m_sourceRows.size] = m_application6.getRow("3");
        m_sourceRows[m_sourceRows.size] = m_application8.getRow("-");
    end;

    private macro initializeDependencies()
        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("1.1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("1.2");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[2] = m_application1.getRow("1.3");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[3] = m_application1.getRow("1.4");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[4] = m_application1.getRow("1.5");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[5] = m_application1.getRow("1.6");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("1.1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("1.4");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("1.2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("2.2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("1.3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("3.5");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("1.4"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("1.5");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("1.5"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("2.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("1.6"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("3.6");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("2.6");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("2.10");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("1.1");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("1.2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("1.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.4"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("2.1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("2.2");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[2] = m_application1.getRow("2.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.5"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application5.getRow("5");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.6"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("2.4");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("2.5");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.7"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("1.4");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.8"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("1.5");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.9"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("1.6");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("2.10"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("2.7");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("2.8");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[2] = m_application1.getRow("2.9");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("3.1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("3.2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("3.1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("2.6");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("3.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("3.2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("2.10");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("3.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("3.3"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("4"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("4.1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("4.2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("4.1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("2.6");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("3.1");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("4.2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("2.10");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("3.2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("5"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("5.1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("5.2");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[2] = m_application1.getRow("5.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("5.1"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("5.2"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application1.getRow("5.3"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application6.getRow("1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application6.getRow("2");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[2] = m_application6.getRow("3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("1.1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("1");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("1.2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application3.getRow("1.2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("1.3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("1.1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application2.getRow("1.2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("1.4"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("1.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("1.5"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("1.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application6.getRow("1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application6.getRow("2");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[2] = m_application6.getRow("3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("2.1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("2.2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("2.1");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("2.3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("2.1");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application2.getRow("2");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[2] = m_application6.getRow("1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[3] = m_application6.getRow("2");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[4] = m_application6.getRow("3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("3.1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("3.2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application3.getRow("1.4");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application4.getRow("3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("3.3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("3.2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("3.4"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("3.1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application2.getRow("3.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("3.5"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("3.4");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application2.getRow("3.6"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("3.4");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application3.getRow("1"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application3.getRow("1.1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("1");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application3.getRow("1.2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application3.getRow("1.1");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application3.getRow("1.3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application3.getRow("1.4"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application3.getRow("1.3");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application4.getRow("1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application2.getRow("3");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application2.getRow("3.2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application4.getRow("1.1"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application4.getRow("1");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application4.getRow("2"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application4.getRow("3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application4.getRow("1.1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application4.getRow("2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application5.getRow("1"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application5.getRow("2"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application5.getRow("1");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application5.getRow("3"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application5.getRow("2");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application5.getRow("4"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("2.4");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application5.getRow("5"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application5.getRow("3");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application5.getRow("4");

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application6.getRow("1"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application6.getRow("2"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application6.getRow("3"), TArray());

        m_rowsDependencies[m_rowsDependencies.size]      = TRcbPair(m_application8.getRow("-"), TArray());
        m_rowsDependencies[m_rowsDependencies.size - 1].second[0] = m_application1.getRow("1");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[1] = m_application1.getRow("2");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[2] = m_application1.getRow("3");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[3] = m_application1.getRow("4");
        m_rowsDependencies[m_rowsDependencies.size - 1].second[4] = m_application1.getRow("5");
    end;

    private macro normalizeDecoding()
        if (global.parameters.isOverallNormalizationDisabled())
            return;
        end;

        normalizationProtocol.beginProtocol();
        normalizationProtocolWithErrors.beginProtocol();

        m_application1.normalizeDecoding();
        m_application2.normalizeDecoding();
        m_application4.normalizeDecoding();
        m_application3.normalizeDecoding();
        m_application5.normalizeDecoding();
        m_application6.normalizeDecoding();
        m_application8.normalizeDecoding();

        /**
         * Нормализация по приложению 2 и 6
         */
         //рубли
        var normalizer = TForNormalizer(RcbApplication.currentReport.multiplier);
        var normalizerWithCondition = TForNormalizerWithCondition(RcbApplication.currentReport.multiplier);
        var normalizerApp1 = TForReportNormalizer(normalizationProtocol);

        var balanceIterator = normalizer.getBalanceIterator("Приложение2");
        var prevBalanceTranscript = "";
        var balance;

        while (not balanceIterator.isDone())

            var balanceTranscript = balanceIterator.currentItem.fieldValue("balance").current;
            if (prevBalanceTranscript == balanceTranscript)
                balanceIterator.next();
                continue;
            end;

            balance = substr(balanceTranscript, 1, 5);

            normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "3.2", balanceTranscript),
                                                       TDecodingData("Приложение6", "1", balance),
                                                       TDecodingData("Приложение6", "2", balance),
                                                       TDecodingData("Приложение6", "3", balance)
                                                      ),
                                 RcbArray().initialize(balance),
                                 true,
                                 RCB_RS_EQUAL
                                );

            normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "3.2", balanceTranscript),
                                                       TDecodingData("Приложение6", "1", balance),
                                                       TDecodingData("Приложение6", "2", balance),
                                                       TDecodingData("Приложение6", "3", balance)
                                                      ),
                                 RcbArray().initialize(balance),
                                 false,
                                 RCB_RS_EQUAL
                                );

            prevBalanceTranscript = balanceTranscript;
            balanceIterator.moveNext();
        end;

        normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "3.2", "409011"),
                                                     TDecodingData("Приложение6", "1",   "40901" ),
                                                     TDecodingData("Приложение6", "2",   "40901" ),
                                                     TDecodingData("Приложение6", "3",   "40901" )),
                               RcbArray().initialize("47431", "47410"),
                               true,
                               RCB_RS_LESS_OR_EQUAL);

        normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "3.2", "409011"),
                                                     TDecodingData("Приложение6", "1",   "40901" ),
                                                     TDecodingData("Приложение6", "2",   "40901" ),
                                                     TDecodingData("Приложение6", "3",   "40901" )),
                               RcbArray().initialize("40901", "40902"),
                               true,
                               RCB_RS_LESS_OR_EQUAL);

        normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "1", "40901"),
                                                     TDecodingData("Приложение2", "2", "40901"),
                                                     TDecodingData("Приложение2", "3", "40901"),
                                                     TDecodingData("Приложение6", "1", "40901"),
                                                     TDecodingData("Приложение6", "2", "40901"),
                                                     TDecodingData("Приложение6", "3", "40901")),
                               RcbArray().initialize("40901"),
                               true,
                               RCB_RS_EQUAL);

        normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "1", "40902"),
                                                     TDecodingData("Приложение2", "2", "40902"),
                                                     TDecodingData("Приложение2", "3", "40902"),
                                                     TDecodingData("Приложение6", "1", "40902"),
                                                     TDecodingData("Приложение6", "2", "40902"),
                                                     TDecodingData("Приложение6", "3", "40902")),
                               RcbArray().initialize("40902"),
                               true,
                               RCB_RS_EQUAL);

        normalizerWithCondition.addRelation(RcbArray().initialize("30420", "30421"),
                               RcbArray().initialize("30416", "30417"),
                               RCB_RS_GREATER,
                               RcbArray().initialize(TDecodingData("Приложение2", "3", "304211"),
                                                     TDecodingData("Приложение6", "1", "30420" ),
                                                     TDecodingData("Приложение6", "2", "30420" ),
                                                     TDecodingData("Приложение6", "3", "30420" ),
                                                     TDecodingData("Приложение6", "1", "30421" ),
                                                     TDecodingData("Приложение6", "2", "30421" ),
                                                     TDecodingData("Приложение6", "3", "30421" )),
                               RcbArray().initialize("30420", "30421", "-30416", "-30417"),
                               true,
                               RCB_RS_EQUAL);

        normalizerWithCondition.addRelation(RcbArray().initialize("30422", "30423"),
                               RcbArray().initialize("30418", "30419"),
                               RCB_RS_GREATER,
                               RcbArray().initialize(TDecodingData("Приложение2", "3", "304231"),
                                                     TDecodingData("Приложение6", "1", "30422" ),
                                                     TDecodingData("Приложение6", "2", "30422" ),
                                                     TDecodingData("Приложение6", "3", "30422" ),
                                                     TDecodingData("Приложение6", "1", "30423" ),
                                                     TDecodingData("Приложение6", "2", "30423" ),
                                                     TDecodingData("Приложение6", "3", "30423" )),
                               RcbArray().initialize("30422", "30423", "-30418", "-30419"),
                               true,
                               RCB_RS_EQUAL);

        //валюта
        normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "3.2", "409011"),
                                                     TDecodingData("Приложение6", "1",   "40901" ),
                                                     TDecodingData("Приложение6", "2",   "40901" ),
                                                     TDecodingData("Приложение6", "3",   "40901" )),
                               RcbArray().initialize("47431", "47410"),
                               false,
                               RCB_RS_LESS_OR_EQUAL);

        normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "3.2", "409011"),
                                                     TDecodingData("Приложение6", "1",   "40901" ),
                                                     TDecodingData("Приложение6", "2",   "40901" ),
                                                     TDecodingData("Приложение6", "3",   "40901" )),
                               RcbArray().initialize("40901", "40902"),
                               false,
                               RCB_RS_LESS_OR_EQUAL);

        normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "1", "40901"),
                                                     TDecodingData("Приложение2", "2", "40901"),
                                                     TDecodingData("Приложение2", "3", "40901"),
                                                     TDecodingData("Приложение6", "1", "40901"),
                                                     TDecodingData("Приложение6", "2", "40901"),
                                                     TDecodingData("Приложение6", "3", "40901")),
                               RcbArray().initialize("40901"),
                               false,
                               RCB_RS_EQUAL);

        normalizer.addRelation(RcbArray().initialize(TDecodingData("Приложение2", "1", "40902"),
                                                     TDecodingData("Приложение2", "2", "40902"),
                                                     TDecodingData("Приложение2", "3", "40902"),
                                                     TDecodingData("Приложение6", "1", "40902"),
                                                     TDecodingData("Приложение6", "2", "40902"),
                                                     TDecodingData("Приложение6", "3", "40902")),
                               RcbArray().initialize("40902"),
                               false,
                               RCB_RS_EQUAL);

        normalizerWithCondition.addRelation(RcbArray().initialize("30420", "30421"),
                               RcbArray().initialize("30416", "30417"),
                               RCB_RS_GREATER,
                               RcbArray().initialize(TDecodingData("Приложение2", "3", "304211"),
                                                     TDecodingData("Приложение6", "1", "30420" ),
                                                     TDecodingData("Приложение6", "2", "30420" ),
                                                     TDecodingData("Приложение6", "3", "30420" ),
                                                     TDecodingData("Приложение6", "1", "30421" ),
                                                     TDecodingData("Приложение6", "2", "30421" ),
                                                     TDecodingData("Приложение6", "3", "30421" )),
                               RcbArray().initialize("30420", "30421", "-30416", "-30417"),
                               false,
                               RCB_RS_EQUAL);

        normalizerWithCondition.addRelation(RcbArray().initialize("30422", "30423"),
                               RcbArray().initialize("30418", "30419"),
                               RCB_RS_GREATER,
                               RcbArray().initialize(TDecodingData("Приложение2", "3", "304231"),
                                                     TDecodingData("Приложение6", "1", "30422" ),
                                                     TDecodingData("Приложение6", "2", "30422" ),
                                                     TDecodingData("Приложение6", "3", "30422" ),
                                                     TDecodingData("Приложение6", "1", "30423" ),
                                                     TDecodingData("Приложение6", "2", "30423" ),
                                                     TDecodingData("Приложение6", "3", "30423" )),
                               RcbArray().initialize("30422", "30423", "-30418", "-30419"),
                               false,
                               RCB_RS_EQUAL);

        normalizer.normalize();
        normalizerWithCondition.normalize();
        normalizerApp1.execute();

        normalizationProtocolWithErrors.endProtocol();
        normalizationProtocol.endProtocol();
    end;

    macro print()
        initProgress(-1, "Печать Приложения 1", "Печать Приложения 1");
        m_application1.print();
        remProgress();

        initProgress(-1, "Печать Приложения 2", "Печать Приложения 2");
        m_application2.print();
        remProgress();

        initProgress(-1, "Печать Приложения 3", "Печать Приложения 3");
        m_application3.print();
        remProgress();

        initProgress(-1, "Печать Приложения 4", "Печать Приложения 4");
        m_application4.print();
        remProgress();

        initProgress(-1, "Печать Приложения 5", "Печать Приложения 5");
        m_application5.print();
        remProgress();

        initProgress(-1, "Печать Приложения 6", "Печать Приложения 6");
        m_application6.print();
        remProgress();

        initProgress(-1, "Печать данных о приложениях, не вошедших в состав отчета", "Печать данных о приложениях, не вошедших в состав отчета");
        m_application8.print();
        remProgress();
    end;

    macro recalculateItogValues(isCalcMethod : Bool)
        var isCalculateMethod = nvl(isCalcMethod, true);
        const ARG_LABEL  = "-isCalculateMethod:";

        if (index(cmdArgs, ARG_LABEL) > 0)
            isCalculateMethod = int(SubStr(CmdArgs, index(cmdArgs, ARG_LABEL) + strlen(ARG_LABEL), 1));
        end;

        m_isRecalculationInProcess = true;

        initProgress(-1, "Удаление итоговых значений", "Удаление итоговых значений");
        var i : Integer = 0;

        while (i < m_rowsDependencies.size)
            if (isSourceRow(m_rowsDependencies[i].first))
                m_rowsDependencies[i].first.setSaved(true);
            else
                m_rowsDependencies[i].first.setSaved(false);
                m_rowsDependencies[i].first.removeValues();
            end;

            i = i + 1;
        end;
        remProgress();

        initProgress(-1, "Обновление значений по данным формы \"Балансовые счета\"", "Обновление значений по данным формы \"Балансовые счета\"");

        if (not isCalculateMethod)
            m_application2.updateBalanceValues();
            m_application4.updateBalanceValues();
            m_application3.updateBalanceValues();
            m_application5.updateBalanceValues();
            m_application6.updateBalanceValues();
        end;

        remProgress();

        initProgress(-1, "Нормализация расшифровок", "Нормализация расшифровок");
        normalizeDecoding();
        remProgress();

        initProgress(-1, "Пересчет итоговых значений", "Пересчет итоговых значений");
        saveAttributes();
        remProgress();

        if (not isCalculateMethod)
            initProgress(-1, "Сохранение итоговых значений", "Сохранение итоговых значений");
            rcbApplication().transactionManager.commit();
            remProgress();
        end;

        m_isRecalculationInProcess = true;
    end;

    macro constructor()
        m_application1 = TApplication507_1();
        m_application2 = TApplication507_2();
        m_application3 = TApplication507_3();
        m_application4 = TApplication507_4();
        m_application5 = TApplication507_5();
        m_application6 = TApplication507_6();
        m_application8 = TApplication507_8();

        initializeDependencies();
    end;

    private macro constructorTForm507()
        initTForm();
    end;

    constructorTForm507();
end;

/**
 * CMakeReport с перегруженными методми
 *     GetRegim_LoadNewApplication - для перекрытия настройки BANK_INI\WINDOWS REPORT\LOADNEWAPPLICATION
 */
private class (CMakeReport) TMakeReport(_HeaderStr:string, _SepStr:string, _CountStrOnPage:integer, _CurStr:integer)
    initCMakeReport(_HeaderStr, _SepStr, _CountStrOnPage, _CurStr);

    private macro GetRegim_LoadNewApplication()
        return false;
    end;
end;

class (TForm507) TForm_4217()
    private macro initializeSourceRows()
        // Строки, которые не нужно пересчитывать после нормализации, они либо нормализуются,
        // либо не зависят от нормализованных (прямо или опосредованно)
        m_sourceRows.size = 0;

        m_sourceRows.push_back(m_application1.getRow("3.3"));
        m_sourceRows.push_back(m_application1.getRow("5"));
        m_sourceRows.push_back(m_application1.getRow("5.1"));
        m_sourceRows.push_back(m_application1.getRow("5.2"));
        m_sourceRows.push_back(m_application1.getRow("5.3"));

        m_sourceRows.push_back(m_application2.getRow("1"));
        m_sourceRows.push_back(m_application2.getRow("1.1"));
        m_sourceRows.push_back(m_application2.getRow("1.2"));
        m_sourceRows.push_back(m_application2.getRow("1.2.2"));
        m_sourceRows.push_back(m_application2.getRow("1.2.3"));
        m_sourceRows.push_back(m_application2.getRow("2"));
        m_sourceRows.push_back(m_application2.getRow("3"));
        m_sourceRows.push_back(m_application2.getRow("3.1"));
        m_sourceRows.push_back(m_application2.getRow("3.2"));

        m_sourceRows.push_back(m_application3.getRow("1"));
        m_sourceRows.push_back(m_application3.getRow("1.1"));
        m_sourceRows.push_back(m_application3.getRow("1.1.1"));
        m_sourceRows.push_back(m_application3.getRow("1.2"));
        m_sourceRows.push_back(m_application3.getRow("1.2.1"));

        m_sourceRows.push_back(m_application4.getRow("1"));
        m_sourceRows.push_back(m_application4.getRow("1.2"));
        m_sourceRows.push_back(m_application4.getRow("2"));

        m_sourceRows.push_back(m_application5.getRow("1"));

        m_sourceRows.push_back(m_application6.getRow("1"));
        m_sourceRows.push_back(m_application6.getRow("2"));
        m_sourceRows.push_back(m_application6.getRow("3"));

        m_sourceRows.push_back(m_application8.getRow("-"));
    end;

    private macro initializeDependencies()
        m_rowsDependencies.size = 0;
        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.5"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.6"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.7"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.9"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.10"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.7"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.8"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.9"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.10"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.7"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.8"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.6"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.7"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.9"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.10"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.7"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.11"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.8"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.12"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.9"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.13"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.10"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.14"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.9"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.10"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.11"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.12"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.13"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5.1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5.3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("1"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("4"));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application8.getRow("-"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5"));
    end;

    private macro normalizeDecoding()
        if (global.parameters.isOverallNormalizationDisabled())
            return;
        end;

        var normalizerTimeMarker = TTimeMarker(getTxtFileName("ForNormalizeTime"));

        normalizationProtocol.beginProtocol();
        normalizationProtocolWithErrors.beginProtocol();

        normalizerTimeMarker.clearFile();

        // метод TApplicationRow2_4217::normalizeOneDecoding() не умеет работать с расшифровками и несколькими номерами б/с в правой части,
        // поэтому нормализуем нормализатором с предусловиями
        var appl2Normalizer = TForConditionalNormalizer_4217(RcbApplication().currentReport.multiplier);
        appl2Normalizer.addRelation("C|1 = C|1", "2|1.2.2|425440 <= 2|1.2|425062 + 2|1.2|440062 + B|42507 + B|44007", "RV");
        appl2Normalizer.addRelation("C|1 = C|1", "2|3.2.2|420438 <= 2|3.2|420062 + 2|3.2|421062 + 2|3.2|437062 + 2|3.2|438062 + B|42007 + B|42107 + B|43707 + B|43807", "RV");
        appl2Normalizer.addRelation("C|1 = C|1", "2|3.2.2|520053 <= 2|3.2|520052", "RV");
        appl2Normalizer.addRelation("C|1 = C|1", "2|3.2.2|520061 <= 2|3.2|52006 - 3|1.2|52006", "R");
        appl2Normalizer.normalize();
        normalizerTimeMarker.setMark("Приложение 2, расшифровки 425440, 420438, 520053, 520061");

        var normalizer = TApplication2Normalizer_4217(RcbApplication().currentReport.multiplier);
        normalizer.addRelation("2|3.1.2|409011 + 6|1|40901 + 6|2|40901 + 6|3|40901 = B|47431 + B|47410 + RVL");
        normalizer.addRelation("2|3.1.2|409011 + 6|1|40901 + 6|2|40901 + 6|3|40901 = B|40901 + B|40902 + RVL");
        normalizer.addRelation("2|3.1|40901 + 6|1|40901 + 6|2|40901 + 6|3|40901 = B|40901 + RVE");
        normalizer.addRelation("2|3.1|40902 + 6|1|40902 + 6|2|40902 + 6|3|40902 = B|40902 + RVE");
        normalizer.normalize();
        normalizerTimeMarker.setMark("Приложение 2 и 6, расшифровка 409011, счета 40901, 40902");

        var normalizerWithCondition = TForConditionalNormalizer_4217(RcbApplication().currentReport.multiplier);
        normalizerWithCondition.addRelation("B|30420 + B|30421 > B|30416 + B|30417",
                                            "2|3.1|304211+6|1|30420+6|2|30420+6|3|30420+6|1|30421+6|2|30421+6|3|30421 = B|30420+B|30421-B|30416-B|30417",
                                            "RV"
                                           );
        normalizerWithCondition.addRelation("B|30422 + B|30423 > B|30418 + B|30419",
                                            "2|3.1|304231+6|1|30422+6|2|30422+6|3|30422+6|1|30423+6|2|30423+6|3|30423 = B|30422+B|30423-B|30418-B|30419",
                                            "RV"
                                           );
        normalizerWithCondition.addRelation("B|40108 > B|40109", "2|3.1|401081 = B|40108 - B|40109", "RV");
        normalizerWithCondition.addRelation("B|40110 > B|40111", "2|3.1|401101 = B|40110 - B|40111", "RV");
        normalizerWithCondition.addRelation("B|40306 > B|40308", "2|3.1|403061 = B|40306 - B|40308", "RV");
        normalizerWithCondition.normalize();
        normalizerTimeMarker.setMark("Приложение 2 и 6, расшифровки 304211, 304231, 401081, 401101, 403061");

        m_application2.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 2, прочие расшифровки и счета");

        m_application6.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 6");
        m_application1.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 1");
        m_application3.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 3");
        m_application4.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 4");
        m_application5.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 5");
        m_application8.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 8");

        normalizationProtocolWithErrors.endProtocol();
        normalizationProtocol.endProtocol();
    end;

    macro recalculateItogValues()
        m_isRecalculationInProcess = true;

        for (var dependencies, m_rowsDependencies)
            if (isSourceRow(dependencies.first))
                dependencies.first.setSaved(true);
            else
                dependencies.first.setSaved(false);
                dependencies.first.removeValues();
            end;
        end;

        if (RcbApplication().parameters.isSummaryMode)
            m_application2.updateBalanceValues();
            m_application3.updateBalanceValues();
            m_application4.updateBalanceValues();
            m_application5.updateBalanceValues();
            m_application6.updateBalanceValues();
        end;

        normalizeDecoding();
        saveAttributes();

        if (RcbApplication().parameters.isSummaryMode)
            RcbApplication().transactionManager.commit();
        end;

        m_isRecalculationInProcess = false;
    end;

    private macro getTxtName( prefix, ext )
      var name_f;

      if (ValType(ext) == V_UNDEF)
        ext = "txt";
      end;

      name_f = DirFromPath( GetTxtFileName(prefix) ) + prefix + "." + ext;

      return name_f;
    end;

    private macro getExtendedPrefix()
        var queryText = "";
        var dataSet;
        var report = rcbApplication().currentReport;

        queryText =  "SELECT t_reportId"
            + "\n" + "  FROM dcy_rdate_dbt"
            + "\n" + " WHERE t_issummary  = " + RcbSqlBool(RcbApplication().parameters.isSummaryMode)
            + "\n" + "   AND t_organizationstructure = "+ report.context.organizationStructure
            + "\n" + "   AND t_issuemode  = " + report.context.issueMode
            + "\n" + "   AND t_inumdprt   = " + string(report.context.departmentCode)
            + "\n" + "   AND t_bdrepdate  = " + getsqlDate(report.context.period.endDate)
            + "\n" + "   AND t_bdprevdate = " + getSqlDate(report.context.period.beginDate)
            + "\n" + "   AND t_iformid    = " + string(НайтиИдентификаторОтчетаПоНазванию(report.form.id))
            + "\n" + "   AND t_cvarkind   = chr(0)";

        dataSet = TRsbDataSet(queryText);
        dataSet.SetFieldType("t_reportId", V_INTEGER);

        if (dataSet.moveNext())
            return dataSet.reportId;
        end;

        return "";
    end;

    macro print()
        var formOkudCode    = "ФОР";
        var prefix          = getExtendedPrefix() + "_" + ternary(strLen(formOkudCode) > 3, SubStr(formOkudCode, strLen(formOkudCode) - 2), formOkudCode);
        var m_printFileName = getTxtName(prefix, "txt");
        var oldFile         = SetOutput(m_printFileName);

        message("Печать Приложения 1");
        m_application1.print();
        message("Печать Приложения 2");
        m_application2.print();
        message("Печать Приложения 3");
        m_application3.print();
        message("Печать Приложения 4");
        m_application4.print();
        message("Печать Приложения 5");
        m_application5.print();
        message("Печать Приложения 6");
        m_application6.print();
        message("Печать данных о приложениях, не вошедших в состав отчета");
        m_application8.print();

        SetOutput(oldFile, true);

        return m_printFileName;
    end;

    /**
     * Печать в Excel
     */
    macro printExcel(txtReportFileName : String, coefficent : Double)
        private var m_printEngine       : TMakeReport;
        private var m_txtReportFileName : String;

        macro print()
            var outstream = TStreamDoc(m_txtReportFileName, "R");
            var str       = "";
            var length    = 0;

            while (outstream.readLine(str))
                var tmp = strlen(str);
                if (tmp > length)
                    length = tmp;
                end;
            end;

            str       = "";
            outstream = TStreamDoc(m_txtReportFileName, "R");
            while (outstream.readLine())
                var line = outstream.str;

                if (line == "")
                    line = mkstr(" ", length);
                end;

                if   (Index(line, "Приложение 2") != 0)
                    m_printEngine.init("Приложение 1");
                    m_printEngine.getCurSheet().setSheetName("Приложение 1");

                    str = substr(str, 2);
                    m_printEngine.autoscan("["+str+"]");
                    str = "";

                    m_printEngine.addNewSheetBreak("Приложение 2", "");
                elif (Index(line, "Приложение 3") != 0)
                    str = substr(str, 2);
                    m_printEngine.autoscan("["+str+"]");
                    str = "";

                    m_printEngine.addNewSheetBreak("Приложение 3", "");
                elif (Index(line, "Приложение 4") != 0)
                    str = substr(str, 2);
                    m_printEngine.autoscan("["+str+"]");
                    str = "";

                    m_printEngine.addNewSheetBreak("Приложение 4", "");
                elif (Index(line, "Приложение 5") != 0)
                    str = substr(str, 2);
                    m_printEngine.autoscan("["+str+"]");
                    str = "";

                    m_printEngine.addNewSheetBreak("Приложение 5", "");
                elif (Index(line, "Приложение 6") != 0)
                    str = substr(str, 2);
                    m_printEngine.autoscan("["+str+"]");
                    str = "";

                    m_printEngine.addNewSheetBreak("Приложение 6", "");
                elif (    (Index(line, "ДАННЫЕ") != 0)
                      and (Index(line, "ДАННЫЕ ОБ ОСТАТКАХ РЕЗЕРВИРУЕМЫХ ОБЯЗАТЕЛЬСТВ") == 0))
                    str = substr(str, 2);
                    m_printEngine.autoscan("["+str+"]");
                    str = "";

                    m_printEngine.addNewSheetBreak("Данные о приложениях", "");
                end;

                str = str + "\n" + line;
            end;
            str = substr(str, 2);

            m_printEngine.autoscan("["+str+"]");
            m_printEngine.printWinRep();
        end;

        macro show()
            m_printEngine.showWinRep();
        end;

        m_printEngine = TMakeReport("", SEP_DEFAULT, 100000);
        m_printEngine.setWinRepOutput(WINREP_OUTPUT_EXCEL, WINREP_FORMAT_XLSX);
        m_printEngine.setFlagShowIndicator(false);
        m_printEngine.setFlagShowGrid(false);
        m_printEngine.setFont("Courier New", 10, coefficent);

        var ext : String;
        splitFile(txtReportFileName, m_txtReportFileName, ext);
        m_printEngine.setFileNameWin(m_txtReportFileName);
        m_txtReportFileName = m_txtReportFileName + ext;

        print();
        show();
    end;

    private macro constructor()
        m_application1 = TApplication1_4217();
        m_application2 = TApplication2_4217();
        m_application3 = TApplication3_4217();
        m_application4 = TApplication4_4217();
        m_application5 = TApplication5_4217();
        m_application6 = TApplication6_4217();
        m_application8 = TApplication8_4217();

        initializeDependencies();
    end;

    private macro constructorTForm_4217()
        initTForm507();
    end;

    constructorTForm_4217();
end;

class (TForm_4217) TForm_507_I4605()
    private macro constructor()
        m_application1 = TApplication1_4217();
        m_application2 = TApplication2_507_I4605();
        m_application3 = TApplication3_4217();
        m_application4 = TApplication4_4217();
        m_application5 = TApplication5_4217();
        m_application6 = TApplication6_507_I4605();
        m_application8 = TApplication8_4217();

        initializeDependencies();
    end;

    private macro constructorTForm_507_I4605()
        initTForm_4217();
    end;

    constructorTForm_507_I4605();
end;

class (TForm507) TForm_5036()
    private var m_xlsView : Object;
    private macro initializeSourceRows()
        // Строки, которые не нужно пересчитывать после нормализации, они либо нормализуются,
        // либо не зависят от нормализованных (прямо или опосредованно)
        m_sourceRows.size = 0;

        m_sourceRows.push_back(m_application1.getRow("3.3"));
        m_sourceRows.push_back(m_application1.getRow("5"));
        m_sourceRows.push_back(m_application1.getRow("5.1"));
        m_sourceRows.push_back(m_application1.getRow("5.2"));
        m_sourceRows.push_back(m_application1.getRow("5.3"));

        m_sourceRows.push_back(m_application2.getRow("1"));
        m_sourceRows.push_back(m_application2.getRow("1.1"));
        m_sourceRows.push_back(m_application2.getRow("1.2"));
        m_sourceRows.push_back(m_application2.getRow("1.2.2"));

        m_sourceRows.push_back(m_application2.getRow("2"));
        m_sourceRows.push_back(m_application2.getRow("3"));
        m_sourceRows.push_back(m_application2.getRow("3.1"));
        m_sourceRows.push_back(m_application2.getRow("3.2"));

        m_sourceRows.push_back(m_application3.getRow("1"));
        m_sourceRows.push_back(m_application3.getRow("1.1"));
        m_sourceRows.push_back(m_application3.getRow("1.1.1"));
        m_sourceRows.push_back(m_application3.getRow("1.2"));
        m_sourceRows.push_back(m_application3.getRow("1.2.1"));

        m_sourceRows.push_back(m_application4.getRow("1"));
        m_sourceRows.push_back(m_application4.getRow("1.2"));
        m_sourceRows.push_back(m_application4.getRow("2"));

        m_sourceRows.push_back(m_application5.getRow("1"));

        m_sourceRows.push_back(m_application6.getRow("1"));
        m_sourceRows.push_back(m_application6.getRow("2"));
        m_sourceRows.push_back(m_application6.getRow("3"));

        m_sourceRows.push_back(m_application8.getRow("-"));
    end;

    private macro initializeDependencies()
        m_rowsDependencies.size = 0;
        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.5"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.6"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.7"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.9"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.10"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.7"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.8"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.9"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.10"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.7"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.8"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.6"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.7"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.9"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.10"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.7"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.11"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.8"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.12"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.9"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.13"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.10"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.14"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.9"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.10"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.11"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.12"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.13"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5.1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5.3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("1"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("4"));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application8.getRow("-"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5"));
    end;

    private macro normalizeDecoding()
        if (global.parameters.isOverallNormalizationDisabled())
            return;
        end;

        var normalizerTimeMarker = TTimeMarker(getTxtFileName("ForNormalizeTime"));

        normalizationProtocol.beginProtocol();
        normalizationProtocolWithErrors.beginProtocol();

        normalizerTimeMarker.clearFile();

        var normalizer = TApplication2Normalizer_4217(RcbApplication().currentReport.multiplier);
        normalizer.addRelation("2|3.1.2|409011 + 6|1|40901 + 6|2|40901 + 6|3|40901 = B|47431 + B|47410 + RVL");
        normalizer.addRelation("2|3.1.2|409011 + 6|1|40901 + 6|2|40901 + 6|3|40901 = B|40901 + B|40902 + RVL");
        normalizer.addRelation("2|3.1|40901 + 6|1|40901 + 6|2|40901 + 6|3|40901 = B|40901 + RVE");
        normalizer.addRelation("2|3.1|40902 + 6|1|40902 + 6|2|40902 + 6|3|40902 = B|40902 + RVE");
        normalizer.normalize();
        normalizerTimeMarker.setMark("Приложение 2 и 6, расшифровка 409011, счета 40901, 40902");

        var normalizerWithCondition = TForConditionalNormalizer_4217(RcbApplication().currentReport.multiplier);
        normalizerWithCondition.addRelation("B|30420 + B|30421 > B|30416 + B|30417",
                                            "2|3.1|304211+6|1|30420+6|2|30420+6|3|30420+6|1|30421+6|2|30421+6|3|30421 = B|30420+B|30421-B|30416-B|30417",
                                            "RV"
                                           );
        normalizerWithCondition.addRelation("B|30422 + B|30423 > B|30418 + B|30419",
                                            "2|3.1|304231+6|1|30422+6|2|30422+6|3|30422+6|1|30423+6|2|30423+6|3|30423 = B|30422+B|30423-B|30418-B|30419",
                                            "RV"
                                           );
        normalizerWithCondition.addRelation("B|40108 > B|40109", "2|3.1|401081 = B|40108 - B|40109", "RV");
        normalizerWithCondition.addRelation("B|40110 > B|40111", "2|3.1|401101 = B|40110 - B|40111", "RV");
        normalizerWithCondition.addRelation("B|40306 > B|40308", "2|3.1|403061 = B|40306 - B|40308", "RV");
        normalizerWithCondition.normalize();
        normalizerTimeMarker.setMark("Приложение 2 и 6, расшифровки 304211, 304231, 401081, 401101, 403061");

        m_application2.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 2, прочие расшифровки и счета");

        m_application6.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 6");
        m_application1.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 1");
        m_application3.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 3");
        m_application4.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 4");
        m_application5.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 5");
        m_application8.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 8");

        normalizationProtocolWithErrors.endProtocol();
        normalizationProtocol.endProtocol();
    end;

    macro recalculateItogValues()
        m_isRecalculationInProcess = true;

        for (var dependencies, m_rowsDependencies)
            if (isSourceRow(dependencies.first))
                dependencies.first.setSaved(true);
            else
                dependencies.first.setSaved(false);
                dependencies.first.removeValues();
            end;
        end;

        if (RcbApplication().parameters.isSummaryMode)
            m_application2.updateBalanceValues();
            m_application3.updateBalanceValues();
            m_application4.updateBalanceValues();
            m_application5.updateBalanceValues();
            m_application6.updateBalanceValues();
        end;

        normalizeDecoding();
        saveAttributes();

        if (RcbApplication().parameters.isSummaryMode)
            RcbApplication().transactionManager.commit();
        end;

        m_isRecalculationInProcess = false;
    end;

    private macro getTxtName( prefix, ext )
      var name_f;

      if (ValType(ext) == V_UNDEF)
        ext = "txt";
      end;

      name_f = DirFromPath( GetTxtFileName(prefix) ) + prefix + "." + ext;

      return name_f;
    end;

    private macro getExtendedPrefix()
        var queryText = "";
        var dataSet;
        var report = rcbApplication().currentReport;

        queryText =  "SELECT t_reportId"
            + "\n" + "  FROM dcy_rdate_dbt"
            + "\n" + " WHERE t_issummary  = " + RcbSqlBool(RcbApplication().parameters.isSummaryMode)
            + "\n" + "   AND t_organizationstructure = "+ report.context.organizationStructure
            + "\n" + "   AND t_issuemode  = " + report.context.issueMode
            + "\n" + "   AND t_inumdprt   = " + string(report.context.departmentCode)
            + "\n" + "   AND t_bdrepdate  = " + getsqlDate(report.context.period.endDate)
            + "\n" + "   AND t_bdprevdate = " + getSqlDate(report.context.period.beginDate)
            + "\n" + "   AND t_iformid    = " + string(НайтиИдентификаторОтчетаПоНазванию(report.form.id))
            + "\n" + "   AND t_cvarkind   = chr(0)";

        dataSet = TRsbDataSet(queryText);
        dataSet.SetFieldType("t_reportId", V_INTEGER);

        if (dataSet.moveNext())
            return dataSet.reportId;
        end;

        return "";
    end;

    macro print()
        var formOkudCode    = "ФОР";
        var prefix          = getExtendedPrefix() + "_" + ternary(strLen(formOkudCode) > 3, SubStr(formOkudCode, strLen(formOkudCode) - 2), formOkudCode);
        var m_printFileName = getTxtName(prefix, "txt");
        var oldFile         = SetOutput(m_printFileName);

        message("Печать Приложения 1");
        m_application1.print();
        message("Печать Приложения 2");
        m_application2.print();
        message("Печать Приложения 3");
        m_application3.print();
        message("Печать Приложения 4");
        m_application4.print();
        message("Печать Приложения 5");
        m_application5.print();
        message("Печать Приложения 6");
        m_application6.print();
        message("Печать данных о приложениях, не вошедших в состав отчета");
        m_application8.print();

        SetOutput(oldFile, true);

        return m_printFileName;
    end;



    macro printExcel(txtReportFileName : String, coefficent : Double)

        var formOkudCode    = "ФОР";
        var prefix          = getExtendedPrefix() + "_" + ternary(strLen(formOkudCode) > 3, SubStr(formOkudCode, strLen(formOkudCode) - 2), formOkudCode);


        message("Печать Приложения 1");
        m_application1.printExcel();
        message("Печать Приложения 2");
        m_application2.printExcel();
        message("Печать Приложения 3");
        m_application3.printExcel();
        message("Печать Приложения 4");
        m_application4.printExcel();
        message("Печать Приложения 5");
        m_application5.printExcel();
        message("Печать Приложения 6");
        m_application6.printExcel();
        message("Печать данных о приложениях, не вошедших в состав отчета");
        m_application8.printExcel();


        m_xlsView.save(prefix);

    end;

    private macro constructor()
        m_xlsView = TForReportExcelView();

        m_application1 = TApplication1_5036(m_xlsView.getApplView(0));
        m_application2 = TApplication2_5036(m_xlsView.getApplView(1));
        m_application3 = TApplication3_5036(m_xlsView.getApplView(2));
        m_application4 = TApplication4_5036(m_xlsView.getApplView(3));
        m_application5 = TApplication5_5036(m_xlsView.getApplView(4));
        m_application6 = TApplication6_5036(m_xlsView.getApplView(5));
        m_application8 = TApplication8_5036(m_xlsView.getApplView(6));


        initializeDependencies();
    end;

    private macro constructorTForm_5036()
        initTForm507();
    end;

    constructorTForm_5036();
end;

class (TForm_5036) TForm_5087()

    private macro initializeSourceRows()
        // Строки, которые не нужно пересчитывать после нормализации, они либо нормализуются,
        // либо не зависят от нормализованных (прямо или опосредованно)
        m_sourceRows.size = 0;

        m_sourceRows.push_back(m_application1.getRow("3.3"));
        m_sourceRows.push_back(m_application1.getRow("5"));
        m_sourceRows.push_back(m_application1.getRow("5.1"));

        m_sourceRows.push_back(m_application2.getRow("1"));
        m_sourceRows.push_back(m_application2.getRow("1.1"));
        m_sourceRows.push_back(m_application2.getRow("1.2"));
        m_sourceRows.push_back(m_application2.getRow("1.2.2"));

        m_sourceRows.push_back(m_application2.getRow("2"));
        m_sourceRows.push_back(m_application2.getRow("3"));
        m_sourceRows.push_back(m_application2.getRow("3.1"));
        m_sourceRows.push_back(m_application2.getRow("3.2"));

        m_sourceRows.push_back(m_application3.getRow("1"));
        m_sourceRows.push_back(m_application3.getRow("1.1"));
        m_sourceRows.push_back(m_application3.getRow("1.1.1"));
        m_sourceRows.push_back(m_application3.getRow("1.2"));
        m_sourceRows.push_back(m_application3.getRow("1.2.1"));

        m_sourceRows.push_back(m_application4.getRow("1"));
        m_sourceRows.push_back(m_application4.getRow("1.2"));
        m_sourceRows.push_back(m_application4.getRow("2"));

        m_sourceRows.push_back(m_application5.getRow("1"));

        m_sourceRows.push_back(m_application6.getRow("1"));
        m_sourceRows.push_back(m_application6.getRow("2"));
        m_sourceRows.push_back(m_application6.getRow("3"));

        m_sourceRows.push_back(m_application8.getRow("-"));
    end;

    private macro initializeDependencies()
        m_rowsDependencies.size = 0;
        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.5"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.6"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.7"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.9"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.10"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.7"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.8"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.9"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.10"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.7"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.8"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.6"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.7"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.9"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.10"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.7"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.11"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.8"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.12"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.9"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.13"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.10"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.14"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.9"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.10"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.11"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.12"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.13"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5.1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("1"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("4"));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application8.getRow("-"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5"));
    end;

    macro calculate()
        if (global.parameters.isSecuritiesData())
            insertAtrFor52006Acc(RcbApplication().currentReport.context.period.beginDate, RcbApplication().currentReport.context.period.endDate);
        end;
        return calculate();
    end;

    private macro constructor()
        m_xlsView = TForReportExcelView();

        m_application1 = TApplication1_5087(m_xlsView.getApplView(0));
        m_application2 = TApplication2_5036(m_xlsView.getApplView(1));
        m_application3 = TApplication3_5087(m_xlsView.getApplView(2));
        m_application4 = TApplication4_5036(m_xlsView.getApplView(3));
        m_application5 = TApplication5_5036(m_xlsView.getApplView(4));
        m_application6 = TApplication6_5036(m_xlsView.getApplView(5));
        m_application8 = TApplication8_5036(m_xlsView.getApplView(6));

        initializeDependencies();
    end;

    private macro constructorTForm_5087()
        initTForm507();
    end;

    constructorTForm_5087();
end;

class (TForm_5036) TForm_5242()
    private macro initializeSourceRows()
        // Строки, которые не нужно пересчитывать после нормализации, они либо нормализуются,
        // либо не зависят от нормализованных (прямо или опосредованно)
        m_sourceRows.size = 0;

        m_sourceRows.push_back(m_application1.getRow("3.3"));
        m_sourceRows.push_back(m_application1.getRow("5"));

        m_sourceRows.push_back(m_application2.getRow("1"));
        m_sourceRows.push_back(m_application2.getRow("1.1"));
        m_sourceRows.push_back(m_application2.getRow("1.2"));
        m_sourceRows.push_back(m_application2.getRow("1.2.2"));

        m_sourceRows.push_back(m_application2.getRow("2"));
        m_sourceRows.push_back(m_application2.getRow("3"));
        m_sourceRows.push_back(m_application2.getRow("3.1"));
        m_sourceRows.push_back(m_application2.getRow("3.2"));

        m_sourceRows.push_back(m_application3.getRow("1"));
        m_sourceRows.push_back(m_application3.getRow("1.1"));
        m_sourceRows.push_back(m_application3.getRow("1.1.1"));
        m_sourceRows.push_back(m_application3.getRow("1.2"));
        m_sourceRows.push_back(m_application3.getRow("1.2.1"));

        m_sourceRows.push_back(m_application4.getRow("1"));
        m_sourceRows.push_back(m_application4.getRow("1.2"));
        m_sourceRows.push_back(m_application4.getRow("2"));

        m_sourceRows.push_back(m_application5.getRow("1"));

        m_sourceRows.push_back(m_application6.getRow("1"));
        m_sourceRows.push_back(m_application6.getRow("2"));
        m_sourceRows.push_back(m_application6.getRow("3"));

        m_sourceRows.push_back(m_application8.getRow("-"));
    end;

    private macro initializeDependencies()
        m_rowsDependencies.size = 0;
        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.5"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.6"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.7"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.9"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.10"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.7"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.8"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.9"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("1.10"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.7"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("5"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.8"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.6"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.7"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.9"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.10"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.7"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.11"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.8"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.12"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.9"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.13"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1.10"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("2.14"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.9"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.10"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.11"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.12"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.13"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("3.3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.8"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("4.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.14"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application1.getRow("5"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.1.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("1.2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.1.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application6.getRow("3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("3.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.3"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application2.getRow("3.2.6"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.2.4"));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application3.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application3.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application2.getRow("3.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.1.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.1"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("1.2.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("3.1"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.1.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application4.getRow("3.2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("1.2.1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application4.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("2"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("1"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("3"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("2"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("4"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2.6"));

        m_rowsDependencies.push_back(TRcbPair(m_application5.getRow("5"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application5.getRow("4"));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("1"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("2"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application6.getRow("3"), RcbArray()));

        m_rowsDependencies.push_back(TRcbPair(m_application8.getRow("-"), RcbArray()));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("1"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("2"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("3"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("4"));
        m_rowsDependencies[m_rowsDependencies.size - 1].second.push_back(m_application1.getRow("5"));
    end;

    private macro normalizeDecoding()
        if (global.parameters.isOverallNormalizationDisabled())
            return;
        end;

        var normalizerTimeMarker = TTimeMarker(getTxtFileName("ForNormalizeTime"));

        normalizationProtocol.beginProtocol();
        normalizationProtocolWithErrors.beginProtocol();

        normalizerTimeMarker.clearFile();

        var normalizer = TApplication2Normalizer_4217(RcbApplication().currentReport.multiplier);
        normalizer.addRelation("2|3.1.2|409011 + 6|1|40901 + 6|2|40901 + 6|3|40901 = B|47431 + B|47410 + RVL");
        normalizer.addRelation("2|3.1.2|409011 + 6|1|40901 + 6|2|40901 + 6|3|40901 = B|40901 + B|40902 + RVL");
        normalizer.addRelation("2|3.1|40901 + 6|1|40901 + 6|2|40901 + 6|3|40901 = B|40901 + RVE");
        normalizer.addRelation("2|3.1|40902 + 6|1|40902 + 6|2|40902 + 6|3|40902 = B|40902 + RVE");
        normalizer.normalize();
        normalizerTimeMarker.setMark("Приложение 2 и 6, расшифровка 409011, счета 40901, 40902");

        var normalizerWithCondition = TForConditionalNormalizer_4217(RcbApplication().currentReport.multiplier);
        normalizerWithCondition.addRelation("B|30420 + B|30421 > B|30416 + B|30417",
                                            "2|3.1|304211+6|1|30420+6|2|30420+6|3|30420+6|1|30421+6|2|30421+6|3|30421 = B|30420+B|30421-B|30416-B|30417",
                                            "RV"
                                           );
        normalizerWithCondition.addRelation("B|30422 + B|30423 > B|30418 + B|30419",
                                            "2|3.1|304231+6|1|30422+6|2|30422+6|3|30422+6|1|30423+6|2|30423+6|3|30423 = B|30422+B|30423-B|30418-B|30419",
                                            "RV"
                                           );
        normalizerWithCondition.addRelation("B|40108 > B|40109", "2|3.1|401081 = B|40108 - B|40109", "RV");
        normalizerWithCondition.addRelation("B|40110 > B|40111", "2|3.1|401101 = B|40110 - B|40111", "RV");
        normalizerWithCondition.addRelation("B|40306 > B|40308", "2|3.1|403061 = B|40306 - B|40308", "RV");
        normalizerWithCondition.normalize();
        normalizerTimeMarker.setMark("Приложение 2 и 6, расшифровки 304211, 304231, 401081, 401101, 403061");

        m_application2.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 2, прочие расшифровки и счета");

        m_application6.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 6");
        m_application1.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 1");
        m_application3.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 3");
        m_application4.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 4");
        m_application5.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 5");
        m_application8.normalizeDecoding();
        normalizerTimeMarker.setMark("Приложение 8");

// 13.09.2019 ABP Отключено, т.к. в СМ не реализован метод multiply.
//                Сходимость достигается раздельным расчетом по точным и округлённым значениям с пересчётом после нормализации П2, П5
//                При расчете/пересчете ограничение "Строка 3 (Приложение 1) / Строка 2 (Приложение 1) <= 0.8" игнорируется
//                В нормализаторе требования отбрасывать дробную часть для строк 3.1, 3.2 игнорируются. Но, возможно, он в приницпе
//                не может дать нецелое решение?
//                Если multiply получится реализовать, то можно будет подключить нормализатор, убрать раздельный расчёт в П1 и убрать
//                пересчёт строк П1
//        var normalizerApp1 = TApplication1Normalizer_5242(normalizationProtocol);
//        normalizerApp1.normalize();
//        normalizerTimeMarker.setMark("Приложение 1");

        normalizationProtocolWithErrors.endProtocol();
        normalizationProtocol.endProtocol();
    end;

    macro calculate()
        if (global.parameters.isSecuritiesData())
            insertAtrFor52006Acc(RcbApplication().currentReport.context.period.beginDate, RcbApplication().currentReport.context.period.endDate);
        end;
        return calculate();
    end;

    private macro constructor()
        m_xlsView = TForReportExcelView();

        m_application1 = TApplication1_5242(m_xlsView.getApplView(0));
        m_application2 = TApplication2_5242(m_xlsView.getApplView(1));
        m_application3 = TApplication3_5087(m_xlsView.getApplView(2));
        m_application4 = TApplication4_5036(m_xlsView.getApplView(3));
        m_application5 = TApplication5_5036(m_xlsView.getApplView(4));
        m_application6 = TApplication6_5036(m_xlsView.getApplView(5));
        m_application8 = TApplication8_5036(m_xlsView.getApplView(6));

        initializeDependencies();
    end;

    private macro constructorTForm_5242()
        initTForm_5036();
    end;

    constructorTForm_5242();
end;

if (global.form == null)
    if   (global.parameters.getEndDate() >= RCB_I5242_DATE)
        global.form = TForm_5242();
    elif   (global.parameters.getEndDate() >= RCB_I5087_DATE)
        global.form = TForm_5087();
    elif (global.parameters.getEndDate() >= RCB_I5036_DATE)
        global.form = TForm_5036();
    elif (global.parameters.getEndDate() >= RCB_I4605_DATE)
        global.form = TForm_507_I4605();
    elif (global.parameters.getEndDate() >= RCB_I4217_DATE)
        global.form = TForm_4217();
    elif (global.parameters.getEndDate() >= RCB_I507_DATE)
        global.form = TForm507();
    elif (global.parameters.getEndDate() >= RCB_I3654_DATE)
        global.form = TForm_3654();
    elif (global.parameters.getEndDate() >= RCB_I3115_DATE)
        global.form = TForm_3115();
    elif (global.parameters.getEndDate() >= RCB_I2963_DATE)
        global.form = TForm2963();
    elif (global.parameters.getEndDate() >= RCB_I2341_DATE)
        global.form = TForm2341();
    elif (global.parameters.getEndDate() >= RCB_I342_DATE)
        global.form = TForm342();
    else
        global.form = TForm();
    end;
end;
