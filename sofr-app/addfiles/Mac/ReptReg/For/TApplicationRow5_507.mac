/*
$Name:          TApplicationRow5_507.mac
$Module:        Регламентируемая отчетность
$Description:   ФОР. Классы строк Приложения 5 ФОР по 507-П
*/
/***************************************************************************************************
 *  Класc строки 1 приложения5
 **************************************************************************************************/
private class (TDataSourceFilter) TDataSourceFilter5_1(balanceMasks : String, category : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter(balanceMasks, category);
end;

class (TApplicationRow507_5) TApplicationRow507_5_1(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter5_1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "Касса"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "Касса");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "Касса");
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Касса")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Фактические остатки балансовых счетов", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" по учету наличных денежных средств в ", null , null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте Российской Федерации в кассе:", null , null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator);
    end;

    macro exportToKliko()
        exportDescriptionRow("1.Факт. остатки б/сч. в кассе:", true);
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR5_1", this, "Касса", "R").export();
    end;

    private macro constructorTApplicationRow507_5_1(applicationName : String)
        initTApplicationRow507_5(applicationName);

        m_code = "1";
    end;

    constructorTApplicationRow507_5_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2 приложения5
 **************************************************************************************************/
class (TApplicationRow507_5) TApplicationRow507_5_2(applicationName : String)
    macro saveAttributes()

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, "ИТОГО");
    end;

    macro exportToKliko()
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_DATE);

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportValueRow(iterator, "2.Итого");
        else
            exportValueRow(iterator, "2.ИТОГО");
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow507_5_2(applicationName : String)
        initTApplicationRow507_5(applicationName);

        m_code = "2";
    end;

    constructorTApplicationRow507_5_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3 приложения5
 **************************************************************************************************/
class (TApplicationRow507_5) TApplicationRow507_5_3(applicationName : String)
    macro saveAttributes()
        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2");
            chronologicAverage = calculateChronologicAverage(iterator);
            if (chronologicAverage != NULL)
                saveAttributeValue("", "", Date(0,0,0), chronologicAverage.rouble, $0.0, round(chronologicAverage.scaledRouble, 0), 0.0);

            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Средняя хронологическая", reportWidth, true);
        printDescriptionRow(" величина наличных денежных", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" средств в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в кассе (по данным строки 2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";


        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("3.Средняя хрон. вел. (по стр. 2)", value);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow507_5_3(applicationName : String)
        initTApplicationRow507_5(applicationName);

        m_code = "3";
    end;

    constructorTApplicationRow507_5_3(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 4 приложения5
 **************************************************************************************************/
class (TApplicationRow507_5) TApplicationRow507_5_4(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;

        var iterator : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.4");
                iterator.moveFirst();

            if (iterator.count > 0)
                compositeValue = iterator.currentItem();
                saveAttributeValue("", "", Date(0,0,0), compositeValue.fieldValue("sum").exact * 0.25, $0.0,
                                                        round(compositeValue.fieldValue("sum").scaled * 0.25, 0), 0.0);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Величина обязательных резервов по ", reportWidth, true);
        printDescriptionRow(" обязательствам в валюте Российской", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федерации с учетом ограничения,", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" установленного пунктом 3.5 Положения", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Банка России от 1 декабря 2015 года", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" № 507-П (строка 2.4 Расчета * 25/100)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";


        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("4.Величина обязат. резервов по обязательствам в валюте РФ", value);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow507_5_4(applicationName : String)
        initTApplicationRow507_5(applicationName);

        m_code = "4";
    end;

    constructorTApplicationRow507_5_4(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 5 приложения5
 **************************************************************************************************/
class (TApplicationRow507_5) TApplicationRow507_5_5(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator3 = getAttributeValueIterator(m_applicationName, NULL);
            iterator3.setFilter(FILTER_FOR_APPLICATION_ROW, "3");
            iterator3.moveFirst();

            var iterator4 = getAttributeValueIterator(m_applicationName, NULL);
            iterator4.setFilter(FILTER_FOR_APPLICATION_ROW, "4");
            iterator4.moveFirst();

            var compositeValue3 = iterator3.currentItem();
            var compositeValue4 = iterator4.currentItem();

            if (compositeValue3.fieldValue("roubleRest").exact > compositeValue4.fieldValue("roubleRest").exact)
                var iterator = getAttributeValueIterator("Приложение1", NULL);
                iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.4");
                iterator.moveFirst();

                var compositeValue = iterator.currentItem();

                saveAttributeValue("", "", Date(0,0,0), compositeValue.fieldValue("sum").exact * 0.25, $0.0,
                                                        floor(double(compositeValue.fieldValue("sum").scaled * 0.25)), 0.0);
            else
                saveAttributeValue("", "", Date(0,0,0), compositeValue3.fieldValue("roubleRest").exact, $0.0,
                                                        compositeValue3.fieldValue("roubleRest").scaled, 0.0);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Величина исключаемых наличных денежных", reportWidth, true);
        printDescriptionRow(" средств в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в кассе кредитной организации,", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (строка 3, если строка 3 <= строке 4, ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" или строка 4, если строка 3 > строки 4),", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" код обозначения - 202025", null, null, beginDateInBlock, numberDatesInBlock);
        printBottom(null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";


        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("5.Велич. исключ. нал. ден.средств в валюте РФ в кассе КО (код 202025)", value);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow507_5_5(applicationName : String)
        initTApplicationRow507_5(applicationName);

        m_code = "5";
    end;

    constructorTApplicationRow507_5_5(applicationName);
end;

// Базовый класс строк Приложения 5 по 4217-У
private class (TApplicationRow2_7_4217) TApplicationRow5_4217(applicationName : String)
    private macro printRow(iterator : Object, isPrintRowNumber : Bool, description : String)
        var currentBalance : String = "no balance";
        var isFirst = true;
        var compositeValue : Object = NULL;
        var str : String = "";
        var numberColumnString : String = "";

        if (isPrintRowNumber)
            numberColumnString = getNumberColumnString();
        else
            numberColumnString = "│      │";
        end;

        iterator.moveFirst();
        while (not iterator.isDone)
            compositeValue = iterator.currentItem;
            if (currentBalance != compositeValue.fieldValue("balance").currentAsString)
                if (not IsFirst)
                    printLn(str);
                end;
                isFirst = false;
                currentBalance = compositeValue.fieldValue("balance").currentAsString;
                if (description == NULL)
                    str = numberColumnString + getDiscriptionColumnString(currentBalance, STR_ALIGN_CENTER);
                else
                    str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
                end;
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString, true);
            else
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString, true);
            end;
            iterator.moveNext();
        end;

        var dateCount   : Integer = global.parameters.getEndDate() - global.parameters.getBeginDate() + 2;
        var i           : Integer = 0;

        if ((iterator.count == 0) and (description != NULL))
            str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
            while (i < dateCount)
                str = str + getSumColumnString(0, true);
                i = i + 1;
            end;
            printLn(str);
        end;

        if (iterator.count > 0)
            printLn(str);
        end;
    end;

    private macro printDescriptionRow(description : String, isPrintRowNumber : Bool, isPrintDelimeter: Bool, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var delimeter   : String  = "";
        var str         : String  = "";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;

        if (isPrintRowNumber)
            str = getNumberColumnString();
        else
            str = "│      │";
        end;

        if (isPrintDelimeter)
            delimeter = "│";
        else
            delimeter = " ";
        end;

        str = str + getDiscriptionColumnString(description, STR_ALIGN_LEFT);

        while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
            str = str + mkStr(" ", columnWidth) + delimeter;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "│");
    end;

    private macro printSeparator(separatorKind : Integer, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var str         : String  = "├──────┼─────────────────────────────────────────┼";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;
        var cross       : String;

        if (separatorKind == 0)
            cross = "┬";
        elif (separatorKind == 1)
            cross = "┼";
        elif (separatorKind == 2)
            cross = "┴";
        elif (separatorKind == 3)
            cross = "─";
        end;

        while ((i < dateCount)and(beginDateInBlock + i <= global.parameters.getEndDate()))
            str = str + mkStr("─", columnWidth) + cross;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "┤");
    end;

    private macro printBottom(isDelimeter : Bool, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var str         : String  = "└──────┴─────────────────────────────────────────┴";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;
        var delimeter   : String  = "";
        if (isDelimeter)
            delimeter = "┴";
        else
            delimeter = "─";
        end;

        while ((i < dateCount)and(beginDateInBlock + i <= global.parameters.getEndDate()))
            str = str + mkStr("─", columnWidth) + delimeter;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "┘");
    end;

    // 09.03.2017 ABP Надо бы переписать TApplicationRow::exportValueRowExt() так, чтоб он умел и с П5 работать.
    private macro exportValueRowExt(iterator : Object, description : String, isPrintRouble : Bool, isPrintCurrency : Bool)
        var valueArray     : Object = getArrayExt(0, isPrintRouble, isPrintCurrency);
        var isFirst        : Bool   = true;
        var currentBalance : String = "no balance";
        var compositeValue : Object = NULL;

        var lastRoubleValue   = "";

        var i : Integer = 0;
        iterator.moveFirst();
        while (not iterator.isDone)
            compositeValue = iterator.currentItem;
            if (currentBalance != compositeValue.fieldValue("balance").currentAsString)
                if (not isFirst)
                    global.klikoExportFile.printString(valueArray);
                end;
                isFirst = false;
                currentBalance = compositeValue.fieldValue("balance").currentAsString;
                valueArray = getArrayExt(0, isPrintRouble, isPrintCurrency);
                i = 0;
                if (description == NULL)
                    valueArray[i] = currentBalance;
                else
                    valueArray[i] = description;
                end;
                i = i + 1;
                valueArray[i] = ternary(isPrintRouble, compositeValue.fieldValue("roubleRest").currentAsString, "");
            else
                valueArray[i] = ternary(isPrintRouble, compositeValue.fieldValue("roubleRest").currentAsString, "");
            end;

            lastRoubleValue   = ternary(isPrintRouble, compositeValue.fieldValue("roubleRest").currentAsString, "");

            iterator.moveNext();
            i = i + 1;
        end;

        if (iterator.count > 0)
            global.klikoExportFile.printString(valueArray);
        end;

        if ((iterator.count == 0) and (description != NULL))
            valueArray[0] = description;
            global.klikoExportFile.printString(valueArray);
        end;
    end;

    macro getExportCode()
        return strSubst(getCode(), ".", "");
    end;

    private macro constructorTApplicationRow5_4217(applicationName : String)
        initTApplicationRow2_7_4217(applicationName);

        m_valueColumnWidth = 17;
    end;

    constructorTApplicationRow5_4217(applicationName);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter1(balanceMasks : String, category : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

// Строка 1 Приложения 5 по 4217-У
class (TApplicationRow5_4217) TApplicationRow5_1_4217(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "Касса"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "Касса");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "Касса");
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Касса")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Фактические остатки балансовых счетов", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" по учету наличных денежных средств в ", null , null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте Российской Федерации в кассе:", null , null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator);
    end;

    macro exportToKliko()
        exportDescriptionRow("1.Факт. остатки б/сч. в кассе:", true);
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR5_1", this, "Касса", "R").export();
    end;

    private macro constructorTApplicationRow5_1_4217(applicationName : String)
        initTApplicationRow5_4217(applicationName);

        m_code = "1";
    end;

    constructorTApplicationRow5_1_4217(applicationName);
end;

// Строка 2 Приложения 5 по 4217-У
class (TApplicationRow5_4217) TApplicationRow5_2_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, "ИТОГО");
    end;

    macro exportToKliko()
        var description;

        if (global.reportingPeriodIsVror == false)
            description = "2.Итого";
        else
            description = "2.ИТОГО";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow5_2_4217(applicationName : String)
        initTApplicationRow5_4217(applicationName);

        m_code = "2";
    end;

    constructorTApplicationRow5_2_4217(applicationName);
end;

// Строка 3 Приложения 5 по 4217-У
class (TApplicationRow5_4217) TApplicationRow5_3_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2");
            value = calculateArithmeticalMean(iterator);
            if (value != NULL)
                saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, round(value.scaledRouble, 0), 0.0);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Средняя арифметическая", reportWidth, true);
        printDescriptionRow(" величина наличных денежных", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" средств в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в кассе (по данным строки 2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("3.Средняя арифм. вел. (по стр. 2)", value);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow5_3_4217(applicationName : String)
        initTApplicationRow5_4217(applicationName);

        m_code = "3";
    end;

    constructorTApplicationRow5_3_4217(applicationName);
end;

// Строка 4 Приложения 5 по 4217-У
class (TApplicationRow5_4217) TApplicationRow5_4_4217(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;

        var iterator : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.6");
            iterator.moveFirst();
            if (iterator.count > 0)
                compositeValue = iterator.currentItem();
                saveAttributeValue("", "", Date(0,0,0), compositeValue.fieldValue("sum").exact * 0.25, $0.0,
                                                        floor(Double(compositeValue.fieldValue("sum").scaled * 0.25), 0), 0.0);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Величина обязательных резервов по ", reportWidth, true);
        printDescriptionRow(" обязательствам в валюте Российской", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федерации с учетом ограничения,", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" установленного пунктом 3.5 Положения", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Банка России от 1 декабря 2015 года", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" № 507-П (строка 2.6 Расчета * 25/100)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("4.Величина обязат. резервов по обязательствам в валюте РФ", value);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow5_4_4217(applicationName : String)
        initTApplicationRow5_4217(applicationName);

        m_code = "4";
    end;

    constructorTApplicationRow5_4_4217(applicationName);
end;

// Строка 5 Приложения 5 по 4217-У
class (TApplicationRow5_4217) TApplicationRow5_5_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator3 = getAttributeValueIterator(m_applicationName, NULL);
            iterator3.setFilter(FILTER_FOR_APPLICATION_ROW, "3");
            iterator3.moveFirst();

            var iterator4 = getAttributeValueIterator(m_applicationName, NULL);
            iterator4.setFilter(FILTER_FOR_APPLICATION_ROW, "4");
            iterator4.moveFirst();

            var compositeValue3 = iterator3.currentItem();
            var compositeValue4 = iterator4.currentItem();

            if (compositeValue3.fieldValue("roubleRest").exact > compositeValue4.fieldValue("roubleRest").exact)
                var iterator = getAttributeValueIterator("Приложение1", NULL);
                iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.6");
                iterator.moveFirst();

                var compositeValue = iterator.currentItem();

                saveAttributeValue("", "", Date(0,0,0), compositeValue.fieldValue("sum").exact * 0.25, $0.0,
                                                        floor(Double(compositeValue.fieldValue("sum").scaled * 0.25)), 0.0);
            else
                saveAttributeValue("", "", Date(0,0,0), compositeValue3.fieldValue("roubleRest").exact, $0.0,
                                                        compositeValue3.fieldValue("roubleRest").scaled, 0.0);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Величина исключаемых наличных денежных", reportWidth, true);
        printDescriptionRow(" средств в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в кассе кредитной организации,", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (строка 3, если строка 3 <= строке 4, ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" или строка 4, если строка 3 > строки 4),", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" код обозначения - 202025", null, null, beginDateInBlock, numberDatesInBlock);
        printBottom(null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("5.Велич. исключ. нал. ден.средств в валюте РФ в кассе КО (код 202025)", value);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow5_5_4217(applicationName : String)
        initTApplicationRow5_4217(applicationName);

        m_code = "5";
    end;

    constructorTApplicationRow5_5_4217(applicationName);
end;

// Базовый класс строк Приложения 5 по 5036-У
private class (TApplicationRow2_7_5036) TApplicationRow5_5036(applicationName : String, xlsView)
    private macro printRow(iterator : Object, isPrintRowNumber : Bool, description : String)
        var currentBalance : String = "no balance";
        var isFirst = true;
        var compositeValue : Object = NULL;
        var str : String = "";
        var numberColumnString : String = "";

        if (isPrintRowNumber)
            numberColumnString = getNumberColumnString();
        else
            numberColumnString = "│      │";
        end;

        iterator.moveFirst();
        while (not iterator.isDone)
            compositeValue = iterator.currentItem;
            if (currentBalance != compositeValue.fieldValue("balance").currentAsString)
                if (not IsFirst)
                    printLn(str);
                end;
                isFirst = false;
                currentBalance = compositeValue.fieldValue("balance").currentAsString;
                if (description == NULL)
                    str = numberColumnString + getDiscriptionColumnString(currentBalance, STR_ALIGN_CENTER);
                else
                    str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
                end;
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString, true);
            else
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString, true);
            end;
            iterator.moveNext();
        end;

        var dateCount   : Integer = global.parameters.getEndDate() - global.parameters.getBeginDate() + 2;
        var i           : Integer = 0;

        if ((iterator.count == 0) and (description != NULL))
            str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
            while (i < dateCount)
                str = str + getSumColumnString(0, true);
                i = i + 1;
            end;
            printLn(str);
        end;

        if (iterator.count > 0)
            printLn(str);
        end;
    end;
	
	private macro printRowExcel(iterator : Object, isPrintRowNumber : Bool, description : String)
        var currentBalance : String = "no balance";
        var isFirst = true;
        var compositeValue : Object = NULL;
        var str : String = "";
        var numberColumnString : String = "";
		
		var rowArray           : RcbArray = RcbArray();

        if (isPrintRowNumber)
            numberColumnString = m_code;
        else
            numberColumnString = " ";
        end;

        iterator.moveFirst();
        while (not iterator.isDone)
            compositeValue = iterator.currentItem;
            if (currentBalance != compositeValue.fieldValue("balance").currentAsString)
                if (not IsFirst)
                    m_xlsView.printRow(rowArray);
					rowArray.clear();
                end;
                isFirst = false;
                currentBalance = compositeValue.fieldValue("balance").currentAsString;
                if (description == NULL)
                    rowArray[rowArray.size] = numberColumnString;
			        rowArray[rowArray.size] = currentBalance;
                else
                    rowArray[rowArray.size] = numberColumnString;
			        rowArray[rowArray.size] = description;
                end;
                rowArray[rowArray.size] = compositeValue.fieldValue("roubleRest").currentAsString;
            else
                rowArray[rowArray.size] = compositeValue.fieldValue("roubleRest").currentAsString;
            end;
            iterator.moveNext();
        end;

        var dateCount   : Integer = global.parameters.getEndDate() - global.parameters.getBeginDate() + 2;
        var i           : Integer = 0;

        if ((iterator.count == 0) and (description != NULL))
            rowArray[rowArray.size] = numberColumnString;
			rowArray[rowArray.size] = description;
            while (i < dateCount)
                rowArray[rowArray.size] = "0";
                i = i + 1;
            end;
            m_xlsView.printRow(rowArray);
        end;

        if (iterator.count > 0)
            m_xlsView.printRow(rowArray);
        end;
    end;

    private macro printDescriptionRow(description : String, isPrintRowNumber : Bool, isPrintDelimeter: Bool, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var delimeter   : String  = "";
        var str         : String  = "";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;

        if (isPrintRowNumber)
            str = getNumberColumnString();
        else
            str = "│      │";
        end;

        if (isPrintDelimeter)
            delimeter = "│";
        else
            delimeter = " ";
        end;

        str = str + getDiscriptionColumnString(description, STR_ALIGN_LEFT);

        while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
            str = str + mkStr(" ", columnWidth) + delimeter;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "│");
    end;

    private macro printSeparator(separatorKind : Integer, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var str         : String  = "├──────┼─────────────────────────────────────────┼";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;
        var cross       : String;

        if (separatorKind == 0)
            cross = "┬";
        elif (separatorKind == 1)
            cross = "┼";
        elif (separatorKind == 2)
            cross = "┴";
        elif (separatorKind == 3)
            cross = "─";
        end;

        while ((i < dateCount)and(beginDateInBlock + i <= global.parameters.getEndDate()))
            str = str + mkStr("─", columnWidth) + cross;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "┤");
    end;

    private macro printBottom(isDelimeter : Bool, beginDateInBlock, numberDatesInBlock)
        var columnWidth : Integer = nvl(m_valueColumnWidth, 14);
        var str         : String  = "└──────┴─────────────────────────────────────────┴";
        var dateCount   : Integer = numberDatesInBlock;
        var i           : Integer = 0;
        var delimeter   : String  = "";
        if (isDelimeter)
            delimeter = "┴";
        else
            delimeter = "─";
        end;

        while ((i < dateCount)and(beginDateInBlock + i <= global.parameters.getEndDate()))
            str = str + mkStr("─", columnWidth) + delimeter;
            i = i + 1;
        end;
        printLn(subStr(str, 1, strLen(str) - 1) + "┘");
    end;

    // 09.03.2017 ABP Надо бы переписать TApplicationRow::exportValueRowExt() так, чтоб он умел и с П5 работать.
    private macro exportValueRowExt(iterator : Object, description : String, isPrintRouble : Bool, isPrintCurrency : Bool)
        var valueArray     : Object = getArrayExt(0, isPrintRouble, isPrintCurrency);
        var isFirst        : Bool   = true;
        var currentBalance : String = "no balance";
        var compositeValue : Object = NULL;

        var lastRoubleValue   = "";

        var i : Integer = 0;
        iterator.moveFirst();
        while (not iterator.isDone)
            compositeValue = iterator.currentItem;
            if (currentBalance != compositeValue.fieldValue("balance").currentAsString)
                if (not isFirst)
                    global.klikoExportFile.printString(valueArray);
                end;
                isFirst = false;
                currentBalance = compositeValue.fieldValue("balance").currentAsString;
                valueArray = getArrayExt(0, isPrintRouble, isPrintCurrency);
                i = 0;
                if (description == NULL)
                    valueArray[i] = currentBalance;
                else
                    valueArray[i] = description;
                end;
                i = i + 1;
                valueArray[i] = ternary(isPrintRouble, compositeValue.fieldValue("roubleRest").currentAsString, "");
            else
                valueArray[i] = ternary(isPrintRouble, compositeValue.fieldValue("roubleRest").currentAsString, "");
            end;

            lastRoubleValue   = ternary(isPrintRouble, compositeValue.fieldValue("roubleRest").currentAsString, "");

            iterator.moveNext();
            i = i + 1;
        end;

        if (iterator.count > 0)
            global.klikoExportFile.printString(valueArray);
        end;

        if ((iterator.count == 0) and (description != NULL))
            valueArray[0] = description;
            global.klikoExportFile.printString(valueArray);
        end;
    end;

    macro getExportCode()
        return strSubst(getCode(), ".", "");
    end;

    private macro constructorTApplicationRow5_5036(applicationName : String, xlsView)
        initTApplicationRow2_7_5036(applicationName, xlsView);

        m_valueColumnWidth = 17;
    end;

    constructorTApplicationRow5_5036(applicationName, xlsView);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter1_5036(balanceMasks : String, category : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter_5036(balanceMasks, category);
end;

// Строка 1 Приложения 5 по 5036-У
class (TApplicationRow5_5036) TApplicationRow5_1_5036(applicationName : String, xlsView)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter1_5036(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "Касса"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "Касса");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "Касса");
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Касса")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Фактические остатки балансовых счетов", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" по учету наличных денежных средств в ", null , null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте Российской Федерации в кассе:", null , null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator);
    end;
	
	macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        
        printDescriptionRowExcel(RcbArray().initialize(" Фактические остатки балансовых счетов",
		                                               " по учету наличных денежных средств в ",
													   " валюте Российской Федерации в кассе:"), true, null, beginDateInBlock, numberDatesInBlock);
        
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRowExcel(iterator);
    end;

    macro exportToKliko()
        exportDescriptionRow("1.Факт. остатки б/сч. в кассе:", true);
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR5_1", this, "Касса", "R").export();
    end;

    private macro constructorTApplicationRow5_1_5036(applicationName : String, xlsView)
        initTApplicationRow5_5036(applicationName, xlsView);

        m_code = "1";
    end;

    constructorTApplicationRow5_1_5036(applicationName, xlsView);
end;

// Строка 2 Приложения 5 по 5036-У
class (TApplicationRow5_5036) TApplicationRow5_2_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, "ИТОГО");
    end;
	
	macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, "ИТОГО");
    end;

    macro exportToKliko()
        var description;

        if (global.reportingPeriodIsVror == false)
            description = "2.Итого";
        else
            description = "2.ИТОГО";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow5_2_5036(applicationName : String, xlsView)
        initTApplicationRow5_5036(applicationName, xlsView);

        m_code = "2";
    end;

    constructorTApplicationRow5_2_5036(applicationName, xlsView);
end;

// Строка 3 Приложения 5 по 5036-У
class (TApplicationRow5_5036) TApplicationRow5_3_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2");
            value = calculateArithmeticalMean(iterator);
            if (value != NULL)
                saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, round(value.scaledRouble, 0), 0.0);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Средняя арифметическая", reportWidth, true);
        printDescriptionRow(" величина наличных денежных", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" средств в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в кассе (по данным строки 2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;
	
	macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize( " Средняя арифметическая",
																  " величина наличных денежных", 
																  " средств в валюте Российской Федерации",
																  " в кассе (по данным строки 2)"),reportWidth, true);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("3.Средняя арифм. вел. (по стр. 2)", value);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow5_3_5036(applicationName : String, xlsView)
        initTApplicationRow5_5036(applicationName, xlsView);

        m_code = "3";
    end;

    constructorTApplicationRow5_3_5036(applicationName, xlsView);
end;

// Строка 4 Приложения 5 по 5036-У
class (TApplicationRow5_5036) TApplicationRow5_4_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var compositeValue : Object = NULL;

        var iterator : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.6");
            iterator.moveFirst();
            if (iterator.count > 0)
                compositeValue = iterator.currentItem();
                saveAttributeValue("", "", Date(0,0,0), compositeValue.fieldValue("sum").exact * 0.25, $0.0,
                                                        floor(Double(compositeValue.fieldValue("sum").scaled * 0.25), 0), 0.0);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Величина обязательных резервов по ", reportWidth, true);
        printDescriptionRow(" обязательствам в валюте Российской", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федерации с учетом ограничения,", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" установленного пунктом 3.5 Положения", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Банка России от 1 декабря 2015 года", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" № 507-П (строка 2.6 Расчета * 25/100)", null, null, beginDateInBlock, numberDatesInBlock);
    end;
	
	macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Величина обязательных резервов по ",
		                                                         " обязательствам в валюте Российской",
																 " Федерации с учетом ограничения,",
																 " установленного пунктом 3.5 Положения",
																 " Банка России от 1 декабря 2015 года",
																 " № 507-П (строка 2.6 Расчета * 25/100)"), reportWidth, true);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("4.Величина обязат. резервов по обязательствам в валюте РФ", value);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow5_4_5036(applicationName : String, xlsView)
        initTApplicationRow5_5036(applicationName, xlsView);

        m_code = "4";
    end;

    constructorTApplicationRow5_4_5036(applicationName, xlsView);
end;

// Строка 5 Приложения 5 по 5036-У
class (TApplicationRow5_5036) TApplicationRow5_5_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator3 = getAttributeValueIterator(m_applicationName, NULL);
            iterator3.setFilter(FILTER_FOR_APPLICATION_ROW, "3");
            iterator3.moveFirst();

            var iterator4 = getAttributeValueIterator(m_applicationName, NULL);
            iterator4.setFilter(FILTER_FOR_APPLICATION_ROW, "4");
            iterator4.moveFirst();

            var compositeValue3 = iterator3.currentItem();
            var compositeValue4 = iterator4.currentItem();

            if (compositeValue3.fieldValue("roubleRest").exact > compositeValue4.fieldValue("roubleRest").exact)
                var iterator = getAttributeValueIterator("Приложение1", NULL);
                iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.6");
                iterator.moveFirst();

                var compositeValue = iterator.currentItem();

                saveAttributeValue("", "", Date(0,0,0), compositeValue.fieldValue("sum").exact * 0.25, $0.0,
                                                        floor(Double(compositeValue.fieldValue("sum").scaled * 0.25)), 0.0);
            else
                saveAttributeValue("", "", Date(0,0,0), compositeValue3.fieldValue("roubleRest").exact, $0.0,
                                                        compositeValue3.fieldValue("roubleRest").scaled, 0.0);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Величина исключаемых наличных денежных", reportWidth, true);
        printDescriptionRow(" средств в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в кассе кредитной организации,", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (строка 3, если строка 3 <= строке 4, ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" или строка 4, если строка 3 > строки 4),", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" код обозначения - 202025", null, null, beginDateInBlock, numberDatesInBlock);
        printBottom(null, beginDateInBlock, numberDatesInBlock);
    end;
	
	macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Величина исключаемых наличных денежных",
		                                                         " средств в валюте Российской Федерации",
																 " в кассе кредитной организации,",
																 " (строка 3, если строка 3 <= строке 4, ",
																 " или строка 4, если строка 3 > строки 4),",
																 " код обозначения - 202025"), reportWidth, true);
        
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("5.Велич. исключ. нал. ден.средств в валюте РФ в кассе КО (код 202025)", value);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR5_2", this, "R").export();
    end;

    private macro constructorTApplicationRow5_5_5036(applicationName : String, xlsView)
        initTApplicationRow5_5036(applicationName, xlsView);

        m_code = "5";
    end;

    constructorTApplicationRow5_5_5036(applicationName, xlsView);
end;
