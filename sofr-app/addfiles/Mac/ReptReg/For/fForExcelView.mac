/*
$Name:          fForExcelView.mac
$Module:        Регламентируемая отчетность
$Description:   ФОР. Классы печатного представления Excel на основе Windows Reports
*/

//import or_rep_h;
//import or_tpl_h;
import ExcelReportView;

private const MAX_DATE_COUNT = 31;

/**
 * Базовый класс представления приложения в Excel
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TBasePartExcelView) TApplicationExcelView(applicationName, tableName, printEngine, sheetNumber)
	private var m_dateCount       : Integer = 1;
 	//private var m_colCount        : Integer = 3;
		
	private macro constructorTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber)
		m_applicationName = applicationName;
		m_dateCount       = global.parameters.getEndDate() - global.parameters.getBeginDate() + 1;
		initTBasePartExcelView(applicationName, tableName, printEngine, sheetNumber);
	end;
	constructorTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber);
end;


/**
 * Базовый класс представления приложения с переменным числом граф в Excel
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TApplicationExcelView) TApplExcelView_ColumnsVaries(applicationName, tableName, printEngine, sheetNumber)
	
	/**
	 * Удалить незаполненные колонки шаблона
	 *
	 * @param diapazon         Диапазон заполненной части шаблона.
	 * @param emptyColumnCount Количество пустых колонок шаблона(колонок листа без учета объединений).
	 */
	private macro removeEmptyColumns(diapazon, emptyColumnCount)
		var uDiap = CAddressDiapazon();
		uDiap.OffSet_Left  ( diapazon.Get_bCol() + diapazon.GetNumbColumn() );
		uDiap.OffSet_Right ( diapazon.Get_eCol() + emptyColumnCount + 1);
		if(uDiap.Get_bCol() < uDiap.Get_eCol())
			m_printEngine.RemoveColumn (strsubst(uDiap.Get_Address(),"1",""), m_applicationName);
		end;
	end;
	
	private macro makeAdditionalFormatting(diapazon);
		removeEmptyColumns(diapazon, (MAX_DATE_COUNT - m_dateCount) * 2);
	end;
		
	private macro constructorTApplicationExcelView_ColsVaries(applicationName, tableName, printEngine, sheetNumber)
		initTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber);
	end;
	
	constructorTApplicationExcelView_ColsVaries(applicationName, tableName, printEngine, sheetNumber);
end;


/**
 * Класс представления приложения 1
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TApplicationExcelView) TApp1View(applicationName, tableName, printEngine, sheetNumber)
	
	macro makeRowCSV(dataset)
				
		
		var titleRowCount = 1;
		var title = "";
		
		title = getMergedMultiline( dataset[1] , @titleRowCount);
		
		//Графа 1
		addCellToCurRow(cell(dataset[0]));
		//Графа 2
		addCellToCurRow(ternary(titleRowCount > 1, cell(title).setRowHeight(titleRowCount), cell(title)));
		addCellToCurRow(cell(null));
		addCellToCurRow(cell(null));
		//Графа 3
		addCellToCurRow(cell(dataset[2]));
	end;
	
	macro printHead(lendingAgencyCodeZone : Object, namesZone : Object)
	    m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("okatoCode",     lendingAgencyCodeZone.getOkato());
		m_printEngine.SetValue_NameCell("okpoCode",      strLpad(lendingAgencyCodeZone.getOkpo(),8,"0"));
		m_printEngine.SetValue_NameCell("regNumber",     lendingAgencyCodeZone.getRegistrationNumber());
		m_printEngine.SetValue_NameCell("app1_name",     namesZone.getFormName());
		m_printEngine.SetValue_NameCell("app1_period",   namesZone.getPeriodName());
		m_printEngine.SetValue_NameCell("bankName",      namesZone.getLendingAgencyName());
		m_printEngine.SetValue_NameCell("address",       namesZone.getLendingAgencyPostalAdress());
		m_printEngine.SetValue_NameCell("periodicity",   namesZone.getPeriodicityName());
		m_printEngine.SetValue_NameCell("app1_currency", namesZone.getUnitName());
	end;
	
	macro printSignature(signatureZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app1_boss", signatureZone.getSigner());
		m_printEngine.SetValue_NameCell("app1_boss2", signatureZone.getSignerName());
		m_printEngine.SetValue_NameCell("app1_user", signatureZone.getExecutor());
		m_printEngine.SetValue_NameCell("phone",     signatureZone.getPhone());
		m_printEngine.SetValue_NameCell("date",      signatureZone.getDate());
	end;
	
	private macro reheightSingleCells()
		reheightCell("app1_note1", 1);
		reheightCell("app1_note2", 3);
		reheightCell("app1_note3", 2);
	end;
	
	private macro constructorTApp1View(applicationName, tableName, printEngine, sheetNumber)
		initTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber);
	end;
	constructorTApp1View(applicationName, tableName, printEngine, sheetNumber);
end;

/**
 * Класс представления приложения 2
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TApplExcelView_ColumnsVaries) TApp2View(applicationName, tableName, printEngine, sheetNumber)
	
	macro makeRowCSV(dataset)
		var titleRowCount = 1;
		var title = "";
		
		title = getMergedMultiline( dataset[1] , @titleRowCount);
				
		//Графа 1
		addCellToCurRow(cell(dataset[0]));
		//Графа 2
		addCellToCurRow(ternary(titleRowCount > 1, cell(title).setRowHeight(titleRowCount), cell(title)));
		addCellToCurRow(cell(null));
		addCellToCurRow(cell(null));
		
		
		if ((dataset[0] == "1")     or
		    (dataset[0] == "1.1")   or
		    (dataset[0] == "1.2")   or
			(dataset[0] == "1.2.2") or
		    (dataset[0] == "2")     or
		    (dataset[0] == "3")     or
		    (dataset[0] == "3.1")   or
		    (dataset[0] == "3.1.2") or
		    (dataset[0] == "3.2")   or
			(dataset[0] == "3.2.2"))
			//Графа 3-64(пустая)
			addCellToCurRow(cell("").setHorMerged(m_dateCount * 2));
			addEmptyCellToCurRow(m_dateCount * 2 - 1);
		elif ((dataset[0] == "1.1.2") or
		      (dataset[0] == "1.1.3") or
			  (dataset[0] == "1.2.4") or
		      (dataset[0] == "1.2.5") or
			  (dataset[0] == "2.2") or
		      (dataset[0] == "2.3") or
		      (dataset[0] == "3.1.5") or
		      (dataset[0] == "3.1.6")or
		      (dataset[0] == "3.2.5")or
		      (dataset[0] == "3.2.6"))
			//Графа 3-64(одно значение)
			addCellToCurRow(cell(dataset[2]).setHorMerged(m_dateCount * 2));
            addEmptyCellToCurRow(m_dateCount * 2 - 1);			
		else
			var blockCount = 0;
			while(blockCount < m_dateCount)
			    //Графа 3+ (повторяется по количеству дат)
				addCellToCurRow(cell(dataset[blockCount * 2 + 2]));
                //Графа 4+ (повторяется по количеству дат)				
				addCellToCurRow(cell(dataset[blockCount * 2 + 3]));                                                   
				blockCount = blockCount + 1;
			end;
		end;
	
	end;
	
	macro printHead(lendingAgencyCodeZone : Object, namesZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app2_name",     namesZone.getFormName());
		m_printEngine.SetValue_NameCell("app2_period",   namesZone.getPeriodName());
		m_printEngine.SetValue_NameCell("app2_bankName", namesZone.getLendingAgencyName());
		m_printEngine.SetValue_NameCell("app2_currency", namesZone.getUnitName());
		
		var headDateCount = 1;
		var fistDate      = global.parameters.getBeginDate();
		var restDate      = fistDate;
		while(headDateCount <= m_dateCount)			
			m_printEngine.SetValue_NameCell("app2_date" + headDateCount, String(restDate:f) );
			restDate = fistDate + headDateCount;
			headDateCount = headDateCount + 1;            	
		end;
	end;
	
	macro printSignature(signatureZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app2_boss", signatureZone.getSigner());
		m_printEngine.SetValue_NameCell("app2_boss2", signatureZone.getSignerName());
	end;
	
	private macro reheightSingleCells()
		reheightCell("app2_note1", 3);
		reheightCell("app2_note2", 2);
		reheightCell("app2_note3", 2);
	end;

	private macro constructorTApp2View(applicationName, tableName, printEngine, sheetNumber)
		initTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber);
	end;
	constructorTApp2View(applicationName, tableName, printEngine, sheetNumber);
end;

/**
 * Класс представления приложения 3
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TApplExcelView_ColumnsVaries) TApp3View(applicationName, tableName, printEngine, sheetNumber)

	macro makeRowCSV(dataset)
			
		var titleRowCount = 1;
		var title = "";
		
		title = getMergedMultiline( dataset[1] , @titleRowCount);
				
		//Графа 1
		addCellToCurRow(cell(dataset[0]));
		//Графа 2
		addCellToCurRow(ternary(titleRowCount > 1, cell(title).setRowHeight(titleRowCount), cell(title)));
		addCellToCurRow(cell(null));
		addCellToCurRow(cell(null));
		
		if ((dataset[0] == "1")     or
		    (dataset[0] == "1.1")   or
		    (dataset[0] == "1.2"))
			//Графа 3-64(пустая)
			addCellToCurRow(cell("").setHorMerged(m_dateCount * 2));
			addEmptyCellToCurRow(m_dateCount * 2 - 1);
		elif (false)
			//Графа 3-64(одно значение)
		    addCellToCurRow(cell(dataset[2]).setHorMerged(m_dateCount * 2)); 
			addEmptyCellToCurRow(m_dateCount * 2 - 1);
		else
			var blockCount = 0;
			while(blockCount < m_dateCount)
				//Графа 3+ (повторяется по количеству дат)
				addCellToCurRow(cell(dataset[blockCount * 2 + 2]));
				//Графа 4+ (повторяется по количеству дат)
				addCellToCurRow(cell(dataset[blockCount * 2 + 3]));                                                    
				blockCount = blockCount + 1;
			end;
		end;
	end;
	
	macro printHead(lendingAgencyCodeZone : Object, namesZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app3_name",     namesZone.getFormName());
		m_printEngine.SetValue_NameCell("app3_period",   namesZone.getPeriodName());
		m_printEngine.SetValue_NameCell("app3_bankName", namesZone.getLendingAgencyName());
		m_printEngine.SetValue_NameCell("app3_currency", namesZone.getUnitName());
		
		var headDateCount = 1;
		var fistDate      = global.parameters.getBeginDate();
		var restDate      = fistDate;
		while(headDateCount <= m_dateCount)			
			m_printEngine.SetValue_NameCell("app3_date" + headDateCount,String(restDate:f) );
			restDate = fistDate + headDateCount;
			headDateCount = headDateCount + 1;            	
		end;
	end;
	
	macro printSignature(signatureZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app3_boss", signatureZone.getSigner());
		m_printEngine.SetValue_NameCell("app3_boss2", signatureZone.getSignerName());
	end;
	
	private macro reheightSingleCells()
		reheightCell("app3_note1", 3);
	end;

	private macro constructorTApp3View(applicationName, tableName, printEngine, sheetNumber)
		initTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber);
	end;
	constructorTApp3View(applicationName, tableName, printEngine, sheetNumber);
end;

/**
 * Класс представления приложения 4
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TApplExcelView_ColumnsVaries) TApp4View(applicationName, tableName, printEngine, sheetNumber)

	macro makeRowCSV(dataset)
			
		var titleRowCount = 1;
		var title = "";
				
		title = getMergedMultiline( dataset[1] , @titleRowCount);
				
		//Графа 1
		addCellToCurRow(cell(dataset[0]));
		//Графа 2
		addCellToCurRow(ternary(titleRowCount > 1, cell(title).setRowHeight(titleRowCount), cell(title)));
		addCellToCurRow(cell(null));
		addCellToCurRow(cell(null));
		
		if ((dataset[0] == "1")     or
		    (dataset[0] == "1.1")   or
		    (dataset[0] == "1.2"))
			//Графа 3-64(пустая)
			addCellToCurRow(cell("").setHorMerged(m_dateCount * 2));
			addEmptyCellToCurRow(m_dateCount * 2 - 1);
		elif ((dataset[0] == "2"))
			//Графа 3-64(одно значение)
			addCellToCurRow(cell(dataset[2]).setHorMerged(m_dateCount * 2));
			addEmptyCellToCurRow(m_dateCount * 2 - 1);
		else
			var blockCount = 0;
			while(blockCount < m_dateCount)
				//Графа 3+ (повторяется по количеству дат)
				addCellToCurRow(cell(dataset[blockCount * 2 + 2]));
				//Графа 4+ (повторяется по количеству дат)
				addCellToCurRow(cell(dataset[blockCount * 2 + 3]));                                                    
				blockCount = blockCount + 1;
			end;
		end;
		
	end;
	
	macro printHead(lendingAgencyCodeZone : Object, namesZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app4_name",     namesZone.getFormName());
		m_printEngine.SetValue_NameCell("app4_period",   namesZone.getPeriodName());
		m_printEngine.SetValue_NameCell("app4_bankName", namesZone.getLendingAgencyName());
		m_printEngine.SetValue_NameCell("app4_currency", namesZone.getUnitName());
		
		var headDateCount = 1;
		var fistDate      = global.parameters.getBeginDate();
		var restDate      = fistDate;
		while(headDateCount <= m_dateCount)			
			m_printEngine.SetValue_NameCell("app4_date" + headDateCount, String(restDate:f) );
			restDate = fistDate + headDateCount;
			headDateCount = headDateCount + 1;            	
		end;
	end;
	
	macro printSignature(signatureZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app4_boss", signatureZone.getSigner());
		m_printEngine.SetValue_NameCell("app4_boss2", signatureZone.getSignerName());
	end;
	
	private macro reheightSingleCells()
		reheightCell("app4_note1", 3);
		reheightCell("app4_note2", 2);
		reheightCell("app4_note3", 3);
		reheightCell("app4_note4", 1);
	end;
	
	private macro constructorTApp4View(applicationName, tableName, printEngine, sheetNumber)
		initTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber);
	end;
	constructorTApp4View(applicationName, tableName, printEngine, sheetNumber);
end;

/**
 * Класс представления приложения 5
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TApplExcelView_ColumnsVaries) TApp5View(applicationName, tableName, printEngine, sheetNumber)

	private macro makeAdditionalFormatting(diapazon);
		removeEmptyColumns(diapazon, MAX_DATE_COUNT - m_dateCount);
	end;

	macro makeRowCSV(dataset)
			
		var titleRowCount = 1;
		var title = "";
		
		title = getMergedMultiline( dataset[1] , @titleRowCount);
				
		//Графа 1
		addCellToCurRow(cell(dataset[0]));
		//Графа 2
		addCellToCurRow(ternary(titleRowCount > 1, cell(title).setRowHeight(titleRowCount), cell(title)));
		addCellToCurRow(cell(null));
		addCellToCurRow(cell(null));
		
		if ((dataset[0] == "1"))
		    //Графа 3-32(пустая)
			addCellToCurRow(cell("").setHorMerged(m_dateCount)); 
			addEmptyCellToCurRow(m_dateCount - 1);
		elif ((dataset[0] == "3") or
			  (dataset[0] == "4") or
		      (dataset[0] == "5"))
			//Графа 3-32(одно значение)
			addCellToCurRow(cell(dataset[2]).setHorMerged(m_dateCount));
			addEmptyCellToCurRow(m_dateCount - 1);
		else
			var blockCount = 0;
			while(blockCount < m_dateCount)
				//Графа 3+ (повторяется по количеству дат)
				addCellToCurRow(cell(dataset[blockCount + 2]));                                                    
				blockCount = blockCount + 1;
			end;
		end;
	end;
	
	macro printHead(lendingAgencyCodeZone : Object, namesZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app5_name",     namesZone.getFormName());
		m_printEngine.SetValue_NameCell("app5_period",   namesZone.getPeriodName());
		m_printEngine.SetValue_NameCell("app5_bankName", namesZone.getLendingAgencyName());
		m_printEngine.SetValue_NameCell("app5_currency", namesZone.getUnitName());
		
		var headDateCount = 1;
		var fistDate      = global.parameters.getBeginDate();
		var restDate      = fistDate;
		while(headDateCount <= m_dateCount)			
			m_printEngine.SetValue_NameCell("app5_date" + headDateCount, String(restDate:f) );
			restDate = fistDate + headDateCount;
			headDateCount = headDateCount + 1;            	
		end;
	end;
	
	macro printSignature(signatureZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app5_boss", signatureZone.getSigner());
		m_printEngine.SetValue_NameCell("app5_boss2", signatureZone.getSignerName());
	end;
	
	private macro reheightSingleCells()
		reheightCell("app5_note1", 2);
	end;
	
	private macro constructorTApp5View(applicationName, tableName, printEngine, sheetNumber)
		initTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber);
	end;
	constructorTApp5View(applicationName, tableName, printEngine, sheetNumber);
end;

/**
 * Класс представления приложения 6
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TApplExcelView_ColumnsVaries) TApp6View(applicationName, tableName, printEngine, sheetNumber)

    macro makeRowCSV(dataset)
			
		var titleRowCount = 1;
		var title = "";
		
		title = getMergedMultiline( dataset[1] , @titleRowCount);
				
		//Графа 1
		addCellToCurRow(cell(dataset[0]));
		//Графа 2
		addCellToCurRow(ternary(titleRowCount > 1, cell(title).setRowHeight(titleRowCount), cell(title)));
		addCellToCurRow(cell(null));
		addCellToCurRow(cell(null));
		
		if ((dataset[0] == "1")     or
		    (dataset[0] == "2")   or
		    (dataset[0] == "3"))
			//Графа 3-64(пустая)
			addCellToCurRow(cell("").setHorMerged(m_dateCount * 2));
			addEmptyCellToCurRow(m_dateCount * 2 - 1);
		elif (false)
			//Графа 3-64(одно значение)
			addCellToCurRow(cell(dataset[2]).setHorMerged(m_dateCount * 2));
			addEmptyCellToCurRow(m_dateCount * 2 - 1);
		else
			var blockCount = 0;
			while(blockCount < m_dateCount)
				//Графа 3+ (повторяется по количеству дат)
				addCellToCurRow(cell(dataset[blockCount * 2 + 2]));
                //Графа 4+ (повторяется по количеству дат)				
				addCellToCurRow(cell(dataset[blockCount * 2 + 3]));                                                    
				blockCount = blockCount + 1;
			end;
		end;
	
	end;
	
	macro printHead(lendingAgencyCodeZone : Object, namesZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app6_name",     namesZone.getFormName());
		m_printEngine.SetValue_NameCell("app6_period",   namesZone.getPeriodName());
		m_printEngine.SetValue_NameCell("app6_bankName", namesZone.getLendingAgencyName());
		m_printEngine.SetValue_NameCell("app6_currency", namesZone.getUnitName());
		
		var headDateCount = 1;
		var fistDate      = global.parameters.getBeginDate();
		var restDate      = fistDate;
		while(headDateCount <= m_dateCount)			
			m_printEngine.SetValue_NameCell("app6_date" + headDateCount, String(restDate:f) );
			restDate = fistDate + headDateCount;
			headDateCount = headDateCount + 1;            	
		end;
	end;
	
	macro printSignature(signatureZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app6_boss", signatureZone.getSigner());
		m_printEngine.SetValue_NameCell("app6_boss2", signatureZone.getSignerName());
	end;
	
	private macro reheightSingleCells()
		reheightCell("app6_note1", 3);
	end;

	private macro constructorTApp6View(applicationName, tableName, printEngine, sheetNumber)
		initTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber);
	end;
	constructorTApp6View(applicationName, tableName, printEngine, sheetNumber);
end;

/**
 * Класс представления приложения Данные о приложениях
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TApplicationExcelView) TAppOtherView(applicationName, tableName, printEngine, sheetNumber)

    macro makeRowCSV(dataset)
				
		var titleRowCount = 1;
		var title = "";
		
		title = getMergedMultiline( dataset[1] , @titleRowCount);
		
		//Графа 1
		addCellToCurRow(cell(dataset[0]));
		//Графа 2
		addCellToCurRow(ternary(titleRowCount > 1, cell(title).setRowHeight(titleRowCount), cell(title)));
		addCellToCurRow(cell(null));
		//Графа 3
		addCellToCurRow(cell(dataset[2]));
		
	end;
	
	macro printHead(lendingAgencyCodeZone : Object, namesZone : Object)
		m_printEngine.SheetChange(m_applicationName);
	    m_printEngine.SetValue_NameCell("app7_name",     namesZone.getFormName());
		m_printEngine.SetValue_NameCell("app7_period",   namesZone.getPeriodName());
		m_printEngine.SetValue_NameCell("app7_bankName", namesZone.getLendingAgencyName());
	end;
	
	macro printSignature(signatureZone : Object)
		m_printEngine.SheetChange(m_applicationName);
		m_printEngine.SetValue_NameCell("app7_boss",  signatureZone.getSigner());
		m_printEngine.SetValue_NameCell("app7_boss2", signatureZone.getSignerName());
		m_printEngine.SetValue_NameCell("app7_user",  signatureZone.getExecutor());
		m_printEngine.SetValue_NameCell("app7_phone", signatureZone.getPhone());
		m_printEngine.SetValue_NameCell("app7_date",  signatureZone.getDate());
	end;
	
	private macro constructorTAppOtherView(applicationName, tableName, printEngine, sheetNumber)
		initTApplicationExcelView(applicationName, tableName, printEngine, sheetNumber);
	end;
	constructorTAppOtherView(applicationName, tableName, printEngine, sheetNumber);
end;

/**
 * ФОР. Класс печатного представления отчета
 *
 * @since   v.6.00.020.31.57
 * @author  MFB
 * @version 1.0
 */
class (TReportExcelView) TForReportExcelView()
	private var m_dateCount        : Integer;

	macro printAppl(appNum, applData)
		m_partViews[appNum].print(applData);
    end;
	
	macro getApplView(appNum)
		return m_partViews[appNum];
    end;
	
	macro save(filename)
		m_printEngine.SaveAsTemplate(filename);
    end;
	
	macro initializePartViews()
		m_partViews[m_partViews.size] = TApp1View    ("Приложение 1",         "app1_table",               this, 1);
		m_partViews[m_partViews.size] = TApp2View    ("Приложение 2",         "app2_table" + m_dateCount, this, 2);
		m_partViews[m_partViews.size] = TApp3View    ("Приложение 3",         "app3_table" + m_dateCount, this, 3);
		m_partViews[m_partViews.size] = TApp4View    ("Приложение 4",         "app4_table" + m_dateCount, this, 4);
		m_partViews[m_partViews.size] = TApp5View    ("Приложение 5",         "app5_table" + m_dateCount, this, 5);
		m_partViews[m_partViews.size] = TApp6View    ("Приложение 6",         "app6_table" + m_dateCount, this, 6);
		m_partViews[m_partViews.size] = TAppOtherView("Данные о приложениях", "app7_table"              , this, 7);
	end;
	
	private macro constructorTReportExcelView()
		var exlname     = "for_tpl.xlsx";
		var exlname1000 = "for_tpl1000.xlsx";
		m_sheetOffset = 0;
		
		m_printEngine = CTemplateXLS();
		if((rcbApplication().currentReport.multiplier == 1.0) AND (rcbApplication().currentReport.dimension == 0))
			m_printEngine.OpenTemplate(exlname);
		else
			m_printEngine.OpenTemplate(exlname1000);
		end;
		
		m_dateCount = global.parameters.getEndDate() - global.parameters.getBeginDate() + 1;
		
		initializePartViews()
	end;
	constructorTReportExcelView();
end;
