/*
$Name:          TApplicationRow6_342.mac
$Module:        Регламентируемая отчетность
$Description:   Классы строк приложения 6 ФОР по 302-П
*/

/*─────────────────────────────────────────────────────────────────────────────────────────────────┐
  RS-Bank V6                                                                        R-Style Softlab
  Файл подсистемы "Регламентируемая отчетность"

  Классы строк приложения6 ФОР по 302-П

  Создан: 22.10.2009 - Ser.
└─────────────────────────────────────────────────────────────────────────────────────────────────*/
/***************************************************************************************************
 *  Класc строки 1 приложения6
 **************************************************************************************************/
class (TApplicationRow342_6) TApplicationRow342_6_1(applicationName : String)
    initTApplicationRow342_6(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter6_1(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = " " + hasAssignedCategory("N")
                +"\n"+ "AND  NOT " + hasAssignedCategory("Строка 2.2")
            ;
        end;

        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                +"\n"+ "AND  " + isNotZeroForAtLeastOneDay();
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    private macro constructor()
        m_code = "1";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNotDataZeroFilter_6(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBalanceInBwpFilter_6(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllFilter_6(this.getCode(), "ФОР");
        end;
    end;

    macro getFilter()
        return TDataSourceFilter6_1(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых",      true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств, выраженных", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в неденежной форме, балансовых счетов:",   false, true, beginDateInBlock, numberDatesInBlock);
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V1");
        else
            global.klikoExportFile.printID("F_P6N1");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter342_6("OR6_1", this, "ФОР", "RV", m_exportFilter).export();
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 2 приложения6
 **************************************************************************************************/
class (TApplicationRow342_6) TApplicationRow342_6_2(applicationName : String)
    initTApplicationRow342_6(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter6_2(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = " NOT " + hasAssignedCategory("N")
                +"\n"+ "     AND NOT " + hasAssignedCategory("Строка 2.2")
                +"\n"+ "     AND (   " + hasAssignedCategory("КО")
                +"\n"+ "          OR (    " + isBank("account.t_contractorId")
                +"\n"+ "              AND NOT " + isNotResident("account.t_contractorId")
                +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_contractorId")
                +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_contractorId") + ")"
                +"\n"+ "          OR (    " + isBank("account.t_clientCode")
                +"\n"+ "              AND NOT " + isNotResident("account.t_clientCode")
                +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_clientCode")
                +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_clientCode") + "))"
            ;
        end;

        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                +"\n"+ "AND " + isNotZeroForAtLeastOneDay();
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    private macro constructor()
        m_code = "2";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNotDataZeroFilter_6(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBalanceInBwpFilter_6(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllFilter_6(this.getCode(), "ФОР");
        end;
    end;

    macro getFilter()
        return TDataSourceFilter6_2(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", true));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых   ", true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" другой кредитной организацией,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" зарегистрированной в установленном    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" порядке и действующей на основании    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выданной Банком России лицензии на    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществление банковских операций,    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" международной финансовой организацией,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществляющей свою деятельность на   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" основе международного  договора       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (соглашения) о ее создании с участием ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Российской Федерации, а также         ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Внешэкономбанком, Банком России,      ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" возникающих в результате заключения   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" договоров (за исключением обязательств", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" по выпущенным долговым ценным бумагам ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" и процентам по ним), и обязательств   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед АСВ и (или) обязательств перед  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" инвесторами, не являющимися кредитными", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" организациями, возникающих в рамках   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" оказания финансовой помощи по планам  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" участия АСВ в предупреждении          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" банкротства в соответствии с          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федеральным законом <О дополнительных ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" мерах для укрепления стабильности     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" банковской системы в период до 31     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" декабря 2011 года>, балансовых счетов:", false, true, beginDateInBlock, numberDatesInBlock);

        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V2");
        else
            global.klikoExportFile.printID("F_P6N2");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);

        //формируем
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter342_6("OR6_3", this, "ФОР", "RV", m_exportFilter).export();
    end;

    constructor();
end;

class (TApplicationRow342_6_2) TApplicationRow342_6_2_2963(applicationName : String)
    initTApplicationRow342_6_2(applicationName);

    private macro printRow(beginDateInBlock : Date, numberDatesInBlock : Integer, iterator : Object, isPrintRowNumber : Bool, isPrintRouble : Bool, isPrintCurrency : Bool, description : String)

        var compositeValue     : Object  = NULL;
        var currentBalance     : String  = "no balance";
        var str                : String  = "";
        var numberColumnString : String  = "";
        var dateCount          : Integer = global.parameters.getEndDate() - global.parameters.getBeginDate() + 2;
        var i                  : Integer = 0;
        var isNeedPrint                  = false;
        var daysInRow                    = numberDatesInBlock; /* Фактическое количество дат в блоке */

        if (isPrintRowNumber)
            numberColumnString = getNumberColumnString();
        else
            numberColumnString = "│      │";
        end;

        if (beginDateInBlock + numberDatesInBlock > global.parameters.getEndDate() + 1)
            daysInRow = NDays(beginDateInBlock - 1, global.parameters.getEndDate() + 2);
        end;

        iterator.moveFirst();
        while (not iterator.isDone)

            compositeValue = iterator.currentItem;
            if (currentBalance != global.exportBalanceProcessor.getBalanceNumber(compositeValue))

                if (str != "")
                    while (i < daysInRow)
                    str = str + getSumColumnString(0, isPrintRouble);
                    str = str + getSumColumnString(0, isPrintCurrency);
                    i = i + 1;
                    end;

                    i = 0;
                    if (isNeedPrint)
                    printLn(str);
                        isNeedPrint = false;
                    end;
                end;

                currentBalance = global.exportBalanceProcessor.getBalanceNumber(compositeValue);
                if (description == NULL)
                    str = numberColumnString + getDiscriptionColumnString(currentBalance, STR_ALIGN_CENTER);
                else
                    str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
                end;
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            else
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            end;

            if (description == NULL)
                if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
                    if (isNotDataZero(compositeValue) and (not isNeedPrint))
                        isNeedPrint = true;
                    end;
                elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
                    if (isBalanceInBwp(compositeValue) and (not isNeedPrint))
                        isNeedPrint = true;
                    end;
                else
                    isNeedPrint = true;
                end;
            else
                isNeedPrint = true;
            end;

            i = i + 1;
            iterator.moveNext();
        end;

        i = 0;
        if ((iterator.count == 0) and (description != NULL))
            str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
            while (i < dateCount)
                str = str + getSumColumnString(0, isPrintRouble);
                str = str + getSumColumnString(0, isPrintCurrency);
                i = i + 1;
            end;
            printLn(str);
        end;

        if (iterator.count > 0)
            if (isNeedPrint)
                printLn(str);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых   ", true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" другой кредитной организацией,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" зарегистрированной в установленном    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" порядке и действующей на основании    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выданной Банком России лицензии на    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществление банковских операций,    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" международной финансовой организацией,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществляющей свою деятельность на   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" основе международного  договора       ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (соглашения) о ее создании с участием ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Российской Федерации, а также         ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Внешэкономбанком, Банком России,      ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" возникающих в результате заключения   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" договоров (за исключением обязательств", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" по выпущенным долговым ценным бумагам ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" и процентам по ним), и обязательств   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед АСВ и (или) обязательств перед  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" инвесторами, не являющимися кредитными", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" организациями, возникающих в рамках   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" оказания финансовой помощи по планам  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" участия АСВ в предупреждении          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" банкротства в соответствии с          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федеральным законом <О дополнительных ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" мерах для укрепления стабильности     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" банковской системы в период до 31     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" декабря 2014 года>, балансовых счетов:", false, true, beginDateInBlock, numberDatesInBlock);

        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(beginDateInBlock, numberDatesInBlock, iterator, false, true, true);
    end;

end;

class (TApplicationRow342_6_2_2963) TApplicationRow342_6_2_3115(applicationName : String)
    initTApplicationRow342_6_2_2963(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter6_2_3115(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = " NOT " + hasAssignedCategory("N")
                +"\n"+ "     AND NOT " + hasAssignedCategory("Искл. из П6")
                +"\n"+ "     AND NOT " + hasAssignedCategory("Строка 2.2")
                +"\n"+ "     AND NOT " + hasAssignedCategory("ДУ", RCB_OBJGROUP_REPORTKIND)
                +"\n"+ "     AND (   " + hasAssignedCategory("КО")
                +"\n"+ "          OR (    " + isBank("account.t_contractorId")
                +"\n"+ "              AND NOT " + isNotResident("account.t_contractorId")
                +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_contractorId")
                +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_contractorId") + ")"
                +"\n"+ "          OR (    " + isBank("account.t_clientCode")
                +"\n"+ "              AND NOT " + isNotResident("account.t_clientCode")
                +"\n"+ "              AND " + isClientBankWithValidLicense("account.t_clientCode")
                +"\n"+ "              AND NOT " + isClientInDepartmentReference("account.t_clientCode") + "))"
            ;
        end;

        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                +"\n"+ "AND " + isNotZeroForAtLeastOneDay();
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    macro getFilter()
        return TDataSourceFilter6_2_3115(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых   ", true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" другой кредитной организацией,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" зарегистрированной в установленном    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" порядке и действующей на основании    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выданной Банком России лицензии на    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществление банковских операций     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" кредитной организацией, выступающей в ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" качестве доверительного управляющего),", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" международной финансовой              ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" орагнизацией, осуществляющей свою     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" деятельность на основе международного ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" договора (соглашения) о ее создании   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" с участием Российской Федерации,      ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" а также Внешэкономбанком,             ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Банком России, возникающих в          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" результате заключения договоров (за   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" исключением обязательств по выпущенным", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" долговым ценным бумагам и процентам   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" по ним), и обязательств перед АСВ и   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (или) обязательств перед инвесторами, ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" не являющимися кредитными             ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" организациями, возникающих в рамках   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" оказания финансовой помощи по планам  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" участия АСВ в предупреждении          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" банкротства в соответствии с          ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федеральным законом <О дополнительных ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" мерах для укрепления стабильности     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" банковской системы в период до 31     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" декабря 2014 года>, балансовых счетов:", false, true, beginDateInBlock, numberDatesInBlock);

        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(beginDateInBlock, numberDatesInBlock, iterator, false, true, true);
    end;

end;

class (TApplicationRow342_6_2_3115) TApplicationRow342_6_2_3654(applicationName : String)
    initTApplicationRow342_6_2_3115(applicationName);

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Пассивные остатки отдельных лицевых   ", true, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" другой кредитной организацией,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" зарегистрированной в установленном    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" порядке и действующей на основании    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" выданной Банком России лицензии на    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" осуществление банковских операций     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением обязательств перед    ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" кредитной организацией, выступающей в ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" качестве доверительного управляющего),", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" международной финансовой              ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" орагнизацией, осуществляющей свою     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" деятельность на основе международного ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" договора (соглашения) о ее создании   ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" с участием Российской Федерации,      ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" а также Внешэкономбанком,             ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Банком России, возникших в рамках     ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" оказания финансовой помощи по планам  ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" участия АСВ в осуществении мер по пре-", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" дупреждению банкротства банка,        ", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов:                    ", false, true, beginDateInBlock, numberDatesInBlock);

        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(beginDateInBlock, numberDatesInBlock, iterator, false, true, true);
    end;
end;

/***************************************************************************************************
 *  Класc строки 3 приложения6
 **************************************************************************************************/
class (TApplicationRow342_6) TApplicationRow342_6_3(applicationName : String)
    initTApplicationRow342_6(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter6_3(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = " NOT " + hasAssignedCategory("Строка 2.2")
                +"\n"+ "    AND  (   " + hasAssignedCategory("З")
                +"\n"+ "          OR (    " + isClientInDepartmentReference("account.t_contractorId")
                +"\n"+ "              AND NOT " + isDepartmentOwnFunds("account.t_contractorId") + "))"
            ;
        end;

        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                +"\n"+ "AND " + isNotZeroForAtLeastOneDay();
        end;

        initTDataSourceFilter(balanceMasks, category);
    end;

    private macro constructor()
        m_code = "3";
        if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
            m_exportFilter = TNotDataZeroFilter_6(this.getCode(), "ФОР");
        elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
            m_exportFilter = TBalanceInBwpFilter_6(this.getCode(), "ФОР");
        else
            m_exportFilter = TAllFilter_6(this.getCode(), "ФОР");
        end;
    end;

    private macro printRow(beginDateInBlock : Date, numberDatesInBlock : Integer, iterator : Object, isPrintRowNumber : Bool, isPrintRouble : Bool, isPrintCurrency : Bool, description : String)

        var compositeValue     : Object  = NULL;
        var currentBalance     : String  = "no balance";
        var str                : String  = "";
        var numberColumnString : String  = "";
        var dateCount          : Integer = global.parameters.getEndDate() - global.parameters.getBeginDate() + 2;
        var i                  : Integer = 0;
        var isNeedPrint                  = false;
        var daysInRow                    = numberDatesInBlock; /* Фактическое количество дат в блоке */

        if (isPrintRowNumber)
            numberColumnString = getNumberColumnString();
        else
            numberColumnString = "│      │";
        end;

        if (beginDateInBlock + numberDatesInBlock > global.parameters.getEndDate() + 1)
            daysInRow = NDays(beginDateInBlock - 1, global.parameters.getEndDate() + 2);
        end;

        iterator.moveFirst();
        while (not iterator.isDone)

            compositeValue = iterator.currentItem;
            if (currentBalance != global.exportBalanceProcessor.getBalanceNumber(compositeValue))

                if (str != "")
                    while (i < daysInRow)
                    str = str + getSumColumnString(0, isPrintRouble);
                    str = str + getSumColumnString(0, isPrintCurrency);
                    i = i + 1;
                    end;

                    i = 0;
                    if (isNeedPrint)
                    printLn(str);
                        isNeedPrint = false;
                    end;
                end;

                currentBalance = global.exportBalanceProcessor.getBalanceNumber(compositeValue);
                if (description == NULL)
                    str = numberColumnString + getDiscriptionColumnString(currentBalance, STR_ALIGN_CENTER);
                else
                    str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
                end;
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            else
                str = str + getSumColumnString(compositeValue.fieldValue("roubleRest").currentAsString,   isPrintRouble);
                str = str + getSumColumnString(compositeValue.fieldValue("currencyRest").currentAsString, isPrintCurrency);
            end;

            if (description == NULL)
                if (global.parameters.getPrintZeroApp6() == PRINT_NOT_ZERO)
                    if (isNotDataZero(compositeValue) and (not isNeedPrint))
                        isNeedPrint = true;
                    end;
                elif (global.parameters.getPrintZeroApp6() == PRINT_RPS)
                    if (isBalanceInBwp(compositeValue) and (not isNeedPrint))
                        isNeedPrint = true;
                    end;
                else
                    isNeedPrint = true;
                end;
            else
                isNeedPrint = true;
            end;

            i = i + 1;
            iterator.moveNext();
        end;

        i = 0;
        if ((iterator.count == 0) and (description != NULL))
            str = numberColumnString + getDiscriptionColumnString(description, STR_ALIGN_LEFT);
            while (i < dateCount)
                str = str + getSumColumnString(0, isPrintRouble);
                str = str + getSumColumnString(0, isPrintCurrency);
                i = i + 1;
            end;
            printLn(str);
        end;

        if (iterator.count > 0)
            if (isNeedPrint)
                printLn(str);
            end;
        end;
    end;

    macro getFilter()
        return TDataSourceFilter6_3(getBalanceMasksForRow(m_code));
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(this.getFilter(), m_code, m_applicationName, "ФОР", false));
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);

        printDescriptionRow(" Пассивные остатки отдельных лицевых", true,  true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" счетов по учету задолженности,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" возникающей между обособленными", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" подразделениями кредитной организации,", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов: ", false, true, beginDateInBlock, numberDatesInBlock);
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(beginDateInBlock, numberDatesInBlock, iterator, false, true, true);
        printBottom(true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V3");
        else
            global.klikoExportFile.printID("F_P6N3");
        end;

        var iterator = getValueIterator(NULL);

        //даты при Внеочередном Регулировании Обязательных Резервов
        if (global.reportingPeriodIsVror)
            exportDescriptionRow("Даты:", true);
        end;

        //фильруем
        iterator.setFilter(m_exportFilter);

        //сортируем
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter342_6("OR6_5", this, "ФОР", "RV", m_exportFilter).export();
    end;

    constructor();
end;
