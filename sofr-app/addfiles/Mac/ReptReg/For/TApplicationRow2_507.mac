/*
$Name:          TApplicationRow2_507.mac
$Module:        Регламентируемая отчетность
$Description:   ФОР. Классы строк приложения2 ФОР по 507-П
*/
/***************************************************************************************************
 *  Класc строки 1 приложения2
 **************************************************************************************************/
private class (TDataSourceFilter) TDataSourceFilter2_1_Gr1(balanceMasks : String, category : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter(balanceMasks, category);
end;

private class (TDataSourceFilter) TDataSourceFilter2_1_Gr2(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "    NOT " + hasAssignedCategory("Строка 2.2")
            +"\n"+ "AND  NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()

        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + ")";

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  (   ( " + isNotResident("account.t_contractorId")
            +"\n"+ "          AND (   " + isEmployer("account.t_contractorId")
            +"\n"+ "               OR " + isBank("account.t_contractorId")
            +"\n"+ "               OR NOT " + isNaturalPerson("account.t_contractorId") + "))"
            +"\n"+ "      OR"
            +"\n"+ "         ( " + isNotResident("account.t_clientCode")
            +"\n"+ "          AND (   " + isEmployer("account.t_clientCode")
            +"\n"+ "               OR " + isBank("account.t_clientCode")
            +"\n"+ "               OR NOT " + isNaturalPerson("account.t_clientCode") + ")))"
            ;
    end;
    initTDataSourceFilter(balanceMasks, category);
end;

class (TApplicationRow2) TApplicationRow507_2_1(applicationName : String)
    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1(1)");

        return balanceMasks;
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_1_Gr1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ_Нерез"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_1_Gr2(getBalanceMasksForRow("1(1)")), m_code, m_applicationName, "1"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ_Нерез");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ_Нерез");
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ_Нерез"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408061"),
                                                   TDecodingData(m_applicationName, "2", "408062"),
                                                   TDecodingData("Приложение6", "1", "40806"),
                                                   TDecodingData("Приложение6", "2", "40806"),
                                                   TDecodingData("Приложение6", "3", "40806")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408061"),
                                                   TDecodingData(m_applicationName, "2", "408062"),
                                                   TDecodingData("Приложение6", "1", "40806"),
                                                   TDecodingData("Приложение6", "2", "40806"),
                                                   TDecodingData("Приложение6", "3", "40806")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );

        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408091"),
                                                   TDecodingData(m_applicationName, "2", "408092"),
                                                   TDecodingData("Приложение6", "1", "40809"),
                                                   TDecodingData("Приложение6", "2", "40809"),
                                                   TDecodingData("Приложение6", "3", "40809")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408091"),
                                                   TDecodingData(m_applicationName, "2", "408092"),
                                                   TDecodingData("Приложение6", "1", "40809"),
                                                   TDecodingData("Приложение6", "2", "40809"),
                                                   TDecodingData("Приложение6", "3", "40809")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );

        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408141"),
                                                   TDecodingData(m_applicationName, "2", "408142"),
                                                   TDecodingData("Приложение6", "1", "40814"),
                                                   TDecodingData("Приложение6", "2", "40814"),
                                                   TDecodingData("Приложение6", "3", "40814")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408141"),
                                                   TDecodingData(m_applicationName, "2", "408142"),
                                                   TDecodingData("Приложение6", "1", "40814"),
                                                   TDecodingData("Приложение6", "2", "40814"),
                                                   TDecodingData("Приложение6", "3", "40814")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );

        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408151"),
                                                   TDecodingData(m_applicationName, "2", "408152"),
                                                   TDecodingData("Приложение6", "1", "40815"),
                                                   TDecodingData("Приложение6", "2", "40815"),
                                                   TDecodingData("Приложение6", "3", "40815")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408151"),
                                                   TDecodingData(m_applicationName, "2", "408152"),
                                                   TDecodingData("Приложение6", "1", "40815"),
                                                   TDecodingData("Приложение6", "2", "40815"),
                                                   TDecodingData("Приложение6", "3", "40815")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );

        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408181"),
                                                   TDecodingData(m_applicationName, "2", "408182"),
                                                   TDecodingData("Приложение6", "1", "40818"),
                                                   TDecodingData("Приложение6", "2", "40818"),
                                                   TDecodingData("Приложение6", "3", "40818")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "408181"),
                                                   TDecodingData(m_applicationName, "2", "408182"),
                                                   TDecodingData("Приложение6", "1", "40818"),
                                                   TDecodingData("Приложение6", "2", "40818"),
                                                   TDecodingData("Приложение6", "3", "40818")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );

        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "474261"),
                                                   TDecodingData(m_applicationName, "3", "474262"),
                                                   TDecodingData("Приложение6", "1", "47426"),
                                                   TDecodingData("Приложение6", "2", "47426"),
                                                   TDecodingData("Приложение6", "3", "47426")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "1", "474261"),
                                                   TDecodingData(m_applicationName, "3", "474262"),
                                                   TDecodingData("Приложение6", "1", "47426"),
                                                   TDecodingData("Приложение6", "2", "47426"),
                                                   TDecodingData("Приложение6", "3", "47426")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );

        global.rowCode = m_code;
        normalizeApplication2Row();
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Обязательства перед юридическими", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" лицами - нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("1.Обязательства перед юридическими лицами-нерезидентами", true);
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_1", this, "ЮЛ_Нерез", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_1", this, "Расш", "RV").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_1(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "1";
    end;

    constructorTApplicationRow507_2_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 1.1 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_1_1(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " ИТОГО");
        printDescriptionRow(" (сумма остатков по строке 1)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_DATE);
        exportValueRow(iterator, "1.1.Итого (сумма остатков по строке 1)");
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_2", this, "RV").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_1_1(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "1.1";
    end;

    constructorTApplicationRow507_2_1_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 1.2 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_1_2(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator("Приложение3", NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator, "расшифровка", "314440");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, false, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("Вычитается:");
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_DATE);
        exportValueRow(iterator, "1.2.314440");
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_3", this, "RV", "314440").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_1_2(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "1.2";
    end;

    constructorTApplicationRow507_2_1_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 1.3 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_1_3(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1", "1.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "1.1", "1.2");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Всего (строка 1.1 - 1.2)");
    end;

    macro exportToKliko()
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_DATE);

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportValueRow(iterator, "1.3.Всего (строка 1.1 - строка 1.2)");
        else
            exportValueRow(iterator, "1.3.ВСЕГО (строка 1.1 - строка 1.2)");
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "RV").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_1_3(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "1.3";
    end;

    constructorTApplicationRow507_2_1_3(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 1.4 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_1_4(applicationName : String)
    macro saveAttributes()
        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.3");
            chronologicAverage = calculateChronologicAverage(iterator);
            saveAttributeValue("", "", Date(0,0,0), chronologicAverage.rouble, $0.0, chronologicAverage.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Обязательства перед", reportWidth, true);
        printDescriptionRow(" юридическими лицами-", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" нерезидентами в валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 1.3)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportSingleValueRow("1.4.Обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным граф ~^в рублях~^ строки 1.3)", value);
        else
            exportSingleValueRow("1.4.Обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.3 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "R").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_1_4(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "1.4";
    end;

    constructorTApplicationRow507_2_1_4(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 1.5 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_1_5(applicationName : String)
    macro saveAttributes()
        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.3");
            chronologicAverage = calculateChronologicAverage(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, chronologicAverage.currency, 0.0, chronologicAverage.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Обязательства перед юриди-", reportWidth, false);
        printDescriptionRow(" ческими лицами - нерезидентами в", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" иностранной валюте (по данным", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" граф \"в иностранной валюте ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в рублевом эквиваленте\" строки 1.3)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportSingleValueRow("1.5.Обязательства перед юридическими лицами-нерезидентами в ин. валюте(по данным граф ~^в валюте~^ строки 1.3)", value);
        else
            exportSingleValueRow("1.5.Обязательства перед юридическими лицами-нерезидентами в ин. валюте(по данным строки 1.3 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_4", this, "R").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_1_5(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "1.5";
    end;

    constructorTApplicationRow507_2_1_5(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2 приложения2
 **************************************************************************************************/
private class (TDataSourceFilter) TDataSourceFilter2_2_Gr1(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " 1 = 1 ";
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter(balanceMasks, category);
end;

private class (TDataSourceFilter) TDataSourceFilter2_2_Gr2(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")"
                    +"\n"+ "     AND (  " + hasAssignedCategory("Строка 2.2")
                    +"\n"+ "      OR (    NOT " + isEmployer("account.t_contractorId")
                    +"\n"+ "          AND " + isNaturalPerson("account.t_contractorId")
                    +"\n"+ "         )"
                    +"\n"+ "      OR"
                    +"\n"+ "         (    NOT " + isEmployer("account.t_clientCode")
                    +"\n"+ "          AND " + isNaturalPerson("account.t_clientCode")
                    +"\n"+ "         )"
                    +"\n"+"      )"
                    ;
    end;

    macro makePartFilter()

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter(balanceMasks, category);
end;

class (TApplicationRow2) TApplicationRow507_2_2(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_2_Gr1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ФЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_2_Gr2(getBalanceMasksForRow("2(1)")), m_code, m_applicationName, "1", "Расш1"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_2_Gr2(getBalanceMasksForRow("2(2)")), m_code, m_applicationName, "2", "Расш2"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ФЛ");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ФЛ");
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        macro unionMasks(masks1, masks2)
            if ((masks1 == "") or (masks2 == ""))
                return masks1 + masks2;
            end;

            return masks1 + "," + masks2;
        end;

        return unionMasks(unionMasks(getBalanceMasksForRow(m_code), getBalanceMasksForRow("2(1)")), getBalanceMasksForRow("2(2)"));
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ФЛ"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш1")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш2")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

        end;
    end;

    macro normalizeDecoding()
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "2", "408191"),
                                                   TDecodingData(m_applicationName, "3", "408192"),
                                                   TDecodingData("Приложение6", "1", "40819"),
                                                   TDecodingData("Приложение6", "2", "40819"),
                                                   TDecodingData("Приложение6", "3", "40819")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "2", "408191"),
                                                   TDecodingData(m_applicationName, "3", "408192"),
                                                   TDecodingData("Приложение6", "1", "40819"),
                                                   TDecodingData("Приложение6", "2", "40819"),
                                                   TDecodingData("Приложение6", "3", "40819")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );

        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "2", "524051"),
                                                   TDecodingData(m_applicationName, "3", "524052"),
                                                   TDecodingData("Приложение6", "1", "52405"),
                                                   TDecodingData("Приложение6", "2", "52405"),
                                                   TDecodingData("Приложение6", "3", "52405")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "2", "524051"),
                                                   TDecodingData(m_applicationName, "3", "524052"),
                                                   TDecodingData("Приложение6", "1", "52405"),
                                                   TDecodingData("Приложение6", "2", "52405"),
                                                   TDecodingData("Приложение6", "3", "52405")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );

        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "2", "525011"),
                                                   TDecodingData(m_applicationName, "3", "525012"),
                                                   TDecodingData("Приложение6", "1", "52501"),
                                                   TDecodingData("Приложение6", "2", "52501"),
                                                   TDecodingData("Приложение6", "3", "52501")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "2", "525011"),
                                                   TDecodingData(m_applicationName, "3", "525012"),
                                                   TDecodingData("Приложение6", "1", "52501"),
                                                   TDecodingData("Приложение6", "2", "52501"),
                                                   TDecodingData("Приложение6", "3", "52501")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );

        global.rowCode = m_code;
        normalizeApplication2Row();
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Обязательства перед физическими лицами", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("2.Обязательства перед физическими лицами");
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;


    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_5", this, "ФЛ",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_5", this, "Расш1", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_5", this, "Расш2", "RV").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_2(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "2";
    end;

    constructorTApplicationRow507_2_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.1 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_2_1(applicationName : String)
    macro saveAttributes()

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого");
        printDescriptionRow(" (сумма остатков по строке 2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_DATE);

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportValueRow(iterator, "2.1.Итого (сумма остатков по строке 2)");
        else
            exportValueRow(iterator, "2.1.ИТОГО (сумма остатков по строке 2)");
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_6", this, "RV").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_2_1(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "2.1";
    end;

    constructorTApplicationRow507_2_2_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.2 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_2_2(applicationName : String)
    macro saveAttributes()

        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.1");
            chronologicAverage = calculateChronologicAverage(iterator);
            saveAttributeValue("", "", Date(0,0,0), chronologicAverage.rouble, $0.0, chronologicAverage.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Обязательства перед физическими", reportWidth, true);
        printDescriptionRow(" лицами в валюте Российской  Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 2.1)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportSingleValueRow("2.2.Обязательства перед физическими лицами в валюте РФ(по данным граф ~^в рублях~^ строки 2.1)", value);
        else
            exportSingleValueRow("2.2.Обязательства перед физическими лицами в валюте РФ(по данным строки 2.1 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_6", this, "R").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_2_2(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "2.2";
    end;

    constructorTApplicationRow507_2_2_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.3 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_2_3(applicationName : String)
    macro saveAttributes()
        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.1");
            chronologicAverage = calculateChronologicAverage(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, chronologicAverage.currency, 0.0, chronologicAverage.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Обязательства перед физическими", reportWidth, false);
        printDescriptionRow(" лицами в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф в \"иностранной", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте в рублевом эквиваленте\"", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 2.1) (2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportSingleValueRow("2.3.Обязательства перед физическими лицами в иностранной валюте(по данным граф ~^в валюте~^ строки 2.1)", value);
        else
            exportSingleValueRow("2.3.Обязательства перед физическими лицами в иностранной валюте(по данным строки 2.1 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_6", this, "R").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_2_3(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "2.3";
    end;

    constructorTApplicationRow507_2_2_3(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3 приложения2
 **************************************************************************************************/
private class (TDataSourceFilter) TDataSourceFilter2_3_Gr1(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory();
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter(balanceMasks, category);
end;

class (TApplicationRow2) TApplicationRow507_2_3(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_3_Gr1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_3_Gr1(getBalanceMasksForRow("3(2)")), m_code, m_applicationName, "2"));

        tempTable.fill(TDecodingDifferenceDataSource3042(TDataSourceFilter2_3_Gr1("30420, 30421"), TDataSourceFilter2_3_Gr1("30416, 30417"), m_code, m_applicationName, "304211",
                                                         TBalanceId("Приложение6", "1", "ФОР", "30420"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30420"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30420"),
                                                         TBalanceId("Приложение6", "1", "ФОР", "30421"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30421"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30421")));

        tempTable.fill(TDecodingDifferenceDataSource3042(TDataSourceFilter2_3_Gr1("30422, 30423"), TDataSourceFilter2_3_Gr1("30418, 30419"), m_code, m_applicationName, "304231",
                                                         TBalanceId("Приложение6", "1", "ФОР", "30422"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30422"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30422"),
                                                         TBalanceId("Приложение6", "1", "ФОР", "30423"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30423"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30423")));

        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40108, 40109"), m_code, m_applicationName, "401081","40108", "40109"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40110, 40111"), m_code, m_applicationName, "401101","40110", "40111"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40306, 40308"), m_code, m_applicationName, "403061","40306", "40308"));

        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("47426"), m_code, m_applicationName, "474262"));

        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "F"), m_code, m_applicationName, "603221"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "E"), m_code, m_applicationName, "603222"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "A"), m_code, m_applicationName, "603223"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "G"), m_code, m_applicationName, "603224"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ");
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3(2)");

        return balanceMasks;
    end;

    macro getDecodingBalanceMasks()
        return "30420, 30416, 30421, 30417, 30422, 30418, 30423, 30419, 40108, 40109, 40110, 40111, 40306, 40308, 47426, 60322";
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, max(0, dataSet.roubleRest), max(0, dataSet.currencyRest), max(0, dataSet.roubleScaledRest), max(0, dataSet.currencyScaledRest));
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "Расш"),
                                                                  TBalanceId(m_applicationName, "2", "Расш1"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка"), "474262"));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, correctNegativeValue(dataSet.roubleRest, $0), correctNegativeValue(dataSet.currencyRest, $0));
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "474262"),
                                                                  TBalanceId(m_applicationName, "1", "Расш", "474261"),
                                                                  TBalanceId("Приложение6", "1", "ФОР", "47426"),
                                                                  TBalanceId("Приложение6", "2", "ФОР", "47426"),
                                                                  TBalanceId("Приложение6", "3", "ФОР", "47426")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "3", "603221"),
                                                   TDecodingData(m_applicationName, "3", "603222"),
                                                   TDecodingData(m_applicationName, "3", "603223"),
                                                   TDecodingData(m_applicationName, "3", "603224"),
                                                   TDecodingData("Приложение6", "1", "60322"),
                                                   TDecodingData("Приложение6", "2", "60322"),
                                                   TDecodingData("Приложение6", "3", "60322")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_LESS_OR_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "3", "603221"),
                                                   TDecodingData(m_applicationName, "3", "603222"),
                                                   TDecodingData(m_applicationName, "3", "603223"),
                                                   TDecodingData(m_applicationName, "3", "603224"),
                                                   TDecodingData("Приложение6", "1", "60322"),
                                                   TDecodingData("Приложение6", "2", "60322"),
                                                   TDecodingData("Приложение6", "3", "60322")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_LESS_OR_EQUAL
                            );

        global.rowCode = m_code;
        normalizeApplication2Row();
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Иные обязательства", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("3.Иные обязательства");
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_7", this, "ЮЛ",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш", "RV").export();

        TPtkPsdDecodingExporter("OR2_7", this, "RV", "304211").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "304231").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401081").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401101").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "403061").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "474262").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603221").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603222").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603223").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603224").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_3(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "3";
    end;

    constructorTApplicationRow507_2_3(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3.1 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_3_1(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков  по строке 3)");
    end;

    macro exportToKliko()
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_DATE);

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportValueRow(iterator, "3.1.Итого (сумма остатков по строке 3)");
        else
            exportValueRow(iterator, "3.1.ИТОГО (сумма остатков по строке 3)");
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_8", this, "RV").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_3_1(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "3.1";
    end;

    constructorTApplicationRow507_2_3_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3.2 приложения2
 **************************************************************************************************/
private class (TDataSourceFilter) TDataSourceFilter2_3_2(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory();
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter(balanceMasks, category);
end;

private class (TDataSourceFilter) TDataSourceFilter2_3_2_Gr(balanceMasks : String, category : String, groupId : Integer)
    private var m_objGroupId = nvl(groupId, RCB_OBJGROUP_REPORT);

    private macro hasAssignedCategory(category : String, groupId : Integer)
        var filter = "";
        var objGroupId = nvl(groupId, RCB_OBJGROUP_REPORT);

        if (nvl(category, m_category) != NULL)
            filter = "EXISTS(SELECT 1"
              +"\n"+ "         FROM dobjatcor_dbt atc"
              +"\n"+ "        WHERE atc.t_ObjectType = " + RCB_OBJTYPE_ACCOUNT
              +"\n"+ "          AND atc.t_GroupID    = " + m_objGroupId
              +"\n"+ "          AND atc.t_Object     = account.t_accountObjectId"
              +"\n"+ "          AND atc.t_AttrID = (SELECT att.t_AttrID"
              +"\n"+ "                                FROM dobjattr_dbt att"
              +"\n"+ "                               WHERE att.t_ObjectType = " + RCB_OBJTYPE_ACCOUNT
              +"\n"+ "                                 AND att.t_GroupID    = " + m_objGroupId
              +"\n"+ "                                 AND att.t_codeList = CHR(1)"
              +"\n"+ "                                 AND att.t_numInList  = " + getSqlString(nvl(category, m_category)) + ")"
              +"\n"+ "          AND (frd.t_date - 1) BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate)";
        else
            filter = "1 = 1";
        end;
        return filter;
    end;

    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory(m_category, m_objGroupId);
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter(balanceMasks, category);
end;

class (TApplicationRow2) TApplicationRow507_2_3_2(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource4090_Total(
                                                    TDecodingDataSource4090(TDataSourceFilter2_3_2_Gr("40901", "ПА", RCB_OBJGROUP_REPORTKIND), TDataSourceFilter2_3_2_Gr("47431", "ПА", RCB_OBJGROUP_REPORTKIND), m_code, m_applicationName, "409011"),
                                                    TDecodingDataSource4090(TDataSourceFilter2_3_2_Gr("40902", "ПА", RCB_OBJGROUP_REPORTKIND), TDataSourceFilter2_3_2_Gr("47410", "ПА", RCB_OBJGROUP_REPORTKIND), m_code, m_applicationName, "409011")
                                                   ));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_2("40312", "R"), m_code, m_applicationName, "403121", NULL, global.ROUBLE_ONLY));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_2("52005", "D"), m_code, m_applicationName, "520051"));
    end;

    macro getDecodingBalanceMasks()
        return "40901, 40902, 40312, 52005, 47431, 47410";
    end;

    macro normalizeDecoding()
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "3.2", "403121"),
                                                   TDecodingData("Приложение6", "1", "40312"),
                                                   TDecodingData("Приложение6", "2", "40312"),
                                                   TDecodingData("Приложение6", "3", "40312")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_LESS_OR_EQUAL
                            );

        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "3.2", "520051"),
                                                   TDecodingData("Приложение4", "1", "52005"),
                                                   TDecodingData("Приложение6", "1", "52005"),
                                                   TDecodingData("Приложение6", "2", "52005"),
                                                   TDecodingData("Приложение6", "3", "52005")
                                                  ),
                             NATIONAL_CURRENCY,
                             RCB_RS_EQUAL
                            );
        normalizeOneDecoding(RcbArray().initialize(TDecodingData(m_applicationName, "3.2", "520051"),
                                                   TDecodingData("Приложение4", "1", "52005"),
                                                   TDecodingData("Приложение6", "1", "52005"),
                                                   TDecodingData("Приложение6", "2", "52005"),
                                                   TDecodingData("Приложение6", "3", "52005")
                                                  ),
                             FOREIGN_CURRENCY,
                             RCB_RS_EQUAL
                            );
    end;

    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var dataSet        : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, "3.2", "расшифровка")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            iterator = getAttributeValueIterator("Приложение3", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.4");
            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                saveAttributeValue("расшифровка", "410439", Date(trim(compositeValue.fieldValue("date").exact)),
                                   compositeValue.fieldValue("roubleRest").exact,  compositeValue.fieldValue("currencyRest").exact,
                                   compositeValue.fieldValue("roubleRest").scaled, compositeValue.fieldValue("currencyRest").scaled);
                iterator.moveNext();
            end;

            iterator = getAttributeValueIterator("Приложение4", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3");
            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                saveAttributeValue("расшифровка", "520524", Date(trim(compositeValue.fieldValue("date").exact)),
                                   compositeValue.fieldValue("roubleRest").exact,  compositeValue.fieldValue("currencyRest").exact,
                                   compositeValue.fieldValue("roubleRest").scaled, compositeValue.fieldValue("currencyRest").scaled);
                iterator.moveNext();
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;

        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);

        var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, DATE(beginDateInBlock), numberDatesInBlock, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_CHANGED_BALANCE_DATE, "409011");
        printRow(iterator, false, true, false);
        iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT2, DATE(beginDateInBlock), numberDatesInBlock, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_CHANGED_BALANCE_DATE, "409011");
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        global.rowCode = m_code;

        exportDescriptionRow("3.2.Вычитаются:");
        var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO1, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_CHANGED_BALANCE_DATE, "409011");
        exportRoubleValueRow(iterator);
        iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO2, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_CHANGED_BALANCE_DATE, "409011");
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "409011").export();
        TPtkPsdDecodingExporter("OR2_9", this, "R",  "403121").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "410439").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "520051").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "520524").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_3_2(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "3.2";
    end;

    constructorTApplicationRow507_2_3_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3.3 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_3_3(applicationName : String)
    macro saveAttributes()

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков по кодам");
        printDescriptionRow(" обозначения по строке 3.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_DATE);

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportValueRow(iterator, "3.3.Итого (сумма остатков по кодам обозначения по строке 3.2)");
        else
            exportValueRow(iterator, "3.3.ИТОГО (сумма остатков по кодам обозначения по строке 3.2)");
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_91", this, "RV").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_3_3(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "3.3";
    end;

    constructorTApplicationRow507_2_3_3(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3.4 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_3_4(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1", "3.3");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "3.1", "3.3");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Всего (строка 3.1 - строка 3.3)");
    end;

    macro exportToKliko()
        var iterator = getValueIterator(NULL);
        iterator.setSortOrder(SORTER_FOR_DATE);

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportValueRow(iterator, "3.4.Итого (строка 3.1 - строка 3.3)");
        else
            exportValueRow(iterator, "3.4.ВСЕГО (строка 3.1 - строка 3.3)");
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_91", this, "RV").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_3_4(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "3.4";
    end;

    constructorTApplicationRow507_2_3_4(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3.5 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_3_5(applicationName : String)
    macro saveAttributes()
        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.4");
            chronologicAverage = calculateChronologicAverage(iterator);
            saveAttributeValue("", "", Date(0,0,0), chronologicAverage.rouble, $0.0, chronologicAverage.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Иные обязательства в валюте ", reportWidth, true);
        printDescriptionRow(" Российской Федерации (по данным граф ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 3.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportSingleValueRow("3.5.Иные обязательства в валюте РФ(по данным граф ~^в рублях~^ строки 3.4)", value);
        else
            exportSingleValueRow("3.5.Иные обязательства в валюте РФ(по данным строки 3.4 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_91", this, "R").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_3_5(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "3.5";
    end;

    constructorTApplicationRow507_2_3_5(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3.6 приложения2
 **************************************************************************************************/
class (TApplicationRow2) TApplicationRow507_2_3_6(applicationName : String)
    macro saveAttributes()
        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.4");
            chronologicAverage = calculateChronologicAverage(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, chronologicAverage.currency, 0.0, chronologicAverage.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Иные обязательства в иностранной валюте", reportWidth, false);
        printDescriptionRow(" (по данным граф в \"иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в рублевом эквиваленте\" строки 3.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
        printBottom(false, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (    (global.reportingPeriodIsVror == false)
            and (   (global.klikoExportFile.getDescription() == "for_60.pak от 10.05.2016")
                 or (global.klikoExportFile.getDescription() == "FOR_58.PAK от 26.01.2016")))
            exportSingleValueRow("3.6.Иные обязательства в иностранной валюте(по данным граф ~^в валюте~^ строки 3.4)", value);
        else
            exportSingleValueRow("3.6.Иные обязательства в иностранной валюте(по данным строки 3.4 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_91", this, "R").export();
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_2_3_6(applicationName : String)
        initTApplicationRow2(applicationName);

        m_code = "3.6";
    end;

    constructorTApplicationRow507_2_3_6(applicationName);
end;

private class TNormalizerValueData(_name : String, _value : Object)
    var name = _name;
    var value = _value;
end;

// Базовый класс строк Приложения 2 по 4217-У
private class (TApplicationRow2_7_4217) TApplicationRow2_4217(applicationName : String)
    private macro normalizeOneDecodingImpl(decodingNamePool : RcbArray, isRouble : Bool, sign : Integer)
        var iteratorPool = RcbArray();
        var applicationNamePool = RcbArray();

        var synchronizer = RcbValueIteratorSynchronizer(RCB_ISK_FULL_OUTER_JOIN, SORTER_FOR_DATE);

        var iterator;

        var decodingName;
        var applicationName;
        var row;

        decodingNamePool.moveFirst();

        if (global.parameters.getAppl2NormalizationAlgorithm() == 0)
            return;
        elif (global.parameters.getAppl2NormalizationAlgorithm() == 1)
            while (decodingNamePool.moveNext())
                applicationName = decodingNamePool.getCurrentItem().applicationName;
                row = decodingNamePool.getCurrentItem().row;
                decodingName = decodingNamePool.getCurrentItem().name;
                iterator = getAttributeValueIterator(applicationName);
                iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, global.parameters.getEndDate(), 1, decodingName, row);
                iterator.moveFirst();
                iteratorPool.push_back(iterator);
                applicationNamePool.push_back(applicationName);
                synchronizer.addIterator(iterator);
            end;
        elif(global.parameters.getAppl2NormalizationAlgorithm() == 2)
            while (decodingNamePool.moveNext())
                applicationName = decodingNamePool.getCurrentItem().applicationName;
                row = decodingNamePool.getCurrentItem().row;
                decodingName = decodingNamePool.getCurrentItem().name;
                iterator = getAttributeValueIterator(applicationName);
                iterator.setFilter(FILTER_FOR_NORMALIZER1, decodingName, row);
                iterator.moveFirst();
                iteratorPool.push_back(iterator);
                applicationNamePool.push_back(applicationName);
                synchronizer.addIterator(iterator);
            end;
        else
            return;
        end;

        synchronizer.moveFirst();
        while (not synchronizer.isDone())
            iteratorPool.moveFirst();

            var dateValue : Date;
            var balanceNumber;

            var rcbValuePool = RcbArray();
            var isFirstIterator = true;
            var hasBalanceData = false;

            while (iteratorPool.moveNext())
                if (synchronizer.isNull(iteratorPool.getCurrentItem()))
                    continue;
                end;

                var compositeValue = iteratorPool.getCurrentItem().currentItem;

                if (isFirstIterator)
                    dateValue = Date(trim(compositeValue.fieldValue("date").exactAsString));
                    balanceNumber = substr(compositeValue.fieldValue("balance").exactAsString, 1, 5);
                    isFirstIterator = false;
                    hasBalanceData = true;
                end;

                if (hasBalanceData)
                    var value = compositeValue.fieldValue(ternary(isRouble, "roubleRest", "currencyRest"));
                    if (value.exact != $0)
                        var id = global.toAnsiNorm(        applicationNamePool.value(iteratorPool.getCurrentIndex())
                                                   + "_" + compositeValue.fieldValue("row").exactAsString
                                                   + "_" + ternary(isRouble, "Ру", "Ва")
                                                   + "_" + compositeValue.fieldValue("balance").exactAsString
                                                   + "_" + string(dateValue : f),
                                                   true
                                                  );
                        rcbValuePool.push_back(TNormalizerValueData(id, value));
                    end;
                end;
            end;

            if (hasBalanceData)
                var balanceValues = global.balanceData.getValues(balanceNumber, dateValue);
                var balanceValue;
                if (isRouble)
                    balanceValue = balanceValues.getRoubleScaledRest();
                else
                    balanceValue = balanceValues.getCurrencyScaledRest();
                end;
                if ((balanceValue != 0.0) and (rcbValuePool.size != 0))
                    normalizeOneRecord(rcbValuePool, balanceValue, sign);
                end;
            end;

            synchronizer.moveNext();
        end;
    end;

    private macro normalizeOneDecoding(p1 : Variant, p2 : Variant, sign : Integer)
        if (valType(p1) == V_STRING)
            var data = RcbArray();
            for (var attributeName, strcut(p1, "+="))
                var attributeParts = strcut(attributeName, "_|");
                var decodingData = TDecodingData("Приложение"+trim(attributeParts[0]), trim(attributeParts[1]), trim(attributeParts[2]));
                data.push_back(decodingData);
            end;
            var lastToken = data.pop_back();
            if (index(lastToken.applicationName, "E") != 0)
                sign = RCB_RS_EQUAL;
            elif (index(lastToken.applicationName, "L") != 0)
                sign = RCB_RS_LESS_OR_EQUAL;
            else
                sign = RCB_RS_EQUAL;
            end;
            if (index(lastToken.applicationName, "R") != 0)
                normalizeOneDecodingImpl(data, NATIONAL_CURRENCY, sign);
            end;
            if (index(lastToken.applicationName, "V") != 0)
                normalizeOneDecodingImpl(data, FOREIGN_CURRENCY, sign);
            end;
        elif (valType(p2) == V_BOOL)
            normalizeOneDecodingImpl(p1, p2, sign);
        else
            sign = p2;
            normalizeOneDecodingImpl(p1, NATIONAL_CURRENCY, sign);
            normalizeOneDecodingImpl(p1, FOREIGN_CURRENCY, sign);
        end;
    end;

    private macro normalizeApplication2Row(rowCode)
        class TFilter(row)
            private var m_row = row;
            private var m_date = global.parameters.getEndDate();

            macro isSuitable(v : Object)
                return (    (strlen(v.fieldValue("balance").current) == 5)
                        and (v.fieldValue("row").current == m_row)
                        and (v.fieldValue("balance").current != "40901")
                        and (v.fieldValue("balance").current != "40902")
                        and (Date(v.fieldValue("date").current) == m_date) // преобразование строки к дате надёжней, т.к. возможно
                                                                           // ручное заполнение даты и не факт, что соответствующая
                                                                           // строка будет равна ДООП, приведенной к строке
                       );
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return ((v1.fieldValue("balance").current) < (v2.fieldValue("balance").current));
            end;
        end;

        rowCode = nvl(rowCode, global.rowCode);

        if (global.parameters.getAppl2NormalizationAlgorithm() == 0)
            return;
        elif (global.parameters.getAppl2NormalizationAlgorithm() == 1)
            var prevBalance = "";
            var balanceIterator = getAttributeValueIterator(m_applicationName, TFilter(rowCode), TSorter());
            while (not balanceIterator.isDone())
                var balance = balanceIterator.currentItem.fieldValue("balance").current;
                if (prevBalance == balance)
                    balanceIterator.next();
                    continue;
                end;

                var decodingData = RcbArray().initialize(TDecodingData(m_applicationName, rowCode, balance),
                                                         TDecodingData("Приложение6", "1", balance),
                                                         TDecodingData("Приложение6", "2", balance),
                                                         TDecodingData("Приложение6", "3", balance)
                                    );
                normalizeOneDecoding(decodingData, RCB_RS_EQUAL);

                balanceIterator.next();
                prevBalance = balance;
            end;
        elif (global.parameters.getAppl2NormalizationAlgorithm() == 2)
            var balanceReports = global.balanceData.getBalanceReports();
            if (balanceReports != null)
                var protocolData = TArray();
                var errorProtocolData = TArray();

                normalizeApplication2RowSys(rowCode, balanceReports, protocolData, errorProtocolData);

                var i;
                for (i, protocolData)
                    normalizationProtocol.printString(i[0], i[1], i[2], i[3]);
                end;
                for (i, errorProtocolData)
                    normalizationProtocolWithErrors.printError(i[0]);
                    normalizationProtocolWithErrors.printNameLog(i[1]);
                end;
            end;
        else
            return;
        end;
    end;

    private macro constructorTApplicationRow2_4217(applicationName : String)
        initTApplicationRow2_7_4217(applicationName);
    end;

    constructorTApplicationRow2_4217(applicationName);
end;

// Классы строк 1* Приложения 2 по 4217-У
private class (TDataSourceFilter_4217) TDataSourceFilter1_4217(balanceMasks : String, category : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter2_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + ")";

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND (   ( " + isNotResident("account.t_contractorId")
            +"\n"+ "         AND (   " + isEmployer("account.t_contractorId")
            +"\n"+ "              OR " + isBank("account.t_contractorId")
            +"\n"+ "              OR NOT " + isNaturalPerson("account.t_contractorId")
            +"\n"+ "             )"
            +"\n"+ "        )"
            +"\n"+ "     OR"
            +"\n"+ "        ( " + isNotResident("account.t_clientCode")
            +"\n"+ "         AND (   " + isEmployer("account.t_clientCode")
            +"\n"+ "              OR " + isBank("account.t_clientCode")
            +"\n"+ "              OR NOT " + isNaturalPerson("account.t_clientCode")
            +"\n"+ "             )"
            +"\n"+ "        )"
            +"\n"+ "    )"
//            +"\n"+ "AND NOT (" + application6Filter + ")"
            ;
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter3_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + ")";

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermLessThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
//            +"\n"+ "AND  NOT (" + application6Filter + ")"
            ;
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter4_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + ")";

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
//            +"\n"+ "AND  NOT (" + application6Filter + ")"
            ;
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter5_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory("507-П пункт 2.5.6")
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
            ;
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter6_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory("507-П пункт 2.5.6")
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            ;
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter15_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + ")";

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  EXISTS(SELECT 1"
            +"\n"+ "              FROM repMmDeals_vw deals"
            +"\n"+ "             WHERE deals.t_mainRestAccount = account.t_account"
            +"\n"+ "               AND deals.t_fiId = account.t_fiId"
            +"\n"+ "               AND deals.t_isOpened = 1"
            +"\n"+ "               AND " + isNotResident("deals.t_contragentId")
            +"\n"+ "               AND " + isBank("deals.t_contragentId")
            +"\n"+ "               AND " + isMmDealsTermLessThreeYears()
            +"\n"+ "           ) "
            ;
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter16_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + ")";

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  EXISTS(SELECT 1"
            +"\n"+ "              FROM repMmDeals_vw deals"
            +"\n"+ "             WHERE deals.t_mainRestAccount = account.t_account"
            +"\n"+ "               AND deals.t_fiId = account.t_fiId"
            +"\n"+ "               AND deals.t_isOpened = 1"
            +"\n"+ "               AND " + isNotResident("deals.t_contragentId")
            +"\n"+ "               AND " + isBank("deals.t_contragentId")
            +"\n"+ "               AND " + isMmDealsTermEqualThreeYears()
            +"\n"+ "           ) "
            ;
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_4217(applicationName : String)
    macro getBalanceMasks()
    end;

    macro fillTempTable(tempTable : TTempTable)
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
    end;

    macro updateBalanceValues()
    end;

    macro saveAttributes()
    end;

    macro normalizeDecoding()
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Обязательства перед юридическими", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" лицами - нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        exportDescriptionRow("1.Обязательства перед юридическими лицами-нерезидентами", true);
    end;

    macro exportToPtkPsd()
    end;

    private macro constructorTApplicationRow2_1_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1";
    end;

    constructorTApplicationRow2_1_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_1_4217(applicationName : String)
    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.1(1)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.1(2)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.1(2_МБК)");

        return balanceMasks;
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter1_4217(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ_Нерез"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_4217(getBalanceMasksForRow("1.1(1)")), m_code, m_applicationName, "1", "Расш"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter3_4217(getBalanceMasksForRow("1.1(2)")), m_code, m_applicationName, "1", "РасшКс"));

        if (global.parameters.isMmDealsData())
            tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter15_4217(getBalanceMasksForRow("1.1(2_МБК)")), m_code, m_applicationName, "1", "РасшКс"));
        else
            tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter3_4217(getBalanceMasksForRow("1.1(2_МБК)")), m_code, m_applicationName, "1", "РасшКс"));
        end;
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ_Нерез");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ_Нерез");
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ_Нерез"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "РасшКс")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeOneDecoding("2|1.1|408061 + 2|2|408062 + 6|1|40806 + 6|2|40806 + 6|3|40806 = RVE");
        normalizeOneDecoding("2|1.1|408091 + 2|2|408092 + 6|1|40809 + 6|2|40809 + 6|3|40809 = RVE");
        normalizeOneDecoding("2|1.1|408121 + 2|2|408122 + 6|1|40812 + 6|2|40812 + 6|3|40812 = RVE");
        normalizeOneDecoding("2|1.1|408141 + 2|2|408142 + 6|1|40814 + 6|2|40814 + 6|3|40814 = RVE");
        normalizeOneDecoding("2|1.1|408151 + 2|2|408152 + 6|1|40815 + 6|2|40815 + 6|3|40815 = RVE");
        normalizeOneDecoding("2|1.1|408181 + 2|2|408182 + 6|1|40818 + 6|2|40818 + 6|3|40818 = RVE");

        normalizeOneDecoding("2|1.1|474261 + 2|3.1|474262 + 6|1|47426 + 6|2|47426 + 6|3|47426 = RVE");

        normalizeOneDecoding("2|1.1|314081 + 2|1.2|314082 + 6|1|31408 + 6|2|31408 + 6|3|31408 = RVE");
        normalizeOneDecoding("2|1.1|316081 + 2|1.2|316082 + 6|1|31608 + 6|2|31608 + 6|3|31608 = RVE");
        normalizeOneDecoding("2|1.1|425061 + 2|1.2|425062 + 6|1|42506 + 6|2|42506 + 6|3|42506 = RVE");
        normalizeOneDecoding("2|1.1|440061 + 2|1.2|440062 + 6|1|44006 + 6|2|44006 + 6|3|44006 = RVE");

        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Обязательства перед юридическими", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением долгосрочных)", null, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("1.1.Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных)", true);
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_1", this, "ЮЛ_Нерез", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_1", this, "Расш", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_1", this, "РасшКс", "RV").export();
    end;

    private macro constructorTApplicationRow2_1_1_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.1";
    end;

    constructorTApplicationRow2_1_1_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_1_1_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " ИТОГО");
        printDescriptionRow(" (сумма остатков по строке 1.1)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        exportToKliko(SORTER_FOR_DATE, "1.1.1.Итого (сумма остатков по строке 1.1)");
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_2", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_1_1_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.1.1";
    end;

    constructorTApplicationRow2_1_1_1_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_1_2_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.1");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRow(iterator, " Обязательства перед юридическими", reportWidth, true);
        printDescriptionRow(" лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением долгосрочных)", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф \"в рублях\"", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 1.1.1)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.1.2.Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте РФ(по данным граф ~^в рублях~^ строки 1.1.1)", value);
        else
            exportSingleValueRow("1.1.2.Обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.1.1 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_2", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_1_2_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.1.2";
    end;

    constructorTApplicationRow2_1_1_2_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_1_3_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.1");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRow(iterator, " Обязательства перед юридическими", reportWidth, false);
        printDescriptionRow(" лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением долгосрочных)", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф \"в иностранной", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте в рублевом эквиваленте\"", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 1.1.1)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.1.3.Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в ин. валюте(по данным граф ~^в валюте~^ строки 1.1.1)", value);
        else
            exportSingleValueRow("1.1.3.Обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.1.1 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_2", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_1_3_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.1.3";
    end;

    constructorTApplicationRow2_1_1_3_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_2_4217(applicationName : String)
    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.2(1)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.2(1_МБК)");

        return balanceMasks;
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter1_4217(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ_Нерез_ДС"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter4_4217(getBalanceMasksForRow("1.2(1)")), m_code, m_applicationName, "2", "ЮЛ_Н_Расш"));

        if (global.parameters.isMmDealsData())
            tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter16_4217(getBalanceMasksForRow("1.2(1_МБК)")), m_code, m_applicationName, "2", "ЮЛ_Н_Расш"));
        else
            tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter4_4217(getBalanceMasksForRow("1.2(1_МБК)")), m_code, m_applicationName, "2", "ЮЛ_Н_Расш"));
        end;
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ_Нерез_ДС");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ_Нерез_ДС");
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ_Нерез_ДС"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ЮЛ_Н_Расш")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Долгосрочные обязательства перед", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" юридическими лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("1.2.Долгосрочные обязательства перед юридическими лицами-нерезидентами", true);
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_21", this, "ЮЛ_Нерез_ДС", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_21", this, "ЮЛ_Н_Расш", "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.2";
    end;

    constructorTApplicationRow2_1_2_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_2_1_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " ИТОГО");
        printDescriptionRow(" (сумма остатков по строке 1.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        exportToKliko(SORTER_FOR_DATE, "1.2.1.Итого (сумма остатков по строке 1.2)");
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_22", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_1_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.2.1";
    end;

    constructorTApplicationRow2_1_2_1_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_2_2_4217(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TDecodingDataSource(TDataSourceFilter5_4217("42506*,44006*"), m_code, m_applicationName, "425440(3)"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter6_4217("42507*,44007*"), m_code, m_applicationName, "425440(3)"));
    end;

    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator("Приложение3", NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator, "П3_1_1_1_314440", "314440");

            var dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "425440(3)")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, false, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, beginDateInBlock, numberDatesInBlock, "314440", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "314440");
        printRow(iterator, false, true, true);
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT2, beginDateInBlock, numberDatesInBlock, "314440", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "314440");
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        global.rowCode = m_code;
        exportDescriptionRow("1.2.2.Вычитаются:");
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO1, "314440", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "314440");
        exportValueRow(iterator);
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO2, "314440", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "314440");
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_3", this, "П3_1_1_1_314440", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_3", this, "расшифровка", "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_2_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.2.2";
    end;

    constructorTApplicationRow2_1_2_2_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_2_3_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков по кодам");
        printDescriptionRow(" обозначения по строке 1.2.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        exportToKliko(SORTER_FOR_DATE, "1.2.3.Итого (сумма остатков по кодам обозначения по строке 1.2.2)");
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_3_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.2.3";
    end;

    constructorTApplicationRow2_1_2_3_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_2_4_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.1", "1.2.3");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "1.2.1", "1.2.3");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (строка 1.2.1 - 1.2.3)");
    end;

    macro exportToKliko()
        var description : String;

        if (global.reportingPeriodIsVror == false)
            description = "1.2.4.Итого (строка 1.2.1 - строка 1.2.3)";
        else
            description = "1.2.4.ИТОГО (строка 1.2.1 - 1.2.3)";
        end;
        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_4_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.2.4";
    end;

    constructorTApplicationRow2_1_2_4_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_2_5_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные обязательства", reportWidth, true);
        printDescriptionRow(" перед юридическими лицами-", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" нерезидентами в валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 1.2.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.2.5.Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным граф ~^в рублях~^ строки 1.2.4)", value);
        else
            exportSingleValueRow("1.2.5.Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.2.4 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_2_5_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.2.5";
    end;

    constructorTApplicationRow2_1_2_5_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_1_2_6_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные обязательства", reportWidth, false);
        printDescriptionRow(" перед юридическими лицами-", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" нерезидентами в иностранной", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте (по данным граф \"в", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" иностранной валюте в рублевом", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" эквиваленте\" строки 1.2.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.2.6.Долгосрочные обязательства перед юридическими лицами-нерезидентами в ин. валюте(по данным граф ~^в валюте~^ строки 1.2.4)", value);
        else
            exportSingleValueRow("1.2.6.Долгосрочные обязательства перед юридическими лицами-нерезидентами в иностранной валюте (по данным строки 1.2.4 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_4", this, "V").export();
    end;

    private macro constructorTApplicationRow2_1_2_6_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "1.2.6";
    end;

    constructorTApplicationRow2_1_2_6_4217(applicationName);
end;

// Классы строк 2* Приложения 2 по 4217-У
private class (TDataSourceFilter_4217) TDataSourceFilter7_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        m_partDateFilter = " 1 = 1 ";
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter8_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")"
                    +"\n"+ "     AND (  " + hasAssignedCategory("Строка 2.2")
                    +"\n"+ "      OR (    NOT " + isEmployer("account.t_contractorId")
                    +"\n"+ "          AND " + isNaturalPerson("account.t_contractorId")
                    +"\n"+ "         )"
                    +"\n"+ "      OR"
                    +"\n"+ "         (    NOT " + isEmployer("account.t_clientCode")
                    +"\n"+ "          AND " + isNaturalPerson("account.t_clientCode")
                    +"\n"+ "         )"
                    +"\n"+"      )"
                    ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;

    initTDataSourceFilter_4217(balanceMasks, category);
end;

class (TApplicationRow2_4217) TApplicationRow2_2_4217(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter7_4217(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ФЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter8_4217(getBalanceMasksForRow("2(1)")), m_code, m_applicationName, "1", "Расш1"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter8_4217(getBalanceMasksForRow("2(2)")), m_code, m_applicationName, "2", "Расш2"));
    end;

//    macro fillTempTableForBalanceData(tempTable : TTempTable)
//        fillTempTable(tempTable);
//
//        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));
//
//        updateTempTable(dataSet, "ФЛ");
//    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ФЛ");
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        macro unionMasks(masks1, masks2)
            if ((masks1 == "") or (masks2 == ""))
                return masks1 + masks2;
            end;

            return masks1 + "," + masks2;
        end;

        return unionMasks(unionMasks(getBalanceMasksForRow(m_code), getBalanceMasksForRow("2(1)")), getBalanceMasksForRow("2(2)"));
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ФЛ"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш1")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш2")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

        end;
    end;

    macro normalizeDecoding()
        normalizeOneDecoding("2|2|408191 + 2|3.1|408192 + 6|1|40819 + 6|2|40819 + 6|3|40819 = RVE");
        normalizeOneDecoding("2|2|524051 + 2|3.1|524052 + 6|1|52405 + 6|2|52405 + 6|3|52405 = RVE");
        normalizeOneDecoding("2|2|525011 + 2|3.1|525012 + 6|1|52501 + 6|2|52501 + 6|3|52501 = RVE");

        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Обязательства перед физическими лицами", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("2.Обязательства перед физическими лицами");
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_5", this, "ФЛ",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_5", this, "Расш1", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_5", this, "Расш2", "RV").export();
    end;

    private macro constructorTApplicationRow2_2_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "2";
    end;

    constructorTApplicationRow2_2_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_2_1_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого");
        printDescriptionRow(" (сумма остатков по строке 2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var description;

        if (global.reportingPeriodIsVror == false)
            description = "2.1.Итого (сумма остатков по строке 2)";
        else
            description = "2.1.ИТОГО (сумма остатков по строке 2)";
        end;
        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_6", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_2_1_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "2.1";
    end;

    constructorTApplicationRow2_2_1_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_2_2_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.1");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Обязательства перед физическими", reportWidth, true);
        printDescriptionRow(" лицами в валюте Российской  Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 2.1)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("2.2.Обязательства перед физическими лицами в валюте РФ(по данным граф ~^в рублях~^ строки 2.1)", value);
        else
            exportSingleValueRow("2.2.Обязательства перед физическими лицами в валюте РФ(по данным строки 2.1 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_6", this, "R").export();
    end;

    private macro constructorTApplicationRow2_2_2_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "2.2";
    end;

    constructorTApplicationRow2_2_2_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_2_3_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.1");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Обязательства перед физическими", reportWidth, false);
        printDescriptionRow(" лицами в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф в \"иностранной", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте в рублевом эквиваленте\"", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 2.1) (2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("2.3.Обязательства перед физическими лицами в иностранной валюте(по данным граф ~^в валюте~^ строки 2.1)", value);
        else
            exportSingleValueRow("2.3.Обязательства перед физическими лицами в иностранной валюте(по данным строки 2.1 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_6", this, "R").export();
    end;

    private macro constructorTApplicationRow2_2_3_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "2.3";
    end;

    constructorTApplicationRow2_2_3_4217(applicationName);
end;

// Классы строк 3* Приложения 2 по 4217-У
private class (TDataSourceFilter_4217) TDataSourceFilter10_4217(balanceMasks : String, category : String, groupId : Integer)
    private var m_objGroupId = groupId;

    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory(m_category, m_objGroupId);
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter101_4217(balanceMasks : String)
    macro makePartDateFilter()
        m_partDateFilter = " 1=1 ";
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter_4217(balanceMasks);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter9_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")"
                    ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermLessThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
        ;
    end;

    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter14_4217(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
        ;
    end;

    initTDataSourceFilter_4217(balanceMasks, category);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter11_4217(balanceMasks1 : String, balanceMasks2 : String)
    private var m_filter1 : Object;
    private var m_filter2 : Object;

    macro makePartDateFilter()
        m_partDateFilter = " " + m_filter1.hasAssignedCategory()
               + "\n" + "AND " + m_filter2.hasAssignedCategory()
        ;
    end;

    macro makePartFilter()
        m_partFilter = "   (   (    " + m_filter1.isSatisfiesToBalancesMasks("account.t_balance")
                 + "\n" + "     AND " + m_filter1.isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
                 + "\n" + "    )"
                 + "\n" + " OR " + m_filter2.isSatisfiesToBalancesMasks("account.t_balance")
                 + "\n" + ")"
        ;
    end;

    private macro ctor(balanceMasks1 : String, balanceMasks2 : String)
        m_filter1 = TDataSourceFilter_4217(balanceMasks1, "507-П пункт 2.5.6");
        m_filter2 = TDataSourceFilter_4217(balanceMasks2, "507-П пункт 2.5.6");
        initTDataSourceFilter_4217(balanceMasks1 + "," + balanceMasks2, "");
    end;

    ctor(balanceMasks1, balanceMasks2);
end;

private class (TDataSourceFilter_4217) TDataSourceFilter12_4217(balanceMasks : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory();
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
        ;
    end;

    initTDataSourceFilter_4217(balanceMasks, "507-П пункт 2.5.6_1");
end;

private class (TDataSourceFilter_4217) TDataSourceFilter13_4217(balanceMasks : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory()
             +"\n"+ "AND " + hasNoAssignedCategory(null, RCB_OBJGROUP_SUBORDINATEDLOAN) //"Субординированный кредит"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
        ;
    end;

    initTDataSourceFilter_4217(balanceMasks, "507-П пункт 2.5.6_1");
end;

private class (TDataSourceFilter_4217) TDataSourceFilter14_507_I4605(balanceMasks : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;

    initTDataSourceFilter_4217(balanceMasks, null);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_4217(applicationName : String)
    macro getBalanceMasks()
    end;

    macro fillTempTable(tempTable : TTempTable)
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
    end;

    macro updateBalanceValues()
    end;

    macro saveAttributes()
    end;

    macro normalizeDecoding()
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Иные обязательства", true, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        exportDescriptionRow("3.Иные обязательства", true);
    end;

    macro exportToPtkPsd()
    end;

    private macro constructorTApplicationRow2_3_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3";
    end;

    constructorTApplicationRow2_3_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_1_4217(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter101_4217(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter9_4217(getBalanceMasksForRow("3.1(1)")), m_code, m_applicationName, "1", "Расш1"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter101_4217(getBalanceMasksForRow("3.1(2)")), m_code, m_applicationName, "2", "Расш2"));

        tempTable.fill(TDecodingDifferenceDataSource3042(TDataSourceFilter101_4217("30420, 30421"), TDataSourceFilter101_4217("30416, 30417"), m_code, m_applicationName, "304211",
                                                         TBalanceId("Приложение6", "1", "ФОР", "30420"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30420"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30420"),
                                                         TBalanceId("Приложение6", "1", "ФОР", "30421"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30421"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30421")));

        tempTable.fill(TDecodingDifferenceDataSource3042(TDataSourceFilter101_4217("30422, 30423"), TDataSourceFilter101_4217("30418, 30419"), m_code, m_applicationName, "304231",
                                                         TBalanceId("Приложение6", "1", "ФОР", "30422"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30422"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30422"),
                                                         TBalanceId("Приложение6", "1", "ФОР", "30423"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30423"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30423")));

        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter101_4217("40108, 40109"), m_code, m_applicationName, "401081","40108", "40109"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter101_4217("40110, 40111"), m_code, m_applicationName, "401101","40110", "40111"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter101_4217("40306, 40308"), m_code, m_applicationName, "403061","40306", "40308"));

        tempTable.fill(TDecodingDataSource(TDataSourceFilter101_4217("47426"), m_code, m_applicationName, "474262"));

        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_4217("60322", "F"), m_code, m_applicationName, "603221"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_4217("60322", "E"), m_code, m_applicationName, "603222"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_4217("60322", "A"), m_code, m_applicationName, "603223"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_4217("60322", "G"), m_code, m_applicationName, "603224"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ");
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.1(1)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.1(2)");

        return balanceMasks;
    end;

    macro getDecodingBalanceMasks()
        return "30420, 30416, 30421, 30417, 30422, 30418, 30423, 30419, 40108, 40109, 40110, 40111, 40306, 40308, 47426, 60322";
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, max(0, dataSet.roubleRest), max(0, dataSet.currencyRest), max(0, dataSet.roubleScaledRest), max(0, dataSet.currencyScaledRest));
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш1")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "Расш2"),
                                                                  TBalanceId(m_applicationName, "2", "Расш1"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка"), "474262"));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, correctNegativeValue(dataSet.roubleRest, $0), correctNegativeValue(dataSet.currencyRest, $0), correctNegativeValue(dataSet.roubleScaledRest, 0), correctNegativeValue(dataSet.currencyScaledRest, 0));
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "474262"),
                                                                  TBalanceId(m_applicationName, "1.1", "Расш", "474261"),
                                                                  TBalanceId("Приложение6", "1", "ФОР", "47426"),
                                                                  TBalanceId("Приложение6", "2", "ФОР", "47426"),
                                                                  TBalanceId("Приложение6", "3", "ФОР", "47426")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeOneDecoding("2|3.1|603221 + 2|3.1|603222 + 2|3.1|603223 + 2|3.1|603224 + 6|1|60322 + 6|2|60322 + 6|3|60322 = RVL");

        normalizeOneDecoding("2|3.1|520051 + 2|3.2|520052 = RVE");

        normalizeOneDecoding("2|3.1|408192 + 2|2|408191 + 6|1|40819 + 6|2|40819 + 6|3|40819 = RVE");
        normalizeOneDecoding("2|3.1|524052 + 2|2|524051 + 6|1|52405 + 6|2|52405 + 6|3|52405 = RVE");
        normalizeOneDecoding("2|3.1|525012 + 2|2|525011 + 6|1|52501 + 6|2|52501 + 6|3|52501 = RVE");

        normalizeOneDecoding("2|3.1|410061 + 2|3.2|410062 + 6|1|41006 + 6|2|41006 + 6|3|41006 = RVE");
        normalizeOneDecoding("2|3.1|411061 + 2|3.2|411062 + 6|1|41106 + 6|2|41106 + 6|3|41106 = RVE");
        normalizeOneDecoding("2|3.1|412061 + 2|3.2|412062 + 6|1|41206 + 6|2|41206 + 6|3|41206 = RVE");
        normalizeOneDecoding("2|3.1|413061 + 2|3.2|413062 + 6|1|41306 + 6|2|41306 + 6|3|41306 = RVE");
        normalizeOneDecoding("2|3.1|414061 + 2|3.2|414062 + 6|1|41406 + 6|2|41406 + 6|3|41406 = RVE");
        normalizeOneDecoding("2|3.1|415061 + 2|3.2|415062 + 6|1|41506 + 6|2|41506 + 6|3|41506 = RVE");
        normalizeOneDecoding("2|3.1|416061 + 2|3.2|416062 + 6|1|41606 + 6|2|41606 + 6|3|41606 = RVE");
        normalizeOneDecoding("2|3.1|417061 + 2|3.2|417062 + 6|1|41706 + 6|2|41706 + 6|3|41706 = RVE");
        normalizeOneDecoding("2|3.1|418061 + 2|3.2|418062 + 6|1|41806 + 6|2|41806 + 6|3|41806 = RVE");
        normalizeOneDecoding("2|3.1|419061 + 2|3.2|419062 + 6|1|41906 + 6|2|41906 + 6|3|41906 = RVE");
        normalizeOneDecoding("2|3.1|420061 + 2|3.2|420062 + 6|1|42006 + 6|2|42006 + 6|3|42006 = RVE");
        normalizeOneDecoding("2|3.1|421061 + 2|3.2|421062 + 6|1|42106 + 6|2|42106 + 6|3|42106 = RVE");
        normalizeOneDecoding("2|3.1|421131 + 2|3.2|421132 + 6|1|42113 + 6|2|42113 + 6|3|42113 = RVE");
        normalizeOneDecoding("2|3.1|422061 + 2|3.2|422062 + 6|1|42206 + 6|2|42206 + 6|3|42206 = RVE");
        normalizeOneDecoding("2|3.1|427061 + 2|3.2|427062 + 6|1|42706 + 6|2|42706 + 6|3|42706 = RVE");
        normalizeOneDecoding("2|3.1|428061 + 2|3.2|428062 + 6|1|42806 + 6|2|42806 + 6|3|42806 = RVE");
        normalizeOneDecoding("2|3.1|429061 + 2|3.2|429062 + 6|1|42906 + 6|2|42906 + 6|3|42906 = RVE");
        normalizeOneDecoding("2|3.1|430061 + 2|3.2|430062 + 6|1|43006 + 6|2|43006 + 6|3|43006 = RVE");
        normalizeOneDecoding("2|3.1|431061 + 2|3.2|431062 + 6|1|43106 + 6|2|43106 + 6|3|43106 = RVE");
        normalizeOneDecoding("2|3.1|432061 + 2|3.2|432062 + 6|1|43206 + 6|2|43206 + 6|3|43206 = RVE");
        normalizeOneDecoding("2|3.1|433061 + 2|3.2|433062 + 6|1|43306 + 6|2|43306 + 6|3|43306 = RVE");
        normalizeOneDecoding("2|3.1|434061 + 2|3.2|434062 + 6|1|43406 + 6|2|43406 + 6|3|43406 = RVE");
        normalizeOneDecoding("2|3.1|435061 + 2|3.2|435062 + 6|1|43506 + 6|2|43506 + 6|3|43506 = RVE");
        normalizeOneDecoding("2|3.1|436061 + 2|3.2|436062 + 6|1|43606 + 6|2|43606 + 6|3|43606 = RVE");
        normalizeOneDecoding("2|3.1|437061 + 2|3.2|437062 + 6|1|43706 + 6|2|43706 + 6|3|43706 = RVE");
        normalizeOneDecoding("2|3.1|438061 + 2|3.2|438062 + 6|1|43806 + 6|2|43806 + 6|3|43806 = RVE");
        normalizeOneDecoding("2|3.1|439061 + 2|3.2|439062 + 6|1|43906 + 6|2|43906 + 6|3|43906 = RVE");

        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Иные обязательства (за", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" исключением долгосрочных)", false, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("3.1.Иные обязательства (за исключением долгосрочных)");
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_7", this, "ЮЛ",    "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш1",  "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш2", "RV").export();

        TPtkPsdDecodingExporter("OR2_7", this, "RV", "304211").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "304231").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401081").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401101").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "403061").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "474262").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603221").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603222").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603223").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603224").export();
    end;

    private macro constructorTApplicationRow2_3_1_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.1";
    end;

    constructorTApplicationRow2_3_1_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_1_1_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков  по строке 3.1)");
    end;

    macro exportToKliko()
        var description;

        if (global.reportingPeriodIsVror == false)
            description = "3.1.1.Итого (сумма остатков по строке 3.1)";
        else
            description = "3.1.1.ИТОГО (сумма остатков по строке 3.1)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_8", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_1_1_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.1.1";
    end;

    constructorTApplicationRow2_3_1_1_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_1_2_4217(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource4090_Total(
                                                    TDecodingDataSource4090(TDataSourceFilter10_4217("40901", "ПА", RCB_OBJGROUP_REPORTKIND), TDataSourceFilter2_3_2_Gr("47431", "ПА", RCB_OBJGROUP_REPORTKIND), m_code, m_applicationName, "409011"),
                                                    TDecodingDataSource4090(TDataSourceFilter10_4217("40902", "ПА", RCB_OBJGROUP_REPORTKIND), TDataSourceFilter2_3_2_Gr("47410", "ПА", RCB_OBJGROUP_REPORTKIND), m_code, m_applicationName, "409011")
                                                   ));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_4217("40312", "R"), m_code, m_applicationName, "403121", NULL, global.ROUBLE_ONLY));
    end;

    macro getDecodingBalanceMasks()
        return "40901, 40902, 40312, 47431, 47410";
    end;

    macro normalizeDecoding()
        normalizeOneDecoding("2|3.1.2|403121 + 6|1|40312 + 6|2|40312 + 6|3|40312 = RL");
//        normalizeApplication2Row(m_code); в этой строке нет б/с, только расшифровки
    end;

    private macro getDeleterFilter()
        class TFilter()
            macro isSuitable(v : Object) : Bool
                return (    (v.fieldValue("row").exactAsString == "3.1.2")
                        and (v.fieldValue("balanceGroup").exactAsString == "расшифровка")
                        and (v.fieldValue("balance").exactAsString == "520524")
                       );
            end;
        end;

        return TFilter();
    end;

    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var dataSet        : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, "3.1.2", "расшифровка")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            iterator = getAttributeValueIterator("Приложение4", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1");
            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                saveAttributeValue("расшифровка", "520524", Date(trim(compositeValue.fieldValue("date").exact)),
                                   compositeValue.fieldValue("roubleRest").exact,  compositeValue.fieldValue("currencyRest").exact,
                                   compositeValue.fieldValue("roubleRest").scaled, compositeValue.fieldValue("currencyRest").scaled);
                iterator.moveNext();
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;

        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);

        var iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, Date(beginDateInBlock), numberDatesInBlock, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_CHANGED_BALANCE_DATE, "409011");
        printRow(iterator, false, true, false);
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT2, Date(beginDateInBlock), numberDatesInBlock, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_CHANGED_BALANCE_DATE, "409011");
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        global.rowCode = m_code;

        exportDescriptionRow("3.1.2.Вычитаются:");
        var iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO1, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_CHANGED_BALANCE_DATE, "409011");
        exportRoubleValueRow(iterator);
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO2, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_CHANGED_BALANCE_DATE, "409011");
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_81", this, "R",  "403121").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "409011").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "520524").export();
    end;

    private macro constructorTApplicationRow2_3_1_2_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.1.2";
    end;

    constructorTApplicationRow2_3_1_2_4217(applicationName);
end;

class (TApplicationRow2_3_1_2_4217) TApplicationRow2_3_1_2_507_I4605(applicationName : String)
    private var m_isCalculated;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource4090_Total(
                                                    TDecodingDataSource4090(TDataSourceFilter10_4217("40901", "ПА", RCB_OBJGROUP_REPORTKIND), TDataSourceFilter2_3_2_Gr("47431", "ПА", RCB_OBJGROUP_REPORTKIND), m_code, m_applicationName, "409011"),
                                                    TDecodingDataSource4090(TDataSourceFilter10_4217("40902", "ПА", RCB_OBJGROUP_REPORTKIND), TDataSourceFilter2_3_2_Gr("47410", "ПА", RCB_OBJGROUP_REPORTKIND), m_code, m_applicationName, "409011")
                                                   ));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_4217("40312", "R"), m_code, m_applicationName, "403121", NULL, global.ROUBLE_ONLY));

        tempTable.fill(TDecodingDataSource(TDataSourceFilter14_507_I4605("47422"), m_code, m_applicationName, "474221"));
    end;

    macro normalizeDecoding()
        normalizeOneDecoding("2|3.1.2|403121 + 6|1|40312 + 6|2|40312 + 6|3|40312 = RL");
        normalizeOneDecoding("2|3.1.2|474221 + 6|1|47422 + 6|2|47422 + 6|3|47422 = RVL");
    end;

    macro saveAttributes()
        saveAttributes();

        var dates = TRsbDataSet("SELECT t_date FROM dffordates_tmp");
        if (not m_isCalculated)
            while (dates.moveNext())
                saveAttributeValue("расшифровка", "437001(4)", dates.date, $0.0, $0.0);
            end;

            m_isCalculated = true;
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_81", this, "R",  "403121").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "409011").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "437001(4)").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "474221").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "520524").export();
    end;

    private macro constructorTApplicationRow2_3_1_2_507_I4605(applicationName : String)
        initTApplicationRow2_3_1_2_4217(applicationName);

        m_isCalculated = false;
    end;

    constructorTApplicationRow2_3_1_2_507_I4605(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_1_3_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков по кодам");
        printDescriptionRow(" обозначения по строке 3.1.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "3.1.3.Итого (сумма остатков по кодам обозначения по строке 3.1.2)";
        else
            description = "3.1.3.ИТОГО (сумма остатков по кодам обозначения по строке 3.1.2)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_82", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_1_3_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.1.3";
    end;

    constructorTApplicationRow2_3_1_3_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_1_4_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1.1", "3.1.3");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "3.1.1", "3.1.3");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (строка 3.1.1 - строка 3.1.3)");
    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "3.1.4.Итого (строка 3.1.1 - строка 3.1.3)";
        else
            description = "3.1.4.ВСЕГО (строка 3.1 - строка 3.3)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_82", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_1_4_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.1.4";
    end;

    constructorTApplicationRow2_3_1_4_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_1_5_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Иные обязательства (за исключением ", reportWidth, true);
        printDescriptionRow(" долгосрочных) в валюте Российской ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федерации (по данным граф ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 3.1.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("3.1.5.Иные обязательства (за исключением долгосрочных) в валюте РФ(по данным граф ~^в рублях~^ строки 3.1.4)", value);
        else
            exportSingleValueRow("3.1.5.Иные обязательства (за исключением долгосрочных) в валюте РФ(по данным строки 3.1.4 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_82", this, "R").export();
    end;

    private macro constructorTApplicationRow2_3_1_5_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.1.5";
    end;

    constructorTApplicationRow2_3_1_5_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_1_6_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Иные обязательства (за исключением", reportWidth, false);
        printDescriptionRow(" долгосрочных) в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф в \"иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в рублевом эквиваленте\" строки 3.1.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("3.1.6.Иные обязательства (за исключением долгосрочных) в иностранной валюте(по данным граф ~^в валюте~^ строки 3.1.4)", value);
        else
            exportSingleValueRow("3.1.6.Иные обязательства (за исключением долгосрочных) в иностранной валюте(по данным строки 3.1.4 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_82", this, "R").export();
    end;

    private macro constructorTApplicationRow2_3_1_6_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.1.6";
    end;

    constructorTApplicationRow2_3_1_6_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_2_4217(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter101_4217(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ_П"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter14_4217(getBalanceMasksForRow("3.2(2)")), m_code, m_applicationName, "2", "Расш"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ_П");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ_П");
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.2(2)");

        return balanceMasks;
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ_П"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Долгосрочные иные обязательства", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("3.2.Долгосрочные иные обязательства");
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_9", this, "ЮЛ_П",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_9", this, "Расш", "RV").export();
    end;

    private macro constructorTApplicationRow2_3_2_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.2";
    end;

    constructorTApplicationRow2_3_2_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_2_1_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков по строке 3.2)");
    end;

    macro exportToKliko()
        var description;

        if (global.reportingPeriodIsVror == false)
            description = "3.2.1.Итого (сумма остатков по строке 3.2)";
        else
            description = "3.2.1.ИТОГО (сумма остатков по строке 3.2)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_91", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_2_1_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.2.1";
    end;

    constructorTApplicationRow2_3_2_1_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_2_2_4217(applicationName : String)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TDecodingDataSource(TDataSourceFilter11_4217("42006,42106,43706,43806", "42007,42107,43707,43807"), m_code, m_applicationName, "420438(4)"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter12_4217("52005"), m_code, m_applicationName, "520053"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter13_4217("52006"), m_code, m_applicationName, "520061(5)"));
    end;

    macro getDecodingBalanceMasks()
        return "42006,42106,43706,43806,42007,42107,43707,43807,52005,52006";
    end;

    private macro getDeleterFilter()
        class TFilter()
            macro isSuitable(v : Object) : Bool
                return (    (v.fieldValue("row").exactAsString == "3.2.2")
                        and (v.fieldValue("balanceGroup").exactAsString == "расшифровка")
                        and (in(v.fieldValue("balance").exactAsString, "411520", "520056"))
                       );
            end;
        end;

        return TFilter();
    end;

    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var dataSet        : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение3", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator, "расшифровка", "411520");

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            iterator = getAttributeValueIterator("Приложение4", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator, "расшифровка", "520056");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT2, beginDateInBlock, numberDatesInBlock, "520056", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "520056");
        printRow(iterator, false, true, true);
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, beginDateInBlock, numberDatesInBlock, "520056", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "520056");
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        global.rowCode = m_code;
        exportDescriptionRow("3.2.2.Вычитаются:");
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO2, "520056", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "520056");
        exportValueRow(iterator);
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO1, "520056", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "520056");
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "411520").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "420438(4)").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "520053").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "520061(5)").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "520056").export();
    end;

    private macro constructorTApplicationRow2_3_2_2_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.2.2";
    end;

    constructorTApplicationRow2_3_2_2_4217(applicationName);
end;

private class TPrintSorterRow3_2_2()
    private var m_orderTable = RcbArray().initialize("411520","437002","420438","520053","520061","520056");

    private macro getOrder(value : String)
        m_orderTable.moveFirst();
        while (m_orderTable.moveNext())
            if (value == m_orderTable.getCurrentItem())
                return m_orderTable.getCurrentIndex();
            end;
        end;

        return m_orderTable.size;
    end;

    macro isLess(lhs, rhs)
        var lbalOrder = getOrder(substr(lhs.fieldValue("balance").currentAsString, 1, 6));
        var rbalOrder = getOrder(substr(rhs.fieldValue("balance").currentAsString, 1, 6));
        var result = lbalOrder < rbalOrder;
        if (not result)
            result =     (lbalOrder == rbalOrder)
                     and (Date(lhs.fieldValue("date").currentAsString) < Date(rhs.fieldValue("date").currentAsString));
        end;

        return result;
    end;
end;

class (TApplicationRow2_3_2_2_4217) TApplicationRow2_3_2_2_507_I4605(applicationName : String)
    private var m_isCalculated;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TDecodingDataSource(TDataSourceFilter11_4217("42006,42106,43706,43806", "42007,42107,43707,43807"), m_code, m_applicationName, "420438(5)"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter12_4217("52005"), m_code, m_applicationName, "520053"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter13_4217("52006"), m_code, m_applicationName, "520061(6)"));
    end;

    macro saveAttributes()
        saveAttributes();  //вызываем метод родителя

        var dates = TRsbDataSet("SELECT t_date FROM dffordates_tmp");
        if (not m_isCalculated)
            while (dates.moveNext())
                saveAttributeValue("расшифровка", "437002(4)", dates.date, $0.0, $0.0);
            end;

            m_isCalculated = true;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_7_BASE_ROW, beginDateInBlock, numberDatesInBlock, global.rowCode);
        iterator.setSortOrder(TPrintSorterRow3_2_2());
        printRow(iterator, false, true, true);
    end;

    macro exportToKliko()
        global.rowCode = m_code;
        exportDescriptionRow("3.2.2.Вычитаются:");
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_ROW, global.rowCode);
        iterator.setSortOrder(TPrintSorterRow3_2_2());
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "411520").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "437002(4)").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "420438(5)").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "520053").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "520061(6)").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "520056").export();
    end;

    private macro constructorTApplicationRow2_3_2_2_507_I4605(applicationName : String)
        initTApplicationRow2_3_2_2_4217(applicationName);

        m_isCalculated = false;
    end;

    constructorTApplicationRow2_3_2_2_507_I4605(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_2_3_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков по кодам");
        printDescriptionRow(" обозначения по строке 3.2.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "3.2.3.Итого (сумма остатков по кодам обозначения по строке 3.2.2)";
        else
            description = "3.2.3.ИТОГО (сумма остатков по кодам обозначения по строке 3.2.2)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_93", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_2_3_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.2.3";
    end;

    constructorTApplicationRow2_3_2_3_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_2_4_4217(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2.1", "3.2.3");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "3.2.1", "3.2.3");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (строка 3.2.1 - строка 3.2.3)");
    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "3.2.4.Итого (строка 3.2.1 - строка 3.2.3)";
        else
            description = "3.2.4.ВСЕГО (строка 3.2.1 - строка 3.2.3)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_93", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_2_4_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.2.4";
    end;

    constructorTApplicationRow2_3_2_4_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_2_5_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные иные обязательства ", reportWidth, true);
        printDescriptionRow(" в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф \"в рублях\" ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 3.2.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("3.2.5.Долгосрочные иные обязательства в валюте РФ(по данным граф ~^в рублях~^ строки 3.2.4)", value);
        else
            exportSingleValueRow("3.2.5.Долгосрочные иные обязательства в валюте РФ(по данным строки 3.2.4 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_93", this, "R").export();
    end;

    private macro constructorTApplicationRow2_3_2_5_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.2.5";
    end;

    constructorTApplicationRow2_3_2_5_4217(applicationName);
end;

class (TApplicationRow2_4217) TApplicationRow2_3_2_6_4217(applicationName : String)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные иные обязательства", reportWidth, false);
        printDescriptionRow(" в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф в \"иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в рублевом эквиваленте\" строки 3.2.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
        printBottom(false, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("3.2.6.Долгосрочные иные обязательства в иностранной валюте(по данным граф ~^в валюте~^ строки 3.2.4)", value);
        else
            exportSingleValueRow("3.2.6.Долгосрочные иные обязательства в иностранной валюте(по данным строки 3.2.4 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_93", this, "R").export();
    end;

    private macro constructorTApplicationRow2_3_2_6_4217(applicationName : String)
        initTApplicationRow2_4217(applicationName);

        m_code = "3.2.6";
    end;

    constructorTApplicationRow2_3_2_6_4217(applicationName);
end;

// Базовый класс строк Приложения 2 по 5036-У
private class (TApplicationRow2_7_5036) TApplicationRow2_5036(applicationName : String, xlsView)
    private macro normalizeOneDecodingImpl(decodingNamePool : RcbArray, isRouble : Bool, sign : Integer)
        var iteratorPool = RcbArray();
        var applicationNamePool = RcbArray();

        var synchronizer = RcbValueIteratorSynchronizer(RCB_ISK_FULL_OUTER_JOIN, SORTER_FOR_DATE);

        var iterator;

        var decodingName;
        var applicationName;
        var row;

        decodingNamePool.moveFirst();

        if (global.parameters.getAppl2NormalizationAlgorithm() == 0)
            return;
        elif (global.parameters.getAppl2NormalizationAlgorithm() == 1)
            while (decodingNamePool.moveNext())
                applicationName = decodingNamePool.getCurrentItem().applicationName;
                row = decodingNamePool.getCurrentItem().row;
                decodingName = decodingNamePool.getCurrentItem().name;
                iterator = getAttributeValueIterator(applicationName);
                iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, global.parameters.getEndDate(), 1, decodingName, row);
                iterator.moveFirst();
                iteratorPool.push_back(iterator);
                applicationNamePool.push_back(applicationName);
                synchronizer.addIterator(iterator);
            end;
        elif(global.parameters.getAppl2NormalizationAlgorithm() == 2)
            while (decodingNamePool.moveNext())
                applicationName = decodingNamePool.getCurrentItem().applicationName;
                row = decodingNamePool.getCurrentItem().row;
                decodingName = decodingNamePool.getCurrentItem().name;
                iterator = getAttributeValueIterator(applicationName);
                iterator.setFilter(FILTER_FOR_NORMALIZER1, decodingName, row);
                iterator.moveFirst();
                iteratorPool.push_back(iterator);
                applicationNamePool.push_back(applicationName);
                synchronizer.addIterator(iterator);
            end;
        else
            return;
        end;

        synchronizer.moveFirst();
        while (not synchronizer.isDone())
            iteratorPool.moveFirst();

            var dateValue : Date;
            var balanceNumber;

            var rcbValuePool = RcbArray();
            var isFirstIterator = true;
            var hasBalanceData = false;

            while (iteratorPool.moveNext())
                if (synchronizer.isNull(iteratorPool.getCurrentItem()))
                    continue;
                end;

                var compositeValue = iteratorPool.getCurrentItem().currentItem;

                if (isFirstIterator)
                    dateValue = Date(trim(compositeValue.fieldValue("date").exactAsString));
                    balanceNumber = substr(compositeValue.fieldValue("balance").exactAsString, 1, 5);
                    isFirstIterator = false;
                    hasBalanceData = true;
                end;

                if (hasBalanceData)
                    var value = compositeValue.fieldValue(ternary(isRouble, "roubleRest", "currencyRest"));
                    if (value.exact != $0)
                        var id = global.toAnsiNorm(        applicationNamePool.value(iteratorPool.getCurrentIndex())
                                                   + "_" + compositeValue.fieldValue("row").exactAsString
                                                   + "_" + ternary(isRouble, "Ру", "Ва")
                                                   + "_" + compositeValue.fieldValue("balance").exactAsString
                                                   + "_" + string(dateValue : f),
                                                   true
                                                  );
                        rcbValuePool.push_back(TNormalizerValueData(id, value));
                    end;
                end;
            end;

            if (hasBalanceData)
                var balanceValues = global.balanceData.getValues(balanceNumber, dateValue);
                var balanceValue;
                if (isRouble)
                    balanceValue = balanceValues.getRoubleScaledRest();
                else
                    balanceValue = balanceValues.getCurrencyScaledRest();
                end;
                if ((balanceValue != 0.0) and (rcbValuePool.size != 0))
                    normalizeOneRecord(rcbValuePool, balanceValue, sign);
                end;
            end;

            synchronizer.moveNext();
        end;
    end;

    private macro normalizeOneDecoding(p1 : Variant, p2 : Variant, sign : Integer)
        if (valType(p1) == V_STRING)
            var data = RcbArray();
            for (var attributeName, strcut(p1, "+="))
                var attributeParts = strcut(attributeName, "_|");
                var decodingData = TDecodingData("Приложение"+trim(attributeParts[0]), trim(attributeParts[1]), trim(attributeParts[2]));
                data.push_back(decodingData);
            end;
            var lastToken = data.pop_back();
            if (index(lastToken.applicationName, "E") != 0)
                sign = RCB_RS_EQUAL;
            elif (index(lastToken.applicationName, "L") != 0)
                sign = RCB_RS_LESS_OR_EQUAL;
            else
                sign = RCB_RS_EQUAL;
            end;
            if (index(lastToken.applicationName, "R") != 0)
                normalizeOneDecodingImpl(data, NATIONAL_CURRENCY, sign);
            end;
            if (index(lastToken.applicationName, "V") != 0)
                normalizeOneDecodingImpl(data, FOREIGN_CURRENCY, sign);
            end;
        elif (valType(p2) == V_BOOL)
            normalizeOneDecodingImpl(p1, p2, sign);
        else
            sign = p2;
            normalizeOneDecodingImpl(p1, NATIONAL_CURRENCY, sign);
            normalizeOneDecodingImpl(p1, FOREIGN_CURRENCY, sign);
        end;
    end;

    private macro normalizeApplication2Row(rowCode)
        class TFilter(row)
            private var m_row = row;
            private var m_date = global.parameters.getEndDate();

            macro isSuitable(v : Object)
                return (    (strlen(v.fieldValue("balance").current) == 5)
                        and (v.fieldValue("row").current == m_row)
                        and (v.fieldValue("balance").current != "40901")
                        and (v.fieldValue("balance").current != "40902")
                        and (Date(v.fieldValue("date").current) == m_date) // преобразование строки к дате надёжней, т.к. возможно
                                                                           // ручное заполнение даты и не факт, что соответствующая
                                                                           // строка будет равна ДООП, приведенной к строке
                       );
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return ((v1.fieldValue("balance").current) < (v2.fieldValue("balance").current));
            end;
        end;

        rowCode = nvl(rowCode, global.rowCode);

        if (global.parameters.getAppl2NormalizationAlgorithm() == 0)
            return;
        elif (global.parameters.getAppl2NormalizationAlgorithm() == 1)
            var prevBalance = "";
            var balanceIterator = getAttributeValueIterator(m_applicationName, TFilter(rowCode), TSorter());
            while (not balanceIterator.isDone())
                var balance = balanceIterator.currentItem.fieldValue("balance").current;
                if (prevBalance == balance)
                    balanceIterator.next();
                    continue;
                end;

                var decodingData = RcbArray().initialize(TDecodingData(m_applicationName, rowCode, balance),
                                                         TDecodingData("Приложение6", "1", balance),
                                                         TDecodingData("Приложение6", "2", balance),
                                                         TDecodingData("Приложение6", "3", balance)
                                    );
                normalizeOneDecoding(decodingData, RCB_RS_EQUAL);

                balanceIterator.next();
                prevBalance = balance;
            end;
        elif (global.parameters.getAppl2NormalizationAlgorithm() == 2)
            var balanceReports = global.balanceData.getBalanceReports();
            if (balanceReports != null)
                var protocolData = TArray();
                var errorProtocolData = TArray();

                normalizeApplication2RowSys(rowCode, balanceReports, protocolData, errorProtocolData);

                var i;
                for (i, protocolData)
                    normalizationProtocol.printString(i[0], i[1], i[2], i[3]);
                end;
                for (i, errorProtocolData)
                    normalizationProtocolWithErrors.printError(i[0]);
                    normalizationProtocolWithErrors.printNameLog(i[1]);
                end;
            end;
        else
            return;
        end;
    end;

    private macro constructorTApplicationRow2_5036(applicationName : String, xlsView)
        initTApplicationRow2_7_5036(applicationName, xlsView);
    end;

    constructorTApplicationRow2_5036(applicationName, xlsView);
end;

// Классы строк 1* Приложения 2 по 5036-У
private class (TDataSourceFilter_5036) TDataSourceFilter_BalanceMask_5036(balanceMasks : String, category : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;

    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter2_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND (   ( " + isNotResident("account.t_contractorId")
            +"\n"+ "         AND (   " + isEmployer("account.t_contractorId")
            +"\n"+ "              OR " + isBank("account.t_contractorId")
            +"\n"+ "              OR NOT " + isNaturalPerson("account.t_contractorId")
            +"\n"+ "             )"
            +"\n"+ "        )"
            +"\n"+ "     OR"
            +"\n"+ "        ( " + isNotResident("account.t_clientCode")
            +"\n"+ "         AND (   " + isEmployer("account.t_clientCode")
            +"\n"+ "              OR " + isBank("account.t_clientCode")
            +"\n"+ "              OR NOT " + isNaturalPerson("account.t_clientCode")
            +"\n"+ "             )"
            +"\n"+ "        )"
            +"\n"+ "    )"
            ;
    end;
    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter3_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermLessThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
            ;
    end;
    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter4_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + ")";

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
            ;
    end;
    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter15_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + ")";

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  EXISTS(SELECT 1"
            +"\n"+ "              FROM repMmDeals_vw deals"
            +"\n"+ "             WHERE deals.t_mainRestAccount = account.t_account"
            +"\n"+ "               AND deals.t_fiId = account.t_fiId"
            +"\n"+ "               AND deals.t_isOpened = 1"
            +"\n"+ "               AND " + isNotResident("deals.t_contragentId")
            +"\n"+ "               AND " + isBank("deals.t_contragentId")
            +"\n"+ "               AND " + isMmDealsTermLessThreeYears()
            +"\n"+ "           ) "
            ;
    end;
    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter16_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")";
    end;

    macro makePartFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + ")";

        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  EXISTS(SELECT 1"
            +"\n"+ "              FROM repMmDeals_vw deals"
            +"\n"+ "             WHERE deals.t_mainRestAccount = account.t_account"
            +"\n"+ "               AND deals.t_fiId = account.t_fiId"
            +"\n"+ "               AND deals.t_isOpened = 1"
            +"\n"+ "               AND " + isNotResident("deals.t_contragentId")
            +"\n"+ "               AND " + isBank("deals.t_contragentId")
            +"\n"+ "               AND " + isMmDealsTermEqualThreeYears()
            +"\n"+ "           ) "
            ;
    end;
    initTDataSourceFilter_5036(balanceMasks, category);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_5036(applicationName : String, xlsView)

    macro getBalanceMasks()
    end;

    macro fillTempTable(tempTable : TTempTable)
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
    end;

    macro updateBalanceValues()
    end;

    macro saveAttributes()
    end;

    macro normalizeDecoding()
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Обязательства перед юридическими", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" лицами - нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printDescriptionRowExcel(RcbArray().initialize(" Обязательства перед юридическими",
                                                       " лицами - нерезидентами"), true, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro exportToKliko()
        exportDescriptionRow("1.Обязательства перед юридическими лицами-нерезидентами", true);
    end;

    macro exportToPtkPsd()
    end;

    private macro constructorTApplicationRow2_1_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1";
    end;

    constructorTApplicationRow2_1_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_1_5036(applicationName : String, xlsView)
    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.1(1)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.1(2)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.1(2_МБК)");

        return balanceMasks;
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter_BalanceMask_5036(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ_Нерез"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_5036(getBalanceMasksForRow("1.1(1)")), m_code, m_applicationName, "1", "Расш"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter3_5036(getBalanceMasksForRow("1.1(2)")), m_code, m_applicationName, "1", "РасшКс"));

        if (global.parameters.isMmDealsData())
            tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter15_5036(getBalanceMasksForRow("1.1(2_МБК)")), m_code, m_applicationName, "1", "РасшКс"));
        else
            tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter3_5036(getBalanceMasksForRow("1.1(2_МБК)")), m_code, m_applicationName, "1", "РасшКс"));
        end;
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ_Нерез");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ_Нерез");
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ_Нерез"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "РасшКс")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeOneDecoding("2|1.1|408061 + 2|2|408062 + 6|1|40806 + 6|2|40806 + 6|3|40806 = RVE");
        normalizeOneDecoding("2|1.1|408091 + 2|2|408092 + 6|1|40809 + 6|2|40809 + 6|3|40809 = RVE");
        normalizeOneDecoding("2|1.1|408121 + 2|2|408122 + 6|1|40812 + 6|2|40812 + 6|3|40812 = RVE");
        normalizeOneDecoding("2|1.1|408141 + 2|2|408142 + 6|1|40814 + 6|2|40814 + 6|3|40814 = RVE");
        normalizeOneDecoding("2|1.1|408151 + 2|2|408152 + 6|1|40815 + 6|2|40815 + 6|3|40815 = RVE");
        normalizeOneDecoding("2|1.1|408181 + 2|2|408182 + 6|1|40818 + 6|2|40818 + 6|3|40818 = RVE");

        normalizeOneDecoding("2|1.1|474261 + 2|3.1|474262 + 6|1|47426 + 6|2|47426 + 6|3|47426 = RVE");

        normalizeOneDecoding("2|1.1|314081 + 2|1.2|314082 + 6|1|31408 + 6|2|31408 + 6|3|31408 = RVE");
        normalizeOneDecoding("2|1.1|316081 + 2|1.2|316082 + 6|1|31608 + 6|2|31608 + 6|3|31608 = RVE");
        normalizeOneDecoding("2|1.1|425061 + 2|1.2|425062 + 6|1|42506 + 6|2|42506 + 6|3|42506 = RVE");
        normalizeOneDecoding("2|1.1|440061 + 2|1.2|440062 + 6|1|44006 + 6|2|44006 + 6|3|44006 = RVE");

        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Обязательства перед юридическими", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением долгосрочных)", null, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printDescriptionRowExcel(RcbArray().initialize("Обязательства перед юридическими",
                                                       "лицами - нерезидентами ",
                                                       "(за исключением долгосрочных)"), true, null, beginDateInBlock, numberDatesInBlock);

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRowExcel(iterator, false, true, true);
    end;

    macro exportToKliko()
        exportDescriptionRow("1.1.Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных)", true);
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_1", this, "ЮЛ_Нерез", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_1", this, "Расш", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_1", this, "РасшКс", "RV").export();
    end;

    private macro constructorTApplicationRow2_1_1_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.1";
    end;

    constructorTApplicationRow2_1_1_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_1_1_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " ИТОГО");
        printDescriptionRow(" (сумма остатков по строке 1.1)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);

        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, RcbArray().initialize(" ИТОГО ", "(сумма остатков по строке 1.1)"));
    end;

    macro exportToKliko()
        exportToKliko(SORTER_FOR_DATE, "1.1.1.Итого (сумма остатков по строке 1.1)");
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_2", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_1_1_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.1.1";
    end;

    constructorTApplicationRow2_1_1_1_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_1_2_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.1");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRow(iterator, " Обязательства перед юридическими", reportWidth, true);
        printDescriptionRow(" лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением долгосрочных)", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф \"в рублях\"", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 1.1.1)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRowExcel(iterator, RcbArray().initialize(" Обязательства перед юридическими",
                                                                 " лицами-нерезидентами",
                                                                 " (за исключением долгосрочных)",
                                                                 " в валюте Российской Федерации ",
                                                                 " (по данным граф \\\"в рублях\\\" ",
                                                                 " строки 1.1.1)(2)"), reportWidth, true);//"в рублях"
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.1.2.Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте РФ(по данным граф ~^в рублях~^ строки 1.1.1)", value);
        else
            exportSingleValueRow("1.1.2.Обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.1.1 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_2", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_1_2_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.1.2";
    end;

    constructorTApplicationRow2_1_1_2_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_1_3_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.1");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRow(iterator, " Обязательства перед юридическими", reportWidth, false);
        printDescriptionRow(" лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением долгосрочных)", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф \"в иностранной", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте в рублевом эквиваленте\"", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 1.1.1)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRowExcel(iterator, RcbArray().initialize(" Обязательства перед юридическими",
                                                                 " лицами-нерезидентами ",
                                                                 " (за исключением долгосрочных)",
                                                                 " в иностранной валюте ",
                                                                 "(по данным граф \\\"в иностранной",
                                                                 " валюте в рублевом эквиваленте\\\" строки 1.1.1)(2)"), reportWidth, false);
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.1.3.Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в ин. валюте(по данным граф ~^в валюте~^ строки 1.1.1)", value);
        else
            exportSingleValueRow("1.1.3.Обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.1.1 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_2", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_1_3_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.1.3";
    end;

    constructorTApplicationRow2_1_1_3_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_5036(applicationName : String, xlsView)
    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.2(1)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("1.2(1_МБК)");

        return balanceMasks;
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter_BalanceMask_5036(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ_Нерез_ДС"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter4_5036(getBalanceMasksForRow("1.2(1)")), m_code, m_applicationName, "2", "ЮЛ_Н_Расш"));

        if (global.parameters.isMmDealsData())
            tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter16_5036(getBalanceMasksForRow("1.2(1_МБК)")), m_code, m_applicationName, "2", "ЮЛ_Н_Расш"));
        else
            tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter4_5036(getBalanceMasksForRow("1.2(1_МБК)")), m_code, m_applicationName, "2", "ЮЛ_Н_Расш"));
        end;
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ_Нерез_ДС");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ_Нерез_ДС");
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ_Нерез_ДС"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "ЮЛ_Н_Расш")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Долгосрочные обязательства перед", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" юридическими лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        printDescriptionRowExcel(RcbArray().initialize(" Долгосрочные обязательства перед",
                                                       " юридическими лицами-нерезидентами"), true, null, beginDateInBlock, numberDatesInBlock);

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRowExcel(iterator, false, true, true);

    end;

    macro exportToKliko()
        exportDescriptionRow("1.2.Долгосрочные обязательства перед юридическими лицами-нерезидентами", true);
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_21", this, "ЮЛ_Нерез_ДС", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_21", this, "ЮЛ_Н_Расш", "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2";
    end;

    constructorTApplicationRow2_1_2_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_1_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " ИТОГО");
        printDescriptionRow(" (сумма остатков по строке 1.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, "ИТОГО (сумма остатков по строке 1.2)");

    end;

    macro exportToKliko()
        exportToKliko(SORTER_FOR_DATE, "1.2.1.Итого (сумма остатков по строке 1.2)");
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_22", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_1_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.1";
    end;

    constructorTApplicationRow2_1_2_1_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_2_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator("Приложение3", NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator, "П3_1_1_1_314440", "314440");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, false, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, beginDateInBlock, numberDatesInBlock, "314440", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "314440");
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        global.rowCode = m_code;

        printDescriptionRowExcel(" Вычитаются:", true, false, beginDateInBlock, numberDatesInBlock);

        var iterator;

        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, beginDateInBlock, numberDatesInBlock, "314440", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "314440");
        printRowExcel(iterator, false, true, true);

    end;

    macro exportToKliko()
        global.rowCode = m_code;
        exportDescriptionRow("1.2.2.Вычитаются:");
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO1, "314440", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE, "314440");
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_2_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.2";
    end;

    constructorTApplicationRow2_1_2_2_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_3_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.1", "1.2.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "1.2.1", "1.2.2");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого");
        printDescriptionRow(" (строка 1.2.1 - строка 1.2.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, "Итого (строка 1.2.1 - строка 1.2.2)");
    end;

    macro exportToKliko()
        exportToKliko(SORTER_FOR_DATE, "1.2.3.Итого (строка 1.2.1 - строка 1.2.2)");
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_3_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.3";
    end;

    constructorTApplicationRow2_1_2_3_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_4_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.3");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные обязательства", reportWidth, true);
        printDescriptionRow(" перед юридическими лицами-", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" нерезидентами в валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 1.2.3)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Долгосрочные обязательства ",
                                                            " перед юридическими лицами-",
                                                            " нерезидентами в валюте ",
                                                            " Российской Федерации ",
                                                            " (по данным граф ",
                                                            " \\\"в рублях\\\" строки 1.2.3)(2)"), reportWidth, true);

    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.2.4.Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным граф ~^в рублях~^ строки 1.2.3)", value);
        else
            exportSingleValueRow("1.2.4.Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.2.3 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_2_4_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.4";
    end;

    constructorTApplicationRow2_1_2_4_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_5_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.3");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные обязательства", reportWidth, false);
        printDescriptionRow(" перед юридическими лицами-", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" нерезидентами в иностранной", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте (по данным граф \"в", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" иностранной валюте в рублевом", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" эквиваленте\" строки 1.2.3)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Долгосрочные обязательства ",
                                                            " перед юридическими лицами-",
                                                            " нерезидентами в иностранной ",
                                                            " валюте (по данным граф \\\"в ",
                                                            " иностранной валюте в рублевом",
                                                            " эквиваленте\\\" строки 1.2.3)(2)"), reportWidth, false);

    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.2.5.Долгосрочные обязательства перед юридическими лицами-нерезидентами в ин. валюте(по данным граф ~^в валюте~^ строки 1.2.3)", value);
        else
            exportSingleValueRow("1.2.5.Долгосрочные обязательства перед юридическими лицами-нерезидентами в иностранной валюте (по данным строки 1.2.3 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_4", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_2_5_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.5";
    end;

    constructorTApplicationRow2_1_2_5_5036(applicationName, xlsView);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter8_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")"
                    +"\n"+ "     AND (  " + hasAssignedCategory("Строка 2.2")
                    +"\n"+ "      OR (    NOT " + isEmployer("account.t_contractorId")
                    +"\n"+ "          AND " + isNaturalPerson("account.t_contractorId")
                    +"\n"+ "         )"
                    +"\n"+ "      OR"
                    +"\n"+ "         (    NOT " + isEmployer("account.t_clientCode")
                    +"\n"+ "          AND " + isNaturalPerson("account.t_clientCode")
                    +"\n"+ "         )"
                    +"\n"+"      )"
                    ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;

    initTDataSourceFilter_5036(balanceMasks, category);
end;

class (TApplicationRow2_5036) TApplicationRow2_2_5036(applicationName : String, xlsView)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter_BalanceMask_5036(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ФЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter8_5036(getBalanceMasksForRow("2(1)")), m_code, m_applicationName, "1", "Расш1"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter8_5036(getBalanceMasksForRow("2(2)")), m_code, m_applicationName, "2", "Расш2"));
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ФЛ");
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        macro unionMasks(masks1, masks2)
            if ((masks1 == "") or (masks2 == ""))
                return masks1 + masks2;
            end;

            return masks1 + "," + masks2;
        end;

        return unionMasks(unionMasks(getBalanceMasksForRow(m_code), getBalanceMasksForRow("2(1)")), getBalanceMasksForRow("2(2)"));
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ФЛ"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш1")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш2")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

        end;
    end;

    macro normalizeDecoding()
        normalizeOneDecoding("2|2|408191 + 2|3.1|408192 + 6|1|40819 + 6|2|40819 + 6|3|40819 = RVE");
        normalizeOneDecoding("2|2|524051 + 2|3.1|524052 + 6|1|52405 + 6|2|52405 + 6|3|52405 = RVE");
        normalizeOneDecoding("2|2|525011 + 2|3.1|525012 + 6|1|52501 + 6|2|52501 + 6|3|52501 = RVE");

        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Обязательства перед физическими лицами", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        printDescriptionRowExcel(" Обязательства перед физическими лицами", true, null, beginDateInBlock, numberDatesInBlock);

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRowExcel(iterator, false, true, true);

    end;

    macro exportToKliko()
        exportDescriptionRow("2.Обязательства перед физическими лицами");
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_5", this, "ФЛ",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_5", this, "Расш1", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_5", this, "Расш2", "RV").export();
    end;

    private macro constructorTApplicationRow2_2_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "2";
    end;

    constructorTApplicationRow2_2_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_2_1_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого");
        printDescriptionRow(" (сумма остатков по строке 2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, " Итого (сумма остатков по строке 2)");
    end;

    macro exportToKliko()
        var description;

        if (global.reportingPeriodIsVror == false)
            description = "2.1.Итого (сумма остатков по строке 2)";
        else
            description = "2.1.ИТОГО (сумма остатков по строке 2)";
        end;
        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_6", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_2_1_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "2.1";
    end;

    constructorTApplicationRow2_2_1_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_2_2_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.1");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Обязательства перед физическими", reportWidth, true);
        printDescriptionRow(" лицами в валюте Российской  Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 2.1)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Обязательства перед физическими ",
                                                            " лицами в валюте Российской Федерации ",
                                                            " (по данным граф",
                                                            " \\\"в рублях\\\" строки 2.1)(2)"), reportWidth, true);

    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("2.2.Обязательства перед физическими лицами в валюте РФ(по данным граф ~^в рублях~^ строки 2.1)", value);
        else
            exportSingleValueRow("2.2.Обязательства перед физическими лицами в валюте РФ(по данным строки 2.1 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_6", this, "R").export();
    end;

    private macro constructorTApplicationRow2_2_2_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "2.2";
    end;

    constructorTApplicationRow2_2_2_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_2_3_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.1");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Обязательства перед физическими", reportWidth, false);
        printDescriptionRow(" лицами в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф в \"иностранной", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте в рублевом эквиваленте\"", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 2.1) (2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Обязательства перед физическими ",
                                                            " лицами в иностранной валюте ",
                                                            " (по данным граф \\\"в иностранной ",
                                                            " валюте в рублевом эквиваленте\\\" ",
                                                            " строки 2.1)(2)"), reportWidth, false);

    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("2.3.Обязательства перед физическими лицами в иностранной валюте(по данным граф ~^в валюте~^ строки 2.1)", value);
        else
            exportSingleValueRow("2.3.Обязательства перед физическими лицами в иностранной валюте(по данным строки 2.1 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_6", this, "R").export();
    end;

    private macro constructorTApplicationRow2_2_3_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "2.3";
    end;

    constructorTApplicationRow2_2_3_5036(applicationName, xlsView);
end;

// Классы строк 3* Приложения 2 по 5036-У
private class (TDataSourceFilter_5036) TDataSourceFilter9_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")"
                    ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermLessThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
        ;
    end;

    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter10_5036(balanceMasks : String, category : String, groupId : Integer)
    private var m_objGroupId = groupId;

    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory(m_category, m_objGroupId);
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
    end;
    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter11_5036(balanceMasks1 : String, balanceMasks2 : String)
    private var m_filter1 : Object;
    private var m_filter2 : Object;

    macro makePartDateFilter()
        m_partDateFilter = " " + m_filter1.hasAssignedCategory()
               + "\n" + "AND " + m_filter2.hasAssignedCategory()
        ;
    end;

    macro makePartFilter()
        m_partFilter = "   (   (    " + m_filter1.isSatisfiesToBalancesMasks("account.t_balance")
                 + "\n" + "     AND " + m_filter1.isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
                 + "\n" + "    )"
                 + "\n" + " OR " + m_filter2.isSatisfiesToBalancesMasks("account.t_balance")
                 + "\n" + ")"
        ;
    end;

    private macro ctor(balanceMasks1 : String, balanceMasks2 : String)
        m_filter1 = TDataSourceFilter_5036(balanceMasks1, "507-П пункт 2.5.6");
        m_filter2 = TDataSourceFilter_5036(balanceMasks2, "507-П пункт 2.5.6");
        initTDataSourceFilter_5036(balanceMasks1 + "," + balanceMasks2, "");
    end;

    ctor(balanceMasks1, balanceMasks2);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter12_5036(balanceMasks : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory();
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
        ;
    end;

    initTDataSourceFilter_5036(balanceMasks, "507-П пункт 2.5.6_1");
end;

private class (TDataSourceFilter_5036) TDataSourceFilter13_5036(balanceMasks : String)
    macro makePartDateFilter()
        m_partDateFilter = " " + hasAssignedCategory()
             +"\n"+ "AND " + hasNoAssignedCategory(null, RCB_OBJGROUP_SUBORDINATEDLOAN) //"Субординированный кредит"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
        ;
    end;

    initTDataSourceFilter_5036(balanceMasks, "507-П пункт 2.5.6_1");
end;

private class (TDataSourceFilter_5036) TDataSourceFilter14_5036(balanceMasks : String, category : String)
    macro makePartDateFilter()
        var application6Filter = "   (" + global.form.getApplication6().getRow("1").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("1").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("2").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("2").getFilter().getSqlDateFilter() + ")"
            +"\n"+               "OR (" + global.form.getApplication6().getRow("3").getFilter().getSqlFilter() + " AND " + global.form.getApplication6().getRow("3").getFilter().getSqlDateFilter() + ")";

        m_partDateFilter = "     NOT (" + application6Filter + ")"
        ;
    end;

    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
        ;
    end;

    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter17_5036(balanceMasks : String, category : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isVnesheconombank("account.t_contractorId")
            +"\n"+ "AND  " + isTermLessThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
        ;
    end;

    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter18_5036(balanceMasks : String, category : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isVnesheconombank("account.t_contractorId")
            +"\n"+ "AND  " + isTermEqualThreeYears("account.t_account", "account.t_fiId", "account.t_chapter")
        ;
    end;

    initTDataSourceFilter_5036(balanceMasks, category);
end;

private class (TDataSourceFilter_5036) TDataSourceFilter19_5036(balanceMasks : String, category : String)
    macro makePartFilter()
        m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
            +"\n"+ "AND  " + isVnesheconombank("account.t_contractorId")
        ;
    end;

    initTDataSourceFilter_5036(balanceMasks, category);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_5036(applicationName : String, xlsView)
    macro getBalanceMasks()
    end;

    macro fillTempTable(tempTable : TTempTable)
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
    end;

    macro updateBalanceValues()
    end;

    macro saveAttributes()
    end;

    macro normalizeDecoding()
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Иные обязательства", true, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        printDescriptionRowExcel(" Иные обязательства", true, null, beginDateInBlock, numberDatesInBlock);

    end;

    macro exportToKliko()
        exportDescriptionRow("3.Иные обязательства", true);
    end;

    macro exportToPtkPsd()
    end;

    private macro constructorTApplicationRow2_3_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3";
    end;

    constructorTApplicationRow2_3_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_1_5036(applicationName : String, xlsView)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter_BalanceMask_5036(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter9_5036(getBalanceMasksForRow("3.1(1)")), m_code, m_applicationName, "1", "Расш1"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter_BalanceMask_5036(getBalanceMasksForRow("3.1(2)")), m_code, m_applicationName, "2", "Расш2"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter19_5036(getBalanceMasksForRow("3.1(3)")), m_code, m_applicationName, "1", "Расш3"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter17_5036(getBalanceMasksForRow("3.1(4)")), m_code, m_applicationName, "1", "Расш4"));

        tempTable.fill(TDecodingDifferenceDataSource3042(TDataSourceFilter_BalanceMask_5036("30420, 30421"), TDataSourceFilter_BalanceMask_5036("30416, 30417"), m_code, m_applicationName, "304211",
                                                         TBalanceId("Приложение6", "1", "ФОР", "30420"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30420"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30420"),
                                                         TBalanceId("Приложение6", "1", "ФОР", "30421"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30421"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30421")));

        tempTable.fill(TDecodingDifferenceDataSource3042(TDataSourceFilter_BalanceMask_5036("30422, 30423"), TDataSourceFilter_BalanceMask_5036("30418, 30419"), m_code, m_applicationName, "304231",
                                                         TBalanceId("Приложение6", "1", "ФОР", "30422"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30422"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30422"),
                                                         TBalanceId("Приложение6", "1", "ФОР", "30423"),
                                                         TBalanceId("Приложение6", "2", "ФОР", "30423"),
                                                         TBalanceId("Приложение6", "3", "ФОР", "30423")));

        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter_BalanceMask_5036("40108, 40109"), m_code, m_applicationName, "401081","40108", "40109"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter_BalanceMask_5036("40110, 40111"), m_code, m_applicationName, "401101","40110", "40111"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter_BalanceMask_5036("40306, 40308"), m_code, m_applicationName, "403061","40306", "40308"));

        tempTable.fill(TDecodingDataSource(TDataSourceFilter_BalanceMask_5036("47426"), m_code, m_applicationName, "474262"));

        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_5036("60322", "F"), m_code, m_applicationName, "603221"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_5036("60322", "E"), m_code, m_applicationName, "603222"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_5036("60322", "A"), m_code, m_applicationName, "603223"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_5036("60322", "G"), m_code, m_applicationName, "603224"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ");
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.1(1)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.1(2)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.1(3)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.1(4)");

        return balanceMasks;
    end;

    macro getDecodingBalanceMasks()
        return "30420, 30416, 30421, 30417, 30422, 30418, 30423, 30419, 40108, 40109, 40110, 40111, 40306, 40308, 47426, 60322";
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, max(0, dataSet.roubleRest), max(0, dataSet.currencyRest), max(0, dataSet.roubleScaledRest), max(0, dataSet.currencyScaledRest));
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш1")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш3")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш4")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "Расш2"),
                                                                  TBalanceId(m_applicationName, "2", "Расш1"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка"), "474262"));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, correctNegativeValue(dataSet.roubleRest, $0), correctNegativeValue(dataSet.currencyRest, $0), correctNegativeValue(dataSet.roubleScaledRest, 0), correctNegativeValue(dataSet.currencyScaledRest, 0));
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "474262"),
                                                                  TBalanceId(m_applicationName, "1.1", "Расш", "474261"),
                                                                  TBalanceId("Приложение6", "1", "ФОР", "47426"),
                                                                  TBalanceId("Приложение6", "2", "ФОР", "47426"),
                                                                  TBalanceId("Приложение6", "3", "ФОР", "47426")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeOneDecoding("2|3.1|603221 + 2|3.1|603222 + 2|3.1|603223 + 2|3.1|603224 + 6|1|60322 + 6|2|60322 + 6|3|60322 = RVL");

        normalizeOneDecoding("2|3.1|520051 + 2|3.2|520052 = RVE");

        normalizeOneDecoding("2|3.1|408192 + 2|2|408191 + 6|1|40819 + 6|2|40819 + 6|3|40819 = RVE");
        normalizeOneDecoding("2|3.1|524052 + 2|2|524051 + 6|1|52405 + 6|2|52405 + 6|3|52405 = RVE");
        normalizeOneDecoding("2|3.1|525012 + 2|2|525011 + 6|1|52501 + 6|2|52501 + 6|3|52501 = RVE");

        normalizeOneDecoding("2|3.1|410061 + 2|3.2|410062 + 6|1|41006 + 6|2|41006 + 6|3|41006 = RVE");
        normalizeOneDecoding("2|3.1|411061 + 2|3.2|411062 + 6|1|41106 + 6|2|41106 + 6|3|41106 = RVE");
        normalizeOneDecoding("2|3.1|412061 + 2|3.2|412062 + 6|1|41206 + 6|2|41206 + 6|3|41206 = RVE");
        normalizeOneDecoding("2|3.1|413061 + 2|3.2|413062 + 6|1|41306 + 6|2|41306 + 6|3|41306 = RVE");
        normalizeOneDecoding("2|3.1|414061 + 2|3.2|414062 + 6|1|41406 + 6|2|41406 + 6|3|41406 = RVE");
        normalizeOneDecoding("2|3.1|415061 + 2|3.2|415062 + 6|1|41506 + 6|2|41506 + 6|3|41506 = RVE");
        normalizeOneDecoding("2|3.1|416061 + 2|3.2|416062 + 6|1|41606 + 6|2|41606 + 6|3|41606 = RVE");
        normalizeOneDecoding("2|3.1|417061 + 2|3.2|417062 + 6|1|41706 + 6|2|41706 + 6|3|41706 = RVE");
        normalizeOneDecoding("2|3.1|418061 + 2|3.2|418062 + 6|1|41806 + 6|2|41806 + 6|3|41806 = RVE");
        normalizeOneDecoding("2|3.1|419061 + 2|3.2|419062 + 6|1|41906 + 6|2|41906 + 6|3|41906 = RVE");
        normalizeOneDecoding("2|3.1|420061 + 2|3.2|420062 + 6|1|42006 + 6|2|42006 + 6|3|42006 = RVE");
        normalizeOneDecoding("2|3.1|421061 + 2|3.2|421062 + 6|1|42106 + 6|2|42106 + 6|3|42106 = RVE");
        normalizeOneDecoding("2|3.1|421131 + 2|3.2|421132 + 6|1|42113 + 6|2|42113 + 6|3|42113 = RVE");
        normalizeOneDecoding("2|3.1|422061 + 2|3.2|422062 + 6|1|42206 + 6|2|42206 + 6|3|42206 = RVE");
        normalizeOneDecoding("2|3.1|427061 + 2|3.2|427062 + 6|1|42706 + 6|2|42706 + 6|3|42706 = RVE");
        normalizeOneDecoding("2|3.1|428061 + 2|3.2|428062 + 6|1|42806 + 6|2|42806 + 6|3|42806 = RVE");
        normalizeOneDecoding("2|3.1|429061 + 2|3.2|429062 + 6|1|42906 + 6|2|42906 + 6|3|42906 = RVE");
        normalizeOneDecoding("2|3.1|430061 + 2|3.2|430062 + 6|1|43006 + 6|2|43006 + 6|3|43006 = RVE");
        normalizeOneDecoding("2|3.1|431061 + 2|3.2|431062 + 6|1|43106 + 6|2|43106 + 6|3|43106 = RVE");
        normalizeOneDecoding("2|3.1|432061 + 2|3.2|432062 + 6|1|43206 + 6|2|43206 + 6|3|43206 = RVE");
        normalizeOneDecoding("2|3.1|433061 + 2|3.2|433062 + 6|1|43306 + 6|2|43306 + 6|3|43306 = RVE");
        normalizeOneDecoding("2|3.1|434061 + 2|3.2|434062 + 6|1|43406 + 6|2|43406 + 6|3|43406 = RVE");
        normalizeOneDecoding("2|3.1|435061 + 2|3.2|435062 + 6|1|43506 + 6|2|43506 + 6|3|43506 = RVE");
        normalizeOneDecoding("2|3.1|436061 + 2|3.2|436062 + 6|1|43606 + 6|2|43606 + 6|3|43606 = RVE");
        normalizeOneDecoding("2|3.1|437061 + 2|3.2|437062 + 6|1|43706 + 6|2|43706 + 6|3|43706 = RVE");
        normalizeOneDecoding("2|3.1|438061 + 2|3.2|438062 + 6|1|43806 + 6|2|43806 + 6|3|43806 = RVE");
        normalizeOneDecoding("2|3.1|439061 + 2|3.2|439062 + 6|1|43906 + 6|2|43906 + 6|3|43906 = RVE");

        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Иные обязательства (за", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" исключением долгосрочных)", false, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        printDescriptionRowExcel(RcbArray().initialize(" Иные обязательства (за ",
                                                       " исключением долгосрочных)"), true, null, beginDateInBlock, numberDatesInBlock);

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRowExcel(iterator, false, true, true);

    end;

    macro exportToKliko()
        exportDescriptionRow("3.1.Иные обязательства (за исключением долгосрочных)");
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_7", this, "ЮЛ",    "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш1", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш2", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш3", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш4", "RV").export();

        TPtkPsdDecodingExporter("OR2_7", this, "RV", "304211").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "304231").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401081").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401101").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "403061").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "474262").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603221").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603222").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603223").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603224").export();
    end;

    private macro constructorTApplicationRow2_3_1_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.1";
    end;

    constructorTApplicationRow2_3_1_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_1_1_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков  по строке 3.1)");
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, " Итого (сумма остатков  по строке 3.1)");

    end;

    macro exportToKliko()
        var description;

        if (global.reportingPeriodIsVror == false)
            description = "3.1.1.Итого (сумма остатков по строке 3.1)";
        else
            description = "3.1.1.ИТОГО (сумма остатков по строке 3.1)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_8", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_1_1_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.1.1";
    end;

    constructorTApplicationRow2_3_1_1_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_1_2_5036(applicationName : String, xlsView)
    private var m_isSaved437001;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource4090_Total(
                                                    TDecodingDataSource4090(TDataSourceFilter10_5036("40901", "ПА", RCB_OBJGROUP_REPORTKIND), TDataSourceFilter2_3_2_Gr("47431", "ПА", RCB_OBJGROUP_REPORTKIND), m_code, m_applicationName, "409011"),
                                                    TDecodingDataSource4090(TDataSourceFilter10_5036("40902", "ПА", RCB_OBJGROUP_REPORTKIND), TDataSourceFilter2_3_2_Gr("47410", "ПА", RCB_OBJGROUP_REPORTKIND), m_code, m_applicationName, "409011")
                                                   ));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_5036("40312", "R"), m_code, m_applicationName, "403121", NULL, global.ROUBLE_ONLY));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter10_5036("47422", "Сумма Аренды_Лизинга", RCB_OBJGROUP_REPORTKIND_ACTIVE), m_code, m_applicationName, "474221"));
    end;

    macro getDecodingBalanceMasks()
        return "40901, 40902, 40312, 47431, 47410";
    end;

    macro normalizeDecoding()
        normalizeOneDecoding("2|3.1.2|403121 + 6|1|40312 + 6|2|40312 + 6|3|40312 = RL");
        normalizeOneDecoding("2|3.1.2|474221 + 6|1|47422 + 6|2|47422 + 6|3|47422 = RVL");
    end;

    private macro getDeleterFilter()
        class TFilter()
            macro isSuitable(v : Object) : Bool
                return (    (v.fieldValue("row").exactAsString == "3.1.2")
                        and (v.fieldValue("balanceGroup").exactAsString == "расшифровка")
                        and (v.fieldValue("balance").exactAsString == "520524")
                       );
            end;
        end;

        return TFilter();
    end;

    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var dataSet        : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, "3.1.2", "расшифровка")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            if (not m_isSaved437001)
                m_isSaved437001 = true;
                dataSet = TRsbDataSet("SELECT t_date FROM dffordates_tmp");
                while (dataSet.moveNext())
                    saveAttributeValue("расшифровка", "437001(3)", dataSet.date, $0.0, $0.0);
                end;
            end;

            iterator = getAttributeValueIterator("Приложение4", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1");
            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                saveAttributeValue("расшифровка", "520524", Date(trim(compositeValue.fieldValue("date").exact)),
                                   compositeValue.fieldValue("roubleRest").exact,  compositeValue.fieldValue("currencyRest").exact,
                                   compositeValue.fieldValue("roubleRest").scaled, compositeValue.fieldValue("currencyRest").scaled);
                iterator.moveNext();
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;

        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);

        var iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, Date(beginDateInBlock), numberDatesInBlock, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, false);
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT2, Date(beginDateInBlock), numberDatesInBlock, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        global.rowCode = m_code;

        printDescriptionRowExcel(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);

        var iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT1, Date(beginDateInBlock), numberDatesInBlock, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRowExcel(iterator, false, true, false);

        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_PRINT2, Date(beginDateInBlock), numberDatesInBlock, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRowExcel(iterator, false, true, true);

    end;

    macro exportToKliko()
        global.rowCode = m_code;

        exportDescriptionRow("3.1.2.Вычитаются:");
        var iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO1, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportRoubleValueRow(iterator);
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_ROW_3_2_KLIKO2, "403121", global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_81", this, "R",  "403121").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "409011").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "437001(3)").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "474221").export();
        TPtkPsdDecodingExporter("OR2_81", this, "RV", "520524").export();
    end;

    private macro constructorTApplicationRow2_3_1_2_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.1.2";
        m_isSaved437001 = false;
    end;

    constructorTApplicationRow2_3_1_2_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_1_3_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков по кодам");
        printDescriptionRow(" обозначения по строке 3.1.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, RcbArray().initialize(" Итого (сумма остатков по кодам", " обозначения по строке 3.1.2)"));

    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "3.1.3.Итого (сумма остатков по кодам обозначения по строке 3.1.2)";
        else
            description = "3.1.3.ИТОГО (сумма остатков по кодам обозначения по строке 3.1.2)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_82", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_1_3_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.1.3";
    end;

    constructorTApplicationRow2_3_1_3_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_1_4_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1.1", "3.1.3");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "3.1.1", "3.1.3");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (строка 3.1.1 - строка 3.1.3)");
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, " Итого (строка 3.1.1 - строка 3.1.3)");

    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "3.1.4.Итого (строка 3.1.1 - строка 3.1.3)";
        else
            description = "3.1.4.ВСЕГО (строка 3.1 - строка 3.3)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_82", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_1_4_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.1.4";
    end;

    constructorTApplicationRow2_3_1_4_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_1_5_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Иные обязательства (за исключением ", reportWidth, true);
        printDescriptionRow(" долгосрочных) в валюте Российской ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федерации (по данным граф ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 3.1.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Иные обязательства (за исключением ",
                                                                 " долгосрочных) в валюте Российской ",
                                                                 " Федерации (по данным граф ",
                                                                 " \\\"в рублях\\\" строки 3.1.4)(2)"), reportWidth, true);

    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("3.1.5.Иные обязательства (за исключением долгосрочных) в валюте РФ(по данным граф ~^в рублях~^ строки 3.1.4)", value);
        else
            exportSingleValueRow("3.1.5.Иные обязательства (за исключением долгосрочных) в валюте РФ(по данным строки 3.1.4 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_82", this, "R").export();
    end;

    private macro constructorTApplicationRow2_3_1_5_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.1.5";
    end;

    constructorTApplicationRow2_3_1_5_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_1_6_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.1.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Иные обязательства (за исключением", reportWidth, false);
        printDescriptionRow(" долгосрочных) в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф в \"иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в рублевом эквиваленте\" строки 3.1.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Иные обязательства (за исключением ",
                                                                 " долгосрочных) в иностранной валюте ",
                                                                 " (по данным граф в \\\"иностранной валюте ",
                                                                 " в рублевом эквиваленте\\\" строки 3.1.4)(2)"), reportWidth, false);

    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("3.1.6.Иные обязательства (за исключением долгосрочных) в иностранной валюте(по данным граф ~^в валюте~^ строки 3.1.4)", value);
        else
            exportSingleValueRow("3.1.6.Иные обязательства (за исключением долгосрочных) в иностранной валюте(по данным строки 3.1.4 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_82", this, "R").export();
    end;

    private macro constructorTApplicationRow2_3_1_6_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.1.6";
    end;

    constructorTApplicationRow2_3_1_6_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_2_5036(applicationName : String, xlsView)
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter_BalanceMask_5036(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ_П"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter14_5036(getBalanceMasksForRow("3.2(2)")), m_code, m_applicationName, "2", "Расш"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter18_5036(getBalanceMasksForRow("3.2(3)")), m_code, m_applicationName, "2", "Расш3"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter19_5036(getBalanceMasksForRow("3.2(4)")), m_code, m_applicationName, "1", "Расш4"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ_П");
    end;

    macro updateBalanceValues()
        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateBalanceValue(dataSet, "ЮЛ_П");
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.2(2)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.2(3)");

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3.2(4)");

        return balanceMasks;
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ_П"),
                                                                  TBalanceId("Приложение6", "1", "ФОР"),
                                                                  TBalanceId("Приложение6", "2", "ФОР"),
                                                                  TBalanceId("Приложение6", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш3")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш4")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;
        end;
    end;

    macro normalizeDecoding()
        normalizeApplication2Row(m_code);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Долгосрочные иные обязательства", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        printDescriptionRowExcel(" Долгосрочные иные обязательства", true, null, beginDateInBlock, numberDatesInBlock);

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRowExcel(iterator, false, true, true);

    end;

    macro exportToKliko()
        exportDescriptionRow("3.2.Долгосрочные иные обязательства");
        exportToKliko(SORTER_FOR_BALANCE_DATE);
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_9", this, "ЮЛ_П",  "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_9", this, "Расш",  "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_9", this, "Расш3", "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_9", this, "Расш4", "RV").export();
    end;

    private macro constructorTApplicationRow2_3_2_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.2";
    end;

    constructorTApplicationRow2_3_2_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_2_1_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков по строке 3.2)");
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, " Итого (сумма остатков по строке 3.2)");

    end;

    macro exportToKliko()
        var description;

        if (global.reportingPeriodIsVror == false)
            description = "3.2.1.Итого (сумма остатков по строке 3.2)";
        else
            description = "3.2.1.ИТОГО (сумма остатков по строке 3.2)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_91", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_2_1_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.2.1";
    end;

    constructorTApplicationRow2_3_2_1_5036(applicationName, xlsView);
end;

private class TPrintSorterRow3_2_2_5036()
    private var m_orderTable = RcbArray().initialize("411520","437002","520056");

    private macro getOrder(value : String)
        m_orderTable.moveFirst();
        while (m_orderTable.moveNext())
            if (value == m_orderTable.getCurrentItem())
                return m_orderTable.getCurrentIndex();
            end;
        end;

        return m_orderTable.size;
    end;

    macro isLess(lhs, rhs)
        var lbalOrder = getOrder(substr(lhs.fieldValue("balance").currentAsString, 1, 6));
        var rbalOrder = getOrder(substr(rhs.fieldValue("balance").currentAsString, 1, 6));
        var result = lbalOrder < rbalOrder;
        if (not result)
            result =     (lbalOrder == rbalOrder)
                     and (Date(lhs.fieldValue("date").currentAsString) < Date(rhs.fieldValue("date").currentAsString));
        end;

        return result;
    end;
end;

class (TApplicationRow2_5036) TApplicationRow2_3_2_2_5036(applicationName : String, xlsView)
    private var m_isSaved437002;

    private macro getDeleterFilter()
        class TFilter()
            macro isSuitable(v : Object) : Bool
                return (    (v.fieldValue("row").exactAsString == "3.2.2")
                        and (v.fieldValue("balanceGroup").exactAsString == "расшифровка")
                        and (in(v.fieldValue("balance").exactAsString, "411520", "520056"))
                       );
            end;
        end;

        return TFilter();
    end;

    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var dataSet        : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение3", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator, "расшифровка", "411520");

            iterator = getAttributeValueIterator("Приложение4", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator, "расшифровка", "520056");

            if (not m_isSaved437002)
                m_isSaved437002 = true;
                var dates = TRsbDataSet("SELECT t_date FROM dffordates_tmp");
                while (dates.moveNext())
                    saveAttributeValue("расшифровка", "437002(3)", dates.date, $0.0, $0.0);
                end;
            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_7_BASE_ROW, beginDateInBlock, numberDatesInBlock, global.rowCode);
        iterator.setSortOrder(TPrintSorterRow3_2_2_5036());
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        global.rowCode = m_code;

        printDescriptionRowExcel(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);

        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_7_BASE_ROW, beginDateInBlock, numberDatesInBlock, global.rowCode);
        iterator.setSortOrder(TPrintSorterRow3_2_2_5036());
        printRowExcel(iterator, false, true, true);

    end;

    macro exportToKliko()
        global.rowCode = m_code;
        exportDescriptionRow("3.2.2.Вычитаются:");
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_ROW, global.rowCode);
        iterator.setSortOrder(TPrintSorterRow3_2_2_5036());
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "411520").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "437002(3)").export();
        TPtkPsdDecodingExporter("OR2_92", this, "RV", "520056").export();
    end;

    private macro constructorTApplicationRow2_3_2_2_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.2.2";
        m_isSaved437002 = false;
    end;

    constructorTApplicationRow2_3_2_2_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_2_3_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков по кодам");
        printDescriptionRow(" обозначения по строке 3.2.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, RcbArray().initialize(" Итого (сумма остатков по кодам", " обозначения по строке 3.2.2)"));

    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "3.2.3.Итого (сумма остатков по кодам обозначения по строке 3.2.2)";
        else
            description = "3.2.3.ИТОГО (сумма остатков по кодам обозначения по строке 3.2.2)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_93", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_2_3_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.2.3";
    end;

    constructorTApplicationRow2_3_2_3_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_2_4_5036(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2.1", "3.2.3");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "3.2.1", "3.2.3");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (строка 3.2.1 - строка 3.2.3)");
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, " Итого (строка 3.2.1 - строка 3.2.3)");

    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "3.2.4.Итого (строка 3.2.1 - строка 3.2.3)";
        else
            description = "3.2.4.ВСЕГО (строка 3.2.1 - строка 3.2.3)";
        end;

        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_93", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_3_2_4_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.2.4";
    end;

    constructorTApplicationRow2_3_2_4_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_2_5_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные иные обязательства ", reportWidth, true);
        printDescriptionRow(" в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф \"в рублях\" ", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 3.2.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Долгосрочные иные обязательства ",
                                                            " в валюте Российской Федерации",
                                                            " (по данным граф \\\"в рублях\\\" ",
                                                            " строки 3.2.4)(2)"), reportWidth, true);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("3.2.5.Долгосрочные иные обязательства в валюте РФ(по данным граф ~^в рублях~^ строки 3.2.4)", value);
        else
            exportSingleValueRow("3.2.5.Долгосрочные иные обязательства в валюте РФ(по данным строки 3.2.4 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_93", this, "R").export();
    end;

    private macro constructorTApplicationRow2_3_2_5_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.2.5";
    end;

    constructorTApplicationRow2_3_2_5_5036(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_3_2_6_5036(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.2.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные иные обязательства", reportWidth, false);
        printDescriptionRow(" в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф в \"иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в рублевом эквиваленте\" строки 3.2.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
        printBottom(false, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Долгосрочные иные обязательства",
                                                            " в иностранной валюте",
                                                            " (по данным граф в \\\"иностранной валюте",
                                                            " в рублевом эквиваленте\\\" строки 3.2.4)(2)"), reportWidth, false);
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("3.2.6.Долгосрочные иные обязательства в иностранной валюте(по данным граф ~^в валюте~^ строки 3.2.4)", value);
        else
            exportSingleValueRow("3.2.6.Долгосрочные иные обязательства в иностранной валюте(по данным строки 3.2.4 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_93", this, "R").export();
    end;

    private macro constructorTApplicationRow2_3_2_6_5036(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "3.2.6";
    end;

    constructorTApplicationRow2_3_2_6_5036(applicationName, xlsView);
end;

// Приложение 2 по 5242-У
private class TPrintSorterBalanceEnumDate()
    private var m_orderTable : Object;

    private macro getOrder(value : String)
        m_orderTable.moveFirst();
        while (m_orderTable.moveNext())
            if (value == m_orderTable.getCurrentItem())
                return m_orderTable.getCurrentIndex();
            end;
        end;

        return m_orderTable.size;
    end;

    macro isLess(lhs, rhs)
        var lbalOrder = getOrder(substr(lhs.fieldValue("balance").currentAsString, 1, 6));
        var rbalOrder = getOrder(substr(rhs.fieldValue("balance").currentAsString, 1, 6));
        var result = lbalOrder < rbalOrder;
        if (not result)
            result =     (lbalOrder == rbalOrder)
                     and (Date(lhs.fieldValue("date").currentAsString) < Date(rhs.fieldValue("date").currentAsString));
        end;

        return result;
    end;

    m_orderTable = RcbArray();
    local var i = 1;
    local var v = null;
    while (getParm(i, v))
        m_orderTable.push_back(v);
        i = i + 1;
    end;
end;

// Классы строк 1* Приложения 2 по 5242-У
class (TApplicationRow2_5036) TApplicationRow2_1_1_2_5242(applicationName : String, xlsView)
//    private var m_isSaved314001;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

//            if (not m_isSaved314001)
//                m_isSaved314001 = true;
                dataSet = TRsbDataSet("SELECT t_date FROM dffordates_tmp");
                while (dataSet.moveNext())
                    saveAttributeValue("расшифровка", "314001(3)", dataSet.date, $0.0, $0.0);
                end;
//            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитается:", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_7_BASE_ROW, beginDateInBlock, numberDatesInBlock, global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        printDescriptionRowExcel(" Вычитается:", true, null, beginDateInBlock, numberDatesInBlock);
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_7_BASE_ROW, beginDateInBlock, numberDatesInBlock, global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        printRowExcel(iterator, false, true, true);
    end;

    macro exportToKliko()
        global.rowCode = m_code;
        exportDescriptionRow("1.1.2.Вычитаются:");
        var iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_ROW, global.rowCode);
        iterator.setSortOrder(SORTER_FOR_BALANCE_DATE);
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_2", this, "RV", "314001(3)").export();
    end;

    private macro constructorTApplicationRow2_1_1_2_5242(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.1.2";
//        m_isSaved314001 = false;
    end;

    constructorTApplicationRow2_1_1_2_5242(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_1_3_5242(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.1", "1.1.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "1.1.1", "1.1.2");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (строка 1.1.1 - строка 1.1.2)");
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, " Итого (строка 1.1.1 - строка 1.1.2)");
    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "1.1.3.Итого (строка 1.1.1 - строка 1.1.2)";
        else
            description = "1.3.ВСЕГО (строка 1.1 - строка 1.2)";
        end;
        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_2", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_1_3_5242(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.1.3";
    end;

    constructorTApplicationRow2_1_1_3_5242(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_1_4_5242(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.3");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRow(iterator, " Обязательства перед юридическими", reportWidth, true);
        printDescriptionRow(" лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением долгосрочных)", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в валюте Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф \"в рублях\"", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 1.1.3)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRowExcel(iterator, RcbArray().initialize(" Обязательства перед юридическими",
                                                                 " лицами-нерезидентами",
                                                                 " (за исключением долгосрочных)",
                                                                 " в валюте Российской Федерации ",
                                                                 " (по данным граф \\\"в рублях\\\" ",
                                                                 " строки 1.1.3)(2)"), reportWidth, true);//"в рублях"
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.1.4.Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте РФ(по данным граф ~^в рублях~^ строки 1.1.3)", value);
        else
            exportSingleValueRow("1.1.4.Обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.1.3 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_2", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_1_4_5242(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.1.4";
    end;

    constructorTApplicationRow2_1_1_4_5242(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_1_5_5242(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.3");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRow(iterator, " Обязательства перед юридическими", reportWidth, false);
        printDescriptionRow(" лицами-нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (за исключением долгосрочных)", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в иностранной валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф \"в иностранной", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте в рублевом эквиваленте\"", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 1.1.3)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)

        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);

        printSingleValueRowExcel(iterator, RcbArray().initialize(" Обязательства перед юридическими",
                                                                 " лицами-нерезидентами ",
                                                                 " (за исключением долгосрочных)",
                                                                 " в иностранной валюте ",
                                                                 "(по данным граф \\\"в иностранной",
                                                                 " валюте в рублевом эквиваленте\\\" строки 1.1.3)(2)"), reportWidth, false);
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.1.5.Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в ин. валюте(по данным граф ~^в валюте~^ строки 1.1.3)", value);
        else
            exportSingleValueRow("1.1.5.Обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.1.3 граф в валюте)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_2", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_1_5_5242(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.1.5";
    end;

    constructorTApplicationRow2_1_1_5_5242(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_2_5242(applicationName : String, xlsView)
//    private var m_isSaved314002;

    macro saveAttributes()
        var dataset : Object;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator("Приложение3", NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1.1");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator, "расшифровка", "314440");

//            if (not m_isSaved314002)
//                m_isSaved314002 = true;
                dataSet = TRsbDataSet("SELECT t_date FROM dffordates_tmp");
                while (dataSet.moveNext())
                    saveAttributeValue("расшифровка", "314002(3)", dataSet.date, $0.0, $0.0);
                end;
//            end;
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, false, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_7_BASE_ROW, beginDateInBlock, numberDatesInBlock, global.rowCode);
        iterator.setSortOrder(TPrintSorterBalanceEnumDate("314002", "314440"));
        printRow(iterator, false, true, true);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        printDescriptionRowExcel(" Вычитаются:", true, false, beginDateInBlock, numberDatesInBlock);
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_2_7_BASE_ROW, beginDateInBlock, numberDatesInBlock, global.rowCode);
        iterator.setSortOrder(TPrintSorterBalanceEnumDate("314002", "314440"));
        printRowExcel(iterator, false, true, true);
    end;

    macro exportToKliko()
        global.rowCode = m_code;
        exportDescriptionRow("1.2.2.Вычитаются:");
        var iterator;
        iterator = getAttributeValueIterator(m_applicationName);
        iterator.setFilter(FILTER_FOR_APPLICATION_ROW, global.rowCode);
        iterator.setSortOrder(TPrintSorterBalanceEnumDate("314440", "314002"));
        exportValueRow(iterator);
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_4", this, "RV", "314440").export();
        TPtkPsdDecodingExporter("OR2_4", this, "RV", "314002(3)").export();
    end;

    private macro constructorTApplicationRow2_1_2_2_5242(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.2";
//        m_isSaved314002 = false;
    end;

    constructorTApplicationRow2_1_2_2_5242(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_3_5242(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.2");
            iterator.setSortOrder(SORTER_FOR_DATE);
            summarizeAndSaveAttributeValue(iterator);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого (сумма остатков по кодам");
        printDescriptionRow(" обозначения по строке 1.2.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, RcbArray().initialize(" Итого (сумма остатков по кодам", " обозначения по строке 1.2.2)"));
    end;

    macro exportToKliko()
        var description;
        if (global.reportingPeriodIsVror == false)
            description = "1.2.3.Итого (сумма остатков по кодам обозначения по строке 1.2.2)";
        else
            description = "1.2.3.ИТОГО (сумма остатков по кодам обозначения по строке 1.2.2)";
        end;
        exportToKliko(SORTER_FOR_DATE, description);
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_3_5242(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.3";
    end;

    constructorTApplicationRow2_1_2_3_5242(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_4_5242(applicationName : String, xlsView)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.1", "1.2.3");
            iterator.setSortOrder(SORTER_FOR_DATE);
            subtractAndSaveAttributeValue(iterator, "1.2.1", "1.2.3");
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRow(iterator, true, true, true, " Итого");
        printDescriptionRow(" (строка 1.2.1 - строка 1.2.3)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        var iterator = getValueIterator(NULL, beginDateInBlock, numberDatesInBlock);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printRowExcel(iterator, true, true, true, "Итого (строка 1.2.1 - строка 1.2.3)");
    end;

    macro exportToKliko()
        exportToKliko(SORTER_FOR_DATE, "1.2.4.Итого (строка 1.2.1 - строка 1.2.3)");
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "RV").export();
    end;

    private macro constructorTApplicationRow2_1_2_4_5242(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.4";
    end;

    constructorTApplicationRow2_1_2_4_5242(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_5_5242(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), value.rouble, $0.0, value.scaledRouble, 0.0);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные обязательства", reportWidth, true);
        printDescriptionRow(" перед юридическими лицами-", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" нерезидентами в валюте", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Российской Федерации", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (по данным граф", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" \"в рублях\" строки 1.2.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Долгосрочные обязательства ",
                                                            " перед юридическими лицами-",
                                                            " нерезидентами в валюте ",
                                                            " Российской Федерации ",
                                                            " (по данным граф ",
                                                            " \\\"в рублях\\\" строки 1.2.4)(2)"), reportWidth, true);
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.2.5.Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным граф ~^в рублях~^ строки 1.2.4)", value);
        else
            exportSingleValueRow("1.2.5.Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте РФ(по данным строки 1.2.4 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_2_5_5242(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.5";
    end;

    constructorTApplicationRow2_1_2_5_5242(applicationName, xlsView);
end;

class (TApplicationRow2_5036) TApplicationRow2_1_2_6_5242(applicationName : String, xlsView)
    macro saveAttributes()
        var value : Object = null;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            var iterator = getAttributeValueIterator(m_applicationName, NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2.4");
            value = calculateArithmeticalMean(iterator);
            saveAttributeValue("", "", Date(0,0,0), $0.0, value.currency, 0.0, value.scaledCurrency);
        end;
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRow(iterator, " Долгосрочные обязательства", reportWidth, false);
        printDescriptionRow(" перед юридическими лицами-", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" нерезидентами в иностранной", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте (по данным граф \"в", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" иностранной валюте в рублевом", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" эквиваленте\" строки 1.2.4)(2)", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    macro printExcel(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        var iterator = getValueIterator(NULL, null, null);
        iterator.setSortOrder(SORTER_FOR_DATE);
        printSingleValueRowExcel(iterator, RcbArray().initialize(" Долгосрочные обязательства ",
                                                            " перед юридическими лицами-",
                                                            " нерезидентами в иностранной ",
                                                            " валюте (по данным граф \\\"в ",
                                                            " иностранной валюте в рублевом",
                                                            " эквиваленте\\\" строки 1.2.4)(2)"), reportWidth, false);
    end;

    macro exportToKliko()
        var iterator : Object = getValueIterator();
        var value    : String = "0";

        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        if (global.reportingPeriodIsVror == false)
            exportSingleValueRow("1.2.6.Долгосрочные обязательства перед юридическими лицами-нерезидентами в ин. валюте(по данным граф ~^в валюте~^ строки 1.2.4)", value);
        else
            exportSingleValueRow("1.2.6.Долгосрочные обязательства перед юридическими лицами-нерезидентами в иностранной валюте (по данным строки 1.2.4 граф в рублях)", value);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdConvertColumnKindExporter("OR2_4", this, "R").export();
    end;

    private macro constructorTApplicationRow2_1_2_6_5242(applicationName : String, xlsView)
        initTApplicationRow2_5036(applicationName, xlsView);

        m_code = "1.2.6";
    end;

    constructorTApplicationRow2_1_2_6_5242(applicationName, xlsView);
end;
