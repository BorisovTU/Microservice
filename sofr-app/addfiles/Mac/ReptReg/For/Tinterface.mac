/*
$Name:          Tinterface.mac
$Module:        Регламентируемая отчетность
$Description:   ФОР. Интерфейс операций
*/

/**
 *  Общебанковские интеры и модули
 */

/**
 *  Интеры и модели подсистемы
 */
import "import.mac";

/**
 *  Запуск операции расчета отчета
 */
macro executeControlInputData()

    const DESCRIPTION_LABEL = "-desc:";

    var descriptionLabelIndex = index(cmdArgs, DESCRIPTION_LABEL);

    if (descriptionLabelIndex == 0)
        return;
    end;

    var appNumber = substr(cmdArgs, descriptionLabelIndex + strlen(DESCRIPTION_LABEL));


    if (rcbApplication().currentReport.context.period.endDate >= RCB_I5036_DATE)
        TBeginDataControllerI5036(appNumber).execute();
    elif (rcbApplication().currentReport.context.period.endDate >= RCB_I4217_DATE)
        TBeginDataControllerI4217(appNumber).execute();
    elif (rcbApplication().currentReport.context.period.endDate >= RCB_I2963_DATE)
        TBeginDataControllerI2963(appNumber).execute();
    else
        TBeginDataController(appNumber).execute();
    end;
end;

/**
 *  Запуск операции экспорта в Kliko.exe
 */
macro executeKlikoExportOperation()
    //запоминаем первоначальное значение флага Внеочередного Регулирования Обязательных Резевров
    var temp = global.reportingPeriodIsVror;

    //принудительно устанавливаем тип периода, выбранный пользователем
    global.reportingPeriodIsVror = false;
    global.klikoExportFile.execute();

    //возвращаем первоначальное значение флагу ВРОР
    global.reportingPeriodIsVror = temp;

    установитьФлагВозврата(OK_MACRO_FLAG);
    exit(1);
end;

/**
 *  Запуск операции экспорта в Kliko.exe при ВРОР
 */
macro executeKlikoExportOperationVror()
    //запоминаем первоначальное значение флага Внеочередного Регулирования Обязательных Резевров
    var temp = global.reportingPeriodIsVror;

    //принудительно устанавливаем тип периода, выбранный пользователем
    global.reportingPeriodIsVror = true;
    global.klikoExportFile.execute();

    //возвращаем первоначальное значение флагу ВРОР
    global.reportingPeriodIsVror = temp;

    установитьФлагВозврата(OK_MACRO_FLAG);
    exit(1);
end;

/**
 *  Запуск операции экспорта в ПТК ПСД
 */
macro executePtkPsdExportOperation()
    global.ptkPsdExportFile.execute();

    установитьФлагВозврата(OK_MACRO_FLAG);
    exit(1);
end;

/**
 *  Запуск операции экспорта в БИСквит
 */
macro executeBiscuitExportOperation()
    const DESCRIPTION_LABEL = "-desc:";

    var descriptionLabelIndex = index(cmdArgs, DESCRIPTION_LABEL);

    if (descriptionLabelIndex == 0)
        return;
    end;

    var operation = substr(cmdArgs, descriptionLabelIndex + strlen(DESCRIPTION_LABEL));

	var controller = getForBiscuitExportControllers().getController(operation);
	if (controller != null)
		controller.execute();
	else
		return;
	end;

    установитьФлагВозврата(OK_MACRO_FLAG);
    exit(1);
end;

macro normalize()
    if (ValType(global.form) != V_UNDEF)
        global.form.normalize();
    end;
    установитьФлагВозврата( OK_MACRO_FLAG);
    exit(1);
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
