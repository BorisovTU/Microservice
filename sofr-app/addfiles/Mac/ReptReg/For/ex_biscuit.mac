/*
$Name:          ex_biscuit.mac
$Module:        Регламентируемая отчетность
$Description:   Форма ФОР. Выгрузка в БИСквит
*/

import rcbimport;
import rsexts;

//класс справочника в формате Excel
class TCatalog(sheetName)
    private var EXCEL_ws = NULL;            // EXCEL worksheet
    private var l_ob;                       // объект Excel.Application
    private var startAX;
    private var exlname  = "";
    private var l_wb;                       // EXCEL WorkBook
    private var m_sheetName;

    /* Преобразовать путь в полный */
    macro _processPath(p_path, path)
        var l_str;
        var l_path;
        var l_p;

        p_path = trim(p_path);

        if (substr(p_path, 1, 2 ) == "..") /* ссылка на вышестоящий каталог */
            p_path = substr(p_path, 3);
            l_str  = path;
            l_path = "";
            l_p    = strbrk(l_str, "\\");

            while (l_p != 0)
                l_path = l_path + substr(l_str, 1, l_p - 1) + "\\";
                l_str  = substr(l_str, l_p + 1);
                l_p    = strbrk(l_str, "\\");
            end;

            return (substr(l_path, 1, strlen(l_path) - 1) + p_path);
        elif (substr(p_path, 1, 1) == ".") /* ссылка на текущий каталог */
            return (path + substr(p_path, 2));
        end;

        return path + "\\" + p_path;
    end;

    /*
          Открытие шаблона отчета в EXCEL
           p_name: Opt: полный путь к файлу шаблона
    */
    macro ee_EXCEL_template_init(p_excel_ob, p_name)
        l_wb               = p_excel_ob.Workbooks.Add(p_name);
        EXCEL_ws           = l_wb.Sheets(m_sheetName);
//        p_excel_ob.Visible = false;
    end;

    macro setOutputFile()
        var path = "";

        path = GetCurDir(false);

        //ищем файл шаблона
        var pathXls = FindPath(exlname, NULL, "xls");

        if (pathXls == "" )
            msgbox("Не найден файл EXCEL " + exlname + " в каталоге макрофайлов на сервере приложений.");
            Exit(1);
        end;

        if (isStandAlone())
            l_ob = ActiveX("Excel.Application", NULL, TRUE);
            path = _processPath(pathXls, path);
        else
            if (startAX == null)
                startAX = CreateObject("rsax", "TRsAxServer", "ReportAxServer", isStandalone());
            end;
            l_ob = startAX.CreateComObject("Excel.Application");

            if(not copyFile(pathXls, "$" + exlname))
                msgbox("Невозможно открыть файл EXCEL ", exlname, ".");
                return;
            end;

            GetFileInfo("$" + exlname, null, null, null, path);

            if (strBrk(path, "$") == 1)
                path = subStr(path, 2);
            end;
        end;

        ee_EXCEL_template_init(l_ob, path);
    end;

    /*
      Код колонки EXCEL по номеру
       p_idx: Req: номер колонки (нумерация с 1)
    */
    macro ee_cl_code(p_idx)
        var l_s;
        var s;

        p_idx = p_idx - 1; /* 0 == "A" */
        if (p_idx <= 25)
            return strfor(codefor("A") + p_idx);
        end;
        l_s = ee_cl_code(p_idx / 26 - 1);
        l_s = l_s + ee_cl_code(p_idx - (p_idx / 26) * 26);

        return s;
    end;

    /*
       Код ячейки таблицы в EXCEL - для вызова EXCEL-процедур
        p_cl: Req: номер колонки
        p_ln: Req: номер строки
    */
    macro ee_cell_code(p_cl, p_ln)
        return string(ee_cl_code(p_cl), p_ln);
    end;

    macro getSortNumber(code)
        var cell;
//        l_wb.Sheets(m_sheetName).Select;
//        cell = l_wb.Sheets(m_sheetName).Columns("A:A").Find(code);
        cell = EXCEL_ws.Columns("A:A").Find(code);

        if (cell != null)
            return EXCEL_ws.Range(ee_cell_code(2, cell.row)).FormulaR1C1;
        else
            return "99999";
        end;
    end;

    private macro destructor()
        l_wb.Close();
    end;

    private macro constructorTCatalog(sheetName)
        m_sheetName = sheetName;
        exlname = "Лист в БТ_GAP-130_ФОР_1.xls";
        setOutputFile();
    end;

    constructorTCatalog(sheetName);
end;

class (RcbReportBase) fForRcbReport()
    initRcbReportBase(RcbApplication().currentReport);

    macro initialize()
    end;
end;

macro getFormatDate(_date : String)
    var d, m, y;
    var yyyymmdd;

    if (not StrIsNumber(SubStr(_date, 1, 1)))
        _date = "0" + SubStr(_date, 2);
    end;

    DateSplit(Date(_date), d, m, y);
    yyyymmdd = String(y) + "." + ternary(StrLen(String(m)) == 1, "0" + String(m), String(m)) + "." + ternary(StrLen(String(d)) == 1, "0" + String(d), String(d));

    return yyyymmdd;
end;

/**
 * Экспорт в БИСквит приложений 2-6
 */
class (RcbBiscuitExportController) TFForBisExportController_2_6(dimention)
    private var m_dimention;
    private var m_catalog;
    private var m_metaInf;

    macro insert_app2_row31(accounts)
        var query =  "INSERT INTO dffor_tmp                                                                                                                                           "
            + "\n" + "(                                                                                                                                                               "
            + "\n" + " t_applicationName,                                                                                                                                             "
            + "\n" + " t_backOffice,                                                                                                                                                  "
            + "\n" + " t_row,                                                                                                                                                         "
            + "\n" + " t_balance,                                                                                                                                                     "
            + "\n" + " t_date,                                                                                                                                                        "
            + "\n" + " t_rest,                                                                                                                                                        "
            + "\n" + " t_scaledRest,                                                                                                                                                  "
            + "\n" + " t_isCurrency,                                                                                                                                                  "
            + "\n" + " t_balanceGroup                                                                                                                                                 "
            + "\n" + ")                                                                                                                                                               "
            + "\n" + "SELECT t_applicationName t_applicationName,                                                                                                                     "
            + "\n" + "       t_backOffice t_backOffice,                                                                                                                               "
            + "\n" + "       t_rowCode t_rowCode,                                                                                                                                     "
            + "\n" + "       t_balance,                                                                                                                                               "
            + "\n" + "       t_date t_date,                                                                                                                                           "
            + "\n" + "       sum(t_rest) t_rest,                                                                                                                                      "
            + "\n" + "       sum(t_scaledRest) t_scaledRest,                                                                                                                          "
            + "\n" + "       t_isCurrency t_isCurrency,                                                                                                                               "
            + "\n" + "       t_balanceGroup t_balanceGroup                                                                                                                            "
            + "\n" + "  FROM (SELECT /*+ UNNEST*/                                                                                                                                     "
            + "\n" + "       'Приложение2' t_applicationName,                                                                                                                         "
            + "\n" + "       1 t_backOffice,                                                                                                                                          "
            + "\n" + "       '3.1' t_rowCode,                                                                                                                                         "
            + "\n" + "       t_balance t_balance,                                                                                                                                     "
            + "\n" + "       t_date,                                                                                                                                                  "
            + "\n" + "       SUM(NVL(t_rest, 0)) t_rest,                                                                                                                              "
            + "\n" + "       ROUND(SUM(NVL(t_rest, 0)) / 1000.0000) t_scaledRest,                                                                                                     "
            + "\n" + "       NVL(t_isCurrency, CHR(0)) t_isCurrency,                                                                                                                  "
            + "\n" + "       'расшифровка' t_balanceGroup                                                                                                                             "
            + "\n" + "  FROM (SELECT t_balance,                                                                                                                                       "
            + "\n" + "               t_date,                                                                                                                                          "
            + "\n" + "               t_rest*t_rate AS t_rest,                                                                                                                         "
            + "\n" + "               t_isCurrency                                                                                                                                     "
            + "\n" + "          FROM (SELECT account.*,                                                                                                                               "
            + "\n" + "       frd.t_date,                                                                                                                                              "
            + "\n" + "       CASE frd.t_isWorkDay                                                                                                                                     "
            + "\n" + "           WHEN 'X' THEN 1.0                                                                                                                                    "
            + "\n" + "           ELSE frd.t_rate                                                                                                                                      "
            + "\n" + "       END t_rate,                                                                                                                                              "
            + "\n" + "       DECODE(account.t_kind_account, 'П', 1, -1) * NVL((SELECT repRestHist.t_rest                                                                              "
            + "\n" + "                                                           FROM drepRestHist_tmp repRestHist                                                                    "
            + "\n" + "                                                          WHERE repRestHist.t_accountId = account.t_accountId                                                   "
            + "\n" + "                                                            AND (  (    repRestHist.t_restCurrency  = account.t_fiId                                            "
            + "\n" + "                                                                    AND frd.t_isWorkDay != 'X'                                                                  "
            + "\n" + "                                                                   )                                                                                            "
            + "\n" + "                                                                 OR                                                                                             "
            + "\n" + "                                                                   (    repRestHist.t_restCurrency  = 0                                                         "
            + "\n" + "                                                                    AND frd.t_isWorkDay = 'X'                                                                   "
            + "\n" + "                                                                   )                                                                                            "
            + "\n" + "                                                                )                                                                                               "
            + "\n" + "                                                            AND repRestHist.t_restDate IN (SELECT MAX(rd.t_restDate)                                            "
            + "\n" + "                                                                                             FROM drepRestHist_tmp rd                                           "
            + "\n" + "                                                                                            WHERE rd.t_accountId = account.t_accountId                          "
            + "\n" + "                                                                                              AND (  (    rd.t_restCurrency  = account.t_fiId                   "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay != 'X'                                "
            + "\n" + "                                                                                                     )                                                          "
            + "\n" + "                                                                                                   OR                                                           "
            + "\n" + "                                                                                                     (    rd.t_restCurrency  = 0                                "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay = 'X'                                 "
            + "\n" + "                                                                                                     )                                                          "
            + "\n" + "                                                                                                  )                                                             "
            + "\n" + "                                                                                              AND rd.t_restDate <= (SELECT workDays.t_prevWorkDay               "
            + "\n" + "                                                                                                                      FROM dfforDates_tmp workDays              "
            + "\n" + "                                                                                                                     WHERE workDays.t_date = frd.t_date         "
            + "\n" + "                                                                                                                   )                                            "
            + "\n" + "                                                                                          )                                                                     "
            + "\n" + "                                                        ),  0) t_rest                                                                                           "
            + "\n" + "  FROM (SELECT account.*                                                                                                                                        "
            + "\n" + "          FROM (SELECT ac.*,                                                                                                                                    "
            + "\n" + "                       TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account AS t_accountObjectId,                                   "
            + "\n" + "                       NVL((SELECT TO_NUMBER(linkedObjects.t_id)                                                                                                "
            + "\n" + "                              FROM drepLinkedObjects_vw linkedObjects                                                                                           "
            + "\n" + "                             WHERE linkedObjects.t_connectObjectId = TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account           "
            + "\n" + "                               AND linkedObjects.t_connectObjectType = rep_const.get().cb.objectTypes.account                                                   "
            + "\n" + "                               AND linkedObjects.t_type = rep_const.get().cb.objectTypes.party                                                                  "
            + "\n" + "                               AND linkedObjects.t_role = rep_const.get().cb.objectRoles.party.operationContragent                                              "
            + "\n" + "                               AND linkedObjects.t_isInstalledForEndDate = 1), t_clientCode)                                                                    "
            + "\n" + "                       AS t_contractorId                                                                                                                        "
            + "\n" + "                  FROM dfforaccount_tmp ac) account                                                                                                             "
            + "\n" + "         WHERE  account.t_balance IN (" + StrAssemble(accounts, ",") + ")                                                                                                          "
            + "\n" + "           AND rowNum > 0 --Делаем так для того, чтобы сначла был наложен фильтр на л/с и только потом джойн с датами                                           "
            + "\n" + "           AND 1 = 1) account,                                                                                                                                  "
            + "\n" + "       dfforRateDates_tmp frd                                                                                                                                   "
            + "\n" + " WHERE account.t_fiId = frd.t_fiId                                                                                                                              "
            + "\n" + "   AND  1=1 ) account                                                                                                                                           "
            + "\n" + "         UNION ALL                                                                                                                                              "
            + "\n" + "        SELECT t_balance,                                                                                                                                       "
            + "\n" + "               t_date,                                                                                                                                          "
            + "\n" + "               0 t_rest,                                                                                                                                        "
            + "\n" + "               cur.t_isCurrency                                                                                                                                 "
            + "\n" + "          FROM dbalance_dbt,                                                                                                                                    "
            + "\n" + "               dffordates_tmp,                                                                                                                                  "
            + "\n" + "               (SELECT 'X' t_isCurrency FROM DUAL                                                                                                               "
            + "\n" + "                 UNION ALL                                                                                                                                      "
            + "\n" + "                SELECT CHR(0) t_isCurrency FROM DUAL                                                                                                            "
            + "\n" + "               ) cur                                                                                                                                            "
            + "\n" + "         WHERE 1 = 1                                                                                                                                            "
            + "\n" + "           AND t_chapter = 1                                                                                                                                    "
            + "\n" + "           AND t_balance IN (" + StrAssemble(accounts, ",") + ")                                                                                                                   "
            + "\n" + "       ) account                                                                                                                                                "
            + "\n" + " GROUP BY t_balance,                                                                                                                                            "
            + "\n" + "          t_date,                                                                                                                                               "
            + "\n" + "          t_isCurrency)                                                                                                                                         "
            + "\n" + " WHERE t_balance IN (" + StrAssemble(accounts, ",") + ")                                                                                                        "
            + "\n" + " GROUP BY t_applicationName,t_backOffice,t_rowCode,t_balance,t_date,t_isCurrency,t_balanceGroup                                                                 "
            ;

        sql_execute(query);
    end;

    macro insert_app2_row312()
        var query =  "INSERT INTO dffor_tmp                                                                                                                                           "
            + "\n" + "(                                                                                                                                                                           "
            + "\n" + " t_applicationName,                                                                                                                                                         "
            + "\n" + " t_backOffice,                                                                                                                                                              "
            + "\n" + " t_row,                                                                                                                                                                     "
            + "\n" + " t_balance,                                                                                                                                                                 "
            + "\n" + " t_date,                                                                                                                                                                    "
            + "\n" + " t_rest,                                                                                                                                                                    "
            + "\n" + " t_scaledRest,                                                                                                                                                              "
            + "\n" + " t_isCurrency,                                                                                                                                                              "
            + "\n" + " t_balanceGroup                                                                                                                                                             "
            + "\n" + ")                                                                                                                                                                           "
            + "\n" + "SELECT t_applicationName,                                                                                                                                                 "
            + "\n" + "       t_backOffice,                                                                                                                                                        "
            + "\n" + "       t_rowCode,                                                                                                                                                           "
            + "\n" + "       t_balance,                                                                                                                                                           "
            + "\n" + "       t_date,                                                                                                                                                              "
            + "\n" + "       SUM(t_rest),                                                                                                                                                         "
            + "\n" + "       SUM(t_scaledRest),                                                                                                                                                   "
            + "\n" + "       t_isCurrency,                                                                                                                                                        "
            + "\n" + "       t_balanceGroup                                                                                                                                                       "
            + "\n" + "  FROM (                                                                                                                                                                    "
            + "\n" + "SELECT t_applicationName    t_applicationName,                                                                                                                              "
            + "\n" + "       t_backOffice         t_backOffice,                                                                                                                                   "
            + "\n" + "       t_rowCode            t_rowCode,                                                                                                                                      "
            + "\n" + "       t_balance            t_balance,                                                                                                                                      "
            + "\n" + "       t_date               t_date,                                                                                                                                         "
            + "\n" + "       MIN(t_rest)          t_rest,                                                                                                                                         "
            + "\n" + "       MIN(t_scaledRest)    t_scaledRest,                                                                                                                                   "
            + "\n" + "       t_isCurrency         t_isCurrency,                                                                                                                                   "
            + "\n" + "       t_balanceGroup       t_balanceGroup                                                                                                                                  "
            + "\n" + "  FROM (SELECT /*+ UNNEST*/                                                                                                                                                 "
            + "\n" + "       'Приложение2' t_applicationName,                                                                                                                                     "
            + "\n" + "       1 t_backOffice,                                                                                                                                                      "
            + "\n" + "       '3.1.2' t_rowCode,                                                                                                                                                   "
            + "\n" + "       /*'409011'*/ t_balance,                                                                                                                                              "
            + "\n" + "       t_date,                                                                                                                                                              "
            + "\n" + "       SUM(NVL(t_rest, 0)) t_rest,                                                                                                                                          "
            + "\n" + "       ROUND(SUM(NVL(t_rest, 0)) / 1000.0000) t_scaledRest,                                                                                                                 "
            + "\n" + "       NVL(t_isCurrency, CHR(0)) t_isCurrency,                                                                                                                              "
            + "\n" + "       'расшифровка' t_balanceGroup                                                                                                                                         "
            + "\n" + "  FROM (SELECT t_balance,                                                                                                                                                   "
            + "\n" + "               t_date,                                                                                                                                                      "
            + "\n" + "               t_rest*t_rate AS t_rest,                                                                                                                                     "
            + "\n" + "               t_isCurrency                                                                                                                                                 "
            + "\n" + "          FROM (SELECT account.*,                                                                                                                                           "
            + "\n" + "       frd.t_date,                                                                                                                                                          "
            + "\n" + "       CASE frd.t_isWorkDay                                                                                                                                                 "
            + "\n" + "           WHEN 'X' THEN 1.0                                                                                                                                                "
            + "\n" + "           ELSE frd.t_rate                                                                                                                                                  "
            + "\n" + "       END t_rate,                                                                                                                                                          "
            + "\n" + "       DECODE(account.t_kind_account, 'П', 1, -1) * NVL((SELECT repRestHist.t_rest                                                                                          "
            + "\n" + "                                                           FROM drepRestHist_tmp repRestHist                                                                                "
            + "\n" + "                                                          WHERE repRestHist.t_accountId = account.t_accountId                                                               "
            + "\n" + "                                                            AND (  (    repRestHist.t_restCurrency  = account.t_fiId                                                        "
            + "\n" + "                                                                    AND frd.t_isWorkDay != 'X'                                                                              "
            + "\n" + "                                                                   )                                                                                                        "
            + "\n" + "                                                                 OR                                                                                                         "
            + "\n" + "                                                                   (    repRestHist.t_restCurrency  = 0                                                                     "
            + "\n" + "                                                                    AND frd.t_isWorkDay = 'X'                                                                               "
            + "\n" + "                                                                   )                                                                                                        "
            + "\n" + "                                                                )                                                                                                           "
            + "\n" + "                                                            AND repRestHist.t_restDate IN (SELECT MAX(rd.t_restDate)                                                        "
            + "\n" + "                                                                                             FROM drepRestHist_tmp rd                                                       "
            + "\n" + "                                                                                            WHERE rd.t_accountId = account.t_accountId                                      "
            + "\n" + "                                                                                              AND (  (    rd.t_restCurrency  = account.t_fiId                               "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay != 'X'                                            "
            + "\n" + "                                                                                                     )                                                                      "
            + "\n" + "                                                                                                   OR                                                                       "
            + "\n" + "                                                                                                     (    rd.t_restCurrency  = 0                                            "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay = 'X'                                             "
            + "\n" + "                                                                                                     )                                                                      "
            + "\n" + "                                                                                                  )                                                                         "
            + "\n" + "                                                                                              AND rd.t_restDate <= (SELECT workDays.t_prevWorkDay                           "
            + "\n" + "                                                                                                                      FROM dfforDates_tmp workDays                          "
            + "\n" + "                                                                                                                     WHERE workDays.t_date = frd.t_date                     "
            + "\n" + "                                                                                                                   )                                                        "
            + "\n" + "                                                                                          )                                                                                 "
            + "\n" + "                                                        ),  0) t_rest                                                                                                       "
            + "\n" + "  FROM (SELECT account.*                                                                                                                                                    "
            + "\n" + "          FROM (SELECT ac.*,                                                                                                                                                "
            + "\n" + "                       TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account AS t_accountObjectId,                                               "
            + "\n" + "                       NVL((SELECT TO_NUMBER(linkedObjects.t_id)                                                                                                            "
            + "\n" + "                              FROM drepLinkedObjects_vw linkedObjects                                                                                                       "
            + "\n" + "                             WHERE linkedObjects.t_connectObjectId = TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account                       "
            + "\n" + "                               AND linkedObjects.t_connectObjectType = rep_const.get().cb.objectTypes.account                                                               "
            + "\n" + "                               AND linkedObjects.t_type = rep_const.get().cb.objectTypes.party                                                                              "
            + "\n" + "                               AND linkedObjects.t_role = rep_const.get().cb.objectRoles.party.operationContragent                                                          "
            + "\n" + "                               AND linkedObjects.t_isInstalledForEndDate = 1), t_clientCode)                                                                                "
            + "\n" + "                       AS t_contractorId                                                                                                                                    "
            + "\n" + "                  FROM dfforaccount_tmp ac) account                                                                                                                         "
            + "\n" + "         WHERE  account.t_balance IN ('40901')                                                                                                                              "
            + "\n" + "           AND rowNum > 0 --Делаем так для того, чтобы сначла был наложен фильтр на л/с и только потом джойн с датами                                                       "
            + "\n" + "           AND 1 = 1) account,                                                                                                                                              "
            + "\n" + "       dfforRateDates_tmp frd                                                                                                                                               "
            + "\n" + " WHERE account.t_fiId = frd.t_fiId                                                                                                                                          "
            + "\n" + "   AND  EXISTS (SELECT 1                                                                                                                                                    "
            + "\n" + "          FROM dobjatcor_dbt atc                                                                                                                                            "
            + "\n" + "         WHERE atc.t_ObjectType = 4                                                                                                                                         "
            + "\n" + "           AND atc.t_GroupID    = 2                                                                                                                                         "
            + "\n" + "           AND atc.t_Object     = account.t_accountObjectId                                                                                                                 "
            + "\n" + "           AND atc.t_AttrID = ANY (SELECT att.t_AttrID                                                                                                                      "
            + "\n" + "                                     FROM dobjattr_dbt att                                                                                                                  "
            + "\n" + "                                    WHERE att.t_ObjectType = 4                                                                                                              "
            + "\n" + "                                      AND att.t_GroupID    = 2                                                                                                              "
            + "\n" + "                                      AND att.t_codeList = CHR(1)                                                                                                           "
            + "\n" + "                                      AND att.t_numInList = ANY('ПА')                                                                                                       "
            + "\n" + "                                  )                                                                                                                                         "
            + "\n" + "           AND frd.t_date BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate                                                                                                 "
            + "\n" + "       )) account                                                                                                                                                           "
            + "\n" + "         UNION ALL                                                                                                                                                          "
            + "\n" + "        SELECT t_balance,                                                                                                                                                   "
            + "\n" + "               t_date,                                                                                                                                                      "
            + "\n" + "               0 t_rest,                                                                                                                                                    "
            + "\n" + "               cur.t_isCurrency                                                                                                                                             "
            + "\n" + "          FROM dbalance_dbt,                                                                                                                                                "
            + "\n" + "               dffordates_tmp,                                                                                                                                              "
            + "\n" + "               (SELECT 'X' t_isCurrency FROM DUAL                                                                                                                           "
            + "\n" + "                 UNION ALL                                                                                                                                                  "
            + "\n" + "                SELECT CHR(0) t_isCurrency FROM DUAL                                                                                                                        "
            + "\n" + "               ) cur                                                                                                                                                        "
            + "\n" + "         WHERE 1=1                                                                                                                                                          "
            + "\n" + "           AND t_chapter = 1                                                                                                                                                "
            + "\n" + "           AND t_balance IN ('40901')                                                                                                                                       "
            + "\n" + "       ) account                                                                                                                                                            "
            + "\n" + " GROUP BY t_balance,                                                                                                                                                        "
            + "\n" + "          t_date,                                                                                                                                                           "
            + "\n" + "          t_isCurrency                                                                                                                                                      "
            + "\n" + "         UNION                                                                                                                                                              "
            + "\n" + "        SELECT /*+ UNNEST*/                                                                                                                                                 "
            + "\n" + "       'Приложение2' t_applicationName,                                                                                                                                     "
            + "\n" + "       1 t_backOffice,                                                                                                                                                      "
            + "\n" + "       '3.1.2' t_rowCode,                                                                                                                                                   "
            + "\n" + "       /*'409011'*/ t_balance,                                                                                                                                              "
            + "\n" + "       t_date,                                                                                                                                                              "
            + "\n" + "       SUM(NVL(t_rest, 0)) t_rest,                                                                                                                                          "
            + "\n" + "       ROUND(SUM(NVL(t_rest, 0)) / 1000.0000) t_scaledRest,                                                                                                                 "
            + "\n" + "       NVL(t_isCurrency, CHR(0)) t_isCurrency,                                                                                                                              "
            + "\n" + "       'расшифровка' t_balanceGroup                                                                                                                                         "
            + "\n" + "  FROM (SELECT t_balance,                                                                                                                                                   "
            + "\n" + "               t_date,                                                                                                                                                      "
            + "\n" + "               t_rest*t_rate AS t_rest,                                                                                                                                     "
            + "\n" + "               t_isCurrency                                                                                                                                                 "
            + "\n" + "          FROM (SELECT account.*,                                                                                                                                           "
            + "\n" + "       frd.t_date,                                                                                                                                                          "
            + "\n" + "       CASE frd.t_isWorkDay                                                                                                                                                 "
            + "\n" + "           WHEN 'X' THEN 1.0                                                                                                                                                "
            + "\n" + "           ELSE frd.t_rate                                                                                                                                                  "
            + "\n" + "       END t_rate,                                                                                                                                                          "
            + "\n" + "       DECODE(account.t_kind_account, 'П', 1, -1) * NVL((SELECT repRestHist.t_rest                                                                                          "
            + "\n" + "                                                           FROM drepRestHist_tmp repRestHist                                                                                "
            + "\n" + "                                                          WHERE repRestHist.t_accountId = account.t_accountId                                                               "
            + "\n" + "                                                            AND (  (    repRestHist.t_restCurrency  = account.t_fiId                                                        "
            + "\n" + "                                                                    AND frd.t_isWorkDay != 'X'                                                                              "
            + "\n" + "                                                                   )                                                                                                        "
            + "\n" + "                                                                 OR                                                                                                         "
            + "\n" + "                                                                   (    repRestHist.t_restCurrency  = 0                                                                     "
            + "\n" + "                                                                    AND frd.t_isWorkDay = 'X'                                                                               "
            + "\n" + "                                                                   )                                                                                                        "
            + "\n" + "                                                                )                                                                                                           "
            + "\n" + "                                                            AND repRestHist.t_restDate IN (SELECT MAX(rd.t_restDate)                                                        "
            + "\n" + "                                                                                             FROM drepRestHist_tmp rd                                                       "
            + "\n" + "                                                                                            WHERE rd.t_accountId = account.t_accountId                                      "
            + "\n" + "                                                                                              AND (  (    rd.t_restCurrency  = account.t_fiId                               "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay != 'X'                                            "
            + "\n" + "                                                                                                     )                                                                      "
            + "\n" + "                                                                                                   OR                                                                       "
            + "\n" + "                                                                                                     (    rd.t_restCurrency  = 0                                            "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay = 'X'                                             "
            + "\n" + "                                                                                                     )                                                                      "
            + "\n" + "                                                                                                  )                                                                         "
            + "\n" + "                                                                                              AND rd.t_restDate <= (SELECT workDays.t_prevWorkDay                           "
            + "\n" + "                                                                                                                      FROM dfforDates_tmp workDays                          "
            + "\n" + "                                                                                                                     WHERE workDays.t_date = frd.t_date                     "
            + "\n" + "                                                                                                                   )                                                        "
            + "\n" + "                                                                                          )                                                                                 "
            + "\n" + "                                                        ),  0) t_rest                                                                                                       "
            + "\n" + "  FROM (SELECT account.*                                                                                                                                                    "
            + "\n" + "          FROM (SELECT ac.*,                                                                                                                                                "
            + "\n" + "                       TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account AS t_accountObjectId,                                               "
            + "\n" + "                       NVL((SELECT TO_NUMBER(linkedObjects.t_id)                                                                                                            "
            + "\n" + "                              FROM drepLinkedObjects_vw linkedObjects                                                                                                       "
            + "\n" + "                             WHERE linkedObjects.t_connectObjectId = TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account                       "
            + "\n" + "                               AND linkedObjects.t_connectObjectType = rep_const.get().cb.objectTypes.account                                                               "
            + "\n" + "                               AND linkedObjects.t_type = rep_const.get().cb.objectTypes.party                                                                              "
            + "\n" + "                               AND linkedObjects.t_role = rep_const.get().cb.objectRoles.party.operationContragent                                                          "
            + "\n" + "                               AND linkedObjects.t_isInstalledForEndDate = 1), t_clientCode)                                                                                "
            + "\n" + "                       AS t_contractorId                                                                                                                                    "
            + "\n" + "                  FROM dfforaccount_tmp ac) account                                                                                                                         "
            + "\n" + "         WHERE  account.t_balance IN ('47431')                                                                                                                              "
            + "\n" + "           AND rowNum > 0 --Делаем так для того, чтобы сначла был наложен фильтр на л/с и только потом джойн с датами                                                       "
            + "\n" + "           AND 1 = 1) account,                                                                                                                                              "
            + "\n" + "       dfforRateDates_tmp frd                                                                                                                                               "
            + "\n" + " WHERE account.t_fiId = frd.t_fiId                                                                                                                                          "
            + "\n" + "   AND  EXISTS(SELECT 1                                                                                                                                                     "
            + "\n" + "         FROM dobjatcor_dbt atc                                                                                                                                             "
            + "\n" + "        WHERE atc.t_ObjectType = 4                                                                                                                                          "
            + "\n" + "          AND atc.t_GroupID    = 2                                                                                                                                          "
            + "\n" + "          AND atc.t_Object     = account.t_accountObjectId                                                                                                                  "
            + "\n" + "          AND atc.t_AttrID = (SELECT att.t_AttrID                                                                                                                           "
            + "\n" + "                                FROM dobjattr_dbt att                                                                                                                       "
            + "\n" + "                               WHERE att.t_ObjectType = 4                                                                                                                   "
            + "\n" + "                                 AND att.t_GroupID    = 2                                                                                                                   "
            + "\n" + "                                 AND att.t_codeList = CHR(1)                                                                                                                "
            + "\n" + "                                 AND att.t_numInList  = 'ПА')                                                                                                               "
            + "\n" + "          AND (frd.t_date - 1) BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate)) account                                                                                  "
            + "\n" + "         UNION ALL                                                                                                                                                          "
            + "\n" + "        SELECT t_balance,                                                                                                                                                   "
            + "\n" + "               t_date,                                                                                                                                                      "
            + "\n" + "               0 t_rest,                                                                                                                                                    "
            + "\n" + "               cur.t_isCurrency                                                                                                                                             "
            + "\n" + "          FROM dbalance_dbt,                                                                                                                                                "
            + "\n" + "               dffordates_tmp,                                                                                                                                              "
            + "\n" + "               (SELECT 'X' t_isCurrency FROM DUAL                                                                                                                           "
            + "\n" + "                 UNION ALL                                                                                                                                                  "
            + "\n" + "                SELECT CHR(0) t_isCurrency FROM DUAL                                                                                                                        "
            + "\n" + "               ) cur                                                                                                                                                        "
            + "\n" + "         WHERE 1=1                                                                                                                                                          "
            + "\n" + "           AND t_chapter = 1                                                                                                                                                "
            + "\n" + "           AND t_balance IN ('47431')                                                                                                                                       "
            + "\n" + "       ) account                                                                                                                                                            "
            + "\n" + " GROUP BY t_balance,                                                                                                                                                        "
            + "\n" + "          t_date,                                                                                                                                                           "
            + "\n" + "          t_isCurrency                                                                                                                                                      "
            + "\n" + "       )                                                                                                                                                                    "
            + "\n" + " GROUP BY t_applicationName,                                                                                                                                                "
            + "\n" + "          t_backOffice,                                                                                                                                                     "
            + "\n" + "          t_rowCode,                                                                                                                                                        "
            + "\n" + "          t_balance,                                                                                                                                                        "
            + "\n" + "          t_date,                                                                                                                                                           "
            + "\n" + "          t_isCurrency,                                                                                                                                                     "
            + "\n" + "          t_balanceGroup                                                                                                                                                    "
            + "\n" + ")                                                                                                                                                                           "
            + "\n" + " GROUP BY t_applicationName,                                                                                                                                                "
            + "\n" + "          t_backOffice,                                                                                                                                                     "
            + "\n" + "          t_rowCode,                                                                                                                                                        "
            + "\n" + "          t_balance,                                                                                                                                                        "
            + "\n" + "          t_date,                                                                                                                                                           "
            + "\n" + "          t_isCurrency,                                                                                                                                                     "
            + "\n" + "          t_balanceGroup                                                                                                                                                    "
            ;

        sql_execute(query);
    end;

    macro insert_app2_row322(accounts)
        var query =  "INSERT INTO dffor_tmp                                                                                                                                                                 "
            + "\n" + "(                                                                                                                                                                                       "
            + "\n" + " t_applicationName,                                                                                                                                                                     "
            + "\n" + " t_backOffice,                                                                                                                                                                          "
            + "\n" + " t_row,                                                                                                                                                                                 "
            + "\n" + " t_balance,                                                                                                                                                                             "
            + "\n" + " t_date,                                                                                                                                                                                "
            + "\n" + " t_rest,                                                                                                                                                                                "
            + "\n" + " t_scaledRest,                                                                                                                                                                          "
            + "\n" + " t_isCurrency,                                                                                                                                                                          "
            + "\n" + " t_balanceGroup                                                                                                                                                                         "
            + "\n" + ")                                                                                                                                                                                       "
            + "\n" + "SELECT /*+ UNNEST*/                                                                                                                                                                   "
            + "\n" + "       'Приложение2' t_applicationName,                                                                                                                                                 "
            + "\n" + "       1 t_backOffice,                                                                                                                                                                  "
            + "\n" + "       '3.2.2' t_rowCode,                                                                                                                                                               "
            + "\n" + "       /*'420438(5)'*/ t_balance,                                                                                                                                                       "
            + "\n" + "       t_date,                                                                                                                                                                          "
            + "\n" + "       SUM(NVL(t_rest, 0)) t_rest,                                                                                                                                                      "
            + "\n" + "       ROUND(SUM(NVL(t_rest, 0)) / 1000.0000) t_scaledRest,                                                                                                                             "
            + "\n" + "       NVL(t_isCurrency, CHR(0)) t_isCurrency,                                                                                                                                          "
            + "\n" + "       'расшифровка' t_balanceGroup                                                                                                                                                     "
            + "\n" + "  FROM (SELECT t_balance,                                                                                                                                                               "
            + "\n" + "               t_date,                                                                                                                                                                  "
            + "\n" + "               t_rest*t_rate AS t_rest,                                                                                                                                                 "
            + "\n" + "               t_isCurrency                                                                                                                                                             "
            + "\n" + "          FROM (SELECT account.*,                                                                                                                                                       "
            + "\n" + "       frd.t_date,                                                                                                                                                                      "
            + "\n" + "       CASE frd.t_isWorkDay                                                                                                                                                             "
            + "\n" + "           WHEN 'X' THEN 1.0                                                                                                                                                            "
            + "\n" + "           ELSE frd.t_rate                                                                                                                                                              "
            + "\n" + "       END t_rate,                                                                                                                                                                      "
            + "\n" + "       DECODE(account.t_kind_account, 'П', 1, -1) * NVL((SELECT repRestHist.t_rest                                                                                                      "
            + "\n" + "                                                           FROM drepRestHist_tmp repRestHist                                                                                            "
            + "\n" + "                                                          WHERE repRestHist.t_accountId = account.t_accountId                                                                           "
            + "\n" + "                                                            AND (  (    repRestHist.t_restCurrency  = account.t_fiId                                                                    "
            + "\n" + "                                                                    AND frd.t_isWorkDay != 'X'                                                                                          "
            + "\n" + "                                                                   )                                                                                                                    "
            + "\n" + "                                                                 OR                                                                                                                     "
            + "\n" + "                                                                   (    repRestHist.t_restCurrency  = 0                                                                                 "
            + "\n" + "                                                                    AND frd.t_isWorkDay = 'X'                                                                                           "
            + "\n" + "                                                                   )                                                                                                                    "
            + "\n" + "                                                                )                                                                                                                       "
            + "\n" + "                                                            AND repRestHist.t_restDate IN (SELECT MAX(rd.t_restDate)                                                                    "
            + "\n" + "                                                                                             FROM drepRestHist_tmp rd                                                                   "
            + "\n" + "                                                                                            WHERE rd.t_accountId = account.t_accountId                                                  "
            + "\n" + "                                                                                              AND (  (    rd.t_restCurrency  = account.t_fiId                                           "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay != 'X'                                                        "
            + "\n" + "                                                                                                     )                                                                                  "
            + "\n" + "                                                                                                   OR                                                                                   "
            + "\n" + "                                                                                                     (    rd.t_restCurrency  = 0                                                        "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay = 'X'                                                         "
            + "\n" + "                                                                                                     )                                                                                  "
            + "\n" + "                                                                                                  )                                                                                     "
            + "\n" + "                                                                                              AND rd.t_restDate <= (SELECT workDays.t_prevWorkDay                                       "
            + "\n" + "                                                                                                                      FROM dfforDates_tmp workDays                                      "
            + "\n" + "                                                                                                                     WHERE workDays.t_date = frd.t_date                                 "
            + "\n" + "                                                                                                                   )                                                                    "
            + "\n" + "                                                                                          )                                                                                             "
            + "\n" + "                                                        ),  0) t_rest                                                                                                                   "
            + "\n" + "  FROM (SELECT account.*                                                                                                                                                                "
            + "\n" + "          FROM (SELECT ac.*,                                                                                                                                                            "
            + "\n" + "                       TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account AS t_accountObjectId,                                                           "
            + "\n" + "                       NVL((SELECT TO_NUMBER(linkedObjects.t_id)                                                                                                                        "
            + "\n" + "                              FROM drepLinkedObjects_vw linkedObjects                                                                                                                   "
            + "\n" + "                             WHERE linkedObjects.t_connectObjectId = TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account                                   "
            + "\n" + "                               AND linkedObjects.t_connectObjectType = rep_const.get().cb.objectTypes.account                                                                           "
            + "\n" + "                               AND linkedObjects.t_type = rep_const.get().cb.objectTypes.party                                                                                          "
            + "\n" + "                               AND linkedObjects.t_role = rep_const.get().cb.objectRoles.party.operationContragent                                                                      "
            + "\n" + "                               AND linkedObjects.t_isInstalledForEndDate = 1), t_clientCode)                                                                                            "
            + "\n" + "                       AS t_contractorId                                                                                                                                                "
            + "\n" + "                  FROM dfforaccount_tmp ac) account                                                                                                                                     "
            + "\n" + "         WHERE    (   (    account.t_balance IN ('42006','42106','43706','43806')                                                                                                       "
            + "\n" + "     AND rep_note.readMaturityDate(t_accountObjectId, " + getSqlDate(RcbApplication().currentReport.context.period.endDate) + ") = ADD_MONTHS(rcb_for.dateOpeningAccount(account.t_account, account.t_openDate), 36)        "
            + "\n" + "    )                                                                                                                                                                                   "
            + "\n" + " OR account.t_balance IN ('42007','42107','43707','43807')                                                                                                                              "
            + "\n" + ")                                                                                                                                                                                       "
            + "\n" + "           AND rowNum > 0 --Делаем так для того, чтобы сначла был наложен фильтр на л/с и только потом джойн с датами                                                                   "
            + "\n" + "           AND 1 = 1) account,                                                                                                                                                          "
            + "\n" + "       dfforRateDates_tmp frd                                                                                                                                                           "
            + "\n" + " WHERE account.t_fiId = frd.t_fiId                                                                                                                                                      "
            + "\n" + "   AND  EXISTS (SELECT 1                                                                                                                                                                "
            + "\n" + "          FROM dobjatcor_dbt atc                                                                                                                                                        "
            + "\n" + "         WHERE atc.t_ObjectType = 4                                                                                                                                                     "
            + "\n" + "           AND atc.t_GroupID    = 1                                                                                                                                                     "
            + "\n" + "           AND atc.t_Object     = account.t_accountObjectId                                                                                                                             "
            + "\n" + "           AND atc.t_AttrID = ANY (SELECT att.t_AttrID                                                                                                                                  "
            + "\n" + "                                     FROM dobjattr_dbt att                                                                                                                              "
            + "\n" + "                                    WHERE att.t_ObjectType = 4                                                                                                                          "
            + "\n" + "                                      AND att.t_GroupID    = 1                                                                                                                          "
            + "\n" + "                                      AND att.t_codeList = CHR(1)                                                                                                                       "
            + "\n" + "                                      AND att.t_numInList = ANY('507-П пункт 2.5.6')                                                                                                    "
            + "\n" + "                                  )                                                                                                                                                     "
            + "\n" + "           AND frd.t_date BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate                                                                                                             "
            + "\n" + "       )                                                                                                                                                                                "
            + "\n" + "AND EXISTS (SELECT 1                                                                                                                                                                    "
            + "\n" + "          FROM dobjatcor_dbt atc                                                                                                                                                        "
            + "\n" + "         WHERE atc.t_ObjectType = 4                                                                                                                                                     "
            + "\n" + "           AND atc.t_GroupID    = 1                                                                                                                                                     "
            + "\n" + "           AND atc.t_Object     = account.t_accountObjectId                                                                                                                             "
            + "\n" + "           AND atc.t_AttrID = ANY (SELECT att.t_AttrID                                                                                                                                                     "
            + "\n" + "                                     FROM dobjattr_dbt att                                                                                                                              "
            + "\n" + "                                    WHERE att.t_ObjectType = 4                                                                                                                          "
            + "\n" + "                                      AND att.t_GroupID    = 1                                                                                                                          "
            + "\n" + "                                      AND att.t_codeList = CHR(1)                                                                                                                       "
            + "\n" + "                                      AND att.t_numInList = ANY('507-П пункт 2.5.6')                                                                                                    "
            + "\n" + "                                  )                                                                                                                                                     "
            + "\n" + "           AND frd.t_date BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate                                                                                                             "
            + "\n" + "       )) account                                                                                                                                                                       "
            + "\n" + "         UNION ALL                                                                                                                                                                      "
            + "\n" + "        SELECT t_balance,                                                                                                                                                               "
            + "\n" + "               t_date,                                                                                                                                                                  "
            + "\n" + "               0 t_rest,                                                                                                                                                                "
            + "\n" + "               cur.t_isCurrency                                                                                                                                                         "
            + "\n" + "          FROM dbalance_dbt,                                                                                                                                                            "
            + "\n" + "               dffordates_tmp,                                                                                                                                                          "
            + "\n" + "               (SELECT 'X' t_isCurrency FROM DUAL                                                                                                                                       "
            + "\n" + "                 UNION ALL                                                                                                                                                              "
            + "\n" + "                SELECT CHR(0) t_isCurrency FROM DUAL                                                                                                                                    "
            + "\n" + "               ) cur                                                                                                                                                                                       "
            + "\n" + "         WHERE 1 = 1                                                                                                                                                                    "
            + "\n" + "           AND t_chapter = 1                                                                                                                                                            "
            + "\n" + "           AND t_balance IN (" + StrAssemble(accounts, ",") + ")                                                                                           "
            + "\n" + "       ) account                                                                                                                                                                        "
            + "\n" + " GROUP BY t_balance,                                                                                                                                                                    "
            + "\n" + "          t_date,                                                                                                                                                                       "
            + "\n" + "          t_isCurrency                                                                                                                                                                  "
            ;

        sql_execute(query);
    end;

    macro insert_app2_row322_520053()
        var query =  "INSERT INTO dffor_tmp                                                                                                                                                       "
            + "\n" + "(                                                                                                                                                                            "
            + "\n" + " t_applicationName,                                                                                                                                                          "
            + "\n" + " t_backOffice,                                                                                                                                                               "
            + "\n" + " t_row,                                                                                                                                                                      "
            + "\n" + " t_balance,                                                                                                                                                                  "
            + "\n" + " t_date,                                                                                                                                                                     "
            + "\n" + " t_rest,                                                                                                                                                                     "
            + "\n" + " t_scaledRest,                                                                                                                                                               "
            + "\n" + " t_isCurrency,                                                                                                                                                               "
            + "\n" + " t_balanceGroup                                                                                                                                                              "
            + "\n" + ")                                                                                                                                                                            "
            + "\n" + "SELECT /*+ UNNEST*/                                                                                                                                                          "
            + "\n" + "       'Приложение2' t_applicationName,                                                                                                                                      "
            + "\n" + "       1 t_backOffice,                                                                                                                                                       "
            + "\n" + "       '3.2.2' t_rowCode,                                                                                                                                                    "
            + "\n" + "       '520053' t_balance,                                                                                                                                                   "
            + "\n" + "       t_date,                                                                                                                                                               "
            + "\n" + "       SUM(NVL(t_rest, 0)) t_rest,                                                                                                                                           "
            + "\n" + "       ROUND(SUM(NVL(t_rest, 0)) / 1000.0000) t_scaledRest,                                                                                                                  "
            + "\n" + "       NVL(t_isCurrency, CHR(0)) t_isCurrency,                                                                                                                               "
            + "\n" + "       'расшифровка' t_balanceGroup                                                                                                                                          "
            + "\n" + "  FROM (SELECT t_balance,                                                                                                                                                    "
            + "\n" + "               t_date,                                                                                                                                                       "
            + "\n" + "               t_rest*t_rate AS t_rest,                                                                                                                                      "
            + "\n" + "               t_isCurrency                                                                                                                                                  "
            + "\n" + "          FROM (SELECT account.*,                                                                                                                                            "
            + "\n" + "       frd.t_date,                                                                                                                                                           "
            + "\n" + "       CASE frd.t_isWorkDay                                                                                                                                                  "
            + "\n" + "           WHEN 'X' THEN 1.0                                                                                                                                                 "
            + "\n" + "           ELSE frd.t_rate                                                                                                                                                   "
            + "\n" + "       END t_rate,                                                                                                                                                           "
            + "\n" + "       DECODE(account.t_kind_account, 'П', 1, -1) * NVL((SELECT repRestHist.t_rest                                                                                           "
            + "\n" + "                                                           FROM drepRestHist_tmp repRestHist                                                                                 "
            + "\n" + "                                                          WHERE repRestHist.t_accountId = account.t_accountId                                                                "
            + "\n" + "                                                            AND (  (    repRestHist.t_restCurrency  = account.t_fiId                                                         "
            + "\n" + "                                                                    AND frd.t_isWorkDay != 'X'                                                                               "
            + "\n" + "                                                                   )                                                                                                         "
            + "\n" + "                                                                 OR                                                                                                          "
            + "\n" + "                                                                   (    repRestHist.t_restCurrency  = 0                                                                      "
            + "\n" + "                                                                    AND frd.t_isWorkDay = 'X'                                                                                "
            + "\n" + "                                                                   )                                                                                                         "
            + "\n" + "                                                                )                                                                                                            "
            + "\n" + "                                                            AND repRestHist.t_restDate IN (SELECT MAX(rd.t_restDate)                                                         "
            + "\n" + "                                                                                             FROM drepRestHist_tmp rd                                                        "
            + "\n" + "                                                                                            WHERE rd.t_accountId = account.t_accountId                                       "
            + "\n" + "                                                                                              AND (  (    rd.t_restCurrency  = account.t_fiId                                "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay != 'X'                                             "
            + "\n" + "                                                                                                     )                                                                       "
            + "\n" + "                                                                                                   OR                                                                        "
            + "\n" + "                                                                                                     (    rd.t_restCurrency  = 0                                             "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay = 'X'                                              "
            + "\n" + "                                                                                                     )                                                                       "
            + "\n" + "                                                                                                  )                                                                          "
            + "\n" + "                                                                                              AND rd.t_restDate <= (SELECT workDays.t_prevWorkDay                            "
            + "\n" + "                                                                                                                      FROM dfforDates_tmp workDays                           "
            + "\n" + "                                                                                                                     WHERE workDays.t_date = frd.t_date                      "
            + "\n" + "                                                                                                                   )                                                         "
            + "\n" + "                                                                                          )                                                                                  "
            + "\n" + "                                                        ),  0) t_rest                                                                                                        "
            + "\n" + "  FROM (SELECT account.*                                                                                                                                                     "
            + "\n" + "          FROM (SELECT ac.*,                                                                                                                                                 "
            + "\n" + "                       TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account AS t_accountObjectId,                                                "
            + "\n" + "                       NVL((SELECT TO_NUMBER(linkedObjects.t_id)                                                                                                             "
            + "\n" + "                              FROM drepLinkedObjects_vw linkedObjects                                                                                                        "
            + "\n" + "                             WHERE linkedObjects.t_connectObjectId = TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account                        "
            + "\n" + "                               AND linkedObjects.t_connectObjectType = rep_const.get().cb.objectTypes.account                                                                "
            + "\n" + "                               AND linkedObjects.t_type = rep_const.get().cb.objectTypes.party                                                                               "
            + "\n" + "                               AND linkedObjects.t_role = rep_const.get().cb.objectRoles.party.operationContragent                                                           "
            + "\n" + "                               AND linkedObjects.t_isInstalledForEndDate = 1), t_clientCode)                                                                                 "
            + "\n" + "                       AS t_contractorId                                                                                                                                     "
            + "\n" + "                  FROM dfforaccount_tmp ac) account                                                                                                                          "
            + "\n" + "         WHERE  account.t_balance IN ('52005')                                                                                                                               "
            + "\n" + "AND  rep_note.readMaturityDate(t_accountObjectId, " + getSqlDate(RcbApplication().currentReport.context.period.endDate) + ") = ADD_MONTHS(rcb_for.dateOpeningAccount(account.t_account, account.t_openDate), 36) "
            + "\n" + "           AND rowNum > 0 --Делаем так для того, чтобы сначла был наложен фильтр на л/с и только потом джойн с датами                                                        "
            + "\n" + "           AND 1 = 1) account,                                                                                                                                               "
            + "\n" + "       dfforRateDates_tmp frd                                                                                                                                                "
            + "\n" + " WHERE account.t_fiId = frd.t_fiId                                                                                                                                           "
            + "\n" + "   AND  EXISTS (SELECT 1                                                                                                                                                     "
            + "\n" + "          FROM dobjatcor_dbt atc                                                                                                                                             "
            + "\n" + "         WHERE atc.t_ObjectType = 4                                                                                                                                          "
            + "\n" + "           AND atc.t_GroupID    = 1                                                                                                                                          "
            + "\n" + "           AND atc.t_Object     = account.t_accountObjectId                                                                                                                  "
            + "\n" + "           AND atc.t_AttrID = ANY (SELECT att.t_AttrID                                                                                                                       "
            + "\n" + "                                     FROM dobjattr_dbt att                                                                                                                   "
            + "\n" + "                                    WHERE att.t_ObjectType = 4                                                                                                               "
            + "\n" + "                                      AND att.t_GroupID    = 1                                                                                                               "
            + "\n" + "                                      AND att.t_codeList = CHR(1)                                                                                                            "
            + "\n" + "                                      AND att.t_numInList = ANY('507-П пункт 2.5.6_1')                                                                                       "
            + "\n" + "                                  )                                                                                                                                          "
            + "\n" + "           AND frd.t_date BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate                                                                                                  "
            + "\n" + "       )) account                                                                                                                                                            "
            + "\n" + "         UNION ALL                                                                                                                                                           "
            + "\n" + "        SELECT t_balance,                                                                                                                                                    "
            + "\n" + "               t_date,                                                                                                                                                       "
            + "\n" + "               0 t_rest,                                                                                                                                                     "
            + "\n" + "               cur.t_isCurrency                                                                                                                                              "
            + "\n" + "          FROM dbalance_dbt,                                                                                                                                                 "
            + "\n" + "               dffordates_tmp,                                                                                                                                               "
            + "\n" + "               (SELECT 'X' t_isCurrency FROM DUAL                                                                                                                            "
            + "\n" + "                 UNION ALL                                                                                                                                                   "
            + "\n" + "                SELECT CHR(0) t_isCurrency FROM DUAL                                                                                                                         "
            + "\n" + "               ) cur                                                                                                                                                         "
            + "\n" + "         WHERE 1 = 1                                                                                                                                                         "
            + "\n" + "           AND t_chapter = 1                                                                                                                                                 "
            + "\n" + "           AND t_balance IN ('52005')                                                                                                                                        "
            + "\n" + "       ) account                                                                                                                                                             "
            + "\n" + " GROUP BY t_balance,                                                                                                                                                         "
            + "\n" + "          t_date,                                                                                                                                                            "
            + "\n" + "          t_isCurrency                                                                                                                                                       "
            ;

        sql_execute(query);
    end;


    macro insert_app2_row322_520061()
        var query =  "INSERT INTO dffor_tmp                                                                                                                                                       "
            + "\n" + "(                                                                                                                                                            "
            + "\n" + " t_applicationName,                                                                                                                                          "
            + "\n" + " t_backOffice,                                                                                                                                               "
            + "\n" + " t_row,                                                                                                                                                      "
            + "\n" + " t_balance,                                                                                                                                                  "
            + "\n" + " t_date,                                                                                                                                                     "
            + "\n" + " t_rest,                                                                                                                                                     "
            + "\n" + " t_scaledRest,                                                                                                                                               "
            + "\n" + " t_isCurrency,                                                                                                                                               "
            + "\n" + " t_balanceGroup                                                                                                                                              "
            + "\n" + ")                                                                                                                                                            "
            + "\n" + "SELECT /*+ UNNEST*/                                                                                                                                          "
            + "\n" + "       'Приложение2' t_applicationName,                                                                                                                      "
            + "\n" + "       1 t_backOffice,                                                                                                                                       "
            + "\n" + "       '3.2.2' t_rowCode,                                                                                                                                    "
            + "\n" + "       '520061' t_balance,                                                                                                                                   "
            + "\n" + "       t_date,                                                                                                                                               "
            + "\n" + "       SUM(NVL(t_rest, 0)) t_rest,                                                                                                                           "
            + "\n" + "       ROUND(SUM(NVL(t_rest, 0)) / 1000.0000) t_scaledRest,                                                                                                  "
            + "\n" + "       NVL(t_isCurrency, CHR(0)) t_isCurrency,                                                                                                               "
            + "\n" + "       'расшифровка' t_balanceGroup                                                                                                                          "
            + "\n" + "  FROM (SELECT t_balance,                                                                                                                                    "
            + "\n" + "               t_date,                                                                                                                                       "
            + "\n" + "               t_rest*t_rate AS t_rest,                                                                                                                      "
            + "\n" + "               t_isCurrency                                                                                                                                  "
            + "\n" + "          FROM (SELECT account.*,                                                                                                                            "
            + "\n" + "       frd.t_date,                                                                                                                                           "
            + "\n" + "       CASE frd.t_isWorkDay                                                                                                                                  "
            + "\n" + "           WHEN 'X' THEN 1.0                                                                                                                                 "
            + "\n" + "           ELSE frd.t_rate                                                                                                                                   "
            + "\n" + "       END t_rate,                                                                                                                                           "
            + "\n" + "       DECODE(account.t_kind_account, 'П', 1, -1) * NVL((SELECT repRestHist.t_rest                                                                           "
            + "\n" + "                                                           FROM drepRestHist_tmp repRestHist                                                                 "
            + "\n" + "                                                          WHERE repRestHist.t_accountId = account.t_accountId                                                "
            + "\n" + "                                                            AND (  (    repRestHist.t_restCurrency  = account.t_fiId                                         "
            + "\n" + "                                                                    AND frd.t_isWorkDay != 'X'                                                               "
            + "\n" + "                                                                   )                                                                                         "
            + "\n" + "                                                                 OR                                                                                          "
            + "\n" + "                                                                   (    repRestHist.t_restCurrency  = 0                                                      "
            + "\n" + "                                                                    AND frd.t_isWorkDay = 'X'                                                                "
            + "\n" + "                                                                   )                                                                                         "
            + "\n" + "                                                                )                                                                                            "
            + "\n" + "                                                            AND repRestHist.t_restDate IN (SELECT MAX(rd.t_restDate)                                         "
            + "\n" + "                                                                                             FROM drepRestHist_tmp rd                                        "
            + "\n" + "                                                                                            WHERE rd.t_accountId = account.t_accountId                       "
            + "\n" + "                                                                                              AND (  (    rd.t_restCurrency  = account.t_fiId                "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay != 'X'                             "
            + "\n" + "                                                                                                     )                                                       "
            + "\n" + "                                                                                                   OR                                                        "
            + "\n" + "                                                                                                     (    rd.t_restCurrency  = 0                             "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay = 'X'                              "
            + "\n" + "                                                                                                     )                                                       "
            + "\n" + "                                                                                                  )                                                          "
            + "\n" + "                                                                                              AND rd.t_restDate <= (SELECT workDays.t_prevWorkDay            "
            + "\n" + "                                                                                                                      FROM dfforDates_tmp workDays           "
            + "\n" + "                                                                                                                     WHERE workDays.t_date = frd.t_date      "
            + "\n" + "                                                                                                                   )                                         "
            + "\n" + "                                                                                          )                                                                  "
            + "\n" + "                                                        ),  0) t_rest                                                                                        "
            + "\n" + "  FROM (SELECT account.*                                                                                                                                     "
            + "\n" + "          FROM (SELECT ac.*,                                                                                                                                 "
            + "\n" + "                       TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account AS t_accountObjectId,                                "
            + "\n" + "                       NVL((SELECT TO_NUMBER(linkedObjects.t_id)                                                                                             "
            + "\n" + "                              FROM drepLinkedObjects_vw linkedObjects                                                                                        "
            + "\n" + "                             WHERE linkedObjects.t_connectObjectId = TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account        "
            + "\n" + "                               AND linkedObjects.t_connectObjectType = rep_const.get().cb.objectTypes.account                                                "
            + "\n" + "                               AND linkedObjects.t_type = rep_const.get().cb.objectTypes.party                                                               "
            + "\n" + "                               AND linkedObjects.t_role = rep_const.get().cb.objectRoles.party.operationContragent                                           "
            + "\n" + "                               AND linkedObjects.t_isInstalledForEndDate = 1), t_clientCode)                                                                 "
            + "\n" + "                       AS t_contractorId                                                                                                                     "
            + "\n" + "                  FROM dfforaccount_tmp ac) account                                                                                                          "
            + "\n" + "         WHERE  account.t_balance IN ('52006')                                                                                                               "
            + "\n" + "           AND rowNum > 0 --Делаем так для того, чтобы сначла был наложен фильтр на л/с и только потом джойн с датами                                        "
            + "\n" + "           AND 1 = 1) account,                                                                                                                               "
            + "\n" + "       dfforRateDates_tmp frd                                                                                                                                "
            + "\n" + " WHERE account.t_fiId = frd.t_fiId                                                                                                                           "
            + "\n" + "   AND  EXISTS (SELECT 1                                                                                                                                     "
            + "\n" + "          FROM dobjatcor_dbt atc                                                                                                                             "
            + "\n" + "         WHERE atc.t_ObjectType = 4                                                                                                                          "
            + "\n" + "           AND atc.t_GroupID    = 1                                                                                                                          "
            + "\n" + "           AND atc.t_Object     = account.t_accountObjectId                                                                                                  "
            + "\n" + "           AND atc.t_AttrID = ANY (SELECT att.t_AttrID                                                                                                       "
            + "\n" + "                                     FROM dobjattr_dbt att                                                                                                   "
            + "\n" + "                                    WHERE att.t_ObjectType = 4                                                                                               "
            + "\n" + "                                      AND att.t_GroupID    = 1                                                                                               "
            + "\n" + "                                      AND att.t_codeList = CHR(1)                                                                                            "
            + "\n" + "                                      AND att.t_numInList = ANY('507-П пункт 2.5.6_1')                                                                       "
            + "\n" + "                                  )                                                                                                                          "
            + "\n" + "           AND frd.t_date BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate                                                                                  "
            + "\n" + "       )                                                                                                                                                     "
            + "\n" + "AND NOT EXISTS (SELECT 1                                                                                                                                     "
            + "\n" + "          FROM dobjatcor_dbt atc                                                                                                                             "
            + "\n" + "         WHERE atc.t_ObjectType = 4                                                                                                                          "
            + "\n" + "           AND atc.t_GroupID    = 25                                                                                                                         "
            + "\n" + "           AND atc.t_Object     = account.t_accountObjectId                                                                                                  "
            + "\n" + "           AND atc.t_AttrID = ANY (SELECT att.t_AttrID                                                                                                       "
            + "\n" + "                                     FROM dobjattr_dbt att                                                                                                   "
            + "\n" + "                                    WHERE att.t_ObjectType = 4                                                                                               "
            + "\n" + "                                      AND att.t_GroupID    = 25                                                                                              "
            + "\n" + "                                      AND att.t_codeList = CHR(1)                                                                                            "
            + "\n" + "                                      AND att.t_numInList = ANY('507-П пункт 2.5.6_1')                                                                       "
            + "\n" + "                                  )                                                                                                                          "
            + "\n" + "           AND frd.t_date BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate                                                                                  "
            + "\n" + "       )) account                                                                                                                                            "
            + "\n" + "         UNION ALL                                                                                                                                           "
            + "\n" + "        SELECT t_balance,                                                                                                                                    "
            + "\n" + "               t_date,                                                                                                                                       "
            + "\n" + "               0 t_rest,                                                                                                                                     "
            + "\n" + "               cur.t_isCurrency                                                                                                                              "
            + "\n" + "          FROM dbalance_dbt,                                                                                                                                 "
            + "\n" + "               dffordates_tmp,                                                                                                                               "
            + "\n" + "               (SELECT 'X' t_isCurrency FROM DUAL                                                                                                            "
            + "\n" + "                 UNION ALL                                                                                                                                   "
            + "\n" + "                SELECT CHR(0) t_isCurrency FROM DUAL                                                                                                         "
            + "\n" + "               ) cur                                                                                                                                         "
            + "\n" + "         WHERE 1 = 1                                                                                                                                         "
            + "\n" + "           AND t_chapter = 1                                                                                                                                 "
            + "\n" + "           AND t_balance IN ('52006')                                                                                                                        "
            + "\n" + "       ) account                                                                                                                                             "
            + "\n" + " GROUP BY t_balance,                                                                                                                                         "
            + "\n" + "          t_date,                                                                                                                                            "
            + "\n" + "          t_isCurrency                                                                                                                                       "
            ;

        sql_execute(query);
    end;

    macro insert_app2_row122(accounts)
        var query =  "INSERT INTO dffor_tmp                                                                                                                                                             "
            + "\n" + "(                                                                                                                                                                                 "
            + "\n" + " t_applicationName,                                                                                                                                                               "
            + "\n" + " t_backOffice,                                                                                                                                                                    "
            + "\n" + " t_row,                                                                                                                                                                           "
            + "\n" + " t_balance,                                                                                                                                                                       "
            + "\n" + " t_date,                                                                                                                                                                          "
            + "\n" + " t_rest,                                                                                                                                                                          "
            + "\n" + " t_scaledRest,                                                                                                                                                                    "
            + "\n" + " t_isCurrency,                                                                                                                                                                    "
            + "\n" + " t_balanceGroup                                                                                                                                                                   "
            + "\n" + ")                                                                                                                                                                                 "
            + "\n" + "SELECT /*+ UNNEST*/                                                                                                                                                               "
            + "\n" + "       'Приложение2' t_applicationName,                                                                                                                                           "
            + "\n" + "       1 t_backOffice,                                                                                                                                                            "
            + "\n" + "       '1.2.2' t_rowCode,                                                                                                                                                         "
            + "\n" + "       t_balance,                                                                                                                                                     "
            + "\n" + "       t_date,                                                                                                                                                                    "
            + "\n" + "       SUM(NVL(t_rest, 0)) t_rest,                                                                                                                                                "
            + "\n" + "       ROUND(SUM(NVL(t_rest, 0)) / 1000.0000) t_scaledRest,                                                                                                                       "
            + "\n" + "       NVL(t_isCurrency, CHR(0)) t_isCurrency,                                                                                                                                    "
            + "\n" + "       'расшифровка' t_balanceGroup                                                                                                                                               "
            + "\n" + "  FROM (SELECT t_balance,                                                                                                                                                         "
            + "\n" + "               t_date,                                                                                                                                                            "
            + "\n" + "               t_rest*t_rate AS t_rest,                                                                                                                                           "
            + "\n" + "               t_isCurrency                                                                                                                                                       "
            + "\n" + "          FROM (SELECT account.*,                                                                                                                                                 "
            + "\n" + "       frd.t_date,                                                                                                                                                                "
            + "\n" + "       CASE frd.t_isWorkDay                                                                                                                                                       "
            + "\n" + "           WHEN 'X' THEN 1.0                                                                                                                                                      "
            + "\n" + "           ELSE frd.t_rate                                                                                                                                                        "
            + "\n" + "       END t_rate,                                                                                                                                                                "
            + "\n" + "       DECODE(account.t_kind_account, 'П', 1, -1) * NVL((SELECT repRestHist.t_rest                                                                                                "
            + "\n" + "                                                           FROM drepRestHist_tmp repRestHist                                                                                      "
            + "\n" + "                                                          WHERE repRestHist.t_accountId = account.t_accountId                                                                     "
            + "\n" + "                                                            AND (  (    repRestHist.t_restCurrency  = account.t_fiId                                                              "
            + "\n" + "                                                                    AND frd.t_isWorkDay != 'X'                                                                                    "
            + "\n" + "                                                                   )                                                                                                              "
            + "\n" + "                                                                 OR                                                                                                               "
            + "\n" + "                                                                   (    repRestHist.t_restCurrency  = 0                                                                           "
            + "\n" + "                                                                    AND frd.t_isWorkDay = 'X'                                                                                     "
            + "\n" + "                                                                   )                                                                                                              "
            + "\n" + "                                                                )                                                                                                                 "
            + "\n" + "                                                            AND repRestHist.t_restDate IN (SELECT MAX(rd.t_restDate)                                                              "
            + "\n" + "                                                                                             FROM drepRestHist_tmp rd                                                             "
            + "\n" + "                                                                                            WHERE rd.t_accountId = account.t_accountId                                            "
            + "\n" + "                                                                                              AND (  (    rd.t_restCurrency  = account.t_fiId                                     "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay != 'X'                                                  "
            + "\n" + "                                                                                                     )                                                                            "
            + "\n" + "                                                                                                   OR                                                                             "
            + "\n" + "                                                                                                     (    rd.t_restCurrency  = 0                                                  "
            + "\n" + "                                                                                                      AND frd.t_isWorkDay = 'X'                                                   "
            + "\n" + "                                                                                                     )                                                                            "
            + "\n" + "                                                                                                  )                                                                               "
            + "\n" + "                                                                                              AND rd.t_restDate <= (SELECT workDays.t_prevWorkDay                                 "
            + "\n" + "                                                                                                                      FROM dfforDates_tmp workDays                                "
            + "\n" + "                                                                                                                     WHERE workDays.t_date = frd.t_date                           "
            + "\n" + "                                                                                                                   )                                                              "
            + "\n" + "                                                                                          )                                                                                       "
            + "\n" + "                                                        ),  0) t_rest                                                                                                             "
            + "\n" + "  FROM (SELECT account.*                                                                                                                                                          "
            + "\n" + "          FROM (SELECT ac.*,                                                                                                                                                      "
            + "\n" + "                       TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account AS t_accountObjectId,                                                     "
            + "\n" + "                       NVL((SELECT TO_NUMBER(linkedObjects.t_id)                                                                                                                  "
            + "\n" + "                              FROM drepLinkedObjects_vw linkedObjects                                                                                                             "
            + "\n" + "                             WHERE linkedObjects.t_connectObjectId = TO_CHAR(ac.t_chapter, 'FM0x') || TO_CHAR(ac.t_fiId, 'FM0xxxxxx') || ac.t_account                             "
            + "\n" + "                               AND linkedObjects.t_connectObjectType = rep_const.get().cb.objectTypes.account                                                                     "
            + "\n" + "                               AND linkedObjects.t_type = rep_const.get().cb.objectTypes.party                                                                                    "
            + "\n" + "                               AND linkedObjects.t_role = rep_const.get().cb.objectRoles.party.operationContragent                                                                "
            + "\n" + "                               AND linkedObjects.t_isInstalledForEndDate = 1), t_clientCode)                                                                                      "
            + "\n" + "                       AS t_contractorId                                                                                                                                          "
            + "\n" + "                  FROM dfforaccount_tmp ac) account                                                                                                                               "
            + "\n" + "         WHERE  account.t_balance IN (" + StrAssemble(accounts, ",") + ")";

            if (   (accounts[0] == "'42506'")
                or (accounts[0] == "'44006'")
               )
                query
            + "\n" + "AND  rep_note.readMaturityDate(t_accountObjectId, " + getSqlDate(RcbApplication().currentReport.context.period.endDate) + ") = ADD_MONTHS(rcb_for.dateOpeningAccount(account.t_account, account.t_openDate), 36)      ";
            end;

            query = query
            + "\n" + "           AND rowNum > 0 --Делаем так для того, чтобы сначла был наложен фильтр на л/с и только потом джойн с датами                                                             "
            + "\n" + "           AND 1 = 1) account,                                                                                                                                                    "
            + "\n" + "       dfforRateDates_tmp frd                                                                                                                                                     "
            + "\n" + " WHERE account.t_fiId = frd.t_fiId                                                                                                                                                "
            + "\n" + "   AND  EXISTS (SELECT 1                                                                                                                                                          "
            + "\n" + "          FROM dobjatcor_dbt atc                                                                                                                                                  "
            + "\n" + "         WHERE atc.t_ObjectType = 4                                                                                                                                               "
            + "\n" + "           AND atc.t_GroupID    = 1                                                                                                                                               "
            + "\n" + "           AND atc.t_Object     = account.t_accountObjectId                                                                                                                       "
            + "\n" + "           AND atc.t_AttrID = ANY (SELECT att.t_AttrID                                                                                                                            "
            + "\n" + "                                     FROM dobjattr_dbt att                                                                                                                        "
            + "\n" + "                                    WHERE att.t_ObjectType = 4                                                                                                                    "
            + "\n" + "                                      AND att.t_GroupID    = 1                                                                                                                    "
            + "\n" + "                                      AND att.t_codeList   = CHR(1)                                                                                                               "
            + "\n" + "                                      AND att.t_numInList  = ANY('507-П пункт 2.5.6')                                                                                             "
            + "\n" + "                                  )                                                                                                                                               "
            + "\n" + "           AND frd.t_date BETWEEN atc.t_ValidFromDate AND atc.t_ValidToDate)                                                                                                      "
            + "\n" + "       ) account                                                                                                                                                                  "
            + "\n" + "         UNION ALL                                                                                                                                                                "
            + "\n" + "        SELECT t_balance,                                                                                                                                                         "
            + "\n" + "               t_date,                                                                                                                                                            "
            + "\n" + "               0 t_rest,                                                                                                                                                          "
            + "\n" + "               cur.t_isCurrency                                                                                                                                                   "
            + "\n" + "          FROM dbalance_dbt,                                                                                                                                                      "
            + "\n" + "               dffordates_tmp,                                                                                                                                                    "
            + "\n" + "               (SELECT 'X' t_isCurrency FROM DUAL                                                                                                                                 "
            + "\n" + "                 UNION ALL                                                                                                                                                        "
            + "\n" + "                SELECT CHR(0) t_isCurrency FROM DUAL                                                                                                                              "
            + "\n" + "               ) cur                                                                                                                                                              "
            + "\n" + "         WHERE 1 = 1                                                                                                                                                              "
            + "\n" + "           AND t_chapter = 1                                                                                                                                                      "
            + "\n" + "           AND t_balance IN (" + StrAssemble(accounts, ",") + ")"
            + "\n" + "       ) account                                                                                                                                                                  "
            + "\n" + " GROUP BY t_balance,                                                                                                                                                              "
            + "\n" + "          t_date,                                                                                                                                                                 "
            + "\n" + "          t_isCurrency                                                                                                                                                            "
            + "\n" + " ORDER BY t_balance,                                                                                                                                                              "
            + "\n" + "          t_date,                                                                                                                                                                 "
            + "\n" + "          t_isCurrency                                                                                                                                                            "
            ;

        sql_execute(query);
    end;

    class TFilter()
        macro isSuitable(v : Object)
            return (v.fieldValue("balance").exactAsString != "");
        end;
    end;

    class TSorter()
        macro isLess(lhs, rhs : Object)
            if (lhs.fieldValue("balance").exact != rhs.fieldValue("balance").exact)
                return (lhs.fieldValue("balance").exact < rhs.fieldValue("balance").exact);
            else
                return (lhs.fieldValue("date").exact < rhs.fieldValue("date").exact)
            end;
        end;
    end;

    /**
     * Печать (экспорт) раздела 1
     */
    private macro printPart_1()
        var compositeValue = RcbApplication().currentReport.attributeValue("Приложение1");
        var keyValue = compositeValue.createKeyValue();
        var sumRub;
        var sumCur;
        var sumTotal;

        macro output(row, code, comment)
            keyValue.fieldValue("row") = row;
            sumRub = 0;
            sumCur = 0;
            if   (m_dimention == "руб.")
                sumTotal = compositeValue.findValue(keyValue).fieldValue("sum").exact;
            elif (m_dimention == "тыс.")
                sumTotal = compositeValue.findValue(keyValue).fieldValue("sum").scaled;
            end;

            m_view.printRow(code,
                            getFormatDate(String(RcbApplication().currentReport.context.period.endDate)),
                            m_catalog.getSortNumber(code),
                            "",
                            sumRub,
                            sumCur,
                            sumTotal,
                            0, 0, 0, 0, 0, 0, 0, 0, 0,
                            comment
                           );
        end;

        output("5.1", "p1s5_30202", "30202~~  ~Да~  ~Да~~");
        output("5.2", "p1s5_30204", "30204~~  ~Да~  ~Да~~");
        output("5.3", "p1s5_30238", "30238~~  ~Да~  ~Да~~Да");
    end;

    macro getItogComment(app, row)
        if   ((app == "2") and (row == "1"))
            return "{" + row + "}" + "Обязательства перед юриди-|ческими лицами-нерезидентами~~  ~  ~  ~Да~";
        elif ((app == "2") and (row == "1.1"))
            return "{" + row + "}" + "Обязательства перед юриди-|ческими лицами-нерезидентами|(за исключением долгосрочных)~~Да~no~  ~Да~";
        elif ((app == "2") and (row == "1.1.2"))
            return "{" + row + "}" + "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте Российской Федерации (по данным граф ""в рублях"" строки 1.1.1) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.1.3"))
            return "{" + row + "}" + "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в иностранной валюте (по данным граф ""в иностранной валюте в рублевом эквиваленте"" строки 1.1.1) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.2.1"))
            return "{" + row + "}" + "Итого|(сумма остатков по строке 1.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.2.3"))
            return "{" + row + "}" + "Итого|(сумма остатков по кодам обозначения по строке 1.2.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.2.5"))
            return "{" + row + "}" + "Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте Российской Федерации (по данным граф ""в рублях"" строки 1.2.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.2.6"))
            return "{" + row + "}" + " Долгосрочные обязательства перед юридическими лицами-нерезидентами в иностранной валюте (по данным граф ""в иностранной валюте в рублевом эквиваленте"" строки 1.2.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "2"))
            return "{" + row + "}" + "Обязательства перед|физическими лицами~~  ~~  ~Да~";
        elif ((app == "2") and (row == "2.1"))
            return "{" + row + "}" + "Итого|(сумма остатков по строке 2)~~Да~  ~  ~Да~";
        elif ((app == "2") and (row == "2.2"))
            return "{" + row + "}" + "Обязательства перед физическими лицами в валюте Российской Федерации (по данным граф ""в рублях"" строки 2.1) (2)~~  ~~  ~Да~";
        elif ((app == "2") and (row == "2.3"))
            return "{" + row + "}" + "Обязательства перед физическими лицами в иностранной валюте (по данным граф ""иностранная валюта в рублевом эквиваленте"" строки 2.1) (2)~~  ~~  ~Да~";
        elif ((app == "2") and (row == "3"))
            return "{" + row + "}" + "Иные обязательства~~  ~  ~  ~Да~";
        elif ((app == "2") and (row == "3.1"))
            return "{" + row + "}" + "Иные обязательства|(за исключением долгосрочных)~~Да~Да~  ~Да~";
        elif ((app == "2") and (row == "3.1.1"))
            return "{" + row + "}" + "Итого|(сумма остатков по строке 3.1)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.2"))
            return "{" + row + "}" + "Вычитаются:~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.3"))
            return "{" + row + "}" + "Итого|(сумма остатков по кодам обозначения по строке 3.1.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.4"))
            return "{" + row + "}" + "Итого|(строка 3.1.1 - строка 3.1.3)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.5"))
            return "{" + row + "}" + "Иные обязательства (за исключением долгосрочных) в валюте Российской Федерации (по данным граф ""в рублях"" строки 3.1.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.6"))
            return "{" + row + "}" + " Иные обязательства (за исключением долгосрочных) в иностранной валюте (по данным граф ""в иностранной валюте в рублевом эквиваленте"" строки 3.1.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2"))
            return "{" + row + "}" + "Долгосрочные иные обязательства~~Да~  ~  ~Да~";
        elif ((app == "2") and (row == "3.2.1"))
            return "{" + row + "}" + "Итого|(сумма остатков по строке 3.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.2"))
            return "{" + row + "}" + "Вычитаются:~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.3"))
            return "{" + row + "}" + "Итого|(сумма остатков по кодам обозначения по строке 3.2.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.4"))
            return "{" + row + "}" + "Итого|(строка 3.2.1 - строка 3.2.3)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.5"))
            return "{" + row + "}" + "Долгосрочные иные обязательства в валюте Российской Федерации (по данным граф ""в рублях"" строки 3.2.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.6"))
            return "{" + row + "}" + "Долгосрочные иные в иностранной валюте (по данным граф ""в иностранной валюте в рублевом эквиваленте"" строки 3.2.4) (2)~~Да~~Да~Да~";
        elif ((app == "3") and (row == "1"))
            return "{" + row + "}" + "Пассивные остатки отдельных лицевых счетов балансовых счетов по учету субординированных кредитов (депозитов, займов, облигационных займов):~~  ~  ~  ~Да~";
        elif ((app == "3") and (row == "1.1"))
            return "{" + row + "}" + "юридических лиц - нерезидентов:~~Да~  ~  ~Да~";
        elif ((app == "3") and (row == "1.1.1"))
            return "{" + row + "}" + "Итого пассивных остатков, подлежащих исключению из долгосрочных обязательств перед юридическими лицами - нерезидентами,|код обозначения 314440~~Да~~Да~Да~";
        elif ((app == "3") and (row == "1.2"))
            return "{" + row + "}" + "иных юридических лиц:~~Да~  ~  ~Да~";
        elif ((app == "3") and (row == "1.2.1"))
            return "{" + row + "}" + "Итого пассивных остатков, подлежащих исключению из долгосрочных иных обязательств,|код обозначения 411520~~Да~~Да~Да~";
        elif ((app == "4") and (row == "1"))
            return "{" + row + "}" + "Пассивные остатки (либо их часть) отдельных|лицевых счетов по учету|выпущенных  ценных    бумаг|балансовых счетов:~~  ~  ~  ~Да~";
        elif ((app == "4") and (row == "1.1"))
            return "{" + row + "}" + "В части иных обязательств (за исключением долгосрочных)~~Да~  ~  ~Да~";
        elif ((app == "4") and (row == "1.1.1"))
            return "{" + row + "}" + "Итого (сумма остатков по строке 1.1)~~Да~~Да~Да~";
        elif ((app == "4") and (row == "1.2"))
            return "{" + row + "}" + "В части долгосрочных иных обязательств~~Да~~Да~Да~";
        elif ((app == "4") and (row == "1.2.1"))
            return "{" + row + "}" + "Итого (сумма остатков по строке 1.2)~~Да~~Да~Да~";
        elif ((app == "4") and (row == "3.1"))
            return "{" + row + "}" + "Всего остатков,   подлежащих|исключению  из иных обязательств (за исключением долгосрочных)|(строка 1.1.1 х корректировочный коэффициент),|код обозначения|520524~~Да~~Да~Да~";
        elif ((app == "4") and (row == "3.2"))
            return "{" + row + "}" + "Всего остатков,   подлежащих|исключению  из долгосрочных иных обязательств|(строка 1.2.1 х корректировочный коэффициент),|код обозначения|520056~~Да~~Да~Да~";
        elif ((app == "5") and (row == "2"))
            return "{" + row + "}" + "Итого~~  ~~  ~Да~";
        elif ((app == "5") and (row == "3"))
            return "{" + row + "}" + "Средняя арифметическая величина денежных средств в валюте РФ в кассе (по данным строки 2) (3)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4"))
            return "{" + row + "}" + "Величина обязательных резервов по обязательствам в валюте РФ с учетом ограничения, установленного пунктом 3.5 Положения (строка 2.6 Расчета Х 25/100)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1"))
            return "Предрасчет стр. 2.6 Прилож.1 (отбрасываем знаки после запятой у p5s414)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.1"))
            return "Предрасчет стр. 2.6 Прилож.1 (см. p255bmt1|p1s21 и p255bmt1|p1s22)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.2"))
            return "Предрасчет стр. 2.6 Прилож.1 (см. p255bmt1|p1s23)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.3"))
            return "Предрасчет стр. 2.6 Прилож.1 (см. p255bmt1|p1s24 и p255bmt1|p1s25)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.4"))
            return "Предрасчет стр. 2.6 Прилож.1 (p5s411+p5s412+p5s413)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.5"))
            return "Предрасчет стр. 2.6 Прилож.1 (p6s414*0.25)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "5"))
            return "{" + row + "}" + "Величина исключаемых наличных денежных средств в валюте РФ в кассе, (строка 3, если стр.3 <= стр.4, или строка 4, если стр.3 > стр.4),|код обозначения 202025~~Да~  ~Да~Да~";
        elif ((app == "7") and (row == "1"))
            return "{" + row + "}" + "Пассивные  остатки отдельных|лицевых   счетов   по  учету |обязательств,  выраженных  в|неденежной форме, балансовых счетов:~~  ~Не пусто~  ~Да~";
        elif ((app == "7") and (row == "2"))
            return "{" + row + "}" + "Пассивные остатки отдельных лицевых счетов по учету обязательств перед другой кредитной организацией, зарегистрированной в установленном порядке и действующей на основании выданной Банком России лицензии на осуществление банковских операций (за  исключением  обязательств  перед  кредитной  организацией,  выступающей  в  качестве доверительного управляющего), перед международной финансовой организацией,  осуществляющей свою деятельность на основе международного договора (соглашения) о ее создании    с участием Российской Федерации, перед Внешэкономбанком, перед Банком России, возникающих в  результате заключения договоров (за исключением обязательств по выпущенным долговым ценным бумагам и процентов по ним), а также обязательств перед Банком России или АСВ и (или) инвесторами, не являющимися кредитными организациями, возникающих в рамках оказания финансовой помощи по планам участия Банка России или АСВ в осуществлении мер по предупреждению банкротства банка, балансовых счетов:~~Да~Не пусто~  ~Да~";
        elif ((app == "7") and (row == "3"))
            return "{" + row + "}" + "Пассивные  остатки  отдельных|лицевых   счетов   по   учету|задолженности, возникающей   |между обособленными          |подразделениями кредитной    |организации,                 |балансовых счетов:           ~~Да~Не пусто~  ~Да~";
        else
            return "";
        end;
    end;
    /**
     * Печать (экспорт) раздела
     * @param partId String Идентфикатор раздела
     */
    private macro printPart(partId: String)
        var compositeValue = RcbApplication().currentReport.attributeValue("Приложение" + partId);
        var iterator       = compositeValue.createValueIterator();
        var sumRub;
        var sumCur;
        var sumTotal;
        var code;
        var balance;
        var comment        = "";
        var row;

        //судя по файлу примера, для "Приложения 2..6 (руб.)" итоги не выводятся
        if (m_dimention == "руб.")
            iterator.setFilter(TFilter());
        end;
        iterator.setSortOrder(TSorter());
        iterator.moveFirst();
        while (not iterator.isDone())
            if   (m_dimention == "руб.")
                sumRub   = iterator.currentItem().fieldValue("roubleRest").exact;
                sumCur   = iterator.currentItem().fieldValue("currencyRest").exact;
                sumTotal = iterator.currentItem().fieldValue("roubleRest").exact + iterator.currentItem().fieldValue("currencyRest").exact;
            elif (m_dimention == "тыс.")
                sumRub   = iterator.currentItem().fieldValue("roubleRest").scaled;
                sumCur   = iterator.currentItem().fieldValue("currencyRest").scaled;
                sumTotal = iterator.currentItem().fieldValue("roubleRest").scaled + iterator.currentItem().fieldValue("currencyRest").scaled;
            end;

            balance = iterator.currentItem().fieldValue("balance").currentAsString;
            code    = "p" + partId + "s" + StrSubst(iterator.currentItem().fieldValue("row").currentAsString, ".", "") + ternary(balance != "", String("_" + balance), "");

            row = iterator.currentItem().fieldValue("row").currentAsString;
            if (balance != "")
                comment = balance + "~~  ~Да~  ~Да~~";
            else
                comment = getItogComment(partId, row);
            end;

            m_view.printRow(code,
                            getFormatDate(iterator.currentItem().fieldValue("date").currentAsString),
                            m_catalog.getSortNumber(code),
                            "",
                            sumRub,
                            sumCur,
                            sumTotal,
                            ternary(m_dimention == "руб.", 0, sumTotal * m_report.getRcbReport().multiplier - (iterator.currentItem().fieldValue("roubleRest").exact + iterator.currentItem().fieldValue("currencyRest").exact)),
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            comment
                           );

            iterator.next();
        end;
    end;

    class TMetaInf(balance, code, sorting, comment)
        var m_balance = balance;
        var m_code    = code;
        var m_sorting = sorting;
        var m_comment = comment;
    end;

    macro getMetaInfForBalance(balance)
        m_metaInf.moveFirst();
        while (m_metaInf.moveNext())
            if (m_metaInf.getCurrentItem().m_balance == balance)
                return m_metaInf.getCurrentItem();
            end;
        end;

        return TMetaInf("", "", "", "");
    end;

    /**
     *  расчитываемые строки экспорта
     */
    private macro printCalculatedAccounts()
        var sumRub;
        var sumCur;
        var sumTotal;
        var metaInf;
        var temp = TTempTable();        //заполняем временные таблицы ФОРа

        sql_execute("call rep_opt.clearRestHistTable()");
        sql_execute("call rep_opt.makeRestHistSlice(" + getSqlDate(RcbApplication().currentReport.context.period.beginDate) + ", "
                                                      + getSqlDate(RcbApplication().currentReport.context.period.endDate) + ", "
                                                      + "'(repRestHist.t_accountId) IN (SELECT t_accountId FROM dfforAccount_tmp)')");
        sql_execute("call rep_opt.clearourbanktable()");
        sql_execute("call rep_opt.makeOurBankSlice()");

        insert_app2_row122(RcbArray().initialize("'42506'", "'44006'"));
        insert_app2_row122(RcbArray().initialize("'42507'", "'44007'"));
        insert_app2_row31(RcbArray().initialize("'30416'", "'30417'", "'30418'", "'30419'", "'30420'", "'30421'", "'30422'", "'30423'", "'40108'", "'40109'", "'40110'", "'40111'", "'40306'", "'40308'"));
        insert_app2_row312();
        insert_app2_row322(RcbArray().initialize("'42006'","'42007'","'42106'","'42107'","'43706'","'43707'","'43806'","'43807'"));
        insert_app2_row322_520053();
        insert_app2_row322_520061();

        var query = "SELECT t1.t_applicationName    AS t_applicationName,              "
           + "\n" + "       t1.t_row                AS t_row,                          "
           + "\n" + "       t1.t_date               AS t_date,                         "
           + "\n" + "       t1.t_balance            AS t_balance,                      "
           + "\n" + "       SUM(t1.t_rest)          AS t_sumRub,                       "
           + "\n" + "       SUM(t1.t_scaledRest)    AS t_sumRubScaled,                 "
           + "\n" + "       SUM(t2.t_rest)          AS t_sumCur,                       "
           + "\n" + "       SUM(t2.t_scaledRest)    AS t_sumCurScaled                  "
           + "\n" + "  FROM dffor_tmp t1,                                              "
           + "\n" + "       dffor_tmp t2                                               "
           + "\n" + " WHERE t1.t_applicationName  = t2.t_applicationName               "
           + "\n" + "   AND t1.t_row              = t2.t_row                           "
           + "\n" + "   AND t1.t_balancegroup     = t2.t_balancegroup                  "
           + "\n" + "   AND t1.t_balance          = t2.t_balance                       "
           + "\n" + "   AND t1.t_date             = t2.t_date                          "
           + "\n" + "   AND t1.t_isCurrency      != 'X'                                "
           + "\n" + "   AND t2.t_isCurrency       = 'X'                                "
           + "\n" + " GROUP BY t1.t_applicationName, t1.t_row, t1.t_date, t1.t_balance "
           + "\n" + " ORDER BY t1.t_balance,                                           "
           + "\n" + "          t1.t_date                                               "
           ;

        var dataSet = TRsbDataSet(query);
        while (dataSet.moveNext())
            sumRub   = ternary(m_dimention == "руб.", dataSet.sumRub, dataSet.sumRubScaled);
            sumCur   = ternary(m_dimention == "руб.", dataSet.sumCur, dataSet.sumCurScaled);
            sumTotal = ternary(m_dimention == "руб.", dataSet.sumRub + dataSet.sumCur, dataSet.sumRubScaled + dataSet.sumCurScaled);
            metaInf  = getMetaInfForBalance(dataSet.balance);

            m_view.printRow(metaInf.m_code,
                            getFormatDate(SubStr(String(dataSet.date), 1, 10)),
                            metaInf.m_sorting,
                            "",
                            sumRub,
                            sumCur,
                            sumTotal,
                            ternary(m_dimention == "руб.", 0, sumTotal * m_report.getRcbReport().multiplier - dataSet.sumRub - dataSet.sumCur),
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            metaInf.m_comment
                           );
        end;
    end;

    /**
     * Печать (экспорт) отчета
     */
    private macro printDataZone()
        m_view.printHead(ternary(m_dimention == "руб.", "p255bm", "p255bmt"));

        if (m_dimention == "руб.")
            printPart_1();
        end;

        printCalculatedAccounts();

        printPart(2);
        printPart(3);
        printPart(4);
        printPart(5);
        printPart(6);

        m_view.printBottom();
    end;

    /**
     * Конструктор
     */
    private macro constructorTFForBisExportController_2_6(dimention)
        m_dimention = dimention;

        if (not in(m_dimention, "руб.", "тыс."))
            TPureVirtualMethodCallException("TFForBisExportController_2_6: error dimention");
        end;
        initRcbBiscuitExportController("txt", fForRcbReport(), ternary(m_dimention == "руб.", "p255bm", "p255bmt"));

        m_catalog = TCatalog("Формулы p255bm и сортировка");
        m_metaInf = RcbArray().initialize(TMetaInf("42506",  "p2s122cs_42506", "20162", "42506 вспом. (для 425440)~~  ~~Да~Да~~Да"),
                                          TMetaInf("42507",  "p2s122cs_42507", "20162", "42507 вспом. (для 425440)~~  ~~Да~Да~"),
                                          TMetaInf("44006",  "p2s122cs_44006", "20162", "44006 вспом. (для 425440)~~  ~~Да~Да~"),
                                          TMetaInf("44007",  "p2s122cs_44007", "20162", "44007 вспом. (для 425440)~~  ~~Да~Да~"),
                                          TMetaInf("30416",  "p2s31cs_30416",  "24700", "30416 - вспом. (для 304211)~~  ~~~  ~"),
                                          TMetaInf("30417",  "p2s31cs_30417",  "24700", "30417 - вспом. (для 304211)~~  ~~~  ~"),
                                          TMetaInf("30418",  "p2s31cs_30418",  "24700", "30418 - вспом. (для 304231)~~  ~~~  ~"),
                                          TMetaInf("30419",  "p2s31cs_30419",  "24700", "30419 - вспом. (для 304231)~~  ~~~  ~"),
                                          TMetaInf("30420",  "p2s31cs_30420",  "24700", "30420 - вспом. (для 304211)~~  ~~~  ~"),
                                          TMetaInf("30421",  "p2s31cs_30421",  "24700", "30421 - вспом. (для 304211)~~  ~~~  ~"),
                                          TMetaInf("30422",  "p2s31cs_30422",  "24700", "30422 - вспом. (для 304231)~~  ~~~  ~"),
                                          TMetaInf("30423",  "p2s31cs_30423",  "24700", "30423 - вспом. (для 304231)~~  ~~~  ~"),
                                          TMetaInf("40108",  "p2s31cs_40108",  "24700", "40108 - вспом. (для 401081)~~  ~~~Да~"),
                                          TMetaInf("40109",  "p2s31cs_40109",  "24700", "40109 - вспом. (для 401081)~~  ~~~Да~"),
                                          TMetaInf("40110",  "p2s31cs_40110",  "24700", "40110 - вспом. (для 401101)~~  ~~~Да~"),
                                          TMetaInf("40111",  "p2s31cs_40111",  "24700", "40111 - вспом. (для 401101)~~  ~~~Да~"),
                                          TMetaInf("40306",  "p2s31cs_40306",  "24700", "40306 - вспом. (для 403061)~~  ~~~  ~"),
                                          TMetaInf("40308",  "p2s31cs_40308",  "24700", "40308 - вспом. (для 403061)~~  ~~~  ~"),
                                          TMetaInf("42006",  "p2s322cs_42006", "25100", "42006 вспом. (для 420438)~~  ~~Да~Да~"),
                                          TMetaInf("42007",  "p2s322cs_42007", "25100", "42007 вспом. (для 420438)~~  ~~Да~Да~"),
                                          TMetaInf("42106",  "p2s322cs_42106", "25100", "42106 вспом. (для 420438)~~  ~~Да~Да~"),
                                          TMetaInf("42107",  "p2s322cs_42107", "25100", "42107 вспом. (для 420438)~~  ~~Да~Да~"),
                                          TMetaInf("43706",  "p2s322cs_43706", "25100", "43706 вспом. (для 420438)~~  ~~Да~Да~"),
                                          TMetaInf("43707",  "p2s322cs_43707", "25100", "43707 вспом. (для 420438)~~  ~~Да~Да~"),
                                          TMetaInf("43806",  "p2s322cs_43806", "25100", "43806 вспом. (для 420438)~~  ~~Да~Да~"),
                                          TMetaInf("43807",  "p2s322cs_43807", "25100", "43807 вспом. (для 420438)~~  ~~Да~Да~"),
                                          TMetaInf("40901",  "p2s312r_40901",  "24700", "40901 вспом. (для 409011)~~  ~~Да~Да~"),
                                          TMetaInf("40902",  "p2s312r_40902",  "24700", "40902 вспом. (для 409021)~~  ~~Да~Да~"),
                                          TMetaInf("47410",  "p2s312r_47410",  "24700", "47410 вспом. (для 409021)~~  ~~Да~Да~"),
                                          TMetaInf("47431",  "p2s312r_47431",  "24700", "47431 вспом. (для 409011)~~  ~~Да~Да~"),
                                          TMetaInf("520053", "p2s322r_520053", "25100", "520053 вспом. (для 520053)~~  ~~Да~Да~"),
                                          TMetaInf("520061", "p2s322r_520061", "25100", "520061 вспом. (для 520061)~~  ~~Да~Да~")
                                         );
    end;

    constructorTFForBisExportController_2_6(dimention);
end;

class (TFForBisExportController_2_6) TFForBisExportController_2_6_5242(dimention)
	initTFForBisExportController_2_6(dimention);
	
	macro getItogComment(app, row)
        if   ((app == "2") and (row == "1"))
            return "{" + row + "}" + "Обязательства перед юриди-|ческими лицами-нерезидентами~~  ~  ~  ~Да~";
        elif ((app == "2") and (row == "1.1"))
            return "{" + row + "}" + "Обязательства перед юриди-|ческими лицами-нерезидентами|(за исключением долгосрочных)~~Да~no~  ~Да~";
        elif ((app == "2") and (row == "1.1.3"))
            return "{" + row + "}" + "Итого|(строка 1.1.1 - строка 1.1.2)~~Да~~Да~Да~";
		elif ((app == "2") and (row == "1.1.4"))
            return "{" + row + "}" + "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте Российской Федерации (по данным граф ""в рублях"" строки 1.1.3) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.1.5"))
            return "{" + row + "}" + "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в иностранной валюте (по данным граф ""в иностранной валюте в рублевом эквиваленте"" строки 1.1.3) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.2.1"))
            return "{" + row + "}" + "Итого|(сумма остатков по строке 1.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.2.3"))
            return "{" + row + "}" + "Итого|(сумма остатков по кодам обозначения по строке 1.2.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.2.4"))
            return "{" + row + "}" + "Итого|(строка 1.2.1 - строка 1.2.3)~~Да~~Да~Да~";
		elif ((app == "2") and (row == "1.2.5"))
            return "{" + row + "}" + "Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте Российской Федерации (по данным граф ""в рублях"" строки 1.2.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "1.2.6"))
            return "{" + row + "}" + " Долгосрочные обязательства перед юридическими лицами-нерезидентами в иностранной валюте (по данным граф ""в иностранной валюте в рублевом эквиваленте"" строки 1.2.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "2"))
            return "{" + row + "}" + "Обязательства перед|физическими лицами~~  ~~  ~Да~";
        elif ((app == "2") and (row == "2.1"))
            return "{" + row + "}" + "Итого|(сумма остатков по строке 2)~~Да~  ~  ~Да~";
        elif ((app == "2") and (row == "2.2"))
            return "{" + row + "}" + "Обязательства перед физическими лицами в валюте Российской Федерации (по данным граф ""в рублях"" строки 2.1) (2)~~  ~~  ~Да~";
        elif ((app == "2") and (row == "2.3"))
            return "{" + row + "}" + "Обязательства перед физическими лицами в иностранной валюте (по данным граф ""иностранная валюта в рублевом эквиваленте"" строки 2.1) (2)~~  ~~  ~Да~";
        elif ((app == "2") and (row == "3"))
            return "{" + row + "}" + "Иные обязательства~~  ~  ~  ~Да~";
        elif ((app == "2") and (row == "3.1"))
            return "{" + row + "}" + "Иные обязательства|(за исключением долгосрочных)~~Да~Да~  ~Да~";
        elif ((app == "2") and (row == "3.1.1"))
            return "{" + row + "}" + "Итого|(сумма остатков по строке 3.1)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.2"))
            return "{" + row + "}" + "Вычитаются:~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.3"))
            return "{" + row + "}" + "Итого|(сумма остатков по кодам обозначения по строке 3.1.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.4"))
            return "{" + row + "}" + "Итого|(строка 3.1.1 - строка 3.1.3)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.5"))
            return "{" + row + "}" + "Иные обязательства (за исключением долгосрочных) в валюте Российской Федерации (по данным граф ""в рублях"" строки 3.1.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.1.6"))
            return "{" + row + "}" + " Иные обязательства (за исключением долгосрочных) в иностранной валюте (по данным граф ""в иностранной валюте в рублевом эквиваленте"" строки 3.1.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2"))
            return "{" + row + "}" + "Долгосрочные иные обязательства~~Да~  ~  ~Да~";
        elif ((app == "2") and (row == "3.2.1"))
            return "{" + row + "}" + "Итого|(сумма остатков по строке 3.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.2"))
            return "{" + row + "}" + "Вычитаются:~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.3"))
            return "{" + row + "}" + "Итого|(сумма остатков по кодам обозначения по строке 3.2.2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.4"))
            return "{" + row + "}" + "Итого|(строка 3.2.1 - строка 3.2.3)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.5"))
            return "{" + row + "}" + "Долгосрочные иные обязательства в валюте Российской Федерации (по данным граф ""в рублях"" строки 3.2.4) (2)~~Да~~Да~Да~";
        elif ((app == "2") and (row == "3.2.6"))
            return "{" + row + "}" + "Долгосрочные иные в иностранной валюте (по данным граф ""в иностранной валюте в рублевом эквиваленте"" строки 3.2.4) (2)~~Да~~Да~Да~";
        elif ((app == "3") and (row == "1"))
            return "{" + row + "}" + "Пассивные остатки отдельных лицевых счетов балансовых счетов по учету субординированных кредитов (депозитов, займов, облигационных займов):~~  ~  ~  ~Да~";
        elif ((app == "3") and (row == "1.1"))
            return "{" + row + "}" + "юридических лиц - нерезидентов:~~Да~  ~  ~Да~";
        elif ((app == "3") and (row == "1.1.1"))
            return "{" + row + "}" + "Итого пассивных остатков, подлежащих исключению из долгосрочных обязательств перед юридическими лицами - нерезидентами,|код обозначения 314440~~Да~~Да~Да~";
        elif ((app == "3") and (row == "1.2"))
            return "{" + row + "}" + "иных юридических лиц:~~Да~  ~  ~Да~";
        elif ((app == "3") and (row == "1.2.1"))
            return "{" + row + "}" + "Итого пассивных остатков, подлежащих исключению из долгосрочных иных обязательств,|код обозначения 411520~~Да~~Да~Да~";
        elif ((app == "4") and (row == "1"))
            return "{" + row + "}" + "Пассивные остатки (либо их часть) отдельных|лицевых счетов по учету|выпущенных  ценных    бумаг|балансовых счетов:~~  ~  ~  ~Да~";
        elif ((app == "4") and (row == "1.1"))
            return "{" + row + "}" + "В части иных обязательств (за исключением долгосрочных)~~Да~  ~  ~Да~";
        elif ((app == "4") and (row == "1.1.1"))
            return "{" + row + "}" + "Итого (сумма остатков по строке 1.1)~~Да~~Да~Да~";
        elif ((app == "4") and (row == "1.2"))
            return "{" + row + "}" + "В части долгосрочных иных обязательств~~Да~~Да~Да~";
        elif ((app == "4") and (row == "1.2.1"))
            return "{" + row + "}" + "Итого (сумма остатков по строке 1.2)~~Да~~Да~Да~";
        elif ((app == "4") and (row == "3.1"))
            return "{" + row + "}" + "Всего остатков,   подлежащих|исключению  из иных обязательств (за исключением долгосрочных)|(строка 1.1.1 х корректировочный коэффициент),|код обозначения|520524~~Да~~Да~Да~";
        elif ((app == "4") and (row == "3.2"))
            return "{" + row + "}" + "Всего остатков,   подлежащих|исключению  из долгосрочных иных обязательств|(строка 1.2.1 х корректировочный коэффициент),|код обозначения|520056~~Да~~Да~Да~";
        elif ((app == "5") and (row == "2"))
            return "{" + row + "}" + "Итого~~  ~~  ~Да~";
        elif ((app == "5") and (row == "3"))
            return "{" + row + "}" + "Средняя арифметическая величина денежных средств в валюте РФ в кассе (по данным строки 2) (3)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4"))
            return "{" + row + "}" + "Величина обязательных резервов по обязательствам в валюте РФ с учетом ограничения, установленного пунктом 3.5 Положения (строка 2.6 Расчета Х 25/100)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1"))
            return "Предрасчет стр. 2.6 Прилож.1 (отбрасываем знаки после запятой у p5s414)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.1"))
            return "Предрасчет стр. 2.6 Прилож.1 (см. p255bmt1|p1s21 и p255bmt1|p1s22)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.2"))
            return "Предрасчет стр. 2.6 Прилож.1 (см. p255bmt1|p1s23)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.3"))
            return "Предрасчет стр. 2.6 Прилож.1 (см. p255bmt1|p1s24 и p255bmt1|p1s25)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.4"))
            return "Предрасчет стр. 2.6 Прилож.1 (p5s411+p5s412+p5s413)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "4.1.5"))
            return "Предрасчет стр. 2.6 Прилож.1 (p6s414*0.25)~~  ~  ~  ~Да~";
        elif ((app == "5") and (row == "5"))
            return "{" + row + "}" + "Величина исключаемых наличных денежных средств в валюте РФ в кассе, (строка 3, если стр.3 <= стр.4, или строка 4, если стр.3 > стр.4),|код обозначения 202025~~Да~  ~Да~Да~";
        elif ((app == "7") and (row == "1"))
            return "{" + row + "}" + "Пассивные  остатки отдельных|лицевых   счетов   по  учету |обязательств,  выраженных  в|неденежной форме, балансовых счетов:~~  ~Не пусто~  ~Да~";
        elif ((app == "7") and (row == "2"))
            return "{" + row + "}" + "Пассивные остатки отдельных лицевых счетов по учету обязательств перед другой кредитной организацией, зарегистрированной в установленном порядке и действующей на основании выданной Банком России лицензии на осуществление банковских операций (за  исключением  обязательств  перед  кредитной  организацией,  выступающей  в  качестве доверительного управляющего), перед международной финансовой организацией,  осуществляющей свою деятельность на основе международного договора (соглашения) о ее создании    с участием Российской Федерации, перед Внешэкономбанком, перед Банком России, возникающих в  результате заключения договоров (за исключением обязательств по выпущенным долговым ценным бумагам и процентов по ним), а также обязательств перед Банком России или АСВ и (или) инвесторами, не являющимися кредитными организациями, возникающих в рамках оказания финансовой помощи по планам участия Банка России или АСВ в осуществлении мер по предупреждению банкротства банка, балансовых счетов:~~Да~Не пусто~  ~Да~";
        elif ((app == "7") and (row == "3"))
            return "{" + row + "}" + "Пассивные  остатки  отдельных|лицевых   счетов   по   учету|задолженности, возникающей   |между обособленными          |подразделениями кредитной    |организации,                 |балансовых счетов:           ~~Да~Не пусто~  ~Да~";
        else
            return "";
        end;
    end;
	
	/**
     * Печать (экспорт) отчета
     */
    private macro printDataZone()
        m_view.printHead(ternary(m_dimention == "руб.", "p255bm", "p255bmt"));

        printCalculatedAccounts();

        printPart(2);
        printPart(3);
        printPart(4);
        printPart(5);
        printPart(6);

        m_view.printBottom();
    end;
end;


/**
 * Экспорт в БИСквит приложения 1
 */
class (RcbBiscuitExportController) TFForBisExportController_1()
    /**
     * Печать (экспорт) раздела
     * @param partId String Идентфикатор раздела
     */
    private macro printPart_1()
        var compositeValue = RcbApplication().currentReport.attributeValue("Приложение1");
        var iterator = compositeValue.createValueIterator();
        var sumTotal;
        var code;

        iterator.moveFirst();
        while (not iterator.isDone())
            code     = "p1" + "s" + StrSubst(iterator.currentItem().fieldValue("row").currentAsString, ".", "");
            sumTotal = Money(iterator.currentItem().fieldValue("sum").scaled);

            m_view.printRow(code,
                            "",
                            "",
                            "",
                            sumTotal,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            ""
                           );

            iterator.next();
        end;
    end;

    /**
     * Печать (экспорт) отчета
     */
    private macro printDataZone()
        m_view.printHead("p255bmt1");
        printPart_1();
        m_view.printBottom();
    end;

    /**
     * Конструктор
     */
    private macro constructorTFForBisExportController_1()
        initRcbBiscuitExportController("txt", fForRcbReport(), "p255bmt1");
    end;

    constructorTFForBisExportController_1();
end;

/**
 * Экспорт в БИСквит Расшифровки по лицевым счетам (руб.)
 */
class (RcbBiscuitExportController) TFForBisExportController_decodes()
    private var m_catalog;

    class TFilter(balance)
        private var m_balance = balance;

        macro isSuitable(v : Object)
            return (SubStr(v.fieldValue("balance").exactAsString, 1, StrLen(m_balance)) == m_balance)
        end;
    end;

    class TSorter()
        macro isLess(lhs, rhs : Object)
            return (lhs.fieldValue("date").exact < rhs.fieldValue("date").exact)
        end;
    end;

    class TSorterExclude()
        macro isLess(lhs, rhs : Object)
            if (lhs.fieldValue("balance").exact != rhs.fieldValue("balance").exact)
                return (lhs.fieldValue("balance").exact < rhs.fieldValue("balance").exact);
            else
                return (lhs.fieldValue("date").exact < rhs.fieldValue("date").exact)
            end;
        end;
    end;

    macro output(balance, appName, code, formula)
        var compositeValue = RcbApplication().currentReport.attributeValue(appName);
        var iterator       = compositeValue.createValueIterator();
        var sumRub         = 0;
        var sumCur         = 0;
        var sumTotal       = 0;
        var _date          = "";

        iterator.setFilter(TFilter(balance));
        iterator.setSortOrder(TSorter());
        iterator.moveFirst();
        if (not iterator.isDone())
            _date = getFormatDate(String(RcbApplication().currentReport.context.period.beginDate));
        end;
        while (not iterator.isDone())
            if (getFormatDate(iterator.currentItem().fieldValue("date").currentAsString) != _date)
                m_view.printRow(SubStr(balance, 1, 5),
                                code,
                                _date,
                                "",
                                sumRub,
                                sumCur,
                                0,
                                0,
                                sumTotal,
                                0,
                                0, 0, 0, 0, 0, 0,
                                formula
                               );

                sumRub   = iterator.currentItem().fieldValue("roubleRest").exact;
                sumCur   = iterator.currentItem().fieldValue("currencyRest").exact;
                sumTotal = iterator.currentItem().fieldValue("roubleRest").exact + iterator.currentItem().fieldValue("currencyRest").exact;
            else
                sumRub   = sumRub   + iterator.currentItem().fieldValue("roubleRest").exact;
                sumCur   = sumCur   + iterator.currentItem().fieldValue("currencyRest").exact;
                sumTotal = sumTotal + iterator.currentItem().fieldValue("roubleRest").exact + iterator.currentItem().fieldValue("currencyRest").exact;
            end;

            _date = getFormatDate(iterator.currentItem().fieldValue("date").currentAsString);

            iterator.next();
        end;

        if (_date != "")
            m_view.printRow(SubStr(balance, 1, 5),
                            code,
                            _date,
                            "",
                            sumRub,
                            sumCur,
                            0,
                            0,
                            sumTotal,
                            0,
                            0, 0, 0, 0, 0, 0,
                            formula
                           );
        end;
    end;

    /**
     * Печать (экспорт) по коду формулы list_bal
     */
    private macro printPart_list_bal()
        var code    = "list_bal";
        var formula = m_catalog.getSortNumber(code);

        output("47426", "Приложение2", code, formula);
        output("52405", "Приложение2", code, formula);
        output("52501", "Приложение2", code, formula);
    end;

    /**
     * Печать (экспорт) по коду формулы list_bal_pr
     */
    private macro printPart_list_bal_pr()
        var code    = "list_bal_pr";
        var formula = m_catalog.getSortNumber(code);

//        output("524051", "Приложение2", code, formula);
//        output("524052", "Приложение2", code, formula);
        output("52405", "Приложение2", code, formula);
//        output("525011", "Приложение2", code, formula);
//        output("525012", "Приложение2", code, formula);
        output("52501", "Приложение2", code, formula);
    end;

    /**
     * Печать (экспорт) по коду формулы 3n_Sub
     */
    private macro printPart_3n_Sub()
        var code    = "3n_Sub";
        var formula = m_catalog.getSortNumber(code);

        output("31409", "Приложение3", code, formula);
        output("31609", "Приложение3", code, formula);
    end;

    /**
     * Печать (экспорт) по коду формулы p255_F_pr
     */
    private macro printPart_p255_F_pr()
        var code    = "p255_F_pr";
        var formula = m_catalog.getSortNumber(code);

        output("524052", "Приложение2", code, formula);
        output("525012", "Приложение2", code, formula);
    end;

    /**
     * Печать (экспорт) по коду формулы 52006Н
     */
    private macro printPart_52006Н()
        var code    = "52006Н";
        var formula = "52006. не сод.возможности доср.выкупа";

        output("52006", "Приложение2", code, formula);
    end;

    /**
     * Печать (экспорт) по коду формулы 603222
     */
    private macro printPart_603222()
        var code    = "603222";
        var formula = "60322. Пр.2/Стр.3. .Ден.ср-ва в ин.валюте, поступающие в оплату акций КО";

        output("603222", "Приложение2", code, formula);
    end;

    /**
     * Печать (экспорт) по коду формулы 603223
     */
    private macro printPart_603223()
        var code    = "603223";
        var formula = "60322. Пр.2/Стр.3. Излишек денежных средств, выявленных в кассах кредитных организаций или банкоматах КО";

        output("603223", "Приложение2", code, formula);
    end;

    /**
     * Печать (экспорт) по коду формулы p255_not2
     */
    private macro printPart_p255_not2()
        var code    = "p255_not2";
        var formula = "Об-ва перед другой КО";

        macro output(appName, code, formula)
            var compositeValue = RcbApplication().currentReport.attributeValue(appName);
            var iterator       = compositeValue.createValueIterator();
            var sumRub         = 0;
            var sumCur         = 0;
            var sumTotal       = 0;
            var _date          = "";
            var _balance       = "";

            iterator.setSortOrder(TSorterExclude());
            iterator.moveFirst();
            if (not iterator.isDone())
                _date = getFormatDate(String(RcbApplication().currentReport.context.period.beginDate));
                _balance = iterator.currentItem().fieldValue("balance").currentAsString;
            end;
            while (not iterator.isDone())
                if (getFormatDate(iterator.currentItem().fieldValue("date").currentAsString) != _date)
                    m_view.printRow(_balance,
                                    code,
                                    _date,
                                    "",
                                    0,
                                    0,
                                    sumRub,
                                    sumCur,
                                    0,
                                    sumTotal,
                                    0, 0, 0, 0, 0, 0,
                                    formula
                                   );

                    sumRub   = iterator.currentItem().fieldValue("roubleRest").exact;
                    sumCur   = iterator.currentItem().fieldValue("currencyRest").exact;
                    sumTotal = iterator.currentItem().fieldValue("roubleRest").exact + iterator.currentItem().fieldValue("currencyRest").exact;
                else
                    sumRub   = sumRub   + iterator.currentItem().fieldValue("roubleRest").exact;
                    sumCur   = sumCur   + iterator.currentItem().fieldValue("currencyRest").exact;
                    sumTotal = sumTotal + iterator.currentItem().fieldValue("roubleRest").exact + iterator.currentItem().fieldValue("currencyRest").exact;
                end;

                _date = getFormatDate(iterator.currentItem().fieldValue("date").currentAsString);
                _balance = iterator.currentItem().fieldValue("balance").currentAsString;

                iterator.next();
            end;

            if (_date != "")
                m_view.printRow(_balance,
                                code,
                                _date,
                                "",
                                0,
                                0,
                                sumRub,
                                sumCur,
                                0,
                                sumTotal,
                                0, 0, 0, 0, 0, 0,
                                formula
                               );
            end;
        end;

        output("Приложение6", code, formula);
    end;

    /**
     * Печать (экспорт) отчета
     */
    private macro printDataZone()
        m_view.printHead("h255m");

        printPart_list_bal();
        printPart_list_bal_pr();
        printPart_3n_Sub();
        printPart_p255_F_pr();
        printPart_52006Н();
        printPart_603222();
        printPart_603223();

        printPart_p255_not2();

        m_view.printBottom();
    end;

    /**
     * Конструктор
     */
    private macro constructorTFForBisExportController_decodes()
        initRcbBiscuitExportController("txt", fForRcbReport(), "h255m");

        m_catalog = TCatalog("Формулы h255m");
    end;

    constructorTFForBisExportController_decodes();
end;


class TForBiscuitExportControllersBase()
	private var m_decodes;
	private var m_2_6_rouble;
	private var m_2_6_thousands;
	private var m_appl1;
	
	private macro initialize()
		m_decodes       = TFForBisExportController_decodes();
		m_2_6_rouble    = TFForBisExportController_2_6("руб.");
		m_2_6_thousands = TFForBisExportController_2_6("тыс.");
		m_appl1         = TFForBisExportController_1();
	end;
	
	/**
     * Вернуть Контроллер экспорта

     * @param     operation идентификатор операции
     *
     * @return    возвращает требуемый Контроллер экспорта
     */
    macro getController(operation : String) : RcbBiscuitExportController
        if   (operation == "decods") //"Расшифровки по лицевым счетам (руб.)")
			return m_decodes;
		elif (operation == "appl2_6_units") //"Приложения 2..6 (руб.)")
			return m_2_6_rouble;
		elif (operation == "appl2_6_thousands") //"Приложения 2..6 (тыс.)")
			return m_2_6_thousands;
		elif (operation == "appl1") //"Приложение 1 (тыс.)")
			return m_appl1;
		else
			return null;
		end;
    end;
	
	initialize();
end;

class (TForBiscuitExportControllersBase) TForBiscuitExportControllers_5242()
	private macro initialize()
		m_decodes       = TFForBisExportController_decodes();
		m_2_6_rouble    = TFForBisExportController_2_6_5242("руб.");
		m_2_6_thousands = TFForBisExportController_2_6_5242("тыс.");
		m_appl1         = TFForBisExportController_1();
	end;
	initTForBiscuitExportControllersBase();
end;

macro getForBiscuitExportControllers()
	if (RcbApplication.currentReport.context.period.endDate >= RCB_I5242_DATE)
		return TForBiscuitExportControllers_5242();
	else
		return TForBiscuitExportControllersBase();
	end;
end;
