/*
$Name:          TApplication_507.mac
$Module:        Регламентируемая отчетность
$Description:   ФОР. Классы приложений ФОР по 507-П
*/

/**
 * Зона подписей печатных форм приложений отчета по 507-П
 *
 * @author ABP
 * @since v6.20.031.039
 */

const AC_REPORT_DATE = 100; //Печатать дату отчета

private class (TSignatureZone) TFForSignatureZone()
    macro print(reportWidth)
        var datePrintableReport = string(m_reportIssueDate : f : m);

        var lenFPA = strLen(m_firstPersonAppointment);
        var lenSPA = strLen(m_secondPersonAppointment);
        var lenEx  = strLen("Исполнитель");
        var lenPh  = strLen("телефон:");
        var lenDPR = strLen(datePrintableReport);

        var maxLen = max(
                         max(lenFPA,lenSPA),
                         max(lenEx,
                             max(lenPh,lenDPR)
                            )
                        ) + 4;

        println();

        if (not isAttributeExcluded(AC_FIRST_PERSON))
            println(strAlign(m_firstPersonAppointment  + mkstr(" ", maxLen - lenFPA) + m_firstPersonName,  reportWidth, STR_ALIGN_LEFT));
        end;
        if (not isAttributeExcluded(AC_SECOND_PERSON))
            println(strAlign(m_secondPersonAppointment + mkstr(" ", maxLen - lenSPA) + m_secondPersonName, reportWidth, STR_ALIGN_LEFT));
        end;

        println(strAlign("М.П.", reportWidth, STR_ALIGN_LEFT));

        if (not isAttributeExcluded(AC_EXECUTOR))
            println(strAlign("Исполнитель"             + mkstr(" ", maxLen - lenEx)  + m_executorName  ,   reportWidth, STR_ALIGN_LEFT));
            [ ];
            [______________________  ___________________________];
            [      (подпись)             (инициалы, фамилия)];
        end;
        if (not isAttributeExcluded(AC_EXECUTOR_PHONE_NUMBER))
            println(strAlign("телефон:"                + mkstr(" ", maxLen - lenPh)  + m_executorPhoneNumber, reportWidth, STR_ALIGN_LEFT));
        end;
        println(strAlign(datePrintableReport, reportWidth, STR_ALIGN_LEFT));
    end;

    private macro constructorTFForSignatureZone()
        initTSignatureZone();
    end;

    constructorTFForSignatureZone();
end;

/**
 * Зона подписей печатных форм приложений отчета по 4217-У
 *
 * @author ABP
 * @since v6.20.031.039
 */
private class (TSignatureZone) TFForSignatureZone_4217()
    macro print(reportWidth)
        defaultParm(reportWidth, 80);
        var datePrintableReport = string(m_reportIssueDate : f : m);

        var paText = "(должность)";
        var lenPA  = max(max(strLen(m_firstPersonAppointment), strLen(paText)), strLen(m_secondPersonAppointment));
        var exText = "Исполнитель";
        var lenEx  = max(strLen(exText), strLen(m_executorName));
        var signatureText = "(подпись)";
        var surnameText = "(инициалы, фамилия)";
        var phoneText = "Tелефон: ";
        var signatureLine = "______________________";
        var lenDPR = strLen(datePrintableReport);
        var lenPaName = max(strLen(m_firstPersonName), strLen(m_secondPersonName));

        println();
        println(strAlign("Уполномоченное лицо кредитной организации", reportWidth, STR_ALIGN_LEFT));

        if (not isAttributeExcluded(AC_FIRST_PERSON))
            printLn();
            printLn(strAlign(m_firstPersonAppointment, lenPA + 2, STR_ALIGN_CENTER) + mkstr(" ", strLen(signatureLine) + 2) + strAlign(m_firstPersonName,  lenPaName + 2, STR_ALIGN_CENTER));
            printLn(mkStr("_", lenPA + 2) + " " + signatureLine + " " + mkStr("_", lenPaName + 2));
            printLn(strAlign(paText, lenPa + 2, STR_ALIGN_CENTER) + " " + strAlign(signatureText, strLen(signatureLine), STR_ALIGN_CENTER) + " " + strAlign(surnameText, lenPaName + 2, STR_ALIGN_CENTER));
        end;

        if (not isAttributeExcluded(AC_SECOND_PERSON))
            printLn();
            printLn(strAlign(m_secondPersonAppointment, lenPA + 2, STR_ALIGN_CENTER) + mkstr(" ", strLen(signatureLine) + 2) + strAlign(m_secondPersonName,  lenPaName + 2, STR_ALIGN_CENTER));
            printLn(mkStr("_", lenPA + 2) + " " + signatureLine + " " + mkStr("_", lenPaName + 2));
            printLn(strAlign(paText, lenPa + 2, STR_ALIGN_CENTER) + " " + strAlign(signatureText, strLen(signatureLine), STR_ALIGN_CENTER) + " " + strAlign(surnameText, lenPaName + 2, STR_ALIGN_CENTER));
        end;

        printLn();
        println(strAlign("М.П. (при наличии)", reportWidth, STR_ALIGN_LEFT));
        println();

        if (not isAttributeExcluded(AC_EXECUTOR))
            printLn(exText);
            printLn(mkstr(" ", strLen(signatureLine) + 1) + strAlign(m_executorName,  lenEx + 2, STR_ALIGN_CENTER));
            printLn(signatureLine + " " + mkStr("_", lenEx + 2));
            printLn(strAlign(signatureText, strLen(signatureLine), STR_ALIGN_CENTER) + " " + strAlign(surnameText, lenEx + 2, STR_ALIGN_CENTER));
        end;

        if (not isAttributeExcluded(AC_EXECUTOR_PHONE_NUMBER))
            printLn();
            println(phoneText + mkStr(" ", strLen(signatureLine) - strLen(phoneText) + 1) + m_executorPhoneNumber);
        end;

        if (not isAttributeExcluded(AC_REPORT_DATE))
            println(strAlign(datePrintableReport, reportWidth, STR_ALIGN_LEFT));
        end;
    end;

    private macro constructorTFForSignatureZone_4217()
        initTSignatureZone();
    end;

    constructorTFForSignatureZone_4217();
end;

/**
 * Зона подписей печатных форм приложений отчета по 5036-У
 *
 * @author ABP
 * @since v6.20.031.039
 */
private class (TSignatureZone) TFForSignatureZone_5036()
    macro print(reportWidth)
        defaultParm(reportWidth, 80);
        var datePrintableReport = string(m_reportIssueDate : f : m);

        var paText = "(должность)";
        var lenPA  = max(max(strLen(m_firstPersonAppointment), strLen(paText)), strLen(m_secondPersonAppointment));
        var exText = "Исполнитель";
        var lenEx  = max(strLen(exText), strLen(m_executorName));
        var signatureText = "(подпись)";
        var surnameText = "(инициалы, фамилия)";
        var phoneText = "Tелефон: ";
        var signatureLine = "______________________";
        var lenDPR = strLen(datePrintableReport);
        var lenPaName = max(strLen(m_firstPersonName), strLen(m_secondPersonName));

        println();
        println(strAlign("Уполномоченное лицо кредитной организации", reportWidth, STR_ALIGN_LEFT));

        if (not isAttributeExcluded(AC_FIRST_PERSON))
            printLn();
            printLn(strAlign(m_firstPersonAppointment, lenPA + 2, STR_ALIGN_CENTER) + mkstr(" ", strLen(signatureLine) + 2) + strAlign(m_firstPersonName,  lenPaName + 2, STR_ALIGN_CENTER));
            printLn(mkStr("_", lenPA + 2) + " " + signatureLine + " " + mkStr("_", lenPaName + 2));
            printLn(strAlign(paText, lenPa + 2, STR_ALIGN_CENTER) + " " + strAlign(signatureText, strLen(signatureLine), STR_ALIGN_CENTER) + " " + strAlign(surnameText, lenPaName + 2, STR_ALIGN_CENTER));
        end;

        if (not isAttributeExcluded(AC_SECOND_PERSON))
            printLn();
            printLn(strAlign(m_secondPersonAppointment, lenPA + 2, STR_ALIGN_CENTER) + mkstr(" ", strLen(signatureLine) + 2) + strAlign(m_secondPersonName,  lenPaName + 2, STR_ALIGN_CENTER));
            printLn(mkStr("_", lenPA + 2) + " " + signatureLine + " " + mkStr("_", lenPaName + 2));
            printLn(strAlign(paText, lenPa + 2, STR_ALIGN_CENTER) + " " + strAlign(signatureText, strLen(signatureLine), STR_ALIGN_CENTER) + " " + strAlign(surnameText, lenPaName + 2, STR_ALIGN_CENTER));
        end;

        printLn();
        println(strAlign("М.П. (при наличии)", reportWidth, STR_ALIGN_LEFT));
        println();

        if (not isAttributeExcluded(AC_EXECUTOR))
            printLn(exText);
            printLn(mkstr(" ", strLen(signatureLine) + 1) + strAlign(m_executorName,  lenEx + 2, STR_ALIGN_CENTER));
            printLn(signatureLine + " " + mkStr("_", lenEx + 2));
            printLn(strAlign(signatureText, strLen(signatureLine), STR_ALIGN_CENTER) + " " + strAlign(surnameText, lenEx + 2, STR_ALIGN_CENTER));
        end;

        if (not isAttributeExcluded(AC_EXECUTOR_PHONE_NUMBER))
            printLn();
            println(phoneText + mkStr(" ", strLen(signatureLine) - strLen(phoneText) + 1) + m_executorPhoneNumber);
        end;

        if (not isAttributeExcluded(AC_REPORT_DATE))
            println(strAlign(datePrintableReport, reportWidth, STR_ALIGN_LEFT));
        end;
    end;

    macro getPhone()
        return m_executorPhoneNumber;
    end;

    macro getDate()
        return string(m_reportIssueDate : f );
    end;

    macro getSigner()
        if (not isAttributeExcluded(AC_FIRST_PERSON))
            return m_firstPersonAppointment;
        elif (not isAttributeExcluded(AC_SECOND_PERSON))
            return m_secondPersonAppointment;
        end;
    end;

    macro getSignerName()
        if (not isAttributeExcluded(AC_FIRST_PERSON))
            return m_firstPersonName;
        elif (not isAttributeExcluded(AC_SECOND_PERSON))
            return m_secondPersonName;
        end;
    end;



    macro getExecutor()
        return m_executorName;
    end;

    private macro constructorTFForSignatureZone_5036()
        initTSignatureZone();
    end;

    constructorTFForSignatureZone_5036();
end;

class (TNamesZone_4212) TFForNamesZoneExcel_5036(formName, formOkudCode, formPeriodicity, periodFormat)
    initTNamesZone_4212(formName, formOkudCode, formPeriodicity, periodFormat);

    macro getPeriodicityName()
        return "Ежемесячно";
    end;

    macro getUnitName()
        return getUnitName()
    end;

    macro getFormName()
        return m_formName;
    end;

    macro getPeriodName()
        const template1 = "за ";
        const template2 = "за период с ";
        const template3 = " года";

        var month : String = "";
        var year  : String = "";
        var dateString     = "";
        var dateWidth      = 0;
        var pre            = "";  //пустая (пробельная) подстрока перед выводом подчеркивания
        var result         = "";

        if (m_report.context.period.kind == RCB_PK_MONTH)
            dateSplit(global.parameters.getBeginDate(), NULL, month, year);

            dateString = strLwr(monName(int(month))) + " " + string(year);
            result = template1 + dateString + template3
        else
            dateString = String(global.parameters.getBeginDate():f, " по ", global.parameters.getEndDate():f);
            result = template2 + dateString;
        end;
        return result;
    end;

end;


/**
 * Базовый класс экспорта в kliko.exe для приложений отчета по 507-П
 *
 * @author ABP
 * @since v6.20.031.039
 */
private class TApplicationKlikoExporter()
    macro export(data : Object)
        var i = 0;

        while (i < data.size)
            data[i].exportToKliko();
            i = i + 1;
        end;
    end;

    private macro constructorTApplicationKlikoExporter()
    end;

    constructorTApplicationKlikoExporter();
end;

/**
 * Базовый класс экспорта в ПТК ПСД для приложений отчета по 507-П
 *
 * @author ABP
 * @since v6.20.031.039
 */
private class TApplicationPtkPsdExporter()
    macro export(data : Object)
        var i = 0;

        while (i < data.size)
            data[i].exportToPtkPsd();
            i = i + 1;
        end;
    end;

    private macro constructorTApplicationPtkPsdExporter()
    end;

    constructorTApplicationPtkPsdExporter();
end;

/**
 * Базовый класс приложений отчета по 507-П
 * Скопирован из TApplication и дополнен/переопределён из TApplication342. Выполнен рефакторинг
 *
 * @author ABP
 * @since v6.20.031.039
 */
class TApplication507()
    const GORIZONTAL_BOUNDARY = 196;    //196 - ASCII-код символа "─"

    private var m_name            : String;
    private var m_balanceMasksSet : TRcbSet;
    private var m_reportWidth     : Integer;
    private var m_report          : Object;
    private var m_rows            : TArray;
    private var m_numberDatesInOneBlock : Integer;
    private var m_isFistBlock           : Bool;
    private var m_applicationLength     : Integer;
    private var m_klikoExporter : Object;
    private var m_ptkPsdExporter : Object;

    private macro unionArray(arr1, arr2)
        var i = 0;
        while (i < arr1.size)
            arr1[i] = arr1[i] + arr2[i];
            i = i + 1;
        end;
    end;

    private macro printArray(stringArray : TArray)
        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

//    private macro getPeriod()
//        var month : String = "";
//        var year  : String = "";
//
//        if (m_report.context.period.kind == RCB_PK_MONTH)
//            dateSplit(global.parameters.getBeginDate(), NULL, month, year);
//
//            return strLwr(monName(int(month))) + " " + string(year) + " г.";
//        else
//            return String("за период с ", global.parameters.getBeginDate():f," по ", (global.parameters.getEndDate() + 1):f );
//        end;
//    end;

    //печать даты отчета
    private macro printPeriod()
        const template1 = "за ";
        const template2 = "за период с ";
        const template3 = " года";

        var month : String = "";
        var year  : String = "";
        var dateString     = "";
        var dateWidth      = 0;
        var pre            = "";  //пустая (пробельная) подстрока перед выводом подчеркивания

        if (m_report.context.period.kind == RCB_PK_MONTH)
            dateSplit(global.parameters.getBeginDate(), NULL, month, year);

            dateString = strLwr(monName(int(month))) + " " + string(year);
            dateWidth  = strLen(dateString);
            pre = mkstr(" ", (m_applicationLength - (strLen(template1) + dateWidth + strLen(template3)))/2);

            printLn(pre + template1 + dateString + template3);
            printLn(pre + mkstr(" ", StrLen(template1)) + mkstr(GORIZONTAL_BOUNDARY, dateWidth));
        else
            dateString = String(global.parameters.getBeginDate():f," по ", (global.parameters.getEndDate() + 1):f);
            dateWidth  = StrLen(dateString);
            pre = mkstr(" ", (m_applicationLength - (StrLen(template2) + dateWidth))/2);

            printLn(pre + template2 + dateString);
            printLn(pre + mkstr(" ", StrLen(template2)) + mkstr(GORIZONTAL_BOUNDARY, dateWidth));
        end;
    end;

    //печать наименования кредитной организации
    private macro printNameLendingAgency()
        var attrTitle = ternary(global.parameters.getEndDate() < RCB_I1951_DATE,
                                "Наименование кредитной организации ",
                                "Полное или сокращенное фирменное наименование кредитной организации ");
        var arr = strTransferByWord(attrTitle + {Name_Bank}, m_applicationLength);
        var pre = "";  //пустая (пробельная) подстрока перед выводом подчеркивания

        printLn();

        var i = 0;

        while (i < arr.size)
            printLn(arr[i]);
            if (i == 0)
                pre = mkstr(" ", StrLen(attrTitle));
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(arr[i]) - StrLen(attrTitle)));
            else
                pre = "";
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(trim(arr[i]))));
            end;

            i = i + 1;
        end;
    end;

    //печать почтового адреса КО
    private macro printPostalAddress()
        var addressTitle = "Почтовый адрес ";
        var arr = strTransferByWord(addressTitle + TNamesZone().getLendingAgencyPostalAdress(), m_applicationLength);
        var pre = "";  //пустая (пробельная) подстрока перед выводом подчеркивания

        var i = 0;

        while (i < arr.size)
            printLn(arr[i]);
            if (i == 0)
                pre = mkstr(" ", StrLen(addressTitle));
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(arr[i]) - StrLen(addressTitle)));
            else
                pre = "";
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(trim(arr[i]))));
            end;

            i = i + 1;
        end;
    end;

    private macro getDateAsString(reportDate : Date) : String
        if (in(reportDate, global.parameters.getBeginDate(), global.parameters.getEndDate() + 1))
            return String(reportDate:f) + "(1)";
        end;

        return String(reportDate:f) + "   ";
    end;

    private macro printHeader()
    end;

    private macro printBody(beginDateInBlock)
        var i : Integer = 0;
        while (i < m_rows.size)
            m_rows[i].print(ternary(m_applicationLength == null, m_reportWidth, m_applicationLength), beginDateInBlock, m_numberDatesInOneBlock);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
    end;

    private macro printFooter()
        var nameBoss  : String = {Name_Boss};
        var maxLength : Integer = max(strLen({Name_Boss}), strLen({Name_Book}));
        nameBoss = strRPad({Name_Boss}, maxLength, " ");

        [                              ];
        [                              ];
        [Уполномоченное лицо кредитной организации          ];
        [ ];
        [_______________________  ______________________  ___________________________];
        [     (должность)               (подпись)             (инициалы, фамилия)];
        [                              ];
        [М.П.(при наличии)             ];
        [                              ];

        printFooterComments();
    end;

    private macro initializeBalanceMasksSet()
        var set = TRcbSet();

        macro fillSet(str : String)
            var pos : Integer = index(str, ",");

            if (pos > 0)
                while (pos > 0)
                    set.insert(trim(substr(str, 1, pos - 1)));
                    str = trim(substr(str, pos + 1));
                    pos = index(str, ",");
                end;
            end;

            if (str != "")
                set.insert(trim(str));
            end;
        end;

        var i = 0;
        while (i < m_rows.size)
            fillSet(m_rows[i].getBalanceMasks());
            fillSet(m_rows[i].getDecodingBalanceMasks());
            i = i + 1;
        end;

        m_balanceMasksSet = set;
    end;

    macro getName()
        return m_name;
    end;

    private macro getValueIterator(isFilter : bool)

        var attributeValue = m_report.attributeValue(m_name);
        var iterator = attributeValue.createValueIterator();

        if (isFilter)
            iterator.setFilter(FILTER_FOR_NONZERO_REST);
        end;

        return iterator;
    end;

    macro isEmpty()
        if ((m_name == "Приложение1") or (m_name == "ОтчетОбОтсутствииОстатков"))
            return false;
        end;

        return getValueIterator(true).count == 0;
    end;

    private macro printBlocks()

        var fistDateInBlock = global.parameters.getBeginDate();

        if ((m_name == "Приложение1") or (m_name == "ОтчетОбОтсутствииОстатков"))
            printHeader();
            printBody();
            printFooter();
        else
            while (fistDateInBlock <= global.parameters.getEndDate() + 1)
                printHeader(fistDateInBlock);
                printBody(fistDateInBlock);
                fistDateInBlock = fistDateInBlock + m_numberDatesInOneBlock;
            end;
            printFooter();
        end;
    end;

    macro print()
        var iterator : Object = NULL;
        if (m_name == "Приложение1")
            iterator = getValueIterator(false);
            iterator.moveFirst();
            if (iterator.isDone())
                RepErrorsQueue().add(0, "Операция печати ФОР. Для выполнения операции печати необходимо рассчитать отчет.");
                msgBox("Операция печати ФОР. Для выполнения операции печати необходимо рассчитать отчет.");
                установитьФлагВозврата(STOP_PROC_FLG);
                exit(1);
            end;
        end;

        if ((not isEmpty) or (global.parameters.isPrintApplicationZero()))
            printBlocks();
        end;
    end;

    macro fillTempTable(tempTable : TTempTable)
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].fillTempTable(tempTable);
            i = i + 1;
        end;
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].fillTempTableForBalanceData(tempTable);
            i = i + 1;
        end;
    end;

    macro normalizeDecoding()
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].normalizeDecoding();
            i = i + 1;
        end;
    end;

    macro getBalanceMasksSet()
        if (m_balanceMasksSet == NULL)
            initializeBalanceMasksSet();
        end;
        return m_balanceMasksSet;
    end;

    macro getRow(code : String)
        var i = 0;
        while (i < m_rows.size)
            if (m_rows[i].getCode == code)
                return m_rows[i];
            end;
            i = i + 1;
        end;

        return NULL;
    end;

    macro saveAttributes()
        var i = 0;

        while (i < m_rows.size)
            m_rows[i].saveAttributes();
            i = i + 1;
        end;
    end;

    macro completeAttributes()
        var i = 0;

        while (i < m_rows.size)
            m_rows[i].completeAttributes();
            i = i + 1;
        end;
    end;

    macro exportToPtkPsd()
        m_ptkPsdExporter.export(m_rows);
    end;

    macro exportToKliko()
        m_klikoExporter.export(m_rows);
    end;

    macro calculateNumberBlocks()
        m_reportWidth           = global.parameters.getReportLength();
        m_numberDatesInOneBlock = int((m_reportWidth-50)/30);
        var dateCount           = global.parameters.getEndDate() + 2 - global.parameters.getBeginDate();
        if (m_numberDatesInOneBlock > dateCount)
            m_numberDatesInOneBlock = dateCount;
        end;
    end;

    //печать заголовка приложения
    macro printApplicationTitle()
        var strArray = StrCut(global.getAppTitle(m_name), "\n", false);
        for (var counter, 0, strArray.Size - 1)
            printLn(strAlign(strArray(counter), m_applicationLength, STR_ALIGN_CENTER));
        end;
    end;

    macro updateBalanceValues()
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].updateBalanceValues();
            i = i + 1;
        end;
    end;

    private macro constructorTApplication507()
        m_report = RcbApplication().currentReport;
        m_rows = TArray();
        m_numberDatesInOneBlock = 0;
        m_isFistBlock = true;
        m_applicationLength = null;
        m_klikoExporter = null;
        m_ptkPsdExporter = null;
    end;

    constructorTApplication507();
end;

/***************************************************************************************************
 *  Класс Приложения 1
 **************************************************************************************************/
private class (TApplicationKlikoExporter) TApplicationKlikoExporter_1()
    macro export(data : Object)
        var valueArray = TArray();

        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P1VV");
        else
            global.klikoExportFile.printID("F_P1M");
        end;

        valueArray[valueArray.size] = "NBNR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NFLR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNaturalPersonRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIOR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NBNV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NFLV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNaturalPersonCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIOV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        export(data);
    end;

    private macro constructorTApplicationKlikoExporter_1()
        initTApplicationKlikoExporter();
    end;

    constructorTApplicationKlikoExporter_1();
end;

private class (TApplicationPtkPsdExporter) TApplicationPtkPsdExporter_1()
    macro export(data : Object)
        export(data);
    end;

    private macro constructorTApplicationPtkPsdExporter_1()
        initTApplicationPtkPsdExporter();
    end;

    constructorTApplicationPtkPsdExporter_1();
end;

class (TApplication507) TApplication507_1()
    private macro printHeader()
        var okatoCode = substr(Код_СОАТО, 1, 5);
        okatoCode = nvl(String(okatoCode) + MkStr("0", 5 - strlen(String(okatoCode))), "");

        [                                                                  Приложение 1 ];
        [                                                      к Положению Банка России ];
        [                                                от 1 декабря 2015 года № 507-П ];
        [                                                     "Об обязательных резервах ];
        [                                                        кредитных организаций" ];
        [                                                                               ];
        [           ┌────────────────────┬─────────────────────────────────────────────┐];
        [           │   Код территории   │          Код кредитной организации          │];
        [           │      по ОКАТО      ├────────────────┬────────────────────────────┤];
        [           │                    │    по ОКПО     │   Регистрационный номер    │];
        [           ├────────────────────┼────────────────┼────────────────────────────┤];
        [           │####################│############### │############################│](okatoCode:c, Код_ОКПО:c, РегНомерБанка:c);
        [           └────────────────────┴────────────────┴────────────────────────────┘];
        [                                                                               ];
        [###############################################################################](global.getAppTitle(m_name):c:w);
        printPeriod();
        [                                     (отчетный период)                         ];
        [                                                                               ];
        printNameLendingAgency();
        printPostalAddress();
        [                                                                               ];
        [                                                                    Ежемесячно ];
        [                                                                     тыс. руб. ];
    end;

    private macro printFooter()
        var m_signature = TFForSignatureZone();
        m_signature.clearExcludeAttributes();
        m_signature.excludeAttribute(AC_SECOND_PERSON);

        [Уполномоченное лицо кредитной организации          ];
        [ ];
        [_______________________  ______________________  ___________________________];
        [     (должность)               (подпись)             (инициалы, фамилия)];
        m_signature.print(80);
        [______________________________];

        [ ############################################################################# ]("(1) Приводятся показатели приложения 2 к настоящему Положению.":w);
        [ ############################################################################# ]("(2) Заполняется кредитной организацией при намерении получить право на усреднение обязательных резервов. В ином случае проставляется нулевое значение. Коэффициент усреднения указывается в числовом выражении в интервале от 0 до 1.":w);
        [ ############################################################################# ]("(3) Указывается фактический остаток средств обязательных резервов на счетах по учету обязательных резервов, счете по учету обязательных резервов при невыполнении обязанности по усреднению на дату, установленную для представления Расчета.":w);
    end;

    macro constructorTApplication507_1()
        initTApplication507();

        m_name = "Приложение1";
        m_reportWidth = 80;
        m_applicationLength = 80;
        m_klikoExporter = TApplicationKlikoExporter_1();
        m_ptkPsdExporter = TApplicationPtkPsdExporter_1();

        m_rows[m_rows.size] = TApplicationRow507_1_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_1_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_1_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_1_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_1_4(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_1_5(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_1_6(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_4(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_5(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_6(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_7(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_8(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_9(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_2_10(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_3_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_3_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_3_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_4(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_4_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_4_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_5(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_5_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_5_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_1_5_3(m_name);
    end;

    constructorTApplication507_1();
end;

/***************************************************************************************************
 *  Класс Приложения 2
 **************************************************************************************************/
private class (TApplicationKlikoExporter) TApplicationKlikoExporter_2()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P2V");
        else
            global.klikoExportFile.printID("F_P2");
        end;

        export(data);
    end;

    private macro constructorTApplicationKlikoExporter_2()
        initTApplicationKlikoExporter();
    end;

    constructorTApplicationKlikoExporter_2();
end;

private class (TApplicationPtkPsdExporter) TApplicationPtkPsdExporter_2()
    macro export(data : Object)
        export(data);
    end;

    private macro constructorTApplicationPtkPsdExporter_2()
        initTApplicationPtkPsdExporter();
    end;

    constructorTApplicationPtkPsdExporter_2();
end;

class (TApplication507) TApplication507_2()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        на " + getDateAsString(restDate) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ иностранная  │";
                arr[arr.size] = "              │   валюта в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/
                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по балансовому счету,",                m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("по коду обозначения",                          m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("на каждую календарную дату отчетного периода", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;


            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета,         │";
            stringArray[stringArray.size] = "│      │            код обозначения              │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate() + 1))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                  Приложение 2 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. руб. ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
        printarray(StrTransferByWord("(2) Показатель рассчитывается по формуле средней хронологической величины, указанной в пункте 1 приложения 9 к настоящему Положению." , m_applicationLength));
    end;

    macro normalizeDecoding()
        var iterator = TApplicationRow(m_name).getAttributeValueIterator(m_name);
        var i = 0;

        iterator.moveFirst();
        while (not iterator.isDone())
            if (iterator.currentItem.fieldValue("roubleRest").exact < $0.0)
                iterator.currentItem.fieldValue("roubleRest").scaled = $0.0;
            end;
            if (iterator.currentItem.fieldValue("currencyRest").exact < $0.0)
                iterator.currentItem.fieldValue("currencyRest").scaled = $0.0;
            end;
            iterator.moveNext();
        end;

        normalizeDecoding();
    end;

    private macro constructorTApplication507_2()
        initTApplication507();

        m_name = "Приложение2";
        m_reportWidth = 80;
        m_klikoExporter = TApplicationKlikoExporter_2();
        m_ptkPsdExporter = TApplicationPtkPsdExporter_2();

        m_rows[m_rows.size] = TApplicationRow507_2_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_1_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_1_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_1_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_1_4(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_1_5(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_2_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_2_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_2_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_3_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_3_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_3_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_3_4(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_3_5(m_name);
        m_rows[m_rows.size] = TApplicationRow507_2_3_6(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication507_2();
end;

/***************************************************************************************************
 *  Класс Приложения 3
 **************************************************************************************************/
private class (TApplicationKlikoExporter) TApplicationKlikoExporter_3()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P3V");
        else
            global.klikoExportFile.printID("F_P3");
        end;

        export(data);
    end;

    private macro constructorTApplicationKlikoExporter_3()
        initTApplicationKlikoExporter();
    end;

    constructorTApplicationKlikoExporter_3();
end;

private class (TApplicationPtkPsdExporter) TApplicationPtkPsdExporter_3()
    macro export(data : Object)
        export(data);
    end;

    private macro constructorTApplicationPtkPsdExporter_3()
        initTApplicationPtkPsdExporter();
    end;

    constructorTApplicationPtkPsdExporter_3();
end;

class (TApplication507) TApplication507_3()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        на " + getDateAsString(restDate:f) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ иностранная  │";
                arr[arr.size] = "              │   валюта в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/
                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по отдельному лицевому счету,",        m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("по коду обозначения",                          m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("на каждую календарную дату отчетного периода", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета          │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate() + 1))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                  Приложение 3 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. руб. ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printArray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    private macro constructorTApplication507_3()
        initTApplication507();

        m_name = "Приложение3";
        m_reportWidth = 80;
        m_klikoExporter = TApplicationKlikoExporter_3();
        m_ptkPsdExporter = TApplicationPtkPsdExporter_3();

        m_rows[m_rows.size] = TApplicationRow507_3_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_3_1_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_3_1_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_3_1_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_3_1_4(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication507_3();
end;

/***************************************************************************************************
 *  Класс Приложения4
 **************************************************************************************************/
private class (TApplicationKlikoExporter) TApplicationKlikoExporter_4()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P4V");
        else
            global.klikoExportFile.printID("F_P4N");
        end;

        export(data);
    end;

    private macro constructorTApplicationKlikoExporter_4()
        initTApplicationKlikoExporter();
    end;

    constructorTApplicationKlikoExporter_4();
end;

private class (TApplicationPtkPsdExporter) TApplicationPtkPsdExporter_4()
    macro export(data : Object)
        export(data);
    end;

    private macro constructorTApplicationPtkPsdExporter_4()
        initTApplicationPtkPsdExporter();
    end;

    constructorTApplicationPtkPsdExporter_4();
end;

class (TApplication507) TApplication507_4()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        на " + getDateAsString(restDate:f) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "   в рублях   │ иностранная  │";
                arr[arr.size] = "              │   валюта в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/

                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по балансовому счету,",                m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("отдельному лицевому счету балансового счета,", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("коду обозначения ",                            m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[4] = substr(stringArray[4], 1, POS) + strAlign("на каждую календарную дату отчетного периода", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │         Наименование показателя,        │";
            stringArray[stringArray.size] = "│строки│         номер балансового счета         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate() + 1))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                   Приложение 4 ", m_applicationLength, " "));
            printLn(strLpad("       к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года  № 507-П ", m_applicationLength, " "));
            printLn(strLpad("     \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("        кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. руб. ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России.", m_applicationLength));
        printarray(StrTransferByWord("(2) Балансовый счет № 52005 включается в настоящее приложение за минусом остатков по коду обозначения 520051, указанному в приложении 2 к настоящему Положению.", m_applicationLength));
        printarray(StrTransferByWord("(3) Корректировочный коэффициент указывается в числовом выражении в интервале от 0 до 1.", m_applicationLength));
    end;

    private macro constructorTApplication507_4()
        initTApplication507();

        m_name = "Приложение4";
        m_reportWidth = 80;
        m_klikoExporter = TApplicationKlikoExporter_4();
        m_ptkPsdExporter = TApplicationPtkPsdExporter_4();

        m_rows[m_rows.size] = TApplicationRow507_4_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_4_1_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_4_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_4_3(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication507_4();
end;

/***************************************************************************************************
 *  Класс Приложения 5
 **************************************************************************************************/
private class (TApplicationKlikoExporter) TApplicationKlikoExporter_5()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P5V");
        else
            global.klikoExportFile.printID("F_P5N");
        end;

        export(data);
    end;

    private macro constructorTApplicationKlikoExporter_5()
        initTApplicationKlikoExporter();
    end;

    constructorTApplicationKlikoExporter_5();
end;

private class (TApplicationPtkPsdExporter) TApplicationPtkPsdExporter_5()
    macro export(data : Object)
        export(data);
    end;

    private macro constructorTApplicationPtkPsdExporter_5()
        initTApplicationPtkPsdExporter();
    end;

    constructorTApplicationPtkPsdExporter_5();
end;

class (TApplication507) TApplication507_5()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "─────────────────┬";
                arr[arr.size] = "                 │";
                arr[arr.size] = "на " + getDateAsString(restDate:f) + " │";
                arr[arr.size] = "                 │";
                arr[arr.size] = "─────────────────┼";
                arr[arr.size] = "      " + strLPad(String(number + 1), 2, " ") + "         │";

                return arr;
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета          │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate() + 1))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
        m_isFistBlock = false;
            printLn(strLpad("                  Приложение 5 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. руб. ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    macro calculateNumberBlocks()
        m_reportWidth  = global.parameters.getReportLength();

        const HEADER_BLOCK_WIDTH = 50;

        const DATA_BLOCK_WIDTH   = 18;

        m_numberDatesInOneBlock = int((m_reportWidth - HEADER_BLOCK_WIDTH)/DATA_BLOCK_WIDTH);

        var dateCount = global.parameters.getEndDate() + 2 - global.parameters.getBeginDate();
        if (m_numberDatesInOneBlock > dateCount)
            m_numberDatesInOneBlock = dateCount;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    private macro constructorTApplication507_5()
        initTApplication507();

        m_name = "Приложение5";
        m_reportWidth = 80;
        m_klikoExporter = TApplicationKlikoExporter_5();
        m_ptkPsdExporter = TApplicationPtkPsdExporter_5();

        m_rows[m_rows.size] = TApplicationRow507_5_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_5_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_5_3(m_name);
        m_rows[m_rows.size] = TApplicationRow507_5_4(m_name);
        m_rows[m_rows.size] = TApplicationRow507_5_5(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication507_5();
end;

/***************************************************************************************************
 *  Класс Приложения 6
 **************************************************************************************************/
private class (TApplicationKlikoExporter) TApplicationKlikoExporter_6()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P6V");
        else
            global.klikoExportFile.printID("F_P6N");
        end;

        export(data);
    end;

    private macro constructorTApplicationKlikoExporter_6()
        initTApplicationKlikoExporter();
    end;

    constructorTApplicationKlikoExporter_6();
end;

private class (TApplicationPtkPsdExporter) TApplicationPtkPsdExporter_6()
    macro export(data : Object)
        export(data);
    end;

    private macro constructorTApplicationPtkPsdExporter_6()
        initTApplicationPtkPsdExporter();
    end;

    constructorTApplicationPtkPsdExporter_6();
end;

class (TApplication507) TApplication507_6()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        на " + getDateAsString(restDate) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ иностранная  │";
                arr[arr.size] = "              │   валюта в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/

                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по отдельному лицево-", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("му счету на каждую календар-",  m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("ную дату отчетного периода(1)", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";

            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │      Наименование показателя,           │";
            stringArray[stringArray.size] = "│строки│      номер балансового счета            │";
            stringArray[stringArray.size] = "│      │          второго порядка                │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate() + 1))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                   Приложение 6 ", m_applicationLength, " "));
            printLn(strLpad("       к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года  № 507-П ", m_applicationLength, " "));
            printLn(strLpad("     \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("        кредитных организаций\" ", m_applicationLength, " "));
            printLn();

            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. руб. ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1)При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    macro normalizeDecoding()
        var iterator = TApplicationRow(m_name).getAttributeValueIterator(m_name);
        var i = 0;

        iterator.moveFirst();
        while (not iterator.isDone())
            if (iterator.currentItem.fieldValue("roubleRest").exact < $0.0)
                iterator.currentItem.fieldValue("roubleRest").scaled = $0.0;
            end;
            if (iterator.currentItem.fieldValue("currencyRest").exact < $0.0)
                iterator.currentItem.fieldValue("currencyRest").scaled = $0.0;
            end;
            iterator.moveNext();
        end;

        normalizeDecoding();
    end;

    private macro constructorTApplication507_6()
        initTApplication507();

        m_name = "Приложение6";
        m_reportWidth = 80;
        m_klikoExporter = TApplicationKlikoExporter_6();
        m_ptkPsdExporter = TApplicationPtkPsdExporter_6();

        m_rows[m_rows.size] = TApplicationRow507_6_1(m_name);
        m_rows[m_rows.size] = TApplicationRow507_6_2(m_name);
        m_rows[m_rows.size] = TApplicationRow507_6_3(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication507_6();
end;

/***************************************************************************************************
 *  Класс отчета "ДАННЫЕ О ПРИЛОЖЕНИЯХ, НЕ ВОШЕДШИХ В СОСТАВ ОТЧЕТА"
 **************************************************************************************************/
private class (TApplicationKlikoExporter) TApplicationKlikoExporter_8()
    macro export(data : Object)
        export(data);
    end;

    private macro constructorTApplicationKlikoExporter_8()
        initTApplicationKlikoExporter();
    end;

    constructorTApplicationKlikoExporter_8();
end;

private class (TApplicationPtkPsdExporter) TApplicationPtkPsdExporter_8()
    macro export(data : Object)
        export(data);
    end;

    private macro constructorTApplicationPtkPsdExporter_8()
        initTApplicationPtkPsdExporter();
    end;

    constructorTApplicationPtkPsdExporter_8();
end;

class (TApplication507) TApplication507_8()
    var m_printedReport : Object;

    private macro printHeader()
        var numberStringWidth            : Integer = 6;
        var applicationNumberStringWidth : Integer = 16;
        var balanceListStringWidth       : Integer = 80;

        m_reportWidth = 2 + numberStringWidth + 3 + applicationNumberStringWidth + 3 + balanceListStringWidth + 2;

        m_printedReport.addColumn("Номер|строки", numberStringWidth, AL_CENTER);
        m_printedReport.addColumn("Номер приложения" , applicationNumberStringWidth, AL_CENTER);
        m_printedReport.addColumn("Балансовые счета",  balanceListStringWidth);

        printLn();

        m_applicationLength = m_reportWidth;
        printApplicationTitle();
        printPeriod();

        printNameLendingAgency();

        var i : Integer = 0;
        var arr = strTransferByWord(" В связи с нулевыми значениями по балансовым счетам (отдельным лицевым счетам) в течение отчетного периода в состав отчетности не включаются следующие приложения к расчету по Положению об обязательных резервах:", m_reportWidth);
        printLn();
        while (i < arr.size)
        printLn(strAlign(arr[i], m_reportWidth, STR_ALIGN_LEFT));
            i = i + 1;
        end;

        m_printedReport.printHead();
    end;

    private macro printFooter()
        var m_signature = TSignatureZone();
        var nameBoss  : String = {Name_Boss};
        var sign      : String = "       (подпись, ФИО)";
        var maxLength : Integer = max(strLen({Name_Boss}), strLen({Name_Book}));

        m_signature.clearExcludeAttributes();
        m_signature.excludeAttribute(AC_SECOND_PERSON);
        nameBoss = strRPad({Name_Boss}, maxLength, " ");
        sign     = strLPad(sign       , maxLength + strLen(sign), " ");

        [                              ];
        [                              ];
        [Уполномоченное лицо           ];
        [кредитной организации     #   ]((nameBoss + "______________________" + {FIO_Boss}):l);
        [                          #   ](sign);
        m_signature.print(80);
        [                              ];
    end;

    private macro printBody()
        var i : Integer = 0;
        while (i < m_rows.size)
            m_rows[i].print(m_printedReport);
            i = i + 1;
        end;
    end;

    private macro constructorTApplication507_8()
        initTApplication507();

        m_printedReport = CTableReport();

        m_name = "ОтчетОбОтсутствииОстатков";
        m_klikoExporter = TApplicationKlikoExporter_8();
        m_ptkPsdExporter = TApplicationPtkPsdExporter_8();

        m_rows[0] = TApplicationRow507_8(m_name);
    end;

    constructorTApplication507_8();
end;

/**
 * Базовый класс приложений отчета по 4217-У
 * Скопирован из TApplication и дополнен/переопределён из TApplication342. Выполнен рефакторинг
 *
 * @author ABP
 * @since v6.20.031.040
 */
class TApplication_4217()
    const GORIZONTAL_BOUNDARY = 196;    //196 - ASCII-код символа "─"

    private var m_name            : String;
    private var m_balanceMasksSet : TRcbSet;
    private var m_reportWidth     : Integer;
    private var m_report          : Object;
    private var m_rows            : TArray;
    private var m_numberDatesInOneBlock : Integer;
    private var m_isFistBlock           : Bool;
    private var m_applicationLength     : Integer;
    private var m_klikoExporter : Object;
    private var m_ptkPsdExporter : Object;

    private macro unionArray(arr1, arr2)
        var i = 0;
        while (i < arr1.size)
            arr1[i] = arr1[i] + arr2[i];
            i = i + 1;
        end;
    end;

    private macro printArray(stringArray : TArray)
        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    //печать даты отчета
    private macro printPeriod()
        const template1 = "за ";
        const template2 = "за период с ";
        const template3 = " года";

        var month : String = "";
        var year  : String = "";
        var dateString     = "";
        var dateWidth      = 0;
        var pre            = "";  //пустая (пробельная) подстрока перед выводом подчеркивания

        if (m_report.context.period.kind == RCB_PK_MONTH)
            dateSplit(global.parameters.getBeginDate(), NULL, month, year);

            dateString = strLwr(monName(int(month))) + " " + string(year);
            dateWidth  = strLen(dateString);
            pre = mkstr(" ", (m_applicationLength - (strLen(template1) + dateWidth + strLen(template3)))/2);

            printLn(pre + template1 + dateString + template3);
            printLn(pre + mkstr(" ", StrLen(template1)) + mkstr(GORIZONTAL_BOUNDARY, dateWidth));
        else
            dateString = String(global.parameters.getBeginDate():f, " по ", global.parameters.getEndDate():f);
            dateWidth  = StrLen(dateString);
            pre = mkstr(" ", (m_applicationLength - (StrLen(template2) + dateWidth))/2);

            printLn(pre + template2 + dateString);
            printLn(pre + mkstr(" ", StrLen(template2)) + mkstr(GORIZONTAL_BOUNDARY, dateWidth));
        end;
    end;

    //печать наименования кредитной организации
    private macro printNameLendingAgency()
        var attrTitle = "Полное или сокращенное фирменное наименование кредитной организации ";
        var arr = strTransferByWord(attrTitle + {Name_Bank}, m_applicationLength);
        var pre = "";  //пустая (пробельная) подстрока перед выводом подчеркивания

        printLn();

        var i = 0;

        while (i < arr.size)
            printLn(arr[i]);
            if (i == 0)
                pre = mkstr(" ", StrLen(attrTitle));
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(arr[i]) - StrLen(attrTitle)));
            else
                pre = "";
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(trim(arr[i]))));
            end;

            i = i + 1;
        end;
    end;

    //печать почтового адреса КО
    private macro printPostalAddress()
        var addressTitle = "Почтовый адрес ";
        var arr = strTransferByWord(addressTitle + TNamesZone().getLendingAgencyPostalAdress(), m_applicationLength);
        var pre = "";  //пустая (пробельная) подстрока перед выводом подчеркивания

        var i = 0;

        while (i < arr.size)
            printLn(arr[i]);
            if (i == 0)
                pre = mkstr(" ", StrLen(addressTitle));
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(arr[i]) - StrLen(addressTitle)));
            else
                pre = "";
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(trim(arr[i]))));
            end;

            i = i + 1;
        end;
    end;

    private macro getDateAsString(reportDate : Date) : String
        if (in(reportDate, global.parameters.getBeginDate(), global.parameters.getEndDate()))
            return String(reportDate:f) + "(1)";
        end;

        return String(reportDate:f) + "   ";
    end;

    private macro printHeader()
    end;

    private macro printBody(beginDateInBlock)
        var i : Integer = 0;
        while (i < m_rows.size)
            m_rows[i].print(ternary(m_applicationLength == null, m_reportWidth, m_applicationLength), beginDateInBlock, m_numberDatesInOneBlock);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
    end;

    private macro printFooter()
        var signature = TFForSignatureZone_4217();

        signature.clearExcludeAttributes();
        signature.excludeAttribute(AC_SECOND_PERSON);
        signature.excludeAttribute(AC_EXECUTOR);
        signature.excludeAttribute(AC_EXECUTOR_PHONE_NUMBER);
        signature.excludeAttribute(AC_REPORT_DATE);

        signature.print();

        printFooterComments();
    end;

    private macro initializeBalanceMasksSet()
        var set = TRcbSet();

        macro fillSet(str : String)
            var pos : Integer = index(str, ",");

            if (pos > 0)
                while (pos > 0)
                    set.insert(trim(substr(str, 1, pos - 1)));
                    str = trim(substr(str, pos + 1));
                    pos = index(str, ",");
                end;
            end;

            if (str != "")
                set.insert(trim(str));
            end;
        end;

        var i = 0;
        while (i < m_rows.size)
            fillSet(m_rows[i].getBalanceMasks());
            fillSet(m_rows[i].getDecodingBalanceMasks());
            i = i + 1;
        end;

        m_balanceMasksSet = set;
    end;

    macro getName()
        return m_name;
    end;

    private macro getValueIterator(isFilter : bool)

        var attributeValue = m_report.attributeValue(m_name);
        var iterator = attributeValue.createValueIterator();

        if (isFilter)
            iterator.setFilter(FILTER_FOR_NONZERO_REST);
        end;

        return iterator;
    end;

    macro isEmpty()
        if (m_name == "Приложение1")
            return false;
        end;

        var isFilter = ternary(m_name == "ОтчетОбОтсутствииОстатков", false, true);

        return getValueIterator(isFilter).count == 0;
    end;

    private macro printBlocks()
        var fistDateInBlock = global.parameters.getBeginDate();

        if ((m_name == "Приложение1") or (m_name == "ОтчетОбОтсутствииОстатков"))
            printHeader();
            printBody();
            printFooter();
        else
            while (fistDateInBlock <= global.parameters.getEndDate())
                printHeader(fistDateInBlock);
                printBody(fistDateInBlock);
                fistDateInBlock = fistDateInBlock + m_numberDatesInOneBlock;
            end;
            printFooter();
        end;
    end;

    macro print()
        var iterator : Object = NULL;
        if (m_name == "Приложение1")
            iterator = getValueIterator(false);
            iterator.moveFirst();
            if (iterator.isDone())
                RepErrorsQueue().add(0, "Операция печати ФОР. Для выполнения операции печати необходимо рассчитать отчет.");
                msgBox("Операция печати ФОР. Для выполнения операции печати необходимо рассчитать отчет.");
                установитьФлагВозврата(STOP_PROC_FLG);
                exit(1);
            end;
        end;

        if ((not isEmpty) or (global.parameters.isPrintApplicationZero()))
            printBlocks();
        end;
    end;

    macro fillTempTable(tempTable : TTempTable)
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].fillTempTable(tempTable);
            i = i + 1;
        end;
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].fillTempTableForBalanceData(tempTable);
            i = i + 1;
        end;
    end;

    macro normalizeDecoding()
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].normalizeDecoding();
            i = i + 1;
        end;
    end;

    macro getBalanceMasksSet()
        if (m_balanceMasksSet == NULL)
            initializeBalanceMasksSet();
        end;
        return m_balanceMasksSet;
    end;

    macro getRow(code : String)
        var i = 0;
        while (i < m_rows.size)
            if (m_rows[i].getCode == code)
                return m_rows[i];
            end;
            i = i + 1;
        end;

        return NULL;
    end;

    macro saveAttributes()
        var i = 0;

        while (i < m_rows.size)
            m_rows[i].saveAttributes();
            i = i + 1;
        end;
    end;

    macro completeAttributes()
        var i = 0;

        while (i < m_rows.size)
            m_rows[i].completeAttributes();
            i = i + 1;
        end;
    end;

    macro exportToPtkPsd()
        m_ptkPsdExporter.export(m_rows);
    end;

    macro exportToKliko()
        m_klikoExporter.export(m_rows);
    end;

    macro calculateNumberBlocks()
        m_reportWidth           = global.parameters.getReportLength();
        m_numberDatesInOneBlock = int((m_reportWidth-50)/30);
        var dateCount           = global.parameters.getEndDate() + 2 - global.parameters.getBeginDate();
        if (m_numberDatesInOneBlock > dateCount)
            m_numberDatesInOneBlock = dateCount;
        end;
    end;

    //печать заголовка приложения
    macro printApplicationTitle()
        var strArray = StrCut(global.getAppTitle(m_name), "\n", false);
        for (var counter, 0, strArray.Size - 1)
            printLn(strAlign(strArray(counter), m_applicationLength, STR_ALIGN_CENTER));
        end;
    end;

    macro updateBalanceValues()
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].updateBalanceValues();
            i = i + 1;
        end;
    end;

    private macro constructorTApplication_4217()
        m_report = RcbApplication().currentReport;
        m_rows = TArray();
        m_numberDatesInOneBlock = 0;
        m_isFistBlock = true;
        m_applicationLength = null;
        m_klikoExporter = null;
        m_ptkPsdExporter = null;
    end;

    constructorTApplication_4217();
end;

/**
 * Экспорт в клико Приложения 1 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication1KlikoExporter_4217()
    macro export(data : Object)
        var valueArray = TArray();

        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P1V");
        else
            global.klikoExportFile.printID("F_P1M");
        end;

        valueArray.size = 0;
        valueArray[valueArray.size] = "NBNR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonExceptLongRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NBDR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonLongTermRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NFLR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNaturalPersonRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIOR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersExceptLongRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIDR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersLongTermRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NBNV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonExceptLongCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NBDV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonLongTermCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NFLV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNaturalPersonCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIOV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersExceptLongCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIDV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersLongTermCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 1 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication1PtkPsdExporter_4217()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_4217) TApplication1_4217()
    private macro printHeader()
        var okatoCode = RcbObjectFactoryBase().createPrintableView().getLendingAgencyCodeZone().getOkato();

        [                                                                  Приложение 1 ];
        [                                                      к Положению Банка России ];
        [                                                от 1 декабря 2015 года № 507-П ];
        [                                                     "Об обязательных резервах ];
        [                                                        кредитных организаций" ];
        [                                                                               ];
        [           ┌────────────────────┬─────────────────────────────────────────────┐];
        [           │   Код территории   │          Код кредитной организации          │];
        [           │      по ОКАТО      ├────────────────┬────────────────────────────┤];
        [           │                    │    по ОКПО     │   Регистрационный номер    │];
        [           ├────────────────────┼────────────────┼────────────────────────────┤];
        [           │####################│############### │############################│](okatoCode:c, Код_ОКПО:c, РегНомерБанка:c);
        [           └────────────────────┴────────────────┴────────────────────────────┘];
        [                                                                               ];
        [###############################################################################](global.getAppTitle(m_name):c:w);
        printPeriod();
        [                                     (отчетный период)                         ];
        [                                                                               ];
        printNameLendingAgency();
        printPostalAddress();
        [                                                                               ];
        [                                                                    Ежемесячно ];
        [                                                                   тыс. рублей ];
    end;

    private macro printFooter()
        var m_signature = TFForSignatureZone_4217();

        m_signature.excludeAttribute(AC_SECOND_PERSON);

        m_signature.print(80);

        [______________________________];

        [ ############################################################################# ]("(1) Приводятся показатели приложения 2 к настоящему Положению.":w);
        [ ############################################################################# ]("(2) Заполняется кредитной организацией при намерении получить право на усреднение обязательных резервов. В ином случае проставляется нулевое значение. Коэффициент усреднения указывается в числовом выражении в интервале от 0 до 1.":w);
        [ ############################################################################# ]("(3) Указывается фактический остаток средств обязательных резервов на счетах по учету обязательных резервов, счете по учету обязательных резервов при невыполнении обязанности по усреднению на дату, установленную для представления Расчета.":w);
    end;

    macro constructorTApplication1_4217()
        initTApplication_4217();

        m_name = "Приложение1";
        m_reportWidth = 80;
        m_applicationLength = 80;
        m_klikoExporter = TApplication1KlikoExporter_4217();
        m_ptkPsdExporter = TApplication1PtkPsdExporter_4217();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_5_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_6_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_7_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_8_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_9_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_1_10_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_5_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_6_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_7_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_8_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_9_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_10_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_11_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_12_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_13_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_2_14_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_3_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_3_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_3_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_4_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_4_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_5_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_5_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_5_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow1_5_3_4217(m_name);
    end;

    constructorTApplication1_4217();
end;

/**
 * Экспорт в клико Приложения 2 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication2KlikoExporter_4217()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P2V");
        else
            global.klikoExportFile.printID("F_P2");
        end;

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 2 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication2PtkPsdExporter_4217()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_4217) TApplication2_4217()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │  эквиваленте │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/
                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по балансовому счету,", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("по коду обозначения",           m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("за каждую календарную дату",    m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[4] = substr(stringArray[4], 1, POS) + strAlign("отчетного периода",             m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета,         │";
            stringArray[stringArray.size] = "│      │            код обозначения              │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                  Приложение 2 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("    тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
        printarray(StrTransferByWord("(2) Показатель рассчитывается по формуле средней арифметической величины, указанной в пункте 1 приложения 9 к настоящему Положению." , m_applicationLength));
        printarray(StrTransferByWord("(3) Остатки по коду обозначения 425440 определяются исходя из остатков отдельных лицевых счетов балансовых счетов № 42506, 44006 по учету обязательств со сроком привлечения три года и остатков балансовых счетов № 42507,  44007 за минусом остатков отдельных лицевых счетов балансовых счетов № 42507, 44007 по учету субординированных кредитов (депозитов, займов)." , m_applicationLength));
        printarray(StrTransferByWord("(4) Остатки по коду обозначения 420438 определяются исходя из остатков отдельных лицевых счетов балансовых счетов № 42006, 42106, 43706, 43806 по учету обязательств со сроком привлечения три года и остатков балансовых счетов № 42007, 42107, 43707, 43807 за минусом остатков отдельных лицевых счетов балансовых счетов № 42007, 42107, 43707, 43807 по учету субординированных кредитов (депозитов, займов)." , m_applicationLength));
        printarray(StrTransferByWord("(5) Остатки по коду обозначения 520061 определяются исходя из остатков балансового счета № 52006 за минусом остатков отдельных лицевых счетов указанного счета по учету субординированных облигационных займов." , m_applicationLength));
    end;

    macro normalizeDecoding()
        var iterator = TApplicationRow(m_name).getAttributeValueIterator(m_name);
        var i = 0;

        iterator.moveFirst();
        while (not iterator.isDone())
            if (iterator.currentItem.fieldValue("roubleRest").exact < $0.0)
                iterator.currentItem.fieldValue("roubleRest").scaled = $0.0;
            end;
            if (iterator.currentItem.fieldValue("currencyRest").exact < $0.0)
                iterator.currentItem.fieldValue("currencyRest").scaled = $0.0;
            end;
            iterator.moveNext();
        end;

        normalizeDecoding();
    end;

    private macro constructorTApplication2_4217()
        initTApplication_4217();

        m_name           = "Приложение2";
        m_reportWidth    = 80;
        m_klikoExporter  = TApplication2KlikoExporter_4217();
        m_ptkPsdExporter = TApplication2PtkPsdExporter_4217();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_1_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_1_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_5_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_6_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_2_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_2_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_5_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_6_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_5_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_6_4217(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication2_4217();
end;

class (TApplication2_4217) TApplication2_507_I4605()
    private macro constructorTApplication2_507_I4605()
        initTApplication2_4217();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_1_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_1_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_5_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_1_2_6_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_2_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_2_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_2_507_I4605(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_5_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_1_6_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_2_507_I4605(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_5_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow2_3_2_6_4217(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication2_507_I4605();
end;

/**
 * Экспорт в клико Приложения 3 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication3KlikoExporter_4217()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P3V");
        else
            global.klikoExportFile.printID("F_P3");
        end;

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 3 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication3PtkPsdExporter_4217()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_4217) TApplication3_4217()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate:f) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/
                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по отдельному", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("лицевому счету, коду",  m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("обозначения за каждую", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[4] = substr(stringArray[4], 1, POS) + strAlign("календарную дату",      m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[5] = substr(stringArray[5], 1, POS) + strAlign("отчетного периода",     m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета          │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                  Приложение 3 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printArray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    private macro constructorTApplication3_4217()
        initTApplication_4217();

        m_name = "Приложение3";
        m_reportWidth = 80;
        m_klikoExporter = TApplication3KlikoExporter_4217();
        m_ptkPsdExporter = TApplication3PtkPsdExporter_4217();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow3_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow3_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow3_1_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow3_1_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow3_1_2_1_4217(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication3_4217();
end;

/**
 * Экспорт в клико Приложения 4 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication4KlikoExporter_4217()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P4V");
        else
            global.klikoExportFile.printID("F_P4N");
        end;

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 4 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication4PtkPsdExporter_4217()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_4217) TApplication4_4217()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate:f) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "   в рублях   │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/

                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по балансовому счету,", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("отдельному лицевому счету",     m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("балансового счета,",            m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[4] = substr(stringArray[4], 1, POS) + strAlign("коду обозначения за каждую",    m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[5] = substr(stringArray[5], 1, POS) + strAlign("календарную дату",              m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[6] = substr(stringArray[6], 1, POS) + strAlign("отчетного периода",             m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │         Наименование показателя,        │";
            stringArray[stringArray.size] = "│строки│         номер балансового счета         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                   Приложение 4 ", m_applicationLength, " "));
            printLn(strLpad("       к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года  № 507-П ", m_applicationLength, " "));
            printLn(strLpad("     \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("        кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России.", m_applicationLength));
        printarray(StrTransferByWord("(2) Остатки по коду обозначения 520052 включаются в настоящее приложение за минусом остатков по коду обозначения 520053, указанному в приложении 2 к настоящему Положению.", m_applicationLength));
        printarray(StrTransferByWord("(3) Балансовый счет № 52006 включается в настоящее приложение за минусом остатков указанного счета по учету субординированных облигационных займов, указанных в приложении 3 к настоящему Положению,  а также остатков по коду обозначения 520061, указанному в приложении 2 к настоящему Положению.", m_applicationLength));
        printarray(StrTransferByWord("(4) Корректировочный коэффициент указывается в числовом выражении в интервале от 0 до 1.", m_applicationLength));
    end;

    private macro constructorTApplication4_4217()
        initTApplication_4217();

        m_name = "Приложение4";
        m_reportWidth = 80;
        m_klikoExporter = TApplication4KlikoExporter_4217();
        m_ptkPsdExporter = TApplication4PtkPsdExporter_4217();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow4_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow4_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow4_1_1_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow4_1_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow4_1_2_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow4_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow4_3_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow4_3_2_4217(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication4_4217();
end;

/**
 * Экспорт в клико Приложения 5 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication5KlikoExporter_4217()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P5V");
        else
            global.klikoExportFile.printID("F_P5N");
        end;

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 5 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication5PtkPsdExporter_4217()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_4217) TApplication5_4217()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "─────────────────┬";
                arr[arr.size] = "                 │";
                arr[arr.size] = "за " + getDateAsString(restDate:f) + " │";
                arr[arr.size] = "                 │";
                arr[arr.size] = "─────────────────┼";
                arr[arr.size] = "      " + strLPad(String(number + 1), 2, " ") + "         │";

                return arr;
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета          │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
        m_isFistBlock = false;
            printLn(strLpad("                  Приложение 5 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    macro calculateNumberBlocks()
        m_reportWidth  = global.parameters.getReportLength();

        const HEADER_BLOCK_WIDTH = 50;

        const DATA_BLOCK_WIDTH   = 18;

        m_numberDatesInOneBlock = int((m_reportWidth - HEADER_BLOCK_WIDTH)/DATA_BLOCK_WIDTH);

        var dateCount = global.parameters.getEndDate() + 2 - global.parameters.getBeginDate();
        if (m_numberDatesInOneBlock > dateCount)
            m_numberDatesInOneBlock = dateCount;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    private macro constructorTApplication5_4217()
        initTApplication_4217();

        m_name = "Приложение5";
        m_reportWidth = 80;
        m_klikoExporter = TApplication5KlikoExporter_4217();
        m_ptkPsdExporter = TApplication5PtkPsdExporter_4217();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow5_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow5_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow5_3_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow5_4_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow5_5_4217(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication5_4217();
end;

/**
 * Экспорт в клико Приложения 6 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication6KlikoExporter_4217()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 6 по 4217-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication6PtkPsdExporter_4217()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_4217) TApplication6_4217()
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/

                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по отдельному лицево-", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("му счету на каждую календар-",  m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("ную дату отчетного периода(1)", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";

            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │      Наименование показателя,           │";
            stringArray[stringArray.size] = "│строки│      номер балансового счета            │";
            stringArray[stringArray.size] = "│      │          второго порядка                │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                   Приложение 6 ", m_applicationLength, " "));
            printLn(strLpad("       к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года  № 507-П ", m_applicationLength, " "));
            printLn(strLpad("     \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("        кредитных организаций\" ", m_applicationLength, " "));
            printLn();

            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1)При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    macro normalizeDecoding()
        var iterator = TApplicationRow(m_name).getAttributeValueIterator(m_name);
        var i = 0;

        iterator.moveFirst();
        while (not iterator.isDone())
            if (iterator.currentItem.fieldValue("roubleRest").exact < $0.0)
                iterator.currentItem.fieldValue("roubleRest").scaled = $0.0;
            end;
            if (iterator.currentItem.fieldValue("currencyRest").exact < $0.0)
                iterator.currentItem.fieldValue("currencyRest").scaled = $0.0;
            end;
            iterator.moveNext();
        end;

        normalizeDecoding();
    end;

    private macro constructorTApplication6_4217()
        initTApplication_4217();

        m_name = "Приложение6";
        m_reportWidth = 80;
        m_klikoExporter = TApplication6KlikoExporter_4217();
        m_ptkPsdExporter = TApplication6PtkPsdExporter_4217();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow6_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow6_2_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow6_3_4217(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication6_4217();
end;

class (TApplication6_4217) TApplication6_507_I4605()
    private macro constructorTApplication6_507_I4605()
        initTApplication6_4217();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow6_1_4217(m_name);
        m_rows[m_rows.size] = TApplicationRow6_2_507_I4605(m_name);
        m_rows[m_rows.size] = TApplicationRow6_3_4217(m_name);

        calculateNumberBlocks();
    end;

    constructorTApplication6_507_I4605();
end;

class (TApplication_4217) TApplication8_4217()
    var m_printedReport : Object;

    private macro printHeader()
        var numberStringWidth            : Integer = 6;
        var applicationNumberStringWidth : Integer = 16;
        var balanceListStringWidth       : Integer = 80;

        m_reportWidth = 2 + numberStringWidth + 3 + applicationNumberStringWidth + 3 + balanceListStringWidth + 2;

        m_printedReport.addColumn("Номер|строки", numberStringWidth, AL_CENTER);
        m_printedReport.addColumn("Номер приложения" , applicationNumberStringWidth, AL_CENTER);
        m_printedReport.addColumn("Балансовые счета",  balanceListStringWidth);

        printLn();

        m_applicationLength = m_reportWidth;
        printApplicationTitle();
        printPeriod();

        printNameLendingAgency();

        var i : Integer = 0;
        var arr = strTransferByWord(" В связи с нулевыми значениями по балансовым счетам (отдельным лицевым счетам) в течение отчетного периода в состав отчетности не включаются следующие приложения к расчету по Положению об обязательных резервах:", m_reportWidth);
        printLn();
        while (i < arr.size)
        printLn(strAlign(arr[i], m_reportWidth, STR_ALIGN_LEFT));
            i = i + 1;
        end;

        m_printedReport.printHead();
    end;

    private macro printFooter()
        var signature = TFForSignatureZone_4217();
        signature.clearExcludeAttributes();

        signature.excludeAttribute(AC_SECOND_PERSON);

        signature.print(80);
    end;

    private macro printBody()
        var i : Integer = 0;
        while (i < m_rows.size)
            m_rows[i].print(m_printedReport);
            i = i + 1;
        end;
    end;

    private macro constructorTApplication8_4217()
        initTApplication_4217();

        m_printedReport = CTableReport();

        m_name = "ОтчетОбОтсутствииОстатков";
        m_klikoExporter = TApplicationKlikoExporter_8();
        m_ptkPsdExporter = TApplicationPtkPsdExporter_8();

        m_rows.size = 0;
        m_rows[0] = TApplicationRow507_8(m_name);
    end;

    constructorTApplication8_4217();
end;

/**
 * Базовый класс приложений отчета по 5036-У
 * Скопирован из TApplication_4217 и дополнен/переопределён
 *
 * @author ABP
 * @since 6.20.031.56
 */
class TApplication_5036(applView)
    const GORIZONTAL_BOUNDARY = 196;    //196 - ASCII-код символа "─"

    private var m_name            : String;
    private var m_balanceMasksSet : TRcbSet;
    private var m_reportWidth     : Integer;
    private var m_report          : Object;
    private var m_rows            : TArray;
    private var m_numberDatesInOneBlock : Integer;
    private var m_isFistBlock           : Bool;
    private var m_applicationLength     : Integer;
    private var m_klikoExporter : Object;
    private var m_ptkPsdExporter : Object;
    private var m_xlsApplView : Object;
    private macro unionArray(arr1, arr2)
        var i = 0;
        while (i < arr1.size)
            arr1[i] = arr1[i] + arr2[i];
            i = i + 1;
        end;
    end;

    private macro printArray(stringArray : TArray)
        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    //печать даты отчета
    private macro printPeriod()
        const template1 = "за ";
        const template2 = "за период с ";
        const template3 = " года";

        var month : String = "";
        var year  : String = "";
        var dateString     = "";
        var dateWidth      = 0;
        var pre            = "";  //пустая (пробельная) подстрока перед выводом подчеркивания

        if (m_report.context.period.kind == RCB_PK_MONTH)
            dateSplit(global.parameters.getBeginDate(), NULL, month, year);

            dateString = strLwr(monName(int(month))) + " " + string(year);
            dateWidth  = strLen(dateString);
            pre = mkstr(" ", (m_applicationLength - (strLen(template1) + dateWidth + strLen(template3)))/2);

            printLn(pre + template1 + dateString + template3);
            printLn(pre + mkstr(" ", StrLen(template1)) + mkstr(GORIZONTAL_BOUNDARY, dateWidth));
        else
            dateString = String(global.parameters.getBeginDate():f, " по ", global.parameters.getEndDate():f);
            dateWidth  = StrLen(dateString);
            pre = mkstr(" ", (m_applicationLength - (StrLen(template2) + dateWidth))/2);

            printLn(pre + template2 + dateString);
            printLn(pre + mkstr(" ", StrLen(template2)) + mkstr(GORIZONTAL_BOUNDARY, dateWidth));
        end;
    end;

    //печать наименования кредитной организации
    private macro printNameLendingAgency()
        var attrTitle = "Полное или сокращенное фирменное наименование кредитной организации ";
        var arr = strTransferByWord(attrTitle + {Name_Bank}, m_applicationLength);
        var pre = "";  //пустая (пробельная) подстрока перед выводом подчеркивания

        printLn();

        var i = 0;

        while (i < arr.size)
            printLn(arr[i]);
            if (i == 0)
                pre = mkstr(" ", StrLen(attrTitle));
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(arr[i]) - StrLen(attrTitle)));
            else
                pre = "";
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(trim(arr[i]))));
            end;

            i = i + 1;
        end;
    end;

    //печать почтового адреса КО
    private macro printPostalAddress()
        var addressTitle = "Почтовый адрес ";
        var arr = strTransferByWord(addressTitle + TNamesZone().getLendingAgencyPostalAdress(), m_applicationLength);
        var pre = "";  //пустая (пробельная) подстрока перед выводом подчеркивания

        var i = 0;

        while (i < arr.size)
            printLn(arr[i]);
            if (i == 0)
                pre = mkstr(" ", StrLen(addressTitle));
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(arr[i]) - StrLen(addressTitle)));
            else
                pre = "";
                printLn(pre + mkstr(GORIZONTAL_BOUNDARY, StrLen(trim(arr[i]))));
            end;

            i = i + 1;
        end;
    end;

    private macro getDateAsString(reportDate : Date) : String
        if (in(reportDate, global.parameters.getBeginDate(), global.parameters.getEndDate()))
            return String(reportDate:f) + "(1)";
        end;

        return String(reportDate:f) + "   ";
    end;

    private macro printHeader()
    end;

    private macro printBody(beginDateInBlock)
        var i : Integer = 0;
        while (i < m_rows.size)
            m_rows[i].print(ternary(m_applicationLength == null, m_reportWidth, m_applicationLength), beginDateInBlock, m_numberDatesInOneBlock);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
    end;

    private macro printFooter()
        var signature = TFForSignatureZone_5036();

        signature.clearExcludeAttributes();
        signature.excludeAttribute(AC_SECOND_PERSON);
        signature.excludeAttribute(AC_EXECUTOR);
        signature.excludeAttribute(AC_EXECUTOR_PHONE_NUMBER);
        signature.excludeAttribute(AC_REPORT_DATE);

        signature.print();

        printFooterComments();
    end;

    private macro initializeBalanceMasksSet()
        var set = TRcbSet();

        macro fillSet(str : String)
            var pos : Integer = index(str, ",");

            if (pos > 0)
                while (pos > 0)
                    set.insert(trim(substr(str, 1, pos - 1)));
                    str = trim(substr(str, pos + 1));
                    pos = index(str, ",");
                end;
            end;

            if (str != "")
                set.insert(trim(str));
            end;
        end;

        var i = 0;
        while (i < m_rows.size)
            fillSet(m_rows[i].getBalanceMasks());
            fillSet(m_rows[i].getDecodingBalanceMasks());
            i = i + 1;
        end;

        m_balanceMasksSet = set;
    end;

    macro getName()
        return m_name;
    end;

    private macro getValueIterator(isFilter : bool)

        var attributeValue = m_report.attributeValue(m_name);
        var iterator = attributeValue.createValueIterator();

        if (isFilter)
            iterator.setFilter(FILTER_FOR_NONZERO_REST);
        end;

        return iterator;
    end;

    macro isEmpty()
        if (m_name == "Приложение1")
            return false;
        end;

        var isFilter = ternary(m_name == "ОтчетОбОтсутствииОстатков", false, true);

        return getValueIterator(isFilter).count == 0;
    end;

    private macro printBlocks()
        var fistDateInBlock = global.parameters.getBeginDate();

        if ((m_name == "Приложение1") or (m_name == "ОтчетОбОтсутствииОстатков"))
            printHeader();
            printBody();
            printFooter();
        else
            while (fistDateInBlock <= global.parameters.getEndDate())
                printHeader(fistDateInBlock);
                printBody(fistDateInBlock);
                fistDateInBlock = fistDateInBlock + m_numberDatesInOneBlock;
            end;
            printFooter();
        end;
    end;

    macro print()
        var iterator : Object = NULL;
        if (m_name == "Приложение1")
            iterator = getValueIterator(false);
            iterator.moveFirst();
            if (iterator.isDone())
                RepErrorsQueue().add(0, "Операция печати ФОР. Для выполнения операции печати необходимо рассчитать отчет.");
                msgBox("Операция печати ФОР. Для выполнения операции печати необходимо рассчитать отчет.");
                установитьФлагВозврата(STOP_PROC_FLG);
                exit(1);
            end;
        end;

        if ((not isEmpty) or (global.parameters.isPrintApplicationZero()))
            printBlocks();
        end;
    end;

    private macro printBodyExcel(beginDateInBlock)
        var i : Integer = 0;
        var dateCount = global.parameters.getEndDate() + 2 - global.parameters.getBeginDate();
        while (i < m_rows.size)
            m_rows[i].printExcel(ternary(m_applicationLength == null, m_reportWidth, m_applicationLength), beginDateInBlock, dateCount);
            i = i + 1;
        end;
    end;

    private macro printBlocksExcel()
        var fistDateInBlock = global.parameters.getBeginDate();

        if ((m_name == "Приложение1") or (m_name == "ОтчетОбОтсутствииОстатков"))
            printBodyExcel();
        else
            printBodyExcel(fistDateInBlock);
        end;
    end;


    macro printExcel()
        var iterator : Object = NULL;
        if (m_name == "Приложение1")
            iterator = getValueIterator(false);
            iterator.moveFirst();
            if (iterator.isDone())
                RepErrorsQueue().add(0, "Операция печати ФОР. Для выполнения операции печати необходимо рассчитать отчет.");
                msgBox("Операция печати ФОР. Для выполнения операции печати необходимо рассчитать отчет.");
                установитьФлагВозврата(STOP_PROC_FLG);
                exit(1);
            end;
        end;


        if ((not isEmpty) or (global.parameters.isPrintApplicationZero()))
            var signature             = TFForSignatureZone_5036();
            var namesZone             = TFForNamesZoneExcel_5036(global.getAppTitle(m_name),
                                                        null,
                                                        null,
                                                        DATE_IN_PERIOD_FORMAT);
            var lendingAgencyCodeZone = RcbObjectFactoryBase().createPrintableView().getLendingAgencyCodeZone();
            m_xlsApplView.printHead(lendingAgencyCodeZone, namesZone);



            printBlocksExcel();
            m_xlsApplView.printSignature(signature);
            m_xlsApplView.print();
        end;
    end;

    macro fillTempTable(tempTable : TTempTable)
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].fillTempTable(tempTable);
            i = i + 1;
        end;
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].fillTempTableForBalanceData(tempTable);
            i = i + 1;
        end;
    end;

    macro normalizeDecoding()
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].normalizeDecoding();
            i = i + 1;
        end;
    end;

    macro getBalanceMasksSet()
        if (m_balanceMasksSet == NULL)
            initializeBalanceMasksSet();
        end;
        return m_balanceMasksSet;
    end;

    macro getRow(code : String)
        var i = 0;
        while (i < m_rows.size)
            if (m_rows[i].getCode == code)
                return m_rows[i];
            end;
            i = i + 1;
        end;

        return NULL;
    end;

    macro saveAttributes()
        var i = 0;

        while (i < m_rows.size)
            m_rows[i].saveAttributes();
            i = i + 1;
        end;
    end;

    macro completeAttributes()
        var i = 0;

        while (i < m_rows.size)
            m_rows[i].completeAttributes();
            i = i + 1;
        end;
    end;

    macro exportToPtkPsd()
        m_ptkPsdExporter.export(m_rows);
    end;

    macro exportToKliko()
        m_klikoExporter.export(m_rows);
    end;

    macro calculateNumberBlocks()
        m_reportWidth           = global.parameters.getReportLength();
        m_numberDatesInOneBlock = int((m_reportWidth-50)/30);
        var dateCount           = global.parameters.getEndDate() + 2 - global.parameters.getBeginDate();
        if (m_numberDatesInOneBlock > dateCount)
            m_numberDatesInOneBlock = dateCount;
        end;
    end;

    //печать заголовка приложения
    macro printApplicationTitle()
        var strArray = StrCut(global.getAppTitle(m_name), "\n", false);
        for (var counter, 0, strArray.Size - 1)
            printLn(strAlign(strArray(counter), m_applicationLength, STR_ALIGN_CENTER));
        end;
    end;

    macro updateBalanceValues()
        var i = 0;
        while (i < m_rows.size)
            m_rows[i].updateBalanceValues();
            i = i + 1;
        end;
    end;

    private macro constructorTApplication_5036(applView)
        m_report = RcbApplication().currentReport;
        m_rows = TArray();
        m_numberDatesInOneBlock = 0;
        m_isFistBlock = true;
        m_applicationLength = null;
        m_klikoExporter = null;
        m_ptkPsdExporter = null;
        m_xlsApplView = applView;
    end;

    constructorTApplication_5036(applView);
end;

/**
 * Экспорт в клико Приложения 1 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication1KlikoExporter_5036()
    macro export(data : Object)
        var valueArray = TArray();

        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P1V");
        else
            global.klikoExportFile.printID("F_P1M");
        end;

        valueArray.size = 0;
        valueArray[valueArray.size] = "NBNR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonExceptLongRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NBDR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonLongTermRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NFLR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNaturalPersonRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIOR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersExceptLongRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIDR";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersLongTermRouble() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NBNV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonExceptLongCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NBDV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNotresidentLegalPersonLongTermCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NFLV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getNaturalPersonCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIOV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersExceptLongCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        valueArray.size = 0;
        valueArray[valueArray.size] = "NIDV";
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = global.parameters.getReservation().getOthersLongTermCurrency() * 100;
        global.klikoExportFile.printString(valueArray);

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 1 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication1PtkPsdExporter_5036()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_5036) TApplication1_5036(applView)
    private macro printHeader()
        var okatoCode = RcbObjectFactoryBase().createPrintableView().getLendingAgencyCodeZone().getOkato();

        [                                                                  Приложение 1 ];
        [                                                      к Положению Банка России ];
        [                                                от 1 декабря 2015 года № 507-П ];
        [                                                     "Об обязательных резервах ];
        [                                                        кредитных организаций" ];
        [                                                                               ];
        [           ┌────────────────────┬─────────────────────────────────────────────┐];
        [           │   Код территории   │          Код кредитной организации          │];
        [           │      по ОКАТО      ├────────────────┬────────────────────────────┤];
        [           │                    │    по ОКПО     │   Регистрационный номер    │];
        [           ├────────────────────┼────────────────┼────────────────────────────┤];
        [           │####################│############### │############################│](okatoCode:c, Код_ОКПО:c, РегНомерБанка:c);
        [           └────────────────────┴────────────────┴────────────────────────────┘];
        [                                                                               ];
        [###############################################################################](global.getAppTitle(m_name):c:w);
        printPeriod();
        [                                     (отчетный период)                         ];
        [                                                                               ];
        printNameLendingAgency();
        printPostalAddress();
        [                                                                               ];
        [                                                                    Ежемесячно ];
        [                                                                   тыс. рублей ];
    end;

    private macro printFooter()
        var m_signature = TFForSignatureZone_5036();

        m_signature.excludeAttribute(AC_SECOND_PERSON);

        m_signature.print(80);

        [______________________________];

        [ ############################################################################# ]("(1) Приводятся показатели приложения 2 к настоящему Положению.":w);
        [ ############################################################################# ]("(2) Заполняется кредитной организацией при намерении получить право на усреднение обязательных резервов. В ином случае проставляется нулевое значение. Коэффициент усреднения указывается в числовом выражении в интервале от 0 до 1.":w);
        [ ############################################################################# ]("(3) Указывается фактический остаток средств обязательных резервов на счете по учету обязательных резервов на дату, установленную для представления Расчета.":w);
    end;

    macro constructorTApplication1_5036(applView)
        initTApplication_5036(applView);

        m_name = "Приложение1";
        m_reportWidth = 80;
        m_applicationLength = 80;
        m_klikoExporter = TApplication1KlikoExporter_5036();
        m_ptkPsdExporter = TApplication1PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_6_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_7_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_8_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_9_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_10_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_6_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_7_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_8_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_9_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_10_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_11_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_12_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_13_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_14_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_4_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_4_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_5_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_5_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_5_3_5036(m_name, m_xlsApplView);
    end;

    constructorTApplication1_5036(applView);
end;

/**
 * Экспорт в клико Приложения 2 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication2KlikoExporter_5036()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P2V");
        else
            global.klikoExportFile.printID("F_P2");
        end;

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 2 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication2PtkPsdExporter_5036()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_5036) TApplication2_5036(applView)
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │  эквиваленте │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/
                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по балансовому счету,", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("по коду обозначения",           m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("за каждую календарную дату",    m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[4] = substr(stringArray[4], 1, POS) + strAlign("отчетного периода",             m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета,         │";
            stringArray[stringArray.size] = "│      │            код обозначения              │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                  Приложение 2 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("    тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
        printarray(StrTransferByWord("(2) Показатель рассчитывается по формуле средней арифметической величины, указанной в пункте 1 приложения 9 к настоящему Положению." , m_applicationLength));
        printarray(StrTransferByWord("(3) Остатки по кодам обозначения 437001, 437002 включаются в настоящее приложение центральным контрагентом." , m_applicationLength));
    end;

    macro normalizeDecoding()
        var iterator = TApplicationRow(m_name).getAttributeValueIterator(m_name);
        var i = 0;

        iterator.moveFirst();
        while (not iterator.isDone())
            if (iterator.currentItem.fieldValue("roubleRest").exact < $0.0)
                iterator.currentItem.fieldValue("roubleRest").scaled = $0.0;
            end;
            if (iterator.currentItem.fieldValue("currencyRest").exact < $0.0)
                iterator.currentItem.fieldValue("currencyRest").scaled = $0.0;
            end;
            iterator.moveNext();
        end;

        normalizeDecoding();
    end;

    private macro constructorTApplication2_5036(applView)
        initTApplication_5036(applView);

        m_name           = "Приложение2";
        m_reportWidth    = 80;
        m_klikoExporter  = TApplication2KlikoExporter_5036();
        m_ptkPsdExporter = TApplication2PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_6_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_6_5036(m_name, m_xlsApplView);

        calculateNumberBlocks();
    end;

    constructorTApplication2_5036(applView);
end;

/**
 * Экспорт в клико Приложения 3 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication3KlikoExporter_5036()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P3V");
        else
            global.klikoExportFile.printID("F_P3");
        end;

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 3 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication3PtkPsdExporter_5036()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_5036) TApplication3_5036(applView)
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate:f) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/
                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по отдельному", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("лицевому счету, коду",  m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("обозначения за каждую", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[4] = substr(stringArray[4], 1, POS) + strAlign("календарную дату",      m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[5] = substr(stringArray[5], 1, POS) + strAlign("отчетного периода",     m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета          │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                  Приложение 3 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printArray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    private macro constructorTApplication3_5036(applView)
        initTApplication_5036(applView);

        m_name = "Приложение3";
        m_reportWidth = 80;
        m_klikoExporter = TApplication3KlikoExporter_5036();
        m_ptkPsdExporter = TApplication3PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow3_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow3_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow3_1_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow3_1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow3_1_2_1_5036(m_name, m_xlsApplView);

        calculateNumberBlocks();
    end;

    constructorTApplication3_5036(applView);
end;

/**
 * Экспорт в клико Приложения 4 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication4KlikoExporter_5036()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P4V");
        else
            global.klikoExportFile.printID("F_P4N");
        end;

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 4 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication4PtkPsdExporter_5036()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_5036) TApplication4_5036(applView)
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate:f) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "   в рублях   │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/

                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по балансовому счету,", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("отдельному лицевому счету",     m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("балансового счета,",            m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[4] = substr(stringArray[4], 1, POS) + strAlign("коду обозначения за каждую",    m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[5] = substr(stringArray[5], 1, POS) + strAlign("календарную дату",              m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[6] = substr(stringArray[6], 1, POS) + strAlign("отчетного периода",             m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │         Наименование показателя,        │";
            stringArray[stringArray.size] = "│строки│         номер балансового счета         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                   Приложение 4 ", m_applicationLength, " "));
            printLn(strLpad("       к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года  № 507-П ", m_applicationLength, " "));
            printLn(strLpad("     \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("        кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России.", m_applicationLength));
        printarray(StrTransferByWord("(2) Остатки по коду обозначения 520052 включаются в настоящее приложение в размере остатков по коду обозначения 520052, указанному в приложении 2 к настоящему Положению.", m_applicationLength));
        printarray(StrTransferByWord("(3) Балансовый счет № 52006 включается в настоящее приложение за минусом остатков указанного счета по учету субординированных облигационных займов, указанных в приложении 3 к настоящему Положению.", m_applicationLength));
        printarray(StrTransferByWord("(4) Корректировочный коэффициент указывается в числовом выражении в интервале от 0 до 1.", m_applicationLength));
    end;

    private macro constructorTApplication4_5036(applView)
        initTApplication_5036(applView);

        m_name = "Приложение4";
        m_reportWidth = 80;
        m_klikoExporter = TApplication4KlikoExporter_5036();
        m_ptkPsdExporter = TApplication4PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow4_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow4_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow4_1_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow4_1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow4_1_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow4_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow4_3_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow4_3_2_5036(m_name, m_xlsApplView);

        calculateNumberBlocks();
    end;

    constructorTApplication4_5036(applView);
end;

/**
 * Экспорт в клико Приложения 5 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication5KlikoExporter_5036()
    macro export(data : Object)
        if (global.reportingPeriodIsVror)
            global.klikoExportFile.printID("F_P5V");
        else
            global.klikoExportFile.printID("F_P5N");
        end;

        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 5 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication5PtkPsdExporter_5036()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_5036) TApplication5_5036(applView)
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "─────────────────┬";
                arr[arr.size] = "                 │";
                arr[arr.size] = "за " + getDateAsString(restDate:f) + " │";
                arr[arr.size] = "                 │";
                arr[arr.size] = "─────────────────┼";
                arr[arr.size] = "      " + strLPad(String(number + 1), 2, " ") + "         │";

                return arr;
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета          │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
        m_isFistBlock = false;
            printLn(strLpad("                  Приложение 5 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    macro calculateNumberBlocks()
        m_reportWidth  = global.parameters.getReportLength();

        const HEADER_BLOCK_WIDTH = 50;

        const DATA_BLOCK_WIDTH   = 18;

        m_numberDatesInOneBlock = int((m_reportWidth - HEADER_BLOCK_WIDTH)/DATA_BLOCK_WIDTH);

        var dateCount = global.parameters.getEndDate() + 2 - global.parameters.getBeginDate();
        if (m_numberDatesInOneBlock > dateCount)
            m_numberDatesInOneBlock = dateCount;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    private macro constructorTApplication5_5036(applView)
        initTApplication_5036(applView);

        m_name = "Приложение5";
        m_reportWidth = 80;
        m_klikoExporter = TApplication5KlikoExporter_5036();
        m_ptkPsdExporter = TApplication5PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow5_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow5_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow5_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow5_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow5_5_5036(m_name, m_xlsApplView);

        calculateNumberBlocks();
    end;

    constructorTApplication5_5036(applView);
end;

/**
 * Экспорт в клико Приложения 6 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationKlikoExporter) TApplication6KlikoExporter_5036()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationKlikoExporter();
end;

/**
 * Экспорт в АС ПСД Приложения 6 по 5036-У
 * Наследование запрещено
 */
private class (TApplicationPtkPsdExporter) TApplication6PtkPsdExporter_5036()
    macro export(data : Object)
        export(data);
    end;

    initTApplicationPtkPsdExporter();
end;

class (TApplication_5036) TApplication6_5036(applView)
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/

                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по отдельному лицево-", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("му счету на каждую календар-",  m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("ную дату отчетного периода(1)", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";

            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │      Наименование показателя,           │";
            stringArray[stringArray.size] = "│строки│      номер балансового счета            │";
            stringArray[stringArray.size] = "│      │          второго порядка                │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                   Приложение 6 ", m_applicationLength, " "));
            printLn(strLpad("       к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года  № 507-П ", m_applicationLength, " "));
            printLn(strLpad("     \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("        кредитных организаций\" ", m_applicationLength, " "));
            printLn();

            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1)При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    macro normalizeDecoding()
        var iterator = TApplicationRow(m_name).getAttributeValueIterator(m_name);
        var i = 0;

        iterator.moveFirst();
        while (not iterator.isDone())
            if (iterator.currentItem.fieldValue("roubleRest").exact < $0.0)
                iterator.currentItem.fieldValue("roubleRest").scaled = $0.0;
            end;
            if (iterator.currentItem.fieldValue("currencyRest").exact < $0.0)
                iterator.currentItem.fieldValue("currencyRest").scaled = $0.0;
            end;
            iterator.moveNext();
        end;

        normalizeDecoding();
    end;

    private macro constructorTApplication6_5036(applView)
        initTApplication_5036(applView);

        m_name = "Приложение6";
        m_reportWidth = 80;
        m_klikoExporter = TApplication6KlikoExporter_5036();
        m_ptkPsdExporter = TApplication6PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow6_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow6_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow6_3_5036(m_name, m_xlsApplView);

        calculateNumberBlocks();
    end;

    constructorTApplication6_5036(applView);
end;

class (TApplication_5036) TApplication8_5036(applView)
    var m_printedReport : Object;

    private macro printHeader()
        var numberStringWidth            : Integer = 6;
        var applicationNumberStringWidth : Integer = 16;
        var balanceListStringWidth       : Integer = 80;

        m_reportWidth = 2 + numberStringWidth + 3 + applicationNumberStringWidth + 3 + balanceListStringWidth + 2;

        m_printedReport.addColumn("Номер|строки", numberStringWidth, AL_CENTER);
        m_printedReport.addColumn("Номер приложения" , applicationNumberStringWidth, AL_CENTER);
        m_printedReport.addColumn("Балансовые счета",  balanceListStringWidth);

        printLn();

        m_applicationLength = m_reportWidth;
        printApplicationTitle();
        printPeriod();

        printNameLendingAgency();

        var i : Integer = 0;
        var arr = strTransferByWord(" В связи с нулевыми значениями по балансовым счетам (отдельным лицевым счетам) в течение отчетного периода в состав отчетности не включаются следующие приложения к расчету по Положению об обязательных резервах:", m_reportWidth);
        printLn();
        while (i < arr.size)
        printLn(strAlign(arr[i], m_reportWidth, STR_ALIGN_LEFT));
            i = i + 1;
        end;

        m_printedReport.printHead();
    end;

    private macro printFooter()
        var signature = TFForSignatureZone_5036();
        signature.clearExcludeAttributes();

        signature.excludeAttribute(AC_SECOND_PERSON);

        signature.print(80);
    end;

    private macro printBody()
        var i : Integer = 0;
        while (i < m_rows.size)
            m_rows[i].print(m_printedReport);
            i = i + 1;
        end;
    end;

    private macro constructorTApplication8_5036(applView)
        initTApplication_5036(applView);

        m_printedReport = CTableReport();

        m_name = "ОтчетОбОтсутствииОстатков";
        m_klikoExporter = TApplicationKlikoExporter_8();
        m_ptkPsdExporter = TApplicationPtkPsdExporter_8();

        m_rows.size = 0;
        m_rows[0] = TApplicationRow8_5036(m_name, m_xlsApplView);
    end;

    constructorTApplication8_5036(applView);
end;

/**
 * Указание 5087-У
 * Наследуется от 5036-У
 */
class (TApplication_5036) TApplication1_5087(applView)
    private macro printHeader()
        var okatoCode = RcbObjectFactoryBase().createPrintableView().getLendingAgencyCodeZone().getOkato();

        [                                                                  Приложение 1 ];
        [                                                      к Положению Банка России ];
        [                                                от 1 декабря 2015 года № 507-П ];
        [                                                     "Об обязательных резервах ];
        [                                                        кредитных организаций" ];
        [                                                                               ];
        [           ┌────────────────────┬─────────────────────────────────────────────┐];
        [           │   Код территории   │          Код кредитной организации          │];
        [           │      по ОКАТО      ├────────────────┬────────────────────────────┤];
        [           │                    │    по ОКПО     │   Регистрационный номер    │];
        [           ├────────────────────┼────────────────┼────────────────────────────┤];
        [           │####################│############### │############################│](okatoCode:c, Код_ОКПО:c, РегНомерБанка:c);
        [           └────────────────────┴────────────────┴────────────────────────────┘];
        [                                                                               ];
        [###############################################################################](global.getAppTitle(m_name):c:w);
        printPeriod();
        [                                     (отчетный период)                         ];
        [                                                                               ];
        printNameLendingAgency();
        printPostalAddress();
        [                                                                               ];
        [                                                                    Ежемесячно ];
        [                                                                   тыс. рублей ];
    end;

    private macro printFooter()
        var m_signature = TFForSignatureZone_5036();

        m_signature.excludeAttribute(AC_SECOND_PERSON);
        m_signature.print(80);

        [______________________________];

        [ ############################################################################# ]("(1) Приводятся показатели приложения 2 к настоящему Положению.":w);
        [ ############################################################################# ]("(2) Заполняется кредитной организацией при намерении получить право на усреднение обязательных резервов. В ином случае проставляется нулевое значение. Коэффициент усреднения указывается в числовом выражении в интервале от 0 до 1.":w);
        [ ############################################################################# ]("(3) Указывается фактический остаток средств обязательных резервов на счете по учету обязательных резервов на дату, установленную для представления Расчета.":w);
    end;

    macro constructorTApplication1_5087(applView)
        initTApplication_5036(applView);

        m_name              = "Приложение1";
        m_reportWidth       = 80;
        m_applicationLength = 80;
        m_klikoExporter     = TApplication1KlikoExporter_5036();
        m_ptkPsdExporter    = TApplication1PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_6_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_7_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_8_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_9_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_10_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_6_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_7_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_8_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_9_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_10_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_11_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_12_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_13_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_14_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_4_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_4_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_5_5087(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_5_1_5087(m_name, m_xlsApplView);
    end;

    constructorTApplication1_5087(applView);
end;

class (TApplication_5036) TApplication3_5087(applView)
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate:f) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │ эквиваленте  │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/
                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по отдельному", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("лицевому счету, коду",  m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("обозначения за каждую", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[4] = substr(stringArray[4], 1, POS) + strAlign("календарную дату",      m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[5] = substr(stringArray[5], 1, POS) + strAlign("отчетного периода",     m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета          │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                  Приложение 3 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("      тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printArray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
    end;

    private macro constructorTApplication3_5087(applView)
        initTApplication_5036(applView);

        m_name = "Приложение3";
        m_reportWidth = 80;
        m_klikoExporter = TApplication3KlikoExporter_5036();
        m_ptkPsdExporter = TApplication3PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow3_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow3_1_1_5087(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow3_1_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow3_1_2_5087(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow3_1_2_1_5036(m_name, m_xlsApplView);

        calculateNumberBlocks();
    end;

    constructorTApplication3_5087(applView);
end;

/**
 * Указание 5242-У
 * Наследуется от 5036-У
 */
class (TApplication_5036) TApplication1_5242(applView)
    private macro printHeader()
        var okatoCode = RcbObjectFactoryBase().createPrintableView().getLendingAgencyCodeZone().getOkato();

        [                                                                  Приложение 1 ];
        [                                                      к Положению Банка России ];
        [                                                от 1 декабря 2015 года № 507-П ];
        [                                                     "Об обязательных резервах ];
        [                                                        кредитных организаций" ];
        [                                                                               ];
        [           ┌────────────────────┬─────────────────────────────────────────────┐];
        [           │   Код территории   │          Код кредитной организации          │];
        [           │      по ОКАТО      ├────────────────┬────────────────────────────┤];
        [           │                    │    по ОКПО     │   Регистрационный номер    │];
        [           ├────────────────────┼────────────────┼────────────────────────────┤];
        [           │####################│############### │############################│](okatoCode:c, Код_ОКПО:c, РегНомерБанка:c);
        [           └────────────────────┴────────────────┴────────────────────────────┘];
        [                                                                               ];
        [###############################################################################](global.getAppTitle(m_name):c:w);
        printPeriod();
        [                                     (отчетный период)                         ];
        [                                                                               ];
        printNameLendingAgency();
        printPostalAddress();
        [                                                                               ];
        [                                                                    Ежемесячно ];
        [                                                                   тыс. рублей ];
    end;

    private macro printFooter()
        var m_signature = TFForSignatureZone_5036();

        m_signature.excludeAttribute(AC_SECOND_PERSON);
        m_signature.print(80);

        [______________________________];

        [ ############################################################################# ]("(1) Приводятся показатели приложения 2 к настоящему Положению.":w);
        [ ############################################################################# ]("(2) Заполняется кредитной организацией при намерении получить право на усреднение обязательных резервов. В ином случае проставляется нулевое значение. Коэффициент усреднения указывается в числовом выражении в интервале от 0 до 1.":w);
        [ ############################################################################# ]("(3) Указывается фактический остаток средств обязательных резервов на счете по учету обязательных резервов на дату, установленную для представления Расчета.":w);
    end;

    macro constructorTApplication1_5242(applView)
        initTApplication_5036(applView);

        m_name              = "Приложение1";
        m_reportWidth       = 80;
        m_applicationLength = 80;
        m_klikoExporter     = TApplication1KlikoExporter_5036();
        m_ptkPsdExporter    = TApplication1PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_1_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_2_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_6_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_7_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_8_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_9_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_1_10_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_6_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_7_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_8_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_9_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_10_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_11_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_12_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_13_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_2_14_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_3_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_4_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_4_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow1_5_5242(m_name, m_xlsApplView);
    end;

    constructorTApplication1_5242(applView);
end;

class (TApplication_5036) TApplication2_5242(applView)
    private macro printHeader(beginDateInBlock)
        var stringArray = TArray();
        macro makeHeader(beginDateInBlock)
            macro closeTable()
                var arr = TArray;
                arr[arr.size] = "┐";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "│";
                arr[arr.size] = "┤";
                arr[arr.size] = "│";
                var i : Integer = 0;
                while (i < stringArray.size)
                    stringArray[i] = subStr(stringArray[i], 1, strLen(stringArray[i]) - 1);
                    i = i + 1;
                end;

                unionArray(stringArray, arr);
            end;

            macro getArray(restDate, number)
                var arr = TArray;
                arr[arr.size] = "──────────────────────────────";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "                              ";
                arr[arr.size] = "─────────────────────────────┬";
                arr[arr.size] = "        за " + getDateAsString(restDate) + "     │";
                arr[arr.size] = "──────────────┬──────────────┼";
                arr[arr.size] = "  в рублях    │ в иностранной│";
                arr[arr.size] = "              │   валюте в   │";
                arr[arr.size] = "              │   рублевом   │";
                arr[arr.size] = "              │  эквиваленте │";
                arr[arr.size] = "──────────────┼──────────────┼";
                arr[arr.size] = "     " + strLPad(String(number * 2 - 1), 2, " ") + "       │     " + strLPad(String(number * 2), 2, " ") +"       │";

                return arr;
            end;

            macro correctHeader()
                const  POS = 50;/*позиция начала вывода*/
                stringArray[1] = substr(stringArray[1], 1, POS) + strAlign("Остаток по балансовому счету,", m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[2] = substr(stringArray[2], 1, POS) + strAlign("по коду обозначения",           m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[3] = substr(stringArray[3], 1, POS) + strAlign("за каждую календарную дату",    m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
                stringArray[4] = substr(stringArray[4], 1, POS) + strAlign("отчетного периода",             m_applicationLength - POS - 1, STR_ALIGN_CENTER) + "│";
            end;

            stringArray[stringArray.size] = "┌──────┬─────────────────────────────────────────┬";
            stringArray[stringArray.size] = "│Номер │        Наименование показателя,         │";
            stringArray[stringArray.size] = "│строки│        номер балансового счета,         │";
            stringArray[stringArray.size] = "│      │            код обозначения              │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         ├";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "│      │                                         │";
            stringArray[stringArray.size] = "├──────┼─────────────────────────────────────────┼";
            stringArray[stringArray.size] = "│  1   │                    2                    │";

            var dateCount : Integer = m_numberDatesInOneBlock;
            var i         : Integer = 0;

            while ((i < dateCount) and (beginDateInBlock + i <= global.parameters.getEndDate()))
                unionArray(stringArray, getArray(beginDateInBlock + i, i + 2));
                i = i + 1;
            end;

            m_applicationLength = strLen(stringArray[0]);
            correctHeader();
            closeTable();
        end;

        makeHeader(beginDateInBlock);

        if (m_isFistBlock)
            m_isFistBlock = false;
            printLn(strLpad("                  Приложение 2 ", m_applicationLength, " "));
            printLn(strLpad("      к Положению Банка России ", m_applicationLength, " "));
            printLn(strLpad("от 1 декабря 2015 года № 507-П ", m_applicationLength, " "));
            printLn(strLpad("    \"Об обязательных резервах ", m_applicationLength, " "));
            printLn(strLpad("       кредитных организаций\" ", m_applicationLength, " "));
            printLn();
            printApplicationTitle();
            printPeriod();

            printNameLendingAgency();

            printLn(strLpad("    тыс. рублей ", m_applicationLength, " "));
        end;

        var i : Integer = 0;
        while (i < stringArray.size)
            println(stringArray[i]);
            i = i + 1;
        end;
    end;

    private macro printFooterComments()
        printarray(StrTransferByWord("(1) При проведении внеочередного регулирования размера обязательных резервов указываются даты (дата) отчетного периода, установленного Банком России." , m_applicationLength));
        printarray(StrTransferByWord("(2) Показатель рассчитывается по формуле средней арифметической величины, указанной в пункте 1 приложения 9 к настоящему Положению." , m_applicationLength));
        printarray(StrTransferByWord("(3) Остатки по кодам обозначения 314001, 314002, 437001, 437002 включаются в настоящее приложение центральным контрагентом." , m_applicationLength));
    end;

    macro normalizeDecoding()
        var iterator = TApplicationRow(m_name).getAttributeValueIterator(m_name);
        var i = 0;

        iterator.moveFirst();
        while (not iterator.isDone())
            if (iterator.currentItem.fieldValue("roubleRest").exact < $0.0)
                iterator.currentItem.fieldValue("roubleRest").scaled = $0.0;
            end;
            if (iterator.currentItem.fieldValue("currencyRest").exact < $0.0)
                iterator.currentItem.fieldValue("currencyRest").scaled = $0.0;
            end;
            iterator.moveNext();
        end;

        normalizeDecoding();
    end;

    private macro constructorTApplication2_5242(applView)
        initTApplication_5036(applView);

        m_name           = "Приложение2";
        m_reportWidth    = 80;
        m_klikoExporter  = TApplication2KlikoExporter_5036();
        m_ptkPsdExporter = TApplication2PtkPsdExporter_5036();

        m_rows.size = 0;
        m_rows[m_rows.size] = TApplicationRow2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_2_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_3_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_4_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_1_5_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_2_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_3_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_4_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_5_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_1_2_6_5242(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_1_6_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_1_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_2_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_3_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_4_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_5_5036(m_name, m_xlsApplView);
        m_rows[m_rows.size] = TApplicationRow2_3_2_6_5036(m_name, m_xlsApplView);

        calculateNumberBlocks();
    end;

    constructorTApplication2_5242(applView);
end;
