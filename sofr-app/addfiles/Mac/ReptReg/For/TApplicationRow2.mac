/*─────────────────────────────────────────────────────────────────────────────────────────────────┐
  RS-Bank V6                                                                        R-Style Softlab
  Файл подсистемы "Регламентируемая отчетность"

  Классы строк приложения2 ФОР

  Создан: 20.04.2007 - Ser.
└─────────────────────────────────────────────────────────────────────────────────────────────────*/
/***************************************************************************************************
 *  Класc строки 1 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_1(applicationName : String)
    initTApplicationRow2_7(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter2_1_Gr1(balanceMasks : String, category : String)
        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    local class (TDataSourceFilter) TDataSourceFilter2_1_Gr2(balanceMasks : String, category : String)
        macro makePartFilter()
            var application7Filter = "   (" + global.form.getApplication7().getRow("1").getFilter().getSqlFilter() + ")"
                +"\n"+               "OR (" + global.form.getApplication7().getRow("2").getFilter().getSqlFilter() + ")"
                +"\n"+               "OR (" + global.form.getApplication7().getRow("3").getFilter().getSqlFilter() + ")";

            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                +"\n"+ "AND  NOT (" + application7Filter + ")"
                +"\n"+ "AND  (" + hasNotResidentBankOperationContragent("account.t_account", "account.t_fiId", "account.t_chapter")
                +"\n"+ "      OR  (" + isBank("account.t_clientCode")
                +"\n"+ "            AND  " + isNotResident("account.t_clientCode") + "))";
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    private macro constructor()
        m_code = "1";
    end;


    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_1_Gr1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "КО_Нерез"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_1_Gr2("47426"), m_code, m_applicationName, "474261"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "КО_Нерез");
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_1", this, "КО_Нерез", "RV").export();

        TPtkPsdDecodingExporter("OR2_1", this, "RV", "474261").export();
    end;

    macro getBalanceMasks()
        return getBalanceMasksForRow(m_code);
    end;

    macro getDecodingBalanceMasks()
        return "47426";
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "КО_Нерез"),
                                                                  TBalanceId("Приложение7", "1", "ФОР")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                if (v1.fieldValue("balanceGroup").exact < v2.fieldValue("balanceGroup").exact)
                    return true;
                elif (v1.fieldValue("balanceGroup").exact == v2.fieldValue("balanceGroup").exact)
                    if (v1.fieldValue("balance").exact < v2.fieldValue("balance").exact)
                        return true;
                    elif (v1.fieldValue("balance").exact == v2.fieldValue("balance").exact)
                        if (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)))
                            return true;
                        end;
                    end;
                end;
                return false;
            end;
        end;

        exportDescriptionRow("1.Балансовые счета по учету обязательств перед банками-нерезидентами");
        exportValueRow(getValueIterator(TSorter()));

    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                if (v1.fieldValue("balanceGroup").exact < v2.fieldValue("balanceGroup").exact)
                    return true;
                elif (v1.fieldValue("balanceGroup").exact == v2.fieldValue("balanceGroup").exact)
                    if (v1.fieldValue("balance").exact < v2.fieldValue("balance").exact)
                        return true;
                    elif (v1.fieldValue("balance").exact == v2.fieldValue("balance").exact)
                        if (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)))
                            return true;
                        end;
                    end;
                end;
                return false;
            end;
        end;

        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Балансовые счета по учету обязательств", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед банками - нерезидентами", null, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), false, true, true);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 1.1 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_1_1(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "1.1";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "1");
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            summarizeAndSaveAttributeValue(getAttributeValueIterator(m_applicationName, TFilter(), TSorter()));
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_2", this, "RV").export();
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;

        exportValueRow(getValueIterator(TSorter()), "1.1.Итого (сумма остатков балансовых счетов по строке 1)");
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), true, true, true, " ИТОГО");
        printDescriptionRow(" (сумма остатков", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов по", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строке 1)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 1.2 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_1_2(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "1.2";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "1.2");
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            summarizeAndSaveAttributeValue(getAttributeValueIterator("Приложение3", TFilter(), TSorter()), "расшифровка", "314316");
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_3", this, "RV", "314316").export();
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;

        exportDescriptionRow("1.2.");
        exportValueRow(getValueIterator(TSorter()));
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, false, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), false, true, true);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 1.3 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_1_3(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "1.3";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "1.2");
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            summarizeAndSaveAttributeValue(getAttributeValueIterator(m_applicationName, TFilter(), TSorter()));
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "RV").export();
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;

        exportValueRow(getValueIterator(TSorter()), "1.3.ИТОГО (сумма остатков по кодам по строке 1.2)");
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), true, true, true, " Итого (сумма остатков по ");
        printDescriptionRow(" кодам по строке 1.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 1.4 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_1_4(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "1.4";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return ((v.fieldValue("row").exact == "1.1") or (v.fieldValue("row").exact == "1.3"));
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            subtractAndSaveAttributeValue(getAttributeValueIterator(m_applicationName, TFilter(), TSorter()), "1.1", "1.3");
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_4", this, "RV").export();
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;

        exportValueRow(getValueIterator(TSorter()), "1.4.ВСЕГО (строка 1.1 - строка 1.3)");
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), true, true, true, " ВСЕГО (строка 1.1 - 1.3)");
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 1.5 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_1_5(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "1.5";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "1.4");
            end;
        end;

        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            chronologicAverage = calculateChronologicAverage(getAttributeValueIterator(m_applicationName, TFilter()));
            saveAttributeValue("", "", Date(0,0,0), chronologicAverage.rouble, $0.0, chronologicAverage.scaledRouble, 0.0);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdChronologicAverageExporter("OR2_4", this, "R").export();
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";


        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("1.5.Средняя хронологическая величина резервируемых обязательств перед банками-нерезидентами в валюте РФ", value);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;

        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printSingleValueRow(getValueIterator(TSorter(), null, null), " Средняя хронологическая", reportWidth, true);
        printDescriptionRow(" величина резервируемых", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств перед", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" банками - нерезидентами в", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте Российской", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федерации (по данным", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 1.4 графы \"в рублях\")", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 1.6 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_1_6(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "1.6";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "1.4");
            end;
        end;

        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            chronologicAverage = calculateChronologicAverage(getAttributeValueIterator(m_applicationName, TFilter()));
            saveAttributeValue("", "", Date(0,0,0), $0.0, chronologicAverage.currency, 0.0, chronologicAverage.scaledCurrency);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdChronologicAverageExporter("OR2_4", this, "V").export();
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";


        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        exportSingleValueRow("1.6.Средняя хронологическая величина резервируемых обязательств перед банками-нерезидентами в иностранной валюте", value);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;
        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printSingleValueRow(getValueIterator(TSorter(), null, null), " Средняя хронологическая", reportWidth, false);
        printDescriptionRow(" величина резервируемых", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств перед", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" банками - нерезидентами в", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте Российской", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федерации (по данным", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 1.4 графы \"иностранная валюта в", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" рублевом эквиваленте\")", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 2 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_2(applicationName : String)
    initTApplicationRow2_7(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter2_2_Gr1(balanceMasks : String, category : String)
        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance");
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    local class (TDataSourceFilter) TDataSourceFilter2_2_Gr2(balanceMasks : String, category : String)
        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                +"\n"+ "AND  (" + hasNaturalPersonOperationContragent("account.t_account", "account.t_fiId", "account.t_chapter")
                +"\n"+ "      OR  " + isNaturalPerson("account.t_clientCode") + ")";
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    private macro constructor()
        m_code = "2";
    end;


    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_2_Gr1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ФЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_2_Gr2(getBalanceMasksForRow("2(2)")), m_code, m_applicationName, "1"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_2_Gr2("47426"), m_code, m_applicationName, "474262"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ФЛ");
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("2(2)");

        return balanceMasks;
    end;

    macro getDecodingBalanceMasks()
        return "47426";
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ФЛ"),
                                                                  TBalanceId("Приложение7", "1", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_5", this, "ФЛ",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_5", this, "Расш", "RV").export();

        TPtkPsdDecodingExporter("OR2_5", this, "RV", "474262").export();
    end;


    macro exportToKliko()
        class TSorter
            macro isLess(v1, v2)
                return (v1.fieldValue("balance").currentAsString < v2.fieldValue("balance").currentAsString)
                    or (     (v1.fieldValue("balance").currentAsString == v2.fieldValue("balance").currentAsString)
                         and (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current))));
            end;
        end;

        exportDescriptionRow("2.Балансовые счета по учету обязательств перед физическими лицами");
        exportValueRow(getValueIterator(TSorter()));

    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter
            macro isLess(v1, v2)
                macro getGroupCode(bg)
                    if (bg == "ФЛ")   return 1; end;
                    if (bg == "Расш") return 2; end;
                    return 3;
                end;

                var bgCode1 = getGroupCode(v1.fieldValue("balanceGroup").current);
                var bgCode2 = getGroupCode(v2.fieldValue("balanceGroup").current);

                return (bgCode1 < bgCode2)
                    or (     (bgCode1 == bgCode2)
                         and (v1.fieldValue("balance").current < v2.fieldValue("balance").current))
                    or (     (v1.fieldValue("balance").current == v2.fieldValue("balance").current)
                         and (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current))));
            end;
        end;

        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Балансовые счета по учету обязательств", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" перед физическими лицами", null, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), false, true, true);
    end;

    constructor();
end;
/***************************************************************************************************
 *  Класc строки 2 приложения2 после 1827У
 **************************************************************************************************/
class (TApplicationRow2_2) TApplicationRow2_2_1827(applicationName : String)
    initTApplicationRow2_2(applicationName);

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_2_Gr1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ФЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_2_Gr2(getBalanceMasksForRow("2(2)")), m_code, m_applicationName, "1"));
    end;

    macro getDecodingBalanceMasks()
        return "";
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ФЛ"),
                                                                  TBalanceId("Приложение7", "1", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "Расш")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_5", this, "ФЛ",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_5", this, "Расш", "RV").export();
    end;
end;

/***************************************************************************************************
 *  Класc строки 2 приложения2 после 2184У
 **************************************************************************************************/
class (TApplicationRow2_2_1827) TApplicationRow2_2_2184(applicationName : String)
    initTApplicationRow2_2_1827(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter2_2__2184(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = "    NOT " + hasAssignedCategory()
                        +"\n"+ "AND (   (    " + isNaturalPerson("account.t_contractorId")
                        +"\n"+ "         AND NOT " + isEmployer("account.t_contractorId")
                        +"\n"+ "        )"
                        +"\n"+ "     OR (    " + isNaturalPerson("account.t_clientCode")
                        +"\n"+ "         AND NOT " + isEmployer("account.t_clientCode")
                        +"\n"+ "        )"
                        +"\n"+ "     OR (" + hasAssignedCategory("Строка 2.2") + ")"
                        +"\n"+ "    )"
                        ;
        end;

        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                ;
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    local class (TDataSourceFilter) TDataSourceFilter2_2__2184_Gr1(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = "    NOT " + hasAssignedCategory()
                        +"\n"+ "AND (   (    " + isNaturalPerson("account.t_contractorId")
                        +"\n"+ "         AND NOT " + isEmployer("account.t_contractorId")
                        +"\n"+ "        )"
                        +"\n"+ "     OR (    " + isNaturalPerson("account.t_clientCode")
                        +"\n"+ "         AND NOT " + isEmployer("account.t_clientCode")
                        +"\n"+ "        )"
                        +"\n"+ "     OR (" + hasAssignedCategory("Строка 2.2") + ")"
                        +"\n"+ "    )"
                        ;
        end;

        macro makePartFilter()
            var application7Filter = "   (" + global.form.getApplication7().getRow("1").getFilter().getSqlFilter() + ")"
                +"\n"+               "OR (" + global.form.getApplication7().getRow("2").getFilter().getSqlFilter() + ")"
                +"\n"+               "OR (" + global.form.getApplication7().getRow("3").getFilter().getSqlFilter() + ")";

            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                +"\n"+ "AND  NOT (" + application7Filter + ")"
                ;
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_2__2184(getBalanceMasksForRow(m_code), "R"), m_code, m_applicationName, "ФЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_2__2184_Gr1(getBalanceMasksForRow("2(2)"), "R"), m_code, m_applicationName, "1"));
    end;
end;

/***************************************************************************************************
 *  Класc строки 2.1 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_2_1(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "2.1";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "2");
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            summarizeAndSaveAttributeValue(getAttributeValueIterator(m_applicationName, TFilter(), TSorter()));
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_6", this, "RV").export();
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;

        exportValueRow(getValueIterator(TSorter()), "2.1.ИТОГО (сумма остатков балансовых счетов по строке 2)");
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), true, true, true, " ИТОГО");
        printDescriptionRow(" (сумма остатков", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" балансовых счетов по", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строке 2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 2.2 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_2_2(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "2.2";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "2.1");
            end;
        end;

        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            chronologicAverage = calculateChronologicAverage(getAttributeValueIterator(m_applicationName, TFilter()));
            saveAttributeValue("", "", Date(0,0,0), chronologicAverage.rouble, $0.0, chronologicAverage.scaledRouble, 0.0);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdChronologicAverageExporter("OR2_6", this, "R").export();
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";


        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("2.2.Средняя хронологическая величина резервируемых обязательств перед физическими лицами в валюте РФ", value);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printSingleValueRow(getValueIterator(TSorter(), null, null), " Средняя хронологическая", reportWidth, true);
        printDescriptionRow(" величина резервируемых", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств перед", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" физическими лицами в", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте Российской", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федерации (по данным", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 2.1 графы \"в рублях\")", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;


/***************************************************************************************************
 *  Класc строки 3 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_3(applicationName : String)
    initTApplicationRow2_7(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter2_3_Gr1(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = " " + hasAssignedCategory()
                        ;
        end;

        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                ;
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    local class (TDataSourceFilter) TDataSourceFilter2_3_Gr2(balanceMasks : String, category : String)
        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                +"\n"+ "AND  ( NOT " + hasNaturalPersonOperationContragent("account.t_account", "account.t_fiId", "account.t_chapter")
                +"\n"+ "       OR  " + isNaturalPerson("account.t_clientCode") + ")";
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    private macro constructor()
        m_code = "3";
    end;


    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_3_Gr1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_3_Gr2(getBalanceMasksForRow("3(2)")), m_code, m_applicationName, "2"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40108, 40109"), m_code, m_applicationName, "401081","40108", "40109"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40110, 40111"), m_code, m_applicationName, "401101","40110", "40111"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40306, 40308"), m_code, m_applicationName, "403061","40306", "40308"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("47426"), m_code, m_applicationName, "474263"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "F"), m_code, m_applicationName, "603221"));
    end;

    macro fillTempTableForBalanceData(tempTable : TTempTable)
        fillTempTable(tempTable);

        var dataSet = getBalanceDataSet(getBalanceMasksForRow(m_code));

        updateTempTable(dataSet, "ЮЛ");
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_7", this, "ЮЛ",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш", "RV").export();

        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401081").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401101").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "403061").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "474263").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603221").export();
    end;

    macro getBalanceMasks()
        var balanceMasks = getBalanceMasksForRow(m_code);

        if (balanceMasks != "")
            balanceMasks = balanceMasks + ",";
        end;

        balanceMasks = balanceMasks + getBalanceMasksForRow("3(2)");

        return balanceMasks;
    end;

    macro getDecodingBalanceMasks()
        return "40108, 40109, 40110, 40111, 40306, 40308, 47426, 60322";
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ"),
                                                                  TBalanceId("Приложение7", "1", "ФОР"),
                                                                  TBalanceId("Приложение7", "2", "ФОР"),
                                                                  TBalanceId("Приложение7", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest, dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "Расш"),
                                                                  TBalanceId(m_applicationName, "2", "Расш"),
                                                                  TBalanceId("Приложение7", "1", "ФОР"),
                                                                  TBalanceId("Приложение7", "2", "ФОР"),
                                                                  TBalanceId("Приложение7", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;


            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка"), "474263, 603221"));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, correctNegativeValue(dataSet.roubleRest, $0), correctNegativeValue(dataSet.currencyRest, $0));
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "603221")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "474263"),
                                                                  TBalanceId(m_applicationName, "1", "расшифровка", "474261"),
                                                                  TBalanceId("Приложение7", "1", "ФОР", "47426"),
                                                                  TBalanceId("Приложение7", "2", "ФОР", "47426"),
                                                                  TBalanceId("Приложение7", "3", "ФОР", "47426")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;

    macro exportToKliko()
        class TSorter
            macro isLess(v1, v2)
                return (v1.fieldValue("balance").currentAsString < v2.fieldValue("balance").currentAsString)
                    or (     (v1.fieldValue("balance").currentAsString == v2.fieldValue("balance").currentAsString)
                         and (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current))));
            end;
        end;

        exportDescriptionRow("3.Балансовые счета по учету иных обязательств");
        exportValueRow(getValueIterator(TSorter()));
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter
            macro isLess(v1, v2)
                macro getGroupCode(bg)
                    if (bg == "ЮЛ")   return 1; end;
                    if (bg == "Расш") return 2; end;
                    return 3;
                end;

                var bgCode1 = getGroupCode(v1.fieldValue("balanceGroup").current);
                var bgCode2 = getGroupCode(v2.fieldValue("balanceGroup").current);

                return (bgCode1 < bgCode2)
                    or (     (bgCode1 == bgCode2)
                         and (v1.fieldValue("balance").current < v2.fieldValue("balance").current))
                    or (     (v1.fieldValue("balance").current == v2.fieldValue("balance").current)
                         and (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current))));
            end;
        end;

        printSeparator(WIDTH_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Балансовые счета по учету ", true, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" иных обязательств", null, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), false, true, true);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 3 приложения2 после 1827У
 **************************************************************************************************/
class (TApplicationRow2_3) TApplicationRow2_3_1827(applicationName : String)
    initTApplicationRow2_3(applicationName);

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_3_Gr1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_3_Gr1(getBalanceMasksForRow("3(2)")), m_code, m_applicationName, "2"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40108, 40109"), m_code, m_applicationName, "401081","40108", "40109"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40110, 40111"), m_code, m_applicationName, "401101","40110", "40111"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40306, 40308"), m_code, m_applicationName, "403061","40306", "40308"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("47426"), m_code, m_applicationName, "474263"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "F"), m_code, m_applicationName, "603221"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "E"), m_code, m_applicationName, "603222"));
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_7", this, "ЮЛ",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш", "RV").export();

        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401081").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401101").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "403061").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "474263").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603221").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603222").export();
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ"),
                                                                  TBalanceId("Приложение7", "1", "ФОР"),
                                                                  TBalanceId("Приложение7", "2", "ФОР"),
                                                                  TBalanceId("Приложение7", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "Расш"),
                                                                  TBalanceId(m_applicationName, "2", "Расш"),
                                                                  TBalanceId("Приложение7", "1", "ФОР"),
                                                                  TBalanceId("Приложение7", "2", "ФОР"),
                                                                  TBalanceId("Приложение7", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;


            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка"), "474263, 603221, 603222"));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, correctNegativeValue(dataSet.roubleRest, $0), correctNegativeValue(dataSet.currencyRest, $0));
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "603221")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "603222")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "474263"),
                                                                  TBalanceId(m_applicationName, "1", "расшифровка", "474261"),
                                                                  TBalanceId("Приложение7", "1", "ФОР", "47426"),
                                                                  TBalanceId("Приложение7", "2", "ФОР", "47426"),
                                                                  TBalanceId("Приложение7", "3", "ФОР", "47426")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;
end;

/***************************************************************************************************
 *  Класc строки 3 приложения2 после 1951У
 **************************************************************************************************/
class (TApplicationRow2_3_1827) TApplicationRow2_3_1951(applicationName : String)
    initTApplicationRow2_3_1827(applicationName);

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_3_Gr1(getBalanceMasksForRow(m_code)), m_code, m_applicationName, "ЮЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_3_Gr1(getBalanceMasksForRow("3(2)")), m_code, m_applicationName, "2"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40108, 40109"), m_code, m_applicationName, "401081","40108", "40109"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40110, 40111"), m_code, m_applicationName, "401101","40110", "40111"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40306, 40308"), m_code, m_applicationName, "403061","40306", "40308"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("47426"), m_code, m_applicationName, "474263"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "F"), m_code, m_applicationName, "603221"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "E"), m_code, m_applicationName, "603222"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "A"), m_code, m_applicationName, "603223"));
    end;

    macro exportToPtkPsd()
        TPtkPsdBalanceGroupExporter("OR2_7", this, "ЮЛ",   "RV").export();
        TPtkPsdBalanceGroupExporter("OR2_7", this, "Расш", "RV").export();

        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401081").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "401101").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "403061").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "474263").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603221").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603222").export();
        TPtkPsdDecodingExporter("OR2_7", this, "RV", "603223").export();
    end;

    macro saveAttributes()
        var dataSet : Object;
        var i = 0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "ЮЛ"),
                                                                  TBalanceId("Приложение7", "1", "ФОР"),
                                                                  TBalanceId("Приложение7", "2", "ФОР"),
                                                                  TBalanceId("Приложение7", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest,  dataSet.roubleScaledRest, dataSet.currencyScaledRest);
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "Расш"),
                                                                  TBalanceId(m_applicationName, "2", "Расш"),
                                                                  TBalanceId("Приложение7", "1", "ФОР"),
                                                                  TBalanceId("Приложение7", "2", "ФОР"),
                                                                  TBalanceId("Приложение7", "3", "ФОР")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;


            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка"), "474263, 603221, 603222, 603223"));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, correctNegativeValue(dataSet.roubleRest, $0), correctNegativeValue(dataSet.currencyRest, $0));
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "603221")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "603222")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "603223")));
            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            dataSet = TRsbDataSet(createQueryForDifferenceBalance(TBalanceId(m_applicationName, m_code, "расшифровка", "474263"),
                                                                  TBalanceId(m_applicationName, "1", "расшифровка", "474261"),
                                                                  TBalanceId("Приложение7", "1", "ФОР", "47426"),
                                                                  TBalanceId("Приложение7", "2", "ФОР", "47426"),
                                                                  TBalanceId("Приложение7", "3", "ФОР", "47426")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;
        end;
    end;
end;

/***************************************************************************************************
 *  Класc строки 3 приложения2 после 2184У
 **************************************************************************************************/
class (TApplicationRow2_3_1951) TApplicationRow2_3_2184(applicationName : String)
    initTApplicationRow2_3_1951(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter2_3_Gr1_2184(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = "    (   " + isSatisfiesToBalancesMasks("account.t_balance", "40312, 47409")
                        +"\n"+ "     OR NOT " + hasAssignedCategory()
                        +"\n"+ "    )"
                        +"\n"+ "AND NOT " + hasAssignedCategory("Строка2.2")
                        ;
        end;

        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                ;
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;
    local class (TDataSourceFilter) TDataSourceFilter2_3_Gr2_2184(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = "    NOT " + hasAssignedCategory()
                        +"\n"+ "AND NOT " + hasAssignedCategory("Строка2.2")
                        ;
        end;

        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                ;
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TBalanceDataSource(TDataSourceFilter2_3_Gr1_2184(getBalanceMasksForRow(m_code), "R"), m_code, m_applicationName, "ЮЛ"));
        tempTable.fill(TBalanceDecodingDataSource(TDataSourceFilter2_3_Gr2_2184(getBalanceMasksForRow("3(2)"), "R"), m_code, m_applicationName, "2"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40108, 40109"), m_code, m_applicationName, "401081","40108", "40109"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40110, 40111"), m_code, m_applicationName, "401101","40110", "40111"));
        tempTable.fill(TDecodingDifferenceDataSource(TDataSourceFilter2_3_Gr1("40306, 40308"), m_code, m_applicationName, "403061","40306", "40308"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("47426"), m_code, m_applicationName, "474263"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "F"), m_code, m_applicationName, "603221"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "E"), m_code, m_applicationName, "603222"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_Gr1("60322", "A"), m_code, m_applicationName, "603223"));
    end;
end;

/***************************************************************************************************
 *  Класc строки 3.1 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_3_1(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "3.1";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "3");
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            summarizeAndSaveAttributeValue(getAttributeValueIterator(m_applicationName, TFilter(), TSorter()));
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_8", this, "RV").export();
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;

        exportValueRow(getValueIterator(TSorter()), "3.1.ИТОГО (сумма остатков балансовых счетов по строке 3)");
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").exact)) < Date(trim(v2.fieldValue("date").exact)));
            end;
        end;
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), true, true, true, " ИТОГО (сумма остатков");
        printDescriptionRow(" балансовых счетов по", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строке 3)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 3.2 приложения2 до 1951У
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_3_2(applicationName : String)
    initTApplicationRow2_7(applicationName);

    local class (TDataSourceFilter) TDataSourceFilter2_3_2(balanceMasks : String, category : String)
        macro makePartDateFilter()
            m_partDateFilter = "    " + hasAssignedCategory()
                        ;
        end;

        macro makePartFilter()
            m_partFilter = " " + isSatisfiesToBalancesMasks("account.t_balance")
                ;
        end;
        initTDataSourceFilter(balanceMasks, category);
    end;

    private macro constructor()
        m_code = "3.2";
    end;
    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_2("30604", "R"), m_code, m_applicationName, "306041", NULL, global.ROUBLE_ONLY));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_2("40312", "R"), m_code, m_applicationName, "403121", NULL, global.ROUBLE_ONLY));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_2("47409", "R"), m_code, m_applicationName, "474091"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_2("52005", "D"), m_code, m_applicationName, "520051"));
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "306041").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "403121").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "410440").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "474091").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "520051").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "520514").export();
    end;

    macro getDecodingBalanceMasks()
        return "30604, 40312, 47409, 52005";
    end;

    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var dataSet        : Object;
        var i = 0;

        class TFilterAppl_3()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "1.4");
            end;
        end;

        class TFilterAppl_5()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "3");
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            dataSet = TRsbDataSet(createQueryForBalance(TBalanceId(m_applicationName, "3.2", "расшифровка")));

            while (dataSet.moveNext())
                saveAttributeValue(dataSet.balanceGroup, dataSet.balance, dataSet.date, dataSet.roubleRest, dataSet.currencyRest);
            end;

            iterator = getAttributeValueIterator("Приложение3", TFilterAppl_3());
            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                saveAttributeValue("расшифровка", "410440", Date(trim(compositeValue.fieldValue("date").exact)),
                                   compositeValue.fieldValue("roubleRest").exact,compositeValue.fieldValue("currencyRest").exact,
                                   compositeValue.fieldValue("roubleRest").scaled,compositeValue.fieldValue("currencyRest").scaled);
                iterator.moveNext();
            end;

            iterator = getAttributeValueIterator("Приложение5", TFilterAppl_5());
            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                saveAttributeValue("расшифровка", "520514", Date(trim(compositeValue.fieldValue("date").exact)),
                                   compositeValue.fieldValue("roubleRest").exact,compositeValue.fieldValue("currencyRest").exact,
                                   compositeValue.fieldValue("roubleRest").scaled,compositeValue.fieldValue("currencyRest").scaled);
                iterator.moveNext();
            end;
        end;
    end;

    macro exportToKliko()
        global.rowCode = m_code;
        class TFilter1()
            macro isSuitable(v : Object)
                return     (v.fieldValue("row").current == global.rowCode)
                       and ((v.fieldValue("balance").current == "306041") or (v.fieldValue("balance").current == "403121"));
            end;
        end;

        class TFilter2()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").current == global.rowCode) and (v.fieldValue("balance").current == "474091");
            end;
        end;

        class TFilter3()
            macro isSuitable(v : Object)
                return     (v.fieldValue("row").current == global.rowCode)
                       and (v.fieldValue("balance").current != "306041")
                       and (v.fieldValue("balance").current != "474091")
                       and (v.fieldValue("balance").current != "403121");
            end;
        end;

        class TSorter
            macro isLess(v1, v2)
                return (v1.fieldValue("balance").current < v2.fieldValue("balance").current)
                    or (     (v1.fieldValue("balance").current == v2.fieldValue("balance").current)
                         and (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current))));
            end;
        end;

        exportDescriptionRow("3.2.Вычитаются:");
        exportRoubleValueRow(getAttributeValueIterator(m_applicationName, TFilter1(), TSorter()));
        exportValueRow(getAttributeValueIterator(m_applicationName, TFilter2(), TSorter()));
        exportValueRow(getAttributeValueIterator(m_applicationName, TFilter3(), TSorter()));
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        class TFilter1(beginDateInBlock, numberDatesInBlock)
            private var m_beginDateInBlock = beginDateInBlock;
            private var m_numberDatesInBlock = numberDatesInBlock;
            macro isSuitable(v : Object)
                return     (v.fieldValue("row").current == global.rowCode)
                       and ((v.fieldValue("balance").current == "306041") or (v.fieldValue("balance").current == "403121"))
                       and (v.fieldValue("date").current >= m_beginDateInBlock)
                       and (v.fieldValue("date").current < m_beginDateInBlock + m_numberDatesInBlock);
            end;
        end;

        class TFilter2(beginDateInBlock, numberDatesInBlock)
            private var m_beginDateInBlock = beginDateInBlock;
            private var m_numberDatesInBlock = numberDatesInBlock;
            macro isSuitable(v : Object)
                return     (v.fieldValue("row").current == global.rowCode)
                       and (v.fieldValue("balance").current != "306041")
                       and (v.fieldValue("balance").current != "403121")
                       and (v.fieldValue("date").current >= m_beginDateInBlock)
                       and (v.fieldValue("date").current < m_beginDateInBlock + m_numberDatesInBlock);
            end;
        end;

        class TSorter
            macro isLess(v1, v2)
                return (v1.fieldValue("balance").current < v2.fieldValue("balance").current)
                    or (     (v1.fieldValue("balance").current == v2.fieldValue("balance").current)
                         and (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current))));
            end;
        end;

        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getAttributeValueIterator(m_applicationName, TFilter1(beginDateInBlock, numberDatesInBlock), TSorter()), false, true, false);
        printRow(getAttributeValueIterator(m_applicationName, TFilter2(beginDateInBlock, numberDatesInBlock), TSorter()), false, true, true);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 3.2 приложения2 после 1951У
 **************************************************************************************************/
class (TApplicationRow2_3_2) TApplicationRow2_3_2_1951(applicationName : String)
    initTApplicationRow2_3_2(applicationName);

    macro fillTempTable(tempTable : TTempTable)
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_2("40312", "R"), m_code, m_applicationName, "403121", NULL, global.ROUBLE_ONLY));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_2("47409", "R"), m_code, m_applicationName, "474091"));
        tempTable.fill(TDecodingDataSource(TDataSourceFilter2_3_2("52005", "D"), m_code, m_applicationName, "520051"));
    end;

    macro exportToPtkPsd()
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "403121").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "410440").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "474091").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "520051").export();
        TPtkPsdDecodingExporter("OR2_9", this, "RV", "520514").export();
    end;

    macro getDecodingBalanceMasks()
        return "40312, 47409, 52005";
    end;

    macro exportToKliko()
        global.rowCode = m_code;
        class TFilter1()
            macro isSuitable(v : Object)
                return     (v.fieldValue("row").current == global.rowCode)
                       and (v.fieldValue("balance").current == "403121");
            end;
        end;

        class TFilter2()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").current == global.rowCode) and (v.fieldValue("balance").current == "474091");
            end;
        end;

        class TFilter3()
            macro isSuitable(v : Object)
                return     (v.fieldValue("row").current == global.rowCode)
                       and (v.fieldValue("balance").current != "474091")
                       and (v.fieldValue("balance").current != "403121");
            end;
        end;

        class TSorter
            macro isLess(v1, v2)
                return (v1.fieldValue("balance").current < v2.fieldValue("balance").current)
                    or (     (v1.fieldValue("balance").current == v2.fieldValue("balance").current)
                         and (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current))));
            end;
        end;

        exportDescriptionRow("3.2.Вычитаются:");
        exportRoubleValueRow(getAttributeValueIterator(m_applicationName, TFilter1(), TSorter()));
        exportValueRow(getAttributeValueIterator(m_applicationName, TFilter2(), TSorter()));
        exportValueRow(getAttributeValueIterator(m_applicationName, TFilter3(), TSorter()));
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        global.rowCode = m_code;
        class TFilter1(beginDateInBlock, numberDatesInBlock)
            private var m_beginDateInBlock = beginDateInBlock;
            private var m_numberDatesInBlock = numberDatesInBlock;
            macro isSuitable(v : Object)
                return     (v.fieldValue("row").current == global.rowCode)
                       and (v.fieldValue("balance").current == "403121")
                       and (Date(trim(v.fieldValue("date").current)) >= m_beginDateInBlock)
                       and (Date(trim(v.fieldValue("date").current)) < m_beginDateInBlock + m_numberDatesInBlock);
            end;
        end;

        class TFilter2(beginDateInBlock, numberDatesInBlock)
            private var m_beginDateInBlock = beginDateInBlock;
            private var m_numberDatesInBlock = numberDatesInBlock;
            macro isSuitable(v : Object)
                return     (v.fieldValue("row").current == global.rowCode)
                       and (v.fieldValue("balance").current != "403121")
                       and (Date(trim(v.fieldValue("date").current)) >= m_beginDateInBlock)
                       and (Date(trim(v.fieldValue("date").current)) < m_beginDateInBlock + m_numberDatesInBlock);
            end;
        end;

        class TSorter
            macro isLess(v1, v2)
                return (v1.fieldValue("balance").current < v2.fieldValue("balance").current)
                    or (     (v1.fieldValue("balance").current == v2.fieldValue("balance").current)
                         and (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current))));
            end;
        end;

        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Вычитаются:", true, null, beginDateInBlock, numberDatesInBlock);
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getAttributeValueIterator(m_applicationName, TFilter1(beginDateInBlock, numberDatesInBlock), TSorter()), false, true, false);
        printRow(getAttributeValueIterator(m_applicationName, TFilter2(beginDateInBlock, numberDatesInBlock), TSorter()), false, true, true);
    end;
end;

/***************************************************************************************************
 *  Класc строки 3.3 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_3_3(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "3.3";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "3.2");
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            summarizeAndSaveAttributeValue(getAttributeValueIterator(m_applicationName, TFilter(), TSorter()));
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_91", this, "RV").export();
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        exportValueRow(getValueIterator(TSorter()), "3.3.ИТОГО (сумма остатков по кодам по строке 3.2)");
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), true, true, true, " ИТОГО (сумма остатков по");
        printDescriptionRow(" кодам по строке 3.2)", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 3.4 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_3_4(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "3.4";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return ((v.fieldValue("row").exact == "3.1") or (v.fieldValue("row").exact == "3.3"));
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            subtractAndSaveAttributeValue(getAttributeValueIterator(m_applicationName, TFilter(), TSorter()), "3.1", "3.3");
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_91", this, "RV").export();
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        exportValueRow(getValueIterator(TSorter()), "3.4.ВСЕГО (строка 3.1 - строка 3.3)");
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;
        printSeparator(MIDDLE_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), true, true, true, " ВСЕГО (строка 3.1 - строка 3.3)");
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 3.5 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_3_5(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "3.5";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "3.4");
            end;
        end;

        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            chronologicAverage = calculateChronologicAverage(getAttributeValueIterator(m_applicationName, TFilter()));
            saveAttributeValue("", "", Date(0,0,0), chronologicAverage.rouble, $0.0, chronologicAverage.scaledRouble, 0.0);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdChronologicAverageExporter("OR2_91", this, "R").export();
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";


        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("roubleRest").currentAsString;
        end;

        exportSingleValueRow("3.5.Средняя хронологическая величина иных резервируемых обязательств", value);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printSingleValueRow(getValueIterator(TSorter(), null, null), " Средняя хронологическая", reportWidth, true);
        printDescriptionRow(" величина иных резервируемых", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств в", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюте Российской", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" Федерации (по данным", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" строки 3.4 графы \"в рублях\")", null, null, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 4 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_4(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "4";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return ((v.fieldValue("row").exact == "2.1") or (v.fieldValue("row").exact == "3.4"));
            end;
        end;

        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            summarizeAndSaveAttributeValue(getAttributeValueIterator(m_applicationName, TFilter(), TSorter()));
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdRowExporter("OR2_91", this, "V").export();
    end;

    macro exportToKliko()
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;

        exportCurrencyValueRow(getValueIterator(TSorter()), "4.ВСЕГО иных обязательств в иностранной валюте (стр. 2.1+стр.3.4) по данным графы ин.валюта в руб.эквивал. ");
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;
        printSeparator(TOP_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printRow(getValueIterator(TSorter(), beginDateInBlock, numberDatesInBlock), true, false, true, " ВСЕГО иных обязательств");
        printDescriptionRow(" в иностранной валюте", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" (строка 2.1 + строка 3.4), по", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" данным графы \"иностранная валюта", false, true, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в рублевом эквиваленте\"", false, true, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;

/***************************************************************************************************
 *  Класc строки 4.1 приложения2
 **************************************************************************************************/
class (TApplicationRow2_7) TApplicationRow2_4_1(applicationName : String)
    initTApplicationRow2_7(applicationName);

    private macro constructor()
        m_code = "4.1";
    end;

    macro saveAttributes()

        class TFilter()
            macro isSuitable(v : Object)
                return (v.fieldValue("row").exact == "4");
            end;
        end;

        var chronologicAverage : Object = NULL;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            chronologicAverage = calculateChronologicAverage(getAttributeValueIterator(m_applicationName, TFilter()));
            saveAttributeValue("", "", Date(0,0,0), $0.0, chronologicAverage.currency, 0.0, chronologicAverage.scaledCurrency);
        end;
    end;

    macro exportToPtkPsd()
        TPtkPsdChronologicAverageExporter("OR2_91", this, "V").export();
    end;

    macro exportToKliko()
        var iterator       : Object = getValueIterator();
        var value          : String = "0";


        if (iterator != null)
            iterator.moveFirst();
            value = iterator.currentItem.fieldValue("currencyRest").currentAsString;
        end;

        exportSingleValueRow("4.1.Средняя хронологическая величина иных резервируемых обязательств в иностранной валюте (по данным стр.4 графы ин.валюта в руб.эквивал.)", value);
    end;

    macro print(reportWidth : Integer, beginDateInBlock, numberDatesInBlock)
        class TSorter()
            macro isLess(v1 : Object, v2 : Object)
                return (Date(trim(v1.fieldValue("date").current)) < Date(trim(v2.fieldValue("date").current)));
            end;
        end;
        printSeparator(BOTTOM_SEPARATOR, beginDateInBlock, numberDatesInBlock);
        printSingleValueRow(getValueIterator(TSorter(), null, null), " Средняя хронологическая", reportWidth, false);
        printDescriptionRow(" величина иных резервируемых", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" обязательств", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" в иностранной валюте (по", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" данным строки 4 графы \"иностранная", null, null, beginDateInBlock, numberDatesInBlock);
        printDescriptionRow(" валюта в рублевом эквиваленте\"", null, null, beginDateInBlock, numberDatesInBlock);
        printBottom(null, beginDateInBlock, numberDatesInBlock);
    end;

    constructor();
end;
