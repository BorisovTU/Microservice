/*
$Name:          TApplicationRow1_507.mac
$Module:        Регламентируемая отчетность
$Description:   Классы строк приложения1 ФОР по 507-П
*/

/***************************************************************************************************
 *  Классы строки 1 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_1(applicationName : String)
    initTApplicationRow1(applicationName);

    private macro constructor()
        m_code = "1";
    end;

    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1", "1.2", "1.3", "1.4", "1.5", "1.6");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [┌──────┬─────────────────────────────────────────────────────┬────────────────┐];
        [│Номер │            Наименование показателя                  │     Сумма      │];
        [│строки│                                                     │                │];
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 1    │                          2                          │       3        │];
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 1    │Размер резервируемых обязательств, ВСЕГО             │############### │](getValue():r);
        [│      │(строка 1.1 + строка 1.2 + строка 1.3 +              │                │];
        [│      │строка 1.4 + строка 1.5+ строка 1.6),                │                │];
        [│      │ в том числе:                                        │                │];
    end;

    constructor();
end;

/***************************************************************************************************
 *  Классы строки 1.1 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_1_1(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение2", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.4");

            iterator.moveFirst();


            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("roubleRest").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("roubleRest").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 1.1  │Обязательства перед юридическими лицами-нерезидентами│############### │](getValue():r);
        [│      │в валюте Российской Федерации                        │                │];
        [│      │(строка 1.4 приложения 2(1))                         │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_1_1(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "1.1";
    end;

    constructorTApplicationRow507_1_1_1(applicationName);
end;

/***************************************************************************************************
 *  Классы строки 1.2 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_1_2(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение2", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.2");

            iterator.moveFirst();


            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("roubleRest").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("roubleRest").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 1.2  │Обязательства перед физическими лицами в валюте      │############### │](getValue():r);
        [│      │Российской Федерации (строка 2.2 приложения 2(1))    │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_1_2(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "1.2";
    end;

    constructorTApplicationRow507_1_1_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 1.3 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_1_3(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение2", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.5");

            iterator.moveFirst();


            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("roubleRest").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("roubleRest").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 1.3  │Иные обязательства в валюте Российской Федерации     │############### │](getValue():r);
        [│      │(строка 3.5 приложения 2(1))                         │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_1_3(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "1.3";
    end;

    constructorTApplicationRow507_1_1_3(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 1.4 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_1_4(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение2", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.5");

            iterator.moveFirst();


            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("currencyRest").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("currencyRest").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 1.4  │Обязательства перед юридическими лицами-нерезидентами│############### │](getValue():r);
        [│      │в иностранной валюте (строка 1.5 приложения 2(1))    │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_1_4(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "1.4";
    end;

    constructorTApplicationRow507_1_1_4(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 1.5 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_1_5(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение2", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.3");

            iterator.moveFirst();


            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("currencyRest").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("currencyRest").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 1.5  │Обязательства перед физическими лицами в иностранной │############### │](getValue():r);
        [│      │валюте (строка 2.3 приложения 2(1))                  │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_1_5(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "1.5";
    end;

    constructorTApplicationRow507_1_1_5(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 1.6 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_1_6(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение2", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "3.6");

            iterator.moveFirst();


            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("currencyRest").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("currencyRest").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 1.6  │Иные обязательства в иностранной валюте              │############### │](getValue():r);
        [│      │(строка 3.6 приложения 2(1))                         │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_1_6(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "1.6";
    end;

    constructorTApplicationRow507_1_1_6(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.6", "2.10");

            iterator.moveFirst();

            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2    │Нормативная величина обязательных резервов, ВСЕГО    │############### │](getValue():r);
        [│      │(строка 2.6 + строка 2.10)                           │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2";
    end;

    constructorTApplicationRow507_1_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.1 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_1(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.1");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum       = sum + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum * global.parameters.getReservation().getNotresidentLegalPersonRouble(),
                               scaledSum * global.parameters.getReservation().getNotresidentLegalPersonRouble());
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.1  │По обязательствам перед юридическими лицами-         │############### │](getValue():r);
        [│      │нерезидентами в валюте Российской Федерации          │                │];
        [│      │(строка 1.1 * норматив обязательных резервов)        │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_1(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.1";
    end;

    constructorTApplicationRow507_1_2_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.2 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_2(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.2");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum = sum + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum * global.parameters.getReservation().getNaturalPersonRouble(),
                               scaledSum * global.parameters.getReservation().getNaturalPersonRouble());
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.2  │По обязательствам перед физическими лицами в валюте  │############### │](getValue():r);
        [│      │Российской Федерации                                 │                │];
        [│      │(строка 1.2 * норматив обязательных резервов)        │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_2(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.2";
    end;

    constructorTApplicationRow507_1_2_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.3 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_3(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.3");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum = sum + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum * global.parameters.getReservation().getOthersRouble(),
                               scaledSum * global.parameters.getReservation().getOthersRouble());
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.3  │По иным обязательствам в валюте Российской Федерации │############### │](getValue():r);
        [│      │(строка 1.3 * норматив обязательных резервов)        │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_3(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.3";
    end;

    constructorTApplicationRow507_1_2_3(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.4 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_4(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.1", "2.2", "2.3");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.4  │Итого по обязательствам в валюте Российской Федерации│############### │](getValue():r);
        [│      │(строка 2.1 + строка 2.2 + строка 2.3)               │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_4(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.4";
    end;

    constructorTApplicationRow507_1_2_4(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.5 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_5(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение5", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "5");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("roubleRest").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("roubleRest").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.5  │Величина исключаемых наличных денежных средств в     │############### │](getValue():r);
        [│      │валюте Российской Федерации в кассе,                 │                │];
        [│      │код обозначения - 202025                             │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_5(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.5";
    end;

    constructorTApplicationRow507_1_2_5(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.6 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_6(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum2_4         : Money  = $0.0;
        var scaledSum2_4   : Double = 0.0;
        var sum2_5         : Money  = $0.0;
        var scaledSum2_5   : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.4", "2.5");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                if (compositeValue.fieldValue("row").exact == "2.4")
                    sum2_4   = compositeValue.fieldValue("sum").exact;
                    scaledSum2_4 = compositeValue.fieldValue("sum").scaled;
                elif (compositeValue.fieldValue("row").exact == "2.5")
                    sum2_5       = compositeValue.fieldValue("sum").exact;
                    scaledSum2_5 = compositeValue.fieldValue("sum").scaled;
                end;
                iterator.moveNext();
            end;

            saveAttributeValue(sum2_4 - sum2_5, scaledSum2_4 - scaledSum2_5);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.6  │Всего по обязательствам в валюте Российской Федерации│############### │](getValue():r);
        [│      │(строка 2.4 - строка 2.5)                            │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_6(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.6";
    end;

    constructorTApplicationRow507_1_2_6(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.7 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_7(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.4");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum = sum + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum * global.parameters.getReservation().getNotresidentLegalPersonCurrency(),
                               scaledSum * global.parameters.getReservation().getNotresidentLegalPersonCurrency());
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.7  │по обязательствам перед юридическими лицами-         │############### │](getValue():r);
        [│      │нерезидентами в иностранной валюте                   │                │];
        [│      │(строка 1.4 * норматив обязательных резервов)        │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_7(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.7";
    end;

    constructorTApplicationRow507_1_2_7(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.8 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_8(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.5");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum = sum + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum * global.parameters.getReservation().getNaturalPersonCurrency(),
                               scaledSum * global.parameters.getReservation().getNaturalPersonCurrency());
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.8  │по обязательствам перед физическими лицами           │############### │](getValue():r);
        [│      │в иностранной валюте                                 │                │];
        [│      │(строка 1.5* норматив обязательных резервов)         │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_8(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.8";
    end;

    constructorTApplicationRow507_1_2_8(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.9 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_9(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "1.6");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum       = sum       + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum * global.parameters.getReservation().getOthersCurrency(),
                               scaledSum * global.parameters.getReservation().getOthersCurrency());
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.9  │по иным обязательствам в иностранной валюте          │############### │](getValue():r);
        [│      │(строка 1.6 * норматив обязательных резервов)        │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_9(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.9";
    end;

    constructorTApplicationRow507_1_2_9(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 2.10 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_2_10(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.7", "2.8", "2.9");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum = sum   + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 2.10 │Итого по обязательствам в иностранной валюте         │############### │](getValue():r);
        [│      │(строка 2.7 + строка 2.8 + строка 2.9)               │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_2_10(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "2.10";
    end;

    constructorTApplicationRow507_1_2_10(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_3(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = 0.0;

        var scaledControlSum : Double = 0.0;

        class TControlFilter()
            macro isSuitable(v : Object)
                return ((v.fieldValue("row").exact == "2.6") or (v.fieldValue("row").exact == "2.10"));
            end;
        end;

        macro getErrorPriority(value : RcbValue) : Double
            var v = mod(value.scaled * global.parameters.getReservation().getAveragingCoefficient(), 1) - 0.5;

            return 1 - ternary(v < 0, 1, v);
        end;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            if (global.parameters.isAveragingOut())
                iterator = getAttributeValueIterator("Приложение1", NULL);
                iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.6", "2.10");

                iterator.moveFirst();
                while (not iterator.isDone())
                    compositeValue = iterator.currentItem();

                    sum   = sum   + compositeValue.fieldValue("sum").exact;
                    scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                    iterator.moveNext();
                end;

                iterator = getAttributeValueIterator("Приложение1", TControlFilter);

                iterator.moveFirst();
                while (not iterator.isDone())
                    compositeValue = iterator.currentItem();

                    scaledControlSum = scaledControlSum + compositeValue.fieldValue("sum").scaled;
                    iterator.moveNext();
                end;

                if ((scaledControlSum == 0) or (scaledSum/scaledControlSum <= global.parameters.getReservation().getAveragingCoefficient()))
                    saveAttributeValue(sum, scaledSum);
                else
                    if (getErrorPriority(getRcbValue("2.6")) > getErrorPriority(getRcbValue("2.10")))
                        getRcbValue("3.1").scaled = floor(Double(getRcbValue("2.6").scaled * global.parameters.getReservation().getAveragingCoefficient()));
                    else
                        getRcbValue("3.2").scaled = floor(Double(getRcbValue("2.10").scaled * global.parameters.getReservation().getAveragingCoefficient()));
                    end;

                    saveAttributeValue(sum, floor(Double(scaledControlSum * global.parameters.getReservation().getAveragingCoefficient())));
                end;
            else
                saveAttributeValue(getRcbValue("3.1").exact + getRcbValue("3.2").exact);
            end;
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 3    │Усредненная величина обязательных резервов, ВСЕГО    │############### │](getValue():r);
        [│      │(строка 3.1 + строка 3.2),                           │                │];
        [│      │в том числе(2):                                      │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_3(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "3";
    end;

    constructorTApplicationRow507_1_3(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3.1 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_3_1(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            if (global.parameters.isAveragingOut())
                iterator = getAttributeValueIterator("Приложение1", NULL);
                iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.6");

                iterator.moveFirst();
                while (not iterator.isDone())
                    compositeValue = iterator.currentItem();
                    sum   = sum   + compositeValue.fieldValue("sum").exact;
                    scaledSum = scaledSum   + compositeValue.fieldValue("sum").scaled;
                    iterator.moveNext();
                end;
                sum = sum   * global.parameters.getReservation().getAveragingCoefficient();
                scaledSum = scaledSum * global.parameters.getReservation().getAveragingCoefficient();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 3.1  │По обязательствам в валюте Российской Федерации      │############### │](getValue():r);
        [│      │(строка 2.6 * коэффициент усреднения)(2)             │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_3_1(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "3.1";
    end;

    constructorTApplicationRow507_1_3_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3.2 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_3_2(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum      : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            if (global.parameters.isAveragingOut())
                iterator = getAttributeValueIterator("Приложение1", NULL);
                iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.10");

                iterator.moveFirst();
                while (not iterator.isDone())
                    compositeValue = iterator.currentItem();
                    sum = sum + compositeValue.fieldValue("sum").exact;
                    scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                    iterator.moveNext();
                end;
                sum = sum   * global.parameters.getReservation().getAveragingCoefficient();
                scaledSum = scaledSum   * global.parameters.getReservation().getAveragingCoefficient();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 3.2  │По обязательствам в иностранной валюте               │############### │](getValue():r);
        [│      │(строка 2.10 * коэффициент усреднения)(2)            │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_3_2(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "3.2";
    end;

    constructorTApplicationRow507_1_3_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 3.3 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_3_3(applicationName : String)
    macro saveAttributes()
        var value : Double = global.parameters.getReservation().getAveragingCoefficient() * 100;
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();
            saveAttributeValue(value, value);
        end;
    end;

    macro print()
        var value : Double = Double(getValue())/100;

        macro formatting(v)
            v = String(v);
            while ((subStr(v,strLen(v)) == "0") and (strLen(v) > 3))
                v = substr(v,1, strLen(v)-1);
            end;
            return v;
        end;

        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 3.3  │Коэффициент усреднения (2)                           │############### │](formatting(value):r);
    end;

    macro exportToPtkPsd()
        global.ptkPsdExportFile.printString("OR1", getExportCode(), "1", Double(getValue())/100);
    end;

    macro exportToKliko()
        var valueArray = TArray();
        valueArray[valueArray.size] = "S_" + getExportCode();
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = Double(nvl(getValue(), 0))/100;

        global.klikoExportFile.printString(valueArray);
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_3_3(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "3.3";
    end;

    constructorTApplicationRow507_1_3_3(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 4 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_4(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "4.1", "4.2");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;

            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
         [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
         [│ 4    │Расчетная величина обязательных резервов, ВСЕГО      │############### │](getValue():r);
         [│      │(строка 4.1 + строка 4.2),                           │                │];
         [│      │в том числе:                                         │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_4(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "4";
    end;

    constructorTApplicationRow507_1_4(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 4.1 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_4_1(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum2_6         : Money  = $0.0;
        var scaledSum2_6   : Double = 0.0;
        var sum3_1         : Money  = $0.0;
        var scaledSum3_1   : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.6", "3.1");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                if (compositeValue.fieldValue("row").exact == "2.6")
                    sum2_6   = compositeValue.fieldValue("sum").exact;
                    scaledSum2_6 = compositeValue.fieldValue("sum").scaled;
                elif (compositeValue.fieldValue("row").exact == "3.1")
                    sum3_1   = compositeValue.fieldValue("sum").exact;
                    scaledSum3_1 = compositeValue.fieldValue("sum").scaled;
                end;
                iterator.moveNext();
            end;

            saveAttributeValue(sum2_6 - sum3_1, scaledSum2_6 - scaledSum3_1);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 4.1  │По обязательствам в валюте Российской Федерации ─    │############### │](getValue():r);
        [│      │(строка 2.6 - строка 3.1)                            │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_4_1(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "4.1";
    end;

    constructorTApplicationRow507_1_4_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 4.2 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_4_2(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum2_10         : Money  = $0.0;
        var scaledSum2_10   : Double = 0.0;
        var sum3_2         : Money  = $0.0;
        var scaledSum3_2   : Double = 0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "2.10", "3.2");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                if (compositeValue.fieldValue("row").exact == "2.10")
                    sum2_10   = compositeValue.fieldValue("sum").exact;
                    scaledSum2_10 = compositeValue.fieldValue("sum").scaled;
                elif (compositeValue.fieldValue("row").exact == "3.2")
                    sum3_2   = compositeValue.fieldValue("sum").exact;
                    scaledSum3_2 = compositeValue.fieldValue("sum").scaled;
                end;
                iterator.moveNext();
            end;

            saveAttributeValue(sum2_10 - sum3_2, scaledSum2_10 - scaledSum3_2);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 4.2  │По обязательствам в иностранной валюте               │############### │](getValue():r);
        [│      │(строка 2.10 - строка 3.2)                           │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_4_2(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "4.2";
    end;

    constructorTApplicationRow507_1_4_2(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 5 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_5(applicationName : String)
    macro saveAttributes()
        var compositeValue : Object = NULL;
        var iterator       : Object = NULL;
        var sum            : Money  = $0.0;
        var scaledSum          : Double = $0.0;

        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            iterator = getAttributeValueIterator("Приложение1", NULL);
            iterator.setFilter(FILTER_FOR_APPLICATION_ROW, "5.1", "5.2", "5.3");

            iterator.moveFirst();
            while (not iterator.isDone())
                compositeValue = iterator.currentItem();
                sum   = sum   + compositeValue.fieldValue("sum").exact;
                scaledSum = scaledSum + compositeValue.fieldValue("sum").scaled;
                iterator.moveNext();
            end;
            saveAttributeValue(sum, scaledSum);
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 5    │Фактические остатки средств на счетах по учету       │############### │](getValue():r);
        [│      │обязательных резервов и счете по учету обязательных  │                │];
        [│      │резервов при невыполнении обязательств по усреднению,│                │];
        [│      │ВСЕГО (строка 5.1+строка 5.2 + строка 5.3),          │                │];
        [│      │в том числе (3):                                     │                │];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_5(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "5";
    end;

    constructorTApplicationRow507_1_5(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 5.1 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_5_1(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            saveAttributeValue(global.userDataInputer.getActualReserveRest().getRouble(), global.userDataInputer.getActualReserveRest().getScaledRouble());
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 5.1  │По обязательствам в валюте Российской Федерации (3)  │############### │](getValue():r);
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_5_1(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "5.1";
    end;

    constructorTApplicationRow507_1_5_1(applicationName);
end;

/***************************************************************************************************
 *  Класc строки 5.2 приложения1
 **************************************************************************************************/
class (TApplicationRow1) TApplicationRow507_1_5_2(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            saveAttributeValue(global.userDataInputer.getActualReserveRest().getCurrency(), global.userDataInputer.getActualReserveRest().getScaledCurrency());
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 5.2  │По обязательствам в иностранной валюте (3)           │############### │](getValue():r);
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_5_2(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "5.2";
    end;

    constructorTApplicationRow507_1_5_2(applicationName);
end;

class (TApplicationRow1) TApplicationRow507_1_5_3(applicationName : String)
    macro saveAttributes()
        if (not isSaved())
            m_isSaved = true;
            saveAttributes();

            saveAttributeValue(global.userDataInputer.getActualReserveRest().getLegalReserve(), global.userDataInputer.getActualReserveRest().getScaledLegalReserve());
        end;
    end;

    macro print()
        [├──────┼─────────────────────────────────────────────────────┼────────────────┤];
        [│ 5.3  │На счете по учету обязательных резервов при          │############### │](getValue():r);
        [│      │невыполнении обязанности по усреднению (3)           │                │];
        [└──────┴─────────────────────────────────────────────────────┴────────────────┘];
    end;

    macro constructor()
    end;

    private macro constructorTApplicationRow507_1_5_3(applicationName : String)
        initTApplicationRow1(applicationName);

        m_code = "5.3";
    end;

    constructorTApplicationRow507_1_5_3(applicationName);
end;

/**
 * Служебный класс расчета атрибута
 * Сумма последовательности
 * Итератор, фильтр заданы параметрически
 * Наследование запрещено
 */
private class TSequenceSum(sourceName : String, filterType : Integer, filterValue : String, fieldName : String, coefficient : Double)
    private var m_sourceName : String;
    private var m_filterType : Integer;
    private var m_filterValue : String;
    private var m_fieldName : String;
    private var m_coefficient : Double;

    macro calculate(report, exact, scaled)
        var iterator = report.attributeValue(m_sourceName).createValueIterator();

        var filterCommand = "iterator.setFilter(m_filterType";
        for (var it, strcut(m_filterValue, ","))
            filterCommand = filterCommand + "," + "\"" + trim(it) + "\"";
        end;
        filterCommand = filterCommand + ")";
        execExp(filterCommand);

        var compositeValue : Object = NULL;

        exact = $0.0;
        scaled = $0.0;
        iterator.moveFirst();
        while (not iterator.isDone())
            compositeValue = iterator.currentItem();
            exact = exact + compositeValue.fieldValue(m_fieldName).exact;
            scaled = scaled + compositeValue.fieldValue(m_fieldName).scaled;

            iterator.moveNext();
        end;

        exact = exact * m_coefficient;
        scaled = scaled * m_coefficient;

        setParm(2, exact);
        setParm(3, scaled);
    end;

    private macro ctor(sourceName : String, filterType : Integer, filterValue : String, fieldName : String, coefficient : Double)
        m_sourceName = sourceName;
        m_filterType = filterType;
        m_filterValue = filterValue;
        m_fieldName = fieldName;
        m_coefficient = nvl(coefficient, 1.0);
    end;

    ctor(sourceName, filterType, filterValue, fieldName, coefficient);
end;

/**
 * Служебный класс расчета атрибута
 * Сумма последовательности
 * Итератор, фильтр заданы параметрически
 * Наследование запрещено
 */
private class TSequenceSumFloor(sourceName : String, filterType : Integer, filterValue : String, fieldName : String, coefficient : Double)
    private var m_sourceName : String;
    private var m_filterType : Integer;
    private var m_filterValue : String;
    private var m_fieldName : String;
    private var m_coefficient : Double;

    macro calculate(report, exact, scaled)
        var iterator = report.attributeValue(m_sourceName).createValueIterator();

        var filterCommand = "iterator.setFilter(m_filterType";
        for (var it, strcut(m_filterValue, ","))
            filterCommand = filterCommand + "," + "\"" + trim(it) + "\"";
        end;
        filterCommand = filterCommand + ")";
        execExp(filterCommand);

        var compositeValue : Object = NULL;

        exact = $0.0;
        scaled = $0.0;
        iterator.moveFirst();
        while (not iterator.isDone())
            compositeValue = iterator.currentItem();
            exact = exact + compositeValue.fieldValue(m_fieldName).exact;
            scaled = scaled + compositeValue.fieldValue(m_fieldName).scaled;

            iterator.moveNext();
        end;

        exact = exact * m_coefficient;
        scaled = Money(floor(Double(scaled) * m_coefficient));

        setParm(2, exact);
        setParm(3, scaled);
    end;

    private macro ctor(sourceName : String, filterType : Integer, filterValue : String, fieldName : String, coefficient : Double)
        m_sourceName = sourceName;
        m_filterType = filterType;
        m_filterValue = filterValue;
        m_fieldName = fieldName;
        m_coefficient = nvl(coefficient, 1.0);
    end;

    ctor(sourceName, filterType, filterValue, fieldName, coefficient);
end;

/**
 * Сумма последовательности из Приложения 1
 */
private macro TSequenceSumAppl1(filterValue : String, coefficient : Double)
    return TSequenceSum("Приложение1", FILTER_FOR_APPLICATION_ROW, filterValue, "sum", coefficient);
end;

/**
 * Сумма последовательности из Приложения 1 для строк 3.1 и 3.2
 */
private macro TSequenceSumAppl1Floor(filterValue : String, coefficient : Double)
    return TSequenceSumFloor("Приложение1", FILTER_FOR_APPLICATION_ROW, filterValue, "sum", coefficient);
end;

/**
 * Сумма последовательности из Приложения 2, рубли
 */
private macro TSequenceSumAppl2National(filterValue : String, coefficient : Double)
    return TSequenceSum("Приложение2", FILTER_FOR_APPLICATION_ROW, filterValue, "roubleRest", coefficient);
end;

/**
 * Сумма последовательности из Приложения 2, ин. валюта
 */
private macro TSequenceSumAppl2Foreign(filterValue : String, coefficient : Double)
    return TSequenceSum("Приложение2", FILTER_FOR_APPLICATION_ROW, filterValue, "currencyRest", coefficient);
end;

/**
 * Служебный класс расчета атрибута
 * Разность сумм двух последовательностей
 * Итератор, фильтр заданы параметрически
 * Наследование запрещено
 */
private class TAttributesResidual(sourceName1 : String, filterType1 : Integer, filterValue1 : String, fieldName1 : String,
                                  sourceName2 : String, filterType2 : Integer, filterValue2 : String, fieldName2 : String)
    private var m_attributeCalculator1 : Object;
    private var m_attributeCalculator2 : Object;

    macro calculate(report, exact, scaled)
        var exact1 = $0.0;
        var scaled1 = $0.0;
        var exact2 = $0.0;
        var scaled2 = $0.0;

        m_attributeCalculator1.calculate(report, exact1, scaled1);
        m_attributeCalculator2.calculate(report, exact2, scaled2);

        exact = exact1 - exact2;
        scaled = scaled1 - scaled2;

        setParm(2, exact);
        setParm(3, scaled);
    end;

    private macro ctor(sourceName1 : String, filterType1 : Integer, filterValue1 : String, fieldName1 : String,
                       sourceName2 : String, filterType2 : Integer, filterValue2 : String, fieldName2 : String)
        m_attributeCalculator1 = TSequenceSum(sourceName1, filterType1, filterValue1, fieldName1);
        m_attributeCalculator2 = TSequenceSum(sourceName2, filterType2, filterValue2, fieldName2);
    end;

    ctor(sourceName1, filterType1, filterValue1, fieldName1, sourceName2, filterType2, filterValue2, fieldName2);
end;

/**
 * Служебный класс расчета атрибута
 * Константа
 * Наследование запрещено
 */
private class TConstant(exact : Variant, scaled : Variant, isLazy : Bool)
    private var m_exact : Variant;
    private var m_scaled : Variant;
    private var m_isLazy : Bool;

    macro calculate(report, exact, scaled)
        exact = $0.0;
        scaled = $0.0;
        if (m_isLazy)
            exact = execExp(m_exact);
            scaled = execExp(m_scaled);
        else
            exact = m_exact;
            scaled = m_scaled;
        end;

        setParm(2, exact);
        setParm(3, scaled);
    end;

    private macro ctor(exact : Variant, scaled : Variant, isLazy : Bool)
        m_exact = nvl(exact, $0.0);
        m_scaled = nvl(scaled, exact);
        m_isLazy = nvl(isLazy, false);
    end;

    ctor(exact, scaled, isLazy);
end;

/**
 * Служебный класс печати атрибута, который ничего не печатает
 * Наследование запрещено
 */
private class TFakeAttributePrinter(number : String, name : String, header : String, footer : String, xlsApplView)
    macro print(value : Variant)
    end;

    macro printExcel(value : Variant)

    end;

    private macro ctor(number : String, name : String, header : String, footer : String)
    end;

    ctor(number, name, header, footer);
end;

/**
 * Служебный класс печати атрибута
 * Наследование запрещено
 */
private class TAttributePrinter(number : String, name : String, header : String, footer : String, xlsView : Object)
    private var m_number;
    private var m_name;
    private var m_header;
    private var m_footer;
    private var m_xlsView;

    macro print(value : Variant)
        if (m_header != null)
            println(m_header);
        end;

        println("├──────┼─────────────────────────────────────────────────────┼────────────────┤");
        println("│", m_number, "│", m_name[0], "│", strAlign(value, 15, STR_ALIGN_RIGHT), " │");
        var i = 1;
        while (i < m_name.size)
            println("│      │", m_name[i], "│                │");
            i = i + 1;
        end;

        if (m_footer != null)
            println(m_footer);
        end;
    end;

    macro printExcel(value : Variant)
        if (m_xlsView != null)
            m_xlsView.printRow(RcbArray.initialize(m_number, m_name, value));
        end;
    end;

    private macro ctor(number : String, name : String, header : String, footer : String, xlsView : Object)
        m_number = strAlign(" " + number, 6, STR_ALIGN_LEFT);
        m_name = strTransferByWord(name, 53, STR_ALIGN_LEFT);
        m_header = header;
        m_footer = footer;
        m_xlsView = xlsView;
    end;

    ctor(number, name, header, footer, xlsView);
end;

/**
 * Служебный класс печати коэффициента усреднения
 * Наследование запрещено
 */
private class TAveragingCoefficientPrinter(number : String, name : String, header : String, xlsApplView)
    private var m_attributePrinter : Object;

    macro print(value : Variant)
        value = String(Double(value)/100.0);
        while ((subStr(value, strLen(value)) == "0") and (strLen(value) > 3))
            value = substr(value, 1, strLen(value)-1);
        end;

        m_attributePrinter.print(value);
    end;

    macro printExcel(value : Variant)
        value = String(Double(value)/100.0);
        while ((subStr(value, strLen(value)) == "0") and (strLen(value) > 3))
            value = substr(value, 1, strLen(value)-1);
        end;

        m_attributePrinter.printExcel(value);
    end;

    private macro ctor(number : String, name : String, header : String, xlsApplView)
        m_attributePrinter = TAttributePrinter(number, name, header, null, xlsApplView);
    end;

    ctor(number, name, header, xlsApplView);
end;

/**
 * Класс строки Приложения 1 по 4217-У
 */
class (TApplicationRow) TApplicationRow1_4217(applicationName : String, code : String, calculator : Object, printer : Object)
    private var m_calculator : Object;
    private var m_printer : Object;

    private macro getValue()
        global.rowCode = m_code;
        var iterator = getAttributeValueIterator(m_applicationName, NULL);
        iterator.setFilter(FILTER_FOR_APPLICATION_ROW, global.rowCode);
        var value    = NULL;

        iterator.moveFirst();
        if (not iterator.isDone())
            if (not iterator.currentItem.fieldValue("sum").isUndefined())
                value = iterator.currentItem.fieldValue("sum").currentAsString;
            else
                value = "-";
            end;
        end;
        return value;
    end;

    private macro saveAttributeValue(sum : Money, scaledSum : Double)
        var attributeValue = m_report.attributeValue(m_applicationName);
        var compositeValue = attributeValue.addValue();
        compositeValue.fieldValue("row").exact = m_code;
        if (sum == NULL)
            compositeValue.fieldValue("sum").setUndefined();
        else
            compositeValue.fieldValue("sum").exact = sum;
            if (scaledSum == NULL)
                compositeValue.fieldValue("sum").recalculateScaled();
            else
                compositeValue.fieldValue("sum").scaled = scaledSum;
            end;
        end;
    end;

    macro completeAttributes()
    end;

    /**
     *  Функционал экспорта в ПТК ПСД
     */
    macro getExportCode()
        return strSubst(getCode(), ".", "");
    end;

    macro exportToPtkPsd()
        var value = nvl(getValue(), "");
        global.ptkPsdExportFile.printString("OR1", getExportCode(), "1", getValue());
    end;

    /**
     *  Функционал экспорта в kliko.exe
     */
    macro exportToKliko()
        var valueArray = TArray();
        var value      = getValue();

        valueArray[valueArray.size] = "S_" + getExportCode();
        valueArray[valueArray.size] = ternary(value == "-", "0", nvl(value, "0"));
        valueArray[valueArray.size] = "";

        global.klikoExportFile.printString(valueArray);
    end;

    macro saveAttributes()
        if (not isSaved())
            var exact : Money = $0;
            var scaled : Money = $0;
            m_isSaved = true;

            saveAttributes();
            m_calculator.calculate(m_report, exact, scaled);
            saveAttributeValue(exact, scaled);
        end;
    end;

    macro print()
        m_printer.print(getValue());
    end;

    macro constructor()
    end;

    private macro ctorTApplicationRow1_4217(applicationName : String, code : String, calculator : Object, printer : Object)
        initTApplicationRow(applicationName);

        m_code = code;
        m_calculator = calculator;
        m_printer = printer;
    end;

    ctorTApplicationRow1_4217(applicationName, code, calculator, printer);
end;

/**
 * Класс строки 3.3 Приложения 1 по 4217-У
 * Нужен из-за специфического экспорта
 */
class (TApplicationRow1_4217) TApplicationRow1_4217_3_3(applicationName : String, code : String, calculator : Object, printer : Object)
    macro exportToPtkPsd()
        global.ptkPsdExportFile.printString("OR1", getExportCode(), "1", Double(getValue())/100);
    end;

    macro exportToKliko()
        var valueArray = TArray();
        valueArray[valueArray.size] = "S_" + getExportCode();
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = String(Double(nvl(getValue(), 0))/100 : 0 : 3);

        global.klikoExportFile.printString(valueArray);
    end;

    private macro ctorTApplicationRow1_4217_3_3(applicationName : String, code : String, calculator : Object, printer : Object)
        initTApplicationRow1_4217(applicationName, code, calculator, printer);
    end;

    ctorTApplicationRow1_4217(applicationName, code, calculator, printer);
end;

macro TApplicationRow1_1_4217(applicationName : String)
    const code = "1";
    const filterValue = "1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 1.10";
    const header = "┌──────┬─────────────────────────────────────────────────────┬────────────────┐"
          + "\n" + "│Номер │            Наименование показателя                  │     Сумма      │"
          + "\n" + "│строки│                                                     │                │"
          + "\n" + "├──────┼─────────────────────────────────────────────────────┼────────────────┤"
          + "\n" + "│ 1    │                          2                          │       3        │";
    const footer = null;
    const number = code;
    const name = "Размер резервируемых обязательств, ВСЕГО"
        + "\n" + "(строка 1.1 + строка 1.2 + строка 1.3 + строка 1.4 + строка 1.5 + "
               + "строка 1.6 + строка 1.7 + строка 1.8 + строка 1.9 + строка 1.10),"
        + "\n" + "в том числе:";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_1_4217(applicationName : String)
    const code = "1.1";
    const filterValue = "1.1.2";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте Российской Федерации (строка 1.1.2 приложения 2)(1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_2_4217(applicationName : String)
    const code = "1.2";
    const filterValue = "1.2.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте Российской Федерации (строка 1.2.5 приложения 2) (1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_3_4217(applicationName : String)
    const code = "1.3";
    const filterValue = "2.2";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед физическими лицами в валюте Российской Федерации (строка  2.2 приложения 2)(1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_4_4217(applicationName : String)
    const code = "1.4";
    const filterValue = "3.1.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Иные обязательства (за исключением долгосрочных) в валюте Российской Федерации (строка  3.1.5 приложения 2)(1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_5_4217(applicationName : String)
    const code = "1.5";
    const filterValue = "3.2.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные иные обязательства в валюте Российской Федерации (строка  3.2.5 приложения 2) (1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_6_4217(applicationName : String)
    const code = "1.6";
    const filterValue = "1.1.3";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в иностранной валюте (строка 1.1.3 приложения 2)(1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_7_4217(applicationName : String)
    const code = "1.7";
    const filterValue = "1.2.6";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные обязательства перед юридическими лицами-нерезидентами в иностранной валюте (строка 1.2.6 приложения 2)(1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_8_4217(applicationName : String)
    const code = "1.8";
    const filterValue = "2.3";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед физическими лицами в иностранной валюте (строка 2.3 приложения 2)(1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_9_4217(applicationName : String)
    const code = "1.9";
    const filterValue = "3.1.6";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Иные обязательства (за исключением долгосрочных) в иностранной валюте (строка 3.1.6 приложения 2)(1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_1_10_4217(applicationName : String)
    const code = "1.10";
    const filterValue = "3.2.6";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные иные обязательства в иностранной валюте (строка 3.2.6 приложения 2) (1)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_4217(applicationName : String)
    const code = "2";
    const filterValue = "2.8, 2.14";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Нормативная величина обязательных резервов, ВСЕГО (строка 2.8 + строка 2.14)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_1_4217(applicationName : String)
    const code = "2.1";
    const filterValue = "1.1";
    const reserve = global.parameters.getReservation().getNotresidentLegalPersonExceptLongRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте Российской Федерации (строка 1.1 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_2_4217(applicationName : String)
    const code = "2.2";
    const filterValue = "1.2";
    const reserve = global.parameters.getReservation().getNotresidentLegalPersonLongTermRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По долгосрочным обязательствам перед юридическими лицами-нерезидентами в валюте Российской Федерации (строка 1.2 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_3_4217(applicationName : String)
    const code = "2.3";
    const filterValue = "1.3";
    const reserve = global.parameters.getReservation().getNaturalPersonRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам перед физическими лицами в валюте Российской Федерации (строка 1.3 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_4_4217(applicationName : String)
    const code = "2.4";
    const filterValue = "1.4";
    const reserve = global.parameters.getReservation().getOthersExceptLongRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По иным обязательствам (за исключением долгосрочных) в валюте Российской Федерации (строка 1.4 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_5_4217(applicationName : String)
    const code = "2.5";
    const filterValue = "1.5";
    const reserve = global.parameters.getReservation().getOthersLongTermRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По долгосрочным иным обязательствам в валюте Российской Федерации (строка 1.5 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_6_4217(applicationName : String)
    const code = "2.6";
    const filterValue = "2.1, 2.2, 2.3, 2.4, 2.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Итого по обязательствам в валюте Российской Федерации (строка 2.1 + строка 2.2 + строка 2.3 + строка 2.4 + строка 2.5)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_7_4217(applicationName : String)
    const code = "2.7";

    const sourceName = "Приложение5";
    const filterType = FILTER_FOR_APPLICATION_ROW;
    const filterValue = "5";
    const fieldName = "roubleRest";

    const header = null;
    const footer = null;
    const number = code;
    const name = "Величина исключаемых наличных денежных средств в валюте Российской Федерации в кассе кредитной организации, код обозначения 202025";

    return TApplicationRow1_4217(applicationName, code, TSequenceSum(sourceName, filterType, filterValue, fieldName), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_8_4217(applicationName : String)
    const code = "2.8";

    const sourceName = "Приложение1";
    const filterType = FILTER_FOR_APPLICATION_ROW;
    const filterValue1 = "2.6";
    const filterValue2 = "2.7";
    const fieldName = "sum";

    const header = null;
    const footer = null;
    const number = code;
    const name = "Всего по обязательствам в валюте Российской Федерации (строка 2.6 - строка 2.7)";

    return TApplicationRow1_4217(applicationName,
                                 code,
                                 TAttributesResidual(sourceName, filterType, filterValue1, fieldName, sourceName, filterType, filterValue2, fieldName),
                                 TAttributePrinter(number, name, header, footer)
                                );
end;

macro TApplicationRow1_2_9_4217(applicationName : String)
    const code = "2.9";
    const filterValue = "1.6";
    const reserve = global.parameters.getReservation().getNotresidentLegalPersonExceptLongCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам перед юридическими лицами-нерезидентами (за исключением долгосрочных) в иностранной валюте (строка 1.6 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_10_4217(applicationName : String)
    const code = "2.10";
    const filterValue = "1.7";
    const reserve = global.parameters.getReservation().getNotresidentLegalPersonLongTermCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По долгосрочным обязательствам перед юридическими лицами-нерезидентами в иностранной валюте (строка 1.7 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_11_4217(applicationName : String)
    const code = "2.11";
    const filterValue = "1.8";
    const reserve = global.parameters.getReservation().getNaturalPersonCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам перед физическими лицами в иностранной валюте (строка 1.8 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_12_4217(applicationName : String)
    const code = "2.12";
    const filterValue = "1.9";
    const reserve = global.parameters.getReservation().getOthersExceptLongCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По иным обязательствам (за исключением долгосрочных) в иностранной валюте(строка 1.9 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_13_4217(applicationName : String)
    const code = "2.13";
    const filterValue = "1.10";
    const reserve = global.parameters.getReservation().getOthersLongTermCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По долгосрочным иным обязательствам в иностранной валюте (строка 1.10 * норматив обязательных резервов)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_2_14_4217(applicationName : String)
    const code = "2.14";
    const filterValue = "2.9, 2.10, 2.11, 2.12, 2.13";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Итого по обязательствам в иностранной валюте (строка 2.9 + строка 2.10 + строка 2.11 + строка 2.12 + строка 2.13)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_3_4217(applicationName : String)
    const code = "3";
    const filterValue = "3.1, 3.2";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Усредненная величина обязательных резервов, всего (строка 3.1 + строка 3.2), в том числе (2)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_3_1_4217(applicationName : String)
    const code = "3.1";
    const filterValue = "2.8";
    const averagingCoefficient = ternary(global.parameters.isAveragingOut(), global.parameters.getReservation().getAveragingCoefficient(), 0.0);
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в валюте Российской Федерации (строка 2.8 * коэффициент усреднения) (2)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1Floor(filterValue, averagingCoefficient), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_3_2_4217(applicationName : String)
    const code = "3.2";
    const filterValue = "2.14";
    const averagingCoefficient = ternary(global.parameters.isAveragingOut(), global.parameters.getReservation().getAveragingCoefficient(), 0.0);
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в иностранной валюте (строка 2.14 * коэффициент усреднения) (2)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue, averagingCoefficient), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_3_3_4217(applicationName : String)
    const code = "3.3";
    const averagingCoefficient = global.parameters.getReservation().getAveragingCoefficient() * 100.0;
    const header = null;
    const footer = null;
    const number = code;
    const name = "Коэффициент усреднения (2)";

    return TApplicationRow1_4217_3_3(applicationName, code, TConstant(averagingCoefficient), TAveragingCoefficientPrinter(number, name));
end;

macro TApplicationRow1_4_4217(applicationName : String)
    const code = "4";
    const filterValue = "4.1, 4.2";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Расчетная величина обязательных резервов, всего (строка 4.1 + строка 4.2), в том числе:";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_4_1_4217(applicationName : String)
    const code = "4.1";

    const sourceName = "Приложение1";
    const filterType = FILTER_FOR_APPLICATION_ROW;
    const filterValue1 = "2.8";
    const filterValue2 = "3.1";
    const fieldName = "sum";

    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в валюте Российской Федерации (строка 2.8 - строка 3.1)";

    return TApplicationRow1_4217(applicationName,
                                 code,
                                 TAttributesResidual(sourceName, filterType, filterValue1, fieldName, sourceName, filterType, filterValue2, fieldName),
                                 TAttributePrinter(number, name, header, footer)
                                );
end;

macro TApplicationRow1_4_2_4217(applicationName : String)
    const code = "4.2";

    const sourceName = "Приложение1";
    const filterType = FILTER_FOR_APPLICATION_ROW;
    const filterValue1 = "2.14";
    const filterValue2 = "3.2";
    const fieldName = "sum";

    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в иностранной валюте (строка 2.14 - строка 3.2)";

    return TApplicationRow1_4217(applicationName,
                                 code,
                                 TAttributesResidual(sourceName, filterType, filterValue1, fieldName, sourceName, filterType, filterValue2, fieldName),
                                 TAttributePrinter(number, name, header, footer)
                                );
end;

macro TApplicationRow1_5_4217(applicationName : String)
    const code = "5";
    const filterValue = "5.1, 5.2, 5.3";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Фактические остатки средств на счетах по учету обязательных резервов и счете по учету обязательных резервов "
               + "при невыполнении обязанности по усреднению, всего (строка 5.1 + строка 5.2 + строка 5.3),"
        + "\n" + "в том числе (3)";

    return TApplicationRow1_4217(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_5_1_4217(applicationName : String)
    const code = "5.1";
    const exact = "global.userDataInputer.getActualReserveRest().getRouble()";
    const scaled = "global.userDataInputer.getActualReserveRest().getScaledRouble()";
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в валюте Российской Федерации (3)";

    return TApplicationRow1_4217(applicationName, code, TConstant(exact, scaled, true), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_5_2_4217(applicationName : String)
    const code = "5.2";
    const exact = "global.userDataInputer.getActualReserveRest().getCurrency()";
    const scaled = "global.userDataInputer.getActualReserveRest().getScaledCurrency()";
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в иностранной валюте (3)";

    return TApplicationRow1_4217(applicationName, code, TConstant(exact, scaled, true), TAttributePrinter(number, name, header, footer));
end;

macro TApplicationRow1_5_3_4217(applicationName : String)
    const code = "5.3";
    const exact = "global.userDataInputer.getActualReserveRest().getLegalReserve()";
    const scaled = "global.userDataInputer.getActualReserveRest().getScaledLegalReserve()";
    const header = null;
    const footer = "└──────┴─────────────────────────────────────────────────────┴────────────────┘";
    const number = code;
    const name = "На счете по учету обязательных резервов при невыполнении обязанности по усреднению (3)";

    return TApplicationRow1_4217(applicationName, code, TConstant(exact, scaled, true), TAttributePrinter(number, name, header, footer));
end;

/**
 * Класс строки Приложения 1 по 5036-У
 */
class (TApplicationRow) TApplicationRow1_5036(applicationName : String, code : String, calculator : Object, printer : Object)
    private var m_calculator : Object;
    private var m_printer : Object;

    private macro getValue()
        global.rowCode = m_code;
        var iterator = getAttributeValueIterator(m_applicationName, NULL);
        iterator.setFilter(FILTER_FOR_APPLICATION_ROW, global.rowCode);
        var value    = NULL;

        iterator.moveFirst();
        if (not iterator.isDone())
            if (not iterator.currentItem.fieldValue("sum").isUndefined())
                value = iterator.currentItem.fieldValue("sum").currentAsString;
            else
                value = "-";
            end;
        end;
        return value;
    end;

    private macro saveAttributeValue(sum : Money, scaledSum : Double)
        var attributeValue = m_report.attributeValue(m_applicationName);
        var compositeValue = attributeValue.addValue();
        compositeValue.fieldValue("row").exact = m_code;
        if (sum == NULL)
            compositeValue.fieldValue("sum").setUndefined();
        else
            compositeValue.fieldValue("sum").exact = sum;
            if (scaledSum == NULL)
                compositeValue.fieldValue("sum").recalculateScaled();
            else
                compositeValue.fieldValue("sum").scaled = scaledSum;
            end;
        end;
    end;

    macro completeAttributes()
    end;

    /**
     *  Функционал экспорта в ПТК ПСД
     */
    macro getExportCode()
        return strSubst(getCode(), ".", "");
    end;

    macro exportToPtkPsd()
        var value = nvl(getValue(), "");
        global.ptkPsdExportFile.printString("OR1", getExportCode(), "1", getValue());
    end;

    /**
     *  Функционал экспорта в kliko.exe
     */
    macro exportToKliko()
        var valueArray = TArray();
        var value      = getValue();

        valueArray[valueArray.size] = "S_" + getExportCode();
        valueArray[valueArray.size] = ternary(value == "-", "0", nvl(value, "0"));
        valueArray[valueArray.size] = "";

        global.klikoExportFile.printString(valueArray);
    end;

    macro saveAttributes()
        if (not isSaved())
            var exact : Money = $0;
            var scaled : Money = $0;
            m_isSaved = true;

            saveAttributes();
            m_calculator.calculate(m_report, exact, scaled);
            saveAttributeValue(exact, scaled);
        end;
    end;

    macro printExcel()
        m_printer.printExcel(getValue());
    end;

    macro print()
        m_printer.print(getValue());
    end;

    macro constructor()
    end;

    private macro ctorTApplicationRow1_5036(applicationName : String, code : String, calculator : Object, printer : Object)
        initTApplicationRow(applicationName);

        m_code = code;
        m_calculator = calculator;
        m_printer = printer;
    end;

    ctorTApplicationRow1_5036(applicationName, code, calculator, printer);
end;

/**
 * Класс строки 3.3 Приложения 1 по 5036-У
 * Нужен из-за специфического экспорта
 */
class (TApplicationRow1_5036) TApplicationRow1_5036_3_3(applicationName : String, code : String, calculator : Object, printer : Object)
    macro exportToPtkPsd()
        global.ptkPsdExportFile.printString("OR1", getExportCode(), "1", Double(getValue())/100);
    end;

    macro exportToKliko()
        var valueArray = TArray();
        valueArray[valueArray.size] = "S_" + getExportCode();
        valueArray[valueArray.size] = "";
        valueArray[valueArray.size] = String(Double(nvl(getValue(), 0))/100 : 0 : 3);

        global.klikoExportFile.printString(valueArray);
    end;

    macro printExcel()
        m_printer.printExcel(getValue());
    end;

    private macro ctorTApplicationRow1_5036_3_3(applicationName : String, code : String, calculator : Object, printer : Object)
        initTApplicationRow1_5036(applicationName, code, calculator, printer);
    end;

    ctorTApplicationRow1_5036_3_3(applicationName, code, calculator, printer);
end;

/**
 * Класс строк 5.1, 5.2, 5.3 Приложения 1 по 5036-У
 * Нужен из-за специфического экспорта
 */
class (TApplicationRow1_5036) TApplicationRow1_5036_5_x(applicationName : String, code : String, calculator : Object, printer : Object)
    macro exportToPtkPsd()
    end;

    macro exportToKliko()
    end;

    private macro ctorTApplicationRow1_5036_5_x(applicationName : String, code : String, calculator : Object, printer : Object)
        initTApplicationRow1_5036(applicationName, code, calculator, printer);
    end;

    ctorTApplicationRow1_5036_5_x(applicationName, code, calculator, printer);
end;

macro TApplicationRow1_1_5036(applicationName : String, xlsApplView : Object)
    const code = "1";
    const filterValue = "1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 1.10";
    const header = "┌──────┬─────────────────────────────────────────────────────┬────────────────┐"
          + "\n" + "│Номер │            Наименование показателя                  │     Сумма      │"
          + "\n" + "│строки│                                                     │                │"
          + "\n" + "├──────┼─────────────────────────────────────────────────────┼────────────────┤"
          + "\n" + "│ 1    │                          2                          │       3        │";
    const footer = null;
    const number = code;
    const name = "Размер резервируемых обязательств, ВСЕГО"
        + "\n" + "(строка 1.1 + строка 1.2 + строка 1.3 + строка 1.4 + строка 1.5 + "
               + "строка 1.6 + строка 1.7 + строка 1.8 + строка 1.9 + строка 1.10),"
        + "\n" + "в том числе:";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_1_5036(applicationName : String, xlsApplView : Object)
    const code = "1.1";
    const filterValue = "1.1.2";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте Российской Федерации (строка 1.1.2 приложения 2)(1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_2_5036(applicationName : String, xlsApplView : Object)
    const code = "1.2";
    const filterValue = "1.2.4";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте Российской Федерации (строка 1.2.4 приложения 2) (1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_3_5036(applicationName : String, xlsApplView : Object)
    const code = "1.3";
    const filterValue = "2.2";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед физическими лицами в валюте Российской Федерации (строка  2.2 приложения 2)(1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_4_5036(applicationName : String, xlsApplView : Object)
    const code = "1.4";
    const filterValue = "3.1.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Иные обязательства (за исключением долгосрочных) в валюте Российской Федерации (строка  3.1.5 приложения 2)(1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_5_5036(applicationName : String, xlsApplView : Object)
    const code = "1.5";
    const filterValue = "3.2.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные иные обязательства в валюте Российской Федерации (строка  3.2.5 приложения 2) (1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_6_5036(applicationName : String, xlsApplView : Object)
    const code = "1.6";
    const filterValue = "1.1.3";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в иностранной валюте (строка 1.1.3 приложения 2)(1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_7_5036(applicationName : String, xlsApplView : Object)
    const code = "1.7";
    const filterValue = "1.2.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные обязательства перед юридическими лицами-нерезидентами в иностранной валюте (строка 1.2.5 приложения 2)(1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_8_5036(applicationName : String, xlsApplView : Object)
    const code = "1.8";
    const filterValue = "2.3";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед физическими лицами в иностранной валюте (строка 2.3 приложения 2)(1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_9_5036(applicationName : String, xlsApplView : Object)
    const code = "1.9";
    const filterValue = "3.1.6";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Иные обязательства (за исключением долгосрочных) в иностранной валюте (строка 3.1.6 приложения 2)(1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_10_5036(applicationName : String, xlsApplView : Object)
    const code = "1.10";
    const filterValue = "3.2.6";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные иные обязательства в иностранной валюте (строка 3.2.6 приложения 2) (1)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_5036(applicationName : String, xlsApplView : Object)
    const code = "2";
    const filterValue = "2.8, 2.14";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Нормативная величина обязательных резервов, ВСЕГО (строка 2.8 + строка 2.14)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_1_5036(applicationName : String, xlsApplView : Object)
    const code = "2.1";
    const filterValue = "1.1";
    const reserve = global.parameters.getReservation().getNotresidentLegalPersonExceptLongRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте Российской Федерации (строка 1.1 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_2_5036(applicationName : String, xlsApplView : Object)
    const code = "2.2";
    const filterValue = "1.2";
    const reserve = global.parameters.getReservation().getNotresidentLegalPersonLongTermRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По долгосрочным обязательствам перед юридическими лицами-нерезидентами в валюте Российской Федерации (строка 1.2 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_3_5036(applicationName : String, xlsApplView : Object)
    const code = "2.3";
    const filterValue = "1.3";
    const reserve = global.parameters.getReservation().getNaturalPersonRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам перед физическими лицами в валюте Российской Федерации (строка 1.3 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_4_5036(applicationName : String, xlsApplView : Object)
    const code = "2.4";
    const filterValue = "1.4";
    const reserve = global.parameters.getReservation().getOthersExceptLongRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По иным обязательствам (за исключением долгосрочных) в валюте Российской Федерации (строка 1.4 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_5_5036(applicationName : String, xlsApplView : Object)
    const code = "2.5";
    const filterValue = "1.5";
    const reserve = global.parameters.getReservation().getOthersLongTermRouble();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По долгосрочным иным обязательствам в валюте Российской Федерации (строка 1.5 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_6_5036(applicationName : String, xlsApplView : Object)
    const code = "2.6";
    const filterValue = "2.1, 2.2, 2.3, 2.4, 2.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Итого по обязательствам в валюте Российской Федерации (строка 2.1 + строка 2.2 + строка 2.3 + строка 2.4 + строка 2.5)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_7_5036(applicationName : String, xlsApplView : Object)
    const code = "2.7";

    const sourceName = "Приложение5";
    const filterType = FILTER_FOR_APPLICATION_ROW;
    const filterValue = "5";
    const fieldName = "roubleRest";

    const header = null;
    const footer = null;
    const number = code;
    const name = "Величина исключаемых наличных денежных средств в валюте Российской Федерации в кассе кредитной организации, код обозначения 202025";

    return TApplicationRow1_5036(applicationName, code, TSequenceSum(sourceName, filterType, filterValue, fieldName), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_8_5036(applicationName : String, xlsApplView : Object)
    const code = "2.8";

    const sourceName = "Приложение1";
    const filterType = FILTER_FOR_APPLICATION_ROW;
    const filterValue1 = "2.6";
    const filterValue2 = "2.7";
    const fieldName = "sum";

    const header = null;
    const footer = null;
    const number = code;
    const name = "Всего по обязательствам в валюте Российской Федерации (строка 2.6 - строка 2.7)";

    return TApplicationRow1_5036(applicationName,
                                 code,
                                 TAttributesResidual(sourceName, filterType, filterValue1, fieldName, sourceName, filterType, filterValue2, fieldName),
                                 TAttributePrinter(number, name, header, footer, xlsApplView)
                                );
end;

macro TApplicationRow1_2_9_5036(applicationName : String, xlsApplView : Object)
    const code = "2.9";
    const filterValue = "1.6";
    const reserve = global.parameters.getReservation().getNotresidentLegalPersonExceptLongCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам перед юридическими лицами-нерезидентами (за исключением долгосрочных) в иностранной валюте (строка 1.6 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_10_5036(applicationName : String, xlsApplView : Object)
    const code = "2.10";
    const filterValue = "1.7";
    const reserve = global.parameters.getReservation().getNotresidentLegalPersonLongTermCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По долгосрочным обязательствам перед юридическими лицами-нерезидентами в иностранной валюте (строка 1.7 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_11_5036(applicationName : String, xlsApplView : Object)
    const code = "2.11";
    const filterValue = "1.8";
    const reserve = global.parameters.getReservation().getNaturalPersonCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам перед физическими лицами в иностранной валюте (строка 1.8 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_12_5036(applicationName : String, xlsApplView : Object)
    const code = "2.12";
    const filterValue = "1.9";
    const reserve = global.parameters.getReservation().getOthersExceptLongCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По иным обязательствам (за исключением долгосрочных) в иностранной валюте(строка 1.9 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_13_5036(applicationName : String, xlsApplView : Object)
    const code = "2.13";
    const filterValue = "1.10";
    const reserve = global.parameters.getReservation().getOthersLongTermCurrency();
    const header = null;
    const footer = null;
    const number = code;
    const name = "По долгосрочным иным обязательствам в иностранной валюте (строка 1.10 * норматив обязательных резервов)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue, reserve), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_2_14_5036(applicationName : String, xlsApplView : Object)
    const code = "2.14";
    const filterValue = "2.9, 2.10, 2.11, 2.12, 2.13";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Итого по обязательствам в иностранной валюте (строка 2.9 + строка 2.10 + строка 2.11 + строка 2.12 + строка 2.13)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_3_5036(applicationName : String, xlsApplView : Object)
    const code = "3";
    const filterValue = "3.1, 3.2";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Усредненная величина обязательных резервов, всего (строка 3.1 + строка 3.2), в том числе (2)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_3_1_5036(applicationName : String, xlsApplView : Object)
    const code = "3.1";
    const filterValue = "2.8";
    const averagingCoefficient = ternary(global.parameters.isAveragingOut(), global.parameters.getReservation().getAveragingCoefficient(), 0.0);
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в валюте Российской Федерации (строка 2.8 * коэффициент усреднения) (2)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1Floor(filterValue, averagingCoefficient), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_3_2_5036(applicationName : String, xlsApplView : Object)
    const code = "3.2";
    const filterValue = "2.14";
    const averagingCoefficient = ternary(global.parameters.isAveragingOut(), global.parameters.getReservation().getAveragingCoefficient(), 0.0);
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в иностранной валюте (строка 2.14 * коэффициент усреднения) (2)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1Floor(filterValue, averagingCoefficient), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_3_3_5036(applicationName : String, xlsApplView : Object)
    const code = "3.3";
    const averagingCoefficient = global.parameters.getReservation().getAveragingCoefficient() * 100.0;
    const header = null;
    const footer = null;
    const number = code;
    const name = "Коэффициент усреднения (2)";

    return TApplicationRow1_5036_3_3(applicationName, code, TConstant(averagingCoefficient), TAveragingCoefficientPrinter(number, name, header, xlsApplView));
end;

macro TApplicationRow1_4_5036(applicationName : String, xlsApplView : Object)
    const code = "4";
    const filterValue = "4.1, 4.2";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Расчетная величина обязательных резервов, всего (строка 4.1 + строка 4.2), в том числе:";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_4_1_5036(applicationName : String, xlsApplView : Object)
    const code = "4.1";

    const sourceName = "Приложение1";
    const filterType = FILTER_FOR_APPLICATION_ROW;
    const filterValue1 = "2.8";
    const filterValue2 = "3.1";
    const fieldName = "sum";

    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в валюте Российской Федерации (строка 2.8 - строка 3.1)";

    return TApplicationRow1_5036(applicationName,
                                 code,
                                 TAttributesResidual(sourceName, filterType, filterValue1, fieldName, sourceName, filterType, filterValue2, fieldName),
                                 TAttributePrinter(number, name, header, footer, xlsApplView)
                                );
end;

macro TApplicationRow1_4_2_5036(applicationName : String, xlsApplView : Object)
    const code = "4.2";

    const sourceName = "Приложение1";
    const filterType = FILTER_FOR_APPLICATION_ROW;
    const filterValue1 = "2.14";
    const filterValue2 = "3.2";
    const fieldName = "sum";

    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в иностранной валюте (строка 2.14 - строка 3.2)";

    return TApplicationRow1_5036(applicationName,
                                 code,
                                 TAttributesResidual(sourceName, filterType, filterValue1, fieldName, sourceName, filterType, filterValue2, fieldName),
                                 TAttributePrinter(number, name, header, footer, xlsApplView)
                                );
end;

macro TApplicationRow1_5_5036(applicationName : String, xlsApplView : Object)
    const code = "5";
    const filterValue = "5.1, 5.2, 5.3";
    const header = null;
    const footer = "└──────┴─────────────────────────────────────────────────────┴────────────────┘";
    const number = code;
    const name = "Фактические остатки средств на счете по учету обязательных резервов (3)";

    return TApplicationRow1_5036(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_5_1_5036(applicationName : String, xlsApplView : Object)
    const code = "5.1";
    const exact = "global.userDataInputer.getActualReserveRest().getRouble()";
    const scaled = "global.userDataInputer.getActualReserveRest().getScaledRouble()";
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в валюте Российской Федерации (3)";

    return TApplicationRow1_5036_5_x(applicationName, code, TConstant(exact, scaled, true), TFakeAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_5_2_5036(applicationName : String, xlsApplView : Object)
    const code = "5.2";
    const exact = "global.userDataInputer.getActualReserveRest().getCurrency()";
    const scaled = "global.userDataInputer.getActualReserveRest().getScaledCurrency()";
    const header = null;
    const footer = null;
    const number = code;
    const name = "По обязательствам в иностранной валюте (3)";

    return TApplicationRow1_5036_5_x(applicationName, code, TConstant(exact, scaled, true), TFakeAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_5_3_5036(applicationName : String, xlsApplView : Object)
    const code = "5.3";
    const exact = "global.userDataInputer.getActualReserveRest().getLegalReserve()";
    const scaled = "global.userDataInputer.getActualReserveRest().getScaledLegalReserve()";
    const header = null;
    const footer = "└──────┴─────────────────────────────────────────────────────┴────────────────┘";
    const number = code;
    const name = "На счете по учету обязательных резервов при невыполнении обязанности по усреднению (3)";

    return TApplicationRow1_5036_5_x(applicationName, code, TConstant(exact, scaled, true), TFakeAttributePrinter(number, name, header, footer, xlsApplView));
end;

/**
 * Класс строки Приложения 1 по 5087-У
 */
class (TApplicationRow) TApplicationRow1_5087(applicationName : String, code : String, calculator : Object, printer : Object)
    private var m_calculator : Object;
    private var m_printer : Object;

    private macro getValue()
        global.rowCode = m_code;
        var iterator = getAttributeValueIterator(m_applicationName, NULL);
        iterator.setFilter(FILTER_FOR_APPLICATION_ROW, global.rowCode);
        var value    = NULL;

        iterator.moveFirst();
        if (not iterator.isDone())
            if (not iterator.currentItem.fieldValue("sum").isUndefined())
                value = iterator.currentItem.fieldValue("sum").currentAsString;
            else
                value = "-";
            end;
        end;
        return value;
    end;

    private macro saveAttributeValue(sum : Money, scaledSum : Double)
        var attributeValue = m_report.attributeValue(m_applicationName);
        var compositeValue = attributeValue.addValue();
        compositeValue.fieldValue("row").exact = m_code;
        if (sum == NULL)
            compositeValue.fieldValue("sum").setUndefined();
        else
            compositeValue.fieldValue("sum").exact = sum;
            if (scaledSum == NULL)
                compositeValue.fieldValue("sum").recalculateScaled();
            else
                compositeValue.fieldValue("sum").scaled = scaledSum;
            end;
        end;
    end;

    macro completeAttributes()
    end;

    /**
     *  Функционал экспорта в ПТК ПСД
     */
    macro getExportCode()
        return strSubst(getCode(), ".", "");
    end;

    macro exportToPtkPsd()
        var value = nvl(getValue(), "");
        global.ptkPsdExportFile.printString("OR1", getExportCode(), "1", getValue());
    end;

    /**
     *  Функционал экспорта в kliko.exe
     */
    macro exportToKliko()
        var valueArray = TArray();
        var value      = getValue();

        valueArray[valueArray.size] = "S_" + getExportCode();
        valueArray[valueArray.size] = ternary(value == "-", "0", nvl(value, "0"));
        valueArray[valueArray.size] = "";

        global.klikoExportFile.printString(valueArray);
    end;

    macro saveAttributes()
        if (not isSaved())
            var exact : Money = $0;
            var scaled : Money = $0;
            m_isSaved = true;

            saveAttributes();
            m_calculator.calculate(m_report, exact, scaled);
            saveAttributeValue(exact, scaled);
        end;
    end;

    macro print()
        m_printer.print(getValue());
    end;

    macro printExcel()
        m_printer.printExcel(getValue());
    end;

    macro constructor()
    end;

    private macro ctorTApplicationRow1_5087(applicationName : String, code : String, calculator : Object, printer : Object)
        initTApplicationRow(applicationName);

        m_code = code;
        m_calculator = calculator;
        m_printer = printer;
    end;

    ctorTApplicationRow1_5087(applicationName, code, calculator, printer);
end;

/**
 * Класс строк 5.1 Приложения 1 по 5087-У
 * Нужен из-за специфического экспорта
 */
class (TApplicationRow1_5087) TApplicationRow1_5087_5_x(applicationName : String, code : String, calculator : Object, printer : Object)
    macro exportToPtkPsd()
    end;

    macro exportToKliko()
    end;

    private macro ctorTApplicationRow1_5087_5_x(applicationName : String, code : String, calculator : Object, printer : Object)
        initTApplicationRow1_5087(applicationName, code, calculator, printer);
    end;

    ctorTApplicationRow1_5087_5_x(applicationName, code, calculator, printer);
end;

macro TApplicationRow1_5_5087(applicationName : String, xlsApplView : Object)
    const code        = "5";
    const filterValue = "5.1";
    const header      = null;
    const footer      = "└──────┴─────────────────────────────────────────────────────┴────────────────┘";
    const number      = code;
    const name        = "Фактические остатки средств на счете по учету обязательных резервов (3)";

    return TApplicationRow1_5087(applicationName, code, TSequenceSumAppl1(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_5_1_5087(applicationName : String, xlsApplView : Object)
    const code   = "5.1";
    const exact  = "global.userDataInputer.getActualReserveRest().getRouble()";
    const scaled = "global.userDataInputer.getActualReserveRest().getScaledRouble()";
    const header = null;
    const footer = null;
    const number = code;
    const name   = "По обязательствам в валюте Российской Федерации (3)";

    return TApplicationRow1_5087_5_x(applicationName, code, TConstant(exact, scaled, true), TFakeAttributePrinter(number, name, header, footer, xlsApplView));
end;

/**
 * Класс строки Приложения 1 по 5242-У
 */
class (TApplicationRow) TApplicationRow1_5242(applicationName : String, code : String, calculator : Object, printer : Object)
    private var m_calculator : Object;
    private var m_printer : Object;
    private macro getValue()
        global.rowCode = m_code;
        var iterator = getAttributeValueIterator(m_applicationName, NULL);
        iterator.setFilter(FILTER_FOR_APPLICATION_ROW, global.rowCode);
        var value    = NULL;

        iterator.moveFirst();
        if (not iterator.isDone())
            if (not iterator.currentItem.fieldValue("sum").isUndefined())
                value = iterator.currentItem.fieldValue("sum").currentAsString;
            else
                value = "-";
            end;
        end;
        return value;
    end;

    private macro saveAttributeValue(sum : Money, scaledSum : Double)
        var attributeValue = m_report.attributeValue(m_applicationName);
        var compositeValue = attributeValue.addValue();
        compositeValue.fieldValue("row").exact = m_code;
        if (sum == NULL)
            compositeValue.fieldValue("sum").setUndefined();
        else
            compositeValue.fieldValue("sum").exact = sum;
            if (scaledSum == NULL)
                compositeValue.fieldValue("sum").recalculateScaled();
            else
                compositeValue.fieldValue("sum").scaled = scaledSum;
            end;
        end;
    end;

    macro completeAttributes()
    end;

    /**
     *  Функционал экспорта в ПТК ПСД
     */
    macro getExportCode()
        return strSubst(getCode(), ".", "");
    end;

    macro exportToPtkPsd()
        var value = nvl(getValue(), "");
        global.ptkPsdExportFile.printString("OR1", getExportCode(), "1", getValue());
    end;

    /**
     *  Функционал экспорта в kliko.exe
     */
    macro exportToKliko()
        var valueArray = TArray();
        var value      = getValue();

        valueArray[valueArray.size] = "S_" + getExportCode();
        valueArray[valueArray.size] = ternary(value == "-", "0", nvl(value, "0"));
        valueArray[valueArray.size] = "";

        global.klikoExportFile.printString(valueArray);
    end;

    macro saveAttributes()
        if (not isSaved())
            var exact : Money = $0;
            var scaled : Money = $0;
            m_isSaved = true;

            saveAttributes();
            m_calculator.calculate(m_report, exact, scaled);
            saveAttributeValue(exact, scaled);
        end;
    end;

    macro print()
        m_printer.print(getValue());
    end;

    macro printExcel()
        m_printer.printExcel(getValue());
    end;

    macro constructor()
    end;

    private macro ctorTApplicationRow1_5242(applicationName : String, code : String, calculator : Object, printer : Object)
        initTApplicationRow(applicationName);

        m_code = code;
        m_calculator = calculator;
        m_printer = printer;
    end;

    ctorTApplicationRow1_5242(applicationName, code, calculator, printer);
end;

macro TApplicationRow1_1_1_5242(applicationName : String, xlsApplView : Object)
    const code = "1.1";
    const filterValue = "1.1.4";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в валюте Российской Федерации (строка 1.1.4 приложения 2)(1)";

    return TApplicationRow1_5242(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_2_5242(applicationName : String, xlsApplView : Object)
    const code = "1.2";
    const filterValue = "1.2.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные обязательства перед юридическими лицами-нерезидентами в валюте Российской Федерации (строка 1.2.5 приложения 2) (1)";

    return TApplicationRow1_5242(applicationName, code, TSequenceSumAppl2National(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_6_5242(applicationName : String, xlsApplView : Object)
    const code = "1.6";
    const filterValue = "1.1.5";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Обязательства перед юридическими лицами-нерезидентами (за исключением долгосрочных) в иностранной валюте (строка 1.1.5 приложения 2)(1)";

    return TApplicationRow1_5242(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_1_7_5242(applicationName : String, xlsApplView : Object)
    const code = "1.7";
    const filterValue = "1.2.6";
    const header = null;
    const footer = null;
    const number = code;
    const name = "Долгосрочные обязательства перед юридическими лицами-нерезидентами в иностранной валюте (строка 1.2.6 приложения 2)(1)";

    return TApplicationRow1_5242(applicationName, code, TSequenceSumAppl2Foreign(filterValue), TAttributePrinter(number, name, header, footer, xlsApplView));
end;

macro TApplicationRow1_5_5242(applicationName : String, xlsApplView : Object)
    const code   = "5";
    const exact  = "global.userDataInputer.getActualReserveRest().getRouble()";
    const scaled = "global.userDataInputer.getActualReserveRest().getScaledRouble()";
    const header = null;
    const footer = "└──────┴─────────────────────────────────────────────────────┴────────────────┘";
    const number = code;
    const name   = "Фактические остатки средств на счете по учету обязательных резервов (3)";

    return TApplicationRow1_5242(applicationName, code, TConstant(exact, scaled, true), TAttributePrinter(number, name, header, footer, xlsApplView));
end;
