/*
$Name:          f123interface.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 123. Операции формы
*/

/**
 * @since   18.09.2014
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

import f123import;

/**
 *  Запуск операции "Сервис"
 */
macro executeServiceCalculationOperation()
    objectFactoryInstance.createReportCalculateController().service();
    RcbApplication.transactionManager.commit();
end;

/**
 *  Запуск операции расчета
 */
macro executeCalculationOperation()
    objectFactoryInstance.createReportCalculateController().calculate();
    RcbApplication.transactionManager.commit();
end;

/**
 *  Запуск операции печати отчета
 */
macro executePrintOperation()
    objectFactoryInstance.createReportPrintController().print();
end;

/**
 *  Запуск операции округления и нормализации
 */
macro executeNormalizationOperation()
    objectFactoryInstance.createNormalizationController().execute();
end;

/**
 *  Запуск операции пересчет после свода
 */
macro executerecalculateOperation()
    objectFactoryInstance.createReportNormalizer(objectFactoryInstance.createNormalizationProtocolView()).normalizeTotalLines();
end;

/**
 *  Запуск операции контроля
 */
macro executeControlCalculatedData()
    objectFactoryInstance.createControlCalculatedData().execute();
end;

/**
 *  Запуск операции экспорта в Kliko.exe
 */
macro executeKlikoExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В kliko").checkCalculateReport("kliko.exe");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createKlikoExportController(false).execute();
    RcbApplication.TransactionManager.rollBack();
end;

/**
 *  Запуск операции экспорта в Kliko.exe за месяц
 */
macro executeKlikoExportMonthOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В kliko").checkCalculateReport("kliko.exe");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createKlikoExportController(true).execute();
    RcbApplication.TransactionManager.rollBack();
end;

/**
 *  Запуск операции экспорта в АС ПСД
 */
macro executePtkPsdExportOperation()
    if (not rcbApplication().currentReport.isCalculated)
        TProtocolView("ПРОТОКОЛ ЭКСПОРТА В АС ПСД").checkCalculateReport("АС ПСД");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createPtkPsdExportController().execute();
    RcbApplication.TransactionManager.rollBack();
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
