/*
$Name:          f123CapitalData.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 123. Справочник "Размер собственных средств (капитал) банка"
*/

/**
 * @since   18.09.2014
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

class (RcbCapital) TF123CapitalData(report : RcbReport)

    private var m_protocolView;

    macro constructorTF123CapitalData(report : RcbReport)
        initRcbCapital(report);
        m_report = objectFactoryInstance.createReport(report);
        m_protocolView = objectFactoryInstance.createCalculateProtocolView("ПРОТОКОЛ РАСЧЕТА");
    end;

    macro execute()
        m_protocolView.setProtocolOutput(true);

        if (global.parameters.getFillCapitalData())
            if (not getValue(global.getRcbReport().context.period.endDate + 1))
                setValue(global.getRcbReport().context.period.endDate + 1, m_report.getPart("").getAttribute("000").getScaledValue());
                m_protocolView.printThatNewCapital(global.getRcbReport().context.period.endDate + 1, m_report.getPart("").getAttribute("000").getScaledValue())
            else
                m_protocolView.printThatUpdateCapital(global.getRcbReport().context.period.endDate + 1, getValue(global.getRcbReport().context.period.endDate + 1), m_report.getPart("").getAttribute("000").getScaledValue());
                setValue(global.getRcbReport().context.period.endDate + 1, m_report.getPart("").getAttribute("000").getScaledValue());
            end;
            setValue(global.getRcbReport().context.period.endDate + 1, m_report.getPart("").getAttribute("000").getScaledValue());
        end;

        m_protocolView.resetProtocolOutput();
    end;

    constructorTF123CapitalData(report);
end;