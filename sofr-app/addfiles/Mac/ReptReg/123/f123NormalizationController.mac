/*
$Name:          f123NormalizationController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 123. Контролллер нормализации.
*/

/**
 * Форма 123. Контролллер нормализации.
 *
 * @since   29.03.2013
 * @author  Kirin Pavel
 * @version 6.00.020.30
 */

class TF123NormalizationController()
    private var m_protocolView = null;
    private var m_balanceRcbReport = null;

    macro constructorTF123NormalizationController()
        m_protocolView = objectFactoryInstance.createNormalizationProtocolView();
        m_balanceRcbReport = RcbApplication.currentReport.createBalanceReport(false, RCB_CBR_IS_EARLIEST_BEGINNING_DATE);
    end;

    private macro checkReports()

        if ((m_balanceRcbReport.dimension != RcbApplication().currentReport.dimension) or not m_balanceRcbReport.isCalculated())
            m_protocolView.printAuditedReportAbsence("Балансовые счета", m_balanceRcbReport.context.period.endDate);
            m_balanceRcbReport = null;
        end;

    end;

    macro execute()

        m_protocolView.beginProtocol();

        checkReports();

        initProgress(null, "Выполнение нормализации данных", "Выполнение нормализации данных");
        objectFactoryInstance.createReportNormalizer(m_protocolView).execute();
        remProgress();

        RcbApplication.TransactionManager.commit();

        m_protocolView.endProtocol();

    end;

    constructorTF123NormalizationController();
end;