/*
$Name:          f303KlikoExportController.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 303. Контроллер экспорта kliko
*/

/**
 * Форма 303. Контроллер экспорта kliko.
 *
 * @since   10.08.2015
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

const ROWS_IN_FILE = 50000;

macro sortByCreditId(v1, v2)
    var result = 0;
    var creditId1 = int(v1.getCreditId());
    var creditId2 = int(v2.getCreditId());

    if (creditId1 < creditId2)
        result = -1;
    elif (creditId1 == creditId2)
        result = 0;
    else
        result = 1;
    end;

    return result;
end;

macro sortByCreditIdAddLineTrancheNumber(v1, v2)
    var result = 0;
    var creditId1 = int(v1.getCreditId());
    var creditId2 = int(v2.getCreditId());
    var addLine1  = int(v1.getAddLine());
    var addLine2  = int(v2.getAddLine());
    var trancheNumber1 = int(v1.getTrancheNumber());
    var trancheNumber2 = int(v2.getTrancheNumber());

    if (creditId1 < creditId2)
        result = -1;
    elif (creditId1 == creditId2)
        if ((addLine1 == 0) and (addLine2 > 0))
            result = -1;
        elif ((addLine2 == 0) and (addLine1 > 0))
            result = 1;
        elif ((trancheNumber1 == creditId1) and (trancheNumber2 != creditId2))
            result = -1;
        elif ((trancheNumber2 == creditId2) and (trancheNumber1 != creditId1))
            result = 1;
        elif (trancheNumber1 < trancheNumber2)
            result = -1;
        elif (trancheNumber1 == trancheNumber2)
            if (addLine1 < addLine2)
                result = -1;
            elif (addLine1 == addLine2)
                result = 0;
            else
                result = 1;
            end;
        else
           result = 1;
        end;
    else
        result = 1;
    end;

    return result;
end;

macro sortByCreditIdAddLine(v1, v2)
    var result = 0;
    var creditId1 = int(v1.getCreditId());
    var creditId2 = int(v2.getCreditId());
    var addLine1  = int(v1.getAddLine());
    var addLine2  = int(v2.getAddLine());

    if (creditId1 < creditId2)
        result = -1;
    elif (creditId1 == creditId2)
        if ((addLine1 == 0) and (addLine2 > 0))
            result = -1;
        elif ((addLine2 == 0) and (addLine1 > 0))
            result = 1;
        else
            result = 1;
        end;
    else
        result = 1;
    end;

    return result;
end;

    /**
     * Форматирование числа
     * @param str - форматируемая строка
     * @param p1 - количество знаков всего
     * @param p2 - количество знаков после запятой (если 0 - выводится как целое)
     */
macro formatNumber(str, p1 : Integer, p2 : Integer) : String

    return trim(execExp("string(str:" + p1 + ":" + p2+ ")"));
end;

//Класс раздела отчета
class TF303PartKliko(rowsArray : TArray, sorter : string)
    var m_currentPosition;
    var m_currentContractid;

    var m_dataArray = TArray();

    macro getCurrentItem()
        return m_dataArray[m_currentPosition];
    end;

    macro next()
        m_currentPosition = m_currentPosition + 1;

        if (m_currentPosition < m_dataArray.size)
            m_currentContractid = string(int(m_dataArray[m_currentPosition].getCreditId()));
        end;

        return m_currentPosition < m_dataArray.size;
    end;

    macro movePrev()
        if (m_currentPosition >= 0)
            m_currentPosition = m_currentPosition - 1;

            if (m_currentPosition >= 0)
                m_currentContractid = string(int(m_dataArray[m_currentPosition].getCreditId()));
            end;
        end;
    end;

    macro getCurrentContractId()
        return m_currentContractid;
    end;

    macro getRowForContract(contractId)
        if (next())
            if (getCurrentContractId() == contractId)
                return true;
            else
                movePrev();

                return false;
            end;
        end;

        return false;
    end;

    macro constructorTF303PartKliko(rowsArray, sorter)
        var i = 0;

        if (rowsArray.size == 0)
            m_currentPosition = -1;

            return;
        end;

        while (i < rowsArray.size)
            m_dataArray[i] = rowsArray[i];

            i = i + 1;
        end;

        qSort(m_dataArray, sorter);

        m_currentPosition = -1;
    end;

    constructorTF303PartKliko(rowsArray, sorter);
end;

//Класс раздела отчета с дополнительными строками
class (TF303PartKliko) TF303PartKlikoWithAddLine(rowsArray : TArray, sorter : string)
    var m_currentTrancheNumber;
    var m_currentAddLine;

    macro getCurrentAddLine()
        return m_currentAddLine;
    end;

    macro getCurrentTrancheNumber()
        return m_currentTrancheNumber;
    end;

    macro next()
        m_currentPosition = m_currentPosition + 1;
        if (m_currentPosition < m_dataArray.size)
            m_currentContractid    = string(int(m_dataArray[m_currentPosition].getCreditId()));
            m_currentTrancheNumber = string(int(m_dataArray[m_currentPosition].getTrancheNumber()));
            m_currentAddLine       = m_dataArray[m_currentPosition].getAddLine();
        end;

        return m_currentPosition < m_dataArray.size;
    end;

    macro movePrev()
        if (m_currentPosition >= 0)
            m_currentPosition = m_currentPosition - 1;

            if (m_currentPosition >= 0)
                m_currentContractid    = string(int(m_dataArray[m_currentPosition].getCreditId()));
                m_currentTrancheNumber = string(int(m_dataArray[m_currentPosition].getTrancheNumber()));
                m_currentAddLine       = m_dataArray[m_currentPosition].getAddLine();

            end;
        end;
    end;

    macro getRowForContract(contractId, addLine)
        if (next())
            if ((getCurrentContractId() == contractId) and (getCurrentAddLine() == addLine))
                return true;
            else
                movePrev();

                return false;
            end;
        end;

        return false;
    end;

    macro getRowsForTranche(contractId, trancheNumber, addLine)
        if (next())
            if ((getCurrentContractId() == contractId) and (getCurrentTrancheNumber() == trancheNumber) and (getCurrentAddLine() == addLine))
                return true;
            else
                movePrev();

                return false;
            end;
        end;

        return false;
    end;

    macro constructorTF303PartKlikoWithAddLine(rowsArray, sorter)
        initTF303PartKliko(rowsArray, sorter);
    end;

    constructorTF303PartKlikoWithAddLine(rowsArray, sorter);
end;

//Класс раздела отчета с дополнительными строками к основной стрроке
class (TF303PartKliko) TF303PartKlikoWithAddLineForMainRow(rowsArray : TArray, sorter : string)
    var m_currentAddLine;

    macro getCurrentAddLine()
        return m_currentAddLine;
    end;

    macro next()
        m_currentPosition = m_currentPosition + 1;
        if (m_currentPosition < m_dataArray.size)
            m_currentContractid    = string(int(m_dataArray[m_currentPosition].getCreditId()));
            m_currentAddLine       = m_dataArray[m_currentPosition].getAddLine();
        end;

        return m_currentPosition < m_dataArray.size;
    end;

    macro movePrev()
        if (m_currentPosition >= 0)
            m_currentPosition = m_currentPosition - 1;

            if (m_currentPosition >= 0)
                m_currentContractid    = string(int(m_dataArray[m_currentPosition].getCreditId()));
                m_currentAddLine       = m_dataArray[m_currentPosition].getAddLine();

            end;
        end;
    end;

    macro getRowForContract(contractId, isMainRow : bool)

        if (next())
            var isGoodAddLine = ternary(isMainRow, getCurrentAddLine() == 0, getCurrentAddLine() > 0);

            if ((getCurrentContractId() == contractId) and (isGoodAddLine))
                return true;
            else
                movePrev();

                return false;
            end;
        end;

        return false;
    end;

    macro constructorTF303PartKlikoWithAddLineForMainRow(rowsArray, sorter)
        initTF303PartKliko(rowsArray, sorter);
    end;

    constructorTF303PartKlikoWithAddLineForMainRow(rowsArray, sorter);
end;

//Класс контроллера экспорта
class (RcbKlikoExportController) TF303KlikoExportController()
    var m_partNumber;
    var m_part1;
    var m_userPart1;
    var m_part2;
    var m_userPart2;
    var m_part3;
    var m_userPart3;
    var m_part4;
    var m_userPart4;
    var m_part5;
    var m_userPart5;
    var m_part6;
    var m_userPart6;
    var m_part7;
    var m_userPart7;
    var m_part8;
    var m_userPart8;
    var m_part9;
    var m_userPart9;
    var m_part10;
    var m_userPart10;

    private macro getPartNumber()
        return m_partNumber;
    end;

    private macro setPartNumber(partNumber : integer)
        m_partNumber = partNumber;
    end;

    private macro createView()
        return TF303KlikoView(m_fileExtension, m_report.getPeriod().endDate);
    end;

    private macro getDescriptorInfo()
        return "F303_07.PAK от 28.03.2016";
    end;

    macro getPrintValue(userValue, reportValue)
        if ((reportValue == null) or (reportValue == strFor(1)) or (reportValue == ""))
            return userValue;
        end;

        return reportValue;
    end;

    private macro fillParts()
        m_part1      = TF303PartKliko(m_report.getPart("1").getAttributes(), "sortByCreditId");
        m_userPart1  = TF303PartKliko(m_report.getPart("1User").getAttributes(), "sortByCreditId");
        m_part2      = TF303PartKlikoWithAddLine(m_report.getPart("2").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart2  = TF303PartKlikoWithAddLine(m_report.getPart("2User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part3      = TF303PartKlikoWithAddLine(m_report.getPart("3").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart3  = TF303PartKlikoWithAddLine(m_report.getPart("3User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part4      = TF303PartKliko(m_report.getPart("4").getAttributes(), "sortByCreditId");
        m_userPart4  = TF303PartKliko(m_report.getPart("4User").getAttributes(), "sortByCreditId");
        m_part5      = TF303PartKlikoWithAddLine(m_report.getPart("5").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart5  = TF303PartKlikoWithAddLine(m_report.getPart("5User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part6      = TF303PartKlikoWithAddLine(m_report.getPart("6").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart6  = TF303PartKlikoWithAddLine(m_report.getPart("6User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part7      = TF303PartKlikoWithAddLine(m_report.getPart("7").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart7  = TF303PartKlikoWithAddLine(m_report.getPart("7User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part8      = TF303PartKliko(m_report.getPart("8").getAttributes(), "sortByCreditId");
        m_userPart8  = TF303PartKliko(m_report.getPart("8User").getAttributes(), "sortByCreditId");
        m_part9      = TF303PartKlikoWithAddLine(m_report.getPart("9").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart9  = TF303PartKlikoWithAddLine(m_report.getPart("9User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part10     = TF303PartKliko(m_report.getPart("10").getAttributes(), "sortByCreditId");
        m_userPart10 = TF303PartKliko(m_report.getPart("10User").getAttributes(), "sortByCreditId");
    end;

    private macro getContractRow()
        var result = TArray();
        var contractId;
        var tmpPart;
        // Основной раздел - 2
        if (m_part2.next())
            contractId = m_part2.getCurrentContractId();

            // Пропускаем возможные дополнительные строки раздела 2
            if (m_part2.getCurrentItem.getaddline() != 0)
                while (m_part2.getCurrentItem.getaddline() != 0)
                    m_part2.next();
                    contractId = m_part2.getCurrentContractId();
                end;
            end;
            //Добавляем данные из 1-го разздела, если есть
            if (m_part1.getRowForContract(contractId))
                if (m_userPart1.getRowForContract(contractId))
                    tmpPart = m_userPart1.getCurrentItem();
                else
                    tmpPart = m_part1.getCurrentItem();
                end;
                result[result.size] = nvl(StrSubst(getPrintValue(tmpPart.getDebtor(), m_part1.getCurrentItem().getDebtor()), "\"", "~^"), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrn(), m_part1.getCurrentItem().getOgrn()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrnip(), m_part1.getCurrentItem().getOgrnip()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegistrationDate(), m_part1.getCurrentItem().getRegistrationDate()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDebtorINN(), m_part1.getCurrentItem().getDebtorINN()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDebtorOKPO(), m_part1.getCurrentItem().getDebtorOKPO()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDebtorOKSM(), m_part1.getCurrentItem().getDebtorOKSM()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getIsMSP(), m_part1.getCurrentItem().getIsMSP()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRelationsWitnBank(), m_part1.getCurrentItem().getRelationsWitnBank()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Данные 2-го раздела
            if (m_part2.getRowForContract(contractId, 0))
                if (m_userpart2.getRowForContract(contractId, 0))
                    tmpPart = m_userPart2.getCurrentItem();
                else
                    tmpPart = m_part2.getCurrentItem();
                end;
                result[result.size] = nvl(Int(getPrintValue(tmpPart.getCreditId(), m_part2.getCurrentItem().getCreditId())), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCreditNumber(), m_part2.getCurrentItem().getCreditNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDate(), m_part2.getCurrentItem().getDate()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getNumberLoan(), m_part2.getCurrentItem().getNumberLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLoan(), m_part2.getCurrentItem().getDateLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPartyLoan(), m_part2.getCurrentItem().getPartyLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrnLoan(), m_part2.getCurrentItem().getOgrnLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegnumberLoan(), m_part2.getCurrentItem().getRegnumberLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOksmLoan(), m_part2.getCurrentItem().getOksmLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getNumberRestructurings(), m_part2.getCurrentItem().getNumberRestructurings()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateClaim(), m_part2.getCurrentItem().getDateClaim()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateEntry(), m_part2.getCurrentItem().getDateEntry()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaim(), m_part2.getCurrentItem().getSumClaim()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCollection(), m_part2.getCurrentItem().getSumCollection()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part2.getCurrentItem().getFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBankruptcyInfo(), m_part2.getCurrentItem().getBankruptcyInfo()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;
            //Добавляем данные из 3-го разздела, если есть
            if (m_part3.getRowForContract(contractId, 0))
                if (m_userPart3.getRowForContract(contractId, 0))
                    tmpPart = m_userPart3.getCurrentItem();
                else
                    tmpPart = m_part3.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeLoan(), m_part3.getCurrentItem().getTypeLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPurposeCredit(), m_part3.getCurrentItem().getPurposeCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOrigContract(), m_part3.getCurrentItem().getSumOrigContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumChangesContract(), m_part3.getCurrentItem().getSumChangesContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeOrigContract(), m_part3.getCurrentItem().getFiCodeOrigContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeChangesContract(), m_part3.getCurrentItem().getFiCodeChangesContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateOrigContract(), m_part3.getCurrentItem().getDateOrigContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateChangesContract(), m_part3.getCurrentItem().getDateChangesContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeRate(), m_part3.getCurrentItem().getTypeRate()), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateOrigContract(), ""), nvl(m_part3.getCurrentItem().getRateOrigContract(), "")), 0, 3), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateChangesContract(), ""), nvl(m_part3.getCurrentItem().getRateChangesContract(), "")), 0, 3), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateLoan(), ""), nvl(m_part3.getCurrentItem().getRateLoan(), "")), 0, 3), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getInterestPeriod(), m_part3.getCurrentItem().getInterestPeriod()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeFloatRate(), m_part3.getCurrentItem().getTypeFloatRate()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getConditionCode(), m_part3.getCurrentItem().getConditionCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCreditIdCode(), m_part3.getCurrentItem().getCreditIdCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 4-го разздела, если есть
            if (m_part4.getRowForContract(contractId, 0))
                if (m_userPart4.getRowForContract(contractId, 0))
                    tmpPart = m_userPart4.getCurrentItem();
                else
                    tmpPart = m_part4.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeSecurity(), m_part4.getCurrentItem().getTypeSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFirstQuality(), m_part4.getCurrentItem().getSumFirstQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumSecondQuality(), m_part4.getCurrentItem().getSumSecondQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumSecuritiesReserve(), m_part4.getCurrentItem().getSumSecuritiesReserve()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeInsurance(), m_part4.getCurrentItem().getTypeInsurance()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 5-го разздела, если есть
            if (m_part5.getRowForContract(contractId, 0))
                if (m_userPart5.getRowForContract(contractId, 0))
                    tmpPart = m_userPart5.getCurrentItem();
                else
                    tmpPart = m_part5.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLoan(), m_part5.getCurrentItem().getDateLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getUserTrancheNumber(), m_part5.getCurrentItem().getUserTrancheNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFunds(), m_part5.getCurrentItem().getFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part5.getCurrentItem().getFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOkato(), m_part5.getCurrentItem().getOkato()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 6-го разздела, если есть
            if (m_part6.getRowForContract(contractId, 0))
                if (m_userPart6.getRowForContract(contractId, 0))
                    tmpPart = m_userPart6.getCurrentItem();
                else
                    tmpPart = m_part6.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTermDebtAccount(), m_part6.getCurrentItem().getTermDebtAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getArrearsAccount(), m_part6.getCurrentItem().getArrearsAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumTermDebt(), m_part6.getCurrentItem().getSumTermDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOverDebt(), m_part6.getCurrentItem().getSumOverDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLoanQuality(), m_part6.getCurrentItem().getLoanQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getEvaluation(), m_part6.getCurrentItem().getEvaluation()), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getCalcReserve(), ""), nvl(m_part6.getCurrentItem().getCalcReserve(), "")), 0, 3), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part6.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part6.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getInformation254P(), m_part6.getCurrentItem().getInformation254P()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 7-го разздела, если есть
            if (m_part7.getRowForContract(contractId, 0))
                if (m_userPart7.getRowForContract(contractId, 0))
                    tmpPart = m_userPart7.getCurrentItem();
                else
                    tmpPart = m_part7.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalance(), m_part7.getCurrentItem().getSumClaimBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalanceOver(), m_part7.getCurrentItem().getSumClaimBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalance(), m_part7.getCurrentItem().getSumClaimNotBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalanceOver(), m_part7.getCurrentItem().getSumClaimNotBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part7.getCurrentItem().getSumFormedReserve()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 8-го разздела, если есть
            if (m_part8.getRowForContract(contractId, 0))
                if (m_userPart8.getRowForContract(contractId, 0))
                    tmpPart = m_userPart8.getCurrentItem();
                else
                    tmpPart = m_part8.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getSumUnusedLimits(), m_part8.getCurrentItem().getSumUnusedLimits()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part8.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part8.getCurrentItem().getSumFormedReserve()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 9-го разздела, если есть
            if (m_part9.getRowForContract(contractId, 0))
                if (m_userPart9.getRowForContract(contractId, 0))
                    tmpPart = m_userPart9.getCurrentItem();
                else
                    tmpPart = m_part9.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityRepayment(), m_part9.getCurrentItem().getPeriodicityRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedDebt(), m_part9.getCurrentItem().getSumProvidedDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidDebt(), m_part9.getCurrentItem().getSumPaidDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityInterest(), m_part9.getCurrentItem().getPeriodicityInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedInterest(), m_part9.getCurrentItem().getSumProvidedInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidInterest(), m_part9.getCurrentItem().getSumPaidInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFines(), m_part9.getCurrentItem().getSumFines()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getSourceRepayment(), m_part9.getCurrentItem().getSourceRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCodeNewCredit(), m_part9.getCurrentItem().getCodeNewCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part9.getCurrentItem().getRegNumber()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 10-го разздела, если есть
            if (m_part10.getRowForContract(contractId, 0))
                if (m_userPart10.getRowForContract(contractId, 0))
                    tmpPart = m_userPart10.getCurrentItem();
                else
                    tmpPart = m_part10.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getMethodRefinancing(), m_part10.getCurrentItem().getMethodRefinancing()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumRefinancingDebt(), m_part10.getCurrentItem().getSumRefinancingDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFunds(), m_part10.getCurrentItem().getSumFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getParty(), m_part10.getCurrentItem().getParty()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrn(), m_part10.getCurrentItem().getOgrn()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part10.getCurrentItem().getRegNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOksm(), m_part10.getCurrentItem().getOksm()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем окончание строки
            result[result.size] = "С";
            result[result.size] = "1";
            result[result.size] = "1";
            result[result.size] = "";
        end;

        return result;
    end;

    private macro getContractAddRows()  //Дополнительные строки для основной строки
        var result = TArray();
        var tmpPart;
        var contractId    = m_part2.getCurrentContractId();
        var hasDataPart2  = m_part2.getRowForContract(contractId, 1);
        var hasDataPart3  = m_part3.getRowForContract(contractId);
        var hasDataPart6  = m_part6.getRowForContract(contractId);
        var hasDataPart9  = m_part9.getRowForContract(contractId, 2);
        var hasDataPart10 = m_part10.getRowForContract(contractId);

        if (hasDataPart2 or hasDataPart3 or hasDataPart6 or hasDataPart9 or hasDataPart10)
            //1 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //2
            if (hasDataPart2)
                if (m_userpart2.getRowForContract(contractId, 1))
                    tmpPart = m_userpart2.getCurrentItem();
                else
                    tmpPart = m_part2.getCurrentItem();
                end;
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(nvl(tmpPart.getDateClaim(), m_part2.getCurrentItem().getDateClaim()), "");
                result[result.size] = nvl(nvl(tmpPart.getDateEntry(), m_part2.getCurrentItem().getDateEntry()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumClaim(), m_part2.getCurrentItem().getSumClaim()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumCollection(), m_part2.getCurrentItem().getSumCollection()), "");
                result[result.size] = nvl(nvl(tmpPart.getFiCode(), m_part2.getCurrentItem().getFiCode()), "");
                result[result.size] = "";
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            if (hasDataPart3)
                if (m_userpart3.getRowForContract(contractId))
                    tmpPart = m_userpart3.getCurrentItem();
                else
                    tmpPart = m_part3.getCurrentItem();
                end;
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(nvl(tmpPart.getConditionCode(), m_part3.getCurrentItem().getConditionCode()), "");
                result[result.size] = nvl(nvl(tmpPart.getCreditIdCode(), m_part3.getCurrentItem().getCreditIdCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;
            //4 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //5 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            if (hasDataPart6)
                if (m_userPart6.getRowForContract(contractId))
                    tmpPart = m_userPart6.getCurrentItem();
                else
                    tmpPart = m_part6.getCurrentItem();
                end;
                result[result.size] = nvl(nvl(tmpPart.getLoansTermAccount(), m_part6.getCurrentItem().getLoansTermAccount()), "");
                result[result.size] = nvl(nvl(tmpPart.getLoansArrearsAccount(), m_part6.getCurrentItem().getLoansArrearsAccount()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumTermDebt(), m_part6.getCurrentItem().getSumTermDebt()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumOverDebt(), m_part6.getCurrentItem().getSumOverDebt()), "");
                result[result.size] = nvl(nvl(tmpPart.getLoanQuality(), m_part6.getCurrentItem().getLoanQuality()), "");
                result[result.size] = nvl(nvl(tmpPart.getEvaluation(), m_part6.getCurrentItem().getEvaluation()), "");
                result[result.size] = nvl(nvl(tmpPart.getCalcReserve(), m_part6.getCurrentItem().getCalcReserve()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumCalcReserveSecurity(), m_part6.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumFormedReserve(), m_part6.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = "";
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //7 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            //8 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 9-го разздела
            if (m_userPart9.getRowForContract(contractId, 2))
                tmpPart = m_userPart9.getCurrentItem();
            else
                tmpPart = m_part9.getCurrentItem();
            end;
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = nvl(nvl(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
            result[result.size] = nvl(nvl(tmpPart.getMaturityDateDebt(), m_part9.getCurrentItem().getMaturityDateDebt()), "");
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

/* Раскомментировать, когда будет реализован расчет 10 раздела
            if (m_userPart10.getRowForContract(contractId))
                tmpPart = m_userPart10.getCurrentItem();
            else
                tmpPart = m_part10.getCurrentItem();
            end;
            result[result.size] = nvl(nvl(tmpPart.getMethodRefinancing(), m_part10.getCurrentItem().getMethodRefinancing()), "");
            result[result.size] = nvl(nvl(tmpPart.getSumRefinancingDebt(), m_part10.getCurrentItem().getSumRefinancingDebt()), "");
            result[result.size] = nvl(nvl(tmpPart.getSumFunds(), m_part10.getCurrentItem().getSumFunds()), "");
            result[result.size] = nvl(nvl(tmpPart.getParty(), m_part10.getCurrentItem().getParty()), "");
            result[result.size] = nvl(nvl(tmpPart.getOgrn(), m_part10.getCurrentItem().getOgrn()), "");
            result[result.size] = nvl(nvl(tmpPart.getRegNumber(), m_part10.getCurrentItem().getRegNumber()), "");
            result[result.size] = nvl(nvl(tmpPart.getOksm(), m_part10.getCurrentItem().getOksm()), "");
 */
            //10-й раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            result[result.size] = "-";
            result[result.size] = "1";
            result[result.size] = "0";
            result[result.size] = "1";
        end;

        return result;
    end;

    private macro getTrancheRows()
        var result = TArray();
        var contractId = m_part2.getCurrentContractId();
        var trancheNumber;
        var tmpPart;
        // Основной раздел - 3

        if (m_part3.getRowForContract(contractId, 1))
            trancheNumber = m_part3.getCurrentTrancheNumber();

            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = contractId;
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            if (m_userPart3.getRowForContract(contractId, 1))
                tmpPart = m_userPart3.getCurrentItem();
            else
                tmpPart = m_part3.getCurrentItem();
            end;
            result[result.size] = nvl(getPrintValue(tmpPart.getPurposeCredit(), m_part3.getCurrentItem().getPurposeCredit()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getSumOrigContract(), m_part3.getCurrentItem().getSumOrigContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getSumChangesContract(), m_part3.getCurrentItem().getSumChangesContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeOrigContract(), m_part3.getCurrentItem().getFiCodeOrigContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeChangesContract(), m_part3.getCurrentItem().getFiCodeChangesContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getDateOrigContract(), m_part3.getCurrentItem().getDateOrigContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getDateChangesContract(), m_part3.getCurrentItem().getDateChangesContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getTypeRate(), m_part3.getCurrentItem().getTypeRate()), "");
            result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateOrigContract(), ""), nvl(m_part3.getCurrentItem().getRateOrigContract(), "")), 0, 3), "");
            result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateChangesContract(), ""), nvl(m_part3.getCurrentItem().getRateChangesContract(), "")), 0, 3), "");
            result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateLoan(), ""), nvl(m_part3.getCurrentItem().getRateLoan(), "")), 0, 3), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getInterestPeriod(), m_part3.getCurrentItem().getInterestPeriod()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getTypeFloatRate(), m_part3.getCurrentItem().getTypeFloatRate()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getConditionCode(), m_part3.getCurrentItem().getConditionCode()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getCreditIdCode(), m_part3.getCurrentItem().getCreditIdCode()), "");

// В текущей реализации 4-й раздел не рассчитывается для траншей
            //Добавляем данные из 4-го разздела, если есть
/*            if (m_part4.getRowsForTranche(contractId, trancheNumber, 1))
                result[result.size] = nvl(m_part4.getCurrentItem().getTypeSecurity(), "");
                result[result.size] = nvl(m_part4.getCurrentItem().getSumFirstQuality(), "");
                result[result.size] = nvl(m_part4.getCurrentItem().getSumSecondQuality(), "");
                result[result.size] = nvl(m_part4.getCurrentItem().getSumSecuritiesReserve(), "");
                result[result.size] = "";
            else
*/              result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
//            end;

            //Добавляем данные из 5-го разздела, если есть
            if (m_part5.getRowsForTranche(contractId, trancheNumber, 1));
                if (m_userPart5.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart5.getCurrentItem();
                else
                    tmpPart = m_part5.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLoan(), m_part5.getCurrentItem().getDateLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getUserTrancheNumber(), m_part5.getCurrentItem().getUserTrancheNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFunds(), m_part5.getCurrentItem().getFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part5.getCurrentItem().getFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOkato(), m_part5.getCurrentItem().getOkato()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 6-го разздела, если есть
            if (m_part6.getRowsForTranche(contractId, trancheNumber, 1))
                if (m_userPart6.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart6.getCurrentItem();
                else
                    tmpPart = m_part6.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTermDebtAccount(), m_part6.getCurrentItem().getTermDebtAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getArrearsAccount(), m_part6.getCurrentItem().getArrearsAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumTermDebt(), m_part6.getCurrentItem().getSumTermDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOverDebt(), m_part6.getCurrentItem().getSumOverDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLoanQuality(), m_part6.getCurrentItem().getLoanQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getEvaluation(), m_part6.getCurrentItem().getEvaluation()), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getCalcReserve(), ""), nvl(m_part6.getCurrentItem().getCalcReserve(), "")), 0, 3), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part6.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part6.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = "";
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 7-го разздела, если есть
            if (m_part7.getRowsForTranche(contractId, trancheNumber, 1))
                if (m_userPart7.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart7.getCurrentItem();
                else
                    tmpPart = m_part7.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalance(), m_part7.getCurrentItem().getSumClaimBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalanceOver(), m_part7.getCurrentItem().getSumClaimBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalance(), m_part7.getCurrentItem().getSumClaimNotBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalanceOver(), m_part7.getCurrentItem().getSumClaimNotBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part7.getCurrentItem().getSumFormedReserve()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //8 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 9-го разздела, если есть
            if (m_part9.getRowsForTranche(contractId, trancheNumber, 1))
                if (m_userPart9.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart9.getCurrentItem();
                else
                    tmpPart = m_part9.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityRepayment(), m_part9.getCurrentItem().getPeriodicityRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedDebt(), m_part9.getCurrentItem().getSumProvidedDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidDebt(), m_part9.getCurrentItem().getSumPaidDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityInterest(), m_part9.getCurrentItem().getPeriodicityInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedInterest(), m_part9.getCurrentItem().getSumProvidedInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidInterest(), m_part9.getCurrentItem().getSumPaidInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFines(), m_part9.getCurrentItem().getSumFines()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getSourceRepayment(), m_part9.getCurrentItem().getSourceRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCodeNewCredit(), m_part9.getCurrentItem().getCodeNewCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part9.getCurrentItem().getRegNumber()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //10-й раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            result[result.size] = "Т";
            result[result.size] = "2";
            result[result.size] = "1";
            result[result.size] = "";
        end;

        return result;
    end;

    private macro getTrancheAddRows()
        var result = TArray();
        var tmpPart;

        // Данные только по 9-му разделу
        if (m_part9.getRowsForTranche(m_part2.getCurrentContractId(), m_part3.getCurrentTrancheNumber(), 2))
            //1 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //2 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //3 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //4 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //5 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //6 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            //7 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            //8 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 9-го разздела
            if (m_userPart9.getRowsForTranche(m_part2.getCurrentContractId(), m_part3.getCurrentTrancheNumber(), 2))
                tmpPart = m_userPart9.getCurrentItem();
            else
                tmpPart = m_part9.getCurrentItem();
            end;
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getMaturityDateDebt()()), "");
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //10-й раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            result[result.size] = "~";
            result[result.size] = "2";
            result[result.size] = "0";
            result[result.size] = "1";
        end;

        return result;
    end;

    private macro getContract()
        var tempArray      = TArray();
        var resultArray    = TArray();
        var trancheAddRows = TArray();

        tempArray = getContractRow();

        //Добавляем основную строку
        if (tempArray.size > 0)
            resultArray[0] = tempArray;
        else
            return resultArray;
        end;

        //Добавление дополнительных строк
        tempArray = getContractAddRows();

        while (tempArray.size > 0)

            resultArray[resultArray.size] = tempArray;

            tempArray = getContractAddRows();
        end;

        //Добавление строк по траншам
        tempArray = getTrancheRows();

        while (tempArray.size > 0)
            resultArray[resultArray.size] = tempArray;

            trancheAddRows = getTrancheAddRows();
            //Добавление дополнительных строк для транша
            while (trancheAddRows.size > 0)
                resultArray [resultArray.size] = trancheAddRows;

                trancheAddRows = getTrancheAddRows();
            end;

            tempArray = getTrancheRows();
        end;

        return resultArray;
    end;

    private macro printContract(contract);
        var i = 0;

        while (i < contract.size)
            m_view.printRow(contract[i]);

            i = i + 1;
        end;
    end;

    private macro getLastOperationDay()
        var query = " SELECT to_char(MAX(curDate.t_curdate), 'DD.MM.YYYY')  AS t_curDate"
        + "\n" + "      FROM dcurdate_dbt curDate"
        + "\n" + "     WHERE curDate.t_curdate <= rep_data.getEndDate()";

        var dataSet = TRsbDataSet(query, RSDVAL_CLIENT, RSDVAL_STATIC);

        if (dataSet.moveNext)
            return dataSet.curDate;
        end;
    end;

    private macro printDataZone()
        var currentRow = 0;
        var contractArray = TArray();

        m_view.setOutputFile();

        m_view.printHead("F303_" + getPartNumber());

        contractArray = getContract();

        while (contractArray.size > 0)
            if ((currentRow + contractArray.size) > ROWS_IN_FILE)
                currentRow = 0;

                setPartNumber(getPartNumber() + 1);

                m_view.setOutputFileName(getPartNumber());
                m_view.setOutputFile();

                m_view.printHead("F303_" + getPartNumber());
            end;

            printContract(contractArray);

            currentRow = currentRow + contractArray.size;

            contractArray = getContract();
        end;

        if (rcbApplication().currentReport.context.period.endDate >= Date(01, 08, 2016))
            m_view.printHead("F303_OD");
            m_view.printRow(getLastOperationDay());
        end;

        m_view.resetOutputFile();
    end;

    macro constructorTF303KlikoExportController()
        initRcbKlikoExportController("303", objectFactoryInstance.createReport(RcbApplication.currentReport), "Форма 303");

        setPartNumber(1);
        m_view.setOutputFileName(getPartNumber());

        fillParts();
    end;

    constructorTF303KlikoExportController();
end;

//Класс контроллера экспорта
class (TF303KlikoExportController) TF303KlikoExportController_4212()
    initTF303KlikoExportController();

    private macro getDescriptorInfo()
        return "F303_20.pak от 22.02.2017";
    end;

    macro getCodeInn(code : string):string
        var result = code;
        var oldString : string;
        if (code!="")
            oldString = code;
            if (Index(oldString,"SWIFT") > 0)
                result = StrSubst(oldString, "SWIFT", "");
            elif (Index(oldString,"NUM") > 0)
                result = StrSubst(oldString, "NUM", "");
            elif (Index(oldString,"ИНН") > 0)
                result = StrSubst(oldString, "ИНН", "");
            end;
        end;

        if ((valType(result) == V_UNDEF) or (result == strFor(1)))
            result = "";
        end;

        return result;
    end;

    macro getCodeKliko(code : string):string
        var result = "";

        if (Index(code,"SWIFT") > 0)
            result = "SWIFT";
        elif (Index(code,"NUM") > 0)
            result = "NUM";
        elif (Index(code,"ИНН") > 0)
            result = "ИНН";
        else
            result = "";
        end;

        if (strLen(trim(code)) - strLen(result) > 1)
        else
            result = "";
        end;

        return result;
    end;

    private macro getContractRow()
        var result = TArray();
        var contractId;
        var tmpPart;
        // Основной раздел - 2
        if (m_part2.next())
            contractId = m_part2.getCurrentContractId();

            // Пропускаем возможные дополнительные строки раздела 2
            if (m_part2.getCurrentItem.getaddline() != 0)
                while (m_part2.getCurrentItem.getaddline() != 0)
                    m_part2.next();
                    contractId = m_part2.getCurrentContractId();
                end;
            end;
            //Добавляем данные из 1-го разздела, если есть
            if (m_part1.getRowForContract(contractId))
                if (m_userPart1.getRowForContract(contractId))
                    tmpPart = m_userPart1.getCurrentItem();
                else
                    tmpPart = m_part1.getCurrentItem();
                end;
                result[result.size] = nvl(StrSubst(getPrintValue(tmpPart.getDebtor(), m_part1.getCurrentItem().getDebtor()), "\"", "~^"), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrn(), m_part1.getCurrentItem().getOgrn()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrnip(), m_part1.getCurrentItem().getOgrnip()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegistrationDate(), m_part1.getCurrentItem().getRegistrationDate()), "");
                result[result.size] = nvl(getPrintValue(getCodeInn(tmpPart.getDebtorINN()), getCodeInn(m_part1.getCurrentItem().getDebtorINN())), "");
                result[result.size] = nvl(getPrintValue(getCodeKliko(tmpPart.getDebtorINN()), getCodeKliko(m_part1.getCurrentItem().getDebtorINN())), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDebtorOKPO(), m_part1.getCurrentItem().getDebtorOKPO()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDebtorOKSM(), m_part1.getCurrentItem().getDebtorOKSM()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRelationsWitnBank(), m_part1.getCurrentItem().getRelationsWitnBank()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;
            //Данные 2-го раздела
                if (m_userpart2.getRowForContract(contractId, 0))
                    tmpPart = m_userPart2.getCurrentItem();
                else
                    tmpPart = m_part2.getCurrentItem();
                end;
                result[result.size] = nvl(Int(getPrintValue(tmpPart.getCreditId(), m_part2.getCurrentItem().getCreditId())), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCreditNumber(), m_part2.getCurrentItem().getCreditNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDate(), m_part2.getCurrentItem().getDate()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getNumberLoan(), m_part2.getCurrentItem().getNumberLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLoan(), m_part2.getCurrentItem().getDateLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPartyLoan(), m_part2.getCurrentItem().getPartyLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrnLoan(), m_part2.getCurrentItem().getOgrnLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegnumberLoan(), m_part2.getCurrentItem().getRegnumberLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOksmLoan(), m_part2.getCurrentItem().getOksmLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getNumberRestructurings(), m_part2.getCurrentItem().getNumberRestructurings()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateFilingSuit(), m_part2.getCurrentItem().getDateFilingSuit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLawCourt(), m_part2.getCurrentItem().getLawCourt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateClaim(), m_part2.getCurrentItem().getDateClaim()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateEntry(), m_part2.getCurrentItem().getDateEntry()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaim(), m_part2.getCurrentItem().getSumClaim()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCollection(), m_part2.getCurrentItem().getSumCollection()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part2.getCurrentItem().getFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBankruptcyInfo(), m_part2.getCurrentItem().getBankruptcyInfo()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateBankruptcy(), m_part2.getCurrentItem().getDateBankruptcy()), "");

            //Добавляем данные из 3-го разздела, если есть
            if (m_part3.getRowForContract(contractId, 0))
                if (m_userPart3.getRowForContract(contractId, 0))
                    tmpPart = m_userPart3.getCurrentItem();
                else
                    tmpPart = m_part3.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeLoan(), m_part3.getCurrentItem().getTypeLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPurposeCredit(), m_part3.getCurrentItem().getPurposeCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOrigContract(), m_part3.getCurrentItem().getSumOrigContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumChangesContract(), m_part3.getCurrentItem().getSumChangesContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeOrigContract(), m_part3.getCurrentItem().getFiCodeOrigContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeChangesContract(), m_part3.getCurrentItem().getFiCodeChangesContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateOrigContract(), m_part3.getCurrentItem().getDateOrigContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateChangesContract(), m_part3.getCurrentItem().getDateChangesContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeRate(), m_part3.getCurrentItem().getTypeRate()), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateOrigContract(), ""), nvl(m_part3.getCurrentItem().getRateOrigContract(), "")), 0, 3), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateChangesContract(), ""), nvl(m_part3.getCurrentItem().getRateChangesContract(), "")), 0, 3), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateLoan(), ""), nvl(m_part3.getCurrentItem().getRateLoan(), "")), 0, 3), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getInterestPeriod(), m_part3.getCurrentItem().getInterestPeriod()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeFloatRate(), m_part3.getCurrentItem().getTypeFloatRate()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getConditionCode(), m_part3.getCurrentItem().getConditionCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCreditIdCode(), m_part3.getCurrentItem().getCreditIdCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 4-го разздела, если есть
            if (m_part4.getRowForContract(contractId, 0))
                if (m_userPart4.getRowForContract(contractId, 0))
                    tmpPart = m_userPart4.getCurrentItem();
                else
                    tmpPart = m_part4.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeSecurity(), m_part4.getCurrentItem().getTypeSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFirstQuality(), m_part4.getCurrentItem().getSumFirstQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumSecondQuality(), m_part4.getCurrentItem().getSumSecondQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumSecuritiesReserve(), m_part4.getCurrentItem().getSumSecuritiesReserve()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeInsurance(), m_part4.getCurrentItem().getTypeInsurance()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 5-го разздела, если есть
            if (m_part5.getRowForContract(contractId, 0))
                if (m_userPart5.getRowForContract(contractId, 0))
                    tmpPart = m_userPart5.getCurrentItem();
                else
                    tmpPart = m_part5.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLoan(), m_part5.getCurrentItem().getDateLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getUserTrancheNumber(), m_part5.getCurrentItem().getUserTrancheNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFunds(), m_part5.getCurrentItem().getFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part5.getCurrentItem().getFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOkato(), m_part5.getCurrentItem().getOkato()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 6-го разздела, если есть
            if (m_part6.getRowForContract(contractId, 0))
                if (m_userPart6.getRowForContract(contractId, 0))
                    tmpPart = m_userPart6.getCurrentItem();
                else
                    tmpPart = m_part6.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTermDebtAccount(), m_part6.getCurrentItem().getTermDebtAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getArrearsAccount(), m_part6.getCurrentItem().getArrearsAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumTermDebt(), m_part6.getCurrentItem().getSumTermDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOverDebt(), m_part6.getCurrentItem().getSumOverDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLoanQuality(), m_part6.getCurrentItem().getLoanQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getEvaluation(), m_part6.getCurrentItem().getEvaluation()), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getCalcReserve(), ""), nvl(m_part6.getCurrentItem().getCalcReserve(), "")), 0, 3), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part6.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part6.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getInformation254P(), m_part6.getCurrentItem().getInformation254P()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 7-го разздела, если есть
            if (m_part7.getRowForContract(contractId, 0))
                if (m_userPart7.getRowForContract(contractId, 0))
                    tmpPart = m_userPart7.getCurrentItem();
                else
                    tmpPart = m_part7.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalance(), m_part7.getCurrentItem().getSumClaimBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalanceOver(), m_part7.getCurrentItem().getSumClaimBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalance(), m_part7.getCurrentItem().getSumClaimNotBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalanceOver(), m_part7.getCurrentItem().getSumClaimNotBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part7.getCurrentItem().getSumFormedReserve()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 8-го разздела, если есть
            if (m_part8.getRowForContract(contractId, 0))
                if (m_userPart8.getRowForContract(contractId, 0))
                    tmpPart = m_userPart8.getCurrentItem();
                else
                    tmpPart = m_part8.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getSumUnusedLimits(), m_part8.getCurrentItem().getSumUnusedLimits()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part8.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part8.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRvpPercent(), m_part8.getCurrentItem().getRvpPercent()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 9-го разздела, если есть
            if (m_part9.getRowForContract(contractId, 0))
                if (m_userPart9.getRowForContract(contractId, 0))
                    tmpPart = m_userPart9.getCurrentItem();
                else
                    tmpPart = m_part9.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityRepayment(), m_part9.getCurrentItem().getPeriodicityRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedDebt(), m_part9.getCurrentItem().getSumProvidedDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidDebt(), m_part9.getCurrentItem().getSumPaidDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityInterest(), m_part9.getCurrentItem().getPeriodicityInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedInterest(), m_part9.getCurrentItem().getSumProvidedInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidInterest(), m_part9.getCurrentItem().getSumPaidInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFines(), m_part9.getCurrentItem().getSumFines()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getSourceRepayment(), m_part9.getCurrentItem().getSourceRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCodeNewCredit(), m_part9.getCurrentItem().getCodeNewCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part9.getCurrentItem().getRegNumber()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 10-го разздела, если есть
            if (m_part10.getRowForContract(contractId, 0))
                if (m_userPart10.getRowForContract(contractId, 0))
                    tmpPart = m_userPart10.getCurrentItem();
                else
                    tmpPart = m_part10.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getMethodRefinancing(), m_part10.getCurrentItem().getMethodRefinancing()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumRefinancingDebt(), m_part10.getCurrentItem().getSumRefinancingDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFunds(), m_part10.getCurrentItem().getSumFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getParty(), m_part10.getCurrentItem().getParty()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrn(), m_part10.getCurrentItem().getOgrn()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part10.getCurrentItem().getRegNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOksm(), m_part10.getCurrentItem().getOksm()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumDeal(), m_part10.getCurrentItem().getSumDeal()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part10.getCurrentItem().getFiCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем окончание строки
            result[result.size] = "С";
            result[result.size] = "1";
            result[result.size] = "1";
            result[result.size] = "";
        end;

        return result;
    end;

    private macro getContractAddRows()  //Дополнительные строки для основной строки
        var result = TArray();
        var tmpPart;
        var contractId    = m_part2.getCurrentContractId();
        var hasDataPart2  = m_part2.getRowForContract(contractId, 1);
        var hasDataPart3  = m_part3.getRowForContract(contractId);
        var hasDataPart6  = m_part6.getRowForContract(contractId);
        var hasDataPart9  = m_part9.getRowForContract(contractId, 2);
        var hasDataPart10 = m_part10.getRowForContract(contractId);

        if (hasDataPart2 or hasDataPart3 or hasDataPart6 or hasDataPart9 or hasDataPart10)
            //1 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //2
            if (hasDataPart2)
                if (m_userpart2.getRowForContract(contractId, 1))
                    tmpPart = m_userpart2.getCurrentItem();
                else
                    tmpPart = m_part2.getCurrentItem();
                end;
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(nvl(tmpPart.getDateFilingSuit(), m_part2.getCurrentItem().getDateFilingSuit()), "");
                result[result.size] = nvl(nvl(tmpPart.getLawCourt(), m_part2.getCurrentItem().getLawCourt()), "");
                result[result.size] = nvl(nvl(tmpPart.getDateClaim(), m_part2.getCurrentItem().getDateClaim()), "");
                result[result.size] = nvl(nvl(tmpPart.getDateEntry(), m_part2.getCurrentItem().getDateEntry()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumClaim(), m_part2.getCurrentItem().getSumClaim()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumCollection(), m_part2.getCurrentItem().getSumCollection()), "");
                result[result.size] = nvl(nvl(tmpPart.getFiCode(), m_part2.getCurrentItem().getFiCode()), "");
                result[result.size] = "";
        result[result.size] = "";
                result[result.size] = "";
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            if (hasDataPart3)
                if (m_userpart3.getRowForContract(contractId))
                    tmpPart = m_userpart3.getCurrentItem();
                else
                    tmpPart = m_part3.getCurrentItem();
                end;
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(nvl(tmpPart.getConditionCode(), m_part3.getCurrentItem().getConditionCode()), "");
                result[result.size] = nvl(nvl(tmpPart.getCreditIdCode(), m_part3.getCurrentItem().getCreditIdCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;
            //4 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //5 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            if (hasDataPart6)
                if (m_userPart6.getRowForContract(contractId))
                    tmpPart = m_userPart6.getCurrentItem();
                else
                    tmpPart = m_part6.getCurrentItem();
                end;
                result[result.size] = nvl(nvl(tmpPart.getLoansTermAccount(), m_part6.getCurrentItem().getLoansTermAccount()), "");
                result[result.size] = nvl(nvl(tmpPart.getLoansArrearsAccount(), m_part6.getCurrentItem().getLoansArrearsAccount()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumTermDebt(), m_part6.getCurrentItem().getSumTermDebt()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumOverDebt(), m_part6.getCurrentItem().getSumOverDebt()), "");
                result[result.size] = nvl(nvl(tmpPart.getLoanQuality(), m_part6.getCurrentItem().getLoanQuality()), "");
                result[result.size] = nvl(nvl(tmpPart.getEvaluation(), m_part6.getCurrentItem().getEvaluation()), "");
                result[result.size] = nvl(nvl(tmpPart.getCalcReserve(), m_part6.getCurrentItem().getCalcReserve()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumCalcReserveSecurity(), m_part6.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(nvl(tmpPart.getSumFormedReserve(), m_part6.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = "";
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //7 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            //8 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 9-го разздела
            if (m_userPart9.getRowForContract(contractId, 2))
                tmpPart = m_userPart9.getCurrentItem();
            else
                tmpPart = m_part9.getCurrentItem();
            end;
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = nvl(nvl(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
            result[result.size] = nvl(nvl(tmpPart.getMaturityDateDebt(), m_part9.getCurrentItem().getMaturityDateDebt()), "");
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

/* Раскомментировать, когда будет реализован расчет 10 раздела
            if (m_userPart10.getRowForContract(contractId))
                tmpPart = m_userPart10.getCurrentItem();
            else
                tmpPart = m_part10.getCurrentItem();
            end;
            result[result.size] = nvl(nvl(tmpPart.getMethodRefinancing(), m_part10.getCurrentItem().getMethodRefinancing()), "");
            result[result.size] = nvl(nvl(tmpPart.getSumRefinancingDebt(), m_part10.getCurrentItem().getSumRefinancingDebt()), "");
            result[result.size] = nvl(nvl(tmpPart.getSumFunds(), m_part10.getCurrentItem().getSumFunds()), "");
            result[result.size] = nvl(nvl(tmpPart.getParty(), m_part10.getCurrentItem().getParty()), "");
            result[result.size] = nvl(nvl(tmpPart.getOgrn(), m_part10.getCurrentItem().getOgrn()), "");
            result[result.size] = nvl(nvl(tmpPart.getRegNumber(), m_part10.getCurrentItem().getRegNumber()), "");
            result[result.size] = nvl(nvl(tmpPart.getOksm(), m_part10.getCurrentItem().getOksm()), "");
 */
            //10-й раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            result[result.size] = "-";
            result[result.size] = "1";
            result[result.size] = "0";
            result[result.size] = "1";
        end;

        return result;
    end;

    private macro getTrancheRows()
        var result = TArray();
        var contractId = m_part2.getCurrentContractId();
        var trancheNumber;
        var tmpPart;
        // Основной раздел - 3

        if (m_part3.getRowForContract(contractId, 1))
            trancheNumber = m_part3.getCurrentTrancheNumber();

            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = contractId;
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            if (m_userPart3.getRowForContract(contractId, 1))
                tmpPart = m_userPart3.getCurrentItem();
            else
                tmpPart = m_part3.getCurrentItem();
            end;
            result[result.size] = nvl(getPrintValue(tmpPart.getPurposeCredit(), m_part3.getCurrentItem().getPurposeCredit()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getSumOrigContract(), m_part3.getCurrentItem().getSumOrigContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getSumChangesContract(), m_part3.getCurrentItem().getSumChangesContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeOrigContract(), m_part3.getCurrentItem().getFiCodeOrigContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeChangesContract(), m_part3.getCurrentItem().getFiCodeChangesContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getDateOrigContract(), m_part3.getCurrentItem().getDateOrigContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getDateChangesContract(), m_part3.getCurrentItem().getDateChangesContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getTypeRate(), m_part3.getCurrentItem().getTypeRate()), "");
            result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateOrigContract(), ""), nvl(m_part3.getCurrentItem().getRateOrigContract(), "")), 0, 3), "");
            result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateChangesContract(), ""), nvl(m_part3.getCurrentItem().getRateChangesContract(), "")), 0, 3), "");
            result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateLoan(), ""), nvl(m_part3.getCurrentItem().getRateLoan(), "")), 0, 3), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getInterestPeriod(), m_part3.getCurrentItem().getInterestPeriod()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getTypeFloatRate(), m_part3.getCurrentItem().getTypeFloatRate()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getConditionCode(), m_part3.getCurrentItem().getConditionCode()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getCreditIdCode(), m_part3.getCurrentItem().getCreditIdCode()), "");

// В текущей реализации 4-й раздел не рассчитывается для траншей
            //Добавляем данные из 4-го разздела, если есть
/*            if (m_part4.getRowsForTranche(contractId, trancheNumber, 1))
                result[result.size] = nvl(m_part4.getCurrentItem().getTypeSecurity(), "");
                result[result.size] = nvl(m_part4.getCurrentItem().getSumFirstQuality(), "");
                result[result.size] = nvl(m_part4.getCurrentItem().getSumSecondQuality(), "");
                result[result.size] = nvl(m_part4.getCurrentItem().getSumSecuritiesReserve(), "");
                result[result.size] = "";
            else
*/              result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
//            end;

            //Добавляем данные из 5-го разздела, если есть
            if (m_part5.getRowsForTranche(contractId, trancheNumber, 1));
                if (m_userPart5.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart5.getCurrentItem();
                else
                    tmpPart = m_part5.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLoan(), m_part5.getCurrentItem().getDateLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getUserTrancheNumber(), m_part5.getCurrentItem().getUserTrancheNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFunds(), m_part5.getCurrentItem().getFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part5.getCurrentItem().getFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOkato(), m_part5.getCurrentItem().getOkato()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 6-го разздела, если есть
            if (m_part6.getRowsForTranche(contractId, trancheNumber, 1))
                if (m_userPart6.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart6.getCurrentItem();
                else
                    tmpPart = m_part6.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTermDebtAccount(), m_part6.getCurrentItem().getTermDebtAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getArrearsAccount(), m_part6.getCurrentItem().getArrearsAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumTermDebt(), m_part6.getCurrentItem().getSumTermDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOverDebt(), m_part6.getCurrentItem().getSumOverDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLoanQuality(), m_part6.getCurrentItem().getLoanQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getEvaluation(), m_part6.getCurrentItem().getEvaluation()), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getCalcReserve(), ""), nvl(m_part6.getCurrentItem().getCalcReserve(), "")), 0, 3), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part6.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part6.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = "";
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 7-го разздела, если есть
            if (m_part7.getRowsForTranche(contractId, trancheNumber, 1))
                if (m_userPart7.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart7.getCurrentItem();
                else
                    tmpPart = m_part7.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalance(), m_part7.getCurrentItem().getSumClaimBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalanceOver(), m_part7.getCurrentItem().getSumClaimBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalance(), m_part7.getCurrentItem().getSumClaimNotBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalanceOver(), m_part7.getCurrentItem().getSumClaimNotBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part7.getCurrentItem().getSumFormedReserve()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //8 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 9-го разздела, если есть
            if (m_part9.getRowsForTranche(contractId, trancheNumber, 1))
                if (m_userPart9.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart9.getCurrentItem();
                else
                    tmpPart = m_part9.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityRepayment(), m_part9.getCurrentItem().getPeriodicityRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedDebt(), m_part9.getCurrentItem().getSumProvidedDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidDebt(), m_part9.getCurrentItem().getSumPaidDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityInterest(), m_part9.getCurrentItem().getPeriodicityInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedInterest(), m_part9.getCurrentItem().getSumProvidedInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidInterest(), m_part9.getCurrentItem().getSumPaidInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFines(), m_part9.getCurrentItem().getSumFines()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getSourceRepayment(), m_part9.getCurrentItem().getSourceRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCodeNewCredit(), m_part9.getCurrentItem().getCodeNewCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part9.getCurrentItem().getRegNumber()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //10-й раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            result[result.size] = "Т";
            result[result.size] = "2";
            result[result.size] = "1";
            result[result.size] = "";
        end;

        return result;
    end;

    private macro getTrancheAddRows()
        var result = TArray();
        var tmpPart;

        // Данные только по 9-му разделу
        if (m_part9.getRowsForTranche(m_part2.getCurrentContractId(), m_part3.getCurrentTrancheNumber(), 2))
            //1 раздел не заполняется
            result[result.size] = "";
        result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //2 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //3 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //4 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //5 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //6 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            //7 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            //8 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 9-го разздела
            if (m_userPart9.getRowsForTranche(m_part2.getCurrentContractId(), m_part3.getCurrentTrancheNumber(), 2))
                tmpPart = m_userPart9.getCurrentItem();
            else
                tmpPart = m_part9.getCurrentItem();
            end;
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getMaturityDateDebt()()), "");
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //10-й раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            result[result.size] = "~";
            result[result.size] = "2";
            result[result.size] = "0";
            result[result.size] = "1";
        end;

        return result;
    end;

end;

//Класс контроллера экспорта
class (TF303KlikoExportController_4212) TF303KlikoExportController_4637()
    initTF303KlikoExportController_4212();

    private macro getDescriptorInfo()
        return "F303_29.pak от 29.01.2018";
    end;

    private macro fillParts()
        m_part1      = TF303PartKliko(m_report.getPart("1").getAttributes(), "sortByCreditId");
        m_userPart1  = TF303PartKliko(m_report.getPart("1User").getAttributes(), "sortByCreditId");
        m_part2      = TF303PartKlikoWithAddLine(m_report.getPart("2").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart2  = TF303PartKlikoWithAddLine(m_report.getPart("2User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part3      = TF303PartKlikoWithAddLine(m_report.getPart("3").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart3  = TF303PartKlikoWithAddLine(m_report.getPart("3User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part4      = TF303PartKlikoWithAddLineForMainRow(m_report.getPart("4").getAttributes(), "sortByCreditIdAddLine");
        m_userPart4  = TF303PartKlikoWithAddLineForMainRow(m_report.getPart("4User").getAttributes(), "sortByCreditIdAddLine");
        m_part5      = TF303PartKlikoWithAddLine(m_report.getPart("5").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart5  = TF303PartKlikoWithAddLine(m_report.getPart("5User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part6      = TF303PartKlikoWithAddLine(m_report.getPart("6").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart6  = TF303PartKlikoWithAddLine(m_report.getPart("6User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part7      = TF303PartKlikoWithAddLine(m_report.getPart("7").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart7  = TF303PartKlikoWithAddLine(m_report.getPart("7User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part8      = TF303PartKliko(m_report.getPart("8").getAttributes(), "sortByCreditId");
        m_userPart8  = TF303PartKliko(m_report.getPart("8User").getAttributes(), "sortByCreditId");
        m_part9      = TF303PartKlikoWithAddLine(m_report.getPart("9").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_userPart9  = TF303PartKlikoWithAddLine(m_report.getPart("9User").getAttributes(), "sortByCreditIdAddLineTrancheNumber");
        m_part10     = TF303PartKliko(m_report.getPart("10").getAttributes(), "sortByCreditId");
        m_userPart10 = TF303PartKliko(m_report.getPart("10User").getAttributes(), "sortByCreditId");
    end;

    private macro getContractRow()
        var result = TArray();
        var contractId;
        var tmpPart;
        // Основной раздел - 1
        if (m_part1.next())
            contractId = m_part1.getCurrentContractId();

            //Добавляем данные из 1-го разздела
                if (m_userPart1.getRowForContract(contractId))
                    tmpPart = m_userPart1.getCurrentItem();
                else
                    tmpPart = m_part1.getCurrentItem();
                end;
                result[result.size] = nvl(StrSubst(getPrintValue(tmpPart.getDebtor(), m_part1.getCurrentItem().getDebtor()), "\"", "~^"), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrn(), m_part1.getCurrentItem().getOgrn()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrnip(), m_part1.getCurrentItem().getOgrnip()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegistrationDate(), m_part1.getCurrentItem().getRegistrationDate()), "");
                result[result.size] = nvl(getPrintValue(getCodeInn(tmpPart.getDebtorINN()), getCodeInn(m_part1.getCurrentItem().getDebtorINN())), "");
                result[result.size] = nvl(getPrintValue(getCodeKliko(tmpPart.getDebtorINN()), getCodeKliko(m_part1.getCurrentItem().getDebtorINN())), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDebtorOKPO(), m_part1.getCurrentItem().getDebtorOKPO()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDebtorOKSM(), m_part1.getCurrentItem().getDebtorOKSM()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRelationsWitnBank(), m_part1.getCurrentItem().getRelationsWitnBank()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOkved(), m_part1.getCurrentItem().getOkved()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBorrowersGroupNumber(), m_part1.getCurrentItem().getBorrowersGroupNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBorrowersGroupName(), m_part1.getCurrentItem().getBorrowersGroupName()), "");

            //Данные 2-го раздела, если есть
            if (m_part2.getRowForContract(contractId, 0))
                if (m_userpart2.getRowForContract(contractId, 0))
                    tmpPart = m_userPart2.getCurrentItem();
                else
                    tmpPart = m_part2.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getCreditIdForReport(), m_part2.getCurrentItem().getCreditIdForReport()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCreditNumber(), m_part2.getCurrentItem().getCreditNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDate(), m_part2.getCurrentItem().getDate()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getNumberLoan(), m_part2.getCurrentItem().getNumberLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLoan(), m_part2.getCurrentItem().getDateLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPartyLoan(), m_part2.getCurrentItem().getPartyLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrnLoan(), m_part2.getCurrentItem().getOgrnLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegnumberLoan(), m_part2.getCurrentItem().getRegnumberLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOksmLoan(), m_part2.getCurrentItem().getOksmLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getNumberRestructurings(), m_part2.getCurrentItem().getNumberRestructurings()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateFilingSuit(), m_part2.getCurrentItem().getDateFilingSuit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLawCourt(), m_part2.getCurrentItem().getLawCourt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateClaim(), m_part2.getCurrentItem().getDateClaim()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateEntry(), m_part2.getCurrentItem().getDateEntry()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaim(), m_part2.getCurrentItem().getSumClaim()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCollection(), m_part2.getCurrentItem().getSumCollection()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part2.getCurrentItem().getFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBankruptcyInfo(), m_part2.getCurrentItem().getBankruptcyInfo()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateBankruptcy(), m_part2.getCurrentItem().getDateBankruptcy()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLastRestructuring(), m_part2.getCurrentItem().getDateLastRestructuring()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBeneficiaryName(), m_part2.getCurrentItem().getBeneficiaryName()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBeneficiaryOgrn(), m_part2.getCurrentItem().getBeneficiaryOgrn()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBeneficiaryRegNumber(), m_part2.getCurrentItem().getBeneficiaryRegNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBeneficiaryOksm(), m_part2.getCurrentItem().getBeneficiaryOksm()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getObligationKind(), m_part2.getCurrentItem().getObligationKind()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getObligationSum(), m_part2.getCurrentItem().getObligationSum()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getMaturityObligation(), m_part2.getCurrentItem().getMaturityObligation()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 3-го разздела, если есть
            if (m_part3.getRowForContract(contractId, 0))
                if (m_userPart3.getRowForContract(contractId, 0))
                    tmpPart = m_userPart3.getCurrentItem();
                else
                    tmpPart = m_part3.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeLoan(), m_part3.getCurrentItem().getTypeLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPurposeCredit(), m_part3.getCurrentItem().getPurposeCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOrigContract(), m_part3.getCurrentItem().getSumOrigContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumChangesContract(), m_part3.getCurrentItem().getSumChangesContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeOrigContract(), m_part3.getCurrentItem().getFiCodeOrigContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeChangesContract(), m_part3.getCurrentItem().getFiCodeChangesContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateOrigContract(), m_part3.getCurrentItem().getDateOrigContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateChangesContract(), m_part3.getCurrentItem().getDateChangesContract()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeRate(), m_part3.getCurrentItem().getTypeRate()), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateOrigContract(), ""), nvl(m_part3.getCurrentItem().getRateOrigContract(), "")), 0, 3), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateChangesContract(), ""), nvl(m_part3.getCurrentItem().getRateChangesContract(), "")), 0, 3), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateLoan(), ""), nvl(m_part3.getCurrentItem().getRateLoan(), "")), 0, 3), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getInterestPeriod(), m_part3.getCurrentItem().getInterestPeriod()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeFloatRate(), m_part3.getCurrentItem().getTypeFloatRate()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getConditionCode(), m_part3.getCurrentItem().getConditionCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCreditIdCode(), m_part3.getCurrentItem().getCreditIdCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeRateEndDate(), m_part3.getCurrentItem().getTypeRateEndDate()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeFloatRateEndDate(), m_part3.getCurrentItem().getTypeFloatRateEndDate()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 4-го разздела, если есть
            if (m_part4.getRowForContract(contractId, true))
                if (m_userPart4.getRowForContract(contractId, true))
                    tmpPart = m_userPart4.getCurrentItem();
                else
                    tmpPart = m_part4.getCurrentItem();
                end;
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeInsurance(), m_part4.getCurrentItem().getTypeInsurance()), "");
                result[result.size] = "";
                result[result.size] = "";
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 5-го разздела, если есть
            if (m_part5.getRowForContract(contractId, 0))
                if (m_userPart5.getRowForContract(contractId, 0))
                    tmpPart = m_userPart5.getCurrentItem();
                else
                    tmpPart = m_part5.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLoan(), m_part5.getCurrentItem().getDateLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getUserTrancheNumber(), m_part5.getCurrentItem().getUserTrancheNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFunds(), m_part5.getCurrentItem().getFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part5.getCurrentItem().getFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOkato(), m_part5.getCurrentItem().getOkato()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 6-го разздела, если есть
            if (m_part6.getRowForContract(contractId, 0))
                if (m_userPart6.getRowForContract(contractId, 0))
                    tmpPart = m_userPart6.getCurrentItem();
                else
                    tmpPart = m_part6.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTermDebtAccount(), m_part6.getCurrentItem().getTermDebtAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getArrearsAccount(), m_part6.getCurrentItem().getArrearsAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumTermDebt(), m_part6.getCurrentItem().getSumTermDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOverDebt(), m_part6.getCurrentItem().getSumOverDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLoanQuality(), m_part6.getCurrentItem().getLoanQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getEvaluation(), m_part6.getCurrentItem().getEvaluation()), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getCalcReserve(), ""), nvl(m_part6.getCurrentItem().getCalcReserve(), "")), 0, 3), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part6.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part6.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getInformation254P(), m_part6.getCurrentItem().getInformation254P()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFinPositionBorrower(), m_part6.getCurrentItem().getFinPositionBorrower()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getQualityServiceDebt(), m_part6.getCurrentItem().getQualityServiceDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getHighRiskFactor(), m_part6.getCurrentItem().getHighRiskFactor()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 7-го разздела, если есть
            if (m_part7.getRowForContract(contractId, 0))
                if (m_userPart7.getRowForContract(contractId, 0))
                    tmpPart = m_userPart7.getCurrentItem();
                else
                    tmpPart = m_part7.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalance(), m_part7.getCurrentItem().getSumClaimBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalanceOver(), m_part7.getCurrentItem().getSumClaimBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalance(), m_part7.getCurrentItem().getSumClaimNotBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalanceOver(), m_part7.getCurrentItem().getSumClaimNotBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part7.getCurrentItem().getSumFormedReserve()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 8-го разздела, если есть
            if (m_part8.getRowForContract(contractId, 0))
                if (m_userPart8.getRowForContract(contractId, 0))
                    tmpPart = m_userPart8.getCurrentItem();
                else
                    tmpPart = m_part8.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getSumUnusedLimits(), m_part8.getCurrentItem().getSumUnusedLimits()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part8.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part8.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRvpPercent(), m_part8.getCurrentItem().getRvpPercent()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 9-го разздела, если есть
            if (m_part9.getRowForContract(contractId, 0))
                if (m_userPart9.getRowForContract(contractId, 0))
                    tmpPart = m_userPart9.getCurrentItem();
                else
                    tmpPart = m_part9.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityRepayment(), m_part9.getCurrentItem().getPeriodicityRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedDebt(), m_part9.getCurrentItem().getSumProvidedDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidDebt(), m_part9.getCurrentItem().getSumPaidDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityInterest(), m_part9.getCurrentItem().getPeriodicityInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedInterest(), m_part9.getCurrentItem().getSumProvidedInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidInterest(), m_part9.getCurrentItem().getSumPaidInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFines(), m_part9.getCurrentItem().getSumFines()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getSourceRepayment(), m_part9.getCurrentItem().getSourceRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCodeNewCredit(), m_part9.getCurrentItem().getCodeNewCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part9.getCurrentItem().getRegNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPrincipalPaymentFiCode(), m_part9.getCurrentItem().getPrincipalPaymentFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPercentPaymentFiCode(), m_part9.getCurrentItem().getPercentPaymentFiCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 10-го разздела, если есть
            if (m_part10.getRowForContract(contractId, 0))
                if (m_userPart10.getRowForContract(contractId, 0))
                    tmpPart = m_userPart10.getCurrentItem();
                else
                    tmpPart = m_part10.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getMethodRefinancing(), m_part10.getCurrentItem().getMethodRefinancing()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumRefinancingDebt(), m_part10.getCurrentItem().getSumRefinancingDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFunds(), m_part10.getCurrentItem().getSumFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getParty(), m_part10.getCurrentItem().getParty()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrn(), m_part10.getCurrentItem().getOgrn()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part10.getCurrentItem().getRegNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOksm(), m_part10.getCurrentItem().getOksm()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumDeal(), m_part10.getCurrentItem().getSumDeal()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part10.getCurrentItem().getFiCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем окончание строки
            result[result.size] = "С";
            result[result.size] = "1";
            result[result.size] = "1";
            result[result.size] = "";
        end;

        return result;
    end;

    private macro getContractAddRows()  //Дополнительные строки для основной строки
        var result = TArray();
        var tmpPart;
        var contractId    = m_part1.getCurrentContractId();
        var hasDataPart1  = m_part1.getRowForContract(contractId, false);
        var hasDataPart2  = m_part2.getRowsForTranche(contractId, contractId, 1);
        var hasDataPart3  = m_part3.getRowForContract(contractId);
        var hasDataPart4  = m_part4.getRowForContract(contractId, false);
        var hasDataPart6  = m_part6.getRowForContract(contractId);
        var hasDataPart9  = m_part9.getRowForContract(contractId, 2);
        var hasDataPart10 = m_part10.getRowForContract(contractId);

        if (hasDataPart1 or hasDataPart2 or hasDataPart3 or hasDataPart4 or hasDataPart6 or hasDataPart9 or hasDataPart10)
            if (hasDataPart1)
                if (m_userPart1.getRowForContract(contractId))
                    tmpPart = m_userPart1.getCurrentItem();
                else
                    tmpPart = m_part1.getCurrentItem();
                end;
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getBorrowersGroupNumber(), m_part1.getCurrentItem().getBorrowersGroupNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBorrowersGroupName(), m_part1.getCurrentItem().getBorrowersGroupName()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;
            //2
            if (hasDataPart2)
                if (m_userpart2.getRowForContract(contractId, 1))
                    tmpPart = m_userpart2.getCurrentItem();
                else
                    tmpPart = m_part2.getCurrentItem();
                end;
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getDateFilingSuit(), m_part2.getCurrentItem().getDateFilingSuit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLawCourt(), m_part2.getCurrentItem().getLawCourt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateClaim(), m_part2.getCurrentItem().getDateClaim()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateEntry(), m_part2.getCurrentItem().getDateEntry()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaim(), m_part2.getCurrentItem().getSumClaim()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCollection(), m_part2.getCurrentItem().getSumCollection()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part2.getCurrentItem().getFiCode()), "");
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getBeneficiaryName(), m_part2.getCurrentItem().getBeneficiaryName()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBeneficiaryOgrn(), m_part2.getCurrentItem().getBeneficiaryOgrn()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBeneficiaryRegNumber(), m_part2.getCurrentItem().getBeneficiaryRegNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getBeneficiaryOksm(), m_part2.getCurrentItem().getBeneficiaryOksm()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getObligationKind(), m_part2.getCurrentItem().getObligationKind()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getObligationSum(), m_part2.getCurrentItem().getObligationSum()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getMaturityObligation(), m_part2.getCurrentItem().getMaturityObligation()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            if (hasDataPart3)
                if (m_userpart3.getRowForContract(contractId))
                    tmpPart = m_userpart3.getCurrentItem();
                else
                    tmpPart = m_part3.getCurrentItem();
                end;
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getConditionCode(), m_part3.getCurrentItem().getConditionCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCreditIdCode(), m_part3.getCurrentItem().getCreditIdCode()), "");
                result[result.size] = "";
                result[result.size] = "";
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;
            //4 раздел
            if (hasDataPart4)
                if (m_userPart4.getRowForContract(contractId, false))
                    tmpPart = m_userPart4.getCurrentItem();
                else
                    tmpPart = m_part4.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTypeSecurity(), m_part4.getCurrentItem().getTypeSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFirstQuality(), m_part4.getCurrentItem().getSumFirstQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumSecondQuality(), m_part4.getCurrentItem().getSumSecondQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumSecuritiesReserve(), m_part4.getCurrentItem().getSumSecuritiesReserve()), "");
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getSecuritiesRvpPercent(), m_part4.getCurrentItem().getSecuritiesRvpPercent()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSecuritiesRvpObligations(), m_part4.getCurrentItem().getSecuritiesRvpObligations()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;
            //5 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            if (hasDataPart6)
                if (m_userPart6.getRowForContract(contractId))
                    tmpPart = m_userPart6.getCurrentItem();
                else
                    tmpPart = m_part6.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getLoansTermAccount(), m_part6.getCurrentItem().getLoansTermAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLoansArrearsAccount(), m_part6.getCurrentItem().getLoansArrearsAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumTermDebt(), m_part6.getCurrentItem().getSumTermDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOverDebt(), m_part6.getCurrentItem().getSumOverDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLoanQuality(), m_part6.getCurrentItem().getLoanQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getEvaluation(), m_part6.getCurrentItem().getEvaluation()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCalcReserve(), m_part6.getCurrentItem().getCalcReserve()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part6.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part6.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //7 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            //8 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 9-го разздела
            if (hasDataPart9)
                if (m_userPart9.getRowForContract(contractId, 2))
                    tmpPart = m_userPart9.getCurrentItem();
                else
                    tmpPart = m_part9.getCurrentItem();
                end;
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidDebt(), m_part9.getCurrentItem().getSumPaidDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityInterest(), m_part9.getCurrentItem().getPeriodicityInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedInterest(), m_part9.getCurrentItem().getSumProvidedInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidInterest(), m_part9.getCurrentItem().getSumPaidInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFines(), m_part9.getCurrentItem().getSumFines()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getMaturityDateDebt(), m_part9.getCurrentItem().getMaturityDateDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSourceRepayment(), m_part9.getCurrentItem().getSourceRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCodeNewCredit(), m_part9.getCurrentItem().getCodeNewCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part9.getCurrentItem().getRegNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPrincipalPaymentFiCode(), m_part9.getCurrentItem().getPrincipalPaymentFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPercentPaymentFiCode(), m_part9.getCurrentItem().getPercentPaymentFiCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            if (hasDataPart10)
                if (m_userPart10.getRowForContract(contractId))
                    tmpPart = m_userPart10.getCurrentItem();
                else
                    tmpPart = m_part10.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getMethodRefinancing(), m_part10.getCurrentItem().getMethodRefinancing()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumRefinancingDebt(), m_part10.getCurrentItem().getSumRefinancingDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFunds(), m_part10.getCurrentItem().getSumFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getParty(), m_part10.getCurrentItem().getParty()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOgrn(), m_part10.getCurrentItem().getOgrn()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part10.getCurrentItem().getRegNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOksm(), m_part10.getCurrentItem().getOksm()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumDeal(), m_part10.getCurrentItem().getSumDeal()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part10.getCurrentItem().getFiCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            result[result.size] = "-";
            result[result.size] = "1";
            result[result.size] = "0";
            result[result.size] = "1";
        end;

        return result;
    end;

    private macro getTrancheRows()
        var result = TArray();
        var contractId = m_part1.getCurrentContractId();
        var trancheNumber;
        var tmpPart;
        // Основной раздел - 3

        if (m_part3.getRowForContract(contractId, 1))
            trancheNumber = m_part3.getCurrentTrancheNumber();
            //Данные 2-го раздела
            if (m_part2.getRowsForTranche(contractId, trancheNumber, 1));
                if (m_userpart2.getRowForContract(contractId, 1))
                    tmpPart = m_userPart2.getCurrentItem();
                else
                    tmpPart = m_part2.getCurrentItem();
                end;
                //1 раздел
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                //2 раздел
                result[result.size] = nvl(getPrintValue(tmpPart.getCreditIdForReport(), m_part2.getCurrentItem().getCreditIdForReport()), "");
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getNumberRestructurings(), m_part2.getCurrentItem().getNumberRestructurings()), "");
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            else
                //1 раздел
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                //2 раздел
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            if (m_userPart3.getRowForContract(contractId, 1))
                tmpPart = m_userPart3.getCurrentItem();
            else
                tmpPart = m_part3.getCurrentItem();
            end;
            result[result.size] = "";
            result[result.size] = nvl(getPrintValue(tmpPart.getPurposeCredit(), m_part3.getCurrentItem().getPurposeCredit()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getSumOrigContract(), m_part3.getCurrentItem().getSumOrigContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getSumChangesContract(), m_part3.getCurrentItem().getSumChangesContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeOrigContract(), m_part3.getCurrentItem().getFiCodeOrigContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getFiCodeChangesContract(), m_part3.getCurrentItem().getFiCodeChangesContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getDateOrigContract(), m_part3.getCurrentItem().getDateOrigContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getDateChangesContract(), m_part3.getCurrentItem().getDateChangesContract()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getTypeRate(), m_part3.getCurrentItem().getTypeRate()), "");
            result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateOrigContract(), ""), nvl(m_part3.getCurrentItem().getRateOrigContract(), "")), 0, 3), "");
            result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateChangesContract(), ""), nvl(m_part3.getCurrentItem().getRateChangesContract(), "")), 0, 3), "");
            result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getRateLoan(), ""), nvl(m_part3.getCurrentItem().getRateLoan(), "")), 0, 3), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getInterestPeriod(), m_part3.getCurrentItem().getInterestPeriod()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getTypeFloatRate(), m_part3.getCurrentItem().getTypeFloatRate()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getConditionCode(), m_part3.getCurrentItem().getConditionCode()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getCreditIdCode(), m_part3.getCurrentItem().getCreditIdCode()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getTypeRateEndDate(), m_part3.getCurrentItem().getTypeRateEndDate()), "");
            result[result.size] = nvl(getPrintValue(tmpPart.getTypeFloatRateEndDate(), m_part3.getCurrentItem().getTypeFloatRateEndDate()), "");

         //Для раздела 4 всегда формируются дополнительные строки к основной строке в разрезе видов обеспечений
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 5-го разздела, если есть
            if (m_part5.getRowsForTranche(contractId, trancheNumber, 1));
                if (m_userPart5.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart5.getCurrentItem();
                else
                    tmpPart = m_part5.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getDateLoan(), m_part5.getCurrentItem().getDateLoan()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getUserTrancheNumber(), m_part5.getCurrentItem().getUserTrancheNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFunds(), m_part5.getCurrentItem().getFunds()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getFiCode(), m_part5.getCurrentItem().getFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getOkato(), m_part5.getCurrentItem().getOkato()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 6-го разздела, если есть
            if (m_part6.getRowsForTranche(contractId, trancheNumber, 1))
                if (m_userPart6.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart6.getCurrentItem();
                else
                    tmpPart = m_part6.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getTermDebtAccount(), m_part6.getCurrentItem().getTermDebtAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getArrearsAccount(), m_part6.getCurrentItem().getArrearsAccount()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumTermDebt(), m_part6.getCurrentItem().getSumTermDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumOverDebt(), m_part6.getCurrentItem().getSumOverDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getLoanQuality(), m_part6.getCurrentItem().getLoanQuality()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getEvaluation(), m_part6.getCurrentItem().getEvaluation()), "");
                result[result.size] = nvl(formatNumber(getPrintValue(nvl(tmpPart.getCalcReserve(), ""), nvl(m_part6.getCurrentItem().getCalcReserve(), "")), 0, 3), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumCalcReserveSecurity(), m_part6.getCurrentItem().getSumCalcReserveSecurity()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part6.getCurrentItem().getSumFormedReserve()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getInformation254P(), m_part6.getCurrentItem().getInformation254P()), "");
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getQualityServiceDebt(), m_part6.getCurrentItem().getQualityServiceDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getHighRiskFactor(), m_part6.getCurrentItem().getHighRiskFactor()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //Добавляем данные из 7-го разздела, если есть
            if (m_part7.getRowsForTranche(contractId, trancheNumber, 1))
                if (m_userPart7.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart7.getCurrentItem();
                else
                    tmpPart = m_part7.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalance(), m_part7.getCurrentItem().getSumClaimBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimBalanceOver(), m_part7.getCurrentItem().getSumClaimBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalance(), m_part7.getCurrentItem().getSumClaimNotBalance()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumClaimNotBalanceOver(), m_part7.getCurrentItem().getSumClaimNotBalanceOver()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFormedReserve(), m_part7.getCurrentItem().getSumFormedReserve()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //8 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 9-го разздела, если есть
            if (m_part9.getRowsForTranche(contractId, trancheNumber, 1))
                if (m_userPart9.getRowsForTranche(contractId, trancheNumber, 1))
                    tmpPart = m_userPart9.getCurrentItem();
                else
                    tmpPart = m_part9.getCurrentItem();
                end;
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityRepayment(), m_part9.getCurrentItem().getPeriodicityRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedDebt(), m_part9.getCurrentItem().getSumProvidedDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidDebt(), m_part9.getCurrentItem().getSumPaidDebt()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPeriodicityInterest(), m_part9.getCurrentItem().getPeriodicityInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumProvidedInterest(), m_part9.getCurrentItem().getSumProvidedInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumPaidInterest(), m_part9.getCurrentItem().getSumPaidInterest()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getSumFines(), m_part9.getCurrentItem().getSumFines()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
                result[result.size] = "";
                result[result.size] = nvl(getPrintValue(tmpPart.getSourceRepayment(), m_part9.getCurrentItem().getSourceRepayment()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getCodeNewCredit(), m_part9.getCurrentItem().getCodeNewCredit()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getRegNumber(), m_part9.getCurrentItem().getRegNumber()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPrincipalPaymentFiCode(), m_part9.getCurrentItem().getPrincipalPaymentFiCode()), "");
                result[result.size] = nvl(getPrintValue(tmpPart.getPercentPaymentFiCode(), m_part9.getCurrentItem().getPercentPaymentFiCode()), "");
            else
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
                result[result.size] = "";
            end;

            //10-й раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            result[result.size] = "Т";
            result[result.size] = "2";
            result[result.size] = "1";
            result[result.size] = "";
        end;

        return result;
    end;

    private macro getTrancheAddRows()
        var result = TArray();
        var tmpPart;
        var contractId = m_part1.getCurrentContractId();
        var trancheNumber = m_part3.getCurrentTrancheNumber();

        if (m_part9.getRowsForTranche(m_part2.getCurrentContractId(), m_part3.getCurrentTrancheNumber(), 2))
            //1 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //2 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //3
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //4 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //5 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //6 раздел
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //7 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            //8 раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //Добавляем данные из 9-го разздела
            if (m_userPart9.getRowsForTranche(m_part2.getCurrentContractId(), m_part3.getCurrentTrancheNumber(), 2))
                tmpPart = m_userPart9.getCurrentItem();
            else
                tmpPart = m_part9.getCurrentItem();
            end;
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = nvl(getPrintValue(tmpPart.getDateRemovalDebt(), m_part9.getCurrentItem().getDateRemovalDebt()), "");
            result[result.size] = "";
            result[result.size] = nvl(getPrintValue(tmpPart.getSourceRepayment(), m_part9.getCurrentItem().getSourceRepayment()()), "");
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";

            //10-й раздел не заполняется
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";
            result[result.size] = "";


            result[result.size] = "~";
            result[result.size] = "2";
            result[result.size] = "0";
            result[result.size] = "1";
         end;

        return result;
    end;

end;
