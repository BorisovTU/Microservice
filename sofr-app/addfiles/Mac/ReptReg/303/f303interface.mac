/*
$Name:          f303interface.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 303. Операции формы
*/

/**
 * Форма 303. Операции формы.
 *
 * @since   10.08.2015
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

import f303import;

/**
 *  Запуск операции расчета
 */
macro executeCalculationOperation()
    objectFactoryInstance.createReportCalculateController().calculate();
    RcbApplication.transactionManager.commit();
end;

/**
 *  Запуск операции расчета
 */
macro executeServiceOperation()
    objectFactoryInstance.createReportUserCalculateController().calculate();
    RcbApplication.transactionManager.commit();
end;

/**
 *  Запуск операции печати отчета
 */
macro executePrintOperation()
    objectFactoryInstance.createReportPrintController().print();
end;

/**
 *  Запуск операции экспорта kliko
 */
macro executeKlikoExportOperation()
    var m_protocolView  = TProtocolView("ПРОТОКОЛ ЭКСПОРТА В Kliko.exe");

    if (not rcbApplication().currentReport.isCalculated)
        m_protocolView.checkCalculateReport("kliko.exe");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createKlikoExportController().execute();
    RcbApplication.TransactionManager.rollBack();
end;

/**
 *  Запуск операции экспорта ПТК ПСД
 */
macro executePtkPsdExportOperation()
    var m_protocolView  = TProtocolView("ПРОТОКОЛ ЭКСПОРТА В АС ПСД");

    if (not rcbApplication().currentReport.isCalculated)
        m_protocolView.checkCalculateReport("АС ПСД");
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    objectFactoryInstance.createPtkPsdExportController().execute();
    RcbApplication.TransactionManager.rollBack();
end;

/**
 * Операция экспорта в xml. "Экспорт в XML-формате"
 */
macro executeXmlExportOperation()
    objectFactoryInstance.createXmlExportController(RCB_XML_PK_MONTHLY).execute();
end;


установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
