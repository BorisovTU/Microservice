/*
$Name:          f119ReportCalculateController.mac
$Module:        Отчеты ЦБ
$Description:   Форма 119. Класс контроллера расчета отчета.
*/

class (RcbReportCalculateController) TF119ReportCalculateController()
    private macro clearValues()
        getReport().getPart(TF119Global().getPart1Id()).getPartCompositeValue().removeAllValues();
        getReport().getPart(TF119Global().getPart2Id()).getPartCompositeValue().removeAllValues();
        getReport().getPart(TF119Global().getPart3Id()).getPartCompositeValue().removeAllValues();
        RcbApplication().transactionManager.commit();

        getReport().getPart(TF119Global().getPart1Id()).clear();
        getReport().getPart(TF119Global().getPart2Id()).clear();
        getReport().getPart(TF119Global().getPart3Id()).clear();

        getDataSources().clear();
    end;

    private macro pushControllers()
        m_partCalculateControllers.push_back(objectFactoryInstance.createPart1CalculateController(this));
        m_partCalculateControllers.push_back(objectFactoryInstance.createPart2CalculateController(this));
        m_partCalculateControllers.push_back(objectFactoryInstance.createPart3CalculateController(this));
    end;

    private macro printAdditionalProtocolData()
        TF119Parameters().printCalculationReport(getProtocolView());
    end;

    macro calculate()
        var result = calculate();
        for (var i, m_partCalculateControllers)
            i.getDataProtocolView().save();
        end;
        return result;
    end;

    macro initialize() : Bool
        clearValues();
        pushControllers();

        return m_partCalculateControllers.size > 0;
    end;

    private macro constructorTF119ReportCalculateController()
        initRcbReportCalculateController();
    end;

    constructorTF119ReportCalculateController();
end;
