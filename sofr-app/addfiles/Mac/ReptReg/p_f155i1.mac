/*─────────────────────────────────────────────────────────────────────────────────┐
  RS-Bank 6.0                                                       R-Style SoftLab
  Файл подсистемы "Отчетность регламентируемая"

  Форма 155. Печать раздела 1.

  FILENAME: p_f155i1.mac
  CREATED:  24.11.2005 ABP 
  MODIFICATIONS:
  COMMENTS:
└─────────────────────────────────────────────────────────────────────────────────*/
import calc_f155, ReptCbInter, lib_str, cy_find, p_f155i2;

var Issue1Width = 127;
var IsIssue1Empty;

/* Переменные 1 раздела */
var Р1_С1__ГР__Г2, Р1_С1__ГР__Г3, Р1_С1__ГР__Г6,
    Р1_С1__ГР1_Г2,
    Р1_С1__ГР2_Г2, Р1_С1__ГР2_Г3, Р1_С1__ГР2_Г6,
    Р1_С1__ГР3_Г2, Р1_С1__ГР3_Г3, Р1_С1__ГР3_Г6,
    Р1_С1__ГР4_Г2, Р1_С1__ГР4_Г3, Р1_С1__ГР4_Г6,
    Р1_С1__ГР5_Г2, Р1_С1__ГР5_Г3, Р1_С1__ГР5_Г6,
    Р1_С2__ГР__Г2, Р1_С2__ГР__Г3, Р1_С2__ГР__Г6,
    Р1_С2__ГР1_Г2,
    Р1_С2__ГР2_Г2, Р1_С2__ГР2_Г3, Р1_С2__ГР2_Г6,
    Р1_С2__ГР3_Г2, Р1_С2__ГР3_Г3, Р1_С2__ГР3_Г6,
    Р1_С2__ГР4_Г2, Р1_С2__ГР4_Г3, Р1_С2__ГР4_Г6,
    Р1_С2__ГР5_Г2, Р1_С2__ГР5_Г3, Р1_С2__ГР5_Г6,
    Р1_С3__ГР__Г2, Р1_С3__ГР__Г3, Р1_С3__ГР__Г6,
    Р1_С3__ГР1_Г2,
    Р1_С3__ГР2_Г2, Р1_С3__ГР2_Г3, Р1_С3__ГР2_Г6,
    Р1_С3__ГР3_Г2, Р1_С3__ГР3_Г3, Р1_С3__ГР3_Г6,
    Р1_С3__ГР4_Г2, Р1_С3__ГР4_Г3, Р1_С3__ГР4_Г6,
    Р1_С3__ГР5_Г2, Р1_С3__ГР5_Г3, Р1_С3__ГР5_Г6,
    Р1_С4__ГР__Г2, Р1_С4__ГР__Г3, Р1_С4__ГР__Г6,
    Р1_С4__ГР1_Г2,
    Р1_С4__ГР2_Г2, Р1_С4__ГР2_Г3, Р1_С4__ГР2_Г6,
    Р1_С4__ГР3_Г2, Р1_С4__ГР3_Г3, Р1_С4__ГР3_Г6,
    Р1_С4__ГР4_Г2, Р1_С4__ГР4_Г3, Р1_С4__ГР4_Г6,
    Р1_С4__ГР5_Г2, Р1_С4__ГР5_Г3, Р1_С4__ГР5_Г6,
    Р1_С5__ГР__Г2, Р1_С5__ГР__Г3, Р1_С5__ГР__Г6,
    Р1_С5__ГР1_Г2,
    Р1_С5__ГР2_Г2, Р1_С5__ГР2_Г3, Р1_С5__ГР2_Г6,
    Р1_С5__ГР3_Г2, Р1_С5__ГР3_Г3, Р1_С5__ГР3_Г6,
    Р1_С5__ГР4_Г2, Р1_С5__ГР4_Г3, Р1_С5__ГР4_Г6,
    Р1_С5__ГР5_Г2, Р1_С5__ГР5_Г3, Р1_С5__ГР5_Г6,
    Р1_С6__ГР__Г2, Р1_С6__ГР__Г3, Р1_С6__ГР__Г6,
    Р1_С6__ГР1_Г2,
    Р1_С6__ГР2_Г2, Р1_С6__ГР2_Г3, Р1_С6__ГР2_Г6,
    Р1_С6__ГР3_Г2, Р1_С6__ГР3_Г3, Р1_С6__ГР3_Г6,
    Р1_С6__ГР4_Г2, Р1_С6__ГР4_Г3, Р1_С6__ГР4_Г6,
    Р1_С6__ГР5_Г2, Р1_С6__ГР5_Г3, Р1_С6__ГР5_Г6,
    Р1_С7__ГР__Г2, Р1_С7__ГР__Г3, Р1_С7__ГР__Г6,
    Р1_С7__ГР1_Г2,
    Р1_С7__ГР2_Г2, Р1_С7__ГР2_Г3, Р1_С7__ГР2_Г4, Р1_С7__ГР2_Г5, Р1_С7__ГР2_Г6,
    Р1_С7__ГР3_Г2, Р1_С7__ГР3_Г3, Р1_С7__ГР3_Г4, Р1_С7__ГР3_Г5, Р1_С7__ГР3_Г6,
    Р1_С7__ГР4_Г2, Р1_С7__ГР4_Г3, Р1_С7__ГР4_Г4, Р1_С7__ГР4_Г5, Р1_С7__ГР4_Г6,
    Р1_С7__ГР5_Г2, Р1_С7__ГР5_Г3, Р1_С7__ГР5_Г4, Р1_С7__ГР5_Г5, Р1_С7__ГР5_Г6,
    Р1_С8__ГР__Г2, Р1_С8__ГР__Г3, Р1_С8__ГР__Г6,
    Р1_С8__ГР1_Г2,
    Р1_С8__ГР2_Г2, Р1_С8__ГР2_Г3, Р1_С8__ГР2_Г6,
    Р1_С8__ГР3_Г2, Р1_С8__ГР3_Г3, Р1_С8__ГР3_Г6,
    Р1_С8__ГР4_Г2, Р1_С8__ГР4_Г3, Р1_С8__ГР4_Г6,
    Р1_С8__ГР5_Г2, Р1_С8__ГР5_Г3, Р1_С8__ГР5_Г6,
    Р1_С9__ГР__Г2, Р1_С9__ГР__Г3, Р1_С9__ГР__Г6,
    Р1_С9__ГР1_Г2,
    Р1_С9__ГР2_Г2, Р1_С9__ГР2_Г3, Р1_С9__ГР2_Г6,
    Р1_С9__ГР3_Г2, Р1_С9__ГР3_Г3, Р1_С9__ГР3_Г6,
    Р1_С9__ГР4_Г2, Р1_С9__ГР4_Г3, Р1_С9__ГР4_Г6,
    Р1_С9__ГР5_Г2, Р1_С9__ГР5_Г3, Р1_С9__ГР5_Г6,
    Р1_С10_ГР__Г2, Р1_С10_ГР__Г3, Р1_С10_ГР__Г6,
    Р1_С10_ГР1_Г2,
    Р1_С10_ГР2_Г2, Р1_С10_ГР2_Г3, Р1_С10_ГР2_Г6,
    Р1_С10_ГР3_Г2, Р1_С10_ГР3_Г3, Р1_С10_ГР3_Г6,
    Р1_С10_ГР4_Г2, Р1_С10_ГР4_Г3, Р1_С10_ГР4_Г6,
    Р1_С10_ГР5_Г2, Р1_С10_ГР5_Г3, Р1_С10_ГР5_Г6;

private const X = "X";

private var RepTable = CTableReport;

/* Проверяет, пуст ли 1 раздел */
private MACRO IsEmptyIssue1()
  const FormID = НайтиИдентификаторОтчетаПоНазванию({Название отчета});
  var rs = SQL_ExecuteAndGetRs(
        "SELECT count(*) FROM dcy_varsd_dbt var, dcy_mreal_dbt val"
      + " WHERE var.T_IFORMID = val.T_IFORMID"
      + " AND var.T_IVARID = val.T_IVARID"
      + " AND var.T_IFORMID = " + FormID
      + " AND val.T_BDREPDATE = " + GetSQLDate(ДатаОтчета)
      + " AND val.T_INUMDPRT = " + НомерПодразделения
      + " AND val.T_MEAN2 <> 0"
      + " AND substr(var.T_SZVARNAME, 1, 2) = 'Р1'");
  rs.moveNext();
  if (rs.Value(0) == 0)
    return true;
  end;

  return false;
END;

/* Заголовок 1 раздела */
private MACRO PrintHeader1()
if (ДатаОтчета < Дата1_1660У)
[┌─────────────────────────────────────────────┬───────────────┬───────────────────────────────────────────────────────────────┐];
[│        Элементы расчетной базы              │ Распределение │                  Резерв на возможные потери                   │];
[│                                             │   элементов   ├───────────────┬───────────────┬───────────────┬───────────────┤];
else
[┌─────────────────────────────────────────────┬───────────────┬───────────────────────────────────────────────────────────────┐];
[│        Элементы расчетной базы              │ Распределение │                  Резерв на возможные потери                   │];
[│      резерва на возможные потери            │   элементов   ├───────────────┬───────────────┬───────────────┬───────────────┤];
end;
[│                                             │   расчетной   │   расчетный   │    размер     │   расчетный,  │ сформированный│];
[│                                             │    базы по    │               │  обеспечения  │   скорректи-  │               │];
[│                                             │   категориям  │               │               │  рованный на  │               │];
[│                                             │    качества   │               │               │     сумму     │               │];
[│                                             │               │               │               │  обеспечения  │               │];
[├─────────────────────────────────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┤];
[│                    1                        │      2        │       3       │       4       │      5        │       6       │];
[├─────────────────────────────────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┤];
END;

/* Вывод одной строки (в терминах таблицы) */
/* Выводим деньги в виде целых чисел, чтобы получилась требуемая точность */
private MACRO PrintLine()
  var arr = TArray;
  var i = 0;
  
  while(GetParm(i, arr[i]))
    if (ValType(arr[i]) != V_STRING)
      arr[i] = Int(arr[i]);
    end;
    i = i+1;
  end;
  arr.size = arr.size - 1;
  
  RepTable.PrintSeparator();
  RepTable.PrintStringTransferByWord(arr);
END;

MACRO PrintIssue1()
  var i;

  println();
  println(StrAlign("Раздел 1", Issue1Width, STR_ALIGN_CENTER));
  println();
  if (IsIssue1Empty)
    println("Данные отсутствуют");
    return;
  end;


  message("Чтение значений переменных 1 раздела");
  if (not ПрочитатьЗначенияПеременных(1))
    exit(1);
  end;

  message("Вывод 1 раздела");

  PrintHeader1();

  RepTable.AddColumn(1, 43, AL_LEFT);
  i = 2;
  while(i <= 6)
    RepTable.AddColumn(i, 13, AL_RIGHT);
    i = i+1;
  end;
  
  PrintLine("1. Вложения в ценные бумаги", 
                                     Р1_С1__ГР__Г2, Р1_С1__ГР__Г3, X, X, Р1_С1__ГР__Г6);
  PrintLine("из них: 1-я - 0%     ", Р1_С1__ГР1_Г2,             X, X, X,             X);    
  PrintLine("        2-я - 1-20%  ", Р1_С1__ГР2_Г2, Р1_С1__ГР2_Г3, X, X, Р1_С1__ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С1__ГР3_Г2, Р1_С1__ГР3_Г3, X, X, Р1_С1__ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С1__ГР4_Г2, Р1_С1__ГР4_Г3, X, X, Р1_С1__ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С1__ГР5_Г2, Р1_С1__ГР5_Г3, X, X, Р1_С1__ГР5_Г6);

  PrintLine("2. Средства, размещенные на корреспондентских счетах", 
                                     Р1_С2__ГР__Г2, Р1_С2__ГР__Г3, X, X, Р1_С2__ГР__Г6);
  PrintLine("из них: 1-я - 0%     ", Р1_С2__ГР1_Г2,             X, X, X,             X);    
  PrintLine("        2-я - 1-20%  ", Р1_С2__ГР2_Г2, Р1_С2__ГР2_Г3, X, X, Р1_С2__ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С2__ГР3_Г2, Р1_С2__ГР3_Г3, X, X, Р1_С2__ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С2__ГР4_Г2, Р1_С2__ГР4_Г3, X, X, Р1_С2__ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С2__ГР5_Г2, Р1_С2__ГР5_Г3, X, X, Р1_С2__ГР5_Г6);

  PrintLine("3. Требования кредитной организации по прочим операциям", 
                                     Р1_С3__ГР__Г2, Р1_С3__ГР__Г3, X, X, Р1_С3__ГР__Г6);
  PrintLine("из них: 1-я - 0%     ", Р1_С3__ГР1_Г2,             X, X, X,             X);    
  PrintLine("        2-я - 1-20%  ", Р1_С3__ГР2_Г2, Р1_С3__ГР2_Г3, X, X, Р1_С3__ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С3__ГР3_Г2, Р1_С3__ГР3_Г3, X, X, Р1_С3__ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С3__ГР4_Г2, Р1_С3__ГР4_Г3, X, X, Р1_С3__ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С3__ГР5_Г2, Р1_С3__ГР5_Г3, X, X, Р1_С3__ГР5_Г6);

  PrintLine("4. Прочие финансово-хозяйственные операции кредитной организации", 
                                     Р1_С4__ГР__Г2, Р1_С4__ГР__Г3, X, X, Р1_С4__ГР__Г6);
  PrintLine("из них: 1-я - 0%     ", Р1_С4__ГР1_Г2,             X, X, X,             X);    
  PrintLine("        2-я - 1-20%  ", Р1_С4__ГР2_Г2, Р1_С4__ГР2_Г3, X, X, Р1_С4__ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С4__ГР3_Г2, Р1_С4__ГР3_Г3, X, X, Р1_С4__ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С4__ГР4_Г2, Р1_С4__ГР4_Г3, X, X, Р1_С4__ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С4__ГР5_Г2, Р1_С4__ГР5_Г3, X, X, Р1_С4__ГР5_Г6);

  PrintLine("5. Прочее участие", 
                                     Р1_С5__ГР__Г2, Р1_С5__ГР__Г3, X, X, Р1_С5__ГР__Г6);
  PrintLine("из них: 1-я - 0%     ", Р1_С5__ГР1_Г2,             X, X, X,             X);    
  PrintLine("        2-я - 1-20%  ", Р1_С5__ГР2_Г2, Р1_С5__ГР2_Г3, X, X, Р1_С5__ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С5__ГР3_Г2, Р1_С5__ГР3_Г3, X, X, Р1_С5__ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С5__ГР4_Г2, Р1_С5__ГР4_Г3, X, X, Р1_С5__ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С5__ГР5_Г2, Р1_С5__ГР5_Г3, X, X, Р1_С5__ГР5_Г6);

  PrintLine("6. Активы, переданные в доверительное управление", 
                                     Р1_С6__ГР__Г2, Р1_С6__ГР__Г3, X, X, Р1_С6__ГР__Г6);
  PrintLine("из них: 1-я - 0%     ", Р1_С6__ГР1_Г2,             X, X, X,             X);    
  PrintLine("        2-я - 1-20%  ", Р1_С6__ГР2_Г2, Р1_С6__ГР2_Г3, X, X, Р1_С6__ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С6__ГР3_Г2, Р1_С6__ГР3_Г3, X, X, Р1_С6__ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С6__ГР4_Г2, Р1_С6__ГР4_Г3, X, X, Р1_С6__ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С6__ГР5_Г2, Р1_С6__ГР5_Г3, X, X, Р1_С6__ГР5_Г6);

  if(ДатаОтчета < Дата1_1660У)
   PrintLine("7. Резерв по условным обязательствам кредитного характера", 
                                     Р1_С7__ГР__Г2, Р1_С7__ГР__Г3,             X,             X, Р1_С7__ГР__Г6);
  else
   PrintLine("7. Условные обязательства кредитного характера", 
                                     Р1_С7__ГР__Г2, Р1_С7__ГР__Г3,             X,             X, Р1_С7__ГР__Г6);
  end;

  PrintLine("из них: 1-я - 0%     ", Р1_С7__ГР1_Г2,             X,             X,             X,             X);
  PrintLine("        2-я - 1-20%  ", Р1_С7__ГР2_Г2, Р1_С7__ГР2_Г3, Р1_С7__ГР2_Г4, Р1_С7__ГР2_Г5, Р1_С7__ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С7__ГР3_Г2, Р1_С7__ГР3_Г3, Р1_С7__ГР3_Г4, Р1_С7__ГР3_Г5, Р1_С7__ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С7__ГР4_Г2, Р1_С7__ГР4_Г3, Р1_С7__ГР4_Г4, Р1_С7__ГР4_Г5, Р1_С7__ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С7__ГР5_Г2, Р1_С7__ГР5_Г3, Р1_С7__ГР5_Г4, Р1_С7__ГР5_Г5, Р1_С7__ГР5_Г6);

  if(ДатаОтчета < Дата1_1660У)
   PrintLine("8. Резерв по срочным сделкам", 
                                     Р1_С8__ГР__Г2, Р1_С8__ГР__Г3, X, X, Р1_С8__ГР__Г6);
  else
   PrintLine("8. Срочные сделки", 
                                     Р1_С8__ГР__Г2, Р1_С8__ГР__Г3, X, X, Р1_С8__ГР__Г6);
  end;

  PrintLine("из них: 1-я - 0%     ", Р1_С8__ГР1_Г2,             X, X, X,             X);    
  PrintLine("        2-я - 1-20%  ", Р1_С8__ГР2_Г2, Р1_С8__ГР2_Г3, X, X, Р1_С8__ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С8__ГР3_Г2, Р1_С8__ГР3_Г3, X, X, Р1_С8__ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С8__ГР4_Г2, Р1_С8__ГР4_Г3, X, X, Р1_С8__ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С8__ГР5_Г2, Р1_С8__ГР5_Г3, X, X, Р1_С8__ГР5_Г6);

  if(ДатаОтчета < Дата1_1660У)
   PrintLine("9. Резерв под прочие потери", 
                                     Р1_С9__ГР__Г2, Р1_С9__ГР__Г3, X, X, Р1_С9__ГР__Г6);
  else
   PrintLine("9. Прочие потери", 
                                     Р1_С9__ГР__Г2, Р1_С9__ГР__Г3, X, X, Р1_С9__ГР__Г6);
  end;

  PrintLine("из них: 1-я - 0%     ", Р1_С9__ГР1_Г2,             X, X, X,             X);    
  PrintLine("        2-я - 1-20%  ", Р1_С9__ГР2_Г2, Р1_С9__ГР2_Г3, X, X, Р1_С9__ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С9__ГР3_Г2, Р1_С9__ГР3_Г3, X, X, Р1_С9__ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С9__ГР4_Г2, Р1_С9__ГР4_Г3, X, X, Р1_С9__ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С9__ГР5_Г2, Р1_С9__ГР5_Г3, X, X, Р1_С9__ГР5_Г6);

  if(ДатаОтчета < Дата1_1660У)
    PrintLine("10. Резерв под иные финансовые инструменты", 
                                     Р1_С10_ГР__Г2, Р1_С10_ГР__Г3, X, X, Р1_С10_ГР__Г6);
  else
    PrintLine("10. Иные финансовые инструменты", 
                                     Р1_С10_ГР__Г2, Р1_С10_ГР__Г3, X, X, Р1_С10_ГР__Г6);
  end;

  PrintLine("из них: 1-я - 0%     ", Р1_С10_ГР1_Г2,             X, X, X,             X);    
  PrintLine("        2-я - 1-20%  ", Р1_С10_ГР2_Г2, Р1_С10_ГР2_Г3, X, X, Р1_С10_ГР2_Г6);
  PrintLine("        3-я - 21-50% ", Р1_С10_ГР3_Г2, Р1_С10_ГР3_Г3, X, X, Р1_С10_ГР3_Г6);
  PrintLine("        4-я - 51-100%", Р1_С10_ГР4_Г2, Р1_С10_ГР4_Г3, X, X, Р1_С10_ГР4_Г6);
  PrintLine("        5-я - 100%   ", Р1_С10_ГР5_Г2, Р1_С10_ГР5_Г3, X, X, Р1_С10_ГР5_Г6);
  
  RepTable.PrintBottom();
END;

/* Инициализация */
IsIssue1Empty = IsEmptyIssue1();
if (IsIssue1Empty)
  Issue1Width = Issue2Width;
end;
