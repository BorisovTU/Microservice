/*
$Name:          f401Interface.mac
$Module:        Отчеты ЦБ
$Description:   Форма 401. Доступ к операциям формы.
*/

import f401import;

/**
 *  Запуск операции расчета отчета
 */
macro calculate()
    var profiler;
    if (TF401Settings().isUseSqlProfilerDuringCalculation())
        profiler = TSqlProfiler(getTxtFileName("!f401CalculationProfile"));
        profiler.clear();
        profiler.on();
    end;
    objectFactoryInstance.createReportCalculateController().calculate();
end;

/**
 *  Запуск операции нормализации
 */
macro normalize()
    var profiler;
    if (TF401Settings().isUseSqlProfilerDuringNormalization())
        profiler = TSqlProfiler(getTxtFileName("!f401NormalizationProfile"));
        profiler.clear();
        profiler.on();
    end;
    objectFactoryInstance.createNormalizationController().execute();
    RcbApplication().transactionManager.commit();
end;

/**
 *  Запуск операции пересчета после свода
 */
macro recalculateAfterSummation()
    var profiler;
    if (TF401Settings().isUseSqlProfilerDuringRecalculation())
        profiler = TSqlProfiler(getTxtFileName("!f401RecalculationProfile"));
        profiler.clear();
        profiler.on();
    end;
    objectFactoryInstance.createReportRecalculateController().calculate();
    RcbApplication().transactionManager.commit();
end;

/**
 *  Запуск операции печати отчета в plain text
 */
macro printReport()
    objectFactoryInstance.createReportPrintController().print("txt");
end;

/**
 *  Запуск операции печати отчета в excel
 */
macro printReportExcel()
    objectFactoryInstance.createReportPrintController(WINREP_FORMAT_XLSX).print("xls");
end;

/**
 *  Запуск операции экспорта в kliko.exe
 */
macro exportToKliko()
    objectFactoryInstance.createExportKlikoController().execute();
end;

/**
 *  Запуск операции экспорта в БИСквит в тысячах
 */
macro exportToBiskvitT()
    objectFactoryInstance.createExportBiskvitScaledController().execute(false);
end;

/**
 *  Операция печати протокола экспорта в БИСквит
 */
macro showProtocolBiskvitExport()
    showProtocol("-kind:8 -desc:\"ПРОТОКОЛ ЭКСПОРТА В БИСквит В ЕДИНИЦАХ ВАЛЮТЫ\" \"ПРОТОКОЛ ЭКСПОРТА В БИСквит В ТЫСЯЧАХ ЕДИНИЦ ВАЛЮТЫ\"");
end;

установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
