/*
$Name:          f664ProtocolViewIssue1.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 664. Протокол 1 раздела
*/

/**
 * Форма 664. Протокол 1 раздела.
 *
 * @since   03.10.2012
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

/**
 * Класс протокола.
 */
class (TProtocolView_2867) TProtocolViewIssue1_2867()

    private var m_mainTableWidth;
    private var m_accountsTableWidth;
    private var m_wrongCodeTableWidth;

    macro constructorTProtocolViewIssue1_2867()
        initTProtocolView_2867();
        m_mainTableWidth      = 110;
        m_accountsTableWidth  = 77;
        m_wrongCodeTableWidth = 128;
    end;

    macro getAccountsTableWidth()
        return m_accountsTableWidth;
    end;

    macro getWrongCodeTableWidth()
        return m_wrongCodeTableWidth;
    end;

    macro getMainTableWidth()
        return m_mainTableWidth;
    end;

    macro printIssueHeader()
        println();
        println();
        println("РАЗДЕЛ 1");
        println();
    end;

    macro printTurnsHeader(currency)
        defaultParm(currency, "любая");

        println("Валюта счета: ", currency);
        println("┌──────────┬──────────┬──────────────────────┬──────────┬───────────────────────────┬───────────────────────────┬─────────────────┐");
        println("│Код опер. │Код опер. │     Сумма в валюте   │   Дата   │        Счет по дебету     │      Счет по кредиту      │   № документа   │");
        println("│в отчете  │в платеже │          счета       │   док    │                           │                           │                 │");
        println("└──────────┴──────────┴──────────────────────┴──────────┴───────────────────────────┴───────────────────────────┴─────────────────┘");
    end;

    macro printCurrencyFooter(directionOverall)
        [ ##########            #####################  ]("ИТОГО":r, directionOverall);
        println();
    end;

    macro printDirectionHeader(directionCode)
        var directionStr;

        if (directionCode == DEBIT)
            directionStr = "Списание";
        else
            directionStr = "Зачисление";
        end;

        [ ########## ](directionStr:l);
    end;

    macro printDirectionFooter(currentDirection, directionOverall)
        var directionStr;

        if (currentDirection == DEBIT)
            directionStr = "ВСЕГО СПИС";
        else
            directionStr = "ВСЕГО ЗАЧ";
        end;

        [ ##########            #####################  ](directionStr:l, directionOverall);
        println();
    end;

    macro printOperationFooter(operationOverall)
        [ ##########            #####################  ]("ИТОГО":r, operationOverall);
        println();
    end;

    macro printNoData(width)
        println(strAlign(EMPTY_DATA, width, STR_ALIGN_CENTER));
        println();
    end;

    macro printAccountsWithoutTurnsHeader()
        println();
        println("Лицевые счета, по которым в отчетный период не было оборотов, но были остатки:");
        println("┌───────────────────────────┬───────────────────────┬───────────────────────┐");
        println("│       Номер л/с           │   Остаток на начало   │   Остаток на конец    │");
        println("│                           │        периода        │        периода        │");
        println("└───────────────────────────┴───────────────────────┴───────────────────────┘");
    end;

    macro printRowAccountsWithoutTurns(dataSource)
        [  #########################   #####################   ###################### ]
        (  dataSource.accountNumber,   dataSource.restIn,      dataSource.restOut);
    end;

    macro printRowTurns(dataSource)
        var operationCodeOrig = ternary(   (dataSource.operationCodeOrig == dataSource.operationCode)
                                        or (dataSource.operationCodeOrig == "Не задан"), dataSource.operationCodeOrig, "!" + dataSource.operationCodeOrig);

        [ ########## ########## #####################  ##########  #########################   #########################   ############### ]
        (dataSource.operationCode:r,
                     operationCodeOrig:r,
                                dataSource.sum,
                                                       dataSource.dateCarry:f,
                                                                   dataSource.accountPayer,    dataSource.accountReceiver,
                                                                                                                           dataSource.numberDocument:l/*, dataSource.currency*/);
    end;

    constructorTProtocolViewIssue1_2867();
end;
