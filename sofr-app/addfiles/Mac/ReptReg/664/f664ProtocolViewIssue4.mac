/*
$Name:          f664ProtocolViewIssue4.mac
$Module:        Регламентируемая отчетность
$Description:   Форма 664. Протокол 4 раздела
*/

/**
 * Форма 664. Протокол 4 раздела.
 *
 * @since   03.10.2012
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */


/**
 * Класс протокола.
 */
class (TProtocolView_2867) TProtocolViewIssue4_2867()

    private var m_tableWidth;
    private var m_accountsTableWidth;
    private var m_wrongCodeTableWidth;

    macro printTableHeader()
        println("┌───────────────────────────────────┬──────────┬──────────┬──────────┬──────────────────────┬──────────┬─────────────────┬─────────────────────────┬─────────────────────────┬───────────────────────────────────┐");
        println("│                                   │Код страны│Код опер. │Код опер. │  Сумма в рублях РФ   │   Дата   │   № документа   │      Счет по дебету     │     Счет по кредиту     │             Нерезидент -          │");
        println("│                                   │ нерезид. │в отчете  │в платеже │                      │документа │                 │                         │                         │           владелец счета          │");
        println("└───────────────────────────────────┴──────────┴──────────┴──────────┴──────────────────────┴──────────┴─────────────────┴─────────────────────────┴─────────────────────────┴───────────────────────────────────┘");
    end;

    macro printTableFooter()
        println();
    end;

    macro printRowTable(dataSource)
        var operationCodeOrig = ternary(   (dataSource.operationCodeOrig == dataSource.operationCode)
                                        or (dataSource.operationCodeOrig == "Не задан"), dataSource.operationCodeOrig, "!" + dataSource.operationCodeOrig);
        var errorMessage = ternary(dataSource.countryCode == "997", "! Не задан код страны нерезидента", "");
        var countryCode  = ternary(dataSource.countryCode != "997", dataSource.countryCode, "-");

        [  #################################     ###     ########## ########## ###################### ##########  ################  ######################### ######################### ################################### ]
        (  errorMessage,
                                                 countryCode:c,
                                                         dataSource.operationCode:r,
                                                                    operationCodeOrig:r,
                                                                               dataSource.sum,        dataSource.dateCarry:f,
                                                                                                                  dataSource.numberDocument:l,
                                                                                                                                   dataSource.accountPayer,  dataSource.accountReceiver,
                                                                                                                                                                                       dataSource.clientCodeAndName:w);
    end;

    macro getTableWidth()
        return m_tableWidth;
    end;

    macro getAccountsTableWidth()
        return m_accountsTableWidth;
    end;

    macro getWrongCodeTableWidth()
        return m_wrongCodeTableWidth;
    end;

    macro printIssueHeader()
        println();
        println("РАЗДЕЛ 4");
        println();
    end;

    macro printAccountKindHeader(accountKind)
        defaultParm(accountKind, "любой");

        println("Вид счета: ", accountKind);
    end;

    macro printAccountKindFooter()
    end;

    macro printDirectionHeader(directionCode)
        var directionStr;

        if (directionCode == DEBIT)
            directionStr = "Списание";
        else
            directionStr = "Зачисление";
        end;

        [ ########## ](directionStr:l);
    end;

    macro printDirectionFooter(currentDirection, directionOverall)
        var directionStr;

        if (currentDirection == DEBIT)
            directionStr = "ВСЕГО СПИС";
            [ ##########            #####################  ](directionStr:l, directionOverall);
        else
            directionStr = "ВСЕГО ЗАЧ";
            [ ##########                                                            #####################  ](directionStr:l, directionOverall);
        end;

        println();
    end;

    macro printCountryFooter()
    end;

    macro printOperationFooter()
    end;

    macro printNoData(width)
            println(strAlign(EMPTY_DATA, width, STR_ALIGN_CENTER));
            println();
    end;

    macro printTurnsWithWrongCodeHeader()
        println("Внимание! Разделы 3 и 4: для перечисленных ниже платежей по списанию не задан код валютной операции, либо задан неверно. Платежи не включены в отчет");
    end;

    macro printTurnsWithWrongCodeTableHeader()
        println("┌─────────┬──────────┬──────────────────────┬──────────┬───────────────────────────┬───────────────────────────┬─────────────────┐");
        println("│   Код   │Код опер. │       Сумма          │   Дата   │      Счет по дебету       │      Счет по кредиту      │   № документа   │");
        println("│  страны │в платеже │      платежа         │ платежа  │                           │                           │                 │");
        println("└─────────┴──────────┴──────────────────────┴──────────┴───────────────────────────┴───────────────────────────┴─────────────────┘");
    end;

    macro printRowTurnsWithWrongCode(dataSource)
        [  #######  ########## ###################### ########## ########################### ########################### ###############]
        (
           dataSource.countryCode:c,
                    dataSource.operationCodeOrig:r,
                               dataSource.sum,
                                                      dataSource.dateCarry:f,
                                                                 dataSource.accountPayer,
                                                                                             dataSource.accountReceiver,
                                                                                                                         dataSource.numberDocument);
    end;

    macro constructorTProtocolViewIssue4_2867()
        initTProtocolView_2867();
        m_accountsTableWidth = 77;
        m_wrongCodeTableWidth = 121;
        m_tableWidth = 161;
    end;

    constructorTProtocolViewIssue4_2867();
end;
