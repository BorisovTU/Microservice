/**
 * Форма 664. Контроллер протокола расчета.
 *
 * @since   03.10.2012
 * @author  Kirin Pavel
 * @version 6.00.020.31
 */

/**
 * Класс протокола, базовый
 */
class TCalculateProtocolView_2867()

    private var m_protocol;
    private var m_lastOutput;

    macro constructorTCalculateProtocolView_2867(accountKind, tempTableName)
        m_protocol = TProtocolView_2867();
        m_lastOutput = "";
    end;

    macro create()
        var oldOutput;
        oldOutput = setOutput(m_protocol.getFileName());
        m_protocol.printHead();
        setOutput(oldOutput, true);
    end;

    macro switchOutput()
        if (m_lastOutput != "")
            setOutput(m_lastOutput, true);
            m_lastOutput = "";
        else
            m_lastOutput = setOutput(m_protocol.getFileName(), true);
        end;
    end;

    macro view()
        viewFileLog(m_protocol.getFileName());
    end;

    macro isOperationCodeExists()
        return  "EXISTS (SELECT dllvalues.t_element t_element"
       + "\n" + "          FROM dvoopkind_dbt voop, dllvalues_dbt dllvalues"
       + "\n" + "        WHERE voop.t_list = " + RCB_OBJTYPE_PURPOSE117 + " AND dllvalues.t_list = voop.t_list" // RCB_OBJTYPE_PURPOSE117 - номер справочника КВО
       + "\n" + "          AND voop.t_element = dllvalues.t_element AND t_operationCode = dllvalues.t_code"
       + "\n" + "          AND t_operationCode != '00000' AND t_operationCode != '00012' AND t_operationCode != '00034'"
       + "\n" + "        )"
    end;

    constructorTCalculateProtocolView_2867();
end;
