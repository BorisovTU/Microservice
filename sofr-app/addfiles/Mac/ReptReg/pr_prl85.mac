/*───────────────────────────────────────────────────────────────────────────┐
  RS-Bank V6                                                  R-Style Softlab
  Файл подсистемы "Регламентируемая отчетность"

  Печать приложения 8. Глава 5.

  Создан: 23.05.2005
    08.08.2005 SCR 71874 Более строгий инструмент ( см. 71910 )
└───────────────────────────────────────────────────────────────────────────*/
import pr_PRL8;

private const PRINT_ZERO_D_REGPATH = "REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/ПЕЧАТЬ НУЛЕЙ ПО ГЛАВЕ Д";

class (RRG_PRL8_Report) RRG_PRL8_Report5()

    private var m_UnusedCol : String;

    private var m_precision;

    getRegistryValue("REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/ТОЧНОСТЬ ДЛЯ ГЛАВЫ Д", V_INTEGER,  m_precision, null); 

    /* Не печатать заголовок раздела */
    macro PrintHeadPartition( Parm: RRG_PRL8_Parm, Balance )
    end;

    /* Не печатать итог по разделу */
    macro PrintPartitionItog( Parm : RRG_PRL8_Parm, Itog  )
    end;

    /* Не печатать заголовок по счету 1-ого порядка */
    macro PrintHeadLevel1Balance( Parm : RRG_PRL8_Parm, level1Balance )
    end;

    /* Не печатать итог по счету 1-ого порядка */
    macro PrintLevel1BalanceItog( Parm: RRG_PRL8_Parm, Itog  )
    end;

    macro Pr( value )
        return execExp("String(value:0:" + m_precision + ")");
    end;

    macro createBalance(dataSet)
        return RRG_PRL85_Balance(dataSet);
    end;

    macro ProcessBalance( Balance, Parm : RRG_PRL8_Parm, level2Itog , level1Itog , partitionItog  )
        ProcessLevel2Balance( Balance, Parm, level2Itog, level1Itog, partitionItog );

        m_tableReport.PrintStringTransferByWord
        ( m_UnusedCol, balance.Balance(), balance.BalanceName(),                                                                               
                                                       Pr( Balance.Sums()[RRG_IS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Balance.Sums()[RRG_DS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Balance.Sums()[RRG_CS], Parm ),
                                                       Pr( Balance.Sums()[RRG_OS], Parm )
        );
    end;

    macro PrintItogActive( Parm : RRG_PRL8_Parm, Itog  )
        [#]( RRG_PRL8_MakeString( " Итого по активу:" ) );
        m_tableReport.PrintStringTransferByWord
        ( "", "", "",                                                                               


                                                       Pr( Itog.Sums()[RRG_IS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_DS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_CS], Parm ),
                                                       Pr( Itog.Sums()[RRG_OS], Parm )
        );
        PrintSeparator();        
    end;

    macro PrintItogPassive( Parm : RRG_PRL8_Parm, Itog  )
        [#]( RRG_PRL8_MakeString( " Итого по пассиву:" ) );
        m_tableReport.PrintStringTransferByWord
        ( "", "", "",                                                                               

                                                       Pr( Itog.Sums()[RRG_IS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_DS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_CS], Parm ),
                                                       Pr( Itog.Sums()[RRG_OS], Parm )
        );

        PrintSeparator();        
    end;

    macro PrintAllTurnsItog( Parm : RRG_PRL8_Parm, Itog  )
        m_tableReport.PrintFreeString( " ВСЕГО ОБОРОТОВ " );
        m_tableReport.PrintStringTransferByWord( "", "", "", "", 
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_DS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_CS], Parm )
                                               );
        PrintSeparator();
    end;


    private 
    macro Constructor()
        InitRRG_PRL8_Report();

        var type = V_UNDEF,
            err  = 0,
            val  = false;

        type = GetRegistryValue( PRINT_ZERO_D_REGPATH, V_BOOL, val, err );
        if ( (err == 0) and (type == V_BOOL) )
            if ( val )
                m_UnusedCol = Pr(0.0);
            else
                m_UnusedCol = " ";
            end;
        end;
    end;

    Constructor();
end;

class (RRG_PRL8_Report_Spod) RRG_PRL8_Report5Spod()

    private var m_UnusedCol : String;

    private var m_precision;

    getRegistryValue("REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/ТОЧНОСТЬ ДЛЯ ГЛАВЫ Д", V_INTEGER,  m_precision, null); 

    private macro printSpod( Parm : RRG_PRL8_Parm, Itog, shouldPrintZero)
        defaultParm(shouldPrintZero, true);
        
        if (isPrindSpod(Parm.periodKind, shouldPrintZero, itog))
            m_tableReport.PrintFreeString(" В том числе СПОД:");

            m_tableReport.PrintStringTransferByWord( "",
                                                     "", 
                                                     "",
                                                     "",
                             m_UnusedCol, m_UnusedCol, Pr( Itog.spodSums()[RRG_DS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.spodSums()[RRG_CS], Parm ),
                                                     ""
                                                    );
        end;
    end;

    /* Не печатать заголовок раздела */
    macro PrintHeadPartition( Parm: RRG_PRL8_Parm, Balance )
    end;

    /* Не печатать итог по разделу */
    macro PrintPartitionItog( Parm : RRG_PRL8_Parm, Itog  )
    end;

    /* Не печатать заголовок по счету 1-ого порядка */
    macro PrintHeadLevel1Balance( Parm : RRG_PRL8_Parm, level1Balance )
    end;

    /* Не печатать итог по счету 1-ого порядка */
    macro PrintLevel1BalanceItog( Parm: RRG_PRL8_Parm, Itog  )
    end;

    macro Pr( value )
        return execExp("String(value:0:" + m_precision + ")");
    end;

    macro ProcessBalance( Balance, Parm : RRG_PRL8_Parm, level2Itog , level1Itog , partitionItog  )
        ProcessLevel2Balance( Balance, Parm, level2Itog, level1Itog, partitionItog );

        m_tableReport.PrintStringTransferByWord
        ( m_UnusedCol, balance.Balance(), balance.BalanceName(),                                                                               
                                                       Pr( Balance.Sums()[RRG_IS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Balance.Sums()[RRG_DS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Balance.Sums()[RRG_CS], Parm ),
                                                       Pr( Balance.Sums()[RRG_OS], Parm )
        );

    end;

    macro PrintItogActive( Parm : RRG_PRL8_Parm, Itog  )
        [#]( RRG_PRL8_MakeString( " Итого по активу:" ) );
        m_tableReport.PrintStringTransferByWord
        ( "", "", "",                                                                               


                                                       Pr( Itog.Sums()[RRG_IS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_DS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_CS], Parm ),
                                                       Pr( Itog.Sums()[RRG_OS], Parm )
        );

        printSpod( RRG_PRL8_Parm, Itog);
  
        PrintSeparator();        
    end;

    macro PrintItogPassive( Parm : RRG_PRL8_Parm, Itog  )
        [#]( RRG_PRL8_MakeString( " Итого по пассиву:" ) );
        m_tableReport.PrintStringTransferByWord
        ( "", "", "",                                                                               

                                                       Pr( Itog.Sums()[RRG_IS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_DS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_CS], Parm ),
                                                       Pr( Itog.Sums()[RRG_OS], Parm )
        );

        printSpod( RRG_PRL8_Parm, Itog);

        PrintSeparator();        
    end;

    macro PrintAllTurnsItog( Parm : RRG_PRL8_Parm, Itog  )
        m_tableReport.PrintFreeString( " ВСЕГО ОБОРОТОВ " );
        m_tableReport.PrintStringTransferByWord( "", "", "", "", 
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_DS], Parm ),
                             m_UnusedCol, m_UnusedCol, Pr( Itog.Sums()[RRG_CS], Parm )
                                               );
        printSpod( RRG_PRL8_Parm, Itog);

        PrintSeparator();
    end;


    private 
    macro Constructor()
        InitRRG_PRL8_Report_Spod();

        var type = V_UNDEF,
            err  = 0,
            val  = false;

        type = GetRegistryValue( PRINT_ZERO_D_REGPATH, V_BOOL, val, err );
        if ( (err == 0) and (type == V_BOOL) )
            if ( val )
                m_UnusedCol = Pr(0.0);
            else
                m_UnusedCol = " ";
            end;
        end;
    end;

    Constructor();
end;

