/*─────────────────────────────────────────────────────────────────────────────────────────────────┐
  RS-Bank V6                                                                        R-Style Softlab
  Файл подсистемы "Регламентируемая отчетность"

  Расчет Формы 118 предварительные действия.
└─────────────────────────────────────────────────────────────────────────────────────────────────*/
import RcbCoreInter;
import ReptcbInter;
import cb_sql;

/**
 *  Удаление структурных значений
 */
private class TStructureAttributeEraser(attributeName : String)

    private var m_attributeName;

    macro erase()

        var i;

        var attributeValue = RcbApplication().currentReport.attributeValue(m_attributeName);

        var attributeValueIterator = attributeValue.createValueIterator();

        var valuesToRemove = TArray();

        attributeValueIterator.first();

        while (not attributeValueIterator.isDone())

            valuesToRemove[valuesToRemove.size] = attributeValueIterator.currentItem.valueId;

            attributeValueIterator.next();

        end;

        i = 0;
        while (i < valuesToRemove.size)
            attributeValue.removeValue(valuesToRemove[i]);
            i = i + 1;
        end;

        if (valuesToRemove.size > 0)
            RcbApplication().transactionManager.commit();
        end;

    end;

    local macro constructor(attributeName : String)
        m_attributeName = attributeName;
    end;

    constructor(attributeName);
end;

sql_truncate("df118_tmp");
sql_truncate("drcbcreditparts_tmp");

var i = 1;

RcbApplication().currentReport.attributeValue("Н6_ВерхнПредел").current = 25;

TStructureAttributeEraser("Ф118_итого").erase();

while (i < 21)
    if (i > 9)
        TStructureAttributeEraser("Ф118_строка_" + string(i)).erase();
    else
        TStructureAttributeEraser("Ф118_строка_0" + string(i)).erase();
    end;
    i = i + 1;
end;


установитьФлагВозврата(OK_MACRO_FLAG);
exit(1);
