/*
$Name: ctrlSvod_f251.mac
$Module: Отчеты ЦБ
$Description: Контроль перед сведением формы 251
*/

import Rep_lib, ReptCBInter;
import rcbimport;

private const DEPARTMENT  = 2;

private macro controlBeforeSummation()
    var currentReport = RcbApplication().currentReport;
    var organizationStructure = currentReport.context.organizationStructure;
    var context = RcbReportContext(currentReport.context.period, {numdprt}, DEPARTMENT, organizationStructure, false);
    var report  = RcbApplication().objectFactory.createReport(currentReport.form.id, context);
    
    var msgError = "Для формирования сводного отчета за период с " + currentReport.context.period.beginDate 
                                                          + " по " + currentReport.context.period.endDate  
                                                          + " отсутствует отчет по головному офису в режиме 'Филиал'.";

    if (report.isCalculated())
        rcbApplication.summator.printLogLine(msgError);
        установитьФлагВозврата(STOP_PROC_FLG);
        exit(1);
    end;

    установитьФлагВозврата( OK_MACRO_FLAG);
    exit(1);
end;