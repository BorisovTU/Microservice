import deprintr, OperCode;

record tmpDoc( "sbdepdoc.dbt" );

record ALG_DEPOSITOR( "depositr.dbt" );
record ALG_SBDEPDOC ( "sbdepdoc.dbt" );
record ALG_PARAM    ( "sb_algop.dbt" );

const
  UPDATE_ALL  = 1,
  UPDATE_DEP  = 2,
  UPDATE_DOC  = 4;

const
  OK_RES   =  0,  /* продолжать проводку */
  SKIP_RES =  1,  /* пропустить выполнение предопределенного модуля */
  END_RES  =  2,  /* завершить проводку */
  ERR_RES  = -1;  /* аваpийно завершить проводку */

const
  D_IN = 1,         /* Приход */
  D_OUT = 2,        /* Расход */
  D_GET = 3,        /* Списание */
  D_PUT = 5;        /* Зачисление */

var
  {curdate},
  {oper},
  Stat = True;

/* Точка входа */

if(ALG_SBDEPDOC.InSum)
  ClearRecord(tmpDoc);
  tmpDoc.Referenc         = ALG_DEPOSITOR.Referenc;
  tmpDoc.IsCur            = ALG_DEPOSITOR.IsCur;
  tmpDoc.FNCash           = ALG_DEPOSITOR.FNCash;
  tmpDoc.Account          = ALG_DEPOSITOR.Account;
  tmpDoc.Oper             = {oper};
  tmpDoc.Type_Account     = ALG_DEPOSITOR.Type_Account;
  tmpDoc.Code_Currency    = ALG_DEPOSITOR.Code_Currency;
  tmpDoc.CodClient        = ALG_DEPOSITOR.CodClient;
  tmpDoc.YesSbook         = ALG_SBDEPDOC.YesSbook;
  tmpDoc.Date_Document    = {curdate};
  tmpDoc.DepDate_Document = ALG_SBDEPDOC.DepDate_Document;
  tmpDoc.Author           = ALG_SBDEPDOC.Author;
  tmpDoc.VidDoc           = 1;
  tmpDoc.KindOp           = 1; /* D_IN */
  tmpDoc.TypeOper         = Дополнительный_Взнос;
  tmpDoc.TypeComplexOper  = Дополнительный_Взнос;
  tmpDoc.iApplicationKind = ALG_SBDEPDOC.iApplicationKind;
  tmpDoc.ApplicationKey   = FormApplicationKey( ALG_SBDEPDOC.iApplicationKind );
  tmpDoc.IsControl        = "X";
  tmpDoc.ObjectPerc       = 2001;
  tmpDoc.InSum            = ALG_SBDEPDOC.InSum;
  tmpDoc.KNFCode          = ALG_SBDEPDOC.KNFCode;
  tmpDoc.Ground           = "Дополнительный Взнос";
  InsertDocToGDDList( tmpDoc );
  ALG_SBDEPDOC.InSum = 0;
  ALG_SBDEPDOC.NotConfirm = "";
  UpdateAlgRecords( UPDATE_DOC, True ); 
  ALG_UPDATE = UPDATE_DOC;
end;
ALG_RESULT = OK_RES;
end;
