/**************************************************************************

  RS-Bank ( Сбербанк )
  Обслуживание безналичных платежей.

  Проводка по счетам без договора.
  Пользовательский макрос загрузки
  в файл документов вкладчиков по безналичным платежам
  в модуле "Филиал".

  Данный макрос представляет собой шаблон пользовательского макроса загрузки.

***************************************************************************/

import deprintr;

/*____________142833 - SAN - Removal of the relative paths__________*/
const PatternFile = GetRegVal( "BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ДИРЕКТОРИИ\\TEXTDIR", false ) + "\\*.woc";        /* Маска исходного текстового файла   "..\\TXTFILE\\*.woc"*/
const ReportFile = GetRegVal( "BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ДИРЕКТОРИИ\\TEXTDIR", false ) + "\\trn_lu_woc.txt";   // "..\\TXTFILE\\trn_lu_woc.txt";       /* Отчет по занесенным записям */
/*___________/142833 - 14/07/09_____________________________________*/

private file InputFile () txt;              /* Исходный файл формата DBF    */
private file RepFile () txt 250 write;  /* Отчет о занесенных записях   */

/************************************************************
                  Головная функция макроса
************************************************************/

macro Load ( PaymentID )  // PaymentID - ключевое поле в таблице платежей dpmpaym_dbt
  var NameInputFile = "";     /* Имя Операционного файла         */

  if ( SelectFile( NameInputFile, PatternFile, "Выберите исходный файл" ) )
    if ( Open( InputFile, NameInputFile )   AND
         Open( RepFile, ReportFile ) )

      // 
      // обработка файла
      //

      Close( RepFile );
      Close( InputFile );
      ViewFile( RepFile );
      [ Работа закончена ]
    else
      [ Ошибка при открытии файлов ];
    end;
  else
    [ Отказались от выбора исходного текстового файла ];
  end;

end;

