/*
$Name: clsdate.mac
$Module: Сервис розничных услуг 
$Description: автоматическая смена опердня
*/

import deprintr;

macro CloseAndOpenDay(newdate:date)
   var oldFlagCur, stat;

   oldFlagCur = SetFlagCur(0);
   stat = RtCloseDay(true,newdate);
   if ( stat )
      println("Завершение дня в рублях выполнено успешно");
   else
      println("Возникли ошибки при завершении дня в рублях");
   end;

   if ( stat )
     SetFlagCur(1);
     stat = RtCloseDay(true,newdate);
     if ( stat )
        println("Завершение дня в валюте выполнено успешно");
     else
        println("Возникли ошибки при завершении дня в валюте");
     end;
   end;

   if ( stat )
     SetFlagCur(0);
     stat = RtOpenDay(true);
     if ( stat )
        println(string("Открытие дня ",newdate," в рублях выполнено успешно"));
     else
        println(string("Возникли ошибки при открытии дня ",newdate," в рублях"));
     end;
   end;

   if ( stat )
     SetFlagCur(1);
     stat = RtOpenDay(true);
     if ( stat )
        println(string("Открытие дня ",newdate," в валюте выполнено успешно"));
     else
        println(string("Возникли ошибки при открытии дня ",newdate," в валюте"));
     end;
   end;

   SetFlagCur(oldFlagCur);
   return stat;
end;

CloseAndOpenDay(date);