file ORVVZRate("orvvz_rt.dbt") key 0;
file CIMisc("ci_misc.dbt") key 0;

var
  Price=$0;

const  
  O_LOTTERY_SELL=1;

macro CalcPrice(Type,Issue,Operation,SubOp,DocDate)

  var
    dd,mm,yy;

  if(Operation==O_LOTTERY_SELL)
    DateSplit(DocDate,dd,mm,yy);
    ORVVZRate.Type=Type;
    ORVVZRate.Issue=Issue;
    mm = mm - 1;
    ORVVZRate.ID = mm-3*Int(mm/3);
    GetEQ(ORVVZRate);
    if(dd<=15)
      Price=ORVVZRate.Rate1;
    else                   
      Price=ORVVZRate.Rate2;
    end;
  else
    CIMisc.Type = Type;
    CIMisc.IssueID = Issue;
    GetEQ( CIMisc );
    Price = CIMisc.Price;
  end;
end;

