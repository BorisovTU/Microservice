/*
$Name: eod_rep.mac
$Module: Обслуживание физ лиц
$Description: какой-то отчет, наверное для сбера
*/

/* закомментировано при удалении таблицы ddesk_rec_dbt по ##197859, 198467 */
/*
import deprintr, ResComm, Stat_Tot;

file DepParm("depparm.dbt") key 0;

private var
  IsCur = NumFlagCur,
  TotPrevRestV=$0,
  TotRestV=$0,
  TotDebetV=$0,
  TotCreditV=$0;

macro OutHead

  [


                            Справка о завершении опердня ########## ########

  ]({curdate},Time);
end;

macro OutSubHead

  [+--------------------------------------------------------------------------------------------------+
   |                            |            П р и х о д           |            Р а с х о д           |
   |                            |----------------------------------|----------------------------------|
   |                            |    Наличный     |  Безналичный   |    Наличный     |  Безналичный   |
   +--------------------------------------------------------------------------------------------------+];
end;

macro AddResourceToTotals;

  var
    Deb, Cred;

  if ( CashVal.rec.Type == TYPE_RES_NOPAY )
    return;
  end;

  CalcTurns( CashVal.rec.RefValue, Cred, Deb );
  TotDebetV = TotDebetV + Deb;
  TotCreditV = TotCreditV + Cred;
  CalcOtherTurns( CashVal.rec.RefValue, Cred, Deb );
  TotDebetV = TotDebetV + Deb;
  TotCreditV = TotCreditV + Cred;
end;

macro CalcCashValTotals

/*  ClearRecord( CashVal );*/
  CashVal.clear;
  CashVal.rec.TypeValue=CV_ValForm;
  if(CashVal.GetGE)
    if((CashVal.rec.RefValueReport==IsCur) or (CashVal.rec.RefValueReport==2))
      AddResourceToTotals;
    end;
    while(CashVal.Next)
      if((CashVal.rec.RefValueReport==IsCur) or (CashVal.rec.RefValueReport==IsCur))
        AddResourceToTotals;
      end;
    end;
  end;
end;

macro ReportForCurCurrency

  var
    RecFound,
    PrevRest=$0,
    Rest=$0,
    Credit=$0,
    Debet=$0,
    TmpCred,
    TmpDeb,
    MemDebet=$0,
    MemCredit=$0;

  CashAcc.KeyNum = 2;
  CashAcc.rec.Branch=Branch;
  CashAcc.rec.CashOper=Safe;
  CashAcc.rec.RefValue=CashVal.rec.RefValue;
  CashAcc.rec.Date={curdate};
  if(CashAcc.GetLT and
    (CashAcc.rec.Branch==Branch) and
    (CashAcc.rec.RefValue==CashVal.rec.RefValue) and
    (CashAcc.rec.CashOper==Safe))
    PrevRest=CashAcc.rec.RestMoney;
  end;

  CashAcc.KeyNum = 1;
  CashAcc.rec.Branch=Branch;
  CashAcc.rec.CashOper=Safe;
  CashAcc.rec.RefValue=CashVal.rec.RefValue;
  CashAcc.rec.Date={curdate};
  if(CashAcc.GetEQ)
    Rest=CashAcc.rec.RestMoney;
  end;

  CalcTurns( CashVal.rec.RefValue, Credit, Debet );
  CalcOtherTurns( CashVal.rec.RefValue, TmpCred, TmpDeb );
  Credit = Credit + TmpCred;
  Debet = Debet + TmpDeb;

  getTotalDepStats( {curdate}, CashVal.rec.CodIntValue );
  MemDebet = totalStat.MemDebSum;
  MemCredit = totalStat.MemKredSum;

  OutSubHead;

  [ Н а л и ч н ы е              #################                  #################                  ]
  (Credit,Debet);
  [ Мемориальные обороты                           ################                   ################ ]
  (MemCredit,MemDebet);
  if((not IsCur) or (CashVal.rec.CodIntValue==1))
    TotPrevRestV=$0;
    TotRestV=$0;
    TotDebetV=$0;
    TotCreditV=$0;
    CalcCashValTotals;
    [ Ц е н н о с т и              #################                  #################                  ]
    (TotCreditV,TotDebetV);
  end;
end;

  var
    RecFound;

  CashVal.KeyNum = 1;
  Safe = GetNativeSafe;
  OutHead;
  if(not IsCur)
    CashVal.rec.TypeValue=CV_Currency;
    CashVal.rec.CodIntValue=0;
    CashVal.rec.Type = 0;
    if(CashVal.GetEQ)
      ReportForCurCurrency;
    end;
  else
    CashVal.rec.TypeValue=CV_Currency;
    CashVal.rec.CodIntValue=1;
    CashVal.rec.Type = 0;
    RecFound=CashVal.GetGE;
    while(RecFound  and (CashVal.rec.TypeValue==CV_Currency))
      if ( CashVal.rec.Type == 0 )
        PrintLn;
        PrintLn(CashVal.rec.NameValue);
        PrintLn;
        CashVal.GetPos;
        ReportForCurCurrency;
        CashVal.GetDirect;
      end;
      RecFound=CashVal.Next;
    end;
  end;
end;
*/