/*
$Name:               wf_localExecutor.mac
$Module:             DEPOSITR
$Description:        API депозита
*/
/*
*/

import xr_wf_execute;

class TLocalExecutor(_ui, _outputHandler)
  private var ui = _ui;
  private var outputHandler = _outputHandler;

  private macro output(msg : String, pd : TProcessData)
    if (outputHandler != null)
      execMacro2(@outputHandler, msg, pd);
    end;
  end;

  macro executeProcess(processDefinitionId : String, p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, p13, p14, p15)
    output("Запуск процесса " + processDefinitionId);
    var pd = startProcess(processDefinitionId, null, p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12, p13, p14, p15);
    while ((not pd.IsFinished) and (pd.UiSessionId != null))
      ui.processForm(pd);
      if (ui.isCanceled(pd))
        output("Прерывание процесса", pd);
        abortProcess(pd);
        return;
      end;  
      output("Возобновление процесса", pd);
      pd = resumeProcess(pd, null);
    end;
    if (pd.IsAborted)
      output("Процесс прерван", pd);
    elif (pd.IsFinished)
      output("Процесс завершен", pd);
    else 
      output("Процесс приостановлен", pd);
    end; 
  end;
end;