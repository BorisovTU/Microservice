/***************************************************************************\
| Ib_Setattr.mac Система:RS-Retail Автор: Войновский М.                     |
| Признак необходимости информирования ВС                                   |
| Для шага "Действия в конце транзакции" операции                           |
\***************************************************************************/
 import deprintr, alg_vars, rsd;
/*---------- Инициализируемые структуры ---------------------------------*/
private var {curdate};

var needSendAccInf = rsdcommand("SELECT * FROM dopobject_dbt WHERE T_OPAPPKIND = 11001 AND T_OBJECTREF = ?");
needSendAccInf.AddParam("OBJECTREF",RSDBP_IN,string(ALG_SBDEPDOC.REFERENC));
needSendAccInf.execute();
var rs_needSendAccInf = RsdRecordset(needSendAccInf);
if (not rs_needSendAccInf.moveNext())
  ALG_RESULT=SKIP_RES;
else
var insertOPObj = rsdcommand("INSERT INTO dopobject_dbt (T_BRANCH, "
                           " T_DATE, "
                           " T_OPAPPKIND, "
                           " T_OPAPPKEY, "
                           " T_OBJECTTYPE, "
                           " T_OBJECTREF, "
                           " T_SESSIONNUM, "
                           " T_NUMBER, "
                           " T_ISCUR) "
    " VALUES (?, "
             " ?, "
             " ?, "
             " ?, "
             " 11002, "
             " chr(0), "
             " 0, "
             " 0, "
             "?)");

insertOPObj.AddParam("BRANCH",RSDBP_IN,ALG_SBDEPDOC.FNCash);
insertOPObj.AddParam("DATE",RSDBP_IN,{curdate});
insertOPObj.AddParam("OPAPPKIND",RSDBP_IN,ALG_SBDEPDOC.IAPPLICATIONKIND);
insertOPObj.AddParam("OPAPPKEY",RSDBP_IN,ALG_SBDEPDOC.APPLICATIONKEY);
insertOPObj.AddParam("ISCUR",RSDBP_IN,ALG_SBDEPDOC.IsCur);
insertOPObj.execute();
ALG_RESULT=OK_RES;
end;
OnError
ALG_RESULT=ERR_RES;

return;