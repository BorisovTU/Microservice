/*
$Name:               wf_prndogs.mac
$Module:             DEPOSITR
$Description:        Печать договора для web
*/
/*
  RS-Bank
  Частные вклады для Сбербанка

  Вызов макpо печати договоpа для шагов алгоpитма

  07.02.97 | Зубов В.Ю. | Создан
*/

import toolprndogs,CbReport_h,"ws_file.mac";

macro PrintContract (ReferencID : Integer, Amount : Money, ownerID : Integer, clientID : Integer) : String
  file depos("depositr.dbt") key 8;
  record depositr("depositr.dbt");
  record depdoc("sbdepdoc.dbt");
  var depclnt = TClientList;
  var tagFile = "";
  var retVal = "";
  ReplaceMacro ( "isStandalone", "WEB_isStandalone" );
  ClearRecord(depos);
  depos.Referenc = ReferencID;
  if( getEQ( depos ) )
    Copy(depositr, depos);
    depdoc.Referenc = depositr.Referenc;
    depdoc.Type_Account = depositr.Type_account;
    depdoc.FNCash = depositr.FNCash;
    depdoc.Date_document = depositr.Open_Date;
    depdoc.isCur = depositr.isCur;
    depdoc.Code_currency = depositr.Code_currency;
    depdoc.inSum = Amount;
    depdoc.Rest = Amount;
    if ( depclnt.GetRecord(clientID) )
      var COMPAYER = depclnt.CurRec;
      if ( depclnt.GetRecord(ownerID) )
        var COMDEPCLNT = depclnt.CurRec;
        SetOutPut( null, FALSE);
        tagFile = Main_MAC(depositr,depdoc,COMPAYER,COMDEPCLNT, true);/*вызов основного макроса*/
      end;
    end;
  end;
  ReplaceMacro ( "isStandalone", NULL );

  var FileCont = CreateFileContainer(tagFile, false);
  return FileCont.Body;

  onError(e)
  retVal = "Error:" + e.Message + "; " + e.AxMes + "; " + e.Module + "; " + string(e.Line);
  return retVal;
end;
