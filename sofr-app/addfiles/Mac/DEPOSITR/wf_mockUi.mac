import wf_params, wf_uiFormManager;

private const IS_CANCELED = "__isCanceled";

class TMockWebUI
  var forms = TParameters;

  macro isCanceled(pd)
    if (pd.CurrentForm != null)
      var f = TParameters;
      f.setArray(pd.CurrentForm.Fields);
      return f.get(IS_CANCELED) == true; 
    end;
    return false;  
  end;

  macro processForm(pd)
    if (pd.CurrentForm != null)
      var handler = forms.get(pd.CurrentForm.Id);
      var f = TParameters;
      f.setArray(pd.CurrentForm.Fields);
      println("# Обработка формы " + pd.CurrentForm.Id);
      if (handler != null) 
        pd.CurrentForm.Fields = execMacro2(handler, f).asArray;
      end; 
    end;
  end;
end;

macro fireCancel(fields : TParameters)
  fields.set(IS_CANCELED, true);
  return fields;
end;

