/*
  ---------------------
  R-Style Software Lab.
  ---------------------
  RS-Retail
  ---------------------
  Макрос проверок для компенсаций (общая часть)
  ---------------------
  Проверки при зачислениях компенсаций

*/

import deprintr;

 const
   AT01 =  1,  /* Старше 1916 г.р. */
   AT02 =  2,  /* С 1917 по 1929 г.р. */
   AT03 =  3,  /* Насл.1 очереди 1920г */
   AT04 =  4,  /* Инвалиды 1 группы */
   AT05 =  5,  /* Насл.влад.гарант.сб. */
   AT06 =  6,  /* Вкладч.старше 1924г. */
   AT07 =  7,  /* Участники ВОВ */
   AT08 =  8,  /* Насл.1оч. ст.1924г. */
   AT09 =  9,  /* Наследникам 1 очереди инвалидов 1 группы */
   AT10 = 10,  /* Насл.1оч. участн.ВОВ */
   AT11 = 11,  /* Инвал.2гр. ст.1940г. */
   AT12 = 12,  /* Вкладчикам до 16г.р. */
   AT13 = 13,  /* Вкладчикам 17-20г.р. */
   AT14 = 14,  /* Вкладчикам 21-22г.р. */
   AT15 = 15,  /* Вкладчикам 23-24 г.р. */
   AT16 = 16,  /* Инвалидам 1 группы */
   AT17 = 17,  /* На погребение */
   AT18 = 18,  /* Участникам В.О.В. */
   AT19 = 19,  /* Наследникам участников В.О.В. */
   AT20 = 20,  /* Наследн.инвалидов 1г */
   AT21 = 21,  /* Наследникам 1очереди */
   AT22 = 22,  /* Инвалидам 2 группы до 40 г.р. */
   AT23 = 23,  /* 1922 г.р. и старше */
   AT24 = 24,  /* С 1925 по 1928 г.р. */
   AT25 = 25,  /* Родитель детей-инвалидов */
   AT26 = 26,  /* На уплату ритуальных услуг */
   AT27 = 27,  /* Наследникам 1 очереди по 1928 г.р. */
   AT28 = 28,  /* Наследникам 1 очереди инвалидов 2 группы по 1940 г.р. */
   AT29 = 29,  /* Наследникам 1 очереди родителей инвалидов */
   AT51 = 51,  /* Вкладчикам до 16 г р */
   AT52 = 52,  /* Вкладчикам 17-20 г р */
   AT53 = 53,  /* Вкладчикам 21-22 г р */
   AT54 = 54,  /* Вкладчикам 23-24 г р */
   AT55 = 55,  /* Инвалидам 1 группы */
   AT56 = 56,  /* На погребение */
   AT57 = 57,  /* Участникам ВОВ */
   AT58 = 58,  /* Наследн участников В */
   AT59 = 59,  /* Наследн инвалидов 1г */
   AT60 = 60,  /* Наследникам 1 очереди  1932 г.р. */
   AT61 = 61,  /* Инв 2группы до 40 г */
   AT62 = 62,  /* Вкладчикам 29-32 г.р. */
   AT63 = 63,  /* Владельцам детских целевых */
   AT64 = 64,  /* Вкладчикам по 1945 г.р. */
   AT65 = 65,  /* Инвалидам 2-й группы по 1950 г.р. */
   AT66 = 66,  /* Бывшим узникам */
   AT67 = 67,  /* Родителям погибших воинов */
   AT68 = 68,  /* Наследникам 1-й очереди по 1945 г.р. */
   AT69 = 69,  /* Наследникам 1-й очереди - инвалидам 2-й группы по 1950 г.р. */
   AT70 = 70,  /* Наследникам 1-й очереди - бывшим узникам */
   AT71 = 71,  /* Вкладчикам по 1932 г. р. */
   AT72 = 72;  /* Наследникам 1-й очереди по 1932 г.р. */

 const
   Limit1 = $6000.00,
   Limit2 = $1000.00, 
   Limit3 = $1000.00;

 const
   sNoCategoria = "Вкладчик не относится к выбранной категории",
   sLimit = "Максимальная сумма компенсации = ";

 const
   Compensation1997 = 0,    /* Компенсация 1997 года */
   Compensation1998 = 1,    /* Компенсация 1998 года */
   Compensation2000 = 2,    /* Компенсация 2000 года */
   Compensation2001 = 3,    /* Компенсация 2001 года */
   Compensation2003 = 4,    /* Компенсация 2003 года */
   Compensation2003Add = 5,    /* Дополнительная компенсация 2003 года */
   CompensationCash = 999;  /* Внесена наличными     */

var ClientList = TClientList;
var Client;

macro CheckCompensTypeCommon ( compens )

  var CodeClient = compens.rec.DestClientCode,
      CompensType = compens.rec.Kind,
      ClientType = compens.rec.Appltype;
  var bDay, bMon, bYear;  /* День, месяц, год рождения клиента */
  var retVal = 0;
  var Limit = 0;

  if (ClientList.GetRecord( CodeClient ) )

    Client = ClientList.CurRec;

    DateSplit( Client.rec.Born, bDay, bMon, bYear );

    /* Проверка для "Детского целевого" */
   if   ( ClientType == AT63 )  /* Владельцам детских целевых */
     if ( Client.rec.NotResident != StrFor( 0 ) )  /* Не резидент */
       retVal = 1;
     end;
    /* Проверки года рождения */
   elif ( ClientType == AT01 )  /* Старше 1916 г.р. */
     if ( bYear >= 1916 )
       retVal = 1;
     end;
   elif ( ClientType == AT02 )  /* С 1917 по 1929 г.р. */
     if ( ( bYear < 1917 )  OR  ( bYear > 1929 ) )
       retVal = 1;
     end;
   elif ( ClientType == AT03 )  /* Насл.1 очереди 1920г */
     if ( bYear != 1920 )
       retVal = 1;
     end;
   elif ( ClientType == AT06 )  /* Вкладч.старше 1924г. */
     if ( bYear >= 1924 )
       retVal = 1;
     end;
   elif ( ClientType == AT08 )  /* Насл.1оч. ст.1924г. */
     if ( bYear >= 1924 )
       retVal = 1;
     end;
   elif ( ClientType == AT11 )  /* Инвал.2гр. ст.1940г. */
     if ( bYear >= 1940 )
       retVal = 1;
     end;
   elif ( ClientType == AT12 )  /* Вкладчикам до 16г.р. */
     if ( bYear >= 1916 )
       retVal = 1;
     end;
   elif ( ClientType == AT13 )  /* Вкладчикам 17-20г.р. */
     if ( ( bYear < 1917 )  OR  ( bYear > 1920 ) )
       retVal = 1;
     end;
   elif ( ClientType == AT14 )  /* Вкладчикам 21-22г.р. */
     if ( ( bYear < 1921 )  OR  ( bYear > 1922 ) )
       retVal = 1;
     end;
   elif ( ClientType == AT15 )  /* Вкладчикам 23-24 г.р. */
     if ( ( bYear < 1923 )  OR  ( bYear > 1924 ) )
       retVal = 1;
     end;
   elif ( ClientType == AT22 )  /* Инвалидам 2 группы до 40 г.р. */
     if ( bYear > 1940 )
       retVal = 1;
     end;
   elif ( ClientType == AT23 )  /* 1922 г.р. и старше */
     if ( bYear > 1922 )
       retVal = 1;
     end;
   elif ( ClientType == AT24 )  /* С 1925 по 1928 г.р. */
     if ( ( bYear < 1925 )  OR  ( bYear > 1928 ) )
       retVal = 1;
     end;
   elif ( ClientType == AT27 )  /* Наследникам 1 очереди по 1928 г.р. */
     if ( bYear > 1928 )
       retVal = 1;
     end;
   elif ( ClientType == AT28 )  /* Наследникам 1 очереди инвалидов 2 группы по 1940 г.р. */
     if ( bYear > 1940 )
       retVal = 1;
     end;
   elif ( ClientType == AT51 )  /* Вкладчикам до 16 г р */
     if ( bYear >= 1916 )
       retVal = 1;
     end;
   elif ( ClientType == AT52 )  /* Вкладчикам 17-20 г р */
     if ( ( bYear < 1917 )  OR  ( bYear > 1920 ) )
       retVal = 1;
     end;
   elif ( ClientType == AT53 )  /* Вкладчикам 21-22 г р */
     if ( ( bYear < 1921 )  OR  ( bYear > 1922 ) )
       retVal = 1;
     end;
   elif ( ClientType == AT54 )  /* Вкладчикам 23-24 г р */
     if ( ( bYear < 1923 )  OR  ( bYear > 1924 ) )
       retVal = 1;
     end;
   elif ( ClientType == AT60 )  /* Наследникам 1 очереди  1932 г.р. */
     if ( bYear > 1932 )
       retVal = 1;
     end;
   elif ( ClientType == AT61 )  /* Инв 2группы до 40 г */
     if ( bYear > 1940 )
       retVal = 1;
     end;  
   elif ( ClientType == AT62 )  /* С 1929 по 1932 г.р. */
     if ( ( bYear < 1929 )  OR  ( bYear > 1932 ) )
       retVal = 1;
     end;
   elif ( ClientType == AT64 )  /* Вкладчикам по 1945 г.р. */
     if ( bYear > 1945 )
       retVal = 1;
     end;
   elif ( ClientType == AT65 )  /* Инвалидам 2-й группы по 1950 г.р. */
     if ( bYear > 1950 )
       retVal = 1;
     end;
   elif ( ClientType == AT68 )  /* Наследникам 1-й очереди по 1945 г.р. */
     if ( bYear > 1945 )
       retVal = 1;
     end;
   elif ( ClientType == AT69 )  /* Наследникам 1-й очереди - инвалидам 2-й группы по 1950 г.р. */
     if ( bYear > 1950 )
       retVal = 1;
     end;
   elif ( ClientType == AT71 )  /* Вкладчикам по 1932 г.р. */
     if ( bYear > 1932 )
       retVal = 1;
     end;
   elif ( ClientType == AT72 )  /* Наследникам 1-й очереди по 1932 г.р. */
     if ( bYear > 1932 )
       retVal = 1;
     end;
   end;


   /* Проверки для компенсаций наследникам */
   if (   ( ClientType == AT09 )  OR  /* Наследникам 1 очереди инвалидов 1 группы */
          ( ClientType == AT19 )  OR  /* Наследникам участников В.О.В. */
          ( ClientType == AT26 )  OR  /* На уплату ритуальных услуг */
          ( ClientType == AT27 )  OR  /* Наследникам 1 очереди по 1928 г.р. */
          ( ClientType == AT28 )  OR  /* Наследникам 1 очереди инвалидов 2 группы по 1940 г.р. */
          ( ClientType == AT29 )  OR  /* Наследникам 1 очереди родителей инвалидов */
          ( ClientType == AT68 )  OR  /* Наследникам 1-й очереди по 1945 г.р. */
          ( ClientType == AT69 )  OR  /* Наследникам 1-й очереди - инвалидам 2-й группы по 1950 г.р. */
          ( ClientType == AT70 )  OR  /* Наследникам 1-й очереди - бывшим узникам */
          ( ClientType == AT72 ) )    /* Наследникам 1-й очереди по 1932 г.р. */

     if ( ClientList.CurRec.rec.DateDeath == Date(0,0,0) )
       GetDate( ClientList.CurRec.rec.DateDeath, "Укажите дату смерти вкладчика" );
       if ( ClientList.CurRec.rec.DateDeath == Date(0,0,0) )
         MsgBox( "Дата смерти вкладчика не установлена" );
         return 2;
       else
         ClientList.Update;
       end;
     end;
     if ( ClientType == AT26 )  /* На уплату ритуальных услуг */
       DateSplit( ClientList.CurRec.rec.DateDeath, bDay, bMon, bYear );
       if ( ( CompensType == Compensation2003 ) OR ( CompensType == Compensation2003Add ) )
         if ( ( bYear < 2001 )  OR  ( bYear > 2003 ) )
           retVal = 1;
         end;
       else
         if ( ( bYear < 1998 )  OR  ( bYear > 2001 ) )
           retVal = 1;
         end;
       end;
     end;
   end;

   if (retVal==0)
     if ( ( ClientType == AT26 )  AND  /* На уплату ритуальных услуг */
          ( compens.rec.Kind == Compensation2001 ) )  /* Компенсация 2001 года */
       if ( compens.rec.Sum > Limit1 )
         Limit = Limit1;
         retVal = 3;
       end;
     elif ( ( ( ClientType == AT60 ) 
           OR ( ClientType == AT62 ) 
           OR ( ClientType == AT09 ) 
           OR ( ClientType == AT04 ) 
           OR ( ClientType == AT25 ) 
           OR ( ClientType == AT55 ) )  AND  
          ( compens.rec.Kind == Compensation2003 ) )  
       if ( compens.rec.Sum > Limit3 )
         Limit = Limit3;
         retVal = 3;
       end;
     else
       if ( compens.rec.Sum > Limit2 )
         Limit = Limit2;
         retVal = 3;
       end;
     end;
   end;


   if (retVal == 1)
     MsgBox ( sNoCategoria );
   elif (retVal == 3)
     MsgBox ( sLimit + String (Limit) + " руб.");
   end;

  else
     MsgBox( "Вкладчик не найден" );
     retVal = 1;
  end;

  return retVal;

end;


MACRO CheckCompensationType (compens)

  var retVal=CheckCompensTypeCommon (compens);

  return retVal;

end;
