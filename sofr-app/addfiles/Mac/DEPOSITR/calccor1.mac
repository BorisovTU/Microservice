/*
  RS-Bank 6
  RS-Retail

   Сложная капитализация по основным условиям для Целевых
  вкладов на детей.
   Т.к. за прошлые периоды (годы) проценты причисляются отдельно, 
  то потом, при выпуске отчета, капитализация может быть неверная.
  Поэтому за последний период капитализируем оплаченные проценты,
  если сумма процентов к выплате равна 0 
*/
import DeprIntr;

record DEP_ACC_REC("depositr.dbt");   
record PC_ACC_REC ("pc_alg.dbt");

const  PC_ACCOUNT_DEP  = 2001;

var    SumCorRest,
       NextCalc;

/**********************************************************/

macro CalcDelta (CalcDate)

  var
    Delta  = $0l,
    SumPay = $0l;

  Проценты_Налог_К_Оплате_Учет_Конв (
       DEP_ACC_REC.Referenc,
       PC_ACCOUNT_DEP,
       CalcDate,
       Delta, SumPay );

  return Delta+SumPay;
end;
/***********************************************************
 Головной макрос (вызывается из программы для капитализации)
***********************************************************/

macro CalcCorSum( CalcDate, Rest, PrevDelta )

  NextCalc = 0;

  SumCorRest = CalcDelta( CalcDate-1 );

end;
