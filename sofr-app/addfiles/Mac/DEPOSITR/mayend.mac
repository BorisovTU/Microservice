/***************************************************************************\
| MAYEND.MAC   RS-Retail Автор: Саввин Д.                                   |
| Для вкладов первоклассников                                               |
| Для шага алгоритма ???                                                    |
\***************************************************************************/

/* При открытии вклада первоклассников данный макрос устанавливает
дату окончания вклада, равной 1 мая следующего года */
import commonInter;

/*---------- Инициализируемые структуры ---------------------------------*/
 record ALG_DEPOSITOR("depositr.dbt");
 record ALG_SBDEPDOC("sbdepdoc.dbt");
 record ALG_PARAM("sb_algop.dbt");
 var    DC = TClientList;

/*---------- Коды возврата макроса --------------------------------------*/
 const  OK_RES   =  0,  /* продолжать проводку */
        SKIP_RES =  1,  /* пропустить выполнение предопределенного модуля */
        END_RES  =  2,  /* завершить проводку */
        ERR_RES  = -1;  /* аваpийно завершить проводку */
/*-----------------------------------------------------------------------*/
 var DatGR=date(0,0,0), day=0, mon=0, year=0, DayEnd=31;

 macro BD(CodClient)
   if (DC.GetRecord (CodClient))
     return DC.CurRec.rec.Born;
   else
     msgbox("Не найден клиент счета");
     ALG_RESULT=ERR_RES;
     exit(1);
   end;
 end;

/*-----------------------------------------------------------------------*/
DateSplit(ALG_DEPOSITOR.Start_DateDep,day,mon,year);
DatGR=date(DayEnd,5,year+1);
ALG_DEPOSITOR.End_DateDep=DatGR;
ALG_RESULT=SKIP_RES;
ALG_UPDATE=1;
Exit(1); /* Убрать вывод на экран */
return;
