/*

    Расчет доходов по Сертификатам СССР 1988 года

*/

const DateCert1988 = Date( 1, 1, 1988 );
const Day91        = 1;
const Month91      = 3;
const Year91       = 1991;

const Par0250 = $250.0;
const Par0500 = $500.0;
const Par1000 = $1000.0;

var Yield = $0.0, Tax = $0;

/*  Таблицы сумм выплаты по полным годам для расчета C1  */
array Pay0250, Pay0500, Pay1000;

aSize( Pay0250, 11 );
aSize( Pay0500, 11 );
aSize( Pay1000, 11 );

Pay0250( 1) = $13.0;
Pay0250( 2) = $27.0;
Pay0250( 3) = $47.0;
Pay0250( 4) = $71.0;
Pay0250( 5) = $104.0;
Pay0250( 6) = $142.0;
Pay0250( 7) = $190.0;
Pay0250( 8) = $246.0;
Pay0250( 9) = $316.0;
Pay0250(10) = $399.0;

Pay0500( 1) = $25.0;
Pay0500( 2) = $55.0;
Pay0500( 3) = $95.0;
Pay0500( 4) = $142.0;
Pay0500( 5) = $208.0;
Pay0500( 6) = $285.0;
Pay0500( 7) = $380.0;
Pay0500( 8) = $492.0;
Pay0500( 9) = $632.0;
Pay0500(10) = $798.0;

Pay1000( 1) = $50.0;
Pay1000( 2) = $110.0;
Pay1000( 3) = $190.0;
Pay1000( 4) = $285.0;
Pay1000( 5) = $415.0;
Pay1000( 6) = $570.0;
Pay1000( 7) = $760.0;
Pay1000( 8) = $985.0;
Pay1000( 9) = $1265.0;
Pay1000(10) = $1595.0;

/*  Таблицы сумм доходов по полным годам с 01.03.91 г. для расчета C2  */
array Yield0250, Yield0500, Yield1000;

aSize( Yield0250, 11 );
aSize( Yield0500, 11 );
aSize( Yield1000, 11 );

Yield0250( 3) = $19.0;
Yield0250( 4) = $28.0;
Yield0250( 5) = $41.0;
Yield0250( 6) = $57.0;
Yield0250( 7) = $76.0;
Yield0250( 8) = $98.0;
Yield0250( 9) = $126.0;
Yield0250(10) = $160.0;

Yield0500( 3) = $38.0;
Yield0500( 4) = $56.0;
Yield0500( 5) = $82.0;
Yield0500( 6) = $114.0;
Yield0500( 7) = $152.0;
Yield0500( 8) = $196.0;
Yield0500( 9) = $252.0;
Yield0500(10) = $320.0;

Yield1000( 3) = $76.0;
Yield1000( 4) = $112.0;
Yield1000( 5) = $164.0;
Yield1000( 6) = $228.0;
Yield1000( 7) = $304.0;
Yield1000( 8) = $392.0;
Yield1000( 9) = $504.0;
Yield1000(10) = $640.0;

macro CalcYield(Issue,Par,Duration,SellDate,DemandDate)

  var day1, month1, year1, day2, month2, year2, years1, years2;

  var C1 = $0.0, C2 = $0.0, C3 = $0.0, C4 = $0.0;

  var Sum, Rub, Kop;

  /* Проверки правильности задания даты продажи */
  if ( SellDate < Date( 01, 01, 1988 ) )
    println("\nСрок реализации начат с 1988 года" );
    return FALSE;
  end;
  if ( SellDate > Date( 31, 12, 1993 ) )
    println("\nСрок реализации прекращен 31 декабря 1993 года" );
    return FALSE;
  end;

  Par = Par * 1000;

  Yield = $0.0;
  if ( SellDate < DateCert1988 )
    println( "Дата приобретения ", SellDate,
             " меньше даты выпуска ", DateCert1988,
             ".\nРасчет не выполняется" );
    return;
  end;
  if ( SellDate > DemandDate )
    println( "Дата предъявления ", DemandDate,
             " меньше даты приобретения ", SellDate,
             ".\nРасчет не выполняется" );
    return;
  end;

  DateSplit( SellDate,   day1, month1, year1 );
  DateSplit( DemandDate, day2, month2, year2 );

  /* Рассчет числа полных лет со дня продажи */
  years1 = year2 - year1;

  if ( month1 > month2 )
    years1 = years1 - 1;
  elif ( ( month1 == month2 )  AND  ( day1 > day2 ) )
    years1 = years1 - 1;
  end;

  if ( years1 > 10 )
    years1 = 10;
  end;

  /* Рассчет числа полных лет хранения с 01.03.91 г. */
  years2 = year2 - Year91;

  if ( Month91 > month2 )
    years2 = years2 - 1;
  elif ( ( Month91 == month2 )  AND  ( Day91 > day2 ) )
    years2 = years2 - 1;
  end;

  if ( years2 > 10 )
    years2 = 10;
  end;

  /* Расчет сумм C1 */
  if ( years1 < 1 )
    C1 = 0;
  else
    if   ( Par == Par0250 )
      C1 = Pay0250( years1 );
    elif ( Par == Par0500 )
      C1 = Pay0500( years1 );
    elif ( Par == Par1000 )
      C1 = Pay1000( years1 );
    else
      println( "Номинал ", Par, " сертификата не равен 250, 500 или 1000" );
      return;
    end;
  end;

  /* Расчет сумм C2, C3, C4 */
  if   ( Par == Par0250 )
    if ( SellDate < Date( 01, 03, 1991 ) )
      C2 = $100.0;
      if ( years2 > 2 )
        C3 = Yield0250( years2 );
      end;
    end;
    C4 = $75.0;
  elif ( Par == Par0500 )
    if ( SellDate < Date( 01, 03, 1991 ) )
      C2 = $200.0;
      if ( years2 > 2 )
        C3 = Yield0500( years2 );
      end;
    end;
    C4 = $150.0;
  elif ( Par == Par1000 )
    if ( SellDate < Date( 01, 03, 1991 ) )
      C2 = $400.0;
      if ( years2 > 2 )
        C3 = Yield1000( years2 );
      end;
    end;
    C4 = $300.0;
  else
    println( "Номинал ", Par, " сертификата не равен 250, 500 или 1000" );
    return;
  end;

  Yield = C1 + C2 + C3 + C4;

  /* Формирование протокола расчета дохода по Сертификатам */

  println( "\n Сертификат СССР 1988 года выпуска - ", Par:a, " руб." );

  println( "\n Номинал Сертификата: ", Par, " руб." );

  println( "\n Дата приобретения - ", SellDate:m );

  println( "\n Дата предъявления - ", DemandDate:m );

  println( "\n Со дня продажи прошло ", years1, " полных лет." );

  println( "\n Расчет сумм без учета деноминации:",
           "\n Сумма выдачи = ",
           Par, " + ", C1, " + ", C2, " + ", C3, " + ", C4,
           " = ", (Par + Yield):a, " руб." );

  Sum = (Par+Yield)/1000;  /* Деноминированная сумма */

  Yield= Yield/1000;       /* Деноминированный доход */

  RubToStr( Sum, Rub, Kop );

  println( "\n Итого к выдаче после деноминации ",
           Int( DoubleL(Sum)/100 ), " руб ", Kop, " коп" );

  return true;
end;
