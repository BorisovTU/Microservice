/*

  RS-Bank.

  RS-Retail.

  Пример макроса для расчета суммы планового перечисления.

  Правила для такого макроса:

    1. Макрос должен возвращать переменную типа bool ( TRUE / FALSE ).

    2. Значение суммы для планового перечисления должно помещаться
       в переменную с именем Sum.

*/

import DeprIntr, OperCode;

record pp ( "dplanpay.dbt" ) key 2;
record dp ( "depositr.dbt" ) key 8;

var Sum;

macro CalculateSum (AddrPlan, AddrAcc)
  var sum1=$0;
  
  SetBuff( pp, addrPlan );
  SetBuff( dp, addrAcc );
  
  sum1 = Money( SubStr( pp.Sum, 2 ) );
  
  If ( dp.Sum_rest >= sum1 )
      Sum = dp.Sum_rest - sum1;
    else
      Sum = $0;
  end;
  
  return true;
end;
