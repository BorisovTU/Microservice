/*
$Name: trst_36.mac
$Module: DEPOSITR
$Description: Форма 36
*/

import deprintr, commclnt, alg_vars;

// file opr      ( person   ) key 0;
file depositr ( depositr ) key 8;

var clnt = TClientList(true);

record sbtrast_new ( sbtrast );

var sFIO_Trast = "";  // Ф.И.О. доверенного лица.

/**************************************************************************\
|                       Получение Ф.И.О. доверенного лица.                 |
\**************************************************************************/
macro FillFIOForTrast()
  if ( sbtrast_new.CodClient != 0 )
    if ( clnt.GetRecord( sbtrast_new.CodClient ) )
      sFIO_Trast = clnt.CurRec.ConvertFIOFull();
    end;
  end;
end;

/**************************************************************************\
|                                                                          |
\**************************************************************************/
macro Print_nf_36

  var v_FIO;
  // var sOper = "";

  if ( clnt.GetRecord( ALG_DEPOSITOR.CodClient ) )
    v_FIO = clnt.CurRec.ConvertFIOFull();
  end;

  FillFIOForTrast();

  /*
  opr.Oper = {oper};
  if ( GetEQ( opr ) )
    sOper = opr.Name;
  else
    sOper = "";
  end;
  */

  [
     Сбербанк России                                           ф.№ 322
    ##################################################################
    --------------------------------
      (наименование подразделения
          Сбербанка России)

      Доверяю получать суммы со вклада по счету № #######################################################
    с ######################################################
    ##################################################################




    ##################################################################



    ________________________/##################################################################]
  (
    getFilialName(),
    // Acc_Form(ALG_DEPOSITOR.Account):f,
    ALG_DEPOSITOR.Account:f,
    String( sbtrast_new.DateOpen:m ) + " по " + String( sbtrast_new.CloseDate:m ),
    ( "клиенту: " + sFIO_Trast ):w,
    {curdate}:m,
    v_FIO + "/"
  );

end;

// Вызов из скроллинга доверенностей.
//  ref  - референс счета.
//  ptr  - адрес записи доверенности
macro PrintForm_36( ref, ptr )

  if ( ptr != NULL )
    setbuff( sbtrast_new, ptr );
  end;

  ClearRecord( depositr );
  depositr.Referenc = ref;

  if ( GetEQ( depositr ) )
    Copy( ALG_DEPOSITOR, depositr );
    Print_nf_36();
  end;
end;
