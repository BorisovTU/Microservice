/*
*  ---------------------
*  R-Style Software Lab.
*  ---------------------
*  RS-Retail
*
*  Компенсации по вкладам
*
*  Реестр начисленных и выплаченных компенсаций
*
*/

import RSD, deprintr, issrvdoc;

var SpecialAccess = GetSpecialAccess(); /*имеет ли операционист спецдоступ к счетам*/
var OperMayListSpecialAccounts = GetShowSpecialAccessAccounts() and GetBankStandart(); /* может ли операционист просматривать спец счета ,не имея спец. доступа*/

const
   AT04 =  4,  /* Инвалиды 1 группы */
   AT09 =  9,  /* Наследникам 1 очереди инвалидов 1 группы */
   AT25 = 25,  /* Родитель детей-инвалидов */
   AT63 = 63,  /* Владельцам детских целевых */
   AT67 = 67,  /* Родителям погибших воинов */
   AT73 = 73,
   AT74 = 74,
   AT75 = 75,
   AT76 = 76,
   AT77 = 77,
   AT78 = 78,
   AT79 = 79,
   AT80 = 80,
   AT81 = 81,
   AT82 = 82,
   AT83 = 83,
   AT84 = 84,
   AT85 = 85,
   AT87 = 87,
   AT88 = 88;
   AT98 = 98,
   AT99 = 99;

var ClientList = TClientList;
var Client;

var cmd, rs;
var PayOutofSum = $0, count_of_account = 0;

macro isDateNull(_date)
    var day, month, year;
    DateSplit(_date, day, month, year );

    if ( (day == 1) and (month == 1) and (year == 1) )
       return 1;
    end;

    return 0;
end;

macro isCompensPayOut(arrFNcash, kind, type, date1, date2, arrAutoKey)
  var count_account = 0;
  var cmd_1, rs_1;
      cmd = RsdCommand("select ddepositr_dbt.t_referenc, dcompens_dbt.t_autokey from ddepositr_dbt, dcompens_dbt where dcompens_dbt.t_fncash = ? and dcompens_dbt.T_APPLTYPE = ?" 
                       "and dcompens_dbt.t_kind = ? and dcompens_dbt.T_DESTACCOUNT = ddepositr_dbt.T_ACCOUNT and dcompens_dbt.t_fncash = ddepositr_dbt.t_fncash "
	               "and dcompens_dbt.t_date between ? and ? ");
      cmd.addParam("t_fncash", RsdBp_in);
      cmd.value("t_fncash") = arrFNcash;
      cmd.addParam("t_appltype", RsdBp_in);
      cmd.value("t_appltype") = type;
      cmd.addParam("t_kind", RsdBp_in);
      cmd.value("t_kind") = kind;
      cmd.addParam("t_date1", RsdBp_in);
      cmd.value("t_date1") = date1;
      cmd.addParam("t_date2", RsdBp_in);
      cmd.value("t_date2") = date2;
      cmd.execute();
      rs = RsdRecordset(cmd);

      while( rs.moveNext() )
                cmd_1 = RsdCommand("select count(*) from dsbdepdoc_dbt where t_referenc = ? and t_typeoper = ? "
      	                         "and ( t_date_document between ? and ? ) and " + IsServ_const);
                cmd_1.addParam("t_referenc", RsdBp_in);
                cmd_1.value("t_referenc") = rs.value(0);
                cmd_1.addParam("t_typeoper", RsdBp_in);
                cmd_1.value("t_typeoper") = 74; // Операция зачисления компенсации
                cmd_1.addParam("t_date1", RsdBp_in);
                cmd_1.value("t_date1") = date1;
                cmd_1.addParam("t_date2", RsdBp_in);
                cmd_1.value("t_date2") = date2;
                cmd_1.execute();
                rs_1 = RsdRecordset(cmd_1);
                if (rs_1.moveNext())
                   arrAutoKey(count_account) = rs.value(1);
                   count_account = count_account + 1;
                end;
      end;
      if (count_account > 0)
         return count_account;
      end;	
      return -1;
end;

macro EndofList(count_of_account, PayOutofSum)
var tmp_account = 0;
      if (count_of_account != -1)
         tmp_account = count_of_account;
      end;
      [  
          Сумма начисленной компенсации (итого по реестру)       #   (руб.коп)

          Количество счетов (итого по реестру)  #  (шт.)

          Руководитель подразделения ]
      (PayOutofSum,
       tmp_account);
end;

macro ListType_1_body(arrFNcash, kind, type, date1, date2 )
   array arrAutoKey;
   var count = isCompensPayOut(arrFNcash, kind, type, date1, date2, arrAutoKey);
   var FIO="", Type_Account="", Account="", SumComp="", FIO_pol="";
   var temp_date="", bDay="", bMon="", bYear="", dateC="";
   var cmd_1, rs_1, i=0;
   array payDate, paySum, payDestAccount;
   var count_pay=0,

     count_of_account = count;

     while (i < count) 
      cmd = RsdCommand("select cmp.t_codclient, cmp.t_account, cmp.t_accClsDate, cmp.t_restIn91, cmp.t_rate, "+
                       " cmp.t_FullSum, cmp.t_sum, cmp.t_date, cmp.t_destAccount, cmp.T_DESTCLIENTCODE, dep.t_SpecialAccess as SpecialAccess"+
                       " from dcompens_dbt cmp, ddepositr_dbt dep where cmp.t_fncash = ? and cmp.t_autokey = ?"+
                       " and cmp.T_DESTACCOUNT = dep.T_ACCOUNT and cmp.t_fncash = dep.t_fncash");
      cmd.addParam("t_fncash", RsdBp_in);
      cmd.value("t_fncash") = arrFNcash;
      cmd.addParam("t_autokey", RsdBp_in);
      cmd.value("t_autokey") = arrAutoKey(i);
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();

      if(  (not SpecialAccess) and OperMayListSpecialAccounts and RS.value("SpecialAccess"))
         FIO = "XXXXXX X.X.";
         bYear = "XXXX";
      else

        if ( rs.value(0) != 0) 
           if ( ClientList.GetRecord( rs.value(0) ) )
             FIO = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
           DateSplit(ClientList.CurRec.rec.Born, bDay, bMon, bYear );
           end;
        else
           cmd_1 = RsdCommand("select t_lastname, t_firstname, t_patrname, t_birthdate from dcompens_dbt where t_fncash = ? and t_autokey = ? "); 
           cmd_1.addParam("t_fncash", RsdBp_in);
           cmd_1.value("t_fncash") = arrFNcash;
           cmd_1.addParam("t_autokey", RsdBp_in);
           cmd_1.value("t_autokey") = arrAutoKey(i);
           cmd_1.execute();
           rs_1 = RsdRecordset(cmd_1);
           rs_1.moveNext();
           FIO = rs_1.value(0) + " " + SubStr( rs_1.value(1), 1, 1 ) + ". " + SubStr( rs_1.value(2), 1, 1 ) + ".";
           DtTmSplit( rs_1.value(3), temp_date);
           if ( isDateNull(temp_date) == 0 )
              DateSplit(temp_date, bDay, bMon, bYear );
           end;
  
        end;
      end;

      cmd_1 = RsdCommand("select t_type_account from ddepositr_dbt where ddepositr_dbt.T_ACCOUNT = ? ");
      cmd_1.addParam("t_account", RsdBp_in);
      cmd_1.value("t_account") = rs.value(1);
      cmd_1.execute();
      rs_1 = RsdRecordset(cmd_1);
      if ( rs_1.moveNext() )
         Type_Account = rs_1.value(0); 
      end;

      if ( rs.value(5) != rs.value(6) )
         SumComp = String( rs.value(5):a, "\\", rs.value(6):a  );
      else
         SumComp = String(rs.value(6):a);
      end;
        PayOutofSum = PayOutofSum + rs.value(6);
      if ( rs.value(0) != rs.value(9) )
         if ( ClientList.GetRecord( rs.value(9) ) )
           FIO_pol = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
         end;
      end;
      cmd_1 = RsdCommand("select dcompens_dbt.t_date, dcompens_dbt.t_sum, dcompens_dbt.t_destaccount from dcompens_dbt "
                       "where (dcompens_dbt.t_kind <> ? or dcompens_dbt.t_appltype <> ? or dcompens_dbt.t_fncash <> ? or dcompens_dbt.t_account <> ?) "
                       "and dcompens_dbt.t_codclient = ? and dcompens_dbt.t_date <> '01.01.0001' ");
      cmd_1.addParam("t_kind", RsdBp_in);
      cmd_1.value("t_kind") = kind;
      cmd_1.addParam("t_appltype", RsdBp_in);
      cmd_1.value("t_appltype") = type;
      cmd_1.addParam("t_fncash", RsdBp_in);
      cmd_1.value("t_fncash") = arrFNcash;
      cmd_1.addParam("t_account", RsdBp_in);
      cmd_1.value("t_account") = rs.value(1);
      cmd_1.addParam("t_codclient", RsdBp_in);
      cmd_1.value("t_codclient") = rs.value(0);
      cmd_1.execute();
      rs_1 = RsdRecordset(cmd_1);
      while ( rs_1.moveNext() )
        if (count_pay < 3)
          DtTmSplit(rs_1.value(0), temp_date);
          payDate(count_pay)        = temp_date;
          paySum(count_pay)         = rs_1.value(1); 
          payDestAccount(count_pay) = rs_1.value(2); 
          count_pay = count_pay + 1;
        end;
      end;

      if ( (count_pay == 0) OR (count_pay == 1) )
         payDate(count_pay)        = " ";
         paySum(count_pay)         = " ";          
         payDestAccount(count_pay) = " "; 
         payDate(count_pay+1)        = " ";
         paySum(count_pay+1)         = " ";          
         payDestAccount(count_pay+1) = " "; 
      end;

      DtTmSplit(rs.value(7), temp_date);
      DtTmSplit(rs.value(2), dateC);

      if (isDateNull(dateC) == 1)
         dateC ="";
      end;

        [|###|#########################|#########|#############|##############################|##########|###########|#######|##########|##########|###########|#########################|##########|#########|#########################|#####################|###########|##############################|#########################|]
        (i+1, 
         FIO,
         bYear,
         Type_account,
         rs.value(1):f,
         dateC,
         rs.value(3):a,
         rs.value(4),
         rs.value(5):a,
         payDate(0) ,
         paySum(0):a:r,
         Acc_Form(String(payDestAccount(0))):f ,
         payDate(1) ,
         paySum(1):a:r  ,
         Acc_Form(String(payDestAccount(1))):f ,
         SumComp:r,
         temp_date,
         rs.value(8):f,
         FIO_pol );     
      i=i+1;
     end;
        [+---+-------------------------+---------+-------------+------------------------------+----------+-----------+-------+----------+----------+-----------+-------------------------+----------+---------+-------------------------+---------------------+-----------+------------------------------+-------------------------+];
end;

macro ListType_1_head(arrFNcash, kind, type, date1, date2 )
  var sGround = "",
      sNameBranch ="",
      sClientCatName ="";
  var i=0;

      if( not findDepartment(arrFNcash, sNameBranch) )
         sNameBranch = "НЕ найден";
      end;
      
      cmd = RsdCommand("select t_ground from dcomp_typ_dbt where t_compenstypeid = ? ");
      cmd.addParam("t_compenstypeid", RsdBp_in);
      cmd.value("t_compenstypeid") = kind;
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      if (rs.value(0) != strfor(1))
          sGround = rs.value(0);
      end;

      cmd = RsdCommand("select t_clientcatname from dcomp_cli_dbt where t_clientcatid = ? ");
      cmd.addParam("t_clientcatid", RsdBp_in);
      cmd.value("t_clientcatid") = type;
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      sClientCatName = rs.value(0);

      [  
          структурное подразделение № #
          
                                                                          Реестр начисленной компенсации в соответствии с 
                                                                                    #
                                                              (название, номер и дата нормативно-правового акта, определяющего выплату)

                                                                                           по категории 
                                                                               ######################################
                                                                 
                                                                                за период с ########## по ##########      

      ]
      (sNameBranch, sGround, sClientCatName:c, date1, date2);

      [|---+-------------------------+---------+-------------+------------------------------+----------+-----------+-------+----------+------------------------------------------------+----------------------------------------------+---------------------+-----------+------------------------------+-------------------------+
       | № |                         |  Год    |             |                              |  По      | Остаток   |Коэффи-| Сумма    |         Выплачена предварительная              |          Выплачена дополнительная            |       Сумма         |  Дата     |                              |                         |
       | пп|    Ф.И.О. вкладчика     |рождения | Вид вклада  |        № счета               |закрытым  |вклада на  | циент | компен-  |                компенсация                     |         пердарительная компенсация           |     компенсации     |зачисления |Номер счета на, который       |   Ф.И.О  наследника     |
       |   |                         |вкладчика|             |                              |вкладам   |20.06.1991г|компен-| сации    +----------+-----------+-------------------------+----------+---------+-------------------------+     подлежащая      |компенсации| зачисленна компенсация       |получившего компенсацию  |
       |   |                         |         |             |                              |          | (руб.коп) | сации |(руб.коп) | Дата     |  сумма    | номер счета, на который |   дата   |  сумма  | номер счета, на который |       выплате       |           |                              |                         |
       |   |                         |         |             |                              |  Дата    |           |       |  7*8=    |выплаты   |(руб.коп)  |       зачислена         |          |         |       зачислена         |       9-11-14=      |           |                              |                         |
       |   |                         |         |             |                              |закрытия  |           |       |          |          |           |                         |          |         |                         |                     |           |                              |                         |
       |   |                         |         |             |                              | счета    |           |       |          |          |           |                         |          |         |                         |                     |           |                              |                         |
       +---+-------------------------+---------+-------------+------------------------------+----------+-----------+-------+----------+----------+-----------+-------------------------+----------+---------+-------------------------+---------------------+-----------+------------------------------+-------------------------+
       | 1 |           2             |    3    |      4      |            5                 |    6     |     7     |   8   |    9     |  10      |   11      |           12            |    13    |   14    |          15             |    16               |    17     |              18              |            19           |
       +---+-------------------------+---------+-------------+------------------------------+----------+-----------+-------+----------+----------+-----------+-------------------------+----------+---------+-------------------------+---------------------+-----------+------------------------------+-------------------------+ ];

       ListType_1_body(arrFNcash, kind, type, date1, date2 );



end;

macro ListType_2_body(arrFNcash, kind, type, date1, date2 );
   array arrAutoKey;
   var count = isCompensPayOut(arrFNcash, kind, type, date1, date2, arrAutoKey);
   var FIO="", Type_Account="", Account="", SumComp="", FIO_pol="";
   var temp_date="",bDay="", bMon="", bYear="";
   var cmd_1, rs_1, i=0;
   var   CompenSum="",
         SumOfCompens="",
         DateComp="",
         DestAccountComp="",
         CompenSumDop="",
         SumOfCompensDop="",
         DateCompDop="",
         DestAccountCompDop="";     
   var Flag = false;
   var count_pay=0;

     count_of_account = count;

     while (i < count) 
      cmd = RsdCommand("select cmp.t_codclient, cmp.t_account, cmp.t_accClsDate, cmp.t_restIn91, cmp.t_rate, cmp.t_FullSum, cmp.t_sum,"+
                       " cmp.t_date, cmp.t_destAccount, cmp.T_DESTCLIENTCODE, cmp.t_compensedsum, dep.t_SpecialAccess as SpecialAccess "+
                       " from dcompens_dbt cmp, ddepositr_dbt dep where cmp.t_fncash = ? and cmp.t_autokey = ? "+
                       " and cmp.T_DESTACCOUNT = dep.T_ACCOUNT and cmp.t_fncash = dep.t_fncash");
      cmd.addParam("t_fncash", RsdBp_in);
      cmd.value("t_fncash") = arrFNcash;
      cmd.addParam("t_autokey", RsdBp_in);
      cmd.value("t_autokey") = arrAutoKey(i);
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      if(  (not SpecialAccess) and OperMayListSpecialAccounts and RS.value("SpecialAccess"))
         FIO = "XXXXXX X.X.";
         bYear = "XXXX";
      else

        if ( rs.value(0) != 0) 
           if ( ClientList.GetRecord( rs.value(0) ) )
             FIO = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
             DateSplit(ClientList.CurRec.rec.Born, bDay, bMon, bYear );
           end;
        else
           cmd_1 = RsdCommand("select t_lastname, t_firstname, t_patrname, t_birthdate from dcompens_dbt where t_fncash = ? and t_autokey = ? "); 
           cmd_1.addParam("t_fncash", RsdBp_in);
           cmd_1.value("t_fncash") = arrFNcash;
           cmd_1.addParam("t_autokey", RsdBp_in);
           cmd_1.value("t_autokey") = arrAutoKey(i);
           cmd_1.execute();
           rs_1 = RsdRecordset(cmd_1);
           rs_1.moveNext();
           FIO = rs_1.value(0) + " " + SubStr( rs_1.value(1), 1, 1 ) + ". " + SubStr( rs_1.value(2), 1, 1 ) + ".";
           DtTmSplit( rs.value(3), temp_date);
           if (isDateNull(temp_date) == 0)
              DateSplit(temp_date, bDay, bMon, bYear );
           end;
        end;

      end;

      PayOutofSum = PayOutofSum + rs.value(6);

      cmd_1 = RsdCommand("select t_type_account from ddepositr_dbt where ddepositr_dbt.T_ACCOUNT = ? ");
      cmd_1.addParam("t_account", RsdBp_in);
      cmd_1.value("t_account") = rs.value(1);
      cmd_1.execute();
      rs_1 = RsdRecordset(cmd_1);
      if (rs_1.moveNext())
         Type_Account = rs_1.value(0); 
      end;

      if ( rs.value(0) != rs.value(9) )
         if ( ClientList.GetRecord( rs.value(9) ) )
           FIO_pol = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
         end;
      end;
      
//-------Заполнение столбцов 8,10-12 и 14-17------------------------------------------------------------
      
      cmd_1 = RsdCommand("select dcompens_dbt.t_date, dcompens_dbt.t_sum, dcompens_dbt.t_destaccount, dcompens_dbt.t_compensedsum, dcompens_dbt.t_fullsum from dcompens_dbt "
                       "where (dcompens_dbt.t_kind <> ? or dcompens_dbt.t_appltype <> ? or dcompens_dbt.t_fncash <> ? or dcompens_dbt.t_account <> ? ) "
                       "and dcompens_dbt.t_codclient = ? and dcompens_dbt.t_date <> '01.01.0001' ");
      cmd_1.addParam("t_kind", RsdBp_in);
      cmd_1.value("t_kind") = kind;
      cmd_1.addParam("t_appltype", RsdBp_in);
      cmd_1.value("t_appltype") = type;
      cmd_1.addParam("t_fncash", RsdBp_in);
      cmd_1.value("t_fncash") = arrFNcash;
      cmd_1.addParam("t_account", RsdBp_in);
      cmd_1.value("t_account") = rs.value(1);
      cmd_1.addParam("t_codclient", RsdBp_in);
      cmd_1.value("t_codclient") = rs.value(0);
      cmd_1.execute();
      rs_1 = RsdRecordset(cmd_1);
      if ( rs_1.moveNext() )
         CompenSumDop = rs_1.value(3);
         if ( rs_1.value(1) != rs_1.value(4) )
            SumOfCompensDop = String(rs_1.value(4):a) + "\\" + String(rs_1.value(1):a);
         else
            SumOfCompensDop = String(rs_1.value(1):a);
         end;
         DtTmSplit(rs_1.value(0), temp_date);
         DateCompDop = temp_date;
         DestAccountCompDop = rs_1.value(2);
         Flag = true;
      end;


      if ( NOT(Flag) )
         if ( rs.value(5) != rs.value(6) )
            SumOfCompens = String(rs.value(5):a) + "\\" + String(rs.value(6):a);
         else
            SumOfCompens = String(rs.value(6):a);
         end;
           CompenSum = rs.value(10);
           DtTmSplit(rs.value(7), temp_date);
           DateComp = temp_date;
           DestAccountComp = rs.value(8);
      end;
        DtTmSplit(rs.value(2), temp_date);
        if (isDateNull(temp_date) == 1)
           temp_date = "";
        end;
//          1                 2               3          4              5                            6         7          8           9     10                       11          12                             13                         14      15                   16          17
        [|###|#########################|#########|#############|##############################|##########|###########|###########|#######|####################|###########|##############################|########################|##########|####################|########|###############################|]  
        (i+1, 
         FIO,
         bYear,
         Type_account,
         rs.value(1):f,
         temp_date,
         rs.value(3):a,
         CompenSum:a,
         rs.value(4),
         SumOfCompens:r,
         DateComp,
         Acc_Form(String(DestAccountComp)):f,
         FIO_pol,
         CompenSumDop:a:r,
         SumOfCompensDop:r,
         DateCompDop,
         Acc_Form(String(DestAccountCompDop)):f );     
     i=i+1;
     end;
        [+---+-------------------------+---------+-------------+------------------------------+----------+-----------+-----------+-------+--------------------+-----------+------------------------------+------------------------+----------+--------------------+--------+-------------------------------+]; 
end;



macro ListType_2_head(arrFNcash, kind, type, date1, date2 )
  var sGround = "",
      sNameBranch ="",
      sClientCatName ="";
  var i=0;

      if( not findDepartment(arrFNcash, sNameBranch) )
         sNameBranch = "НЕ найден";
      end;
      
      cmd = RsdCommand("select t_ground from dcomp_typ_dbt where t_compenstypeid = ? ");
      cmd.addParam("t_compenstypeid", RsdBp_in);
      cmd.value("t_compenstypeid") = kind;
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      if (rs.value(0) != strfor(1))
          sGround = rs.value(0);
      end;

      cmd = RsdCommand("select t_clientcatname from dcomp_cli_dbt where t_clientcatid = ? ");
      cmd.addParam("t_clientcatid", RsdBp_in);
      cmd.value("t_clientcatid") = type;
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      sClientCatName = rs.value(0);

      [  
         структурное подразделение № #
          
                                                           Реестр счетов по вкладам, подлежащим предварительной компенсации в соответствии с 
                                                                            #
                                                              (название, номер и дата нормативно-правового акта, определяющего выплату)

                                                                                          по категории 
                                                                             ########################################
                                                                 
                                                                               за период с ########## по ########## 

      ]
      (sNameBranch, sGround, sClientCatName:c, date1, date2);

      [|---+-------------------------+---------+-------------+------------------------------+----------+-----------+-----------+-------+--------------------+-----------+------------------------------+------------------------+----------+--------------------+--------+-------------------------------+
       | № |                         |  Год    |    Вид      |                              |  По      | Остаток   |   Сумма   |Коэффи-|      Сумма         |  Дата     |                              |                        |  Сумма   |      Сумма         | Дата   |                               |
       | пп|  Ф.И.О.  вкладчика      |рождения |   вклада    |         № счета              |закрытым  |вклада на  |  вклада,  | циент |    компенсации     |зачисления |    Номер счета на,           |   Ф.И.О наследника     | вклада,  |       доп.         |зачисл. |   № счета, на который         |
       |   |                         |вкладчика|             |                              |вкладам   |20.06.1991г|подлежащая |компен-|     (руб.коп)      |компенсации|   который зачисленна         |      получившего       |подлежащая|    компенсации     | доп.   |зачислена доп. компенсация     |            |
       |   |                         |         |             |                              |          | (руб.коп) |компенсации| сации |                    |           |      компенсация             |      компенсацию       |   доп.   |                    |компенс.|                               |
       |   |                         |         |             |                              |  Дата    |           |           |       |                    |           |                              |                        |компенса- |                    |        |                               |
       |   |                         |         |             |                              |закрытия  |           |           |       |                    |           |                              |                        |   ции    |                    |        |                               |
       |   |                         |         |             |                              | счета    |           |           |       |                    |           |                              |                        |          |                    |        |                               |
       +---+-------------------------+---------+-------------+------------------------------+----------+-----------+-----------+-------+--------------------+-----------+------------------------------+------------------------+----------+--------------------+--------+-------------------------------+
       | 1 |           2             |    3    |      4      |            5                 |   6      |     7     |     8     |   9   |         10         |    11     |           12                 |           13           |   14     |         15         |   16   |            17                 |
       +---+-------------------------+---------+-------------+------------------------------+----------+-----------+-----------+-------+--------------------+-----------+------------------------------+------------------------+----------+--------------------+--------+-------------------------------+ ];


       ListType_2_body(arrFNcash, kind, type, date1, date2 );



end;

macro ListType_3_body(arrFNcash, kind, type, date1, date2 );
   array arrAutoKey;
   var count = isCompensPayOut(arrFNcash, kind, type, date1, date2, arrAutoKey);
   var FIO="", Type_Account="", SumComp="", FIO_pol="";
   var temp_date="",bDay="", bMon="", bYear="";
   var cmd_1, rs_1,i=0;
   var Flag = false;
   var CloseDate="", AccAccount="", Rest="";

   var count_pay=0;
     count_of_account = count;
     while (i < count) 
      cmd = RsdCommand("select cmp.t_codclient, cmp.t_account, cmp.t_accClsDate, cmp.t_restIn91,"+
                       "  cmp.t_FullSum, cmp.t_sum, cmp.t_date, cmp.t_destAccount, cmp.T_DESTCLIENTCODE, dep.t_SpecialAccess as SpecialAccess "+
                       "from dcompens_dbt cmp, ddepositr_dbt dep  where t_fncash = ? and t_autokey = ? "+
                       " and cmp.T_DESTACCOUNT = dep.T_ACCOUNT and cmp.t_fncash = dep.t_fncash");
      cmd.addParam("t_fncash", RsdBp_in);
      cmd.value("t_fncash") = arrFNcash;
      cmd.addParam("t_autokey", RsdBp_in);
      cmd.value("t_autokey") = arrAutoKey(i);
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      if(  (not SpecialAccess) and OperMayListSpecialAccounts and RS.value("SpecialAccess"))
         FIO = "XXXXXX X.X.";
         bYear = "XXXX";
      else

        if ( rs.value(0) != 0) 
           if ( ClientList.GetRecord( rs.value(0) ) )
             FIO = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
           DateSplit(ClientList.CurRec.rec.Born, bDay, bMon, bYear );
           end;
        else
           cmd_1 = RsdCommand("select t_lastname, t_firstname, t_patrname, t_birthdate from dcompens_dbt where t_fncash = ? and t_autokey = ? "); 
           cmd_1.addParam("t_fncash", RsdBp_in);
           cmd_1.value("t_fncash") = arrFNcash;
           cmd_1.addParam("t_autokey", RsdBp_in);
           cmd_1.value("t_autokey") = arrAutoKey(i);
           cmd_1.execute();
           rs_1 = RsdRecordset(cmd_1);
           rs_1.moveNext();
           FIO = rs_1.value(0) + " " + SubStr( rs_1.value(1), 1, 1 ) + ". " + SubStr( rs_1.value(2), 1, 1 ) + ".";
           DtTmSplit( rs.value(3), temp_date);
           if (isDateNull(temp_date) == 0)
              DateSplit(temp_date, bDay, bMon, bYear );
           end;
        end;
      end;
      cmd_1 = RsdCommand("select t_type_account from ddepositr_dbt where ddepositr_dbt.T_ACCOUNT = ? ");
      cmd_1.addParam("t_account", RsdBp_in);
      cmd_1.value("t_account") = rs.value(1);
      cmd_1.execute();
      rs_1 = RsdRecordset(cmd_1);
      if (rs_1.moveNext())
         Type_Account = rs_1.value(0); 
      end;

      if ( ClientList.GetRecord( rs.value(8) ) )
         FIO_pol = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
      end;
      if ( rs.value(4) != rs.value(5) )
         SumComp = String(rs.value(4):a) + "\\" + String(rs.value(5):a);
      else
         SumComp = String(rs.value(5):a);
      end;

      PayOutofSum = PayOutofSum + rs.value(5);      

      DtTmSplit(rs.value(2), temp_date);
      if (isDateNull(temp_date) == 1)
         temp_date = ""; 
      end;
      CloseDate = string(temp_date) + " ";
      AccAccount = String(Acc_Form(String(rs.value(1))):f) + " ";
      Rest = String(rs.value(3):a) + " ";
      
      cmd_1 = RsdCommand("select dcomp_acc_dbt.t_close_date, dcomp_acc_dbt.T_RESTLN20061991, ddepositr_dbt.t_account from dcomp_acc_dbt, ddepositr_dbt "
                         "where dcomp_acc_dbt.t_fncash = ? and dcomp_acc_dbt.t_autokey = ? and  ddepositr_dbt.t_referenc = dcomp_acc_dbt.t_referenc ");
      cmd_1.addParam("t_fncash", RsdBp_in);
      cmd_1.value("t_fncash") = arrFNcash;
      cmd_1.addParam("t_autokey", RsdBp_in);
      cmd_1.value("t_autokey") = arrAutoKey(i);
      cmd_1.execute();
      rs_1 = RsdRecordset(cmd_1);

      while( rs_1.moveNext() )
         temp_date = "";
         DtTmSplit(rs_1.value(0), temp_date);
         if (isDateNull(temp_date) == 1)
            temp_date = "";
         end;   
         CloseDate = CloseDate + string(temp_date) + " ";
         AccAccount = AccAccount + String(Acc_Form(String(rs_1.value(2))):f) + " ";
         Rest = Rest + string(rs_1.value(1):a) + " ";
      end;

        DtTmSplit(rs.value(6), temp_date);

//          1                2                 3                  4                          5         6          7                    8                    9              10            11
        [|###|#########################|#############|###############################|###########|###########|###########|#####################|########################|##########|###############################|]  
        (i+1, 
         FIO,
         Type_Account,
         AccAccount:w,
         CloseDate:w,
         Rest:w:r,
         rs.value(3):a,
         SumComp:r,
         FIO_pol,
         temp_date,
         rs.value(7):f );     
      i=i+1;
     end;
        [+---+-------------------------+-------------+-------------------------------+-----------+-----------+-----------+---------------------+------------------------+----------+-------------------------------+];
end;



macro ListType_3_head(arrFNcash, kind, type, date1, date2 )
  var sGround = "",
      sNameBranch ="",
      sClientCatName ="";
  var i=0;

      if( not findDepartment(arrFNcash, sNameBranch) )
         sNameBranch = "НЕ найден";
      end;
      
      cmd = RsdCommand("select t_ground from dcomp_typ_dbt where t_compenstypeid = ? ");
      cmd.addParam("t_compenstypeid", RsdBp_in);
      cmd.value("t_compenstypeid") = kind;
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      if (rs.value(0) != strfor(1))
          sGround = rs.value(0);
      end;

      cmd = RsdCommand("select t_clientcatname from dcomp_cli_dbt where t_clientcatid = ? ");
      cmd.addParam("t_clientcatid", RsdBp_in);
      cmd.value("t_clientcatid") = type;
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      sClientCatName = rs.value(0);

      [  
         структурное подразделение № #
          
                                                           Реестр счетов по вкладам, подлежащим предварительной компенсации в соответствии с 
                                                                              #
                                                              (название, номер и дата нормативно-правового акта, определяющего выплату)

                                                                                           по категории 
                                                                              ########################################
                                                                 
                                                                                за период с ########## по ########## 

      ]
      (sNameBranch, sGround, sClientCatName:c, date1, date2);

      [|---+-------------------------+-------------+-------------------------------+-----------+-----------+-----------+---------------------+------------------------+----------+-------------------------------+
       | № |                         |    Вид      |                               |  По       | Остатки   |   Общая   |       Сумма         |                        |  Дата    |                               |
       | пп|  Ф.И.О.  вкладчика      |   вклада    |       № № счетов              |закрытым   |вкладов на |   сумма   |    компенсации,     |   Ф.И.О наследника     | зачисл.  |   № счета, на который         |
       |   |                         |             |                               |вкладам    |20.06.1991г|вкладов, на|    выплаченная      |                        | компенс. |  зачислена компенсация        |            
       |   |                         |             |                               |           | (руб.коп) |20.06.1991 |    наследнику       |                        |          |                               |
       |   |                         |             |                               |  Дата     |           |           |                     |                        |          |                               |
       |   |                         |             |                               |закрытия   |           |           |                     |                        |          |                               |
       |   |                         |             |                               | счета     |           |           |                     |                        |          |                               |
       +---+-------------------------+-------------+-------------------------------+-----------+-----------+-----------+---------------------+------------------------+----------+-------------------------------+
       | 1 |           2             |      3      |            4                  |    5      |     6     |     7     |          8          |            9           |   10     |               11              |
       +---+-------------------------+-------------+-------------------------------+-----------+-----------+-----------+---------------------+------------------------+----------+-------------------------------+ ];  


       ListType_3_body(arrFNcash, kind, type, date1, date2 );



end;

macro ListType_4_body(arrFNcash, kind, type, date1, date2 )
   array arrAutoKey;
   var count = isCompensPayOut(arrFNcash, kind, type, date1, date2, arrAutoKey);
   var FIO="", SumComp="", FIO_pol="";
   var temp_date="",bDay="", bMon="", bYear="";
   var cmd_1, rs_1, cmd_2, rs_2,i=0;
   var payDate=" ", paySum=" ", payDestAccount=" ", payFIO=" ";
   var doplDate=" ", doplSum=" ", doplDestAccount=" ", doplFIO=" ";
   var Flag = false;
    
   var CloseDate="", AccAccount="", Rest="", Type_Account="";

   var count_pay=0;
     count_of_account = count;
     while (i < count) 
      cmd = RsdCommand("select cmp.t_codclient, cmp.t_account, cmp.t_accClsDate, cmp.t_restIn91, cmp.t_FullSum, cmp.t_sum, cmp.t_date,"+
                       " cmp.t_destAccount, cmp.T_DESTCLIENTCODE, dep.t_SpecialAccess as SpecialAccess "+
                       "from dcompens_dbt cmp, ddepositr_dbt dep where cmp.t_fncash = ? and cmp.t_autokey = ? "+
                       " and cmp.T_DESTACCOUNT = dep.T_ACCOUNT and cmp.t_fncash = dep.t_fncash");
      cmd.addParam("t_fncash", RsdBp_in);
      cmd.value("t_fncash") = arrFNcash;
      cmd.addParam("t_autokey", RsdBp_in);
      cmd.value("t_autokey") = arrAutoKey(i);
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      if(  (not SpecialAccess) and OperMayListSpecialAccounts and RS.value("SpecialAccess"))
         FIO = "XXXXXX X.X.";
         bYear = "XXXX";
      else

        if ( rs.value(0) != 0) 
           if ( ClientList.GetRecord( rs.value(0) ) )
             FIO = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
           DateSplit(ClientList.CurRec.rec.Born, bDay, bMon, bYear );
           end;
        else
           cmd_1 = RsdCommand("select t_lastname, t_firstname, t_patrname, t_birthdate from dcompens_dbt where t_fncash = ? and t_autokey = ? "); 
           cmd_1.addParam("t_fncash", RsdBp_in);
           cmd_1.value("t_fncash") = arrFNcash;
           cmd_1.addParam("t_autokey", RsdBp_in);
           cmd_1.value("t_autokey") = arrAutoKey(i);
           cmd_1.execute();
           rs_1 = RsdRecordset(cmd_1);
           rs_1.moveNext();
           FIO = rs_1.value(0) + " " + SubStr( rs_1.value(1), 1, 1 ) + ". " + SubStr( rs_1.value(2), 1, 1 ) + ".";
           DtTmSplit( rs.value(3), temp_date);
           if (isDateNull(temp_date) == 0)
              DateSplit(temp_date, bDay, bMon, bYear );
           end;
        end;
      end;
         PayOutofSum = PayOutofSum + rs.value(5);      

//------------- 3-6 ----------------------------------- 
         cmd_1 = RsdCommand("select t_type_account from ddepositr_dbt where ddepositr_dbt.T_ACCOUNT = ? ");
         cmd_1.addParam("t_account", RsdBp_in);
         cmd_1.value("t_account") = rs.value(1);
         cmd_1.execute();
         rs_1 = RsdRecordset(cmd_1);
         if (rs_1.moveNext())
            Type_Account = rs_1.value(0) + " ";
         end;
         DtTmSplit(rs.value(2), temp_date);
         if (isDateNull(temp_date) == 1)
            temp_date = "";
         end;
         CloseDate = String(temp_date) + " ";
         AccAccount = String(Acc_Form(String(rs.value(1))):f) + " ";
         Rest = String(rs.value(3):a) + " ";
//------------- 3-6 end-------------------------------- 

      cmd_1 = RsdCommand("select dcomp_acc_dbt.t_close_date, dcomp_acc_dbt.T_RESTLN20061991, ddepositr_dbt.t_account from dcomp_acc_dbt, ddepositr_dbt " 
                       "where dcomp_acc_dbt.t_fncash = ? and dcomp_acc_dbt.t_autokey = ? and  ddepositr_dbt.t_referenc = dcomp_acc_dbt.t_referenc ");
      cmd_1.addParam("t_fncash", RsdBp_in);
      cmd_1.value("t_fncash") = arrFNcash;
      cmd_1.addParam("t_autokey", RsdBp_in);
      cmd_1.value("t_autokey") = arrAutoKey(i);
      cmd_1.execute();
      rs_1 = RsdRecordset(cmd_1);
      while ( rs_1.moveNext() )
//------------- 3-6 ----------------------------------- 
         cmd_2 = RsdCommand("select t_type_account from ddepositr_dbt where ddepositr_dbt.T_ACCOUNT = ? ");
         cmd_2.addParam("t_account", RsdBp_in);
         cmd_2.value("t_account") = rs_1.value(2);
         cmd_2.execute();
         rs_2 = RsdRecordset(cmd_2);
         rs_2.moveNext(); 
         Type_Account = Type_Account + rs_2.value(0) + " ";
         DtTmSplit(rs_1.value(0), temp_date);
         if (isDateNull(temp_date) == 1)
            temp_date = "";
         end;
         CloseDate = CloseDate + string(temp_date) + " ";
         AccAccount = AccAccount + String(Acc_Form(String(rs_1.value(2))):f) + " ";
         Rest = Rest + string(rs_1.value(1):a) + " ";
//------------- 3-6 end-------------------------------- 
//-----------------------------------------------------
//------------- 13-16 ---------------------------------
         DtTmSplit(rs.value(6), temp_date);
         doplDate = temp_date;
         if ( rs.value(4) != rs.value(5) )
            doplSum = String(rs.value(4):a) + "\\" + String(rs.value(5):a);
         else
            doplSum = String(rs.value(5):a);
         end;
         doplDestAccount = String(Acc_Form(String(rs.value(7))):f);
         if ( ClientList.GetRecord( rs.value(8) ) )
            doplFIO = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
         end;
//------------- 13-16 end------------------------------ 
         Flag = true;
      end;
      if ( NOT(Flag) )
//-----------------------------------------------------
//------------- 9-12 ---------------------------------- 
         DtTmSplit(rs.value(6), temp_date);
         payDate = temp_date;
         if ( rs.value(4) != rs.value(5) )
            paySum = String(rs.value(4):a) + "\\" + String(rs.value(5):a);
         else
            paySum = String(rs.value(5):a);
         end;
         payDestAccount = String(Acc_Form(String(rs.value(7))):f);
         if ( ClientList.GetRecord( rs.value(8) ) )
            payFIO = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
         end;
//------------- 9-12 end------------------------------- 
      end;

      if ( ClientList.GetRecord( rs.value(8) ) )
         FIO_pol = ClientList.CurRec.rec.name1 + " " + SubStr( ClientList.CurRec.rec.name2, 1, 1 ) + ". " + SubStr( ClientList.CurRec.rec.name3, 1, 1 ) + ".";
      end;
      if ( rs.value(4) != rs.value(5) )
         SumComp = String(rs.value(4):a) + "\\" + String(rs.value(5):a);
      else
         SumComp = String(rs.value(5):a);
      end;


        [|###|#########################|#############|###########################|##########|###########|##########|##########|##########|##########|#########################|#########################|#######################|##########################|###########|##########################|]
        (i+1, 
         FIO,
         Type_Account:w,
         AccAccount:w,
         CloseDate:w,
         Rest:w:r,
         rs.value(3):a,
         rs.value(4):a,
         paySum:r,
         payDate,
         payFIO, 
         payDestAccount,
         doplSum:r,
         doplFIO,
         doplDate,
         doplDestAccount );
     i=i+1;
     end;
        [+---+-------------------------+-------------+---------------------------+----------+-----------+----------+----------+----------+----------+-------------------------+-------------------------+-----------------------+--------------------------+-----------+--------------------------+];
end;

macro ListType_4_head(arrFNcash, kind, type, date1, date2 )
  var sGround = "",
      sNameBranch ="",
      sClientCatName ="";
  var i=0;

      if( not findDepartment(arrFNcash, sNameBranch) )
         sNameBranch = "НЕ найден";
      end;
      
      cmd = RsdCommand("select t_ground from dcomp_typ_dbt where t_compenstypeid = ? ");
      cmd.addParam("t_compenstypeid", RsdBp_in);
      cmd.value("t_compenstypeid") = kind;
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      if (rs.value(0) != strfor(1))
          sGround = rs.value(0);
      end;

      cmd = RsdCommand("select t_clientcatname from dcomp_cli_dbt where t_clientcatid = ? ");
      cmd.addParam("t_clientcatid", RsdBp_in);
      cmd.value("t_clientcatid") = type;
      cmd.execute();
      rs = RsdRecordset(cmd);
      rs.moveNext();
      sClientCatName = rs.value(0);

      [  
         структурное подразделение № #

                                                               Реестр счетов по вкладам, подлежащим предварительной компенсации в соответствии с 
                                                                                #
                                                                  (название, номер и дата нормативно-правового акта, определяющего выплату)

                                                                                               по категории 
                                                                                #############################################
                                                                     
                                                                                    за период с ########## по ########## 

      ]
      (sNameBranch, sGround, sClientCatName:c, date1, date2);

      [|---+-------------------------+-------------+---------------------------+----------+-----------+----------+----------+-------------------------------------------------------------------------+-----------------------+--------------------------+-----------+--------------------------+
       | № |                         |             |                           |  По      | Остаток   |  Общая   | Сумма    |          Предварительная компенсация, выплаченная наследнику            |     Сумма             |                          |   Дата    |                          |
       | пп|    Ф.И.О. вкладчика     | Вид вклада  |       № № счетов          |закрытым  |вклада на  |  сумма   | компен-  |                                                                         |    доплаты            |  Ф.И.О. наследника(ов),  |зачисления |Номер счета на, который   |
       |   |                         |             |                           |вкладам   |20.06.1991г| вкладов  | сации    +----------+----------+-------------------------+-------------------------+   подлежащая          | получившего(их) доплату  |  доплаты  |   зачисленна доплата     |
       |   |                         |             |                           |          | (руб.коп) |    на    |исходя из |  Сумма   |  Дата    |   Ф.И.О. наследника     | номер счета, на который |    выплате            |      компенсации         |компенсации|      компенсации         |
       |   |                         |             |                           |  Дата    |           | 20.06.91 |  общего  |          |          |                         |       зачислена         |   наследнику          |                          |           |                          |
       |   |                         |             |                           |закрытия  |           |          | остатка  |          |          |                         |                         |                       |                          |           |                          |
       |   |                         |             |                           | счета    |           |          | вкладов  |          |          |                         |                         |                       |                          |           |                          |
       +---+-------------------------+-------------+---------------------------+----------+-----------+----------+----------+----------+----------+-------------------------+-------------------------+-----------------------+--------------------------+-----------+--------------------------+
       | 1 |           2             |      3      |            4              |    5     |     6     |    7     |    8     |    9     |    10    |           11            |           12            |       13              |           14             |    15     |           16             |
       +---+-------------------------+-------------+---------------------------+----------+-----------+----------+----------+----------+----------+-------------------------+-------------------------+-----------------------+--------------------------+-----------+--------------------------+ ];

       ListType_4_body(arrFNcash, kind, type, date1, date2 );



end;


macro run_listtype(arrFNcash, count_fncash, kind, arrType, count_appltype, date1, date2)
  var i=0, j=0, temp_i	;

 while (j < count_fncash)
  while (i < count_appltype)
    if ( (arrType(i) == AT73) OR
         (arrType(i) == AT04) OR
         (arrType(i) == AT77) OR
         (arrType(i) == AT09) OR
         (arrType(i) == AT85) OR
         (arrType(i) == AT87) OR
         (arrType(i) == AT88) )
            ListType_1_head(arrFNcash(j), kind, arrType(i), date1, date2 );

    elif (arrType(i) == AT82)
            ListType_3_head(arrFNcash(j), kind, arrType(i), date1, date2 );

    elif ( (arrType(i) == AT81) OR
           (arrType(i) == AT83) OR
           (arrType(i) == AT98) OR
           (arrType(i) == AT99) )
            ListType_4_head(arrFNcash(j), kind, arrType(i), date1, date2 );
    else        
         if (arrType(i) != -1)
            ListType_2_head(arrFNcash(j), kind, arrType(i), date1, date2 );
         else
            temp_i = i+1;
            i = count_appltype;
         end;
    end;
    if (i < count_appltype)
       EndofList(count_of_account, PayOutofSum);
    end;
    PayOutofSum = $0;
    i = i + 1;
  end;
  j = j + 1;
  i = temp_i;
  
 end;
end;

MACRO listCompens2004(kind, type, date1, date2, fncash)
var count_fncash=0, count_appltype=0;
array arrFNcash, arrType;
var cmd_1, rs_1;	

 if ( type != -1 )
    if (fncash != 0)
       arrFNcash(count_fncash) = fncash;
       count_fncash = 1;
    elif (fncash == 0)
       cmd = RsdCommand(" select DISTINCT(dcompens_dbt.t_fncash) from dcompens_dbt where "
                        " dcompens_dbt.t_kind = ? and dcompens_dbt.t_date between ? and ? and dcompens_dbt.t_appltype = ?"
                        " order by dcompens_dbt.t_fncash");
       cmd.addParam("T_kind", RsdBp_in);
       cmd.value("T_kind") = kind;
       cmd.addParam("t_date1", RsdBp_in);
       cmd.value("t_date1") = date1;
       cmd.addParam("t_date2", RsdBp_in);
       cmd.value("t_date2") = date2;
       cmd.addParam("t_appltype", RsdBp_in);
       cmd.value("t_appltype") = type;
       cmd.execute;
       rs = RsdRecordset(cmd);
       while ( rs.moveNext() )
          arrFNcash(count_fncash) = rs.value(0);
          count_fncash = count_fncash + 1;
       end;
    end;
    arrType(count_appltype) = type;
    count_appltype = 1;
    run_listtype(arrFNcash, count_fncash, kind, arrType, count_appltype, date1, date2);

 elif (type == -1)
    if (fncash != 0)
       arrFNcash(count_fncash) = fncash;
       count_fncash = 1;
       cmd_1 = RsdCommand(" select DISTINCT(dcompens_dbt.t_appltype) from dcompens_dbt, dcomp_lnk_dbt where "
                        " dcompens_dbt.t_fncash = ? and dcompens_dbt.t_kind = ? and dcompens_dbt.t_kind = dcomp_lnk_dbt.t_compenstypeid "
                        " and dcomp_lnk_dbt.t_clientcatid = dcompens_dbt.t_appltype and dcompens_dbt.t_date between ? and ? order by dcompens_dbt.t_appltype");
       cmd_1.addParam("T_fncash", RsdBp_in);
       cmd_1.value("T_fncash") = fncash;
       cmd_1.addParam("T_kind", RsdBp_in);
       cmd_1.value("T_kind") = kind;
       cmd_1.addParam("t_date", RsdBp_in);
       cmd_1.value("t_date") = date1;
       cmd_1.addParam("t_date2", RsdBp_in);
       cmd_1.value("t_date2") = date2;
       cmd_1.execute;
       rs_1 = RsdRecordset(cmd_1);
       while ( rs_1.moveNext() )
            arrType(count_appltype) = rs_1.value(0);
            count_appltype = count_appltype + 1;
       end;
       arrType(count_appltype) = -1;

    elif (fncash == 0)
       cmd = RsdCommand(" select DISTINCT(dcompens_dbt.t_fncash) from dcompens_dbt where "
                        " dcompens_dbt.t_kind = ? and dcompens_dbt.t_date between ? and ? "
                        " order by dcompens_dbt.t_fncash");
       cmd.addParam("T_kind", RsdBp_in);
       cmd.value("T_kind") = kind;
       cmd.addParam("t_date", RsdBp_in);
       cmd.value("t_date") = date1;
       cmd.addParam("t_date2", RsdBp_in);
       cmd.value("t_date2") = date2;
       cmd.execute;
       rs = RsdRecordset(cmd);
       while ( rs.moveNext() )
          arrFNcash(count_fncash) = rs.value(0);
          count_fncash = count_fncash + 1;

          cmd_1 = RsdCommand(" select DISTINCT(dcompens_dbt.t_appltype) from dcompens_dbt, dcomp_lnk_dbt where "
                           " dcompens_dbt.t_fncash = ? and dcompens_dbt.t_kind = ? and dcompens_dbt.t_kind = dcomp_lnk_dbt.t_compenstypeid "
                           " and dcomp_lnk_dbt.t_clientcatid = dcompens_dbt.t_appltype and dcompens_dbt.t_date between ? and ? order by dcompens_dbt.t_appltype");
          cmd_1.addParam("T_fncash", RsdBp_in);
          cmd_1.value("T_fncash") = rs.value(0);
          cmd_1.addParam("T_kind", RsdBp_in);
          cmd_1.value("T_kind") = kind;
          cmd_1.addParam("t_date", RsdBp_in);
          cmd_1.value("t_date") = date1;
          cmd_1.addParam("t_date2", RsdBp_in);
          cmd_1.value("t_date2") = date2;
          cmd_1.execute;
          rs_1 = RsdRecordset(cmd_1);
          while ( rs_1.moveNext() )
               arrType(count_appltype) = rs_1.value(0);
               count_appltype = count_appltype + 1;
          end;
          arrType(count_appltype) = -1;
          count_appltype = count_appltype + 1;

       end;
    end;

    run_listtype(arrFNcash, count_fncash, kind, arrType, count_appltype, date1, date2);

 end;

END;

