/*
$Name:               BusinessRule_scala.mac
$Module:             DEPOSITR
$Description:        для вызова функций БП из скалы
*/
/*
*/
import commonInter, deposInter, deskInter, wf_log, wf_appUtils, dep_utils, operCode, BankInter;
private const STEP_EXEC_ERROR = 4662;

macro getTarifSumFromScala(paramStr : String) : String //(CodCur : Integer, NumTarif: Integer, needDate: Date, convDate: Date, needDate : money)

  var inParams = TParameters(paramStr);
  var sumout:money = $0;
  var numTarif = inParams.get("NumTarif");
  var CodCur = inParams.get("CodCur");
  var needDate = inParams.get("needDate");
  var convDate = inParams.get("convDate");
  var SumOper = inParams.get("SumOper");

  var stat = CalculateTarifEx(numTarif, CodCur, needDate, convDate, SumOper, sumout);

  var outParams = handleResult(0);
  outParams.add("RetVal", stat);
  outParams.add("SumTarif", sumout);
  return outParams.toString;
  onError(e)
  return handleResult(STEP_EXEC_ERROR, e.message).toString;     
end;

macro GetRegValFromScala(paramStr : String) : String
  var inParams = TParameters(paramStr);
  var RetVal = GetRegVal( inParams.get("RegVal"), false );
  var outParams = handleResult(0);
  outParams.add("Value", RetVal);
  return outParams.toString;
  onError(e)
  return handleResult(STEP_EXEC_ERROR, e.message).toString;     
end;

macro GetCB_GetParentFilial(paramStr : String) : String
  var inParams = TParameters(paramStr);
  var Depart = 0;
  var RetVal = CB_GetParentFilial( inParams.get("Code"), Depart );
  var outParams = handleResult(0);
  outParams.add("stat", RetVal);
  outParams.add("ParentFilial", Depart);
  return outParams.toString;
  onError(e)
  return handleResult(STEP_EXEC_ERROR, e.message).toString;     
end;

macro ScalaConvertSumEx
(
  CurrencyFrom : integer,
  CurrencyTo : integer,
  AmountFrom : money,
  ConvertDate : string,
  RateKindID : integer,
  RateChange : integer,
  TypeCalcRate : integer,
  crossCalcType : integer,
  flagCommission : bool
  )

  record convdata("convert_cum_data.rsl");
  var data;

  var stat = ConvertSumEx(CurrencyFrom, CurrencyTo, AmountFrom, date(ConvertDate), RateKindID, RateChange, TypeCalcRate, crossCalcType, flagCommission, data );

  if ( stat == 0 )
    SetBuff(convdata,data);
    return convdata.ToSumma;
  end;
  return stat;
end;