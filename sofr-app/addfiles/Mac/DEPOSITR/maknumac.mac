/*********************************************************
*  Retail 1.0                                            *
*                                                        *
*  Макрос при формировании номера  счета вкладчика       *
*                                                        *
*  13.02.98                                              *
*********************************************************/

record dr  ("depositr.dbt");

file   fdr (depositr) key 8 write;


/****************************************************************
****************************************************************/
macro MakNumAc    /* !!! Имя макропроцедуры должно соответствовать !!! */
(                 /* !!! имени файла                               !!! */
 depos
)

  setbuff(dr, depos);

/* *********************************************************  
   ОБРАЗЕЦ.
   *********************************************************
   Все изменения в записи по счетеу должны быть сохранены в 
   файле и в буфере. Для этого предлагается следующий алгоритм:
   1. Поиск в файле записи по счету (по полю Referenc). Эта
      запись в файл внесена, несмотря на то, что счет новый
      (в процессе открытия)
   2. Вносим все изменения в найденную строку
   3. Выполняем обновление строки по счету (Update)
   4. Все измененные поля копируем в переданный буфер

   Пример смотри ниже.

  fdr.Referenc = dr.Referenc;
  if (GetEQ(fdr))
    fdr.Account = String (100000000 + fdr.Number);
    if (NOT Update(fdr))
      MsgBox ("Общая инициализация: Ошибка при обновлении файла счетов");
    else
      dr.Account = fdr.Account;
    end;
  else
    MsgBox ("Общая инициализация: не найдена запись по счету");
  end;
********************************************************* */
end;
