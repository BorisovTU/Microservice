/*
  RS-Retail 5.1
  Шаг "Ограничение на доп.взносы" 
  операции "Доп.взнос"
------------------------------------------------------------
  Вид вклада- "Юбилейная рента- 2 года"
------------------------------------------------------------
   По прошествии года с начала договора доп.взносы запрещены
------------------------------------------------------------
    Ромодин Александр Васильевич
    28 августа 2002 г.
*/
Import deprintr, alg_vars, OperCode;


/* ##### Точка входа ##### */

  var StartDate;
  var TestDate,
      d,m,y;
  ALG_RESULT = SKIP_RES;

  if ( ( ALG_SBDEPDOC.TypeOper == Зачисление_По_Данным_ПК ) and ( ALG_SBDEPDOC.ApplType == 14 ) )
    return;
  end;

  if ( (StrFor(GetProgramID) == "П")            /* Последующий контроль */
   AND (CodeFor(ALG_SBDEPDOC.FlagStorn) != 0) ) /* Сторнирование */
    ALG_RESULT = OK_RES;
  elif (ALG_DEPOSITOR.UseAlternate != 0)
    MsgBox ("Договор завершен либо нарушен- доп.взносы запрещены");
    ALG_RESULT = ERR_RES;
  else
/*
    1. Год после начала договора
*/
    if (ALG_DEPOSITOR.Prol_DateDep != Date(0,0,0))
      StartDate = ALG_DEPOSITOR.Prol_DateDep - 1;
    else
      StartDate = ALG_DEPOSITOR.Start_DateDep;
    end;
    DateSplit (StartDate,d,m,y);
    y = y + 1;
    TestDate = Date(d,m,y);
    if (ALG_SBDEPDOC.DepDate_Document > TestDate)
      MsgBox ("С момента начала договора прошло больше года- доп.взносы запрещены");
      ALG_RESULT = ERR_RES;
    else
/* 
      2. Ограничение на сумму прихода
*/
      if (ALG_SBDEPDOC.InSum < ALG_PARAM.prmD)
        MsgBox ("Минимальная сумма прихода- ",ALG_PARAM.prmD);
        ALG_RESULT = ERR_RES;
      end;
    end;
  end;
end;
/* ----- Конец файла ----- */
