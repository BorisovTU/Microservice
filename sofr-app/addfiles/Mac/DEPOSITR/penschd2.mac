
/* Смена вида вклада для зачисления пенсии */

record p_Oper_Prm("oper_prm.1");

CONST
  ПЕНСИЯ                                       =  2,
  ПЕНСИЯ_МО                                    =  5,
  ПЕНСИЯ_МВД                                   =  6,
  ПЕНСИЯ_ФСБ                                   =  7,
  ПЕНСИЯ_ФСНП                                  =  8,
  ПЕНСИЯ_ПРОКУРАТУРЫ                           =  9;

const
  UPDATE_DEPDOC = 4;
const
  NewTypeAccount  = "Пенсионный";

import deprintr, OperCode, alg_vars;

macro GetDepTypeIdentCharz

  file dtyp ("sb_dtyp.dbt") key 2;

  rewind(dtyp);
  dtyp.FlagCur = ALG_DEPOSITOR.IsCur;
  dtyp.Kind = NewTypeAccount;
  if(getEQ(dtyp))
    return dtyp.NewIdentChar;
  end;

  return "XX";

end;

 ALG_RESULT = OK_RES;
 if((ALG_DEPOSITOR.Type_Account == "ДО ВОСТРЕБ.") and
     (ALG_SBDEPDOC.TypeOper == Зачисление_В_Пак_Режиме) and
     ((ALG_SBDEPDOC.ApplType      == ПЕНСИЯ)      OR       /* Пенсии */
      (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_МО)   OR
      (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_МВД)  OR
      (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_ФСБ)  OR
      (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_ФСНП) OR
      (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_ПРОКУРАТУРЫ)))
      ClearRecord(p_Oper_Prm);
      p_Oper_Prm.Account         = ALG_DEPOSITOR.Account;
      p_Oper_Prm.Type_Account    = ALG_DEPOSITOR.Type_Account;
      p_Oper_Prm.Code_Currency   = ALG_DEPOSITOR.Code_Currency;
      p_Oper_Prm.Type_Oper       = Перевод_В_Другой_Вид_Вклада;
      p_Oper_Prm.Show_Panel      = 0;
      p_Oper_Prm.UseMaxDate      = 1;
      p_Oper_Prm.NoPrint         = 1;
      p_Oper_Prm.NonCashCommission = 0;
      p_Oper_Prm.TypeComplexOper = Перевод_В_Другой_Вид_Вклада;
      if(Выполнение_Операции(p_Oper_Prm,ALG_SBDEPDOC))
        ALG_RESULT = ERR_RES;
      else
        if((GetDepTypeIdentCharz != "XX") /*and (StrFor(GetProgramID) != "П")*/)
          StrSet(ALG_SBDEPDOC.Account, 21, GetDepTypeIdentCharz);
          UpdateAlgRecords( UPDATE_DEPDOC, True );
        end;
      end;
 end;
end;