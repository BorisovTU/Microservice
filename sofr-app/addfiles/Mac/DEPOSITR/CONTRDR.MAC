/*-RSL----------------------------------------------------JV R-Style--*/
/*------------------ Печать договора вкладчика -----------------------*/
IMPORT BankInter;
 record d ("depositr.dbt");
 record c ("depclnt.dbt");
 record t ("trast.dbt");

 macro PutContrDr ( pd,     /* счет вкладчика         */
                    pc,     /* данные по вкладчику    */
                    pt,     /* данные по доверенности */
                    typed,  /* тип договора           */
                    termd,  /* срок договора          */
                    rate    /* процентная ставка      */
                  )
/*  var s1, s2, s3, s4; */
  file Fd (sbdepdoc) key 6; /* список проводок по вкладчику */

  setbuff( d, pd );
  setbuff( c, pc );
  setbuff( t, pt );

  GetString( s1, "Особые условия договора" );

[

                                   ДОГОВОР О ВКЛАДЕ

    ########################## ########################## ##########################

    Счет N #########

    Доверенность  : ########################## ########################## ##########################

    Тип договора  : ########################################

    Срок договора : ######################

    Особые условия договора
    ################################################################

    Процентная ставка ######### %

]
   (c.Sname,
    c.Name,
    c.Pname,
    d.Account,
    t.Sname,
    t.Name,
    t.Pname,
    typed,
    termd,
    s1:w,
    rate:0:2 );

/*    Fd.Date_Document = date; */ /* установить текущую дату */
    Fd.Date_Document = {curdate};
    getdate( Fd.Date_Document, "Введите дату, с которой печатать проводки" );
    /* Fd.IsCur         = d.IsCur;
    Fd.FNCash        = d.FNCash;
    Fd.Account       = d.Account;
    Fd.Code_Currency = d.Code_Currency; */
    Fd.Referenc = d.Referenc;
    Fd.NumDayDoc = 0;
    [----------------------------------------------------------];
    [  Дата    :   Приход      :    Расход     :   Остаток     ];
    [----------:---------------:---------------:---------------];
    /* прочитать проводки начиная с указанной даты */
    if( getGE( Fd ) )
      LoopFlag = true;
      while( LoopFlag                               AND
             (Fd.Referenc == d.Referenc) )
            /* (Fd.Account == d.Account)               AND
            (Fd.Code_Currency == d.Code_Currency) ) */
/*        if (Fd.ArDate == Date (0,0,0) )  */
        if ((Fd.KindOp != 8) AND (Fd.KindOp != 9)) /* отбрас.арх.док-ты*/
          if( Fd.InSum )
            [########## ###############                 ###############]
            ( Fd.Date_Document, Fd.InSum:15:2, Fd.Rest:15:2 );
          else
            [##########                 ############### ###############]
            ( Fd.Date_Document, Fd.OutSum:15:2, Fd.Rest:15:2 );
          end;
        end;
        LoopFlag = next( Fd );
      end;
    end;
 end;
