/**************************************************************************\
*  ---------------                                                         *
*  R-Style Softlab                                                         *
*  ---------------                                                         *
*  RS-Retail                                                               *
*                                                                          *
*  Вклады                                                                  *
*                                                                          *
*  Макрос для инициализации счета. Добавление дополнительных счетов        *
*                                                                          *
*  Лебедев С.В.                                                            *
*  05.02.2003                                                              *
\**************************************************************************/

import DeprIntr, alg_vars;

file sb_acnam ( sb_acnam ) key 1;
file sb_congt ( sb_congt ) key 0 write;


/**************************************************************************\
|                                                                          |
\**************************************************************************/
macro AddAccountsForDepAccount

  var Account;

  /* Добавление счета накопленных процентов */
  sb_acnam.NameAccount = "{Счет накопл. %%}";
  if ( GetEQ( sb_acnam ) )
    ClearRecord( sb_congt );
    sb_congt.ReferencAcc = ALG_DEPOSITOR.Referenc;
    sb_congt.GetType     = 1000 + sb_acnam.CodAccount;
    if ( ( GetGE( sb_congt )                                  ) and
         ( sb_congt.ReferencAcc == ALG_DEPOSITOR.Referenc     ) and
         ( sb_congt.GetType     == 1000 + sb_acnam.CodAccount )    )
      ; /* Счет накопленных процентов уже есть */
    else
      Account = DefPcEstimAccountForDepositr( ALG_DEPOSITOR, false );
      if ( Account != "" )
        ClearRecord( sb_congt );
        sb_congt.IsCur       = ALG_DEPOSITOR.IsCur;
        sb_congt.FNCash      = ALG_DEPOSITOR.FNCash;
        sb_congt.ReferencAcc = ALG_DEPOSITOR.Referenc;
        sb_congt.GetType     = 1000 + sb_acnam.CodAccount;
        sb_congt.Ac_Type_Get = Account;
        if ( not Insert( sb_congt ) )
          MsgBox( "Для счета не удалось завести счет накопленных процентов");
        end;
      end;
    end;
  end;

end;


/**************************************************************************\
|                                                                          |
\**************************************************************************/

  ALG_RESULT = OK_RES;

  AddAccountsForDepAccount( );

end;
