/*
  $Name:         unloadgiszkh.mac
  $Module:       Коммунальные платежи
  $Description:  Выгрузка коммунальных платежей из RS-Retail в ГИС ЖКХ RS-Connect для планировщика
*/
import cpgiszkh;

private var {curdate};
private var {CNum};
private var branch = NumFNCash( );
private var dayOut, monOut, yearOut;
private var hhOut, mmOut, ssOut;
private var nameOut = "";
private var dirOut = GetRegVal( "BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ДИРЕКТОРИИ\\TEXTDIR" );

DateSplit( Date( ), dayOut, monOut, yearOut );
TimeSplit( Time( ), hhOut, mmOut, ssOut );

if ( dirOut != "" )
  if ( SubStr( dirOut, StrLen( dirOut ), 1 ) != "\\" )
    dirOut = dirOut + "\\";
  end;
end;

nameOut = dirOut + "unloadgiszkh" + String( yearOut ) + String( monOut:2:o ) + String( dayOut:2:o ) + String( hhOut:2:o ) + String( mmOut:2:o ) + String( ssOut:2:o ) + "." + String( {CNum} );

SetOutput( nameOut, false );

SendZKHToGIS( branch, {curdate}, {curdate} )