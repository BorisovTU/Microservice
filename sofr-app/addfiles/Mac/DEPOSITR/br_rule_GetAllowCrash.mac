/*
$Name:               br_rule_GetAllowCrash.mac
$Module:             DEPOSITR
$Description:        element_GetAllowCrash
*/
/*
*/
import br_rule_common;

macro GetFieldMode ( numParameter, parameterType )
  if ( parameterType == BR_PROP_KEY )
    if ( numParameter == nf_key1 )
    elif ( numParameter == nf_key2 )
    elif ( numParameter == nf_key3 )
    elif ( numParameter == nf_key4 )
    elif ( numParameter == nf_key5 )
      return Type_FET;
    end;
  elif( parameterType == BR_PROP_VALUE )
    if ( numParameter == nf_value1 )
    end;
  end;
  return Type_FBT;
end;

macro FieldValue ( numParameter, parameterType, FldValue, stat )
  var retval = false;

  if ( parameterType == BR_PROP_KEY )
    if ( numParameter == nf_key1 )
    elif ( numParameter == nf_key2 )
    elif ( numParameter == nf_key3 )
    elif ( numParameter == nf_key4 )
    elif ( numParameter == nf_key5 )
      if ( element.key5 == StrFor(0) )
        element.key5 = "01.01.0001";
      end;
      retval = true;
      if ( (FldValue == "01.01.0001") or (FldValue == "") or (FldValue == "00.00.0000") )
        element.key5 = "01.01.0001";
        retval = false;
      end;
    end;
  elif( parameterType == BR_PROP_VALUE )
    if ( numParameter == nf_value1 )
    end;
  end;
  return retval;
end;

macro onMakeRecCurrent( val1 )
  SetBuff(element,val1);
end;

macro ListFieldValues( numParameter, parameterType )
  record llvalues("llvalues.dbt");
  var retval = "";
  var stat;
  var res;

  if ( parameterType == BR_PROP_KEY )
    if ( numParameter == nf_key1 )
      if (LL_ListLLVALUES(4003, llvalues))
        element.key1 = llvalues.Code;
        retval = llvalues.Name;
      end;
    elif ( numParameter == nf_key2 )
      if ( LL_ListLLVALUES(4004, llvalues))
        element.key2 = llvalues.Code;
        retval = llvalues.Name;
      end;
    elif ( numParameter == nf_key3 )
      res = list_alg(767);
      if (res != element.key3)
        retval = GetNameAlg(767, res);
        element.key3 = string(res);
      end;
    elif ( numParameter == nf_key4 )
      if ( LL_ListLLVALUES(4005, llvalues))
        element.key4 = llvalues.Code;
        retval = llvalues.Name;
      end;
    elif ( numParameter == nf_key5 )
    end;
  elif( parameterType == BR_PROP_VALUE )
    if ( numParameter == nf_value1 )
      if (element.key1 == "äÄêíõ_èãÄíÄ")
         res = list_alg(790);
      else
         res = list_alg(775);
      end;
      if (res != element.value1)
        retval = GetNameAlg(790, res);
        element.value1 = string(res);
      end;
    end;
  end;

  return retval;
end;

macro GetFieldsText();
  var rule = TRecHandler ("businessruleparameter.1");
  record llvalues("llvalues.dbt");
  var res;

  rule.rec.key1   = element.key1;
  if (LL_FindLLVALUES(4003, element.key1, llvalues))
    rule.rec.key1 = llvalues.Name;
  end;

  rule.rec.key2 = element.key2;
  if (LL_FindLLVALUES(4004, element.key2, llvalues))
    rule.rec.key2 = llvalues.Name;
  end;

  if ( (element.key3 == StrFor(0)) or (element.key3 == StrFor(1)) )
    element.key3 = "0";
  end;
  rule.rec.key3 = element.key3;
  res = GetNameAlg(767, Int(element.key3));
  if (res != "")
    rule.rec.key3 = res;
  end;

  rule.rec.key4   = element.key4;
  if (LL_FindLLVALUES(4005, element.key4, llvalues))
    rule.rec.key4 = llvalues.Name;
  end;

  rule.rec.key5   = element.key5  ;
  rule.rec.key6   = element.key6  ;
  rule.rec.key7   = element.key7  ;
  rule.rec.key8   = element.key8  ;
  rule.rec.key9   = element.key9  ;
  rule.rec.key10  = element.key10 ;


  if ( (element.value1 == StrFor(0)) or (element.value1 == StrFor(1)) )
    element.value1 = "-1";
  end;
  rule.rec.value1 = element.value1;
  res = GetNameAlg(790, Int(element.value1));
  if (res != "")
    rule.rec.value1 = res;
  end;

  rule.rec.value2 = element.value2;
  rule.rec.value3 = element.value3;
  rule.rec.value4 = element.value4;
  rule.rec.value5 = element.value5;
  return rule;
end;
