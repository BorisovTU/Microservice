import cb_sql;

private macro intToStr( n, len )
  
  var s = string( n );
  while ( strLen( s ) < len )
    s = "0" + s;
  end;                         
  return s;
end;


macro sqlDateToStr( dt : date )
  
  var
    d, m, y;

  dateSplit( dt, d, m, y );

  if ( d == 0 )
    d = 1;
  end;
  if ( m == 0 )
    m = 1;
  end;
  if ( y == 0 )
    y = 1;
  end;

  return "to_date( '" 
       + intToStr( d, 2 ) + "." 
       + intToStr( m, 2 ) + "."
       + intToStr( y, 4 ) + "', 'DD.MM.YYYY' )"
end;


macro sqlChar (c : string)
//
// Преобразование символа для фильтра под Oracle 
//
  if (c == "")
    return "chr(0)";
  else
    return "'" + SubStr( c, 1, 1 ) + "'";
  end;
end;


macro rslString( s : string )

  if ( s == StrFor( 1 ) )
    return "";
  else
    return s;
  end;
end;


macro rslDate( inDate: DateTime )

  var retDate = Date( 0, 0, 0 );
  var d, m, y;

  DtTmSplit( inDate, retDate );

  DateSplit( retDate, d, m, y );

  if ( ( d == 1 ) and ( m == 1 ) and ( y == 1 ) )
    retDate = Date( 0, 0, 0 );
  end;

  return retDate;

end;
