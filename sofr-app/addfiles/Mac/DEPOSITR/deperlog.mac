/*
  Макрос печати отчета об ошибках при групповом исправлении ошибок по вкладам
  вызывается из файла dpc_test.c
*/

// Константы из файла rdpc.h

private const ACCTEST_NoError    =   0;
  // ----------------------
private const PCREST_CodeErrMin  =   1;
private const PCREST_TotRestErr  =   2;
private const PCREST_CodeErrMax  =  99;
  // ----------------------
private const PCCALC_CodeErrMin  = 101;
private const PCCALC_TotRestErr  = 102;
private const PCCALC_CodeErrMax  = 199;
  // ----------------------
private const ACCREST_CodeErrMin = 201;
private const ACCREST_LastDocErr = 202;
private const ACCREST_TwoDocErr  = 203;
private const ACCREST_CodeErrMax = 299;
  // ----------------------
private const PCESTIM_CodeErrMin = 301;
private const PCESTIM_NoEstFile  = 302;
private const PCESTIM_EstSumErr  = 303;
private const PCESTIM_EstDateErr = 304;
private const PCESTIM_CodeErrMax = 399;

 /* функция получения названия ошибки по вкладам */
macro dep_getErrorDescription( errcode )
  var ret = "";
  if      (errcode == PCREST_TotRestErr)
    ret = "Несоответствие суммы в файле остатков";
  elif (errcode == PCCALC_TotRestErr)
    ret = "Несоответствие суммы в файле процентов";
  elif (errcode == ACCREST_LastDocErr)
    ret = "Несоответствие остатка в документе и счете";
  elif (errcode == ACCREST_TwoDocErr)
    ret = "Несоответствие операции остатку в документе";
  elif (errcode == PCESTIM_NoEstFile)
    ret = "Отсутствует запись в файле накопленных %% по счету";
  elif (errcode == PCESTIM_EstSumErr)
    ret = "Несоответствие данных по накопленным %%";
  elif (errcode == PCESTIM_EstDateErr)
    ret = "Ошибка в определении периода по накопленным %%";
  elif (errcode == ACCTEST_NoError)
    ret = "";
  else
    ret = "Ошибка";
  end;

  return ret;
end;

macro init()
[┌────────────────────────┬─────────────────┬──────────────────────────────────────────────────┬────────┬──────────────────────────────────────────┐];
[│########################│#################│##################################################│########│##########################################│]
("Счет":c, "Вид вклада":c, "Ошибка по вкладу":c,"Номер":c, "Описание ошибки":l);
[└────────────────────────┴─────────────────┴──────────────────────────────────────────────────┴────────┴──────────────────────────────────────────┘];
end;

/*
deptype:  TRecHandler("sb_dtyp.dbt"),  // вид вклада
depositr: TRecHandler("depositr.dbt"), // счет
acerr:    TRecHandler("acerrtmp.tmp"), // ошибки по вкладам
errstat:  integer,                     // номер ошибки
errmsg:   string                       // описание по номеру ошибки
*/

macro PrintString(deptype, depositr, acerr, errstat, errmsg)

[│########################│#################│##################################################│########│##########################################│]
(depositr.rec.Account:c, deptype.rec.Kind:c, dep_getErrorDescription( acerr.rec.ErrorCode ), errstat:c, errmsg:l);
[└────────────────────────┴─────────────────┴──────────────────────────────────────────────────┴────────┴──────────────────────────────────────────┘];
end;

init();