/*
  RS-Retail 5.1
  Шаг "Ограничение на доп.взносы" 
  операции "Доп.взнос"
------------------------------------------------------------
  Вид вклада- "Новый европейский (1год, 2 года)"
------------------------------------------------------------
   Ограничение на сумму операции задается не в долларах,
 а в валюте счета.
------------------------------------------------------------
    Ромодин Александр Васильевич
    16 августа 2002 г.
*/
Import deprintr, alg_vars;


/* ##### Точка входа ##### */

  var Cont;
  var DifDate;
  var OldRest;
  ALG_RESULT = SKIP_RES;
  var StartDate;
  var TestDate,
      d,m,y;
/* 
  1. Ограничение на сумму прихода
*/
  if ( (StrFor(GetProgramID) == "П")            /* Последующий контроль */
   AND (CodeFor(ALG_SBDEPDOC.FlagStorn) != 0) ) /* Сторнирование */
    ALG_RESULT = OK_RES;
  else
    if (ALG_SBDEPDOC.InSum < ALG_PARAM.prmD)
      MsgBox ("Минимальная сумма прихода- ",ALG_PARAM.prmD);
      ALG_RESULT = ERR_RES;
    end;
/*
    2. Год после начала договора
*/
    if ( (ALG_RESULT != ERR_RES)
     AND ((ALG_DEPOSITOR.Type_Account == "Нов.европ.2г")
       OR (ALG_DEPOSITOR.Type_Account == "Ср.пен.на 2г")
       OR (ALG_DEPOSITOR.Type_Account == "Накоп.на 2 г")) )
      if (ALG_DEPOSITOR.Prol_DateDep != Date(0,0,0))
        StartDate = ALG_DEPOSITOR.Prol_DateDep - 1;
      else
        StartDate = ALG_DEPOSITOR.Start_DateDep;
      end;
      DateSplit (StartDate,d,m,y);
      y = y + 1;
      TestDate = Date(d,m,y);
      if (ALG_SBDEPDOC.DepDate_Document > TestDate)
        MsgBox ("С момента начала договора прошло больше года- доп.взносы запрещены");
        ALG_RESULT = ERR_RES;
      end;
    end;
  end;
end;
/* ----- Конец файла ----- */
