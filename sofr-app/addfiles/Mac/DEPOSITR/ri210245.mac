import rp210245;

var dd = {curdate};
var orderNum;

if ( not getDate( dd, "Введите дату" ) )
  exit( 1 );
end;

if ( not getInt( orderNum, "Введите номер ордера" ) )
  exit( 1 );
end;

var cd = RsdCommand( "delete from drsbedref_tmp " +
                     "where t_isCur = ?" );



cd.addParam( "p_isCur", RSDBP_IN );
cd.value( "p_isCur" ) = flag_Cur;

cd.execute;

var c = RsdCommand( "insert into drsbedref_tmp ( t_isCur, " +
                                                "t_signRec, " +
                                                "t_accType, " +
                                                "t_accNumber, " +
                                                "t_operation, " +
                                                "t_knfCode, " +
                                                "t_errCode, " +
                                                "t_code_currency, " +
                                                "t_applicationKind, " +
                                                "t_applicationKey ) " +
                    "( select t_isCur, " +
                              string( SIGNORDER ) + ", " +
                             "t_type_account, " +
                             "t_referenc, " +
                             "t_typeOper, " +
                             "t_knfCode, " +
                             "0, " +
                             "t_code_currency, " +
                             "t_iApplicationKind, " +
                             "t_applicationKey " +
                    "from dsbdepdoc_dbt " +
                    "where t_isCur = ? and t_fnCash = ? and t_date_document = ? and t_orderNum = ? )" );

c.addParam( "p_isCur", RSDBP_IN );
c.addParam( "p_branch", RSDBP_IN );
c.addParam( "p_date", RSDBP_IN );
c.addParam( "p_orderNum", RSDBP_IN );
c.value( "p_isCur" ) = flag_Cur;
c.value( "p_branch" ) = FNCash;
c.value( "p_date" ) = dd;
c.value( "p_orderNum" ) = orderNum;

c.execute;

report( 0, 0, 1 );