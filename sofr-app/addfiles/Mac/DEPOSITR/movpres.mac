/*-------------------------------------------------------------------------
  Перевод счета в альтернативное состояние с даты операции.
  (Для вида вклада "Выигрышный")
  Автор: Зубов В.Ю. 24.12.97                              
-------------------------------------------------------------------------*/
import deprintr;
/*---------- Это нам передают ---------------------------------*/
 record ALG_DEPOSITOR("depositr.dbt");
 record ALG_SBDEPDOC ("sbdepdoc.dbt");
 record ALG_PARAM    ("sb_algop.dbt");

/*---------- Коды возврата макроса --------------------------------------*/
 const
  OK_RES   =  0,  /* продолжать проводку */
  SKIP_RES =  1,  /* пропустить выполнение предопределенного модуля */
  END_RES  =  2,  /* завершить проводку */
  ERR_RES  = -1,  /* аваpийно завершить проводку */

  OP_2_ALT = 85,
  OP_2_DEP = 86,

  НЕ_ОБНОВЛЯТЬ                                 =  0,
  ОБНОВИТЬ                                     =  1,
  ТИП_ОПЕРАЦИИ_ЗАЧИСЛЕНИЕ                      = 73,
  ПЕНСИЯ                                       =  2,
  СЧЕТ_ОТКРЫТ                                  =  "",
  СЧЕТ_В_ОСНОВНОМ_СОСТОЯНИИ                    =  0,
  СЧЕТ_В_АЛЬТЕРНАТИВНОМ_СОСТОЯНИИ              =  1,
  ОПЕРАЦИЯ_ПЕРЕВОДА_В_АЛЬТЕРНАТИВНОЕ_СОСТОЯНИЕ = OP_2_ALT,
  ОПЕРАЦИЯ_ПЕРЕВОДА_В_ОСНОВНОЕ_СОСТОЯНИЕ       = OP_2_DEP,
  FOREVER                                      = Date(1,1,9999),
  TODAY                                        = Date(1,4,1997);

 ALG_RESULT = ERR_RES;/*заранее инициализируем код возврата*/
 ALG_UPDATE = НЕ_ОБНОВЛЯТЬ;
/*--------------------------------------------------------------*/

 var
   errorCode;

  if(
     (ALG_DEPOSITOR.Open_Close   == СЧЕТ_ОТКРЫТ)
     AND (ALG_DEPOSITOR.UseAlternate == СЧЕТ_В_ОСНОВНОМ_СОСТОЯНИИ)
    )
    errorCode = moveAccountIntoAnotherState
                (ОПЕРАЦИЯ_ПЕРЕВОДА_В_АЛЬТЕРНАТИВНОЕ_СОСТОЯНИЕ,
                   ALG_DEPOSITOR.Referenc,
                     TODAY,
                       FOREVER);


    if(errorCode==0)
/*    ALG_DEPOSITOR.UseAlternate = СЧЕТ_В_ОСНОВНОМ_СОСТОЯНИИ;
      ALG_DEPOSITOR.NumSession   = 0;*/
      ALG_RESULT                 = SKIP_RES;
/*      ALG_UPDATE                 = ОБНОВИТЬ;*/
    end;
  else
    ALG_RESULT = ERR_RES;
    ALG_UPDATE = НЕ_ОБНОВЛЯТЬ;
  end;

  Exit(1); /* Убрать вывод на экран */

END;
/*----------------------------------------------------------------------*/
