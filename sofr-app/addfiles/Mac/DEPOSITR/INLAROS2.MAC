/*
  RS-Retail
  Инициализация счета
  Определение номера рублевого счета по правилам Ларос
  БЕЗ определения первого (контрольного) символа
  (макрос описывается в cbbank.ini)

  Ромодин Александр Васильевич
  16.04.98
*/
import deprintr;
/* *** НАСТРОЙКА- первый символ в номере счета (вместо контрольного) *** */
const CntrSym = "_";

/*---------- Инициализируемые структуры ---------------------------------*/
record dr("depositr.dbt");

/*---------- Коды возврата макроса --------------------------------------*/
const  OK_RES   =  0,  /* продолжать проводку */
       SKIP_RES =  1,  /* пропустить выполнение предопределенного модуля */
       END_RES  =  2,  /* завершить проводку */
       ERR_RES  = -1;  /* аваpийно завершить проводку */
/*---------- Код филиала и валюта ---------------------------------------*/
var FNcash  = NumFNcash();
var FlagCur = NumFlagCur();
var strFNcash = String(FNcash);
if (StrLen(strFNcash)<2)
  strFNcash = "0" + strFNcash;
end;
/*---------- Интересный видывкладов -------------------------------------*/
const pension = "Пенсионный";
const uslov = "Условн.";
/**********************************************************/

var KindInLaros = "";

/***********************************************************
***********************************************************/

macro LetterLaros (TypeAccount)
/*
  Определение соответствия видов вкладов Ларос и Retail
*/
  var Kind = "";
  if (TypeAccount == "СРОЧНЫЙ")
    Kind = "0";
  elif (TypeAccount == "СР.ДЕП. 4 МП")
    Kind = "Г";
  elif (TypeAccount == "СР.ДЕП. 6 МП")
    Kind = "Г";
  elif (TypeAccount == "СР.ДЕП. 12МП")
    Kind = "Г";
  elif (TypeAccount == "Пенсионный")
    Kind = "Т";
  elif (TypeAccount == "Условн.")
    Kind = "Т";
  elif (TypeAccount == "ДО ВОСТРЕБ.")
    Kind = "Т";
  elif (TypeAccount == "Ср.1мес.выпл")
    Kind = "6";
  elif (TypeAccount == "Фикс-3")
    Kind = "И";
  elif (TypeAccount == "Фикс-6")
    Kind = "И";
  elif (TypeAccount == "Ср.пенсион.")
    Kind = "Л";
  elif (TypeAccount == "Целев. дети")
    Kind = "Н";
  elif (TypeAccount == "СБЕРЕГ.1МЕС.")
    Kind = "С";
  elif (TypeAccount == "СБЕРЕГ.2МЕС.")
    Kind = "С";
  elif (TypeAccount == "СБЕРЕГ.3МЕС.")
    Kind = "С";
  elif (TypeAccount == "ШКОЛЬНЫЙ")
    Kind = "Ш";
  elif (TypeAccount == "ЮБИЛЕЙНЫЙ")
    Kind = "Б";
  elif (TypeAccount == "НОМЕРНОЙ")
    Kind = "Ц";
  elif (TypeAccount == "РОЖДЕСТВЕН.")
    Kind = "Э";
  elif (TypeAccount == "РОЖДЕСТВЕН.+")
    Kind = "Щ";
  elif (TypeAccount == "НОВОДЕНЕЖНЫЙ")
    Kind = "Ь";
  elif (TypeAccount == "Компнес. 2")
    Kind = "Й";
  elif (TypeAccount == "ВЫИГРЫШНЫЙ")
    Kind = "А";
  elif (TypeAccount == "ВЕСЕННИЙ")
    Kind = "Э";
  elif (TypeAccount == "ВЕСЕННИЙ+")
    Kind = "Щ";
  elif (TypeAccount == "СБ-100 дней")
    Kind = "Ы";
  elif (TypeAccount == "СБ-60 дней")
    Kind = "Ъ";
  elif (TypeAccount == "Особый номер")
    Kind = "О";
  end;
  return Kind;
end;
/**********************************************************
##### Головной макрос #####################################
**********************************************************/

macro inlaros2    /* !!! Имя макропроцедуры должно соответствовать !!! */
(                 /* !!! имени файла                               !!! */
 depos
)
  setbuff(dr, depos);

  if (FlagCur > 0)
    return;
/*    MsgBox ("Инициализация работает только для рублей"); */
  else
    SetOutput("NUL");       /* Убираем вывод на экран*/
/*
    1. Определение вида вклада по Ларос
*/
    KindInLaros = LetterLaros (dr.Type_Account);
    if (KindInLaros == "")
      MsgBox ("Не определен вид вклада по Ларос");
    else
/*
      2. Определение номера счета
*/
      dr.Account = CntrSym + strFNcash + KindInLaros + String(dr.Number);
      if ((dr.Type_Account == pension) OR
       (dr.Type_Account == uslov))
        dr.UseAlternate = 1;
      end;
    end;
  end;

  return;
end;
