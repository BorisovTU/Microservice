
/* Отчет по отложенным документам */

import deprintr;

file PsDoc("psdepdoc.dbt")  key 1;
file TypeOp("sb_typop.dbt") key 0;
file SubOper("suboper.dbt") key 1;

const
  D_DELETE=2;

var
  {curdate},
  FlagCur=NumFlagCur,
  FNCash=NumFNCash,
  Op,
  SubOp,
  Sum;

macro OutHead;

  Print("                     Отчет по отложенным документам за "
    +String({curdate}));
  if(FlagCur)
    PrintLn(" (валюта)");
  else
    PrintLn(" (рубли)");
  end;
  PrintLn;
  [+----+-------------------------+------------------+------------+-------------------+-----+];
  [| №  |        С ч е т          |    С у м м а     |  Операция  |  Подвид операции  | № п |];
  [+----+-------------------------+------------------+------------+-------------------+-----+];
end;

macro OutLine;

  [|####|#########################|##################|############|###################|#####|]
  (
    PsDoc.NDoc,
    Acc_Form(PsDoc.Account),
    Sum,
    Op,
    SubOp,
    PsDoc.NPack
  );
end;

macro GetReportData;

  if(PsDoc.InSum>$0)
    Sum=PsDoc.InSum;
  else
    Sum=PsDoc.OutSum;
  end;

  TypeOp.IsCur=PsDoc.IsCur;
  TypeOp.Kind=PsDoc.Type_Account;
  TypeOp.NumOpert=PsDoc.TypeOper;
  if(GetEQ(TypeOp))
    Op=TypeOp.czNameAlg;
  else
    Op="Не найдена";
  end;

  if(PsDoc.TypeOper!=0)
    SubOper.IsCur    = PsDoc.IsCur;
    SubOper.Kind     = PsDoc.Type_Account;
    SubOper.OperType = PsDoc.TypeOper;
    SubOper.Type     = PsDoc.ApplType;
    if(GetEQ(SubOper))
      SubOp=SubOper.Name;
    else
      SubOp="Не найдена";
    end;
  else
    SubOp="";
  end;
end;

  var
    RecFound;

  OutHead;
  ClearRecord(PsDoc);
  PsDoc.IsCur=FlagCur;
  PsDoc.FNCash=FNCash;
  RecFound=Next(PsDoc);
  while(RecFound and (PsDoc.IsCur==FlagCur) and (PsDoc.FNCash==FNCash))
    if(PsDoc.Action!=D_DELETE)
      GetReportData;
      OutLine;
    end;
    RecFound=Next(PsDoc);
  end;
end;




