
/* Перевод счета в неподвижные/объединенные */

import T2S_Comm;

private record ALG_DEPOSITOR( "depositr.dbt" );

/*---------- Коды возврата макроса --------------------------------------*/
private const  OK_RES   =  0,  /* продолжать проводку */
        SKIP_RES =  1,  /* пропустить выполнение предопределенного модуля */
        END_RES  =  2,  /* завершить проводку */
        ERR_RES  = -1;  /* аваpийно завершить проводку */
/*-----------------------------------------------------------------------*/

const
  UPDATE_ALL  = 1,
  UPDATE_DEP  = 2,
  UPDATE_DOC  = 4;

macro TreatAccForRef( Reference )

  var
    OldKey = KeyNum( Dep, 8 );

  if(BranchStatus == BS_BRANCH)
    OpenOrCreateTrFiles(Branch);
  end;
  Dep.Referenc = Reference;
  if ( GetEQ( Dep ) )
    KeyNum( Dep, OldKey );
    if(((StrFor(GetProgramID) == "П") or (Dep.SvodAccount == ""))
       and CheckAndSetStaticAccType)
      if ( TreatAccount )
        Copy( ALG_DEPOSITOR, Dep );
        UpdateAlgRecords( UPDATE_ALL, true );
        return;
      end;
    end;
  end;
  if(not InFCGroupOpRun())
    MsgBox( "Счет не переведен" );
  end;
  Exit( -1 );   
end;

  ALG_RESULT = SKIP_RES;
  TreatAccForRef( ALG_DEPOSITOR.Referenc );
  ALG_RESULT = OK_RES;
end;