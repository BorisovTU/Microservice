/***************************************************************************\
| SCHTST1.MAC  RS-Retail Автор: Саввин Д.                                   |
| Шаг алгоритма ???                                                         |
\***************************************************************************/
import commonInter;       

/* Отслеживает возрастные категории при открытии школьного вклада */

/*---------- Инициализируемые структуры ---------------------------------*/
 record ALG_DEPOSITOR("depositr.dbt");
 record ALG_SBDEPDOC("sbdepdoc.dbt");
 record ALG_PARAM("sb_algop.dbt");
 var DC = TClientList;

/*---------- Коды возврата макроса --------------------------------------*/
 const  OK_RES   =  0,  /* продолжать проводку */
        SKIP_RES =  1,  /* пропустить выполнение предопределенного модуля */
        END_RES  =  2,  /* завершить проводку */
        ERR_RES  = -1;  /* аваpийно завершить проводку */
/*-----------------------------------------------------------------------*/
 var FromDate=date(0,0,0), ToDate=date(0,0,0),
     {curdate}, BornDate=date(0,0,0),
     day, mon, year;

 macro BD(CodClient)
   if (DC.GetRecord (CodClient))
     return DC.CurRec.rec.Born;
   else
     msgbox("Не найден клиент счета");
     ALG_RESULT=ERR_RES;
     exit(1);
   end;
 end;

/*-----------------------------------------------------------------------*/

 BornDate=BD(ALG_DEPOSITOR.CodClient);

 DateSplit(BornDate,day,mon,year);
 FromDate=date(day,mon,year+7);
 ToDate=date(day,mon,year+13);

 if({curdate}<FromDate)
   msgbox("Открытие вклада не возможно, возраст вкладчика менее 7 лет.");
   ALG_RESULT=END_RES;
   return;
 elif(({curdate}>=FromDate) and ({curdate}<=ToDate))
   if(gettrue(NULL,"Возраст вкладчика от 7 до 13 лет, есть ли согласие родителей ?"))
      ALG_RESULT=OK_RES;
      return;
   else
      ALG_RESULT=END_RES;
      return;
   end;
 else
   ALG_RESULT=OK_RES;
   return;
 end;

 Exit(1); /* Убрать вывод на экран */

return;
