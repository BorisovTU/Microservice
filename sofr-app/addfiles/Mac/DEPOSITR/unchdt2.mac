/*
  RS-Retail 2.01
  Откат (удаление\сторнирование) операции зачисления в пакетном
  ражиме для вида вклада "Пенсионный"
  ==========================================================
  Вызывается для Пенсионного для шага "Сторнирование/удаление"
  операции # 73 "Зачисление в пакетном режиме"
  ==========================================================
  Разработан при исправлении замечания 21 аттестации
  в центр.аппарате СБ РФ
  ==========================================================
   Макрос проверяет наличие в списке операции # 73 подоперации
  "Смена вида вклада", и в зависимости от этого вызывает
  макрос MakeChangeDepType() с разными параметрами
  ==========================================================
  Ромодин Александр Васильевич
  26.05.00
*/
Import unchdtm;
/*
  Точка входа
  ===========
*/
  var bool_IsChangeDepType = False;
  var n,y, f;
/*
  Есть ли в списке на зачисление документ с кодом 78
  (смена вида вклада)?
*/
  KeyNum (casln, 1);
  casln.ApplicationKind2 = ALG_SBDEPDOC.iApplicationKind;
  casln.ApplicationKey2  = ALG_SBDEPDOC.ApplicationKey;
  casln.RefValue2 = 0;
  if (getEQ(casln))
    n = casln.ApplicationKind1;
    y = casln.ApplicationKey1;
    KeyNum (casln, 0);
    casln.ApplicationKind1 = n;
    casln.ApplicationKey1  = y;
    casln.NumLinkDoc       = 0;
    f = getGE (casln);
    while (f
     AND (NOT bool_IsChangeDepType)
     AND (casln.ApplicationKind1 == n)
     AND (casln.ApplicationKey1 == y) )
      if (casln.RefValue2 == 0) 
        KeyNum (SBDepDoc,3);
        SBDepDoc.iApplicationKind = casln.ApplicationKind2;
        SBDepDoc.ApplicationKey = casln.ApplicationKey2;
        if (getEQ(SBDepDoc))
          if (SBDepDoc.TypeOper == 78)
            bool_IsChangeDepType = True;
          end;
        end;
      end;
      f = Next (casln);
    end;
  end;
/*
  Откат документа с возможной сменой вида вклада
*/
  MakeChangeDepType (bool_IsChangeDepType);
end;
