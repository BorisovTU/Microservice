/*
  RS-Retail
  Филиал Сбербанка

  Итоговые суммы остатков по рублевым видам вкладов
  (для открытых счетов)

  Ромодин Александр Васильевич
  01.11.97
*/
/*
  Общие файлы
*/
import BankInter,deprintr,sqlconv,rsd;

//Private var DEPOSITR = Tbfile ("depositr.dbt","r",1),
private var cmd_DEPOSITR = RsdCommand;
private var rs_DEPOSITR;

            //SB_DTYP  = Tbfile ("sb_dtyp.dbt" ,"r",1), /* Справочник видов вкладов */
private var cmd_SB_DTYP = RsdCommand;
private var rs_SB_DTYP;
                                                      /* FlagCur + Prior */
            //CURR     = Tbfile ("currency.dbt","r",0), /* Справочник валют*/
            //listfdep = Tbfile ("listfdep.dbt","r",0);
private var cmd_listfdep = RsdCommand;
private var rs_listfdep;

  var cmd_ClientList= RsdCommand;
  var rs_ClientList;


var sql;

/***********************************************************
        Настройки
***********************************************************/
const MinPrior = 0;             /* Приоритеты видов вкладов */
const MaxPrior = 999;

const FNcash   = NumFNcash();         /* Номер филиала        */
const FlagCur  = NumFlagCur();
const BranchStatus = GetBranchStatus();

const NoLook  = "Служебный";   /* Информация не выводится */

const NoMobil = "Неподвижный";  /* */
const United  = "Объединенный";

const SymNep = "Н";           /* Указывает на принадлежность счета к
                                 Неподвижным */

const
  BS_BRANCH       = 0,    /* Филиал                 */
  BS_DEP          = 1,    /* Отделение              */
  BS_EXCH         = 2,    /* Обменный пункт         */
  BS_OPERDEP      = 3;    /* Оперчасть              */


/***********************************************************
        Переменные
***********************************************************/
var {curdate};
var DateSum = {curdate}; /* Дата */
var Mode = GetCurrentMode;

var KolAccKind   = 0;
var KolAccKindNR = 0;

array KolAcc,           /* Количество счетов по виду вклада и сумма остатков */
      KolAccNR,
      KolAccAll,
      SumAcc,
      SumAccNR,
      SumAccAll,
      KolFin,           /* Количество завершенных договоров и сумма остатков */
      KolFinNR,
      KolFinAll,
      SumFin,
      SumFinNR,
      SumFinAll,
      KolCont,          /* Количество не завершенных договоров и сумма остатков */
      KolContNR,
      KolContAll,
      SumCont,
      SumContNR,
      SumContAll;
array Currency;            /* Код валюты- Рубли    */
var   KolCur = 0;
//var   ClientList = TClientList;

/***********************************************************
***********************************************************/

macro GetCur (Cur)
/*
  Получение имени валюты
*/
  //new
  var Name = "";

  var cmd_CURR = RsdCommand;
  var rs_CURR;

  cmd_CURR.CmdText =
    " SELECT * FROM dcurrency_dbt "+
    " WHERE "+
    " t_Code_Currency = "+String(Cur);
    ;
  cmd_CURR.execute;
  rs_CURR = RsdRecordset(cmd_CURR);

  if (rs_CURR.MoveNext)
    Name = rs_CURR.Fld("t_Short_Name").Value;
  end;

  return Name;

  /* old
  var Name = "";
  CURR.rec.Code_Currency = Cur;
  if (CURR.GetEQ())
    Name = CURR.rec.Short_Name;
  end;
  return Name;
  */
end;
/**********************************************************/

macro HaveSymbol /* Проверка наличия символа Symbol в строке SymArr */
(
 Symbol,
 SymArr
)
/*
  Возврат:
    TRUE - есть в списке
    FALSE - нет в списке
*/
  var stat = False;

  if ( Index( SymArr, Symbol ) )
      stat = TRUE;
  end;

  return stat;
end;
/**********************************************************/

macro LineRep
/*
  Разделитель
*/
  [----------------------------------------------------------------------------------------------------------------------------------------];
end;

macro BeginReport
/*
  Начало отчета
*/
  [ ];
  [                        Итоговые суммы по видам вкладов на ##########](DateSum);
  [                                          по филиалу ##](FNcash);
  [ ];
  LineRep();
  [| Вид вклада        | Договор    |     Всего открытых счетов       |     Завершенных договоров       |     Незавершенных договоров     |];
  LineRep();
end;

macro StringReport
/*
  Строка отчета
*/

  var Form="";
  var  i = 0;
  if (rs_SB_DTYP.Value("t_FormContr") == 1)
    Form = "Срочные";
  elif (rs_SB_DTYP.Value("t_FormContr") == 20)
    Form = "Депозиты";
  elif (rs_SB_DTYP.Value("t_FormContr") == 30)
    Form = "Пролонгир.";
  end;
    if ((Asize(KolAcc)>0) OR (Asize(KolAccNR)>0))
      while (i < KolCur)
        if (KolAcc(i) > 0)
  [| ############ (###)| ########## | ##### | ####################### | ##### | ####################### | ##### | ####################### |]
        (rs_SB_DTYP.Value("t_Kind"),GetCur(Currency(i)),Form,KolAcc(i),SumAcc(i):a,KolFin(i),SumFin(i):a,
          KolCont(i),SumCont(i):a);
        end;
        if (KolAccNR(i) > 0)
          [| ############ (###)| ########## | ##### | ####################### | ##### | ####################### | ##### | ####################### |]
          (rs_SB_DTYP.Value("t_Kind"),GetCur(Currency(i)),Form,KolAccNR(i),SumAccNR(i):a,KolFinNR(i),SumFinNR(i):a,
          KolContNR(i),SumContNR(i):a);
          [| (нерезидент)      |            |       |                         |       |                         |       |                         |]
        end;
        i = i + 1;
      end;
    end;
end;

macro EndRep;
/*
  Конец отчета
*/
  var i = 0;
  LineRep();
  while (i < KolCur)
  [| Итого                     ###: | ##### | ####################### | ##### | ####################### | ##### | ####################### |]
  (GetCur(Currency(i)),KolAccAll(i),SumAccAll(i):a,KolFinAll(i),SumFinAll(i):a,
  KolContAll(i),SumContAll(i):a);
    i = i + 1;
  end;
end;
/**********************************************************/

macro DefCur
(
 Cur
)
/*
  Определение валюты или добавление в список новой
*/
  var i = 0;
  var NumCur = 0;
  var stat = TRUE;
  while (stat AND (i < KolCur))
    if (Currency(i) == Cur)
      stat = FALSE;
      NumCur = i;
    else
      i = i + 1;
    end;
  end;
  if (stat)
    Currency (KolCur) = Cur;
    KolAcc (KolCur) = 0; KolAccNR (KolCur) = 0; KolAccAll (KolCur) = 0;
    SumAcc (KolCur) = 0; SumAccNR (KolCur) = 0; SumAccAll (KolCur) = 0;
    KolFin (KolCur) = 0; KolFinNR (KolCur) = 0; KolFinAll (KolCur) = 0;
    SumFin (KolCur) = 0; SumFinNR (KolCur) = 0; SumFinAll (KolCur) = 0;
    KolCont(KolCur) = 0; KolContNR(KolCur) = 0; KolContAll(KolCur) = 0;
    SumCont(KolCur) = 0; SumContNR(KolCur) = 0; SumContAll(KolCur) = 0;
    NumCur = KolCur;
    KolCur = KolCur + 1;
  end;
  return NumCur;
end;
/**********************************************************/

macro AccForKind
(
 Branch
)
/*
  Цикл по счетам
*/
  //new
  var stat;
  var NumCur;
  var IsRez;
  var strFilter;
  var Open_Close = "";  // По открытым счетам

  cmd_DEPOSITR.CmdText=
    " SELECT * FROM ddepositr_dbt "+
    " WHERE "+
    " t_FNCash = "         + String(Branch)+
    " AND t_Code_Currency >= -1 " +
    " AND t_Number >= 0 "  +
    " AND T_ISCUR = "     + String(FlagCur) +
    " AND T_OPEN_CLOSE = "     + sqlChar(Open_Close) +
    " AND T_TYPE_ACCOUNT = "     + GetSQLString( rs_SB_DTYP.Value("t_Kind") );

  cmd_DEPOSITR.execute;
  rs_DEPOSITR = RsdRecordset(cmd_DEPOSITR);
  stat = rs_DEPOSITR.MoveNext;
  //cmd_DEPOSITR.Clear ();

  /*old
  var stat;
  var NumCur;
  var IsRez;
  var strFilter;
  var Open_Close = "";  // По открытым счетам

  DEPOSITR.Clear ();
  DEPOSITR.rec.IsCur         = FlagCur;
  DEPOSITR.rec.FNCash        = Branch;
  DEPOSITR.rec.Open_Close    = Open_Close;
  DEPOSITR.rec.Type_Account  = SB_DTYP.rec.Kind;
  DEPOSITR.rec.Code_Currency = -1;
  DEPOSITR.rec.Number        = 0;

  strFilter = "t.T_ISCUR = "            + String(FlagCur) +
         " AND t.T_FNCASH = "           + String(Branch)  +
         " AND t.T_OPEN_CLOSE = "       + sqlChar(Open_Close) +
         " AND t.T_TYPE_ACCOUNT = "     + GetSQLString(SB_DTYP.rec.Kind);

  DEPOSITR.addFilter (strFilter);
  stat = DEPOSITR.GetGE ();
  */

/*
  println ( " stat ",stat,
            " DEPOSITR.FNCash ", DEPOSITR.rec.FNCash,
            " DEPOSITR.Type_Account ", DEPOSITR.rec.Type_Account,
            " DEPOSITR.Code_Currency ", DEPOSITR.rec.Code_Currency,
            " DEPOSITR.Number ", DEPOSITR.rec.Number );
*/
/*  println ("stat ", stat, " (DEPOSITR.FNCash == Branch) ", (DEPOSITR.FNCash == Branch),
           " (DEPOSITR.Type_Account == SB_DTYP.Kind) ", (DEPOSITR.Type_Account == SB_DTYP.Kind),
           " ((DEPOSITR.Code_Currency == 0) OR (FlagCur != 0)) ",
             ((DEPOSITR.Code_Currency == 0) OR (FlagCur != 0)),
           " (not HaveSymbol( SymNep, DEPOSITR.UserTypeAccount )) ",
             (not HaveSymbol( SymNep, DEPOSITR.UserTypeAccount )),
           " depositr.Account ", depositr.Account,
           " depositr.Type_Account ", depositr.Type_Account);
*/
  //new
  while (stat                                   AND
   (rs_DEPOSITR.Fld("t_IsCur").Value        == FlagCur)      AND
   (rs_DEPOSITR.Fld("t_FNCash").Value       == Branch)       AND
   (rs_DEPOSITR.Fld("t_Open_Close").Value   == Open_Close)   AND
   (rs_DEPOSITR.Fld("t_Type_Account").Value == rs_SB_DTYP.Value("t_Kind") ) AND
   ((rs_DEPOSITR.Fld("t_Code_Currency").Value == 0) OR (FlagCur != 0)) )
    if (not HaveSymbol( SymNep, rs_DEPOSITR.Fld("t_UserTypeAccount").Value ))
       IsRez = TRUE;
       if (rs_DEPOSITR.Fld("t_CodClient").Value != 0)

         //new from scr#86878
         sql = "SELECT p.t_notresident FROM dparty_dbt p "
              +"  WHERE  p.t_partyid = "+String(rs_DEPOSITR.Value("t_CodClient"));

//         cmd_ClientList = RsdCommand( sql );
         cmd_ClientList.CmdText = sql ;
         cmd_ClientList.execute;
         rs_ClientList = RsdRecordset( cmd_ClientList );
         if ( rs_ClientList.MoveNext )
           if( rs_ClientList.value("t_notresident")!="" )
             IsRez = FALSE;
           end;
         end;

         /*old
         if (  ClientList.GetRecord( DEPOSITR.rec.CodClient ) )
           if (ClientList.CurRec.Rec.NotResident != "")
             IsRez = FALSE;
           end;
         end;
         */
       end;

       NumCur = DefCur (rs_DEPOSITR.Fld("t_Code_Currency").Value);

       if (IsRez)
         KolAccKind = KolAccKind + 1;
       else
         KolAccKindNR = KolAccKindNR + 1;
       end;

       if (rs_DEPOSITR.Fld("t_Type_Account").Value != NoMobil)
         if (IsRez)
           KolAcc(NumCur) = KolAcc(NumCur) + 1;
         else
           KolAccNR(NumCur) = KolAccNR(NumCur) + 1;
         end;
           KolAccAll(NumCur) = KolAccAll(NumCur) + 1;
       else
         if (IsRez)
           KolAcc(NumCur) = KolAcc(NumCur) + rs_DEPOSITR.Fld("t_S_NumAccounts").Value;
         else
           KolAccNR(NumCur) = KolAccNR(NumCur) + rs_DEPOSITR.Fld("t_S_NumAccounts").Value;
         end;
         KolAccAll(NumCur) = KolAccAll(NumCur) + rs_DEPOSITR.Fld("t_S_NumAccounts").Value;
       end;
       if (IsRez)
         SumAcc(NumCur) = SumAcc(NumCur) + rs_DEPOSITR.Fld("t_Sum_Rest").Value;
       else
         SumAccNR(NumCur) = SumAccNR(NumCur) + rs_DEPOSITR.Fld("t_Sum_Rest").Value;
       end;
       SumAccAll(NumCur) = SumAccAll(NumCur) + rs_DEPOSITR.Fld("t_Sum_Rest").Value;
       if (rs_SB_DTYP.Value("t_FormContr") != 0)
         if (rs_DEPOSITR.Fld("t_End_DateDep").Value != Date(0,0,0))
           if (IsRez)
             KolCont(NumCur) = KolCont(NumCur) + 1;
             SumCont(NumCur) = SumCont(NumCur) + rs_DEPOSITR.Fld("t_Sum_Rest").Value;
           else
             KolContNR(NumCur) = KolContNR(NumCur) + 1;
             SumContNR(NumCur) = SumContNR(NumCur)+ rs_DEPOSITR.Fld("t_Sum_Rest").Value;
           end;
           KolContAll(NumCur) = KolContAll(NumCur) + 1;
           SumContAll(NumCur) = SumContAll(NumCur) + rs_DEPOSITR.Fld("t_Sum_Rest").Value;
         else
           if (IsRez)
             KolFin(NumCur) = KolFin(NumCur) + 1;
             SumFin(NumCur) = SumFin(NumCur) + rs_DEPOSITR.Fld("t_Sum_Rest").Value;
           else
             KolFinNR(NumCur) = KolFinNR(NumCur) + 1;
             SumFinNR(NumCur) = SumFinNR(NumCur) + rs_DEPOSITR.Fld("t_Sum_Rest").Value;
           end;
           KolFinAll(NumCur) = KolFinAll(NumCur) + 1;
           SumFinAll(NumCur) = SumFinAll(NumCur) + rs_DEPOSITR.Fld("t_Sum_Rest").Value;
         end;
       end;
     end;
     Message ("По виду вклада \"",rs_SB_DTYP.Value("t_Kind"),"\" обработано ",(KolAccKind + KolAccKindNR)," счетов");
     stat = rs_DEPOSITR.MoveNext();
  end;

/*old
  while (stat                                  AND
   (DEPOSITR.rec.IsCur        == FlagCur)      AND
   (DEPOSITR.rec.FNCash       == Branch)       AND
   (DEPOSITR.rec.Open_Close   == Open_Close)   AND
   (DEPOSITR.rec.Type_Account == SB_DTYP.rec.Kind) AND
   ((DEPOSITR.rec.Code_Currency == 0) OR (FlagCur != 0)) )
    if (not HaveSymbol( SymNep, DEPOSITR.rec.UserTypeAccount ))
       IsRez = TRUE;
       if (DEPOSITR.rec.CodClient != 0)
         if ( ClientList.GetRecord( DEPOSITR.rec.CodClient ) )
           if (ClientList.CurRec.Rec.NotResident != "")
             IsRez = FALSE;
           end;
         end;
       end;

       NumCur = DefCur (DEPOSITR.rec.Code_Currency);

       if (IsRez)
         KolAccKind = KolAccKind + 1;
       else
         KolAccKindNR = KolAccKindNR + 1;
       end;

       if (DEPOSITR.rec.Type_Account != NoMobil)
         if (IsRez)
           KolAcc(NumCur) = KolAcc(NumCur) + 1;
         else
           KolAccNR(NumCur) = KolAccNR(NumCur) + 1;
         end;
           KolAccAll(NumCur) = KolAccAll(NumCur) + 1;
       else
         if (IsRez)
           KolAcc(NumCur) = KolAcc(NumCur) + DEPOSITR.rec.S_NumAccounts;
         else
           KolAccNR(NumCur) = KolAccNR(NumCur) + DEPOSITR.rec.S_NumAccounts;
         end;
         KolAccAll(NumCur) = KolAccAll(NumCur) + DEPOSITR.rec.S_NumAccounts;
       end;
       if (IsRez)
         SumAcc(NumCur) = SumAcc(NumCur) + DEPOSITR.rec.Sum_Rest;
       else
         SumAccNR(NumCur) = SumAccNR(NumCur) + DEPOSITR.rec.Sum_Rest;
       end;
       SumAccAll(NumCur) = SumAccAll(NumCur) + DEPOSITR.rec.Sum_Rest;
       if (SB_DTYP.rec.FormContr != 0)
         if (DEPOSITR.rec.End_DateDep != Date(0,0,0))
           if (IsRez)
             KolCont(NumCur) = KolCont(NumCur) + 1;
             SumCont(NumCur) = SumCont(NumCur)+ DEPOSITR.rec.Sum_Rest;
           else
             KolContNR(NumCur) = KolContNR(NumCur) + 1;
             SumContNR(NumCur) = SumContNR(NumCur)+ DEPOSITR.rec.Sum_Rest;
           end;
           KolContAll(NumCur) = KolContAll(NumCur) + 1;
           SumContAll(NumCur) = SumContAll(NumCur) + DEPOSITR.rec.Sum_Rest;
         else
           if (IsRez)
             KolFin(NumCur) = KolFin(NumCur) + 1;
             SumFin(NumCur) = SumFin(NumCur) + DEPOSITR.rec.Sum_Rest;
           else
             KolFinNR(NumCur) = KolFinNR(NumCur) + 1;
             SumFinNR(NumCur) = SumFinNR(NumCur) + DEPOSITR.rec.Sum_Rest;
           end;
           KolFinAll(NumCur) = KolFinAll(NumCur) + 1;
           SumFinAll(NumCur) = SumFinAll(NumCur) + DEPOSITR.rec.Sum_Rest;
         end;
       end;
     end;
     Message ("По виду вклада \"",SB_DTYP.rec.Kind,"\" обработано ",(KolAccKind + KolAccKindNR)," счетов");
     stat = DEPOSITR.Next ();
  end;
  DEPOSITR.dropFilter();
*/
  /*
  NumCur = 0;
  While (NumCur <= KolCur)
     println ("branch ", branch, " KolAcc (NumCur) ", KolAcc(NumCur),
              " SumAcc(NumCur) ", SumAcc(NumCur));
     NumCur = NumCur + 1;
  end;
  */
  return TRUE;
end;
/**********************************************************/


macro ForTypeAccount
/*
  Цикл по видам вкладов
*/
  var stat;
  var i = 0;
  var strFilter;
//  var dpDepList = TdpDepList; //????????????

  //new
  cmd_SB_DTYP.CmdText=
    " SELECT * FROM dsb_dtyp_dbt "+
    " WHERE "+
    " t_Priorit >= "         + String(MinPrior)+
    " AND T_FLAGCUR = "      + String(FlagCur)+
    " AND T_PRIORIT <= "     + String(MaxPrior)+
    " AND T_KIND    <> \'" + NoLook+"\'";
    ;
  cmd_SB_DTYP.execute;
  rs_SB_DTYP = RsdRecordset(cmd_SB_DTYP);
  stat = rs_SB_DTYP.MoveNext;

/*old
  SB_DTYP.rec.FlagCur = FlagCur;
  SB_DTYP.rec.Priorit= MinPrior;
  strFilter = "t.T_FLAGCUR = "      + String(FlagCur)+
              " AND t.T_PRIORIT <= "+ String(MaxPrior)+
              " AND t.T_KIND    <> \'"+ NoLook+"\'";
  SB_DTYP.addFilter (strFilter);
  stat = SB_DTYP.GetGE();
*/

  //new
  while (stat AND (rs_SB_DTYP.value("t_FlagCur") == FlagCur) AND
   (rs_SB_DTYP.Value("t_Priorit") <= MaxPrior))

    i = 0;
    if ( (rs_SB_DTYP.Value("t_Kind") != NoLook ) and
         (rs_SB_DTYP.Value("t_Kind") != NoMobil) and
         (rs_SB_DTYP.Value("t_Kind") != United ) )
      while (i < KolCur)
        KolAcc (i) = 0;  KolAccNR (i) = 0;
        SumAcc (i) = 0;  SumAccNR (i) = 0;
        KolFin (i) = 0;  KolFinNR (i) = 0;
        SumFin (i) = 0;  SumFinNR (i) = 0;
        KolCont(i) = 0;  KolContNR(i) = 0;
        SumCont(i) = 0;  SumContNR(i) = 0;
        KolAccKind = 0;  KolAccKindNR = 0;
        i = i + 1;
      end;
      stat = AccForKind (FNcash);

      if (stat)
        StringReport ();
        stat = rs_SB_DTYP.MoveNext ();
      end;

    elif ( ( (rs_SB_DTYP.Value("t_Kind") == NoMobil) or
             (rs_SB_DTYP.Value("t_Kind") == United )   ) and
           ( BranchStatus == BS_OPERDEP  ) )
      KolAcc (i) = 0;  KolAccNR (i) = 0;
      SumAcc (i) = 0;  SumAccNR (i) = 0;
      KolFin (i) = 0;  KolFinNR (i) = 0;
      SumFin (i) = 0;  SumFinNR (i) = 0;
      KolCont(i) = 0;  KolContNR(i) = 0;
      SumCont(i) = 0;  SumContNR(i) = 0;
      KolAccKind = 0;  KolAccKindNR = 0;

      //new  
      cmd_listfdep = RsdCommand;
      cmd_listfdep.CmdText=
        " SELECT * FROM dlistfdep_dbt ";
      cmd_listfdep.execute;
      rs_listfdep = RsdRecordset(cmd_listfdep);
      while( rs_listfdep.MoveNext )
         stat = AccForKind ( rs_listfdep.Value("t_FNcash") );
      end;

      /*old rev.1.6
      dpDepList.SetFilter(dpDepList.getFilialID(NumFNCash()));
      while (dpDepList.next())
         stat = AccForKind (dpDepList.rec.Code);

      end;
      */

      /*old rev.1.5
      listfdep.Clear ();
      listfdep.Rewind      ();
      while (listfdep.Next ())
         stat = AccForKind (listfdep.rec.FNcash);
      end;
      */


      if (stat)
        StringReport ();
        stat = rs_SB_DTYP.MoveNext ();
      end;
    else
      stat = rs_SB_DTYP.MoveNext ();
    end;
  end;

/*old
  while (stat AND (SB_DTYP.rec.FlagCur == FlagCur) AND
   (SB_DTYP.rec.Priorit <= MaxPrior))
    i = 0;
    if ( (SB_DTYP.rec.Kind != NoLook ) and
         (SB_DTYP.rec.Kind != NoMobil) and
         (SB_DTYP.rec.Kind != United ) )
      while (i < KolCur)
        KolAcc (i) = 0;  KolAccNR (i) = 0;
        SumAcc (i) = 0;  SumAccNR (i) = 0;
        KolFin (i) = 0;  KolFinNR (i) = 0;
        SumFin (i) = 0;  SumFinNR (i) = 0;
        KolCont(i) = 0;  KolContNR(i) = 0;
        SumCont(i) = 0;  SumContNR(i) = 0;
        KolAccKind = 0;  KolAccKindNR = 0;
        i = i + 1;
      end;
      stat = AccForKind (FNcash);
      if (stat)
        StringReport ();
        stat = SB_DTYP.Next ();
      end;
    elif ( ( (SB_DTYP.rec.Kind == NoMobil) or
             (SB_DTYP.rec.Kind == United )   ) and
           ( BranchStatus == BS_OPERDEP  ) )
      KolAcc (i) = 0;  KolAccNR (i) = 0;
      SumAcc (i) = 0;  SumAccNR (i) = 0;
      KolFin (i) = 0;  KolFinNR (i) = 0;
      SumFin (i) = 0;  SumFinNR (i) = 0;
      KolCont(i) = 0;  KolContNR(i) = 0;
      SumCont(i) = 0;  SumContNR(i) = 0;
      KolAccKind = 0;  KolAccKindNR = 0;
      listfdep.Clear ();
      listfdep.Rewind      ();
      while (listfdep.Next ())
         stat = AccForKind (listfdep.rec.FNcash);
      end;
      if (stat)
        StringReport ();
        stat = SB_DTYP.Next ();
      end;
    else
      stat = SB_DTYP.Next ();
    end;
  end;
  SB_DTYP.dropFilter();
  */
end;
/**********************************************************/

macro sum_kind
/*
  Головной макрос
*/
  BeginReport();
  ForTypeAccount();
  EndRep();
end;
/*********/
sum_kind();