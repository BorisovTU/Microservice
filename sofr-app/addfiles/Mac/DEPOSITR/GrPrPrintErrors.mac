import rsd;

macro PrintErrorsFromTable

  var cmd, rs;
  var ErrorArray;
  var state, i;
  var printHeader = false;
  var isPrintRecord = false;
/*
  RsdCommand("insert into drt_grpr_errors_tmp (t_account, t_state, t_errortext) " +
             "values ('4230681057708082080699', 21077, 'При генерации шаблона РДД по операции возникла ошибка Не найдено значение категории счета ''НакопленныеПроценты'' для ВВ ''111179-2'' id  валюты = 0 id подразделения = 17')"
            ).execute;
  RsdCommand("insert into drt_grpr_errors_tmp (t_account, t_state, t_errortext) " +
             "values ('4230681027708082084799', 21077, 'При генерации шаблона РДД по операции возникла ошибка Не найдено значение категории счета ''НакопленныеПроценты'' для ВВ ''111179-2'' id  валюты = 0 id подразделения = 17')"
            ).execute;
  RsdCommand("insert into drt_grpr_errors_tmp (t_account, t_state, t_errortext) " +
             "values ('4230681097708082082099', 21077, 'При генерации шаблона РДД по операции возникла ошибка Не найдено значение категории счета ''НакопленныеПроценты'' для ВВ ''111179-2'' id  валюты = 0 id подразделения = 17')"
            ).execute;
*/

  cmd = RsdCommand(
      "select t_account, t_state, t_errortext " + 
        "from drt_grpr_errors_tmp");
  cmd.execute;
  rs = RsdRecordSet(cmd);
  while (rs.moveNext)
    state = rs.value("t_state");
    if (state != 0)
      if ( not printHeader )
        [ ];
        [ ];
        [   При проведении процедуры возникли следующие ошибки: ]; 
        [ ];
        [                         │ Код  │                                                                       ];
        [       Номер счета       │ошибки│           Описание ошибки                                             ];
        [─────────────────────────┼──────┼───────────────────────────────────────────────────────────────────────];
        printHeader = true;
      end;
      i = 1;
      ErrorArray = StrSplit2(rs.value("t_errortext"), 70, 70, 4);
      [ ########################│######│ ######################################################################]
      (rs.value("t_account"), state, ErrorArray[0]);
      isPrintRecord = true;
      while ((ErrorArray[i] != "") and (ErrorArray[i] != null))
        [                         │      │ ######################################################################]
        (ErrorArray[i]);
        i = i + 1;
      end;
    end;
  end;

  if (isPrintRecord)
    [─────────────────────────┴──────┴───────────────────────────────────────────────────────────────────────];
  end;

end; //PrintErrorsFromTable