/***************************************************************************\
| KONDTRUE.MAC RS-Retail Автор: Саввин Д.                                   |
| Для условного вида вклада                                                 |
\***************************************************************************/
/* Макрос подключается к тем операциям, для выполнения которых надо
проверять условие, указанное в пользовательских полях счета */

/*---------- Инициализируемые структуры ---------------------------------*/
 record ALG_DEPOSITOR("depositr.dbt");
 record ALG_SBDEPDOC("sbdepdoc.dbt");
 record ALG_PARAM("sb_algop.dbt");
 record quest(quest) dialog;
/*---------- Коды возврата макроса --------------------------------------*/
 const  OK_RES   =  0,  /* продолжать проводку */
        SKIP_RES =  1,  /* пропустить выполнение предопределенного модуля */
        END_RES  =  2,  /* завершить проводку */
        ERR_RES  = -1;  /* аваpийно завершить проводку */
/*-----------------------------------------------------------------------*/

 macro MyEvent(dlg,cmd,id,key)
   if(cmd==DLG_INIT)
     ALG_RESULT=END_RES;
     dlg.Kond=ALG_DEPOSITOR.UserField1+" "+
              ALG_DEPOSITOR.UserField2+" "+
              ALG_DEPOSITOR.UserField3+" "+
              ALG_DEPOSITOR.UserField4;
     UpdateFields(dlg);
     SetFocus(dlg,1);
     return CM_IGNORE;
   end;
   if(cmd==DLG_KEY)
     if((key==323) or (key==13) or (key==27))
       return CM_IGNORE;
     end
   end;
   if(cmd==DLG_BUTTON)
     if(trim(FldName(dlg,id))=="~Д~а")
       ALG_RESULT=OK_RES;
       return CM_SAVE;
     else
       ALG_RESULT=ERR_RES;
       return CM_SAVE;
     end;
   end;

   return CM_DEFAULT;
 end;

/*------------------------------------------------*/

if(not(RunDialog(quest,"MyEvent")))
  ALG_RESULT=ERR_RES;
  return;
end;
return;






