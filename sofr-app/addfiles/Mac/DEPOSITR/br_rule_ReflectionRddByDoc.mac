/*
$Name:               br_rule_ReflectionRddByDoc.mac
$Module:             DEPOSITR
$Description:        element_ReflectionRddByDoc
*/
/*
*/
import br_rule_common;

macro GetFieldMode ( numParameter, parameterType )
  if ( parameterType == BR_PROP_KEY )
    if ( numParameter == nf_key1 )
      return Type_FET;
    elif ( numParameter == nf_key2 )
    end;
  elif( parameterType == BR_PROP_VALUE )
    if ( numParameter == nf_value1 )
    end;
  end;
  return Type_FBT;
end;

macro FieldValue ( numParameter, parameterType, FldValue, stat )
  var retval = false;
  var sql = "";
  var fndvalue, rs_fndvalue;

  if ( parameterType == BR_PROP_KEY )
    if ( numParameter == nf_key1 )
      retval = true;
    elif ( numParameter == nf_key2 )
    end;
  elif( parameterType == BR_PROP_VALUE )
    if ( numParameter == nf_value1 )
    end;
  end;
  return retval;
end;

macro onMakeRecCurrent( val1 )
  SetBuff(element,val1);
end;

macro ListFieldValues( numParameter, parameterType )
  record llvalues("llvalues.dbt");
  var retval = "";
  var stat;
  var sql = "";
  var fndvalue, rs_fndvalue;

  if ( parameterType == BR_PROP_KEY )
    if ( numParameter == nf_key1 )
    elif ( numParameter == nf_key2 )
      if ( LL_ListLLVALUES(TYPE_OPERSPEC,llvalues) == true )
        element.key2 = llvalues.Code;
        retval = llvalues.Name;
      end;
    end;
  elif( parameterType == BR_PROP_VALUE )
    if ( numParameter == nf_value1 )
      var number = list_alg(LISTALG_TYPE_DOCRDD);
      retval = GetNameAlg(LISTALG_TYPE_DOCRDD, number);
      if ( retval != element.value1 )
        element.value1 = string(retval);
      end;
    end;
  end;

  return retval;
end;

macro GetFieldsText();

  var rule = TRecHandler ("businessruleparameter.1");
  var sql = "";
  var fndvalue, rs_fndvalue;

  rule.rec.key1   = element.key1;

  rule.rec.key2   = element.key2;
  var findobject =  rsdcommand("select * from DLLVALUES_DBT where T_LIST = ? AND T_CODE = ?");
  findobject.AddParam("List", RSDBP_IN, TYPE_PAYMENT);
  findobject.AddParam("codeCur", RSDBP_IN, element.key2);
  findobject.nullConversion = true;
  findobject.execute();
  var rs_findobject = RsdRecordset(findobject);
  if ( rs_findobject.moveNext() )
    rule.rec.key2 = rs_findobject.value("T_NAME");
  end;

  rule.rec.key3   = element.key3;
  rule.rec.key4   = element.key4;
  rule.rec.key5   = element.key5;
  rule.rec.key6   = element.key6;
  rule.rec.key7   = element.key7;
  rule.rec.key8   = element.key8;
  rule.rec.key9   = element.key9;
  rule.rec.key10  = element.key10;

  if ( (element.value1 == StrFor(0)) or (element.value1 == StrFor(1)) )
    element.value1 = "По вкладному счету";
  end;
  rule.rec.value1 = element.value1;
  sql = "select * from dnamealg_dbt where T_ITYPEALG = ? AND T_SZNAMEALG = ?";
  fndvalue =  rsdcommand(sql);
  fndvalue.AddParam("typeAlg", RSDBP_IN, Int(LISTALG_TYPE_DOCRDD));
  fndvalue.AddParam("szNameAlg", RSDBP_IN, String(element.value1));
  fndvalue.nullConversion = true;
  fndvalue.execute();
  rs_fndvalue = RsdRecordset(fndvalue);
  if ( rs_fndvalue.moveNext() )
    rule.rec.value1 = String(rs_fndvalue.value("T_SZNAMEALG"));
  end;

  rule.rec.value2 = element.value2;
  rule.rec.value3 = element.value3;
  rule.rec.value4 = element.value4;
  rule.rec.value5 = element.value5;
  return rule;
end;
