import od_desk;

class TCIRecGenerator( _oper, _makeReport, _observer )

  var
    oper = _oper,   
    makeReport = _makeReport, 
    observer = _observer, 
    totValCredit = $0,
    totValDebet = $0, 
    totValCreditCV = $0,
    totValDebetCV = $0;

  macro resetValCounter

    totValCredit = totValDebet = totValCreditCV = totValDebetCV = $0;
  end;

  macro updateValCounter( applicationKind, applicationKey )
 
    var
      valCredit, valDebet, valCreditCV, valDebetCV;

    desk.getValuesTurnsForOp( applicationKind, applicationKey, 
                         valCredit, valDebet, valCreditCV, valDebetCV );

    totValCredit = totValCredit + valCredit;
    totValDebet = totValDebet + valDebet;
    totValCreditCV = totValCreditCV + valCreditCV;
    totValDebetCV = totValDebetCV + valDebetCV;
  end;

  macro notifyObserver( type, lSubType, op, ground, totSum, totCoinSum )

    if ( totCoinSum == null )
      totCoinSum = $0;
    end;
   
    if ( observer != null )
      observer.writeLineAndUpdateTotals( type, PROC_TRANSFER, lSubType, op, ground, maxTime, 
                                         totSum, totCoinSum, 
                                         totValCredit, totValDebet, 
                                         totValCreditCV, totValDebetCV );
    end;
  end;

  macro printRec( applicationKind, applicationKey )
  end;

  macro f5_report
  end;

  macro proceed
  end;

  macro isOpIncluded( issue, op )

    return false;
  end;

  /* вызывается ручками из observer`а. SCR10801 */
  macro beforeDestructor
    observer = null;
  end;

  if ( oper == null )
    oper = 0;
  end;
  if ( makeReport == null )
    makeReport = true;
  end;
end;