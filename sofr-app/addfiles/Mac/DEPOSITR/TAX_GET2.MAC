/**************************************************************************\
*  --------------                                                          *
*  R-Style Soflab                                                          *
*  --------------                                                          *
*  RS-Retail                                                               *
*                                                                          *
*  Вклады                                                                  *
*                                                                          *
*  Проверка необходимости взятия комиссии при проведении операции          *
*  "Списание переводом" при различии клиентов в счете плательщике и        *
*  получателе                                                              *
*                                                                          *
*  Лебедев С.В.                                                            *
*  10.05.2000                                                              *
\**************************************************************************/

import DeprIntr, alg_vars;

file depositr ( depositr ) key 8;
file depdoc   ( sbdepdoc ); 

var depclnt  = TClientList;
var depclnt2 = TClientList;

record ALG_SBDEPDOC_1 ( "sbdepdoc.1" );


/**************************************************************************\
|                    Г Л А В Н А Я   П Р О Г Р А М М А                     |
\**************************************************************************/

  Copy( depdoc, ALG_SBDEPDOC );
  SetRecordAddr( ALG_SBDEPDOC_1, depdoc, 0, 0, true );
         
  ALG_RESULT = SKIP_RES;
  ALG_PARAM.prmD = 0;
  if (ALG_SBDEPDOC_1.CorrAcc_Referenc != "")

    depositr.Referenc = ALG_SBDEPDOC_1.CorrAcc_Referenc;
    if (GetEQ(depositr))
      if (depositr.CodClient == ALG_DEPOSITOR.CodClient)
        ;
      else
        if ( depclnt.GetRecord ( ALG_DEPOSITOR.CodClient ) AND 
             depclnt2.GetRecord( depositr.CodClient      )    )
          if ( ( depclnt.CurRec.rec.PaperNumber == "" ) AND 
               ( depclnt.CurRec.rec.PaperSeries == "" )    )
            ALG_RESULT = OK_RES;
          else
            if ( ( depclnt.CurRec.rec.PaperKind             == depclnt2.CurRec.rec.PaperKind             ) AND 
                 ( StrUpr( depclnt.CurRec.rec.PaperNumber ) == StrUpr( depclnt2.CurRec.rec.PaperNumber ) ) AND 
                 ( StrUpr( depclnt.CurRec.rec.PaperSeries ) == StrUpr( depclnt2.CurRec.rec.PaperSeries ) )    )
              ;
            else
              ALG_RESULT = OK_RES;
            end;
          end;
        else
          ALG_RESULT = OK_RES;
        end;
      end;
    end;
  end;
  if ((StrFor(GetProgramID) == "П") AND (ALG_PARAM.prmC == "X"))
    ALG_RESULT = OK_RES;
  end;
  
end;
