
/* Удаление следов из файла вкладных документов */

file dd("sbdepdoc.dbt") key 1000 write;

const
  D_AR=8,
  D_ARC=9,
  D_AUDIT_STORN=14,
  D_AUDIT_DELETE=15,
  D_AUDIT_CORRECT=16,
  D_DELETE=2;

var
  rec_found,
  tot_cnt=0,
  astorn_cnt=0,
  adel_cnt=0,
  acorr_cnt=0,
  ar_cnt=0,
  arc_cnt=0,
  del_cnt=0;

  Rewind(dd);
  rec_found=Next(dd);

  while(rec_found)
    if((dd.KindOp==D_AUDIT_STORN)
      or (dd.KindOp==D_AUDIT_DELETE)
      or (dd.KindOp==D_AUDIT_CORRECT)
      or (dd.KindOp==D_AR)
      or (dd.KindOp==D_ARC)
      or (dd.Action==D_DELETE))

      if(dd.KindOp==D_AUDIT_STORN)
        astorn_cnt=astorn_cnt+1;
      elif(dd.KindOp==D_AUDIT_DELETE)
        adel_cnt=adel_cnt+1;
      elif(dd.KindOp==D_AUDIT_CORRECT)
        acorr_cnt=acorr_cnt+1;
      elif(dd.KindOp==D_AR)
        ar_cnt=ar_cnt+1;
      elif(dd.KindOp==D_ARC)
        arc_cnt=arc_cnt+1;
      elif(dd.Action==D_DELETE)
        del_cnt=del_cnt+1;
      end;
      tot_cnt=tot_cnt+1;
      Delete(dd);
    end;
    rec_found=Next(dd);
  end;
  [Признак           Количество];
  [----------------------------];
  [D_AUDIT_STORN              #](astorn_cnt);
  [D_AUDIT_DELETE             #](adel_cnt);
  [D_AUDIT_CORRECT            #](acorr_cnt);
  [D_AR                       #](ar_cnt);
  [D_ARC                      #](arc_cnt);
  [D_DELETE                   #](del_cnt);
  [----------------------------];
  [Всего                      #](tot_cnt);
end;

