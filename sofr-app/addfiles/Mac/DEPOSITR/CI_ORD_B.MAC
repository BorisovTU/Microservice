/*

  Договор покупки Облигаций государственного сберегательного займа

*/

import CommonInter, BankInter;

private file BrList( "listfdep.dbt" ) key 0;

private var ClientList = TClientList;

private macro SetContractNumber( OGSZDocInfo )

  file DepParm( "depparm.dbt" ) key 0 write;

  if ( OGSZDocInfo.ContractNum == 0 )
    DepParm.FNcash = NumFNCash;
    DepParm.FlagCur = 0;
    GetEQ( DepParm );
    DepParm.OGSZ_LBuyContractNum = OGSZDocInfo.ContractNum = DepParm.OGSZ_LBuyContractNum  + 1;
    Update( DepParm );  
  end;
  return OGSZDocInfo.ContractNum;
end;

private macro GetCity

  var
   RegPath = "RS-RETAIL\\СЕРВИСНЫЕ\\ВКЛАДЫ\\ПАРАМЕТРЫ_ДОГОВОРОВ\\НАЗВ_ГОРОДА",
   Type = V_STRING,
   Value,
   ErrCode;

  if(GetRegistryValue(RegPath, Type, Value, ErrCode) == V_STRING)
    return Value;
  else
    return "???";
  end;
end;

private macro FindClient( CIDoc )

  return ClientList.GetRecord( CIDoc.ClientCode );
end;

macro PrintContractBuy
(
  CIDoc, 
  CIRate
)
  record OGSZDocInfo( "ci_doc.1" );
  FILE rep ( ) txt;

  /*____________142833 - SAN - Removal of the relative paths__________*/
  var textdir = GetRegVal( "BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ДИРЕКТОРИИ\\TEXTDIR", false );
  var contoutfile = "\\ci_ord_b.";
  var nr = textdir + contoutfile + UserNumber;
  //Println(nr);
  /*___________/142833 - 14/07/09_____________________________________*/

  //var nr = "..\\TXTFILE\\ci_ord_b." + UserNumber;
  var Series;   /* Серия      */
  var Value;    /* Цена       */
  var Warrant;  /* Накопленный купонный доход */
  var Items;    /* Количество */
  var LegalPerson;
  var ClientName;

  var Sum1;
  var Sum2;
  var Sum; 
  var sItem;
  var str1, str2;

  SetRecordAddr(OGSZDocInfo,CIDoc,0,FldOffset(CIDoc,"Info"),true);

  Series = OGSZDocInfo.Series;
  Value = CIRate.Buy;
  Warrant = CIRate.WarrantYield;
  Items = OGSZDocInfo.NumItems; 
  LegalPerson = OGSZDocInfo.LawPerson;

  if ( LegalPerson == StrFor ( 0 ) )
    return;
  end;

  if ( not GetTrue( true, "Оформлять договор?" ) )
    return;
  end;

  Sum1 = Value*Items;
  Sum2 = Warrant*Items;
  Sum = Sum1 + Sum2;

  DelFile( nr );

  Open( rep, nr );

  SetOutput( nr, TRUE );  /* Вывод в файл вывода договора */

  if ( not FindClient( CIDoc ) )
    MsgBox( "Не найден клиент" );
    Exit( 1 ); 
  end;

  ClientName = ClientList.CurRec.Rec.Name1 
       + " " + ClientList.CurRec.Rec.Name2 
       + " " + ClientList.CurRec.Rec.Name3 
       + " ";

  [

                              ДОГОВОР    # КУПЛИ-ПРОДАЖИ
                    ОБЛИГАЦИЙ ГОСУДАРСТВЕННОГО СБЕРЕГАТЕЛЬНОГО ЗАЙМА
                                 РОССИЙСКОЙ ФЕДЕРАЦИИ

    #                                                               #            
  ] ( SetContractNumber( OGSZDocInfo ), CIDoc.Date:m, GetCity );

  [
    __________________________________________________________________именуемое в
    дальнейшем <ПРОДАВЕЦ>, в лице  #_____________________________________________
    с одной стороны,    и _______________________________________________________
    ____________________________, именуемый   в  дальнейшем <ПОКУПАТЕЛЬ>,  в лице
    ____________________________________________________________, действующего на
    основании  Устава Сбербанка РФ,  Положения и доверенности  № 1-5258  от
    16.09.98 г.,  с другой стороны, заключили настоящий ДОГОВОР о нижеследующем.
  ] ( ClientName );

  [


                                  1. ПРЕДМЕТ ДОГОВОРА

           1.1. ПРОДАВЕЦ продает, а ПОКУПАТЕЛЬ покупает следующие Облигации
    государственного сберегательного займа Российской Федерации (далее - ОГСЗ):

          ┌───────┬──────────────┬─────────────┬──────────────────────────────┐
          │ Номер │    Цена      │ Количество, │         Сумма, руб.          │
          │ серии │  облигации   │    штук     │                              │
          │       │  (без учета  │             │                              │
          │       │ НКД), рублей │             │                              │
          ├───────┼──────────────┼─────────────┼──────────────────────────────┤
          │   ##  │ ############ │  #########  │ ############################ │
          └───────┴──────────────┴─────────────┴──────────────────────────────┘]
  ( Series:2, Value:12:2:a, Items:9:c, Sum1:28:2:a );
  RubToStr(Money(Items),sItem);
  str1 = Items + " (" + sItem + ") штук.";
  str2 = String(Sum1:a) + " (" + String(Sum1:m) + ").";
  [
         Общее количество: #
         Общая стоимость облигаций: #]
  ( str1, str2 );
  [
           1.2. Помимо цены облигаций, перечисленных в п. 1.1. настоящего ДОГОВОРА,
    ПОКУПАТЕЛЬ обязуется уплатить ПРОДАВЦУ сумму накопленного купонного дохода,
    официально объявленного на дату заключения настоящего ДОГОВОРА:

          ┌───────┬──────────────┬─────────────┬──────────────────────────────┐
          │ Номер │ Накопленный  │ Количество, │         Сумма, руб.          │
          │ серии │   купонный   │    штук     │                              │
          │       │    доход,    │             │                              │
          │       │    рублей    │             │                              │
          ├───────┼──────────────┼─────────────┼──────────────────────────────┤
          │   ##  │ ############ │  #########  │ ############################ │
          └───────┴──────────────┴─────────────┴──────────────────────────────┘]
  ( Series:2, Warrant:12:2:a, Items:9:c, Sum2:28:2:a );
  str2 = String(Sum2:a) + " (" + String(Sum2:m) + ").";
  [
          Общая сумма накопленного купонного дохода: #]
  ( str2 );
  str2 = String(Sum:a) + " (" + String(Sum:m) + ").";
  [
           1.3. Таким образом, общая сумма сделки по настоящему ДОГОВОРУ составляет
    #]
  ( str2 );
  [
           1.4. ПРОДАВЕЦ гарантирует, что до заключения настоящего ДОГОВОРА все
    поименованные в п. 1.1. ОГСЗ принадлежат ему на праве собственности, они не
    проданы, не заложены, не состоят в споре или под арестом и никакие третьи лица
    не имеют на них прав.


                       2. ОБЯЗАТЕЛЬСТВА И ОТВЕТСТВЕННОСТЬ СТОРОН

           2.1. ПРОДАВЕЦ обязуется выдать ПОКУПАТЕЛЮ приобретенные им ОГСЗ в
    течение одного банковского дня с момента заключения настоящего Договора.

           2.2. ПОКУПАТЕЛЬ обязуется оплатить указанные в п. 1.1. настоящего Договора
    ОГСЗ в течение одного банковского дня с момента их получения.

           2.3. За нарушение сроков, установленных п.п. 2.1. и 2.2. ДОГОВОРА виновная
    сторона уплачивает неустойку в размере 0,5 % от суммы ДОГОВОРА за каждый день
    просрочки.

           2.4. ПРОДАВЕЦ несет ответственность в полном объеме перед ПОКУПАТЕЛЕМ:
           - за полноту и достоверность сведений, указанных в п.п. 1.1., 1.2.
    настоящего ДОГОВОРА;
           - за передачу ОГСЗ в меньшем количестве, либо с иными реквизитами, чем
    указано в п.п. 1.1., 1.2.


                                     3. ФОРС-МАЖОР

           3.1. Ни одна из сторон не будет нести ответственность за полное или
    частичное неисполнение любой из своих обязанностей, если неисполнение будет
    являться следствием обстоятельств или событий чрезвычайного характера,
    которые сторона не могла ни предвидеть, ни предотвратить разумными мерами.

           3.2. При наступлении или прекращении указанных обстоятельств сторона в
    течение 3 календарных дней с момента их наступления или прекращения должна
    известить об этом в письменном виде другую сторону.



                              4. ПОРЯДОК РАЗРЕШЕНИЯ СПОРОВ

           4.1. Все споры, возникающие в ходе исполнения настоящего договора или
    связанные с ним, разрешаются сторонами путем переговоров, а при не достижении
    соглашения - в Арбитражном суде.



                            5. СРОКИ ДЕЙСТВИЯ ДОГОВОРА

           5.1. Настоящий договор вступает в силу с момента его подписания
    сторонами и прекращает свое действие после окончательного урегулирования всех
    расчетов по нему.
           Все изменения и дополнения к настоящему договору действительны лишь в
    случае, если они совершены в письменной форме и подписаны уполномоченными
    представителями сторон.
           Настоящий договор составлен в двух экземплярах, по одному для каждой
    стороны, причем оба экземпляра имеют одинаковую юридическую силу.



                    6. ЮРИДИЧЕСКИЕ АДРЕСА, РЕКВИЗИТЫ И ПОДПИСИ СТОРОН


       ПРОДАВЕЦ:  ______________________________________________________________

       Адрес: __________________________________________________________________

       Р/с ___________________, к/с ____________________, БИК __________________


       ПОКУПАТЕЛЬ: _____________________________________________________________

       Адрес: __________________________________________________________________

       Р/с ___________________, к/с ____________________, БИК __________________




             ПРОДАВЕЦ                                     ПОКУПАТЕЛЬ

       _______________________                      _______________________

               М.П.                                           М.П.

  ];

  SetOutput( NULL, TRUE );  /* Вывод в стандартный файл вывода */

  Close( rep );

  ViewFile( rep );

end;
