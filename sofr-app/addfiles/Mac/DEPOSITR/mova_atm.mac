/*--------------- Шаг алгоритма группового начисления----------------------
  Перевод счета в основное состояние если счет находится в альтернативном
  состоянии и операция - начисление пенсии
-------------------------------------------------------------------------*/
import deprintr, alg_vars;

/*---------- Коды возврата макроса --------------------------------------*/
 const
  OP_2_ALT = 85,
  OP_2_DEP = 86,

  НЕ_ОБНОВЛЯТЬ                                 =  0,
  ОБНОВИТЬ                                     =  1,
  ТИП_ОПЕРАЦИИ_ЗАЧИСЛЕНИЕ                      = 73,
  ПЕНСИЯ                                       =  2,
  ПЕНСИЯ_МО                                    =  5,
  ПЕНСИЯ_МВД                                   =  6,
  ПЕНСИЯ_ФСБ                                   =  7,
  ПЕНСИЯ_ФСНП                                  =  8,
  ПЕНСИЯ_ПРОКУРАТУРЫ                           =  9,
  СЧЕТ_ОТКРЫТ                                  =  "",
  СЧЕТ_В_ОСНОВНОМ_СОСТОЯНИИ                    =  0,
  СЧЕТ_В_АЛЬТЕРНАТИВНОМ_СОСТОЯНИИ              =  1,
  ОПЕРАЦИЯ_ПЕРЕВОДА_В_АЛЬТЕРНАТИВНОЕ_СОСТОЯНИЕ = OP_2_ALT,
  ОПЕРАЦИЯ_ПЕРЕВОДА_В_ОСНОВНОЕ_СОСТОЯНИЕ       = OP_2_DEP,
  FOREVER                                      = Date(1,1,9999),
  TODAY                                        = {curdate};

/*- Это мы возвращаем - по возврату Зубов найдет эти переменные
    по их ИМЕНАМ - шаман, однако !    --------------------------*/

 ALG_RESULT = ERR_RES;/*заранее инициализируем код возврата*/
 ALG_UPDATE = НЕ_ОБНОВЛЯТЬ;
/*--------------------------------------------------------------*/

 var
   errorCode;

  if(
     (ALG_DEPOSITOR.Open_Close   == СЧЕТ_ОТКРЫТ)
     AND (ALG_DEPOSITOR.UseAlternate == СЧЕТ_В_АЛЬТЕРНАТИВНОМ_СОСТОЯНИИ)
     AND (ALG_SBDEPDOC.TypeOper      == ТИП_ОПЕРАЦИИ_ЗАЧИСЛЕНИЕ)
     AND ((ALG_SBDEPDOC.ApplType      == ПЕНСИЯ)     OR
          (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_МО)  OR
          (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_МВД) OR
          (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_ФСБ) OR
          (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_ФСНП)  OR
          (ALG_SBDEPDOC.ApplType      == ПЕНСИЯ_ПРОКУРАТУРЫ)))
    errorCode = moveAccountIntoAnotherState
                (ОПЕРАЦИЯ_ПЕРЕВОДА_В_ОСНОВНОЕ_СОСТОЯНИЕ,
                   ALG_DEPOSITOR.Referenc,
                     ALG_SBDEPDOC.DepDate_Document+1,
                       FOREVER);


    if(errorCode==0)
      ALG_DEPOSITOR.UseAlternate = СЧЕТ_В_ОСНОВНОМ_СОСТОЯНИИ;
      ALG_DEPOSITOR.NumSession   = 0;
      ALG_RESULT                 = OK_RES;
      ALG_UPDATE                 = ОБНОВИТЬ;
    end;
  else
    ALG_RESULT = OK_RES;
    ALG_UPDATE = НЕ_ОБНОВЛЯТЬ;
  end;

  Exit(1); /* Убрать вывод на экран */

END;
/*----------------------------------------------------------------------*/