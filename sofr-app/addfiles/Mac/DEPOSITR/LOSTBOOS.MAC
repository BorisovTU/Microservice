/*
$Name:               lostboos.mac
$Module:             DEPOSITR
$Description:        Действия при сторнировании операции утери сберкнижки
*/
/**************************************************************************\
*  ---------------------                                                   *
*  R-Style Software Lab.                                                   *
*  ---------------------                                                   *
*  RS-Retail                                                               *
*                                                                          *
*  Вклады                                                                  *
*                                                                          *
*  Сторнирование операция по утере сберкнижки                              *
*                                                                          *
*  Лебедев С.В.                                                            *
*  12.07.2000                                                              *
\**************************************************************************/

import deprintr,alg_vars;

file depositr (depositr);

const UPDATE_ALL  = 1;
const UPDATE_DEP  = 2;
const UPDATE_DOC  = 4;


/**************************************************************************\
|                                                                          |
\**************************************************************************/
macro TrnProc

  var stat            = TRUE;
  var Storn           = TRUE;
  var UserTypeAccount = "";
  var Symb            = "";
  var i               = 1;

  if (ALG_PARAM.PrmC)
    Storn = TRUE;
  else
    Storn = FALSE;
  end;

  if (stat)
    i = 1;
    while (i <= StrLen(ALG_DEPOSITOR.UserTypeAccount))
      Symb = SubStr(ALG_DEPOSITOR.UserTypeAccount,i,1);
      if (Symb != "Y")
        UserTypeAccount = UserTypeAccount + Symb;
      end;
      i = i + 1;
    end;
    UserTypeAccount = "";
    ALG_DEPOSITOR.UserTypeAccount = UserTypeAccount;
    stat = UpdateAlgRecords(UPDATE_DEP,TRUE);
  end;

  if (stat)
      stat = DeleteDocument(ALG_SBDEPDOC.iApplicationKind,ALG_SBDEPDOC.ApplicationKey,Storn);
  end;

  if (NOT stat)
    AbortTrn();
  end;

end;


/**************************************************************************\
|                    Г Л А В Н А Я   П Р О Г Р А М М А                     |
\**************************************************************************/

  ALG_RESULT = OK_RES;

  if (ALG_RESULT == OK_RES)
    if (ProcessTrn(1,"TrnProc",depositr))
      ALG_RESULT = END_RES;
    else
        MsgBox("Ошибка во время проведения операции");
      ALG_RESULT = ERR_RES;
    end;
  end;

  
end;
