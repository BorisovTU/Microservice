/*

   R-Style SoftLab

   RS-Retail

   Макрос выпуска ф.31 и ф.187 при открытии "Блокированного целевого для ГЖС"

   Ввод суммы ГЖС

*/

import DeposInter;

file AI ( auxinfo ) key 0;  /* Доп.информация счета */

record ALG_DEPOSITOR ("depositr.dbt");
record ALG_SBDEPDOC  ("sbdepdoc.1");

private const AI_GJS = 18;  /* Тип для auxinfo.dbt для ГЖС */

var Sum = $0.0;

ReWind( AI );
ClearRecord( AI );
AI.Reference = ALG_DEPOSITOR.Referenc;
AI.InfoType  = AI_GJS;
AI.Date      = ALG_DEPOSITOR.Open_Date;
if ( GetEQ( AI ) )
  Sum = Money( SubStr( AI.Info, Index( AI.Info, "SUM.=" ) + 5 ) );
end;

ALG_SBDEPDOC.OutSum = Sum;

UpdateAlgRecords( 4, TRUE, TRUE );
