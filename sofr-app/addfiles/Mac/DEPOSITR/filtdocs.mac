/***************************************************************************
*  ---------------------                                                   *
*  R-Style Software Lab.                                                   *
*  ---------------------                                                   *
*  ФИЛИАЛ Сбербанка                                                        *
*                                                                          *
*  Печать проведённых документов по фильтру                                *
*                                                                          *
*  Ромодин А.В.                                                            *
*  04.04.00                                                                *
***************************************************************************/

import DeprIntr,rsd;

record sbdepdoc ( sbdepdoc );

//var depclnt = TClientList;
Private var rs_depclnt,cmd_depclnt,sql;

var headerPrinted = false;


array subs;             
  

macro printHeader( void )

 var str = "(рубли)";

 if( NumFlagCur() )
    str = "(валюта)";
 end;
 [
   ╔══════════════════════ Проведенные документы дня########══════════════════════╗
   ║─────────────────────────┬────────────────────┬──┬───────────────┬────────────║
   ║          Счет           │     Фамилия И.О.   │ВО│    Сумма      │Начисленные ║
   ║                         │                    │  │   операции    │ проценты   ║
   ║─────────────────────────┴────────────────────┴──┴───────────────┴────────────║
 ]( str );

end;

macro lineOut( void )

 var BO, FIO, sum;

 if( not headerPrinted )
    printHeader();
    headerPrinted = true;
 end;
 if( sbdepdoc.VidDoc )
    BO = "Н";
 else
    BO = "Б";
 end;
 if( sbdepdoc.InSum )
    BO = BO + "+";
    sum = sbdepdoc.InSum;
 elif( sbdepdoc.OutSum )
    BO = BO + "-";
    sum = sbdepdoc.OutSum;
 else
    sum = $0.00L;
 end;

 //new, scr # 85009

 sql = "SELECT * FROM dparty_dbt p"
            +"  WHERE  p.t_partyid = "+string( sbdepdoc.CodClient );
 
 cmd_depclnt = RsdCommand( sql );
 cmd_depclnt.execute;
 rs_depclnt = RsdRecordset( cmd_depclnt );
 if ( rs_depclnt.MoveNext )
   FIO = Trim( rs_depclnt.Value("t_Name") );
   subs(0)=Trim( SubStr(FIO, 1, StrBrk(FIO," ") ) );
   FIO=Trim( SubStr(FIO, StrBrk(FIO," ")) );
   subs(1)=SubStr(FIO,1,1);
   FIO=Trim( SubStr(FIO, StrBrk(FIO," ")) );
   subs(2)=SubStr(FIO,1,1);
   FIO = subs(0)+" "+subs(1)+"."+subs(2)+".";
 else
    FIO = "Клиент Не Найден";
 end;
 //*/

 /* /old
 if ( depclnt.GetRecord( sbdepdoc.CodClient ) )
    FIO = Trim( depclnt.CurRec.rec.Name1 );
    if ( StrLen( Trim( depclnt.CurRec.rec.Name2 ) ) > 0 )
      FIO = FIO + " " + SubStr( depclnt.CurRec.rec.Name2, 1, 1 ) + ".";
      if ( StrLen( Trim( depclnt.CurRec.rec.Name3 ) ) > 0 )
        FIO = FIO + SubStr( depclnt.CurRec.rec.Name3, 1, 1 ) + ".";
      end;
    end;
 else
    FIO = "Клиент Не Найден";
 end;
 */

[ ║######################### #################### ## ############### ############║]
 ( Acc_Form(sbdepdoc.Account), FIO, BO, sum, sbdepdoc.PercOprSum );

end;

/***************************************************************************\
|                      Г Л А В Н А Я   П Р О Г Р А М М А                    |
\***************************************************************************/
macro filtdocs( RecAddr )

  if( RecAddr != 0 )
    setbuff( sbdepdoc, RecAddr );
    lineOut();
  else
     [ ║                                                                              ║
       ╚══════════════════════════════════════════════════════════════════════════════╝
     ];  
  end;

end;
    