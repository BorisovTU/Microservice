/* ¥ç âì ®âç¥â  (prj937) */
import indebt;
private var {curdate};

macro Print_IndebtReport( _Data )
  var cmdstr = "";
  var cmd, rs;
  var numstr = 0;
  var IndebtRest = 0.0;
 
  cmdstr  = "SELECT indebt.t_IndebtID as IndebtID, indebt.t_Date as IndebtDate, indebt.t_IndebtKind as IndebtKind, curr.t_Short_Name as CurrName, "
            " depos.t_Account as Account, depos.t_CodClient as CodClient, depos.t_isCur as isCur, "
            " depos.t_Type_Account as TypeAcc, depos.t_SpecialAccess as SpecialAccess "
            " FROM ddpindebt_dbt indebt, ddepositr_dbt depos, dcurrency_dbt curr "
            " WHERE indebt.t_Branch = ? AND indebt.t_Date <= ? "
            " AND indebt.t_State = 1 AND indebt.t_Action <> 2 AND indebt.t_CardRef = 0 AND indebt.t_AuthRef = 0 "
            " AND depos.t_Referenc(+) = indebt.t_Reference "
            " AND curr.t_Code_Currency(+) = indebt.t_CurrencyCode ";
  cmd = RsdCommand(cmdstr);

  cmd.addParam("Branch", RsdBp_in);
  cmd.addParam("Date", RsdBp_in);
  cmd.value("Branch") = _Data.Branch;
  cmd.value("Date") = _Data.Repdate;
  cmd.execute();
  rs = RsdRecordset(cmd);

  while( rs.moveNext() )
    IndebtRest = GetIndebtRestForDate(_Data.Branch, rs.value("IndebtID"), _Data.RepDate);

    if( IndebtRest > 0 )
      numstr = numstr + 1;
      if( numstr == 1 )
        _Data.RepNumber = _Data.RepNumber + 1;
        [  
           ‘âàãªâãà­®¥ ¯®¤à §¤¥«¥­¨¥ ‘¡¥à¡ ­ª  ®áá¨¨ < ########## >]( _Data.NameBranch );
        [      < ##########   ######## >]( Date({curdate}), Time() );
        [  ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
           (¤ â  ¨ ¢à¥¬ï ä®à¬¨à®¢ ­¨ï ®âç¥â )

           
        ];
        [            ’—…’  …ƒ€˜…›• ‡€„‹†…‘’Ÿ•  ‘—…’€Œ ”ˆ‡ˆ—…‘Šˆ• ‹ˆ–  ‘‘’Ÿˆ € < ########## >]( _Data.RepDate );
        [ 
         ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
         ³ ®¬¥à áç¥â              ³ ”ˆ ª«¨¥­â        ³‚ «³áâ â®ª § ¤®«¦¥­­®áâ¨³„ â  ®¯¥à æ¨¨³ ‚¨¤ § ¤®«¦¥­­®áâ¨      ³
         ³                         ³                   ³   ³                     ³             ³                        ³
         ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
      end;

      [³#########################³###################³###³#####################³ ##########  ³########################³](
      rs.value("Account"),
      GetClientName( rs.value("CodClient"), rs.value("SpecialAccess")):w,
      rs.value("CurrName"),
      IndebtRest,
      Date(rs.value("IndebtDate")),
      GetIndebtName(rs.value("isCur"), rs.value("IndebtKind"), rs.value("TypeAcc"))
      );
    end;

  end;

  if( numstr > 0 )
    [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ



    ];
    [®¤¯¨áì: < ###################### >]( GetOperatorName() );
    [        ____________________________________________________
    
    
    ];
  end;
end;

macro IndebtReport( Branch, RepDate, DateFrom, DateTo, NeedStructFile )
  var cmdstr = "";
  var cmd, rs;
  var Data = IndebtReportData(Branch, RepDate, DateFrom, DateTo, NeedStructFile);
  
  GetDate(Data.RepDate, "„ â  ®âç¥â ");
  cmdstr = "SELECT t_name FROM ddp_dep_dbt WHERE t_code = ?";
  cmd = RsdCommand(cmdstr);
  cmd.addParam("Code", RsdBp_in);
  cmd.value("Code") = Data.Branch;

  cmd.execute();
  rs = RsdRecordset(cmd);
  if( rs.moveNext() )
    Data.NameBranch = rs.value("t_name");
    Print_IndebtReport(Data);
  end;
end;

END;