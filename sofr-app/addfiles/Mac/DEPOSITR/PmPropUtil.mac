/*
  Макрос - библиотека для работы с таблицей RTPaymentProp.dbt
  (реквизиты получателя)
*/

import CommonInter;
import rsd;
import RsbDataSet;

record PMNT_PROP_REC_BUF(RTPAYMENTPROP); /* глобальная переменная */

/* Поиск названия вида кода по номеру вида кода */
macro FindBankCodeKindName( codeKind )
  var stat, rsb;
  var query = "select t_name from dobjkcode_dbt" + 
                   " where t_objecttype=3 and t_codekind=" + codeKind;
  rsb = TRsbDataSet( query );
  stat = rsb.moveNext(); 
  
  if (stat == false) 
    return "не определено"; 
  end;
  return rsb.name; 
end;

/* Поиск PartyID банка по коду и виду кода */
macro FindPartyIDByCode( code, codeKind )
  var stat, rsb;
  var query;
if(code != "")
  if( ValType( codeKind ) == V_UNDEF )
    codeKind = 3;
  end;
  query = "select t_objectid from dobjcode_dbt" + 
         " where T_OBJECTTYPE=3 and T_CODEKIND=" + codeKind +
         " and T_CODE='" + code + "'";
             
  rsb = TRsbDataSet( query );
  stat = rsb.moveNext(); 
  
  if (stat == false) 
    return 0;
  end;
  return rsb.objectid; 
end;  
  return 0;
end;

/* Поиск реквизитов получателя по номеру документа и виду БП */

macro FindPmntProp(PmntProp, AppKind, AppKey)
  PmntProp.DocApplicationKind = AppKind;
	PmntProp.DocApplicationKey  = AppKey;
	if (not GetEQ(PmntProp))
		ClearRecord(PmntProp);
		return false;
	end;
	return true;
end;

