import rslx, rsexts;

class RtDocTemplateHandler
  private var m_templPath : string, m_outputPath : string;
  private var m_docPathName : string; 
  private var m_word = ActiveX( "Word.Application" );
  private var m_doc, m_curBm;
  private var m_curBmNo : integer = 0;

  macro setTemplatePath( val : string ) 
    m_templPath = val;
  end;

  macro setOutputPath( val : string )
    m_outputPath = val;
  end;

  macro newDocument( docFileName : string, templFileName : string ) : bool

    m_docPathName = getCurDir + "\\" + m_outputPath + "\\" + docFileName; 

    if ( not copyFile( m_templPath + "\\" + templFileName, 
                       m_docPathName ) )
      return false;
    end; 

    if ( not m_word.documents.open( m_docPathName ) )
      return false;
    end;

    m_doc = m_word.documents( docFileName );
    return true;
  end;

  macro closeDocument()
    m_doc.save;
  end;

  macro startGettingMarkers()
    m_curBmNo = 0;
  end;

  macro getNextMarker() : string

    m_curBmNo = m_curBmNo + 1;

    if ( m_curBmNo > m_doc.bookmarks.count )
      return null;
    end;

    m_curBm = m_doc.bookmarks( m_curBmNo );

    return subStr( m_curBm.name, 3 );
  end;

  macro getMarkerPos() : integer
    return 0;
  end;

  macro setLeftMargin( pos : integer )
  end;

  macro setRightMargin( pos : integer )
  end;

  macro setOverwriteMode( val : bool ) : bool
    var prev : bool = m_word.options.overtype;
    m_word.options.overtype = val; 
    return prev;
  end;

  macro insertText( text )
//    m_curBm.range.delete;
    m_curBm.range.insertAfter( text );
    return true;
  end;

  m_word.visible = true;
end;

   