/* выбирает записи графика оплаты по ячейке 
   и записывает в массив параметры */
   
class PayGrParams( number_, period_, sum_ )
  var number  = number_;
  var period  = period_;
  var sum     = sum_;
end;

class PayGrafCreator( contract, activeCell )

  private var contr   = contract;
  private var curCell = activeCell;
  private var PayGrArr = null;
  
  macro Create( AgrID )
    var rsPayGr = null;
    var i = 0;
    var PerDate;

    PayGrArr = TArray();

    rsPayGr = Выбрать_записи_графика_оплаты( contr.rec.Branch, contr.rec.ContractID, 
                    curCell.rec.SafeID, curCell.rec.CellNumber, AgrID );

    while( rsPayGr.moveNext() )
    
        DtTmSplit( rsPayGr.value("t_StartDate"), PerDate );
        PayGrArr[i] = PayGrParams( i+1, PerDate, rsPayGr.value("t_FutureSum") );
        i = i + 1;
        
    end;
  end;

  macro getGrafRecords()
    return PayGrArr;
  end;
end;

