import rsd;

MACRO CalcExpSum(contr, agrmnt)
  var Sum : money;
  var Cur : integer;
  var Rs, found;
  /* Ищем рублёвый тариф для платы за расширенние круга лиц :) */
  var TarifSelectQuery =  " select tar.T_SUMMA, tar.T_CODCUR from dpay_kind_dbt pk, dsb_tarif_dbt tar  where pk.T_NUMOPERAT = 22 and pk.T_NUMTARIF = tar.T_NUMTARIF and pk.T_GROUPOPERT = 21 and tar.t_iscur = pk.t_iscur and tar.T_ISCUR = 0";

  Rs = RsdRecordset( TarifSelectQuery );

    found = Rs.moveNext();  
    if (found)
    Sum = Rs.value(0);
    Cur = Rs.value(1);
    if (agrmnt.rec.AccessKind == 3) // DS_AK_BOTH
      Sum = Sum * 2;
    end;
    else
        Sum = $0;
        Cur = 0;
    end;

    return string(Sum)+"|"+string(Cur);
END;