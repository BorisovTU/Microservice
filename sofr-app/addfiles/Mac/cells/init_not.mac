/* Панель для операции смена нотариуса */

import CommonInter,RslCellObjects;

private var {curdate};

const ENTER = 13, ESC=27, F2=316, F3=317, SPACE=32;

var tmpObj;
var Mode;
/*
  Mode == 0 запретить редактирование
*/

/*    Инициализация записи договора с условием     */
macro init( obj )
  return obj.setVarPartFormat("dsnotary.rec");
end;

/* Мессадж - процедура для панели по доп. части договора*/
macro MessProcForContract(dl,cmd,id,key)

  if( cmd == DLG_INIT )

    dl.JusticeOrgName = tmpObj.varPart.rec.JusticeOrgName;
    dl.LegacyNumber   = tmpObj.varPart.rec.LegacyNumber;

    dl.OrderNumber    = tmpObj.varPart.rec.OrderNumber;
    dl.OrderDate      = tmpObj.varPart.rec.OrderDate;

    dl.LicenceNumber  = tmpObj.varPart.rec.LicenceNumber;
    dl.LicenceDate    = tmpObj.varPart.rec.LicenceDate;

    if( Mode == 0 )
      /*DisableFields( dl );
      EnableFields( dl, 1 );
      EnableFields( dl, 2 );*/
      DisableFields( dl, 2 );
      DisableFields( dl, 3 );
      DisableFields( dl, 4 );
      DisableFields( dl, 5 );
    end;
   
    UpdateFields(dl);
  end;

  if( cmd == DLG_KEY )
    
    if( Mode != 0 )
        if( key == F3 )
        end;
        if( key == SPACE )
        end;
        
        if( key == F2 )
        
          if( (dl.JusticeOrgName == "") or (dl.LegacyNumber == "") or 
              (dl.OrderNumber == "") or (dl.OrderDate == "")   )
              MsgBox ("Необходимо заполнить:| Наименование органа юстиции| Номер наследственного дела| Номер приказа| Дату приказа.");
              return CM_IGNORE;
          end;
        
            tmpObj.varPart.rec.JusticeOrgName = dl.JusticeOrgName;
            tmpObj.varPart.rec.LegacyNumber   = dl.LegacyNumber;
        
            tmpObj.varPart.rec.OrderNumber    = dl.OrderNumber;
            tmpObj.varPart.rec.OrderDate      = dl.OrderDate;
        
            tmpObj.varPart.rec.LicenceNumber  = dl.LicenceNumber;
            tmpObj.varPart.rec.LicenceDate    = dl.LicenceDate;
        
          return CM_SAVE;
        end;
        
    end;

    if( key == F2 )
      if( (dl.JusticeOrgName == "") or (dl.LegacyNumber == "") )
          MsgBox ("Необходимо заполнить:| Наименование органа юстиции| Номер наследственного дела");
          return CM_IGNORE;
      end;
    
        tmpObj.varPart.rec.JusticeOrgName = dl.JusticeOrgName;
        tmpObj.varPart.rec.LegacyNumber   = dl.LegacyNumber;    
        return CM_SAVE;
    end;            
    
    if( key == ESC )
      return CM_CANCEL;
    end;
  end;

end;

/* Ввод/редактирование доп. части по договору */
macro RunPanelForContract( obj, InputMode )

record dlg(DSNOTADV, sbbank) dialog;
  var status = false;

  tmpObj = obj;
  Mode = InputMode;
  status = RunDialog(dlg,"MessProcForContract");
  obj = tmpObj;

  return status;
end;

/*********** Теперь все для документа ************************/

/* Мессадж - процедура для панели по доп. части документа*/
macro MessProcForDocument(dl,cmd,id,key)
  if( cmd == DLG_INIT )

    dl.OldOrderNumber = tmpObj.varPart.rec.OldOrderNumber;
    dl.OldOrderDate   = tmpObj.varPart.rec.OldOrderDate;

    dl.OldLicenceNumber = tmpObj.varPart.rec.OldLicenceNumber;
    dl.OldLicenceDate   = tmpObj.varPart.rec.OldLicenceDate;

    dl.NewOrderNumber = tmpObj.varPart.rec.NewOrderNumber;
    dl.NewOrderDate   = tmpObj.varPart.rec.NewOrderDate;

    dl.NewLicenceNumber = tmpObj.varPart.rec.NewLicenceNumber;
    dl.NewLicenceDate   = tmpObj.varPart.rec.NewLicenceDate;

    if( Mode == 0 )
      DisableFields( dl );
    else
      DisableFields( dl,0);
      DisableFields( dl,1);
      DisableFields( dl,2);
      DisableFields( dl,3);
    end;
    UpdateFields(dl);
  end;
  if( cmd == DLG_KEY )
    if( key == F3 )
    end;
    if( key == F2 )

      if( (dl.NewOrderNumber == "") or (dl.NewOrderDate == "") )
        MsgBox ("Новый номер и дату приказа необходимо заполнить");
        return CM_CANCEL;
      end;

        tmpObj.varPart.rec.NewOrderNumber = dl.NewOrderNumber;
        tmpObj.varPart.rec.NewOrderDate   = dl.NewOrderDate;

        tmpObj.varPart.rec.NewLicenceNumber = dl.NewLicenceNumber;
        tmpObj.varPart.rec.NewLicenceDate   = dl.NewLicenceDate;

      return CM_SAVE;
    end;
    if( key == SPACE )
    end;
    if( key == ESC )
      return CM_CANCEL;
    end;
  end;

end;

/*    Инициализация записи документа с условием     */
macro initDocument( obj )
  
  return obj.setVarPartFormat("dsdocnot.rec");

end;

macro RunPanelForDocument( varPart, InputMode )
record dlg(DSNOTPAN, sbbank) dialog;
  var status = false;

  tmpObj = varPart;
  Mode = InputMode;
  
  status = RunDialog(dlg,"MessProcForDocument");
  
  varPart = tmpObj;
  SetParm(0,varPart);

  return status;
end;

/* Установка названий полей в панели ввода/редактирования договора */
macro GetFieldsName()

var strName1 = "Нотариус 1:",
    strName2 = "            ";
  
  return strName1 + strName2;

end;

end; /* EOF */
