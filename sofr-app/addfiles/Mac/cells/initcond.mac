import CommonInter,RslCellObjects;

var tmpObj,Mode;
private var {curdate};

const ENTER = 13, ESC=27, F2=316, F3=317, SPACE=32;

/*    Инициализация записи договора с условием     */
macro init( obj )

  //obj.rec.Number = String(obj.rec.ContractID);
  return obj.setVarPartFormat("dscondop");

end;

/* Мессадж - процедура для панели по доп. части договора*/
macro MessProcForContract(dl,cmd,id,key)
  if( cmd == DLG_INIT )
    dl.CheckBeginDate = tmpObj.varPart.rec.CheckBeginDate;
    dl.CheckEndDate = tmpObj.varPart.rec.CheckEndDate;
    dl.Condition = tmpObj.varPart.rec.Condition;
    UpdateFields(dl);
    if( Mode == 0 )
      DisableFields( dl );
    end;
  end;
  if( cmd == DLG_KEY )
    if( key == F3 )
    end;
    if( key == F2 )
      if( dl.CheckBeginDate >= dl.CheckEndDate )
	msgbox( "Дата окончания контрольного периода меньше даты начала!" );
	return CM_IGNORE;
      else
	if( (dl.CheckBeginDate < tmpObj.rec.OpenDate) OR (dl.CheckEndDate > tmpObj.rec.EndDate) )
	  msgbox( "Контрольный период вне сроков договора аренды!" );
	  return CM_IGNORE;
	else
          tmpObj.varPart.rec.CheckBeginDate = dl.CheckBeginDate;
          tmpObj.varPart.rec.CheckEndDate = dl.CheckEndDate;
          tmpObj.varPart.rec.Condition = dl.Condition;
          return CM_SAVE;
	end;
      end;
    end;
    if( key == SPACE )
    end;
    if( key == ESC )
      if( (tmpObj.varPart.rec.CheckBeginDate != dl.CheckBeginDate) OR
	  (tmpObj.varPart.rec.CheckEndDate != dl.CheckEndDate) OR
	  (tmpObj.varPart.rec.Condition != dl.Condition) )
	if( NOT ConfDlg ("Внимание! Данные были изменены. Вы действительно хотите выйти",NULL,"Да","Нет") )
          return CM_CANCEL;
        else
	  return CM_IGNORE;
        end;
      else
        return CM_CANCEL;
      end;
    end;
  end;
end;

/* Ввод/редактирование доп. части по договору */
macro RunPanelForContract( obj, InputMode )
record dlg(DSCONDOP) dialog;

  tmpObj = obj;
  Mode = InputMode;
  RunDialog(dlg,"MessProcForContract");
  obj = tmpObj;

  return true;
end;

/*********** Теперь все для документа ************************/

/* Мессадж - процедура для панели по доп. части документа*/
macro MessProcForDocument(dl,cmd,id,key)
  if( cmd == DLG_INIT )
    dl.NewCheckBeginDate = tmpObj.varPart.rec.CheckBeginDate;
    dl.NewCheckEndDate = tmpObj.varPart.rec.CheckEndDate;
    if( Mode == 0 )
      DisableFields( dl );
    else
      DisableFields( dl,0);
    end;
    UpdateFields(dl);
  end;
  if( cmd == DLG_KEY )
    if( key == F3 )
    end;
    if( key == F2 )
      tmpObj.varPart.rec.CheckBeginDate = dl.NewCheckBeginDate;
      tmpObj.varPart.rec.CheckEndDate = dl.NewCheckEndDate;
      return CM_SAVE;
    end;
    if( key == SPACE )
    end;
    if( key == ESC )
      return CM_CANCEL;
    end;
  end;
end;

/*    Инициализация записи договора с условием     */
macro initDocument( obj )
  
  return obj.setVarPartFormat("dsdocdop");

end;

macro RunPanelForDocument( varPart, InputMode )
record dlg(DSDOCDOP) dialog;

  tmpObj = varPart;
  Mode = InputMode;
  RunDialog(dlg,"MessProcForDocument");
  varPart = tmpObj;
  SetParm(0,varPart);

  return true;
end;

/* Установка названий полей в панели ввода/редактирования договора */
macro GetFieldsName()

var strName1 = "Покупатель:",
    strName2 = " Продавец:";
  
  return strName1 + strName2;

end;

end;