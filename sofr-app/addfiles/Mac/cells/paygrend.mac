import Š «¥­¤ àì, DeprIntr;

/* ’¨¯ë ª«¨¥­â®¢. …á«¨ çâ® ­ ¤® ¥é¥ ¢ stforcel.mac ¯®¬¥­ïâì */
private const CT_PHYSICAL = 0,   /* ”¨§. «¨æ® */
              CT_LEGAL    = 1;   /* à¨¤¨ç¥áª®¥ «¨æ® */

/******************************************************************************/
private macro GetMonth( ClientType, DateBegin )
  var Period = 0;
  var d,m,y;

  datesplit( DateBegin, d,m,y );

  if( ClientType == CT_PHYSICAL )  /* ”¨§. «¨æ® */
    Period = GetRegVal( "RS-RETAIL\\‘…‚ˆ‘›…\\‘…‰”‚›…_Ÿ—…‰Šˆ\\…ˆ„_’€†_„•\\”ˆ‡_‹ˆ–", true );
  end;
  if( ClientType == CT_LEGAL)      /* à¨¤¨ç¥áª®¥ «¨æ® */
    Period = GetRegVal( "RS-RETAIL\\‘…‚ˆ‘›…\\‘…‰”‚›…_Ÿ—…‰Šˆ\\…ˆ„_’€†_„•\\_‹ˆ–", true );
  end;
  if( Period == 1 ) /*  Œ¥áïæ */
  end;
  if( Period == 2 ) /*  Š¢ àâ « */
    if( (int(m / 3)) != (double(m) / 3) )
      m = (int(m / 3) + 1 )*3 ;
    end;
  end;
  if ( Period == 3)
      m = 12;
  end;

  return m;
end;
/******************************************************************************/
macro GetDateEnd( ClientType, DateBegin )
  var DateEnd = date(0,0,0), d,m,y;

  datesplit(DateBegin, d,m,y);
  m = GetMonth( ClientType, DateBegin );
  d = LastDayInMonth( date(10,m,y) );
  DateEnd = date(d,m,y);

  return DateEnd;
end;
/******************************************************************************/
macro GetReportDate( ClientType, DateBegin )
  var RepDate = date(0,0,0), d,m,y, month;
  var RepDay = GetRegVal( "RS-RETAIL\\‘…‚ˆ‘›…\\‘…‰”‚›…_Ÿ—…‰Šˆ\\’—…’›‰_„…œ", true );

  datesplit(DateBegin, d,m,y);

  month = m = GetMonth( ClientType, DateBegin );
/*  if( RepDay < 1 )
    RepDay = 1;
  end; */

  if( ( RepDay < 1 ) or ( RepDay > 28 ) )
    RepDay = LastDayInMonth( date( 10, m, y) );
  end;  

  RepDate = date( RepDay, m, y );
  while( IsHoliday(RepDate) )
    RepDate = DateAfterCalenDays(RepDate,1);
  end;
  datesplit( RepDate, d,m,y);
  if( month != m )
    RepDate = date( RepDay, month, y );
    while( IsHoliday(RepDate) )
      RepDate = DateAfterCalenDays(RepDate,-1);
    end;
  end;

  return RepDate;
end;
