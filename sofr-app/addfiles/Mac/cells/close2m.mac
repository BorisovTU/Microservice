/* Закрытие договора для типа "2 Арендатора" */
import closecls;

class (TCloseContractOperation) TCloseContractOperationWithTwoMen( opObj )

  macro checkClients()
    if (not checkClients())
      return false;
    end;

    var Found1 = false,Found2 = false,stat;
    
    stat = operationObj.clientList.first();
    while( stat )
      if( (strlen(operationObj.clientList.item.rec.Attributes)==0) OR 
	  index(operationObj.clientList.item.rec.Attributes,"Г") OR
	  index(operationObj.clientList.item.rec.Attributes,"Д") )
        if( operationObj.clientList.item.rec.GroupNumber == 1 )
          Found1 = true;
        else
          Found2 = true;
        end;
      end;
      stat = operationObj.clientList.next();
    end;
    if( not (Found1 AND Found2) )
      msgbox("Должны присутствовать оба арендатора или их доверенные лица!");
    end;
    return (Found1 AND Found2);
  end;

  InitTCloseContractOperation( opObj );
end;

/********* Основная программа ******************************/

var obj = TCloseContractOperationWithTwoMen( operation );

  obj.runOp();

end;
