/* Стандартный макрос для расчета суммы по тарифу */
  	// если тариф интервально-периодический
    // if( Tarif.rec.TermUnit == Tarif.rec.PeriodUnit )

import DeprIntr,CommonInter;

const Day = 1;

macro GetSum(Contract,Tarif)

var Sum = $0,
    i=0;

	// если тариф не интервальный 
  if( (( Tarif.rec.TermMinVal == 0 ) and ( Tarif.rec.TermMaxVal == 0 ) and ( Tarif.rec.TermUnit == 0 ) and (Tarif.rec.PeriodUnit != 0) ) 
       or ( ( Tarif.rec.TermMinVal != 0 ) and ( Tarif.rec.TermMaxVal != 0 ) and ( Tarif.rec.TermUnit == Tarif.rec.PeriodUnit ) ) )

  		// если тариф периодический или интервально-периодический
    if(Contract.rec.TermTail == 0)
      i = Contract.rec.TermValue;
    else
      if( Contract.rec.TermType == Day)
        i = Contract.rec.TermValue + Contract.rec.TermTail;
      else
        i = Contract.rec.TermValue + 1;
      end;
    end;
  else
  	// если тариф интервальный
    i = 1;
  end;
  Sum = Sum + Tarif.rec.FixedSum + (Tarif.rec.TariffValue * i);

  if( Sum < Tarif.rec.MinPaySum )
    Sum = Tarif.rec.MinPaySum;
  end;
  
  return Sum;
end;