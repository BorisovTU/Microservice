/* Доступ к ячейке для типа договора "С Условием"*/
import accesscl;

class (TOperationAccessToCell) TOperationAccessToCellWithCondition( opObj )

  macro checkClients()
    if (not checkClients())
      return false;
    end;

    var AllFound = true,Found,stat,opstat;
    
    stat = operationObj.contract.clients.first();
    while( stat )
      if( NOT index(operationObj.contract.clients.item.rec.Attributes,"Д") )
        Found = false;
        opstat = operationObj.clientList.first();
        while( opstat and (not Found) )
          if( (operationObj.contract.clients.item.rec.ClientCode == operationObj.clientList.item.rec.ClientCode ) OR
  	    (operationObj.contract.clients.item.rec.ClientCode == operationObj.clientList.item.rec.ProxyOf ) )
  	    Found = true;
          end;
          opstat = operationObj.clientList.next();
        end;
        if( NOT Found )
  	  stat = false;
  	  AllFound = false;
	end;
      end;
      if( stat )
        stat = operationObj.contract.clients.next();
      end;
    end;
    return AllFound;
  end;

  macro runOp()
    operationObj.contract.setVarPartFormat("dscondop");
    msgbox( CreateString(operationObj.contract.varPart.rec.Condition) );
    return runOp();
  end;

  InitTOperationAccessToCell( opObj );
end;

/******************** Основная программа ***********************/

var obj = TOperationAccessToCellWithCondition( operation );

  obj.runOp();

end;