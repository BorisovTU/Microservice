/*
    Информирование о необработанных документах
    Планируемые

            Mikhailov S., 22.08.2001, Wed

    
*/

import cbinfcom;
import cbinfint;

macro CBINF_Proc( RegPath, OutType )

    file indexv( indexv ) key 0;
    file indexc( indexc ) key 0;

    var this_stat, nmbRec = 0;

    CBINF_Result = 0;
    CBINF_ErrorStatus = 0;

    if( OutType == CBINF_OutReport )
        if( PrintHeader( RegPath, LIST_PLANNED ) )
            return CBINF_StatusError;
        end;
    end;


    rewind ( indexv );
    
	InitProgress( NRecords(indexv) * 2, "Информирование о необработанных документах", "Планируемые" );
	
    while( next( indexv ) )

	    nmbRec = nmbRec + 1;
	    UseProgress( nmbRec );

        if( ( indexv.date_carry <= {curdate} ) and ( CBINF_OperDocFit( indexv.Oper ) == 0 ) )
        
            if( OutType == CBINF_OutMsg )
            
                this_stat = MsgDocFound( RegPath, CBINF_Planned, indexv );
                if( this_stat )
 	                RemProgress( nmbRec );
                   return this_stat;
                end;
                
            elif( OutType == CBINF_OutReport )
                this_stat = PrintLine( RegPath, CBINF_Planned, indexv );
                if( this_stat )
 	                RemProgress( nmbRec );
                   return this_stat;
                end;
                
            end;/*OutType*/
            
        end;/*if CBINF_OperDocFit*/
        
    end;/*while*/


    while( next( indexc ) )

	    nmbRec = nmbRec + 1;
	    UseProgress( nmbRec );

        if( ( indexc.date_carry <= {curdate} ) and ( CBINF_OperDocFit( indexc.Oper ) == 0 ) )
        
            if( OutType == CBINF_OutMsg )
            
                this_stat = MsgDocFound( RegPath, CBINF_Planned, indexc );
                if( this_stat )
 	                RemProgress( nmbRec );
                   return this_stat;
                end;
                
            elif( OutType == CBINF_OutReport )
                this_stat = PrintLine( RegPath, CBINF_Planned, indexc );
                if( this_stat )
	                RemProgress( nmbRec );
                    return this_stat;
                end;
                
            end;/*OutType*/
            
        end;/*if CBINF_OperDocFit*/
        
    end;/*while*/

    RemProgress( nmbRec );

    if( OutType == CBINF_OutReport )
        if( PrintFooter( RegPath, LIST_PLANNED ) )
            return CBINF_StatusError;
        end;
    end;

    return CBINF_StatusOk;

    
end;/*CBINF_Proc*/

/*test call
const REGPATH = "COMMON\\CBINFPARMS";
var ret;

ret = CBINF_Proc( REGPATH, CBINF_OutReport);

msgbox( "test : stat =  ", ret , " CBINF_Result = ", CBINF_Result );
*/


