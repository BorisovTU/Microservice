 import rcw;
 import rcwTools;
 import adaptLoc;
// import debug;

  /* Если channelName равно пустой строке "", для каждого локального
     инстанса RSL создается свой канал и соответственно отдельный процесс
     на стороне сервера приложений. Если для канала задано непустое имя,
     все локальные инстансы будут использовать по одному каналу на каждое
     имя.
  */
  class CRemoteRSL(channelName:string,channelIniFileName:string,initRemoteProgressBar,initRemoteGetInput)
    var channel;
    var host;

    if(channelName != "")
      channel=GetNamedChanel(channelName); end;
    if(ValType(channel) == V_UNDEF)
      channel=TRSLChanel();
      channel.LoadConfig(channelIniFileName);
      if(channelName != "")
        channel.name=channelName; end;
//      dbgPrint(channel,true);
      if(not channel.connect())
        RunError(string("Невозможно установить соединение с сервером ",channel.server)); end;
    end;

    host=CreateObject("rcwhost","TRcwHost",null,channel,TRCWSite());
//    dbgPrint(host,true);
//    PrintObject(host);

    host.AddModule("adaptRmt");
    host.execute();
    private class CLocalClass
    end; /* end of class CLocalClass */
    host.call("RemoteAdapterStart",CLocalClass(),initRemoteProgressBar,initRemoteGetInput);
    LocalAdapterInit();


    macro destructor()
      if(ValType(host) != V_UNDEF)
        host.call("RemoteAdapterStop");
        host.stop();
        host.DetachSite();
        host=null;
        ClrRmtStubs();
      end;
      channel=null;
      ClrRmtStubs();
    end;
  end; /* end of class CRemoteRSL */
