
import "operlog", BankInter, oralib,likepy;

var {operlog};

class TPrintOperLog
   private var opLog = {operlog};

   const PreImage = 1;
   const PostImage = 2;
   const BothImage  = 3;

   macro printHeader()
         [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ ########## ######## Ä](Date(), Time());
         [ ];
         [##############################################################################](opLog.Name():c);
         [ ];
   end;
   macro printFooter()
         [ ];
         [##############################################################################]("Š®­¥æ ®âç¥â ":c);
         [ ];
         [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ ########## ######## Ä](Date, Time);
   end;

   /*³º
    *ÚÄÂÄ¿ ÉÍËÍ» ÖÄÒÄ·ÕÍÑÍ¸
    *ÃÄÅÄ´ ÌÍÎÍ¹ ÇÄ×Ä¶ÆÍØÍµ
    *ÀÄÁÄÙ ÈÍÊÍ¼ ÓÄĞÄ½ÔÍÏÍ¾
    */
   private macro printTopLine()
         [ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
   end;
   private macro printCenterLine()
         [ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
   end;
   private macro printBotLine()
         [ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
   end;

   private macro printMesgEntry(mesgEntry)

      var mesgText = mesgEntry.mesgText;
         [³                                                                            ³
          ³ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·³];
         [³º##########################################################################º³](mesgText:w);
         [³ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½³];
   end;

   private macro printBFileEntry(bfileEntry)

         [³¯¨á ­¨¥ ä ©«  ­ ©¤¥­® ¢ á«®¢ à¥: ##########################################³]
         (bfileEntry.dictName():w);

      var imageType = opLog.getImageType(opLog.opCode);

      var recBuf = bfileEntry.recBuf;
      var recLen = bfileEntry.recLen;
      var saveBuf = bfileEntry.saveBuf;
      var saveLen = bfileEntry.saveLen;

      var rec = bfileEntry.GetRecord();
      var save = bfileEntry.GetSaveRecord();

      var numFld = rec.FldNumber();
      var i = 0;
      
      var val1, val2, diff;

      if (imageType == PreImage)
         /*
          * ‚ë¢®¤ ¨§®¡à ¦¥­¨ï § ¯¨á¨ [„®] ®¯¥à æ¨¨
          */

         if (recLen <= 0)
         [³âáãâáâ¢ã¥â ¨§®¡à ¦¥­¨¥ § ¯¨á¨                                              ³];
            return;
         end;

         /* 1234567890123456789012 123456789012345678901234*/
         [³                                                                            ³
          ³ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·                           ³
          ³º  §¢ ­¨¥ ¯®«ï        ³  ‡­ ç¥­¨¥ ¤® ®¯¥à æ¨¨  º                           ³
          ³ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶                           ³];

         i = 0;
         while (i < numFld)
         [³º######################³########################º                           ³]
         (FldComment(rec.TblName, i), rec.item(i):r:w);
         i = i + 1;
         end;
         [³ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½                           ³];

      elif (imageType == PostImage)
         /*
          * ‚ë¢®¤ ¨§®¡à ¦¥­¨ï § ¯¨á¨ [®á«¥] ®¯¥à æ¨¨
          */

         if (recLen <= 0)
         [³âáãâáâ¢ã¥â ¨§®¡à ¦¥­¨¥ § ¯¨á¨                                              ³];
            return;
         end;

         /* 1234567890123456789012 123456789012345678901234*/
         [³                                                                            ³
          ³ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·                           ³
          ³º  §¢ ­¨¥ ¯®«ï        ³ ‡­ ç¥­¨¥ ¯®á«¥ ®¯¥à æ¨¨º                           ³
          ³ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶                           ³];

         i = 0;
         while (i < numFld)
         [³º######################³########################º                           ³]
         (FldComment(rec.TblName, i), rec.item(i):r:w);
         i = i + 1;
         end;
         [³ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½                           ³];

      elif (imageType == BothImage)
         /*
          * ‚ë¢®¤ ¨§®¡à ¦¥­¨ï § ¯¨á¨ [„®] ¨ [®á«¥] ®¯¥à æ¨¨
          */

         if (recLen <= 0)
         [³âáãâáâ¢ã¥â ¨§®¡à ¦¥­¨¥ § ¯¨á¨ ¯®á«¥ ®¯¥à æ¨¨                               ³];
            return;
         end;

         if (saveLen <= 0)
         [³âáãâáâ¢ã¥â ¨§®¡à ¦¥­¨¥ § ¯¨á¨ ¤® ®¯¥à æ¨¨                                  ³];
            return;
         end;

         /* 1234567890123456789012   123456789012345678901234 123456789012345678901234*/
         [³                                                                            ³
          ³ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·³
          ³º  §¢ ­¨¥ ¯®«ï        ³ ³  ‡­ ç¥­¨¥ ¤® ®¯¥à æ¨¨  ³‡­ ç¥­¨¥ ¯®á«¥ ®¯¥à æ¨¨ º³
          ³ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶³];
         i = 0;
         while (i < numFld)

         val1 = save.item(i);
         val2 = rec.item(i);

         if (val1 == val2) diff = "";
         else diff = "X"; end;

         [³º######################³#³########################³########################º³]
         (FldComment(rec.TblName, i), diff, val1:r:w, val2:r:w);
         i = i + 1;
         end;
         [³ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½³];
      end;
   end;

   private macro printProgramEntry(programEntry)

      var progDate = programEntry.progDate;
      var progTime = programEntry.progTime;
      var progSize = programEntry.progSize;
      var progPath = programEntry.progPath;
      var version = programEntry.progVersion;

         [³                                                                            ³
          ³ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·³
          ³ºãâì: ####################################################################º³
          ³º„ â : ####################################################################º³
          ³º‚à¥¬ï: ###################################################################º³
          ³º §¬¥à: ##################################################################º³
          ³º‚¥àá¨ï: ##################################################################º³
          ³ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½³]
         (progPath:l, progDate:l, progTime:l, progSize:l, version:l);
   end;

   private macro printOprStepExecReport()
      
      var OprStepExec = TRecHandler("oprstep_exec.str");
      file oproper( oproper );

      var Kind_Operation, DocKind, DocID;
      
      var alreadyTreated = 0;
      var BuffSize = opLog.VarBuffSize;
            
      opLog.ReadVarData( 10, OprStepExec);
            
      oproper.ID_Operation = OprStepExec.rec.ID_Operation;
      if( not getEQ(oproper) )
        Kind_Operation = "";
        DocKind = "";
        DocID = "";
      else
        Kind_Operation = oproper.Kind_Operation;
        DocKind = oproper.DocKind;
        DocID   = oproper.DocumentID;
      end;

         [³                                                                            ³
          ³   ‚ˆŒ€ˆ…! ˆ­ä®à¬ æ¨ï ¢ áâà®ª å "‚¨¤ ®¯¥à æ¨¨", "‚¨¤ ¤®ªã¬¥­â ",          ³
          ³   "ˆ¤¥­â¨ä¨ª â®à ¤®ªã¬¥­â " ®âà ¦ ¥â á®áâ®ï­¨¥ ¡ §ë ¤ ­­ëå ­  ¬®¬¥­â       ³
          ³   ¯¥ç â¨ ®âç¥â !                                                           ³ 
          ³ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·³
          ³ºˆ„ ®¯¥à æ¨¨:            ##################################################º³
          ³ºˆ„ è £ :                ##################################################º³
          ³º®¬¥à ¡«®ª :            ##################################################º³
          ³º®¬¥à è £ :             ##################################################º³
          ³º‚¨¤ ®¯¥à æ¨¨:           ##################################################º³
          ³º‚¨¤ ¤®ªã¬¥­â :          ##################################################º³
          ³ºˆ¤¥­â¨ä¨ª â®à ¤®ªã¬¥­â :##################################################º³
          ³ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½³]        
         (OprStepExec.rec.ID_Operation, OprStepExec.rec.ID_Step, OprStepExec.rec.BlockID, OprStepExec.rec.Number_Step,
          Kind_Operation, DocKind, DocID:r);
                                                           
      alreadyTreated = alreadyTreated + 22;
      while( alreadyTreated < BuffSize )
        opLog.ReadVarData( alreadyTreated, OprStepExec);
        alreadyTreated = alreadyTreated + 12;

        oproper.ID_Operation = OprStepExec.rec.ID_Operation;
        if( not getEQ(oproper) )
          Kind_Operation = "";
          DocKind = "";
          DocID = "";
        else
          Kind_Operation = oproper.Kind_Operation;
          DocKind = oproper.DocKind;
          DocID   = oproper.DocumentID;
        end;

         [³ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·³
          ³ºˆ„ ®¯¥à æ¨¨:             #################################################º³
          ³ºˆ„ è £ :                 #################################################º³
          ³º®¬¥à ¡«®ª :             #################################################º³
          ³º®¬¥à è £ :              #################################################º³
          ³º‚¨¤ ®¯¥à æ¨¨:            #################################################º³
          ³º‚¨¤ ¤®ªã¬¥­â :           #################################################º³
          ³ºˆ¤¥­â¨ä¨ª â®à ¤®ªã¬¥­â : #################################################º³
          ³ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½³]        
         (OprStepExec.rec.ID_Operation, OprStepExec.rec.ID_Step, OprStepExec.rec.BlockID, OprStepExec.rec.Number_Step,
          Kind_Operation, DocKind, DocID:r);
      end;
      

   end;

   private macro printDischargeReport( numDprt, recID)
      file wldisdoc( "wldisdoc.tmp" ) key 0;
      var  state, FI_Code,Form;
      var  params:TArray;
      var  params1:TArray;
      var  select:string;
      var  rs:object;
      var  i;
      array str1, str2, str3, str4;

      params = makeArray( SQLParam( "RecID"    , recID                  ),
                          SQLParam( "NumDprt"  , numDprt                ),
                          SQLParam( "PmCount"  , V_INTEGER, RSDBP_OUT   ),
                          SQLParam( "MesCount" , V_INTEGER, RSDBP_OUT   ),
                          SQLParam( "State"    , V_INTEGER, RSDBP_OUT   ),
                          SQLParam( "Err"      , V_INTEGER, RSDBP_OUT   )
                        );
      execStoredFunc( "WLD_COMMON.ParseDischargeLog", V_UNDEF, params );
      if(params.Value(5).value == 0)

        if  ( params.Value(4).value == 1 )
          state = "‚áñ ¢ë¯®«­¥­® ãá¯¥è­®";
        elif( params.Value(4).value == 2 )
          state = "— áâ¨ç­® ¢ë¯®«­¥­®";
        elif( params.Value(4).value == 3 )
          state = "¥ ¢ë¯®«­¥­®";
        end;

        ReWind(wldisdoc);
        
         [³                                                                            ³
          ³¡é¨© à¥§ã«ìâ â: ########################                                   ³
          ³                                                                            ³
          ³¡à ¡®â ­­ë¥ ¤®ªã¬¥­âë                                                      ³
          ³ÖÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄ·³
          ³º  ®¬¥à  ³Š®¤ ¡ ­ª  ³‚ «³‘ã¬¬  ¤®ªã¬¥­â ³     ¥§ã«ìâ â    ³”®à¬ ³¥ä¥à¥­áº³
          ³º¤®ªã¬¥­â ³¯®«ãç â¥«ï³îâ ³               ³     ®¡à ¡®âª¨    ³á®®¡é³ á®®¡é. º³
          ³ÇÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄ¶³](state);

        while ( Next( wldisdoc ) )
         select = " select t_FI_Code" +
                    " from dfininstr_dbt"+
                   " where t_FIID=:FIID";       
         params1 = makeArray( SQLParam("FIID", wldisdoc.BaseFIID  ));
         rs = execSQLselect( select, params1, FALSE );
         if(rs.MoveNext())
           FI_Code = rs.value(0);
         else
           FI_Code = "";
         end;

         select = " select frm.t_Name" +
                    " from dwlmesfrm_dbt frm, dwlmesrls_dbt rls"+
                   " where rls.t_RlsFormID=:rlsformid"+
                     " and rls.t_FormID=frm.t_FormID";       
         params1 = makeArray( SQLParam("rlsformid", wldisdoc.RlsFormID  ));
         rs = execSQLselect( select, params1, FALSE );
         if(rs.MoveNext())
           Form = rs.value(0);
         else
           Form = "";
         end;
         StrSplit(wldisdoc.Number,str1,9,9,5);
         StrSplit(wldisdoc.ReceiverBankCode,str2,10,10,5);
         StrSplit(wldisdoc.Result,str3,18,18,5);
         StrSplit(wldisdoc.TRN,str4,8,8,5);
         
         [³º#########³##########³###³###############³##################³#####³########º³]
         (str1(0),str2(0),FI_Code,wldisdoc.BaseAmount,str3(0),Form,str4(0));
         i = 1;
         while((strlen(str1(i))>0) or (strlen(str2(i))>0) or (strlen(str3(i))>0) or (strlen(str4(i))>0))
         [³º#########³##########³   ³               ³##################³     ³########º³]
         (str1(i):s,str2(i):s,str3(i):s,str4(i):s);
         i = i + 1;
         end;

        end;
         
         [³ÓÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄ½³
          ³ˆâ®£® - ®¡à ¡®â ­® ¤®ªã¬¥­â®¢:  ######                                      ³
          ³      - áä®à¬¨à®¢ ­® á®®¡é¥­¨©: ######                                      ³](params.Value(2).value:r, params.Value(3).value:r);
      end;
   end;

   private macro printMasInsPmReport( numDprt, recID)

       [³ ‘ä®à¬¨à®¢ ­­ë¥ ¤®ªã¬¥­âë:                                                  ³];
       [³ÖÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ·          ³];
       [³º  ®¬¥à  ³„ â  ¢ «î-³‚ «î-³  ‘ã¬¬  ¤®ªã¬¥­â   ³‚¨¤   ³ID ¯« â¥¦ º          ³];
       [³º¤®ªã¬¥­â ³â¨à®¢ ­¨ï ³ â   ³                   ³¤®ª-â ³          º          ³];
       [³ÇÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄ¶          ³];

      var  params:TArray;
      params = makeArray( 
                            SQLParam( "RecID"    , recID                  ),
                            SQLParam( "NumDprt"  , numDprt                ),
                            SQLParam( "DocCount" , V_INTEGER, RSDBP_OUT   ),
                            SQLParam( "Stat"     , V_INTEGER, RSDBP_OUT   )
                        );
                        
      execStoredFunc( "PM_COMMON.ParseMasInsPmLog", V_UNDEF, params );

      if(params.Value(3).value !=0 )
        return 1;
      end;
      
      var RS = null;
      var DocCount = 0;
      var Select:string;
      Select =  " SELECT  " 
                "   masinspm.t_Number AS DocNumber,"
                "   masinspm.t_ValueDate AS ValueDate,"
                "   masinspm.t_PayerAccount AS PayerAccount, "
                "   masinspm.t_ReceiverAccount AS ReceiverAccount,"
                "   masinspm.t_ReceiverBankCode AS ReceiverBankCode,"
                "   fininstr.t_FI_Code AS Base_FI_Code,"
                "   masinspm.t_BaseAmount AS BaseAmount,"
                "   masinspm.t_DocKind AS DocKind,"
                "   masinspm.t_PaymentID AS PaymentID"
                " FROM "
                "   dmasinspm_tmp masinspm, " 
                "   dfininstr_dbt fininstr  "
                " WHERE " 
                "   fininstr.t_FIID = masinspm.t_BaseFIID "
                " ORDER BY masinspm.t_PaymentID"
              ;
     RS = execSQLselect(Select);
     while(RS.MoveNext())

       [³º#########³##########³#####³###################³######³##########º          ³]
       (RS.value("DocNumber"),date(RS.value("ValueDate")),RS.value("Base_FI_Code"),RS.value("BaseAmount"):14:2:r,RS.value("DocKind"),RS.value("PaymentID"));

       DocCount = DocCount + 1;

     end;
       [³ÓÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ½          ³];


       [³ˆâ®£® - áä®à¬¨à®¢ ­® ¤®ªã¬¥­â®¢:  ##########                                ³](DocCount);

       execSQL("TRUNCATE TABLE dmasinspm_tmp");
   end;
   
   private macro printRecord()

      /* ®«ãç ¥¬ ¯ à ¬¥âàë § ¯¨á¨ */
      var numDprt = opLog.NumDprt;
      var _date   = opLog.Date;
      var _time   = opLog.Time;
      var opCode  = opLog.opCode;
      var opName  = opLog.getOpName(opCode);
      var userID    = opLog.userID;
      var _userName = opLog.getUserName(userID);
      var userType  = opLog.getUserType(opLog.userType);
      var tableName = opLog.TableName;
      var tableDesc = opLog.getTableDesc(tableName);
      var progID    = opLog.progID;
      var progName  = opLog.getProgName(progID);
      var objectID  = opLog.objectID;
      var varPart = opLog.CreateVarPart();
      var recID   = opLog.RecID;

      if ((ValType(numDprt) != V_UNDEF) AND (numDprt != 0))
         /*12345678901234567890                                    12345678901234567890*/
         [³########## ######## ####################################        ”¨«¨ «: ####³
          ³                                                                            ³]
         (_date, _time, opName:c, numDprt:l);
      else
         [³########## ######## ####################################                    ³
          ³                                                                            ³]
         (_date, _time, opName:c);
      end;
      if (ValType(opCode) == V_UNDEF)
         [³è¨¡ª  ¯à¨ çâ¥­¨¨ § ¯¨á¨                                                    ³
          ³                                                                            ³];
         return;
      end;
      if ((ValType(_userName) != V_UNDEF) AND (_userName != ""))
         [³®«ì§®¢ â¥«ì: ##############################################################³]
         (String(userID:l, " '", _userName, "'"));
      else
         [³®«ì§®¢ â¥«ì: ####                                                          ³]
         (userID:l);
      end;
      if ((ValType(userType) != V_UNDEF) AND (userType != ""))
         [³“à®¢¥­ì ¤®áâã¯ : ####################                                       ³]
         (userType:l);
      end;
      if ((ValType(progName) != V_UNDEF) AND (progName != ""))
         [³à¨«®¦¥­¨¥: ##################################                              ³]
         (progName:l);
      end;
      if ((ValType(objectID) != V_UNDEF) AND (objectID != ""))
         [³¡ê¥ªâ: ########################################                            ³]
         (objectID:l);
      end;
      if ((ValType(tableName) != V_UNDEF) AND (tableName != ""))
         [³” ©«: ######################################################################³]
         (String(tableName:l, " '", tableDesc, "'"));
      end;

      if (IsEqClass("TRslMesgEntry", varPart))
         printMesgEntry(varPart);
      elif (IsEqClass("TRslBFileEntry", varPart))
         printBFileEntry(varPart);
      elif (IsEqClass("TRslProgramEntry", varPart))
         printProgramEntry(varPart);
      elif( (opCode == UOL_OPR_EXECUTE_STEP/*1132*/) OR (opcode == UOL_OPR_MASS_EXECUTE_STEP/*1133*/) )
         printOprStepExecReport();
      elif( opCode == UOL_WLD_DISCHARGE /*1134*/)
         printDischargeReport( numDprt, recID);
      elif( opCode == UOL_PM_MASINSPM /*1135*/)
         printMasInsPmReport( numDprt, recID);
      else
         [³                                                                            ³];
         [³                                                                            ³];
      end;
   end;

   macro printBody()
      var rc = opLog.First;
      if (rc)
         printTopLine();
         while (rc)
            printRecord();
            rc = opLog.Next;
            if (rc)
               printCenterLine();
            end;
         end;
         printBotLine();
      end;
   end;
end;


var obj = TPrintOperLog();

obj.printHeader();
obj.printBody();
obj.printFooter();
