/*
  $Name:         bdtransf.mac
  $Module:       ББ
  $Description:  Макрос скроллинга переводов в ББ
*/
//-----------------------------------------------------------------------------
// Блок      : Вне блока
// Шаг       : Вне шага
// Назначение: Макрос скроллинга
// Описание  : Макрос скроллинга переводов в ББ
//-----------------------------------------------------------------------------

import FIInter, globals, PaymInter, "pm_opr.mac", "pmchoper.mac", "pm_tools.mac";

/*
      Макросы:
       -  Check()
      - Проверить_Документ (...)
      должны возвращать номер поля в котором произошла ошибка
*/

var НомерПоля =  -1; /*ошибки нет*/

FILE   f_account  ("account.dbt" );

record BdTransf   ( bdtransf );
record OldBdTransf( bdtransf );

const
    FLD_BDTR_DATE            = 1,
    FLD_BDTR_AMOUNT          = 3,
    FLD_BDTR_PAYERNAME       = 4,
    FLD_BDTR_RECEIVERNAME    = 9,
    FLD_BDTR_BANKCODE        = 12,
    FLD_BDTR_RECACCOUNT      = 13,
    FLD_BDTR_GROUND          = 15,
    FLD_BDTR_TAXOPERATION    = 7,
    FLD_BDTR_NUMBER          = 10,
    FLD_BDTR_STATUS          = 1;

private macro    Новый_Документ( )
         return 0;
end;

/* Установка подсказки для скролингов из макроса */
/*
private const Hint_ByValueDate:string = 
"/*+FIRST_ROWS(200) LEADING(pmpaym t pmrmprop oproper oprcurst) INDEX(pmpaym dpmpaym_dbt_idx11) USE_NL(pmpaym t pmrmprop oproper oprcurst)*/";

private const Hint_ByCloseDate:string = 
"/*+FIRST_ROWS LEADING(pmpaym t pmrmprop oproper oprcurst) INDEX(pmpaym dpmpaym_dbt_idx15) USE_NL(pmpaym t pmrmprop oproper oprcurst)*/";

private const Hint_ByStatus   :string = 
"/*+FIRST_ROWS LEADING(t pmpaym pmrmprop oproper oprcurst) INDEX(t dmultydoc_dbt_idx1) INDEX(pmpaym dpmpaym_dbt_idx0) USE_NL(t pmpaym pmrmprop oproper oprcurst)*/";

private const Hint_ByStep     :string = 
"/*+FIRST_ROWS LEADING(t oproper multydoc pmpaym pmrmprop oprcurst) INDEX(t doprstep_dbt_idx10) INDEX(multydoc dmultydoc_dbt_idx0) INDEX(pmpaym dpmpaym_dbt_idx0) USE_NL(t oproper multydoc pmpaym pmrmprop oprcurst)*/";

MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStates:integer ):string
  
  return DefaultHint;

END;
*/
/* Тип_документа - тип документа куда проводим */
macro    Проверить_документ( Режим, Тип_документа )
  var stat = 0, num;
  var errors:TArray = TArray();
  if( Режим == 2  or (Режим == 3) )  /* ВВОД ДОКУМЕНТА */
    if( BdTransf.Date == date(0,0,0) )
      MsgBox("Не задана дата перевода");
      return FLD_BDTR_DATE;
    end;

    if( BdTransf.Amount <= 0 )
      MsgBox("Не задана сумма перевода");
      return FLD_BDTR_AMOUNT;
    end;

    if( StrLen(BdTransf.PayerName) == 0 )
      MsgBox("Не задан плательщик");
      return FLD_BDTR_PAYERNAME;
    end;

    if( StrLen(BdTransf.ReceiverBankCode) == 0 )
      MsgBox("Не задан банк получателя");
      return FLD_BDTR_BANKCODE;
    end;

    if( StrLen(BdTransf.ReceiverAccount) == 0 )
      MsgBox("Не задан счет получателя");
      return FLD_BDTR_RECACCOUNT;
    end;

    if( StrLen(BdTransf.Ground) == 0 )
      MsgBox("Не задано назначение");
      return FLD_BDTR_GROUND;
    end;

    if( StrLen(BdTransf.TaxOperation) == 0 )
      MsgBox("Не задан номер операции");
      return FLD_BDTR_TAXOPERATION;
    end;
  end;                                          
  return stat;
end;

private macro Функция_Пользователя( Режим:integer )
 return 0;
end;

