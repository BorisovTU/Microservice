/*
 *  Контроль заполнения полей операции
 */

Import PTInter, FMInter, "globals.mac";

private const fm_error   = 1;
private const fm_warning = 2;

private var IsSimpleIDRegVal : bool;

file FileOes () dbf;

/*Считать значение настройки "ФИНМОНИТОРИНГ / УПРОЩЕННАЯ ИДЕНТ-ЦИЯ УЧАСТНИКОВ".*/
private macro GetSimpleIDRegVal() : bool

  var stat;    
  
  if( IsSimpleIDRegVal == null )
      GetRegistryValue("ФИНМОНИТОРИНГ\\УПРОЩЕННАЯ ИДЕНТ-ЦИЯ УЧАСТНИКОВ", V_BOOL, IsSimpleIDRegVal, stat);    
  end;  

  return IsSimpleIDRegVal;

end;

private macro StringCodeToArray(ArrayCode : TArray, StrCode : string )
  var i : integer, ArrNum : integer, Len : integer;
  var tmpStrCode = "";
  var cchr =  "";
  var prevI = 1;

  ArrNum = 0;
  i = 1; 
  Len = strlen(StrCode);

  while( i <= Len )
      cchr = substr(StrCode, i, 1);

      if(cchr == ",")
        tmpStrCode = substr(StrCode, prevI, i-prevI);
        prevI = i + 1;
        tmpStrCode = trim(tmpStrCode);
        if(strlen(tmpStrCode))
          ArrayCode(ArrNum) = tmpStrCode;
          ArrNum = ArrNum + 1;
        end;
      end;

    i = i + 1;
  end;

  if(prevI < i)
    tmpStrCode = substr(StrCode, prevI, i-prevI);
    tmpStrCode = trim(tmpStrCode);
    if(strlen(tmpStrCode))
      ArrayCode(ArrNum) = tmpStrCode;
      ArrNum = ArrNum + 1;
    end;
  end;
end;


private macro CheckCodeOC(ArrayCode : TArray)
 
  var RetVal = true;
  var i : integer, NCode : integer;
  
  i = 0; NCode = ArrayCode.Size();

  while( i < NCode )
    if( Index ( "1003, 1004, 1006, 1007, 6001" , ArrayCode(i) ) == 0 )
      RetVal = false;
    end;

    i = i + 1;
  end;
  
  return RetVal;

end;


private macro CheckCodeUO(ArrayCode : TArray)
  var RetVal = true; 
  var i : integer, NCode : integer;
  
  i = 0; NCode = ArrayCode.Size();

  while( i < NCode )

    if( Index ( "201, 1102" , ArrayCode(i) ) == 0 )
      RetVal = false;
    end;

    i = i + 1;
  end;
  
  return RetVal;
end;


/* проверка соответствия кода и наименования банка */
private macro CheckBankAndCodeName( BankCode:string, BankName:string ) : bool

  record rec_bank("party.dbt");
  var PartyID : integer;  
  PartyID = -1;

  PartyID = ПолучитьКодСубъекта( BankCode, PTCK_BIC );

  if( PartyID < 0 )
    PartyID = ПолучитьКодСубъекта( BankCode, PTCK_SWIFT );
  end;

  if( PartyID > 0 )    
    if( ПолучитьСубъекта( PartyID, rec_bank) == 0 )      
      if( rec_bank.Name != Trim( BankName) )
        return false;
      end;
    end;
  end;

  return true;

end;


private macro GetSimpleCheck()
  var RetVal ;
  var ArrayCode = TArray;
  var StrCodes = "";

  RetVal = GetSimpleIDRegVal();

  if(RetVal == true)
     StrCodes = "";
     if( Trim(FileOes.VO) != "0" )
       StrCodes = Trim(FileOes.VO);
     end;

     if( (Trim(FileOes.DOP_V) != "") and (Trim(FileOes.DOP_V) != "0") )
       if(StrCodes != "")
         StrCodes = StrCodes + ", "
       end;

       StrCodes = StrCodes + Trim(FileOes.DOP_V);
     end;

     StringCodeToArray(ArrayCode, StrCodes );

     RetVal = CheckCodeOC(ArrayCode);
  end;


  if(RetVal == true)
     ArrayCode = TArray;
     StrCodes = "";
     if( Trim(FileOes.PRIZ6001) != "0" )
       StrCodes = Trim(FileOes.PRIZ6001);
     end;

     StringCodeToArray(ArrayCode, StrCodes );

     RetVal = CheckCodeUO(ArrayCode);
  end;

  if(RetVal == true)
    if( not((FileOes.TU0 == 2) OR (FileOes.TU1 == 2) OR (FileOes.TU2 == 2) OR (FileOes.TU3 == 2) OR (FileOes.TU4 == 2) OR 
            (FileOes.TU0 == 3) OR (FileOes.TU1 == 3) OR (FileOes.TU2 == 3) OR (FileOes.TU3 == 3) OR (FileOes.TU4 == 3)   ) )  
      RetVal = false;
    end;
  end;

  return RetVal;
end;

/* добавить сообщение к строке об ошибке */
private macro addResult( Result : string, addString : string ) : string

  if( Result != "" ) Result = Result + "\n"; end;

  return Result + addString;

end;



/*Процедура контроля данных файла ОЭС */ 
macro FileOesRecordCheck_LG():string
 
  var Result:string;
  Result = "";

  var Error:string, ErrorEnd:string, Warning:string, TmpMes:string;
  Error = "";
  ErrorEnd = "";
  Warning = "";
  TmpMes = "";

  var IsSimpleCheck = GetSimpleCheck();

  /*1 Проверка заполнения сведений об операции:*/
  /*1.1 Терроризм TERROR  Если для операции указан код 7001 (VO=7001), то поле TERROR должно быть 
  заполнено. 
  И наоборот, если поле TERROR - заполнено, то для операции должен быть указан код 7001 в поле VO.  
  !Ошибка:  (Не) Указан код операции 7001, поле "Терроризм" (не) заполнено. */    
  if( (Trim(FileOes.VO) == "7001") AND (FileOes.TERROR == 0) )
    Result = addResult( Result, "!Ошибка:\nУказан код операции 7001, поле \"Терроризм\" не заполнено.\n" );
  else 
    if( (FileOes.TERROR != 0) AND (Trim(FileOes.VO) != "7001") )
      Result = addResult( Result, "!Ошибка:\nНе указан код операции 7001, поле \"Терроризм\" заполнено.\n" );
    end;
  end;

  /*1.2   Все поля должны быть заполнены.     
   Дата совершения DATE, Валюта  CURREN, Сумма   SUME, Коды операции   VO 
   !Ошибка: Не заполнено поле <Наименование незаполненного поля>.
  */
  if( (FileOes.DATA == date(0,0,0)) OR (FileOes.DATA == date(1,1,2099)) )  
     Result = addResult( Result, "!Ошибка:\nНе заполнено поле \"DATA\".\n" );
  end;

  if( Trim(FileOes.CURREN) == "")   
     Result = addResult( Result, "!Ошибка:\nНе заполнено поле \"CURREN\".\n" );
  end;  
  if( FileOes.SUME == 0 )  
    Result = addResult( Result, "!Ошибка:\nНе заполнено поле \"SUME\".\n" );
  end;
  if( Trim(FileOes.VO) == "" )
    Result = addResult( Result, "!Ошибка:\nНе заполнено поле \"VO\".\n" );
  end;
      
  /*1.3 Коды операции  НО   PRIZ6001  Если для операции проставлены коды НО в поле PRIZ6001, 
  то должен быть задан так же код 6001 в полях VO или DOP_V. 
  !Ошибка: Указан код необычной операции, но не указан код операции для обязательного контроля 6001.*/
    
  if( (Trim(FileOes.PRIZ6001) != "0") AND (Trim(FileOes.PRIZ6001) != "") )
    if( (Trim(FileOes.VO) != "6001") AND (Trim(FileOes.DOP_V) != "6001") ) 
      Result = addResult( Result, "!Ошибка:\nУказан код необычной операции, но не указан код операции для обязательного контроля 6001.\n" );
    end;
  end;

  /*Если для операции указан код 6001 (в полях VO или DOP_V), то обязательно должен быть указан хотя 
  бы один код НО в поле PRIZ6001.  
  !Ошибка: Указан код операции для обязательного контроля 6001, но не указан код необычной операции.*/
  if( (Trim(FileOes.VO) == "6001") OR (Trim(FileOes.DOP_V) == "6001") )
    if( (Trim(FileOes.PRIZ6001) == "") OR (Trim(FileOes.PRIZ6001) == "0") )
      Result = addResult( Result, "!Ошибка:\nУказан код операции для обязательного контроля 6001, но не указан код необычной операции.\n" );
    end;
  end;

  /* 1.5 Дополнительная информация DESCR Если код операции равен 6001 (в полях VO или DOP_V), 
  то поле DESCR должно быть  заполнено.  
  !Ошибка: Для операции с кодом 6001 не заполнена дополнительная информация.*/

  if( (Trim(FileOes.VO) == "6001") OR (Trim(FileOes.DOP_V) == "6001") ) 
    if( (Trim(FileOes.DESCR_1) == "") OR (Trim(FileOes.DESCR_1) == "0") )
      Result = addResult( Result, "!Ошибка:\nДля операции с кодом 6001 не заполнена дополнительная информация.\n" );
    end;
  end;

  if( (FileOes.ACTION == 3) OR (FileOes.ACTION == 4) ) 
    if( (Trim(FileOes.DESCR_1) == "") OR (Trim(FileOes.DESCR_1) == "0") )
      Result = addResult( Result, "!Ошибка:\nДля операции с типом отправки " + string(FileOes.ACTION) + " \"" +
                                  НазваниеТипаОтправкиОперации(FileOes.ACTION) + "\" не заполнена дополнительная информация.\n" );
    end;
  end;

  /*2 Сведения об участниках операции - плательщике/получателе:
  2.1 Тип участника операции  TU0 - TU4   
  Хотя бы одно из перечисленных полей должно быть обязательно  заполнено.  
  !Ошибка: Не заполнены тип и наименование участника. */ 

  if( ((FileOes.TU0 == 0) AND (FileOes.TU1 == 0) AND (FileOes.TU2 == 0) AND (FileOes.TU3 == 0) 
        AND (FileOes.TU4 == 0))
    AND (  ((Trim(FileOes.NAMEU0) == "") OR (Trim(FileOes.NAMEU0) == "0"))
        AND ((Trim(FileOes.NAMEU1) == "") OR (Trim(FileOes.NAMEU1) == "0"))
        AND ((Trim(FileOes.NAMEU2) == "") OR (Trim(FileOes.NAMEU2) == "0"))
        AND ((Trim(FileOes.NAMEU3) == "") OR (Trim(FileOes.NAMEU3) == "0"))
        AND ((Trim(FileOes.NAMEU4) == "") OR (Trim(FileOes.NAMEU4) == "0"))
        )
    )
    Result = addResult( Result, "!Ошибка:\nНе заполнены тип и наименование участника.\n" );
  end;

  /*Если указан тип участника операции (TU0), то наименование участника операции (NAMEU0) должно быть 
  обязательно заполнено. 
  Соответственно для TU1 проверяется NAMEU1 и так далее.  
  !Ошибка: Для типа участника операции <значение типа> не заполнено поле 
  "Наименование участника операции".*/
     
  Error = "!Ошибка:\nДля типа участника операции ";
  ErrorEnd = " не заполнено поле \"Наименование участника операции\".\n";

  if( (FileOes.TU0 != 0) AND ((Trim(FileOes.NAMEU0) == "") OR (Trim(FileOes.NAMEU0) == "0")) )    
    Result = addResult( Result, Error + "\"TU0\"" + ErrorEnd );
  end;

  if( (FileOes.TU1 != 0) AND ((Trim(FileOes.NAMEU1) == "") OR (Trim(FileOes.NAMEU1) == "0")) )
    Result = addResult( Result, Error + "\"TU1\"" + ErrorEnd );
  end;
  if( (FileOes.TU2 != 0) AND ((Trim(FileOes.NAMEU2) == "") OR (Trim(FileOes.NAMEU2) == "0")) )
    Result = addResult( Result, Error + "\"TU2\"" + ErrorEnd );
  end;
  if( (FileOes.TU3 != 0) AND ((Trim(FileOes.NAMEU3) == "") OR (Trim(FileOes.NAMEU3) == "0")) )
    Result = addResult( Result, Error + "\"TU3\"" + ErrorEnd );
  end;
  if( (FileOes.TU4 != 0) AND ((Trim(FileOes.NAMEU4) == "") OR (Trim(FileOes.NAMEU4) == "0")) )
    Result = addResult( Result, Error + "\"TU4\"" + ErrorEnd );
  end;  


  /*Наименование участника операции NAMEU0 - NAMEU4   
  Если указано наименование участника операции (NAMEU0), то обязательно должен быть заполнен тип 
  участника (TU0). 
  Соответственно для NAMEU1 проверяется TU1 и так далее.  
  !Ошибка:  Для участника операции <наименование участника операции> не заполнено поле "Тип участника операции".*/

  Error = "!Ошибка:\nДля участника операции ";
  ErrorEnd = " не заполнено поле \"Тип участника операции\".\n";

  if( (Trim(FileOes.NAMEU0) != "") AND (Trim(FileOes.NAMEU0) != "0") )
    if( FileOes.TU0 == 0 )       
      Result = addResult( Result, Error + "\"NAMEU0\"" + ErrorEnd );
    end;
  end;
  if( (Trim(FileOes.NAMEU1) != "") AND (Trim(FileOes.NAMEU1) != "0") )
    if( FileOes.TU1 == 0)       
      Result = addResult( Result, Error + "\"NAMEU1\"" + ErrorEnd );
    end;
  end;
  if( (Trim(FileOes.NAMEU2) != "") AND (Trim(FileOes.NAMEU2) != "0") ) 
    if( FileOes.TU2 == 0 )       
      Result = addResult( Result, Error + "\"NAMEU2\"" + ErrorEnd );
    end;
  end;
  if( (Trim(FileOes.NAMEU3) != "") AND (Trim(FileOes.NAMEU3) != "0") )
    if( FileOes.TU3 == 0)      
      Result = addResult( Result, Error + "\"NAMEU3\"" + ErrorEnd );
    end;
  end;  
  if( (Trim(FileOes.NAMEU4) != "") AND (Trim(FileOes.NAMEU4) != "0") )
    if(FileOes.TU4 == 0)      
      Result = addResult( Result, Error + "\"NAMEU4\"" + ErrorEnd );
    end;
  end;

  /*2.2 Признак участника операции  PRU0 - PRU4 Поле должно быть заполнено только у операций, для 
  которых указан хотя бы один код 3001, 3011, 3021 или 7001 в любом из полей: VO или DOP_V. 
  Иначе, если таких кодов нет - поле должно быть пустым.   
  !Ошибка:  (Не) указан код операции группы 3000 или 7000. 
  Поле "Признак участника операции" (не) заполнено.*/

  if( Trim(FileOes.PRU0 != "0") OR Trim(FileOes.PRU1 != "0") OR Trim(FileOes.PRU2 != "0") 
         OR Trim(FileOes.PRU3 != "0") OR Trim(FileOes.PRU4 != "0"))            
    if( (Trim(FileOes.VO) != "3001") OR (Trim(FileOes.VO) != "3011")  
       OR (Trim(FileOes.VO) != "3021") OR (Trim(FileOes.VO) != "7001")
       OR (Trim(FileOes.DOP_V) != "3001") OR (Trim(FileOes.DOP_V) != "3011") 
       OR (Trim(FileOes.DOP_V) != "3021") OR (Trim(FileOes.DOP_V) != "7001") )
             
    Result = addResult( Result, "!Ошибка:\nНе указан код операции группы 3000 или 7000. Поле \"Признак участника операции\" заполнено.\n" );
    end;
  end;
  
  if( (Trim(FileOes.VO) == "3001") OR (Trim(FileOes.VO) == "3011")  
       OR (Trim(FileOes.VO) == "3021") OR (Trim(FileOes.VO) == "7001")
       OR (Trim(FileOes.DOP_V) == "3001") OR (Trim(FileOes.DOP_V) == "3011") 
       OR (Trim(FileOes.DOP_V) == "3021") OR (Trim(FileOes.DOP_V) == "7001") )
     if( Trim(FileOes.PRU0 == "0") AND Trim(FileOes.PRU1 == "0") AND Trim(FileOes.PRU2 == "0") 
            AND Trim(FileOes.PRU3 == "0") AND Trim(FileOes.PRU4 == "0"))          
       Result = addResult( Result, "!Ошибка:\nУказан код операции группы 3000 или 7000. Поле \"Признак участника операции\" не заполнено.\n" );
     end;
  end;

  /*2.3 Сведения об участнике операции (плательщике/получателе):  Если B_PAYER = "1" или "2", 
  то поля для плательщика 
  KODCR0- KODCN0-AMR0-ADRESS0-SD0-RG0-GR0 
  должны быть заполнены.*/

  if(IsSimpleCheck == false)
    Warning = "!Внимание:\nЗначение поля \"Признак плательщика\" = " + FileOes.B_PAYER;  
    Warning = Warning + ", для плательщика не заполнено поле ";
    
    if( (FileOes.B_PAYER == 1) OR (FileOes.B_PAYER == 2) )
      if( (Trim(FileOes.KODCR0) == "") OR (Trim(FileOes.KODCR0) == "0") )
        Result = addResult( Result, Warning + "\"KODCR0\".\n" );
      end;

      if( (Trim(FileOes.KODCN0) == "") OR (Trim(FileOes.KODCN0) == "0") )
        Result = addResult( Result, Warning + "\"KODCN0\".\n" );
      end;

      if( (Trim(FileOes.AMR_S0) == "") OR (Trim(FileOes.AMR_S0) == "0") )
        Result = addResult( Result, Warning + "\"AMR_S0\".\n" );
      end;

      if( (Trim(FileOes.AMR_G0) == "") OR (Trim(FileOes.AMR_G0) == "0") )
        Result = addResult( Result, Warning + "\"AMR_G0\".\n" );
      end;

      if( (Trim(FileOes.AMR_U0) == "") OR (Trim(FileOes.AMR_U0) == "0") )
        Result = addResult( Result, Warning + "\"AMR_U0\".\n" );
      end;

      if( (Trim(FileOes.AMR_D0) == "") OR (Trim(FileOes.AMR_D0) == "0") )
        Result = addResult( Result, Warning + "\"AMR_D0\".\n" );
      end;

      if( (Trim(FileOes.ADRESS_S0) == "") OR (Trim(FileOes.ADRESS_S0) == "0") )
        Result = addResult( Result, Warning + "\"ADRESS_S0\".\n" );
      end;

      if( (Trim(FileOes.ADRESS_G0) == "") OR (Trim(FileOes.ADRESS_G0) == "0") )
        Result = addResult( Result, Warning + "\"ADRESS_G0\".\n" );
      end;

      if( (Trim(FileOes.ADRESS_U0) == "") OR (Trim(FileOes.ADRESS_U0) == "0") )
        Result = addResult( Result, Warning + "\"ADRESS_U0\".\n" );
      end;

      if( (Trim(FileOes.ADRESS_D0) == "") OR (Trim(FileOes.ADRESS_D0) == "0") )
        Result = addResult( Result, Warning + "\"ADRESS_D0\".\n" );
      end;

      if( (Trim(FileOes.SD0) == "") OR  (Trim(FileOes.SD0) == "0") )
        Result = addResult( Result, Warning + "\"SD0\".\n" );
      end;

      if( (Trim(FileOes.RG0) == "") OR  (Trim(FileOes.RG0) == "0") )
        Result = addResult( Result, Warning + "\"RG0\".\n" );
      end;

      if( (FileOes.GR0 == date(0,0,0)) OR (FileOes.GR0 == date(1,1,2099)) )
        Result = addResult( Result, Warning + "\"GR0\".\n" );
      end;
    end;
    
    /*Если В_RECIP = "1" или "2", то поля для получателя 
    KODCR3-KODCN3-AMR3-ADRESS3-SD3-RG3-GR3
    должны быть заполнены.*/ 
  
    Warning = "!Внимание:\nЗначение поля \"Признак получателя\" = " + FileOes.B_RECIP;  
    Warning = Warning + ", для получателя не заполнено поле ";
   
    if( (FileOes.B_RECIP == 1) OR (FileOes.B_RECIP == 2) )
      if( (Trim(FileOes.KODCR3) == "") OR (Trim(FileOes.KODCR2) == "0") )
        Result = addResult( Result, Warning + "\"KODCR3\".\n" );
      end;

      if( (Trim(FileOes.KODCN3) == "") OR (Trim(FileOes.KODCN3) == "0") )
        Result = addResult( Result, Warning + "\"KODCN3\".\n" );
      end;

      if( (Trim(FileOes.AMR_S3) == "") OR (Trim(FileOes.AMR_S3) == "0") )
        Result = addResult( Result, Warning + "\"AMR_S3\".\n" );
      end;

      if( (Trim(FileOes.AMR_G3) == "") OR (Trim(FileOes.AMR_G3) == "0") )
        Result = addResult( Result, Warning + "\"AMR_G3\".\n" );
      end;

      if( (Trim(FileOes.AMR_U3) == "") OR (Trim(FileOes.AMR_U3) == "0") )
        Result = addResult( Result, Warning + "\"AMR_U3\".\n" );
      end;

      if( (Trim(FileOes.AMR_D3) == "") OR (Trim(FileOes.AMR_D3) == "0") )
        Result = addResult( Result, Warning + "\"AMR_D3\".\n" );
      end;

      if( (Trim(FileOes.ADRESS_S3) == "") OR (Trim(FileOes.ADRESS_S3) == "0") )
        Result = addResult( Result, Warning + "\"ADRESS_S3\".\n" );
      end;

      if( (Trim(FileOes.ADRESS_G3) == "") OR (Trim(FileOes.ADRESS_G3) == "0") )
        Result = addResult( Result, Warning + "\"ADRESS_G3\".\n" );
      end;

      if( (Trim(FileOes.ADRESS_U3) == "") OR (Trim(FileOes.ADRESS_U3) == "0") )
        Result = addResult( Result, Warning + "\"ADRESS_U3\".\n" );
      end;

      if( (Trim(FileOes.ADRESS_D3) == "") OR (Trim(FileOes.ADRESS_D3) == "0") )
        Result = addResult( Result, Warning + "\"ADRESS_D3\".\n" );
      end;

      if( (Trim(FileOes.SD3) == "") OR (Trim(FileOes.SD3) == "0") )
        Result = addResult( Result, Warning + "\"SD3\".\n" );
      end;

      if( (Trim(FileOes.RG3) == "") OR (Trim(FileOes.RG3) == "0") )
        Result = addResult( Result, Warning + "\"RG3\".\n" );
      end;

      if( (FileOes.GR3 == date(0,0,0)) OR (FileOes.GR3 == date(1,1,2099)) )
        Result = addResult( Result, Warning + "\"GR3\".\n" );
      end;
    end; 
  end;
    
  /*2.4 Документ, удостоверяющий личность   KD0 - KD3  
        Наименование документа, удостоверяющего личность  VD0 - VD3
  Если B_PAYER = "1" и тип участника TU0 = "2" или "3", 
  то соответствующие поля (KD0-VD0) должны быть заполнены, 
  Если В_RECIP = "1" и тип участника TU3 = "2" или "3", 
  то соответствующие поля (KD3-VD3) должны быть заполнены. 
  !Внимание: 
  Для плательщика (получателя) физического лица значение поля "<Наименование незаполненного поля>" 
  должно быть заполнено. */
  
  Warning = "!Внимание:\nДля плательщика физического лица значение поля ";
  TmpMes = " должно быть заполнено.\n";

  if( FileOes.B_PAYER == 1 )
    
    if( (FileOes.TU0 == 2) OR (FileOes.TU0 == 3) )
      if( (Trim(FileOes.KD0) == "") OR (Trim(FileOes.KD0) == "0") )
        Result = addResult( Result, Warning + "\"KD0\"" + TmpMes );
      end;
      
      if( (Trim(FileOes.VD01) == "") OR (Trim(FileOes.VD01) == "0") )
        Result = addResult( Result, Warning + "\"VD01\"" + TmpMes );
      end;

      if( (Trim(FileOes.BP_0) == "") OR (Trim(FileOes.BP_0) == "0") )
        Result = addResult( Result, Warning + "\"BP_0\"" + TmpMes );
      end;
    end;
    
  end;

  Warning = "!Внимание:\nДля получателя физического лица значение поля ";
  if( FileOes.B_RECIP == 1 )   
    
    if( (FileOes.TU3 == 2) OR (FileOes.TU3 == 3) )
      if( (Trim(FileOes.KD3) == "") OR (Trim(FileOes.KD3) == "0") )
        Result = addResult( Result, Warning + "\"KD3\"" + TmpMes );
      end;

      if( (Trim(FileOes.VD31) == "") OR (Trim(FileOes.VD31) == "0") )
        Result = addResult( Result, Warning + "\"VD31\"" + TmpMes );
      end;

      if( (Trim(FileOes.BP_3) == "") OR (Trim(FileOes.BP_3) == "0") )
        Result = addResult( Result, Warning + "\"BP_3\"" + TmpMes );
      end;
    end;

  end;
  
  /*2.5 ИНН ND0 - ND3 
   Если B_PAYER = "1" или "2" и тип участника TU0 - TU1 = "1", 
  то соответствующее поле (ND0 или ND1) должно быть заполнено.
  Если В_RECIP = "1" или "2" и тип участника TU2 - TU3 = "1", 
  то соответствующее ему поле (ND2 или ND3) должно быть заполнено.
  !Внимание: 
  Для плательщика (получателя) юридического лица значение поля "<Наименование незаполненного поля>" 
  должно быть заполнено.*/
  
  if(IsSimpleCheck == false)
    Warning = "!Внимание:\nДля плательщика юридического лица значение поля ";
    TmpMes = " должно быть заполнено.\n";

    if( (FileOes.B_PAYER == 1) OR (FileOes.B_PAYER == 2) )
      if( FileOes.TU0 == 1 )
        if( (Trim(FileOes.ND0) == "") OR (Trim(FileOes.ND0) == "0") )
          Result = addResult( Result, Warning + "\"ND0\"" + TmpMes );
        end;      
      end;
    end;

    Warning = "!Внимание:\nДля получателя юридического лица значение поля ";    
    if( (FileOes.B_RECIP == 1) OR (FileOes.B_RECIP == 2) )   
      if( FileOes.TU3 == 1 )
        if( (Trim(FileOes.ND3) == "") OR (Trim(FileOes.ND3) == "0") )        
          Result = addResult( Result, Warning + "\"ND3\"" + TmpMes );
        end;      
      end;
    end;
  end;
 
  /*3 Сведения о кредитной организации участника операции:
  3.1 
  Сведения о кредитной организации плательщика (получателя):  
  Если B_PAYER = "1" или "2", то поля NAME_B0, KODCN_B0,  BIK_B0, NAME_R0, KODCN_R0 и BIK_R0 
  должны быть пустыми или равны 0.  
  Если В_RECIP = "1" или "2", то поля NAME_B3, KODCN_B3,  BIK_B3, NAME_R3, KODCN_R3 и BIK_R3 
  должны быть пустыми или равны 0.
  !Ошибка: 
  Значение поля "Признак банка плательщика (получателя)" = <Значение поля>, для плательщика 
  (получателя) заполнено поле "<Наименование заполненного поля>".
    Наименование  NAME_B0     
    Код места нахождения  KODCN_B0    
    БИК ЦБ РФ/BIC SWIFT   BIK_B0 */ 
    
  Error = "!Ошибка:\nЗначение поля \"Признак плательщика\" = " + FileOes.B_PAYER;
  Error = Error + ", для плательщика заполнено поле ";  

  if( (FileOes.B_PAYER == 1) OR (FileOes.B_PAYER == 2) )
    if( (Trim(FileOes.NAME_B0) != "") AND (Trim(FileOes.NAME_B0) != "0") )      
      Result = addResult( Result, Error + "\"NAME_B0\".\n" );
    end;
    if( (Trim(FileOes.KODCN_B0) != "") AND (Trim(FileOes.KODCN_B0) != "0") )      
      Result = addResult( Result, Error + "\"KODCN_B0\".\n" );
    end;
    if( (Trim(FileOes.BIK_B0) != "") AND (Trim(FileOes.BIK_B0) != "0") )      
      Result = addResult( Result, Error + "\"BIK_B0\".\n" );
    end;

    if( (Trim(FileOes.NAME_R0) != "") AND (Trim(FileOes.NAME_R0) != "0") )      
      Result = addResult( Result, Error + "\"NAME_R0\".\n" );
    end;
    if( (Trim(FileOes.KODCN_R0) != "") AND (Trim(FileOes.KODCN_R0) != "0") )      
      Result = addResult( Result, Error + "\"KODCN_R0\".\n" );
    end;
    if( (Trim(FileOes.BIK_R0) != "") AND (Trim(FileOes.BIK_R0) != "0") )       
      Result = addResult( Result, Error + "\"BIK_R0\".\n" );
    end;
  end;

  
  Error = "!Ошибка:\nЗначение поля \"Признак получателя\" = " + FileOes.B_RECIP;
  Error = Error + ", для получателя заполнено поле ";     

  if( (FileOes.B_RECIP == 1) OR (FileOes.B_RECIP == 2) )
    if( (Trim(FileOes.NAME_B3) != "")  AND (Trim(FileOes.NAME_B3) != "0") )      
      Result = addResult( Result, Error + "\"NAME_B3\".\n" );
    end;
    if( (Trim(FileOes.KODCN_B3) != "") AND (Trim(FileOes.KODCN_B3) != "0") )      
      Result = addResult( Result, Error + "\"KODCN_B3\".\n" );
    end;
    if( (Trim(FileOes.BIK_B3) != "") AND (Trim(FileOes.BIK_B3) != "0") )     
      Result = addResult( Result, Error + "\"BIK_B3\".\n" );
    end;

    if( (Trim(FileOes.NAME_R3) != "") AND (Trim(FileOes.NAME_R3) != "0") )      
      Result = addResult( Result, Error + "\"NAME_R3\".\n" );
    end;
    if( (Trim(FileOes.KODCN_R3) != "") AND (Trim(FileOes.KODCN_R3) != "0") )     
      Result = addResult( Result, Error + "\"KODCN_R3\".\n" );
    end;
    if( (Trim(FileOes.BIK_R3) != "") AND (Trim(FileOes.BIK_R3) != "0") )      
      Result = addResult( Result, Error + "\"BIK_R3\".\n" );
    end;
  end; 
  
  /*  Сведения о кредитной организации-корреспонденте плательщика (получателя):     
  Если B_PAYER = "0", то поля NAME_B0, KODCN_B0,  BIK_B0, NAME_R0, KODCN_R0 и BIK_R0 
  должны быть заполнены.
  Если В_RECIP = "0", то поля NAME_B3, KODCN_B3,  BIK_B3, NAME_R3, KODCN_R3 и BIK_R3 
  должны быть заполнены. 
  !Внимание: 
  Значение поля "Признак банка плательщика (получателя)" = 0, для плательщика (получателя) 
  не заполнено поле "<Наименование не заполненного поля>".
    Наименование  NAME_R0     
    Код места нахождения  KODCN_R0    
    БИК ЦБ РФ/BIC SWIFT   BIK_R0*/ 

  
  Warning = "!Внимание:\nЗначение поля \"Признак плательщика\" = " + FileOes.B_PAYER;
  Warning = Warning + ", для плательщика не заполнено поле ";

  if( FileOes.B_PAYER == 0 )
    if( (Trim(FileOes.NAME_B0) == "") OR (Trim(FileOes.NAME_B0) == "0") )      
      Result = addResult( Result, Warning + "\"NAME_B0\".\n" );
    end;
    if( (Trim(FileOes.KODCN_B0) == "") OR (Trim(FileOes.KODCN_B0) == "0") )      
      Result = addResult( Result, Warning + "\"KODCN_B0\".\n" );
    end;
    if( (Trim(FileOes.BIK_B0) == "") OR (Trim(FileOes.BIK_B0) == "0") )
      Result = addResult( Result, Warning + "\"BIK_B0\".\n" );
    end;

    if( (Trim(FileOes.NAME_R0) == "") OR (Trim(FileOes.NAME_R0) == "0") )
      Result = addResult( Result, Warning + "\"NAME_R0\".\n" );
    end;
    if( (Trim(FileOes.KODCN_R0) == "") OR (Trim(FileOes.KODCN_R0) == "0") )
      Result = addResult( Result, Warning + "\"KODCN_R0\".\n" );
    end;
    if( (Trim(FileOes.BIK_R0) == "") OR (Trim(FileOes.BIK_R0) == "0") )
      Result = addResult( Result, Warning + "\"BIK_R0\".\n" );
    end;
  end;

  Warning = "!Ошибка:\nЗначение поля \"Признак получателя\" = " +FileOes.B_RECIP;
  Warning = Warning + ", для получателя не заполнено поле ";

  if( FileOes.B_RECIP == 0 )
    if( (Trim(FileOes.NAME_B3) == "") OR (Trim(FileOes.NAME_B3) == "0") )
      Result = addResult( Result, Warning + "\"NAME_B3\".\n" );
    end;
    if( (Trim(FileOes.KODCN_B3) == "") OR (Trim(FileOes.KODCN_B3) == "0") )
      Result = addResult( Result, Warning + "\"KODCN_B3\".\n" );
    end;
    if( (Trim(FileOes.BIK_B3) == "") OR (Trim(FileOes.BIK_B3) == "0") )
      Result = addResult( Result, Warning + "\"BIK_B3\".\n" );
    end;

    if( (Trim(FileOes.NAME_R3) == "") OR (Trim(FileOes.NAME_R3) == "0") )
      Result = addResult( Result, Warning + "\"NAME_R3\".\n" );
    end;
    if( (Trim(FileOes.KODCN_R3) == "") OR (Trim(FileOes.KODCN_R3) == "0") )
      Result = addResult( Result, Warning + "\"KODCN_R3\".\n" );
    end;
    if( (Trim(FileOes.BIK_R3) == "") OR (Trim(FileOes.BIK_R3) == "0") )
      Result = addResult( Result, Warning + "\"BIK_R3\".\n" );
    end;
  end;   
 
  
  /*3.2 Наименование  NAME_B0
        Наименование  NAME_R0   
  Если B_PAYER = "0" и значение BIK_B0 заполнено, 
  то проверить правильность заполнения  наименования  банка NAME_B0 по коду "БИК ЦБ РФ" (=3). 
  Если не найден такой код, то по коду "BIC SWIFT" (=6). 
  Аналогичную проверку выполнить для BIK_R0 и NAME_B0.

  Если В_RECIP = "0" и значение BIK_B3 заполнено, 
  то проверить правильность заполнения  наименования  банка NAME_B3 по коду "БИК ЦБ РФ" (=3). 
  Если не найден такой код, то по коду "BIC SWIFT" (=6). 
  Аналогичную проверку выполнить для BIK_R3 и NAME_B3.
    
  !Внимание: 
  Значение поля БИК банка плательщика (получателя) "<значение поля>" не соответствует наименованию 
  банка плательщика (получателя) "<значение поля>".  
  */        
  
  Warning = "!Внимание:\nЗначение поля БИК банка плательщика  \"" ;
  TmpMes = "\" не соответствует наименованию банка плательщика \"" + FileOes.NAME_B0 + "\".\n";  
   
  if( FileOes.B_PAYER == 0 )
    if( (Trim(FileOes.BIK_B0) != "") AND (Trim(FileOes.BIK_B0) != "0") )
      if( CheckBankAndCodeName(Trim(FileOes.BIK_B0), FileOes.NAME_B0) == false )        
        Result = addResult( Result, Warning + FileOes.BIK_B0 + TmpMes );
      end;
    end;
    if( (Trim(FileOes.BIK_R0) != "") AND (Trim(FileOes.BIK_B0) != "0") )
      if( CheckBankAndCodeName(Trim(FileOes.BIK_R0), FileOes.NAME_B0) == false )        
        Result = addResult( Result, Warning + FileOes.BIK_R0 + TmpMes );
      end;
    end;   
  end; 
  
  Warning = "!Внимание:\nЗначение поля БИК банка получателя  \"";
  TmpMes  = "\" не соответствует наименованию банка получателя \"" + FileOes.NAME_B3 + "\".\n";

  if( FileOes.B_RECIP == 0 )
    if( (Trim(FileOes.BIK_B3) != "") AND (Trim(FileOes.BIK_B3) != "0") )
      if( CheckBankAndCodeName(Trim(FileOes.BIK_B3), FileOes.NAME_B3) == false )
        Result = addResult( Result, Warning + FileOes.BIK_B3 + TmpMes );
      end;
    end;
    if( (Trim(FileOes.BIK_R3) != "") AND (Trim(FileOes.BIK_R3) != "0") )
      if( CheckBankAndCodeName(Trim(FileOes.BIK_R3), FileOes.NAME_B3) == false )
        Result = addResult( Result, Warning + FileOes.BIK_R3 + TmpMes );
      end;
    end;   
  end; 
 
  return Result;   
end;

macro FileOesRecordCheck_RAO(Type):string

  var Result:string;
  Result = "";

  var Error:string, ErrorEnd:string, Warning:string, TmpMes:string;
  Error = "";
  ErrorEnd = "";
  Warning = "";
  TmpMes = "";

  /*1.2   Все поля должны быть заполнены.     
   Дата совершения DATE, Валюта  CURREN, Сумма   SUME, Коды операции   VO 
   !Ошибка: Не заполнено поле <Наименование незаполненного поля>.
  */
    if( (FileOes.DATA == date(0,0,0)) OR (FileOes.DATA == date(1,1,2099)) )  
       Result = addResult( Result, "!Ошибка:\nНе заполнено поле \"DATA\".\n" );
    end;

  if(Type == FM_OPER_TYPE_REJ_OPR)

    if( Trim(FileOes.CURREN) == "")   
       Result = addResult( Result, "!Ошибка:\nНе заполнено поле \"CURREN\".\n" );
    end;  
    if( FileOes.SUME == 0 )  
      Result = addResult( Result, "!Ошибка:\nНе заполнено поле \"SUME\".\n" );
    end;
  end;
      

  // Для операции с типом отправки <тип отправки> не заполнена дополнительная информация.
  if( (FileOes.ACTION == 3) OR (FileOes.ACTION == 4) ) 
    if( (Trim(FileOes.DESCR) == "") OR (Trim(FileOes.DESCR) == "0") )
      Result = addResult( Result, "!Ошибка:\nДля операции с типом отправки " + string(FileOes.ACTION) + " \"" +
                                  НазваниеТипаОтправкиОперации(FileOes.ACTION) + "\" не заполнена дополнительная информация.\n" );
    end;
  end;

  /*2 Сведения об участниках операции - плательщике/получателе:
  2.1 Тип участника операции  TU0 - TU4   
  Хотя бы одно из перечисленных полей должно быть обязательно  заполнено.  
  !Ошибка: Не заполнены тип и наименование участника. */ 

  if( (FileOes.TU == 0 ) AND (  (Trim(FileOes.NAMEU) == "") OR (Trim(FileOes.NAMEU) == "0")) )
    Result = addResult( Result, "!Ошибка:\nНе заполнены тип и наименование участника.\n" );
  end;

  /*Если указан тип участника операции (TU0), то наименование участника операции (NAMEU0) должно быть 
  обязательно заполнено. 
  Соответственно для TU1 проверяется NAMEU1 и так далее.  
  !Ошибка: Для типа участника операции <значение типа> не заполнено поле 
  "Наименование участника операции".*/
     
  Error = "!Ошибка:\nДля типа участника операции ";
  ErrorEnd = " не заполнено поле \"Наименование участника операции\".\n";

  if( (FileOes.TU != 0) AND ((Trim(FileOes.NAMEU) == "") OR (Trim(FileOes.NAMEU) == "0")) )    
    Result = addResult( Result, Error + "\"TU\"" + ErrorEnd );
  end;

  /*Наименование участника операции NAMEU0 - NAMEU4   
  Если указано наименование участника операции (NAMEU0), то обязательно должен быть заполнен тип 
  участника (TU0). 
  Соответственно для NAMEU1 проверяется TU1 и так далее.  
  !Ошибка:  Для участника операции <наименование участника операции> не заполнено поле "Тип участника операции".*/

  Error = "!Ошибка:\nДля участника операции ";
  ErrorEnd = " не заполнено поле \"Тип участника операции\".\n";

  if( (Trim(FileOes.NAMEU) != "") AND (Trim(FileOes.NAMEU) != "0") )
    if( FileOes.TU == 0 )       
      Result = addResult( Result, Error + "\"NAMEU\"" + ErrorEnd );
    end;
  end;


  /*2.3 Сведения об участнике операции (плательщике/получателе):  Если B_PAYER = "1" или "2", 
  то поля для плательщика 
  KODCR0- KODCN0-AMR0-ADRESS0-SD0-RG0-GR0 
  должны быть заполнены.*/
  
  Warning = "!Внимание:\nДля участника операции не заполнено поле " ;  
  
  if( (Trim(FileOes.KODCR) == "") OR (Trim(FileOes.KODCR) == "0") )
    Result = addResult( Result, Warning + "\"KODCR\".\n" );
  end;

  if( (Trim(FileOes.KODCN) == "") OR (Trim(FileOes.KODCN) == "0") )
    Result = addResult( Result, Warning + "\"KODCN\".\n" );
  end;

  if( (Trim(FileOes.AMR) == "") OR (Trim(FileOes.AMR) == "0") )
    Result = addResult( Result, Warning + "\"AMR\".\n" );
  end;

  if( (Trim(FileOes.ADRESS) == "") OR (Trim(FileOes.ADRESS) == "0") )
    Result = addResult( Result, Warning + "\"ADRESS\".\n" );
  end;

  if( (Trim(FileOes.SD) == "") OR  (Trim(FileOes.SD) == "0") )
    Result = addResult( Result, Warning + "\"SD\".\n" );
  end;

  if( (Trim(FileOes.RG) == "") OR  (Trim(FileOes.RG) == "0") )
    Result = addResult( Result, Warning + "\"RG\".\n" );
  end;

  if( (FileOes.GR == date(0,0,0)) OR (FileOes.GR == date(1,1,2099))  )
      Result = addResult( Result, Warning + "\"GR\".\n" );
  end;
  
  /*2.4 Документ, удостоверяющий личность   KD0 - KD3  
        Наименование документа, удостоверяющего личность  VD0 - VD3
  */
  
  Warning = "!Внимание:\nДля участника операции не заполнено поле ";

  if( (FileOes.TU == 2) OR (FileOes.TU == 3) )
    if( (Trim(FileOes.KD) == "") OR (Trim(FileOes.KD) == "0") )
      Result = addResult( Result, Warning + "\"KD\""  );
    end;
    
    if( (Trim(FileOes.VD) == "") OR (Trim(FileOes.VD) == "0") )
      Result = addResult( Result, Warning + "\"VD\"" );
    end;
  end;
    


  /*2.5 ИНН ND0 - ND3 */
  
  Warning = "!Внимание:\nДля участника операции не заполнено поле ";

  if( FileOes.TU == 1 )
    if( (Trim(FileOes.ND) == "") OR (Trim(FileOes.ND) == "0") )
      Result = addResult( Result, Warning + "\"ND\""  );
    end;      
  end;

 
  return Result;   

end;


Macro PrintFileOesFillingControl(
  sysdate,
  systime,
  OesFileName,
  DprtName,
  OperID,
  OperName,
  FImpType
)
[                  Контроль правильности заполнения полей файла ОЭС                            ];
[ Дата и время контроля: ##########  ##############                                            ](sysdate, systime);
[ Имя файла: #########################                                                         ](OesFileName);
[ Наименование филиала: #########################                                              ](DprtName);
[ Исполнитель: #### ################################                                           ](OperID, OperName);

  
  var DIR_IMPWORK_Path, stat;
   GetRegistryValue("ФИНМОНИТОРИНГ\\DIR_IMPWORK", V_STRING, DIR_IMPWORK_Path, stat);
   if( stat != 0 ) 
     MsgBox ("Ошибка чтения настройки ФИНМОНИТОРИНГ\\DIR_IMPWORK"); 
   end;
   
   
   if( SubStr( DIR_IMPWORK_Path, strlen( DIR_IMPWORK_Path )) != "\\" )
     DIR_IMPWORK_Path = DIR_IMPWORK_Path + "\\";
   end;
   
  
   if( not open( FileOes, DIR_IMPWORK_Path + OesFileName ))
     msgbox("настройка реестра ФИНМОНИТОРИНГ\\DIR_IMPWORK задана неверно,|| или файл ОЭС не может быть открыт!!!"); 
     return 1;
   end;

  
  var numrec = 0, errorrec = 0, i;
  var Result:string, PrintHead = 1;
  var Type = 0;

  while( next (FileOes) )
    numrec = numrec + 1;
    i = 1;
    var RejectCode = 0;

    if(FImpType == FM_IMP_OPER_TYPE_LEGAL)
      Type = FM_OPER_TYPE_LEGAL;
    else
      RejectCode =int(FileOes.Part);
      if((RejectCode >=  FM_REJECTCODE_BANK_REG_AUT) AND (RejectCode <= FM_REJECTCODE_NPER_ABS))
        Type = FM_OPER_TYPE_REJ_ACC;
      elif((RejectCode >=  FM_REJECTCODE_DOC_ABS) AND (RejectCode <= FM_REJECTCODE_OPR_TERROR))
        Type = FM_OPER_TYPE_REJ_OPR;
      elif(RejectCode == FM_REJECTCODE_OPR_REJ)
        Type = FM_OPER_TYPE_REJ_CON;
      end;
    end;

    if(Type == FM_OPER_TYPE_LEGAL)
      Result = FileOesRecordCheck_LG();       
    else
      Result = FileOesRecordCheck_RAO( Type );       
    end;

    if( Result == "" )
      /*В результате выполнения "Процедуры контроля" протокол должен формироваться всегда. 
      При этом если не найдено никаких ошибок, то печатается заголовочная часть протокола, 
      а ниже выводится "Не найдено ошибок при проверке правильности заполнения полей файла ОЭС".*/
      [ Не найдено ошибок при проверке правильности заполнения полей файла ОЭС ];
    elif((Type != FM_OPER_TYPE_REJ_ACC) AND (Type != FM_OPER_TYPE_REJ_CON)) 
      if( PrintHead == 1 )
[ ┌─────┬──────────┬────────────┬─────┬────────────┬───────────────┬────────────────────────────────┐
  │  №  │  Номер   │    Дата    │ Код │   Сумма    │  Сумма (руб.) │       Результат контроля       │
  │ п/п │ операции │            │ вал │            │               │                                │]; 
        
        PrintHead = 0;
      end;

[ ├─────┼──────────┼────────────┼─────┼────────────┼───────────────┼────────────────────────────────┤ 
  │#####│##########│############│#####│############│###############│################################│]
(
  GetPos(FileOes),                    /* .GetPosnumrec,  */          /*№ п/п B1        Порядковый номер записи в таблице.*/
  FileOes.NUMB_P:10:0,                /* Номер операции B2 Выводится значение поля NUMB_P записи в принятом файле.*/
  FileOes.DATA:w,                     /* Дата B3 Дата совершения операции. Выводится значение поля DATA записи в принятом файле.*/
  FileOes.CURREN:w,                   /* Код вал B4  Код валюты.  Выводится значение поля CURREN записи в принятом файле.*/
  round(FileOes.SUM, 2):14:2:w,       /* Сумма B5  Сумма операции в валюте ее проведения.  Выводится значение поля SUM записи в принятом файле.*/
  round(FileOes.SUME, 2):14:2:w,      /* Сумма в руб. B6 Сумма операции в рублевом эквиваленте. Выводится значение поля SUME записи в принятом файле.*/
  Result:w                            /* Результат контроля  B7  Список ошибок / предупреждений. 
                                         Если для одной операции найдено несколько ошибок, то каждое сообщение выводится 
                                         с новой строки. Текст сообщений приведен в таблице "Правила контроля данных файла 
                                         ОЭС" в столбце "Сообщение в протокол".*/
);
      
      errorrec = errorrec + 1;

    else
      if( PrintHead == 1 )
[ ┌─────┬──────────┬────────────┬────────────────────────────────┐
  │  №  │  Номер   │    Дата    │       Результат контроля       │
  │ п/п │ операции │            │                                │]; 
        
        PrintHead = 0;
      end;

[ ├─────┼──────────┼────────────┼────────────────────────────────┤ 
  │#####│##########│############│################################│]
(
  GetPos(FileOes),                    /* .GetPosnumrec,  */          /*№ п/п B1        Порядковый номер записи в таблице.*/
  FileOes.NUMB_P:10:0,                /* Номер операции B2 Выводится значение поля NUMB_P записи в принятом файле.*/
  FileOes.DATA:w,                     /* Дата B3 Дата совершения операции. Выводится значение поля DATA записи в принятом файле.*/
  Result:w                            /* Результат контроля  B7  Список ошибок / предупреждений. 
                                         Если для одной операции найдено несколько ошибок, то каждое сообщение выводится 
                                         с новой строки. Текст сообщений приведен в таблице "Правила контроля данных файла 
                                         ОЭС" в столбце "Сообщение в протокол".*/
);

      errorrec = errorrec + 1;

    end;    
  
  end;
  
  if( PrintHead == 0 )
    if((Type != FM_OPER_TYPE_REJ_ACC) AND (Type != FM_OPER_TYPE_REJ_CON)) 
[ └─────┴──────────┴────────────┴─────┴────────────┴───────────────┴────────────────────────────────┘];
    else
[ └─────┴──────────┴────────────┴────────────────────────────────┘];
    end;
  end;

[ Всего кол-во записей: ######### ]( numrec );
[ Не содержат ошибки/предупреждения: ######### ](numrec-errorrec);
[ Содержат ошибки/предупреждения:    ######### ]( errorrec ); 

end;


/*В результате выполнения "Процедуры контроля" протокол должен формироваться всегда. 
При этом если не найдено никаких ошибок, то печатается заголовочная часть протокола, 
а ниже выводится "Не найдено ошибок при проверке правильности заполнения полей файла ОЭС".*/


/*│║
 *┌─┬─┐ ╔═╦═╗ ╓─╥─╖╒═╤═╕
 *├─┼─┤ ╠═╬═╣ ╟─╫─╢╞═╪═╡
 *└─┴─┘ ╚═╩═╝ ╙─╨─╜╘═╧═╛
 */















