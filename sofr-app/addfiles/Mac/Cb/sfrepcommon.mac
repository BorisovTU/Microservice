/* общие функции для формирования отчета по начислению\оплате комиссий*/

import "globals.mac", RSD;

private macro PrintUser( userType, userNum )
  var strSql : string;
  var rs : RsdRecordset, cmd;

  strSql = "SELECT t_oper, t_name FROM dperson_dbt WHERE t_oper = ? ";
           
  cmd = RsdCommand( strSql );
  cmd.addParam( "", RSDBP_IN, userNum );

  rs = RsdRecordset( cmd );

  if( rs.MoveNext())
[  ############## ##### ####################################################] ( userType, rs.value( 0 ), rs.value( 1 ));
  end;
end;

private macro PrintDate()
[
   Дата формирования : ##########] ( date );
[  Время формирования: ########] ( time );

end;

macro SfRep_PrintTop()
  PrintDate();
  PrintUser( "Операционист: ", {oper} ); 
end;

macro SfRep_GetDepartmentName( DprtID ) : string

  var sqlString : string;
  var rs : RsdRecordset, cmd;

  sqlString = " SELECT p.t_ShortName FROM dparty_dbt p WHERE p.t_PartyID = " +
              "(SELECT d.t_PartyID FROM ddp_dep_dbt d WHERE d.t_Code = ?) ";  

  cmd = RsdCommand( sqlString );
  cmd.addParam( "", RSDBP_IN, DprtID );

  rs = RsdRecordset( cmd );

  if( rs.moveNext())
    return rs.value( 0 );
  end;

  return "";
end;

macro SfRep_GetCurrencyShortName( CCur ) : string

  var sqlString : string;
  var rs : RsdRecordset;

  sqlString = "SELECT t_Ccy FROM dfininstr_dbt WHERE t_fiid = " + CCur;

  rs = RsdRecordset( sqlString );

  if( rs.moveNext())
    return rs.value( 0 );
  end;

  return "";
end;