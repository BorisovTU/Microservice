IMPORT  PaymInter, OprInter;  
IMPORT  "gstname.mac";

RECORD pm_paym( pmpaym );
RECORD pm_rmprop (pmrmprop);

private
  var DrawHead = false;


const Ошибка   = 0,
      Первый   = 1,
      Последний= 2;

MACRO Печать_ОтчетСканирования( Вызов, firstdoc, Статус, Сообщение )

  var PaymentID:integer = 0, DocKind:integer = 0;
  var Number:string = "";
  var OpDate:date = date(0,0,0);
  var Amount = 0,
      PayAmount = 0;

  setbuff( pm_paym, firstdoc );

  if( Вызов == Первый )
      
    DrawHead = true;

  elif( Вызов == Ошибка )
    
    if( DrawHead )
    
[      Отчет о групповом помещении документов на счет незавершенных расчетов       ];
[┌─────────┬─────────────┬──────────┬──────┬──────────────────────────────────────┐];
[│  Номер  │   Сумма     │   Дата   │Номер │                Сообщение             │];
[│документа│             │          │ошибки│                                      │];
[├─────────┼─────────────┼──────────┼──────┼──────────────────────────────────────┤];

    DrawHead = false;

    end;

    if( Статус == 0 )
      Сообщение = "Документ успешно помещен на счет незавершенных расчетов ";
    end;
    
    if( FindPayment( pm_paym.PaymentID, 0, 0, 0, 0, true, null, null, null, pm_rmprop ) != 0 )
      Статус = 1;
      Сообщение = "Документ не найден";
    else 
      Сообщение = Сообщение+". "+GetStepNameExecuteRead(pm_paym.PaymentID, pm_paym.DocKind, pm_paym.PaymStatus);
    end;
    
[│#########│#############│##########│######│######################################│]
( pm_rmprop.Number,pm_paym.Amount,pm_rmprop.Date, Статус, StrSubst(Сообщение, "|", " " ):w );
          
  elif( Вызов == Последний )
   
[└─────────┴─────────────┴──────────┴──────┴──────────────────────────────────────┘];
  end;

END;
