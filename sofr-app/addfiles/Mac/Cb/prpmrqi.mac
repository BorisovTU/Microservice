/*
$Name:             prpmrqi.mac
$Module:           
$Description:      ¥ç âì ¯« â¥¦­®£® ¯®àãç¥­¨ï. 
                   à®£à ¬¬¨áâ    : ‘¬¨à­®¢ ‘.‚. 
                   ‘®§¤ ­         : 09.10.02
*/

import prpm, gnd120p, prpmboi, "pmbudg_lib.mac";

/* ¥ç âì ¯« â¥¦­®£® ¯®àãç¥­¨ï ¯® 1256-“ */
MACRO PrintPayReq1256(ncopy:integer):bool

  var PayerProps   :TPartyProperties = TPartyProperties("Payer",    pr_pmpaym, pr_debet,  pr_pmrmprop);
  var ReceiverProps:TPartyProperties = TPartyProperties("Receiver", pr_pmpaym, pr_credit, pr_pmrmprop);

  var pINN   :string, 
      pKPP   :string,
      rINN   :string, 
      rKPP   :string,
      ground :string,
      IsBudg :bool = IsBudgetPaym(pr_pmrmprop.rec.TaxAuthorState, pr_pmpaym.rec.PayType);
      
  ARRAY SS, SG, SBP, SBR, SP, SR, UIN;

  ground        = InterpretGround( pr_pmrmprop.rec.Ground );
  
  splitINN_KPP(PayerProps.INN,    pINN, pKPP);
  splitINN_KPP(ReceiverProps.INN, rINN, rKPP);

  strsplit( PayerProps.Name,        SP,    50, 50, 4 );
  strsplit( ReceiverProps.Name,     SR,    50, 50, 4 );
  strsplit( PayerProps.BankName,    SBP,   50, 50, 2 );
  strsplit( ReceiverProps.BankName, SBR,   50, 50, 2 );
  strsplit( ground,                 SG,    85, 85, 3 );
  strsplit( RubToStrAlt(pr_pmpaym.rec.Amount), SS, 76, 76, 3 );
  strsplit( GetUIN( pr_pmrmprop.rec.Date, pr_pmrmprop.rec.UIN, pr_pmpaym.rec.PayType ), UIN, 13, 13, 2 );

  while(ncopy != 0)
    [                                                                                  ÚÄÄÄÄÄÄÄÄÄ¿
                                                                                       ³ 0401060 ³
                                                                                       ÀÄÄÄÄÄÄÄÄÄÙ
          ############            ##########
      ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ  ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ®áâã¯. ¢ ¡ ­ª ¯« â.   ‘¯¨á ­® á® áç. ¯« â.
                                                   ############     #############           ÚÄÄÄÄ¿
      « â¥¦­®¥ ¯®àãç¥­¨¥ N ###############        ÄÄÄÄÄÄÄÄÄÄÄÄ     ÄÄÄÄÄÄÄÄÄÄÄÄÄ           ³ ## ³
                                                      („ â )        (‚¨¤ ¯« â¥¦ )           ÀÄÄÄÄÙ

      ‘ã¬¬    ³ ####################################################################################
      ¯à®¯¨áìî³ ####################################################################################
              ³ ####################################################################################
     ÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ˆ ############ ³ Š #########                   ³ ‘ã¬¬  ³ #############################
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´       ³
      ################################################## ³       ³
      ################################################## ³       ³
      ################################################## ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ################################################## ³ ‘ç.N. ³ #############################
                                                         ³       ³
      « â¥«ìé¨ª                                         ³       ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ################################################## ³ ˆŠ   ³ #############################
      ################################################## ÃÄÄÄÄÄÄÄ´
                                                         ³ ‘ç.N. ³ #############################
       ­ª ¯« â¥«ìé¨ª                                    ³       ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ################################################## ³ ˆŠ   ³ #############################
      ################################################## ÃÄÄÄÄÄÄÄ´
                                                         ³ ‘ç.N. ³ #############################
       ­ª ¯®«ãç â¥«ï                                    ³       ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄ´
      ˆ ############ ³ Š #########                   ³ ‘ç.N. ³ #############################
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´       ³
      ################################################## ³       ³
      ################################################## ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄ
      ################################################## ³‚¨¤ ®¯.³ ####        ³‘à®ª ¯« â.³##########
      ################################################## ÃÄÄÄÄÄÄÄ´             ÃÄÄÄÄÄÄÄÄÄÄ´
                                                         ³ §.¯«.³             ³ç¥à ¯« â.³##########
                                                         ÃÄÄÄÄÄÄÄ´             ÃÄÄÄÄÄÄÄÄÄÄ´
                                                         ³Š®¤    ³#############³¥§. ¯®«¥ ³
      ®«ãç â¥«ì                                         ³       ³#############³          ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÁÂÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÂÄÄÁÄÄÄÄÄÄÄÄÄÂÁÄÄÄÄÄÄÄÄÄÄÄ
      ####################³ ########### ³ ## ³ ########## ³ ############### ³ ########## ³ ##
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄ
       §­ ç¥­¨¥ ¯« â¥¦ :
      ###############################################################################################
      ###############################################################################################
      ###############################################################################################

     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
                                               ®¤¯¨á¨                        â¬¥âª¨ ¡ ­ª 
                                                                              #####################
           Œ..
                                               ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

                                               ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ


    ]
    (pr_pmpaym.rec.PayerBankEnterDate:f:c, pr_pmrmprop.rec.PayerChargeOffDate:f:c, pr_pmrmprop.rec.Date:f:c, 
     GetPaymentKind(pr_pmrmprop.rec.PaymentKind):c, pr_pmrmprop.rec.Number:l,
     pr_pmrmprop.rec.TaxAuthorState,
     SS(0):l, SS(1):l, SS(2),
     Str0(pINN, IsBudg), Str0(pKPP, IsBudg), pr_pmpaym.rec.Amount:l:f,
     SP(0), SP(1):l, SP(2):l, SP(3),
     PayerProps.Account:l,
     SBP(0):l, GetCodeBik(pr_pmpaym.rec.valuedate,PayerProps.BankBIC):l, SBP(1):l, PayerProps.BankCorrAccount:l,
     SBR(0):l, GetCodeBik(pr_pmpaym.rec.valuedate,ReceiverProps.BankBIC):l, SBR(1):l, 
     ReceiverProps.BankCorrAccount:l, Str0(rINN, IsBudg), Str0(rKPP, IsBudg), ReceiverProps.Account:l,
     SR(0), SR(1), SR(2),
     pr_pmrmprop.rec.ShifrOper:l, "", SR(3), pr_pmrmprop.rec.Priority:c,
     UIN(0),
     UIN(1),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, Str0(pr_pmrmprop.rec.BttTICode,   IsBudg), ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, Str0(pr_pmrmprop.rec.OKATOCode,   IsBudg), ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, Str0(pr_pmrmprop.rec.TaxPmGround, IsBudg), ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, Str0(pr_pmrmprop.rec.TaxPmPeriod, IsBudg), ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, Str0(pr_pmrmprop.rec.TaxPmNumber, IsBudg), ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, Str0(pr_pmrmprop.rec.TaxPmDate,   IsBudg), ""),
     GetForm110Str(pr_pmrmprop),
     SG(0):l, SG(1):l, SG(2):l, pr_pmpaym.rec.PayerBankMarkDate:f
    );

    ncopy = ncopy - 1;
  end;
  
  return TRUE;
  
END;

MACRO PrintPayReq(ncopy:integer):bool
  var isPrintEOF:bool;               // ¥ç âì á¨¬¢®«  ®ª®­ç ­¨ï «¨áâ 
  if( not GetParm( 1, isPrintEOF ) ) // ¯® ã¬®«ç ­¨î ¯¥ç â âì ­ ¤®
    isPrintEOF = true;
  end;        
  if( pr_PrintEA )
    PrintEAHeader();
  end;
  var stat = 0;
  if( pr_pmrmprop.rec.ShifrOper == "17" )
    stat = PrintBankOrder( ncopy );
  else
    stat = PrintPayReq1256(ncopy);
  end;
  if( isPrintEOF )
    PrintEOF();
  end;
  return stat;
END;
