/*
 $Name: prcret30.mac
 $Module: Возврат излишне начисленных процентов
 $Description: Отражать в учете?
 */
 /*
	Блок      : 452700 - "Возврат излишне начисленных процентов"
    Шаг       : 30    - "Отражать в учете?"
    Назначение: Макрос шага
    Описание  : Макрос шага
 */

import PaymInter, InsCarryDoc, "oralib.mac", "likepy.mac";

//-----------------------------------------------------------------------------
// Выполнение шага
//-----------------------------------------------------------------------------
record contract_buf (prccontract);
record cntopr_buf (prccntopr);

var prccontract = TBfile("prccontract.dbt"),
    cntsched = TBfile("prccntsched.dbt"),
    prccntopr = TBfile("prccntopr.dbt");
    
MACRO ExecuteCaseStep(OperationKind, StepNumber, Document, DocKind)

   SetBuff( cntopr_buf, Document );

   var ContractID = cntopr_buf.contractid;
   var DocID      = cntopr_buf.DocID;

   prccntopr.KeyNum = 0;	
   prccntopr.rec.DocID = DocID;
   if (not prccntopr.GetEQ)
      msgbox ("Не найдена операция доначисления");
      return 1;
   end; 
   
   if (prccntopr.rec.IsCreateDoc == false) 
      return "50";
   else
      return "40";
   end;

END;