import "consrep.mac";

file person(person);

var Count;

var prevCarryDate, 
    prevFICodeDT, 
    prevFICodeKT,
    prevFIDT, 
    prevFIKT;

var ResDS, 
    ResKS, 
    ResSNat;

private macro PrintLogTop( CarryDate : date, DprtID : integer, FICodeDT, FICodeKT, FINameDT, FINameKT )
  PrintLogDepartment( DprtID );
[                                                                              ];
[       ‘¢®¤­ë© ¬¥¬®à¨ «ì­ë© ®à¤¥à ®â ##########                               ](CarryDate:f);
[                                                                              ];
[ ‚ «îâ  ¤¥¡¥â :  #########  ##################################################](FICodeDT, FINameDT);
[ ‚ «îâ  ªà¥¤¨â : #########  ##################################################](FICodeKT, FINameKT);
end;

private macro PrintLogBottom(Oper)
  person.Oper = Oper;
  if(GetEQ(person))
[ Ž¯¥à æ¨®­¨áâ:                     ###########################################](person.Name);
[                                                                              ];
[ Š®­âà®«¥à:                        (                                         )];
[                                                                              ];
  end;
end;

private macro PrintTabHeader(FIDT, FIKT)
if((FIDT == 0) and (FIKT == 0))
[ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
[³üü           ³‘ç¥â ¤¥¡¥â                   ³‘ã¬¬  ¤¥¡¥â  ³‘ç¥â ªà¥¤¨â                  ³];
[³             ³                             ³             ³                             ³];
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
elif(FIDT == FIKT)
[ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
[³üü           ³‘ç¥â ¤¥¡¥â                   ³‘ã¬¬  ¤¥¡¥â  ³‘ç¥â ªà¥¤¨â                  ³ª¢¨¢ «¥­â            ³];
[³             ³                             ³             ³                             ³¢ ­ æ.¢ «îâ¥          ³];
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
else
[ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
[³üü           ³‘ç¥â ¤¥¡¥â                   ³‘ã¬¬  ¤¥¡¥â  ³‘ç¥â ªà¥¤¨â                  ³‘ã¬¬  ªà¥¤¨â ³ª¢¨¢ «¥­â            ³];
[³             ³                             ³             ³                             ³             ³¢ ­ æ.¢ «îâ¥          ³];
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
end;
end;

private macro PrintTabGround(FIDT, FIKT, Ground)
  array _Ground;
  var j;
if((FIDT == 0) and (FIKT == 0))
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
elif(FIDT == FIKT)
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
else
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
end;
  if(StrLen(Ground) > 0 )
    if((FIDT == 0) and (FIKT == 0))
      StrSplit(Ground, _Ground, 80, 80, 10 );
    elif(FIDT == FIKT)
      StrSplit(Ground, _Ground, 95, 95, 10 );
    else
      StrSplit(Ground, _Ground, 115, 115, 10 );
    end;
    j = 0;
    while(StrLen(_Ground( j )) > 0 )
    if((FIDT == 0) and (FIKT == 0))
[³             ³#########################################################################³](_Ground( j ));
    elif(FIDT == FIKT)
[³             ³################################################################################################³](_Ground( j ));
    else
[³             ³##############################################################################################################³](_Ground( j ));
    end;
      j = j + 1;
    end;
  end;
if((FIDT == 0) and (FIKT == 0))
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
elif(FIDT == FIKT)
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
else
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
end;
end;

private macro PrintTabContent(Num, FIDT, AccDT, SumDT, FIKT, AccKT, SumKT, SumNat, Ground)
if((FIDT == 0) and (FIKT == 0))
[³#############³#############################³#############³#############################³](Num, AccDT, SumDT, AccKT);
elif(FIDT == FIKT)
[³#############³#############################³#############³#############################³######################³](Num, AccDT, SumDT, AccKT, SumNat);
else
[³#############³#############################³#############³#############################³#############³######################³](Num, AccDT, SumDT, AccKT, SumKT, SumNat);
end;
  PrintTabGround(FIDT, FIKT, Ground);
end;

private macro PrintTabFooter()
if((prevFIDT == 0) and (prevFIKT == 0))
[³             ³                             ³             ³                             ³];
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
[³             ³ ˆâ®£®                       ³#############³                             ³](ResDS);
[ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
elif(prevFIDT == prevFIKT)
[³             ³                             ³             ³                             ³                      ³];
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
[³             ³ ˆâ®£®                       ³#############³                             ³######################³](ResDS, ResSNat);
[ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
else
[³             ³                             ³             ³                             ³             ³                      ³];
[ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
[³             ³ ˆâ®£®                       ³#############³                             ³#############³######################³](ResDS, ResKS, ResSNat);
[ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
end;
end;

macro PrintTab(CarryDate, FIDT, FICodeDT, FINameDT, AccDT, SumDT, FIKT, FICodeKT, FINameKT, AccKT, SumKT, Num, Ground, SumNat)
  var SumDTNat, SumKTNat;  
  if((prevCarryDate != CarryDate) or (prevFICodeDT != FICodeDT) or (prevFICodeKT != FICodeKT))
    if(Count == 0)
      PrintLogTop(CarryDate, {OperDprtNode}, FICodeDT, FICodeKT, FINameDT, FINameKT);
      PrintTabHeader(FIDT, FIKT);
    else
      PrintTabFooter();
      PrintLogBottom({oper});
      PrintLogTop(CarryDate, {OperDprtNode}, FICodeDT, FICodeKT, FINameDT, FINameKT);
      PrintTabHeader(FIDT, FIKT);
    end;
    ResDS = $0;
    ResKS = $0;
    ResSNat = $0;
  end;
  PrintTabContent(Num, FIDT, AccDT, SumDT, FIKT, AccKT, SumKT, SumNat, Ground);
  Count = Count + 1;
  prevCarryDate = CarryDate;
  prevFICodeDT = FICodeDT;
  prevFICodeKT = FICodeKT;
  prevFIDT = FIDT;
  prevFIKT = FIKT;
  ResDS = ResDS + SumDT;
  ResKS = ResKS + SumKT;
  ResSNat = ResSNat + SumNat;
end;

macro StartReport()
  Count = 0;
  prevFICodeDT = "";
  prevFICodeKT = "";
end;

macro FinishReport()
  if(Count > 0)
    PrintTabFooter();
    PrintLogBottom({oper});
  end;
end;
