/*
$Name: partycbdklink.mac
$Module: Ядро ГКБО
$Description: Пример макроса формирования сообщения в ЦБД
*/

/*
 * Пример макроса формирования сообщения в ЦБД для связывания физических лиц объявленного 
 * в настройке CB/PARTY/CBDK/PERSON/MESMACROLINKPERSON
 */

Import BankInter;
Import PTInter;

private macro DialogPartyCreateLink(PartyFirst : RsbParty, PartySecond : RsbParty, objlink)
  array Text;
  array Button;
  
  file objrole("objrole.dbt") key 0;
  var RoleName = "";

  objrole.ObjectType = 3;
  objrole.GroupID = objlink.GroupID;
  if(getEQ(objrole))
    RoleName = objrole.Name + " - " + objrole.NameAttr;
  end;
  
  Text( 0) = "ИМИТАЦИЯ ИНТЕГРАЦИИ С ВНЕШНЕЙ ЦБД КЛИЕНТОВ";
  Text( 1) = " ";
  Text( 2) = "Дистрибутивная макрофункция partycbdklink.mac.PartyCreateLink";
  Text( 3) = "имитирует передачу во внешнюю ЦБД клиентов (MDM-систему)";
  Text( 4) = "сообщения о регистрации связи между двумя субъектами связи:";
  Text( 5) = "- первый субъект: " + PartyFirst.Code(1) + " " + PartyFirst.ShortName;
  Text( 6) = "- вид связи: " + RoleName;
  Text( 7) = "- второй субъект: " + PartySecond.Code(1) + " " + PartySecond.ShortName;
  Text( 8) = "Непосредственного ответа на запрос не ожидается. Результат     ";
  Text( 9) = "установления связи не оценивается.                             ";
  Text(10) = " ";
  Text(11) = "Для полноценной интеграции доработайте макросы механизма";
  Text(12) = "интеграции в соответствии с требованиями применяемой вами ЦБД.";
  Text(13) = " ";
  Text(14) = "Для управления интеграцией с ЦБД используйте настройки реестра";
  Text(15) = "CB/PARTY/CBDK/";
  Text(16) = " ";
  Text(17) = "Подробнее об интеграции с внешней ЦБД клиентов см. документацию";
  Text(18) = "к системе RS-Bank V.6";
  Text(19) = " ";
  Button(0) = " Продолжить ";
  return confwin(Text, Button); 
end;

/* Функция асинхронного запроса для связывания физических лиц 
 */
macro PartyCreateLink(PartyFirst : RsbParty, PartySecond : RsbParty, objlink)
  DialogPartyCreateLink(PartyFirst, PartySecond, objlink);
  return 0;
end;
