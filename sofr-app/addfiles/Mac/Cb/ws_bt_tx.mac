import RsbDataSet, globals, oralib;

//класс TWsDepartment предоставляет информацию о узле ТС
class TWsBtTx
  var Code : string;
  var Note : string;
end;

macro GetBTTTICode
(
  StartRow: integer, // С какой строки начать
  CountRow: integer  // Количество строк
)
  var query:string = "";
  var outArray = TArray(), tempObj = TWsBtTx();
  
  query =
      " Select Code, Note from  "
      "  ( select BtTx.t_Code Code, BtTx.t_Note Note, rownum rn "
      "      from dbt_tx_dbt BtTx "
      "        where BtTx.t_Taxonomy = 9 "
      "         and LENGTH(BtTx.t_Code) = 20 ) "
      "  where ( 1 = 1 ) ";

  if( StartRow )
    query = query + " and rn >  " + StartRow;
  end;
  if( CountRow )
    if( StartRow )
      query = query + " and rn <= " + CountRow + " + " + StartRow;
    else
      query = query + " and rn <= " + CountRow;
    end;
  end;
 
  query = query + " order By Code ";
  
  var rs:RsdRecordset = execSQLselect( query, NULL, false );
  while( rs and rs.moveNext() )

    tempObj      = TWsBtTx();
    tempObj.Code = rs.value(0);
    tempObj.Note = rs.value(1);

    outArray[outArray.size] = tempObj;
  end;
  return outArray;
end;
