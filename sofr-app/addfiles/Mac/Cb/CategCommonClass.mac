//CategCommonClass.mac
//общий класс категорий

import oralib, likepy, globals, "cblogger2.mac";

class CategCommonClass()
  private var logger:c_logger;
  private var objectID = "";
  private var objectType:integer = 0;

  private macro SetCategory(groupID:integer, attrID:integer, dt:date):bool
    var params = MakeArray(SqlParam("p_object_type", objectType),
                           SqlParam("p_group_id",    groupID),
                           SqlParam("p_object",      objectID),
                           SqlParam("p_attr_id",     attrID),
                           SqlParam("p_date",        dt));
    ExecStoredFunc("categ_utils.save_categ", V_UNDEF, params);
    return true;
  OnError(err)
    logger.ErrorClob("SetCategory. objectID = " + objectID + "; groupID = " + groupID + "; objecttype = " + objectType, GetFullErrMsg(err));
    return false;
  end;

  //возвращает ИД атрибута - attr_id
  private macro GetCategory(groupID:integer, dt:date):integer
    var params = MakeArray(SqlParam("p_object_type", objectType),
                           SqlParam("p_group_id",    groupID),
                           SqlParam("p_object",      objectID),
                           SqlParam("p_date",        dt));
    var attrID = ExecStoredFunc("categ_read.get_attr_id", V_INTEGER, params);
    if (valtype(attrID) == 26)
      return 0;
    end;
    return attrID;
  OnError(err)
    logger.ErrorClob("GetCategory. objectID = " + objectID + "; groupID = " + groupID + "; objecttype = " + objectType, GetFullErrMsg(err));
    return 0;
  end;

end;