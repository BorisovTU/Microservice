/*
$Name:        ws_integrationrsconnect.mac
$Module:      Web-общее
$Description: Макрос для вызова сервисов rs-connect
*/

import rcw;

private var jvm = CreateObject ("rsjvm", "TJavaHost", "GlobalJavaHost");
macro CreateRscOrderHeaderJava( )
  
  var javaObject = jvm.CreateJavaObject( "ru.softlab.rsbank.RscOrderHeader","<init>" );
  return javaObject;
end;

macro CreateRscQueryJava( )
  var javaObject = jvm.CreateJavaObject( "ru.softlab.rsbank.RscQuery","<init>" );
  return javaObject;
end;

/*Сервис создания Запроса о начислениях ГИС ЖКХ*/
macro callhsSendPaymQueryToSMEV ( rscOrderHeader, rscQuery, urlAddress : string )
  var url = jvm.createJavaObject("java.net.URL", "<init>@(Ljava/lang/String;)V",  urlAddress);
  var proxy = jvm.createJavaObject("ru.softlab.rsbank.IntegrationWS", "<init>@(Ljava/net/URL;)V", url);
  var port = proxy.getIntegrationWSPort();
  var result = port.hsSendPaymQueryToSMEV(rscOrderHeader, rscQuery);
  return result;
end;

/*Сервис для получения списка Начислений от ГИС ЖКХ */
macro callhsResultPaymQueryFromSMEV 
( 
  rscOrderHeader, 
  queryMessageID : string, /*MessageID исходного сообщения (запроса)*/
  queryID : integer, /*ID запроса, полученный в сервисе создания запроса*/
  urlAddress : string
)
  var url = jvm.createJavaObject("java.net.URL", "<init>@(Ljava/lang/String;)V",  urlAddress);
  var proxy = jvm.createJavaObject("ru.softlab.rsbank.IntegrationWS", "<init>@(Ljava/net/URL;)V", url);
  var port = proxy.getIntegrationWSPort();
  var result = port.hsResultPaymQueryFromSMEV(rscOrderHeader, queryMessageID, queryID);
  return result;
end;