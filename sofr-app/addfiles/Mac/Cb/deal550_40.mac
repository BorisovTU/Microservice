//-----------------------------------------------------------------------------
// Блок      : 26002 - "Обработка отвергнутой сделки"
// Шаг       : 40    - "Обработка отвергнутой сделки"
// Назначение: Макрос шага
// Описание  : Макрос шага
//-----------------------------------------------------------------------------

import PaymInter, InsCarryDoc, BankInter;

var PaymentObj: RsbPayment,
    Action: integer;

//-----------------------------------------------------------------------------
// Выполнение шага
//-----------------------------------------------------------------------------
MACRO ExecuteStep( doc, paymDoc, KindDoc, ID_Operation, ID_Step )
  Array Text;
  Array Buttons;
  if (Action == 0)
    Text(0) = "Какое действие следует произвести с отвергнутым документом?";                                                       

    Buttons(0) = " Перезапустить ";
    Buttons(1) = " Закрыть ";
    Buttons(2) = " Отменить "; 

    Action = ConfWin(Text, Buttons, 0) + 1;
  end;

  if (Action == 1)//Перезапустить
    if(not InsertOprStatus(2601, 1 )) //Открыта
      msgbox("Ошибка при установке статуса платежа");
      return 1;
    end;
    PaymentObj.PaymStatus = PM_READIED;
  elif(Action == 2)
    if(not InsertOprStatus(2601, 4 )) //Завершена
      msgbox("Ошибка при установке статуса платежа");
      return 1;
    end;
    //BreakOperation();
  elif(Action == 3)
    return 1;
  end;

  return 0;
  
END;