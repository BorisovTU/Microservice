/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : ptmopcl.mac
  Created     : 17.04.03
  Programmer  : Симонишин А.А.
  Description : Отчет о закрытии/открытии субъектов

└───────────────────────────────────────────────────────────────────────────*/


const   Ошибка   = 0,
    Первый   = 1,
    Последний= 2;

RECORD  party (party);

file part_code( "partcode.dbt" ) key 0;

MACRO Печать_ОтчетСканирования (Вызов,firstdoc,Статус,Сообщение)
   array StringArray;
   var i = 1;
   var stat;
   setbuff (party, firstdoc);

    if (Вызов==Первый)
[             Отчет о групповом выполнении.];
[┌───────────────────────────────────┬────────┬─────────────────────────────────────────────────────────┐];
[│               Код                 │   №    │                 Сообщение                               │];
[│             субъекта              │ ошибки │                                                         │];
[├───────────────────────────────────┼────────┼─────────────────────────────────────────────────────────┤];
    elif (Вызов==Ошибка)
        if (Статус == 0)
            Сообщение = "Операция выполнена успешно"
         end;

         part_code.PartyID = party.PartyID;
         part_code.CodeKind = 1;
         stat = GetEQ(part_code);

         StrSplit(StrSubst(Сообщение, "│", " " ), StringArray, 56);
         if(stat == 0) 
[│###################################│########│#########################################################│]("Код вида 1 не найден ",Статус, StringArray(0));
         else
[│###################################│########│#########################################################│](part_code.Code,Статус, StringArray(0));
         end;

         while ( StrLen(StringArray(i) ) > 0)
[│                                   │        │#########################################################│](StringArray(i));
           i = i + 1;
         end;

        elif (Вызов==Последний)         
[└───────────────────────────────────┴────────┴─────────────────────────────────────────────────────────┘];
    end;
END;
