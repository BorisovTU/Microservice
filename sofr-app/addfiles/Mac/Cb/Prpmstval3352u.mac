/*
 $Name:        Prpmstval3352u.mac
 $Module:      ││
 $Description: ▐╔Г═БЛ ╛╔╛╝Ю╓╔Ю═ 0402102 ╞╝ 3352-⌠
*/

// ▐Ю╝ёЮ═╛╛╗АБ: TDV 2014

var pr_pmvaltr:TRecHandler = TRecHandler( "pmvaltr.dbt" );
var pr_pmstval:TRecHandler = TRecHandler( "pmstval.dbt" );

import prpm_common;

private macro PrintOrderPrintData( data : TInOutOrderPrintData, ncopy : integer )

  var piListDeb :TArray = data.order.PIList(PRT_Debet).AsTArray(),
      piListCred:TArray = data.order.PIList(PRT_Credit).AsTArray();
  var isDebL = IfThenElse( piListDeb.size()  > 0, true, false ),
      isCredL= IfThenElse( piListCred.size() > 0, true, false );
     
  array ArrayBankName, ArrayOwnerName, ArrayContent, ArraySumPropis, ArrayRegDoc;
  array ArrayValuableNameValue;
  
  var err:integer = 0, 
      ListSize:integer,
      StringCounter:integer;
  GetRegistryValue( "COMMON\\▐┘≈─▓°\\▌░└┘░\\┼▌▀┬≈┘▒▓┌▌_▒▓░▌┼_█─_▒▓░─█┬√┘",   V_INTEGER, ListSize, err );

  if( err != 0 )
    ListSize = 80;
  end;      
  
  while( ncopy > 0 )
    ncopy = ncopy - 1;
    StrSplit(data.BankName, ArrayBankName, 39, 39, 3);    

    [                                 здддддддддд©                     зддддддддддддддддддддддддддддд©
        ▌Ю╓╔Ю ╞╝ ╞╔Ю╔╓═Г╔ Ф╔╜╜╝АБ╔╘ N Ё ######## Ё#####################Ё     ┼╝╓ Д╝Ю╛К ╓╝╙Ц╛╔╜Б═     Ё
                                      юддддддддддыдддддддддддддддддддддЁ       ╞╝ ▌┼⌠└ 0402102       Ё
                                                          └═Б═         юддддддддддддддддддддддддддддд╢
                                                                                                     Ё
                                                                       зддддддддддддддддддддддддддддд╢
                                                       └┘│┘▓           Ё        ▒Ц╛╛═ Ф╗ДЮ═╛╗        Ё
     █═╗╛╔╜╝╒═╜╗╔ ║═╜╙═ дддддддддддддддддддбдддддддддддддддддддддддддддеддддддддддддддддддддбдддддддд╢]
    ( substr( data.Number, 1, 12 ):c, data.DateStr:c );
    
    StringCounter = 8;
    var index = 0;
    if( isDebL == false )
    [######################################ЁАГ╔Б N ####################Ё### ################Ё        Ё
     дддддддддддддддддддддддддддддддддддддд╢                           Ё                    Ё        Ё
     ######################################Ё                           Ё                    Ё        Ё
     ддддддддддддддддддддддддддддддддддддддаддддддддддддддддддддддддддд╢                    Ё        Ё
     ######################################                            Ё                    Ё        Ё
     дддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢                    Ё        Ё]
      (ArrayBankName(0):l, data.DebAcc:l, getFIINameOrCYY(data.DFI, data.NameVal==1):l, data.DAm:r, 
       ArrayBankName(1):l, 
       ArrayBankName(2):l );
      StringCounter = StringCounter + 6; 
    else
      while( index < piListDeb.size() )
    [######################################ЁАГ╔Б N ####################Ё### ################Ё        Ё]
        (IfThenElse(index == 0,ArrayBankName(0):l,IfThenElse(index == 1,ArrayBankName(1):l,IfThenElse(index == 2,ArrayBankName(2):l,""))), piListDeb.value(index).rec.Account:l, getFIINameOrCYY(piListDeb.value(index).rec.FIID, data.NameVal==1):l, data.SplitAmount(piListDeb.value(index).rec.Amount):r );
        index = index+1;
        StringCounter = StringCounter + 1; 
        if( index != piListDeb.size() )
    [ддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддддддддд╢                    Ё        Ё];
          StringCounter = StringCounter + 1; 
        else
          if (piListDeb.size() == 2)
    [ддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддддддддд╢                    Ё        Ё
     ######################################Ё                           Ё                    Ё        Ё]
            (ArrayBankName(2):l ); 
            StringCounter = StringCounter + 2; 
          end;
    [ дддддддддддддддддддддддддддддддддддддаддддддддддддддддддддддддддд╢                    Ё        Ё];
          StringCounter = StringCounter + 1; 
        end;
      end;
    end;

    StrSplit(data.OwnerName, ArrayOwnerName, 39, 39, 3);    
    index=0;
    [                                                  ┼░┘└┬▓          Ё                    Ё        Ё
     ┼╝╛Ц ╞Ю╗╜═╓╚╔╕═Б Ф╔╜╜╝АБ╗ ддддддддддддбддддддддддддддддддддддддддд╢                    Ё        Ё];

     StringCounter = StringCounter + 2; 
      
    if( isCredL == false )
    [######################################ЁАГ╔Б N ####################Ё### ################Ё        Ё
     дддддддддддддддддддддддддддддддддддддд╢                           Ё                    Ё        Ё
     ######################################Ё                           Ё                    Ё        Ё
     ддддддддддддддддддддддддддддддддддддддадддддддддддддддддддддддддддеддддддддддддддддддддадбдддддд╢
     ######################################                            Ё≤╗ДЮ ╓╝╙Ц╛╔╜Б═        Ё  ##  Ё
     ддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддаддддддддддддддддддддддадддддды]
      (ArrayOwnerName(0):l, data.CredAcc:l, getFIINameOrCYY(data.CFI, data.NameVal==1):l, data.CredAmount:r, 
       ArrayOwnerName(1):l, 
       ArrayOwnerName(2):l, data.Sh:l );      

      StringCounter = StringCounter + 6; 
    else
      while( index < piListCred.size() )
    [######################################ЁАГ╔Б N ####################Ё### ################Ё        Ё]
        (IfThenElse(index == 0,ArrayOwnerName(0):l,IfThenElse(index == 1,ArrayOwnerName(1):l,IfThenElse(index == 2,ArrayOwnerName(2):l,""))), piListCred.value(index).rec.Account:l, getFIINameOrCYY(piListCred.value(index).rec.FIID, data.NameVal==1):l, data.SplitAmount(piListCred.value(index).rec.PmAmount):r );
        index = index+1;
        StringCounter = StringCounter + 1; 
        if( index != piListCred.size() )
    [ддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддддддддд╢                    Ё        Ё];
        StringCounter = StringCounter + 1; 
        else
          if (piListCred.size() == 2)
    [ддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддддддддд╢                    Ё        Ё
     ######################################Ё                           Ё                    Ё        Ё]
            (ArrayOwnerName(2):l ); 
            StringCounter = StringCounter + 1; 
          end;
    [ддддддддддддддддддддддддддддддддддддддадддддддддддддддддддддддддддеддддддддддддддддддддадбдддддд╢
                                                                       Ё≤╗ДЮ ╓╝╙Ц╛╔╜Б═        Ё  ##  Ё
     ддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддаддддддддддддддддддддддадддддды]
          ( data.Sh:l ); 
          StringCounter = StringCounter + 3; 
        end;
      end;
    end;

    StrSplit(data.Content, ArrayContent, 97, 77, 2);    
    
    [▒╝╓╔Ю╕═╜╗╔ ╝╞╔Ю═Ф╗╗ #############################################################################
                         ддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд
     #################################################################################################                                                                                                 
     ддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд
                                                                                                      ]
    ( ArrayContent(0):l,
      ArrayContent(1):l );
    StringCounter = StringCounter + 4; 
   
    [имммммммммммммммммммммммммммммммммммммммммммммяммммммммммммммммммммямммммммммммммммммммммммммммм╩
     ╨           █═╗╛╔╜╝╒═╜╗╔ Ф╔╜╜╝АБ╔╘            Ё     ┼╝╚╗Г╔АБ╒╝     Ё      ▒Ц╛╛═ (Ф╗ДЮ═╛╗)       ╨];
     
    StringCounter = StringCounter + 2; 

    var valuables:TArray = data.order.ValuableList.AsTArray(),
        valuable:TRecHandler,
        valuableCounter:integer = 0;
    for( valuable, valuables )
      StrSplit(valuable.rec.NameValue, ArrayValuableNameValue, 45, 45, 3);    
      valuableCounter = valuableCounter + 1;
      if (StringCounter >= (ListSize - 6))
    [хмммммммммммммммммммммммммммммммммммммммммммммоммммммммммммммммммммомммммммммммммммммммммммммммм╪
     
     имммммммммммммммммммммммммммммммммммммммммммммяммммммммммммммммммммямммммммммммммммммммммммммммм╩
     ╨           █═╗╛╔╜╝╒═╜╗╔ Ф╔╜╜╝АБ╔╘            Ё     ┼╝╚╗Г╔АБ╒╝     Ё      ▒Ц╛╛═ (Ф╗ДЮ═╛╗)       ╨];
        StringCounter = 2;
      end;
      if (valuableCounter != valuables.size)
    [гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨#############################################Ё####################Ё############################╨
     гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨#############################################Ё                    Ё                            ╨
     гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨#############################################Ё                    Ё                            ╨]
        ( ArrayValuableNameValue(0):l, valuable.rec.CountValue:c, data.SplitAmount(valuable.rec.AmountValue):c,
          ArrayValuableNameValue(1):l,
          ArrayValuableNameValue(2):l);
        StringCounter = StringCounter + 6; 
      end;
      
    end;
  
    if (StringCounter >= (ListSize - 29))
    [хмммммммммммммммммммммммммммммммммммммммммммммоммммммммммммммммммммомммммммммммммммммммммммммммм╪
     
     имммммммммммммммммммммммммммммммммммммммммммммяммммммммммммммммммммямммммммммммммммммммммммммммм╩
     ╨           █═╗╛╔╜╝╒═╜╗╔ Ф╔╜╜╝АБ╔╘            Ё     ┼╝╚╗Г╔АБ╒╝     Ё      ▒Ц╛╛═ (Ф╗ДЮ═╛╗)       ╨
     гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨#############################################Ё####################Ё############################╨
     гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨#############################################Ё                    Ё                            ╨
     гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨#############################################Ё                    Ё                            ╨]
        ( ArrayValuableNameValue(0):l, valuable.rec.CountValue:c, data.SplitAmount(valuable.rec.AmountValue):c,
          ArrayValuableNameValue(1):l,
          ArrayValuableNameValue(2):l);
    else
      if ( valuables.size == 0 )
    [гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨                                             Ё                    Ё                            ╨];
      else
    [гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨#############################################Ё####################Ё############################╨
     гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨#############################################Ё                    Ё                            ╨
     гдддддддддддддддддддддддддддддддддддддддддддддеддддддддддддддддддддедддддддддддддддддддддддддддд╤
     ╨#############################################Ё                    Ё                            ╨]
        ( ArrayValuableNameValue(0):l, valuable.rec.CountValue:c, data.SplitAmount(valuable.rec.AmountValue):c,
          ArrayValuableNameValue(1):l,
          ArrayValuableNameValue(2):l);
      end;        
    end;

    [хмммммммммммммммммммммммммммммммммммммммммммммоммммммммммммммммммммомммммммммммммммммммммммммммм╪];
    
    StrSplit(CurToStrAlt( IfThenElse( isDebL, pr_pmpaym.rec.PayAmount, pr_pmpaym.rec.Amount), null, null, 
             int( GetFICode( IfThenElse( isDebL, pr_pmpaym.rec.PayFIID, pr_pmpaym.rec.FIID ), FICK_ISONUMBER ) ) ), ArraySumPropis, 97, 82, 2);    
     
    [▒Ц╛╛═ ╞Ю╝╞╗АЛН ##################################################################################
                    дддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд
     #################################################################################################                                                                                                 
     ддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд]
    ( ArraySumPropis(0):l,
      ArraySumPropis(1):l );       

    StrSplit(data.RegDoc, ArrayRegDoc, 97, 51, 3);    
      
    [  
     дддддддддддддддддддддддддд  дддддддддддддддддддддддд  ддддддддддддддддддддддддддддддддддддддддддд
      (╜═╗╛╔╜╝╒═╜╗╔ ╓╝╚╕╜╝АБ╗)       (╚╗Г╜═О ╞╝╓╞╗АЛ)             (Д═╛╗╚╗О, ╗╜╗Ф╗═╚К)
     
     √╔╜╜╝АБ╗ ╞╔Ю╔╓═╜К:
                                                                                                      
     дддддддддддддддддддддддддд  дддддддддддддддддддддддд  ддддддддддддддддддддддддддддддддддддддддддд
      (╜═╗╛╔╜╝╒═╜╗╔ ╓╝╚╕╜╝АБ╗)       (╚╗Г╜═О ╞╝╓╞╗АЛ)             (Д═╛╗╚╗О, ╗╜╗Ф╗═╚К)
                                                           ###########################################
     дддддддддддддддддддддддддд  дддддддддддддддддддддддд  ддддддддддддддддддддддддддддддддддддддддддд
      (╜═╗╛╔╜╝╒═╜╗╔ ╓╝╚╕╜╝АБ╗)       (╚╗Г╜═О ╞╝╓╞╗АЛ)             (Д═╛╗╚╗О, ╗╜╗Ф╗═╚К)
     
     ▐Ю╔╓ЙО╒╚╔╜ ╓╝╙Ц╛╔╜Б, Ц╓╝АБ╝╒╔ЮОНИ╗╘ ╚╗Г╜╝АБЛ  ###################################################
                                                   ддддддддддддддддддддддддддддддддддддддддддддддддддд
                                                          (╜═╗╛╔╜╝╒═╜╗╔ ╓╝╙Ц╛╔╜Б═,
     #################################################################################################
     ддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд
                                    А╔Ю╗О, ╜╝╛╔Ю, ╙╔╛ ╗ ╙╝ё╓═ ╒К╓═╜)                                  
                                                                                                    ]
    ( data.FIO:c, 
      ArrayRegDoc(0):l, 
      ArrayRegDoc(1):l );
                                    
  end;
  return TRUE;
end;

macro PrintDocument( ncopy:integer ):bool
  var stat : bool = TRUE,
      data : TInOutOrderPrintData = TInOutOrderPrintData();

  if( pr_pmpaym.rec.DocKind == 288 )
    data.InitByCashOrder( pr_pmpaym, pr_pmrmprop, pr_pmstval, pr_pmvaltr );
    stat = PrintOrderPrintData( data, ncopy );
  else
    MsgBox("└═╜╜К╘ ╒╗╓ ╓╝╙Ц╛╔╜Б═ ╜╔ ╞╝╓╓╔Ю╕╗╒═╔БАО ╛═╙Ю╝А╝╛");
    stat = FALSE;
  end;

  return stat;
end;
