/*
$Name:        ws_fiunilist.mac
$Module:      WEB - ¡é¥¥
$Description: Œ ªà®á ¤«ï à¥ «¨§ æ¨¨ à ¡®âë Web-¨­â¥àä¥©á 
*/

import "ws_fiunilistclass.mac";
import "web_scroll_lib.mac";

///////////////////////////////////////////////////////////
// ®«ãç¨âì á¯¨á®ª ¯®áâà ­¨ç­®
// PageSize - à §¬¥à áâà ­¨æë
// PageNum - ­®¬¥à áâà ­¨æë €—ˆ€Ÿ ‘ 0 !!!
///////////////////////////////////////////////////////////

macro GetFIList( PageSize,
                 PageIndex,
                 fltrParm,
                 AddWhereCond,
                 listLen,
                 filterConditionItems,
                 orderitems ):TArray

  var obj = FIUNIList();

  return obj.GetList( PageSize,
                       PageIndex,
                       fltrParm,
                       AddWhereCond,
                       listLen,
                       filterConditionItems,
                       orderitems );

end;

///////////////////////////////////////////////////////////
// ®«ãç¨âì ®¡é¥¥ ª®«¨ç¥áâ¢® (¤«ï ¯ ¤¦¨­ æ¨¨)
///////////////////////////////////////////////////////////

macro GetFICount( fltrParm,
                  AddWhereCond,
                  listLen,
                  filterConditionItems,
                  orderitems):integer

  var obj = FIUNIList();

  return obj.GetCount( fltrParm,
                        AddWhereCond,
                        listLen,
                        filterConditionItems,
                        orderitems);

end;


///////////////////////////////////////////////////////////
// ‚®§¢à é ¥â á¯¨á®ª ¤«¨­­ë listLen ¯®
// ç áâ¨ç­®¬ã á®¢¯ ¤¥­¨î §­ ç¥­¨ï
///////////////////////////////////////////////////////////

macro LookupFI( fltrParm, AddWhereCond, listLen ):TArray

  var obj = FIUNIList();

  return obj.Lookup( fltrParm, AddWhereCond,listLen );

end;

////////////////////////////////////////////////
// ‚®§¢à é ¥â ­®¬¥à áâà®ª¨
////////////////////////////////////////////////

macro GetFIRowNum() : integer

  var obj = FIUNIList();

  return obj.GetRowNum();

end;

/*
 * ®«ãç¨âì ãá«®¢¨ï ¤«ï ¢áâà ¨¢ ­¨ï ¢ SQL-§ ¯à®á
 */
macro WebFI_GetQueryParam( select : @string, from : @string, where : @string, alias : string, FIID : string )

  WebScroll_AddSelect( @select, string(alias, ".t_FIID"         , " ", alias, "_FIID"      ) );
  WebScroll_AddSelect( @select, string(alias, ".t_FI_Code"      , " ", alias, "_FI_Code"   ) );
  WebScroll_AddSelect( @select, string(alias, ".t_FI_Kind"      , " ", alias, "_FI_Kind"   ) );
  WebScroll_AddSelect( @select, string(alias, ".t_Name"         , " ", alias, "_Name"      ) );
  WebScroll_AddSelect( @select, string(alias, ".t_ISO_NUMBER"   , " ", alias, "_ISO_NUMBER") );

  WebScroll_AddFrom( @from, string("dfininstr_dbt ", alias) );

  WebScroll_AddWhere( @where, string(FIID, " = ", alias, ".t_FIID(+)") );

end;

/*
 * ®«ãç¨âì ãá«®¢¨¥ á®àâ¨à®¢ª¨ ¤«ï ¢áâà ¨¢ ­¨ï ¢ SQL-§ ¯à®á
 */
macro WebFI_GetSortParam( alias : string )

  return string(alias, "_FI_Code");

end;

/*
 * ‘®§¤ âì ®¡ê¥ªâ TWsDepartment ¯® à¥§ã«ìâ â ¬ ¢ë¯®«­¥­¨ï SQL-§ ¯à®á 
 */
macro WebFI_GetObjectFromRecordset( alias : string, rs : RsdRecordset )

  var p = null;

  var IsFIIDNull : bool;

  var FIID = rs.value( string(alias, "_FIID"), IsFIIDNull );

  if( IsFIIDNull == false )

    p = TWsFinInstr();

    p.Fiid          = FIID;
    p.CodeWidget    = SQL_ConvType( rs.value(string(alias, "_FI_Code"   )) );
    p.CodeList      = SQL_ConvType( rs.value(string(alias, "_FI_Code"   )) );
    p.Kind          = SQL_ConvType( rs.value(string(alias, "_FI_Kind"   )) );
    p.Name          = SQL_ConvType( rs.value(string(alias, "_Name"      )) );
    p.ISO_Number    = SQL_ConvType( rs.value(string(alias, "_ISO_NUMBER")) );

  end;

  return p;

end;


macro GetTWsFinInstrByID(fiid : integer, codeKind ):TWsFinInstr

  var p;

  var fltrParm = TWsFinInstrFltrParm();
  
  fltrParm.FindFIID = fiid;
  fltrParm.CodeKindWidget = codeKind;

  var list = GetFIList( 0, 0, fltrParm, NULL, 0, NULL, NULL);
  
  if( (list != NULL) AND (list.size > 0) )
  
    p = list[0];

  end;
  
  return p;

end;