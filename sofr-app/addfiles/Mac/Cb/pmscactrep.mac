/*
  $Name:             pmscactrep.mac
  $Module:           РКО, ББ, МБР, АРМ
  $Description:      Универсальный отчет о групповых действиях в скроллинге платежей
*/

IMPORT  PaymInter, BankInter;

record pm_rmprop (pmrmprop);
record pm_paym   (pmpaym);

const   Ошибка   = 0,
        Первый   = 1,
        Последний= 2;

MACRO Печать_ОтчетСканирования( Вызов, firstdoc, Статус, Сообщение, Action )

  var arrWar, i = 0;

  if( Вызов== Первый )
    if( Action == PMSCACT_RECOGNIZEEXECUTED )
[                                     Отчет о групповом признании распоряжений исполнеными.                                  ];
    elif( Action == PMSCACT_ROLBACKUNLOADINGINMBR )
[                                     Отчет о групповом откате из МБР.                                                       ];
    elif( Action == PMSCACT_USERMACRO )
[                                     Отчет о групповом исполнении функции пользователя.                                     ];
    elif( Action == PMSCACT_CANCEL_PAYMENT )
[                                     Отчет о групповом анулировании.                                                        ];
    elif( Action == PMSCACT_OUTPM_KVIT )
[                                     Отчет о групповой квитовке платежей.                                                   ];
    elif( Action == PMSCACT_OUTPM_BACKKVIT )
[                                     Отчет о групповом откате квитовки платежей.                                            ];
    elif( Action == PMSCACT_REVOKEORDER )
[                                     Отчет о групповом отзыве документов.                                                   ];
    elif( Action == PMSCACT_USERSETPARAM )
[                                     Отчет о групповой пользовательской установке реквизитов.                               ];
    elif( Action == PMSCACT_PLACEININCOMPLETE )
[                                     Отчет о групповом помещении на счет незавершенных расчетов.                            ];
    end;
[┌─────────┬────────────────────┬────────────────────┬─────────────┬──────────┬──────┬──────────────────────────────────────┐];
[│  Номер  │        Счет        │        Счет        │    Сумма    │   Дата   │ Рез- │                Сообщение             │];
[│документа│    плательщика     │     получателя     │             │          │ тат  │                                      │];
[├─────────┼────────────────────┼────────────────────┼─────────────┼──────────┼──────┼──────────────────────────────────────┤];
  elif ( Вызов == Ошибка )

    arrWar = GetWarnings(true);

    if(Статус == 0)
      Сообщение = "Действие выполнено успешно.";
    end;

    while( arrWar.size > i )
      Сообщение = Сообщение + "\n" + arrWar[i].Message;
      i = i + 1;
    end;

    if ( FindPayment( GetLastDocumentID(), 
                      0,    
                      0,    
                      0,    
                      0,
                      true,   /* Поиск по реальной базе       */
                      pm_paym,
                      null,
                      null,
                      pm_rmprop
                      ) != 0 )

      Статус = 1;
      Сообщение = "Не найден платеж";
    end;
          
[│#########│####################│####################│#############│##########│######│######################################│]
(pm_rmprop.Number,pm_paym.PayerAccount,pm_paym.ReceiverAccount, pm_paym.Amount,pm_rmprop.Date, Статус, StrSubst(Сообщение, "|", " " ):w);


  elif (Вызов==Последний)
[└─────────┴────────────────────┴────────────────────┴─────────────┴──────────┴──────┴──────────────────────────────────────┘];

  end;
END;
