//-----------------------------------------------------------------------------
// Блок     : 29022 - "Акцепт в кассе"
// Шаг      : 20    - "Акцепт в кассе"
// Описание : Макрос шага
//-----------------------------------------------------------------------------
import PaymInter, cbsttls, pm_common;
var PaymentObj:RsbPayment;

MACRO ExecuteStep( doc, paymDoc )

  var note_text:string = "";


  if (not ((PaymentObj.DocKind == DLDOC_INOUTORDER) and (Opr_IsStepExecuteSymb(PaymentObj.DocumentID, PaymentObj.DocKind, "А", "X", 29022))))  
    if( УстановитьСтатусыПлатежа( OPR_PAYM_CONTROL, OPR_PAYM_ST_CTRL_CONTROL, OPR_PAYM_DO, OPR_PM_ST_ENTER, OPR_PAYM_CABS, OPR_PM_ST_MFR_YES ) )
      msgbox("Ошибка при установке сегментов статуса экземпляра операции");
      return 1;
    end;

    if( PaymentObj.Notes.AddNote( PM_NOTEKIND_DENIALGROUND, note_text ) != 0 )
      msgbox( "Ошибка при вставке примечания платежа" );
      return 1;
    end;
  end;
  if (Opr_IsStepExecuteSymb( PaymentObj.DocumentID, PaymentObj.DocKind, "А", "X", 29022))           
    if( УстановитьСтатусыПлатежа( OPR_PAYM_CONTROL, OPR_PAYM_ST_CTRL_CONTROL, OPR_PAYM_STATE, OPR_PM_ST_CLOSE ) )
      msgbox("Ошибка при установке сегментов статуса экземпляра операции");
      return 1;
    end;
  end;



  return 0;

END;
