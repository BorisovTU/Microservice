/************************************************************************/
/*         Автоматизированная банковская система RS-Bank                */
/*                 Copyright (c) R-Style Software Lab 1999              */
/*                                                                      */
/*  Имя файла        : bb_cpdup.mac                                     */
/*                                                                      */
/*  Описание         : Инициализация и проверки дубликатов              */
/*                     валютного платежного поручения                   */
/*  Программист      : Андреева Е.П.                                    */
/*                                                                      */
/*  Создан           : 18.02.2003                                       */
/*                                                                      */
/************************************************************************/

import BankInter, globals, "pm_tools.mac", PaymInter, pmbuff;

/*номера полей в панели*/
const fld_Number      = 1,
      fld_Date        = 2,
      fld_DateValue   = 3,
      fld_Amount      = 19;

macro Новый_Документ( )
  return 0;
end;


macro Проверить_Документ( Режим )

  var stat     :integer = 0,
      ret_val  :bool,
      note     :string  = "",
      res   ,
      save_note:string  = "";

  /*Проверяем номер для всех */
  if( (Режим == 2 ) or (Режим == 3) )
    if( StrLen( r_pmrmprop.Number ) == 0 )
      MsgBox("Не задан номер документа");
      return fld_Number;
    end;
    if( ({curdate} - r_pmrmprop.Date) > 10 )
      msgbox("Некорректно задана дата документа");
      return fld_Date;
    end;
    if( r_pmpaym.Amount < 0.0 )
      msgbox("Нельзя задавать отрицательную сумму");
      return fld_Amount;
    end;
  end;
  
  if( Режим == 1 ) /*УДАЛЕНИЕ ДОКУМЕНТА*/
  end;
  
  if( Режим == 2 )  /* ВВОД ДОКУМЕНТА */
    if(r_pscpord.Kind_Operation) /* Вставка документа одновременно с началом операции */
      if(r_pmpaym.ValueDate < {curdate}) /* Дата валютирования*/
        r_pmpaym.ValueDate = {curdate};
      end;
    end;
  end;
 
  if( Режим == 3 )  /* РЕДАКТИРОВАНИЕ ДОКУМЕНТА */
  end;

  return stat;
end;

macro   Проверить_Счет_В_Документе( поле ) /*0-счет плательщика, 1-счет получателя*/
        var новое_значение_счета;

        if(поле) новое_значение_счета = r_pmpaym.ReceiverAccount;
        else новое_значение_счета = r_pmpaym.PayerAccount;
        end;
        return новое_значение_счета;
end;

macro    Функция_Пользователя( Режим:integer )
 /*
 Возможные значения Режим:
  UFN_PANEL_INPUT(1) - функция вызвана из панели ввода объекта;
  UFN_PANEL_EDIT(2) - функция вызвана из панели корректировки объекта;
  UFN_SCROL(3) - функция вызвана из панели скролинга, единичный вызов, любая корректировка объекта запрещена;
  UFN_SCROL_FMASS(4) - функция вызвана из панели скролинга, работа по нескольким записям, вызов до начала обработки, любая корректировка объекта запрещена;
 
// Пример работы: 
 if( Режим == UFN_SCROL )
   return UPDTPAGE;    // Обновить страницу записей и область скролинга
   //return UPDTREC;     // Обновить текущую запись, загрузив из файла
 end;
 */
   return 0;
end;

macro УстановитьПодсказкуПоиска( СтараяПодсказка )
        return "/*+FIRST_ROWS LEADING(step) INDEX(step doprstep_dbt_idx7)*/";
end;

MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, ScrolStates:integer ):string
  return DefaultHint;
END;
