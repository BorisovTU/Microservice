/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : sfcbdrep.mac 
  Created     : 08.04.2002
  Description : Печать отчета отката удержанных комиссий

└───────────────────────────────────────────────────────────────────────────*/

import PTInter;//ПолучитьСубъекта
const   Ошибка   = 0,
        Первый   = 1,
        Последний= 2;

private macro GetPartyName(PartyID)
    var party = TRecHandler("party.dbt");
    if( ПолучитьСубъекта( PartyID, party ) == 0 )
        return party.rec.ShortName;
    else
        return "<Субъект не найден>";
    end;
end;

MACRO Печать_ОтчетСканирования (Вызов, firstdoc, Статус, Сообщение)
   array StringArray;
   var i = 1;

        RECORD sfcontr (sfcontr);

        setbuff (sfcontr, firstdoc);


    if (Вызов==Первый)
[     Отчет об откате удержанных комиссий.];
[+----------------+--------------------+--------+---------------------------------------------------------+];
[|    №           |   Плательщик       |   №    |                 Сообщение                               |];
[| договора       |                    | ошибки |                                                         |];
[+----------------+--------------------+--------+---------------------------------------------------------+];
    elif (Вызов==Ошибка)
        if (Статус == 0)
            Сообщение = "Нет ошибок"
         end;

         StrSplit(StrSubst(Сообщение, "|", " " ), StringArray, 56);
[|################|####################|########|#########################################################|](sfcontr.Number, GetPartyName(sfcontr.PartyID),Статус, StringArray(0));
         while ( StrLen(StringArray(i) ) > 0)
[|                |                    |        |#########################################################|](StringArray(i));
           i = i + 1;
         end;

        elif (Вызов==Последний)
[+----------------+--------------------+--------+---------------------------------------------------------+];
    end;
END;


