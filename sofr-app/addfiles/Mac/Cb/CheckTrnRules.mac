/**
 @file CheckTrnRules.mac
 @brief Проверка проводки при вводе на запрещенность

 # changelog
 |date       |autor          |tasks                                           |note
 |-----------|---------------|------------------------------------------------|-------------------------------------------------------------
 |           |               |                                                |

*/
import OprInter, "or_rep_h.mac", rsd, RsbDataSet, FIInter, dlmisc, "CheckTrnProhBl.mac";
RECORD  trn(acctrn);

MACRO CheckRulesForAccTrn(doc:MEMADDR, PrevTrnRulID:integer, TrnRulID:@integer, TrnRulCond:@string)
  setbuff( trn, doc );
  var ArrRules:TArray = TArray();
  var stat = 0;
  TrnRulID = 0;
  TrnRulCond = "";
  stat = GetRules(trn.Date_Carry, @ArrRules, NULL, PrevTrnRulID);
  if (not stat)
    return IIF(GetRulesForAccTrn(ArrRules, trn.AccTrnID, trn.Account_Payer, trn.Account_Receiver, trn.FIID_Payer, trn.FIID_Receiver, trn.Oper, NULL, @TrnRulID, @TrnRulCond), 1, 0);
  end;
  
  SetParm(2, TrnRulID);
  SetParm(3, TrnRulCond);

  return 0;
END;
