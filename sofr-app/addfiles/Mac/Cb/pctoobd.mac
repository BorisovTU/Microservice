 /*
 $Name: pctoobd.mac
 $Module: Подсистема "ОДБ"
 $Description: pctoobd.mac
 */
/*                                                                          */
/*                         R-Style SoftWare Lab                             */
/*                                                                          */
/****************************************************************************/
/*                       Подсистема "ОДБ"                                   */
/*                                                                          */
/*                                                                          */
/*  Имя файла: pctoobd.mac                                                  */
/*  Создан: 23.12.1998                                        Стасевич В.   */
/*                                                                          */
/****************************************************************************/
IMPORT BankInter;

Record Документ( arhdoc );
record acc( pcacc );

FILE pcacnt( pcacnt );

/* Константы */
private CONST ПроводкаПереносНаВнебаланс = 203;       /* Номер сложной проводки */

/*private CONST Актив   = 1;                              Типы остатков счетов процентов 
private CONST Пассив  = 2;

private CONST НомКатСчетПлательщик             = 1;     Номера категорий учета 
private CONST НомКатСчетПолучатель             = 2;
private CONST НомКатСчетТребованийОбязательств = 3;
private CONST НомКатСчетБудПериодов            = 4;
private CONST НомКатСчетПросрочки              = 5;
private CONST НомКатСчетНаВнебалансе           = 6;
private CONST НомКатСчетДляКорреспонденции     = 7;*/

/*------------------------------------------------------------------------*/
MACRO НайтиСчетПоКатегории( НомерКатегории )
  pcacnt.AutoPerc = acc.AutoKey;
  pcacnt.AcntCode = НомерКатегории;

  if(( GetGE( pcacnt ) )                and
     ( pcacnt.AutoPerc == acc.AutoKey ) and
     ( pcacnt.AcntCode == НомерКатегории    )     )
    return pcacnt.Account;
  else
    MsgBox("Не найдена запись по счету для категории учета:",НомерКатегории);
    return "";
  end;
END;

/*---------------------------------------------------------------------*/
MACRO СделатьДокументПереноса( СчетПроцентов, ДатаПроцедуры )
   setbuff( acc, СчетПроцентов );

   /* Заполнение общих полей */

   Документ.Chapter = 1;
   Документ.Code_Currency = acc.FIID;

   Документ.iApplicationKind = 0;
   Документ.ApplicationKey   = "";

   Документ.Date_Carry    = ДатаПроцедуры;

   Документ.Shifr_Oper = "01";
   Документ.Kind_Oper  = "1";
   Документ.Number_Pack = 994;
   Документ.Ground = string("Перенос процентов на внебаланс по счету/договору ", acc.Account );

   //if( Index( acc.UserType, МетодНачислений ) <= 0 )
   //   Документ.Account_Payer    = НайтиСчетПоКатегории(НомКатСчетБудПериодов);
   //   Документ.Account_Receiver = НайтиСчетПоКатегории(НомКатСчетТребованийОбязательств);
   //end;

   Документ.AutoKey = acc.AutoKey;
END;
