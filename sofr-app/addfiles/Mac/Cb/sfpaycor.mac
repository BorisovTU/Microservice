/*
    sfpaycor.mac

    ПЗО
    Оплата комиссий на шаге операции
    Формирование документов шага

    Корректировка параметров оплаты в зависимости от бэкофиса

        19-03-2003, Wed
*/

import SFInter, PTInter;

/*
    Возвращает  0 -- все нормально
                не 0 -- ошибка
*/
macro SfPayCorrect(
        sfcomiss,       /*  запись sfcomiss.dbt */
        date,           /*  дата взимания   */
        ground,         /*  основание   */
        paySum,         /*  сумма в валюте FIID   */
        taxSum,         /*  НДС в валюте FIID*/
        FIID,           /*  валюта сумм */
        primKind,       /*  тип первички    KIND_OF_DOC */
        primID,         /*  ID первички */

        feeType,        /*   тип взимания   SF_FEE_TYPE_... */
        some_com,       /*  если feeType == SF_FEE_TYPE_PERIOD, то здесь должна быть удержанная комиссия sfdefcom
                            а если feeType == SF_FEE_TYPE_SINGLE, то комиссия операции oprsfcom
                            ну а если feeType == SF_FEE_TYPE_ONCE, то разовая комиссия sfsingdf */
        PayMethod,      /*  метод формирования оплат SF_PAY_METHOD_... */

        sidebet,        /* sfsi.dbt -- платежная инструкция плательщика */
        sicredit,       /* sfsi.dbt -- платежная инструкция получателя  */
        Doc             /* буфер для вставки проводок в операции        */
    ) 


    if( sfcomiss.ServiceKind == PTSK_STOCKDL )
      if (feeType == SF_FEE_TYPE_PERIOD)

        if( ExecMacroFile ( "sfpaysec.mac", "СкорректироватьПараметрыОплатыКомиссийДляБОЦБ", Doc, sfcomiss, some_com, sicredit, paySum, taxSum ) == true )
           SetParm(3, paySum);
           SetParm(4, taxSum);
        else
           return 1;     
        end;
      end;

    elif(   sfcomiss.ServiceKind == PTSK_CURRDL )

// и так далее
    end; // sfcomiss.ServiceKind

    return 0;
end; // SfPayCorrect

