/************************************************************************/
/*         €¢â®¬ â¨§¨à®¢ ­­ ï ¡ ­ª®¢áª ï á¨áâ¥¬  RS-Bank                */
/*                 Copyright (c) R-Style Software Lab 2009              */
/*                                                                      */
/*  ˆ¬ï ä ©«       : prpmdmist.mac                                      */
/*                                                                      */
/*  ¯¨á ­¨¥       : ¥ç âì ¯« â¥¦­®£® âà¥¡®¢ ­¨ï á® èâ ¬¯®¬            */
/*                                                                      */
/*  à®£à ¬¬¨áâ    : Š âîè¨­ €.€.                                       */
/*                                                                      */
/*  ‘®§¤ ­         : 01.07.09                                           */
/*                                                                      */
/************************************************************************/

import prpm, gnd120p, "prpmstamp.mac";

/* ¥ç âì ¯« â¥¦­®£® âà¥¡®¢ ­¨ï ¯® 1256-“ */
MACRO PrintPayDem1256(ncopy:integer):bool
  var PayerProps   :TPartyProperties = TPartyProperties("Payer",    pr_pmpaym, pr_debet,  pr_pmrmprop);
  var ReceiverProps:TPartyProperties = TPartyProperties("Receiver", pr_pmpaym, pr_credit, pr_pmrmprop);
  var partPayList  :TPartPayList;
  var Amount;

  var ground        :string,
      AcceptTerm    :string  = "",
      AcceptPeriod  :integer = 0, 
      PayDate       :date    = date(0, 0, 0),
      I2_Date       :date    = date(0, 0, 0),
      Date_Into     :date    = date(0, 0, 0),
      chargeOffDate :date    = date(0, 0, 0),
      i             :integer;
      
  ground = InterpretGround( pr_pmrmprop.rec.Ground );
  
  if( pr_pmpaym.rec.DocKind == PS_PAYORDER )
    partPayList  = TPartPayList(pr_pspaydem.rec.OrderID);
    AcceptPeriod = pr_pspaydem.rec.AcceptPeriod;
    if( (pr_pspayord.rec.DocKind == PSPOKIND_DEMAND ) or 
        (pr_pspayord.rec.DocKind == PSPOKIND_REQUEST) )
      if(pr_pspaydem.rec.AcceptTerm == 0)
         AcceptTerm = "á  ªæ¥¯â®¬";
         PayDate    = pr_pspaydem.rec.AcceptDate;
      else
         AcceptTerm = "¡¥§  ªæ¥¯â . " + StrUpr(Trim(pr_pspaydem.rec.PayCondition), 1);
      end;
    else
      PayDate = pr_pmrmprop.rec.PayDate;
    end;
  elif( ( pr_pmdemand.rec.AcceptDate != date(0, 0, 0) ) and ( pr_pmdemand.rec.AcceptTerm == 0 ) )
    AcceptTerm = "á  ªæ¥¯â®¬";
    PayDate    = pr_pmdemand.rec.AcceptDate;
  else
    AcceptTerm = "¥§  ªæ¥¯â ";
  end;
  
  Date_Into     = pr_pmpaym.rec.PayerBankEnterDate;
  I2_Date       = pr_pmpaym.rec.I2PlaceDate;
  chargeOffDate = pr_pmrmprop.rec.PayerChargeOffDate;

  var st:TArray=TArray();

  if( pr_pmpaym.rec.DocKind == PS_PAYORDER )
    Amount = pr_pmpaym.rec.Amount;
  else
    Amount = pr_pmpaym.rec.OrderAmount;
  end;
  
  ARRAY SS, SG, SBP, SBR, SP, SR, TE, UIN;

  strsplit( AcceptTerm,             TE,    61, 61, 3 );
  strsplit( PayerProps.Name,        SP,    50, 50, 4 );
  strsplit( ReceiverProps.Name,     SR,    50, 50, 4 );
  strsplit( PayerProps.BankName,    SBP,   50, 50, 3 );
  strsplit( ReceiverProps.BankName, SBR,   50, 50, 3 );
  strsplit( ground,                 SG,    77, 77, 3 );
  strsplit( GetUIN( pr_pmrmprop.rec.Date, pr_pmrmprop.rec.UIN, pr_pmpaym.rec.PayType ), UIN, 13, 13, 2);
  
  st=Stamp();
  
  if( pr_pmpaym.rec.DocKind == PS_PAYORDER )  
    strsplit( RubToStrAlt(Amount), SS, 80, 80, 3 );
  else
    strsplit( CurToStrAlt(Amount , null, null, getISOCode(pr_pmpaym.rec.OrderFIID)), SS, 80, 80, 3 );
  end;

  while(ncopy != 0)
    [
                                                                                     ÚÄÄÄÄÄÄÄÄÄ¿
                                                                                     ³ 0401061 ³
          ############            ##########            ##########                   ÀÄÄÄÄÄÄÄÄÄÙ
       ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ   ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ  ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
       ®áâã¯. ¢ ¡ ­ª ¯« â.  ª®­ç. áà®ª   ªæ¥¯â   ‘¯¨á ­® á® áç. ¯« â.
       
                                                              ##########  ###############
       ‹€’…†… ’…‚€ˆ… N #######################         ÄÄÄÄÄÄÄÄÄÄ  ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
                                                                („ â )    (‚¨¤ ¯« â¥¦ )
     ÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄ
      “á«®¢¨¥ ³#############################################################³ ‘à®ª ¤«ï  ³ ####
      ®¯« âë  ³#############################################################³  ªæ¥¯â    ³
              ³#############################################################³           ³
     ÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄ
      ‘ã¬¬    ³ ################################################################################
      ¯à®¯¨áìî³ ################################################################################
              ³ ################################################################################
     ÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ˆ ################################################³ ‘“ŒŒ€ ³#############################
                                                          ³       ³
      ####################################################³       ³
      ####################################################ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ####################################################³ ‘ç.N. ³#############################
      ####################################################³       ³
      ‹€’…‹œ™ˆŠ                                          ³       ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ####################################################³ ˆŠ   ³#############################
      ####################################################ÃÄÄÄÄÄÄÄ´
      ####################################################³ ‘ç.N. ³#############################
      €Š ‹€’…‹œ™ˆŠ€                                    ³       ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ####################################################³ ˆŠ   ³#############################
      ####################################################ÃÄÄÄÄÄÄÄ´
      ####################################################³ ‘ç.N. ³#############################
      €Š ‹“—€’…‹Ÿ                                     ³       ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄ´
      ˆ ################################################³ ‘ç.N. ³#############################
                                                          ³       ³
                                                          ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄ
                                                          ³‚¨¤ ¯.³ #########   ³        ³
      ####################################################ÃÄÄÄÄÄÄÄ´             ³ç¥à.¯«.³ ###
      ####################################################³ §.¯«.³             ³        ³
      ####################################################ÃÄÄÄÄÄÄÄ´             ÃÄÄÄÄÄÄÄÄ´
      ####################################################³Š®¤    ³#############³¥§.¯®«¥³
      ‹“—€’…‹œ                                          ³       ³#############³        ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄ
       §­ ç¥­¨¥ ¯« â¥¦ :
      ##########################################################################################
      ##########################################################################################
      ##########################################################################################

      „ â  ®âáë«ª¨ (¢àãç¥­¨ï) ¯« â¥«ìé¨ªã ¯à¥¤ãá¬®âà¥­­ëå
      ¤®£®¢®à®¬ ¤®ªã¬¥­â®¢
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
                                     ®¤¯¨á¨                            â¬¥âª¨ ¡ ­ª  ¯®«ãç â¥«ï

          Œ..
                       ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

                       ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

                                                                                  
      ÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄ  „ â  ¯®¬¥é¥­¨ï  
      N ç. ³ N ¯« â.³   „ â      ³  ‘ã¬¬       ³   ‘ã¬¬      ³ ®¤¯¨áì   ¢ ª àâ®â¥ªã  
      ¯« â.³ ®à¤¥à  ³   ¯« â.    ³  ç áâ¨ç­®£® ³   ®áâ âª    ³           ##########
           ³        ³   ®à¤¥à    ³  ¯« â¥¦     ³   ¯« â¥¦    ³          
      ÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ â¬¥âª¨ ¡ ­ª  ¯« â¥«ìé¨ª                                                                                                 
    ]
     (Date_Into:f:c, PayDate:f:c, chargeOffDate:f:c, pr_pmrmprop.rec.Date:f:c,
      GetPaymentKind(pr_pmrmprop.rec.PaymentKind):c, pr_pmrmprop.rec.Number:l,
      TE(0), AcceptPeriod:z, TE(1), TE(2),
      SS(0):l, SS(1):l, SS(2), 
      MakeINN_KPP_String(PayerProps.INN), Amount:l:f,
      SP(0):l, SP(1):l, SP(2):l, PayerProps.Account:l, SP(3):l,
      SBP(0):l, PayerProps.BankBIC:l,    SBP(1):l, SBP(2):l, PayerProps.BankCorrAccount:l,
      SBR(0):l, ReceiverProps.BankBIC:l, SBR(1):l, SBR(2):l, ReceiverProps.BankCorrAccount:l,
      MakeINN_KPP_String(ReceiverProps.INN), ReceiverProps.Account:l,
      pr_pmrmprop.rec.ShifrOper:l, SR(0):l, pr_pmrmprop.rec.Priority:z,
      SR(1):l, SR(2):l, SR(3):l,
      UIN(0),
      UIN(1),
      SG(0):l, SG(1):l, SG(2):l, I2_Date:f, st(0):c, st(1):c, st(2):c, st(3):c, st(4):c, st(5):c, st(6):c);
    
      i = 0;
      if( pr_pmpaym.rec.DocKind == PS_PAYORDER )
      while(i < partPayList.size)
        [ #### ³ ###### ³ ########## ³ ########### ³ ########### ³         ##########################]
        ( partPayList.Value(i).SubPurp:l, 
          partPayList.Value(i).Number:l, 
          partPayList.Value(i).PayDate:f:c,
          partPayList.Value(i).Amount:l:f,
          partPayList.Value(i).Rest:l:f,
          st(i):c);
        i=i+1;
      end;
      if( partPayList.size )
        [ ÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ##########################
        ]
        (st(i):c);
        i=i+1;
      end;
    end;
    while(i < 7)
        [                                                                  ##########################]
        (st(i):c);
        i=i+1;
      end;
    [];

    ncopy = ncopy - 1;
  end;
  
  return TRUE;
  
END;

/* ¥ç âì ¯« â¥¦­®£® âà¥¡®¢ ­¨ï */
MACRO PrintPayDem(ncopy:integer):bool
  return PrintPayDem1256(ncopy);
END;
