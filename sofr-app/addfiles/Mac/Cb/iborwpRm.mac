 import rmtRSL, BankInter;

  /* Параметр SingleChannelForAllBORWPConnections задает использовать ли
     единый канал для соединения с сервером приложений БОУРМ для всех
     запускаемых макрофайлов, либо каждый макрофайл будет иметь свой канал.
     Одному каналу соответствует один процесс на сервере приложений БОУРМ.
  */
  private const SingleChannelForAllBORWPConnections:bool=true; /* один канал на всех */
//  private const SingleChannelForAllBORWPConnections:bool=false; /* персональные каналы для каждого */


  private var _RemoteRSL;
  private var CountName = 1;

  private macro Get_ExistsRemoteRSL(channelName, iniFile)
      var iniFolder:string = "";
      var Path:string = "";
      var DialogFlag;
      var err:integer = 0;
      var errObj;
      
      DialogFlag = SetDialogFlag(0);
      _RemoteRSL.host.execute(); 
      SetDialogFlag(DialogFlag);

      return _RemoteRSL;
  OnError(errObj)
      CountName = CountName + 1;
      SetDialogFlag(DialogFlag);

      _RemoteRSL.channel = NULL; 
      _RemoteRSL.host    = NULL; 
      
      GetRegistryValue("CB\\OPERATION\\CLBRECEIPT\\INI_FOLDER", V_STRING, iniFolder, err);
      if( err == 0)

      end;  
      if(iniFile != NULL)
        Path = iniFolder +"\\" + iniFile;
      else 
        Path = iniFolder +"\\iborwpRm.ini";
      end;

      DialogFlag = SetDialogFlag(0);    

      channelName = channelName + String(CountName);
      _RemoteRSL=CRemoteRSL(channelName,path,true,true);

      SetDialogFlag(DialogFlag);

      return _RemoteRSL;
  end;

  macro GetRemoteRSLForIBORWP(iniFile)
    var channelName="";
    var err:integer = 0;
    var iniFolder:string = "";
    var Path:string = "";

   if(SingleChannelForAllBORWPConnections)
     channelName="RSCOMRSLChannelForIBORWP"; 
   end;

    if(ValType(_RemoteRSL) == V_UNDEF)
       GetRegistryValue("CB\\OPERATION\\CLBRECEIPT\\INI_FOLDER", V_STRING, iniFolder, err);
       if( err == 0)

       end;  
       if(iniFile != NULL)
         Path = iniFolder +"\\" + iniFile;
       else 
         Path = iniFolder +"\\iborwpRm.ini";
       end;

       _RemoteRSL=CRemoteRSL(channelName,path,true,true);
    else
       return Get_ExistsRemoteRSL(channelName, iniFile);
    end;
    return _RemoteRSL;
  end;
