/*
$Name:             pmbudg_lib.mac
$Module:           
$Description:      Функции для работы с платежами в бюджет
*/
//------------------------------------------------------------------------------
//            Автоматизированная банковская система RS-Bank
//
//   Description : Функции для работы с платежами в бюджет
//
//   Author      : Чукина Т.А.
//
//   History     : Создан : 25.12.2013
//
//------------------------------------------------------------------------------

import likepy, BankInter;

macro IsBudgetPaymWithCheckAcc( TaxAuthorState : string, 
                                ReceiverAccount : string, 
                                PayType : string
                              ) : bool

  return (TaxAuthorState != "") and
         ( (substr(ReceiverAccount, 1, 5) == "40101")
           or
           InList(PayType, BPT_TAX, BPT_CUSTOM, BPT_OTHERS)
         );
end;

macro IsBudgetPaym( TaxAuthorState : string, PayType : string) : bool
  return ( (TaxAuthorState != "") and (PayType != 0) );
end;

macro Str0(s : string, needFillEmpty : bool) : string
  if( s )
    return s;
  elif( needFillEmpty )
    return "0";
  end;

  return s;
end;

macro GetForm110Str( pmrmprop:TRecHandler ): string

  var FillingRequisite110 = false, stat = 0;
  GetRegistryValue( "CB\\RUBDOCUMENT\\FillingRequisite110", V_BOOL, FillingRequisite110, stat );  

  if( (pmrmprop.rec.Date >= date(01,01,2015)) and 
      ((pmrmprop.rec.TaxPmType == "0") or (pmrmprop.rec.TaxPmType == "")) and
      FillingRequisite110 
    )
    return "";
  elif( pmrmprop.rec.TaxPmType == "" )
    return "0";
  else
    return pmrmprop.rec.TaxPmType;
  end;

end;
