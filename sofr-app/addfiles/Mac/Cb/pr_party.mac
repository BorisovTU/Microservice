/*
$Name:           pr_party.mac
$Module:         Ядро ГКБО
$Description:    Печать расширенной анкеты клиента
*/

Import PTInter, CTInter, FMInter, "globals.mac", "adress.mac", "pt_lib.mac", cb_sql;
import impcomm;
import RSD, oralib, likepy;
import "pr_party_lib.mac";
import "dlwreps.mac";


private const ОПФ_Категория = 4; /* Организационно-правовая форма */
private const Риск_Категория = 14; /* Уровень риска */
private const ИПДЛ_Категория = 34; /* Принадлежность к ИПДЛ */
private const ОПФИС_Категория = 85; /* Организационная форма иностранной структуры без образования юридического лица  */

private var stat;

private record client("party.dbt");
private record РП_Регистрация("objrgdoc.dbt");
private record RegParty("party.dbt");

private var ОПФ_Имя, УровеньРиска;
private var INN : string, Account_Open_Date : date, Account_Oper : integer, Account_ControlOper : integer, OKATO_OKTMO : string, OKATO : string, OKTMO : string;
private var FormDateFill  : date; /* дата заполнения анкеты */
private var FormDateModif : date; /* дата обновления анкеты */
private var FormDateStore : date; /* дата хранения анкеты   */
private var reg = " ";
private var Number = " ";
private var DeclareCapital : string, RealCapital : string;

file cbcountry_k2("country.dbt")key 2;
file cbcountry_k4("country.dbt")key 4;

private var RiskLevelNumber;


private macro GetLLValuesName( List, Element )
  record llv( "llvalues" );

  ClearRecord( llv );
  if( LL_FindLLVALUES(List, Element, llv) == 0 )
    return "-";
  end;

  return llv.Name;
end;


private macro ПечатьПриложения(ArrayProxy:TArray, BeneficiaryArray:TArray, BeneownerArray:TArray, ClientID)
  file partyf("party.dbt");

 // "<порядковый номер> <заголовок формы приложения> <системный ID субъекта> <полное наименование субъекта>"
  var Number = 0;
  var Str = "";

  if(ArrayProxy.size > 0)
    var i = 0;
    var count = 0;
    while(i<ArrayProxy.size)
      count = i;

      ClearRecord( partyf );
      partyf.PartyID = ArrayProxy(count);
      GetEQ( partyf );

      Number = Number + 1;

      // "Сведения о представителе клиента - физическом лице" 
      Str = Str + string(Number) + " представитель клиента " + partyf.PartyID + " " + partyf.Name + "\n";

      i = i + 1;
    end;
  end;

         
  if(BeneficiaryArray.size > 0)
    i = 0;
    count = 0;
    while(i<BeneficiaryArray.size)
      count = i;

      ClearRecord( partyf );
      partyf.PartyID = BeneficiaryArray(count);
      GetEQ( partyf );

      Number = Number + 1;

      // "Сведения о  выгодоприобретателе - физическом лице" 
      Str = Str + string(Number) + " выгодоприобретатель " + partyf.PartyID + " " + partyf.Name + "\n";

      i = i + 1;
    end;
  end;


  if(BeneownerArray.size > 0)
    i = 0;
    count = 0;
    while(i<BeneownerArray.size)
      count = i;

      ClearRecord( partyf );
      partyf.PartyID = BeneownerArray(count);
      GetEQ( partyf );

      Number = Number + 1;

      // "Сведения о бенефициарном владельце - физическом лице" 
      Str = Str + string(Number) + " бенефициарный владелец " + partyf.PartyID + " " + partyf.Name + "\n";

      i = i + 1;
    end;
  end;


  var rs = RsdRecordset( "select 1 from dfmpartychkhist_dbt where t_PartyID = "+ string(ClientID) );

  if( rs.moveNext() )
    Number = Number + 1;

    ClearRecord( partyf );
    partyf.PartyID = ClientID;
    GetEQ( partyf );

    Str = Str + string(Number) +" Сведения о результатах каждой проверки по Перечню ФСФМ. " + partyf.PartyID + " " + partyf.Name + "\n";
  end;

  if(Str == "")
    Str = "Приложений нет";
  end;

  return Str;
end;

/* Вспомогательные фукнции печати */

private macro ПечатьОтношенийК( ClientID, number )

  var i, j ,k;
  var tmpi = 0;
  var num = 0;
  var rs;
  var count = 0;
  var AHeadTitle = TArray();
  var ATitle     = TArray();
  var ARec       = TArray();
  var Name = "";
  var Category = "";

  rs = RsdRecordset( "SELECT T_ID, t_Category, t_Post, t_Employer, t_Address FROM DOFFCERCAT_DBT WHERE T_PARTYID = " + string(ClientID) + " ORDER BY T_ISMAIN DESC  " );

  i = 0;
//OFFCERCAT
  while( rs.moveNext() )
    Category  = rs.value("t_Category");

    Name = ПолучитьИмяКатегории( OBJTYPE_PARTY, ИПДЛ_Категория, "", Category, true );
    
    if(Name != "")
      ARec(i) = Name;
      ATitle(i) = "категория";
      AHeadTitle(i) = "Должностное лицо";

      i = i + 1;
      ARec(i) =  rs.value("t_Post"); // Должность
      ATitle(i) = "должность";
      AHeadTitle(i) = "";

      i = i + 1;
      ARec(i) =  rs.value("t_Employer"); // Наименование работодателя
      ATitle(i) = "наименование работодателя";
      AHeadTitle(i) = "";

      i = i + 1;
      ARec(i) =  rs.value("t_Address"); // Адрес работодателя 
      ATitle(i) = "адрес работодателя";
      AHeadTitle(i) = "";

      i = i + 1;
    end;
  
  end;

  if(i > 0)
    count = count + i;
  else
//    count = count + 1; // Не относится
  end;

  rs = RsdRecordset( "SELECT oc.t_PartyID, pt.t_Name as ptName, llv.t_Name as llName " +
                     " FROM DDROFFICERCAT_DBT oc, DPARTY_DBT pt, DLLVALUES_DBT llv " +
                     " WHERE pt.t_PartyID = oc.t_PartyID " +
                     " AND llv.t_List = 4008 " +
                     " AND llv.t_Element =  oc.t_Like " +
                     " AND oc.t_OfficialID = " + string(ClientID) +
                     " ORDER BY oc.t_Like"  );

  j = 0;
//DROFFICERCAT
  while( rs.moveNext() )
    ARec(j+i) = string(rs.value("t_PartyID")) + " " + rs.value("ptName");
    ATitle(j+i) = "субъект-родственник";
    AHeadTitle(j+i) = "Имеет родственника";

    j = j + 1;
    ARec(j+i) =  rs.value("llName"); 
    ATitle(j+i) = "статус, родство";
    AHeadTitle(j+i) = "";

    j = j + 1;
  end;

  if(j > 0)
    count = count + j;
  end;

  rs = RsdRecordset( "SELECT oc.t_OfficialID, pt.t_Name as ptName, llv.t_Name as llName, " +
                     "        ofc.t_Category, ofc.t_Post, ofc.t_Employer, ofc.t_Address  " +             
                     " FROM DDROFFICERCAT_DBT oc, DOFFCERCAT_DBT ofc, DPARTY_DBT pt, DLLVALUES_DBT llv " +
                     " WHERE pt.t_PartyID = oc.t_OfficialID " +
                     " AND llv.t_List = 4008 " +
                     " AND llv.t_Element =  oc.t_Like " +
                     " AND oc.t_PartyID = " + string(ClientID) +                                                            
                     " AND ofc.t_PartyID = oc.t_OfficialID "                                            
                     " ORDER BY oc.t_Like " );

  k = 0;
// OFFCERCAT
  while( rs.moveNext() )
    Category  = rs.value("t_Category");

    Name = ПолучитьИмяКатегории( OBJTYPE_PARTY, ИПДЛ_Категория, "", Category, true );
    
    if(Name != "")

      ARec(k+j+i) =  rs.value("llName"); 
      ATitle(k+j+i) = "статус, родство";
      AHeadTitle(k+j+i) = "Является родственником";

      k = k + 1;
      ARec(k+j+i) = string(rs.value("t_OfficialID")) + " " + rs.value("ptName");
      ATitle(k+j+i) = "субъект-должностное лицо";
      AHeadTitle(k+j+i) = "";

      k = k + 1;
      ARec(k+j+i) = Name;
      ATitle(k+j+i) = "категория";
      AHeadTitle(k+j+i) = "";

      k = k + 1;
      ARec(k+j+i) =  rs.value("t_Post"); // Должность
      ATitle(k+j+i) = "должность";
      AHeadTitle(k+j+i) = "";

      k = k + 1;
      ARec(k+j+i) =  rs.value("t_Employer"); // Наименование работодателя
      ATitle(k+j+i) = "наименование работодателя";
      AHeadTitle(k+j+i) = "";

      k = k + 1;
      ARec(k+j+i) =  rs.value("t_Address"); // Адрес работодателя 
      ATitle(k+j+i) = "адрес работодателя";
      AHeadTitle(k+j+i) = "";

      k = k + 1;
    end;
  
  end;

  if(k > 0)
    count = count + k;
  end;

  var TableName = 1; //-DeleteTable;
  if(count > 0)
    [~MultipleRow]; 
    println(TableName);        // идентификатор таблицы      
    println(count-1);          // Необходимое количество строк
    println("#");              // закладка для таблицы
    println(15);               // номер ряда, который необходимо размножить // 15 - ряд <idpl_head_title_>  <idpl_title_> <idpl_>
  end;

  var z = 0;
  while(z<count)
    num = z+1;
    println("~idpl_head_title_" + num);
    println(AHeadTitle(z));

    println("~idpl_title_" + num);
    println(ATitle(z));

    println("~idpl_" + num);
    println(ARec(z)); 


    z= z + 1;
  end;

  
  if(i > 0)
    z = 0;
    while (z < i)
      [~MergeCells];
      println(TableName);
      [%];
      println(1);                     // затирать текст "ненужных" ячеек
      println(number+z + "," + 1);           // начальная ячейка
      println((number+z+3) + "," + 1);       // конечная ячейка

      z = z+ 4;
    end;
  end;

  if(j > 0)
    z = i;
    while (z < i+j)
      [~MergeCells];
      println(TableName);
      [%];
      println(1);                     // затирать текст "ненужных" ячеек
      println(number+z + "," + 1);           // начальная ячейка
      println((number+z+1) + "," + 1);       // конечная ячейка

      z = z + 2;
    end;
  end;

  if(k > 0)
    z = i + j;
    while (z < i+j+k)
      [~MergeCells];
      println(TableName);
      [%];
      println(1);                     // затирать текст "ненужных" ячеек
      println(number+z + "," + 1);           // начальная ячейка
      println((number+z+5) + "," + 1);       // конечная ячейка

      z = z + 6;
    end;
  end;

  if(count == 0)
    println("~idpl_head_title_1");
    println("");

    println("~idpl_title_1");
    println("");

    println("~idpl_1");
    println("Не относится"); 

    
    [~MergeCells];
      println(TableName);
      [%];
      println(1);                     // затирать текст "ненужных" ячеек
      println(number + "," + 1);           // начальная ячейка
      println((number) + "," + 3);       // конечная ячейка
  end;

end;

// Сведения об операциях клиента
private macro ПечатьОпераций( ClientID, DeleteTable )
  var str = "",shapka;
  var i, j ,k;
  var num = 0;
  var rs;
  var count;
  array aPeriod1, aNmber1, aSum1;
  array aPeriod2, aNmber2, aSum2;

macro GetSQLstring( OprType )
  
  return "SELECT t_Quarter, t_Year, t_Quantity, t_Sum FROM dacc_chrt_dbt " + 
         "WHERE t_ClientID = " + string(ClientID) + " AND t_Type = '" + string(OprType) + "' "
         "ORDER BY t_Year, t_Quarter";

end;

  rs = RsdRecordset( GetSQLstring("О") );

  i = 0;
  while( rs.moveNext() )

    aPeriod1(i) = rs.value("t_Quarter") + " кв. " + rs.value("t_Year");
    aNmber1(i)  = rs.value("t_Quantity");
    aSum1(i)    = rs.value("t_Sum");

    i = i + 1;
  
  end;


  rs = RsdRecordset( GetSQLstring("И") );
  
  j = 0;

  while( rs.moveNext() )

    aPeriod2(j) = rs.value("t_Quarter") + " кв. " + rs.value("t_Year");
    aNmber2(j)  = rs.value("t_Quantity");
    aSum2(j)    = rs.value("t_Sum");

    j = j + 1;
  end;

  count = 0;
  if( i == 0)
    count = 1; 
    i = 1;
    aPeriod1(0) = "";
    aNmber1(0)  = "";
    aSum1(0)    = "";
  else 
    count = i;
  end;

  if( j == 0)
    count = count + 1; 
    j = 1;
    aPeriod2(0) = "";
    aNmber2(0)  = "";
    aSum2(0)    = "";
  else
    count = count + j; 
  end;

  var TableName = 8-DeleteTable;
  [~MultipleRow]; 
  println(TableName);               // идентификатор таблицы      
  println(count-1);           // Необходимое количество строк
  println("#");             // закладка для таблицы
  println(2);               // номер ряда, который необходимо размножить
//  println(1);
  k = 0;
  while(k<i)
    num = k+1;
    println("~party_opr_title_" + num);
    println("Операции, проводимые по счетам (предполагаемые клиен-том, если клиент ранее не обслуживался)" );

    println("~popr_period_" + num);
    println(aPeriod1(k));

    println("~popr_number_" + num);
    println(aNmber1(k)); 

    println("~popr_sum_" + num);
    println(aSum1(k));   

    k= k + 1;
  end;

  while(k<i+j)
    num = k+1;
    println("~party_opr_title_" + num);
    println("Источники поступления денежных средств (ожидаемые клиентом, если клиент ранее не обслуживался)" );

    println("~popr_period_" + num);
    println(aPeriod2(k-i));

    println("~popr_number_" + num);
    println(aNmber2(k-i)); 

    println("~popr_sum_" + num);
    println(aSum2(k-i));   

    k= k + 1;
  end;

  [~MergeCells];
  println(TableName);
  [%];
  println(1);                     // затирать текст "ненужных" ячеек
  println(2 + "," + 1);           // начальная ячейка
  println((i+1) + "," + 1);       // конечная ячейка

  [~MergeCells];
  println(TableName);
  [%];
  println(1);                     // затирать текст "ненужных" ячеек
  println(i+2 + "," + 1);           // начальная ячейка
  println((i+j+1) + "," + 1);       // конечная ячейка

  [~char_oper37];
  println(_sХарактОпераций);
end;

// Сведения о выгодоприобретателе
private macro ПечатьОперацийВыгодоприобретателя( ClientID, DeleteTable )
  var str = "",shapka;
  var i, k;
  var num = 0;
  var rs;
  var count;
  array aPeriod1, aNmber1, aSum1;

macro GetSQLstring() 
  return "SELECT t_Quarter, t_Year, t_Quantity, t_Sum FROM dopcontr_benefit_dbt " +
         " WHERE t_ClientID = " + string(ClientID) +
         " ORDER BY t_Year, t_Quarter DESC ;";
end;

  rs = RsdRecordset( GetSQLstring() );

  i = 0;
  while( rs.moveNext() )
    aPeriod1(i) = rs.value("t_Quarter") + " кв. " + rs.value("t_Year");
    aNmber1(i)  = rs.value("t_Quantity");
    aSum1(i)    = rs.value("t_Sum");

    i = i + 1;
  end;


  count = 0;
  if( i == 0)
    count = 1; 
    i = 1;
    aPeriod1(0) = "";
    aNmber1(0)  = "";
    aSum1(0)    = "";
  else 
    count = i;
  end;

  [~MultipleRow]; 
  println(9-DeleteTable);   // идентификатор таблицы      
  println(count-1);         // Необходимое количество строк
  println("#");             // закладка для таблицы
  println(2);               // номер ряда, который необходимо размножить
//  println(1);

  k = 0;
  while(k<i)
    num = k+1;
    println("~ben_opr_title_" + num);
    println("Операции, проводимые по счетам (предполагаемые клиен-том, если клиент ранее не обслуживался) " );

    println("~ben_period_" + num);
    println(aPeriod1(k));

    println("~ben_number_" + num);
    println(aNmber1(k)); 

    println("~ben_sum_" + num);
    println(aSum1(k));   

    k= k + 1;
  end;


  [~MergeCells];
  println(9-DeleteTable);
  [%];
  println(1);                     // затирать текст "ненужных" ячеек
  println(2 + "," + 1);           // начальная ячейка
  println((i+1) + "," + 1);       // конечная ячейка
end;


// История банкротства
private macro ПечатьИсторииБанкротства( ClientID, DeleteTable )
  var str = "",shapka;
  var i, k;
  var num = 0;
  var rs;
  var count;
  array aEventDate, aRecTypeName, aStatusName;

macro GetSQLstring() 
  return " SELECT t_EventDate, NVL(llvrt.t_Name, chr(1)) AS RecTypeName, NVL(llvst.t_Name, chr(1)) AS StatusName " +
         "   FROM dptbankrupthist_dbt bnkr, dllvalues_dbt llvrt, dllvalues_dbt llvst " +
         "  WHERE bnkr.t_RecType = llvrt.t_Element(+) " +
         "    AND  llvrt.t_List(+) = 3563 "+ /*OBJTYPE_PTBANKRUPT_TYPE*/
         "    AND  bnkr.t_BankruptStatus = llvst.t_Element(+) " +
         "    AND  llvst.t_List(+) = 3564 " + /*OBJTYPE_PTBANKRUPT_STATUS*/
         "    AND  bnkr.t_PartyID = " + string(ClientID) +
         " ORDER BY t_EventDate ";
end;

  rs = RsdRecordset( GetSQLstring() );

  i = 0;
  while( rs.moveNext() )
    aEventDate(i)   = date(rs.value("t_EventDate"));
    aRecTypeName(i) = rs.value("RecTypeName");
    aStatusName(i)  = rs.value("StatusName");

    i = i + 1;
  end;

  count = 0;
  if( i == 0)
    count = 1; 
    i = 1;
    aEventDate(0) = "";
    aRecTypeName(0)  = "";
    aStatusName(0)    = "";
  else 
    count = i;
  end;

  [~MultipleRow]; 
  println(10 - DeleteTable); // идентификатор таблицы      
  println(count-1);         // Необходимое количество строк
  println("#");             // закладка для таблицы
  println(3);               // номер ряда, который необходимо размножить
//  println(1);

  k = 0;
  while(k<i)
    num = k+1;

    println("~BnkrptDate_" + num);
    println(aEventDate(k));

    println("~BnkrptRecType_" + num);
    println(aRecTypeName(k)); 

    println("~BnkrptStatus_" + num);
    println(aStatusName(k));   

    k= k + 1;
  end;

/*
  [~MergeCells];
  println(3);
  [%];
  println(1);                     // затирать текст "ненужных" ячеек
  println(2 + "," + 1);           // начальная ячейка
  println((i+1) + "," + 1);       // конечная ячейка
*/
end;



// Сведения о результатах каждой проверки по Перечню ФСФМ 
private macro ПечатьСведенияПроверкиПоПеречнюФСФМ( ClientID )
  var str = "",shapka;
  var i, k;
  var num = 0;
  var rs;
  var count;
  
  // fmch_date fmch_lstnum fmch_lstdate fmch_terr_num_name
  array aFmchDate, aFmchLstNum, aFmchLstDate, aFmchTerrNumName;


macro GetSQLstring() 
  return "select  fmpt.t_date, fmpt.t_listnumber, fmpt.t_listdate, nvl(fmchk.t_terrnumber, 0) as terrnumber, nvl(fmchk.t_terrname,chr(1)) as terrname, nvl(fmchk.t_procvalue,0) as procvalue " +
         "  from dfmpartychkhist_dbt fmpt, dfmkfmchkhist_dbt fmchk " +
         " where fmpt.t_PartyID = " + string(ClientID) + 
         "   and fmpt.t_CheckList = 1 "
         "   and  fmpt.t_PartyID =  fmchk.t_PartyID(+) "
         "   and  fmpt.t_Date    =  fmchk.t_Date(+) "
         "  order by fmpt.t_Date DESC, fmchk.t_TerrNumber ";
end;

  var scmd = RsdCommand( GetSQLstring() );
  scmd.NullConversion = true;
  rs = RsdRecordset( scmd  );

  i = 0;
  while( rs.moveNext() )
    aFmchDate(i)   = date(rs.value("t_date"));
    aFmchLstNum(i) = rs.value("t_listnumber");
    aFmchLstDate(i)= date(rs.value("t_listdate"));

    var ProcValue  = int(rs.value("procvalue" ));
    var TerrNumber = int(rs.value("terrnumber"));
    var TerrName   = string(rs.value("terrname"  ));

    // Текст: "<значение атрибута Процент совпадения>%: № <значение атрибута Номер терро-риста> - <значение атрибута Наименование (ФИО)>".
    if ((ProcValue > 0) AND (TerrNumber > 0))
      aFmchTerrNumName(i) =  ProcValue + "%: № " + TerrNumber + " - " + TerrName;
    else
      aFmchTerrNumName(i) = "Совпадений не обнаружено";
    end;
    

    i = i + 1;
  end;


  count = 0;
  if( i == 0)
    count = 1; 
    i = 1;
    aFmchDate(0)    = "";
    aFmchLstNum(0)  = "";
    aFmchLstDate(0) = "";
    aFmchTerrNumName(0)= "";
  else 
    count = i;
  end;

  [~MultipleRow]; 
  println(1);   // идентификатор таблицы      
  println(count-1);         // Необходимое количество строк
  println("#");             // закладка для таблицы
  println(3);               // номер ряда, который необходимо размножить
//  println(1);

  // fmch_date fmch_lstnum fmch_lstdate fmch_terr_num_name
  k = 0;
  while(k<i)
    num = k+1;
    println("~fmch_date_" + num);
    println(aFmchDate(k));

    println("~fmch_lstnum_" + num);
    println(aFmchLstNum(k));

    println("~fmch_lstdate_" + num);
    println(aFmchLstDate(k)); 

    println("~fmch_terr_num_name_" + num);
    println(aFmchTerrNumName(k));   

    k= k + 1;
  end;


//  [~MergeCells];
//  println(1);
//  [%];
//  println(1);                     // затирать текст "ненужных" ячеек
//  println(2 + "," + 1);           // начальная ячейка
//  println((i+1) + "," + 1);       // конечная ячейка
end;



/* Вспомогательные функции печати */
private macro ПечатьЛицензий( PartyID )

  var strSql : string;
  var Count : integer;
  var num = 0, i = 0 ;
  var DocKind : integer;
  
  var RegNumber : string, RegDate : date;
  var rs : RsdRecordset;
  
  array _Лицензии;

  file objkdoc("objkdoc.dbt") key 0;

  RegNumber = GetCodeParty( PartyID, PTCK_BANKREGNUM );
  if( RegNumber == null ) RegNumber = ""; end;

  strSql = "SELECT objrgdoc.t_RegDocKind, objrgdoc.t_DocDate";
  strSql = strSql + " FROM dobjrgdoc_dbt objrgdoc, dobjalreg_dbt objalreg";
  strSql = strSql + " WHERE objrgdoc.t_ObjectType = " + string(OBJTYPE_PARTY);
  strSql = strSql + " AND objrgdoc.t_ObjectID = " + string(PartyID);
  strSql = strSql + " AND objrgdoc.t_RegPartyKind = " + string(REGPT_CENTRALBANK);
  strSql = strSql + " AND objalreg.t_ObjectType = objrgdoc.t_ObjectType";
  strSql = strSql + " AND objalreg.t_RegDocKind = objrgdoc.t_RegDocKind";
  strSql = strSql + " AND objalreg.t_CodeKind = " + string(PTCK_BANKREGNUM);
  strSql = strSql + " AND objrgdoc.t_IsClosed = chr(0)";
  strSql = strSql + " AND (objrgdoc.t_FinishDate =  " + To_SQLData(date(0, 0, 0)) +
                      " OR objrgdoc.t_FinishDate >= " + To_SQLData({curdate}) + ")";

  Count = 0;

  rs = RsdRecordset( strSql );

  while( rs.MoveNext() )
    
    DocKind = rs.value(0);
    RegDate = ReadDate( rs, 1 );

    ClearRecord( objkdoc );
      
    objkdoc.RegDocKind = DocKind;
    objkdoc.ObjectType = OBJTYPE_PARTY;

    if( (GetEQ(objkdoc)) and (objkdoc.Name != "Лицензия ЦБ РФ") )
      
       _Лицензии(Count) = "вид: " + objkdoc.Name + " \n" +
                          "номер: " + RegNumber + " \n" +
                          "дата выдачи: " + RegDate;
       Count = Count + 1;
    end;

  end;

  /* если нет ни одной лицензии - напечатаем пустые графы */
  if( Count == 0 )
   _Лицензии(Count) = "";
   Count = 1;
  end;

  if(Count > 1)
    [~MultipleRow]; 
    println(1);               // идентификатор таблицы      
    println(Count-1);         // Необходимое количество строк
    println("#");             // закладка для таблицы
    println(11);              // номер ряда, который необходимо размножить
  end;

  i = 0;
  while(i<Count)
    num = i+1;
    println("~licence_tbl_title_" + num);
    println("Лицензии на осуществление банковских операций" );

    println("~licence_tbl_data_" + num);
    println(_Лицензии(i));

    i= i + 1;
  end;

  if(Count > 1)
    [~MergeCells];
    println(1);
    [%];
    println(1);                      // затирать текст "ненужных" ячеек
    println(11 + "," + 1);           // начальная ячейка
    println((Count+10) + "," + 1);   // конечная ячейка
  end;


end;


private macro _GetRegBenefOwnerMinPercent()
  var stat;
  var Percent;
  GetRegistryValue("CB\\PARTY\\BENEFOWNER_MIN_PERCENT", V_INTEGER, Percent, stat);
  return Percent;
end;

/*
 *   Печать бенефициарных владельцев юридического лица
 */
private macro ПечатьБенефициарныхВладельцев( PartyID, DeleteTable, BeneownerArray:TArray )

  var strSql : string;

  var Count : integer;

  var Comment : string;
  var BeginDate : date;
  var EndDate   : date;
  var IdentRenewDate : date;

  var Code : string;
  var Name : string;
  var DecisionNumber : string;
  var DecisionDate   : date;
  var OwnPrc;
  
  var cmd : RsdCommand;
  var rs : RsdRecordset;

  strSql = "SELECT t.t_Comment, t.t_BeginDate, t.t_EndDate, t.t_IdentRenewDate, pcode.t_Code, pt.t_Name, t.t_DecisionNumber, t.t_DecisionDate, t.t_OwnPrc, t.t_BeneOwnerID "
           "FROM dptbeneowner_dbt t, dpartcode_dbt pcode, dparty_dbt pt "
           "WHERE t.t_PartyID = ? AND t.t_BeneOwnerID = pcode.t_PartyID(+) "
           " AND (t.t_OwnPrc > " + string(_GetRegBenefOwnerMinPercent()) +" OR t.t_DecisionNumber <> chr(1))"
           " AND pcode.t_CodeKind(+) = ? AND t.t_BeneOwnerID = pt.t_PartyID(+)"
           " AND t.t_BeginDate < TO_DATE('" + {CurDate} + "','DD-MM-YYYY') AND (t.t_EndDate > TO_DATE('" + {CurDate} + "','DD-MM-YYYY') OR t.t_EndDate = TO_DATE('01-01-0001','DD-MM-YYYY'))";
                      
  cmd = RsdCommand( strSql );

  cmd.nullConversion = true;

  cmd.addParam( "", RSDBP_IN, PartyID    );
  cmd.addParam( "", RSDBP_IN, PTCK_CONTR );

  rs = RsdRecordset( cmd );

  Count = 0;

  while( rs.MoveNext() )
    
    Comment = _getRSetValue( rs, "t_Comment", "" );

    BeginDate      = _getRSetValue( rs, "t_BeginDate"     , date(0, 0, 0) );
    EndDate        = _getRSetValue( rs, "t_EndDate"       , date(0, 0, 0) );
    IdentRenewDate = _getRSetValue( rs, "t_IdentRenewDate", date(0, 0, 0) );

    DecisionNumber = _getRSetValue( rs, "t_DecisionNumber", "" );
    DecisionDate   = _getRSetValue( rs, "t_DecisionDate", date(0, 0, 0) );
    OwnPrc         = _getRSetValue( rs, "t_OwnPrc", 0 );
    

    Code = _getRSetValue( rs, "t_Code", "" );
    Name = _getRSetValue( rs, "t_Name", "" );

    BeneownerArray(Count) = _getRSetValue( rs, "t_BeneOwnerID", 0 );

    if( Count > 0 )
      println;
    end;

    println("Бенефициарный владелец: ", Code, " ", Name );
    println("  решение: ", DecisionNumber, " от ", string(DecisionDate:f));
    println("  обоснование: ", Comment );
    println("  доля владения: ", OwnPrc );
    println("  идентификация: дата обновления ", string(IdentRenewDate:f) );

    Count = Count + 1;
  end;

  if( Count == 0 )
    println("Бенефициарные владельцы не определены" );
  end;

end;

/*
 *   Сведения о бенефициарном владельце
*/
private macro ПечатьБенефициарногоВладельца( BeneOwnerID )

  var strSql : string;

  var Count : integer;

  var Comment : string;
  var BeginDate : date;
  var EndDate   : date;
  var IdentRenewDate : date;

  var Code : string;
  var Name : string;

  var DecisionNumber : string;
  var DecisionDate   : date;
  var OwnPrc;

  
  var cmd : RsdCommand;
  var rs : RsdRecordset;
  
  strSql = "SELECT t.t_Comment, t.t_BeginDate, t.t_EndDate, t.t_IdentRenewDate, pcode.t_Code, pt.t_Name, t.t_DecisionNumber, t.t_DecisionDate, t.t_OwnPrc "
           "FROM dptbeneowner_dbt t, dpartcode_dbt pcode, dparty_dbt pt "
           "WHERE t.t_BeneOwnerID = ? AND t.t_PartyID = pcode.t_PartyID(+) AND pcode.t_CodeKind(+) = ? AND t.t_PartyID = pt.t_PartyID(+)"
           " AND t.t_BeginDate < TO_DATE('" + {CurDate} + "','DD-MM-YYYY') AND (t.t_EndDate > TO_DATE('" + {CurDate} + "','DD-MM-YYYY') OR t.t_EndDate = TO_DATE('01-01-0001','DD-MM-YYYY'))";

  cmd = RsdCommand( strSql );

  cmd.nullConversion = true;

  cmd.addParam( "", RSDBP_IN, BeneOwnerID );
  cmd.addParam( "", RSDBP_IN, PTCK_CONTR  );

  rs = RsdRecordset( cmd );

  Count = 0;

  while( rs.MoveNext() )
    
    Comment = _getRSetValue( rs, "t_Comment", "" );

    BeginDate      = _getRSetValue( rs, "t_BeginDate"     , date(0, 0, 0) );
    EndDate        = _getRSetValue( rs, "t_EndDate"       , date(0, 0, 0) );
    IdentRenewDate = _getRSetValue( rs, "t_IdentRenewDate", date(0, 0, 0) );

    Code = _getRSetValue( rs, "t_Code", "" );
    Name = _getRSetValue( rs, "t_Name", "" );

    DecisionNumber = _getRSetValue( rs, "t_DecisionNumber", "" );
    DecisionDate   = _getRSetValue( rs, "t_DecisionDate", date(0, 0, 0) );
    OwnPrc         = _getRSetValue( rs, "t_OwnPrc", 0 );

    if( Count > 0 )
      println;
    end;

    println("Является бенефициарным владельцем для: ", Code, " ", Name );
    println("  решение: ", DecisionNumber, " от ", string(DecisionDate:f));
    println("  обоснование: ", Comment );
    println("  доля владения: ", OwnPrc );
    println("  идентификация: дата обновления ", string(IdentRenewDate:f) );

    Count = Count + 1;

  end;

  if( Count == 0 )
    println("Бенефициарным владельцем не является" );
  end;

end;

/*
 *   Печать выгодоприобретателя
 */
private macro ПечатьВыгодоприобретателей( PartyID, BeneficiaryArray :TArray )

  var strSql : string;

  var Count : integer;

  var GroundDocName : string;
  var GroundDocNumber : string;

  var GroundDocDate : date;

  var Comment : string;
  var BeginDate : date;
  var EndDate   : date;
  var GroundDocValidity : date;
  var IdentRenewDate : date;

  var NotCompleteIdent : string;

  var Code : string;
  var Name : string;
  
  var cmd : RsdCommand;
  var rs : RsdRecordset;
  
  strSql = "SELECT t.t_GroundDocNumber, t.t_GroundDocDate, t.t_Comment, t.t_BeginDate, t.t_EndDate, t.t_IdentRenewDate, t.t_NotCompleteIdent, t.t_BeneficiaryID, "
           "       llval.t_Name llvalName, pcode.t_Code ptCode, pt.t_Name ptName, t.t_GroundDocValidity  "
           "FROM dptbeneficiary_dbt t, dllvalues_dbt llval, dpartcode_dbt pcode, dparty_dbt pt "
           "WHERE t.t_PartyID = ? "
           "  AND t.t_GroundDocKind = llval.t_Element(+) AND llval.t_List(+) = ? "
           "  AND t.t_BeneficiaryID = pcode.t_PartyID(+) AND pcode.t_CodeKind(+) = ? "
           "  AND t.t_BeneficiaryID = pt.t_PartyID(+)";

  cmd = RsdCommand( strSql );

  cmd.nullConversion = true;

  cmd.addParam( "", RSDBP_IN, PartyID    );
  cmd.addParam( "", RSDBP_IN, 3497       );
  cmd.addParam( "", RSDBP_IN, PTCK_CONTR );

  rs = RsdRecordset( cmd );

  Count = 0;

  while( rs.MoveNext() )
    
    GroundDocName   = _getRSetValue( rs, "llvalName"        , "" );
    GroundDocNumber = _getRSetValue( rs, "t_GroundDocNumber", "" );
    GroundDocDate   = _getRSetValue( rs, "t_GroundDocDate"  , date(0, 0, 0) );

    Comment = _getRSetValue( rs, "t_Comment", "" );

    BeginDate      = _getRSetValue( rs, "t_BeginDate"     , date(0, 0, 0) );
    EndDate        = _getRSetValue( rs, "t_EndDate"       , date(0, 0, 0) );
    GroundDocValidity = _getRSetValue( rs, "t_GroundDocValidity"       , date(0, 0, 0) );
    IdentRenewDate = _getRSetValue( rs, "t_IdentRenewDate", date(0, 0, 0) );

    NotCompleteIdent = _getRSetValue( rs, "t_NotCompleteIdent", "" );

    if( NotCompleteIdent == "X" ) NotCompleteIdent = "не ";
    else                          NotCompleteIdent = "";
    end;

    Code = _getRSetValue( rs, "ptCode", "" );
    Name = _getRSetValue( rs, "ptName", "" );


    BeneficiaryArray(Count) = _getRSetValue( rs, "t_BeneficiaryID", 0 );

    if( Count > 0 )
      println;
    end;

    println("Выгодоприобретатель: ", Code, " ", Name );
    println("  ", "документ: ", GroundDocName, " номер ", GroundDocNumber, " от ", string(GroundDocDate:f), " срок действия ", string(GroundDocValidity:f) );
    println("  ", "комментарий ", Comment );
//    println("  ", "действует:" , " c ", string(BeginDate:f), " по ", string(EndDate:f) );
    println("идентификация: дата обновления ", string(IdentRenewDate:f), ", идентификация ", NotCompleteIdent, "завершена" );

    Count = Count + 1;

  end;

  if( Count == 0 )
    println("Выгодоприобретателей нет" );
  end;

end;

/*
 *   Печать параметров выгодоприобретателя
 */
private macro ПечатьПараметровВыгодоприобретателя( BeneficiaryID )

  var strSql : string;

  var Count : integer;

  var GroundDocName : string;
  var GroundDocNumber : string;

  var GroundDocDate : date;

  var Comment : string;
  var BeginDate : date;
  var EndDate   : date;
  var IdentRenewDate : date;

  var NotCompleteIdent : string;

  var Code : string;
  var Name : string;
  
  var cmd : RsdCommand;
  var rs : RsdRecordset;
  
  strSql = "SELECT t.t_GroundDocNumber, t.t_GroundDocDate, t.t_Comment, t.t_BeginDate, t.t_EndDate, t.t_IdentRenewDate, t.t_NotCompleteIdent, "
           "       llval.t_Name llvalName, pcode.t_Code ptCode, pt.t_Name ptName "
           "FROM dptbeneficiary_dbt t, dllvalues_dbt llval, dpartcode_dbt pcode, dparty_dbt pt "
           "WHERE t.t_BeneficiaryID = ? "
           "  AND t.t_GroundDocKind = llval.t_Element(+) AND llval.t_List(+) = ? "
           "  AND t.t_PartyID = pcode.t_PartyID(+) AND pcode.t_CodeKind(+) = ? "
           "  AND t.t_PartyID = pt.t_PartyID(+)";

  cmd = RsdCommand( strSql );

  cmd.nullConversion = true;

  cmd.addParam( "", RSDBP_IN, BeneficiaryID );
  cmd.addParam( "", RSDBP_IN, 3497          );
  cmd.addParam( "", RSDBP_IN, PTCK_CONTR    );

  rs = RsdRecordset( cmd );

  Count = 0;

  while( rs.MoveNext() )
    
    GroundDocName   = _getRSetValue( rs, "llvalName"        , "" );
    GroundDocNumber = _getRSetValue( rs, "t_GroundDocNumber", "" );
    GroundDocDate   = _getRSetValue( rs, "t_GroundDocDate"  , date(0, 0, 0) );

    Comment = _getRSetValue( rs, "t_Comment", "" );

    BeginDate      = _getRSetValue( rs, "t_BeginDate"     , date(0, 0, 0) );
    EndDate        = _getRSetValue( rs, "t_EndDate"       , date(0, 0, 0) );
    IdentRenewDate = _getRSetValue( rs, "t_IdentRenewDate", date(0, 0, 0) );

    NotCompleteIdent = _getRSetValue( rs, "t_NotCompleteIdent", "" );

    if( NotCompleteIdent == "X" ) NotCompleteIdent = "не ";
    else                          NotCompleteIdent = "";
    end;

    Code = _getRSetValue( rs, "ptCode", "" );
    Name = _getRSetValue( rs, "ptName", "" );

    if( Count > 0 )
      println;
    end;

    println("Является выгодоприобретателем для: ", Code, " ", Name );
    println("  ", "документ: ", GroundDocName, " номер ", GroundDocNumber, " от ", string(GroundDocDate:f) );
    println("  ", "комментарий ", Comment );
    println("  ", "действует:" , " c ", string(BeginDate:f), " по ", string(EndDate:f) );
    println("идентификация: дата обновления ", string(IdentRenewDate:f), ", идентификация ", NotCompleteIdent, "завершена" );

    Count = Count + 1;

  end;

  if( Count == 0 )
    println("Выгодоприобретателем не является" );
  end;

end;


// АНКЕТА КЛИЕНТА - ЮРИДИЧЕСКОГО ЛИЦА 
macro АнкетаЮридическогоЛица_word( party, partyKind, ArrayProxy:TArray, BeneficiaryArray:TArray, BeneownerArray:TArray, NameA:@string )

  file objkdoc("objkdoc.dbt") key 0;
  
  SetBuff( client, party );
  
  ПрочитатьПримечания_str(client);
  
  PrintLn("party_ins.dot");
  PrintLn("party_prnw");
  
  ПрочитатьИдентифицирующиеCведения(client, 0);
  
  [~KillBm];

  NameA = ПолучитьНазваниеАнкеты(client.PartyID, partyKind, "") + " - юридического лица";
  
  [~pt_kind_1];
  println(ПолучитьНазваниеАнкеты(client.PartyID, partyKind, "") );
  
  [~close_party];
  if( client.Locked == "X" )
    println("СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ");
  else
    println(" ");
  end;
  
  [~pt_name_2];
  println(client.Name +"\n"+ client.ShortName +"\n"+client.LatName)  ; // PARTY

  if(IsForeignParty(client))
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФИС_Категория );
  else
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФ_Категория );
  end;

  
  [~lg_form_3];
  println(ConvEmptyStr(ОПФ_Имя));
  
  INN = ПолучитьИНН( client.PartyID );
  if(IsForeignParty(client))
    if(_sДопКодыНалог != "")
      if(INN != "")
        INN = INN + "\n";
      end;

      INN = INN +  "Доп. коды налогоплательщика: ";  
      INN = INN + _sДопКодыНалог;
    end;
  end;

  [~inn_4];
  println(ConvEmptyStr(INN));
  
  stat = Регистрация( client, РП_Регистрация, Number ); //OBJRGDOC
  if((stat == true) and ((Number != "") or (RegParty.Name != "")))
    ПолучитьСубъекта (РП_Регистрация.RegPartyID, RegParty ); 
    
    ClearRecord( objkdoc );
    objkdoc.RegDocKind = РП_Регистрация.RegDocKind;
    objkdoc.ObjectType = OBJTYPE_PARTY;
    
    GetEQ(objkdoc);
    
    reg = "Регистрационный номер:" + Number + "\n";
    reg = reg + "Дата: с " + _DefineDateByRegDateMod(РП_Регистрация.InitialDate, РП_Регистрация.StartDate, РП_Регистрация.DocDate) + " по " + РП_Регистрация.FinishDate + "\n";
    reg = reg + "Документ: "+ objkdoc.Name + "\n";
    reg = reg + "Выдан: " + RegParty.Name + "\nМесто регистрации: " + РП_Регистрация.RegPlace  ;
  end;

  if(IsForeignParty(client))
    if(_sДопРегНомера != "")
      if(reg != "")
        reg = reg + "\n";
      end;
      reg = reg +  "Доп. регистрационные номера: ";  
      reg = reg + _sДопРегНомера;
    end;
  end;
  
  [~reg_5];
  println(ConvEmptyStr(reg));
  
  [~adress_6];
  println(ConvEmptyStr(ПолучитьЮридическийАдрес(client)));
  
  [~ocato_47];
  
  OKATO = ПолучитьКод( client.PartyID, 73 );
  OKTMO = ПолучитьКод( client.PartyID, 74 );
  
  if(OKATO != "")
    
    OKATO_OKTMO = "ОКАТО: " + OKATO;
    
  else
    
    OKATO = ПолучитьКатегорию( client, 12 );
    
    if(OKATO != "")
      
      OKATO_OKTMO = "ОКАТО: " + OKATO;
    
    end;
    
  end;
  
  if(OKATO_OKTMO != "")
    
    OKATO_OKTMO = OKATO_OKTMO + " ";
    
  end;
  
  if(OKTMO != "")
    
    OKATO_OKTMO = OKATO_OKTMO + "ОКТМО: " + OKTMO;
    
  else
    
    OKTMO = ПолучитьКатегорию( client, 55 );
    
    if(OKTMO != "")
      
      OKATO_OKTMO = OKATO_OKTMO + "ОКТМО: " + OKTMO;
    
    end;
    
  end;
  
  println(OKATO_OKTMO);
  
  [~okpo_48];
  println(client.OKPO);
  
  [~licence_11];
  println(ConvEmptyStr(_sЛицензии));
  
  [~organ_19];
  println(_sОрганы);
  
  [~phone_9];
  println(ConvEmptyStr(ТелефоныФаксы( client ))); 
  
  [~business_relations_18];
  println(_sДеловОтнош);
  
  [~financial_position_19];
  println(_sФинансПоложении);
  
  [~business_reputation_20];
  println(_sДеловРепутации);
  
  [~source_of_funds_21];
  println(_sПроисхождСредств);
  
  [~beneowner_31];
  ПечатьБенефициарныхВладельцев( client.PartyID, 0, BeneownerArray );
  
  [~LastCheckTerrDate_22];
  println(ConvEmptyStr(string(client.LastCheckTerrDate:f)));
  
  var TerrListPos = "", TerrList = "", Decision = "";
  СведенияОТерроризме( client.PartyID, @TerrListPos, @TerrList, @Decision);
  
  [~TerrListPos_23];
  println(TerrListPos);  
  
  [~TerrList_24];
  println(TerrList);  
  
//  [~Decision_25];
//  println(Decision);  
  
  //УровеньРиска = ЗначениеКатегории( OBJTYPE_PARTY, client, Риск_Категория ); 
  FM_GetActualPtRiskLevel(client.PartyID, RiskLevelNumber, УровеньРиска, _sОценкаРиска);
  [~risk_level_28];
  println(УровеньРиска); 
  
  [~risk_estimate_29];
  println(_sОценкаРиска);
  
  [~risk_level_set_28];
  println(УровеньРискаУстановлен(client.PartyID));
  
  ПервыйСчет_str( client, @Account_Open_Date );
  [~acc_open_date_14];
  println(PrintDate(Account_Open_Date));
  
  [~acc_oper_15];
  println(_sAccountOper);
  
  [~acc_contr_oper_16];
  println(_sAccountControlOper);
  
  [~acc_delegate_name_17];
  println(ПолучитьСведЛицоОткрывающееСчет( client ));
  
  [~close_date_18];
  if( client.Locked == "X" )
    println(ПолучитьДатуЗакрытия(client.PartyID));
  else
    println(" ");
  end;
  
  [~pt_code_13];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_CONTR )));
  
  [~adressf_7];
  println(ConvEmptyStr(ПолучитьФактическийАдрес(client)));
  
  [~adressp_8];  
  println(ConvEmptyStr(ПолучитьПочтовыйАдрес(client)));
  
  [~code_fgsn_12];
  println(ConvEmptyStr(ПолучитьКодыФГСН( client )));
  
  [~founder_20];
  println(_sУчредители);
  
  ПолучитьКапитал( client.PartyID, @DeclareCapital, @RealCapital);
  
  [~capital_reg_21];
  println(DeclareCapital);
  
  [~capital_real_22];
  println(RealCapital);
  
  [~organ_cont_23];
  println(_sОрганыУправления);
  
  [~subdivision_24];
  println(_sПодразделения);
  
  [~kind_of_activity_25];
  println(_sВидыДеятельности);
  
  [~counteragent_26];
  println(_sПостКонтрагенты);
  
  [~history_27];
  println(_sИсторияРепутация);

  [~categ_66];
  println(GetCateg66(client));

  
  [~representative_75];
  ПечатьСведенийОПредставителях( client.PartyID, ArrayProxy );
  
  [~beneficiary_30];
  ПечатьВыгодоприобретателей( client.PartyID, BeneficiaryArray );
  
  ПечатьОпераций( client.PartyID, 0 );
  
  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);
  [~date_fill_42];
  println(FormDateFill);
  
  [~date_modif_43];
  println(FormDateModif);
  
  [~date_store_44];
  println(FormDateStore);
  
  [~employee_15];
  println(_sAccountOper);

  [~applications_2];
  println(ПечатьПриложения(ArrayProxy, BeneficiaryArray, BeneownerArray, client.PartyID));
  
  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("partyw")) );
  SetOutput(NULL, false);
end;

macro MakeCountryString(client)
    var str = "";

    if(client.NRCountry != "")
      cbcountry_k2.CODELAT3 = client.NRCountry;
      cbcountry_k2.COUNTRYID = 0;
      
      if (getGE(cbcountry_k2))
          str = cbcountry_k2.FullName;
      end;
    end;
    
    if (client.OFSHOREZONE != 0)
        cbcountry_k4.COUNTRYID = client.OFSHOREZONE;
        
        if (getEQ(cbcountry_k4))
            str = str + "(" + cbcountry_k4.FullName + ")";
        end;
    end;
    
    var strSql = "SELECT C1.T_FULLNAME AS c1, C2.T_FULLNAME AS c2 " +
      "FROM dpersncit_dbt cit, dcountry_dbt c1, dcountry_dbt c2 " +
     "WHERE     C1.T_CODELAT3 = CIT.T_COUNTRYCODELAT3 " +
     "      AND C2.T_COUNTRYID(+) = CIT.T_TERRITORYID " +
     "AND CIT.T_PERSONID = ?";

    var cmd = RsdCommand(strSql);
    cmd.nullConversion = true;
    cmd.addParam("", RSDBP_IN, client.PartyID);

    var rs = RsdRecordset(cmd);    
    while (rs.moveNext())
        if (strlen(str) > 0)
            str = str + ", ";
        end;
        
        str = str + rs.value(0);
        if (strlen(rs.value(1)) > 0)
            str = str + "(" + rs.value(1) + ")";
        end;
    end;
    return str;
end;

macro ConfwinIsEmployer()
    Array Button, Text;
    Button(0) = " предприниматель ";
    Button(1) = " клиент ";
    Text(0) = "Выберите вариант печати анкеты для физических лиц";
    var choice = ConfWin(Text, Button, 0);
    
    return choice;
end;

// АНКЕТА КЛИЕНТА - ФИЗИЧЕСКОГО ЛИЦА 
macro АнкетаФизическогоЛица_word( party, partyKind, pIsEmployer, ArrayProxy:TArray, BeneficiaryArray:TArray, BeneownerArray:TArray, NameA:@string )

  SetBuff( client, party );

  var stat;
  file persn("persn.dbt");
  file attr("objattr.dbt") key 0;
  record RecordAdress ( adress );
  record persnidc("persnidc.dbt");
  file objkdoc("objkdoc.dbt") key 0;

  array PAPER_KIND, VISA, REG_PALACE;

  var ИДПЛ;

  ClearRecord( persn );
  persn.PersonID = client.PartyID;
  GetEQ( persn );

  ПрочитатьПримечания_str(client); 

  PrintLn("party_prsn.dot");
  PrintLn("party_prnw");
  
  ПрочитатьИдентифицирующиеCведения(client, 3);
  
  var IsEmployer = "";
  if ((pIsEmployer == "X") and (persn.isemployer == "X"))
    IsEmployer = "X";
  end; 

  [~KillBm];

  [~pt_kind_1];
  var strNameA = ""; // ПолучитьНазваниеАнкеты(client.PartyID, partyKind, IsEmployer);
  var error = 0;

  if(PartyKind == 43)
     if (IsEmployer == "X") 
       strNameA = "выгодоприобретателя - предпринимателя";
     else
       strNameA = "выгодоприобретателя - физического лица";
     end;
  else
    if (IsEmployer == "X") 
     if(ВидСубъекта(client.PartyID, PTK_CLIENT, error, {OperDprt}))
       strNameA = "клиента - предпринимателя";
     else
       strNameA = "субъекта экономики - предпринимателя";
     end;
    else
     if(ВидСубъекта(client.PartyID, PTK_CLIENT, error, {OperDprt}))
       strNameA = "клиента - физического лица";
     else
       strNameA = "субъекта экономики - физического лица";
     end;
    end;
  end;

  NameA = strNameA;
  println( strNameA );

  [~close_party];
  var strNameB = "";
  if( client.Locked == "X" )
     strNameB = "СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ";
  else
     strNameB = " ";
  end;

  var BankruptStatus = 0 ;                                                  
  var rvstat = 1;
 
  if(client.LegalForm == PTLEGF_PERSN)
    rvstat = GetPartyBankruptStatus(client.PartyID, date(), @BankruptStatus); 

    if((rvstat == 0) AND (BankruptStatus != 10))
      strNameB = strNameB + " СТАТУС БАНКРОТСТВА: "+ GetLLValuesName( 3564, BankruptStatus );
    end;
  end;

  println(strNameB);

  [~persn_name_45];
  println(persn.Name1 + " " + persn.Name2 + " " + persn.Name3);

  [~born_date_46];
  println(persn.Born);

  [~born_plase_47];
  println(ПолучитьМестоРождения(client));

  [~ethnos_48];
  if(persn.IsStateless == "X")
    println("Лицо без гражданства");
  else
    println(MakeCountryString(client));
  end;
  

  [~paper_50];
  println(ПолучитьУдостоверение(persn));

  [~MigratoryDoc_9];
  println(ПолучитьМиграционнуюКарту(client));

  [~all_reg_doc_10];
  println(ПолучитьДокументНаПребывание ( client.PartyID ));

  [~adress_49];
  println(ПолучитьЮридическийАдрес(client));

  [~adress_12];
  println(ПолучитьФактическийАдрес(client));

  INN = ПолучитьИНН( client.PartyID );
  [~inn_4];
  println(INN);

  var СНИЛС = ПолучитьСНИЛС( client );
  [~snils_14];
  println(СНИЛС);

  [~phone_9];
  println(ТелефоныФаксы( client )); 

  ПечатьОтношенийК( client.PartyID, 15 );
//  [~idpl_53];
//  println(ЗначениеКатегории( OBJTYPE_PARTY, client, ИПДЛ_Категория, "Не относится", true ));

//  [~position_16];
//  println(_sДолжностьЛица);

//  [~relative_17];
//  println(_sРодствоСЛицом);

  [~business_relations_18];
  println(_sДеловОтнош);

  [~financial_position_19];
  println(_sФинансПоложении);

  [~business_reputation_20];
  println(_sДеловРепутации);
  
  [~source_of_funds_21];
  println(_sПроисхождСредств);

  [~beneowner_45];
  ПечатьБенефициарныхВладельцев( client.PartyID, 0, BeneownerArray );
////
  var DeleteTable = 0 ;
  
  if(IsEmployer == "X")

    stat = Регистрация( client, РП_Регистрация, Number ); //OBJRGDOC
    if((stat == true) and ((Number != "") or (RegParty.Name != "")))
      ПолучитьСубъекта (РП_Регистрация.RegPartyID, RegParty ); 
      
      ClearRecord( objkdoc );
      objkdoc.RegDocKind = РП_Регистрация.RegDocKind;
      objkdoc.ObjectType = OBJTYPE_PARTY;

      GetEQ(objkdoc);

      reg = "Регистрационный номер:" + Number + "\n";
      reg = reg + "Дата: с " + _DefineDateByRegDateMod(РП_Регистрация.InitialDate, РП_Регистрация.StartDate, РП_Регистрация.DocDate) + " по " + РП_Регистрация.FinishDate + "\n";
      reg = reg + "Документ: "+ objkdoc.Name + "\n";
      reg = reg + "Выдан: " + RegParty.Name + "\nМесто регистрации: " + РП_Регистрация.RegPlace  ;
    end;
    
    [~reg_5];
    println(reg);

    [~employer_54];
    println(_sВидыДеятельности);
  else
    [~DeleteRows];
    println(3 - DeleteTable);  // <идентификатор таблицы>              
    println("%");  // %                                   
    println("1");  // <номер первой удаляемой строки>     
    println("3");  // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;
////
  [~LastCheckTerrDate_22];
  println(ConvEmptyStr(string(client.LastCheckTerrDate:f)));

  var TerrListPos = "", TerrList = "", Decision = "";
  СведенияОТерроризме( client.PartyID, @TerrListPos, @TerrList, @Decision);

  [~TerrListPos_23];
  println(TerrListPos);  

  [~TerrList_24];
  println(TerrList);  

  var RequestDate; 
  var RequestNumber;

  [~FocusOnOperations_34];
  var IsFocusOnOperations = FM_GetReqInfoFocusOnOperations(client.PartyID, RequestDate, RequestNumber);

  if(IsFocusOnOperations)
    println("Физическое лицо указано в запросе № "+ RequestNumber +" от "+RequestDate+" уполномоченного органа о предоставлении дополнительной информации в рамках противодействия финансированию терроризма с необходимостью уделять повышенное внимание операциям данного физического лица");  
  else
    println(" ");  
  end;

//  [~Decision_25];
//  println(Decision);  

  //УровеньРиска = ЗначениеКатегории( OBJTYPE_PARTY, client, Риск_Категория ); 
  FM_GetActualPtRiskLevel(client.PartyID, RiskLevelNumber, УровеньРиска, _sОценкаРиска);
  [~risk_level_28];
  println(УровеньРиска); 

  [~risk_estimate_29];
  println(_sОценкаРиска);

  [~risk_level_set_28];
  println(УровеньРискаУстановлен(client.PartyID));

  ПервыйСчет_str( client, @Account_Open_Date );
  [~acc_open_date_14];
  println(PrintDate(Account_Open_Date));

  [~acc_oper_15];
  println(_sAccountOper);

  [~acc_contr_oper_16];
  println(_sAccountControlOper);

  [~acc_delegate_name_17];
  println(ПолучитьСведЛицоОткрывающееСчет( client ));

  [~close_date_18];
  if( client.Locked == "X" )
    println(ПолучитьДатуЗакрытия(client.PartyID));
  else
    println(" ");
  end;

  [~pt_code_13];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_CONTR )));

  [~place_work_51];
  println(PrintPlaceWork(persn.PersonID));

  [~freezing_40];
  СведенияОЗамораживании( client.PartyID );

  [~representative_75];     
  ПечатьСведенийОПредставителях( client.PartyID, ArrayProxy );

  [~beneficiary_30];
  ПечатьВыгодоприобретателей( client.PartyID, BeneficiaryArray );

  ПечатьОпераций( client.PartyID, DeleteTable );

  if( ВидСубъекта(client.PartyID, PTK_BENEFIT) )
    ПечатьОперацийВыгодоприобретателя( client.PartyID, DeleteTable );
    [~ground_41];
    ПечатьПараметровВыгодоприобретателя( client.PartyID );
  else
    [~DeleteRows];
    println(9 - DeleteTable);  // <идентификатор таблицы>             
    println("%");  // %                                   
    println("1");  // <номер первой удаляемой строки>     
    println("5");  // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;


  if ((rvstat == 0) AND (BankruptStatus != 10))
    ПечатьИсторииБанкротства( client.PartyID, DeleteTable );
  else
    [~DeleteRows];
    println(10 - DeleteTable); // <идентификатор таблицы>            
    println("%"); // %                                  
    println("1"); // <номер первой удаляемой строки>    
    println("3"); // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;
  
  if( ВидСубъекта(client.PartyID, 64) ) // PTK_PROXY
    [~representative_82];
    СведенияОПредставителе(client.PartyID);
  else
    [~DeleteRows];
    println(11 - DeleteTable); // <идентификатор таблицы>            
    println("%"); // %                                  
    println("1"); // <номер первой удаляемой строки>    
    println("2"); // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;

  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);
  var АнкетаОформлена : string;
  var АнкетаОбновлена : string;
  var НеобходимостьИдентификации : string = "";

  ПолучитьДатыОформленияАнкеты(client, @АнкетаОформлена, @АнкетаОбновлена, @НеобходимостьИдентификации);

  // Дата оформления, даты обновлений сведений, сведения о сотрудниках, заполнивших и обновивших сведения
  if( ВидСубъекта(client.PartyID, 64) OR ВидСубъекта(client.PartyID, PTK_BENEFIT) ) //  PTK_PROXY = 64
    [~InfoFurn_34];
    println(string(FormDateFill));

    [~InfoUpd_35];
    println(string(FormDateModif));

    [~StorLife_36];
    println(string(FormDateStore));

    [~NeedIdent_37];
    println(НеобходимостьИдентификации);
  else

    [~DeleteRows];
    println(12 - DeleteTable); // <идентификатор таблицы>            
    println("%"); // %                                  
    println("1"); // <номер первой удаляемой строки>    
    println("5"); // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;

  // Сведения о бенефициарном владельце
  /*[~beneowner_103];
  ПечатьБенефициарногоВладельца( client.PartyID );*/

/*
  if( (ВидСубъекта(client.PartyID, 68)) OR (IsEmployer == "X")) // PTK_BENEOWNER = 68
    [~beneowner_103];
    ПечатьБенефициарногоВладельца( client.PartyID );
  else
    [~DeleteRows];
    println("13");  // <идентификатор таблицы>             
    println("%");  // %                                   
    println("1");  // <номер первой удаляемой строки>     
    println("2");  // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;
*/

//  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);

/*это удаляется по 127591
  [~date_fill_42];
  println(FormDateFill);

  [~date_modif_43];
  println(FormDateModif);
*/

  [~date_store_44];
  println(FormDateStore);

/*начало - это добавляется по 127591*/
/*
  var АнкетаОформлена : string;
  var АнкетаОбновлена : string;
  var НеобходимостьИдентификации : string = "";

  ПолучитьДатыОформленияАнкеты(client, @АнкетаОформлена, @АнкетаОбновлена, @НеобходимостьИдентификации);
*/
  [~date_fill_42];
  println(АнкетаОформлена);
  
  [~date_modif_43];
  println(АнкетаОбновлена);
  
  [~employee_15];
  println(НеобходимостьИдентификации);
/*окончание - это добавляется по 127591*/

/*это удаляется по 127591
  [~employee_15];
  println(_sAccountOper);
*/

  [~applications_2];
  println(ПечатьПриложения(ArrayProxy, BeneficiaryArray, BeneownerArray, client.PartyID));

  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("partyw")) );
  SetOutput(NULL, false);
end;


// Анкета Кредитной Организации 
macro АнкетаКредитнойОрганизации_word( party, partyKind, BeneownerArray:TArray )

  file objkdoc("objkdoc.dbt") key 0;

  SetBuff( client, party );

  ПрочитатьПримечания_str(client);

  PrintLn("party_crin.dot");
  PrintLn("party_prnw");

  ПрочитатьИдентифицирующиеCведения(client, 0);

  [~KillBm];

  [~close_party];
  if( client.Locked == "X" )
    println("СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ");
  else
    println(" ");
  end;


  [~pt_name_2];
  println(client.Name +"\n"+ client.ShortName +"\n"+client.LatName)  ; // PARTY

  if(IsForeignParty(client))
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФИС_Категория );
  else
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФ_Категория );
  end;

  [~lg_form_3];
  println(ConvEmptyStr(ОПФ_Имя));

  INN = ПолучитьИНН( client.PartyID );
  [~inn_4];
  println(ConvEmptyStr(INN));

  stat = Регистрация( client, РП_Регистрация, Number ); //OBJRGDOC
  if((stat == true) and ((Number != "") or (RegParty.Name != "")))
    ПолучитьСубъекта (РП_Регистрация.RegPartyID, RegParty ); 
    
    ClearRecord( objkdoc );
    objkdoc.RegDocKind = РП_Регистрация.RegDocKind;
    objkdoc.ObjectType = OBJTYPE_PARTY;

    GetEQ(objkdoc);

    reg = "Регистрационный номер:" + Number + "\n";
    reg = reg + "Дата: с " + _DefineDateByRegDateMod(РП_Регистрация.InitialDate, РП_Регистрация.StartDate, РП_Регистрация.DocDate) + " по " + РП_Регистрация.FinishDate + "\n";
    reg = reg + "Документ: "+ objkdoc.Name + "\n";
    reg = reg + "Выдан: " + RegParty.Name + "\nМесто регистрации: " + РП_Регистрация.RegPlace  ;
  end;

  if(IsForeignParty(client))
    if(_sДопРегНомера != "")
      if(reg != "")
        reg = reg + "\n";
      end;
      reg = reg +  "Доп. регистрационные номера: ";  
      reg = reg + _sДопРегНомера;
    end;
  end;

  [~reg_5];
  println(ConvEmptyStr(reg));
  
  [~adress_6];
  println(ConvEmptyStr(ПолучитьЮридическийАдрес(client)));

  [~ocato_47];
  println(ПолучитьКатегорию( client, 12 ));

  [~okpo_48];
  println(client.OKPO);

//  [~licence_11];
//  println(ConvEmptyStr(_sЛицензии));
  ПечатьЛицензий( client.PartyID );

  [~bank_code_58];
  println(ПолучитьКод( client.PartyID, PTCK_BIC ));


  [~organ_19];
  println(_sОрганы);

  [~phone_9];
  println(ConvEmptyStr(ТелефоныФаксы( client ))); 

  [~business_relations_18];
  println(_sДеловОтнош);

  [~financial_position_19];
  println(_sФинансПоложении);

  [~business_reputation_20];
  println(_sДеловРепутации);
  
  [~source_of_funds_21];
  println(_sПроисхождСредств);

  [~beneowner_31];
  ПечатьБенефициарныхВладельцев( client.PartyID, 0, BeneownerArray );

  [~LastCheckTerrDate_22];
  println(ConvEmptyStr(string(client.LastCheckTerrDate:f)));

  var TerrListPos = "", TerrList = "", Decision = "";
  СведенияОТерроризме( client.PartyID, @TerrListPos, @TerrList, @Decision);

  [~TerrListPos_23];
  println(TerrListPos);  

  [~TerrList_24];
  println(TerrList);  

//  [~Decision_25];
//  println(Decision);  

  //УровеньРиска = ЗначениеКатегории( OBJTYPE_PARTY, client, Риск_Категория ); 
  FM_GetActualPtRiskLevel(client.PartyID, RiskLevelNumber, УровеньРиска, _sОценкаРиска);
  [~risk_level_28];
  println(УровеньРиска); 

  [~risk_estimate_29];
  println(_sОценкаРиска);

  [~risk_level_set_28];
  println(УровеньРискаУстановлен(client.PartyID));

  ПервыйСчет_str( client, @Account_Open_Date );
  [~acc_open_date_14];
  println(PrintDate(Account_Open_Date));

  [~acc_oper_15];
  println(_sAccountOper);

  [~acc_contr_oper_16];
  println(_sAccountControlOper);

  [~acc_delegate_name_17];
  println(ПолучитьСведЛицоОткрывающееСчет( client ));

  [~close_date_18];
  if( client.Locked == "X" )
    println(ПолучитьДатуЗакрытия(client.PartyID));
  else
    println(" ");
  end;

  [~pt_code_13];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_CONTR )));

  [~adressf_7];
  println(ConvEmptyStr(ПолучитьФактическийАдрес(client)));

  [~adressp_8];  
  println(ConvEmptyStr(ПолучитьПочтовыйАдрес(client)));

  [~code_fgsn_12];
  println(ConvEmptyStr(ПолучитьКодыФГСН( client )));

  [~founder_20];
  println(_sУчредители);

  ПолучитьКапитал( client.PartyID, @DeclareCapital, @RealCapital);

  [~capital_reg_21];
  println(DeclareCapital);

  [~capital_real_22];
  println(RealCapital);

  [~organ_cont_23];
  println(_sОрганыУправления);

  [~subdivision_24];
  println(_sПодразделения);

//  [~kind_of_activity_25];
//  println(_sВидыДеятельности);

  [~counteragent_26];
  println(_sПостКонтрагенты);

  [~history_27];
  println(_sИсторияРепутация);

  [~categ_66];
  println(GetCateg66(client));

/*
  [~representative_75];
  ПечатьСведенийОПредставителях( client.PartyID );

  [~beneficiary_30];
  ПечатьВыгодоприобретателей( client.PartyID );

  ПечатьОпераций( client.PartyID, 0 );
*/

  [~char_oper37];
  println(_sХарактОпераций);

  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);
  [~date_fill_42];
  println(FormDateFill);

  [~date_modif_43];
  println(FormDateModif);

  [~date_store_44];
  println(FormDateStore);

  [~employee_15];
  println(_sAccountOper);


  var ArrayProxyTemp      = TArray;
  var BeneficiaryArrayTemp= TArray;

  [~applications_2];
  println(ПечатьПриложения(ArrayProxyTemp, BeneficiaryArrayTemp, BeneownerArray, client.PartyID));

  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("partyw")) );
  SetOutput(NULL, false);
end;


/****************************************************************************************/
// Сведения о представителе клиента - физическом лице  
macro АнкетаПредставителяФизическогоЛица_word( party, partyKind/*, IsEmployer, ArrayProxy:TArray, BeneficiaryArray:TArray, BeneownerArray:TArray*/)

  Copy( client, party );

  var stat;
  file persn("persn.dbt");
  file attr("objattr.dbt") key 0;
  record RecordAdress ( adress );
  record persnidc("persnidc.dbt");

  array PAPER_KIND, VISA, REG_PALACE;

  var ИДПЛ;

  ClearRecord( persn );
  persn.PersonID = client.PartyID;
  GetEQ( persn );

  ПрочитатьПримечания_str(client); 

  PrintLn("party_prsn_rep.dot");
  PrintLn("party_prnw");
  ПрочитатьИдентифицирующиеCведения(client, -1);

  [~KillBm];

  [~close_party];
  var strNameB = "";
  if( client.Locked == "X" )
     strNameB = "СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ";
  else
     strNameB = " ";
  end;

  var BankruptStatus = 0 ;                                                  
  var rvstat = 1;
 
  if(client.LegalForm == PTLEGF_PERSN)
    rvstat = GetPartyBankruptStatus(client.PartyID, date(), @BankruptStatus); 

    if((rvstat == 0) AND (BankruptStatus != 10))
      strNameB = strNameB + " СТАТУС БАНКРОТСТВА: "+ GetLLValuesName( 3564, BankruptStatus );
    end;
  end;

  println(strNameB);

  [~persn_name_45];
  println(persn.Name1 + " " + persn.Name2 + " " + persn.Name3);

  [~born_date_46];
  println(persn.Born);

  [~born_plase_47];
  println(ПолучитьМестоРождения(client));

  [~ethnos_48];
  if(persn.IsStateless == "X")
    println("Лицо без гражданства");
  else
    println(MakeCountryString(client));
  end;

  [~paper_50];
  println(ПолучитьУдостоверение(persn));

  [~MigratoryDoc_9];
  println(ПолучитьМиграционнуюКарту(client));

  [~all_reg_doc_10];
  println(ПолучитьДокументНаПребывание ( client.PartyID ));

  [~adress_49];
  println(ПолучитьЮридическийАдрес(client));

  [~adress_12];
  println(ПолучитьФактическийАдрес(client));

  INN = ПолучитьИНН( client.PartyID );
  [~inn_4];
  println(INN);

  var СНИЛС = ПолучитьСНИЛС( client );
  [~snils_14];
  println(СНИЛС);

  [~phone_9];
  println(ТелефоныФаксы( client )); 

  [~pt_code_13];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_CONTR )));

  [~place_work_51];
  println(persn.PlaceWork);

  [~freezing_40];
  СведенияОЗамораживании( client.PartyID );

  var DeleteTable = 0 ;

  if( ВидСубъекта(client.PartyID, 64) ) // PTK_PROXY
    [~representative_82];
    СведенияОПредставителе(client.PartyID);
  else
    [~DeleteRows];
    println(11 - DeleteTable); // <идентификатор таблицы>            
    println("%"); // %                                  
    println("1"); // <номер первой удаляемой строки>    
    println("2"); // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;

  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);
  var АнкетаОформлена : string;
  var АнкетаОбновлена : string;
  var НеобходимостьИдентификации : string = "";

  ПолучитьДатыОформленияАнкеты(client, @АнкетаОформлена, @АнкетаОбновлена, @НеобходимостьИдентификации);

  // Дата оформления, даты обновлений сведений, сведения о сотрудниках, заполнивших и обновивших сведения
  if( ВидСубъекта(client.PartyID, 64) OR ВидСубъекта(client.PartyID, PTK_BENEFIT) ) //  PTK_PROXY = 64
    [~InfoFurn_34];
    println(string(FormDateFill));

    [~InfoUpd_35];
    println(string(FormDateModif));

    [~StorLife_36];
    println(string(FormDateStore));

    [~NeedIdent_37];
    println(НеобходимостьИдентификации);
  else

    [~DeleteRows];
    println(12 - DeleteTable); // <идентификатор таблицы>            
    println("%"); // %                                  
    println("1"); // <номер первой удаляемой строки>    
    println("5"); // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;



/*это удаляется по 127591
  [~date_fill_42];
  println(FormDateFill);

  [~date_modif_43];
  println(FormDateModif);
*/

  [~date_store_44];
  println(FormDateStore);

/*начало - это добавляется по 127591*/
  [~date_fill_42];
  println(АнкетаОформлена);
  
  [~date_modif_43];
  println(АнкетаОбновлена);
  
  [~employee_15];
  println(НеобходимостьИдентификации);
/*окончание - это добавляется по 127591*/

/*это удаляется по 127591
  [~employee_15];
  println(_sAccountOper);
*/


  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("partyw")) );
  SetOutput(NULL, false);
end;


// Сведения о представителе клиента - юридическом лице    
macro АнкетаПредставителяЮридическогоЛица_word( party, partyKind/*, IsEmployer, ArrayProxy:TArray, BeneficiaryArray:TArray, BeneownerArray:TArray*/)

  Copy( client, party );

  var stat;
  file persn("persn.dbt");
  file attr("objattr.dbt") key 0;
  file objkdoc("objkdoc.dbt") key 0;
  record RecordAdress ( adress );
  record persnidc("persnidc.dbt");


  array PAPER_KIND, VISA, REG_PALACE;

  var ИДПЛ;

  ClearRecord( persn );
  persn.PersonID = client.PartyID;
  GetEQ( persn );

  ПрочитатьПримечания_str(client); 

  PrintLn("party_ins_rep.dot");
  PrintLn("party_ins_rep");
  ПрочитатьИдентифицирующиеCведения(client, -1);

  [~KillBm];

  [~close_party];
  var strNameB = "";
  if( client.Locked == "X" )
     strNameB = "СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ";
  else
     strNameB = " ";
  end;

  var BankruptStatus = 0 ;                                                  
  var rvstat = 1;
 
  if(client.LegalForm == PTLEGF_PERSN)
    rvstat = GetPartyBankruptStatus(client.PartyID, date(), @BankruptStatus); 

    if((rvstat == 0) AND (BankruptStatus != 10))
      strNameB = strNameB + " СТАТУС БАНКРОТСТВА: "+ GetLLValuesName( 3564, BankruptStatus );
    end;
  end;

  println(strNameB);

  
  [~pt_name_2];
  println(client.Name +"\n"+ client.ShortName +"\n"+client.LatName)  ; // PARTY
  
  if(IsForeignParty(client))
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФИС_Категория );
  else
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФ_Категория );
  end;

  [~lg_form_3];
  println(ConvEmptyStr(ОПФ_Имя));
  
  INN = ПолучитьИНН( client.PartyID );
  if(IsForeignParty(client))
    if(_sДопКодыНалог != "")
      if(INN != "")
        INN = INN + "\n";
      end;

      INN = INN +  "Доп. коды налогоплательщика: ";  
      INN = INN + _sДопКодыНалог;
    end;
  end;

  [~inn_4];
  println(ConvEmptyStr(INN));
  
  stat = Регистрация( client, РП_Регистрация, Number ); //OBJRGDOC
  if((stat == true) and ((Number != "") or (RegParty.Name != "")))
    ПолучитьСубъекта (РП_Регистрация.RegPartyID, RegParty ); 
    
    ClearRecord( objkdoc );
    objkdoc.RegDocKind = РП_Регистрация.RegDocKind;
    objkdoc.ObjectType = OBJTYPE_PARTY;
    
    GetEQ(objkdoc);
    
    reg = "Регистрационный номер:" + Number + "\n";
    reg = reg + "Дата: с " + _DefineDateByRegDateMod(РП_Регистрация.InitialDate, РП_Регистрация.StartDate, РП_Регистрация.DocDate) + " по " + РП_Регистрация.FinishDate + "\n";
    reg = reg + "Документ: "+ objkdoc.Name + "\n";
    reg = reg + "Выдан: " + RegParty.Name + "\nМесто регистрации: " + РП_Регистрация.RegPlace  ;
  end;
  
  if(IsForeignParty(client))
    if(_sДопРегНомера != "")
      if(reg != "")
        reg = reg + "\n";
      end;
      reg = reg +  "Доп. регистрационные номера: ";  
      reg = reg + _sДопРегНомера;
    end;
  end;

  [~reg_5];
  println(ConvEmptyStr(reg));
  
  [~adress_6];
  println(ConvEmptyStr(ПолучитьЮридическийАдрес(client)));
  
  [~ocato_47];
  println(ПолучитьКатегорию( client, 12 ));
  
  [~okpo_48];
  println(client.OKPO);
  
  [~licence_11];
  println(ConvEmptyStr(_sЛицензии));
  
  [~organ_19];
  println(_sОрганы);
  
  [~phone_9];
  println(ConvEmptyStr(ТелефоныФаксы( client ))); 
  
//  [~business_relations_18];
//  println(_sДеловОтнош);
  
//  [~financial_position_19];
//  println(_sФинансПоложении);
  
//  [~business_reputation_20];
//  println(_sДеловРепутации);
  
//  [~source_of_funds_21];
//  println(_sПроисхождСредств);
  
  var BeneficiaryArrayTemp = TArray;

  [~beneowner_31];
  ПечатьБенефициарныхВладельцев( client.PartyID, 0, BeneficiaryArrayTemp );


  
  var DeleteTable = 0 ;

  if( ВидСубъекта(client.PartyID, 64) ) // PTK_PROXY
    [~representative_82];
    СведенияОПредставителе(client.PartyID);
  else
    [~DeleteRows];
    println(11 - DeleteTable); // <идентификатор таблицы>            
    println("%"); // %                                  
    println("1"); // <номер первой удаляемой строки>    
    println("2"); // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;

  [~pt_code_13];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_CONTR )));


  [~freezing_40];
  СведенияОЗамораживании( client.PartyID );

  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);

/*это удаляется по 127591
  [~date_fill_42];
  println(FormDateFill);

  [~date_modif_43];
  println(FormDateModif);
*/

  [~date_store_44];
  println(FormDateStore);

/*начало - это добавляется по 127591*/
  var АнкетаОформлена : string;
  var АнкетаОбновлена : string;
  var НеобходимостьИдентификации : string = "";

  ПолучитьДатыОформленияАнкеты(client, @АнкетаОформлена, @АнкетаОбновлена, @НеобходимостьИдентификации);
  [~date_fill_42];
  println(АнкетаОформлена);
  
  [~date_modif_43];
  println(АнкетаОбновлена);
  
  [~employee_15];
  println(НеобходимостьИдентификации);
/*окончание - это добавляется по 127591*/

/*это удаляется по 127591
  [~employee_15];
  println(_sAccountOper);
*/


  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("party_ins_rep")) );
  SetOutput(NULL, false);
end;



/****************************************************************************************/
// Сведения о  выгодоприобретателе - физическом лице  
macro АнкетаВыгодоприобретателяФизическогоЛица_word( party, partyKind/*, IsEmployer, ArrayProxy:TArray, BeneficiaryArray:TArray, BeneownerArray:TArray*/)

  Copy( client, party );

  var stat;
  file persn("persn.dbt");
  file attr("objattr.dbt") key 0;
  record RecordAdress ( adress );
  record persnidc("persnidc.dbt");

  array PAPER_KIND, VISA, REG_PALACE;

  var ИДПЛ;

  ClearRecord( persn );
  persn.PersonID = client.PartyID;
  GetEQ( persn );

  ПрочитатьПримечания_str(client); 

  PrintLn("party_prsn_ben.dot");
  PrintLn("party_prnw");

  ПрочитатьИдентифицирующиеCведения(client, -1);

  [~KillBm];

  [~close_party];
  var strNameB = "";
  if( client.Locked == "X" )
     strNameB = "СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ";
  else
     strNameB = " ";
  end;

  var BankruptStatus = 0 ;                                                  
  var rvstat = 1;
 
  if(client.LegalForm == PTLEGF_PERSN)
    rvstat = GetPartyBankruptStatus(client.PartyID, date(), @BankruptStatus); 

    if((rvstat == 0) AND (BankruptStatus != 10))
      strNameB = strNameB + " СТАТУС БАНКРОТСТВА: "+ GetLLValuesName( 3564, BankruptStatus );
    end;
  end;

  println(strNameB);

  [~persn_name_45];
  println(persn.Name1 + " " + persn.Name2 + " " + persn.Name3);

  [~born_date_46];
  println(persn.Born);

  [~born_plase_47];
  println(ПолучитьМестоРождения(client));

  [~ethnos_48];
  if(persn.IsStateless == "X")
    println("Лицо без гражданства");
  else
    println(MakeCountryString(client));
  end;

  [~paper_50];
  println(ПолучитьУдостоверение(persn));

  [~MigratoryDoc_9];
  println(ПолучитьМиграционнуюКарту(client));

  [~all_reg_doc_10];
  println(ПолучитьДокументНаПребывание ( client.PartyID ));

  [~adress_49];
  println(ПолучитьЮридическийАдрес(client));

  [~adress_12];
  println(ПолучитьФактическийАдрес(client));

  INN = ПолучитьИНН( client.PartyID );
  if(IsForeignParty(client))
    if(_sДопКодыНалог != "")
      if(INN != "")
        INN = INN + "\n";
      end;

      INN = INN +  "Доп. коды налогоплательщика: ";  
      INN = INN + _sДопКодыНалог;
    end;
  end;

  [~inn_4];
  println(ConvEmptyStr(INN));

  var СНИЛС = ПолучитьСНИЛС( client );
  [~snils_14];
  println(СНИЛС);

  [~phone_9];
  println(ТелефоныФаксы( client )); 

  [~pt_code_13];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_CONTR )));

  [~place_work_51];
  println(persn.PlaceWork);

  [~freezing_40];
  СведенияОЗамораживании( client.PartyID );

  var DeleteTable = 0 ;

  [~Beneficiary_82];
  ПечатьПараметровВыгодоприобретателя( client.PartyID );

  ПечатьОперацийВыгодоприобретателя( client.PartyID, DeleteTable );


  // Дата оформления, даты обновлений сведений, сведения о сотрудниках, заполнивших и обновивших сведения
  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);
  var АнкетаОформлена : string;
  var АнкетаОбновлена : string;
  var НеобходимостьИдентификации : string = "";

  ПолучитьДатыОформленияАнкеты(client, @АнкетаОформлена, @АнкетаОбновлена, @НеобходимостьИдентификации);

  // Дата оформления, даты обновлений сведений, сведения о сотрудниках, заполнивших и обновивших сведения
  [~InfoFurn_34];
  println(string(FormDateFill));

  [~InfoUpd_35];
  println(string(FormDateModif));

  [~StorLife_36];
  println(string(FormDateStore));

  [~NeedIdent_37];
  println(НеобходимостьИдентификации);

  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("partyw")) );
  SetOutput(NULL, false);
end;

/****************************************************************************************/
// Сведения о бенефициарном владельце - физическом лице  
macro АнкетаБенефициарногоВладельцаФизическогоЛица_word( party, partyKind/*, IsEmployer, ArrayProxy:TArray, BeneficiaryArray:TArray, BeneownerArray:TArray*/)

  Copy( client, party );

  var stat;
  file persn("persn.dbt");
  file attr("objattr.dbt") key 0;
  record RecordAdress ( adress );
  record persnidc("persnidc.dbt");

  array PAPER_KIND, VISA, REG_PALACE;

  var ИДПЛ;

  ClearRecord( persn );
  persn.PersonID = client.PartyID;
  GetEQ( persn );

  ПрочитатьПримечания_str(client); 

  PrintLn("party_prsn_beno.dot");
  PrintLn("party_prnw");
  ПрочитатьИдентифицирующиеCведения(client, -1);

  [~KillBm];

  [~close_party];
  var strNameB = "";
  if( client.Locked == "X" )
     strNameB = "СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ";
  else
     strNameB = " ";
  end;

  var BankruptStatus = 0 ;                                                  
  var rvstat = 1;
 
  if(client.LegalForm == PTLEGF_PERSN)
    rvstat = GetPartyBankruptStatus(client.PartyID, date(), @BankruptStatus); 

    if((rvstat == 0) AND (BankruptStatus != 10))
      strNameB = strNameB + " СТАТУС БАНКРОТСТВА: "+ GetLLValuesName( 3564, BankruptStatus );
    end;
  end;

  println(strNameB);

  [~persn_name_45];
  println(persn.Name1 + " " + persn.Name2 + " " + persn.Name3);

  [~born_date_46];
  println(persn.Born);

  [~born_plase_47];
  println(ПолучитьМестоРождения(client));

  [~ethnos_48];
  if(persn.IsStateless == "X")
    println("Лицо без гражданства");
  else
    println(MakeCountryString(client));
  end;

  [~paper_50];
  println(ПолучитьУдостоверение(persn));

  [~MigratoryDoc_9];
  println(ПолучитьМиграционнуюКарту(client));

  [~all_reg_doc_10];
  println(ПолучитьДокументНаПребывание ( client.PartyID ));

  [~adress_49];
  println(ПолучитьЮридическийАдрес(client));

  [~adress_12];
  println(ПолучитьФактическийАдрес(client));

  INN = ПолучитьИНН( client.PartyID );
  if(IsForeignParty(client))
    if(_sДопКодыНалог != "")
      if(INN != "")
        INN = INN + "\n";
      end;

      INN = INN +  "Доп. коды налогоплательщика: ";  
      INN = INN + _sДопКодыНалог;
    end;
  end;

  [~inn_4];
  println(ConvEmptyStr(INN));

  var СНИЛС = ПолучитьСНИЛС( client );
  [~snils_14];
  println(СНИЛС);

  [~phone_9];
  println(ТелефоныФаксы( client )); 
/*
  [~pt_code_13];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_CONTR )));

  [~place_work_51];
  println(persn.PlaceWork);

  [~freezing_40];
  СведенияОЗамораживании( client.PartyID );
*/
  var DeleteTable = 0 ;

  [~beneowner_103];
  ПечатьБенефициарногоВладельца( client.PartyID );

  // Дата оформления, даты обновлений сведений, сведения о сотрудниках, заполнивших и обновивших сведения
  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);
  var АнкетаОформлена : string;
  var АнкетаОбновлена : string;
  var НеобходимостьИдентификации : string = "";

  ПолучитьДатыОформленияАнкеты(client, @АнкетаОформлена, @АнкетаОбновлена, @НеобходимостьИдентификации);

  // Дата оформления, даты обновлений сведений, сведения о сотрудниках, заполнивших и обновивших сведения
  [~InfoFurn_34];
  println(string(FormDateFill));

  [~InfoUpd_35];
  println(string(FormDateModif));

  [~StorLife_36];
  println(string(FormDateStore));

  [~NeedIdent_37];
  println(НеобходимостьИдентификации);



  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("partyw")) );
  SetOutput(NULL, false);
end;

/**********************************************************/
// Сведения о выгодоприобретателе - юридическом лице
macro АнкетаВыгодоприобретателяЮридическогоЛица_word( party, partyKind )

  file objkdoc("objkdoc.dbt") key 0;

  copy( client, party );

  ПрочитатьПримечания_str(client);

  PrintLn("party_ins_ben.dot");
  PrintLn("party_prnw");

  ПрочитатьИдентифицирующиеCведения(client, -1);

  [~KillBm];

//  [~pt_kind_1];
//  println(ПолучитьНазваниеАнкеты(client.PartyID, partyKind, "") );

  [~close_party];
  if( client.Locked == "X" )
    println("СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ");
  else
    println(" ");
  end;

  [~pt_name_2];
  println(client.Name +"\n"+ client.ShortName +"\n"+client.LatName)  ; // PARTY

  if(IsForeignParty(client))
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФИС_Категория );
  else
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФ_Категория );
  end;

  [~lg_form_3];
  println(ConvEmptyStr(ОПФ_Имя));

  INN = ПолучитьИНН( client.PartyID );
  if(IsForeignParty(client))
    if(_sДопКодыНалог != "")
      if(INN != "")
        INN = INN + "\n";
      end;

      INN = INN +  "Доп. коды налогоплательщика: ";  
      INN = INN + _sДопКодыНалог;
    end;
  end;

  [~inn_4];
  println(ConvEmptyStr(INN));

  stat = Регистрация( client, РП_Регистрация, Number ); //OBJRGDOC
  if((stat == true) and ((Number != "") or (RegParty.Name != "")))
    ПолучитьСубъекта (РП_Регистрация.RegPartyID, RegParty ); 
    
    ClearRecord( objkdoc );
    objkdoc.RegDocKind = РП_Регистрация.RegDocKind;
    objkdoc.ObjectType = OBJTYPE_PARTY;

    GetEQ(objkdoc);

    reg = "Регистрационный номер:" + Number + "\n";
    reg = reg + "Дата: с " + _DefineDateByRegDateMod(РП_Регистрация.InitialDate, РП_Регистрация.StartDate, РП_Регистрация.DocDate) + " по " + РП_Регистрация.FinishDate + "\n";
    reg = reg + "Документ: "+ objkdoc.Name + "\n";
    reg = reg + "Выдан: " + RegParty.Name + "\nМесто регистрации: " + РП_Регистрация.RegPlace  ;
  end;

  if(IsForeignParty(client))
    if(_sДопРегНомера != "")
      if(reg != "")
        reg = reg + "\n";
      end;
      reg = reg +  "Доп. регистрационные номера: ";  
      reg = reg + _sДопРегНомера;
    end;
  end;

  [~reg_5];
  println(ConvEmptyStr(reg));
  
  [~adress_6];
  println(ConvEmptyStr(ПолучитьЮридическийАдрес(client)));

  [~ocato_47];
  println(ПолучитьКатегорию( client, 12 ));

  var BeneficiaryArrayTemp = TArray;

  [~beneowner_31];
  ПечатьБенефициарныхВладельцев( client.PartyID, 0, BeneficiaryArrayTemp );

  [~Beneficiary_82];
  ПечатьПараметровВыгодоприобретателя( client.PartyID );

  var DeleteTable = 0;
  ПечатьОперацийВыгодоприобретателя( client.PartyID, DeleteTable );

  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);
  [~date_fill_42];
  println(FormDateFill);

  [~date_modif_43];
  println(FormDateModif);

  [~date_store_44];
  println(FormDateStore);

  [~employee_15];
  println(_sAccountOper);

  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("partyw")) );
  SetOutput(NULL, false);
end;



// Анкета клиента - иностранной структуры без образования юридического лица 
// Анкета субъекта - иностранной структуры без образования юридического лица
macro АнкетаCубъектаИностраннойСтруктурыЛица_word( party, partyKind, IsEmployer, ArrayProxy:TArray, BeneficiaryArray:TArray, BeneownerArray:TArray, NameA:@string )

  SetBuff( client, party );

  var stat;
  file persn("persn.dbt");
  file attr("objattr.dbt") key 0;
  record RecordAdress ( adress );
  record persnidc("persnidc.dbt");
  file objkdoc("objkdoc.dbt") key 0;

  array PAPER_KIND, VISA, REG_PALACE;

  var ИДПЛ;

  ClearRecord( persn );
  persn.PersonID = client.PartyID;
  GetEQ( persn );

  ПрочитатьПримечания_str(client); 

  PrintLn("party_foreign.dot");
  PrintLn("party_foreign");
  ПрочитатьИдентифицирующиеCведения(client, -1);

  [~KillBm];

  [~pt_kind_1];
  var strNameA = ""; // ПолучитьНазваниеАнкеты(client.PartyID, partyKind, IsEmployer);
  var error = 0;

  if(ВидСубъекта(client.PartyID, PTK_CLIENT, error, {OperDprt}))
    strNameA = "Анкета клиента - иностранной структуры без образования юридического лица";
    NameA = "клиента - иностранной структуры без образования юридического лица";
  else
    strNameA = "Анкета субъекта - иностранной структуры без образования юридического лица";
    NameA = "субъекта - иностранной структуры без образования юридического лица";
  end;

  println( strNameA );

  [~close_party];
  var strNameB = "";
  if( client.Locked == "X" )
     strNameB = "СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ";
  else
     strNameB = " ";
  end;

  var BankruptStatus = 0 ;                                                  
  var rvstat = 1;
 
  if(client.LegalForm == PTLEGF_PERSN)
    rvstat = GetPartyBankruptStatus(client.PartyID, date(), @BankruptStatus); 

    if((rvstat == 0) AND (BankruptStatus != 10))
      strNameB = strNameB + " СТАТУС БАНКРОТСТВА: "+ GetLLValuesName( 3564, BankruptStatus );
    end;
  end;

  println(strNameB);

  [~pt_name_2];
  println(client.Name +"\n"+ client.ShortName +"\n"+client.LatName)  ; // PARTY
  
  if(IsForeignParty(client))
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФИС_Категория );
  else
    ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client, ОПФ_Категория );
  end;

  [~lg_form_3];
  println(ConvEmptyStr(ОПФ_Имя));
  
  INN = ПолучитьИНН( client.PartyID );
  if(IsForeignParty(client))
    if(_sДопКодыНалог != "")
      if(INN != "")
        INN = INN + "\n";
      end;

      INN = INN +  "Доп. коды налогоплательщика: ";  
      INN = INN + _sДопКодыНалог;
    end;
  end;

  [~inn_4];
  println(ConvEmptyStr(INN));

  [~taxpayer_code_14];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_FOREIGN_INN )));
    
  stat = Регистрация( client, РП_Регистрация, Number ); //OBJRGDOC
  if((stat == true) and ((Number != "") or (RegParty.Name != "")))
    ПолучитьСубъекта (РП_Регистрация.RegPartyID, RegParty ); 
    
    ClearRecord( objkdoc );
    objkdoc.RegDocKind = РП_Регистрация.RegDocKind;
    objkdoc.ObjectType = OBJTYPE_PARTY;
    
    GetEQ(objkdoc);
    
    reg = "Регистрационный номер:" + Number + "\n";
    reg = reg + "Дата: с " + _DefineDateByRegDateMod(РП_Регистрация.InitialDate, РП_Регистрация.StartDate, РП_Регистрация.DocDate) + " по " + РП_Регистрация.FinishDate + "\n";
    reg = reg + "Документ: "+ objkdoc.Name + "\n";
    reg = reg + "Выдан: " + RegParty.Name + "\nМесто регистрации: " + РП_Регистрация.RegPlace  ;
  end;

  if(IsForeignParty(client))
    if(_sДопРегНомера != "")
      if(reg != "")
        reg = reg + "\n";
      end;
      reg = reg +  "Доп. регистрационные номера: ";  
      reg = reg + _sДопРегНомера;
    end;
  end;  

  [~reg_5];
  println(ConvEmptyStr(reg));
  
  [~state_rn_52];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_STATEREGNUM )));

  [~adress_6];
  println(ConvEmptyStr(ПолучитьЮридическийАдрес(client)));
  
  [~ocato_47];
  println(ПолучитьКатегорию( client, 12 ));

  [~place_business_57];
  println(_sМестоОсновнойДеят);   

  [~okpo_48];
  println(client.OKPO);
  
  [~licence_11];
  println(ConvEmptyStr(_sЛицензии));
  
  [~organ_19];
  println(_sОрганы);
  
  [~phone_9];
  println(ConvEmptyStr(ТелефоныФаксы( client ))); 
  
  [~business_relations_18];
  println(ConvEmptyStr(_sДеловОтнош));
  
  [~financial_position_19];
  println(ConvEmptyStr(_sФинансПоложении));
  
  [~business_reputation_20];
  println(ConvEmptyStr(_sДеловРепутации));
  
  [~source_of_funds_21];
  println(ConvEmptyStr(_sПроисхождСредств));

  [~beneowner_45];
  ПечатьБенефициарныхВладельцев( client.PartyID, 0, BeneownerArray );

  [~part_prop_109];
  println(_sИмуществоБОЮЛ);

////
  var DeleteTable = 0 ;
  
//  if(IsEmployer == "X")  ??
    [~reg_5];
    println(reg);

    [~employer_54];
    println(_sВидыДеятельности);
/*
  else
    [~DeleteRows];
    println(3 - DeleteTable);  // <идентификатор таблицы>              
    println("%");  // %                                   
    println("1");  // <номер первой удаляемой строки>     
    println("3");  // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;
*/
////

  [~LastCheckTerrDate_22];
  println(ConvEmptyStr(string(client.LastCheckTerrDate:f)));

  var TerrListPos = "", TerrList = "", Decision = "";
  СведенияОТерроризме( client.PartyID, @TerrListPos, @TerrList, @Decision);

  [~TerrListPos_23];
  println(TerrListPos);  

  [~TerrList_24];
  println(TerrList);  

//  [~Decision_25];
//  println(Decision);  

  //УровеньРиска = ЗначениеКатегории( OBJTYPE_PARTY, client, Риск_Категория ); 
  FM_GetActualPtRiskLevel(client.PartyID, RiskLevelNumber, УровеньРиска, _sОценкаРиска);
  [~risk_level_28];
  println(УровеньРиска); 

  [~risk_estimate_29];
  println(_sОценкаРиска);

  [~risk_level_set_28];
  println(УровеньРискаУстановлен(client.PartyID));

  ПервыйСчет_str( client, @Account_Open_Date );
  [~acc_open_date_14];
  println(PrintDate(Account_Open_Date));

  [~acc_oper_15];
  println(_sAccountOper);

  [~acc_contr_oper_16];
  println(_sAccountControlOper);

  [~acc_delegate_name_17];
  println(ПолучитьСведЛицоОткрывающееСчет( client ));

  [~close_date_18];
  if( client.Locked == "X" )
    println(ПолучитьДатуЗакрытия(client.PartyID));
  else
    println(" ");
  end;

  [~pt_code_13];
  println(ConvEmptyStr(ПолучитьКод( client.PartyID, PTCK_CONTR )));
  
  [~adressf_7];
  println(ConvEmptyStr(ПолучитьФактическийАдрес(client)));
  
  [~adressp_8];  
  println(ConvEmptyStr(ПолучитьПочтовыйАдрес(client)));
  
  [~code_fgsn_12];
  println(ConvEmptyStr(ПолучитьКодыФГСН( client )));
  
  [~founder_20];
  println(_sУчредители);
  
  ПолучитьКапитал( client.PartyID, @DeclareCapital, @RealCapital);
  
  [~capital_reg_21];
  println(DeclareCapital);
  
  [~capital_real_22];
  println(RealCapital);
  
  [~organ_cont_23];
  println(_sОрганыУправления);
  
  [~subdivision_24];
  println(_sПодразделения);
  
  [~kind_of_activity_25];
  println(_sВидыДеятельности);
  
  [~counteragent_26];
  println(_sПостКонтрагенты);
  
  [~history_27];
  println(_sИсторияРепутация);

  [~categ_66];
  println(GetCateg66(client));

  [~representative_75];
  ПечатьСведенийОПредставителях( client.PartyID, ArrayProxy );
  
  [~beneficiary_30];
  ПечатьВыгодоприобретателей( client.PartyID, BeneficiaryArray );

  ПечатьОпераций( client.PartyID, DeleteTable );

  if( ВидСубъекта(client.PartyID, PTK_BENEFIT) )
    ПечатьОперацийВыгодоприобретателя( client.PartyID, DeleteTable );
    [~ground_41];
    ПечатьПараметровВыгодоприобретателя( client.PartyID );
  else
    [~DeleteRows];
    println(9 - DeleteTable);  // <идентификатор таблицы>             
    println("%");  // %                                   
    println("1");  // <номер первой удаляемой строки>     
    println("5");  // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;

  // Дата оформления, даты обновлений сведений, сведения о сотрудниках, заполнивших и обновивших сведения
  ПолучитьДатыАнкеты(client, @FormDateFill, @FormDateModif, @FormDateStore);
  var АнкетаОформлена : string;
  var АнкетаОбновлена : string;
  var НеобходимостьИдентификации : string = "";

  ПолучитьДатыОформленияАнкеты(client, @АнкетаОформлена, @АнкетаОбновлена, @НеобходимостьИдентификации);

  // Дата оформления, даты обновлений сведений, сведения о сотрудниках, заполнивших и обновивших сведения
//  if( ВидСубъекта(client.PartyID, 64) OR ВидСубъекта(client.PartyID, PTK_BENEFIT) ) //  PTK_PROXY = 64

    if(string(FormDateFill) == "" )
      [~DeleteRows];
      println(10 - DeleteTable); // <идентификатор таблицы>            
      println("%"); // %                                  
      println("2"); // <номер первой удаляемой строки>    
      println("2"); // <номер последней удаляемой строки >
    end;

    [~InfoFurn_34];
    println(string(FormDateFill));

    [~InfoUpd_35];
    println(string(FormDateModif));

    [~StorLife_36];
    println(string(FormDateStore));

    [~NeedIdent_37];
    println(НеобходимостьИдентификации);
/*  else

    [~DeleteRows];
    println(12 - DeleteTable); // <идентификатор таблицы>            
    println("%"); // %                                  
    println("1"); // <номер первой удаляемой строки>    
    println("5"); // <номер последней удаляемой строки >

    DeleteTable = DeleteTable + 1;
  end;
*/

  [~applications_2];
  println(ПечатьПриложения(ArrayProxy, BeneficiaryArray, BeneownerArray, client.PartyID));

  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("party_foreign")) );
  SetOutput(NULL, false);
end;


private macro AppHead(party, partyKind, Number, strNameA)

  file persn("persn.dbt");

  [~AppHead_1];
  println( "Приложение " + string(Number));
  println( "к анкете " + strNameA );
  println( client.PartyID +" "+ client.Name );
end;

/****************************************************************************************/
// Сведения о результатах каждой проверки по Перечню ФСФМ
macro АнкетаСведенийПроверкиПоПеречнюФСФМ_word( party, partyKind, Number, strNameA)

  Copy( client, party );

  var stat;
  file persn("persn.dbt");
  file attr("objattr.dbt") key 0;
  record RecordAdress ( adress );
  record persnidc("persnidc.dbt");

  ClearRecord( persn );
  persn.PersonID = client.PartyID;
  GetEQ( persn );

  ПрочитатьПримечания_str(client); 

  PrintLn("party_prsn_fm.dot");
  PrintLn("party_prsn_fm");
  ПрочитатьИдентифицирующиеCведения(client, -1);
  [~KillBm];

  AppHead(client, partyKind, Number, strNameA);

  ПечатьСведенияПроверкиПоПеречнюФСФМ( client.PartyID );

  DLWREPS_PrintReportFromTagFile( SetOutput (GetTxtFileName ("party_prsn_fm")) );
  SetOutput(NULL, false);
end;



/*
 *  АНКЕТА КЛИЕНТА - ЮРИДИЧЕСКОГО ЛИЦА 
 */

macro АнкетаЮридическогоЛица( party, partyKind )
  file partyf("party.dbt");
  file persn("persn.dbt");

  var ArrayProxy = TArray;
  var BeneficiaryArray  = TArray;
  var BeneownerArray = TArray;
  var NameA = "";

  SetBuff( client, party );
  var ObjCat = RsbObjCategories( OBJTYPE_PARTY, UniID( client, OBJTYPE_PARTY ));

  if(ObjCat.IsAttrPresense(16, null, "", "11", true, {curdate}))
    АнкетаCубъектаИностраннойСтруктурыЛица_word( party, partyKind, "", ArrayProxy, BeneficiaryArray, BeneownerArray, @NameA);
  else
    АнкетаЮридическогоЛица_word( party, partyKind, ArrayProxy, BeneficiaryArray, BeneownerArray, @NameA);
  end;


  var Number = 0;

  if(ArrayProxy.size > 0)
    var i = 0;
    var count = 0;
    while(i<ArrayProxy.size)
      count = i;

      Number = Number + 1;

      ClearRecord( partyf );
      partyf.PartyID = ArrayProxy(count);
      GetEQ( partyf );

      if(partyf.LegalForm == PTLEGF_PERSN)
        АнкетаПредставителяФизическогоЛица_word( partyf, 64);  // PTK_PROXY = 64
      else
        АнкетаПредставителяЮридическогоЛица_word( partyf, 64 );
      end;

      i = i + 1;
    end;
  end;


  if(BeneficiaryArray.size > 0)
    i = 0;
    count = 0;
    while(i<BeneficiaryArray.size)
      count = i;

      Number = Number + 1;

      ClearRecord( partyf );
      partyf.PartyID = BeneficiaryArray(count);
      GetEQ( partyf );

      АнкетаВыгодоприобретателяЮридическогоЛица_word( partyf, PTK_BENEFIT);  

      i = i + 1;
    end;
  end;

  var IsEmployer = "";

  if(BeneownerArray.size > 0)
    i = 0;
    count = 0;
    while(i<BeneownerArray.size)
      count = i;

      Number = Number + 1;

      ClearRecord( persn );
      persn.PersonID = BeneownerArray(count);
      GetEQ( persn );

      ClearRecord( partyf );
      partyf.PartyID = BeneownerArray(count);
      GetEQ( partyf );

      IsEmployer = "";
      if(persn.IsEmployer == "X")
          IsEmployer = "X";
      end;

      АнкетаБенефициарногоВладельцаФизическогоЛица_word( partyf, 68, IsEmployer);  // PTK_BENEOWNER = 68

      i = i + 1;
    end;
  end;

  var rs = RsdRecordset( "select 1 from dfmpartychkhist_dbt where t_PartyID = "+ string(client.PartyID) );

  if( rs.moveNext() )
     Number = Number + 1;

     АнкетаСведенийПроверкиПоПеречнюФСФМ_word( party, partyKind, Number, NameA);
  end;

  exit(1);
end;



/****************************************************************************************/

/*
 *  АНКЕТА КЛИЕНТА - ФИЗИЧЕСКОГО ЛИЦА 
 */

macro АнкетаФизическогоЛица( party, partyKind, IsEmployerB )

  var IsEmployer = "";
  Array Text;
  Array Buttons;
  var choice = 0;
  var NameA = "";

  var ArrayProxy = TArray;
  var BeneficiaryArray = TArray;
  var BeneownerArray = TArray;
  
  file persn("persn.dbt");
  record client("party.dbt");
  file partyf("party.dbt");

  if(IsEmployerB)
    IsEmployer = "X"
  end;

  SetBuff( client, party );
/*
  ClearRecord( persn );
  persn.PersonID = client.PartyID;
  GetEQ( persn );

  if(persn.IsEmployer == "X")
    if(partyKind != 43)
      Text(0) = "Для предпринимателя печатать анкету в форме:"; 

      Buttons(0) = " для физических лиц ";
      Buttons(1) = " для предпринимателей";

      choice = ConfWin(Text,Buttons, 27);

      if(choice == 1)
         IsEmployer = "X";
      end;
    else
      IsEmployer = "X";
    end;
  end;
*/
//  if(choice != 27)
    АнкетаФизическогоЛица_word( party, partyKind, IsEmployer, ArrayProxy, BeneficiaryArray, BeneownerArray, @NameA);

    if(ArrayProxy.size > 0)
      var i = 0;
      var count = 0;
      while(i<ArrayProxy.size)
        count = i;

        Number = Number + 1;
/*
        ClearRecord( persn );
        persn.PersonID = ArrayProxy(count);
        GetEQ( persn );
*/
        ClearRecord( partyf );
        partyf.PartyID = ArrayProxy(count);
        GetEQ( partyf );
/*
        if(persn.IsEmployer == "X")
          if(partyKind != 43)
            if(choice == 1)
               IsEmployer = "X";
            end;
          else
            IsEmployer = "X";
          end;
        end;
*/

        if(partyf.LegalForm == PTLEGF_PERSN)
          АнкетаПредставителяФизическогоЛица_word( partyf, 64);  // PTK_PROXY = 64
        else
          АнкетаПредставителяЮридическогоЛица_word( partyf, 64 );
        end;

        i = i + 1;
      end;
    end;

    if(BeneficiaryArray.size > 0)
      i = 0;
      count = 0;
      while(i<BeneficiaryArray.size)
        count = i;

        Number = Number + 1;

/*
        ClearRecord( persn );
        persn.PersonID = BeneficiaryArray(count);
        GetEQ( persn );
*/
        ClearRecord( partyf );
        partyf.PartyID = BeneficiaryArray(count);
        GetEQ( partyf );
/*
        if(persn.IsEmployer == "X")
          if(partyKind != 43)
            if(choice == 1)
               IsEmployer = "X";
            end;
          else
            IsEmployer = "X";
          end;
        end;
*/
        АнкетаВыгодоприобретателяФизическогоЛица_word( partyf, PTK_BENEFIT );  

        i = i + 1;
      end;
    end;

    if(BeneownerArray.size > 0)
      i = 0;
      count = 0;
      while(i<BeneownerArray.size)
        count = i;

        Number = Number + 1;
/*
        ClearRecord( persn );
        persn.PersonID = BeneownerArray(count);
        GetEQ( persn );
*/
        ClearRecord( partyf );
        partyf.PartyID = BeneownerArray(count);
        GetEQ( partyf );
/*
        if(persn.IsEmployer == "X")
          if(partyKind != 43)
            if(choice == 1)
               IsEmployer = "X";
            end;
          else
            IsEmployer = "X";
          end;
        end;
*/
        АнкетаБенефициарногоВладельцаФизическогоЛица_word( partyf, 68, IsEmployer);  // PTK_BENEOWNER = 68

        i = i + 1;
      end;
    end;


    var rs = RsdRecordset( "select 1 from dfmpartychkhist_dbt where t_PartyID = "+ string(client.PartyID) );
    if( rs.moveNext() )

       Number = Number + 1;
       АнкетаСведенийПроверкиПоПеречнюФСФМ_word( party, partyKind, Number, NameA);
    end;


//  end;

  exit(1);
end;

/****************************************************************************************/

/*
 *  АНКЕТА Кредитной Организации
 */

macro АнкетаКредитнойОрганизации( party, partyKind )
  var BeneownerArray = TArray;

  АнкетаКредитнойОрганизации_word(party, partyKind, BeneownerArray);

  exit(1);
end;


/*
 * Сведения о представителе клиента - физическом лице
*/
macro АнкетаПредставителяФизическогоЛица( party, partyKind )
  record client("party.dbt");

  SetBuff( client, party );


  АнкетаПредставителяФизическогоЛица_word( client, partyKind );

  exit(1);
end;

/*
 * Сведения о представителе клиента - юридическом лице
*/
macro АнкетаПредставителяЮридическогоЛица( party, partyKind )
  record client("party.dbt");

  SetBuff( client, party );


  АнкетаПредставителяЮридическогоЛица_word( client, partyKind );

  exit(1);
end;



/*
 * Сведения о  выгодоприобретателе - физическом лице  
*/
macro АнкетаВыгодоприобретателяФизическогоЛица( party, partyKind )
  record client("party.dbt");

  SetBuff( client, party );


  АнкетаВыгодоприобретателяФизическогоЛица_word(client, partyKind);

  exit(1);
end;

/*
 * Сведения о выгодоприобретателе - юридическом лице
*/
macro АнкетаВыгодоприобретателяЮридическогоЛица( party, partyKind )
  record client("party.dbt");

  SetBuff( client, party );

  АнкетаВыгодоприобретателяЮридическогоЛица_word(client, partyKind);

  exit(1);
end;

/*
 * Сведения о бенефициарном владельце - физическом лице  
*/
macro АнкетаБенефициарногоВладельцаФизическогоЛица( party, partyKind )
  record client("party.dbt");

  SetBuff( client, party );

  АнкетаБенефициарногоВладельцаФизическогоЛица_word(client, partyKind);

  exit(1);
end;


/*
 * Сведения о  выгодоприобретателе 
*/
macro АнкетаВыгодоприобретателя( party, partyKind )
  record client("party.dbt");

  SetBuff( client, party );

  if(client.LegalForm == PTLEGF_PERSN)
    АнкетаВыгодоприобретателяФизическогоЛица_word(client, partyKind);
  else
    АнкетаВыгодоприобретателяЮридическогоЛица_word(client, partyKind);
  end;

  exit(1);
end;

/*
 * Сведения о Представителе
*/
macro АнкетаПредставителя( party, partyKind )
  record client("party.dbt");

  SetBuff( client, party );
  if(client.LegalForm == PTLEGF_PERSN)
    АнкетаПредставителяФизическогоЛица_word( client, partyKind );
  else
    АнкетаПредставителяЮридическогоЛица_word( client, partyKind );
  end;

  exit(1);
end;


