/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 5.1                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/* Общие константы и вспомогательные функции по обработке аккредитивов      */
/*                                                                          */
/*  Имя файла: akkrtls.mac                                                  */
/*  Создан:  17.01.05                                    Фомченкова Л.Н.    */
/****************************************************************************/

import "likepy.mac";

/*условие оплаты*/
const КодСАкцептом        = 1;
const КодБезАкцепта       = 2;

/*Покрытие*/
const КодПокрытия         = 1;
const КодНепокрытия       = 2;

/*Тип аккредитива */
const КодОтзывный         = 1;
const КодБезотзывный      = 2;


/*Строковые константы*/

/*условие оплаты*/
const НазваниеСАкцептом   = "с акцептом";
const НазваниеБезАкцепта  = "без акцепта";

/*Покрытие*/
const НазваниеПокрытия    = "Покрытый";
const НазваниеНепокрытия  = "Непокрытый";

/*Тип аккредитива */
const НазваниеОтзывный    = "отзывный";
const НазваниеБезотзывный = "безотзывный";

const СрокДействияАкцепта = "Срок действия";



/*функции для печати и генерации сообщений*/

macro ПолучитьУсловиеОплатыПоКоду(Код)
   var Строка = "";
   if(trim(Код) == string(КодСАкцептом))
      Строка = НазваниеСАкцептом;
   end;
   if(trim(Код) == string(КодБезАкцепта))
      Строка = НазваниеБезАкцепта;
   end;
   return Строка;
end;

macro ПолучитьТипАккредитиваПоКоду(Код)
   var Строка = "";
   if(trim(Код) == string(КодОтзывный))
      Строка = НазваниеОтзывный;
   end;
   if(trim(Код) == string(КодБезотзывный))
      Строка = НазваниеБезОтзывный;
   end;
   return Строка;
end;

macro ПолучитьПокрытиеПоКоду(Код)
   var Строка = "";
   if(trim(Код) == string(КодПокрытия))
      Строка = НазваниеПокрытия;
   end;
   if(trim(Код) == string(КодНепокрытия))
      Строка = НазваниеНепокрытия;
   end;
   return Строка;
end;


macro ПолучитьУсловиеОплаты(Строка)
   var Вернуть = НазваниеБезАкцепта;
   if(Index(StrUpr(Строка), StrUpr(НазваниеСАкцептом)))
      Вернуть = НазваниеСАкцептом;
   elif(Index(StrUpr(Строка), StrUpr(НазваниеБезАкцепта)))
      Вернуть = НазваниеБезАкцепта;
   end;
   return Вернуть;
end;

macro ПолучитьТипАккредитива(Строка)
   var Вернуть = НазваниеОтзывный;
   if(Index(StrUpr(Строка), StrUpr(НазваниеОтзывный)))
      Вернуть = НазваниеБезОтзывный;
   end;
   if(Index(StrUpr(Строка), StrUpr(НазваниеБезотзывный)))
      Вернуть = НазваниеОтзывный;
   end;
   return Вернуть;
end;

macro ПолучитьПокрытие(Строка)
   var Вернуть = НазваниеПокрытия;
   if(Index(StrUpr(Строка), StrUpr(НазваниеПокрытия)))
      Вернуть = НазваниеНепокрытия;
   end;
   if(Index(StrUpr(Строка), StrUpr(НазваниеНепокрытия)))
      Вернуть = НазваниеПокрытия;
   end;
   return Вернуть;
end;

macro ПолучитьСрокАккредитива(Строка)
   var Вернуть = "";
   var Подстрока;
   var ИскатьДальше  = 0;
   var ДлинаДаты     = 1;
   var НачалоДаты;
   НачалоДаты = Index (StrUpr(Строка), StrUpr(СрокДействияАкцепта));

   if ((НачалоДаты > 0) and (НачалоДаты + strlen(СрокДействияАкцепта) <= StrLen(Строка)))
        Подстрока = substr (Строка ,НачалоДаты  + strlen(СрокДействияАкцепта)+1);
     while (not ИскатьДальше)
      if (  (IsDigitalNumber(substr(Подстрока,ДлинаДаты,1)))   
             and  (substr(Подстрока,ДлинаДаты,1) !=".")   
             and  (substr(Подстрока,ДлинаДаты,1)!="-")        
             and  (substr(Подстрока,ДлинаДаты,1)!="/"))        
         ИскатьДальше = 255;
         ДлинаДаты = ДлинаДаты - 1;
         continue;
      end;

      if ( (substr(Подстрока,ДлинаДаты,1)==" ") or ( ДлинаДаты >= strlen (Подстрока))
         )
          ИскатьДальше = 1; 
          continue;
      end;
       ДлинаДаты = ДлинаДаты + 1;
     end; /* while */
     if (ИскатьДальше = 1)
       Вернуть = substr (Подстрока,1,ДлинаДаты);
     end;

   end;  /* if  (НачалоДаты > 0)*/
  
   return Вернуть;
end;

macro ПроставитьОтзывностьИПокрытие(КодОтз: integer, КодПокр: integer): string

   if((КодОтз == 1) And (КодПокр == 1)) return "О"; end;
   if((КодОтз == 2) And (КодПокр == 1)) return "Б"; end;
   if((КодОтз == 1) And (КодПокр == 2)) return "П"; end;
   if((КодОтз == 2) And (КодПокр == 2)) return "Н"; end;

end;

macro ПроставитьОтзывностьИПокрытие2(КодОтз: string, КодПокр: string): string

   if((КодОтз == "")                  And (КодПокр == ""))                 return "О"; end;
   if((КодОтз == НазваниеОтзывный)    And (КодПокр == ""))                 return "О"; end;
   if((КодОтз == НазваниеБезотзывный) And (КодПокр == ""))                 return "Б"; end;
   if((КодОтз == "")                  And (КодПокр == НазваниеПокрытия))   return "О"; end;
   if((КодОтз == НазваниеОтзывный)    And (КодПокр == НазваниеПокрытия))   return "О"; end;
   if((КодОтз == НазваниеБезотзывный) And (КодПокр == НазваниеПокрытия))   return "Б"; end;
   if((КодОтз == "")                  And (КодПокр == НазваниеНепокрытия)) return "П"; end;
   if((КодОтз == НазваниеОтзывный)    And (КодПокр == НазваниеНепокрытия)) return "П"; end;
   if((КодОтз == НазваниеБезотзывный) And (КодПокр == НазваниеНепокрытия)) return "Н"; end;

end;
