/*
$Name:        lc_host_info.mac
$Module:      Сервис ГКБО
$Description: Макрос вывода печатной формы с информацией о лицензиях
*/
/*
   Печать формы с информацией о лицензиях
*/

Import RsbDataSet;

/* Сформировать название ограничения с учетом иерархии */
private macro createName( Name : string, Level : integer ) : string

  var i : integer;
  var FullName : string;

  FullName = "";

  i = 0;
  while( i < Level )

    FullName = FullName + "  ";

    i = i + 1;
  end;

  FullName = FullName + Name;

  return FullName;

end;

/* Печать записи с информацией о лицензии */
private macro PrintLicenseTreeBranch( Level : integer, Name : string, DemoID : variant, LicInfoString : string, LicUsingString : string, IsLast : bool )

[| ###################################################################### | ######### | ############# | ############# |](createName(Name, Level):w, DemoID, LicInfoString, LicUsingString);

  if( IsLast )
[+------------------------------------------------------------------------+-----------+---------------+---------------+];  
  end;

end;

/* Заголовок формы */
private macro PrintLicenseInfo()

  var HaspID;
  var StrictMode;
  var HaspRelease;
  var DateAF;
  var ProgramVersion;
  var DateEndTestPeriod;
  var Name_Bank;
  var DateBeginLicPeriod;
  var DateEndLicPeriod;
  var DateFileUpload;
  var DateControl;
  var IsExistsLic;
  var IsNotExistsLic;
  var IsExcess;

  GetParm(  0, HaspID );
  GetParm(  1, StrictMode );
  GetParm(  2, HaspRelease );
  GetParm(  3, DateAF );
  GetParm(  4, ProgramVersion );
  GetParm(  5, DateEndTestPeriod );
  GetParm(  6, Name_Bank );
  GetParm(  7, DateBeginLicPeriod );
  GetParm(  8, DateEndLicPeriod );
  GetParm(  9, DateFileUpload );
  GetParm( 10, DateControl );
  GetParm( 11, IsExistsLic );
  GetParm( 12, IsNotExistsLic );
  GetParm( 13, IsExcess );

  IsExistsLic    = "[" + StrFor(IsExistsLic)    + "]";
  IsNotExistsLic = "[" + StrFor(IsNotExistsLic) + "]";
  IsExcess       = "[" + StrFor(IsExcess)       + "]";

[+--------------------------------------------------------------------------------------------------------------------+];
[| Серийный номер HASP: ########################                                     Режим безопасности: ############ |](HaspID, StrictMode);
[| Релиз HASP:          ########################                           Дата окончания сопровождения: ############ |](HaspRelease, DateAF:f);
[| Версия программы: #####################################################           Тестовый период до: ############ |](ProgramVersion, DateEndTestPeriod:f);
[| Владелец:         ################################################################################################ |](Name_Bank);
[+--------------------------------------------------------------------------------------------------------------------+];
[| Контрольный период: с ########## по ##########                                                                     |](DateBeginLicPeriod:f, DateEndLicPeriod:f);
[| Файл расхода выгружен: ##########  Дата контроля: ##########                                                       |](DateFileUpload:f, DateControl:f);
[+--------------------------------------------------------------------------------------------------------------------+];
[| Лицензии:  имеющиеся ###  отсутствующие ###  превышенные ###                                                       |](IsExistsLic, IsNotExistsLic, IsExcess);
[+------------------------------------------------------------------------+-----------+---------------+---------------+];
[| Лицензия                                                               |  Демо ID  | Наличие       |   Количество  |];
[+------------------------------------------------------------------------+-----------+---------------+---------------+];

end;
