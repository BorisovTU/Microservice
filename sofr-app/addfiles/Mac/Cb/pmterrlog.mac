/*ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  RS-Bank 6.0                                          R-Style Software Lab

  File Name   : pmchkterr.mac
  Created     : 08.02.2010
  Description : ”®à¬¨à®¢ ­¨¥ ®âç¥â  ¯à®æ¥¤ãàë ¯à®¢¥àª¨ ­  â¥àà®à¨§¬

ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ*/
import rsd, globals, PaymInter, likepy;

/* ¯®«ãç¨âì §­ ç¥­¨¥ ¨§ à¥§ã«ìâ â  § ¯à®á  */
private macro getValue( rs : RsdRecordset, fld : string, nullValue : variant ) : variant

  var val = rs.value(fld);
  
  if( val == nullVal )

    if( nullValue != null ) val = nullValue;
    else                    val = "";
    end;

  end;
  
  return val;

end;

private macro PrintRecord(OrderID, Number, Date, Amount, Message)                                                                
[  ³##########³##########³###########³##############³################################################³](OrderID, Number:w, Date, Amount, Message:w);
end;

macro CreateReport()

[
 
   ¯¥à æ¨®­¨áâ:        ################                ‚à¥¬ï ä®à¬¨à®¢ ­¨ï ®âç¥â : ########## ########
   ”¨«¨ «:              ################
   ¯¥à æ¨®­­ë© ¤¥­ì:   ################

   ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
   ³ID ¯« â¥¦ ³ N ¤®ª-â  ³„ â  ¤®ª-â ³    ‘ã¬¬      ³             ¥§ã«ìâ â ¯à®¢¥àª¨                 ³
   ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´]({oper}:l, date(), time(), {OperDprt}:l,{curdate}:l);

  var rs : RsdRecordset, cmd;
  var Message = "";
  var numAll = 0;


  cmd = RsdCommand( string("select t.t_OrderID, rm.t_Number, rm.t_Date, pm.t_BaseAmount, pmft.t_PaymentID as t_PaymentID_pmforterr, pmft.t_TerrorText ",
                              "from doprtemp_tmp t, dpmrmprop_dbt rm, dpmforterr_tmp pmft, dpmpaym_dbt pm ",
                              "where rm.t_PaymentID = t.t_OrderID ",
                                "and pm.t_PaymentID = t.t_OrderID ",
                                "and pmft.t_PaymentID(+) = t.t_OrderID "));

  cmd.NullConversion = true;
  rs = RsdRecordset( cmd );

  while( rs.moveNext() )
    
    if( numAll != 0 )
[  ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
    end;                                            
    
    if( rs.value("t_PaymentID_pmforterr") == nullVal )
      Message = "« â¥¦ ã¦¥ ¡ë« ¯à®¢¥à¥­ à ­¥¥ ¨«¨ ¥¬ã ¯à®¢¥àª  ­¥ âà¥¡ã¥âáï";
    else
      if( getValue(rs, "t_TerrorText") != "" )
        Message = getValue(rs, "t_TerrorText");
      else
        Message = "‘®¢¯ ¤¥­¨© á â¥àà®à¨áâ ¬¨ ­¥ ®¡­ àã¦¥­®";
      end;
    end;
    
    PrintRecord(getValue(rs, "t_OrderID"), getValue(rs, "t_Number"), date(rs.value("t_Date")), money(rs.value("t_BaseAmount")), Message);
    
    numAll = numAll + 1;

  end;

[  ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ


   ‚á¥£® ¤®ªã¬¥­â®¢:      #######################
](numAll:l);

end;

