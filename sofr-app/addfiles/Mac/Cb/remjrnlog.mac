
import "globals.mac";
import FIInter;
   
macro printHeader( )

[┌─────────────────────────  Протокол очистки журналов  ──────────────────────┐];
[│                                                                            │];
[│╓─────────────────────────────────────┬────────────────────────────────────╖│
 │║ Филиал                              │  ################################# ║│
 │╙─────────────────────────────────────┴────────────────────────────────────╜│]({Name_Bank});

      
end;

macro printLog(JournalName, remdate :date, remtime :time, count )
  
[│                                                                            │
 │╓─────────────────────────────────────┬────────────────────────────────────╖│
 │║ Название журнала                    │  ################################# ║│
 │╟─────────────────────────────────────┼────────────────────────────────────╢│
 │║ Системные дата и время выполнения   │  ########### ##########            ║│
 │║ процедуры очистки                   │                                    ║│
 │╟─────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество обработанных записей     │  ##########                        ║│]
 (
 JournalName,
 remdate,
 remtime,
 count
 )
 ;         
end;

macro printState(FileEjected, RowsDeleted)
  var i, LineFileEjected, LineRowsDeleted;
  if(FileEjected)
    LineFileEjected = "Файл выгружен";
  else
    LineFileEjected = "Файл не выгружен";
  end;
  if(RowsDeleted)
    LineRowsDeleted = "Записи удалены";
  else
    LineRowsDeleted = "Записи не удалены";
  end;
[│╟─────────────────────────────────────┼────────────────────────────────────╢│
 │║ Состояние                           │  ################################# ║│
 │║                                     │  ################################# ║│](LineFileEjected, LineRowsDeleted);
end;

macro printComment(FirstTime, Comment)
  var i;
  array _Comment;
  StrSplit(Comment, _Comment, 33, 33, 10 );
  i = 0;
  while(StrLen(_Comment(i)) > 0)
    if(FirstTime and (i < 1))
[│╟─────────────────────────────────────┼────────────────────────────────────╢│
 │║ Комментарий                         │  ################################# ║│](_Comment(i));
    else
[│║                                     │  ################################# ║│](_Comment(i));
    end;
    i = i + 1;
  end;
end;

macro printBottom()
[│╙─────────────────────────────────────┴────────────────────────────────────╜│];
end;

macro printBottomLog()
[└────────────────────────────────────────────────────────────────────────────┘];
end;

macro printCommentNotOperDprt(FirstTime)
  printComment(FirstTime, "Очистка журнала невозможна, филиал не головной");
end;

macro printCommentNotDel(FirstTime)
  printComment(FirstTime, "Удаление не предусмотрено");
end;

macro printCommentNotExp(FirstTime)
  printComment(FirstTime, "Выгрузка не предусмотрена");
end;

macro printCommentFileExists(FirstTime)
  printComment(FirstTime, "Архивный файл за выбранный период уже существует");
end;

macro printCommentNotSignStrong(FirstTime)
  printComment(FirstTime, "Архив не подписан обязательной ЭЦП, выгрузка отменена");
end;

macro printCommentFileSaveErr(FirstTime)
   var ErrMsg = "";

   ErrMsg =  GetErrMsg();
   if (ErrMsg == "")
      ErrMsg = "Ошибка сохранения файла, удаление записей не выполнено";
   end;
   printComment(FirstTime, ErrMsg);
end;

macro printCommentNotSign(FirstTime)
  printComment(FirstTime, "Архив не подписан ЭЦП, удаление записей не выполнено");
end;

macro printMesNoSign( ProcName :string )             
    
[│                                                                            │
 │╓──────────────────────────────────────────────────────────────────────────╖│
 │║ ############################## невозможна.                               ║│
 │║ Данные выгружены в файл  без цифровой подписи                            ║│
 │╙──────────────────────────────────────────────────────────────────────────╜│](ProcName);

end;

macro printMesNotRootDep( ProcName :string )             
    
[│                                                                            │
 │╓──────────────────────────────────────────────────────────────────────────╖│
 │║ ############################## невозможна, филиал не головной.           ║│
 │╙──────────────────────────────────────────────────────────────────────────╜│](ProcName);

end;

macro printMesNoFile( ProcName :string )             
    
[│                                                                            │
 │╓──────────────────────────────────────────────────────────────────────────╖│
 │║ ############################## невозможна.                               ║│
 │║ Не найден каталог экспорта накопленных данных.                           ║│
 │╙──────────────────────────────────────────────────────────────────────────╜│](ProcName);

end;



/*удаление закрытых л/счетов и проводок*/

macro printRemAccCarryLog( remdate:date, remtime:time, countAcc:integer, countCarry:integer )

[┌──────────────────────────  Протокол изъятия по лицевым счетам и проводкам  ─────────────────────┐];
[│                                                                                                 │];
[│╓──────────────────────────────────────────────────────────┬────────────────────────────────────╖│
 │║ Филиал                                                   │  ################################# ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]({Name_Bank});
  
[│╓───────────────────────────────────────────────────────────────────────────────────────────────╖│
 │║                   Удаление закрытых лицевых счетов и проводок по закрытым счетам              ║│
 │╟──────────────────────────────────────────────────────────┬────────────────────────────────────╢│
 │║ Системные дата и время выполнения процедуры очистки      │  ############ ###########          ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных лицевых счетов                      │  ##########                        ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных проводок по закрытым лицевым счетам │  ##########                        ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]
 (remdate, remtime, countAcc, countCarry);
  
end;


macro printHeadRemErrorAcc( )

  
[│╓───────────────────────────────────────────────────────────────────────────────────────────────╖│
 │║                       Ошибки при удалении закрытых лицевых счетов                             ║│
 │╟───────┬──────────┬────────────────────┬───────────────────────────────────────────────────────╢│
 │║ Глава │  Валюта  │   Номер лицевого   │                      Описание ошибки                  ║│
 │║ учета │  счета   │      счета         │                                                       ║│
 │╙───────┴──────────┴────────────────────┴───────────────────────────────────────────────────────╜│];
           
end;


macro printRemErrorAccLog( Chapter, Code_Currency, Account, ErrMes )

  var i = 1;
  array StringArray;
  var  FI_Code;
  FI_Code = ПолучитьКодФинИн( Code_Currency );

  StrSplit(StrSubst(ErrMes, "│", " " ), StringArray, 53);
  

[│╓───────┬──────────┬────────────────────┬───────────────────────────────────────────────────────╖│
 │║ ##### │  ######  │ ################## │ ##################################################### ║│]
  ( Chapter, FI_Code, Account, StringArray(0) );

 while ( StrLen(StringArray(i) ) > 0)

[│║       │          │                    │ ##################################################### ║│]
   (StringArray(i));
   i = i + 1;
 end;  

[│╙───────┴──────────┴────────────────────┴───────────────────────────────────────────────────────╜│];
 

end;

macro printHeadRemErrorCarry( )  
[│╓───────────────────────────────────────────────────────────────────────────────────────────────╖│
 │║                        Ошибки при удалении проводок по закрытым счетам                        ║│
 │╟───────┬────────────────┬───────────────────┬─────────┬─────────┬──────────────────────────────╢│
 │║ Глава │    Счет Дт     │    Счет  Кт       │ Валюта  │  Сумма  │     Описание ошибки          ║│
 │║ учета │                │                   │         │         │                              ║│
 │╙───────┴────────────────┴───────────────────┴─────────┴─────────┴──────────────────────────────╜│];         
end;


macro printRemErrorCarryLog( Chapter, Account_Payer, Account_Receiver, Code_Currency, Sum, ErrMes )

  var i = 1;
  array StringArray;
  var  FI_Code;
  FI_Code = ПолучитьКодФинИн( Code_Currency );

  StrSplit(StrSubst(ErrMes, "│", " " ), StringArray, 28);

[│╓───────┬────────────────┬───────────────────┬─────────┬─────────┬──────────────────────────────╖│
 │║ ##### │ ############## │ ################# │ ####### │######## │ ############################ ║│]
 (Chapter, Account_Payer, Account_Receiver, FI_Code, Sum, StringArray(0));

  while ( StrLen(StringArray(i) ) > 0) 

[│║       │                │                   │         │         │ ############################ ║│]
    (StringArray(i));
    i = i + 1;
 end;

[│╙───────┴────────────────┴───────────────────┴─────────┴─────────┴──────────────────────────────╜│];
 

end;


/*удаление платежей и операций*/

macro printRemPaysOprsLog( remdate:date, remtime:time, countPays:integer, countOprs:integer )

[┌─────────────────────────────  Протокол изъятия по операциям и платежам  ────────────────────────┐];
[│                                                                                                 │];
[│╓──────────────────────────────────────────────────────────┬────────────────────────────────────╖│
 │║ Филиал                                                   │  ################################# ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]
 ({Name_Bank});
  
[│╓───────────────────────────────────────────────────────────────────────────────────────────────╖│
 │║                                   Удаление платежей и операций                                ║│
 │╟──────────────────────────────────────────────────────────┬────────────────────────────────────╢│
 │║ Системные дата и время выполнения процедуры очистки      │  ############ ###########          ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных платежей                            │  ##########                        ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных операций                            │  ##########                        ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]
 (remdate, remtime, countPays, countOprs);
  
end;


macro printHeadRemPaysOprsError( objKind )

  var objName :string;

  if( objKind == 0 ) objName = "платежей" end;
  if( objKind == 1 ) objName = "операций" end; 

[│╓───────────────────────────────────────────────────────────────────────────────────────────────╖│
 │║                                  Ошибки при удалении ##########                               ║│]( objName );
[│╟───────┬───────────────────────────────────────────────────────────────────────────────────────╢│
 │║  ID   │                                   Описание ошибки                                     ║│];         

end;


macro printRemPaysOprsErrorLog( objID, ErrMes  )  
  
  var i = 1;
  array StringArray;   

  StrSplit(StrSubst(ErrMes, "│", " " ), StringArray, 85);
  

[│╟───────┼───────────────────────────────────────────────────────────────────────────────────────╢│
 │║ ##### │ ##################################################################################### ║│]
 (  objID,  StringArray(0));

  while ( StrLen(StringArray(i) ) > 0) 

[│║       │ ##################################################################################### ║│]
    (StringArray(i));
    i = i + 1;
 end;

[│╙───────┴───────────────────────────────────────────────────────────────────────────────────────╜│];
           
end;

/*удаление пользовательских полей*/

macro printRemUserFieldsLog( 
remdate:date, 
remtime:time, 
countCts:integer, 
countNotes:integer, 
countLnkObj:integer )

[┌──────────────────────────  Протокол очистки пользовательских полей объектов  ───────────────────┐];
[│                                                                                                 │];
[│╓──────────────────────────────────────────────────────────┬────────────────────────────────────╖│
 │║ Филиал                                                   │  ################################# ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]
 ({Name_Bank});
  
[│╓──────────────────────────────────────────────────────────┬────────────────────────────────────╖│
 │║ Системные дата и время выполнения процедуры очистки      │  ############ ###########          ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных записей категорий                   │  ##########                        ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных записей примечаний                  │  ##########                        ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных записей связанных объектов          │  ##########                        ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]
 (remdate, remtime, countCts, countNotes, countLnkObj);
  
end;



/*удаление истории пользовательских полей*/

macro printRemUserFieldsHistLog( 
remdate:date, 
remtime:time, 
countCts:integer, 
countNotes:integer, 
countLnkObj:integer )

[┌────────────────────  Протокол очистки истории пользовательских полей объектов  ─────────────────┐];
[│                                                                                                 │];
[│╓──────────────────────────────────────────────────────────┬────────────────────────────────────╖│
 │║ Филиал                                                   │  ################################# ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]
 ({Name_Bank});
  
[│╓──────────────────────────────────────────────────────────┬────────────────────────────────────╖│
 │║ Системные дата и время выполнения процедуры очистки      │  ############ ###########          ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных записей истории категорий           │  ##########                        ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных записей истории примечаний          │  ##########                        ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных записей истории связанных объектов  │  ##########                        ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]
 (remdate, remtime, countCts, countNotes, countLnkObj);
  
end;


/*очистка "нового" шлюза*/ 
macro printRemNewGateLog( 
remdate:date, 
remtime:time, 
countGtRec:integer, 
countSeance:integer, 
countGtObj:integer )

[┌────────────────────────────────  Протокол очистки "нового" шлюза  ──────────────────────────────┐];
[│                                                                                                 │];
[│╓──────────────────────────────────────────────────────────┬────────────────────────────────────╖│
 │║ Филиал                                                   │  ################################# ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]
 ({Name_Bank});
  
[│╓──────────────────────────────────────────────────────────┬────────────────────────────────────╖│
 │║ Системные дата и время выполнения процедуры очистки      │  ############ ###########          ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных записей репликации                  │  ##########                        ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных записей сеансов                     │  ##########                        ║│
 │╟──────────────────────────────────────────────────────────┼────────────────────────────────────╢│
 │║ Количество удаленных записей объектов                    │  ##########                        ║│
 │╙──────────────────────────────────────────────────────────┴────────────────────────────────────╜│]
 (remdate, remtime, countGtRec, countSeance, countGtObj);
  
end;

/*│║
 *┌─┬─┐ ╔═╦═╗ ╓─╥─╖╒═╤═╕
 *├─┼─┤ ╠═╬═╣ ╟─╫─╢╞═╪═╡
 *└─┴─┘ ╚═╩═╝ ╙─╨─╜╘═╧═╛
 */



   

   
