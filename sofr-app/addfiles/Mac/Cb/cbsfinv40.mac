/************************************************************************/
/*         Автоматизированная банковская система RS-Bank v6.0           */
/*                 Copyright (c) R-Style Software Lab 2005              */
/*  Имя файла        : cbsfinv40.mac                                    */
/*  Описание         : Оплата ТО. Шаг ожидания исполнения               */
/*  Программист      : Чернов А.Г.                                      */
/*  Создан           : 09-06-2005                                       */
/************************************************************************/

import OprInter, InsCarryDoc, SFInter, RsbDataSet;


macro ExecuteStep( d, sfinv )
  record sfinv_buf("sfinv.dbt");

  setbuff( sfinv_buf, sfinv );

  if( sfinv_buf.PaidAmount > sfinv_buf.TotalAmount )
    msgbox( "ТО оплачено на сумму, превышающую его номинал." );
    return 1;
  end;

  if( sfinv_buf.InvMethod == SFINV_INVMETHOD_REQUEST )
    if( sfinv_buf.PaidAmount < sfinv_buf.TotalAmount )
      if( not InsertOprStatus(SFINV_OPRCORRECTPAYMSTATUS, SFINV_CORRECTPAYM_NEEDED) ) 
        msgbox( "Ошибка при установке статуса операции." );
        return 1;
      end;
    elif( sfinv_buf.PaidAmount == sfinv_buf.TotalAmount )
      if( not InsertOprStatus(SFINV_OPRCORRECTPAYMSTATUS, SFINV_CORRECTPAYM_UNNEEDED) ) 
        msgbox( "Ошибка при установке статуса операции." );
        return 1;
      end;
    end;
  end;

  return 0;
end;
