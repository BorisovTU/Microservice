/***************************************************************\
 *                                                             *
 *                 RS-Balance - RS-Bank                        *
 *                                                             *
 *    Copyright (c) R-Style Software Lab Ltd. 1993 - 2003      *
 *                                                             *
 * Макрос проверки использования удаляемой страны в dbt-файлах *
 * подсистем Зарплата и Кадровая служба.                       *
 * 30.06.2003                                Меремьянин Т. В.  *
\***************************************************************/
MACRO ProcessFile(filename)

  var stat = 0;

  if (GetEQ(filename))
    stat = -1;
  end;/*if*/

  return stat;

END;/*MACRO*/

MACRO CheckCountryLinx(CountryCode)

  var result = false;

  FILE addrempl ("addrempl.dbt", "zp.def") KEY 6;
  FILE bus_trip ("bus_trip.dbt", "zp.def") KEY 4;
  FILE hs_lsht  ("hs_lsht.dbt" , "zp.def") KEY 3;
  FILE lsheet   ("lsheet.dbt"  , "zp.def") KEY 8;
  FILE militreg ("militreg.dbt", "zp.def") KEY 3;
  FILE national ("national.dbt", "zp.def") KEY 4;
  FILE patrzsal ("patrzsal.dbt", "zp.def") KEY 1;
  FILE zsale    ("zsale.dbt"   , "zp.def") KEY 5;

  addrempl.CodeCountry = CountryCode;
  if (ProcessFile(addrempl) == -1)
    MsgBox("Страна используется в файле адресов сотрудников.\nТабельный № сотрудника ", addrempl.Tnumb);
    result = true;
  end;/*if*/

  bus_trip.Country = CountryCode;
  if (ProcessFile(bus_trip) == -1)
    MsgBox("Страна используется в файле командировок сотрудников.\nТабельный № сотрудника ", bus_trip.Tnumb);
    result = true;
  end;/*if*/

  hs_lsht.CodeCountryBorn = CountryCode;
  if (ProcessFile(hs_lsht) == -1)
    MsgBox("Страна используется в файле истории личных карточек.\nТабельный № сотрудника ", hs_lsht.Tnumb);
    result = true;
  end;/*if*/

  lsheet.CodeCountryBorn = CountryCode;
  if (ProcessFile(lsheet) == -1)
    MsgBox("Страна используется в файле личных карточек сотрудников.\nТабельный № сотрудника ", lsheet.Tnumb);
    result = true;
  end;/*if*/

  militreg.CodeCountry = CountryCode;
  if (ProcessFile(militreg) == -1)
    MsgBox("Страна используется в файле военнокоматов.\nID записи ", militreg.IdRec);
    result = true;
  end;/*if*/

  national.Country = CountryCode;
  if (ProcessFile(national) == -1)
    MsgBox("Страна используется в файле гражданства сотрудников.\nТабельный № сотрудника ", national.Tnumb);
    result = true;
  end;/*if*/

  patrzsal.Country = CountryCode;
  if (ProcessFile(patrzsal) == -1)
    MsgBox("Страна используется в файле шаблонов начислений.\nВид перечисления ", patrzsal.KindMove);
    result = true;
  end;/*if*/

  zsale.Country = CountryCode;
  if (ProcessFile(zsale) == -1)
    MsgBox("Страна используется в файле начислений/удержаний.\nВид перечисления ", zsale.KindMove);
    result = true;
  end;/*if*/

  return result;

END;/*MACRO*/