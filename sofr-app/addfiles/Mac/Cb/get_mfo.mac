/* ************************************************************************
   RS-Bank 5.0

   Поиск БИК по виду кода и коду в документе

   14.08.98 AS

************************************************************************ */
import CTInter, globals;

private file ObjCode ( objcode ) key 1;
private file f_i ( fininstr ) key 0;


/*const КоличествоКопий     = 0 ;*/

macro MFO_from_code( kind_code, code )

   if ( code == "" )  /*  Внутренняя проводка  */
      return "";
   end;

   if ( kind_code == 3 )  /*  код в документе и есть БИК  */
      return code;
   end;

   /*  Код, указанный в документе, не является БИК. Попытаемся найти запись
    *  в файле partcode.dbt, узнать код контрагента, а затем найти БИК
    *  этого контрагента
    */

   ObjCode.CodeKind   = kind_code;
   ObjCode.Code       = code;
   ObjCode.ObjectType = OBJTYPE_PARTY;

   if ( not GetEQ( ObjCode ) )   /*  контрагент не найден  */
      return "";
   end;

   keynum( ObjCode, 0 );

   ObjCode.CodeKind = 3;         /* Значение PartyID оставляем,   */
                                 /* тип кода - 3 (БИК )           */

   if ( not GetEQ( ObjCode ) )   /* для этого контрагента нет БИК */
      return "";
   else
      return ObjCode.Code;       /* БИК найден                    */
   end;

end;


macro GetISOCode( code )

   f_i.FIID = code;
   if ( GetEQ( f_i ) )
      return int(f_i.ISO_Number);
   else
      return 0;
   end;

end;

/* Получить наименование филиала */
MACRO GetDepartmentName(d)
  var dep_name = "";
  CB_GetDepartmentCodeAndName (d.Department, NULL, dep_name);
  return dep_name;
END;
