/*
  $Name:         pm_check_pbr.mac
  $Module:       Ядро Banking
  $Description:  Проверки платежей, позиционированных на корсхему с ПБР
*/

//-----------------------------------------------------------------------------
//          Автоматизированная банковская система RS-Bank               
//                 Copyright (c) R-Style Software Lab
//
// Подсистема   : Ядро Banking
//
// Описание     : Проверки платежей, позиционированных на корсхему с ПБР
//
// Программист  : Чукина Т.А.
//
// Создан       : 03.05.2018
//
//-----------------------------------------------------------------------------

import oralib, likepy;

// Участие в платежной системе Банка России
macro CheckPtIsPartPSBR
( PartyID : integer,
  RoleName : string,
  Msg : @string

) : integer

  var params : TArray = makeArray
    ( SQLParam("p_PartyID",  PartyID),
      SQLParam("p_RoleName", RoleName),
      SQLParam("p_Message",  V_STRING, RSDBP_OUT, 2000)
    );
  var Result : string = execStoredFunc
    ( "PM_CHECK_PBR.CheckPtIsPartPSBR", V_INTEGER, 
      params
    );

  Msg = params.Value(2).value;
  return Result;
end;

// Ограничение участия в платежной системе Банка России
macro CheckPtRestrictPartPSBR
( PartyID : integer,
  RoleName : string,
  Msg : @string

) : integer

  var params : TArray = makeArray
    ( SQLParam("p_PartyID",  PartyID),
      SQLParam("p_RoleName", RoleName),
      SQLParam("p_Message",  V_STRING, RSDBP_OUT, 2000)
    );
  var Result : string = execStoredFunc
    ( "PM_CHECK_PBR.CheckPtRestrictPartPSBR", V_INTEGER, 
      params
    );

  Msg = params.Value(2).value;
  return Result;
end;

// Проверка типа участника по справочнику БИК
macro CheckPtIsCorrectPZN
( PartyID : integer,
  RoleName : string,
  Msg : @string

) : integer

  var params : TArray = makeArray
    ( SQLParam("p_PartyID",  PartyID),
      SQLParam("p_RoleName", RoleName),
      SQLParam("p_Message",  V_STRING, RSDBP_OUT, 2000)
    );
  var Result : string = execStoredFunc
    ( "PM_CHECK_PBR.CheckPtIsCorrectPZN", V_INTEGER, 
      params
    );

  Msg = params.Value(2).value;
  return Result;
end;

