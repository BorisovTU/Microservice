import BankInter, cryptdlm;

macro GetLastResult(ResultArr : TArray)
    var Result : string;
    var OneResArray : TArray;
    var iBegin, iEnd;
    var i : integer = 0;
    var tmp;
    var ErrorCode;
    var cryptoAPI = RsCryptoAPI();

    ErrorCode = cryptoAPI.GetLastResult(Result);
    
    if ((ErrorCode == 0) or (ErrorCode == 1))
        iBegin = 1;
        iEnd = Index(Result, "\n");

        while (iEnd != 0)

            OneResArray = TArray;
            tmp = SubStr(Result, 1, iEnd - 1);

            OneResArray(0) = Int(SubStr(tmp, 1, Index(tmp, "|") - 1));
            tmp = SubStr(tmp, Index(tmp, "|") + 1);
            
            OneResArray(1) = SubStr(tmp, 1, Index(tmp, "|") - 1);
            tmp = SubStr(tmp, Index(tmp, "|") + 1);
            
            OneResArray(2) = tmp;
            
            ResultArr(i) = OneResArray;    

            Result = SubStr(Result, iEnd + 1);
            iEnd = Index(Result, "\n");
            i = i + 1;
        end;
    end;
    
    InitError();
    
    return ErrorCode;
end;   
