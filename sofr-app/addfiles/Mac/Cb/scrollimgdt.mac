/*
$Name:             scrollimgdt.mac
$Module:           Главная книга
$Description:      Макрос проверки изменений в скроллинге прикрепленных объектов
*/
import BankInter, CTInter;

private record oldImgdataBuff(imgdata); //буфер содержащий данные до изменения, актуален во время обновления или удаления
private record newImgdataBuff(imgdata); //буфер содержащий данные после изменения, актуален во время обновления или вставки

private macro CheckImgdata(Mode)
  var stat = 0;
/*
  //пример обработки различных режимов модификации прикрепленного объекта для субъекта
  var msg = "";

  if(Mode == OBJ_INSERT)
    if(newImgdataBuff.ObjectType == OBJTYPE_PARTY)
      msg = msg + "Ввод прикрепленного объекта для субъекта " + string(newImgdataBuff.ObjectID);
      msg = msg + "|oldImgdataBuff.ObjectID=" + string(oldImgdataBuff.ObjectID);
      msg = msg + "|newImgdataBuff.ObjectID=" + string(newImgdataBuff.ObjectID);
    end;
  elif(Mode == OBJ_UPDATE)
    if(newImgdataBuff.ObjectType == OBJTYPE_PARTY)
      if(oldImgdataBuff.FileName == "denied_update_delete.txt")
        stat = 1;
        msg = msg + "Попытка обновления прикрепленного объекта прервана!!!";
      else
        msg = msg + "Обновление прикрепленного объекта для субъекта " + string(newImgdataBuff.ObjectID);
      
        if((newImgdataBuff.IsMain == "X") and (newImgdataBuff.IsMain != oldImgdataBuff.IsMain))
          msg = msg + "|Установлен признак основного прикрепленного объекта!!!";
        end;
      
        if((newImgdataBuff.CloseDate != oldImgdataBuff.CloseDate))
          msg = msg + "|Прикрепленный объект закрыт!!!";
        end;
        msg = msg + "|oldImgdataBuff.ObjectID=" + string(oldImgdataBuff.ObjectID);
        msg = msg + "|newImgdataBuff.ObjectID=" + string(newImgdataBuff.ObjectID);
      end;
    end;
  elif(Mode == OBJ_DELETE)
    if(oldImgdataBuff.ObjectType == OBJTYPE_PARTY)
      if(oldImgdataBuff.FileName == "denied_update_delete.txt")
        stat = 1;
        msg = msg + "Попытка удаления прикрепленного объекта прервана!!!";
      else
        msg = msg + "Удаление прикрепленного объекта для субъекта " + string(newImgdataBuff.ObjectID);
        msg = msg + "|oldImgdataBuff.ObjectID=" + string(oldImgdataBuff.ObjectID);
        msg = msg + "|newImgdataBuff.ObjectID=" + string(newImgdataBuff.ObjectID);
      end;
    end;
  end;

  if(msg != "")
    msgbox(msg);
  end;
*/
  return stat;
end;
