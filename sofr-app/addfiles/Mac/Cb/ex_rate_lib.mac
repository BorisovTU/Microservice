/*
$Name: ex_rate_lib.mac
$Module: Ядро ГКБО
$Description: Общие функции, необходомые для определения счетов курсовых разниц
*/

Import rsd;
Import CTInter;

/*
 *  Определение параметра первого рода "Код ФИ"
 */
macro ExRate_GetParameter_CodeFI( FIID : integer ) : integer
  
  var CodeFI : integer;

  var strSQL : string;
  var rs : RsdRecordset;
  var cmd : RsdCommand;

  strSQL =  " SELECT NVL ( (SELECT t_Element "
            "          FROM dllvalues_dbt"
            "         WHERE t_List = ?   "
            "           AND t_Code = (SELECT t_ISO_Number"
            "                           FROM dfininstr_dbt"
            "                         WHERE t_FIID = ?)), "
            "         (SELECT t_Element "
            "            FROM dllvalues_dbt "
            "          WHERE t_List = ? AND t_Code = ?)) "
            "   FROM DUAL";

  cmd = RsdCommand( strSQL );

  cmd.AddParam("", RSDBP_IN, OBJTYPE_CODE_FI );

  cmd.AddParam("", RSDBP_IN, FIID );

  cmd.AddParam("", RSDBP_IN, OBJTYPE_CODE_FI );

  cmd.AddParam("", RSDBP_IN, "000" );

  rs = RsdRecordset( strSQL );

  CodeFI = -1;

  cmd.Execute();

  rs = RsdRecordset(cmd);

  if( rs.moveNext() )

    if( rs.value(0) != nullval )

      CodeFI = rs.value(0);

    end;

  end;

  return CodeFI;

end;
