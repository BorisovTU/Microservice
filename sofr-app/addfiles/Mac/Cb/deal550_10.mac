//-----------------------------------------------------------------------------
// Блок      : 26000 - "Выгрузка документов сделки 5.50"
// Шаг       : 10    - "Выгрузка документов сделки 5.50"
// Назначение: Макрос шага
// Описание  : Макрос шага
//-----------------------------------------------------------------------------

import PaymInter, InsCarryDoc, "ws_CrPaym.mac";

var PaymentList: TArray,
    FinishDeal: bool,
    PaymentObj: RsbPayment;

//-----------------------------------------------------------------------------
// Выполнение шага
//-----------------------------------------------------------------------------
MACRO ExecuteStep( doc, paymDoc, KindDoc, ID_Operation, ID_Step )
  if ((PaymentList.size() == 0) and (not FinishDeal))
    msgbox("Документы сделки выгружаются из бэк-офисов");
    return 1;
  end;
  var bop;
  var stat = 0;
  if (PaymentList.size() > 0)
    stat = InsertRBDocumentOpr(PaymentList, True);
  end;
  for (bop, PaymentList)
    PaymentObj.LinkPayment(RsbPayment(bop.PaymentID), PMLINK_KIND_DEALPAYMENT);
  end;
  if (FinishDeal)
    if(not InsertOprStatus(2601, 3 )) //Завершена в 5.50
      msgbox("Ошибка при установке статуса платежа");
      return 1;
    end;
  end;
  return 0;
END;