/************************************************************************/
/*         Автоматизированная банковская система RS-Bank 5.1            */
/*                 Copyright (c) R-Style Software Lab 2001              */
/*                                                                      */
/*  Имя файла        : opbbcntr.mac                                     */
/*                                                                      */
/*  Описание         : Контроль платежей ББ                             */
/*                                                                      */
/*  Программист      : Алешин А.В.                                      */
/*                                                                      */
/*  Создан           : 21.12.01                                         */
/*                                                                      */
/************************************************************************/

import PaymInter, "paym_rec.mac";

macro ExecuteStep( doc, primdoc )

  /* Проверяем ДПП платежа для внешних платежей */
  if(( (Pm_debet.PaymentID  == Pm_paym.PaymentID) and (Pm_debet.Group  == PAYMENTS_GROUP_EXTERNAL) ) or
     ( (Pm_credit.PaymentID == Pm_paym.PaymentID) and (Pm_credit.Group == PAYMENTS_GROUP_EXTERNAL) )) 
    if( (Pm_debet.PaymentID  == Pm_paym.PaymentID) and (Pm_debet.Group == PAYMENTS_GROUP_EXTERNAL) )
      if( PaymOutChangeDPP(Pm_paym, Pm_debet, NULL, 0 )==false )
        return 1;
      end;
    else
      if( PaymOutChangeDPP(Pm_paym, NULL, Pm_credit, 0 )==false )
        return 1;
      end;
    end;
  end;

  return 0;
end;