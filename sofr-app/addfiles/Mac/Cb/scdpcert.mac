// ---------------------------------------------------------------------------
//          Автоматизированная банковская система RS-Bank v6
//                 Copyright (c) R-Style SoftWare Lab  2005
//
//  File Name    : scdpcert.mac
//
//  Description  : Отчет "ИК депозитного/сберегательного сертииката"
//
//  Programmer   : Nikonorov Evgeny
//
//  Created      : 27 Desember 2005
//
// ---------------------------------------------------------------------------
import PTInter, FIInter, DealsInter, "or_rep_h.mac", cb_sql;
import RsbDataSet;

record invcard("invcard.dbt");
record leg("dl_leg.dbt");
record bnr("vsbanner.dbt");
var vficert;


const DEPOATTR_ATTNUM_STORAGE = 10;
var sign = "     ";

var _Excel = 0;


macro ЧислоCЗаданнойТочностью( _var, _point:integer, _parm:string ) 
  var TmpStr:string;
  if( (valtype (_var) == V_DOUBLE) OR (valtype (_var) == V_MONEY) )
    if((valtype (_parm) == V_UNDEF) OR (_parm == ""))
      TmpStr = "String(_var:0" + ":" + string(_point) + ")";
    else
      TmpStr = "String(_var:0" + ":" + string(_point) + ":" + _parm + ")";
    end;
    return ExecExp(TmpStr);
  else
    return String(_var);
  end;
end; 


var HeaderProxy = "┌──────────────┬─────────────────────┬────────────────────────────────────┐\n"+
                  "│     Роль     │      Должность      │         Ф.И.О. представителя       │\n"+
                  "├──────────────┼─────────────────────┼────────────────────────────────────┤";




var CertRep = CMakeReport(HeaderProxy);
const FontStyleTitel =  "ex_FS()";

macro GetNameAlg( TypeAlg, NumberAlg)
  file na("namealg");

  na.iTypeAlg   = TypeAlg;
  na.iNumberAlg = NumberAlg;
  if( GetEQ(na))
    return na.szNameAlg;
  else
    return "";
  end;

  return "";

end;

macro PrintSeparator()
   CertRep.AddStr();
   CertRep.AddPrintCell( "------------------------------------------------------------------------------", 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
end;

macro ПечататьЗаголовокОтчета(HeadStr, Xid )

   //проверить, если разделители | в строке
   CertRep.AddPrintCell( "И Н В Е Н Т А Р Н А Я   К А Р Т О Ч К А", 100, 0, "c:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddStr();
   CertRep.AddPrintCell( HeadStr, 100, 0, "c:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddStr();
   CertRep.AddPrintCell( "№ "+Xid, 100, 0, "c:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddStr();

end;

macro ПечататьОбщиеПараметры()
   var width = 25;
   var FaceValue = "";
   var FaceValueFI = "";
   var CloseDate;
   file fin("fininstr");
   file dp("dp_dep");
   var CCY = "";
   var RetSumm = "-";
   var Cost = "-";
   var Department = "-"; 

   CertRep.AddEmptyStr();

   //1. Дата составления
   CertRep.AddStr();
   CertRep.AddPrintCell( "составлена:", width, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( invcard.RegistrDate, 0, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //2. состояние карточки
   CertRep.AddStr();
   CertRep.AddPrintCell( "состояние карточки:", width, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( GetNameAlg( 5211, invcard.Status), 0, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "установлено: " + invcard.StatusDate, 0, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.кол-во сертификатов
   CertRep.AddStr();
   CertRep.AddPrintCell( "всего сертификатов:", width, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( 1+" (" +NumToStr(1)+") шт.", 0, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //4.всего на сумму
   FaceValue   = vficert.FaceValue;
   FaceValueFI = vficert.FaceValueFI;
   
   if( FaceValueFI != -1)
     fin.FIID = FaceValueFI;
     if( GetEQ(fin))
       CCY = fin.CCY;
     end;
   end;   
   CertRep.AddStr();
   CertRep.AddPrintCell( "всего на сумму:", width, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( FaceValue+" (" +NumToStr(FaceValue)+") " + CCY, 100, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //5.Погашение
   if( leg.Closed != date(0,0,0))
     CloseDate = string(leg.Closed);
   else
     CloseDate = "-";
   end;
   CertRep.AddStr();
   CertRep.AddPrintCell( "осуществлено погашение:", width, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( CloseDate, 0, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //6.сумма возврата
   if( CloseDate != "-" )
     Cost = leg.Cost; 
     RetSumm = Cost;
     if( FaceValue != "-")
       RetSumm = RetSumm + FaceValue;
     end; 
   end;  
   CertRep.AddStr();
   CertRep.AddPrintCell( "сумма возврата:", width, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( RetSumm + " " + CCY, 0, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //7.сумма процентов
   CertRep.AddStr();
   CertRep.AddPrintCell( "сумма причитающихся %:", width, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( Cost, 0, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //8.Филиал
   dp.Code = invcard.Department;
   if( GetEQ(dp))
     Department = dp.Name;
   end;
   CertRep.AddStr();
   CertRep.AddPrintCell( "филиал:", width, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( Department, 0, 0, "l:" + FontStyleTitel, REP_ELEM_STR );


   PrintSeparator();
end;

macro ПечататьСписокПредставителей()
   var query;
   var Proxy;
   var RoleName = "";
   file llval("llvalues");

   query =   " select pr.t_ProxyRole, pr.t_AgentPost, pr.t_AgentName from ddl_proxy_dbt pr"
           + "  where t_DocKind = " + 24 /*OBJTYPE_FICERT*/
           + "    and t_ContractID = " + invcard.FiCertID;

   Proxy = TRsbDataSet(query);

   while( Proxy.moveNext() )
     ClearRecord(llval);
     llval.List = 1108;
     llval.Element = Proxy.ProxyRole;
     if( GetEQ(llval))
       RoleName = llval.Name;
     else
       RoleName = "";
     end;

     CertRep.AddStr();
     CertRep.AddPrintCell( RoleName, 0, 0, "c:" + FontStyleTitel );
     CertRep.AddPrintCell( Proxy.AgentPost, 0, 0, "c:" + FontStyleTitel );
     CertRep.AddPrintCell( Proxy.AgentName, 0, 0, "c:" + FontStyleTitel );
   end;
end;

macro ПечататьДанныеКредитнойОрганизации()
   file party("party");
   file adress("adress");
   file bnkdp("bankdprt");
   file obj("objcode");
   var PartyCode = "-", PartyName = "-";
   var PartyAdress = "-", PartyAcc = "-";
   

   //получить все данные
   party.PartyID = vficert.Issuer;
   if( GetEQ(party))
     PartyName = party.Name;

     obj.ObjectType = 3;
     obj.CodeKind   = 1;
     obj.ObjectID   = party.PartyID;
     if( GetEQ(obj) )
       PartyCode = obj.Code;
     end;

     adress.PartyID = party.PartyID;
     adress.Type    = 3;
     if(GetEQ(adress))
       PartyAdress = adress.Adress;
     end;

     bnkdp.PartyID = party.PartyID;
     if( GetEQ(bnkdp))
       PartyAcc = bnkdp.CorAcc;
     end;
   end;

   //1.заголовок
   CertRep.AddStr();
   CertRep.AddPrintCell( "КРЕДИТНАЯ ОРГАНИЗАЦИЯ (банк)", 40, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //2.код анкеты
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"код анкеты:", 30, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PartyCode, 20, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.Наименование
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"наименование:", 30, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PartyName, 200, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //4.местонахождение
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"местонахождение:", 30, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PartyAdress, 200, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //5.корсчет
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"корсчет в Банке России:", 30, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PartyAcc, 100, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //6.представители
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"представители кредитной организации (банка)", 50, 0, "l:" + FontStyleTitel, REP_ELEM_STR );

   ПечататьСписокПредставителей();

   CertRep.AddStr();

end;

macro ПечататьПараметрыСертификата(CertStr)
   
   var FaceValue = "-", FaceValueFI = "-";
   var FiName = "";
   var FiCode = "";
   var Price = "", Factor = "";
   var BaseStr = "";
   file fin("fininstr");
   file avrk("avrkinds.dbt");

   fin.FIID = vficert.FIID;
   GetEQ(fin);  //бумаги не может не быть ни при каких условиях

   avrk.FI_Kind   = fin.FI_Kind;
   avrk.AvoirKind = fin.AvoirKind;
   GetEQ(avrk);
   
   CertRep.AddEmptyStr();
   //1.заголовок
   CertRep.AddStr();
   CertRep.AddPrintCell( "ПАРАМЕТРЫ "+CertStr+" СЕРТИФИКАТА", 60, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //2.код ФИ
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"код анкеты:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( fin.FI_Code, 20, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.имя ФИ
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"наименование:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( fin.Name, 20, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //4.Вид сертификата
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"вид:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( avrk.Name, 40, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //5.Дата внесения вклада
   CertRep.AddStr();
   if( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_SAVING_CERTIFICATE, vficert.AvoirKind ))
     CertRep.AddPrintCell( sign+"дата внесения вклада:", 30, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   elif( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_DEPOSIT_CERTIFICATE, vficert.AvoirKind ))
     CertRep.AddPrintCell( sign+"дата внесения депозита:", 30, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   end;
   CertRep.AddPrintCell( date(vficert.IssueDate), 40, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //6.размер вклада
   FaceValue   = vficert.FaceValue;
   FaceValueFI = vficert.FaceValueFI;  
   if( FaceValueFI != -1)
     ClearRecord(fin);
     fin.FIID = FaceValueFI;
     if( GetEQ(fin))
       FiName = fin.Name;
       FiCode = fin.FI_Code;
     end;
   end;
   CertRep.AddStr();
   if( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_SAVING_CERTIFICATE, vficert.AvoirKind ))
     CertRep.AddPrintCell( sign+"размер вклада:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   elif( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_DEPOSIT_CERTIFICATE, vficert.AvoirKind ))
     CertRep.AddPrintCell( sign+"размер депозита:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   end;
   CertRep.AddPrintCell( FaceValue+" ("+NumToStr(FaceValue)+")", 40, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //7.валюта
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"валюта:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( FiCode+" ("+FiName+")", 60, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //8.дата востребования суммы
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"дата востребования суммы:", 35, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( date(vficert.DrawingDate), 60, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //9.ставка %
   Price = ЧислоCЗаданнойТочностью(leg.Price, leg.Point, "" );    
   CertRep.AddStr();
   if( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_SAVING_CERTIFICATE, vficert.AvoirKind ))
     CertRep.AddPrintCell( sign+"ставка % за пользование вклада:", 40, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   elif( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_DEPOSIT_CERTIFICATE, vficert.AvoirKind ))
     CertRep.AddPrintCell( sign+"ставка % за пользование депозитом:", 40, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   end;

   CertRep.AddPrintCell( Price, 60, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //10.ставка % при досрочном погашении
   Factor = ЧислоCЗаданнойТочностью(leg.Factor, leg.Point, "");
   CertRep.AddStr();
   if( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_SAVING_CERTIFICATE, vficert.AvoirKind ))
     CertRep.AddPrintCell( sign+"ставка % за пользование вклада при досрочном погашении:", 65, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   elif( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_DEPOSIT_CERTIFICATE, vficert.AvoirKind ))
     CertRep.AddPrintCell( sign+"ставка % за пользование депозитом при досрочном погашении:", 65, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   end;
   CertRep.AddPrintCell( Factor, 60, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //11.формула расчета
   BaseStr = sign+"расчет по формуле "+GetNameAlg( 5207, leg.Formula)+" процентов ";
   if( leg.Formula == 2 )  //сложные проценты
     BaseStr = BaseStr + "(базовый период "+int(leg.Duration)+" "+GetNameAlg( 2350, leg.Pitch)+")";
   end;

   CertRep.AddStr();
   CertRep.AddPrintCell( BaseStr, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );


end;

private macro RealAddress(PartyID, Type)
  var adress = TBFile("adress");
  adress.rec.PartyID = PartyID;
  adress.rec.Type    = Type;
  if(getEQ(adress))
     return adress.rec.Adress;
  end;
  return "";
end;

macro ПечататьДанныеВкладчика()
   file party("party");
   file obj("objcode");
   file paper("paprkind");
   var PartyCode = "", PartyName = "", PartyPaper = "";
   var DocStr = "";
   var DataSet;


   party.PartyID = bnr.Holder;
   if(GetEQ(party))

     obj.ObjectType = 3;
     obj.CodeKind   = 1;
     obj.ObjectID   = party.PartyID;
     if(GetEQ(obj))
       PartyCode = obj.Code;
     end;
   end;

   PartyName = bnr.HolderName;

   DataSet = TRsbDataSet("SELECT * FROM dpersnidc_dbt t WHERE t.T_PersonID = " + bnr.Holder + " AND t.T_IsMain = 'X' ");
   if(DataSet.moveNext())
     paper.PaperKind = DataSet.PaperKind;
     if( GetEQ(paper))
       PartyPaper = paper.Name;
     end;
   end;

   //1.заголовок
   CertRep.AddStr();
   CertRep.AddPrintCell( "ВКЛАДЧИК", 60, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //2.код анкеты
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"код анкеты:", 20, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PartyCode, 20, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.ФИО
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"Ф.И.О:", 20, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PartyName, 20, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //4.удостоверение личности
   DocStr = PartyPaper+", ";
   if( DataSet.PaperSeries != "")
     DocStr = DocStr + "серия "+DataSet.PaperSeries+", ";
   else
     DocStr = DocStr + "серия "+"-,";
   end;
   if( DataSet.PaperNumber != "" )
     DocStr = DocStr + "номер "+DataSet.PaperNumber+", ";
   else
     DocStr = DocStr + "номер "+"-, ";
   end;
   if( date(DataSet.PaperIssuedDate) != date(0,0,0))
     DocStr = DocStr + "выдан "+date(DataSet.PaperIssuedDate)+", ";
   else
     DocStr = DocStr + "выдан "+"-, ";
   end;
   if( DataSet.PaperIssuer != date(0,0,0))
     DocStr = DocStr + "кем "+DataSet.PaperIssuer;
   else
     DocStr = DocStr + "кем "+"-";
   end;
   CertRep.AddStr();
   if(FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_SAVING_CERTIFICATE, vficert.AvoirKind ) )
     CertRep.AddPrintCell( sign+"удостоверение личности:", 30, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
     CertRep.AddPrintCell( DocStr, 40, 0, "l:w:" + FontStyleTitel, REP_ELEM_STR );
   elif( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_DEPOSIT_CERTIFICATE, vficert.AvoirKind ))
     CertRep.AddPrintCell( sign+"местонахождение:", 30, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
     CertRep.AddPrintCell( RealAddress(bnr.Holder, PTADDR_REAL), 40, 0, "l:w:" + FontStyleTitel, REP_ELEM_STR );
   end;


end;

macro PrintTableSepartor()
   CertRep.AddStr();
   CertRep.AddPrintCell( "+", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "------------------", 18, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "+", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "------------------", 18, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "+", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "------------------", 18, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "+", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "------------------", 18, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "+", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );

end;

macro ПечататьСертификаты()
   var ThisStyle = "ex_FS(b)"; 
   
   CertRep.AddStr();
   CertRep.AddPrintCell( "СЕРТИФИКАТЫ", 30, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   PrintTableSepartor();
   CertRep.AddStr();
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "Серия", 18, 0, "c:" + ThisStyle, REP_ELEM_STR );
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "№ начальный", 18, 0, "c:" + ThisStyle, REP_ELEM_STR );
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "№ конечный", 18, 0, "c:" + ThisStyle, REP_ELEM_STR );
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "количество", 18, 0, "c:" + ThisStyle, REP_ELEM_STR );
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   PrintTableSepartor();
   CertRep.AddStr();
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( vficert.Series, 18, 0, "c:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( trim(vficert.Number), 18, 0, "c:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( trim(vficert.Number), 18, 0, "c:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( vficert.Copies, 18, 0, "c:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( "|", 1, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   PrintTableSepartor();

end;


macro ПечатьТекущегоЗачисления()
   file party("party");
   file obj("objcode");
   file acc("account") key 1;
   file acnt("depoacnt");
   file atvl("depoatvl");
   file spl("spplaces");
   var DeponentName = "-", DeponentCode = "-", DeponentAcnt = "-", DeponentAcc = "-";
   var PlaceName = "-", PlaceCode = "-", PlaceAcnt = "-", PlaceAcntAutoKey = 0, PlaceAcc = "-";
   var StorageName = "-";

   

   acc.AccountID = invcard.HAccountID;
   if( GetEQ(acc) )
     party.PartyID = acc.Client;

     acnt.AutoKey = acc.DepoAcc;
     if(GetEQ(acnt))
       DeponentAcnt = acnt.BriefCode;
     end;
     if(GetEQ(party))
       DeponentName = party.Name;
       obj.ObjectType = 3;
       obj.CodeKind   = PTCK_CONTR;
       obj.ObjectID   = party.PartyID;
       if(GetEQ(obj))
         DeponentCode = obj.Code;
       end;
     end;

     DeponentAcc = acc.Account;
   end;

   ClearRecord(acc);
   ClearRecord(party);
   ClearRecord(acnt);
   ClearRecord(obj);
   acc.AccountID = invcard.LAccountID;
   if( GetEQ(acc) )
     party.PartyID = acc.Client;

     acnt.AutoKey = acc.DepoAcc;
     if(GetEQ(acnt))
       PlaceAcnt = acnt.BriefCode;
       PlaceAcntAutoKey = acnt.AutoKey;
     end;
     if(GetEQ(party))
       PlaceName = party.Name;
       obj.ObjectType = 3;
       obj.CodeKind   = PTCK_CONTR;
       obj.ObjectID   = party.PartyID;
       if(GetEQ(obj))
         PlaceCode = obj.Code;
       end;
     end;

     PlaceAcc = acc.Account;
   end;

   //1.заголовок
   CertRep.AddStr();
   CertRep.AddPrintCell( "ТЕКУЩЕЕ ЗАЧИСЛЕНИЕ", 60, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //2.Депонент
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"Депонент", 15, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //2.1.код анкеты
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"код анкеты:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( DeponentCode, 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //2.2.наименование
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"наименование:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( DeponentName, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //2.3.счет/раздел
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"счет/раздел:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( DeponentAcnt, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //2.4.лицевой счет
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"лицевой счет:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( DeponentAcc, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );

   //3.Место хранения
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+"Место хранения", 20, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.1.код анкеты
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"код анкеты:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PlaceCode, 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.2.наименование
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"наименование:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PlaceName, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.3.счет/раздел
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"счет/раздел:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PlaceAcnt, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.4.лицевой счет
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"лицевой счет:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( PlaceAcc, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.5.хранилище
   if( PlaceAcntAutoKey != 0 )
     atvl.AttrNum = DEPOATTR_ATTNUM_STORAGE;
     atvl.IsType  = "";
     atvl.ID      = PlaceAcntAutoKey;
     if(GetEQ(atvl))
       spl.Num = int(atvl.value);
       if(GetEQ(spl))
         StorageName = spl.ShortName;
       end;
     end;
   end;
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"хранилище:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( StorageName, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.6.секция
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"секция:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( invcard.Section, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   //3.7.ячейка
   CertRep.AddStr();
   CertRep.AddPrintCell( sign+sign+"ячейка:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddPrintCell( invcard.Cell, 150, 0, "l:" + FontStyleTitel, REP_ELEM_STR );

end;

macro ПачататьСекциюПримечаний()
   CertRep.AddStr();
   CertRep.AddPrintCell( "ПРИМЕЧАНИЯ:", 25, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddStr();
   CertRep.AddPrintCell( "______________________________________________________________________", 100, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddStr();
   CertRep.AddPrintCell( "______________________________________________________________________", 100, 0, "l:" + FontStyleTitel, REP_ELEM_STR );
   CertRep.AddStr();
   CertRep.AddPrintCell( "______________________________________________________________________", 100, 0, "l:" + FontStyleTitel, REP_ELEM_STR );

end;

macro ПечататьИКСберегательногоСертификата()
   //1.Заголовок
   ПечататьЗаголовокОтчета("С Б Е Р Е Г А Т Е Л Ь Н О Г О   С Е Р Т И Ф И К А Т А", invcard.Number);
   //2.Общие параметры карточки
   ПечататьОбщиеПараметры();
   //3.Кредитная организация
   ПечататьДанныеКредитнойОрганизации(); 
   //4.Параметры сертификата
   ПечататьПараметрыСертификата("СБЕРЕГАТЕЛЬНОГО");
   //5.Данные вкладчика
   ПечататьДанныеВкладчика();
   //6.Сертификаты
   ПечататьСертификаты();
   //7.Текущее зачисление
   ПечатьТекущегоЗачисления();
   //8.Примечания
   ПачататьСекциюПримечаний();


   if( _Excel )
     CertRep.PrintWinRep();
     CertRep.ShowWinRep();
   else
     CertRep.PrintRep();
   end;

end;

macro ПечататьИКДепозитногоСертификата()
 
   //1.Заголовок
   ПечататьЗаголовокОтчета("Д Е П О З И Т Н О Г О   С Е Р Т И Ф И К А Т А", invcard.Number);
   //2.Общие параметры карточки
   ПечататьОбщиеПараметры();
   //3.Кредитная организация
   ПечататьДанныеКредитнойОрганизации(); 
   //4.Параметры сертификата
   ПечататьПараметрыСертификата("ДЕПОЗИТНОГО");
   //5.Данные вкладчика
   ПечататьДанныеВкладчика();
   //6.Сертификаты
   ПечататьСертификаты();
   //7.Текущее зачисление
   ПечатьТекущегоЗачисления();
   //8.Примечания
   ПачататьСекциюПримечаний();


   if( _Excel )
     CertRep.PrintWinRep();
     CertRep.ShowWinRep();
   else
     CertRep.PrintRep();
   end;

end;


      
macro  ИК_ДепозитногоИлиСберегательногоСертификата( _invcard, _vficert, _vsbanner, _dl_leg, Excel )
  
  var stat = 0;
  
  copy(invcard, _invcard);
  copy(bnr, _vsbanner);
  copy(leg, _dl_leg);
  vficert = _vficert;

  _Excel     = Excel;

  if( not stat )
    if( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_SAVING_CERTIFICATE, _vficert.AvoirKind ) )
      ПечататьИКСберегательногоСертификата();
    elif( FI_AvrKindsEQ( FIKIND_AVOIRISS, AVOIRISSKIND_DEPOSIT_CERTIFICATE, _vficert.AvoirKind ) )
      ПечататьИКДепозитногоСертификата();
    else
      println("\n Неизвестный тип инвентарной карточки.");
    end;
  else
    println("\n Невозможно определить аттрибуты инвентарной карточки.");
  end;
  return 0;
end;
