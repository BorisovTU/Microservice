/*
 $Name: siem_send.mac
 $Module: Сервис ГКБО
 $Description: Отправка сообщений в Q-Radar
 */
 /*
  Отправка сообщений в Q-Radar
 */
import rssyslog;

macro SEIEM_QRadarSend(pProtocol, pAdress, pPort, pCert, pMessage, oErrMsg)

var oldFile = SetOutput("..\\LOGS\\Siem.out", True);
//println(pMessage);
//pMessage = StrSubst(pMessage,"10.26.113.9","10.4.116.180");
//pMessage = StrSubst(pMessage,"10.26.87.5","10.4.116.180");
//pMessage = StrSubst(pMessage,">","> ");
pMessage = date()+"\t"+time+"\t"+StrSubst(pMessage,"Param02","Param2");
println(pMessage);
println("***********************************************");
SetOutput(Null,Null);
SetOutput(oldFile);


    var stat = true;
    var ConnectParams;

    stat = RsSyslogConnect(pProtocol, pAdress, pPort, pCert, ConnectParams, oErrMsg);
    if (stat)
        stat = RsSyslogWrite(ConnectParams, pMessage);
        RsSyslogClose(ConnectParams);
    end;
    
    if (not stat)
        println("SEIEM_ConnectParams.LastError: ", ConnectParams.LastError);
        println("SEIEM_ConnectParams.LastDetailedError: ", ConnectParams.LastDetailedError);
    end;
    
    return stat;
end;

