/*
  $Name:         SwitchOutput.mac
  $Module:       Banking
  $Description:  Переключение вывода в файл с заданным именем
*/

private FILE RepFile() txt;

class TSwitchOutput(p_RepFileName : string, p_SkipDisplay : bool)
  private var 
    RepFileName : string = p_RepFileName, // имя текстового файла, куда будем выводить
    SkipDisplay : bool = p_SkipDisplay, // без вывода на экран, только в файл
    OldOutput;

  private macro constructor

    // Перенаправляем вывод текста в файл
    OldOutput = SetOutPut( RepFileName );

    if(not open( RepFile, RepFileName ) )
      RunError( String("Файл не открыт:", "|", RepFileName) );
    end;

  end;

  macro destructor

    // Перенаправляем вывод обратно
    close(RepFile);
    SetOutPut( OldOutput, false );

    // Выводим данные из файла на экран
    if(not SkipDisplay)
      rewind(RepFile);
      while( next(RepFile) )
        println(RepFile.str);
      end;
    end;
  end;


  constructor();

end;
