/* ╔══════════════════════════════════════════════════════════════════╗ */
/*         Автоматизированная банковская система RS-Bank v5.10          */
/*                 Copyright (c) R-Style Software Lab 1999              */
/*                                                                      */
/*  Имя файла        : pmtlscom.mac                                      */
/*                                                                      */
/*  Описание         : Единовременные комиссии платежа (функции)        */
/*  Программист      : Бабин А.П.                                       */
/*                                                                      */
/*  Создан           : 02.04.02                                         */
/*                                                                      */
/* ╚══════════════════════════════════════════════════════════════════╝ */
import  FIInter, SFInter, "globals.mac";

const OUR = 0, BEN = 1, OWN = 0, CORRESP = 1;
const ID_CURRENT_STEP = NULL, ID_INIT_STEP = 0, ID_ALL_STEP = -1;

/* Получить комиссию */
macro GetCommission( ID_Operation, ID_Step, Direct, combuf )
    var b_continue, retValue = false;
    FILE commis( sfcomiss ) key 0;


    b_continue = SfGetOperCommission(ID_Operation, ID_Step, combuf);
    while( b_continue )
      commis.FeeType = combuf.FeeType;
      commis.Number = combuf.CommNumber;
      if ( GetEQ(commis) )
         if ( (Direct==OWN) AND (commis.ReceiverID=={OurBank}) ) 
             retValue = true;
             b_continue = 0;
         end;
         if ( (Direct==CORRESP) AND (commis.ReceiverID!={OurBank}) ) 
             retValue = true;
             b_continue = 0;
         end;
      end;
      if ( b_continue )
         b_continue = SfGetOperCommission(ID_Operation, ID_Step, combuf);
      end;
    end;

    SetParm( 1, comBuf );

    return retValue;

end;

/*  Макрос пересчета суммы из одной валюты в другую */
macro GetSumConvert( sum_from, FIID_from, FIID_to, error )
     var stat, sum_to;
     /* Пересчет сумм комиссий выполняются в текуще дате */
     stat = ConvSumCross( sum_to, sum_from, {curdate}, FIID_from, FIID_to );
     if ( valType(error)!=V_UNDEF )
        error = (not stat);
        SetParm( 3, error );
     elif ( not stat )
        /*Пользователь проверки ошибки доверяет нам */
        RunError( "Ошибка конвертации суммы" );
     end;
     if ( not stat )
       sum_to = $0;
     end;
     return sum_to;
end;