/************************************************************************/
/*         Ä¢‚Æ¨†‚®ß®‡Æ¢†≠≠†Ô °†≠™Æ¢·™†Ô ·®·‚•¨† RS-Bank V6             */
/*                 Copyright (c) R-Style Software Lab                   */
/*                                                                      */
/*  à¨Ô ‰†©´†      : prpmboi.mac                                        */
/*                                                                      */
/*  éØ®·†≠®•       : è•Á†‚≠†Ô ‰Æ‡¨† °†≠™Æ¢·™Æ£Æ Æ‡§•‡† ØÆ 2360-ì        */
/*                                                                      */
/*  è‡Æ£‡†¨¨®·‚    : ë¨®‡≠Æ¢ ë.Ç.                                       */
/*                                                                      */
/*  ëÆß§†≠         : 04.01.10                                           */
/*                                                                      */
/************************************************************************/

import FIInter, PaymInter, prpm, oralib, prnlib, pmcarfun, "pmlib.mac";

const NOT_PRINT_AMOUNT = -$1;
const NOT_PRINT_FIID = -1;

private const PRINT_BY_PAYMENT  = 0;
private const PRINT_BY_CARRY    = 1;
private const SET_CHAR = "X";

var pr_document:TRecHandler = TRecHandler("acctrn.dbt", "bank.def");

/* --------------------------------------------
   èÆ´„Á•≠®• ØÆ´≠Æ£Æ ≠†®¨•≠Æ¢†≠®Ô ™´®•≠‚† ·ÁÒ‚†
   -------------------------------------------- */
PRIVATE MACRO GetClientFullName( Chapter:integer, FIID:integer, Account:string ):string

  var query:string = 
  "select pt.t_Name "
    "from daccount_dbt ac, "
         "dparty_dbt pt "
   "where ac.t_Chapter = :Chapter "
     "and ac.t_Code_Currency = :FIID "
     "and ac.t_Account = :Account "
     "and pt.t_PartyID = ac.t_Client";

  var params:TArray = TArray();
  params.value( 0 ) = SQLParam( "Chapter", Chapter );
  params.value( 1 ) = SQLParam( "FIID"   , FIID    );
  params.value( 2 ) = SQLParam( "Account", Account );

  var rs:RsdRecordset = execSQLselect( query, params );

  if( rs.moveNext() )
    return rs.value(0);
  else
    return "";
  end;

END;

// èÆ´„Á®‚Ï †‚‡®°„‚Î ·¢Ôß†≠≠Æ£Æ · Ø‡Æ¢Æ§™Æ© Ø´†‚•¶†
PRIVATE MACRO GetPaymentAttrByCarry(acctrnid, Priority:@integer, PayerName:@string, ReceiverName:@string)

  var select = "select rm.t_Priority, rm.t_PayerName, rm.t_ReceiverName "
               "from dpmdocs_dbt  pd, dpmrmprop_dbt rm "
                 "where PD.T_ACCTRNID = :acctrnid "
                 "and rm.t_PaymentID = pd.t_PaymentID ";

  var params:TArray = makeArray( SQLParam( "acctrnid", acctrnid ));

  var rs:RsdRecordset = execSQLselect( select, params );

  if( rs.moveNext() )
    Priority = rs.value(0);
    PayerName      = rs.value(1);
    ReceiverName   = rs.value(2);
  else
    Priority = 0;
    PayerName      = "";
    ReceiverName   = "";
  end;
    
  if(not Priority)
    Priority = PM_DefaultMaxPriority();
  end;
  
  SetParm( 3, Priority     );
  SetParm( 4, PayerName    );
  SetParm( 5, ReceiverName );
END;

// ä´†·· ·Ø®·™† èà
/*PRIVATE CLASS (TArray)TPIList(_Side)
  var IsAddPI : bool = false, // èà ‡†ß≠Æ·™®?
        Side  : integer = _Side;
END;*/
/* -----------------------------------------------------------
   ë‚‡„™‚„‡† §†≠≠ÎÂ Ø•Á†‚≠Æ© ‰Æ‡¨Î.
   ç„¶≠†, Á‚Æ°Î Æ‚¢Ôß†‚Ï·Ô Æ‚ ·‚‡„™‚„‡Î Ø´†‚•¶† ≠† ·´„Á†©, 
   •·´® ØÆ≠†§Æ°®‚·Ô Ø•Á†‚Ï Ø‡Æ¢Æ§™® ¢ ‰Æ‡¨• °†≠™Æ¢·™Æ£Æ Æ‡§•‡†.
   ----------------------------------------------------------- */

PRIVATE CLASS TBankOrderPrintData

  PRIVATE CLASS TPayInstruction
    var ClientName : string,
        Account    : string,
        Amount     : money,
        FIID       : integer;
  END;

  var Number           : string,
      DocumentDate     : date,
      BaseAmount       : money,
      BaseFIID         : integer,
      ShifrOper        : string,
      Priority         : integer,
      DebetPIList      : TArray,
      CreditPIList     : TArray,
      Ground           : string,
      TypeDocument     : string,
      PayAmount        : money, 
      Amount           : money, 
      FIID             : integer,
      PayFIID          : integer,
      IsDebrazn        : bool,
      IsCredrazn    : bool, 
      PrintType        : integer,
      PaymentId        : integer,
      MinimizationTurn : string;  

  /* -----------------------------------
     è‡Æ®≠®Ê®†´®ß®‡Æ¢†‚Ï §†≠≠Î¨® Ø´†‚•¶†
     ----------------------------------- */
  MACRO InitByPayment( pmpaym:TRecHandler, pmrmprop:TRecHandler )

    PaymentId    = pmpaym.rec.PaymentId;
    Number       = pmrmprop.rec.Number;
    DocumentDate = pmrmprop.rec.Date;
    BaseAmount   = pmpaym.rec.BaseAmount;
    BaseFIID     = pmpaym.rec.BaseFIID;
    ShifrOper    = pmrmprop.rec.ShifrOper;
    Priority     = pmrmprop.rec.Priority;
    Ground       = pmrmprop.rec.Ground;
    TypeDocument = pmpaym.rec.TypeDocument;
    PayAmount    = pmpaym.rec.PayAmount; 
    Amount       = pmpaym.rec.Amount;
    FIID         = pmpaym.rec.FIID;
    PayFIID      = pmpaym.rec.PayFIID;
    IsDebrazn    = false;
    IsCredrazn   = false;
    MinimizationTurn = pmpaym.rec.MinimizationTurn;
    PrintType    = PRINT_BY_PAYMENT;

    if( not ShifrOper )
      ShifrOper = "17";
    end;
    if( not Priority )
      Priority = PM_DefaultMaxPriority();
    end;
    if( not BaseAmount )
      if( pmpaym.rec.IsFixAmount and ( pmpaym.rec.FIID == pmpaym.rec.BaseFIID ) )
        BaseAmount = pmpaym.rec.Amount;
      elif( ( not pmpaym.rec.IsFixAmount ) and ( pmpaym.rec.PayFIID == pmpaym.rec.BaseFIID ) )
        BaseAmount = pmpaym.rec.PayAmount;
      end;
    end;
  
    /* á†ØÆ´≠•≠®• ·Á•‚Æ¢ ® ·„¨¨ ØÆ §•°•‚„ ® ™‡•§®‚„.
       Ö·´® ·ÁÒ‚ ß†§†≠ ¢ Ø´†‚•¶•, Æ‚‚„§† ® °•‡Ò¨.
       à≠†Á• ·Á®‚†•¨, Á‚Æ •·‚Ï ‡†ß≠Æ·™†. */

    MACRO FillPIList( PIList:TArray, payment:RsbPayment, side:integer )
      var pmaddpi:TRecHandler = TRecHandler( "pmaddpi.dbt" );
      var pi:TPayInstruction;
      var stat:integer = payment.PIList( side ).First();
      while( not stat )
        stat = payment.PIList( side ).Current( pmaddpi );
        if( not stat )
          pi = TPayInstruction();
          pi.Account    = pmaddpi.rec.Account;
          pi.Amount     = pmaddpi.rec.Amount;
          pi.FIID       = pmaddpi.rec.FIID;
          pi.ClientName = pmaddpi.rec.NameAccount;
          PIList.value( PIList.size ) = pi;
          stat = payment.PIList( side ).Next();
        end;
      end;
      if (side == PRT_Debet)
        IsDebrazn = true; 
      elif (side == PRT_Credit)
        IsCredrazn = true; 
      end;
    END;
    
    var pi:TPayInstruction,
        payment:RsbPayment;

    DebetPIList = TArray;
    if( pmpaym.rec.PayerAccount )
      pi = TPayInstruction();
      pi.Account    = pmpaym.rec.PayerAccount;
      pi.Amount     = pmpaym.rec.Amount;
      pi.FIID       = pmpaym.rec.FIID;
      pi.ClientName = pmrmprop.rec.PayerName;
      DebetPIList.value(0) = pi;
    else
      payment = RsbPayment( pmpaym.rec.PaymentID );
      FillPIList( DebetPIList, payment, PRT_Debet );
    end;

    CreditPIList = TArray;
    if( pmpaym.rec.ReceiverAccount )
      pi = TPayInstruction();
      pi.Account    = pmpaym.rec.ReceiverAccount;
      if(pmpaym.rec.FIID == pmpaym.rec.PayFIID)
        pi.Amount = NOT_PRINT_AMOUNT;
        pi.FIID   = NOT_PRINT_FIID;
      else
        pi.Amount = pmpaym.rec.PayAmount;
        pi.FIID       = pmpaym.rec.PayFIID;
      end;
      pi.ClientName = pmrmprop.rec.ReceiverName;
      CreditPIList.value(0) = pi;
    else
      if( payment == NULL )
        payment = RsbPayment( pmpaym.rec.PaymentID );
      end;
      FillPIList( CreditPIList, payment, PRT_Credit );
    end;
  
  END;
  
  /* -----------------------------------
     è‡Æ®≠®Ê®†´®ß®‡Æ¢†‚Ï §†≠≠Î¨® Ø‡Æ¢Æ§™®
     ----------------------------------- */
  MACRO InitByCarry( document:TRecHandler )
  
    private var _Priority     =  0,
                PayerName     = "",
                ReceiverName  = "";
    GetPaymentAttrByCarry(document.rec.AccTrnID, @_Priority, @PayerName, @ReceiverName);

    Number       = document.rec.Numb_Document;
    DocumentDate = document.rec.Date_Carry;
    BaseAmount   = document.rec.Sum_Payer;
    BaseFIID     = document.rec.FIID_Payer;
    ShifrOper    = "17";
    Ground       = document.rec.Ground;
    Priority     = _Priority;
    TypeDocument = document.rec.TypeDocument;
    Amount       = document.rec.Sum_Payer;
    FIID         = document.rec.FIID_Payer;
    PrintType    = PRINT_BY_CARRY;
    
    var pi:TPayInstruction;
    
    pi = TPayInstruction();
    pi.Account    = document.rec.Account_Payer;
    pi.Amount     = document.rec.Sum_Payer;
    pi.FIID       = document.rec.FIID_Payer;
    pi.ClientName = IfThenElse( PayerName != "", 
                                PayerName      ,
                                GetClientFullName( document.rec.Chapter, document.rec.FIID_Payer, document.rec.Account_Payer ) );
    DebetPIList = TArray;
    DebetPIList.value(0) = pi;

    pi = TPayInstruction();
    pi.Account    = document.rec.Account_Receiver;
    pi.Amount     = IfThenElse( document.rec.FIID_Payer == document.rec.FIID_Receiver, NOT_PRINT_AMOUNT, document.rec.Sum_Receiver );
    pi.FIID       = IfThenElse( ( ( document.rec.FIID_Receiver == 0/*NATCUR*/ ) or 
                                  ( document.rec.FIID_Payer    == document.rec.FIID_Receiver ) ), NOT_PRINT_FIID, document.rec.FIID_Receiver );
    pi.ClientName = IfThenElse( ReceiverName != "", 
                                ReceiverName      ,
                                GetClientFullName( document.rec.Chapter, document.rec.FIID_Receiver, document.rec.Account_Receiver ) );
   
    PayAmount = document.rec.Sum_Receiver;
    PayFIID   = document.rec.FIID_Receiver;
    CreditPIList  = TArray;
    CreditPIList.value(0) = pi;

  END;

END;

/* -----------------------------------------------
   ç•ØÆ·‡•§·‚¢•≠≠Æ Ø•Á†‚Ï ØÆ ØÆ§£Æ‚Æ¢´•≠≠Î¨ §†≠≠Î¨
   ----------------------------------------------- */

PRIVATE MACRO DoPrintBankOrder( data:TBankOrderPrintData, ncopy:integer ):bool

  private macro GetSumNatCur(TrnId:integer):money
    var sqlString, rs, cmd, Summ;
    sqlString = " select acctrn.t_Sum_NatCur from dacctrn_dbt acctrn where acctrn.t_AcctrnId = " + TrnId;
    cmd = RSDCommand( sqlString );
    rs = RsdRecordset( cmd );
    if( rs AND rs.moveNext() )
      Summ  = rs.value(0);
    end;
    return Summ;
  end;

  private macro PrintSumSubEq(data:TBankOrderPrintData):bool                                                             
    var stat = 0, RegValue;
    GetRegistryValue( "COMMON\\èÖóÄíú\\éêÑÖê\\ÇõÇéÑàíú_ùäÇàÇÄãÖçí", V_BOOL, RegValue, stat ); 
    if(RegValue)
      if ((data.PrintType == PRINT_BY_PAYMENT) and (data.FIID != data.PayFIID))
        return true;
      elif ((data.PrintType == PRINT_BY_CARRY) and (data.FIID != NATCUR))
        return true;
      else
        return false;
      end;
    else
      return false;
    end;    
  end;

  MACRO PrintPayInstructions( PIList:TArray )
    array aClientName;
    var i:integer = 0, j:integer, nrows:integer = 0, fiCode:string, Amount:string, stat = 0, isDigit = FALSE;
    if( ( GetRegistryValue( "COMMON\\èÖóÄíú\\éêÑÖê\\ÑêéÅçÄü_óÄëíú_ñàîêÄåà", V_BOOL, isDigit, stat ) == V_INTEGER ) and 
        ( stat == 0 ) )
      isDigit = FALSE;
    end;


    while( i < PIList.size )
      asize( aClientName, 0 );
      StrSplit( PIList.value( i ).ClientName, aClientName, 37, 37, 1 );
      if( (PIList.value( i ).FIID == NATCUR) or (PIList.value( i ).FIID == NOT_PRINT_FIID))
        fiCode = "";
      else
        fiCode = GetFICode( PIList.value( i ).FIID, null, FICK_ISOSTRING );
      end;
      if(PIList.value( i ).Amount == NOT_PRINT_AMOUNT)
        Amount = "";
      else
        Amount = string(PIList.value( i ).Amount:f);
        if( ( SubStr( Amount, StrLen( Amount ) - 2 ) == "-00" ) and ( isDigit == FALSE ) )
          Amount = SubStr( Amount, 1, StrLen( Amount ) - 3 ) + "=  ";
        end;
      end;
      [#####################################≥ ####################### ≥#################≥ ###]
      ( aClientName( 0 ):l,
        PIList.value( i ).Account:f,
        Amount:r,
        fiCode );
      j = 1;
      while( j < asize( aClientName ) )
        [#####################################≥                         ≥                 ≥    ]
        ( aClientName( j ):l );
        j = j + 1;
      end;
      nrows = nrows + asize( aClientName );
      i = i + 1;
    end;

    while( nrows < 4 )
      [                                     ≥                         ≥                 ≥    ];
      nrows = nrows + 1;
    end;

  END;
  
  array aBaseAmount, aGround, RubEq;

  var val;
  var i:integer = 0, stat;
  var SameFIID:bool = false;
  var tempsum:money =$0;
  var SummRub:money = $0;
  var Sum1,Sum2:money = $0;
  var isDigit = false;
  var tmp: string;

  if( ( GetRegistryValue( "COMMON\\èÖóÄíú\\éêÑÖê\\ÑêéÅçÄü_óÄëíú_ñàîêÄåà", V_BOOL, isDigit, stat ) == V_INTEGER ) and 
      ( stat == 0 ) )
    isDigit = FALSE;
  end;
  
  if (data.IsDebrazn)                                     
    while (i < data.DebetPIList.size-1)
      if (data.DebetPIList[i].FIID == data.DebetPIList[i+1].FIID)
        SameFIID = true;  
      else
        SameFIID = false;
        break;
      end;
      i= i + 1; 
    end;
    i = 0;
    if (SameFIID)        
      while (i < data.DebetPIList.size)
        tempsum = tempsum + data.DebetPIList[i].Amount;
      i = i + 1;
      end;
      val = data.DebetPIList[0].FIID;
    elif (not SameFIID)
      tempsum = data.PayAmount;
      val = data.PayFIID;
    end;
  else
    tempsum = data.Amount;
    val = data.FIID;
  end;

  tmp = CurToStrAlt( tempsum, null, null, int(GetFICode(val, null, FICK_ISONUMBER )));
  if((not isDigit) and (tempsum == int(tempsum)))
    tmp = substr(tmp, 1, index(tmp, " 00"));
  end;
  StrSplit( tmp, aBaseAmount, 67, 67, 3 );

  if (PrintSumSubEq(data))
    if (data.PrintType == PRINT_BY_CARRY)
      ConvSum( SummRub, tempsum, data.DocumentDate, val, NATCUR );
    elif(data.PrintType == PRINT_BY_PAYMENT)
      var carries : TArray;
      var carry   : TPaymentCarryInfo;
      carries = PM_GetAllCarries( data.PaymentId, 1 ); /*CHAPT1*/              
      if( carries.size )
        i = 0;
        tempsum = 0;
        while (i < carries.size)                   
          carry = carries[i];
          tempsum = tempsum + GetSumNatCur(carry.ACCTRNID);
          i = i + 1;
        end;
        SummRub = tempsum;
      else

        if ((data.FIID != data.PayFIID) and (data.FIID !=NATCUR) and (data.PayFIID != NATCUR))
          ConvSum( Sum1, data.Amount, data.DocumentDate, data.FIID, NATCUR );
          ConvSum( Sum2, data.PayAmount, data.DocumentDate, data.PayFIID, NATCUR );    
          SummRub = min(Sum1, Sum2);

        elif ((data.FIID == data.PayFIID) and (data.FIID !=NATCUR) and (data.PayFIID != NATCUR)) 
          ConvSum( SummRub, data.Amount, data.DocumentDate, data.FIID, NATCUR );

        elif ((data.FIID != data.PayFIID) and (data.FIID == NATCUR))
          if (data.MinimizationTurn == SET_CHAR)
            ConvSum( Sum1, data.PayAmount, data.DocumentDate, data.PayFIID, NATCUR );
            SummRub = min(Sum1, data.Amount);
          else
            SummRub = data.Amount;
          end;

        elif ((data.FIID != data.PayFIID) and (data.PayFIID == NATCUR))
          if (data.MinimizationTurn == SET_CHAR)
            ConvSum( Sum1, data.Amount, data.DocumentDate, data.FIID, NATCUR );
            SummRub = min(Sum1,data.PayAmount);
          else
            SummRub = data.PayAmount;
          end;
        elif (data.IsDebetrazn) 
          tempsum = 0;
          Sum1 = 0;
          while (i < data.DebetPIList.size)
            ConvSum( Sum1, data.DebetPIList[i].Amount, data.DocumentDate, data.DebetPIList[i].FIID, NATCUR );
            tempsum = tempsum + Sum1;
            i = i + 1;
          end;
          SummRub = tempsum;
        elif (data.IsCredrazn)
          tempsum = 0;
          Sum1 = 0;
          while (i < data.CreditPIList.size)
            ConvSum( Sum1, data.CreditPIList[i].Amount, data.DocumentDate, data.CreditPIList[i].FIID, NATCUR );
            tempsum = tempsum + Sum1;
            i = i + 1;
          end;
          SummRub = tempsum;          
        end;
      end;   
    end;
    tmp = RubToStrAlt(SummRub, NULL, NULL);
    if((not isDigit) and (SummRub == int(SummRub)))
      tmp = substr(tmp, 1, index(tmp, " 00"));
    end;
    StrSplit(tmp, RubEq, 63, 63, 2);
  else
    StrSplit(" ", RubEq, 63, 63, 2);    
  end;

  StrSplit( data.Ground, aGround, 63, 63, 8 );

  while( ncopy > 0 )

    [                                                                                      ⁄ƒƒƒƒƒƒƒƒƒø
                                                                                           ≥ 0401067 ≥
                                                                                           ¿ƒƒƒƒƒƒƒƒƒŸ
        ############## ÅÄçäéÇëäàâ éêÑÖê ¸ ###############      ##########
                                                          ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ
                                                                   Ñ†‚†

     ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒ
     ë„¨¨†     ≥ ################################################################### ≥Ç®§ ÆØ.   ≥  ##
     Ø‡ÆØ®·ÏÓ  ≥ ################################################################### √ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒ
               ≥ ################################################################### ≥éÁ•‡.Ø´†‚.≥  ##
     ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒ
               è´†‚•´ÏÈ®™                 ≥          ëÁ•‚ ¸         ≥               ë„¨¨†             
                                          ≥                         ≥
     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ]
    ( IfThenElse( IsCORRECTING( data.TypeDocument ), "àëèêÄÇàíÖãúçõâ", "              " ),
      data.Number:l, data.DocumentDate:f,
      aBaseAmount( 0 ):l, data.ShifrOper,
      aBaseAmount( 1 ):l,
      aBaseAmount( 2 ):l, data.Priority:l );

    PrintPayInstructions( data.DebetPIList );
    
    [ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥                 ≥
               èÆ´„Á†‚•´Ï                 ≥          ëÁ•‚ ¸         ≥                 ≥
                                          ≥                         ≥                 ≥
     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥                 ≥];

    PrintPayInstructions( data.CreditPIList );
    
    [ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ
                           ç†ß≠†Á•≠®• Ø´†‚•¶†                       ≥
                                                                    ≥
     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ
     ###############################################################≥           é‚¨•‚™® °†≠™†         
     ###############################################################≥
     ###############################################################≥
     ###############################################################≥
     ###############################################################≥
     ###############################################################≥
     ###############################################################≥
     ###############################################################≥
     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥             ØÆ§Ø®·®             
     ###############################################################≥
     ###############################################################≥
                                                                    ≥]
    ( aGround( 0 ), 
      aGround( 1 ), 
      aGround( 2 ), 
      aGround( 3 ), 
      aGround( 4 ), 
      aGround( 5 ), 
      aGround( 6 ), 
      aGround( 7 ),
      RubEq( 0 ),          
      RubEq( 1 ) );

    ncopy = ncopy - 1;

  end;

  return true;

END;

/* ----------------------------------------------------------------------
   ÇÎßÆ¢ Ø•Á†‚® °†≠™Æ¢·™Æ£Æ Æ‡§•‡† ®ß §‡„£®Â ¨†™‡Æ·Æ¢.
   ---------------------------------------------------------------------- */
MACRO PrintBankOrder( ncopy:integer ):bool

  var isPrintEOF:bool;               // è•Á†‚Ï ·®¨¢Æ´† Æ™Æ≠Á†≠®Ô ´®·‚†
  if( not GetParm( 1, isPrintEOF ) ) // ØÆ „¨Æ´Á†≠®Ó Ø•Á†‚†‚Ï ≠†§Æ
    isPrintEOF = true;
  end;        
  var stat = 0;
  var data:TBankOrderPrintData = TBankOrderPrintData();
  
  if(pr_document.rec.AccTrnID > 0)
    data.InitByCarry( pr_document );
  elif(pr_pmpaym.rec.PaymentID > 0) 
    data.InitByPayment( pr_pmpaym, pr_pmrmprop );
  end;
  if( pr_PrintEA )
    PrintEAHeader();
  end;

  stat = DoPrintBankOrder( data, ncopy );
  if( isPrintEOF )
    PrintEOF();
  end;
  return stat;
END;
