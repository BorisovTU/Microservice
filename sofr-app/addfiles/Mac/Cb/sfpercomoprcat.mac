Import RsbDataSet, SFInter, "sfbatch_lib.mac"; // "sfcomcat.mac"

record SfSrvDocRec("sfsrvdoc.dbt");

macro MassExecuteStep()
  var stat:integer = 0;
  var strSql, cmd, rs;
  var catAccCharger = TSfDefCatAccCharger(SfSrvDocRec.DatePay, SF_FEE_TYPE_PERIOD);
  var isNVPI = false;
  var catAccParam;
  var oprID_Operation = 0; 
  var oprID_Step      = 0; 

  record SfContr(sfcontr);
  record ConCom(sfconcom);
  record SfDef(sfdef);

  var SfAccrueRegVal = SfComAccrueGetRegValue();
  var needAccrue = false;
  if((SfAccrueRegVal == 0 /*SFCOM_ACCRUE_ALWAYS*/) OR (SfSrvDocRec.Kind == 1)) // SFSRVDOC_KIND_ACCRUE = 1
    needAccrue = true;
  end;

  stat = SFCreateCatBatch( SF_FEE_TYPE_PERIOD, needAccrue, SfAccrueRegVal, SfSrvDocRec.DatePay );

  if(stat == 0)
    stat = SfPercomSetOprStatus(SfSrvDocRec);
  end;

  if(stat == 0)
    stat = SfPercomSetOprDates(SfSrvDocRec);
  end;

  return stat;
end;
