/*
$Name:        sfbnkclm.mac
$Module:      РКО (ПЗО)  
$Description: Оплата методом "требование банка"
*/


import sfcommon, InsCarryDoc, sfpaym;

/*Содрано с платежа банка отличается memorder.DocKind*/
macro SfFormBankClaim( sidebet, sicredit, sfcomiss, PayDate, ground, paySum, taxSum, FIID, 
                       PlusCalc_Account, PlusCalcNDS_Account, DefComID, payParams )

  var Payment     : RsbPayment;
  var BankPaym    : RsbBankPaymentBase;
  var Number      : string;
  var RefID;

  if( sidebet.Rec.BankCode != "" )
    MsgBox("При оплате ПЗО требованием банка|плательщик должен быть в нашем банке");
    return 1;
  end;

  BankPaym = RsbBankClaim(0);
  Payment = BankPaym.Payment;

  BankPaym.Origin     = MEMORDER_FDOC_SF;
  BankPaym.Oper       = {oper}; 
  BankPaym.Status     = 1 /*MEMORDER_STATUS_POST*/;

  Payment.DocKind     = DLDOC_BANKCLAIM;
  Payment.DemandAcceptTerm = PM_DEMAND_TERM_WITHOUTACCEPT;
  Payment.DemandAccept     = PM_DEMAND_ACCEPT_NONE;       

  if( SfFillPayment( Payment, sidebet, sicredit, sfcomiss, PayDate, paySum, taxSum, FIID, 
                     PlusCalc_Account, PlusCalcNDS_Account, paySum )) 
    return 1; 
  end;

  if( SfFillBankPayment( Payment, PayDate ))
    return 1; 
  end;


  if( ground == "" )
    Payment.Ground = "Комиссия за обслуживание";
  else
    Payment.Ground = ground;
  end;

  if( SfPayDocGetRefNumber(@Payment.Number, payParams) != 0 )
    return 1;
  end;

  Payment.FeeType = sfcomiss.feeType;
  if( DefComID != null )
    Payment.DefComID = DefComID;
  end;

  return 0;

end;
