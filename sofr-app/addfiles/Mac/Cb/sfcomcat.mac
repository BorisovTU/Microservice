/*
$Name:        sfcomcat.mac
$Module:      ПЗО  
$Description: Макрос формирования документов оплаты по разовой комиссии
*/


/*                                                                          */
/*                         R-Style SoftWare Lab                             */
/*                                                                          */
/****************************************************************************/
/*                       Подсистема "ГКБО"                                  */
/*                                                                          */
/*                             ПЗО                                          */
/*                                                                          */
/*                                                                          */
/*  Имя файла: sfcomcat.mac                                                 */
/*  Создан: 24.07.2007                                               СолАН  */
/*                                                                          */
/****************************************************************************/

import sfcommon, PTInter, rsd, "globals.mac", oralib, "RegvalReader.mac";
import "role_model.mac", "mctplprm.mac";//ролевая модель

macro SfIsOurFilial( ReceiverID )
  
  var rs;
  
  rs = RsdRecordset( "SELECT T_PARTYID FROM DDP_DEP_DBT WHERE T_PARTYID = " + ReceiverID );
                    
  if( rs.movenext )    
    return true;   
  end;

  return false;

end;


macro CountComissAsIncome( DateCarry, debetFIID, debetAccount, creditFIID, creditAccount, Sum, Ground, 
                           TypeDocument, EqSumPayer, OperationID, StepID, linkKind, objectType, objectBuf )    

  var ret = 0;

  var Doc = RsbAccTransaction;

  if( (Sum > $0) OR ((EqSumPayer != NULL) AND (EqSumPayer > $0)) )

    Doc.Chapter    = 1;
    Doc.Date_Carry = DateCarry;   
    Doc.Ground     = Ground;
   
    Doc.SumPayer    = Sum;    

    Doc.FIIDPayer       = debetFIID;   
    Doc.AccountPayer    = debetAccount;
 
    Doc.FIIDReceiver    = creditFIID;   
    Doc.AccountReceiver = creditAccount;   

    Doc.Department = {OperDprt};

   /* Определяем конечного операциониста для проводки */
    if(linkKind == SFDOCS_LINKKIND_COMISSOVERDUE) //Проводки по выносу на просрочку
      Doc.Oper = GetMainOperInGroup(SFCONTR_DOC);
      if(Doc.Oper <= 0)
        Doc.Oper = {Oper};
      end;
      Doc.Number_Pack = 10;
    elif(index(strUpr(Ground),"ОФЕРТ") > 0) //Определение операциониста по разовым комиссиям за оферту
      Doc.Oper = GetMainOperInGroup(159);
      if(Doc.Oper <= 0)
        Doc.Oper = {Oper};
      end;
      Doc.Number_Pack = 10;
    elif((strUpr(Ground) == "УПЛАТА КОМИССИИ БИРЖЕ.") or (index(strUpr(Ground),"КОМИССИЯ ЗА КЛИРИНГ ПРИ ИСПОЛНЕНИИ ФЬЮЧЕРСНЫХ КОНТРАКТОВ") > 0)) //Применим ролевую модель для срочного рынка через комиссии передадим кайнд 194
      Doc.Oper = GetMainOperInGroup(194,12600);
      if(Doc.Oper <= 0)
        Doc.Oper = {Oper};
      end;
      Doc.Number_Pack = 40;
    end;
      
    if(TypeDocument != NULL)
      Doc.TypeDocument = TypeDocument;
    end;

    if( EqSumPayer != NULL )
      Doc.SumEqPayer = EqSumPayer;
    end;

    if( (OperationID != NULL) AND (StepID != NULL) )
      Doc.ID_Operation = OperationID;
      Doc.ID_Step = StepID;
    end;

    if( not Doc.Carry() )
      ret = 1;
      msgbox( "Ошибка при вставке проводки" );
    else
      if( (linkKind != NULL ) AND (objectType != NULL) AND (objectBuf != NULL) )
        SfPay_ConnectSfDocs( linkKind, objectType, objectBuf, Doc.AccTrnID, Doc.ID_Operation, Doc.ID_Step );
      end;
    end; 
  
  end;

  return ret;

end;


class SfComPrimDoc( DocKind, SfContr )
  /* данные класса ---------------------------------------------------- */  
  private var ServKind;
  private var PartyID;
  private var Department;

  private var FIRoleBArray = TArray;

  var Error = 0, Kind, ID;

  /* вернуть параметр второго рода ------------------------------------ */ 
  macro GetParametr( ParmKind, OperDate, CatCode, FIRole )
    var Parametr = -1;
    
    if( ParmKind == MC_TYPE_PARAMETR_CONTRACTOR )
      Parametr = PartyID;  /*контрагентом является плательщик по договору*/
    elif( ParmKind == MC_TYPE_PARAMETR_DEPARTMENT )
      Parametr = Department;
    end;

    return Parametr;
  end; 

  /* вернуть параметр первого рода ------------------------------------ */ 
  macro GetParametrTemplate( ObjectID, Classificator, OperDate, FIRole )
    var Parametr = -1;

    /* значение параметра БэкОфисКУ выбирается по виду обслуживания договора */
    if( Classificator == LLCLASS_BACKOFFICE )

      if( ServKind == PTSK_STOCKDL )  /* Ценные бумаги - Фондовый дилинг */
        Parametr = 5;
      
      elif( ServKind == PTSK_PAY )  /* PKO */
        Parametr = 9;

      /*elif( ServKind == PTSK_CREDIT )  /* MБK - Кредиты юр.лиц */
        Parametr = 2;*/

      elif( ServKind == PTSK_DEPOS )  /* Депозитарное обслуживание */
        Parametr = 10;

      elif( ServKind == PTSK_SVO )  /* Сектор вексельного обращения */
        Parametr = 1;

      elif( ServKind == PTSK_VEKSACC )  /* Учтенные векселя */
        Parametr = 7;

      elif( ServKind == PTSK_DV )  /* ПИ - производные инструменты */
        Parametr = 8;

      /* elif( ServKind == <конверcионные операции> )
         Parametr =  3;
      */ 
      end;

    end;

    return Parametr;
  end;

  /* остновная роль фИ ------------------------------------------------ */
  macro GetBasisFIRole(FIRole)
    return FIROLE_UNDEF;
  end;

/* вернуть весь базис ролей ----------------------------------------- */
  macro GetFIRoleBArray()
    return FIRoleBArray;
  end;

/* найти/открыть счет ---------------------------------------------- */
  macro FindAndOpenAccount( CatCode : string, DateCarry : date, Currency : integer )
    return MC_FindAndOpenAccount( CatCode, this, DateCarry, IsOprMultiExec(), MC_OPENACC_CREATE, null, Currency, null, MC_PAIRACCMODE_MANUAL );
  end;


/* найти счет ------------------------------------------------------- */
  macro FindAccount( CatCode : string, DateCarry : date, Currency : integer )
    return MC_FindAndOpenAccount( CatCode, this, DateCarry, IsOprMultiExec(), MC_OPENACC_ACT, null, Currency, null, MC_PAIRACCMODE_MANUAL );
  end;

  /* Корректировка счета ---------------------------------------------- */
   MACRO CorrectAccount( account, accblnc, ORScheme, categ, templ, accdoc, OperDate )
      return true;
   END;

  /* Конструктор */
   Kind = DocKind;
   ID   = SfContr.ID;
   
   ServKind = SfContr.ServKind;
   PartyID  = SfContr.PartyID;
   Department = SfContr.Department;
   
   FIRoleBArray[0] = 0;
/* ------------------------------------------------------------------ */

end; 

class SfConComPrimDoc( DocKind, SfConCom, SfContr, FIID_Sum )
  /* данные класса ---------------------------------------------------- */  
  private var ServKind;
  private var PartyID;
  private var Department;
  private var feeType;

  private var CurrencyEQ;
  private var CurrencyEQ_RateType;
  private var CurrencyEQ_RateDate;
  private var CurrencyEQ_RateExtra;

  private var FIRoleBArray = TArray;
 
  var sfcomiss  = TBFile("sfcomiss.dbt");  

  var Error = 0, Kind, ID;

  /* вернуть параметр второго рода ------------------------------------ */ 
  macro GetParametr( ParmKind, OperDate, CatCode, FIRole )
    var Parametr = -1;
    
    if( ParmKind == MC_TYPE_PARAMETR_CONTRACTOR )
      Parametr = PartyID;  /*контрагентом является плательщик по договору*/
    elif( ParmKind == MC_TYPE_PARAMETR_DEPARTMENT )
      Parametr = Department;
    elif( ParmKind == MC_TYPE_PARAMETR_CURRENCYEQ )
      Parametr = CurrencyEQ;    
    elif( ParmKind == MC_TYPE_PARAMETR_CURRENCYEQ_RATETYPE )
      Parametr = CurrencyEQ_RateType;
    elif( ParmKind == MC_TYPE_PARAMETR_CURRENCYEQ_RATEDATE )
      Parametr = CurrencyEQ_RateDate;
    elif( ParmKind == MC_TYPE_PARAMETR_CURRENCYEQ_RATEEXTRA )
      Parametr = CurrencyEQ_RateExtra;
    end;

    return Parametr;
  end; 

  /* вернуть параметр первого рода ------------------------------------ */ 
  macro GetParametrTemplate( ObjectID, Classificator, OperDate, FIRole )
    var Parametr = -1;

    /* значение параметра БэкОфисКУ выбирается по виду обслуживания договора */
    if( Classificator == LLCLASS_BACKOFFICE )

      if( ServKind == PTSK_STOCKDL )  /* Ценные бумаги - Фондовый дилинг */
        Parametr = 5;
      
      elif( ServKind == PTSK_PAY )  /* PKO */
        Parametr = 9;

      /*elif( ServKind == PTSK_CREDIT )  /* MБK - Кредиты юр.лиц */
        Parametr = 2;*/

      elif( ServKind == PTSK_DEPOS )  /* Депозитарное обслуживание */
        Parametr = 10;

      elif( ServKind == PTSK_SVO )  /* Сектор вексельного обращения */
        Parametr = 1;

      elif( ServKind == PTSK_VEKSACC )  /* Учтенные векселя */
        Parametr = 7;

      elif( ServKind == PTSK_DV )  /* ПИ - производные инструменты */
        Parametr = 8;

      /* elif( ServKind == <конверcионные операции> )
         Parametr =  3;
      */ 
      end;

    end;

    return Parametr;
  end;

  /* остновная роль фИ ------------------------------------------------ */
  macro GetBasisFIRole(FIRole)
    return FIROLE_UNDEF;
  end;

/* вернуть весь базис ролей ----------------------------------------- */
  macro GetFIRoleBArray()
    return FIRoleBArray;
  end;

  macro FindAndOpenAccountEx( CatCode:string, DateCarry:date, Currency:integer, ID_Operation:integer, ID_Step:integer )
    var AccCat : RsbAccCategory;
        
    AccCat.PrimaryDoc = this;
    AccCat.ActionDate = DateCarry;
    AccCat.IsMass = IsOprMultiExec();
    AccCat.OpenMode = MC_OPENACC_CREATE;    
    AccCat.CurryCurrency = Currency;
    AccCat.ORScheme = null;
    AccCat.PairAccMode = MC_PAIRACCMODE_MANUAL;    
    
    return AccCat.FindAndOpenAccount( CatCode, ID_Operation, ID_Step );
  end;

/* найти/открыть счет ---------------------------------------------- */
  macro FindAndOpenAccount( CatCode:string, DateCarry:date, Currency:integer, ID_Operation:integer, ID_Step:integer )
    if( ((ID_Operation == null) OR (ID_Operation == 0)) OR ((ID_Step == null) OR (ID_Step == 0)) )
      return MC_FindAndOpenAccount( CatCode, this, DateCarry, IsOprMultiExec(), MC_OPENACC_CREATE, null, Currency, null, MC_PAIRACCMODE_MANUAL );
    else
      return FindAndOpenAccountEx( CatCode, DateCarry, Currency, ID_Operation, ID_Step );
    end;
  end;


/* найти счет ------------------------------------------------------- */
  macro FindAccount( CatCode : string, DateCarry : date, Currency : integer )
    return MC_FindAndOpenAccount( CatCode, this, DateCarry, IsOprMultiExec(), MC_OPENACC_ACT, null, Currency, null, MC_PAIRACCMODE_MANUAL );
  end;

  /* Корректировка счета ---------------------------------------------- */
   MACRO CorrectAccount( account, accblnc, ORScheme, categ, templ, accdoc, OperDate )
      return true;
   END;

   macro GetDefComSfSiAccount( defComID:integer, kindSfSi:integer, CatName:string, ActionDate:date, 
                               Currency:integer, SfSi:@TRecHandler )
     return GetDefComSfSi( feeType, defComID, kindSfSi, CatName, this, ActionDate, Currency, SfSi );
   end;

  /* Конструктор */
   Kind = DocKind;
   ID   = SfConCom.ID;
   
   ServKind = SfContr.ServKind;
   PartyID  = SfContr.PartyID;
   Department = SfContr.Department;
   feeType = SfConCom.feeType;

   if( SfConCom.FeeType == 1 ) 
     CurrencyEQ = FIID_Sum;
     CurrencyEQ_RateType = SfContr.PayRateID;
     if( SfContr.PayRateDateKind == 3 )  /*SFINV_RATEDATEKIND_PAYDAY = 3  // Оплаты - 1 день*/    
       CurrencyEQ_RateDate = 1;
     else 
       CurrencyEQ_RateDate = 0;
     end;
     CurrencyEQ_RateExtra = money(SfContr.PayRatePercent);
   elif( SfConCom.FeeType == 3 ) /*OBJTYPE_OPRSFCOM   = 665, // Удержанная единовременная комиссия*/
     CurrencyEQ = FIID_Sum;
     sfcomiss.rec.feeType = SfConCom.FeeType;
     sfcomiss.rec.number  = SfConCom.CommNumber;  
     if( sfcomiss.GetEQ )
       CurrencyEQ_RateType = sfcomiss.rec.RateType;
     else
       CurrencyEQ_RateType = 0;
     end;     
     CurrencyEQ_RateDate = 0;
     CurrencyEQ_RateExtra = $0;
   end;
   
   FIRoleBArray[0] = 0;
/* ------------------------------------------------------------------ */

end;

class (SfConComPrimDoc)   SfConComPrimDocFix( DocKind, SfConCom, SfContr, FIID_Sum )
  /* данные класса ---------------------------------------------------- */  

  sfcomiss  = TBFile("sfcomiss.dbt");  
  FIRoleBArray = TArray;

  /* вернуть параметр первого рода ------------------------------------ */ 
  macro GetParametrTemplate( ObjectID, Classificator, OperDate, FIRole )
    var Parametr = -1;
    /* значение параметра БэкОфисКУ выбирается по виду обслуживания договора */
    if( Classificator == LLCLASS_BACKOFFICE )
      if( ServKind == PTSK_STOCKDL )  /* Ценные бумаги - Фондовый дилинг */
        Parametr = 5;
      elif( ServKind == PTSK_PAY )  /* PKO */
        Parametr = 9;
      elif( ServKind == PTSK_DEPOS )  /* Депозитарное обслуживание */
        Parametr = 10;
      elif( ServKind == PTSK_SVO )  /* Сектор вексельного обращения */
        Parametr = 1;
      elif( ServKind == PTSK_VEKSACC )  /* Учтенные векселя */
        Parametr = 7;
      elif( ServKind == PTSK_DV )  /* ПИ - производные инструменты */
        Parametr = 8;
      end;
    elif( Classificator == LLCLASS_UNCS_FITYPE )  
      if (/*this.*/currencyeq == natcur)
        parametr = 1;
      else
        parametr = 0;  
      end;
    elif( Classificator == LLCLASS_CAT_CONTR )  
      Parametr = MC_GetKindSecurCatContr( /*this.*/partyid );    
    end;

    return Parametr;
  end;


  /* Конструктор */
   Kind = DocKind;
   ID   = SfConCom.ID;
   
   ServKind = SfContr.ServKind;
   PartyID  = SfContr.PartyID;
   Department = SfContr.Department;
   feeType = SfConCom.feeType;

   if( SfConCom.FeeType == 1 ) 
     CurrencyEQ = FIID_Sum;
     CurrencyEQ_RateType = SfContr.PayRateID;
     if( SfContr.PayRateDateKind == 3 )  /*SFINV_RATEDATEKIND_PAYDAY = 3  // Оплаты - 1 день*/    
       CurrencyEQ_RateDate = 1;
     else 
       CurrencyEQ_RateDate = 0;
     end;

     CurrencyEQ = FIID_Sum;
     sfcomiss.rec.feeType = SfConCom.FeeType;
     sfcomiss.rec.number  = SfConCom.CommNumber;  
     if( sfcomiss.GetEQ )
       CurrencyEQ_RateType = sfcomiss.rec.RateType;
     else
       CurrencyEQ_RateType = 0;
     end;     

     CurrencyEQ_RateExtra = money(SfContr.PayRatePercent);
   elif( SfConCom.FeeType == 3 ) /*OBJTYPE_OPRSFCOM   = 665, // Удержанная единовременная комиссия*/
     CurrencyEQ = FIID_Sum;
     sfcomiss.rec.feeType = SfConCom.FeeType;
     sfcomiss.rec.number  = SfConCom.CommNumber;  
     if( sfcomiss.GetEQ )
       CurrencyEQ_RateType = sfcomiss.rec.RateType;
     else
       CurrencyEQ_RateType = 0;
     end;     
     CurrencyEQ_RateDate = 0;
     CurrencyEQ_RateExtra = $0;
   end;
   
   FIRoleBArray[0] = 0;
/* ------------------------------------------------------------------ */
end;


/*Класс первичного документа по удержанной разовой комиссии*/
class SfSingDfPrimDoc( DocKind, SfSingDf )
  /* данные класса ---------------------------------------------------- */  
  private var ServKind;
  private var PartyID;
  private var Department;
  private var feeType;

  private var serviceType:integer; //общий пул, обособленные физики или обособленные юрики

  private var CurrencyEQ;
  private var CurrencyEQ_RateType;
  private var CurrencyEQ_RateDate;
  private var CurrencyEQ_RateExtra;

  private var FIRoleBArray = TArray;
 
  var sfcomiss  = TBFile("sfcomiss.dbt");  

  var Error = 0, Kind, ID;

  private macro GetOfficeIdByCode(officeCode:integer):integer
    var query = "select o.t_officeid "
              + "  from dptoffice_dbt o "
              + " where o.t_officecode = :code";
    var sql = ExecSQLselectPrmDyn(query, officeCode);
    if (sql.MoveNext())
      return sql.value("t_officeid");
    end;
    return -1;
  end;

  /* вернуть параметр второго рода ------------------------------------ */ 
  macro GetParametr( ParmKind, OperDate, CatCode, FIRole )
    var Parametr = -1;
    
    if( ParmKind == MC_TYPE_PARAMETR_CONTRACTOR )
      Parametr = PartyID;  /*контрагентом является плательщик по договору*/
    elif( ParmKind == MC_TYPE_PARAMETR_DEPARTMENT )
      Parametr = Department;
    elif( ParmKind == MC_TYPE_PARAMETR_CURRENCYEQ )
      Parametr = CurrencyEQ;    
    elif( ParmKind == MC_TYPE_PARAMETR_CURRENCYEQ_RATETYPE )
      Parametr = CurrencyEQ_RateType;
    elif( ParmKind == MC_TYPE_PARAMETR_CURRENCYEQ_RATEDATE )
      Parametr = CurrencyEQ_RateDate;
    elif( ParmKind == MC_TYPE_PARAMETR_CURRENCYEQ_RATEEXTRA )
      Parametr = CurrencyEQ_RateExtra;
    elif( ParmKind == MC_TYPE_PARAMETR_MARKET_PLACE ) //Торговая площадка
      Parametr = 4; //ddlmarket_dbt.t_centr //НРД //TODO
    elif( ParmKind == MC_TYPE_PARAMETR_MARKET_PLACE_OFFICE ) //Сектор торговой площадки
      var officeCode:integer;

      //для категорий +-Биржа при условии выключенного обособления дс используются чуть более упрощённые правила
      if (serviceType == 1) //общий пул
        officeCode = 26;
      elif ( ((CatCode == "+Биржа") or (CatCode == "-Биржа")) and (not RegValReader.GetBool("РСХБ\\БРОКЕРСКОЕ ОБСЛУЖИВАНИЕ\\ИСП_ОБОСОБЛ_ДС", false)) )
        officeCode = 30;
      elif (serviceType == 2) //обособленные физики
        officeCode = 30;
      else //остальись обособленные юрики
        officeCode = 27;
      end;
      Parametr = GetOfficeIdByCode(officeCode);
    end;

    return Parametr;
  end; 

  /* вернуть параметр первого рода ------------------------------------ */ 
  macro GetParametrTemplate( ObjectID, Classificator, OperDate, FIRole )
    var Parametr = -1;
    var Contragent = GetParametr( MC_TYPE_PARAMETR_CONTRACTOR, OperDate, null, FIRole );
    /* значение параметра БэкОфисКУ выбирается по виду обслуживания договора */
    if( Classificator == LLCLASS_BACKOFFICE )

      if( ServKind == PTSK_STOCKDL )  /* Ценные бумаги - Фондовый дилинг */
        Parametr = 5;
      
      elif( ServKind == PTSK_PAY )  /* PKO */
        Parametr = 9;

      /*elif( ServKind == PTSK_CREDIT )  /* MБK - Кредиты юр.лиц */
        Parametr = 2;*/

      elif( ServKind == PTSK_DEPOS )  /* Депозитарное обслуживание */
        Parametr = 10;

      elif( ServKind == PTSK_SVO )  /* Сектор вексельного обращения */
        Parametr = 1;

      elif( ServKind == PTSK_VEKSACC )  /* Учтенные векселя */
        Parametr = 7;

      elif( ServKind == PTSK_DV )  /* ПИ - производные инструменты */
        Parametr = 8;

      /* elif( ServKind == <конверcионные операции> )
         Parametr =  3;
      */ 
      end;

    elif (Classificator == LLCLASS_CAT_CONTR) //1826
      Parametr = MC_GetKindSecurCatContr( Contragent );

    elif (Classificator == 1778) //ИстСредств
      Parametr = 2; //Клиентские
    end;

    return Parametr;
  end;

  /* остновная роль фИ ------------------------------------------------ */
  macro GetBasisFIRole(FIRole)
    return FIROLE_UNDEF;
  end;

  /* вернуть весь базис ролей ----------------------------------------- */
  macro GetFIRoleBArray()
    return FIRoleBArray;
  end;

  /* найти/открыть счет ---------------------------------------------- */
  macro FindAndOpenAccount( CatCode : string, DateCarry : date, Currency : integer )
    return MC_FindAndOpenAccount( CatCode, this, DateCarry, IsOprMultiExec(), MC_OPENACC_CREATE, null, Currency, null, MC_PAIRACCMODE_MANUAL );
  end;


  /* найти счет ------------------------------------------------------- */
  macro FindAccount( CatCode : string, DateCarry : date, Currency : integer )
    return MC_FindAndOpenAccount( CatCode, this, DateCarry, IsOprMultiExec(), MC_OPENACC_ACT, null, Currency, null, MC_PAIRACCMODE_MANUAL );
  end;

  /* Корректировка счета ---------------------------------------------- */
  MACRO CorrectAccount( account, accblnc, ORScheme, categ, templ, accdoc, OperDate )
    return true;
  END;

  macro GetDefComSfSiAccount( defComID:integer, kindSfSi:integer, CatName:string, ActionDate:date, 
                              Currency:integer, SfSi:@TRecHandler )
    return GetDefComSfSi( feeType, defComID, kindSfSi, CatName, this, ActionDate, Currency, SfSi );
  end;

  macro GetAccountClientID( Account, FIID )
    record AccRec ("account");
    var ClientID = 0;
    if( SfCommon_GetAccount(AccRec, Account, FIID, 1) == true )
      ClientID = AccRec.Client;
    end;    
    return ClientID;
  end;

  macro GetServiceType(sfid:integer, feeType:integer)
    var query = "select i.contract_service_type From sf_commiss_additional_info i where i.feetype = :feetype and i.sfdef_id = :sfdefid";
    var sql = ExecSQLselectPrmDyn(query, feeType, sfid);
    if (sql.MoveNext())
      return sql.value("contract_service_type");
    end;
    return 0;
  end;

  /* Конструктор */
  Kind = DocKind;
  ID   = SfSingDf.ID;

  sfcomiss.rec.feeType = SfSingDf.FeeType;
  sfcomiss.rec.number  = SfSingDf.CommNumber;   
  if( sfcomiss.GetEQ )   
    ServKind = sfcomiss.rec.ServiceKind;
  else
    ServKind = 0;
  end;

  PartyID  = this.GetAccountClientID( SfSingDf.AccountPayer, SfSingDf.FIIDPayer );
  serviceType = this.GetServiceType(SfSingDf.ID, SfSingDf.FeeType);

  Department = SfSingDf.Department;
  feeType = SfSingDf.feeType;
   
  CurrencyEQ = SfSingDf.FIID_paySum;
  CurrencyEQ_RateType = 0;
  CurrencyEQ_RateDate = 0;
  CurrencyEQ_RateExtra = $0;
   
  FIRoleBArray[0] = 0;
  /* ------------------------------------------------------------------ */
end; 

