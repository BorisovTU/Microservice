IMPORT PTinter, RSBDataSet, dl_plib, dlgCommon, funk, dl_kvlib; 
PRIVATE VAR d0, pId22, rs0, cmd22, {curdate}, sql0, flag, rs05, que, ppriz; 
PRIVATE VAR col22 = TArray();
PRIVATE VAR v_DealId = TArray(), v_count;

MACRO bfiid()
     sql0 = "select t_fiid pId22,t_name nam,t_ccy nam2, t_userfield1 priz from dfininstr_dbt where t_fi_kind in (1,6)  order by t_fiid ";
     cmd22 = RSDRecordset(sql0 , RSDVAL_CLIENT, RSDVAL_STATIC );
     
     MACRO EvProc222 (rs0, cmd22, id, key )
        if (cmd22 == DLG_INIT)       // Инициализация
            if (pId22 != "0")  // Надо найти запись
                v_count = 0;
                while ( (rs0.value ("pId22") != pId22) And (Not rs0.EOF) )  
                         if (ValType(rs0.value ("pId22")) == 26)
                             v_DealId(v_count) = 0;
                         else
                             v_DealId(v_count)= rs0.value ("pId22");
                         end;
                         rs0.Move(1, RELATIVE);
                         v_count = v_count + 1;
                end;
            end;
            GoToScroll(rs0, true);
        elif (cmd22 == DLG_KEY)
            pId22 = rs0.value ("pId22");
            if(DLG_KEY_ENTER == Key)
               if (rs0.value ("priz") == "X" )
                   ppriz = " ";
               else
                   ppriz = "X";
               end;
               que = "update dfininstr_dbt set t_userfield1 = '" + ppriz + "' where t_fiid = " + rs0.value ("pId22");
               rs05 = LnGetRecordSet(que);
               return CM_SELECT;
            elif(DLG_KEY_F5 == Key) 
               return CM_SELECT;
            end;
        end;
     END;

     AddCol (col22, 0, "nam","Валюта", 20);
     AddCol (col22, 1, "nam2","Код валюты", 10);
     AddCol (col22, 2, "priz","Признак не выполнять платеж", 29);  

     while(RunScroll(cmd22, 3, col22, null, @EvProc222,"Валюты для платежей на  ММВБ" ," Enter- Установка признака  ESC- Выход ", null, 10, 5) )
           cmd22 = RSDRecordset(sql0 , RSDVAL_CLIENT, RSDVAL_STATIC );
     end;

   exit(1);
END;




