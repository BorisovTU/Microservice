/*
*/
import InsCarryDoc, "dv_categ.mac", "dv_car.mac",dv_lib,funk,dv_kvlib;

macro ExecuteStep( doc, FDoc, DocKind, ID_Operation, ID_Step )

  record deal(dvndeal);
  var FD;
  var sta,bs,i;
  var ДатаИсполненияШага:date;
  var s_messok  = "Квитовка сообщения выполнена!";

  array masm;

    masm(0) = "  Автоматическая квитовка ";
    masm(1) = "  Ручная квитовка ";
    masm(2) = "  Принудительная  квитовка  ";


  SetBuff(deal, FDoc);
  FD = DVFirstDocFXDeal(DL_DVFXDEAL, deal);

  GetOprDate(DV_FXDEAL_OPRDATE_REQ, ДатаИсполненияШага);


   if (dmdm(deal.id) > 0)
       return 0;
   end;


    i=menu(masm," ESC - отмена, <Enter> - Квитовка ", "Выберите способ квитовки. ");
    if (i == (-2) )
	msgbox("Квитовка отложена!");
	return 1 ;
    elif (i == 0 )
/*
     	AutoKvit( tick.dealid );   
        if (IsExistKvit(tick.dealid))
           msgbox(s_messok);
           return 0;
        end;
*/
        return 1;


     elif (i == 1 )
	HandKvit( deal.id );   
        if (IsExistKvit(deal.id))
             msgbox(s_messok);
   	     return 0;		
        end;
        return 1;

    elif (i == 2 )
         msgbox("Принудительная квитовка !");
        return 0;
    end;


  return 0;
end;
