IMPORT PTinter, RSBDataSet, dl_plib, dlgCommon, funk, dl_kvlib; 
PRIVATE VAR d0, pId22, rs0, cmd22, {curdate}, sql0, flag, rs05, que; 
PRIVATE VAR col22 = TArray();
PRIVATE VAR v_DealId = TArray(), v_count;

MACRO bkom()
     d0 = {curdate};
     sql0 = "select t_id pId22,  t_number nom,t_name nam, t_amount su, 'Не выполнено' pp from DSTD_BSKOM_DBT "; 
     cmd22 = RSDRecordset(sql0 , RSDVAL_CLIENT, RSDVAL_STATIC );

     MACRO EvProc222 (rs0, cmd22, id, key )
        if (cmd22 == DLG_INIT)	// Инициализация
            if (pId22 != "0")  // Надо найти запись
                v_count = 0;
                while ( (rs0.value ("pId22") != pId22) And (Not rs0.EOF) )  
                         if (ValType(rs0.value ("pId22")) == 26)
                             v_DealId(v_count) = 0;
                         else
                             v_DealId(v_count)= rs0.value ("pId22");
                         end;
                         rs0.Move(1, RELATIVE);
                         v_count = v_count + 1;
                end;
            end;
            GoToScroll(rs0, true);
        elif (cmd22 == DLG_KEY)
            pId22 = rs0.value ("pId22");
            if(DLG_KEY_ENTER == Key)
               return CM_SELECT;
            elif(DLG_KEY_F5 == Key) 
               return CM_SELECT;
            end;
        end;
     END;

     AddCol (col22, 0, "nom","Номер", 5);
     AddCol (col22, 1, "nam","Комиссия", 55);
     AddCol (col22, 2, "su","Cумма комиссии", 15);  
     AddCol (col22, 3, "pp","Удержание", 15);                                                                                                                                                        
     AddCol (col22, 5, "su2","Сумма обязательств", 15);

     while(RunScroll(cmd22, 4, col22, null, @EvProc222, "Монитор комиссии по валютному рынку на ММВБ за " + СДАТ(d0), " ESC- Выход ", null, 10, 10) )
           cmd22 = RSDRecordset(sql0 , RSDVAL_CLIENT, RSDVAL_STATIC );
      end;
      exit(1);
END;