/**                                                                                                             
 @file clportsofr2dwh_form.mac                                                                                          
 @brief Обработка формы Буферная таблица "Мобильное приложение"
 #menu 
  - БО ЦБ\Сервисные операции\Буферная таблица "Мобильное приложение"                                                                                                                                                                                                                 
                                                                                                                                                                                                             
                                                                                                                
 # changeLog                                                                                                    
 |date       |author         |tasks               |note                                                         
 |-----------|---------------|--------------------|-------------------------------------------------------------
 |2024.21.04 |Шестаков Д.В.  |BIQ-15004           |Создание макроса для обработки формы                                                                                                                                                                                                                                                                                           
*/ 

import "DlRepForm_h.mac", "globals.mac", rsd, dlquery;
import DatesUtility;


PRIVATE CONST PNFLD_W475SOFR_DTBEGIN = 0;



/**
 @brief Начальная дата выпуска отчета
*/ 
private MACRO DL_FldProc_BeginDate( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER
  if( Cmd == DLG_INIT ) /*Установка значения в поле*/
     if( FldRealValue == null ) /*инициализация по умолчанию*/
        FldRealValue = {curdate};
     end;
     FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE ) /*значение поля было изменено*/
      FldRealValue = FldShowValue;
  elif( (Cmd == DLG_KEY) AND (Key == KEY_F3) ) /*Вызов листалки и заполнение FldShowValue и FldRealValue*/
     FldRealValue = GetDateByCalendar( FldRealValue );
     FldShowValue = FldRealValue;
  end;
  return CM_DEFAULT;
END;




/**
 @brief Класс формы 
*/                    
CLASS (DL_CPanel) BufferTable_DCLPORT_Panel()

  var m_dtBegin:Date = Date(); //начальная дата
 
  /**
   @brief Инициализация параметров формы, назначения обработчиков полей
  */                    
  PRIVATE MACRO Init()
    AddFieldProc(0, PNFLD_W475SOFR_DTBEGIN, DL_PNFLD_BEGINDATE, @DL_FldProc_BeginDate, m_dtBegin);
  END;

  /**
   @brief Проверка параметров формы
   @return true, если проверка пройдена успешно
   @return false, если в процессе проверки были обнаружены ошибки
  */                    
  PRIVATE MACRO Check():BOOL
    return true;
  END;

  /**
   @brief Запуск формы с последующей записью полученных параметров
   @return true, если форма отработала успешно и была подтверждена по F2
   @return false, если в процессе работы формы возникли ошибки или из нее вышли по Esc
  */                    
  MACRO Run()
    var stat = Run();

    m_dtBegin = GetFieldValue(PNFLD_W475SOFR_DTBEGIN);

    return stat;
  END;

  initDL_CPanel("sp_rep.lbr", "p_dcport");
END;