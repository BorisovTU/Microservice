import RSD, RsbDataSet, BankInter, globals, Календарь;


//Функция генерации единого кода на бирже в субдоговорах
macro GetNumberSub( SeqValue, ObjKind, ObjAddr )
	var NumberSub;
record sfcontr(sfcontr);
setBuff(sfcontr, ObjAddr);
var str = sfcontr.number;
if (ObjKind == 659)
 if ((sfcontr.number != "") and (sfcontr.servkindsub != 0))
  if (sfcontr.servkindsub == 9)
   if (SubStr(str,(strlen(str)-6) ) == "внебирж")
    NumberSub = str;
   elif (SubStr(str,(strlen(str)-3) ) == "фонд")
    NumberSub = string(SubStr(str,1,(strlen(str)-4) ), "внебирж")
   elif (SubStr(str,(strlen(str)-4) ) == "срочн")
    NumberSub = string(SubStr(str,1,(strlen(str)-5) ), "внебирж")
   else   
    NumberSub = string(sfcontr.number, "внебирж");
   end;
  else
   if (sfcontr.servkind == 1 )
    if (SubStr(str,(strlen(str)-3) ) == "фонд")
     NumberSub = str;
    elif (SubStr(str,(strlen(str)-6) ) == "внебирж")
     NumberSub = string(SubStr(str,1,(strlen(str)-7) ), "фонд")
    elif (SubStr(str,(strlen(str)-4) ) == "срочн")
     NumberSub = string(SubStr(str,1,(strlen(str)-5) ), "фонд")
    else   
     NumberSub = string(sfcontr.number, "фонд");
	end;
   elif (sfcontr.servkind == 15)
   if (SubStr(str,(strlen(str)-4) ) == "срочн") 
     NumberSub = str;
    elif (SubStr(str,(strlen(str)-6) ) == "внебирж")
     NumberSub = string(SubStr(str,1,(strlen(str)-7) ), "срочн")
    elif (SubStr(str,(strlen(str)-3) ) == "фонд")
     NumberSub = string(SubStr(str,1,(strlen(str)-4) ), "срочн")
    else   
     NumberSub = string(sfcontr.number, "срочн");
	end;
   end;
  end; 
 else
 var nextval;
  GenerateReference(1000007, nextval);
  NumberSub =  nextval;  
 end;
end;
return NumberSub;
end;



