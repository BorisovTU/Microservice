/*
$Name:        dec2form404_panel.mac
$Module:      Ценные бумаги
$Description: Расшифровки к форме 404
$Programmer:  Кротов А.
*/
import "DlRepForm_h.mac", "globals.mac", rsd, dlquery;

/*Номера полей в форме отчета*/
CONST 
      PNFLD_BeginDate  = 0,
      PNFLD_Bank       = 1,
      PNFLD_Client     = 2;

/* Обработчики для нестандарных контролов */
private CONST H_BANK   = 101,
              H_CLIENT = 102;

/**/
private MACRO DL_FldProc_CheckBox(pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT):INTEGER

  if( Cmd == DLG_INIT )
    if( FldRealValue == null ) /*инициализация по умолчанию*/
      FldRealValue = "X";
    end;
    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
    FldRealValue = FldShowValue;
  elif( Cmd == DLG_KEY )
    if( Key == KEY_SPACE )
      if(FldRealValue == "X")
        FldShowValue = FldRealValue = " ";
      else
        FldShowValue = FldRealValue = "X";
      end;
    end;
  end;

  return CM_DEFAULT;
END;

CLASS (DL_CPanel) dec2form404_Panel()

  PRIVATE MACRO Init()

     AddFieldProc(0, PNFLD_BeginDate, DL_PNFLD_BEGINDATE, @DL_FldProc_BeginDate, {curdate});
     AddFieldProc(0, PNFLD_Bank,      H_BANK,             @DL_FldProc_CheckBox, "X" );
     AddFieldProc(0, PNFLD_Client,    H_CLIENT,           @DL_FldProc_CheckBox, "X" );

  END;

  PRIVATE MACRO Check():BOOL
    if((This.GetLinkedValue(H_BANK) != "X") and (This.GetLinkedValue(H_CLIENT) != "X"))
      Msgbox("Необходимо выбрать хотя бы один вариант выпуска отчета");
      return false;
    else
      return true;
    end;
  END;

  initDL_CPanel("dec2form404.lbr", "D2F404"); 

END;

