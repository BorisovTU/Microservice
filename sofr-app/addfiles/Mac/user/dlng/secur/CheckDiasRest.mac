import RSD;
var cmd,rs, sql;
  const K_Enter = 13;
  const K_F2    = 316;
  const K_F3    = 317;
  const K_F8    = 322;
  const K_F9    = 323;
  const K_Alt_F3= 362;

private MACRO AD_Scroll( Select:STRING, Header:STRING, X:INTEGER, Y:INTEGER /*...*/):RsdRecordset
  
  var rs , Column = TArray(),
      i, ColumnValue, ColumnName, ColumnWidth, NumColumns = 0;
      begaction(2000,"Сбор данных...", false);
      rs = RsdRecordset( Select, null, RSDVAL_STATIC );
      endaction;
  macro EvProc( rs, cmd, id, key )
    if( (cmd == DLG_KEY) and (key == K_ENTER) )
       return CM_SELECT;
    end;
    return CM_DEFAULT;
  end;
  
  /* атрибуты полей */
  macro AddColumn( ar,ind, fld, head, Width )
     ar.value( ind * 6 + 0 ) = fld;  // fieldName
     ar.value( ind * 6 + 1 ) = head; // header 
     ar.value( ind * 6 + 2 ) = Width; // width
     ar.value( ind * 6 + 3 ) = 2;    // fldType (2 = FBT)
     ar.value( ind * 6 + 4 ) = null; // decPoint
     ar.value( ind * 6 + 5 ) = 0;    // reserv
     NumColumns = NumColumns + 1;
  end;
 
  i = 4;
  while( GetParm(i, ColumnValue ) AND GetParm(i+1, ColumnName) AND GetParm(i+2, ColumnWidth) )              
     AddColumn( Column, NumColumns, ColumnValue, ColumnName, ColumnWidth );
     i = i + 3;
  end;   

  if( rs.moveNext() )
     if( RunScroll( rs, NumColumns, Column, null, @EvProc, Header, "Esc Выход F4 Поиск Enter Выбор", true, X, Y, null, 25 ) )
       return rs;
    end;
  end;

  return null;
END;

sql = "select rest_timestamp, reportdate, realreportdate from v_diasdeporest group by rest_timestamp, reportdate, realreportdate order by rest_timestamp desc";
rs = RSDRecordset(cmd, rsdval_client, rsdval_static);
//runscroll (rs);
AD_Scroll(sql, "Выгрузки остатков ЦБ, полученные из депозитария Диасофта", 10, 5,
                             "rest_timestamp", "Реальные дата и время выгрузки", 30,
                             "reportdate", "Дата остатков (по Диасофту)", 40,
                             "reportdate", "Дата остатков (расчетная)", 40);