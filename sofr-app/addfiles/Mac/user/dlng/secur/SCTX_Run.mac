import "DlRepForm_h.mac", "globals.mac", "SCTX_Form.mac", "sctxrun.mac";


var form = ARNU_SCTX_Form();

while(form.run())
  VAR Mode, dateST, dateEN, TaxGroup = -1, FIID = -1, Parallel = 0;

  Parallel = form.GetFieldValue(PNFLD_PARALLEL);
  
  if((form.GetFieldValue(PNFLD_AVRGROUP) > 0) or (form.GetFieldValue(PNFLD_AVRGROUP) > 0))
    Mode = TXRUN_MODE_BYFIID;
    dateST = form.GetFieldValue(PNFLD_CALC_TO_DATE);
    TaxGroup = form.GetFieldValue(PNFLD_AVRGROUP);
    FIID  = form.GetFieldValue(PNFLD_AVRGROUP);
  elif(form.GetFieldValue(PNFLD_IS_CALC_TO_DATE) == SET_CHAR)
    Mode = TXRUN_MODE_ONDATE;
    dateST = form.GetFieldValue(PNFLD_CALC_TO_DATE);
  elif(form.GetFieldValue(PNFLD_IS_CALC_FROM_DATE) == SET_CHAR)
    Mode = TXRUN_MODE_BYDATE;
    dateST = form.GetFieldValue(PNFLD_CALC_FROM_DATE);
    if(form.GetFieldValue(PNFLD_IS_CALC_FROM_DATE_TO_DATE) == SET_CHAR)
      dateEN = form.GetFieldValue(PNFLD_CALC_FROM_DATE_TO_DATE);
    else
      dateEN = {curdate};
    end;
  elif(form.GetFieldValue(PNFLD_IS_CLOSE_TAX) == SET_CHAR)
    Mode = TXRUN_MODE_CLOSE;
    dateST = form.GetFieldValue(PNFLD_CLOSE_TAX);
  end;
  
  if(Begin_RunSCTX())
    RunSCTX(Mode,
            dateST,
            dateEN,
            TaxGroup,
            FIID,
            Parallel);
    End_RunSCTX();
  end;

end;

exit(1);
