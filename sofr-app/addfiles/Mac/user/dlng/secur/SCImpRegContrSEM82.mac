/*
$Name:        SCImpRegContrSEM82.mac
$Module:      Ценные бумаги
$Description: Загрузка данных о регистрации изменений по договоарм на бирже SEM82
*/

import "SCImpRegContrSEM82_main";

class (TRsbPanel) Pan
   initTRsbPanel();
   var curstr = 1;
   Caption = "Обработка SEM82";
   Status = "~ESC~Выход ~F2~Выполнить";
   setSize(30,4);
   setPosition(8,1);
   var CalcDate_;

   curstr = curstr+1;
   CalcDate_ = TRsbEditField(V_DATE);
   CalcDate_.setSize(8,1);
   CalcDate_.setPosition(11,curstr);
   CalcDate_.name = "dat";
   CalcDate_.value = {curdate};
   addControl(CalcDate_);
   var m_Label1:TRsbLabel = TRsbLabel(7,curstr,"Дата");
   addLabel (m_Label1);

   macro CalcDate()
      return CalcDate_.value;
   end;

   addEventHandler(RSB_EV_KEY_PRESSED, R2M(this, "onKeyPressed"));

   macro onKeyPressed(ev)   
      var Dt, flag = true, str;
      if (ev.keycode == 316)
         VAR Imp = SC_ImportRegContrSEM82();

         if( Imp != NULL )
            if (Imp.LoadFromFile(this.CalcDate()))
               Imp.FillTableForCompare(this.CalcDate());
               Imp.Compare(this.CalcDate());
            end;

            this.close(1);
         end;
      end;
   end;

end;

var myPanel:TRsbPanel = Pan;
myPanel.run;
