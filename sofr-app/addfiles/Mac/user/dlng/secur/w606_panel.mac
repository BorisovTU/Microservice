/*
$Name:        w606_panel.mac
$Module:      Ценные бумаги
$Description: Формирование данных для ЦКРР (панель)
$Programmer:  Кротов А.
*/
import "DlRepForm_h.mac", "globals.mac";

/*Номера полей в форме отчета*/
CONST P_BEGINDATE = 0,
      P_MBK       = 1,
      P_REPO      = 2,
      P_DIP       = 3,
      P_DNIP      = 4;

/* Обработчики для нестандарных контролов */
private CONST H_CheckMBK  = 101,
              H_CheckREPO = 102,
              H_CheckDIP  = 103,
              H_CheckDNIP = 104;

/**/
private MACRO DL_FldProc_CheckBox( pThis:DL_CPanel, Cmd:INTEGER, Key:INTEGER, FldShowValue:@VARIANT, FldRealValue:@VARIANT ):INTEGER

  if( Cmd == DLG_INIT )
    if( FldRealValue == null ) /*инициализация по умолчанию*/
      FldRealValue = "X";
    end;
    FldShowValue = FldRealValue;
  elif( Cmd == DLG_CHANGEVALUE )
    FldRealValue = FldShowValue;
  elif( Cmd == DLG_KEY )
    if( Key == KEY_SPACE )
      if(FldRealValue == "X")
        FldShowValue = FldRealValue = " ";
      else
        FldShowValue = FldRealValue = "X";
      end;
    end;
  end;

  return CM_DEFAULT;
END;

CLASS (DL_CPanel) W606_Panel()

  PRIVATE MACRO Init()

     AddFieldProc(0, P_BEGINDATE, DL_PNFLD_BEGINDATE, @DL_FldProc_BeginDate, {curdate});
     AddFieldProc(0, P_MBK,       H_CheckMBK,         @DL_FldProc_CheckBox, "X");
     AddFieldProc(0, P_REPO,      H_CheckREPO,        @DL_FldProc_CheckBox, "X");
     AddFieldProc(0, P_DIP,       H_CheckDIP,         @DL_FldProc_CheckBox, "X");
     AddFieldProc(0, P_DNIP,      H_CheckDNIP,        @DL_FldProc_CheckBox, "X");

  END;

  PRIVATE MACRO Check():BOOL
     if((GetFieldValue(P_MBK) != "X") and (GetFieldValue(P_REPO) != "X") and (GetFieldValue(P_DIP) != "X") and (GetFieldValue(P_DNIP) != "X"))
       msgboxex("Определите набор данных для ЦКРР");
       return false;
     else
       return true;
     end;
  END;

  initDL_CPanel("w606.lbr", "PANEL" ); 

END;

