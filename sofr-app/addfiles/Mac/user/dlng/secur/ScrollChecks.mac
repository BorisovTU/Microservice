import RSD;

const K_ENTER   = 13;
const K_ESC     = 27;
const K_F3      = 317;
const K_F2      = 316;
const K_F8      = 322;
const K_F9      = 323;

const GR_ACCBO = 1; 
const GR_ACCBU = 2;
const GR_ACCIN = 3;
const GR_ACCDU = 4;

PRIVATE MACRO AddCol (ar,ind, fld, head, width, rdonly, ty, dp)
   ar.value (ind * 6)     = fld;
   ar.value (ind * 6 + 1) = head;
   ar.value (ind * 6 + 2) = width;
   ar.value (ind * 6 + 3 ) = rdonly;   // fldType
   ar.value (ind * 6 + 4 ) = dp;//   decPoint
   ar.value (ind * 6 + 5 ) = 0;   // reserv
END;

var shift = 0, kind = 0, logid = -1;
var txt_accnum =       "  AND AC1.T_ACCNUM = ";
var cur_accnum = 1;
 
macro Scroll
   var cmd1, rs1, col1, need = true,Column = TArray(),i, ColumnValue, ColumnName, NumColumns = 0, cond = "";
 
   macro EvProc2(rs, cmd, id, key)
     var  CM_DEFAULT = null;
     if ((cmd == DLG_KEY)and(key == K_ENTER))
        if (rs.RecCount > 0)
          return CM_SELECT;
        end;
     end;
     return CM_DEFAULT;
  end;

   macro EvProc(rs, cmd, id, key)
     var  CM_DEFAULT = null;
//msgbox(key);
     if ((cmd == DLG_KEY)and(key == K_ENTER))
       /* if (rs.RecCount > 0)
          return CM_SELECT;
        end;*/
           if (cur_accnum == 4)
             cur_accnum = 1;
           else
             cur_accnum = cur_accnum + 1;
           end;
         need = true;
         return 2;

/*      elif ((cmd == DLG_KEY)and(key == K_F3))
         GetInt(shift,"‘¤Ά¨£ «®£ ©¤");
         cond = "";
         need = true;
         return 2;
      elif ((cmd == DLG_KEY)and(key == K_F8))
         if (kind == 3) kind = -1; else kind = kind + 1; end;
         if (kind == -1) cond = ""; 
         else  cond = " and t_kind = " + kind; 
         end;
         if (logid > -1) cond = cond + " and t_kind = " + kind; end;
         need = true;
         return 2;
      elif ((cmd == DLG_KEY)and(key == K_F9))
         cond = "";
         need = true;
         return 2;*/
      elif ((cmd == DLG_KEY)and(key == 18))
         cond = "";
         need = true;
         return 2;
/*      elif ((cmd == DLG_KEY)and(key == K_F2))
            var retval, cmd2 = " select to_char(t_logid) t_logid,t_objecttype from ( select t_logid, t_objecttype from user_cnvhlplogex where t_logid is not null group by t_logid,t_objecttype order by t_logid desc) ";
            cmd2 = RSDCommand(cmd2);
            var rs2 = RSDRecordset(cmd2 , null, RSDVAL_STATIC );

            if (RunScroll (rs2,2,null,"","EvProc2"))
               logid = rs2.value(0);
               shift = 0;
               cond = " and t_logid = " + logid;
            else
                cond = "";
            end;
         need = true;
         return 2;
  */
      elif ((cmd == DLG_KEY)and(key == K_ESC))
         return 2;
      end;

     return CM_DEFAULT;
   end;

   col1 = TArray;   

   AddCol (col1, 0, "ACCkind",        "‚¨¤ γη¥β ",   8 ,  0,0);
   AddCol (col1, 1, "dealdate",        "„ β ",    8,  0,0);
   AddCol (col1, 2, "cnt",     "®«¨η¥αβΆ®",    8, 0);


   while (need)
      need = false;
      cmd1 = 
/*
      " SELECT  "
      " decode(AC1.T_ACCNUM,1,'',2,'“',3,'‚“',4,'„“') acckind, "
      " d.t_plandate dealdate, count(1) cnt                        "
      " FROM ddlgrdeal_dbt d , ddlgracc_dbt ac1, ddl_tick_dbt t  "  
      "  WHERE     d.t_dockind IN (101, 127, 117)                "  
      "        AND d.t_docid = t.t_dealid                        "  
      "        AND d.t_dockind = t.t_bofficekind                 "  
      "        AND d.t_id = ac1.t_grdealid                       "   ;
      cmd1 = cmd1+ txt_accnum + cur_accnum;
      cmd1 = cmd1+ 
      "        AND T.T_DEALSTATUS = 10                           "  
      "        AND t_clientid = -1  "                               
      "        AND ac1.t_state = 1   "
      "        group by       AC1.T_ACCNUM, "
      " d.t_plandate                         "   
      " ORDER BY d.t_plandate                 ";
*/ 
      " SELECT  "
      " decode(AC1.T_ACCNUM,1,'',2,'“',3,'‚“',4,'„“') acckind, "
      " to_char(d.t_plandate,'dd.mm.yyyy') dealdate, count(1) cnt                        "
      " FROM ddlgrdeal_dbt d , ddlgracc_dbt ac1, ddl_tick_dbt t  "  
      "  WHERE     d.t_dockind IN (101, 127, 117)                "  +
      "        AND d.t_docid = t.t_dealid                        "  
      "        AND d.t_dockind = t.t_bofficekind                 "  
      "        AND d.t_id = ac1.t_grdealid                       "   
      "        AND ac1.T_ACCNUM = 1                           "       +
      "        AND T.T_DEALSTATUS = 10                           "  
      "        AND t_clientid = -1  "                               
      "        AND ac1.t_state = 1   "
      "        group by       AC1.T_ACCNUM, "                        +
      " d.t_plandate                         "   
  //  " ORDER BY d.t_plandate                 "
" union all select '--------', null, null from dual"
" UNION ALL "
      " SELECT  "
      " decode(AC1.T_ACCNUM,1,'',2,'“',3,'‚“',4,'„“') acckind, "  +
      " to_char(d.t_plandate,'dd.mm.yyyy')  dealdate, count(1) cnt                        "
      " FROM ddlgrdeal_dbt d , ddlgracc_dbt ac1, ddl_tick_dbt t  "  
      "  WHERE     d.t_dockind IN (101, 127, 117)                "  
      "        AND d.t_docid = t.t_dealid                        "  
      "        AND d.t_dockind = t.t_bofficekind                 "   +
      "        AND d.t_id = ac1.t_grdealid                       "   
      "        AND ac1.T_ACCNUM = 2                           "  
      "        AND T.T_DEALSTATUS = 10                           "  
      "        AND t_clientid = -1  "                                +
      "        AND ac1.t_state = 1   "
      "        group by       AC1.T_ACCNUM, "
      " d.t_plandate                         "   
  //    " ORDER BY d.t_plandate                 "
" union all select '--------', null, null from dual"
" UNION ALL "                                                         +
      " SELECT  "
      " decode(AC1.T_ACCNUM,1,'',2,'“',3,'‚“',4,'„“') acckind, "
      " to_char(d.t_plandate,'dd.mm.yyyy')  dealdate, count(1) cnt                        "
      " FROM ddlgrdeal_dbt d , ddlgracc_dbt ac1, ddl_tick_dbt t  "  
      "  WHERE     d.t_dockind IN (101, 127, 117)                "  
      "        AND d.t_docid = t.t_dealid                        "  
      "        AND d.t_dockind = t.t_bofficekind                 "   +
      "        AND d.t_id = ac1.t_grdealid                       "   
      "        AND ac1.T_ACCNUM = 3                           "  
      "        AND T.T_DEALSTATUS = 10                           "  
      "        AND t_clientid = -1  "                               
      "        AND ac1.t_state = 1   "
      "        group by       AC1.T_ACCNUM, "                         +
      " d.t_plandate                         "   
  //    " ORDER BY d.t_plandate                 "
" union all select '--------', null, null from dual"
" UNION ALL "
      " SELECT  "
      " decode(AC1.T_ACCNUM,1,'',2,'“',3,'‚“',4,'„“') acckind, "
      " to_char(d.t_plandate,'dd.mm.yyyy')  dealdate, count(1) cnt                        "
      " FROM ddlgrdeal_dbt d , ddlgracc_dbt ac1, ddl_tick_dbt t  "  
      "  WHERE     d.t_dockind IN (101, 127, 117)                "     +
      "        AND d.t_docid = t.t_dealid                        "  
      "        AND d.t_dockind = t.t_bofficekind                 "  
      "        AND d.t_id = ac1.t_grdealid                       "   
      "        AND ac1.T_ACCNUM = 4                           "  
      "        AND T.T_DEALSTATUS = 10                           "  
      "        AND t_clientid = -1  "                               
      "        AND ac1.t_state = 1   "                                +
      "        group by       AC1.T_ACCNUM, "
      " d.t_plandate                         "   ;
   //   " ORDER BY d.t_plandate                 ";

      cmd1 = RSDCommand(cmd1);
      rs1 = RSDRecordset(cmd1 , null, RSDVAL_STATIC );


      if (RunScroll (rs1,3, col1, "test" ,"EvProc"," "," ", true, 1, 1))
       //   return rs1;
      end;


   end;

return null;

end;

Scroll;
exit(1);