import oralib, likepy, globals,fx_globals, CTInter;
IMPORT mmarkinter, OprInter,funk,dl_plib,dl_lib;

IMPORT OprInter;


   private var que,rs9,ii,{curdate},da,dealid,rs5,rez;

   var docKind=102, sql,nbank,fiid,debet,dealcode,sta,idop;
   var exec, command1, command2, chainblockId,chainblockId0=3000019 ;


  idop=49550;


   rez = Opr_InsertAndExecuteBranch(idop, 1029007,OPRBR_INSERT, 0);
   msgbox(rez);


/*

  chainblockId =1029007;
   command1 = "BEGIN :res := RSI_RsbOperation.InsertBranchTrn(0, "+idop+", "
  +ii+",'I', "+chainblockId+", 550, :dt, 0, 0); END;";
  exec = ExecSql(command1, MakeArray(SqlParam ("res",  V_INTEGER, RSDBP_RETVAL), 
                                     SqlParam ("dt", {curdate})), false);

  if(exec == null)
    MsgBox("Ошибка вставки цепочки ");
    return false;
  end;

  if(exec.value("res") != 0)
    MsgBox("Процедура вставки вернула ошибку, для документа ");
    return false;
  end;
*/ 


/*


  command1 = "BEGIN :res := RSI_RsbOperation.StartOperationTrn("+idop+",450,'0000000000000000000000000000018407',14001, :dt, '', 0,0); END;";
  exec = ExecSql(command1, MakeArray(SqlParam ("res",  V_INTEGER, RSDBP_RETVAL), 
                                     SqlParam ("dt", {curdate})), false);

  if(exec == null)
    MsgBox("Ошибка вставки ");
    return false;
  end;

  if(exec.value("res") != 0)
    MsgBox("Процедура вставки вернула ошибку, для документа ");
    return false;
  end;



 */




/*

  // ---  blok cep  -------------------
  sql = "select s.t_id_operation, s.t_id_step, s.t_blockid, s.t_kind_operation, s.t_IsExecute from " 
  + " doproper_dbt o "
  + " inner join doprstep_dbt s on s.t_id_operation=o.t_id_operation and s.t_id_step = (select t_id_step from doprstep_dbt where t_id_operation = s.t_id_operation  and t_isexecute ='R'  )"
  + " where o.t_dockind = :dockind and o.t_documentid = lpad(:dealid, 34, '0')";
  chainblockId = 3000019;
  sql = ExecSqlSelect(sql, MakeArray(SqlParam("dockind", dockind), SqlParam("dealid", dealid)), false);     
  if(not sql.MoveNext())
    MsgBox("Ошибка поиcка сделки  = "+dealid);

    return false;
  end;
  ii=int(sql.value("t_id_step"));
  

  idop=49550;

  command1 = "BEGIN :res := RSI_RsbOperation.InsertBranchTrn(:step, "+idop+", "
  +ii+",'I', "+chainblockId+", 550, :dt, 0, 0); END;";
  exec = ExecSql(command1, MakeArray(SqlParam ("res",  V_INTEGER, RSDBP_RETVAL), 
                                     SqlParam ("step", V_INTEGER, RSDBP_RETVAL), 
                                     SqlParam ("dt", {curdate})), false);

  if(exec == null)
    MsgBox("Ошибка вставки цепочки ");
    return false;
  end;

  if(exec.value("res") != 0)
    MsgBox("Процедура вставки вернула ошибку, для документа ");
    return false;
  end;
  // ----------------------------------------------


p_ID_Operation IN OUT INTEGER,
                              p_DocKind             IN INTEGER,
                              p_DocumentID          IN VARCHAR2,
                              p_Kind_Operation      IN INTEGER,
                              p_Start_Date          IN DATE,
                              p_IsNew               IN CHAR,
                              p_Parent_ID_Operation IN INTEGER,
                              p_Parent_ID_Step      IN INTEGER
                             )




#1, type RSDLONG, value: 0                                                                                                                                                                                 12:25:57.404 23-12-2018
#2, type RSDLONG, value: 49401                                                                                                                                                                             12:25:57.404 23-12-2018
#3, type RSDLONG, value: 450                                                                                                                                                                               12:25:57.404 23-12-2018
#4, type RSDLPSTR, value: 0000000000000000000000000000018400                                                                                                                                               12:25:57.404 23-12-2018
#5, type RSDLONG, value: 14001                                                                                                                                                                             12:25:57.404 23-12-2018
#6, type RSDDATE, value: 13.9.2018                                                                                                                                                                         12:25:57.404 23-12-2018
#7, type RSDCHAR, value: 0                                                                                                                                                                                 12:25:57.404 23-12-2018
#8, type RSDLONG, value: 0                                                                                                                                                                                 12:25:57.404 23-12-2018
#9, type RSDLONG, value: 0                                                                                                                                                                                 12:25:57.404 23-12-2018
BEGIN ? := RSI_RsbOperation.StartOperationTrn(?, ?, ?, ?, ?, ?, ?, ?); END;                                                                                                                                12:25:57.404 23-12-2018
*/


 end;




