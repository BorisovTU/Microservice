import funk,dl_lib;
RECORD tick(dl_tick);
PRIVATE VAR leg = TBfile("dl_leg");
array mas,mas2;
mas(0)="Платеж по ОД                  ";


MACRO PrintStepDocs (
                ID_Operation,  /* Номер экземпляра операции */
                ID_Step,       /* Номер шага операции */
                Kind_Operation,/* Вид операции */
                KindStep)      /* Вид шага операции */
               
    var oproper = TBfile("oproper.dbt"),
         dl_tick = TBfile("dl_tick.dbt") ;
    var que,rs01,idpm,kk,ii,sdop= " ",rs9,pplid;
    
    oproper.rec.ID_Operation = ID_Operation;
    
    if (not oproper.GetEq )
      msgbox( "Не найдена сделка ", ID_Operation );
      return 1;
    end;  

    ClearRecord( tick );
    
    if( (not RestoreFromUniID(oproper.rec.DocumentID, dl_tick, OBJTYPE_MMARKDEAL,oproper.rec.DocKind)) OR       
          (not GetEQ(dl_tick)) )    
      msgbox( "Не найдена сделка ");
      return 1;
    end;    

    Copy (tick, dl_tick);
    pplid=plat_zak(tick.dealid,"102","10",0,"paymentid");
    execmacrofile("plpaym.mac", "PaymDlg2", 0,pplid) ;

    exit(1);

END;
