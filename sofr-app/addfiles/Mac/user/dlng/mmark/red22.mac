IMPORT funk,fx_globals;

   private var que,rs9,jj0,dealid,rs5,j0,que0,rs,ii,ndog,dealcode,rs09;
   array mass1,mass2,mass3;

  que0=" from ddl_tick_dbt a  where a.t_partyid=343   and a.T_DEALTYPE=12300   ";
  que=" select count(*) "+que0; 
  // msgbox(que);
   rs9 = LnGetRecordSet(que);
   if(rs9 != null)
     while(rs9.moveNext())
       jj0=int(rs9.value(0));
     end;
   end;

   InitProgress( jj0, "Редакция сделок параметрам по графику платежей МБК" );  

   j0=0;
   que=" select a.t_dealid,t_dealcode  "+que0; 
   rs9 = LnGetRecordSet(que);
   if(rs9 != null)
     while(rs9.moveNext())
       j0=j0+1;
       useprogress(j0);
       dealid=int(rs9.value(0));
       dealcode = rs9.value(1);
       que="select b.t_nameaccount from dmcaccdoc_dbt a, daccount_dbt b where a.t_dockind=102 and a.t_catid=111 and a.t_docid="+dealid+" and b.t_account=a.t_account ";
       rs = LnGetRecordSet(que);
       if(rs != null)
         if (rs.moveNext)
               ndog=rs.value(0);
               ii=index(ndog,"000");
               if ( ii > 0 )
                 ndog=substr(ndog,ii);
                 ii=index(ndog,"от");
                 if ( ii > 0 )
                    ndog=trim(substr(ndog,1,ii-1));
                    que="update ddl_tick_dbt set t_dealcode='"+ndog+"'  where t_dealid="+ DealID;
                    rs09 = LnGetRecordSet(que);
                    que="update dprccontract_dbt set t_objectid='"+ndog+"'  where t_ObjectType=103 and t_objectid='"+dealcode+"'";
                    rs09 = LnGetRecordSet(que);

                    println(rs9.value(1), "=",ndog);
                 else
                    println(rs9.value(1), " !!!!!!!!!!!!!!!!!!!!!!!!!!!!",ndog);
                 end;
               else
                    println(rs9.value(1), " !!!!!!!!!!!!!!!!!!!!!!!!!!!!",ndog);
               end;
         end;
       end;


     end;
   end;



   RemProgress; 
END;

