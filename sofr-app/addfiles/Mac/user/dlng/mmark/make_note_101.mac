/*
Leplin 
Вставка текста согласования при досрочном закрытии депозита
T_OBJECTTYPE - Вид объекта (Сделка МБК=103)
T_NOTEKIND   - Тип пользовательского примечания для вида объекта =101
*/

import /*Simanov. Избавляемся от библиотеки CommonInter,*/ RSD, globals, funk, dl_note_lib;

macro makenote( DealId )

  private var T_DOCUMENTID,T_TEXT, cmd, que1;
  private var que, que0, rs0;
  const T_OBJECTTYPE= 103,
        T_NOTEKIND  = 101,
        T_DATE ={curdate},
        T_OPER={oper},
	 T_BRANCH={NumDprt};
  record tick( dl_tick );


  T_DOCUMENTID = DealID; 


  GetString(T_TEXT, "Введите текст согласования с ЦБ РФ!",128 , 5);
  if(strlen(trim(T_TEXT)) == 0)
     MsgBox("Недопустимо пустое примечание, сделка не закрыта!");
     return 1;
  end;
          SetNoteDifValue(DealId, 101, T_TEXT);
  	  return 0;
 
        end;
     end;
  end;

end;


