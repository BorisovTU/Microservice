/*──────────────────────────────────────────────────────────────────────────┐
  File Name   : vsi055.mac
                                vs-вексель
                                 i-операция эмиссии векселя (issue)
                               055-номер (соответствующий шагу)
  Операция    : Эмиссия собственного векселя
  Шаг         : Присвоение номеров векселей
└───────────────────────────────────────────────────────────────────────────*/
import vsdates, vssetnumbers;

/* Запуск шага
*/
MACRO ExecuteStep(Buffer, dl_order)
  var StepDate, stat = 0;

  record order( dl_order );
  SetBuff( order, dl_order );

  if(not VS_TestStepDate(DATE_EMI_DOC, @StepDate, order.SignDate))
     return 1;
  end;
/*
  if (not ИзменитьНомераВекселей(order))
    stat = 1;
  elif (not ПроверитьУникальностьВекселей(order))
    stat = 1;
  end;
*/

  stat = ИзменитьНомерВекселя(order);

  return stat;
END;


/* Макрос постобработки 
*/
MACRO PostStep (    
                CommitOrRollback, /*1-выполнение шага,2 -отакат шага*/
                errTrn,        /* Статус выполнения шага-!0-произошла ошибка */
                FirstDoc,      /* Указатель на первичный документ */
                ID_Operation,  /* Номер экземпляра операции */
                Num_Step,      /* Номер шага операции(из настроек) */
                Kind_Operation,/* Вид операции */
                KindDoc,       /* Вид первичного документа */
                KindStep,      /* Вид шага операции */
                ID_Step)       /* Номер шага операции */

  record order( "dl_order" );
  SetBuff( order, FirstDoc );

  
  if (errTrn OR (CommitOrRollback==2)) 
    /* Произошла ошибка или происходит откат */

    //ОбнулитьНомераВекселей(order);

    return;
  end;

  return 1;
END;