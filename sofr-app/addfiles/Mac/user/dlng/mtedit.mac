/*панель редактирования SWIFT сщщбщения*/
import RSD;

macro runmtedit(p_str:@string, send_flag:@bool)
  var o_str = p_str;
  var dlg = TRecHandler ( "mtedit", "mtlib.lbr", TRUE );
  dlg.rec.editfld = p_str;

    macro EvProc (obj, cmd, id, key)
      if (cmd == DLG_KEY)
          if  (key == 316) //F2 
             p_str = dlg.rec.editfld;
             send_flag = true;
             return CM_CANCEL;
          elif (key == 27) //Esc

           if (msgboxex("Вы действительно хотите отказаться от отправки сообщения? ", MB_YES + MB_NO, IND_NO) == IND_YES)
             send_flag = false;
           else
             p_str = dlg.rec.editfld;
             send_flag = true;
           end;

            return CM_CANCEL;
          elif (key == 319)//F5
           obj.rec.editfld = obj.rec.editfld;
           return CM_DEFAULT;
          elif (key == 322)//F8 
            obj.rec.editfld = o_str;
            return CM_DEFAULT;
          else
          end;
        return CM_DEFAULT;
      end;    
    end;

  RunDialog ( dlg, "EvProc" );
end;

macro set_mtsend_flag(sendflag)
   var cmd;
   cmd = RSDCommand(RSLDEFCON, "begin DBMS_SESSION.SET_CONTEXT('CLIENTCONTEXT', 'mtsend_flag', ?); end;");
   cmd.addparam(":Sendflag", RSDBP_IN, sendflag);
   cmd.execute();
end;

macro get_mtsend_flag()
   var cmd, rs, retval;
   cmd = RSDCommand(RSLDEFCON, "SELECT SYS_CONTEXT('CLIENTCONTEXT', 'mtsend_flag') FROM DUAL");
   cmd.execute();
   rs = RSDRecordSet(cmd);
   if(rs.movenext())
     retval = rs.value(0);
   else
     retval = 0;
   end;
   return retval;
end;

