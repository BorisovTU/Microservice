/*  Используется в планировщике для автоматического экспорта подтверждений МТ300 и МТ320, модуль 2130  */
import RSD;

macro CreateSelect( TpID:integer, CorrID:integer ):integer

  var clear = RsdCommand( " delete from DWLMESPRC_TMP " );
  clear.execute();
  
  /* Основной запрос */
  var cmd = RsdCommand(
      " INSERT INTO DWLMESPRC_TMP value( t_MesID ) SELECT DISTINCT wlmes.t_MesID " + 
      " FROM   dwlmes_dbt wlmes, dwltpshem_dbt tpsh " + 
      " WHERE  wlmes.t_Direct = chr(0)  " + /* исходящее */
      " AND    wlmes.t_State  = 10 " + 
      " AND    wlmes.t_Control = 'X' " + 
      " AND    wlmes.t_TpSchemID =  tpsh.t_TpShemID "
      " AND    tpsh.t_TpID = 2 " /* SWIFT */
      // DEF-67457 " AND    wlmes.t_Kind != 10 " /* не неттинг */
      );

  cmd.execute();

  return 0;

OnError
  return 1; /* макрос должен возвращать 0 - в случае успеха, значение отличное от нуля - в случае ошибки*/

end;
