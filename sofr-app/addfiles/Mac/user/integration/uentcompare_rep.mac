/**
 @file uentcompare_rep.mac
 @brief Интеграция с внешними системами. Отчет-сверка проводок, выгруженных в ЦФТ из СОФР

 # tag
 - functional_block: Отчетность_внутренняя
 - code_type: Report

 # changelog
 |date       |autor          |tasks                                           |note
 |-----------|---------------|------------------------------------------------|-------------------------------------------------------------
 |24.10.2023 |Велигжанин А.В.|DEF-52575                                       |Реализован класс отчета-сверки (с локальной работой c Excel)
 |           |               |                                                | см. uentcompare_class.mac
*/

import "uentcompare_class.mac";

private const TRY_LIMIT = 0; //количество повторных попыток сверки 

/**
@brief 				Отчет-сверка проводок выгруженных в ЦФТ из СОФР 
                                !!!!!!!!!В параметрах будет вместо фильтра ReqId соответственно нужно будет поменять SQL-запрос и его параметры
@param[in] ReqId		фильтр
@param[in] ParamProcess		параметры
@param[in] Fl_SetDialog		флаг отображения диалога
@param[out] errortext		текст ошибки
@return 			результат
*/
macro EntCompareRepLogic( ReqId :string, ParamProcess: object, Fl_SetDialog :integer, errortext :@String, p_RepMode :integer ) :bool

  var EntCompare;
  var result;

  EntCompare = c_EntCompare ();  // см. uentcompare_class.mac

  result = EntCompare.EntCompareRep( ReqId, ParamProcess, Fl_SetDialog, errortext, p_RepMode );

  return result;
end;

macro EntCompareRep( ReqId :string, ParamProcess: object, Fl_SetDialog :integer, errortext :@String, p_RepMode :integer ) :bool
  //запускаем в отдельном экземпляре RSL, чтобы при новом пуске, все было чисто
  var result = false;
  var cnt = 0;
  //повторяем TRY_LIMIT раз, пока от EntCompareRep возвращается false
  while ((not result) and (cnt <= TRY_LIMIT))
    result = ExecMacroFile( "uentcompare_rep.mac", "EntCompareRepLogic", ReqId, ParamProcess, Fl_SetDialog, @errortext, p_RepMode);
    RslWait(5000);
    cnt=cnt+1;
  end;
  return result;
end;
//Отчет-сверка проводок выгруженных в ЦФТ из СОФР
