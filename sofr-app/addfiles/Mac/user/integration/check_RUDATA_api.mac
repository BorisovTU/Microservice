import RsbFormsInter, globals, Календарь, oralib;

private const FT_STRING = 7,
              FT_INTEGER = 1,
              FT_DOUBLE = 4,
              FT_DATE = 9,
              FT_MONEY = 25;


private macro BoolToInt( Vl_Bool :bool ) :integer

 if( Vl_Bool )
  return 1;
 else
  return 0;
 end;

end;

private macro AddColumn( ar:@TArray, ind, fld, head, width, fldType, DecPoint )
 ar.value( ind * 6 + 0 ) = fld; //FieldName
 ar.value( ind * 6 + 1 ) = head; //Header
 ar.value( ind * 6 + 2 ) = width; //Null //Width
 ar.value( ind * 6 + 3 ) = fldType; //fldType //2 = FBT
 ar.value( ind * 6 + 4 ) = DecPoint; //Null //DecPoint
 ar.value( ind * 6 + 5 ) = 0; //reserve
end;



//листалка рейтингов
private macro ListRatings( UserRUDATAProcPanel :@object )
var Query :string = "",
    DataSet :RsdRecordset,
    cmd,
    Column = TArray();


  macro EventHandler( rsd, cmd, id, key)

   if( (cmd == DLG_KEY) and (key == 27 ) ) //Esc
    return CM_SELECT;
   end;

  end;

  if( UserRUDATAProcPanel.SelectCode == 0 )
    //по ценной бумаге
    Query = " SELECT B.DT, B.LAST, B.RATING_OFFICIAL_NAME, B.RATING_AGENCY, B.RATING_OBJECT_TYPE, B.RATING_ID , /*CHR(88) AS LOAD_SOFR*/ " +
            "  ( CASE WHEN ( SELECT C.T_FLAG  FROM dllvalues_dbt C " +
            "                WHERE C.T_LIST = 5004 " +
            "                 AND C.T_ELEMENT = B.RATING_ID  ) IS NOT NULL THEN CHR(88) ELSE CHR(0) END ) AS ACCEPT_SOFR, " +
            "  (SELECT E.T_ATTRID FROM dobjattr_dbt E  " +
            "   WHERE E.T_OBJECTTYPE = ? " +
            "    AND E.T_GROUPID  = ? " +
            "    AND E.T_PARENTID = ( SELECT C.T_FLAG  FROM dllvalues_dbt C " +
            "                         WHERE C.T_LIST = 5004 " +
            "                          AND C.T_ELEMENT = B.RATING_ID  ) " +
            "                          AND E.T_NAME = B.LAST " +  
            "                         ) AS T_ATTRID, " +
            "  ( CASE WHEN ( SELECT D.T_ID " +
            "                FROM dobjatcor_dbt D " +
            "                WHERE D.T_OBJECTTYPE = ? " +
            "                 AND D.T_GROUPID = ? " +
            "                 AND  D.T_OBJECT =  LPAD(TO_CHAR(( SELECT F.T_FIID FROM davoiriss_dbt F " +
            "                                                   WHERE F.T_ISIN = ? )), 10, '0' ) " +
            "                 AND D.T_ATTRID = ( SELECT E.T_ATTRID FROM dobjattr_dbt E  " +
            "                                    WHERE E.T_OBJECTTYPE = ? " +
            "                                     AND E.T_GROUPID  = ? " +
            "                                     AND E.T_PARENTID = ( SELECT C.T_FLAG  FROM dllvalues_dbt C " +
            "                                                          WHERE C.T_LIST = 5004 " +
            "                                                           AND C.T_ELEMENT = B.RATING_ID ) " +
            "                                     AND E.T_NAME = B.LAST ) " +
            "                 AND D.T_VALIDFROMDATE = B.DT ) IS NOT NULL THEN CHR(88) ELSE CHR(0) END ) AS LOAD_SOFR " +

            " FROM sofr_rating_ratingshistory B " +
            " WHERE B.FINTOOLID = ( SELECT A.FINTOOLID FROM sofr_info_fintoolreferencedata A " +
            "                       WHERE A.ISINCODE = ? ) " +
            "  AND ( 0 = ? " +
            "   AND  B.RATING_AGENCY IN(  " +
            "                          'Expert RA', " +
            "                          'АКРА', " +
            "                          'Standard ' ||'&'||' Poor''s', " +
            "                          'Moody''s', " +
            "                          'Fitch Ratings', " +
            "                          'Эксперт РА' " +
            "     ) " +
            "   OR B.RATING_AGENCY = ? " +
            "       AND 1 = ? ) " +
            "  AND ( 1 = ? " +
            "   AND B.DT = ( SELECT MAX(C.DT) FROM sofr_rating_ratingshistory C " +
            "                WHERE C.FINTOOLID = B.FINTOOLID " +
            "                 AND  C.DT <= ? " +
            "                 AND C.RATING_ID = B.RATING_ID " +
            "                 AND C.RATING_AGENCY = B.RATING_AGENCY ) " +
            "   OR  0 = ? ) " +
            " ORDER BY RATING_AGENCY, DT ";
  elif( UserRUDATAProcPanel.SelectCode == 1 )
    //по эмитенту ИНН
    Query = " SELECT B.DT, B.LAST, B.RATING_OFFICIAL_NAME, B.RATING_AGENCY, B.RATING_OBJECT_TYPE, B.RATING_ID, /*CHR(88) AS LOAD_SOFR*/ " +
            "  ( CASE WHEN ( SELECT C.T_FLAG  FROM dllvalues_dbt C " +
            "                WHERE C.T_LIST = 5004 " +
            "                 AND C.T_ELEMENT = B.RATING_ID  ) IS NOT NULL THEN CHR(88) ELSE CHR(0) END ) AS ACCEPT_SOFR, " +
            "  (SELECT E.T_ATTRID FROM dobjattr_dbt E  " +
            "   WHERE E.T_OBJECTTYPE = ? " +
            "    AND E.T_GROUPID  = ? " +
            "    AND E.T_PARENTID = ( SELECT C.T_FLAG  FROM dllvalues_dbt C " +
            "                         WHERE C.T_LIST = 5004 " +
            "                          AND C.T_ELEMENT = B.RATING_ID  ) " +
            "                          AND E.T_NAME = B.LAST " +  
            "                         ) AS T_ATTRID, " +
            "  ( CASE WHEN ( SELECT D.T_ID " +
            "                FROM dobjatcor_dbt D " +
            "                WHERE D.T_OBJECTTYPE = ? " +
            "                 AND D.T_GROUPID = ? " +
            "                 AND  D.T_OBJECT =  LPAD(TO_CHAR(( SELECT F.T_OBJECTID FROM dobjcode_dbt F " +
            "                                                   WHERE SUBSTR(F.T_CODE, 1, CASE WHEN INSTR(F.T_CODE, '/') > 0 THEN INSTR(F.T_CODE, '/') - 1 " +
            "                                                                                  ELSE LENGTH(F.T_CODE) END ) =  ? " +
            "                                                    AND F.T_OBJECTTYPE = ? " +
            "                                                    AND F.T_CODEKIND = ? " +
            "                                                    AND F.T_STATE = 0 )), 10, '0' ) " +

            "                 AND D.T_ATTRID = ( SELECT E.T_ATTRID FROM dobjattr_dbt E  " +
            "                                    WHERE E.T_OBJECTTYPE = ? " +
            "                                     AND E.T_GROUPID  = ? " +
            "                                     AND E.T_PARENTID = ( SELECT C.T_FLAG  FROM dllvalues_dbt C " +
            "                                                          WHERE C.T_LIST = 5004 " +
            "                                                           AND C.T_ELEMENT = B.RATING_ID ) " +
            "                                     AND E.T_NAME = B.LAST ) " +
            "                 AND D.T_VALIDFROMDATE = B.DT ) IS NOT NULL THEN CHR(88) ELSE CHR(0) END ) AS LOAD_SOFR " +

            " FROM sofr_rating_ratingshistory B " +
            " WHERE ( 0 = ? " +
            "   AND  B.RATING_AGENCY IN( " +
            "                          'Expert RA', " +
            "                          'АКРА', " +
            "                          'Standard ' ||'&'||' Poor''s', " +
            "                          'Moody''s', " +
            "                          'Fitch Ratings', " +
            "                          'Эксперт РА' " +
            "     ) " +
            "   OR B.RATING_AGENCY = ? " +
            "       AND 1 = ? ) " +
            "  AND B.INN = ? " +
            "  AND B.RATING_OBJECT_TYPE = 'Компания' " +
            "  AND ( 1 = ? " +
            "   AND B.DT = ( SELECT MAX(C.DT) FROM sofr_rating_ratingshistory C " +
            "                WHERE C.INN = B.INN " +
            "                 AND C.RATING_OBJECT_TYPE = B.RATING_OBJECT_TYPE " +
            "                 AND  C.DT <= ? " +
            "                 AND C.RATING_ID = B.RATING_ID " +
            "                 AND C.RATING_AGENCY = B.RATING_AGENCY ) " +
            "   OR  0 = ? ) " +
            " ORDER BY RATING_AGENCY, DT ";

  elif( UserRUDATAProcPanel.SelectCode == 2 )
    //по эмитенту INTERFAX
    Query = " SELECT B.DT, B.LAST, B.RATING_OFFICIAL_NAME, B.RATING_AGENCY, B.RATING_OBJECT_TYPE, B.RATING_ID, /*CHR(88) AS LOAD_SOFR*/ " +
            "  ( CASE WHEN ( SELECT C.T_FLAG  FROM dllvalues_dbt C " +
            "                WHERE C.T_LIST = 5004 " +
            "                 AND C.T_ELEMENT = B.RATING_ID  ) IS NOT NULL THEN CHR(88) ELSE CHR(0) END ) AS ACCEPT_SOFR, " +
            "  (SELECT E.T_ATTRID FROM dobjattr_dbt E  " +
            "   WHERE E.T_OBJECTTYPE = ? " +
            "    AND E.T_GROUPID  = ? " +
            "    AND E.T_PARENTID = ( SELECT C.T_FLAG  FROM dllvalues_dbt C " +
            "                         WHERE C.T_LIST = 5004 " +
            "                          AND C.T_ELEMENT = B.RATING_ID  ) " +
            "                          AND E.T_NAME = B.LAST " +  
            "                         ) AS T_ATTRID, " +
            "  ( CASE WHEN ( SELECT D.T_ID " +
            "                FROM dobjatcor_dbt D " +
            "                WHERE D.T_OBJECTTYPE = ? " +
            "                 AND D.T_GROUPID = ? " +
            "                 AND  D.T_OBJECT =  LPAD(TO_CHAR(( SELECT F.T_OBJECTID FROM dobjcode_dbt F " +
            "                                                   WHERE SUBSTR(F.T_CODE, 1, CASE WHEN INSTR(F.T_CODE, '/') > 0 THEN INSTR(F.T_CODE, '/') - 1 " +
            "                                                                                  ELSE LENGTH(F.T_CODE) END ) =  ? " +
            "                                                    AND F.T_OBJECTTYPE = ? " +
            "                                                    AND F.T_CODEKIND = ? " +
            "                                                    AND F.T_STATE = 0 )), 10, '0' ) " +

            "                 AND D.T_ATTRID = ( SELECT E.T_ATTRID FROM dobjattr_dbt E  " +
            "                                    WHERE E.T_OBJECTTYPE = ? " +
            "                                     AND E.T_GROUPID  = ? " +
            "                                     AND E.T_PARENTID = ( SELECT C.T_FLAG  FROM dllvalues_dbt C " +
            "                                                          WHERE C.T_LIST = 5004 " +
            "                                                           AND C.T_ELEMENT = B.RATING_ID ) " +
            "                                     AND E.T_NAME = B.LAST ) " +
            "                 AND D.T_VALIDFROMDATE = B.DT ) IS NOT NULL THEN CHR(88) ELSE CHR(0) END ) AS LOAD_SOFR " +

            " FROM sofr_rating_ratingshistory B " +
            " WHERE ( 0 = ? " +
            "   AND  B.RATING_AGENCY IN( " +
            "                          'Expert RA', " +
            "                          'АКРА', " +
            "                          'Standard ' ||'&'||' Poor''s', " +
            "                          'Moody''s', " +
            "                          'Fitch Ratings', " +
            "                          'Эксперт РА' " +
            "     ) " +
            "   OR B.RATING_AGENCY = ? " +
            "       AND 1 = ? ) " +
            "  AND B.FININSTID = ? " +
            "  AND B.RATING_OBJECT_TYPE = 'Компания' " +
            "  AND ( 1 = ? " +
            "   AND B.DT = ( SELECT MAX(C.DT) FROM sofr_rating_ratingshistory C " +
            "                WHERE C.FININSTID = B.FININSTID " +
            "                 AND C.RATING_OBJECT_TYPE = B.RATING_OBJECT_TYPE " +
            "                 AND  C.DT <= ? " +
            "                 AND C.RATING_ID = B.RATING_ID " +
            "                 AND C.RATING_AGENCY = B.RATING_AGENCY ) " +
            "   OR  0 = ? ) " +
            " ORDER BY RATING_AGENCY, DT ";
  end;

  AddColumn(@Column, 0, "DT", "Дата значения", 12, V_DATE );
  AddColumn(@Column, 1, "LAST", "Значение", 10, V_STRING );
  AddColumn(@Column, 2, "RATING_OFFICIAL_NAME", "Вид рейтинга", 106, V_STRING );
  AddColumn(@Column, 3, "RATING_AGENCY", "Агентство", 15, V_STRING );
  AddColumn(@Column, 4, "RATING_OBJECT_TYPE", "Объект", 12, V_STRING );
  AddColumn(@Column, 5, "RATING_ID", "ID вида рейтинга", 12, V_STRING );
  AddColumn(@Column, 6, "ACCEPT_SOFR", "СОГЛ", 5, V_STRING );
  AddColumn(@Column, 7, "LOAD_SOFR", "СОФР", 5, V_STRING );

  cmd = RsdCommand(Query);
  if( UserRUDATAProcPanel.SelectCode == 0 )
    //по ценной бумаге ISIN
   
   cmd.AddParam("p_ObjType_1", RSDBP_IN, 12 );
   cmd.AddParam("p_GroupId_1", RSDBP_IN, 53 );
   cmd.AddParam("p_ObjType_2", RSDBP_IN, 12 );
   cmd.AddParam("p_GroupId_2", RSDBP_IN, 53 );
   cmd.AddParam("ISIN_1", RSDBP_IN, UserRUDATAProcPanel.ISIN_INN_INTERFAX );
   cmd.AddParam("p_ObjType_3", RSDBP_IN, 12 );
   cmd.AddParam("p_GroupId_3", RSDBP_IN, 53 );
   cmd.AddParam("ISIN_2", RSDBP_IN, UserRUDATAProcPanel.ISIN_INN_INTERFAX );
   cmd.AddParam("FlAgency_1", RSDBP_IN, UserRUDATAProcPanel.FlAgency );
   cmd.AddParam("Agency", RSDBP_IN, UserRUDATAProcPanel.AgencyName );
   cmd.AddParam("FlAgency_2", RSDBP_IN, UserRUDATAProcPanel.FlAgency );
   cmd.AddParam("FlDate_1", RSDBP_IN, BoolToInt(UserRUDATAProcPanel.Fl_AllDateRep) );
   cmd.AddParam("DateRep", RSDBP_IN, UserRUDATAProcPanel.DateRep );
   cmd.AddParam("FlDate_2", RSDBP_IN, BoolToInt(UserRUDATAProcPanel.Fl_AllDateRep) );
  elif( UserRUDATAProcPanel.SelectCode == 1 )
   //по эмитенту ИНН
   cmd.AddParam("p_ObjType_1", RSDBP_IN, 3 );
   cmd.AddParam("p_GroupId_1", RSDBP_IN, 19 );
   cmd.AddParam("p_ObjType_2", RSDBP_IN, 3 );
   cmd.AddParam("p_GroupId_2", RSDBP_IN, 19 );
   cmd.AddParam("IssuerINN_1", RSDBP_IN, UserRUDATAProcPanel.ISIN_INN_INTERFAX );
   cmd.AddParam("p_ObjType_4", RSDBP_IN, 3 );
   cmd.AddParam("p_CodeKind", RSDBP_IN, 16 );
   cmd.AddParam("p_ObjType_3", RSDBP_IN, 3 );
   cmd.AddParam("p_GroupId_3", RSDBP_IN, 19 );
   cmd.AddParam("FlAgency_1", RSDBP_IN, UserRUDATAProcPanel.FlAgency );
   cmd.AddParam("Agency", RSDBP_IN, UserRUDATAProcPanel.AgencyName );
   cmd.AddParam("FlAgency_2", RSDBP_IN, UserRUDATAProcPanel.FlAgency );
   cmd.AddParam("IssuerINN_2", RSDBP_IN, UserRUDATAProcPanel.ISIN_INN_INTERFAX );
   cmd.AddParam("FlDate_1", RSDBP_IN, BoolToInt(UserRUDATAProcPanel.Fl_AllDateRep) );
   cmd.AddParam("DateRep", RSDBP_IN, UserRUDATAProcPanel.DateRep );
   cmd.AddParam("FlDate_2", RSDBP_IN, BoolToInt(UserRUDATAProcPanel.Fl_AllDateRep) );
  elif( UserRUDATAProcPanel.SelectCode == 2 )
   //по эмитенту INTERFAX
   cmd.AddParam("p_ObjType_1", RSDBP_IN, 3 );
   cmd.AddParam("p_GroupId_1", RSDBP_IN, 19 );
   cmd.AddParam("p_ObjType_2", RSDBP_IN, 3 );
   cmd.AddParam("p_GroupId_2", RSDBP_IN, 19 );
   cmd.AddParam("IssuerIFX_1", RSDBP_IN, UserRUDATAProcPanel.ISIN_INN_INTERFAX );
   cmd.AddParam("p_ObjType_4", RSDBP_IN, 3 );
   cmd.AddParam("p_CodeKind", RSDBP_IN, 106 );
   cmd.AddParam("p_ObjType_3", RSDBP_IN, 3 );
   cmd.AddParam("p_GroupId_3", RSDBP_IN, 19 );
   cmd.AddParam("FlAgency_1", RSDBP_IN, UserRUDATAProcPanel.FlAgency );
   cmd.AddParam("Agency", RSDBP_IN, UserRUDATAProcPanel.AgencyName );
   cmd.AddParam("FlAgency_2", RSDBP_IN, UserRUDATAProcPanel.FlAgency );
   cmd.AddParam("IssuerIFX_2", RSDBP_IN, UserRUDATAProcPanel.ISIN_INN_INTERFAX );
   cmd.AddParam("FlDate_1", RSDBP_IN, BoolToInt(UserRUDATAProcPanel.Fl_AllDateRep) );
   cmd.AddParam("DateRep", RSDBP_IN, UserRUDATAProcPanel.DateRep );
   cmd.AddParam("FlDate_2", RSDBP_IN, BoolToInt(UserRUDATAProcPanel.Fl_AllDateRep) );
  end;

  DataSet = RSDRecordSet( cmd, RSDVAL_CLIENT, RSDVAL_STATIC );
  RunScroll( DataSet, 8, Column, "LisrRating", @EventHandler, "Контроль рейтингов", "~Esc~ Выход", true, 2, 8 );

end;
//листалка рейтингов

//панель параметров рейтингов
class (TRsbPanel) UserRUDATAPanel( DateReport_ :date )
var DateRep :date = DateReport_,
    ISIN_INN_INTERFAX :string = "",
    AgencyName :string = "",
    FlAgency :integer = 0,
    Fl_ISIN_INN :bool = true,
    Fl_AllDateRep :bool = false,
    SelectCode :integer = 0;

  InitTRsbPanel();
  SetCaption("Контроль данных RUDATA");
  SetStatus("~F2~ Выполнить ~F3~ Выбор ~Esc~ Выход");
  SetSize(38,8);
  SetPosition(2,1);



  var SelectCodeCmbBox :TRsbComboBox = TRsbComboBox();
      SelectCodeCmbBox.SetPosition(2,2);
      SelectCodeCmbBox.SetSize(7,1);
      SelectCodeCmbBox.Enabled = true;
      SelectCodeCmbBox.Editable = false;
      SelectCodeCmbBox.focusable = true;
      SelectCodeCmbBox.Name = "SelectCodeCmbBox";
      SelectCodeCmbBox.AddChoice(0, "ISIN");
      SelectCodeCmbBox.AddChoice(1, "ИНН");
      SelectCodeCmbBox.AddChoice(2, "INTERFAX");
      SelectCodeCmbBox.Name = "SelectCodeCmbBox";
      AddControl(SelectCodeCmbBox);
      SelectCodeCmbBox.CurrentChoice = 0;
      SelectCode = SelectCodeCmbBox.CurrentChoice;



  var ISIN_INNEdFld :TRsbEditField = TRsbEditField(FT_STRING);
      ISIN_INNEdFld.SetPosition(10,2);
      ISIN_INNEdFld.SetSize(12,1);
      ISIN_INNEdFld.TextLength = 12;
      ISIN_INNEdFld.Enabled = true;
      ISIN_INNEdFld.Editable = true;
      ISIN_INNEdFld.focusable = true;
      ISIN_INNEdFld.Name = "ISIN_INNEdFld";
      ISIN_INNEdFld.Value = ISIN_INN_INTERFAX;
      AddControl(ISIN_INNEdFld);


  var AgencyLabel :TRsbLabel = TRsbLabel(3, 4, "Агентство");
      AddLabel(AgencyLabel);

  var CmbBox :TRsbComboBox = TRsbComboBox();
      CmbBox.SetPosition(10,4);
      CmbBox.SetSize(25,1);
      CmbBox.Enabled = true;
      CmbBox.Editable = false;
      CmbBox.focusable = true;
      CmbBox.Name = "CmbBox";
      CmbBox.AddChoice(0, "Все");
      CmbBox.AddChoice(1, "Fitch Ratings");
      CmbBox.AddChoice(2, "Standard & Poor's");
      CmbBox.AddChoice(3, "Moody's");
      CmbBox.AddChoice(4, "Эксперт РА");
      CmbBox.AddChoice(5, "АКРА");
      AddControl(CmbBox);
      CmbBox.CurrentChoice = 0;

  var DateRepLabel :TRsbLabel = TRsbLabel(3, 6, "Дата");
      AddLabel(DateRepLabel);

  var DateRepEdFld :TRsbEditField = TRsbEditField(FT_DATE);
      DateRepEdFld.SetPosition(10,6);
      DateRepEdFld.SetSize(9,1);
      DateRepEdFld.Enabled = true;
      if( Fl_AllDateRep )
       DateRepEdFld.value = DateRep;
      else
       DateRepEdFld.value = date("00.00.00");
      end;
      DateRepEdFld.Editable = Fl_AllDateRep;
      DateRepEdFld.focusable = Fl_AllDateRep;
      DateRepEdFld.Name = "DateRepEdFld";
      AddControl(DateRepEdFld);

  var AllDateRepCheckBox :TRsbCheckBox = TRsbCheckBox;
      AllDateRepCheckBox.SetPosition(7,6);
      AllDateRepCheckBox.Checked = Fl_AllDateRep;
      AllDateRepCheckBox.Name = "AllDateRepCheckBox";
      AddControl(AllDateRepCheckBox);


  AddEventHandler(RSB_EV_KEY_PRESSED, R2M(this, "onKeyPressed"));

  macro onKeyPressed(RsbEvent:Object)
  var focusedControl;

   if( RsbEvent.KeyCode == 317 )  //F3
    focusedControl = this.focusedControl();

    if( focusedControl.Name == "DateRepEdFld" )
     DateRep = GetDateByCalendar(DateRep);
     if( DateRep != DateRepEdFld.value  )
      DateRepEdFld.value = DateRep;
     end;
    end;
  
   elif( RsbEvent.KeyCode == 32 )  //Space
    focusedControl = this.focusedControl();

    if( focusedControl.Name == "AllDateRepCheckBox" )

      if( AllDateRepCheckBox.Checked )
       DateRepEdFld.value = DateRep;
       Fl_AllDateRep = AllDateRepCheckBox.Checked;
      else
       DateRepEdFld.value = date("00.00.00");
       Fl_AllDateRep = AllDateRepCheckBox.Checked;
      end;
      DateRepEdFld.Editable = Fl_AllDateRep;
      DateRepEdFld.focusable = Fl_AllDateRep;
     
    end;

   elif( RsbEvent.KeyCode == 27 )  //Esc
    this.Close(RsbEvent.KeyCode);
   elif( RsbEvent.KeyCode == 316 )  //F2
    //вызываем листалку рейтингов
    DateRep = DateRepEdFld.Value;
    ISIN_INN_INTERFAX = ISIN_INNEdFld.Value;
    SelectCode = SelectCodeCmbBox.CurrentChoice;
    if( CmbBox.CurrentChoice == 0 )
     FlAgency = 0;
     AgencyName = "";
    else
     FlAgency = 1;
     AgencyName = CmbBox.Value;
    end;

    ListRatings( this )
    //вызываем листалку рейтингов
   end;


  end;

end;
//панель параметров рейтингов


var ExitCode :integer,
    DateRep :date = {CurDate};

//вызов панели

var UserRUDATAProcPanel :TRsbPanel = UserRUDATAPanel( DateRep );
    ExitCode = UserRUDATAProcPanel.Run;
//вызов панели

if( ExitCode == 316 )
 //перестроить скроллинг
 //перестроить скроллинг
end;
