import "SecurDealExecutor.mac";
import "FuncObj.mac";
import "cblogger2.mac";

//Точка входа funcobj
//здесь параметры другие в отличие от diasoft_Pko_blockSecurities_Open.mac 
macro main(pObjecttype, pObjectid /*dealid*/, pParam /*guid*/)
  var dealExeCcutor:SecurDealExecutor;
  var logger:c_logger = LoggerFactory().NewItLog("Diasoft_FinalStatus_Close.mac").GetLogger();

  if (dealExeCcutor.RunDeal(pObjectid, Date()))
    logger.Debug("Закрытие операции списания ЦБ " + string(pObjectid));
    return FuncObjResult(FUNCOBJ_STATE_OK, "", FUNCOBJ_RESULT_OK);
  else
    logger.Debug("Ошибка при закрытии операции списания ЦБ " + string(pObjectid));
    return FuncObjResult(FUNCOBJ_STATE_FATAL_ERROR, "Ошибка при закрытии операции списания ЦБ", FUNCOBJ_RESULT_ERROR);
  end;
end;
