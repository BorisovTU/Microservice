import globals, oralib, likepy;

macro Portfolio(dateIn)//èäã èÆ‡‚‰•´Ï
var Params:TArray;
Params = makeArray(SQLParam("", dateIn));
var sql = ExecSqlSelect("select * from tRSHB_Portfolio_PKL_2CHD where report_dt = ?", params, true);
sql.movenext();
if (valtype(sql.value(0)) != 26);
    execSQL("delete from tRSHB_Portfolio_PKL_2CHD where report_dt = ?",Params );
end;
Params = makeArray(SQLParam("", datein));
execSQL ("BEGIN rsFillPortfolio(?); END;",Params);
   OnError(er)
      return false;
end;

macro FZOZ(dateIn) //303 ‰Æ‡¨†
var Params:TArray;
Params = makeArray(SQLParam("", dateIn),
                   SQLParam("", dateIn) );
execSQL ("begin RSHB_F303_2CHD.RSHB_F303_2CHD_GEN (:date1, :Date2); end;",Params);
   OnError(er)
      return false;
end;

macro PFI(dateIn) //èäã èîà
var Params:TArray;
Params = makeArray(SQLParam("", dateIn));
var sql = ExecSqlSelect("select * from tRSHB_PFI_PKL_2CHD where report_dt = ?", params, true);
sql.movenext();
if (valtype(sql.value(0)) != 26);
    execSQL("delete from tRSHB_PFI_PKL_2CHD where report_dt = ?",Params );
end;
execSQL ("begin rsFillPFI(?);end;",Params);
   OnError(er)
      return false;
end;

macro Repo(dateIn) //èäã ê•ØÆ
var Params:TArray;
Params = makeArray(SQLParam("", dateIn));
var sql = ExecSqlSelect("select * from tRSHB_REPO_PKL_2CHD where report_dt = ?", params, true);
sql.movenext();
if (valtype(sql.value(0)) != 26);
    execSQL("delete from tRSHB_REPO_PKL_2CHD where report_dt = ?",Params );
end;
Params = makeArray(SQLParam("", dateIn));
execSQL ("BEGIN SECUR_DWHINFO.PrepareREPO(?); END;",Params);
   OnError(er)
      return false;
end;

macro SOFR_PKL_Start
var sql = ExecSqlSelect("select trunc(sysdate)-3 from dual");
sql.movenext();
var outdate = sql.value(0);
Portfolio(outdate);
Repo(outdate);
PFI(outdate);
FZOZ(outdate);
end;

