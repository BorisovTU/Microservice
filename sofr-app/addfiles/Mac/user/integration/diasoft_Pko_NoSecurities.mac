import "spDeal.mac";
import "FuncObj.mac";

//Точка входа funcobj
macro main(pObjecttype, pObjectid /*pko_writeoff.id*/, pParam /*pko_writeoff.operationid*/)
  var dealid = 0;
  //найти в Картотеке запись об созданной операции
  var sql = "select pko.* from pko_writeoff pko where id = :1";
  var cmd = RSDCommand(sql);
  cmd.AddParam(":1",RSDBP_IN,pObjectId);
  cmd.Execute;
  var rs = TrsbDataSet(cmd);
  if (not rs.movenext)
    AddItLog("Операция не найдена в Картотеке pko_writeoff");
    return FuncObjResult(FUNCOBJ_STATE_FATAL_ERROR, "Операция не найдена в Картотеке pko_writeoff", FUNCOBJ_RESULT_ERROR); //если не нашли в Картотеке операцию, то выполнить операцию нельзя
  else
    dealid = rs.dealid;
  end;
  diasoft_Pko_NoSecurities_func(dealid);
  return FuncObjResult(FUNCOBJ_STATE_OK, "", FUNCOBJ_RESULT_OK);   
end;

//main(null,13 , null);

