//А.Киселев 17.09.2018 Сервис вставки платежа/проводки 7.2.13.
//SOFR_AddAccountingEntries
//!!!!!!!!!!!!Все восклицательные знаки должны быть обработанны в соответствии с текстом комментария и удалены

import globals, likepy, oralib, DealsInter, InsCarryDoc, PaymInter, vabkpnum, vsbkpnum, dl_car, email_notifyfun;
import "global_utils_intgr.mac";

private const HEADER_EMAIL :string = "SOFR_AddAccountingEntries сервис создания входящего платежа/проводки в СОФР",
              LIST_ADDRESS_RECEIVER_EMAIL = "", //!!!!!!!!!!!!!!!!!!список адресов получателей через ;
              UNIVERSAL_ERROR_CODE  = -3001;


private class TLegalEntityPayerInfo
var INN :string = "",
    KPP :string = "", // обязательное: Нет
    OKATO :string = "", // обязательное: Нет
    OKTMO :string = "", // обязательное: Нет
    BankAccount :string = "",
    BIC :string = "",
    CorrAccount :string = "",
    BankName :string = "",
    CorpPayerName :string = "";
end;


private class TPersPayerInfo
var INN :string = "", // обязательное: Нет
    BankAccount :string = "", // обязательное: Нет
    BIC :string = "",
    CorrAccount :string = "",
    BankName :string = "",
    Treasury3 :string = "", // обязательное: Нет
    Treasury1 :date, // обязательное: Нет
    CountryRec :string = "", // обязательное: Нет
    BankCountryRec :string = "", // обязательное: Нет
    PersPayerFio :string = "";
end;


private class TCorpPayeeInfo
var INN :string = "",
    KPP :string = "",
    LegalEntityName :string = "", // обязательное: Нет
    LegalAddress :string = "", // обязательное: Нет
    LegalEntityID :string = "", // обязательное: Нет
    ContractNumber :string = "", // обязательное: Нет
    BankAccount :string = ""; // обязательное: Нет
end;


private class TPersPayeeInfo
var LastName :string = "",
    FirstName :string = "",
    MiddleName :string = "", //обязательное: Нет
    ResidenceAddress :string = "", //обязательное: Нет
    DocumentType :string = "", //обязательное: Нет
    DocumentNumber :string = "", //обязательное: Нет
    DocumentIssue :date, //обязательное: Нет
    DocumentIssuer :string = "", //обязательное: Нет
    INN :string = "", //обязательное: Нет
    PersonID :string = "", //обязательное: Нет
    ContractNumber :string = "", // обязательное: Нет
    BankAccount :string = ""; // обязательное: Нет
end;


private class TEntry( )
var EntryId :string = "",
    OperationalDay :date,
    PersonnelNumber :string = "",
    BranchID :string = "",
    EntryType :string = "",
    PayTool :string = "",
    DebitAccount :string = "",
    DebitAmount :string = "",
    DebitCurrencyCode :string = "",
    CreditAccount :string = "",
    CreditAmount :string = "",
    CreditCurrencyCode :string = "",
    EntryDetails :string = "",
    EntryNumber :string = "", // обязательное: Нет
    SuspectType :string = "", // обязательное: Нет
    EntryStatus :string = "",
    ControllerPersonnelNumber :string = "", // обязательное: Нет
    LegalEntityPayerInfo :object /*TLegalEntityPayerInfo*/, // обязательное: Нет
    PersPayerInfo :object /*TPersPayerInfo*/, // обязательное: Нет
    CorpPayeeInfo :object /*TCorpPayeeInfo*/, // обязательное: Нет
    PersPayeeInfo :object /*TPersPayeeInfo*/; // обязательное: Нет
end;

private class TEntryResult
var ResponseCode :string = "",
    ResponseNote :string = "", // обязательное: Нет
    ReferenceId :string = "", // обязательное: Нет
    EntryNumber :string = "",
    EntryID :string = ""; // обязательное: Нет
end;


//параметры ответа из RS-Securities СОФР
private class TSOFR_AddAccountingEntriesResp( )
 var EntryResult :TEntryResult;
end;


//параметры запроса из RS-Securities СОФР
private class TSOFR_AddAccountingEntriesReq( RequestObj_ :object )
var Entry :TEntry;
private var ErrMsg :string = "",
            FlError :bool = false,
            ErrObj :object;


 private macro GetErrText( ) :string

  return ErrMsg;

 end;


 //заполнение входящего параметра-объекта
 private macro InitPropertyReq( RequestObj_ :object )

   ErrMsg = "";
   FlError = false;
   ErrObj = TEntryResult;
   ErrObj.ResponseCode = 0; /* Значение по умолчанию - ошибок нет */


   if( (ValType(RequestObj_.Entry.EntryId) == V_UNDEF) or (ValType(RequestObj_.Entry.EntryId) == 26) or (RequestObj_.Entry.EntryId == "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"EntryId\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.EntryId = RequestObj_.Entry.EntryId;
   end;

   if( (ValType(RequestObj_.Entry.OperationalDay) == V_UNDEF) or (ValType(RequestObj_.Entry.OperationalDay) == 26) or (RequestObj_.Entry.OperationalDay == date("00.00.00")) )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"OperationalDay\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.OperationalDay = RequestObj_.Entry.OperationalDay;
   end;

   if( (ValType(RequestObj_.Entry.PersonnelNumber) == V_UNDEF) or (ValType(RequestObj_.Entry.PersonnelNumber) == 26) or (RequestObj_.Entry.PersonnelNumber == "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"PersonnelNumber\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.PersonnelNumber = RequestObj_.Entry.PersonnelNumber;
   end;

   if( (ValType(RequestObj_.Entry.BranchID) == V_UNDEF) or (ValType(RequestObj_.Entry.BranchID) == 26) or (RequestObj_.Entry.BranchID == "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"BranchID\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.BranchID = RequestObj_.Entry.BranchID;
   end;

   if( (ValType(RequestObj_.Entry.EntryType) == V_UNDEF) or (ValType(RequestObj_.Entry.EntryType) == 26) or (RequestObj_.Entry.EntryType == "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"EntryType\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.EntryType = RequestObj_.Entry.EntryType;
   end;

   if( (ValType(RequestObj_.Entry.PayTool) == V_UNDEF) or (ValType(RequestObj_.Entry.PayTool) == 26) or (RequestObj_.Entry.PayTool == "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"PayTool\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.PayTool = RequestObj_.Entry.PayTool;
   end;

   if( (ValType(RequestObj_.Entry.DebitAccount) == V_UNDEF) or (ValType(RequestObj_.Entry.DebitAccount) == 26) or (RequestObj_.Entry.DebitAccount== "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"DebitAccount\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.DebitAccount = RequestObj_.Entry.DebitAccount;
   end;

   if( (ValType(RequestObj_.Entry.DebitAmount) == V_UNDEF) or (ValType(RequestObj_.Entry.DebitAmount) == 26) or (RequestObj_.Entry.DebitAmount== "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"DebitAmount\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.DebitAmount = RequestObj_.Entry.DebitAmount;
   end;

   if( (ValType(RequestObj_.Entry.DebitCurrencyCode) == V_UNDEF) or (ValType(RequestObj_.Entry.DebitCurrencyCode) == 26) or (RequestObj_.Entry.DebitCurrencyCode== "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"DebitCurrencyCode\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.DebitCurrencyCode = RequestObj_.Entry.DebitCurrencyCode;
   end;

   if( (ValType(RequestObj_.Entry.CreditAccount) == V_UNDEF) or (ValType(RequestObj_.Entry.CreditAccount) == 26) or (RequestObj_.Entry.CreditAccount== "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"CreditAccount\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.CreditAccount = RequestObj_.Entry.CreditAccount;
   end;

   if( (ValType(RequestObj_.Entry.CreditAmount) == V_UNDEF) or (ValType(RequestObj_.Entry.CreditAmount) == 26) or (RequestObj_.Entry.CreditAmount== "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"CreditAmount\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.CreditAmount = RequestObj_.Entry.CreditAmount;
   end;

   if( (ValType(RequestObj_.Entry.CreditCurrencyCode) == V_UNDEF) or (ValType(RequestObj_.Entry.CreditCurrencyCode) == 26) or (RequestObj_.Entry.CreditCurrencyCode == "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"CreditCurrencyCode\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.CreditCurrencyCode = RequestObj_.Entry.CreditCurrencyCode;
   end;

   if( (ValType(RequestObj_.Entry.EntryDetails) == V_UNDEF) or (ValType(RequestObj_.Entry.EntryDetails) == 26) or (RequestObj_.Entry.EntryDetails == "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"EntryDetails\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.EntryDetails = RequestObj_.Entry.EntryDetails;
   end;

   if( (ValType(RequestObj_.Entry.EntryNumber) != V_UNDEF) and (ValType(RequestObj_.Entry.EntryNumber) != 26) and (RequestObj_.Entry.EntryNumber != "") )
    Entry.EntryNumber = RequestObj_.Entry.EntryNumber;
   end;

   if( (ValType(RequestObj_.Entry.SuspectType) != V_UNDEF) and (ValType(RequestObj_.Entry.SuspectType) != 26) and (RequestObj_.Entry.SuspectType != "") )
    Entry.SuspectType = RequestObj_.Entry.SuspectType;
   end;

   if( (ValType(RequestObj_.Entry.EntryStatus) == V_UNDEF) or (ValType(RequestObj_.Entry.EntryStatus) == 26) or (RequestObj_.Entry.EntryStatus == "") )
    FlError = true;
    ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
    ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"EntryStatus\""; 
    ErrObj.ResponseNote = ErrMsg;
    Entry = Null;
   else
    Entry.EntryStatus = RequestObj_.Entry.EntryStatus;
   end;

   if( (ValType(RequestObj_.Entry.ControllerPersonnelNumber) != V_UNDEF) and (ValType(RequestObj_.Entry.ControllerPersonnelNumber) != 26) and (RequestObj_.Entry.ControllerPersonnelNumber != "") )
    Entry.ControllerPersonnelNumber = RequestObj_.Entry.ControllerPersonnelNumber;
   end;


   if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo) != V_UNDEF) and (ValType(RequestObj_.Entry.LegalEntityPayerInfo) != 26) )
    Entry.LegalEntityPayerInfo = TLegalEntityPayerInfo;

    if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo.INN) == V_UNDEF) or (ValType(RequestObj_.Entry.LegalEntityPayerInfo.INN) == 26) or (RequestObj_.Entry.LegalEntityPayerInfo.INN == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"INN\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.LegalEntityPayerInfo.INN = RequestObj_.Entry.LegalEntityPayerInfo.INN;
    end;

    if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo.KPP) != V_UNDEF) and (ValType(RequestObj_.Entry.LegalEntityPayerInfo.KPP) != 26) and (RequestObj_.Entry.LegalEntityPayerInfo.KPP != "") )
     Entry.LegalEntityPayerInfo.KPP = RequestObj_.Entry.LegalEntityPayerInfo.KPP;
    end;

    if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo.OKATO) != V_UNDEF) and (ValType(RequestObj_.Entry.LegalEntityPayerInfo.OKATO) != 26) and (RequestObj_.Entry.LegalEntityPayerInfo.OKATO != "") )
     Entry.LegalEntityPayerInfo.OKATO = RequestObj_.Entry.LegalEntityPayerInfo.OKATO;
    end;

    if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo.OKTMO) != V_UNDEF) and (ValType(RequestObj_.Entry.LegalEntityPayerInfo.OKTMO) != 26) and (RequestObj_.Entry.LegalEntityPayerInfo.OKTMO != "") )
     Entry.LegalEntityPayerInfo.OKTMO = RequestObj_.Entry.LegalEntityPayerInfo.OKTMO;
    end;

    if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo.BankAccount) == V_UNDEF) or (ValType(RequestObj_.Entry.LegalEntityPayerInfo.BankAccount) == 26) or (RequestObj_.Entry.LegalEntityPayerInfo.BankAccount == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"BankAccount\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.LegalEntityPayerInfo.BankAccount = RequestObj_.Entry.LegalEntityPayerInfo.BankAccount;
    end;

    if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo.BIC) == V_UNDEF) or (ValType(RequestObj_.Entry.LegalEntityPayerInfo.BIC) == 26) or (RequestObj_.Entry.LegalEntityPayerInfo.BIC == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"BIC\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.LegalEntityPayerInfo.BIC = RequestObj_.Entry.LegalEntityPayerInfo.BIC;
    end;

    if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo.CorrAccount) == V_UNDEF) or (ValType(RequestObj_.Entry.LegalEntityPayerInfo.CorrAccount) == 26) or (RequestObj_.Entry.LegalEntityPayerInfo.CorrAccount == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"CorrAccount\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.LegalEntityPayerInfo.CorrAccount = RequestObj_.Entry.LegalEntityPayerInfo.CorrAccount;
    end;

    if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo.BankName) == V_UNDEF) or (ValType(RequestObj_.Entry.LegalEntityPayerInfo.BankName) == 26) or (RequestObj_.Entry.LegalEntityPayerInfo.BankName == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"BankName\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.LegalEntityPayerInfo.BankName = RequestObj_.Entry.LegalEntityPayerInfo.BankName;
    end;

    if( (ValType(RequestObj_.Entry.LegalEntityPayerInfo.CorpPayerName) == V_UNDEF) or (ValType(RequestObj_.Entry.LegalEntityPayerInfo.CorpPayerName) == 26) or (RequestObj_.Entry.LegalEntityPayerInfo.CorpPayerName == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"CorpPayerName\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.LegalEntityPayerInfo.CorpPayerName = RequestObj_.Entry.LegalEntityPayerInfo.CorpPayerName;
    end;

   end;


   if( (ValType(RequestObj_.Entry.PersPayerInfo) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayerInfo) != 26) )
    Entry.PersPayerInfo = TPersPayerInfo;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.INN) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayerInfo.INN) != 26) and (RequestObj_.Entry.PersPayerInfo.INN != "") )
     Entry.PersPayerInfo.INN = RequestObj_.Entry.PersPayerInfo.INN;
    end;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.BankAccount) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayerInfo.BankAccount) != 26) and (RequestObj_.Entry.PersPayerInfo.BankAccount != "") )
     Entry.PersPayerInfo.BankAccount = RequestObj_.Entry.PersPayerInfo.BankAccount;
    end;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.BIC) == V_UNDEF) or (ValType(RequestObj_.Entry.PersPayerInfo.BIC) == 26) or (RequestObj_.Entry.PersPayerInfo.BIC == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"BIC\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.PersPayerInfo.BIC = RequestObj_.Entry.PersPayerInfo.BIC;
    end;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.CorrAccount) == V_UNDEF) or (ValType(RequestObj_.Entry.PersPayerInfo.CorrAccount) == 26) or (RequestObj_.Entry.PersPayerInfo.CorrAccount == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"CorrAccount\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.PersPayerInfo.CorrAccount = RequestObj_.Entry.PersPayerInfo.CorrAccount;
    end;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.BankName) == V_UNDEF) or (ValType(RequestObj_.Entry.PersPayerInfo.BankName) == 26) or (RequestObj_.Entry.PersPayerInfo.BankName == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"BankName\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.PersPayerInfo.BankName = RequestObj_.Entry.PersPayerInfo.BankName;
    end;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.Treasury3) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayerInfo.Treasury3) != 26) and (RequestObj_.Entry.PersPayerInfo.Treasury3 != "") )
     Entry.PersPayerInfo.Treasury3 = RequestObj_.Entry.PersPayerInfo.Treasury3;
    end;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.Treasury1) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayerInfo.Treasury1) != 26) and (RequestObj_.Entry.PersPayerInfo.Treasury1 != date("00.00.00") ) )
     Entry.PersPayerInfo.Treasury1 = RequestObj_.Entry.PersPayerInfo.Treasury1;                                                                  
    end;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.CountryRec) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayerInfo.CountryRec) != 26) and (RequestObj_.Entry.PersPayerInfo.CountryRec != "") )
     Entry.PersPayerInfo.CountryRec = RequestObj_.Entry.PersPayerInfo.CountryRec;
    end;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.BankCountryRec) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayerInfo.BankCountryRec) != 26) and (RequestObj_.Entry.PersPayerInfo.BankCountryRec != "") )
     Entry.PersPayerInfo.BankCountryRec = RequestObj_.Entry.PersPayerInfo.BankCountryRec;
    end;

    if( (ValType(RequestObj_.Entry.PersPayerInfo.PersPayerFio) == V_UNDEF) or (ValType(RequestObj_.Entry.PersPayerInfo.PersPayerFio) == 26) or (RequestObj_.Entry.PersPayerInfo.PersPayerFio == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"PersPayerFio\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.PersPayerInfo.PersPayerFio = RequestObj_.Entry.PersPayerInfo.PersPayerFio;
    end;

   end;


   if( (ValType(RequestObj_.Entry.CorpPayeeInfo) != V_UNDEF) and (ValType(RequestObj_.Entry.CorpPayeeInfo) != 26) )
    Entry.CorpPayeeInfo = TCorpPayeeInfo;

    if( (ValType(RequestObj_.Entry.CorpPayeeInfo.INN) == V_UNDEF) or (ValType(RequestObj_.Entry.CorpPayeeInfo.INN) == 26) or (RequestObj_.Entry.CorpPayeeInfo.INN == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"INN\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.CorpPayeeInfo.INN = RequestObj_.Entry.CorpPayeeInfo.INN;
    end;

    if( (ValType(RequestObj_.Entry.CorpPayeeInfo.KPP) == V_UNDEF) or (ValType(RequestObj_.Entry.CorpPayeeInfo.KPP) == 26) or (RequestObj_.Entry.CorpPayeeInfo.KPP == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"KPP\""; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.CorpPayeeInfo.KPP = RequestObj_.Entry.CorpPayeeInfo.KPP;
    end;

    if( (ValType(RequestObj_.Entry.CorpPayeeInfo.LegalEntityName) != V_UNDEF) and (ValType(RequestObj_.Entry.CorpPayeeInfo.LegalEntityName) != 26) and (RequestObj_.Entry.CorpPayeeInfo.LegalEntityName != "") )
     Entry.CorpPayeeInfo.LegalEntityName = RequestObj_.Entry.CorpPayeeInfo.LegalEntityName;
    end;

    if( (ValType(RequestObj_.Entry.CorpPayeeInfo.LegalAddress) != V_UNDEF) and (ValType(RequestObj_.Entry.CorpPayeeInfo.LegalAddress) != 26) and (RequestObj_.Entry.CorpPayeeInfo.LegalAddress != "") )
     Entry.CorpPayeeInfo.LegalAddress = RequestObj_.Entry.CorpPayeeInfo.LegalAddress;
    end;

    if( (ValType(RequestObj_.Entry.CorpPayeeInfo.LegalEntityID) != V_UNDEF) and (ValType(RequestObj_.Entry.CorpPayeeInfo.LegalEntityID) != 26) and (RequestObj_.Entry.CorpPayeeInfo.LegalEntityID != "") )
     Entry.CorpPayeeInfo.LegalEntityID = RequestObj_.Entry.CorpPayeeInfo.LegalEntityID;
    end;

    if( (ValType(RequestObj_.Entry.CorpPayeeInfo.ContractNumber) != V_UNDEF) and (ValType(RequestObj_.Entry.CorpPayeeInfo.ContractNumber) != 26) and (RequestObj_.Entry.CorpPayeeInfo.ContractNumber != "") )
     Entry.CorpPayeeInfo.ContractNumber = RequestObj_.Entry.CorpPayeeInfo.ContractNumber;
    end;

    if( (ValType(RequestObj_.Entry.CorpPayeeInfo.BankAccount) != V_UNDEF) and (ValType(RequestObj_.Entry.CorpPayeeInfo.BankAccount) != 26) and (RequestObj_.Entry.CorpPayeeInfo.BankAccount != "") )
     Entry.CorpPayeeInfo.BankAccount = RequestObj_.Entry.CorpPayeeInfo.BankAccount;
    end;

   end;


   if( (ValType(RequestObj_.Entry.PersPayeeInfo) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo) != 26) )
    Entry.PersPayeeInfo = TPersPayeeInfo;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.LastName) == V_UNDEF) or (ValType(RequestObj_.Entry.PersPayeeInfo.LastName) == 26) or (RequestObj_.Entry.PersPayeeInfo.LastName == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"LastName\"" ; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.PersPayeeInfo.LastName = RequestObj_.Entry.PersPayeeInfo.LastName;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.FirstName) == V_UNDEF) or (ValType(RequestObj_.Entry.PersPayeeInfo.FirstName) == 26) or (RequestObj_.Entry.PersPayeeInfo.FirstName == "") )
     FlError = true;
     ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
     ErrMsg = ErrMsg + " | "+ "не получен обязательный параметр \"FirstName\"" ; 
     ErrObj.ResponseNote = ErrMsg;
     Entry = Null;
    else
     Entry.PersPayeeInfo.FirstName = RequestObj_.Entry.PersPayeeInfo.FirstName;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.MiddleName) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.MiddleName) != 26) and (RequestObj_.Entry.PersPayeeInfo.MiddleName != "") )
     Entry.PersPayeeInfo.MiddleName = RequestObj_.Entry.PersPayeeInfo.MiddleName;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.ResidenceAddress) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.ResidenceAddress) != 26) and (RequestObj_.Entry.PersPayeeInfo.ResidenceAddress != "") )
     Entry.PersPayeeInfo.ResidenceAddress = RequestObj_.Entry.PersPayeeInfo.ResidenceAddress;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.DocumentType) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.DocumentType) != 26) and (RequestObj_.Entry.PersPayeeInfo.DocumentType != "") )
     Entry.PersPayeeInfo.DocumentType = RequestObj_.Entry.PersPayeeInfo.DocumentType;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.DocumentNumber) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.DocumentNumber) != 26) and (RequestObj_.Entry.PersPayeeInfo.DocumentNumber != "") )
     Entry.PersPayeeInfo.DocumentNumber = RequestObj_.Entry.PersPayeeInfo.DocumentNumber;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.DocumentIssue) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.DocumentIssue) != 26) and (RequestObj_.Entry.PersPayeeInfo.DocumentIssue != date("00.00.00")) )
     Entry.PersPayeeInfo.DocumentIssue = RequestObj_.Entry.PersPayeeInfo.DocumentIssue;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.DocumentIssuer) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.DocumentIssuer) != 26) and (RequestObj_.Entry.PersPayeeInfo.DocumentIssuer != "") )
     Entry.PersPayeeInfo.DocumentIssuer = RequestObj_.Entry.PersPayeeInfo.DocumentIssuer;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.INN) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.INN) != 26) and (RequestObj_.Entry.PersPayeeInfo.INN != "") )
     Entry.PersPayeeInfo.INN = RequestObj_.Entry.PersPayeeInfo.INN;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.PersonID) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.PersonID) != 26) and (RequestObj_.Entry.PersPayeeInfo.PersonID != "") )
     Entry.PersPayeeInfo.PersonID = RequestObj_.Entry.PersPayeeInfo.PersonID;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.ContractNumber) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.ContractNumber) != 26) and (RequestObj_.Entry.PersPayeeInfo.ContractNumber != "") )
     Entry.PersPayeeInfo.ContractNumber = RequestObj_.Entry.PersPayeeInfo.ContractNumber;
    end;

    if( (ValType(RequestObj_.Entry.PersPayeeInfo.BankAccount) != V_UNDEF) and (ValType(RequestObj_.Entry.PersPayeeInfo.BankAccount) != 26) and (RequestObj_.Entry.PersPayeeInfo.BankAccount != "") )
     Entry.PersPayeeInfo.BankAccount = RequestObj_.Entry.PersPayeeInfo.BankAccount;
    end;

   end;

 onError(err)
   FlError = true;
   ErrObj.ResponseCode = UNIVERSAL_ERROR_CODE;
   ErrMsg = ErrMsg + " | "+ "При обработке параметров котировки возникла ошибка: " + c_usr_err_obj.obtain_err_msg(err) ; 
   ErrObj.ResponseNote = ErrMsg;
   Entry = Null;
 end;

 if(RequestObj_ != Null)
  InitPropertyReq( RequestObj_ ) //конструктор
 end;

end;



//получить шифр операции
private macro VAVS_GetShifrOper( PayerAccount :string, PayerFIID :integer, ReceiverAccount :string, ReceiverFIID :integer, Chapter:integer )
 record PayerAcc("account");
 record ReceiverAcc("account");

 ClearRecord(PayerAcc);
 ClearRecord(ReceiverAcc);

 DL_GetAccount( Chapter, PayerFIID, PayerAccount, PayerAcc);
 DL_GetAccount( Chapter, ReceiverFIID, ReceiverAccount, ReceiverAcc);

 return DL_GetShifrOper(Chapter, PayerAcc, ReceiverAcc); 

end;
//получить шифр операции


//получим главу счета
private macro GetChapterByAcc( Account :string ) :integer
var Query :string = "",
    DataSet :RsdRecordset,
    Params :TArray;


 Query = " SELECT T_CHAPTER FROM dbalance_dbt " +
         " WHERE T_INUMPLAN = 0 " +
         "  AND T_BALANCE = SUBSTR(:Account, 1, 5) ";

 Params = makeArray( SQLParam("Account", Account) );
 DataSet = execSQLselect( Query, Params );

 if( DataSet.MoveNext )
  return DataSet.value(0, Null, V_INTEGER);
 else
  return -1;
 end;

end;
//получим главу счета


//получим FIID из ISO кода валюты
private macro GetFiidFromCodeISO( FiKind :integer, FiCode :string ) :integer
var Query :string = "",
    DataSet :RsdRecordset,
    Params :TArray;


 Query = " SELECT T_FIID FROM dfininstr_dbt " +
         " WHERE T_FI_KIND = :FiKind " +
         "  AND T_FI_CODE = :FiCode ";

 Params = makeArray( SQLParam("FiKind", FiKind),
                     SQLParam("FiCode", FiCode) );
 DataSet = execSQLselect( Query, Params );

 if( DataSet.MoveNext )
  return DataSet.value(0, Null, V_INTEGER);
 else
  return -1;
 end;

end;
//получим FIID из ISO кода валюты


//получим счет из СПИ ДО
/*
private macro GetAccFromSiContr( ContrId :integer, FiCode :string, ContrAccountId :@integer, ContrClientId :@integer ) :string
var Query :string = "",
    DataSet :RsdRecordset,
    Params :TArray;


 Query = " SELECT A.T_ACCOUNT, B.T_ACCOUNTID, B.T_CLIENT FROM dsettacc_dbt A, daccount_dbt B " +
         " WHERE A.T_SETTACCID = (SELECT A.T_SETACCID FROM " +
         "                        (SELECT T_SETACCID FROM dsfssi_dbt " +
         "                         WHERE T_OBJECTTYPE = :ObjType " +
         "                          AND T_OBJECTID = LPAD( :ContrId, 10, '0') " +
         "                          AND T_FIKIND = :FiKind_1 " +
         "                          AND T_FIID = (SELECT T_FIID FROM dfininstr_dbt B " +
         "                                        WHERE B.T_FI_KIND = :FiKind_2 " +
         "                                         AND T_FI_CODE = :FiCode) " +
         "                         ORDER BY  T_ORDER ) A " +
         "                        WHERE ROWNUM = 1) " + 
         " AND B.T_ACCOUNT = A.T_ACCOUNT " +
         " AND B.T_CHAPTER = A.T_CHAPTER " +
         " AND B.T_CODE_CURRENCY = A.T_FIID ";

 Params = makeArray( SQLParam("ObjType", 659),
                     SQLParam("ContrId", ContrId),
                     SQLParam("FiKind_1", 1),
                     SQLParam("FiKind_2", 1),
                     SQLParam("FiCode", FiCode) );
 DataSet = execSQLselect( Query, Params );

 if( DataSet.MoveNext )
  ContrAccountId = DataSet.value(1);
  ContrClientId = DataSet.value(2);
  return DataSet.value(0, Null, V_STRING);
 else
  return "";
 end;

end;
*/
//получим счет из СПИ ДО


//получим счет из СПИ субъекта и PartyId банка
private macro GetSfSiAccountParty( PartyId :integer, FiCode :string, Account :string, PartyIdBank :@integer ) :string
var Params :TArray,
    state :integer = 0,
    Acc :string = "";


 Params = makeArray( SQLParam("p_PartyId", PartyId),
                     SQLParam("p_ServiceKind", 1 ),
                     SQLParam("p_KindOper", 2037 ),
                     SQLParam("p_FiKind", 1 ),
                     SQLParam("p_FiCode", FiCode ),
                     SQLParam("p_Account", Account ),
                     SQLParam("p_AccountResult", V_STRING , RSDBP_OUT ),
                     SQLParam("p_BankId", V_INTEGER , RSDBP_OUT ) );
 state = execStoredFunc( "USR_PKG_IMPORT_SOFR.GetSfSiAccountAndBankPartyId", V_INTEGER, Params );
 if( state == 0 )
  Acc = Params.Value(6).Value;
  PartyIdBank = Params.Value(7).Value;
 else
  PartyIdBank = -1;
 end;
 Params = Null;

 return Acc;
end;
//получим счет из СПИ субъекта


//создаем СПИ субъекта
private macro SetSfSiAccountParty( PartyId :integer, ServiceKind :integer, KindOper :integer, FiKind :integer, FiCode :string, Account :string,
  PartyIdBank :integer, BankDate :date ) :integer
var Params :TArray,
    state :integer = 0;


 Params = makeArray( SQLParam("p_PartyId", PartyId),
                     SQLParam("p_ServiceKind", ServiceKind ),
                     SQLParam("p_KindOper", KindOper ),
                     SQLParam("p_FiKind", FiKind ),
                     SQLParam("p_FiCode", FiCode ),
                     SQLParam("p_Account", Account ),
                     SQLParam("p_BankId", PartyIdBank ),
                     SQLParam("p_BankDate", BankDate ) );
 state = execStoredFunc( "USR_PKG_IMPORT_SOFR.AddSfSiForParty", V_INTEGER, Params );
 Params = Null;

 return state;
end;
//создаем СПИ субъекта



//зачисления на счета БУ для ФИССиКО

private macro FX_AddPaymOrTrn( AccountPayer :string, SumPayer :money, FIIDPayer :integer,         
                               AccountReceiver :string, SumReceiver :money, FIIDReceiver :integer,
                               NumberDoc :string, Ground :string, PaymentID :integer, Method :integer, Chapter :integer,
                               DateCarry :date, DateRate :date, ResultCarry :integer, SumNATCUR :money ) :integer
var Trn :object,
    PaymentObj :object;

 PaymentObj = Null;
 Trn = Null;

 if( (ValType(Method) == V_UNDEF) or (ValType(Method) == 26) ) 
  Method = PMMET_ID;
 end;

 if( (ValType(DateCarry) == V_UNDEF) or (ValType(DateCarry) == 26) )
  DateCarry = {Curdate};
 end;

 if( (ValType(Ground) == V_UNDEF) or (ValType(Ground) == 26) ) 
  Ground = "";
 end;

 if( (ValType(ResultCarry) == V_UNDEF) or (ValType(ResultCarry) == 26) )  
  ResultCarry = 1;
 end;

 if( (ValType(NumberDoc) == V_UNDEF) or (ValType(NumberDoc) == 26) )  
  NumberDoc = "1";
 end;

 if( ( Method != PMMET_ID_TMP_OP ) and (ValType(PaymentID) != V_UNDEF) and (ValType(PaymentID) != 26) and ( PaymentID > 0 ) )
  PaymentObj = RSBPayment( PaymentID );
  Trn = PaymentObj.MakeTransaction();
 else
  Trn = RsbAccTransaction();
 end;

 if( Trn == NULL )
  return 1;
 end;

 Trn.Chapter = Chapter;
 Trn.Date_Carry = DateCarry;
 Trn.Date_Rate = DateRate;

 if( PaymentObj != Null )
  Trn.Number_Pack = PaymentObj.NumberPack;
 end;

 if( PaymentObj != Null )
  Trn.Numb_Document = PaymentObj.Number;
 else
  Trn.Numb_Document = NumberDoc;
 end;

 Trn.ResultCarry = ResultCarry;
 Trn.Kind_Oper = "";
 Trn.Ground = Ground;
 Trn.Department = {OperDprt};
 Trn.FIIDPayer = FIIDPayer;
 Trn.FIIDReceiver = FIIDReceiver;
 Trn.SumPayer = SumPayer;
 Trn.SumReceiver = SumReceiver;

 if( ValType(SumNATCUR) == V_MONEY )
  Trn.SumEquivalentCarry = SumNATCUR;
 end;

 Trn.AccountPayer = AccountPayer;
 Trn.AccountReceiver = AccountReceiver;

 if( PaymentObj == Null )
  Trn.Shifr_Oper = "09";
 else
  Trn.Shifr_Oper = PaymentObj.ShifrOper;
 end;

 if( not Trn.Carry() )
  return 1;
 end;

 if( PaymentObj != Null )
  PaymentObj = Null;
 end;

 if( Trn != Null )
  Trn = Null;
 end;

 return 0;

onError(err)

// ErrObj.ResponseCode = c_usr_err_obj.obtain_err_code(err);
// ErrMsg = ErrMsg + " | "+ "Не создан входящий платеж: " + c_usr_err_obj.obtain_err_msg(err); 
// ErrObj.ResponseNote = ErrMsg;
// ResponseObj.EntryResult = ErrObj;
// ErrObj = Null;
// RequestObj = Null;
                                     
// return ResponseObj;

end;

//зачисления на счета БУ для ФИССиКО



   //зачисления на счета БУ для БОЦБ
/*!!!!!!!
MACRO ПроводкаПоКатегориямУчета( FD, СчетДебет, СчетКредит, ДатаВалютирования,
                                 Chapter ,FIID, СуммаОперации, docum,
                                 Result_Carry, Kind_Oper,Numb_Document,Ground,
                                 PaymentID, FIRolePayer, FIRoleReceiver,
                                 СчетДебетFIID, СчетКредитFIID, FIID2, СуммаОперации2,
                                 PaymID_type, 
                                 IsSummaryCarry, /*Признак сводной проводки*/
                                 IsInnerCarry,   /*Признак провордки по ВУ*/
                                 ВидРО, PmObj, DebAccNumber:@string, CredAccNumber:@string, NatSum:@money,
                                 DebPairAcc, CredPairAcc )
   var stat:bool = true, CуммаДебет = $0, СуммаКредит  = $0, 
      СчетОВПДебет = "", СчетОВПКредит = "", СчетДоходов = "", СчетРасходов = "";

   var tr, NoCarry:bool = false;
   var PaymentObj = null;

   record AccountPayer(account);
   record AccountReceiver(account);

   if ( FD != NULL )
    if ((FD.tick != NULL) AND (Numb_Document == ""))
       Numb_Document = FD.tick.rec.DealCode;
    end;
   end;

   CarryError = "";
   macro SayCarryError( error )
     if( isOprMultiExec() == false )
        msgbox( error );
     else
        CarryError = error;
     end;
     return false;
   end;

   if( IsSummaryCarry == null )
     IsSummaryCarry = false;
   end;

   if( (СуммаОперации == null) AND (СуммаОперации2 == null) )  
     return SayCarryError( "В проводке не задана ни одна из сумм." );
   end;
     
   /*оставить только копейки для первой суммы, если она задана*/
   if( СуммаОперации != null )
     if( Chapter != 5 ) /*количество ц/б может быть дробным*/
        СуммаОперации = money( round( СуммаОперации, 2 ) );    
     end;
     if( СуммаОперации < $0 )  
        return SayCarryError( "Сумма проводки < 0." );
     end;
   else  
    СуммаОперации = $0;
   end;
   /*для второй суммы, если она задана*/
   if( СуммаОперации2 != null )
     if( Chapter != 5 ) /*количество ц/б может быть дробным*/
        СуммаОперации2 = money( round( СуммаОперации2, 2 ) );
     end;
     if( СуммаОперации2 < $0 )  
        return SayCarryError( "Вторая сумма проводки < 0." );
     end;
   else
    СуммаОперации2 = $0;
   end;

   if( (СуммаОперации == $0) AND (СуммаОперации2 == $0) )  
     return true;
   end;

   if( ValType(СчетДебет) == V_STRING ) /*задан через категорию*/
     if( /*(not FD.IsExistAccount( СчетДебет, null, true, FIRolePayer, AccountPayer, null, ДатаВалютирования, СчетДебетFIID)) and*/
         (not FD.OpenAccount( СчетДебет, null, true, FIRolePayer, AccountPayer, ДатаВалютирования, СчетДебетFIID, null, null, DebPairAcc)) )
         if( not FD.ReOpenAccount( СчетДебет, null, false, FIRolePayer, AccountPayer, ДатаВалютирования, СчетДебетFIID, null, DebPairAcc) )
             return SayCarryError( "Ошибка при определении счета по категории "+СчетДебет+" в проводке.");
         end;
     end;
   else
     copy( AccountPayer, СчетДебет );
   end;

   if( ValType(СчетКредит) == V_STRING ) /*задан через категорию*/
     if( /*(not FD.IsExistAccount( СчетКредит, null, true, FIRoleReceiver, AccountReceiver, null, ДатаВалютирования, СчетКредитFIID)) and*/
         (not FD.OpenAccount( СчетКредит, null, true, FIRoleReceiver, AccountReceiver, ДатаВалютирования, СчетКредитFIID, null, null, CredPairAcc)) )
         if( not FD.ReOpenAccount(СчетКредит, null, false, FIRoleReceiver, AccountReceiver, ДатаВалютирования, СчетКредитFIID, null, CredPairAcc) )
            return SayCarryError( "Ошибка при определении счета по категории "+СчетКредит+" в проводке." );
         end;
     end;
   else
     copy( AccountReceiver, СчетКредит );
   end;

   if( PaymID_type == null )
     PaymID_type = PMMET_ID;
   end;

   if( AccountPayer.Code_Currency == AccountReceiver.Code_Currency)

     /*задана только вторая сумма в валюте одного из счетов*/
     if( (FIID == null) AND (FIID2 != null) )
        FIID = FIID2;
     elif( (FIID == null) AND (FIID2 == null) )
        return SayCarryError("Не задана ни одна из валют проводки.");
     end;

     if( (FIID != AccountPayer.Code_Currency) AND
         (FIID != AccountReceiver.Code_Currency) )
        return SayCarryError( "В проводке не совпадают валюты счетов: " 
                               + string(AccountPayer.Code_Currency) + " " + string( AccountReceiver.Code_Currency ) +
                              "| и валюта документа: " + string(FIID) );
     end;

     if( СуммаОперации != $0 )
        CуммаДебет = СуммаКредит = СуммаОперации;
     elif( СуммаОперации2 != $0 )
        CуммаДебет = СуммаКредит = СуммаОперации2;
     end;
     
     if( (IsSummaryCarry == false) AND 
         НужнаСводнаяПроводка( FD, СчетДебет, СчетКредит, Chapter )
       )
        stat = ДобавитьСводнуюПроводку( FD, AccountPayer, AccountReceiver, ДатаВалютирования, CуммаДебет, $0, Result_Carry, Ground );
        if( not stat ) 
           return SayCarryError("Ошибка при вставке документа сводной проводки.");
        else
               NoCarry = true; /*сформировали сводную проводку - ниже выполнять проводку не надо*/
           end;
     end;

   else /* валюты разные - мультивалютная проводка */
      
     СуммаКредит = $0;
     CуммаДебет  = $0;
     
     /*задана одна сумма в валюте одного из счетов*/
     if( (FIID != null) AND (FIID2 == null) )
        if( FIID == AccountPayer.Code_Currency )
           CуммаДебет  = СуммаОперации;
        else
           СуммаКредит = СуммаОперации;
        end;
     /*задана только вторая сумма в валюте одного из счетов*/
     elif( (FIID2 != null) AND (FIID == null) )
        if( FIID2 == AccountPayer.Code_Currency )
           CуммаДебет  = СуммаОперации2;
        else
           СуммаКредит = СуммаОперации2;
        end;
     /*заданы обе суммы в валютах счетов по которым выполняем проводку*/
     elif( (FIID2 != null) AND (FIID != null) )                         
       if( FIID == AccountPayer.Code_Currency ) 
          CуммаДебет  = СуммаОперации;
       elif( FIID2 == AccountPayer.Code_Currency ) 
          CуммаДебет  = СуммаОперации2;
       end;

       if( FIID == AccountReceiver.Code_Currency ) 
          СуммаКредит = СуммаОперации;
       elif( FIID2 == AccountReceiver.Code_Currency ) 
          СуммаКредит = СуммаОперации2;
       end;
     else
        return SayCarryError("Не задана ни одна из валют проводки.");
     end;

     if( not CheckMultyCarrySum( AccountPayer.Code_Currency, AccountReceiver.Code_Currency,
                                 CуммаДебет, СуммаКредит, ДатаВалютирования ) )
        return SayCarryError("Ошибка при определении сумм мультивалютной проводки.");
     end;

     if( (IsSummaryCarry == false) AND 
         НужнаСводнаяПроводка( FD, СчетДебет, СчетКредит, Chapter )
       )
        stat = ДобавитьСводнуюПроводку( FD, AccountPayer, AccountReceiver, ДатаВалютирования, CуммаДебет, СуммаКредит, Result_Carry, Ground );
        if( not stat ) 
           return SayCarryError("Ошибка при вставке документа сводной проводки.");
        else
              NoCarry = true; /*сформировали сводную проводку - ниже выполнять проводку не надо*/
           end;
        end;
     end;

   if( NoCarry == false )
      /* ------ Выполнить проводку ----------------------------------------------*/
      if( PmObj OR ((PaymID_type != PMMET_ID_TMP_OP) AND ((PaymentID != NULL) AND (PaymentID > 0))) )
           /*проводку формируем по платежу*/
         if (PmObj)
            PaymentObj = PmObj;
         else
            PaymentObj = RSBPayment( PaymentID );
         end;

         tr = PaymentObj.MakeTransaction();
      else
         /*проводку формируем без платежа*/
         tr = RsbAccTransaction();
      end;
              
      if( tr == NULL )
         return SayCarryError("Ошибка при создании проводки");
      end;

      tr.Chapter         = Chapter;
      tr.Date_Carry      = ДатаВалютирования;
      if( PaymentObj != null )
         tr.Number_Pack  = PaymentObj.NumberPack;
      end;
      tr.Numb_Document   = Numb_Document;
      tr.ResultCarry     = 1;
      tr.Kind_Oper       = Kind_Oper;
      tr.Ground          = Ground;
      tr.Department      = {OperDprt};
      tr.Oper            = {oper};
      tr.FIIDPayer       = AccountPayer.Code_Currency;
      tr.FIIDReceiver    = AccountReceiver.Code_Currency;
      tr.SumPayer        = CуммаДебет;
      tr.SumReceiver     = СуммаКредит;
      tr.AccountPayer    = AccountPayer.Account;
      tr.AccountReceiver = AccountReceiver.Account;
      tr.Shifr_Oper      = DL_GetShifrOper(Chapter, AccountPayer, AccountReceiver);
      tr.AddOFRSymbol(SC_GetOFRRecID(FD, AccountPayer, AccountReceiver, FIRolePayer, FIRoleReceiver, ДатаВалютирования));

      if( not tr.Carry() )
         return SayCarryError("Ошибка при выполнении проводки");
      end;
      /*-------------------------------------------------------------------------*/  
      if( DebAccNumber != null )
         DebAccNumber = tr.AccountPayer;
      end;

      if( CredAccNumber != null )
         CredAccNumber = tr.AccountReceiver;
      end;

      if( NatSum != null )
         if( tr.FIIDPayer == NATCUR )
            NatSum = tr.SumPayer;
         elif( tr.FIIDReceiver == NATCUR )
            NatSum = tr.SumReceiver;
         else
            NatSum = $0.0;
         end;
      end;

   end;

   if( not stat ) 
      return SayCarryError("Ошибка при вставке документа проводки.");
   end;

   return stat;
END;


*/
   //зачисления на счета БУ для БОЦБ


//зачисления на счета БУ для УВ

private macro VA_AddPaymOrTrn( AccountPayer :string, SumPayer :money, FIIDPayer :integer,         
                               AccountReceiver :string, SumReceiver :money, FIIDReceiver :integer,
                               NumberDoc :string, Ground :string, PaymentID :integer, Method :integer, Chapter :integer,
                               DateCarry :date, DateRate :date, ResultCarry :integer, SumNATCUR :money, ShifrOper :string ) :integer
var Trn :object,
    PaymentObj :object;

 PaymentObj = Null;
 Trn = Null;


 if( (ValType(Method) == V_UNDEF) or (ValType(Method) == 26) ) 
  Method = PMMET_ID;
 end;

 if( (ValType(DateCarry) == V_UNDEF) or (ValType(DateCarry) == 26) )
  DateCarry = {Curdate};
 end;

 if( (ValType(Ground) == V_UNDEF) or (ValType(Ground) == 26) ) 
  Ground = "";
 end;

 if( (ValType(ResultCarry) == V_UNDEF) or (ValType(ResultCarry) == 26) )  
  ResultCarry = 1;
 end;

 if( (ValType(NumberDoc) == V_UNDEF) or (ValType(NumberDoc) == 26) )  
  if( FIIDPayer == FIIDReceiver ) // Номер док-та пока заполняем только для одновалютных проводок
   NumberDoc = VA_GetBookpassNum( AccountPayer, AccountReceiver, FIIDPayer, Chapter );
  else
   NumberDoc = "1";
  end;
 end;

 if( (ValType(ShifrOper) == V_UNDEF) or (ValType(ShifrOper) == 26) )  
  ShifrOper = "";
 end;

 if( ( Method != PMMET_ID_TMP_OP ) and (ValType(PaymentID) != V_UNDEF) and (ValType(PaymentID) != 26) and ( PaymentID > 0 ) )
  PaymentObj = RSBPayment( PaymentID );
  Trn = PaymentObj.MakeTransaction();
 else
  Trn = RsbAccTransaction();
 end;

 if( Trn == NULL )
  return 1;
 end;

 Trn.Chapter = Chapter;
 Trn.Date_Carry = DateCarry;

 if( PaymentObj != Null )
  Trn.Number_Pack = PaymentObj.NumberPack;
 end;

 if( PaymentObj != Null )
  Trn.Numb_Document = PaymentObj.Number;
 else
  Trn.Numb_Document = NumberDoc;
 end;

 Trn.ResultCarry = ResultCarry;
 Trn.Kind_Oper = "";
 Trn.Ground = Ground;
 Trn.Department = {OperDprt};
 Trn.FIIDPayer = FIIDPayer;
 Trn.FIIDReceiver = FIIDReceiver;
 Trn.SumPayer = SumPayer;
 Trn.SumReceiver = SumReceiver;

 if( ValType(SumNATCUR) == V_MONEY )
  Trn.SumEquivalentCarry = SumNATCUR;
 end;

 Trn.AccountPayer = AccountPayer;
 Trn.AccountReceiver = AccountReceiver;

 if( PaymentObj == Null )
  Trn.Shifr_Oper = VAVS_GetShifrOper( AccountPayer, FIIDPayer, AccountReceiver, FIIDReceiver, Chapter ); //"09";
 else
  Trn.Shifr_Oper = PaymentObj.ShifrOper;
 end;

 if( not Trn.Carry() )
  return 1;
 end;

 if( PaymentObj != Null )
  PaymentObj = Null;
 end;

 if( Trn != Null )
  Trn = Null;
 end;

 return 0;
end;

//зачисления на счета БУ для УВ



//зачисления на счета БУ для СВ

private macro VS_AddPaymOrTrn( AccountPayer :string, SumPayer :money, FIIDPayer :integer,         
                               AccountReceiver :string, SumReceiver :money, FIIDReceiver :integer,
                               NumberDoc :string, Ground :string, PaymentID :integer, Method :integer, Chapter :integer,
                               DateCarry :date, DateRate :date, ResultCarry :integer, SumNATCUR :money, ShifrOper :string ) :integer


var Trn :object,
    PaymentObj :object;

 PaymentObj = Null;
 Trn = Null;


 if( (ValType(Method) == V_UNDEF) or (ValType(Method) == 26) ) 
  Method = PMMET_ID;
 end;

 if( (ValType(DateCarry) == V_UNDEF) or (ValType(DateCarry) == 26) )
  DateCarry = {Curdate};
 end;

 if( (ValType(Ground) == V_UNDEF) or (ValType(Ground) == 26) ) 
  Ground = "";
 end;

 if( (ValType(ResultCarry) == V_UNDEF) or (ValType(ResultCarry) == 26) )  
  ResultCarry = 1;
 end;

 if( (ValType(NumberDoc) == V_UNDEF) or (ValType(NumberDoc) == 26) )  
  if( FIIDPayer == FIIDReceiver ) // Номер док-та пока заполняем только для одновалютных проводок
   NumberDoc = VS_GetBookpassNum( AccountPayer, AccountReceiver, FIIDPayer, Chapter );
  else
   NumberDoc = "1";
  end;
 end;

 if( (ValType(ShifrOper) == V_UNDEF) or (ValType(ShifrOper) == 26) )  
  ShifrOper = "";
 end;

 if( ( Method != PMMET_ID_TMP_OP ) and (ValType(PaymentID) != V_UNDEF) and (ValType(PaymentID) != 26) and ( PaymentID > 0 ) )
  PaymentObj = RSBPayment( PaymentID );
  Trn = PaymentObj.MakeTransaction();
 else
  Trn = RsbAccTransaction();
 end;

 if( Trn == NULL )
  return 1;
 end;

 Trn.Chapter = Chapter;
 Trn.Date_Carry = DateCarry;

 if( PaymentObj != Null )
  Trn.Number_Pack = PaymentObj.NumberPack;
 end;

 if( PaymentObj != Null )
  Trn.Numb_Document = PaymentObj.Number;
 else
  Trn.Numb_Document = NumberDoc;
 end;


 Trn.ResultCarry = ResultCarry;
 Trn.Kind_Oper = "";
 Trn.Ground = Ground;
 Trn.Department = {OperDprt};
 Trn.FIIDPayer = FIIDPayer;
 Trn.FIIDReceiver = FIIDReceiver;
 Trn.SumPayer = SumPayer;
 Trn.SumReceiver = SumReceiver;

 if( ValType(SumNATCUR) == V_MONEY )
  Trn.SumEquivalentCarry = SumNATCUR;
 end;

 Trn.AccountPayer = AccountPayer;
 Trn.AccountReceiver = AccountReceiver;

 if( PaymentObj == Null )
  Trn.Shifr_Oper = VAVS_GetShifrOper( AccountPayer, FIIDPayer, AccountReceiver, FIIDReceiver, Chapter ); //"09";
 else
  Trn.Shifr_Oper = PaymentObj.ShifrOper;
 end;

 if( not Trn.Carry() )
  return 1;
 end;

 if( PaymentObj != Null )
  PaymentObj = Null;
 end;

 if( Trn != Null )
  Trn = Null;
 end;

 return 0;

end;

//зачисления на счета БУ для СВ




//процедура вставки платежа/проводки вызов из RS-Secirities
macro SOFR_AddAccountingEntries( RequestObj_ :@object ) :object //входные данные объект класса TSOFR_AddAccountingEntriesReq
var RequestObj :TSOFR_AddAccountingEntriesReq = TSOFR_AddAccountingEntriesReq( RequestObj_ ),
    ResponseObj :TSOFR_AddAccountingEntriesResp = TSOFR_AddAccountingEntriesResp( ),
    ErrObj :object,
    ErrMsg :string = "",
    Params :TArray = TArray(),
    state :integer = 0,
    PartyId :integer = -1,
    LegalForm :integer = 0,
    PartyIdBank :integer = -1,
    SfContrAcc :string = "",
    ContrNumber :string = "",
    ContrId :integer = 0,
    ContrAccountId :integer,
    ContrClientId :integer,
    SfSiAccountContr :string = "",
    SfSiAccountParty :string = "",
    Mode :integer = 0;

//!!!!!!!!!!!!!! нужно по каким-то параметрам RequestObj определить какую процедуру вставки платежа/проводки дергать

//   var err_txt;



   if( (Substr(RequestObj.Entry.CreditAccount, 1, 5) == "30601") or (Substr(RequestObj.Entry.CreditAccount, 1, 5) == "30606") )
    Mode = 5;
   end;



   //зачисления на счета БУ для МБК
/*
CLASS MM_Carry
// главы счетов
  CONST
        CHPT_BALANCE    = 1,        // балансовые счета
        CHPT_OFFBALANCE = 3;        // внебалансовые счета

  VAR 
// ___параметры поиска счетов плательщика/получателя
    CatPayer        = "",      CatReceiver     = "",       // категории плательщика/получателя
    FDPayer         = NULL,    FDReceiver      = NULL,     // ПД плательщика/получателя
    FiRolePayer     = NULL,    FiRoleReceiver  = NULL,     // роль ФИ плательщика/получателя
    DatePayer       = NULL,    DateReceiver    = NULL,     // дата актуализации счётов
// ___параметры RsbAccTransaction
    AccountPayer    = "",       AccountReceiver = "",
    FIIDPayer       = NATCUR,    FIIDReceiver  = NATCUR,
    FIIDActive      = NULL,
    SumPayer        = $0,      SumReceiver     = $0,
    Chapter         = CHPT_BALANCE,
    Date_carry      = {curdate},
    Department      = {OperDprt},
    Ground          = "",
    Sum             = $0,
    FIID            = NATCUR,
    ResultCarry     = NULL,
    PrimaryDoc      = NULL,
// ___доп. параметры
    Date_conv       = NULL,                                // дата курса для конвертации
    PaymentID       = 0,                                   // ID платежа
    PaymentObj      = NULL;

    PRIVATE MACRO ByDefault(variable, value) 
        if (ValType(variable) == V_UNDEF) 
            variable = value;
        end;
        return variable;
    END;

  PRIVATE MACRO ExceptionToTheRule(Cat)
      if (Cat == tdr_corespacc_vb)
          return true;
      end;

      return false;
  END;

// Получить счёт по категории
    PRIVATE MACRO CalcAccount(Cat, FD, Account:@string, Cur, FIRole, Date)
    var Acc = "";

        Date = ByDefault(Date, date_carry);
        if (FD)
            if (ExceptionToTheRule(Cat))
                Acc = MC_FindAndOpenCommonAccByFD(tdr_corespacc_vb, FD, Date, 0, MC_OPENACC_CREATE, NULL,NATCUR, 
                                                   NULL, NULL, NULL, FIRole, NULL, NULL, NULL, NULL, NULL, false, false);
            else
                             if ( Cat  == "+Обесп. кр., г/п")

                                Acc = MC_FindAndOpenAccountEx(Cat, FD, Date, 0, MC_OPENACC_CREATE, null, Cur, null, null, null, FIRole);
                             else


                if (FD.GetParametr(MC_TYPE_PARAMETR_DOCKIND) == DL_IBCDOC)
                    FD.OpenAccount(Cat, Acc, NULL, FiRole, NULL, Date, Cur);
                else
                    Acc = MC_FindAndOpenAccountEx(Cat, FD, Date, 0, MC_OPENACC_CREATE, null, Cur, null, null, null, FIRole);
                end;

                              end;





            end;

            if (Acc == "")
                return null;
            else
                Account = Acc;
                return Account;
            end;
        else
            return null;
        end;
    END; // CalcAccount()

// Пересчитать счёт плательщика (дебет)
    PRIVATE MACRO CalcPayerAccount()
        FDPayer = ByDefault(FDPayer, PrimaryDoc);
        return CalcAccount(CatPayer, FDPayer, @AccountPayer, FIIDPayer, FIRolePayer, DatePayer);
    END; // CalcPayerAccount()

// Получить счёт плательщика (дебет)
    PRIVATE MACRO GetPayerAccount()
        if (AccountPayer != "")
            return true;
        end;

        return CalcPayerAccount();
    END; // GetPayerAccount()

// Пересчитать счёт получателя (кредит)
    PRIVATE MACRO CalcReceiverAccount()
        FDReceiver = ByDefault(FDReceiver, PrimaryDoc);
        return CalcAccount(CatReceiver, FDReceiver, @AccountReceiver, FIIDReceiver, FIRoleReceiver, DateReceiver);
    END; // CalcReceiverAccount()

// Получить счёт получателя (кредит)
    PRIVATE MACRO GetReceiverAccount()
        if (AccountReceiver != "")
            return true;
        end;

        return CalcReceiverAccount();
    END; // GetReceiverAccount()

// реализация проводки
    PRIVATE MACRO CarryTrans()
    var tr = NULL;
    var RefID = 0;
    var Ref = "";

        if (ValType(PaymentObj) == V_GENOBJ)
            tr = PaymentObj.MakeTransaction();
        else
            tr = RsbAccTransaction();
        end;

        if(tr == NULL)
          return 1;
        end;

        tr.Chapter         = Chapter;
        tr.Date_Carry      = Date_carry;
        if (ValType(PaymentObj) == V_GENOBJ)
            tr.Number_Pack   = PaymentObj.NumberPack;
            tr.Numb_Document = trim(PaymentObj.Number);

            tr.Shifr_Oper = trim(PaymentObj.ShifrOper);
            if (tr.Shifr_Oper == "")
                tr.Shifr_Oper = "01";
            end;
        else
            tr.Shifr_Oper = "09";
        end;
      
        if (tr.Numb_Document == "")
/*
            if (PrimaryDoc.Kind == DL_IBCDOC)
                GetReferenceIDByType(OBJTYPE_MMARKDEAL, 2, refID);
                GenerateReference(refID, Ref);
                tr.Numb_Document = PrimaryDoc.GetTick().DealCode + "/" + Ref;
            end;
*/
        end;

        tr.ResultCarry     = ResultCarry;
        tr.Ground          = Ground;
        tr.Department      = Department;
        tr.FIIDPayer       = FIIDPayer;
        tr.FIIDReceiver    = FIIDReceiver;
        tr.SumPayer        = SumPayer;
        tr.SumReceiver     = SumReceiver;
        tr.AccountPayer    = AccountPayer;
        tr.AccountReceiver = AccountReceiver;
        tr.Date_Rate       = Date_conv;


        if (PrimaryDoc = -1 )
          tr.Number_Pack = 555;
          // tr.Status_After    = 4;  
        end;

        if( not tr.Carry() )
           return false;
        end;      
        return true;
    END;

// Конвертация
    PRIVATE MACRO DoConvert(sum_from, sum_to:@money, cur_from, cur_to)
    var s = $0, stat = 0;
        date_conv = ByDefault(date_conv, date_carry);

        stat = ConvSum(s, sum_from, date_conv, cur_from, cur_to, 0);
        if (stat)
            return false;
        end;

        sum_to = s;

        return true;
    END; // DoConvert()

// Конвертировать сумму получателя в сумму плательщика
    PRIVATE MACRO ConvertToPayer()
        return DoConvert(SumReceiver, @SumPayer, FIIDReceiver, FIIDPayer);
    END; // ConvertToPayer()

// Конвертировать сумму плательщика в сумму получателя
    PRIVATE MACRO ConvertToReceiver()
        return DoConvert(SumPayer, @SumReceiver, FIIDPayer, FIIDReceiver);
  END; // ConvertToPayer()

    PRIVATE MACRO ConvertToMoney(Amount:@Variant)
        Amount = ByDefault(Amount, $0);
        Amount = money( round( Amount, 2 ));
        if( Amount < $0 )
            return false;
        end;
    END; //ConvertToMoney()
    
// проводка
    MACRO Carry()
        if ((ConvertToMoney(@Sum))or(ConvertToMoney(@SumPayer))or(ConvertToMoney(@SumReceiver)))
            return false;
        end;

        if ((Sum == $0) and (SumPayer == $0) and (SumReceiver == $0))
            return true;
        end;

        FIIDActive = ByDefault(FIIDActive, FIIDPayer);

        if (FIID != NATCUR)
            FIIDPayer = FIID;
            FIIDReceiver = FIID;
        end;

        if (FIIDPayer == FIIDReceiver)
            if (Sum != $0)
                SumPayer = Sum;
                SumReceiver =Sum;
            elif (SumPayer != $0)
                SumReceiver = SumPayer;
            elif (SumReceiver != $0)
                SumPayer = SumReceiver;
            end;
        else
            if ((SumPayer == $0)and(SumReceiver == $0)and(Sum != $0))
                SumPayer = Sum;
            end;

            if ((FIIDPayer != FIIDActive)and(SumPayer!= $0))
                DoConvert(SumPayer, SumPayer, FIIDPayer, FIIDActive);
            end;

            if ((FIIDPayer != FIIDActive)and(SumReceiver!= $0))
                DoConvert(SumReceiver, SumReceiver, FIIDReceiver, FIIDActive);
            end;

            if ((SumPayer == $0) and (SumReceiver != $0))
                if (not ConvertToPayer())
                    return false;
                end;
            end;
        
            if ((SumReceiver == $0) and (SumPayer != $0))
                if (not ConvertToReceiver())
                    return false;
                end;
            end;
        end;


        // GetPayerAccount();

        // GetReceiverAccount();



        if (not GetPayerAccount())
            msgbox("Не найден счет получателя.");
            return false;
        end;


        if (not GetReceiverAccount())
            msgbox("Не найден счет плательщика !");
            return false;
        end;

        if( (PaymentID != NULL) AND (PaymentID > 0) )
            PaymentObj = RsbPayment( PaymentID );
        end;

        return CarryTrans();
    END; // Carry()
    
END;
*/
   //зачисления на счета БУ для МБК



   if( Mode == 0 )
    //зачисления на счета БУ для ФИССиКО

    state = FX_AddPaymOrTrn( RequestObj.Entry.DebitAccount, RequestObj.Entry.DebitAmount, GetFiidFromCodeISO( 1, RequestObj.Entry.DebitCurrencyCode ),         
                             RequestObj.Entry.CreditAccount, RequestObj.Entry.CreditAmount, GetFiidFromCodeISO( 1, RequestObj.Entry.CreditCurrencyCode ),
                             RequestObj.Entry.EntryNumber, RequestObj.Entry.EntryDetails, Null, Null, GetChapterByAcc(RequestObj.Entry.CreditAccount),
                             RequestObj.Entry.OperationalDay, RequestObj.Entry.OperationalDay, Null, Null );


    if( state == 0 )
     //!!!!!!!!!заполняем объект ResponseObj

    else
     //!!!!!!!!!если взведен признак отправлять ошибки в почту сотруднику
     AddNotifyToDbt(HEADER_EMAIL, "!!!текст ошибки!!", LIST_ADDRESS_RECEIVER_EMAIL);
     
     //!!!!пока работаем синхронно пока не появится задание планировщика, отловить флаг из реестра синхронный асинхронный режим
     SendNotyfyToEmail(/*fromCnv:bool, interface_mode:bool*/);//для синхронного режима




/*
   macro m_save_to_submit()
      vg_is_error = false;
      /* Сохранение в БД */
      AddNotifyToDbt(vg_msg_head, vg_msg_text, vg_email_list);

   onError(err)
      vg_is_error = true;
      vg_service_msg = c_usr_err_obj.obtain_err_msg(err);
   end;




*/

    end;
    //зачисления на счета БУ для ФИССиКО

   elif( Mode == 3)
    //зачисления на счета БУ для УВ
/*
    state =  VA_AddPaymOrTrn( AccountPayer :string, SumPayer :money, FIIDPayer :integer,         
                              AccountReceiver :string, SumReceiver :money, FIIDReceiver :integer,
                              NumberDoc :string, Ground :string, PaymentID :integer, Method :integer, Chapter :integer,
                              DateCarry :date, DateRate :date, ResultCarry :integer, SumNATCUR :money, ShifrOper :string ) :integer
*/
    if( state == 0 )
     //!!!!!!!!!заполняем объект ResponseObj
    end;
    //зачисления на счета БУ для УВ

   elif( Mode == 4)

    //зачисления на счета БУ для СВ
/*
    state =  VS_AddPaymOrTrn( AccountPayer :string, SumPayer :money, FIIDPayer :integer,         
                              AccountReceiver :string, SumReceiver :money, FIIDReceiver :integer,
                              NumberDoc :string, Ground :string, PaymentID :integer, Method :integer, Chapter :integer,
                              DateCarry :date, DateRate :date, ResultCarry :integer, SumNATCUR :money, ShifrOper :string );
*/
    if( state == 0 )
     //!!!!!!!!!заполняем объект ResponseObj
    end;
    //зачисления на счета БУ для СВ

   elif( Mode == 5 )

    //зачисление на сводные счета
    if( (ValType(RequestObj.Entry.PersPayeeInfo) != V_UNDEF) and (ValType(RequestObj.Entry.PersPayeeInfo) != 26) )
     ContrNumber = RequestObj.Entry.PersPayeeInfo.ContractNumber;
     LegalForm = 2;
    elif( (ValType(RequestObj.Entry.CorpPayeeInfo) != V_UNDEF) and (ValType(RequestObj.Entry.CorpPayeeInfo) != 26) )
     ContrNumber = RequestObj.Entry.CorpPayeeInfo.ContractNumber;
     LegalForm = 1;
    end;

    if((ValType(ContrNumber) != V_UNDEF) and (ValType(ContrNumber) != 26))
     //ищем Id суб-ДО
     Params = makeArray( SQLParam("p_LegalForm", LegalForm ),
                         SQLParam("p_ContrNumber", ContrNumber),
                         SQLParam("p_ObjectType", 0 ), //!!!!!!!!!!могут быть другие типы объекта
                         SQLParam("p_Account", RequestObj.Entry.CreditAccount),
                         SQLParam("p_ObjType", 659),
                         SQLParam("p_FiKind", 1),
                         SQLParam("p_FiCode", RequestObj.Entry.CreditCurrencyCode),
                         SQLParam("p_PartyId", V_INTEGER, RSDBP_OUT ),
                         SQLParam("p_ContrId", V_INTEGER, RSDBP_OUT ),
                         SQLParam("p_AccountContr", V_STRING, RSDBP_OUT ),
                         SQLParam("p_ContrAccountId", V_INTEGER, RSDBP_OUT )  ); 
     state = execStoredFunc( "USR_PKG_IMPORT_SOFR.GetPropFromContrNum", V_INTEGER, Params ); //!!!!!!!!!проблема уникального индекса (по T_NUMBER создать индекс) по номеру договора нет и не будет могут быть дубли
     if( state == 0 )
      PartyId = Params.Value(7).Value;
      ContrId = Params.Value(8).Value;
      SfContrAcc = Params.Value(9).Value;
      ContrAccountId = Params.Value(10).Value;
     end;
     Params = Null;

     if( state == 0 ) //!!!!!!!!
//      SfSiAccountContr = GetAccFromSiContr( ContrId, RequestObj.Entry.DebitCurrencyCode, @ContrAccountId, @ContrClientId );
//      SfSiAccountParty = GetSfSiAccountParty( PartyId, RequestObj.Entry.CreditCurrencyCode, RequestObj.Entry.CreditAccount, @PartyIdBank );

      SfSiAccountParty = GetSfSiAccountParty( PartyId, RequestObj.Entry.DebitCurrencyCode, RequestObj.Entry.DebitAccount, @PartyIdBank );
      if( (SfSiAccountParty == "") or ( SfSiAccountParty != RequestObj.Entry.DebitAccount )) //создать СПИ субъекта по счету из объекта в Нашем банке

       state = SetSfSiAccountParty( PartyId, 1, 2037, 1, RequestObj.Entry.DebitCurrencyCode, RequestObj.Entry.DebitAccount, {OurBank}, {CurDate} );
       PartyIdBank = {OurBank};
       if( state == 0 )
        SfSiAccountParty = RequestObj.Entry.DebitAccount;
       else
        //!!!!ошибка СПИ субъекта не нашли и не добавили
       end;
      end;


      if( ( SfSiAccountParty != "" ) and ( state == 0 ) and ( PartyIdBank != -1 ) )
       state = CreateNPTXOP(10,        //TYPE     //пока всегда 10-зачисление
         PartyId,          //получить на основании номера договора
         ContrId,      //получить на основании номера договора из СПИ по суб-ДО
         ContrAccountId /*SfSiAccountParty*/,  //получить на основании номера договора из СПИ по суб-ДО
         numeric(RequestObj.Entry.CreditAmount),  //получить из объекта RequestObj
         SfSiAccountParty /*SfSiAccountContr*/,   //получить на основании номера договора из СПИ субъекта  
         PartyIdBank,      //получить на основании номера договора из СПИ субъекта
         NULL,          //DATE
         time()         //TIME
         ); 


 /*
    stat = CreateNPTXOP(10,        //TYPE
          _sfcontr.partyid,        //CLIENT
          _sfcontr.contractid,     //CONTRACT
          _sfcontr.accountid,      //ACCOUNT
          IncomeData.SumReceiver,  //SUMM
          IncomeData.AccountPayer, //CLIENT ACCOUNT
          {OurBank},               //CLIENT BANK
          NULL,          //DATE
          time()         //TIME
          ); 

 */
       if( state == 0 )
        //!!!!!!!!!заполняем объект ResponseObj
       end;
    /*
       if (stat != 0)
          CreateErrMsg( stat );
          err_txt = GetErrMsg + " создание операции";
          RunError(err_txt, c_err_obj(err_txt, ERR_CODE_TECH_ERROR));      
       end;
    */   
      end;

     else
      //!!!!!!!!!!не нашли ДО
      //   ContrNumber = ContrNumFromGround( RequestObj.Entry.EntryDetails ); //!!!!!!!!!!!!пока берем из объекта, а может и из назначения платежа придется
     end;
    else
     //!!!!!!!!!!нет номера ДО в свойстве объекта что делать
     //   ContrNumber = ContrNumFromGround( RequestObj.Entry.EntryDetails ); //!!!!!!!!!!!!пока берем из объекта, а может и из назначения платежа придется
    end;
    //зачисление на сводные счета


   //требования по сделкам для БОЦБ
/*
MACRO Sp_CreatePayment( FD, Purpose:INTEGER, DocKind:INTEGER, DocID:INTEGER, 
                        ValueDate:DATE, Chapter:INTEGER,
                        PayerID:INTEGER, PayerBankID:INTEGER,
                        ReceiverID:INTEGER, ReceiverBankID:INTEGER,
                        IsFactPaym:STRING, 
                        BaseAmount:MONEY, BaseFIID:INTEGER, 
                        Amount:MONEY, FIID:INTEGER,       // Payer
                        PayAmount:MONEY, PayFIID:INTEGER, // Receiver
                        Ground:STRING, 
                        PayerAccount:STRING, ReceiverAccount:STRING,
                        Department:INTEGER, SubPurpose:INTEGER, 
                        PaymStatus:INTEGER, TmpPaymentID:INTEGER,
                        RetPmObj:@RsbPayment, RetPayment:@variant,
                        RetPaymPropDT:@variant, RetPaymPropCT:@variant,
                        CorschemDT:INTEGER, CorschemCT:INTEGER,
                        IsFixAmount:BOOL
                      ) :INTEGER

  VAR ErrStr = "", PayerName:string = "", ReceiverName:string = "", PayerBankName:string = "", ReceiverBankName:string = "";
  VAR PMObj, SavePayer, SaveReceiver;
  
  /* Если на одном шаге создается несколько обьектов то нужно обязательно передавать TmpPaymentID с отрицательным значением
     изза того что криво работает класс платежа
  */
  if( TmpPaymentID == NULL )
     TmpPaymentID = 0;
  end;

  PMObj = RsbPayment( TmpPaymentID );

  if( PMObj )
     /*Дублировать заполнение полей через Payment (TRecHandler) приходится из за отсутствия
       FillPaymentAccounts в классе платежа*/
     Payment.Clear();

     if( SubPurpose == NULL )
        SubPurpose = NewSubpurpose( Purpose, DocKind, DocID );
     end;

     Payment.rec.Purpose    = PMObj.Purpose      = Purpose;  
     Payment.rec.SubPurpose = PMObj.SubPurpose   = SubPurpose;
     Payment.rec.PaymStatus = PMObj.PaymStatus   = IIF( PaymStatus == NULL, PM_PREPARING, PaymStatus );
     Payment.rec.DocKind    = PMObj.DocKind      = DocKind;
     Payment.rec.DocumentID = PMObj.DocumentID   = DocID;

     Payment.rec.Payer     = PayerID;
     Payment.rec.Receiver  = ReceiverID;
     Payment.rec.PayFIID   = PayFIID;
     Payment.rec.FIID      = FIID;

     if( IsFixAmount )
        Payment.rec.IsFixAmount  = PMObj.IsFixPayerAmount = "X";
     end;

     Payment.rec.ValueDate  = PMObj.ValueDate    = ValueDate;
     Payment.rec.Department = PMObj.Department   = Department;
     Payment.rec.OrderFIID  = PMObj.OrderFIID    = ВалютаЦеныСделки( DocKind, DocID, 1, BaseFIID );
     Payment.rec.BaseFIID   = PMObj.BaseFIID     = BaseFIID;
     Payment.rec.IsPlanPaym = PMObj.IsPlanPaym   = "X";
     Payment.rec.IsFactPaym = PMObj.IsFactPaym   = IsFactPaym;
     Payment.rec.BaseAmount = PMObj.BaseAmount     = BaseAmount;
     Payment.rec.Amount     = PMObj.PayerAmount    = Amount;
     Payment.rec.PayAmount  = PMObj.ReceiverAmount = PayAmount;
                              PMObj.Ground       = Ground;

     PaymPropDT.Clear();
     PaymPropCT.Clear();
     RmProp.Clear();
     PaymPropDT.rec.DebetCredit = PRT_Debet;
     PaymPropCT.rec.DebetCredit = PRT_Credit;

     SavePayer = Payment.rec.Payer;
     SaveReceiver = Payment.rec.Receiver;

     if( PayerAccount != "" ) /*Счет переданный параметром считаем более важным, чем счет из СПИ*/
        Payment.rec.Payer = -1;
     end;

     if( ReceiverAccount != "" ) /*Счет переданный параметром считаем более важным, чем счет из СПИ*/
        Payment.rec.Receiver = -1;
     end;

     if( FillPaymentAccounts( Payment.rec.Payer, Payment.rec.Receiver, 0, Payment, PaymPropDT, PaymPropCT, ErrStr ) == 0 )

         Payment.rec.Payer = SavePayer;
         Payment.rec.Receiver = SaveReceiver;

         if( CorschemDT != NULL )
         PaymPropDT.rec.Corschem = CorschemDT;
         end;

         if( CorschemCT != NULL )
         PaymPropCT.rec.Corschem = CorschemCT;
         end;

         if( PayerAccount != "" ) /*Счет переданный параметром считаем более важным, чем счет из СПИ*/
            Payment.rec.PayerAccount = PayerAccount;
         end;

         /*Дозаполнить параметры плательщика, если они не заполнилось из СПИ*/
         if( PaymPropDT.rec.CodeKind <= 0 ) 
            PaymPropDT.rec.CodeKind     = PTCK_BIC;
            PMObj.PayerBankCorrCodeKind = PTCK_BIC;
         end;

         if( (Payment.rec.PayerBankID <= 0) AND (PayerBankID > 0) ) 
            Payment.rec.PayerBankID = PayerBankID;
            PaymPropDT.rec.BankCode = ПолучитьКодСубъекта( PayerBankID, PaymPropDT.rec.CodeKind );
         end;

         if( ReceiverAccount != "" ) /*Счет переданный параметром считаем более важным, чем счет из СПИ*/
            Payment.rec.ReceiverAccount = ReceiverAccount;
         end;

         /*Дозаполнить параметры получателя, если они не заполнилось из СПИ*/
         if( PaymPropCT.rec.CodeKind <= 0 ) 
            PaymPropCT.rec.CodeKind          = PTCK_BIC;
            PMObj.ReceiverBankCorrCodeKind   = PTCK_BIC;
         end;

         if( (Payment.rec.ReceiverBankID <= 0) AND (ReceiverBankID > 0) ) 
            Payment.rec.ReceiverBankID   = ReceiverBankID;
            PaymPropCT.rec.BankCode = ПолучитьКодСубъекта( Payment.rec.ReceiverBankID, PaymPropCT.rec.CodeKind );
         end;

         /*Параметры отправителя/получателя*/
         GetPartyName( Payment.rec.Payer, @PayerName );
         GetPartyName( Payment.rec.PayerBankID, @PayerBankName );

         GetPartyName( Payment.rec.Receiver, @ReceiverName );
         GetPartyName( Payment.rec.ReceiverBankID, @ReceiverBankName );

         PMObj.SetPayerPI( PAYMENTS_GROUP_UNDEF, 
                          Payment.rec.PayerBankID, 
                          PaymPropDT.rec.CodeKind, 
                          PaymPropDT.rec.BankCode, 
                          PayerBankName,
                          "",
                          FIID, 
                          Chapter/*CHAPT1*/, 
                          Payment.rec.PayerAccount, 
                          PayerID, 
                          PayerName, 
                          ПолучитьКодСубъекта( Payment.rec.Payer, PTCK_INN ) );


         PMObj.SetReceiverPI( PAYMENTS_GROUP_UNDEF, 
                          Payment.rec.ReceiverBankID, 
                          PaymPropCT.rec.CodeKind, 
                          PaymPropCT.rec.BankCode, 
                          ReceiverBankName,
                          "",
                          PayFIID, 
                          Chapter/*CHAPT1*/, 
                          Payment.rec.ReceiverAccount, 
                          ReceiverID, 
                          ReceiverName, 
                          ПолучитьКодСубъекта( Payment.rec.Receiver, PTCK_INN ) );

         PaymPropDT.rec.Corschem = PMObj.InCorschem;
         PaymPropCT.rec.Corschem = PMObj.OutCorschem;

         /*Плательщик*/
         PMObj.PayerFIID             = FIID;
         PMObj.PayerDpNode           = Payment.rec.PayerDpNode;

         PMObj.PayerBankCorrAcc      = PaymPropDT.rec.CorrAcc;
         PMObj.PayerBankCorrCode     = PaymPropDT.rec.CorrCode;
         PMObj.PayerBankCorrCodeKind = PaymPropDT.rec.CorrCodeKind;

         PMObj.PayerInOurBalance     = PaymPropDT.rec.InOurBalance;
         PMObj.PayerOurCorrAcc       = PaymPropDT.rec.OurCorrAcc;
         PMObj.PayerOurCorrID        = PaymPropDT.rec.OurCorrID;

         /*Получатель*/
         PMObj.ReceiverFIID             = PayFIID;
         PMObj.ReceiverDpNode           = Payment.rec.ReceiverDpNode;

         PMObj.ReceiverBankCorrAcc      = PaymPropCT.rec.CorrAcc;
         PMObj.ReceiverBankCorrCode     = PaymPropCT.rec.CorrCode;
         PMObj.ReceiverBankCorrCodeKind = PaymPropCT.rec.CorrCodeKind;

         PMObj.ReceiverInOurBalance     = PaymPropCT.rec.InOurBalance;
         PMObj.ReceiverOurCorrAcc       = PaymPropCT.rec.OurCorrAcc;
         PMObj.ReceiverOurCorrID        = PaymPropCT.rec.OurCorrID;

         PMObj.Actuate();
         RetPmObj      = PMObj;
         RetPayment    = Payment;
         RetPaymPropDT = PaymPropDT;
         RetPaymPropCT = PaymPropCT;
     else 
        MsgBox( "Ошибка определения СПИ плательщика/получателя при создании платежа.\n" + ErrStr );
        return 1;
     end;

  else
     return 1;
  end;
  return 0;
END;
*/
   //требования по сделкам для БОЦБ

   //требования по сделкам для ПФИ
/*
MACRO DVND_CreatePayment( FD/*DVFirstDocNDeal or DVFirstDocFXDeal or DVFirstDocOper */,
                          Purpose:INTEGER, DocKind:INTEGER, DocID:INTEGER,
                          ValueDate:DATE,
                          PayerID:INTEGER, PayerBankID:INTEGER,
                          ReceiverID:INTEGER, ReceiverBankID:INTEGER,
                          Summa:MONEY, FIID:INTEGER,
                          Ground:STRING,
                          PayerAccount:TRecHandler, ReceiverAccount:TRecHandler,
                          Department:INTEGER, SubPurpose:INTEGER,
                          PaymStatus:INTEGER,
                          RetPayment:@RsbPayment, TmpPaymentID:INTEGER,
                          DebProp:@TRecHandler, CredProp:@TRecHandler
                        ) :INTEGER

  var ErrStr = "", PayerName:string = "", ReceiverName:string = "", PayerBankName:string = "", ReceiverBankName:string = "";
  var PMObj, AccountPayerFIID, AccountReceiverFIID;
  var FI = TRecHandler("fininstr.dbt");
  var IsAvoirPaym = false;

  if( ПолучитьФинИн(FIID, FI) == 0 )
     if( FI.rec.FI_Kind == FIKIND_AVOIRISS )
        IsAvoirPaym = true;
     end;
  end;

  /* Если на одном шаге создается несколько обьектов то нужно обязательно передавать TmpPaymentID с отрицательным значением
     изза того что криво работает класс платежа
  */
  if( TmpPaymentID == NULL )
     TmpPaymentID = 0;
  end;

  PMObj = RsbPayment( TmpPaymentID );

  if( PMObj )
     /*Дублировать заполнение полей через Payment (TRecHandler) приходится из за отсутствия
       FillPaymentAccounts в классе платежа*/
     Payment.Clear();

     if( SubPurpose == NULL )
        SubPurpose = DV_NewSubpurpose( Purpose, DocKind, DocID );
     end;

     Payment.rec.Purpose    = PMObj.Purpose      = Purpose;  
     Payment.rec.SubPurpose = PMObj.SubPurpose   = SubPurpose;
     Payment.rec.PaymStatus = PMObj.PaymStatus   = IIF( PaymStatus == NULL, /*PM_PREPARING*/PM_READIED, PaymStatus );
     Payment.rec.DocKind    = PMObj.DocKind      = DocKind;
     Payment.rec.DocumentID = PMObj.DocumentID   = DocID;

     Payment.rec.Payer     = PayerID;
     Payment.rec.Receiver  = ReceiverID;
     Payment.rec.PayFIID   = FIID;
     Payment.rec.FIID      = FIID;
     Payment.rec.BaseFIID  = PMObj.BaseFIID      = FIID;

     Payment.rec.ValueDate  = PMObj.ValueDate    = ValueDate;
     Payment.rec.Department = PMObj.Department   = Department;
     Payment.rec.IsPlanPaym = PMObj.IsPlanPaym   = "X";

     Payment.rec.BaseAmount  = PMObj.BaseAmount  = Summa;
     Payment.rec.OrderAmount = PMObj.OrderAmount = Summa;
                               PMObj.Ground      = Ground;

     Payment.rec.OrderFIID   = PMObj.OrderFIID = FIID;// Валюта суммы распоряжения

     if( (Payment.rec.Payer == FD.ClientID()) OR (Payment.rec.Payer == {OurBank}) )
        Payment.rec.IsFixAmount = PMObj.IsFixPayerAmount = "X";   /*признак - фикс.сумма - дебет*/
     else
        Payment.rec.IsFixAmount = PMObj.IsFixPayerAmount = UNSET_CHAR;   /*признак - фикс.сумма - кредит*/
     end;

     Payment.rec.PayerCodeKind    = PTCK_CONTR;
     Payment.rec.ReceiverCodeKind = PTCK_CONTR;

     PaymPropDT.Clear();
     PaymPropCT.Clear();
     PaymPropDT.rec.DebetCredit = PRT_Debet;
     PaymPropCT.rec.DebetCredit = PRT_Credit;
     PaymPropDT.rec.IsSender = SET_CHAR;
     PaymPropCT.rec.IsSender = UNSET_CHAR;

     if( IsAvoirPaym )
        PaymPropDT.rec.CorrPosType = PaymPropCT.rec.CorrPosType = PM_CORRPOS_TYPE_USER;
     end;

     RmProp.Clear();
     RmProp.rec.Date        = Payment.rec.ValueDate;
     RmProp.rec.PayDate     = Payment.rec.ValueDate;
     RmProp.rec.ClientDate  = Payment.rec.ValueDate;

     AccountPayerFIID = AccountReceiverFIID = FIID;

     if( PayerAccount != NULL ) /*Счет переданный параметром считаем более важным, чем счет из СПИ*/
        Payment.rec.PayerAccount = PayerAccount.rec.Account;
        AccountPayerFIID         = PayerAccount.rec.Code_Currency;
     else
        if( DV_FillPaymentBySPI( FD.ClientID(), FD.ClientContrID(), FD.BrokerID(), FD.BrokerContrID(), FD.Kind_Operation(),
                                 PRT_Debet, Payment, PaymPropDT, RmProp ) )
           MsgBox( "Ошибка определения СПИ плательщика при создании платежа.\n" + ErrStr );
           return 1;
        end;
     end;

     if( ReceiverAccount != NULL ) /*Счет переданный параметром считаем более важным, чем счет из СПИ*/
        Payment.rec.ReceiverAccount = ReceiverAccount.rec.Account;
        AccountReceiverFIID         = ReceiverAccount.rec.Code_Currency;
     else
        if( DV_FillPaymentBySPI( FD.ClientID(), FD.ClientContrID(), FD.BrokerID(), FD.BrokerContrID(), FD.Kind_Operation(),
                                 PRT_Credit, Payment, PaymPropCT, RmProp ) )
           MsgBox( "Ошибка определения СПИ получателя при создании платежа.\n" + ErrStr );
           return 1;
        end;
     end;

     Payment.rec.FIID_FuturePayAcc = AccountPayerFIID;
     Payment.rec.FIID_FutureRecAcc = AccountReceiverFIID;

     /*Дозаполнить параметры плательщика, если они не заполнилось из СПИ*/
     if( PaymPropDT.rec.CodeKind <= 0 ) 
        PaymPropDT.rec.CodeKind     = PTCK_CONTR;
        PMObj.PayerBankCorrCodeKind = PTCK_CONTR;
     end;

     if( Payment.rec.PayerBankID <= 0 ) 
        Payment.rec.PayerBankID = PayerBankID;
        PaymPropDT.rec.BankCode = ПолучитьКодСубъекта( PayerBankID, PaymPropDT.rec.CodeKind );
     end;

     /*Дозаполнить параметры получателя, если они не заполнилось из СПИ*/
     if( PaymPropCT.rec.CodeKind <= 0 ) 
        PaymPropCT.rec.CodeKind          = PTCK_CONTR;
        PMObj.ReceiverBankCorrCodeKind   = PTCK_CONTR;
     end;

     if( Payment.rec.ReceiverBankID <= 0 ) 
        Payment.rec.ReceiverBankID   = ReceiverBankID;
        PaymPropCT.rec.BankCode = ПолучитьКодСубъекта( Payment.rec.ReceiverBankID, PaymPropCT.rec.CodeKind );
     end;

     /*Параметры отправителя/получателя*/
     DV_GetPartyName( Payment.rec.Payer, @PayerName );
     DV_GetPartyName( Payment.rec.PayerBankID, @PayerBankName );

     DV_GetPartyName( Payment.rec.Receiver, @ReceiverName );
     DV_GetPartyName( Payment.rec.ReceiverBankID, @ReceiverBankName );

     /* Сконвертируем суммы сами */
     if( not DV_SmartConvertSum(Payment.rec.Amount, Payment.rec.BaseAmount, Payment.rec.ValueDate, Payment.rec.BaseFIID, AccountPayerFIID, true) )
        return 1;
     end;
     if( not DV_SmartConvertSum(Payment.rec.PayAmount, Payment.rec.BaseAmount, Payment.rec.ValueDate, Payment.rec.BaseFIID, AccountReceiverFIID, true) )
        return 1;
     end;
     pmobj.PayerAmount = Payment.rec.Amount;
     pmobj.ReceiverAmount = Payment.rec.PayAmount;

     PMObj.SetPayerPI( PAYMENTS_GROUP_UNDEF,
                       Payment.rec.PayerBankID,
                       PaymPropDT.rec.CodeKind,
                       PaymPropDT.rec.BankCode,
                       PayerBankName,
                       "",
                       AccountPayerFIID,
                       IIF(IsAvoirPaym, 5, 1),
                       Payment.rec.PayerAccount,
                       PayerID,
                       PayerName,
                       ПолучитьКодСубъекта(Payment.rec.Payer, PTCK_INN),
                       Payment.rec.PayerCodeKind,
                       Payment.rec.PayerCode,
                       NULL,
                       IIF(IsAvoirPaym, PaymPropDT.rec.CorrPosType, NULL) );

     PMObj.SetReceiverPI( PAYMENTS_GROUP_UNDEF,
                          Payment.rec.ReceiverBankID,
                          PaymPropCT.rec.CodeKind,
                          PaymPropCT.rec.BankCode,
                          ReceiverBankName,
                          "",
                          AccountReceiverFIID,
                          IIF(IsAvoirPaym, 5, 1),
                          Payment.rec.ReceiverAccount,
                          ReceiverID,
                          ReceiverName,
                          ПолучитьКодСубъекта(Payment.rec.Receiver, PTCK_INN),
                          Payment.rec.ReceiverCodeKind,
                          Payment.rec.ReceiverCode,
                          NULL,
                          IIF(IsAvoirPaym, PaymPropCT.rec.CorrPosType, NULL) );

     /*Плательщик*/
     PMObj.PayerDpNode           = Payment.rec.PayerDpNode;

     PMObj.PayerBankCorrAcc      = PaymPropDT.rec.CorrAcc;
     PMObj.PayerBankCorrCode     = PaymPropDT.rec.CorrCode;
     PMObj.PayerBankCorrCodeKind = PaymPropDT.rec.CorrCodeKind;

     PMObj.PayerInOurBalance     = PaymPropDT.rec.InOurBalance;
     PMObj.PayerOurCorrAcc       = PaymPropDT.rec.OurCorrAcc;
     PMObj.PayerOurCorrID        = PaymPropDT.rec.OurCorrID;

     /*Получатель*/
     PMObj.ReceiverDpNode           = Payment.rec.ReceiverDpNode;

     PMObj.ReceiverBankCorrAcc      = PaymPropCT.rec.CorrAcc;
     PMObj.ReceiverBankCorrCode     = PaymPropCT.rec.CorrCode;
     PMObj.ReceiverBankCorrCodeKind = PaymPropCT.rec.CorrCodeKind;

     PMObj.ReceiverInOurBalance     = PaymPropCT.rec.InOurBalance;
     PMObj.ReceiverOurCorrAcc       = PaymPropCT.rec.OurCorrAcc;
     PMObj.ReceiverOurCorrID        = PaymPropCT.rec.OurCorrID;

     PMObj.Actuate();

     Payment.rec.PaymentID = PMObj.PaymentID;
     DV_SetPaymentGround(Payment, -1, FD);

     RetPayment = PMObj;

     if( DebProp != NULL )
        copy(DebProp, PaymPropDT);
     end;
     if( CredProp != NULL )
        copy(CredProp, PaymPropCT);
     end;
  else 
     return 1;
  end;

  return 0;
END;
*/
   //требования по сделкам для ПФИ

   //ИП от ЦБРФ по сделкам для МБК
/*
class MM_RsbPayment(_mode, _parm1, _parm2, _parm3, _parm4, _parm5, _parm6, _parm7)
  var 
      Payment = NULL;

  private var
      prm_mode = _mode,
      prm_prm1 = _parm1,
      prm_prm2 = _parm2,
      prm_prm3 = _parm3,
      prm_prm4 = _parm4,
      prm_prm5 = _parm5,
      prm_prm6 = _parm6,
      prm_prm7 = _parm7;

  private var
      tick = TBfile("dl_tick.dbt"),
      leg  = TBfile("dl_leg.dbt");

  private var
      prm_Paym = NULL;

  // Создание платежа на основе данных из сделки/////////////////////////////////////////
  private macro CreatePaymByDeal(Purpose, SubPurpose, PaymSum, ValueDate)
    var
        purp = TBfile("pmpurp.dbt");

    var DefaultCodeKind = NULL;

    RECORD settacc(settacc);

      if (leg.rec.PFI == NATCUR)
          DefaultCodeKind = PTCK_BIC;
      else
          DefaultCodeKind = PTCK_SWIFT;
      end;

      Payment = RsbPayment();
      Payment.DocKind              = DL_IBCDOC;
      Payment.DocumentID           = tick.rec.DealID;
      Payment.Purpose              = Purpose;
      Payment.SubPurpose           = SubPurpose;
      Payment.OrderFIID            =
      Payment.BaseFIID             = 
      Payment.PayerFIID            = 
      Payment.ReceiverFIID         = 
      Payment.FuturePayerFIID      = 
      Payment.FutureReceiverFIID   = leg.rec.PFI;
      Payment.OrderAmount          =
      Payment.PayerAmount          = 
      Payment.ReceiverAmount       = 
      Payment.BaseAmount           = 
      Payment.FutureBaseAmount     = PaymSum;
      Payment.ActuateFutureAmounts(TBA_AMOUNT);
      Payment.IsPlanPaym           = "X";

      purp.KeyNum = 0;
      purp.rec.Purpose = Purpose;
      if(GetEQ(purp))
          Payment.Ground = purp.rec.Name;
      else
          Payment.Ground = "Платеж";
      end;
      Payment.Ground = Payment.Ground + " по сделке №" +String(tick.rec.DealCode + " заключена " +String(tick.rec.DealDate:f));

      Payment.PaymStatus           = PM_PREPARING;
      Payment.Department    = tick.rec.Department; 
      if (tick.rec.Netting == 3)
          Payment.Netting = "X";
      else
          Payment.Netting = "";
      end;
      Payment.Date                 = 
      Payment.PayDate              = 
      Payment.OutTransferDate      =
      Payment.ValueDate            = ValueDate;
      Payment.ClientDate           = {curdate};
      Payment.Number               = String(SubPurpose); 
      Payment.Oper                 = tick.rec.Oper;
      Payment.Origin               = PAYMENT_OR_AUTO;

      if (not FindSETTACC_PMAUTO(tick.rec.PartyID, FIKIND_CURRENCY, leg.rec.PFI, PTSK_CURRDL, tick.rec.DealType, Purpose, 0, settacc))
          ;
      elif (not FindSETTACC_PMAUTO(tick.rec.PartyID, FIKIND_CURRENCY, leg.rec.PFI, PTSK_CURRDL, tick.rec.DealType, 0, 0, settacc))
          ;
      elif (not FindSETTACC_PMAUTO(tick.rec.PartyID, FIKIND_CURRENCY, leg.rec.PFI, PTSK_CURRDL, 0, Purpose, 0, settacc))
          ;
      elif (not FindSETTACC_PMAUTO(tick.rec.PartyID, FIKIND_CURRENCY, leg.rec.PFI, PTSK_CURRDL, 0, 0, 0, settacc))
          ;
      end;

      if (IsCOMMITMENT(tick.rec.DealGroup, Purpose))
          Payment.SetPayerPI(PAYMENTS_GROUP_UNDEF,
                             {OurBank},
                             DefaultCodeKind,
                             "",
                             "",
                             "",
                             leg.rec.PFI,
                             1,
                             "",
                             {OurBank},
                             "",
                             "",
                             DefaultCodeKind,
                             ""
                             );

          Payment.SetReceiverPI(PAYMENTS_GROUP_UNDEF,
                                settacc.BankID,
                                settacc.BankCodeKind,
                                settacc.BankCode,
                                settacc.BankName,
                                settacc.CorrAcc,
                                settacc.FIID,
                                settacc.Chapter,
                                settacc.Account,
                                settacc.PartyID,
                                settacc.RecName,
                                settacc.INN,
                                settacc.CodeKind,
                                settacc.Code
                                );

          Payment.PayerBankName = Payment.PayerName;
          Payment.PayerBankCorrCodeKind = PTCK_ALL;
          Payment.PayerBankCorrCode     = "";
          Payment.ReceiverInOurBalance  = "";
          Payment.ReceiverOurCorrAcc    = "";
          Payment.ReceiverOurCorrID     = -1;

          if (settacc.BankCorrID != {OurBank})
              Payment.ReceiverBankCorrAcc      = settacc.CorrAcc;
              Payment.ReceiverBankCorrCodeKind = settacc.BankCorrCodeKind;
              Payment.ReceiverBankCorrCode     = settacc.BankCorrCode;
              Payment.ReceiverBankCorrName     = settacc.BankCorrName;
          end;
      else
          Payment.SetPayerPI(PAYMENTS_GROUP_UNDEF,
                                settacc.BankID,
                                settacc.BankCodeKind,
                                settacc.BankCode,
                                settacc.BankName,
                                settacc.CorrAcc,
                                settacc.FIID,
                                settacc.Chapter,
                                settacc.Account,
                                settacc.PartyID,
                                settacc.RecName,
                                settacc.INN,
                                settacc.CodeKind,
                                settacc.Code
                                );

          Payment.SetReceiverPI(PAYMENTS_GROUP_UNDEF,
                             {OurBank},
                             DefaultCodeKind,
                             "",
                             "",
                             "",
                             leg.rec.PFI,
                             1,
                             "",
                             {OurBank},
                             "",
                             "",
                             DefaultCodeKind,
                             ""
                             );

          Payment.ReceiverBankName = Payment.ReceiverName;
          Payment.ReceiverBankCorrCodeKind = PTCK_ALL;
          Payment.ReceiverBankCorrCode     = "";

          Payment.PayerInOurBalance  = "";
          Payment.PayerOurCorrAcc    = "";
          Payment.PayerOurCorrID     = -1;

          if (settacc.BankCorrID != {OurBank})
              Payment.PayerBankCorrAcc      = settacc.CorrAcc;
              Payment.PayerBankCorrCodeKind = settacc.BankCorrCodeKind;
              Payment.PayerBankCorrCode     = settacc.BankCorrCode;
              Payment.PayerBankCorrName     = settacc.BankCorrName;
          end;
      end;

      Payment.Actuate();
  end;
/////////////////////////////////////////////////////////////////////////////////////////
  // Создание платежа на основе данных из другого платежа.///////////////////////////////
  macro CreatePaymByPaym(Paym, Debet, Credit, RMProp, SubPurpose, PaymSum, ValueDate)
      Payment = RsbPayment();
      Payment.DocKind              = Paym.rec.DocKind;
      Payment.DocumentID           = Paym.rec.DocumentID;
      Payment.Purpose              = Paym.rec.Purpose;
      Payment.SubPurpose           = SubPurpose;
      Payment.OrderFIID            = Paym.rec.OrderFIID;
      Payment.BaseFIID             = Paym.rec.BaseFIID;
      Payment.PayerFIID            = Paym.rec.FIID;
      Payment.ReceiverFIID         = Paym.rec.PayFIID;
      Payment.FuturePayerFIID      = Paym.rec.FIID_FuturePayAcc;
      Payment.FutureReceiverFIID   = Paym.rec.FIID_FutureRecAcc;
      Payment.OrderAmount          = 
      Payment.PayerAmount          = 
      Payment.ReceiverAmount       = 
      Payment.BaseAmount           = 
      Payment.FutureBaseAmount     = PaymSum;

      Payment.ActuateFutureAmounts(TBA_AMOUNT);
      Payment.IsPlanPaym           = Paym.rec.IsPlanPaym;
      Payment.Ground               = RMProp.rec.Ground;
      Payment.PaymStatus           = PM_PREPARING;
      Payment.Department           = Paym.rec.Department; 
      Payment.Netting              = Paym.rec.Netting;
      Payment.Date                 = RMProp.rec.Date;
      Payment.PayDate              = RMProp.rec.PayDate;
      if (Debet.rec.IsSender == "")
          Payment.OutTransferDate = Debet.rec.TransferDate;
          Payment.OutTransport    = Debet.rec.TpID;
          Payment.OutTpSchem      = Debet.rec.TpSchemID;
          Payment.OutRlsForm      = Debet.rec.RlsFormID;
      else                            
          Payment.OutTransferDate = Credit.rec.TransferDate;
          Payment.OutTransport    = Credit.rec.TpID;
          Payment.OutTpSchem      = Credit.rec.TpSchemID;
          Payment.OutRlsForm      = Credit.rec.RlsFormID;

      end;
      Payment.ValueDate            = Paym.rec.ValueDate;
      Payment.ClientDate           = {curdate};
      Payment.Number               = RMProp.rec.Number; 
      Payment.Oper                 = Paym.rec.Oper;
      Payment.Origin               = Paym.rec.Origin;

      Payment.SetPayerPI(PAYMENTS_GROUP_UNDEF,
                           Paym.rec.PayerBankID,
                           Debet.rec.CodeKind,
                           Debet.rec.BankCode,
                           RMProp.rec.PayerBankName,
                           RMProp.rec.PayerCorrAccNostro,
                           Paym.rec.FIID,
                           Paym.rec.Chapter,
                           Paym.rec.PayerAccount,
                           Paym.rec.Payer,
                           RMProp.rec.PayerName,
                           RMProp.rec.PayerINN,
                           Paym.rec.PayerCodeKind,
                           Paym.rec.PayerCode,
                           Debet.rec.Corschem,
                           Debet.rec.CorrPosType
                           );

      Payment.SetReceiverPI(PAYMENTS_GROUP_UNDEF,
                            Paym.rec.ReceiverBankID,
                            Credit.rec.CodeKind,
                            Credit.rec.BankCode,
                            RMProp.rec.ReceiverBankName,
                            RMProp.rec.ReceiverCorrAccNostro,
                            Paym.rec.PayFIID,
                            Paym.rec.Chapter,
                            Paym.rec.ReceiverAccount,
                            Paym.rec.Receiver,
                            RMProp.rec.ReceiverName,
                            RMProp.rec.ReceiverINN,
                            Paym.rec.ReceiverCodeKind,
                            Paym.rec.ReceiverCode,
                            Credit.rec.Corschem,
                            Credit.rec.CorrPosType
                            );

      Payment.FuturePayerAccount       = Paym.rec.FuturePayerAccount;
      Payment.FutureReceiverAccount    = Paym.rec.FutureReceiverAccount;
      Payment.PayerBankCorrCodeKind    = Debet.rec.CorrCodeKind;
      Payment.ReceiverBankCorrCodeKind = Credit.rec.CorrCodeKind;
      Payment.PayerBankCorrCode        = Debet.rec.CorrCode;
      Payment.ReceiverBankCorrCode     = Credit.rec.CorrCode;
      Payment.PayerInOurBalance        = Debet.rec.InOurBalance;
      Payment.ReceiverInOurBalance     = Credit.rec.InOurBalance;
      Payment.PayerOurCorrAcc          = Debet.rec.OurCorrAcc;
      Payment.ReceiverOurCorrAcc       = Credit.rec.OurCorrAcc;
      Payment.PayerOurCorrID           = Debet.rec.OurCorrID;
      Payment.ReceiverOurCorrID        = Credit.rec.OurCorrID;
      Payment.PayerBankCorrName        = RMProp.rec.PayerCorrBankName;
      Payment.ReceiverBankCorrName     = RMProp.rec.ReceiverCorrBankName;
      Payment.Priority                 = RMProp.rec.Priority;
      Payment.ShifrOper                = RMProp.rec.ShifrOper;
      Payment.PaymentKind              = RMProp.rec.PaymentKind;
      Payment.PayerMesBankID           = Paym.rec.PayerMesBankID;
      Payment.ReceiverMesBankID        = Paym.rec.ReceiverMesBankID;
      Payment.PrimDocKind              = Paym.rec.PrimDocKind;
      Payment.StartDepartment          = Paym.rec.StartDepartment;
      Payment.EndDepartment            = Paym.rec.EndDepartment;
      Payment.PayType                  = Paym.rec.PayType;
      Payment.CheckTerror              = Paym.rec.CheckTerror;
      Payment.MCMethodID               = Paym.rec.MCMethodID;
      Payment.PayerDpNode              = Paym.rec.PayerDpNode;
      Payment.ReceiverDpNode           = Paym.rec.ReceiverDpNode;
      Payment.PrimDocOrigin            = Paym.rec.PrimDocOrigin;
      Payment.TypeDocument             = Paym.rec.TypeDocument;
      Payment.UserTypeDocument         = Paym.rec.UserTypeDocument;
      Payment.NumberPack               = Paym.rec.NumberPack;
      Payment.Instancy                 = RMProp.rec.Instancy;
      Payment.NeedNotify               = RMProp.rec.NeedNotify;
      Payment.PartPaymNumber           = Paym.rec.PartPaymNumber;
      Payment.PartPaymShifrMain        = Paym.rec.PartPaymShifrMain;
      Payment.PartPaymNumMain          = Paym.rec.PartPaymNumMain;
      Payment.PartPaymDateMain         = Paym.rec.PartPaymDateMain;
      Payment.PartPaymRestAmountMain   = Paym.rec.PartPaymRestAmountMain;
      Payment.ToBackOffice             = Paym.rec.ToBackOffice;
      Payment.NotForBackOffice         = Paym.rec.NotForBackOffice;
      Payment.IsFixPayerAmount         = Paym.rec.IsFixAmount;
      Payment.IsPurpose                = Paym.rec.IsPurpose;
      Payment.PlaceToIndex             = Paym.rec.PlaceToIndex;
      Payment.ClaimID                  = Paym.rec.ClaimID;
      Payment.PayerBankMarkDate        = Paym.rec.PayerBankMarkDate;
      Payment.ReceiverBankMarkDate     = Paym.rec.ReceiverBankMarkDate;
      Payment.PayerBankEnterDate       = Paym.rec.PayerBankEnterDate;
      Payment.DefComID                 = Paym.rec.DefComID;
      Payment.FeeType                  = Paym.rec.FeeType;
      Payment.I2PlaceDate              = Paym.rec.I2PlaceDate;
      Payment.OperNode                 = Paym.rec.OperNode;
      Payment.MessageType              = RMProp.rec.MessageType;
      Payment.TaxPmGround              = RMProp.rec.TaxPmGround;
      Payment.TaxPmPeriod              = RMProp.rec.TaxPmPeriod;
      Payment.TaxPmNumber              = RMProp.rec.TaxPmNumber;
      Payment.TaxPmDate                = RMProp.rec.TaxPmDate;
      Payment.TaxPmType                = RMProp.rec.TaxPmType;
      Payment.TaxAuthorState           = RMProp.rec.TaxAuthorState;
      Payment.PayerChargeOffDate       = RMProp.rec.PayerChargeOffDate;
      Payment.BttTICode                = RMProp.rec.BttTICode;
      Payment.OKATOCode                = RMProp.rec.OKATOCode;
      Payment.CashSymbolDebet          = RMProp.rec.CashSymbolDebet;
      Payment.CashSymbolCredit         = RMProp.rec.CashSymbolCredit;
      Payment.SymbNotBalDebet          = RMProp.rec.SymbNotBalDebet;
      Payment.SymbNotBalCredit         = RMProp.rec.SymbNotBalCredit;
      Payment.DocDispatchDate          = RMProp.rec.DocDispatchDate;
      Payment.PartyInfo                = RMProp.rec.PartyInfo;
      Payment.ComissCharges            = RMProp.rec.ComissCharges;
      Payment.AdditionalInfo           = RMProp.rec.AdditionalInfo;
      Payment.ReceiverCorrAccNostro    = RMProp.rec.ReceiverCorrAccNostro;
      Payment.PayerName                = RMProp.rec.PayerName;
      Payment.PayerINN                 = RMProp.rec.PayerINN;
      Payment.PayerBankName            = RMProp.rec.PayerBankName;
      Payment.PayerBankCorrAcc         = Debet.rec.CorrAcc;
      Payment.ReceiverName             = RMProp.rec.ReceiverName;
      Payment.ReceiverINN              = RMProp.rec.ReceiverINN;
      Payment.ReceiverBankName         = RMProp.rec.ReceiverBankName;
      Payment.ReceiverBankCorrAcc      = Credit.rec.CorrAcc;

      Payment.Actuate();
  end;
/////////////////////////////////////////////////////////////////////////////////////////
// Сохранить платеж
  macro SaveChanges(InTmp)
    var
        RetVal = 0;

      if (ValType(InTmp) != V_BOOL)
          InTmp = false;
      end;

//      if (InTmp)
//          retVal = MM_InsertPayment(Payment.GetPM_PAYM(), Payment.GetDEBET(), Payment.GetCREDIT(), Payment.GetPMRMPROP());
//      else
          retVal = Payment.Update();
//      end;

      return RetVal;
  end;
/////////////////////////////////////////////////////////////////////////////////////////
// Constructor////////////////////////////////////////////////////////////////////
  if (prm_mode == MMPAYM_CREATEBYDEALID)
      tick.rec.DealID = prm_prm1;
      if (tick.GetEQ)
          leg.rec.DealID = prm_prm1;
          leg.rec.LegID  = 1;
          if (not leg.GetEQ)
              return;
          end;
      else
          return;
      end;
      CreatePaymByDeal(prm_prm2, prm_prm3, prm_prm4, prm_prm5);
  elif (prm_mode == MMPAYM_CREATEBYDEALBUF)
      copy(tick, prm_prm1);
      copy(leg, prm_prm2);
      CreatePaymByDeal(prm_prm3, prm_prm4, prm_prm5, prm_prm6);
  elif (prm_mode == MMPAYM_CREATEBYPAYMID)
       prm_Paym = RsbPayment(prm_prm1);
      CreatePaymByPaym(prm_Paym.GetPM_PAYM(), prm_Paym.GetDEBET(), prm_Paym.GetCREDIT(), prm_Paym.GetPMRMPROP(), prm_prm2, prm_prm3, prm_prm4);
      prm_Paym = NULL;
  elif (prm_mode == MMPAYM_CREATEBYPAYMBUF)
      CreatePaymByPaym(prm_prm1, prm_prm2, prm_prm3, prm_prm4, prm_prm5, prm_prm6, prm_prm7);
  elif (prm_mode == MMPAYM_CREATEBYPAYMOBJ)
      CreatePaymByPaym(prm_prm1.GetPM_PAYM(), prm_prm1.GetDEBET(), prm_prm1.GetCREDIT(), prm_prm1.GetPMRMPROP(), prm_prm2, prm_prm3, prm_prm4);
  else
      prm_mode = NULL;
      prm_prm1 = NULL; 
      prm_prm2 = NULL; 
      prm_prm3 = NULL;
      prm_prm4 = NULL;
      prm_prm5 = NULL;
  end;
end;
*/
   //ИП от ЦБРФ по сделкам для МБК



//!!!!!!!!!!!!!! нужно по каким-то параметрам RequestObj определить порождаем внешнее инкассове поручение (30102), объект RSBPayment или RSBAccTransaction 

   end;
  
   RequestObj = Null;

   return ResponseObj;

onError(err)

 ErrObj.ResponseCode = c_usr_err_obj.obtain_err_code(err);
 ErrMsg = ErrMsg + " | "+ "Не создан входящий платеж: " + c_usr_err_obj.obtain_err_msg(err); 
 ErrObj.ResponseNote = ErrMsg;
 ResponseObj.EntryResult = ErrObj;
 ErrObj = Null;
 RequestObj = Null;
                                     
 return ResponseObj;

end;
//процедура вставки платежа/проводки вызов из RS-Secirities



//!!!!!!!!!!!!!!!!это только для тестирования
var RequestObj_ :TSOFR_AddAccountingEntriesReq,
    ResponseObj :TSOFR_AddAccountingEntriesResp;

//---------------------------------------
RequestObj_.Entry.EntryId = "1";
RequestObj_.Entry.OperationalDay = {CurDate};
RequestObj_.Entry.PersonnelNumber = "1";
RequestObj_.Entry.BranchID = "1";
RequestObj_.Entry.EntryType = "0";
RequestObj_.Entry.PayTool = "0";
RequestObj_.Entry.DebitAccount = "30601810100000000047";
RequestObj_.Entry.DebitAmount = "2.64";
RequestObj_.Entry.DebitCurrencyCode = "643";
RequestObj_.Entry.CreditAccount = "30601810900000000002";
RequestObj_.Entry.CreditAmount = "2.64";
RequestObj_.Entry.CreditCurrencyCode = "643";
RequestObj_.Entry.EntryDetails = "BEBEbe101bebbe";
RequestObj_.Entry.EntryStatus = "1";
RequestObj_.Entry.EntryNumber = "12";

RequestObj_.Entry.LegalEntityPayerInfo = Null;
/*
RequestObj_.Entry.LegalEntityPayerInfo = TLegalEntityPayerInfo;
RequestObj_.Entry.LegalEntityPayerInfo.INN = "1";
RequestObj_.Entry.LegalEntityPayerInfo.BankAccount = "1";
RequestObj_.Entry.LegalEntityPayerInfo.BIC = "1";
RequestObj_.Entry.LegalEntityPayerInfo.CorrAccount = "1";
RequestObj_.Entry.LegalEntityPayerInfo.BankName = "1";
RequestObj_.Entry.LegalEntityPayerInfo.CorpPayerName = "1";
*/

RequestObj_.Entry.PersPayerInfo = Null;
/*
RequestObj_.Entry.PersPayerInfo = TPersPayerInfo;
RequestObj_.Entry.PersPayerInfo.BIC = "1";
RequestObj_.Entry.PersPayerInfo.CorrAccount = "1";
RequestObj_.Entry.PersPayerInfo.BankName = "1";
RequestObj_.Entry.PersPayerInfo.PersPayerFio = "1";
*/

RequestObj_.Entry.CorpPayeeInfo = Null;
/*
RequestObj_.Entry.CorpPayeeInfo.INN = "1";
RequestObj_.Entry.CorpPayeeInfo.KPP = "1";
*/

//RequestObj_.Entry.PersPayeeInfo = Null;
RequestObj_.Entry.PersPayeeInfo = TPersPayeeInfo;
RequestObj_.Entry.PersPayeeInfo.LastName = "1";
RequestObj_.Entry.PersPayeeInfo.FirstName = "1";
//---------------------------------------------------

RequestObj_.Entry.PersPayeeInfo.ContractNumber = "123"; //101
//RequestObj_.Entry.CorpPayeeInfo.ContractNumber = "123"; //101
RequestObj_.Entry.DebitCurrencyCode = "643";
RequestObj_.Entry.CreditCurrencyCode = "643";
RequestObj_.Entry.CreditAmount = "2.64";
RequestObj_.Entry.EntryDetails = "BEBEbe101bebbe";


ResponseObj = SOFR_AddAccountingEntries( @RequestObj_ );


//!!!!!!!!!!!!!!!!это только для тестирования


