//-----------------------------------------------------------------------------------------
// Упрощенная передача из СОФР данных по удаленным проводкам ЦФТ. Параметр - id ЦФТ, который откуда=то надо взять в СОФР.
// Дылгеров Ц.В. BIQ-10484 CCBO-6443. Пример использования: для удаления РОВУ по депозитарной комиссии. Зависит от триггера ddl_acc_dbt, стандартного быстрого планировщщика ws_check_job_Event и исполнителя задания ws_SOFR_addAccountingEntriesROVU
//-----------------------------------------------------------------------------------------
import bankinter, oralib, likepy, fiinter, commonutil;



Private const extCodeKind = 1; // Код субъекта в Бисквит
Private const RegistryPath = "РСХБ\\ИНТЕГРАЦИЯ\\NUMOPERAPPROV";


private class c_entry_id(cft_acctrnId)
   var ObjectId     : string
      ,SystemId     : string
      ,SystemNodeId : string;

   macro m_init_prime(cft_acctrnId)
      ObjectId = cft_acctrnId;
   end;

   m_init_prime(cft_acctrnId);
end;
//-----------------------------------------------------------------------------------------

Private class CApproveEntry ( cft_acctrnId )
   var EntryStatus     : STRING,
       PersonnelNumber : STRING,
       EntryID         : OBJECT;

   this.init (cft_acctrnId);

   Macro init ( cft_acctrnId )
      var str :integer,
      stat = 0;

      EntryID = c_entry_id(cft_acctrnId);

      GetRegistryValue(RegistryPath, V_INTEGER, str, stat);
      PersonnelNumber = ReadNoteForObject(92,string(str:o:10),200);
      EntryStatus = "АННУЛ";
   End;
End;
//-----------------------------------------------------------------------------------------

Private class CApproveEntryList ( cft_acctrnId, entryId )
   var ApproveEntry : OBJECT;

   this.init (cft_acctrnId, entryId);

   Macro init ( cft_acctrnId, entryId )
      ApproveEntry = CApproveEntry (cft_acctrnId);
   End;

End;
//-----------------------------------------------------------------------------------------

Private class CApproveAccountingEntries_Req ( cft_acctrnId, entryId )
   Var ApproveAccountingEntriesRequest : OBJECT;

   this.init (cft_acctrnid, entryId);

   Macro init ( cft_acctrnId, entryId )
      ApproveAccountingEntriesRequest = CApproveEntryList (cft_acctrnid, entryId);
   End;
End;
//-----------------------------------------------------------------------------------------

private class c_req_obj(i_cft_acc_trn_id)
   var ApproveAccountingEntriesRequestMsg;

   macro m_init_prime(p_cft_acc_trn_id)
      ApproveAccountingEntriesRequestMsg = CApproveAccountingEntries_Req(p_cft_acc_trn_id);
   end;

   m_init_prime(i_cft_acc_trn_id);
end;
//-----------------------------------------------------------------------------------------

Macro ApproveAccountingEntries_ReqSimple ( CFTacctrnId )  //ID проводки в ЦФТ
   return c_req_obj(CFTacctrnId);
End;
//-----------------------------------------------------------------------------------------


//var v_req = ApproveAccountingEntries_ReqSimple ( 30577 );  //ID проводки в ЦФТ

//msgbox("Done!");