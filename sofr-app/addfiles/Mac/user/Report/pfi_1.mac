/*Отчет "ПФИ_1" РСХБ Morozov D.A. 18.03.2019 */
import RsbDataSet,rsd,oralib,likepy;
import or_rep_h, globals;

private macro iif(a,b,c)
    if(a)
        return b;
    else
        return c;
    end;
end;

private macro SumRestAccAvoir(rest_date, kind, demand):money
  //kind - 0 биржа, 1 - внебиржа
  //demand - 0 требования ВнеБал, 1 - обязательства ВнеБал, 2 - требования Бал, 3 - обязательства Бал
  var sql, query, rs;
  var rest = $0;
  
  query = "SELECT SUM(t.rst) AS rest  " +
          "  FROM (SELECT DECODE(?, 0, NVL(SUM(AMOUNT_DEMAND_RUR), 0), 1,  NVL(SUM(AMOUNT_LIABILITY_RUR), 0), " +
          "                         2, NVL(SUM(AMOUNT_SS_ACTIVE), 0), 3, NVL(SUM(AMOUNT_SS_LIABILITY), 0)) AS rst " +
          "          FROM TRSHB_PFI_PKL_2CHD tpfi " +
          "         WHERE TPFI.REPORT_DT = ? " +
          "           AND LENGTH (BASE_ACTIVE) > 3 " +
          "           AND LOWER(BASE_ACTIVE) NOT LIKE ('%ставка%') " +
          "           AND LOWER(DEAL_EXCHANGE) LIKE DECODE(?, 0, 'бирж', 1, 'внебирж%') " +
          "         UNION ALL " +
          "        SELECT DISTINCT NVL (DECODE(?, 0, ABS(DECODE(acct.t_code_currency, 0, trebsum.sss, RSB_FIInstr.ConvSumtype(trebsum.sss, acct.t_code_currency, 0, 7, ?))), " +
          "                                       1, ABS(DECODE(acco.t_code_currency, 0, obsum.sss, RSB_FIInstr.ConvSumtype (obsum.sss, acco.t_code_currency, 0, 7, ?))), " +
          "                                       0), 0) as rst " +
          "          FROM ddvdeal_dbt ddv " +
          "          LEFT JOIN DFININSTR_DBT fi ON FI.T_FIID = ddv.t_fiid " +
          "          LEFT JOIN dmcaccdoc_dbt cdocT ON CDOCT.T_DOCID = ddv.t_id AND cdocT.t_catid = 781 " +
          "          LEFT JOIN daccount_dbt accT ON ACCT.T_ACCOUNT = CDOCT.T_ACCOUNT " +
          "          LEFT JOIN (SELECT t_rest AS sss, t_accountid " +
          "                       FROM drestdate_dbt rd " +
          "                      WHERE t_restdate = (SELECT MAX (t_restdate) " +
          "                                            FROM drestdate_dbt rd1 " +
          "                                           WHERE t_restdate < ? " +
          "                                             AND rd1.t_accountid = rd.t_accountid)) trebsum " +
          "                    ON trebsum.t_accountid = ACCT.T_ACCOUNTID " +
          "          LEFT JOIN dmcaccdoc_dbt cdocO ON CDOCO.T_DOCID = ddv.t_id AND cdocO.t_catid = 782 " +
          "          LEFT JOIN daccount_dbt accO ON ACCO.T_ACCOUNT = CDOCO.T_ACCOUNT " +
          "          LEFT JOIN (SELECT t_rest AS sss, t_accountid " +
          "                       FROM drestdate_dbt rd " +
          "                      WHERE t_restdate = (SELECT MAX (t_restdate) " +
          "                                            FROM drestdate_dbt rd1 " +
          "                                           WHERE t_restdate < ? " +
          "                                             AND rd1.t_accountid = rd.t_accountid)) obsum " +
          "                    ON obsum.t_accountid = ACCo.T_ACCOUNTID " +
          "         WHERE ddv.t_client = -1 " +
          "           AND ddv.t_date <= ? " +
          "           AND fi.t_drawingdate >= ? " +
          "           AND obsum.sss <> 0 " +
          "           AND trebsum.sss <> 0 " +
          "           AND ? = 0) t ";
  
  sql = RSDCommand(query);
  sql.addParam("", RSDBP_IN, demand);
  sql.addParam("", RSDBP_IN, rest_date-1);
  sql.addParam("", RSDBP_IN, kind);
  sql.addParam("", RSDBP_IN, demand);
  sql.addParam("", RSDBP_IN, rest_date);
  sql.addParam("", RSDBP_IN, rest_date);
  sql.addParam("", RSDBP_IN, rest_date);
  sql.addParam("", RSDBP_IN, rest_date);
  sql.addParam("", RSDBP_IN, rest_date);
  sql.addParam("", RSDBP_IN, rest_date);
  sql.addParam("", RSDBP_IN, kind);
  
  sql.execute();
  rs = TRsbDataSet(sql);
  if (rs.MoveNext())
    rest = abs(rs.rest);
  end;

  return rest;
end;

private macro CntDeal(rest_date, kind):integer
  //kind - 0 биржа, 1 - внебиржа
  var sql, query, rs;
  var ret = 0;
  query = "SELECT COUNT(0) AS cnt " +
          " FROM TRSHB_PFI_PKL_2CHD tpfi " +
          "WHERE TPFI.REPORT_DT = ? " +
          "  AND LENGTH (BASE_ACTIVE) > 3 " +
          "  AND LOWER(BASE_ACTIVE) NOT LIKE ('%ставка%') " +
          "  AND LOWER(DEAL_EXCHANGE) LIKE DECODE(?, 0, 'бирж%', 1, 'внебирж%') " +//
          "GROUP BY DEAL_EXCHANGE";
  sql = RSDCommand(query);
  sql.addParam("", RSDBP_IN, rest_date-1);
  sql.addParam("", RSDBP_IN, kind);
  sql.execute();
  rs = TRsbDataSet(sql);
  if (rs.MoveNext())
    ret = rs.cnt;
  end;
  
  query = "SELECT COUNT(t.NM ) AS cnt FROM ( " +
          "  SELECT DISTINCT(fi.t_name) AS NM, (SELECT t_fi_code FROM dfininstr_dbt WHERE t_fiid = acct.t_code_currency) AS fiid" +
          "    FROM ddvdeal_dbt ddv " +
          "    LEFT JOIN DFININSTR_DBT fi ON FI.T_FIID = ddv.t_fiid " +
          "    LEFT JOIN dmcaccdoc_dbt cdocT ON CDOCT.T_DOCID = ddv.t_id AND cdocT.t_catid = 781 " +
          "    LEFT JOIN daccount_dbt accT ON ACCT.T_ACCOUNT = CDOCT.T_ACCOUNT " +
          "    LEFT JOIN (SELECT t_rest AS sss, t_accountid " +
          "                 FROM drestdate_dbt rd " +
          "                WHERE t_restdate = (SELECT MAX (t_restdate) " +
          "                                      FROM drestdate_dbt rd1 " +
          "                                     WHERE t_restdate < ? " +
          "                                       AND rd1.t_accountid = rd.t_accountid)) trebsum " +
          "              ON trebsum.t_accountid = ACCT.T_ACCOUNTID " +
          "    LEFT JOIN dmcaccdoc_dbt cdocO ON CDOCO.T_DOCID = ddv.t_id AND cdocO.t_catid = 782 " +
          "    LEFT JOIN daccount_dbt accO ON ACCO.T_ACCOUNT = CDOCO.T_ACCOUNT " +
          "    LEFT JOIN (SELECT t_rest AS sss, t_accountid " +
          "                 FROM drestdate_dbt rd " +
          "                WHERE t_restdate = (SELECT MAX (t_restdate) " +
          "                                      FROM drestdate_dbt rd1 " +
          "                                     WHERE t_restdate < ? " +
          "                                       AND rd1.t_accountid = rd.t_accountid)) obsum " +
          "              ON obsum.t_accountid = ACCo.T_ACCOUNTID " +
          "   WHERE ddv.t_client = -1 " +
          "     AND ddv.t_date <= ? " +
          "     AND fi.t_drawingdate >= ?" +
          "     AND obsum.sss <> 0 " +
          "     AND trebsum.sss <> 0 " +
          "     AND ? = 0 ) t";
  sql = RSDCommand(query);
  sql.addParam("", RSDBP_IN, rest_date-1);
  sql.addParam("", RSDBP_IN, rest_date-1);
  sql.addParam("", RSDBP_IN, rest_date-1);
  sql.addParam("", RSDBP_IN, rest_date-1);
  sql.addParam("", RSDBP_IN, kind);
  sql.execute();
  rs = TRsbDataSet(sql);
  if (rs.MoveNext())
    ret = ret + rs.cnt;
  end;
  
  return ret;
end;

private macro CntContrag(rest_date, kind):integer
  //kind - 0 биржа, 1 - внебиржа

  var sql, query, rs;
  var ret = 0;
  query = "SELECT COUNT(COUNT(0)) AS cnt " +
          " FROM TRSHB_PFI_PKL_2CHD tpfi " +
          "WHERE TPFI.REPORT_DT = ? " +
          "  AND LENGTH (BASE_ACTIVE) > 3 " +
          "  AND LOWER(BASE_ACTIVE) NOT LIKE ('%ставка%') " +
          "  AND LOWER(DEAL_EXCHANGE) LIKE DECODE(?, 0, 'бирж%', 1, 'внебирж%') " +//
          "GROUP BY SUBJECT";
  sql = RSDCommand(query);
  sql.addParam("", RSDBP_IN, rest_date-1);
  sql.addParam("", RSDBP_IN, kind);
  sql.execute();
  rs = TRsbDataSet(sql);
  if (rs.MoveNext())
    ret = rs.cnt;
  end;

  return ret;
end;


private macro SumRestAccPFI(acc_mask,rest_date,kind,sector):money
    //kind - вид операции , если 0 - то все . sector: true - биржа , false - внебиржа
    var sql,query,rs;
    var rest = $0;
 /* TEG old versin
    query = "SELECT nvl(SUM(rsi_rsb_account.restall(c.t_account,c.t_chapter,c.t_currency,?)),0) as rst"+
          " FROM dmcaccdoc_dbt c "+
          " WHERE c.t_dockind = 199 "+
          " AND c.t_docid IN " +
          " ( "+
          " SELECT d.t_id FROM ddvndeal_dbt d "+
          " WHERE d.t_ispfi = chr(88) "+
          iif(kind != 0," AND d.t_dvkind = "+kind+" "," ")+
          iif(sector," AND d.t_sector = chr(88) "," AND d.t_sector = chr(0) ")+
          " AND ((d.t_state = 1 AND d.t_date < ?) OR "+
          //" (d.t_state = 2 AND ? BETWEEN d.t_date AND "+
          " (d.t_state = 2 AND (? > d.t_date and ? <=  "+
          " (SELECT max(f.t_execdate) FROM ddvnfi_dbt f WHERE f.t_dealid = d.t_id)))) "+
          " AND d.t_date < (SELECT max(f.t_execdate) FROM ddvnfi_dbt f WHERE f.t_dealid = d.t_id) "+
          " ) "+
          " and substr(c.t_account, 1, "+StrLen(acc_mask)+") = ? ";
    sql = RSDCommand(query);
    sql.addParam("", RSDBP_IN, rest_date-1);
    sql.addParam("", RSDBP_IN, rest_date);
    sql.addParam("", RSDBP_IN, rest_date);
    sql.addParam("", RSDBP_IN, rest_date);
    sql.addParam("", RSDBP_IN, acc_mask);
*/

  /*TEG сделал поиск счетов через привязку к операциям
  query = " SELECT nvl(SUM(rsi_rsb_account.restall(c.t_account,c.t_chapter,c.t_currency,?,0)),0) as rst "+
          " FROM dmcaccdoc_dbt c "+
          " WHERE c.t_dockind = 199 "+
          " AND c.t_docid IN " +
          " ( SELECT d.t_id FROM ddvndeal_dbt d "+
          "    WHERE d.t_ispfi = chr(88) "+
          iif(kind != 0," AND d.t_dvkind  in  ("+kind+" ) "," ")+
          iif(sector," AND d.t_sector = chr(88) "," AND NVL(d.t_sector,chr(0)) <> chr(88) ")+
          "    AND  d.t_state IN (1,2) AND d.t_date < ?    "+
//         "          AND (SELECT max(f.t_execdate) FROM ddvnfi_dbt f WHERE f.t_dealid = d.t_id)>=? "+
//         "        )  "+
           "    AND EXISTS(SELECT 1 FROM ddvnfi_dbt f , dfininstr_dbt fi  "+
           "                                   WHERE  f.t_dealid = d.t_id AND  fi.t_fiid=f.t_fiid  "+ 
           "                                          AND fi.t_fi_kind<>2  AND f.t_execdate >= ?   ) "+ //TEG  выкидываем ноги с ЦБ
          "   )   "+
          "  AND substr(c.t_account, 1, "+StrLen(acc_mask)+") = ?  " +
          "  AND c.t_activatedate <  ? " +
          "  AND (c.t_disablingdate = DATE '0001-01-01'  OR  c.t_disablingdate>= ? )  "   ;
*/
 query = " SELECT nvl(SUM(rsi_rsb_account.restall(account.t_account,account.t_chapter,account.t_code_currency,?,0)),0) as rst "+
         "  FROM (  SELECT  DISTINCT acc.t_account,   acc.t_chapter, acc.t_code_currency                                      "+  
         "          FROM doproper_dbt do , ddvndeal_dbt deal ,doprdocs_dbt opr, dacctrn_dbt trn , daccount_dbt acc       "+
         "          WHERE   do.t_documentid=lpad(deal.t_id,34,'0')    "+
         "          AND opr.t_dockind=1    "+
         "          AND opr.t_id_operation=do.t_id_operation   "+
         "          AND deal.t_dockind=do.t_dockind            "+
         "          AND deal.t_ispfi = chr(88)                 "+
         "          AND trn.t_acctrnid = opr.t_acctrnid        "+
         "          AND (trn.t_accountid_payer=acc.t_accountid OR trn.t_accountid_receiver= acc.t_accountid)  "+
         "          AND NOT upper(acc.t_nameaccount) LIKE '%ПРОМЕЖУТОЧ%'  "+
         "          AND EXISTS ( SELECT 1 FROM ddvndeal_dbt d    "+
         "                                WHERE d.t_id=deal.t_id   "+
                   iif(kind != 0," AND d.t_dvkind  in  ("+kind+" ) "," ")+
                   iif(sector," AND d.t_sector = chr(88) "," AND NVL(d.t_sector,chr(0)) <> chr(88) ")+
         "          AND  d.t_state IN (1,2) AND d.t_date < ?   "+ 
         "          AND EXISTS(SELECT 1 FROM ddvnfi_dbt f , dfininstr_dbt fi   "+
         "                              WHERE  f.t_dealid = d.t_id AND  fi.t_fiid=f.t_fiid   "+
         "                                      AND fi.t_fi_kind<>2  AND f.t_execdate >= ?  ) "+ //TEG  выкидываем ноги с ЦБ
         "                     )   "+
         "               AND substr(acc.t_account, 1, "+StrLen(acc_mask)+") = ? ) account ";

    sql = RSDCommand(query);
    sql.addParam("", RSDBP_IN, rest_date-1 );
    sql.addParam("", RSDBP_IN, rest_date );
    sql.addParam("", RSDBP_IN, rest_date );
    sql.addParam("", RSDBP_IN, acc_mask );
    //sql.addParam("", RSDBP_IN, rest_date );
    //sql.addParam("", RSDBP_IN, rest_date );
    sql.execute();
    rs = TRsbDataSet(sql);

    if (rs.MoveNext())
        rest = abs(rs.rst);
    end;

    return rest;
end;

private macro ContragCnt(cnt_date,kind,sector):integer
    var sql,query,rs;
    var ret = 0;
    var kind_str=" ";

    if (kind > 0)
        kind_str = " AND d.t_dvkind  in  ("+kind+" ) ";
    elif (kind < 0)
        kind_str = "  AND d.t_dvkind NOT IN (1,2,3,4,6)  ";
    end;
/* TEG old version
    query = "SELECT COUNT(distinct d.t_contractor) AS cnt FROM ddvndeal_dbt d "+
            " WHERE d.t_ispfi = chr(88) "+
            kind_str+
            iif(sector," AND d.t_sector = chr(88) "," AND d.t_sector = chr(0) ")+
            " AND ((d.t_state = 1 AND d.t_date <= ?) OR "+
            //" (d.t_state = 2 AND ? BETWEEN d.t_date AND "+
            " (d.t_state = 2 AND (? > d.t_date and ? <=  "+
            " (SELECT max(f.t_execdate) FROM ddvnfi_dbt f WHERE f.t_dealid = d.t_id)))) "+
            " AND d.t_date < (SELECT max(f.t_execdate) FROM ddvnfi_dbt f WHERE f.t_dealid = d.t_id) ";
    sql = RSDCommand(query);
    sql.addParam("", RSDBP_IN, cnt_date);
    sql.addParam("", RSDBP_IN, cnt_date);
    sql.addParam("", RSDBP_IN, cnt_date); 
    */

    query = "SELECT COUNT(distinct d.t_contractor) AS cnt FROM ddvndeal_dbt d "+
            " WHERE d.t_ispfi = chr(88)  "+
            kind_str+
            iif(sector," AND d.t_sector = chr(88) "," AND NVL(d.t_sector,chr(0))<>chr(88) ")+
            "  AND  d.t_state IN (1,2)  AND d.t_date < ? "+
          //  "        AND  (SELECT max(f.t_execdate) FROM ddvnfi_dbt f WHERE f.t_dealid = d.t_id) >= ?  "+ 
          //  "       ) ";
           "    AND EXISTS(SELECT 1 FROM ddvnfi_dbt f , dfininstr_dbt fi  "+
           "                                   WHERE  f.t_dealid = d.t_id AND  fi.t_fiid=f.t_fiid  "+ 
           "                                          AND fi.t_fi_kind<>2  AND f.t_execdate >= ?   ) ";  //TEG  выкидываем ноги с ЦБ
    sql = RSDCommand(query);
    sql.addParam("", RSDBP_IN, cnt_date);
    sql.addParam("", RSDBP_IN, cnt_date);  
    sql.execute();

    rs = TRsbDataSet(sql);

    if (rs.MoveNext())
        ret = rs.cnt;
    end;

    return ret;

end;

private macro DealCnt(cnt_date,kind,sector):integer
    var sql,query,rs;
    var ret = 0;
  /* TEG oldversion
  query = "SELECT COUNT(d.t_id) AS cnt FROM ddvndeal_dbt d "+
            " WHERE d.t_ispfi = chr(88) "+
            iif(kind != 0," AND d.t_dvkind = "+kind+" "," ")+
            iif(sector," AND d.t_sector = chr(88) "," AND d.t_sector = chr(0) ")+
            " AND ((d.t_state = 1 AND d.t_date <= ?) OR "+
            //" (d.t_state = 2 AND ? BETWEEN d.t_date AND "+
            " (d.t_state = 2 AND (? > d.t_date and ? <=  "+
            " (SELECT max(f.t_execdate) FROM ddvnfi_dbt f WHERE f.t_dealid = d.t_id)))) "+
            " AND d.t_date < (SELECT max(f.t_execdate) FROM ddvnfi_dbt f WHERE f.t_dealid = d.t_id) ";
    sql = RSDCommand(query);
    sql.addParam("", RSDBP_IN, cnt_date);
    sql.addParam("", RSDBP_IN, cnt_date);
    sql.addParam("", RSDBP_IN, cnt_date);
   */

  query = " SELECT  COUNT(d.t_id) AS cnt FROM ddvndeal_dbt d "+
          "  WHERE d.t_ispfi = CHR(88) "+
          iif(kind != 0," AND d.t_dvkind IN ("+kind+") "," ")+
          iif(sector," AND d.t_sector = chr(88) "," AND NVL(d.t_sector,chr(0))<>chr(88) ")+
           "  AND d.t_state IN (1,2)  AND d.t_date < ? "+
           //"        AND  (SELECT max(f.t_execdate) FROM ddvnfi_dbt f WHERE f.t_dealid = d.t_id) >= ?  "+ 
           //"      ) ";
           "    AND EXISTS(SELECT 1 FROM ddvnfi_dbt f , dfininstr_dbt fi  "+
           "                                   WHERE  f.t_dealid = d.t_id AND  fi.t_fiid=f.t_fiid  "+ 
           "                                          AND fi.t_fi_kind<>2  AND f.t_execdate >= ?   ) ";  //TEG  выкидываем ноги с ЦБ
    sql = RSDCommand(query);
    sql.addParam("", RSDBP_IN, cnt_date);
    sql.addParam("", RSDBP_IN, cnt_date);          
    sql.execute();

    rs = TRsbDataSet(sql);

    if (rs.MoveNext())
        ret = rs.cnt;
    end;

    return ret;

end;
//MsgBox(SumRestAccPFI("933",date("01.03.2019"),22720,false));

macro DrawFormPFI1(ondate, incAvoir)
    var color = 65535;
    var head_format = "c:ex_FS(b):ex_B(tblr):ex_BC(" + color + ")";
    var line_format = "r:ex_B(tblr):ex_FZ(10)";
    var line_format_l = "l:ex_B(tblr):ex_FZ(10)";
    var line_format_c = "c:ex_B(tblr):ex_FZ(10)";
    var line_format_c_b = "c:ex_B():ex_FZ(10):ex_FS(b)";
    var line_format_l_b = "l:ex_B(tblr):ex_FZ(10):ex_FS(b)";
    var sheet = 1;
    var count = 0;
    var rn = 0;
    //var ondate = date("20.03.2019");
   begaction(100,"Идет расчет данных ..");
    /*Блок статических вычислений*/
        /*Все сделки*/
    var all_bdeal_sumG_demand = $0,all_bdeal_sumG_liability = $0,all_bdeal_sumSS_1 = $0,all_bdeal_sumSS_2 = $0,all_bdeal_count=0,all_bdeal_contrag=0; //биржа
    var all_Vbdeal_sumG_demand = $0,all_Vbdeal_sumG_liability = $0,all_Vbdeal_sumSS_1 = $0,all_Vbdeal_sumSS_2 = $0,all_Vbdeal_count=0,all_Vbdeal_contrag=0; //внебиржа
            /*Биржа*/
    all_bdeal_sumG_demand = SumRestAccPFI("93",ondate,0,true);
    all_bdeal_sumG_liability = SumRestAccPFI("96",ondate,0,true);
    all_bdeal_sumSS_1 = SumRestAccPFI("52601",ondate,0,true);
    all_bdeal_sumSS_2 = SumRestAccPFI("52602",ondate,0,true);
    all_bdeal_count = DealCnt(ondate,0,true);
    all_bdeal_contrag = ContragCnt(ondate,0,true);
            /*Внебиржа*/
    all_Vbdeal_sumG_demand = SumRestAccPFI("93",ondate,0,false);
    all_Vbdeal_sumG_liability = SumRestAccPFI("96",ondate,0,false);
    all_Vbdeal_sumSS_1 = SumRestAccPFI("52601",ondate,0,false);
    all_Vbdeal_sumSS_2 = SumRestAccPFI("52602",ondate,0,false);
    all_Vbdeal_count = DealCnt(ondate,0,false);
    all_Vbdeal_contrag = ContragCnt(ondate,0,false);
        /*Валютный своп . dvkind = 3  а не 6 ли?*/
    var valswp_bdeal_sumG_demand = $0,valswp_bdeal_sumG_liability = $0,valswp_bdeal_sumSS_1 = $0,valswp_bdeal_sumSS_2 = $0,valswp_bdeal_count=0,valswp_bdeal_contrag=0; //биржа
    var valswp_Vbdeal_sumG_demand = $0,valswp_Vbdeal_sumG_liability = $0,valswp_Vbdeal_sumSS_1 = $0,valswp_Vbdeal_sumSS_2 = $0,valswp_Vbdeal_count=0,valswp_Vbdeal_contrag=0; //внебиржа
            /*Биржа*/
    valswp_bdeal_sumG_demand = SumRestAccPFI("93",ondate,"3,6",true);
    valswp_bdeal_sumG_liability = SumRestAccPFI("96",ondate,"3,6",true);
    valswp_bdeal_sumSS_1 = SumRestAccPFI("52601",ondate,"3,6",true);
    valswp_bdeal_sumSS_2 = SumRestAccPFI("52602",ondate,"3,6",true);
    valswp_bdeal_count = DealCnt(ondate,"3,6",true);
    valswp_bdeal_contrag = ContragCnt(ondate,"3,6",true);
            /*Внебиржа*/
    valswp_Vbdeal_sumG_demand = SumRestAccPFI("93",ondate,"3,6",false);
    valswp_Vbdeal_sumG_liability = SumRestAccPFI("96",ondate,"3,6",false);
    valswp_Vbdeal_sumSS_1 = SumRestAccPFI("52601",ondate,"3,6",false);
    valswp_Vbdeal_sumSS_2 = SumRestAccPFI("52602",ondate,"3,6",false);
    valswp_Vbdeal_count = DealCnt(ondate,"3,6",false);
    valswp_Vbdeal_contrag = ContragCnt(ondate,"3,6",false);
        /*Процентный своп . dvkind = 4*/
    var prcswp_bdeal_sumG_demand = $0,prcswp_bdeal_sumG_liability = $0,prcswp_bdeal_sumSS_1 = $0,prcswp_bdeal_sumSS_2 = $0,prcswp_bdeal_count=0,prcswp_bdeal_contrag=0; //биржа
    var prcswp_Vbdeal_sumG_demand = $0,prcswp_Vbdeal_sumG_liability = $0,prcswp_Vbdeal_sumSS_1 = $0,prcswp_Vbdeal_sumSS_2 = $0,prcswp_Vbdeal_count=0,prcswp_Vbdeal_contrag=0; //внебиржа
            /*Биржа*/
    prcswp_bdeal_sumG_demand = SumRestAccPFI("93",ondate,4,true);
    prcswp_bdeal_sumG_liability = SumRestAccPFI("96",ondate,4,true);
    prcswp_bdeal_sumSS_1 = SumRestAccPFI("52601",ondate,4,true);
    prcswp_bdeal_sumSS_2 = SumRestAccPFI("52602",ondate,4,true);
    prcswp_bdeal_count = DealCnt(ondate,4,true);
    prcswp_bdeal_contrag = ContragCnt(ondate,4,true);
            /*Внебиржа*/
    prcswp_Vbdeal_sumG_demand = SumRestAccPFI("93",ondate,4,false);
    prcswp_Vbdeal_sumG_liability = SumRestAccPFI("96",ondate,4,false);
    prcswp_Vbdeal_sumSS_1 = SumRestAccPFI("52601",ondate,4,false);
    prcswp_Vbdeal_sumSS_2 = SumRestAccPFI("52602",ondate,4,false);
    prcswp_Vbdeal_count = DealCnt(ondate,4,false);
    prcswp_Vbdeal_contrag = ContragCnt(ondate,4,false);
        /*Форвард . dvkind = 1*/
    var fwd_bdeal_sumG_demand = $0,fwd_bdeal_sumG_liability = $0,fwd_bdeal_sumSS_1 = $0,fwd_bdeal_sumSS_2 = $0,fwd_bdeal_count=0,fwd_bdeal_contrag=0; //биржа
    var fwd_Vbdeal_sumG_demand = $0,fwd_Vbdeal_sumG_liability = $0,fwd_Vbdeal_sumSS_1 = $0,fwd_Vbdeal_sumSS_2 = $0,fwd_Vbdeal_count=0,fwd_Vbdeal_contrag=0; //внебиржа
            /*Биржа*/
    fwd_bdeal_sumG_demand = SumRestAccPFI("93",ondate,1,true);
    fwd_bdeal_sumG_liability = SumRestAccPFI("96",ondate,1,true);
    fwd_bdeal_sumSS_1 = SumRestAccPFI("52601",ondate,1,true);
    fwd_bdeal_sumSS_2 = SumRestAccPFI("52602",ondate,1,true);
    fwd_bdeal_count = DealCnt(ondate,1,true);
    fwd_bdeal_contrag = ContragCnt(ondate,1,true);
            /*Внебиржа*/
    fwd_Vbdeal_sumG_demand = SumRestAccPFI("93",ondate,1,false);
    fwd_Vbdeal_sumG_liability = SumRestAccPFI("96",ondate,1,false);
    fwd_Vbdeal_sumSS_1 = SumRestAccPFI("52601",ondate,1,false);
    fwd_Vbdeal_sumSS_2 = SumRestAccPFI("52602",ondate,1,false);
    fwd_Vbdeal_count = DealCnt(ondate,1,false);
    fwd_Vbdeal_contrag = ContragCnt(ondate,1,false);
        /*Опцион . dvkind = 2*/
    var opc_bdeal_sumG_demand = $0,opc_bdeal_sumG_liability = $0,opc_bdeal_sumSS_1 = $0,opc_bdeal_sumSS_2 = $0,opc_bdeal_count=0,opc_bdeal_contrag=0; //биржа
    var opc_Vbdeal_sumG_demand = $0,opc_Vbdeal_sumG_liability = $0,opc_Vbdeal_sumSS_1 = $0,opc_Vbdeal_sumSS_2 = $0,opc_Vbdeal_count=0,opc_Vbdeal_contrag=0; //внебиржа
            /*Биржа*/
    opc_bdeal_sumG_demand = SumRestAccPFI("93",ondate,2,true);
    opc_bdeal_sumG_liability = SumRestAccPFI("96",ondate,2,true);
    opc_bdeal_sumSS_1 = SumRestAccPFI("52601",ondate,2,true);
    opc_bdeal_sumSS_2 = SumRestAccPFI("52602",ondate,2,true);
    opc_bdeal_count = DealCnt(ondate,2,true);
    opc_bdeal_contrag = ContragCnt(ondate,2,true);
            /*Внебиржа*/
    opc_Vbdeal_sumG_demand = SumRestAccPFI("93",ondate,2,false);
    opc_Vbdeal_sumG_liability = SumRestAccPFI("96",ondate,2,false);
    opc_Vbdeal_sumSS_1 = SumRestAccPFI("52601",ondate,2,false);
    opc_Vbdeal_sumSS_2 = SumRestAccPFI("52602",ondate,2,false);
    opc_Vbdeal_count = DealCnt(ondate,2,false);
    opc_Vbdeal_contrag = ContragCnt(ondate,2,false);
    
    /* Блок прочее Ценные бумаги Chesnokov D.S. 23.05.2019 IM2776836*/
   if (incAvoir)
    var Params:TArray;
        Params = makeArray(SQLParam("", ondate-1));
        execSQL ("begin rsFillPFI(?, TRUE);end;",Params);
      /*Биржевые*/
    var other_Avr_market_sumVbG_demand = SumRestAccAvoir(ondate, 0, 0);
    var other_Avr_market_sumVbG_liability = SumRestAccAvoir(ondate, 0, 1);
    var other_Avr_market_sum_52601 = SumRestAccAvoir(ondate, 0, 2);
    var other_Avr_market_sum_52602 = SumRestAccAvoir(ondate, 0, 3);
    var other_Avr_market_countdealVbG = CntDeal(ondate, 0);
    var other_Avr_market_countdeal_526 = 0;
    var other_Avr_market_countctgVbG = 1;//Судя по форме 657 контрагент всегда только один
    var other_Avr_market_countctg_526 = 0;

      /*Внебиржевые*/
    var other_Avr_nomarket_sumVbG_demand = SumRestAccAvoir(ondate, 1, 0);
    var other_Avr_nomarket_sumVbG_liability = SumRestAccAvoir(ondate, 1, 1);
    var other_Avr_nomarket_sum_52601 = SumRestAccAvoir(ondate, 1, 2);
    var other_Avr_nomarket_sum_52602 = SumRestAccAvoir(ondate, 1, 3);
    
    var other_Avr_nomarket_countdealVbG = CntDeal(ondate, 1);
    var other_Avr_nomarket_countdeal_526 = CntDeal(ondate, 1);
    var other_Avr_nomarket_countctgVbG = CntContrag(ondate, 1);
    var other_Avr_nomarket_countctg_526 = CntContrag(ondate, 1);
      /*Общий итог по Прочие(Ценные бумаги)*/
    var other_Avr_all_sumVbG_demand = other_Avr_market_sumVbG_demand + other_Avr_nomarket_sumVbG_demand;
    var other_Avr_all_sumVbG_liability = other_Avr_market_sumVbG_liability + other_Avr_nomarket_sumVbG_liability;
    var other_Avr_all_sum_52601 = other_Avr_market_sum_52601 + other_Avr_nomarket_sum_52601;
    var other_Avr_all_sum_52602 = other_Avr_market_sum_52602 + other_Avr_nomarket_sum_52602;
    var other_Avr_all_countdealVbG = other_Avr_market_countdealVbG + other_Avr_nomarket_countdealVbG;
    var other_Avr_all_countdeal_526 = other_Avr_market_countdeal_526 + other_Avr_nomarket_countdeal_526;
    var other_Avr_all_countctgVbG = other_Avr_market_countctgVbG + other_Avr_nomarket_countctgVbG;
    var other_Avr_all_countctg_526 = other_Avr_market_countctg_526 + other_Avr_nomarket_countctg_526;
    end;
        /*Блок прочее*/
    //var other_bdeal_sumG_demand = $0,other_bdeal_sumG_liability = $0,other_bdeal_sumSS_1 = $0,other_bdeal_sumSS_2 = $0,other_bdeal_count=0,other_bdeal_contrag=0; //биржа
    //var other_Vbdeal_sumG_demand = $0,other_Vbdeal_sumG_liability = $0,other_Vbdeal_sumSS_1 = $0,other_Vbdeal_sumSS_2 = $0,other_Vbdeal_count=0,other_Vbdeal_contrag=0; //внебиржа
            /*Биржа*/
    var other_bdeal_sumG_demand = all_bdeal_sumG_demand - (valswp_bdeal_sumG_demand + prcswp_bdeal_sumG_demand + fwd_bdeal_sumG_demand + opc_bdeal_sumG_demand);
    var other_bdeal_sumG_liability = all_bdeal_sumG_liability - (valswp_bdeal_sumG_liability + prcswp_bdeal_sumG_liability + fwd_bdeal_sumG_liability + opc_bdeal_sumG_liability);
    var other_bdeal_sumSS_1 = all_bdeal_sumSS_1 - (valswp_bdeal_sumSS_1 + prcswp_bdeal_sumSS_1 + fwd_bdeal_sumSS_1 + opc_bdeal_sumSS_1);
    var other_bdeal_sumSS_2 = all_bdeal_sumSS_2 - (valswp_bdeal_sumSS_2 + prcswp_bdeal_sumSS_2 + fwd_bdeal_sumSS_2 + opc_bdeal_sumSS_2);
    var other_bdeal_count = all_bdeal_count - (valswp_bdeal_count + prcswp_bdeal_count + fwd_bdeal_count + opc_bdeal_count);
   // var other_bdeal_contrag = all_bdeal_contrag;
    var other_bdeal_contrag = ContragCnt(ondate,-1,true);
            /*Внебиржа*/
    var other_Vbdeal_sumG_demand = all_Vbdeal_sumG_demand - (valswp_Vbdeal_sumG_demand + prcswp_Vbdeal_sumG_demand + fwd_Vbdeal_sumG_demand + opc_Vbdeal_sumG_demand);
    var other_Vbdeal_sumG_liability = all_Vbdeal_sumG_liability - (valswp_Vbdeal_sumG_liability + prcswp_Vbdeal_sumG_liability + fwd_Vbdeal_sumG_liability + opc_Vbdeal_sumG_liability);
    var other_Vbdeal_sumSS_1 = all_Vbdeal_sumSS_1 - (valswp_Vbdeal_sumSS_1 + prcswp_Vbdeal_sumSS_1 + fwd_Vbdeal_sumSS_1 + opc_Vbdeal_sumSS_1);
    var other_Vbdeal_sumSS_2 = all_Vbdeal_sumSS_2 - (valswp_Vbdeal_sumSS_2 + prcswp_Vbdeal_sumSS_2 + fwd_Vbdeal_sumSS_2 + opc_Vbdeal_sumSS_2);
    var other_Vbdeal_count = all_Vbdeal_count - (valswp_Vbdeal_count + prcswp_Vbdeal_count + fwd_Vbdeal_count + opc_Vbdeal_count);
    var other_Vbdeal_contrag = ContragCnt(ondate,-1,false);
    
    endaction();
    /* БЛОК ШАПКА */
    var Rep = CMakereport("┌─┬─┬─┐");

    Rep.SetDefaultFontName("Times New Roman");
    Rep.SetDefaultFontSize(10);
    Rep.SetFlagShowGrid(true);
    


    
    Rep.SetExecute("iBook.Sheets("+sheet+").Rows().RowHeight = 14.75;");
    Rep.SetExecute("iBook.Sheets("+sheet+").Columns(1).ColumnWidth = 55;");
    Rep.SetExecute("iBook.Sheets("+sheet+").Columns(2).ColumnWidth = 35;");
    Rep.SetExecute("iBook.Sheets("+sheet+").Columns(3).ColumnWidth = 35;");
    
    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Информация о сдеках с ПФИ, заключенных по состоянию на "+ondate, 0, null, line_format_c_b);
    //Rep.AddPrintCell(" АО \"РОССЕЛЬХОЗБАНК\" ",Rep.GetHeaderWidth(2)+Rep.GetHeaderWidth(3), 0, head_format);
    Rep.AddStr();

    rn = rn + 1;
    
    Rep.AddEmptyStr();
    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Показатель на "+ondate,0, 0, head_format); 
    Rep.AddPrintCell(" АО \"РОССЕЛЬХОЗБАНК\" ",0, 0, head_format);
    Rep.AddStr();

    rn = rn + 1;
    
    Rep.AddPrintCell("",0, 0, line_format_l_b);
    Rep.AddPrintCell("Сделки с ПФИ, отраженные на счетах раздела Г",0, 0, line_format_l_b);
    Rep.AddPrintCell("Сделки с ПФИ, отраженные на счетах 526",0, 0, line_format_l_b);
    Rep.AddStr();

    /* БЛОК ОБЩАЯ СУММА */

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("ОБЩАЯ СУММА",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(string(round((all_bdeal_sumG_demand+all_Vbdeal_sumG_demand+other_Avr_all_sumVbG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_bdeal_sumSS_1+all_Vbdeal_sumSS_1+other_Avr_all_sum_52601)/1000000000,3):a:10:3),0, 0, line_format_c);
    else
      Rep.AddPrintCell(string(round((all_bdeal_sumG_demand+all_Vbdeal_sumG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_bdeal_sumSS_1+all_Vbdeal_sumSS_1)/1000000000,3):a:10:3),0, 0, line_format_c);
    end;
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    if (incAvoir)   
      Rep.AddPrintCell(string(round((all_bdeal_sumG_liability+all_Vbdeal_sumG_liability+other_Avr_all_sumVbG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_bdeal_sumSS_2+all_Vbdeal_sumSS_2+other_Avr_all_sum_52602)/1000000000,3):a:10:3),0, 0, line_format_c);
    else  
      Rep.AddPrintCell(string(round((all_bdeal_sumG_liability+all_Vbdeal_sumG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_bdeal_sumSS_2+all_Vbdeal_sumSS_2)/1000000000,3):a:10:3),0, 0, line_format_c);
    end;
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(all_bdeal_count+all_Vbdeal_count+other_Avr_all_countdealVbG+other_Avr_all_countdeal_526,0, 0, line_format_c);
    else
      Rep.AddPrintCell(all_bdeal_count+all_Vbdeal_count,0, 0, line_format_c); 
    end;
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(all_bdeal_contrag+all_Vbdeal_contrag+other_Avr_all_countctgVbG+other_Avr_all_countctg_526,0, 0, line_format_c);
    else
      Rep.AddPrintCell(all_bdeal_contrag+all_Vbdeal_contrag,0, 0, line_format_c);
    end;
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. биржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    if (incAvoir)
       Rep.AddPrintCell(string(round((all_bdeal_sumG_demand+other_Avr_market_sumVbG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddPrintCell(string(round((all_bdeal_sumSS_1+other_Avr_market_sum_52601)/1000000000,3):a:10:3),0, 0, line_format_c);
    else
       Rep.AddPrintCell(string(round((all_bdeal_sumG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddPrintCell(string(round((all_bdeal_sumSS_1)/1000000000,3):a:10:3),0, 0, line_format_c);
    end;   
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(string(round((all_bdeal_sumG_liability+other_Avr_market_sumVbG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_bdeal_sumSS_2+other_Avr_market_sum_52602)/1000000000,3):a:10:3),0, 0, line_format_c);
    else
      Rep.AddPrintCell(string(round((all_bdeal_sumG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_bdeal_sumSS_2)/1000000000,3):a:10:3),0, 0, line_format_c);
    end;  
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(all_bdeal_count+other_Avr_market_countdealVbG+other_Avr_market_countdeal_526,0, 0, line_format_c);
    else
      Rep.AddPrintCell(all_bdeal_count,0, 0, line_format_c);
    end;  
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(all_bdeal_contrag+other_Avr_market_countctgVbG+other_Avr_market_countctg_526,0, 0, line_format_c);
    else
      Rep.AddPrintCell(all_bdeal_contrag,0, 0, line_format_c);
    end;  
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. внебиржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(string(round((all_Vbdeal_sumG_demand+other_Avr_nomarket_sumVbG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_Vbdeal_sumSS_1+other_Avr_nomarket_sum_52601)/1000000000,3):a:10:3),0, 0, line_format_c);
    else
      Rep.AddPrintCell(string(round((all_Vbdeal_sumG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_Vbdeal_sumSS_1)/1000000000,3):a:10:3),0, 0, line_format_c);
    end;
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(string(round((all_Vbdeal_sumG_liability+other_Avr_nomarket_sumVbG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_Vbdeal_sumSS_2+other_Avr_nomarket_sum_52602)/1000000000,3):a:10:3),0, 0, line_format_c);
    else
      Rep.AddPrintCell(string(round((all_Vbdeal_sumG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
      Rep.AddPrintCell(string(round((all_Vbdeal_sumSS_2)/1000000000,3):a:10:3),0, 0, line_format_c);
    end;    
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(all_Vbdeal_count+other_Avr_nomarket_countdealVbG+other_Avr_nomarket_countdeal_526,0, 0, line_format_c);
    else
      Rep.AddPrintCell(all_Vbdeal_count,0, 0, line_format_c);
    end;
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    if (incAvoir)
      Rep.AddPrintCell(all_Vbdeal_contrag+other_Avr_nomarket_countctgVbG+other_Avr_nomarket_countctg_526,0, 0, line_format_c);
    else
      Rep.AddPrintCell(all_Vbdeal_contrag,0, 0, line_format_c);
    end; 
    Rep.AddStr();

    /* БЛОК ВАЛЮТНЫЙ СВОП */

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("ВАЛЮТНЫЙ СВОП",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((valswp_bdeal_sumG_demand+valswp_Vbdeal_sumG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((valswp_bdeal_sumSS_1+valswp_Vbdeal_sumSS_1)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((valswp_bdeal_sumG_liability+valswp_Vbdeal_sumG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((valswp_bdeal_sumSS_2+valswp_Vbdeal_sumSS_2)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(valswp_bdeal_count+valswp_Vbdeal_count,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(valswp_bdeal_contrag+valswp_Vbdeal_contrag,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. биржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(valswp_bdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(valswp_bdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(valswp_bdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(valswp_bdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(valswp_bdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(valswp_bdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. внебиржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(valswp_Vbdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(valswp_Vbdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(valswp_Vbdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(valswp_Vbdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(valswp_Vbdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(valswp_Vbdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    /*БЛОК ПРОЦЕНТНЫЙ СВОП*/

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("ПРОЦЕНТНЫЙ и ВАЛЮТНО-ПРОЦЕНТНЫЙ СВОП",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((prcswp_bdeal_sumG_demand+prcswp_Vbdeal_sumG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((prcswp_bdeal_sumSS_1+prcswp_Vbdeal_sumSS_1)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((prcswp_bdeal_sumG_liability+prcswp_Vbdeal_sumG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((prcswp_bdeal_sumSS_2+prcswp_Vbdeal_sumSS_2)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(prcswp_bdeal_count+prcswp_Vbdeal_count,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(prcswp_bdeal_contrag+prcswp_Vbdeal_contrag,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. биржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(prcswp_bdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(prcswp_bdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(prcswp_bdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(prcswp_bdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(prcswp_bdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(prcswp_bdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. внебиржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(prcswp_Vbdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(prcswp_Vbdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(prcswp_Vbdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(prcswp_Vbdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(prcswp_Vbdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(prcswp_Vbdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    /*ФОРВАРД*/

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("ВАЛЮТНЫЙ ФОРВАРД",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((fwd_bdeal_sumG_demand+fwd_Vbdeal_sumG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((fwd_bdeal_sumSS_1+fwd_Vbdeal_sumSS_1)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((fwd_bdeal_sumG_liability+fwd_Vbdeal_sumG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((fwd_bdeal_sumSS_2+fwd_Vbdeal_sumSS_2)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(fwd_bdeal_count+fwd_Vbdeal_count,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(fwd_bdeal_contrag+fwd_Vbdeal_contrag,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. биржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(fwd_bdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(fwd_bdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(fwd_bdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(fwd_bdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(fwd_bdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(fwd_bdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. внебиржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(fwd_Vbdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(fwd_Vbdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(fwd_Vbdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(fwd_Vbdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(fwd_Vbdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(fwd_Vbdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    /*ОПЦИОН*/

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("ОПЦИОН",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((opc_bdeal_sumG_demand+opc_Vbdeal_sumG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((opc_bdeal_sumSS_1+opc_Vbdeal_sumSS_1)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((opc_bdeal_sumG_liability+opc_Vbdeal_sumG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((opc_bdeal_sumSS_2+opc_Vbdeal_sumSS_2)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(opc_bdeal_count+opc_Vbdeal_count,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(opc_bdeal_contrag+opc_Vbdeal_contrag,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. биржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(opc_bdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(opc_bdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(opc_bdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(opc_bdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(opc_bdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(opc_bdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. внебиржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(opc_Vbdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(opc_Vbdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(opc_Vbdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(opc_Vbdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(opc_Vbdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(opc_Vbdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    /*ПРОЧИЕ*/

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("ПРОЧИЕ",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddPrintCell("",0, 0, head_format);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((other_bdeal_sumG_demand+other_Vbdeal_sumG_demand)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((other_bdeal_sumSS_1+other_Vbdeal_sumSS_1)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round((other_bdeal_sumG_liability+other_Vbdeal_sumG_liability)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round((other_bdeal_sumSS_2+other_Vbdeal_sumSS_2)/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(other_bdeal_count+other_Vbdeal_count,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(other_bdeal_contrag+other_Vbdeal_contrag,0, 0, line_format_c);
    //Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Комментарий",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. биржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(other_bdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(other_bdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(other_bdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(other_bdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(other_bdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(other_bdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Комментарий",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("в т.ч. внебиржевые сделки",0, 0, line_format_l_b);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(other_Vbdeal_sumG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(other_Vbdeal_sumSS_1/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
    Rep.AddPrintCell(string(round(other_Vbdeal_sumG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddPrintCell(string(round(other_Vbdeal_sumSS_2/1000000000,3):a:10:3),0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
    Rep.AddPrintCell(other_Vbdeal_count,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
    Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
    Rep.AddPrintCell(other_Vbdeal_contrag,0, 0, line_format_c);
    Rep.AddStr();

    rn = rn + 1;

    Rep.AddPrintCell("Комментарий",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddPrintCell("",0, 0, line_format_l);
    Rep.AddStr();

    /*ПРОЧИЕ(Ценные бумаги) Chesnokov D.S. 16.05.2019 IM2776836*/
    if (incAvoir)
       rn = rn + 1;

       Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
       Rep.AddPrintCell("ПРОЧИЕ (Ценные бумаги)",0, 0, head_format);
       Rep.AddPrintCell("",0, 0, head_format);
       Rep.AddPrintCell("",0, 0, head_format);
       Rep.AddStr();

       rn = rn + 1;

       Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
       Rep.AddPrintCell(string(round(other_Avr_all_sumVbG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddPrintCell(string(round(other_Avr_all_sum_52601/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
       Rep.AddPrintCell(string(round(other_Avr_all_sumVbG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddPrintCell(string(round(other_Avr_all_sum_52602/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       //Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
       Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
       Rep.AddPrintCell(other_Avr_all_countdealVbG, 0, 0, line_format_c);
       Rep.AddPrintCell(other_Avr_all_countdeal_526, 0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       //Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
       Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
       Rep.AddPrintCell(other_Avr_all_countctgVbG,0, 0, line_format_c);
       Rep.AddPrintCell(other_Avr_all_countctg_526,0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       Rep.AddPrintCell("Комментарий",0, 0, line_format_l);
       Rep.AddPrintCell("", 0, 0, line_format_l);
       Rep.AddPrintCell("", 0, 0, line_format_l);
       Rep.AddStr();

       rn = rn + 1;

       Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
       Rep.AddPrintCell("в т.ч. биржевые сделки",0, 0, line_format_l_b);
       Rep.AddPrintCell("", 0, 0, line_format_l);
       Rep.AddPrintCell("", 0, 0, line_format_l);
       Rep.AddStr();

       rn = rn + 1;
       
       Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
       Rep.AddPrintCell(string(round(other_Avr_market_sumVbG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddPrintCell(string(round(other_Avr_market_sum_52601/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
       Rep.AddPrintCell(string(round(other_Avr_market_sumVbG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddPrintCell(string(round(other_Avr_market_sum_52602/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       //Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
       Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
       Rep.AddPrintCell(other_Avr_market_countdealVbG, 0, 0, line_format_c);
       Rep.AddPrintCell(other_Avr_market_countdeal_526, 0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       //Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
       Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
       Rep.AddPrintCell(other_Avr_market_countctgVbG, 0, 0, line_format_c);
       Rep.AddPrintCell(other_Avr_market_countctg_526, 0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       Rep.AddPrintCell("Комментарий",0, 0, line_format_l);
       Rep.AddPrintCell("",0, 0, line_format_l);
       Rep.AddPrintCell("",0, 0, line_format_l);
       Rep.AddStr();

       rn = rn + 1;

       Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+rn+":C"+rn+"\").Merge;");
       Rep.AddPrintCell("в т.ч. внебиржевые сделки",0, 0, line_format_l_b);
       Rep.AddPrintCell("",0, 0, line_format_l);
       Rep.AddPrintCell("",0, 0, line_format_l);
       Rep.AddStr();

       rn = rn + 1;

       Rep.AddPrintCell("Общая сумма требований (раздел Г)/остаток на счете 52601, млрд руб",0, 0, line_format_l);
       Rep.AddPrintCell(string(round(other_Avr_nomarket_sumVbG_demand/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddPrintCell(string(round(other_Avr_nomarket_sum_52601/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       Rep.AddPrintCell("Общая сумма обязательств (раздел Г)/остаток на счете 52602, млрд руб",0, 0, line_format_l);
       Rep.AddPrintCell(string(round(other_Avr_nomarket_sumVbG_liability/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddPrintCell(string(round(other_Avr_nomarket_sum_52602/1000000000,3):a:10:3),0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       //Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
       Rep.AddPrintCell("Количество сделок",0, 0, line_format_l);
       Rep.AddPrintCell(other_Avr_nomarket_countdealVbG, 0, 0, line_format_c);
       Rep.AddPrintCell(other_Avr_nomarket_countdeal_526, 0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       //Rep.SetExecute("iBook.Sheets("+sheet+").Range(\"B"+rn+":C"+rn+"\").Merge;");
       Rep.AddPrintCell("Количество контрагентов",0, 0, line_format_l);
       Rep.AddPrintCell(other_Avr_nomarket_countctgVbG, 0, null, line_format_c);
       Rep.AddPrintCell(other_Avr_nomarket_countctg_526, 0, 0, line_format_c);
       Rep.AddStr();

       rn = rn + 1;

       Rep.AddPrintCell("Комментарий",0, 0, line_format_l);
       Rep.AddPrintCell("", 0, 0, line_format_l);
       Rep.AddPrintCell("", 0, 0, line_format_l);
       Rep.AddStr();
   end;

    /*Вывод Excel*/
    Rep.PrintWinRep("Сделки ПФИ");
    Rep.SetZoomType(ZOOM_TYPE_A4L); /*альбомная ориентация*/
    Rep.SetWinRepOutput();
    Rep.ShowWinRep();

end;

var repdate = {curdate};
var incAvoir=false;
if (GetDate(repdate, "Сформировать отчет на дату:"))
   if (MsgBoxEx("Включить в отчет данные по ценным бумагам?", MB_YES + MB_NO, IND_NO,"Запрос доп. параметров","") == IND_YES )
      incAvoir=true;  
   end;
   DrawFormPFI1(repdate,incAvoir);
end;
exit(1);