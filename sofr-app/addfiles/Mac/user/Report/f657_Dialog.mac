const kbSpace = 32, kbEnter = 13, kbF2 = 316, kbF3 = 317,  kbESC = 27;
record dlgInput657(f657in, "f657res.lbr") dialog;

/*
  Обработчик событий диалогового окна которое вызывается до запуска отчета
*/
macro event_dlgInput657(dlgInput657, cmd, id, key)
   record dp (dp_dep);
   
   if (cmd==DLG_INIT)
      SetFocus(dlgInput657,0);
      UpdateFields(dlgInput657);
      return CM_IGNORE;
   elif ((cmd == dlg_key) and (key == kbF2))
      return CM_SAVE;
   elif ((cmd == dlg_key) and (key == kbESC))
      return CM_CANCEL;
   elif (cmd == DLG_KEY)
      if ((id == 0) and (key == kbF3))
            dlgInput657(0) = GetDateByCalendar(dlgInput657(0));
            UpdateFields (dlgInput657);
      elif ((id == 1) and (key == kbF3))
         if (ListDepartment (dp))
             dlgInput657(1) = dp.Code;
             UpdateFields (dlgInput657);
         end;
      end;
   elif (cmd == DLG_BUTTON)
      if   (id==2) //Запуск отчета
           return CM_SAVE;
      elif (id==3) //Отмена
           return CM_CANCEL;
      end;
   end;
end;