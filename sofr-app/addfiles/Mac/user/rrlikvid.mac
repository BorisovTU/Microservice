import RsbFormsInter, Global, or_rep_h,"cb_sql.mac";

const v_specval = 26;

private macro iif(a,b,c)
      if(a)
         return b;
      else
         return c;
      end;
   end;




CLASS OfferRep(pDAte)

var Report;
var vDAte   = pDAte;

var rn = 1;
var EXCEL_MONEY = "\"# ##0,00\"";
var sheet = 1,n_sheet = 2;
var count = 0;

var col1_len = 30,  col2_len = 20, col3_len = 20;
var col4_len = 20,  col5_len = 20,  col6_len = 20;
var col7_len = 20,   col8_len = 20, col9_len = 20;
var col10_len = 20,   col11_len = 20, col12_len = 20;
var col13_len = 20,   col14_len = 15, col15_len = 20;
var col16_len = 20;
var col2_sum, col3_sum, col4_sum, col5_sum;
var col6_sum, col7_sum, col8_sum, col9_sum;
var col10_sum, col11_sum, col12_sum, col13_sum;
var col14_sum, col15_sum;

var color  = 12632256;  
var ColorD = 16316664;
var ColorL = 15395562;

var head_format = "ex_FS(b):ex_B(tblr):ex_BC(" + color + ")";
var format      = "ex_FS():ex_B(tblr):ex_BC(" + color + ")";

private macro ДобавитьСтроку()
  Report.AddStr();rn = rn + 1;
end;

private macro ДобавитьПустуюСтроку()
   Report.AddEmptyStr();rn = rn + 1;
end; 

private macro ПечатьШапки ()        

    ДобавитьПустуюСтроку();

    Report.SetExecute("iBook.Sheets("+sheet+").Rows("+rn+").WrapText = false;");
    Report.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+(rn)+":D"+(rn)+"\").merge;");
   
    ДобавитьСтроку();

    Report.SetExecute("iBook.Sheets("+sheet+").Rows("+rn+").WrapText = false;");
    Report.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+(rn)+":D"+(rn)+"\").merge;");
    Report.AddPrintCell("Расчет разрыва ликвидности в агрегированном виде.(тыс. руб. за отчетную дату)", col1_len, null, "r:ex_FS(b):ex_B()");
    ДобавитьСтроку();

    Report.SetExecute("iBook.Sheets("+sheet+").Rows("+rn+").WrapText = false;");
    Report.SetExecute("iBook.Sheets("+sheet+").Range(\"A"+(rn)+":D"+(rn)+"\").merge;");
    Report.AddPrintCell("Дата отчета: " + string(vDate):f, col1_len, null, "l:ex_FS(b):ex_B()");
    ДобавитьСтроку();

    ДобавитьПустуюСтроку();

    rn = rn - 1;    

   // Report.SetExecute("iBook.Sheets("+sheet+").Range(\"F"+(rn)+":G"+(rn)+"\").merge;");
   // Report.SetExecute("iBook.Sheets("+sheet+").Range(\"H"+(rn)+":I"+(rn)+"\").merge;");
  //  Report.SetExecute("iBook.Sheets("+sheet+").Range(\"J"+(rn)+":K"+(rn)+"\").merge;");
  //  Report.SetExecute("iBook.Sheets("+sheet+").Range(\"L"+(rn)+":M"+(rn)+"\").merge;");
  //  Report.SetExecute("iBook.Sheets("+sheet+").Range(\"N"+(rn)+":O"+(rn)+"\").merge;");
    //Report.SetExecute("iBook.Sheets("+sheet+").Range(\"F"+(rn)+":G"+(rn)+"\").merge;");
/*1*/   Report.AddPrintCell ("             ",         col1_len,  null, "c:" + head_format);
/*2*/   Report.AddPrintCell ("До востребования",  col2_len,  null,"c:" + head_format);
/*3*/   Report.AddPrintCell ("1 день",   col3_len,  null,"c:" + head_format);
/*4*/   Report.AddPrintCell ("от 2 до 7 дней",         col4_len,  null, "c:" + head_format);   
/*5*/   Report.AddPrintCell ("от 8 до 30 дней",  col5_len,  null,"c:" + head_format); 
/*6*/   Report.AddPrintCell ("от 31 до 60 дней",   col6_len,  null,"c:" + head_format);      
/*7*/   Report.AddPrintCell ("от 61 до 90 дней",         col7_len,  null, "c:" + head_format);   
/*8*/   Report.AddPrintCell ("от 91 до 180 дней",  col8_len,  null,"c:" + head_format); 
/*9*/   Report.AddPrintCell ("181 дней до 1 года",   col9_len,  null,"c:" + head_format);      
/*10*/   Report.AddPrintCell ("от 1 года до 2 лет",         col10_len,  null, "c:" + head_format);   
/*11*/   Report.AddPrintCell ("от 2 лет до 3 лет",  col11_len,  null,"c:" + head_format); 
/*12*/   Report.AddPrintCell ("от 3 лет до 5 лет",   col12_len,  null,"c:" + head_format);      
/*13*/   Report.AddPrintCell ("от 5 лет до 8 лет",         col13_len,  null, "c:" + head_format);   
/*14*/   Report.AddPrintCell ("Свыше 8 лет",  col14_len,  null,"c:" + head_format); 
/*15*/   Report.AddPrintCell ("Без срока и просрочка",   col15_len,  null,"c:" + head_format);      
/*16*/   Report.AddPrintCell ("Всего",         col16_len,  null, "c:" + head_format);   



    ДобавитьСтроку;  color = colorD; head_format = "c:ex_FZ(8):ex_FS():ex_B(tblr):ex_BC(" + color + ")"; color = colorL;
/*1*/   Report.AddPrintCell ("1      ", col1_len,  null, head_format);
/*2*/   Report.AddPrintCell ("2", col2_len,  null, head_format);
/*3*/   Report.AddPrintCell ("3", col3_len,  null, head_format);
/*4*/   Report.AddPrintCell ("4", col4_len,  null, head_format);
/*5*/   Report.AddPrintCell ("5", col5_len,  null, head_format);
/*6*/   Report.AddPrintCell ("6", col6_len,  null, head_format);
/*7*/   Report.AddPrintCell ("7", col7_len,  null, head_format); 
/*8*/   Report.AddPrintCell ("8", col8_len,  null, head_format); 
/*9*/   Report.AddPrintCell ("9", col9_len,  null, head_format); 
/*10*/   Report.AddPrintCell ("10", col10_len,  null, head_format); 
/*11*/   Report.AddPrintCell ("11", col11_len,  null, head_format); 
/*12*/   Report.AddPrintCell ("12", col12_len,  null, head_format); 
/*13*/   Report.AddPrintCell ("13", col13_len,  null, head_format);
/*14*/   Report.AddPrintCell ("14", col14_len,  null, head_format);
/*15*/   Report.AddPrintCell ("15", col15_len,  null, head_format); 
/*16*/   Report.AddPrintCell ("16", col16_len,  null, head_format); 

    Report.SetExecute("iBook.Sheets("+sheet+").Rows("+(rn)+").AutoFilter;");
    ДобавитьСтроку;
   	Report.AddPrintCell ("Активы",         col1_len,  null, "c:" + head_format);
                       
 	 ДобавитьСтроку;

end;

private macro GetTermName(num)
   var retval = "";

   if (num == 1)
      retval = "До востребования";
   elif (num == 2 )
      retval = "1 день";
   elif (num == 3 )
      retval = "от 2 до 7 дней";
   elif (num == 4 )
      retval = "от 8 до 30 дней";
   elif (num == 5 )
      retval = "от 31 до 60 дней";
   elif (num == 6 )
      retval = "от 61 до 90 дней";
   elif (num == 7 )
      retval = "от 91 до 180 дней";
   elif (num == 8 )
      retval = "от 181 до 1 года";
   elif (num == 9 )
      retval = "от 1 года 2 лет";
   elif (num == 10 )
      retval = "от 2 до 3 лет";
   elif (num == 11)
      retval = "от 3 до 5 лет";
   elif (num == 12 )
      retval = "от 5 до 8 лет";
   elif (num == 13 )
      retval = "Свыше 8 лет";
   elif (num == 14 )
      retval = "Без срока и просрочка";
   end;
   return retval;
end;


private macro ПечатьЗакладки(nSheet,_rs, f1)
   var n_rn = 1;
        report.SetCurSheet(1);
        ДобавитьСтроку;             
        var format_tblr = "ex_FS():ex_B(tblr)";
        var format_tblr_b = "ex_FS(b):ex_B(tblr)";
        var format_n = "ex_FS():ex_B()";
        var format_n_b = "ex_FS(b):ex_B()";
        var weight_double = 61, weight_single = 30;
        while (_rs.movenext())
           if (abs(_rs.Value("rest")) != 0)
             Report.AddPrintCell(f1, null, null, "r:"+format_n);
             Report.AddPrintCell(_rs.Value("t_account"), null, null, "r:"+format_n);
             Report.AddPrintCell(abs(_rs.Value("rest")), null, null, "r:"+format_n);
             Report.AddPrintCell(SQL_ConvTypeDate(_rs.Value("begdate")), null, null, "r:"+format_n);
             Report.AddPrintCell(SQL_ConvTypeDate(_rs.Value("paydate")), null, null, "r:"+format_n);
             Report.AddPrintCell(GetTermName(_rs.Value("term")), null, null, "r:"+format_n);
             Report.AddPrintCell(_rs.Value("t_dealcode"), null, null, "r:"+format_n);
             Report.AddStr();n_rn = n_rn + 1;
           end;
        end;
        report.SetCurSheet(0);
end;


private macro ПечатьБлокаДанных(_rs, name_f, name_s);
    if(valtype(_rs) != v_undef)
    format = "ex_FS():ex_B(tblr)";
    var test;
    var sum_itog  = $0.0;

    //  while(_rs.movenext)
     col2_sum = col3_sum = col4_sum = col5_sum =col6_sum = col7_sum = col8_sum = col9_sum =col10_sum = col11_sum =col12_sum = col13_sum =col14_sum = col15_sum  = $0.0;
    	 ДобавитьСтроку;
     while(_rs.movenext)

         if (_rs.value("term") == 1 )
           col2_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 2 )
           col3_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 3 )
           col4_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 4 )
           col5_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 5 )
           col6_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 6 )
           col7_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 7 )
           col8_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 8 )
           col9_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 9 )
           col10_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 10 )
           col11_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 11 )
           col12_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 12 )
           col13_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 13 )
           col14_sum = abs(_rs.value("rest")*0.001);
         elif (_rs.value("term") == 14 )
           col15_sum = abs(_rs.value("rest")*0.001);
    end;
         sum_itog = sum_itog + abs(_rs.value("rest")*0.001);
      end;
      Report.AddPrintCell (name_f/*"8.Кредиты банкам в т.ч."*/,         col1_len,  null, "c:" + head_format);
      Report.AddPrintCell(col2_sum, col2_len, null, "l:"+format);  
      Report.AddPrintCell(col3_sum, col3_len, null, "l:"+format); 
      Report.AddPrintCell(col4_sum, col4_len, null, "l:"+format); 
      Report.AddPrintCell(col5_sum, col5_len, null, "l:"+format);  
      Report.AddPrintCell(col6_sum, col6_len, null, "l:"+format);  
      Report.AddPrintCell(col7_sum, col7_len, null, "l:"+format);  
      Report.AddPrintCell(col8_sum, col8_len, null, "l:"+format);  
      Report.AddPrintCell(col9_sum, col9_len, null, "l:"+format);  
      Report.AddPrintCell(col10_sum, col10_len, null, "l:"+format);  
      Report.AddPrintCell(col11_sum, col11_len, null, "l:"+format); 
      Report.AddPrintCell(col12_sum, col12_len, null, "l:"+format);  
      Report.AddPrintCell(col13_sum, col13_len, null, "l:"+format);
      Report.AddPrintCell(col14_sum, col14_len, null, "l:"+format);
      Report.AddPrintCell(col15_sum, col15_len, null, "l:"+format);
      Report.AddPrintCell(sum_itog, col16_len, null, "l:"+format);        
      
    //	 ДобавитьСтроку;
    //  	Report.AddPrintCell ("name_s",         col1_len,  null, "c:" + head_format);





      end; 
    end;   
      





macro run()                                       
var SQL, sql_ex, cmd, rs;   

var sql_beg = " select sum (rest) rest, term from (   ";
var sql_end = "   )    group by term ";

                                                  
  Report = CMakeReport("┌┬┬┬┬┬┬┬┬┬┬┬┐");          
  Report.SetDefaultFontName("Times New Roman");   
  Report.SetDefaultFontSize(10);                  
  Report.SetFlagShowGrid(true);                   
                                                  
  ПечатьШапки();    

  report.AddNewSheetBreak( "Расшифровка", "┌─────────────────────────────────────────┬────────────────┬───────────────┬──────────────────┬──────────────┬────────────┬─────────────┬───────┐");

  report.SetDefaultFontName("Times New Roman");                                             
  report.SetDefaultFontSize(10);                                                            
  report.SetFlagShowGrid(false);                                                             
  report.AddPrintCell("Раздел"); 
  report.AddPrintCell("Счет");                                                                 
  report.AddPrintCell("Остаток");                                                                   
  report.AddPrintCell("Дата начала");
  report.AddPrintCell("Дата исполнения");
  report.AddPrintCell("Период");
  report.AddPrintCell("Номер сделки");
//  ДобавитьСтроку;
  report.SetCurSheet(0);                              

    /*"8.Кредиты банкам в т.ч.","Всего активов"*/
 SQL =
/*8.REPO*/
" SELECT 1, d.t_account, t.t_dealcode, l.t_expiry paydate, t.t_dealdate begdate,      "+        
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       CASE                                                                             "+
"    WHEN l.t_expiry - t.t_dealdate = 1 THEN 2                                           "+
"    WHEN l.t_expiry - t.t_dealdate <= 2 THEN 3                                           "+
"          WHEN l.t_expiry - t.t_dealdate <= 7  THEN 3                                    "+
"          WHEN l.t_expiry - t.t_dealdate <= 30 THEN 4                                   "+
"          WHEN l.t_expiry - t.t_dealdate <= 60 THEN 5                                   "+
"          WHEN l.t_expiry - t.t_dealdate <= 90 THEN 6                                    "+
"          WHEN l.t_expiry - t.t_dealdate <= 180 THEN 7                                    "+
"          WHEN l.t_expiry - t.t_dealdate <= 365 THEN 8                                       "+
"          WHEN l.t_expiry - t.t_dealdate <= 730 THEN 9                                       "+
"          WHEN l.t_expiry - t.t_dealdate <= 1095 THEN 10                                     "+
"          WHEN l.t_expiry - t.t_dealdate <= 1825 THEN 11                                     "+
"          WHEN l.t_expiry - t.t_dealdate <=2920  THEN 12                                     "+
"          WHEN l.t_expiry - t.t_dealdate > 2921 THEN 13                                      "+
"          WHEN l.t_expiry - t.t_dealdate < 0 THEN 14                                         "+
"       END                                                                               "+
"          term                                                                            "+
"  FROM ddl_tick_dbt t,                                                                   "+
"       ddl_leg_dbt l,                                                                    "+
"       dmcaccdoc_dbt m,                                                                  "+
"       daccount_dbt d                                                                    "+
" WHERE d.T_account = m.t_account                                                         "+
"       AND d.t_balance IN                                                                 "+
"              ('31903',                                                                  "+
"               '31904',                                                                  "+
"               '31905',                                                                  "+
"               '31906',                                                                  "+
"               '31907',                                                                  "+
"               '31908',                                                                  "+
"               '31909',                                                                  "+
"               '32001',                                                                  "+
"               '32003',                                                                  "+
"               '32004',                                                                  "+
"               '32005',                                                                  "+
"               '32006',                                                                  "+
"               '32007',                                                                  "+
"               '32008',                                                                  "+
"               '32009',                                                                  "+
"               '32101',                                                                  "+
"               '32103',                                                                  "+
"               '32104',                                                                  "+
"               '32105',                                                                  "+
"               '32106',                                                                  "+
"               '32107',                                                                  "+
"               '32108',                                                                  "+
"               '32109',                                                                  "+
"               '32203',                                                                  "+
"               '32204',                                                                  "+
"               '32205',                                                                  "+
"               '32206',                                                                  "+
"               '32207',                                                                  "+
"               '32208',                                                                  "+
"               '32209',                                                                  "+
"               '32303',                                                                  "+
"               '32304',                                                                   "+
"               '32305',                                                                 "+
"               '32306',                                                                 "+
"               '32307',                                                                  "+
"               '32308',                                                                  "+
"               '32309',                                                                  "+
"               '32902')                                                                   "+
"       AND m.t_catnum IN (603)                                                           "+
"       AND m.t_docid = l.t_id                                                            "+
"       AND l.t_legkind = 2                                                               "+
"       AND l.t_dealid = t.t_dealid                                                        "+
"       AND ((l.t_expiry >= " + GetSQLDate(vDate) + ") or (l.t_expiry = to_date('01010001','ddmmyyyy')))           "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                       "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                             "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))   "+

"      union all                                                                          "+
/*1den*/
"   SELECT 1, d.t_account, t.t_dealcode, l.t_expiry, t.t_dealdate,                       "+
"    case when t.t_bofficekind = 4832 then  l.t_totalcost                                 "+
"     else RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                  "+
"                           d.t_code_currency,                                             "+
"                           " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"                           end                                                           "+
"          rest,                                                                          "+
"       CASE                                                                              "+
"         WHEN d.t_balance in ('31901','32010','32110','32201','32301') THEN 1             "+
"          WHEN d.t_balance in ('31902','32002','32102','32202','32302') THEN 2            "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 7 THEN 3                                          "+   
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 30 THEN 4                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 60 THEN 5                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                              "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                              "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <=2920  THEN 12                                              "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " > 2921 THEN 13                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " < 0 THEN 14                                                  "+
"       END                                                                                        "+
"          term                                                                                    "+
"  FROM ddl_tick_dbt t,                                                                            "+
"       ddl_leg_dbt l,                                                                             "+
"       dmcaccdoc_dbt m,                                                                           "+
"       daccount_dbt d                                                                            "+
" WHERE d.T_account = m.t_account                                                                  "+
" and d.T_chapter = m.t_chapter                                                                    "+
" and d.T_code_currency = m.t_currency                                                             "+
"       AND d.t_balance IN                                                                         "+
"             ('31901','32010','32110','32201','32301','31902','32002','32102','32202','32302')    "+
"       AND m.t_docid = t.t_dealid                                                                 "+
"       AND l.t_dealid = t.t_dealid                                                                "+
"       AND ((l.t_expiry >= " + GetSQLDate(vDate) + ") or (l.t_expiry = to_date('01010001','ddmmyyyy')))           "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                              "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))   "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                             "+
/*8.МБК*/
"union all                                                                                                          "+
"(SELECT  1, d.t_account, t.t_dealcode, p.T_valuedate, t.t_dealdate,                                                 "+                                           
"      RSB_FIINSTR.CONVSUM(p.t_amount, m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+                                                           
"       CASE                                                                                                        "+
"                                                                                                                   "+
"         WHEN p.T_valuedate - " + GetSQLDate(vDate) + " = 1 THEN 2                                                 "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                               "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 30 THEN 4                                             "+    
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 60 THEN 5                                              "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 90 THEN 6                                              "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 180 THEN 7                                             "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 365 THEN 8                                             "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 730 THEN 9                                             "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                           "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                           "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <=2920  THEN 12                                           "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " > 2921 THEN 13                                            "+   
"           WHEN p.T_valuedate - " + GetSQLDate(vDate) + " < 0 THEN 14                                              "+   
"       END                                                                                                         "+
"          term                                                                                                     "+
"                                                                                                                   "+
" FROM ddl_tick_dbt t,                                                                                              "+
"       ddl_leg_dbt l,                                                                                               "+
"       dmcaccdoc_dbt m,                                                                                            "+
"       daccount_dbt d ,                                                                                             "+
"       dpmpaym_dbt p                                                                                               "+
"                                                                                                                   "+
"where                                                                                                              "+
"d.T_account = m.t_account                                                                                          "+
" and l.t_dealid = t.t_dealid                                                                                        "+
" and t.t_bofficekind =102                                                                                          "+
"       AND d.t_balance IN                                                                                          "+
"              ('31903',                                                                                            "+
"               '31904',                                                                                            "+
"               '31905',                                                                                            "+
"               '31906',                                                                                            "+
"               '31907',                                                                                            "+
"               '31908',                                                                                            "+
"               '31909',                                                                                            "+
"               '32001',                                                                                            "+
"               '32003',                                                                                            "+
"               '32004',                                                                                            "+
"               '32005',                                                                                            "+
"               '32006',                                                                                            "+
"               '32007',                                                                                            "+
"               '32008',                                                                                            "+
"               '32009',                                                                                            "+
"               '32101',                                                                                            "+
"               '32103',                                                                                            "+
"               '32104',                                                                                            "+
"               '32105',                                                                                            "+
"               '32106',                                                                                            "+
"               '32107',                                                                                             "+
"               '32108',                                                                                             "+
"               '32109',                                                                                             "+
"               '32203',                                                                                            "+
"               '32203',                                                                                            "+
"               '32204',                                                                                            "+
"               '32205',                                                                                            "+
"               '32206',                                                                                            "+
"               '32207',                                                                                           "+
"               '32208',                                                                                           "+
"               '32209',                                                                                            "+
"               '32303',                                                                                            "+
"               '32304',                                                                                            "+
"               '32305',                                                                                            "+
"               '32306',                                                                                            "+
"               '32307',                                                                                            "+
"               '32308',                                                                                            "+
"               '32309',                                                                                            "+
"               '32902')                                                                                            "+
"      AND m.t_catnum IN (601)                                                                                      "+
"       and p.T_valuedate >= " + GetSQLDate(vDate) + "                                                              "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))   "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                             "+ 
"       and  m.t_docid = t.t_dealid                                                                                 "+
"       and  p.t_purpose = 10                                                                                "+
"       and p.T_dockind = t.t_bofficekind                                                                           "+
"       and p.t_documentid = T.T_DEALID)                                                                              ";




/*_________________________________________________________________________________________________________ */
                                                                                                      

    cmd = RSDCommand(sql_beg + SQL + sql_end);
    begaction(100,"Сбор данных...");
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
      ПечатьБлокаДанных(rs, "8.Кредиты банкам в т.ч.");

     cmd = rs = null;
    cmd = RSDCommand(SQL );
    begaction(100,"Сбор данных...");
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
    ПечатьЗакладки(0,rs, "8.Кредиты банкам в т.ч.");


/*"23 Требования по срочным сделкам, в т.ч."*/
     	 ДобавитьСтроку;
     	Report.AddPrintCell ("Всего активов",         col1_len,  null, "c:" + head_format);

sql = 
"SELECT 1, d.t_account, t.t_dealcode, l.t_expiry paydate, t.t_dealdate begdate,                     "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       l.t_expiry - " + GetSQLDate(vDate) + ",                                                                      "+
"       CASE                                                                                       "+
"                                                                                                   "+
"         WHEN l.t_expiry - " + GetSQLDate(vDate) + " = 1 THEN 2                                                     "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <=2920  THEN 12                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                "+
"           WHEN l.t_expiry - " + GetSQLDate(vDate) + " < 0 THEN 14                                                  "+
"       END                                                                                        "+
"          term                                                                                     "+
"  FROM ddl_tick_dbt t,                                                                             "+
"       ddl_leg_dbt l,                                                                              "+
"       dmcaccdoc_dbt m,                                                                            "+
"       daccount_dbt d                                                                              "+
" WHERE d.T_account = m.t_account                                                                    "+
"       AND d.t_balance IN                                                                           "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '94001',                                                                            "+
"               '94002',                                                                            "+
"               '94101',                                                                            "+
"               '94102',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312',                                                                             "+
"               '93401',                                                                            "+
"               '93402',                                                                             "+
"               '93403',                                                                             "+
"               '93404',                                                                             "+
"               '93405',                                                                            "+
"               '93406',                                                                            "+
"               '93407',                                                                            "+
"               '93408',                                                                            "+
"               '93409',                                                                            "+
"               '93410',                                                                            "+
"               '93411',                                                                            "+
"               '93412',                                                                             "+
"               '93501',                                                                            "+
"               '93502',                                                                             "+
"               '93503',                                                                             "+
"               '93504',                                                                             "+
"               '93505',                                                                            "+
"               '93506',                                                                            "+
"               '93507',                                                                            "+
"               '93508',                                                                            "+
"               '93509',                                                                            "+
"               '93510',                                                                            "+
"               '93511',                                                                            "+
"               '93512',                                                                             "+
"               '93601',                                                                            "+
"               '93602',                                                                             "+
"               '93603',                                                                             "+
"               '93604',                                                                             "+
"               '93605',                                                                            "+
"               '93606',                                                                            "+
"               '93607',                                                                            "+
"               '93608',                                                                            "+
"               '93609',                                                                            "+
"               '93610',                                                                            "+
"               '93611',                                                                            "+
"               '93612',                                                                             "+
"               '93701',                                                                            "+
"               '93702',                                                                             "+
"               '93703',                                                                             "+
"               '93704',                                                                             "+
"               '93705',                                                                            "+
"               '93706',                                                                            "+
"               '93707',                                                                            "+
"               '93708',                                                                            "+
"               '93709',                                                                            "+
"               '93710',                                                                            "+
"               '93711',                                                                            "+
"               '93712'                                                                             "+
"             )                                                                                     "+
"       AND m.t_docid = t.t_dealid                                                                   "+
"       AND l.t_dealid = t.t_dealid                                                                  "+
"       AND l.t_expiry >= " + GetSQLDate(vDate) + "                                                                   "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                                 "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))      "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                               "+
/*vnebirj*/
" union all                                                                                                          "+
" (SELECT 1,d.t_account, dd.t_code, dv.t_execdate paydate, dd.t_date begdate,                                                    "+                                          
"      RSB_FIINSTR.CONVSUM(dv.t_amount, ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_execdate - " + GetSQLDate(vDate) + ",                                                                                     "+
"       CASE                                                                                                         "+
"                                                                                                                     "+
"         WHEN dv.t_execdate - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                    "+
"          WHEN dv.t_execdate- " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                    "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                 "+
"           WHEN dv.t_execdate - " + GetSQLDate(vDate) + " < 0 THEN 14                                                                    "+
"       END                                                                                                             "+
"       term                                                                                                            "+
"             FROM ddvndeal_dbt dd,                                                                                     "+
"                  dmcaccdoc_dbt ad,                                                                                      "+
"                  daccount_dbt d,                                                                                         "+
"                  ddvnfi_dbt dv                                                                                             "+
"            WHERE                                                                                                          "+
"                  dd.t_id = DV.T_DEALID                                                                                     "+
"                  and dd.t_kind in ('2715','12690','12695','12710','22710','22720',' 2730','2735', '12730', '12735', '12745', '22745')                                                                     "+
"                  AND ( (dv.t_execdate >= " + GetSQLDate(vDate) + ")                                                  "+
"                      OR (dv.t_execdate  = TO_DATE ('01010001', 'ddmmyyyy')))                                                  "+  
"                  AND dd.t_id = AD.T_docID                                                                                     "+
"                  AND d.T_account = ad.t_account                                                                                "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                       "+
"and  d.t_balance IN                                                                                                      "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '94001',                                                                            "+
"               '94002',                                                                            "+
"               '94101',                                                                            "+
"               '94102',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312',                                                                             "+
"               '93401',                                                                            "+
"               '93402',                                                                             "+
"               '93403',                                                                             "+
"               '93404',                                                                             "+
"               '93405',                                                                            "+
"               '93406',                                                                            "+
"               '93407',                                                                            "+
"               '93408',                                                                            "+
"               '93409',                                                                            "+
"               '93410',                                                                            "+
"               '93411',                                                                            "+
"               '93412',                                                                             "+
"               '93501',                                                                            "+
"               '93502',                                                                             "+
"               '93503',                                                                             "+
"               '93504',                                                                             "+
"               '93505',                                                                            "+
"               '93506',                                                                            "+
"               '93507',                                                                            "+
"               '93508',                                                                            "+
"               '93509',                                                                            "+
"               '93510',                                                                            "+
"               '93511',                                                                            "+
"               '93512',                                                                             "+
"               '93601',                                                                            "+
"               '93602',                                                                             "+
"               '93603',                                                                             "+
"               '93604',                                                                             "+
"               '93605',                                                                            "+
"               '93606',                                                                            "+
"               '93607',                                                                            "+
"               '93608',                                                                            "+
"               '93609',                                                                            "+
"               '93610',                                                                            "+
"               '93611',                                                                            "+
"               '93612',                                                                             "+
"               '93701',                                                                            "+
"               '93702',                                                                             "+
"               '93703',                                                                             "+
"               '93704',                                                                             "+
"               '93705',                                                                            "+
"               '93706',                                                                            "+
"               '93707',                                                                            "+
"               '93708',                                                                            "+
"               '93709',                                                                            "+
"               '93710',                                                                            "+
"               '93711',                                                                            "+
"               '93712'                                                                             "+

"             ))                                                                                                          "+   
/*/*pokypka*/
"	union all                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, dv.t_paydate paydate , dd.t_date begdate ,                                                                      "+                              
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_paydate - " + GetSQLDate(vDate) + ",                                                                      "+   
"       CASE                                                                                                               "+
"                                                                                                                         "+
"         WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                         "+
"          WHEN dv.t_paydate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                         "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                        "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                      "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                      "+
"           WHEN dv.t_paydate  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                          "+
"       END                                                                                                                   "+
"       term                                                                                                                  "+
"             FROM ddvndeal_dbt dd,                                                                                           "+
"                  dmcaccdoc_dbt ad,                                                                                          "+
"                  daccount_dbt d,                                                                                            "+
"                  ddvnfi_dbt dv                                                                                               "+
"            WHERE                                                                                                             "+
"                   dd.t_id = DV.T_DEALID                                                                                      "+
"                  AND dd.t_type = 1                                                                                           "+
"                  AND dd.t_id = AD.T_docID                                                                                    "+
"                  AND d.T_account = ad.t_account                                                                              "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                      "+
"                  AND  dv.t_paydate >= " + GetSQLDate(vDate) + "                                                               "+
"and  d.t_balance IN                                                                                                             "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '94001',                                                                            "+
"               '94002',                                                                            "+
"               '94101',                                                                            "+
"               '94102',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312',                                                                             "+
"               '93401',                                                                            "+
"               '93402',                                                                             "+
"               '93403',                                                                             "+
"               '93404',                                                                             "+
"               '93405',                                                                            "+
"               '93406',                                                                            "+
"               '93407',                                                                            "+
"               '93408',                                                                            "+
"               '93409',                                                                            "+
"               '93410',                                                                            "+
"               '93411',                                                                            "+
"               '93412',                                                                             "+
"               '93501',                                                                            "+
"               '93502',                                                                             "+
"               '93503',                                                                             "+
"               '93504',                                                                             "+
"               '93505',                                                                            "+
"               '93506',                                                                            "+
"               '93507',                                                                            "+
"               '93508',                                                                            "+
"               '93509',                                                                            "+
"               '93510',                                                                            "+
"               '93511',                                                                            "+
"               '93512',                                                                             "+
"               '93601',                                                                            "+
"               '93602',                                                                             "+
"               '93603',                                                                             "+
"               '93604',                                                                             "+
"               '93605',                                                                            "+
"               '93606',                                                                            "+
"               '93607',                                                                            "+
"               '93608',                                                                            "+
"               '93609',                                                                            "+
"               '93610',                                                                            "+
"               '93611',                                                                            "+
"               '93612',                                                                             "+
"               '93701',                                                                            "+
"               '93702',                                                                             "+
"               '93703',                                                                             "+
"               '93704',                                                                             "+
"               '93705',                                                                            "+
"               '93706',                                                                            "+
"               '93707',                                                                            "+
"               '93708',                                                                            "+
"               '93709',                                                                            "+
"               '93710',                                                                            "+
"               '93711',                                                                            "+
"               '93712'                                                                             "+

"             ))                                                                                                                   "+ */
/*/*prodaja*/   
"	union all                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, dv.t_supldate paydate , dd.t_date begdate ,                                                                      "+                              
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_supldate - " + GetSQLDate(vDate) + ",                                                                      "+   
"       CASE                                                                                                               "+
"                                                                                                                         "+
"         WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                         "+
"          WHEN dv.t_supldate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                         "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                        "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                      "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                      "+
"           WHEN dv.t_supldate  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                          "+
"       END                                                                                                                   "+
"       term                                                                                                                  "+
"   FROM ddvndeal_dbt dd,                                                                                                     "+
"                  dmcaccdoc_dbt ad,                                                                                            "+
"                  daccount_dbt d,                                                                                              "+
"                  ddvnfi_dbt dv                                                                                                "+
"            WHERE                                                                                                              "+
"                   dd.t_id = DV.T_DEALID                                                                                       "+
"                  AND dd.t_type = 2                                                                                             "+
"                  AND dd.t_id = AD.T_docID                                                                                      "+
"                  AND d.T_account = ad.t_account                                                                                 "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                       "+                    
"                  AND dv.t_supldate >= " + GetSQLDate(vDate) + "                                                                "+
"and  d.t_balance IN                                                                                                             "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '94001',                                                                            "+
"               '94002',                                                                            "+
"               '94101',                                                                            "+
"               '94102',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312',                                                                             "+
"               '93401',                                                                            "+
"               '93402',                                                                             "+
"               '93403',                                                                             "+
"               '93404',                                                                             "+
"               '93405',                                                                            "+
"               '93406',                                                                            "+
"               '93407',                                                                            "+
"               '93408',                                                                            "+
"               '93409',                                                                            "+
"               '93410',                                                                            "+
"               '93411',                                                                            "+
"               '93412',                                                                             "+
"               '93501',                                                                            "+
"               '93502',                                                                             "+
"               '93503',                                                                             "+
"               '93504',                                                                             "+
"               '93505',                                                                            "+
"               '93506',                                                                            "+
"               '93507',                                                                            "+
"               '93508',                                                                            "+
"               '93509',                                                                            "+
"               '93510',                                                                            "+
"               '93511',                                                                            "+
"               '93512',                                                                             "+
"               '93601',                                                                            "+
"               '93602',                                                                             "+
"               '93603',                                                                             "+
"               '93604',                                                                             "+
"               '93605',                                                                            "+
"               '93606',                                                                            "+
"               '93607',                                                                            "+
"               '93608',                                                                            "+
"               '93609',                                                                            "+
"               '93610',                                                                            "+
"               '93611',                                                                            "+
"               '93612',                                                                             "+
"               '93701',                                                                            "+
"               '93702',                                                                             "+
"               '93703',                                                                             "+
"               '93704',                                                                             "+
"               '93705',                                                                            "+
"               '93706',                                                                            "+
"               '93707',                                                                            "+
"               '93708',                                                                            "+
"               '93709',                                                                            "+
"               '93710',                                                                            "+
"               '93711',                                                                            "+
"               '93712'                                                                             "+

"             ))                                                                                                                   "+ */   
/*birjevii*/
"union all                                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, fi.T_LASTCIRCULATIONDATE paydate , dd.t_date begdate ,                                                                                                                            "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + ",                                                                                        "+
"       CASE                                                                                                                         "+
"                                                                                                                                    "+
"         WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                      "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                     "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                    "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                  "+
"           WHEN   fi.T_LASTCIRCULATIONDATE  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                     "+
"       END                                                                                                                            "+
"       term                                                                                                                           "+
"  FROM ddvdeal_dbt dd,                                                                                                                "+
"                  dmcaccdoc_dbt ad,                                                                                                   "+
"                  daccount_dbt d,                                                                                                     "+
"                  dfideriv_dbt fi                                                                                                     "+
"            WHERE                                                                                                                     "+
"                   dd.t_fiid = FI.T_FIID                                                                                             "+
"                  AND dd.t_id = AD.T_docID                                                                                            "+
"                  AND d.T_account = ad.t_account                                                                                      "+
//"                  and dd.t_kind in ('12610','12615','12620','12625')                                                                  "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                             "+
"                  AND ( (fi.T_LASTCIRCULATIONDATE >=  " + GetSQLDate(vDate) + ")                                                      "+
"                  OR (fi.T_LASTCIRCULATIONDATE  =  " + GetSQLDate(vDate) + "))                                                        "+
"and  d.t_balance IN                                                                                                                   "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '94001',                                                                            "+
"               '94002',                                                                            "+
"               '94101',                                                                            "+
"               '94102',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312',                                                                             "+
"               '93401',                                                                            "+
"               '93402',                                                                             "+
"               '93403',                                                                             "+
"               '93404',                                                                             "+
"               '93405',                                                                            "+
"               '93406',                                                                            "+
"               '93407',                                                                            "+
"               '93408',                                                                            "+
"               '93409',                                                                            "+
"               '93410',                                                                            "+
"               '93411',                                                                            "+
"               '93412',                                                                             "+
"               '93501',                                                                            "+
"               '93502',                                                                             "+
"               '93503',                                                                             "+
"               '93504',                                                                             "+
"               '93505',                                                                            "+
"               '93506',                                                                            "+
"               '93507',                                                                            "+
"               '93508',                                                                            "+
"               '93509',                                                                            "+
"               '93510',                                                                            "+
"               '93511',                                                                            "+
"               '93512',                                                                             "+
"               '93601',                                                                            "+
"               '93602',                                                                             "+
"               '93603',                                                                             "+
"               '93604',                                                                             "+
"               '93605',                                                                            "+
"               '93606',                                                                            "+
"               '93607',                                                                            "+
"               '93608',                                                                            "+
"               '93609',                                                                            "+
"               '93610',                                                                            "+
"               '93611',                                                                            "+
"               '93612',                                                                             "+
"               '93701',                                                                            "+
"               '93702',                                                                             "+
"               '93703',                                                                             "+
"               '93704',                                                                             "+
"               '93705',                                                                            "+
"               '93706',                                                                            "+
"               '93707',                                                                            "+
"               '93708',                                                                            "+
"               '93709',                                                                            "+
"               '93710',                                                                            "+
"               '93711',                                                                            "+
"               '93712'                                                                             "+

"             ))                                                                                                                        ";   


       cmd = rs = null;
    cmd = RSDCommand(sql_beg + SQL + sql_end);
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
      ПечатьБлокаДанных(rs, "23 Требования по срочным сделкам, в т.ч.");

     cmd = rs = null;
    cmd = RSDCommand(SQL );
    begaction(100,"Сбор данных...");
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
    ПечатьЗакладки(0,rs, "23 Требования по срочным сделкам, в т.ч.");

    
/*------*/
  /* "23.1 Требования по поставке денежных средств" */
 SQL ="SELECT 1, d.t_account, t.t_dealcode, l.t_expiry paydate, t.t_dealdate begdate,                     "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       l.t_expiry - " + GetSQLDate(vDate) + ",                                                                      "+
"       CASE                                                                                       "+
"                                                                                                   "+
"         WHEN l.t_expiry - " + GetSQLDate(vDate) + " = 1 THEN 2                                                     "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <=2920  THEN 12                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                "+
"           WHEN l.t_expiry - " + GetSQLDate(vDate) + " < 0 THEN 14                                                  "+
"       END                                                                                        "+
"          term                                                                                     "+
"  FROM ddl_tick_dbt t,                                                                             "+
"       ddl_leg_dbt l,                                                                              "+
"       dmcaccdoc_dbt m,                                                                            "+
"       daccount_dbt d                                                                              "+
" WHERE d.T_account = m.t_account                                                                    "+
"       AND d.t_balance IN                                                                           "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312'                                                                             "+
"             )                                                                                     "+
"       AND m.t_docid = t.t_dealid                                                                   "+
"       AND l.t_dealid = t.t_dealid                                                                  "+
"       AND l.t_expiry >= " + GetSQLDate(vDate) + "                                                                   "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                                 "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))      "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                               "+
/*vnebirjev*/
" union all                                                                                                          "+
" (SELECT 1,d.t_account, dd.t_code, dv.t_execdate paydate, dd.t_date begdate,                                                    "+                                          
"      RSB_FIINSTR.CONVSUM(dv.t_amount, ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_execdate - " + GetSQLDate(vDate) + ",                                                                                     "+
"       CASE                                                                                                         "+
"                                                                                                                     "+
"         WHEN dv.t_execdate - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                    "+
"          WHEN dv.t_execdate- " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                    "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                 "+
"           WHEN dv.t_execdate - " + GetSQLDate(vDate) + " < 0 THEN 14                                                                    "+
"       END                                                                                                             "+
"       term                                                                                                            "+
"             FROM ddvndeal_dbt dd,                                                                                     "+
"                  dmcaccdoc_dbt ad,                                                                                      "+
"                  daccount_dbt d,                                                                                         "+
"                  ddvnfi_dbt dv                                                                                             "+
"            WHERE                                                                                                          "+
"                  dd.t_id = DV.T_DEALID                                                                                     "+
"        and dd.t_kind in ('2715','12690','12695','12710','22710','22720',' 2730','2735', '12730', '12735', '12745', '22745')                                                                   "+
"                  AND ( (dv.t_execdate >= " + GetSQLDate(vDate) + ")                                                  "+
"                      OR (dv.t_execdate  = TO_DATE ('01010001', 'ddmmyyyy')))                                                  "+  
"                  AND dd.t_id = AD.T_docID                                                                                     "+
"                  AND d.T_account = ad.t_account                                                                                "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                       "+
"and  d.t_balance IN                                                                                                      "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312'                                                                             "+

"             ))                                                                                                          "+   
/*/*яЁюъєяър*/
"	union all                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, dv.t_paydate paydate , dd.t_date begdate ,                                                                      "+                              
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_paydate - " + GetSQLDate(vDate) + ",                                                                      "+   
"       CASE                                                                                                               "+
"                                                                                                                         "+
"         WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                         "+
"          WHEN dv.t_paydate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                         "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                        "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                      "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                      "+
"           WHEN dv.t_paydate  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                          "+
"       END                                                                                                                   "+
"       term                                                                                                                  "+
"             FROM ddvndeal_dbt dd,                                                                                           "+
"                  dmcaccdoc_dbt ad,                                                                                          "+
"                  daccount_dbt d,                                                                                            "+
"                  ddvnfi_dbt dv                                                                                               "+
"            WHERE                                                                                                             "+
"                   dd.t_id = DV.T_DEALID                                                                                      "+
"                  AND dd.t_type = 1                                                                                           "+
"                  AND dd.t_id = AD.T_docID                                                                                    "+
"                  AND d.T_account = ad.t_account                                                                              "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                      "+
"                  AND  dv.t_paydate >= " + GetSQLDate(vDate) + "                                                               "+
"and  d.t_balance IN                                                                                                             "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312'                                                                             "+

"             ))                                                                                                                   "+ 
/*яЁюфрцр*/   
"	union all                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, dv.t_supldate paydate , dd.t_date begdate ,                                                                      "+                              
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_supldate - " + GetSQLDate(vDate) + ",                                                                      "+   
"       CASE                                                                                                               "+
"                                                                                                                         "+
"         WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                         "+
"          WHEN dv.t_supldate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                         "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                        "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                      "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                      "+
"           WHEN dv.t_supldate  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                          "+
"       END                                                                                                                   "+
"       term                                                                                                                  "+
"   FROM ddvndeal_dbt dd,                                                                                                     "+
"                  dmcaccdoc_dbt ad,                                                                                            "+
"                  daccount_dbt d,                                                                                              "+
"                  ddvnfi_dbt dv                                                                                                "+
"            WHERE                                                                                                              "+
"                   dd.t_id = DV.T_DEALID                                                                                       "+
"                  AND dd.t_type = 2                                                                                             "+
"                  AND dd.t_id = AD.T_docID                                                                                      "+
"                  AND d.T_account = ad.t_account                                                                                 "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                       "+                    
"                  AND dv.t_supldate >= " + GetSQLDate(vDate) + "                                                                "+
"and  d.t_balance IN                                                                                                             "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312'                                                                             "+

"             ))                                                                                                                   "+ */
/*birjev*/
"union all                                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, fi.T_LASTCIRCULATIONDATE paydate , dd.t_date begdate ,                                                                                                                            "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + ",                                                                                        "+
"       CASE                                                                                                                         "+
"                                                                                                                                    "+
"         WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                      "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                     "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                    "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                  "+
"           WHEN   fi.T_LASTCIRCULATIONDATE  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                     "+
"       END                                                                                                                            "+
"       term                                                                                                                           "+
"  FROM ddvdeal_dbt dd,                                                                                                                "+
"                  dmcaccdoc_dbt ad,                                                                                                   "+
"                  daccount_dbt d,                                                                                                     "+
"                  dfideriv_dbt fi                                                                                                     "+
"            WHERE                                                                                                                     "+
"                   dd.t_fiid = FI.T_FIID                                                                                             "+
"                  AND dd.t_id = AD.T_docID                                                                                            "+
"                  AND d.T_account = ad.t_account                                                                                      "+
//"                  and dd.t_kind in ('12610','12615','12620','12625')                                                                  "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                             "+
"                  AND ( (fi.T_LASTCIRCULATIONDATE >=  " + GetSQLDate(vDate) + ")                                                      "+
"                  OR (fi.T_LASTCIRCULATIONDATE  =  " + GetSQLDate(vDate) + "))                                                        "+
"and  d.t_balance IN                                                                                                                   "+
"              ('93901',                                                                            "+
"               '93902',                                                                            "+
"               '93301',                                                                            "+
"               '93302',                                                                             "+
"               '93303',                                                                             "+
"               '93304',                                                                             "+
"               '93305',                                                                            "+
"               '93306',                                                                            "+
"               '93307',                                                                            "+
"               '93308',                                                                            "+
"               '93309',                                                                            "+
"               '93310',                                                                            "+
"               '93311',                                                                            "+
"               '93312'                                                                             "+

"             ))                                                                                                                        ";   



       cmd = rs = null;
    cmd = RSDCommand(sql_beg + SQL + sql_end);
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
      ПечатьБлокаДанных(rs, "23.1 Требования по поставке денежных средств");

     cmd = rs = null;
    cmd = RSDCommand(SQL );
    begaction(100,"Сбор данных...");
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
    ПечатьЗакладки(0,rs, "23.1 Требования по поставке денежных средств.");

  
/*"23.2 Требования по прочим срочным сделкам"*/

  SQL ="SELECT 1, d.t_account, t.t_dealcode, l.t_expiry paydate, t.t_dealdate begdate,                     "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       l.t_expiry - " + GetSQLDate(vDate) + ",                                                                      "+
"       CASE                                                                                       "+
"                                                                                                   "+
"         WHEN l.t_expiry - " + GetSQLDate(vDate) + " = 1 THEN 2                                                     "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <=2920  THEN 12                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                "+
"           WHEN l.t_expiry - " + GetSQLDate(vDate) + " < 0 THEN 14                                                  "+
"       END                                                                                        "+
"          term                                                                                     "+
"  FROM ddl_tick_dbt t,                                                                             "+
"       ddl_leg_dbt l,                                                                              "+
"       dmcaccdoc_dbt m,                                                                            "+
"       daccount_dbt d                                                                              "+
" WHERE d.T_account = m.t_account                                                                    "+
"       AND d.t_balance IN                                                                           "+   
"              ( '94001',                                                                            "+
"               '94002',                                                                            "+
"               '94101',                                                                            "+
"               '94102',                                                                            "+
"               '93401',                                                                            "+
"               '93402',                                                                             "+
"               '93403',                                                                             "+
"               '93404',                                                                             "+
"               '93405',                                                                            "+
"               '93406',                                                                            "+
"               '93407',                                                                            "+
"               '93408',                                                                            "+
"               '93409',                                                                            "+
"               '93410',                                                                            "+
"               '93411',                                                                            "+
"               '93412',                                                                             "+
"               '93501',                                                                            "+
"               '93502',                                                                             "+
"               '93503',                                                                             "+
"               '93504',                                                                             "+
"               '93505',                                                                            "+
"               '93506',                                                                            "+
"               '93507',                                                                            "+
"               '93508',                                                                            "+
"               '93509',                                                                            "+
"               '93510',                                                                            "+
"               '93511',                                                                            "+
"               '93512',                                                                             "+
"               '93601',                                                                            "+
"               '93602',                                                                             "+
"               '93603',                                                                             "+
"               '93604',                                                                             "+
"               '93605',                                                                            "+
"               '93606',                                                                            "+
"               '93607',                                                                            "+
"               '93608',                                                                            "+
"               '93609',                                                                            "+
"               '93610',                                                                            "+
"               '93611',                                                                            "+
"               '93612',                                                                             "+
"               '93701',                                                                            "+
"               '93702',                                                                             "+
"               '93703',                                                                             "+
"               '93704',                                                                             "+
"               '93705',                                                                            "+
"               '93706',                                                                            "+
"               '93707',                                                                            "+
"               '93708',                                                                            "+
"               '93709',                                                                            "+
"               '93710',                                                                            "+
"               '93711',                                                                            "+
"               '93712'                                                                             "+
"             )                                                                                     "+
"       AND m.t_docid = t.t_dealid                                                                   "+
"       AND l.t_dealid = t.t_dealid                                                                  "+
"       AND l.t_expiry >= " + GetSQLDate(vDate) + "                                                                   "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                                 "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))      "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                               "+
/*vnebirjevii*/
" union all                                                                                                          "+
" (SELECT 1,d.t_account, dd.t_code, dv.t_execdate paydate, dd.t_date begdate,                                                    "+                                          
"      RSB_FIINSTR.CONVSUM (dv.t_amount, ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_execdate - " + GetSQLDate(vDate) + ",                                                                                     "+
"       CASE                                                                                                         "+
"                                                                                                                     "+
"         WHEN dv.t_execdate - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                    "+
"          WHEN dv.t_execdate- " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                    "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                 "+
"           WHEN dv.t_execdate - " + GetSQLDate(vDate) + " < 0 THEN 14                                                                    "+
"       END                                                                                                             "+
"       term                                                                                                            "+
"             FROM ddvndeal_dbt dd,                                                                                     "+
"                  dmcaccdoc_dbt ad,                                                                                      "+
"                  daccount_dbt d,                                                                                         "+
"                  ddvnfi_dbt dv                                                                                             "+
"            WHERE                                                                                                          "+
"                  dd.t_id = DV.T_DEALID                                                                                     "+
"                  and dd.t_kind in ('2715','12690','12695','12710','22710','22720',' 2730','2735', '12730', '12735', '12745', '22745')                                                                     "+
"                  AND ( (dv.t_execdate >= " + GetSQLDate(vDate) + ")                                                  "+
"                      OR (dv.t_execdate  = TO_DATE ('01010001', 'ddmmyyyy')))                                                  "+  
"                  AND dd.t_id = AD.T_docID                                                                                     "+
"                  AND d.T_account = ad.t_account                                                                                "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                       "+
"and  d.t_balance IN                                                                                                      "+
"             ( '94001',                                                                            "+
"               '94002',                                                                            "+
"               '94101',                                                                            "+
"               '94102',                                                                            "+
"               '93401',                                                                            "+
"               '93402',                                                                             "+
"               '93403',                                                                             "+
"               '93404',                                                                             "+
"               '93405',                                                                            "+
"               '93406',                                                                            "+
"               '93407',                                                                            "+
"               '93408',                                                                            "+
"               '93409',                                                                            "+
"               '93410',                                                                            "+
"               '93411',                                                                            "+
"               '93412',                                                                             "+
"               '93501',                                                                            "+
"               '93502',                                                                             "+
"               '93503',                                                                             "+
"               '93504',                                                                             "+
"               '93505',                                                                            "+
"               '93506',                                                                            "+
"               '93507',                                                                            "+
"               '93508',                                                                            "+
"               '93509',                                                                            "+
"               '93510',                                                                            "+
"               '93511',                                                                            "+
"               '93512',                                                                             "+
"               '93601',                                                                            "+
"               '93602',                                                                             "+
"               '93603',                                                                             "+
"               '93604',                                                                             "+
"               '93605',                                                                            "+
"               '93606',                                                                            "+
"               '93607',                                                                            "+
"               '93608',                                                                            "+
"               '93609',                                                                            "+
"               '93610',                                                                            "+
"               '93611',                                                                            "+
"               '93612',                                                                             "+
"               '93701',                                                                            "+
"               '93702',                                                                             "+
"               '93703',                                                                             "+
"               '93704',                                                                             "+
"               '93705',                                                                            "+
"               '93706',                                                                            "+
"               '93707',                                                                            "+
"               '93708',                                                                            "+
"               '93709',                                                                            "+
"               '93710',                                                                            "+
"               '93711',                                                                            "+
"               '93712'                                                                             "+ 
"             ))                                                                                                          "+   
/*/*яЁюъєяър*/
"	union all                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, dv.t_paydate paydate , dd.t_date begdate ,                                                                      "+                              
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_paydate - " + GetSQLDate(vDate) + ",                                                                      "+   
"       CASE                                                                                                               "+
"                                                                                                                         "+
"         WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                         "+
"          WHEN dv.t_paydate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                         "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                        "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                      "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                      "+
"           WHEN dv.t_paydate  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                          "+
"       END                                                                                                                   "+
"       term                                                                                                                  "+
"             FROM ddvndeal_dbt dd,                                                                                           "+
"                  dmcaccdoc_dbt ad,                                                                                          "+
"                  daccount_dbt d,                                                                                            "+
"                  ddvnfi_dbt dv                                                                                               "+
"            WHERE                                                                                                             "+
"                   dd.t_id = DV.T_DEALID                                                                                      "+
"                  AND dd.t_type = 1                                                                                           "+
"                  AND dd.t_id = AD.T_docID                                                                                    "+
"                  AND d.T_account = ad.t_account                                                                              "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                      "+
"                  AND  dv.t_paydate >= " + GetSQLDate(vDate) + "                                                               "+
"and  d.t_balance IN                                                                                                             "+
"             ( '94001',                                                                            "+
"               '94002',                                                                            "+
"               '94101',                                                                            "+
"               '94102',                                                                            "+
"               '93401',                                                                            "+
"               '93402',                                                                             "+
"               '93403',                                                                             "+
"               '93404',                                                                             "+
"               '93405',                                                                            "+
"               '93406',                                                                            "+
"               '93407',                                                                            "+
"               '93408',                                                                            "+
"               '93409',                                                                            "+
"               '93410',                                                                            "+
"               '93411',                                                                            "+
"               '93412',                                                                             "+
"               '93501',                                                                            "+
"               '93502',                                                                             "+
"               '93503',                                                                             "+
"               '93504',                                                                             "+
"               '93505',                                                                            "+
"               '93506',                                                                            "+
"               '93507',                                                                            "+
"               '93508',                                                                            "+
"               '93509',                                                                            "+
"               '93510',                                                                            "+
"               '93511',                                                                            "+
"               '93512',                                                                             "+
"               '93601',                                                                            "+
"               '93602',                                                                             "+
"               '93603',                                                                             "+
"               '93604',                                                                             "+
"               '93605',                                                                            "+
"               '93606',                                                                            "+
"               '93607',                                                                            "+
"               '93608',                                                                            "+
"               '93609',                                                                            "+
"               '93610',                                                                            "+
"               '93611',                                                                            "+
"               '93612',                                                                             "+
"               '93701',                                                                            "+
"               '93702',                                                                             "+
"               '93703',                                                                             "+
"               '93704',                                                                             "+
"               '93705',                                                                            "+
"               '93706',                                                                            "+
"               '93707',                                                                            "+
"               '93708',                                                                            "+
"               '93709',                                                                            "+
"               '93710',                                                                            "+
"               '93711',                                                                            "+
"               '93712'                                                                             "+


"             ))                                                                                                                   "+ */

/*birjevii*/
"union all                                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, fi.T_LASTCIRCULATIONDATE paydate , dd.t_date begdate ,                                                                                                                            "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + ",                                                                                        "+
"       CASE                                                                                                                         "+
"                                                                                                                                    "+
"         WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                      "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                     "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                    "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                  "+
"           WHEN   fi.T_LASTCIRCULATIONDATE  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                     "+
"       END                                                                                                                            "+
"       term                                                                                                                           "+
"  FROM ddvdeal_dbt dd,                                                                                                                "+
"                  dmcaccdoc_dbt ad,                                                                                                   "+
"                  daccount_dbt d,                                                                                                     "+
"                  dfideriv_dbt fi                                                                                                     "+
"            WHERE                                                                                                                     "+
"                   dd.t_fiid = FI.T_FIID                                                                                             "+
"                  AND dd.t_id = AD.T_docID                                                                                            "+
"                  AND d.T_account = ad.t_account                                                                                      "+
//"                  and dd.t_kind in ('12610','12615','12620','12625')                                                                  "+
"                  AND ad.t_catid IN ('163', '210', '460')                                                                             "+
"                  AND ( (fi.T_LASTCIRCULATIONDATE >=  " + GetSQLDate(vDate) + ")                                                      "+
"                  OR (fi.T_LASTCIRCULATIONDATE  =  " + GetSQLDate(vDate) + "))                                                        "+
"and  d.t_balance IN                                                                                                                   "+
"             ( '94001',                                                                            "+
"               '94002',                                                                            "+
"               '94101',                                                                            "+
"               '94102',                                                                            "+
"               '93401',                                                                            "+
"               '93402',                                                                             "+
"               '93403',                                                                             "+
"               '93404',                                                                             "+
"               '93405',                                                                            "+
"               '93406',                                                                            "+
"               '93407',                                                                            "+
"               '93408',                                                                            "+
"               '93409',                                                                            "+
"               '93410',                                                                            "+
"               '93411',                                                                            "+
"               '93412',                                                                             "+
"               '93501',                                                                            "+
"               '93502',                                                                             "+
"               '93503',                                                                             "+
"               '93504',                                                                             "+
"               '93505',                                                                            "+
"               '93506',                                                                            "+
"               '93507',                                                                            "+
"               '93508',                                                                            "+
"               '93509',                                                                            "+
"               '93510',                                                                            "+
"               '93511',                                                                            "+
"               '93512',                                                                             "+
"               '93601',                                                                            "+
"               '93602',                                                                             "+
"               '93603',                                                                             "+
"               '93604',                                                                             "+
"               '93605',                                                                            "+
"               '93606',                                                                            "+
"               '93607',                                                                            "+
"               '93608',                                                                            "+
"               '93609',                                                                            "+
"               '93610',                                                                            "+
"               '93611',                                                                            "+
"               '93612',                                                                             "+
"               '93701',                                                                            "+
"               '93702',                                                                             "+
"               '93703',                                                                             "+
"               '93704',                                                                             "+
"               '93705',                                                                            "+
"               '93706',                                                                            "+
"               '93707',                                                                            "+
"               '93708',                                                                            "+
"               '93709',                                                                            "+
"               '93710',                                                                            "+
"               '93711',                                                                            "+
"               '93712'                                                                             "+
"             ))                                                                                                                        ";   



       cmd = rs = null;
    cmd = RSDCommand(sql_beg + SQL + sql_end);
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
      ПечатьБлокаДанных(rs, "23.2 Требования по прочим срочным сделка");

     cmd = rs = null;
    cmd = RSDCommand(SQL );
    begaction(100,"Сбор данных...");
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
    ПечатьЗакладки(0,rs, "23.2 Требования по прочим срочным сделка");

                                                     
  
           /*"6.Кредиты банков, в т.ч."*/
     	 ДобавитьСтроку;
     	Report.AddPrintCell ("Пассивы",         col1_len,  null, "c:" + head_format);
  /*REPO*/
 SQL ="SELECT 1, d.t_account, t.t_dealcode, l.t_expiry paydate, t.t_dealdate begdate,                     "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       CASE                                                                             "+
"    WHEN l.t_expiry - t.t_dealdate = 1 THEN 2                                           "+
//"    WHEN l.t_expiry - t.t_dealdate <= 2 THEN 3                                           "+
"          WHEN l.t_expiry - t.t_dealdate <= 7  THEN 3                                    "+
"          WHEN l.t_expiry - t.t_dealdate <= 30 THEN 4                                   "+
"          WHEN l.t_expiry - t.t_dealdate <= 60 THEN 5                                   "+
"          WHEN l.t_expiry - t.t_dealdate <= 90 THEN 6                                    "+
"          WHEN l.t_expiry - t.t_dealdate <= 180 THEN 7                                    "+
"          WHEN l.t_expiry - t.t_dealdate <= 365 THEN 8                                       "+
"          WHEN l.t_expiry - t.t_dealdate <= 730 THEN 9                                       "+
"          WHEN l.t_expiry - t.t_dealdate <= 1095 THEN 10                                     "+
"          WHEN l.t_expiry - t.t_dealdate <= 1825 THEN 11                                     "+
"          WHEN l.t_expiry - t.t_dealdate <=2920  THEN 12                                     "+
"          WHEN l.t_expiry - t.t_dealdate > 2921 THEN 13                                      "+
"          WHEN l.t_expiry - t.t_dealdate < 0 THEN 14                                         "+
"       END                                                                               "+
"          term                                                                            "+
"  FROM ddl_tick_dbt t,                                                                   "+
"       ddl_leg_dbt l,                                                                    "+
"       dmcaccdoc_dbt m,                                                                  "+
"       daccount_dbt d                                                                    "+
" WHERE d.T_account = m.t_account                                                         "+
"       AND d.t_balance IN                                                                 "+
"              ('20313',                                                                  "+
"               '20314',                                                                  "+
"               '32901',                                                                  "+
"               '40902',                                                                  "+
"               '31202',                                                                  "+
"               '31203',                                                                  "+
"               '31204',                                                                  "+
"               '31205',                                                                  "+
"               '31206',                                                                  "+
"               '31207',                                                                  "+
"               '31208',                                                                  "+
"               '31209',                                                                  "+
"               '31211',                                                                  "+
"               '31212',                                                                  "+
"               '31215',                                                                  "+
"               '31216',                                                                  "+
"               '31217',                                                                  "+
"               '31218',                                                                  "+
"               '31219',                                                                  "+
"               '31220',                                                                  "+
"               '31221',                                                                  "+
"               '31222',                                                                  "+
"               '31301',                                                                  "+
"               '31303',                                                                  "+
"               '31304',                                                                  "+
"               '31305',                                                                  "+
"               '31306',                                                                  "+
"               '31307',                                                                  "+
"               '31308',                                                                   "+
"               '31309',                                                                 "+
"               '31401',                                                                 "+
"               '31403',                                                                  "+
"               '31404',                                                                  "+
"               '31405',                                                                  "+
"               '31406',                                                                  "+
"               '31407',                                                                  "+
"               '31408',                                                                  "+
"               '31409',                                                                  "+
"               '31502',                                                                  "+
"               '31503',                                                                  "+
"               '31504',                                                                  "+
"               '31505',                                                                  "+
"               '31506',                                                                  "+
"               '31507',                                                                  "+
"               '31508',                                                                  "+
"               '31509',                                                                  "+
"               '31510',                                                                  "+
"               '31603',                                                                  "+
"               '31604',                                                                  "+
"               '31605',                                                                  "+
"               '31606',                                                                  "+
"               '31607',                                                                  "+
"               '31608',                                                                  "+
"               '31609',                                                                  "+
"               '31610')                                                                  "+
"       AND m.t_catnum IN (602)                                                           "+
"       AND m.t_docid = l.t_id                                                            "+
"       AND l.t_legkind = 2                                                               "+
"       AND l.t_dealid = t.t_dealid                                                        "+
"       AND ((l.t_expiry >= " + GetSQLDate(vDate) + ") or (l.t_expiry = to_date('01010001','ddmmyyyy')))           "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                       "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                             "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))   "+
/*1den*/
"      union all                                                                          "+
"   SELECT 1, d.t_account, t.t_dealcode, l.t_expiry, t.t_dealdate,                       "+
"    case when t.t_bofficekind = 4832 then  l.t_totalcost                                 "+
"     else RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                  "+
"                           d.t_code_currency,                                             "+
"                            " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"                           end                                                           "+
"          rest,                                                                          "+
"       CASE                                                                              "+
"         WHEN d.t_balance in ('31210','31213','311310','31410','31501','31601') THEN 1             "+
"          WHEN d.t_balance in ('31201','31214','31302','31402','31602') THEN 2            "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 7 THEN 3                                          "+   
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 30 THEN 4                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 60 THEN 5                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                              "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                              "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <=2920  THEN 12                                              "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " > 2921 THEN 13                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " < 0 THEN 14                                                  "+
"       END                                                                                        "+
"          term                                                                                    "+
"  FROM ddl_tick_dbt t,                                                                            "+
"       ddl_leg_dbt l,                                                                             "+
"       dmcaccdoc_dbt m,                                                                           "+
"       daccount_dbt d                                                                            "+
" WHERE d.T_account = m.t_account                                                                  "+
" and d.T_chapter = m.t_chapter                                                                    "+
" and d.T_code_currency = m.t_currency                                                             "+
"       AND d.t_balance IN                                                                         "+
"    ('31210','31213','311310','31410','31501','31601','31201','31214','31302','31402','31602')    "+
"       AND m.t_docid = t.t_dealid                                                                 "+
"       AND l.t_dealid = t.t_dealid                                                                "+
"       AND ((l.t_expiry >= " + GetSQLDate(vDate) + ") or (l.t_expiry = to_date('01010001','ddmmyyyy')))           "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                              "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))   "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                             "+
/*MBK*/
"union all                                                                                                          "+
"(SELECT  1, d.t_account, t.t_dealcode, p.T_valuedate, t.t_dealdate,                                                 "+                                           
"      RSB_FIINSTR.CONVSUM(p.t_amount, m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
" rest,                                                                                                                                "+
                                            
"       CASE                                                                                                        "+
"                                                                                                                   "+
"         WHEN p.T_valuedate - " + GetSQLDate(vDate) + " = 1 THEN 2                                                 "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                               "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 30 THEN 4                                             "+    
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 60 THEN 5                                              "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 90 THEN 6                                              "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 180 THEN 7                                             "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 365 THEN 8                                             "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 730 THEN 9                                             "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                           "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                           "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <=2920  THEN 12                                           "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " > 2921 THEN 13                                            "+   
"           WHEN p.T_valuedate - " + GetSQLDate(vDate) + " < 0 THEN 14                                              "+   
"       END                                                                                                         "+
"          term                                                                                                     "+
"                                                                                                                   "+
" FROM ddl_tick_dbt t,                                                                                              "+
"       ddl_leg_dbt l,                                                                                               "+
"       dmcaccdoc_dbt m,                                                                                            "+
"       daccount_dbt d ,                                                                                             "+
"       dpmpaym_dbt p                                                                                               "+
"                                                                                                                   "+
"where                                                                                                              "+
"d.T_account = m.t_account                                                                                          "+
" and l.t_dealid = t.t_dealid                                                                                        "+
" and t.t_bofficekind =102                                                                                          "+
"       AND d.t_balance IN                                                                                          "+
"              ('20313',                                                                  "+
"               '20314',                                                                  "+
"               '32901',                                                                  "+
"               '40902',                                                                  "+   
"               '31202',                                                                  "+
"               '31203',                                                                  "+
"               '31204',                                                                  "+
"               '31205',                                                                  "+
"               '31206',                                                                  "+
"               '31207',                                                                  "+
"               '31208',                                                                  "+
"               '31209',                                                                  "+
"               '31211',                                                                  "+
"               '31212',                                                                  "+
"               '31215',                                                                  "+
"               '31216',                                                                  "+
"               '31217',                                                                  "+
"               '31218',                                                                  "+
"               '31219',                                                                  "+
"               '31220',                                                                  "+
"               '31221',                                                                  "+
"               '31222',                                                                  "+
"               '31301',                                                                  "+
"               '31303',                                                                  "+
"               '31304',                                                                  "+
"               '31305',                                                                  "+
"               '31306',                                                                  "+
"               '31307',                                                                  "+
"               '31308',                                                                   "+
"               '31309',                                                                 "+
"               '31401',                                                                 "+
"               '31403',                                                                  "+
"               '31404',                                                                  "+
"               '31405',                                                                  "+
"               '31406',                                                                  "+
"               '31407',                                                                  "+
"               '31408',                                                                  "+
"               '31409',                                                                  "+
"               '31502',                                                                  "+
"               '31503',                                                                  "+
"               '31504',                                                                  "+
"               '31505',                                                                  "+
"               '31506',                                                                  "+
"               '31507',                                                                  "+
"               '31508',                                                                  "+
"               '31509',                                                                  "+
"               '31510',                                                                  "+
"               '31603',                                                                  "+
"               '31604',                                                                  "+
"               '31605',                                                                  "+
"               '31606',                                                                  "+
"               '31607',                                                                  "+
"               '31608',                                                                  "+
"               '31609',                                                                  "+
"               '31610')                                                                  "+
"      AND m.t_catnum IN (601)                                                                                      "+
"       and p.T_valuedate >= " + GetSQLDate(vDate) + "                                                              "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))   "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                             "+ 
"       and  m.t_docid = t.t_dealid                                                                                 "+
"       and  p.t_purpose = 10                                                                                "+
"       and p.T_dockind = t.t_bofficekind                                                                           "+
"       and p.t_documentid = T.T_DEALID)                                                                              ";





       cmd = rs = null;
    cmd = RSDCommand(sql_beg + SQL + sql_end);
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
      ПечатьБлокаДанных(rs, "6.Кредиты банков, в т.ч.");

     cmd = rs = null;
    cmd = RSDCommand(SQL );
    begaction(100,"Сбор данных...");
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
    ПечатьЗакладки(0,rs, "6.Кредиты банков, в т.ч.");

             
/*__________________________________________________________________________*/
  
                                  /*"6.1 Кредиты от Банка России"*/
/*6.1 REPO*/
 SQL ="SELECT 1, d.t_account, t.t_dealcode, l.t_expiry paydate, t.t_dealdate begdate,                     "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                                                               "+
"                           d.t_code_currency,                                                                                         "+
"                            " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
" rest,                                                                                                                                "+
"       CASE                                                                             "+
"    WHEN l.t_expiry - t.t_dealdate = 1 THEN 2                                           "+
//"    WHEN l.t_expiry - t.t_dealdate <= 2 THEN 3                                           "+
"          WHEN l.t_expiry - t.t_dealdate <= 7  THEN 3                                    "+
"          WHEN l.t_expiry - t.t_dealdate <= 30 THEN 4                                   "+
"          WHEN l.t_expiry - t.t_dealdate <= 60 THEN 5                                   "+
"          WHEN l.t_expiry - t.t_dealdate <= 90 THEN 6                                    "+
"          WHEN l.t_expiry - t.t_dealdate <= 180 THEN 7                                    "+
"          WHEN l.t_expiry - t.t_dealdate <= 365 THEN 8                                       "+
"          WHEN l.t_expiry - t.t_dealdate <= 730 THEN 9                                       "+
"          WHEN l.t_expiry - t.t_dealdate <= 1095 THEN 10                                     "+
"          WHEN l.t_expiry - t.t_dealdate <= 1825 THEN 11                                     "+
"          WHEN l.t_expiry - t.t_dealdate <=2920  THEN 12                                     "+
"          WHEN l.t_expiry - t.t_dealdate > 2921 THEN 13                                      "+
"          WHEN l.t_expiry - t.t_dealdate < 0 THEN 14                                         "+
"       END                                                                               "+
"          term                                                                            "+
"  FROM ddl_tick_dbt t,                                                                   "+
"       ddl_leg_dbt l,                                                                    "+
"       dmcaccdoc_dbt m,                                                                  "+
"       daccount_dbt d                                                                    "+
" WHERE d.T_account = m.t_account                                                         "+
"       AND d.t_balance IN                                                                 "+
"              ('31202',                                                                  "+
"               '31203',                                                                  "+
"               '31204',                                                                  "+
"               '31205',                                                                  "+
"               '31206',                                                                  "+
"               '31207',                                                                  "+
"               '31208',                                                                  "+
"               '31209',                                                                  "+
"               '31211',                                                                  "+
"               '31212',                                                                  "+
"               '31215',                                                                  "+
"               '31216',                                                                  "+
"               '31217',                                                                  "+
"               '31218',                                                                  "+
"               '31219',                                                                  "+
"               '31220',                                                                  "+
"               '31221',                                                                  "+
"               '31222')                                                                  "+
"       AND m.t_catnum IN (602)                                                           "+
"       AND m.t_docid = l.t_id                                                            "+
"       AND l.t_legkind = 2                                                               "+
"       AND l.t_dealid = t.t_dealid                                                        "+
"       AND ((l.t_expiry >= " + GetSQLDate(vDate) + ") or (l.t_expiry = to_date('01010001','ddmmyyyy')))           "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                       "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                             "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))   "+
/*6.1/1den*/
"      union all                                                                          "+
"   SELECT 1, d.t_account, t.t_dealcode, l.t_expiry, t.t_dealdate,                       "+
"    case when t.t_bofficekind = 4832 then  l.t_totalcost                                 "+
"     else RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                  "+
"                           d.t_code_currency,                                             "+
"                           " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"                           end                                                           "+
"          rest,                                                                          "+
"       CASE                                                                              "+
"         WHEN d.t_balance in ('31210','31213') THEN 1             "+
"          WHEN d.t_balance in ('31201','31214') THEN 2            "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 7 THEN 3                                          "+   
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 30 THEN 4                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 60 THEN 5                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                              "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                              "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <=2920  THEN 12                                              "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " > 2921 THEN 13                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " < 0 THEN 14                                                  "+
"       END                                                                                        "+
"          term                                                                                    "+
"  FROM ddl_tick_dbt t,                                                                            "+
"       ddl_leg_dbt l,                                                                             "+
"       dmcaccdoc_dbt m,                                                                           "+
"       daccount_dbt d                                                                            "+
" WHERE d.T_account = m.t_account                                                                  "+
" and d.T_chapter = m.t_chapter                                                                    "+
" and d.T_code_currency = m.t_currency                                                             "+
"       AND d.t_balance IN                                                                         "+
"             ('31210','31213','331201','32214')                                                   "+
"       AND m.t_docid = t.t_dealid                                                                 "+
"       AND l.t_dealid = t.t_dealid                                                                "+
"       AND ((l.t_expiry >= " + GetSQLDate(vDate) + ") or (l.t_expiry = to_date('01010001','ddmmyyyy')))           "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                              "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))   "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                             "+
/*MBK*/
"union all                                                                                                          "+
"(SELECT  1, d.t_account, t.t_dealcode, p.T_valuedate, t.t_dealdate,                                                 "+                                           
"      RSB_FIINSTR.CONVSUM(p.t_amount, m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
" rest,                                                                                                                                "+
                                            
"       CASE                                                                                                        "+
"                                                                                                                   "+
"         WHEN p.T_valuedate - " + GetSQLDate(vDate) + " = 1 THEN 2                                                 "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                               "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 30 THEN 4                                             "+    
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 60 THEN 5                                              "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 90 THEN 6                                              "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 180 THEN 7                                             "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 365 THEN 8                                             "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 730 THEN 9                                             "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                           "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                           "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " <=2920  THEN 12                                           "+   
"          WHEN p.T_valuedate - " + GetSQLDate(vDate) + " > 2921 THEN 13                                            "+   
"           WHEN p.T_valuedate - " + GetSQLDate(vDate) + " < 0 THEN 14                                              "+   
"       END                                                                                                         "+
"          term                                                                                                     "+
"                                                                                                                   "+
" FROM ddl_tick_dbt t,                                                                                              "+
"       ddl_leg_dbt l,                                                                                               "+
"       dmcaccdoc_dbt m,                                                                                            "+
"       daccount_dbt d ,                                                                                             "+
"       dpmpaym_dbt p                                                                                               "+
"                                                                                                                   "+
"where                                                                                                              "+
"d.T_account = m.t_account                                                                                          "+
" and l.t_dealid = t.t_dealid                                                                                        "+
" and t.t_bofficekind =102                                                                                          "+
"       AND d.t_balance IN                                                                                          "+
"              ('31202',                                                                  "+
"               '31203',                                                                  "+
"               '31204',                                                                  "+
"               '31205',                                                                  "+
"               '31206',                                                                  "+
"               '31207',                                                                  "+
"               '31208',                                                                  "+
"               '31209',                                                                  "+
"               '31211',                                                                  "+
"               '31212',                                                                  "+
"               '31215',                                                                  "+
"               '31216',                                                                  "+
"               '31217',                                                                  "+
"               '31218',                                                                  "+
"               '31219',                                                                  "+
"               '31220',                                                                  "+
"               '31221',                                                                  "+
"               '31222')                                                                  "+
"      AND m.t_catnum IN (601)                                                                                      "+
"       and p.T_valuedate >= " + GetSQLDate(vDate) + "                                                              "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))   "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                             "+ 
"       and  m.t_docid = t.t_dealid                                                                                 "+
"       and  p.t_purpose = 10                                                                                "+
"       and p.T_dockind = t.t_bofficekind                                                                           "+
"       and p.t_documentid = T.T_DEALID)                                                                              ";
    



        cmd = rs = null;
    cmd = RSDCommand(sql_beg + SQL + sql_end);
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
      ПечатьБлокаДанных(rs, "6.1 Кредиты от Банка России");

     cmd = rs = null;
    cmd = RSDCommand(SQL );
    begaction(100,"Сбор данных...");
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
    ПечатьЗакладки(0,rs, "6.1 Кредиты от Банка России");                          
                                 
   
 /*18 обязательства по срочным сделкам в т.ч.*/
     	 ДобавитьСтроку;
     	Report.AddPrintCell ("Всего пассивов",         col1_len,  null, "c:" + head_format);
        SQL ="SELECT 1, d.t_account, t.t_dealcode, l.t_expiry paydate, t.t_dealdate begdate,                                "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                         "+
"                           d.t_chapter,                                                                             "+
"                          d.t_code_currency,                                                                        "+
"                          " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                   "+
"          rest,                                                                                                     "+
"       l.t_expiry - " + GetSQLDate(vDate) + ",                                                                      "+
"       CASE                                                                                                         "+
"                                                                                                                     "+
"         WHEN l.t_expiry - " + GetSQLDate(vDate) + " = 1 THEN 2                                                     "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <=2920  THEN 12                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                "+
"           WHEN l.t_expiry - " + GetSQLDate(vDate) + " < 0 THEN 14                                                  "+
"       END                                                                                        "+
"          term                                                                                     "+
"  FROM ddl_tick_dbt t,                                                                             "+
"       ddl_leg_dbt l,                                                                              "+
"       dmcaccdoc_dbt m,                                                                            "+
"       daccount_dbt d                                                                              "+
" WHERE d.T_account = m.t_account                                                                    "+
"       AND d.t_balance IN                                                                           "+
"              ('96901',                                                                            "+
"               '96902',                                                                            "+
"               '97001',                                                                            "+
"               '97002',                                                                            "+
"               '97101',                                                                            "+
"               '97102',                                                                            "+
"               '96301',                                                                            "+
"               '96302',                                                                             "+
"               '96303',                                                                             "+
"               '96304',                                                                             "+
"               '96305',                                                                            "+
"               '96306',                                                                            "+
"               '96307',                                                                            "+
"               '96308',                                                                            "+
"               '96309',                                                                            "+
"               '96310',                                                                            "+
"               '96311',                                                                            "+
"               '96312',                                                                             "+
"               '96401',                                                                            "+
"               '96402',                                                                             "+
"               '96403',                                                                             "+
"               '96404',                                                                             "+
"               '96405',                                                                            "+
"               '96406',                                                                            "+
"               '96407',                                                                            "+
"               '96408',                                                                            "+
"               '96409',                                                                            "+
"               '96410',                                                                            "+
"               '96411',                                                                            "+
"               '96412',                                                                             "+
"               '96501',                                                                            "+
"               '96502',                                                                             "+
"               '96503',                                                                             "+
"               '96504',                                                                             "+
"               '96505',                                                                            "+
"               '96506',                                                                            "+
"               '96507',                                                                            "+
"               '96508',                                                                            "+
"               '96509',                                                                            "+
"               '96510',                                                                            "+
"               '96511',                                                                            "+
"               '96512',                                                                             "+
"               '96601',                                                                            "+
"               '96602',                                                                             "+
"               '96603',                                                                             "+
"               '96604',                                                                             "+
"               '96605',                                                                            "+
"               '96606',                                                                            "+
"               '96607',                                                                            "+
"               '96608',                                                                            "+
"               '96609',                                                                            "+
"               '96610',                                                                            "+
"               '96611',                                                                            "+
"               '96612',                                                                             "+
"               '96701',                                                                            "+
"               '96702',                                                                             "+
"               '96703',                                                                             "+
"               '96704',                                                                             "+
"               '96705',                                                                            "+
"               '96706',                                                                            "+
"               '96707',                                                                            "+
"               '96708',                                                                            "+
"               '96709',                                                                            "+
"               '96710',                                                                            "+
"               '96711',                                                                            "+
"               '96712'                                                                             "+
"             )                                                                                     "+
"       AND m.t_docid = t.t_dealid                                                                   "+
"       AND l.t_dealid = t.t_dealid                                                                  "+
"       AND l.t_expiry >= " + GetSQLDate(vDate) + "                                                                   "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                                 "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))      "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                               "+
/*внебирж опц фор*/
" union all                                                                                                          "+
" (SELECT 1,d.t_account, dd.t_code, dv.t_execdate paydate, dd.t_date begdate,                                                    "+                                          
"      RSB_FIINSTR.CONVSUM(dv.t_amount, ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_execdate - " + GetSQLDate(vDate) + ",                                                                                     "+
"       CASE                                                                                                         "+
"                                                                                                                     "+
"         WHEN dv.t_execdate - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                    "+
"          WHEN dv.t_execdate- " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                    "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                 "+
"           WHEN dv.t_execdate - " + GetSQLDate(vDate) + " < 0 THEN 14                                                                    "+
"       END                                                                                                             "+
"       term                                                                                                            "+
"             FROM ddvndeal_dbt dd,                                                                                     "+
"                  dmcaccdoc_dbt ad,                                                                                      "+
"                  daccount_dbt d,                                                                                         "+
"                  ddvnfi_dbt dv                                                                                             "+
"            WHERE                                                                                                          "+
"                  dd.t_id = DV.T_DEALID                                                                                     "+
"                    and dd.t_kind in ('2715','12690','12695','12710','22710','22720',' 2730','2735', '12730', '12735', '12745', '22745')                                                                     "+
"                  AND ( (dv.t_execdate >= " + GetSQLDate(vDate) + ")                                                  "+
"                      OR (dv.t_execdate  = TO_DATE ('01010001', 'ddmmyyyy')))                                                  "+  
"                  AND dd.t_id = AD.T_docID                                                                                     "+
"                  AND d.T_account = ad.t_account                                                                                "+
"                  AND ad.t_catid IN ('164', '211', '461')                                                                       "+
"and  d.t_balance IN                                                                                                      "+
"              ('96901',                                                                            "+
"               '96902',                                                                            "+
"               '97001',                                                                            "+
"               '97002',                                                                            "+
"               '97101',                                                                            "+
"               '97102',                                                                            "+
"               '96301',                                                                            "+
"               '96302',                                                                             "+
"               '96303',                                                                             "+
"               '96304',                                                                             "+
"               '96305',                                                                            "+
"               '96306',                                                                            "+
"               '96307',                                                                            "+
"               '96308',                                                                            "+
"               '96309',                                                                            "+
"               '96310',                                                                            "+
"               '96311',                                                                            "+
"               '96312',                                                                             "+
"               '96401',                                                                            "+
"               '96402',                                                                             "+
"               '96403',                                                                             "+
"               '96404',                                                                             "+
"               '96405',                                                                            "+
"               '96406',                                                                            "+
"               '96407',                                                                            "+
"               '96408',                                                                            "+
"               '96409',                                                                            "+
"               '96410',                                                                            "+
"               '96411',                                                                            "+
"               '96412',                                                                             "+
"               '96501',                                                                            "+
"               '96502',                                                                             "+
"               '96503',                                                                             "+
"               '96504',                                                                             "+
"               '96505',                                                                            "+
"               '96506',                                                                            "+
"               '96507',                                                                            "+
"               '96508',                                                                            "+
"               '96509',                                                                            "+
"               '96510',                                                                            "+
"               '96511',                                                                            "+
"               '96512',                                                                             "+
"               '96601',                                                                            "+
"               '96602',                                                                             "+
"               '96603',                                                                             "+
"               '96604',                                                                             "+
"               '96605',                                                                            "+
"               '96606',                                                                            "+
"               '96607',                                                                            "+
"               '96608',                                                                            "+
"               '96609',                                                                            "+
"               '96610',                                                                            "+
"               '96611',                                                                            "+
"               '96612',                                                                             "+
"               '96701',                                                                            "+
"               '96702',                                                                             "+
"               '96703',                                                                             "+
"               '96704',                                                                             "+
"               '96705',                                                                            "+
"               '96706',                                                                            "+
"               '96707',                                                                            "+
"               '96708',                                                                            "+
"               '96709',                                                                            "+
"               '96710',                                                                            "+
"               '96711',                                                                            "+
"               '96712'                                                                             "+
"             ))                                                                                                          "+   
/*/*прокупка*/
"	union all                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, dv.t_paydate paydate , dd.t_date begdate ,                                                                      "+                              
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_paydate - " + GetSQLDate(vDate) + ",                                                                      "+   
"       CASE                                                                                                               "+
"                                                                                                                         "+
"         WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                         "+
"          WHEN dv.t_paydate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                         "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                        "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                      "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                      "+
"           WHEN dv.t_paydate  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                          "+
"       END                                                                                                                   "+
"       term                                                                                                                  "+
"             FROM ddvndeal_dbt dd,                                                                                           "+
"                  dmcaccdoc_dbt ad,                                                                                          "+
"                  daccount_dbt d,                                                                                            "+
"                  ddvnfi_dbt dv                                                                                               "+
"            WHERE                                                                                                             "+
"                   dd.t_id = DV.T_DEALID                                                                                      "+
"                  AND dd.t_type = 1                                                                                           "+
"                  AND dd.t_id = AD.T_docID                                                                                    "+
"                  AND d.T_account = ad.t_account                                                                              "+
"                  AND ad.t_catid IN ('164', '211', '461')                                                                      "+
"                  AND  dv.t_paydate >= " + GetSQLDate(vDate) + "                                                               "+
"and  d.t_balance IN                                                                                                             "+
"              ('96901',                                                                            "+
"               '96902',                                                                            "+
"               '97001',                                                                            "+
"               '97002',                                                                            "+
"               '97101',                                                                            "+
"               '97102',                                                                            "+
"               '96301',                                                                            "+
"               '96302',                                                                             "+
"               '96303',                                                                             "+
"               '96304',                                                                             "+
"               '96305',                                                                            "+
"               '96306',                                                                            "+
"               '96307',                                                                            "+
"               '96308',                                                                            "+
"               '96309',                                                                            "+
"               '96310',                                                                            "+
"               '96311',                                                                            "+
"               '96312',                                                                             "+
"               '96401',                                                                            "+
"               '96402',                                                                             "+
"               '96403',                                                                             "+
"               '96404',                                                                             "+
"               '96405',                                                                            "+
"               '96406',                                                                            "+
"               '96407',                                                                            "+
"               '96408',                                                                            "+
"               '96409',                                                                            "+
"               '96410',                                                                            "+
"               '96411',                                                                            "+
"               '96412',                                                                             "+
"               '96501',                                                                            "+
"               '96502',                                                                             "+
"               '96503',                                                                             "+
"               '96504',                                                                             "+
"               '96505',                                                                            "+
"               '96506',                                                                            "+
"               '96507',                                                                            "+
"               '96508',                                                                            "+
"               '96509',                                                                            "+
"               '96510',                                                                            "+
"               '96511',                                                                            "+
"               '96512',                                                                             "+
"               '96601',                                                                            "+
"               '96602',                                                                             "+
"               '96603',                                                                             "+
"               '96604',                                                                             "+
"               '96605',                                                                            "+
"               '96606',                                                                            "+
"               '96607',                                                                            "+
"               '96608',                                                                            "+
"               '96609',                                                                            "+
"               '96610',                                                                            "+
"               '96611',                                                                            "+
"               '96612',                                                                             "+
"               '96701',                                                                            "+
"               '96702',                                                                             "+
"               '96703',                                                                             "+
"               '96704',                                                                             "+
"               '96705',                                                                            "+
"               '96706',                                                                            "+
"               '96707',                                                                            "+
"               '96708',                                                                            "+
"               '96709',                                                                            "+
"               '96710',                                                                            "+
"               '96711',                                                                            "+
"               '96712'                                                                             "+
"             ))                                                                                                                   "+ 
 
/*продажа*/   
"	union all                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, dv.t_supldate paydate , dd.t_date begdate ,                                                                      "+                              
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_supldate - " + GetSQLDate(vDate) + ",                                                                      "+   
"       CASE                                                                                                               "+
"                                                                                                                         "+
"         WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                         "+
"          WHEN dv.t_supldate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                         "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                        "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                      "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                      "+
"           WHEN dv.t_supldate  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                          "+
"       END                                                                                                                   "+
"       term                                                                                                                  "+
"   FROM ddvndeal_dbt dd,                                                                                                     "+
"                  dmcaccdoc_dbt ad,                                                                                            "+
"                  daccount_dbt d,                                                                                              "+
"                  ddvnfi_dbt dv                                                                                                "+
"            WHERE                                                                                                              "+
"                   dd.t_id = DV.T_DEALID                                                                                       "+
"                  AND dd.t_type = 2                                                                                             "+
"                  AND dd.t_id = AD.T_docID                                                                                      "+
"                  AND d.T_account = ad.t_account                                                                                 "+
"                  AND ad.t_catid IN ('164', '211', '461')                                                                       "+                    
"                  AND dv.t_supldate >= " + GetSQLDate(vDate) + "                                                                "+
"and  d.t_balance IN                                                                                                             "+
"              ('96901',                                                                            "+
"               '96902',                                                                            "+
"               '97001',                                                                            "+
"               '97002',                                                                            "+
"               '97101',                                                                            "+
"               '97102',                                                                            "+
"               '96301',                                                                            "+
"               '96302',                                                                             "+
"               '96303',                                                                             "+
"               '96304',                                                                             "+
"               '96305',                                                                            "+
"               '96306',                                                                            "+
"               '96307',                                                                            "+
"               '96308',                                                                            "+
"               '96309',                                                                            "+
"               '96310',                                                                            "+
"               '96311',                                                                            "+
"               '96312',                                                                             "+
"               '96401',                                                                            "+
"               '96402',                                                                             "+
"               '96403',                                                                             "+
"               '96404',                                                                             "+
"               '96405',                                                                            "+
"               '96406',                                                                            "+
"               '96407',                                                                            "+
"               '96408',                                                                            "+
"               '96409',                                                                            "+
"               '96410',                                                                            "+
"               '96411',                                                                            "+
"               '96412',                                                                             "+
"               '96501',                                                                            "+
"               '96502',                                                                             "+
"               '96503',                                                                             "+
"               '96504',                                                                             "+
"               '96505',                                                                            "+
"               '96506',                                                                            "+
"               '96507',                                                                            "+
"               '96508',                                                                            "+
"               '96509',                                                                            "+
"               '96510',                                                                            "+
"               '96511',                                                                            "+
"               '96512',                                                                             "+
"               '96601',                                                                            "+
"               '96602',                                                                             "+
"               '96603',                                                                             "+
"               '96604',                                                                             "+
"               '96605',                                                                            "+
"               '96606',                                                                            "+
"               '96607',                                                                            "+
"               '96608',                                                                            "+
"               '96609',                                                                            "+
"               '96610',                                                                            "+
"               '96611',                                                                            "+
"               '96612',                                                                             "+
"               '96701',                                                                            "+
"               '96702',                                                                             "+
"               '96703',                                                                             "+
"               '96704',                                                                             "+
"               '96705',                                                                            "+
"               '96706',                                                                            "+
"               '96707',                                                                            "+
"               '96708',                                                                            "+
"               '96709',                                                                            "+
"               '96710',                                                                            "+
"               '96711',                                                                            "+
"               '96712'                                                                             "+
"             ))                                                                                                                   "+  */
/*биржеыве фо*/
"union all                                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, fi.T_LASTCIRCULATIONDATE paydate , dd.t_date begdate ,                                                                                                                            "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + ",                                                                                        "+
"       CASE                                                                                                                         "+
"                                                                                                                                    "+
"         WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                      "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                     "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                    "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                  "+
"           WHEN   fi.T_LASTCIRCULATIONDATE  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                     "+
"       END                                                                                                                            "+
"       term                                                                                                                           "+
"  FROM ddvdeal_dbt dd,                                                                                                                "+
"                  dmcaccdoc_dbt ad,                                                                                                   "+
"                  daccount_dbt d,                                                                                                     "+
"                  dfideriv_dbt fi                                                                                                     "+
"            WHERE                                                                                                                     "+
"                   dd.t_fiid = FI.T_FIID                                                                                             "+
"                  AND dd.t_id = AD.T_docID                                                                                            "+
"                  AND d.T_account = ad.t_account                                                                                      "+
"                  and dd.t_kind in ('12610','12615','12620','12625')                                                                  "+
"                  AND ad.t_catid IN ('164', '211', '461')                                                                             "+
"                  AND ( (fi.T_LASTCIRCULATIONDATE >=  " + GetSQLDate(vDate) + ")                                                      "+
"                  OR (fi.T_LASTCIRCULATIONDATE  =  " + GetSQLDate(vDate) + "))                                                        "+
"and  d.t_balance IN                                                                                                                   "+
"              ('96901',                                                                            "+
"               '96902',                                                                            "+
"               '97001',                                                                            "+
"               '97002',                                                                            "+
"               '97101',                                                                            "+
"               '97102',                                                                            "+
"               '96301',                                                                            "+
"               '96302',                                                                             "+
"               '96303',                                                                             "+
"               '96304',                                                                             "+
"               '96305',                                                                            "+
"               '96306',                                                                            "+
"               '96307',                                                                            "+
"               '96308',                                                                            "+
"               '96309',                                                                            "+
"               '96310',                                                                            "+
"               '96311',                                                                            "+
"               '96312',                                                                             "+
"               '96401',                                                                            "+
"               '96402',                                                                             "+
"               '96403',                                                                             "+
"               '96404',                                                                             "+
"               '96405',                                                                            "+
"               '96406',                                                                            "+
"               '96407',                                                                            "+
"               '96408',                                                                            "+
"               '96409',                                                                            "+
"               '96410',                                                                            "+
"               '96411',                                                                            "+
"               '96412',                                                                             "+
"               '96501',                                                                            "+
"               '96502',                                                                             "+
"               '96503',                                                                             "+
"               '96504',                                                                             "+
"               '96505',                                                                            "+
"               '96506',                                                                            "+
"               '96507',                                                                            "+
"               '96508',                                                                            "+
"               '96509',                                                                            "+
"               '96510',                                                                            "+
"               '96511',                                                                            "+
"               '96512',                                                                             "+
"               '96601',                                                                            "+
"               '96602',                                                                             "+
"               '96603',                                                                             "+
"               '96604',                                                                             "+
"               '96605',                                                                            "+
"               '96606',                                                                            "+
"               '96607',                                                                            "+
"               '96608',                                                                            "+
"               '96609',                                                                            "+
"               '96610',                                                                            "+
"               '96611',                                                                            "+
"               '96612',                                                                             "+
"               '96701',                                                                            "+
"               '96702',                                                                             "+
"               '96703',                                                                             "+
"               '96704',                                                                             "+
"               '96705',                                                                            "+
"               '96706',                                                                            "+
"               '96707',                                                                            "+
"               '96708',                                                                            "+
"               '96709',                                                                            "+
"               '96710',                                                                            "+
"               '96711',                                                                            "+
"               '96712'                                                                             "+  
"             ))                                                                                                                        ";   
  
   

       cmd = rs = null;
    cmd = RSDCommand(sql_beg + SQL + sql_end);
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
      ПечатьБлокаДанных(rs, "18 Обязательства по срочным сделкам в т.ч.");

     cmd = rs = null;
    cmd = RSDCommand(SQL );
    begaction(100,"Сбор данных...");
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
    ПечатьЗакладки(0,rs, "18 Обязательства по срочным сделкам в т.ч.");      
                                                                                                





 

  /* "18.1 Обязательства по поставке денежных средств" */

 SQL ="SELECT 1, d.t_account, t.t_dealcode, l.t_expiry paydate, t.t_dealdate begdate,                     "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), m.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       l.t_expiry - " + GetSQLDate(vDate) + ",                                                                      "+
"       CASE                                                                                       "+
"                                                                                                   "+
"         WHEN l.t_expiry - " + GetSQLDate(vDate) + " = 1 THEN 2                                                     "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                  "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                 "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " <=2920  THEN 12                                               "+
"          WHEN l.t_expiry - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                "+
"           WHEN l.t_expiry - " + GetSQLDate(vDate) + " < 0 THEN 14                                                  "+
"       END                                                                                        "+
"          term                                                                                     "+
"  FROM ddl_tick_dbt t,                                                                             "+
"       ddl_leg_dbt l,                                                                              "+
"       dmcaccdoc_dbt m,                                                                            "+
"       daccount_dbt d                                                                              "+
" WHERE d.T_account = m.t_account                                                                    "+
"       AND d.t_balance IN                                                                           "+
"              ('96901',                                                                            "+
"               '96902',                                                                            "+
"               '96301',                                                                            "+
"               '96302',                                                                             "+
"               '96303',                                                                             "+
"               '96304',                                                                             "+
"               '96305',                                                                            "+
"               '96306',                                                                            "+
"               '96307',                                                                            "+
"               '96308',                                                                            "+
"               '96309',                                                                            "+
"               '96310',                                                                            "+
"               '96311',                                                                            "+
"               '96312'                                                                             "+
"             )                                                                                     "+
"       AND m.t_docid = t.t_dealid                                                                   "+
"       AND l.t_dealid = t.t_dealid                                                                  "+
"       AND l.t_expiry >= " + GetSQLDate(vDate) + "                                                                   "+
"       AND t.t_dealdate <= " + GetSQLDate(vDate) + "                                                                 "+
"       and ((d.t_close_date >= " + GetSQLDate(vDate) + ") or (d.t_close_date = to_date('01010001','ddmmyyyy')))      "+
"       and d.t_open_date <= " + GetSQLDate(vDate) + "                                                               "+
/*внебирж опц фор*/
" union all                                                                                                          "+
" (SELECT 1,d.t_account, dd.t_code, dv.t_execdate paydate, dd.t_date begdate,                                                    "+                                          
"      RSB_FIINSTR.CONVSUM(dv.t_amount, ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_execdate - " + GetSQLDate(vDate) + ",                                                                                     "+
"       CASE                                                                                                         "+
"                                                                                                                     "+
"         WHEN dv.t_execdate - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                    "+
"          WHEN dv.t_execdate- " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                    "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                  "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                 "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                "+
"          WHEN dv.t_execdate - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                 "+
"           WHEN dv.t_execdate - " + GetSQLDate(vDate) + " < 0 THEN 14                                                                    "+
"       END                                                                                                             "+
"       term                                                                                                            "+
"             FROM ddvndeal_dbt dd,                                                                                     "+
"                  dmcaccdoc_dbt ad,                                                                                      "+
"                  daccount_dbt d,                                                                                         "+
"                  ddvnfi_dbt dv                                                                                             "+
"            WHERE                                                                                                          "+
"                  dd.t_id = DV.T_DEALID                                                                                     "+
"                    and dd.t_kind in ('2715','12690','12695','12710','22710','22720',' 2730','2735', '12730', '12735', '12745', '22745')     "+
"                  AND ( (dv.t_execdate >= " + GetSQLDate(vDate) + ")                                                  "+
"                      OR (dv.t_execdate  = TO_DATE ('01010001', 'ddmmyyyy')))                                                  "+  
"                  AND dd.t_id = AD.T_docID                                                                                     "+
"                  AND d.T_account = ad.t_account                                                                                "+
"                  AND ad.t_catid IN ('164', '211', '461')                                                                       "+
"and  d.t_balance IN                                                                                                      "+
"              ('96901',                                                                                                  "+
"               '96902',                                                                                                  "+
"               '96301',                                                                                                  "+
"               '96302',                                                                                                  "+
"               '96303',                                                                                                  "+
"               '96304',                                                                                                   "+
"               '96305',                                                                                                   "+
"               '96306',                                                                                                   "+
"               '96307',                                                                                                    "+
"               '96308',                                                                                                   "+
"               '96309',                                                                                                   "+
"               '96310',                                                                                                   "+
"               '96311',                                                                                                   "+
"               '96312'                                                                                                    "+
"             ))                                                                                                          "+   
/*/*прокупка*/
"	union all                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, dv.t_paydate paydate , dd.t_date begdate ,                                                                      "+                              
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_paydate - " + GetSQLDate(vDate) + ",                                                                      "+   
"       CASE                                                                                                               "+
"                                                                                                                         "+
"         WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                         "+
"          WHEN dv.t_paydate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                         "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                        "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                      "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                       "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                     "+
"          WHEN dv.t_paydate  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                      "+
"           WHEN dv.t_paydate  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                          "+
"       END                                                                                                                   "+
"       term                                                                                                                  "+
"             FROM ddvndeal_dbt dd,                                                                                           "+
"                  dmcaccdoc_dbt ad,                                                                                          "+
"                  daccount_dbt d,                                                                                            "+
"                  ddvnfi_dbt dv                                                                                               "+
"            WHERE                                                                                                             "+
"                   dd.t_id = DV.T_DEALID                                                                                      "+
"                  AND dd.t_type = 1                                                                                           "+
"                  AND dd.t_id = AD.T_docID                                                                                    "+
"                  AND d.T_account = ad.t_account                                                                              "+
"                  AND ad.t_catid IN ('164', '211', '461')                                                                      "+
"                  AND  dv.t_paydate >= " + GetSQLDate(vDate) + "                                                               "+
"and  d.t_balance IN                                                                                                             "+
"              ('96901',                                                                                                         "+
"               '96902',                                                                                                         "+
"               '96301',                                                                                                          "+
"               '96302',                                                                                                         "+
"               '96303',                                                                                                          "+
"               '96304',                                                                                                          "+
"               '96305',                                                                                                          "+
"               '96306',                                                                                                           "+
"               '96307',                                                                                                           "+
"               '96308',                                                                                                           "+
"               '96309',                                                                                                           "+
"               '96310',                                                                                                          "+
"               '96311',                                                                                                          "+
"               '96312'                                                                                                            "+
"             ))                                                                                                                   "+ 
/*продажа*/   
"	union all                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, dv.t_supldate paydate , dd.t_date begdate ,                                                                      "+                              
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       dv.t_supldate - " + GetSQLDate(vDate) + ",                                                                      "+   
"       CASE                                                                                                               "+
"                                                                                                                         "+
"         WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                         "+
"          WHEN dv.t_supldate - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                         "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                        "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                      "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                       "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                     "+
"          WHEN dv.t_supldate  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                      "+
"           WHEN dv.t_supldate  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                          "+
"       END                                                                                                                   "+
"       term                                                                                                                  "+
"   FROM ddvndeal_dbt dd,                                                                                                     "+
"                  dmcaccdoc_dbt ad,                                                                                            "+
"                  daccount_dbt d,                                                                                              "+
"                  ddvnfi_dbt dv                                                                                                "+
"            WHERE                                                                                                              "+
"                   dd.t_id = DV.T_DEALID                                                                                       "+
"                  AND dd.t_type = 2                                                                                             "+
"                  AND dd.t_id = AD.T_docID                                                                                      "+
"                  AND d.T_account = ad.t_account                                                                                 "+
"                  AND ad.t_catid IN ('164', '211', '461')                                                                       "+                    
"                  AND dv.t_supldate >= " + GetSQLDate(vDate) + "                                                                "+
"and  d.t_balance IN                                                                                                             "+
"              ('96901',                                                                                                         "+
"               '96902',                                                                                                         "+
"               '96301',                                                                                                          "+
"               '96302',                                                                                                         "+
"               '96303',                                                                                                          "+
"               '96304',                                                                                                          "+
"               '96305',                                                                                                          "+
"               '96306',                                                                                                           "+
"               '96307',                                                                                                           "+
"               '96308',                                                                                                           "+
"               '96309',                                                                                                           "+
"               '96310',                                                                                                          "+
"               '96311',                                                                                                          "+
"               '96312'                                                                                                            "+
"             ))                                                                                                                   "+ */
/*биржеыве фо*/
"union all                                                                                                                          "+
"(SELECT 1,d.t_account, dd.t_code, fi.T_LASTCIRCULATIONDATE paydate , dd.t_date begdate ,                                                                                                                            "+
"      RSB_FIINSTR.CONVSUM(rsb_account.restall (d.t_account,                                                                           "+
"                           d.t_chapter,                                                "+
"                          d.t_code_currency,                                          "+
"                          " + GetSQLDate(vDate) + "), ad.t_currency, 0, " + GetSQLDate(vDate) + ")                                   "+
"          rest,                                                                         "+
"       fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + ",                                                                                        "+
"       CASE                                                                                                                         "+
"                                                                                                                                    "+
"         WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " = 1 THEN 2                                                                      "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 7 THEN 3                                                                     "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 30 THEN 4                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 60 THEN 5                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 90 THEN 6                                                                    "+
"          WHEN   fi.T_LASTCIRCULATIONDATE - " + GetSQLDate(vDate) + " <= 180 THEN 7                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 365 THEN 8                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 730 THEN 9                                                                   "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1095 THEN 10                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <= 1825 THEN 11                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " <=2920  THEN 12                                                                 "+
"          WHEN   fi.T_LASTCIRCULATIONDATE  - " + GetSQLDate(vDate) + " > 2921 THEN 13                                                                  "+
"           WHEN   fi.T_LASTCIRCULATIONDATE  -" + GetSQLDate(vDate) + " < 0 THEN 14                                                                     "+
"       END                                                                                                                            "+
"       term                                                                                                                           "+
"  FROM ddvdeal_dbt dd,                                                                                                                "+
"                  dmcaccdoc_dbt ad,                                                                                                   "+
"                  daccount_dbt d,                                                                                                     "+
"                  dfideriv_dbt fi                                                                                                     "+
"            WHERE                                                                                                                     "+
"                   dd.t_fiid = FI.T_FIID                                                                                             "+
"                  AND dd.t_id = AD.T_docID                                                                                            "+
"                  AND d.T_account = ad.t_account                                                                                      "+
"                  and dd.t_kind in ('12610','12615','12620','12625')                                                                  "+
"                  AND ad.t_catid IN ('164', '211', '461')                                                                             "+
"                  AND ( (fi.T_LASTCIRCULATIONDATE >=  " + GetSQLDate(vDate) + ")                                                      "+
"                  OR (fi.T_LASTCIRCULATIONDATE  =  " + GetSQLDate(vDate) + "))                                                        "+
"and  d.t_balance IN                                                                                                                   "+
"              ('96901',                                                                                                                "+
"               '96902',                                                                                                                "+
"               '96301',                                                                                                                "+
"               '96302',                                                                                                                "+
"               '96303',                                                                                                                "+
"               '96304',                                                                                                                 "+
"               '96305',                                                                                                                 "+
"               '96306',                                                                                                                 "+
"               '96307',                                                                                                                "+
"               '96308',                                                                                                                 "+
"               '96309',                                                                                                                "+
"               '96310',                                                                                                                "+
"               '96311',                                                                                                                "+
"               '96312'                                                                                                                 "+
"             ))                                                                                                                        ";   

       cmd = rs = null;
    cmd = RSDCommand(sql_beg + SQL + sql_end);
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
      ПечатьБлокаДанных(rs, "18.1 Обязательства по поставке денежных средств");

     cmd = rs = null;
    cmd = RSDCommand(SQL );
    begaction(100,"Сбор данных...");
    rs = RSDRecordset(cmd, rsdval_client,rsdval_static);
    ПечатьЗакладки(0,rs, "18.1 Обязательства по поставке денежных средств");    
                                                                                                                                   


      Report.PrintWinRep("Расчет разрыва ликвидности.");
      Report.SetWinRepOutput();
      Report.ShowWinRep(); 

end;  

END;


CLASS (TRsbPanel) Pan
    initTRsbPanel();

    const Delta = 50;

    const K_Enter = 13;
    const K_F3    = 317;
    const K_F2    = 316;

    const BeginCalcDate_ID = 1;

    var curstr = 1;
    Caption = "Расчет разрыва ликвидности в агрегированном виде.(тыс. руб. за отчетную дату)";
    Status = "~ESC~Выход ~F2~Выполнить";
    setSize(37,5);
    setPosition(30,10);
    var BeginCalcDate, dx;
    var RuDataFlag = 0;
    var InPortfolioFlag = 1;

    curstr = curstr+1;
    BeginCalcDate = TRsbEditField(V_DATE);
    BeginCalcDate.setPosition(16,curstr);
    BeginCalcDate.setSize(8,1);
    BeginCalcDate.name = "begincalcdate";
    BeginCalcDate.value = {curdate};
    addControl(BeginCalcDate);  

    var m_LabelCD:TrsbLabel = TRsbLabel(2,curstr,"Дата отчета:");
     addLabel (m_LabelCD);

     addEventHandler(RSB_EV_KEY_PRESSED, R2M(this, "onKeyPressed"));
    
    macro onKeyPressed(ev)
        if (ev.KeyCode == K_F3)
           if (ev.id == BeginCalcDate_ID)
            BeginCalcDate.value = GetDateByCalendar({CurDate});
            this.redraw; 
           end;
        elif (ev.KeyCode == K_Enter)
            update;
           //EndCalcDate.value = BeginCalcDate.value + Delta;
             redraw; 
        elif(ev.keyCode == K_F2)
                
          var myRep = OfferRep(BeginCalcDate.value);
           myRep.run;
        end;
    end; 
END;

var myPanel:TRsbPanel = Pan;
myPanel.run;
end;
exit(1);
