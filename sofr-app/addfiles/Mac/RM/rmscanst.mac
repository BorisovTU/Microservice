 /*
 $Name:        rmscanst.mac
 $Module:      Арм позиционера
 $Description: Печать отчета сканирования 
               скроллингов входящих платежей на шагах операции
 */

/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.1                                          R-Style Software Lab

  File Name   : rmscanst.mac
  Created     : 11.01.12
  Description : Печать отчета сканирования 
                скроллингов входящих платежей на шагах операции
└───────────────────────────────────────────────────────────────────────────*/
import PaymInter, "d_inter.mac";

RECORD oprstep_rec( oprstep );

MACRO Печать_ОтчетСканирования( Вызов, rec_step, Статус, Сообщение )

  file oproper    ( oproper  );
  var ЗаголовокОтчета = "Отчет о групповом выполнении шагов операций.";
  var УспСообщение = "Шаг выполнен успешно";
  var PaymentId:integer = 0;
  setbuff( oprstep_rec, rec_step );
  oproper.ID_Operation = oprstep_rec.ID_Operation;


  if( Статус == 0 )
    if( PM_GetRejectProcessKind(false) == PM_REJECT_PROCKIND_FINISH )
        Сообщение = Сообщение + " Обработка поручения на списание завершена без формирования инкассового поручения или подтверждения для ФНС";
    end;
  end;  
  
  if( GetEQ(oproper) )
    PaymentId = int(oproper.DocumentId);
  end;       
  ПечатьПолногоОтчетаДляДокумента (Вызов,Статус,Сообщение,УспСообщение,ЗаголовокОтчета,PaymentId);
END;
