/****************************************************************************/
/*                    Проводка по корсчету ответного                        */
/*                                                                          */
/* Выполняется контроль платежа                                             */
/****************************************************************************/

import PaymInter, PTInter, "rmtools.mac", "cbsttls.mac";

var PaymentObj:RsbPayment;

macro ПроверитьПоля_RМакета()
  /* Основание платежа */
  if(not CheckTranspCharSet(PaymentObj.OutTransport, PaymentObj.Ground) )
    msgbox("Недопустимые символы в основании платежа");
    return false;
  end;
  /* Банк плательщик платежа */
  if(not CheckTranspCharSet(PaymentObj.OutTransport, PaymentObj.PayerBankName) )
    msgbox("Недопустимые символы в наименовании банка плательщика");
    return false;
  end;
  /* Банк получатель платежа */
  if(not CheckTranspCharSet(PaymentObj.OutTransport, PaymentObj.ReceiverBankName) )
    msgbox("Недопустимые символы в наименовании банка получателя");
    return false;
  end;
  /* Плательщик платежа */
  if(not CheckTranspCharSet(PaymentObj.OutTransport, PaymentObj.PayerName) )
    msgbox("Недопустимые символы в наименовании плательщика");
    return false;
  end;
  /* Получатель платежа */
  if(not CheckTranspCharSet(PaymentObj.OutTransport, PaymentObj.ReceiverName) )
    msgbox("Недопустимые символы в наименовании получателя");
    return false;
  end;
  /* Информация участнику */
  if(not CheckTranspCharSet(PaymentObj.OutTransport, PaymentObj.PartyInfo) )
    msgbox("Недопустимые символы в информации участнику");
    return false;
  end;
  return true;
end;

macro ExecuteStep( doc, first, KindDoc )
  var DKFlag = "", FlagTrans = 0, stat, TransferDate; 


  if ( PaymentObj.IsCredit() )
     DKFlag = FL_KREDIT;
  else 
     DKFlag = FL_DEBET;
  end;

  FlagTrans = PaymentObj.IsTransit();

  /* Реквизиты платежа */   
  if( not ПроверитьПоля_RМакета() )
    msgbox("Ошибка в свойствах платежа, характерных для R-макет");
    return 1;
  end;    

  /* Проверяем и меняем ДПП */
  if ( PaymentObj.CorrectOutDPP(false) )
     msgbox("Неверное значение ДПП");
     return 1;
  end;

  PaymentObj.PropStatus = PM_PROP_CONTROL;

  return УстановитьСтатусыПлатежа(OPR_PAYM_DO, OPR_PM_ST_DISCHARGE);
end;
