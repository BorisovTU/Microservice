/*
 $Name:        u_rmgroup.mac
 $Module:      АРМ позиционера
 $Description: Отчет о групповой обработке платежей
*/

import RSD, "d_inter.mac";

MACRO Печать_ОтчетСканирования()
  var i;

  array StringArray;

  var rs : RsdRecordset;
  var numAll = 0, numError = 0, PaymentID = 0, state = 0;
  var Сообщение,                                     
      ЗаголовокОтчета = "Отчет о групповой обработке", 
      СообщениеОбУспешномВыполнении = "Документ успешно обработан";
  var Вызов = Первый;
  var УспСообщение = "";

  rs = RsdRecordset( " select t_PaymentID, t_Message, t_ErrorStatus from dpmoprlog_tmp order by t_LogID asc " );
  
  ПечатьПолногоОтчетаДляДокумента (Вызов,0,Сообщение,УспСообщение,ЗаголовокОтчета,0);    

  Вызов = Ошибка;
  
  while( rs.moveNext() )
    state = rs.value("t_ErrorStatus");
    if( state == 0 )
      Сообщение = СообщениеОбУспешномВыполнении;
    else
      Сообщение = rs.value("t_Message");
    end;
    PaymentID = rs.value("t_PaymentID");

    ПечатьПолногоОтчетаДляДокумента (Вызов,state,Сообщение,УспСообщение,ЗаголовокОтчета,PaymentID);    
    
  end;
  Вызов = Последний;
  ПечатьПолногоОтчетаДляДокумента (Вызов,0,Сообщение,УспСообщение,ЗаголовокОтчета,0);    
  return 0;
END;