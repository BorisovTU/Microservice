/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank v6.0                     */
/****************************************************************************/
/*                      Подсистема "АРМ-Позиционера"                        */
/*                              Контроль                                    */
/*                                                                          */
/*  Имя файла: rm_mod1085.mac                                               */
/*  Создан:    24.05.06                                Желнов Ю.Н.          */
/*  Макрос создания запроса выборки платежей, по которым будут создаваться  */
/*  операции                                                                */
/*  Используется в модуле 1085                                              */
/****************************************************************************/

const  PM_PROP_LOADED       =  300;  /*Загружен (сформирован ответный по сообщению) */


macro СоздатьЗапрос ( Corschem , KindOper , FIID )
 var sql:string;
 /* Основной запрос */
 sql = "SELECT prop.t_PaymentID   , prop.t_DebetCredit "+
       "FROM   dpmpaym_dbt paym   , dpmprop_dbt prop   "+
       "WHERE  prop.t_PaymentID   = paym.t_PaymentID   "+
       "AND    prop.t_IsSender    = 'X'                "+
        string ("AND    prop.t_PropStatus  =      " ,PM_PROP_LOADED );
 /* Дополнительные условия */
 if ( Corschem>=0 )
   sql = sql + string ( "AND prop.t_Corschem = ", Corschem, " ");
       if ( FIID >=0 )
       sql = sql + string ( "AND prop.t_PayFIID = ",  FIID, " ");
       end;
 end;
 if (KindOper >= 0)
   sql = sql + string ("AND paym.t_KindOperation = ", KindOper, " " );
 end;

 /* !!!Сортировка. Для изменения порядка сортировки создания операция, добавлять новые условия ниже */
 sql = sql + string ( "ORDER BY prop.t_PaymentID ASC ");/*<< Сортировка по PaymentID, времени поступления*/
 /*  Для отладки, запишет в файл SQL запрос */
 /* println (sql);*/

 /* Вернем созданный запрос  */
return sql;
end;

