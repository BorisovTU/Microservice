/*  Функция создания запроса выборки платежей, по которым будут создаваться  */
/*  операции                                                                 */
/*  Используется в модуле 2080                                               */

import PaymInter;                                     

macro СоздатьЗапрос( Corschem , FIID , KindOper)
 var sql:string;
 /* Основной запрос */
 sql = "SELECT prop.t_PaymentID   , prop.t_DebetCredit "+
       "FROM   dpmpaym_dbt paym   , dpmprop_dbt prop   "+
       "WHERE  prop.t_PaymentID   = paym.t_PaymentID   "+
       "AND    prop.t_IsSender    = chr(0)             "+
        string (" AND    prop.t_PropStatus  =  " ,PM_PROP_READY )+
        string (" AND paym.t_PaymStatus = " , PM_READY_TO_SEND );
 /* Дополнительные условия */
 if ( Corschem>=0 )
   sql = sql + string ( " AND prop.t_Corschem = ", Corschem, " ");
       if ( FIID >=0 )
       sql = sql + string ( " AND prop.t_PayFIID = ",  FIID, " ");
       end;
 end;
 if (KindOper >= 0)
   sql = sql + string (" AND paym.t_KindOperation = ", KindOper, " " );
 end;

 /* !!!Сортировка. Для изменения порядка сортировки создания операция, добавлять новые условия ниже */
 sql = sql + string ( " ORDER BY prop.t_PaymentID ASC ");/*<< Сортировка по PaymentID, времени поступления*/
 /*  Для отладки, запишет в файл SQL запрос */
 /* println (sql);*/

 /* Вернем созданный запрос  */
 return sql;
end;