/*
   Отчет о массовом определении бэк-офиса
*/

import u_rmtls;

const СообщениеОНеопределенномБэкОфисе = "Бэк-офис не определен";

macro Печать_ОтчетСканирования (Вызов,firstdoc,Статус,Сообщение)
   RECORD pmpaymbuf( pmpaym ) ;


   if ( (Вызов==Ошибка) AND (Статус==0) )
      setbuff (step, firstdoc);
      oper.ID_Operation = step.ID_Operation;
      if(not getEQ(oper))
         return;
      end;
      RestoreFromUniID(oper.DocumentID, pmpaymbuf, 0, oper.DocKind);
      if( not FindPayment( pmpaymbuf.PaymentID, /* Индентификатор */
                        0,                  /* Purpose    */
                        0,                  /* SubPurpose */
                        0,                  /* DocKind    */
                        0,                  /* DocId      */
                        true,               /* искать в реальной базе */
                        pmpaymbuf,          /* буфер платежа            */
                        null,               /* буфер дебетовых свойств  */
                        null,               /* буфер кредитовых свойств */
                        null                /* свойства R-макета */
                      ))
         if ( pmpaymbuf.ToBackOffice=="" )
            Статус = "";
            Сообщение = СообщениеОНеопределенномБэкОфисе;
         end;
      end;
   end;

   PaymReportFromOper (
                 Вызов,
                 firstdoc,
                 Статус,
                 Сообщение,
                 "Отчет о массовом определении бэк-офиса",
                 "Определение бэк-офиса выполнено успешно",
                 ПечататьСообщениеОбУспешномВыполнении
              );
end;
