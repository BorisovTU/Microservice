/* Лоскутов А.А.
29.01.2003 г
Макрос написан для печати номеров валютных справок в ф.24 по требованию ревизоров 
10.10.2003 г. KIN дописанана печать ведущих нулей в валютной справке 
*/

MACRO Find_Cas_Doc(sbdepdoc,RefValue); /*возвращает строку с номером справки*/

    /* sbdepdoc - заполненная структура SBDEPDOC.DBT
       RefValue - Referenc ресурса кассы */
  

    file SB_CASDC ("sb_casdc.dbt","sbbank.def");
        
    var STRNumBSO = "",
        temp      = FALSE;

    ClearRecord( SB_CASDC    );
    KeyNum     ( SB_CASDC, 7 ); /* по ApplicationKey*/
    Rewind     ( SB_CASDC    );

    SB_CASDC.RefValue        = RefValue; 
    SB_CASDC.ApplicationKind = SBDEPDOC.iApplicationKind;
    SB_CASDC.ApplicationKey  = SBDEPDOC.ApplicationKey;
    temp = GetEQ(SB_CASDC);

    if (temp)
      /*нашли*/

      if (SB_CASDC.MinRegistrNumber == SB_CASDC.MaxRegistrNumber)
/*         
        STRNumBSO = string(SB_CASDC.MinRegistrNumber);
        while (StrLen(STRNumBSO) < 7)
          STRNumBSO = "0" + STRNumBSO;
        end;
        STRNumBSO = string(SB_CASDC.Series) + " " + STRNumBSO;
*/      
        STRNumBSO = RegNumToStr(SB_CASDC.Series, SB_CASDC.MinRegistrNumber);
      else;
        /*при инкассациях*/
      end;
    else
      /*не нашли*/
      /*msgBox("Нет кассового документа по данной операции");*/
    end;

    Return STRNumBSO;
END;