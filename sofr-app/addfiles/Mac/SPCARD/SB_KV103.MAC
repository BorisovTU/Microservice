/********************************************************
*  ---------------------                                *
*  R-Style SoftWare Lab.                                *
*  ---------------------                                *
*  RS-Retail                                            *
*  ¬¨â¥­â                                              *
*                                                       *
*  ”®à¬¨à®¢ ­¨¥ ª¢ àâ «ì­®© ä®à¬ë 10.3                  *
*  "ˆ­ä®à¬ æ¨ï ® ¤®å®¤ å ¨ à áå®¤ å ®â ¨á¯®«ì§®¢ ­¨ï    *
*   ¯« áâ¨ª®¢ëå ª àâ®ç¥ª"                               *
*                                                       *
*  ‹¥¡¥¤¥¢ ‘.‚.                                         *
*  15.10.97                                             *
********************************************************/

import BankInter,deprintr,"rc_rep.mac";

file account (scAcc ,"spcard.def"); /* Š àâ®ç­ë¥ áç¥â        */
file card    (scCard,"spcard.def"); /* « áâ¨ª®¢ë¥ ª àâ®çª¨  */
file link    (scLink,"spcard.def"); /* ‘¢ï§¨ Š àâ®çª -‘ç¥â   */
file auth    (scAuth,"spcard.def"); /* ’à ­§ ªæ¨¨            */
file scPos   (scPos, "spcard.def"); /* « â¥¦­ë¥ á¨áâ¥¬ë     */

/*  ­¥«ì ¤«ï ¢¢®¤  ¨áå®¤­ëå ¤ ­­ëå */
record InputPanel (sc_prd) dialog;
/* ®¬¥à ¯®«¥© ¤¨ «®£  */
const ne_BeginDate = 0;
const ne_EndDate   = 1;

var {curdate}; /* ’¥ªãé ï ¤ â  */


/*************************************************************************
			     ˜ ¯ª  ®âç¥â 
*************************************************************************/
macro HeadReport

  var str;
  var d,m,y;

  DateSplit(InputPanel.EndDate,d,m,y);

  str = "                                                                                                        à¨«®¦¥­¨¥ N 10.3";
  [#](str);
  str = " Š¥¬ ¯à¥¤áâ ¢«ï¥âáï:  ____________________________________";
  [#](str);
  str = "                                  (®â¤¥«¥­¨¥)";
  [#](str);
  str = " ";
  [#](str);
  str = " Š®¬ã ¯à¥¤áâ ¢«ï¥âáï: “¯à ¢«¥­¨¥  ¢â®¬ â¨ª¨ ¨  ¢â®¬ â¨§ æ¨¨";
  [#](str);
  str = " ";
  [#](str);
  str = " ˆá¯®«­¨â¥«ì:         ____________________________________                            ª¢ àâ «ì­ ï";
  [#](str);
  str = "                                   (”.ˆ.Ž.,â¥«.)                               ¯à¥¤áâ ¢«ï¥âáï ­  5 à ¡®ç¨©";
  [#](str);
  str = "                                                                       ¤¥­ì ¬¥áïæ , á«¥¤ãîé¥£® §  ®âç¥â­ë¬ ¯¥à¨®¤®¬";
  [#](str);
  str = " ";
  [#](str);
  str = "                                ˆ­ä®à¬ æ¨ï ® ¤®å®¤ å ¨ à áå®¤ å ®â ¨á¯®«ì§®¢ ­¨ï ¯« áâ¨ª®¢ëå ª àâ®ç¥ª";
  [#](str);
  str = "                                                    §  ";
  if ((m >= 1) AND (m <= 3))
    str = str + "I";
  elif ((m > 3) AND (m <= 6))
    str = str + "II";
  elif ((m > 6) AND (m <= 9))
    str = str + "III";
  else
    str = str + "IV";
  end;
  str = str + " ª¢ àâ « ";
  str = str + String(y);
  str = str + " £.";
  [#](str);
  str = " ";
  [#](str);
  str = " ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿";
  [#](str);
  str = " ³                 ³                                „®å®¤ë                               ³            áå®¤ë            ³";
  [#](str);
  str = " ³                 ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´";
  [#](str);
  str = " ³    « â¥¦­ë¥    ³               ³                     ‚ â®¬ ç¨á«¥                     ³             ³   ‚ë¯« â  %    ³";
  [#](str);
  str = " ³     á¨áâ¥¬ë     ³     ‚á¥£®     ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´    ‚á¥£®    ³ ¯® ®áâ âª ¬ ­  ³";
  [#](str);
  str = " ³                 ³               ³ ®â à¥ «¨§ æ¨¨ ³  ª®¬¨áá¨®­­ë¥ ®â  ³ ª®¬¨áá¨®­­ë¥ ®â ³             ³ª àâ®ç­ëå áç¥â å³";
  [#](str);
  str = " ³                 ³               ³    ª àâ®ç¥ª   ³   ®¡á«ã¦¨¢ ­¨ï    ³  ®¡á«ã¦¨¢ ­¨ï   ³             ³  ¨ § «®£®¢ë¬   ³";
  [#](str);
  str = " ³                 ³               ³               ³¤¥à¦ â¥«¥© ª àâ®ç¥ª³    ¬ £ §¨­®¢    ³             ³   ¤¥¯®§¨â ¬    ³";
  [#](str);
  str = " ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´";
  [#](str);

end;


/*************************************************************************
			   Žª®­ç ­¨¥ ®âç¥â 
*************************************************************************/
macro BottomReport

  var str;
  var d,m,y;

  DateSplit(InputPanel.EndDate,d,m,y);

  str = " ";
  [#](str);
  str = "  ƒ« ¢­ë© ¡ãå£ «â¥à Ž‘";
  [#](str);
  str = " ";
  [#](str);
  str = "  \"___\" _____________ ";
  if (m > 10)
    y = y + 1;
  end;
  str = str + String(y);
  str = str + " £.";
  [#](str);

end;


/*************************************************************************
			    ‚ë¢®¤ áâà®ª ®âç¥â 
*************************************************************************/
macro DoReport

  var str;
  var TotalD = $0L, /* „®å®¤ë - ‚á¥£®                            */
      CardD  = $0L, /* „®å®¤ë ®â à¥ «¨§ æ¨¨ ª àâ®ç¥ª             */
      ComClD = $0L, /* Š®¬¨áá¨®­­ë¥ ®â ®¡á«ã¦¨¢ ­¨ï ¤¥à¦ â¥«¥©   */
      ComShD = $0L, /* Š®¬¨áá¨®­­ë¥ ®â ®¡á«ã¦¨¢ ­¨ï ¬ £ §¨­®¢    */
      TotalR = $0L, /*  áå®¤ë - ‚á¥£®                           */
      PercR  = $0L; /* ‚ë¯« â  % ¯® ®áâ âª ¬ ­  ª àâ®ç­ëå áç¥â å */

  str = " ³ VISA (âëá.¤®«.) ³" +
	String((TotalD/1000):15:3) + "³" +
	String((CardD/1000):14:3) + " ³" +
	String((ComClD/1000):19:3) + "³" +
	String((ComShD/1000):17:3) + "³" +
	String((TotalR/1000):13:3) + "³" +
	String((PercR/1000):15:3) + " ³";

  [#](str);
  str = " ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
  [#](str);

end;


/*************************************************************************
	       Ž¡à ¡®âª  ­ ¦ â¨ï ª« ¢¨è¥© ¢ ¯ ­¥«¨ ¤¨ «®£ 
*************************************************************************/
macro WorkDialog (IP, cmd, id, key)

  var stat = CM_DEFAULT;

  if (cmd == DLG_KEY)
    /* Enter --------------------------------------- */
    if (key == 13)
      if (id == ne_EndDate)
	SetFocus(IP,0);
	stat = CM_IGNORE;
      end;
    /* Esc - Žâª § ®â ¢ë¯ãáª  ®âç¥â  --------------- */
    elif (key == 27)
      stat = CM_CANCEL;
    /* F7 - ‚ë¯ãáª ®âç¥â  -------------------------- */
    elif (key == 321)
      stat = CM_SAVE;
    end;
  end;

  return stat;

end;


/*************************************************************************
			‚¢®¤ ¨áå®¤­ëå ¤ ­­ëå
*************************************************************************/
macro Input_InputDate

  var stat = TRUE;
  var d,m,y;

  DateSplit({curdate},d,m,y);

  if ((m >= 1) AND (m <= 3))
    InputPanel.BeginDate = Date(1,1,y - 1);
    InputPanel.EndDate = Date(31,12,y - 1);
  elif ((m > 3) AND (m <= 6))
    InputPanel.BeginDate = Date(1,1,y);
    InputPanel.EndDate = Date(31,3,y);
  elif ((m > 6) AND (m <= 9))
    InputPanel.BeginDate = Date(1,1,y);
    InputPanel.EndDate = Date(30,6,y);
  elif ((m > 9) AND (m <= 12))
    InputPanel.BeginDate = Date(1,1,y);
    InputPanel.EndDate = Date(30,9,y);
  end;

  if (NOT RunDialog(InputPanel,"WorkDialog"))
    [ ];
    [ Žâª § «¨áì ®â ¢ë¯ãáª  ®âç¥â ];
    stat = FALSE;
  end;

  return stat;

end;


/*************************************************************************
		      ƒ Ž ‹ Ž ‚  Ž ‰   Œ € Š  Ž ‘
*************************************************************************/
  if (Input_InputDate())
    HeadReport();
    DoReport();
    BottomReport();
  end;
