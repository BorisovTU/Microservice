//--------------------------------------------------------------------------
//                    Подтверждение операции от ПЦ
//--------------------------------------------------------------------------

import psCommon;

private class (PsOnlineStep) ConfirmStep

  //--------------------------------------------------------------------------
  InitPsOnlineStep();
  
  //--------------------------------------------------------------------------
  private macro callPsMacro()
    var macName = getMacroName();
    if (not macName)
      DoError("Не найден макрос для Online взаимодействия с ПЦ");
    end;
    Params.Step = 1;
    CheckError(ExecMacroFile(macName, "Transmit", Params));
    updateMail("ISFIN");

  OnError(err)
    updateMail("ISERR");
    DoError(12442);
  end;

  //--------------------------------------------------------------------------
  macro execute()
    if ((Params.depdoc.rec.InSum != $0) or (Params.depdoc.rec.OutSum == $0))
      return OK_RES;
    end;

    if (not isOnline())
      DoError(12441);
    end;

    message("Выполняется обмен данными с ПЦ...");

    initMail();

    callPsMacro();
    message(" ");
    return psCheckError();

  OnError(err)
    ShowError(err);
    return ERR_RES;
  end;
  
end;

//--------------------------------------------------------------------------
private var step = ConfirmStep;
ALG_RESULT = step.execute();

