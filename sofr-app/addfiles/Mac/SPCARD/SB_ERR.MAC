/**************************************************************************\
*  ---------------------                                                   *
*  R-Style Software Lab.                                                   *
*  ---------------------                                                   *
*  RS-Retail                                                               *
*  Эмитент                                                                 *
*                                                                          *
*  Система автоматического обмена информацией между Эмитентом и            *
*  Процессинговым центром СберБанка в формате UniCard                      *
*                                                                          *
*  Обработка ошибок, возникающих при работе с входными/выходными           *
*  файлами                                                                 *
*                                                                          *
*  Лебедев С.В.                                                            *
*  22.02.99                                                                *
\**************************************************************************/

import "sb_comm.mac";

//---------------------------------------------------------------------------
/*!
 * Класс исключения хранящий код ошибки
 */
class SbErr( errorCode )
  var errCode = errorCode;
end;

//---------------------------------------------------------------------------
/*!
 * Генерирует исключение с кодом ошибки errCode
 */
macro RunSbError( errCode )
  RunError("", SbErr(errCode) );
end;

//---------------------------------------------------------------------------
/*!
 * Перехватывает исключение SbErr и возвращает код ошибки errCode
 * сгенерированный вызовом RunSbError(errCode)
 * Если исключение не относится к классу SbErr, оно генерируется заново
 */
macro HandleSbError( errObj )

  if( isEqClass("SbErr", errObj.err) )
    return errObj.err.errCode;
  else
    RunError;
  end;

end;

/**************************************************************************\
|                  Определение названия ошибки по ее коду                  |
\**************************************************************************/
macro NameError (CodError, DopInfo)

  var Error = "";

  if   (NOT IsStringError(CodError))
    Error = "Нет ошибок";
  elif (CodError == "01")
    Error = "Error 01: Невозможно создать выходной файл";
  elif (CodError == "10")
    Error = "Error 10: Ошибка в названии входного файла";
  elif (CodError == "11")
    Error = "Error 11: Код идентификации банка в названии входного файла не верен";
  elif (CodError == "12")
    Error = "Error 12: Невозможно открыть входной файл";
  elif (CodError == "13")
    Error = "Error 13: Ошибка при чтении записи входного файла";
  elif (CodError == "14")
    Error = "Error 14: Первая строка входного файла - не заголовок";
  elif (CodError == "15")
    Error = "Error 15: Код тербанка в записи входного файла не верен";
  elif (CodError == "16")
    Error = "Error 15: Номер файла за день не соответствует в имени файла и заголовочной строке";
  elif (CodError == "17")
    Error = "Error 17: Дата создания файла в заголовочной строке не соответствует имени файла";
  elif (CodError == "18")
    Error = "Error 18: Дублирование заголовка";
  elif (CodError == "19")
    Error = "Error 19: Заголовок не первая запись в файле";
  elif (CodError == "20")
    Error = "Error 20: Порядковый номер строки не совпадает с номером в записи файла";
  elif (CodError == "21")
    Error = "Error 21: Во входном файле отсутствует хвостовик";
  elif (CodError == "22")
    Error = "Error 22: Неверная дата в хвостовике файла";
  elif (CodError == "23")
    Error = "Error 23: Неверный идентификатор записи";
  elif (CodError == "24")
    Error = "Error 24: Код тербанка в записи файла неверен";
  elif (CodError == "30")
    Error = "Error 30: Ошибка при записи в файл";
  elif (CodError == "31")
    Error = "Error 31: Ошибка при обновлении записи в файле";
  elif (CodError == "40")
    Error = "Error 40: Ошибка при определении референса в файле";
  elif (CodError == "50")
    Error = "Error 50: Карточка в базе данных не найдена";
  elif (CodError == "51")
    Error = "Error 51: Счет в базе данных не найден";
  elif (CodError == "52")
    Error = "Error 52: Валюта счета клиента в справочнике валют не найдена";
  elif (CodError == "53")
    Error = "Error 53: Связь карточки со счетом в базе данных не найдена";
  elif (CodError == "54")
    Error = "Error 54: Клиент в базе данных не найден";
  elif (CodError == "55")
    Error = "Error 55: Валюта в справочнике валют не найдена";
  elif (CodError == "56")
    Error = "Error 56: Подразделение с заданным номером не найдено";
  elif (CodError == "60")
    Error = "Error 60: У карточки отсутствуют открытые связи со счетами";
  elif (CodError == "61")
    Error = "Error 61: У карточки отсутствует необходимая переменная часть";
  elif (CodError == "65")
    Error = "Error 65: У карточки неверен формат номера";
  elif (CodError == "67")
    Error = "Error 67: Состояние карточки или дата установки состояния не позволяет карточку перевыпустить досрочно";
  elif (CodError == "68")
    Error = "Error 68: Перевыпускаемая карточка в базе данных не найдена";
  elif (CodError == "70")
    Error = "Error 70: Не задано имя клиента";
  elif (CodError == "71")
    Error = "Error 71: Не задана фамилия клиента";
  elif (CodError == "72")
    Error = "Error 72: Не задан титул обращения";
  elif (CodError == "73")
    Error = "Error 73: Не задана контрольная информация клиента";
  elif (CodError == "74")
    Error = "Error 74: Не задан тип паспорта";
  elif (CodError == "75")
    Error = "Error 75: Не задан номер паспорта";
  elif (CodError == "76")
    Error = "Error 76: Не задан код типа заявления (тип счета)";
  elif (CodError == "77")
    Error = "Error 77: Не задано эмбосирование";
  elif (CodError == "78")
    Error = "Error 78: Не задана дата рождения клиента";
  elif (CodError == "79")
    Error = "Error 79: В серии паспорта присутствуют арабские цифры";
  elif (CodError == "80")
    Error = "Error 80: Не найден документ по расходной операции";
  elif (CodError == "81")
    Error = "Error 81: Номер карточки не задан";
  elif (CodError == "82")
    Error = "Error 82: Код авторизации не задан";
  elif (CodError == "90")
    Error = "Warning 90: Возможно несовпадает знак суммы транзакции и тип транзакции";
  elif (CodError == "91")
    Error = "Warning 91: Транзакция не является транзакцией по эмиссии";
  elif (CodError == "101")
    Error = "Error 101: Не задан пол клиента";
  elif (CodError == "102")
    Error = "Error 102: Не задана должность клиента";
  elif (CodError == "103")
    Error = "Error 103: Не определен код карточного продукта";
  elif (CodError == "104")
    Error = "Error 104: Не определен код валюты";
  elif (CodError == "105")
    Error = "Error 105: Не определен банковский счет";
  elif (CodError == "106")
    Error = "Error 106: Не определен код источника заявления";
  elif (CodError == "107")
    Error = "Error 107: Должен быть задан титул к эмбосированию";
  elif (CodError == "108")
    Error = "Error 108: Должен быть задан хоть один адрес";
  elif (CodError == "109")
    Error = "Error 109: При заданном адресе не задан индекс";
  elif (CodError == "110")
    Error = "Error 110: При заданном адресе или индексе не задан тип адреса";
  elif (CodError == "111")
    Error = "Error 111: Длина эмбосирования превышает допустимое значение";
  elif (CodError == "112")
    Error = "Error 112: Невозможно загрузить транзакцию на оплату услуги \"Мобильный банк\"";
  elif (CodError == "113")
    Error = "Error 113: Не найдено поручение на \"Мобильный банк\"";
  elif (CodError == "114")
    Error = "Error 114: Не найдено заявление на \"Мобильный банк\"";
  elif (CodError == "115")
    Error = "Error 115: Не найден оператор мобильной связи";    
  elif (CodError == "116")
    Error = "Error 116: Не найдена основная карта по заявлению МБ";
  elif (CodError == "117")
    Error = "Error 117: Не найдены карты по заявлению МБ";
  elif (CodError == "118")
    Error = "Error 118: Неизвестный тип пакета услуг МБ";
  elif (CodError == "119")
    Error = "Error 119: Не найден получать платежей МБ";
  elif (CodError == "120")
    Error = "Error 120: Не найдена страна \"индивидуального режима\"";
  elif (CodError == "121")
    Error = "Error 121: Не найдены данные о сотруднике банка";
  elif (CodError == "122")
    Error = "Error 122: Информация по данной карточке не подлежит выгрузке";
  elif (CodError == "123" )
    Error = "Error 123: Не найдены данные по новой карточке";
  elif (CodError == "124" )
    Error = "Error 124: Не найдена карточная часть счета";
  elif (CodError == "125" )
    Error = "Error 125: Не найдены данные по старому паспорту";    
  elif (CodError == "126" )
    Error = "Error 126: Не найдена главная карта по счету";
  elif (CodError == "127" )
    Error = "Error 127: У главной карты по счету отсутствует номер";
  elif (CodError == "128" )
    Error = "Error 128: Состояние карточки не соответствует выполняемой операции";
  elif (CodError == "129" )
    Error = "Error 129: Неверный формат серии паспорта";
  elif (CodError == "130" )
    Error = "Error 130: Неверный формат номера паспорта";
  elif (CodError == "131" )
    Error = "Error 131: Не найдены данные по старой карточке";
  elif (CodError == "132" )
    Error = "Error 132: Нет данных о журнализированных изменениях";
  elif (CodError == "133" )
    Error = "Error 133: Не удалось прочитать данные из переменной части rtnfopr";    
  elif (CodError = "134" )
    Error = "Error 134: Не найдены данные по смене курса";

  elif (CodError == "9999" )
    Error = "Error 9999: Внутренняя ошибка программы";
  else
    Error = "Данный код ошибки не описан !!!";
  end;

  if (DopInfo != "")
    Error = Error + " " + DopInfo;
  end;

  return Error;

end;
