/*
$Name:           UCS_REPORTS.mac
$Module:         UCS
$Description:    é‚Á•‚Î
*/
import "UCS_DIALOGS.mac";
import "or_rep_h.mac"   ;
macro GetStarMumber(Numb)

    var len = strlen(Numb);
    var res = "";
    var i = 0;

    while(i < len - 4 )
       res = res + "*";
       i = i + 1;
    end;
    res = res + SubStr(Numb,len - 3); 
    return res;
end;
class  Balance_rep(_param)
     var objPrint = CMakeReport();
     var param = _param;
     macro Print()
         var cn = param.Param.scCard.rec.CardNumber;
         
         objPrint.AddPrintCell("Ñéëíìèçõâ ÅÄãÄçë äÄêíõ "                            ,100,0,"c",REP_ELEM_STR);
         objPrint.AddStr();
         objPrint.AddPrintCell("ä†‡‚† ¸ " + GetStarMumber(cn) ,100,0,"l",REP_ELEM_STR);
         objPrint.AddStr();
       
         objPrint.AddPrintCell("ÑÆ·‚„Ø≠Î• ·‡•§·‚¢†"           ,30,0,"",REP_ELEM_STR);
         objPrint.AddPrintCell(money(param.Avalible.Amount)   ,20 ,2,"",REP_ELEM_STR);
         objPrint.AddPrintCell(param.Avalible.Currency        ,20 ,0,"r",REP_ELEM_STR);
         objPrint.AddStr();

         objPrint.AddPrintCell("ä‡•§®‚≠Î© ´®¨®‚"           ,30,0,"",REP_ELEM_STR);
         objPrint.AddPrintCell(money(param.Limit.Amount)   ,20,2,"",REP_ELEM_STR);
         objPrint.AddPrintCell(param.Limit.Currency        ,20,0,"r",REP_ELEM_STR);
         objPrint.AddStr();
         objPrint.AddPrintCell("á†°´Æ™®‡Æ¢†≠≠Î• ·‡•§·‚¢†"   ,30,0,"",REP_ELEM_STR);
         objPrint.AddPrintCell(money(param.BLOCKED.Amount)  ,20,2,"",REP_ELEM_STR);
         objPrint.AddPrintCell(param.BLOCKED.Currency       ,20,0,"r",REP_ELEM_STR);
         objPrint.AddStr();
         objPrint.PrintRep("UCS_BALANCE");
     end;
end;
class RepExCard(_param)
    var param = _param;
    macro Print()
        var Header =
        "⁄ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø\n" +
        "≥Ñ†‚† ® ¢‡•¨Ô≥  K  ≥   ë„¨¨†    ≥   ë„¨¨†    ≥      äÆ§      ≥      RRN         ≥      éØ®·†≠®•           ≥\n" +
        "≥            ≥     ≥ ‚‡†≠ß†™Ê®® ≥ ‚‡†≠ß†™Ê®® ≥  Ä¢‚Æ‡®ß†Ê®®  ≥                  ≥                         ≥\n" +
        "≥            ≥     ≥  ¢ ¢†´Ó‚•  ≥  ¢ ¢†´Ó‚•  ≥               ≥                  ≥                         ≥\n" +
        "≥            ≥     ≥   ™†‡‚Î    ≥  ÆØ•‡†Ê®®  ≥               ≥                  ≥                         ≥\n" +
        "√ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥";
                                                                                                                  
        var objPrint = CMakeReport(Header);
        var cn = param.Param.scCard.rec.CardNumber;
        objPrint.AddPrintCell("êÄëòàêÖççÄü ÇõèàëäÄ èé äÄêíÖ ¸  " +  GetStarMumber(cn) ,100,0,"c",REP_ELEM_STR);
        objPrint.AddStr();
        objPrint.AddPrintCell(" " ,100,0,"c",REP_ELEM_STR);
        objPrint.AddStr();

        var strA1 ; 
        if(param.dlg.TypeRep == 2)
            strA1 = "î®≠†≠·Æ¢Î• ÆØ•‡†Ê®® ß† Ø•‡®Æ§ · "+ param.dlg.bdate  + " ØÆ " + param.dlg.edate;
        elif(param.dlg.TypeRep == 1)
            strA1 = "Ä¢‚Æ‡®ß†Ê®®  ÆØ•‡†Ê®® ß† Ø•‡®Æ§ · "+ param.dlg.bdate  + " ØÆ " + param.dlg.edate;
        elif(param.dlg.TypeRep == 0)
            strA1 = "èÆ·´•§≠®• 10 ÆØ•‡†Ê®© ß† ØÆ·´•§≠®• 30 §≠•©"
        end;
        objPrint.AddPrintCell(strA1 ,100,0,"c",REP_ELEM_STR);
        objPrint.AddStr();
                objPrint.AddPrintCell(param.dlg.bdate + " - " + param.dlg.edate,100,0,"l",REP_ELEM_STR);   
        objPrint.AddStr();
        objPrint.AddPrintCell("ë„¨¨† §Æ·‚„Ø≠ÎÂ ·‡•§·‚¢:  " +  param.Avalible.Amount + "  " + param.Avalible.Currency  ,150,0,"l",REP_ELEM_STR);   
        objPrint.AddStr();
        var i = 0;
        while(i < param.StmtItemArray.size)
            var StmtItem =  param.StmtItemArray[i];
            objPrint.AddPrintCell(StmtItem.LocalDt,0,0,"",REP_ELEM_TABL);
            var pFinCateg = "";
            if(StmtItem.FinCategory  == "N")
                pFinCateg = "F";    
            elif(StmtItem.FinCategory == "Y" )
                pFinCateg = "A"
            end;
            var cmd = RsdCommand(
                "Select * "+
                "from dsccodif_dbt  sc " +
                "where SC.T_PSREF = ? and SC.T_CODType = 20 and sc.T_CODUSERCODE like ?");

            cmd.addParam("PSREF"      , RSDBP_IN,  Param.Param.scCard.rec.psRef);
            cmd.addParam("CODUSERCODE", RSDBP_IN, "_" + StmtItem.TransTypeCode);
            cmd.execute();
            var rs = RsdRecordset(cmd);
            rs.NullConversion = true;
            var T_USERCODE = "";
            if (rs.moveNext())
                T_USERCODE = rs.value("T_CODUSERCODE");
            end;
            objPrint.AddPrintCell(pFinCateg,0,0,"",REP_ELEM_TABL);
            var zn = ""; 
            if(T_USERCODE)
                if(SubStr(T_USERCODE,1,1) != "N")
                    zn =  SubStr(T_USERCODE,1,1); 
                end;
                objPrint.AddPrintCell(zn + abs(StmtItem.AccountAmount) +" "+ StmtItem.AccountAmountCurrency,0,0,"r",REP_ELEM_TABL);
                objPrint.AddPrintCell(zn + abs(StmtItem.TrnAmount)     +" "+ StmtItem.TrnCurrency          ,0,0,"r",REP_ELEM_TABL);
            else
                zn = "?";
                objPrint.AddPrintCell(zn  + StmtItem.AccountAmount +" "+ StmtItem.AccountAmountCurrency,0,0,"r",REP_ELEM_TABL);
                objPrint.AddPrintCell(zn  + StmtItem.TrnAmount     +" "+ StmtItem.TrnCurrency          ,0,0,"r",REP_ELEM_TABL);
            end;
            if(ValType(StmtItem.AuthCode2))
            objPrint.AddPrintCell(StmtItem.AuthCode2.Value  ,0,0,"",REP_ELEM_TABL);
            else
                objPrint.AddPrintCell(""  ,0,0,"",REP_ELEM_TABL);
            end;
            if(ValType(StmtItem.RRN2))
            objPrint.AddPrintCell(StmtItem.RRN2.Value       ,0,0,"",REP_ELEM_TABL);
            else
                objPrint.AddPrintCell("",0,0,"",REP_ELEM_TABL);
            end;
            objPrint.AddPrintCell((StmtItem.Description  )  ,0,0,"",REP_ELEM_TABL);
            objPrint.AddStr();
 
            if(StmtItem.isExistBilling())
                objPrint.AddPrintCell(StmtItem.PhaseDate,0,0,"",REP_ELEM_TABL);
                objPrint.AddPrintCell("",0,0,"",REP_ELEM_TABL);
                objPrint.AddPrintCell("",0,0,"",REP_ELEM_TABL);
                objPrint.AddPrintCell(StmtItem.ExtraAmount + " "+ StmtItem.ExtraCurrency,0,0,"r",REP_ELEM_TABL);
                objPrint.AddPrintCell("",0,0,"",REP_ELEM_TABL);
                objPrint.AddPrintCell("",0,0,"",REP_ELEM_TABL);
                objPrint.AddPrintCell("äÆ¨®··®Ô Å†≠™† " +  StmtItem.ExtraDetails,0,0,"",REP_ELEM_TABL);
            objPrint.AddStr();
            end;

            i = i +1;
        end;
        objPrint.PrintRep();
    end;
end;

