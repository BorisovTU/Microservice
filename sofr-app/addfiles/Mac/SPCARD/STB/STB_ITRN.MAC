/*********************************************************************
*  ---------------------                                             *
*  R-Style Software Lab.                                             *
*  ---------------------                                             *
*  RS-Retail                                                         *
*                                                                    *
*  Пластиковые карточки                                              *
*                                                                    *
*  Действия при инициализации Транзакции Платежной системы STB-Card  *
*                                                                    *
*  Лебедев С.В.                                                      *
*  17.12.99                                                          *
*********************************************************************/

import "sc_error.mac","stb_com.mac";

record SC_TRAN ("STB_Tran.","sc_user.def"); /* Транзакция - Глобальная строка */
record scTran  (scTran,     "spcard.def" ); /* Транзакция                     */

array PunktMenu;
  PunktMenu(0) = " Транзакция типа TRI        ";
  PunktMenu(1) = " Транзакция типа TRA        ";
  PunktMenu(2) = " Транзакция типа TRF        ";


/*********************************************************************
       	          Г Л А В Н А Я   П Р О Г Р А М М А
*********************************************************************/

  var i;

  ALG_STAT   = НЕТ_ОШИБКИ;
  ALG_VARPARTSIZE = GetRecordSize(SC_TRAN) - GetRecordSize(scTran);

  /* Инициализация переменной части */
  SC_TRAN.Format        = "";
  SC_TRAN.BTTRFA        = "";
  SC_TRAN.BTTRTA        = "";
  SC_TRAN.BTSER         = "";
  SC_TRAN.BTRSPC_CTRSPC = "";
  SC_TRAN.BTAPR         = "";
  SC_TRAN.BTCAT1        = "";
  SC_TRAN.BTCAID        = "";
  SC_TRAN.BTCATA        = "";
  SC_TRAN.BTAQID        = "";
  SC_TRAN.BTTRCC_CTTRCC = 0;
  SC_TRAN.BTTRN         = 0;
  SC_TRAN.BTATR         = 0;
  SC_TRAN.BTTRFE        = 0;
  SC_TRAN.BTI1CC        = 0;
  SC_TRAN.BTI1A_CTQUAN  = 0;
  SC_TRAN.BTI1F_CTRATE  = 0;
  SC_TRAN.BTI1P_CTMAX   = 0;
  SC_TRAN.BTC1A_CTMIN   = 0;
  SC_TRAN.BTC1AF_CTATR  = 0;
  SC_TRAN.BTC1PF_CTSTL  = 0;
  SC_TRAN.BTC1SF        = 0;
  SC_TRAN.BTSC1R        = 0;
  SC_TRAN.BTISID        = "";
  SC_TRAN.CTSERV        = "";
  SC_TRAN.CTEVNT        = "";
  SC_TRAN.CTCRD         = "";

  i = Menu(PunktMenu,NULL,"Выберите тип транзакции");

  if (i < 0)
    ALG_STAT   = ЕСТЬ_ОШИБКА;
    MsgBox("Инициализировать транзакцию невозможно. Не определен формат");
  elif (i == 0)
    SC_TRAN.Format = "TRI";
  elif (i == 1)
    SC_TRAN.Format = "TRA";
  else
    SC_TRAN.Format = "TRF";
  end;

end;
