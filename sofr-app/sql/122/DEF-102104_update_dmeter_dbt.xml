<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
                            http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">

    <changeSet id="DEF-102104_update_dmeter_dbt" author="Simanov">
        <update tableName="dmeter_dbt">
            <column name="t_lastvalue" valueComputed="(select max(to_number(substr(t_dealcode, 1, nvl(nullif(instr(t_dealcode, '/'), 0) - 1, length(t_dealcode)))))
                        from ddl_tick_dbt t
                       where t_bofficekind = 130
                         and t_dealtype = 12021
                         and t_dealid > 10000000)"/>	
            <where> t_seqid = 41</where>
        </update>
    </changeSet>
</databaseChangeLog>