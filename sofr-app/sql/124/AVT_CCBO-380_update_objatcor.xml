<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
    http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">

    <changeSet id="AVT_CCBO-380_update_objattr" author="Vrubel">
        <update tableName="dobjatcor_dbt">
            <column name="t_validtodate" valueComputed="to_date('31.12.2025', 'dd.mm.yyyy')"/>
            <where>t_objecttype=12 and t_groupid=33 and t_attrid=35 and (t_validtodate = to_date('31.12.9999', 'dd.mm.yyyy') or t_validtodate > to_date('31.12.2025', 'dd.mm.yyyy'))</where>
        </update>

        <sql>
       INSERT INTO dobjatcor_dbt (t_objecttype, t_groupid, t_attrid, t_object, t_general, t_validfromdate, t_oper, t_validtodate, t_isauto) (
            SELECT t_objecttype, t_groupid, 44, t_object, t_general, to_date('01.01.2026', 'dd.mm.yyyy'), t_oper, to_date('31.12.9999', 'dd.mm.yyyy'), t_isauto
              FROM (SELECT t_objecttype, t_groupid, t_attrid, t_object, t_general, t_validfromdate, t_oper, t_validtodate, t_isauto
                           FROM dobjatcor_dbt 
                        WHERE t_objecttype=12 and t_groupid=33 and t_attrid=35  and (t_validtodate = to_date('31.12.9999', 'dd.mm.yyyy') or t_validtodate >= to_date('31.12.2025', 'dd.mm.yyyy') ) 
                    ORDER BY t_validfromdate DESC, t_id DESC
                )
               WHERE ROWNUM = 1
        )
        </sql>

    </changeSet>

</databaseChangeLog>