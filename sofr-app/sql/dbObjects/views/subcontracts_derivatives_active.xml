<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
                            http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">

    <changeSet id="create_view_subcontracts_derivatives_active" runOnChange="true" author="Simanov">
        <createView viewName="subcontracts_derivatives_active" replaceIfExists="true">
            select /*+  full(c) full(mp) full(d) full(pc) */
                   c.t_id id,
                   c.t_number contract_number,
                   c.t_name name,
                   pc.t_id contract_id,
                   c.t_partyid client_id,
                   c.t_datebegin date_begin,
                   plan.t_sfplanid plan_id,
                   mp.t_firmid firm_id,
                   mp.t_mpcode marketplace_code
              from dsfcontr_dbt c
              join ddlcontrmp_dbt mp on mp.t_sfcontrid = c.t_id
              join ddlcontr_dbt d on d.t_dlcontrid = mp.t_dlcontrid
              join dsfcontr_dbt pc on pc.t_id = d.t_sfcontrid
              join dsfcontrplan_dbt plan on plan.t_sfcontrid = c.t_id
             where c.t_servkind = sfcontr_read.servkind_forts
               and c.t_dateclose = to_date('01.01.0001', 'dd.mm.yyyy')
               and plan.t_begin &lt;= trunc(sysdate)
               and (plan.t_end > trunc(sysdate) or plan.t_end = to_date('01.01.0001', 'dd.mm.yyyy'))
               and mp.t_mpregdate &lt;= trunc(sysdate)
               and (mp.t_mpclosedate > trunc(sysdate) or mp.t_mpclosedate = to_date('01.01.0001', 'dd.mm.yyyy'))
        </createView>
    </changeSet>
  
</databaseChangeLog>