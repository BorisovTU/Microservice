<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
                            http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">

    <changeSet id="create_view_instruments_derivatives_active_moex_lnk" runOnChange="true" author="Simanov">
        <createView viewName="instuments_dv_active_moex_lnk" replaceIfExists="true">
            select fininstr_read.get_mmvb_code(p_fiid => fd.t_fiid) id,
                   fd.t_fiid fiid
              from dfideriv_dbt fd
              join dfininstr_dbt fi on fi.t_fiid = fd.t_fiid
              join dfininstr_dbt base_fi on base_fi.t_fiid = fi.t_facevaluefi
             where fd.t_lastcirculationdate >= trunc(sysdate)
               and fininstr_read.get_mmvb_code(p_fiid => fd.t_fiid) is not null
        </createView>
    </changeSet>
  
</databaseChangeLog>