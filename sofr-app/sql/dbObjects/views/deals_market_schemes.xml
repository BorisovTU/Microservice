<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
                            http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">

    <changeSet id="create_view_deals_market_schemes" runOnChange="true" author="Simanov">
        <createView viewName="deals_market_schemes" replaceIfExists="true">
            select s.t_id id,
                   s.t_settlecode settle_code,
                   nvl(a.t_marketkind, s.t_marketkind) market_kind,
                   case s.t_inpool when 'X' then 'true' else 'false' end is_in_pool,
                   s.t_marketid market_id,
                   s.t_centrid centr_id,
                   nvl(a.t_centrofficeid, s.t_centrofficeid) centroffice_id,
                   nvl(a.t_marketschemeid, s.t_marketschemeid) marketscheme_id
              from ddl_extsettlecode_dbt s
              left join ddl_extscanalytics_dbt a on a.t_codeid = decode(s.t_parentid, 0, s.t_id, s.t_parentid)
                                                and s.t_inpool = 'X'
                                                and a.t_marketkind = 4
        </createView>
    </changeSet>
  
</databaseChangeLog>