<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
                            http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">

    <changeSet id="create_view_commissions_types" runOnChange="true" author="Simanov">
        <createView viewName="commissions_types" replaceIfExists="true">
        select c.t_comissid id,
               c.t_feetype fee_type,
               c.t_number com_number,
               c.t_code code,
               c.t_name name,
               decode(c.t_calcperiodtype, 1, 'День',
                                          2, 'Месяц',
                                          3, 'Квартал',
                                          4, 'Год') calcperiodtype,
               c.t_calcperiodnum calcperiodnum,
               decode(c.t_paynds, 1, 'Не облагается',
                                  2, 'Включен',
                                  3, 'Не включен') paynds,
               c.t_fiid_comm comm_fiid,
               nullif(c.t_fiid_paysum, -1) paysum_fiid,
               c.t_summin sum_min,
               c.t_summax sum_max,
               nullif(c.t_receiverid, -1) receiver_id,
               decode(c.t_incfeetype, 1, 'Периодическая',
                                      2, 'Единовременная',
                                      6, 'Разовая') inc_fee_type,
               nullif(c.t_inccommnumber, 0) inc_number,
               c.t_formalg form_alg,
               c.t_servicekind service_kind,
               c.t_servicesubkind service_subkind,
               decode(c.t_calccomisssumalg, 1, 'На дату расчета',
                                            2, 'на дату оплаты',
                                            3, 'На дату оплаты - 1') calc_comiss_sum_alg,
               c.t_datebegin date_begin,
               case c.t_dateend when to_date('01.01.0001', 'dd.mm.yyyy') then to_date('31.12.9999', 'dd.mm.yyyy') else c.t_dateend end date_end,
               nullif(c.t_parentcomissid, 0) parent_commission_id
          from dsfcomiss_dbt c
         where c.t_dateend = to_date('01.01.0001', 'dd.mm.yyyy') or c.t_dateend >= trunc(sysdate)
        </createView>
    </changeSet>
  
</databaseChangeLog>