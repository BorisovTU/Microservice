<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
                            http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">

    <changeSet id="create_view_calendars_markets_derivatives_clearing" runOnChange="true" author="Simanov">
        <createView viewName="calendars_markets_derivatives_clearing" replaceIfExists="true">
            with days as (
                select level - 1 day_num
                    from dual
                connect by level &lt;= 366
                    )
                select to_char(to_date('01.01.' || to_char(c.t_year)) + days.day_num, 'yyyy-mm-dd') dt,
                case when UTL_RAW.CAST_TO_VARCHAR2(UTL_RAW.SUBSTR(UTL_RAW.SUBSTR(c.t_calendays, days.day_num * 3 + 1, 3), 2, 1)) = chr(1) then 'true'
                   else 'false'
                       end is_work_date       
                  from dcalendar_dbt c
                  join days on days.day_num &lt; c.t_daysinyear
                 where c.t_id = 401
                 order by t_year, days.day_num
        </createView>
    </changeSet>
  
</databaseChangeLog>
