<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
    http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">
  <changeSet id="120_BOSS-2229_create_ddl_debtreestr" author="Zhits">
    <createTable tableName="DDL_DEBTREESTR_DBT" remarks="Таблица реестра прочей задолженности">
      <column name="T_ID" type="NUMBER(10)" remarks="Идентификатор задолженности"/>
      <column name="T_OPID" type="NUMBER(10)" remarks="Идентификатор задолженности из операции выноса на просрочку/списания задолженности"/>
      <column name="T_CLIENTID" type="NUMBER(10)" remarks="Идентификатор клиента"/>
      <column name="T_DLCONTRID" type="NUMBER(10)" remarks="Идентификатор ДБО"/>
      <column name="T_SFCONTRID" type="NUMBER(10)" remarks="Идентификатор субдоговора"/>
      <column name="T_DEBTDATE" type="DATE" remarks="Дата возникновения задолженности"/>
      <column name="T_DEBTSUM" type="NUMBER(32,12)" remarks="Текущая сумма задолженности"/>
      <column name="T_DEBTCURRENCY" type="NUMBER(10)" remarks="Валюта задолженности"/>
      <column name="T_DEBTTYPE" type="NUMBER(5)" remarks="Тип задолженности"/>
      <column name="T_DEBTACCID" type="NUMBER(10)" remarks="Идентификатор счета клиента по прочей задолженности"/>
      <column name="T_DEBT458ACCID" type="NUMBER(10)" remarks="Идентификатор счета клиента по учету просроченной задолженности"/>
      <column name="T_INSTANCE" type="NUMBER(5)" remarks="Инстанс изменения записи"/>
      <column name="T_STATE" type="NUMBER(5)" remarks="Статус записи"/>
      <column name="T_OPER" type="NUMBER(5)" remarks="Операционист"/>
      <column name="T_CHANGEDATE" type="DATE" remarks="Дата последнего изменения"/>
      <column name="T_SYSDATE" type="DATE" defaultValueComputed="SYSDATE" remarks="Системная дата и время выполнения изменений"/>
    </createTable>

    <createIndex indexName="DDL_DEBTREESTR_DBT_IDX0" tableName="DDL_DEBTREESTR_DBT" unique="true">
      <column name="T_ID"/>
    </createIndex>

    <createIndex indexName="DDL_DEBTREESTR_DBT_IDX1" tableName="DDL_DEBTREESTR_DBT" unique="false">
      <column name="T_SFCONTRID"/>
      <column name="T_DEBTDATE"/>
      <column name="T_DEBTCURRENCY"/>
      <column name="T_DEBTTYPE"/>
      <column name="T_STATE"/>
    </createIndex>		

    <createSequence sequenceName="DDL_DEBTREESTR_DBT_SEQ" startValue="1" maxValue="999999999999999999999999999" minValue="1" cacheSize="0"/>
  </changeSet>

  <changeSet id="120_BOSS-2229_create_ddl_debtreestrhist" author="Zhits">
    <createTable tableName="DDL_DEBTREESTRHIST_DBT" remarks="Таблица истории изменения записей реестра прочей задолженности">
      <column name="T_DEBTID" type="NUMBER(10)" remarks="Идентификатор задолженности из реестра задолженности"/>
      <column name="T_DEBTDATE" type="DATE" remarks="Дата возникновения задолженности"/>
      <column name="T_DEBTSUM" type="NUMBER(32,12)" remarks="Текущая сумма задолженности"/>
      <column name="T_DEBTCURRENCY" type="NUMBER(10)" remarks="Валюта задолженности"/>
      <column name="T_INSTANCE" type="NUMBER(5)" remarks="Инстанс изменения записи"/>
      <column name="T_STATE" type="NUMBER(5)" remarks="Статус записи"/>
      <column name="T_OPER" type="NUMBER(5)" remarks="Операционист"/>
      <column name="T_SYSDATE" type="DATE" remarks="Системная дата и время выполнения изменений"/>
      <column name="T_CHANGEDATE" type="DATE" remarks="Дата последнего изменения"/>
      <column name="T_OPID" type="NUMBER(10)" remarks="Идентификатор задолженности из операции выноса на просрочку/списания задолженности"/>
    </createTable>

    <createIndex indexName="DDL_DEBTREESTRHIST_DBT_IDX0" tableName="DDL_DEBTREESTRHIST_DBT" unique="false">
      <column name="T_DEBTID"/>
    </createIndex>
  </changeSet>

  <!--Триггер на авто-инкрементное поле-->
  <changeSet id="120_BOSS-2229_create_trg_ddl_debtreestr.sql" context="prod" author="Zhits"> 
    <sqlFile encoding="cp866" endDelimiter="/" path="./120/120_BOSS-2229_create_trg_ddl_debtreestr.sql" splitStatements="true" stripComments="false"/> 
  </changeSet>

  <!--Временная таблица для загрузки записей реестра из Excel-->
  <changeSet id="120_BOSS-2229_create_ddl_debtreestrexcel_tmp.sql" context="prod" author="Zhits"> 
    <sqlFile encoding="cp866" endDelimiter="/" path="./120/120_BOSS-2229_create_ddl_debtreestrexcel_tmp.sql" splitStatements="true" stripComments="false"/> 
  </changeSet>
</databaseChangeLog>