<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
    http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">
   <property name="now" value="sysdate" dbms="oracle"/>
   <changeSet id="120_BOSS-7584_usernptxshortreq" author="Shestakov" >

      <createTable tableName="DUSERNPTXSHORTREQ_DBT"        remarks="Таблица экземпляров запроса выпуска краткой справки НДФЛ">
         <column name="T_ID"          type="NUMBER(10)"     remarks="Уникальный идентификатор записи"/>
         <column name="T_QMESSLOGID"  type="NUMBER" 	    remarks="Идентификатор запроса в таблице сообщений очередей q manager"/>
		 <column name="T_SESSIONID"   type="NUMBER"         remarks="Уникальный идентификатор сессии"/>
         <column name="T_GUIDREQ"  	  type="VARCHAR(100)"   remarks="Идентификатор запроса GUID из SINV"/>
		 <column name="T_GUIDRESP"    type="VARCHAR(100)"   remarks="Идентификатор запроса GUID из SOFR в SINV"/>
		 <column name="T_TAXPERIOD"   type="NUMBER"         remarks="Отчетный период справки"/>
         <column name="T_REGDATEREQ"  type="DATE"           remarks="Дата RequestTime из запроса SINV"/>
         <column name="T_REGDATERESP" type="DATE"           remarks="Дата RequestTime из ответа SOFR в SINV"/>	 
         <column name="T_CLIENTCODE"  type="VARCHAR(100)"   remarks="Код клиента"/>
         <column name="T_PARTYID"     type="NUMBER(10)"     remarks="Идентификатор клиента в СОФР"/>
		 <column name="T_REQSYSDATE"  type="DATE"           remarks="Системная дата создания записи в таблице"/>
		 <column name="T_JSONGENBEG"  type="TIMESTAMP(6)"   remarks="Дата и время начала формирования JSON"/>
		 <column name="T_JSONGENEND"  type="TIMESTAMP(6)"   remarks="Дата и время окончания формирования JSON"/>		 
		 <column name="T_REPNAME"     type="VARCHAR(100)"   remarks="Наименование сформированного отчета"/>
         <column name="T_ERRORDESC"   type="CLOB"           remarks="Текст ошибки"/>
         <column name="T_ERRORCODE"   type="NUMBER"         remarks="0 - нет ошибок, 1 - ошибка валидации, 2 - ошибка расчета данных, 3 - ошибка генерации"/>
		 <column name="T_FILEGENBEG"  type="TIMESTAMP(6)"   remarks="Дата и время начала формирования файла. Запрос в IPS"/>
		 <column name="T_FILEGENEND"  type="TIMESTAMP(6)"   remarks="Дата и время окончания формирования файла. Ответ из IPS"/>
		 <column name="T_DOCUMENTPATH" type="VARCHAR(200)"  remarks="Путь к сформированному отчету в s3"/>	
      </createTable>

      <createIndex indexName="DUSERNPTXSHORTREQ_DBT_IDX0" tableName="DUSERNPTXSHORTREQ_DBT" unique="true" tablespace="INDX">
         <column name="T_ID"/>
      </createIndex>
      
      <createSequence sequenceName="DUSERNPTXSHORTREQ_DBT_SEQ" startValue="1" maxValue="999999999999999999999999999" minValue="1" cacheSize="0"/>
	  
   </changeSet>
   
   <changeSet id="120_BOSS-7584_trg_usernptxshortreq.sql" context="prod" author="Shestakov"> 
		<sqlFile encoding="cp866" 
			   endDelimiter="/" 
		   path="./120/120_BOSS-7584_trg_usernptxshortreq.sql" 
		   splitStatements="true" 
		   stripComments="false"/> 
   </changeSet>

</databaseChangeLog>
