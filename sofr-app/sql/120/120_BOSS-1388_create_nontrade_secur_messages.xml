<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:pro="http://www.liquibase.org/xml/ns/pro"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
                            http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">

    <changeSet id="120_BOSS-1388_create_nontrade_secur_messages" author="Mustafaev">
        <createTable tableName="nontrade_secur_messages" remarks="Сообщения об операциях по ценным бумагам, отправляемые в QUIK">
            
            <column name="msg_id" type="NUMBER(10)" remarks="Уникальный идентификатор сообщения">
                <constraints primaryKey="true" nullable="false"/>
            </column>

            <column name="deal_id" type="NUMBER(10)" remarks="ID сделки (операции), по которой сформировано сообщение">
                <constraints nullable="false" foreignKeyName="fk_nontrade_secur_messages_deal" 
                             references="ddl_tick_dbt(t_dealid)"/>
            </column>

            <column name="system_name" type="VARCHAR2(100 CHAR)" remarks="Система, куда отправляется сообщение">
                <constraints nullable="false" foreignKeyName="fk_nontrade_secur_messages_system" 
                             references="itt_q_corrsystem(system_name)"/>
            </column>

            <column name="guid" type="VARCHAR2(100 CHAR)" remarks="GUID сообщения">
                <constraints nullable="false"/>
            </column>

            <column name="create_time" type="TIMESTAMP" remarks="Время вставки строки в таблицу">
                <constraints nullable="false"/>
            </column>

            <column name="request_time" type="TIMESTAMP" remarks="Время отправки сообщения">
                <constraints nullable="true"/>
            </column>

            <column name="response_time" type="TIMESTAMP" remarks="Время получения ответа">
                <constraints nullable="true"/>
            </column>

            <column name="result_description" type="VARCHAR2(500 CHAR)" remarks="Описание результата отправки">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <createIndex indexName="idx_nontrade_sec_msq_deal" tableName="nontrade_secur_messages">
            <column name="deal_id"/>
        </createIndex>

        <createIndex indexName="idx_nontrade_sec_msq_system" tableName="nontrade_secur_messages">
            <column name="system_name"/>
        </createIndex>

    </changeSet>

</databaseChangeLog>