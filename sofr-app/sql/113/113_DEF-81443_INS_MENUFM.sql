
DECLARE 
BEGIN

  DELETE FROM DITEMSYST_DBT WHERE T_CIDENTPROGRAM = 'С' AND T_ICASEITEM  = 5563;

  INSERT INTO DITEMSYST_DBT (T_CIDENTPROGRAM,T_ICASEITEM,T_IKINDMETHOD,T_IKINDPROGRAM,T_IHELP,T_RESERVE,T_SZNAMEITEM,T_PARM)
  VALUES(
  'С',5563,0,1,0,chr(1),'Параметры подключения к Active Directory','00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
  );

END;
/

DECLARE 

 v_ID        DMENUITEM_DBT.T_INUMBERPOINT%TYPE;
 v_ParentID  DMENUITEM_DBT.T_INUMBERFATHER%TYPE;

 v_Count  NUMBER;
BEGIN

  SELECT count(1) INTO v_Count FROM DMENUITEM_DBT WHERE T_OBJECTID = 1 AND T_ISTEMPLATE = 'X' AND T_IIDENTPROGRAM = 145 AND T_ICASEITEM = 5563;
  
  IF(v_Count = 0) THEN

    -- 1,'X',145,395,354,40,0,'X',' Синхронизация с Active Directory','Синхронизация с Active Directory',0,145
    SELECT T_INUMBERPOINT INTO v_ParentID FROM DMENUITEM_DBT WHERE T_OBJECTID = 1 AND T_ISTEMPLATE = 'X' AND T_IIDENTPROGRAM = 145 AND T_SZNAMEITEM = ' Синхронизация с Active Directory';

    SELECT MAX(T_INUMBERPOINT) INTO v_ID FROM DMENUITEM_DBT WHERE T_OBJECTID = 1 AND T_ISTEMPLATE = 'X' AND T_IIDENTPROGRAM = 145;
    v_ID := v_ID + 1;

    INSERT INTO DMENUITEM_DBT (T_OBJECTID, T_ISTEMPLATE, T_IIDENTPROGRAM, T_INUMBERPOINT, T_INUMBERFATHER, T_INUMBERLINE, T_ICASEITEM, T_CSYSTEMITEM, T_SZNAMEITEM, T_SZNAMEPROMPT, T_IHELP,T_IPROGITEM)
    VALUES(1,'X',145,v_ID,v_ParentID,30,5563,'X',' Параметры подключения к Active Directory','Параметры подключения к Active Directory',0,145);
    -- 1,'X',145,419,395,30,5563,'X',' Параметры подключения к Active Directory','Параметры подключения к Active Directory',0,145

  END IF;

END;
/


DECLARE 

 v_ID        DMENUITEM_DBT.T_INUMBERPOINT%TYPE;
 v_ParentID  DMENUITEM_DBT.T_INUMBERFATHER%TYPE;

 v_Count  NUMBER;
BEGIN

  FOR rec IN ( SELECT T_INUMBERPOINT AS ParentID, T_OBJECTID  FROM DMENUITEM_DBT WHERE /*T_OBJECTID = 1 AND*/ T_ISTEMPLATE = chr(0) AND T_IIDENTPROGRAM = 145 AND T_SZNAMEITEM = ' Синхронизация с Active Directory' )
  LOOP
    SELECT count(1) INTO v_Count FROM DMENUITEM_DBT WHERE T_OBJECTID = rec.T_OBJECTID AND T_ISTEMPLATE = chr(0) AND T_IIDENTPROGRAM = 145 AND T_ICASEITEM = 5563;
    IF(v_Count = 0) THEN
      SELECT MAX(T_INUMBERPOINT) INTO v_ID FROM DMENUITEM_DBT WHERE T_OBJECTID = rec.T_OBJECTID AND T_ISTEMPLATE = chr(0) AND T_IIDENTPROGRAM = 145;
      v_ID := v_ID + 1;

  --    BEGIN
        INSERT INTO DMENUITEM_DBT (T_OBJECTID, T_ISTEMPLATE, T_IIDENTPROGRAM, T_INUMBERPOINT, T_INUMBERFATHER, T_INUMBERLINE, T_ICASEITEM, T_CSYSTEMITEM, T_SZNAMEITEM, T_SZNAMEPROMPT, T_IHELP,T_IPROGITEM)
        VALUES(rec.T_OBJECTID,chr(0),145,v_ID,rec.ParentID,30,5563,'X',' Параметры подключения к Active Directory','Параметры подключения к Active Directory',0,145);
  --    EXCEPTION
  --        WHEN OTHERS THEN NULL;
  --    END;

    END IF;
  END LOOP;
END;
/

