--Наполнение таблиц при реализации операции зачета удержанного НДФЛ
DECLARE
   v_CatID NUMBER := 0;
   v_CatNum NUMBER := 0;
BEGIN

   SELECT T_ID, T_NUMBER
     INTO v_CatID, v_CatNum
     FROM DMCCATEG_DBT
    WHERE T_LEVELTYPE = 1
      AND T_CODE = 'НДФЛ к перечислению, FLR';

   INSERT INTO DMCDOCCAT_DBT(T_CATID,T_CATNUM,T_DOCKIND,T_NOTINUSE,T_RESERVE) VALUES(v_CatID,v_CatNum,4649,CHR(0),CHR(1));

EXCEPTION 
   WHEN OTHERS THEN NULL;
END;
/

DECLARE
   v_CatID NUMBER := 0;
   v_CatNum NUMBER := 0;
BEGIN

   SELECT T_ID, T_NUMBER
     INTO v_CatID, v_CatNum
     FROM DMCCATEG_DBT
    WHERE T_LEVELTYPE = 1
      AND T_CODE = 'НДФЛ к перечислению, FLN';

   INSERT INTO DMCDOCCAT_DBT(T_CATID,T_CATNUM,T_DOCKIND,T_NOTINUSE,T_RESERVE) VALUES(v_CatID,v_CatNum,4649,CHR(0),CHR(1));

EXCEPTION 
   WHEN OTHERS THEN NULL;
END;
/

DECLARE
   v_CatID NUMBER := 0;
   v_CatNum NUMBER := 0;
BEGIN

   SELECT T_ID, T_NUMBER
     INTO v_CatID, v_CatNum
     FROM DMCCATEG_DBT
    WHERE T_LEVELTYPE = 1
      AND T_CODE = 'НДФЛ к перечислению 15%';

   INSERT INTO DMCDOCCAT_DBT(T_CATID,T_CATNUM,T_DOCKIND,T_NOTINUSE,T_RESERVE) VALUES(v_CatID,v_CatNum,4649,CHR(0),CHR(1));

EXCEPTION 
   WHEN OTHERS THEN NULL;
END;
/

DECLARE
   v_CatID NUMBER := 0;
   v_CatNum NUMBER := 0;
BEGIN

   SELECT T_ID, T_NUMBER
     INTO v_CatID, v_CatNum
     FROM DMCCATEG_DBT
    WHERE T_LEVELTYPE = 1
      AND T_CODE = 'НДФЛ к возврату';

   INSERT INTO DMCDOCCAT_DBT(T_CATID,T_CATNUM,T_DOCKIND,T_NOTINUSE,T_RESERVE) VALUES(v_CatID,v_CatNum,4649,CHR(0),CHR(1));

EXCEPTION 
   WHEN OTHERS THEN NULL;
END;
/

DECLARE
   v_CatID NUMBER := 0;
   v_CatNum NUMBER := 0;
BEGIN

   SELECT T_ID, T_NUMBER
     INTO v_CatID, v_CatNum
     FROM DMCCATEG_DBT
    WHERE T_LEVELTYPE = 1
      AND T_CODE = 'НДФЛ к возврату_15%';

   INSERT INTO DMCDOCCAT_DBT(T_CATID,T_CATNUM,T_DOCKIND,T_NOTINUSE,T_RESERVE) VALUES(v_CatID,v_CatNum,4649,CHR(0),CHR(1));

EXCEPTION 
   WHEN OTHERS THEN NULL;
END;
/

BEGIN
   INSERT INTO DOBJECTS_DBT (T_OBJECTTYPE, T_NAME, T_CODE, T_USERNUMBER, T_PARENTOBJECTTYPE, T_SERVICEMACRO, T_MODULE)
   VALUES(194,'Операция зачета удержанного НДФЛ','ЗАЧНДФЛ',0,0,CHR(1),CHR(0));

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DSEQUENT_DBT(T_SEQID,T_DESCRIPTION,T_RESETTYPE,T_RESETDATE,T_RESETTIME,T_RESETMONTHS,T_IDENTPROGRAM,T_PASSEND,T_SYSDATECHECK,
                           T_SYSRESETTIME,T_CHECKHISTORY,T_SEQSTATUS,T_STARTVALUE,T_ENDVALUE,T_BRANCH,T_ISLOCAL,T_LEVEL,T_NOUPGRADE,
                           T_USEMETERINHIST,T_RESETCALCTYPE,T_RESERVE)
  VALUES(365,'Формирование номера операции зачета удержанного НДФЛ',0,TO_DATE('01-01-0001:00:00:00','DD.MM.YYYY HH24:MI:SS'),0,0,'Г',CHR(1),CHR(0),TO_DATE('01-01-0001:00:00:00','DD.MM.YYYY HH24:MI:SS'),CHR(0),0,0,0,1,CHR(0),1,CHR(0),CHR(0),0,CHR(1));
  

  INSERT INTO DREFER_DBT(T_REFID,T_SEQID,T_DESCRIPTION,T_CALCTYPE,T_TEMPLATE,T_MAXLEN,T_MACROFILE,T_MACROPROC,T_STATE,T_BANKDATE,T_SYSDATE,
                         T_SYSTIME,T_USERID,T_IDENTPROGRAM,T_CHECKMISSED,T_CHECKRANGENUMLIMIT,T_CHECKHISTORY,T_CURREFID,T_BRANCH,T_ISLOCAL,
                         T_NOUPGRADE,T_RESERVE)
  VALUES(369,365,'Номер операции зачета удержанного НДФЛ',1,'\n',10,CHR(1),CHR(1),0,TO_DATE('01-01-0001:00:00:00','DD.MM.YYYY HH24:MI:SS'),TO_DATE('01-01-0001:00:00:00','DD.MM.YYYY HH24:MI:SS'),TO_DATE('01-01-0001:00:00:00','DD.MM.YYYY HH24:MI:SS'),0,'Г',CHR(0),CHR(0),CHR(0),0,1,CHR(0),CHR(0),CHR(1));
  

  INSERT INTO DREFOBJ_DBT(T_OBJECTTYPE,T_REFTYPE,T_REFID,T_IDENTPROGRAM,T_NAME,T_STATE,T_BANKDATE,T_SYSDATE,T_SYSTIME,T_USERID,T_SYSTEM,T_RESERVE)
  VALUES(194,1,369,'S','Формирование кода операции зачета удержанного НДФЛ',0,TO_DATE('01-01-0001:00:00:00','DD.MM.YYYY HH24:MI:SS'),TO_DATE('01-01-0001:00:00:00','DD.MM.YYYY HH24:MI:SS'),TO_DATE('01-01-0001:00:00:00','DD.MM.YYYY HH24:MI:SS'),0,'X',CHR(1));

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;

END;
/

DECLARE
BEGIN
  INSERT INTO DOPRKDOC_DBT(T_DOCKIND,T_PRIMARY,T_MODE,T_NAME,T_DBFILE,T_MACRONAME,T_CLASSMACRONAME,T_CLASSNAME,T_PARENTDOCKIND,T_MAXPHASE,T_PROGRAM,T_ORIGIN)
  VALUES(4649,'X',0,'Зачет удержанного НДФЛ','nptxop.dbt',CHR(1),CHR(1),CHR(1),0,0,CHR(0),0);

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;

END;
/

DECLARE
BEGIN
  INSERT INTO DOPRKDATE_DBT(T_DATEKINDID , T_DOCKIND , T_NUMBERDATE , T_NAMEDATE , T_ELIMINATED)
  VALUES(464900000,4649,0,'Дата операции',CHR(0));
EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRKDATE_DBT(T_DATEKINDID , T_DOCKIND , T_NUMBERDATE , T_NAMEDATE , T_ELIMINATED)
  VALUES(464999999,4649,-1,'Дата цепочки',CHR(0));
EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRSTKND_DBT(T_STATUSKINDID,T_CODE,T_NAME,T_DOCKIND,T_SORT,T_ELIMINATED)
  VALUES(46491,'ДО','Документооборот',4649,0,CHR(0));


  INSERT INTO DOPRSTVAL_DBT(T_STATUSKINDID,T_NUMVALUE,T_NAME,T_ELIMINATED)
  VALUES(46491,1,'Открыт',CHR(0));

  INSERT INTO DOPRSTVAL_DBT(T_STATUSKINDID,T_NUMVALUE,T_NAME,T_ELIMINATED)
  VALUES(46491,2,'Закрыт',CHR(0));

  INSERT INTO DOPRSTVAL_DBT(T_STATUSKINDID,T_NUMVALUE,T_NAME,T_ELIMINATED)
  VALUES(46491,3,'Отвергнут',CHR(0));

  INSERT INTO DOPRSTVAL_DBT(T_STATUSKINDID,T_NUMVALUE,T_NAME,T_ELIMINATED)
  VALUES(46491,4,'Зачет',CHR(0));

  INSERT INTO DOPRSTVAL_DBT(T_STATUSKINDID,T_NUMVALUE,T_NAME,T_ELIMINATED)
  VALUES(46491,5,'Отправка в Хранилище',CHR(0));

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;

END;
/

DECLARE
BEGIN
  INSERT INTO DOPRBLOCK_DBT(T_BLOCKID,T_NAME,T_DOCKIND,T_PARENT,T_UPGRADE,T_VERSION,T_VERSIONWEB)
  VALUES(204601,'Инициализация',4649,0,CHR(0),CHR(1),3);

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;

END;
/

DECLARE
BEGIN
  INSERT INTO DOPRBLOCK_DBT(T_BLOCKID,T_NAME,T_DOCKIND,T_PARENT,T_UPGRADE,T_VERSION,T_VERSIONWEB)
  VALUES(204602,'Зачет удержанного НДФЛ',4649,0,CHR(0),CHR(1),4);

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;

END;
/

DECLARE
BEGIN
  INSERT INTO DOPRBLOCK_DBT(T_BLOCKID,T_NAME,T_DOCKIND,T_PARENT,T_UPGRADE,T_VERSION,T_VERSIONWEB)
  VALUES(204603,'Отправка в Хранилище',4649,0,CHR(0),CHR(1),3);

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;

END;
/


DECLARE
BEGIN
  INSERT INTO DOPRSBLCK_DBT(T_BLOCKID,T_STATUSKINDID,T_NUMVALUE,T_DEFAULT)
  VALUES(204601,46491,2,'X');

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRSBLCK_DBT(T_BLOCKID,T_STATUSKINDID,T_NUMVALUE,T_DEFAULT)
  VALUES(204601,46491,4,CHR(0));

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRSBLCK_DBT(T_BLOCKID,T_STATUSKINDID,T_NUMVALUE,T_DEFAULT)
  VALUES(204602,46491,2,CHR(0));

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRSBLCK_DBT(T_BLOCKID,T_STATUSKINDID,T_NUMVALUE,T_DEFAULT)
  VALUES(204602,46491,4,CHR(0));

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRSBLCK_DBT(T_BLOCKID,T_STATUSKINDID,T_NUMVALUE,T_DEFAULT)
  VALUES(204602,46491,5,'X');

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRSBLCK_DBT(T_BLOCKID,T_STATUSKINDID,T_NUMVALUE,T_DEFAULT)
  VALUES(204603,46491,2,'X');

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRSBLCK_DBT(T_BLOCKID,T_STATUSKINDID,T_NUMVALUE,T_DEFAULT)
  VALUES(204603,46491,4,CHR(0));

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRSBLCK_DBT(T_BLOCKID,T_STATUSKINDID,T_NUMVALUE,T_DEFAULT)
  VALUES(204603,46491,5,CHR(0));

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRKSTEP_DBT(T_DOCKIND,T_KIND_ACTION,T_NAME,T_ISALLOWFOROPER,T_OPERORGROUP,T_RESERVE)
  VALUES(4649,1,'Пользовательский шаг',0,CHR(0),CHR(1));
EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;

END;
/

DECLARE
BEGIN
  INSERT INTO DOPROSTEP_DBT(T_BLOCKID,T_NUMBER_STEP,T_KIND_ACTION,T_DAYOFFSET,T_SCALE,T_DAYFLAG,T_CALENDARID,T_SYMBOL,T_PREVIOUS_STEP,T_MODIFICATION,
                            T_CARRY_MACRO,T_PRINT_MACRO,T_POST_MACRO,T_NOTINUSE,T_FIRSTSTEP,T_NAME,T_DATEKINDID,T_REV,T_AUTOEXECUTESTEP,T_ONLYHANDCARRY,
                            T_ISALLOWFOROPER,T_OPERORGROUP,T_RESTRICTEARLYEXECUTION,T_USERTYPES,T_INITDATEKINDID,T_ASKFORDATE,T_BACKOUT,T_ISBACKOUTGROUP,
                            T_MASSEXECUTEMODE,T_ISCASE,T_ISDISTAFFEXECUTE,T_SKIPINITAFTERPLANDATE,T_MASSPACKSIZE)
  VALUES(204601,5,1,0,0,CHR(0),0,CHR(0),0,0,'nptxnettop005.mac',CHR(1),CHR(1),CHR(0),CHR(0),'Инициализация',464900000,CHR(0),'X',CHR(0),0,CHR(0),'X',CHR(1),0,CHR(0),0,CHR(0),0,CHR(0),CHR(0),'X',0);

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/


DECLARE
BEGIN
  INSERT INTO DOPROSTEP_DBT(T_BLOCKID,T_NUMBER_STEP,T_KIND_ACTION,T_DAYOFFSET,T_SCALE,T_DAYFLAG,T_CALENDARID,T_SYMBOL,T_PREVIOUS_STEP,T_MODIFICATION,
                            T_CARRY_MACRO,T_PRINT_MACRO,T_POST_MACRO,T_NOTINUSE,T_FIRSTSTEP,T_NAME,T_DATEKINDID,T_REV,T_AUTOEXECUTESTEP,T_ONLYHANDCARRY,
                            T_ISALLOWFOROPER,T_OPERORGROUP,T_RESTRICTEARLYEXECUTION,T_USERTYPES,T_INITDATEKINDID,T_ASKFORDATE,T_BACKOUT,T_ISBACKOUTGROUP,
                            T_MASSEXECUTEMODE,T_ISCASE,T_ISDISTAFFEXECUTE,T_SKIPINITAFTERPLANDATE,T_MASSPACKSIZE)
  VALUES(204602,10,1,0,0,CHR(0),0,'З',0,0,'nptxnettop010.mac',CHR(1),CHR(1),CHR(0),CHR(0),'Зачет удержанного НДФЛ',464900000,CHR(0),'X',CHR(0),0,CHR(0),'X',CHR(1),0,CHR(0),0,CHR(0),0,CHR(0),CHR(0),'X',0);

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPROSTEP_DBT(T_BLOCKID,T_NUMBER_STEP,T_KIND_ACTION,T_DAYOFFSET,T_SCALE,T_DAYFLAG,T_CALENDARID,T_SYMBOL,T_PREVIOUS_STEP,T_MODIFICATION,
                            T_CARRY_MACRO,T_PRINT_MACRO,T_POST_MACRO,T_NOTINUSE,T_FIRSTSTEP,T_NAME,T_DATEKINDID,T_REV,T_AUTOEXECUTESTEP,T_ONLYHANDCARRY,
                            T_ISALLOWFOROPER,T_OPERORGROUP,T_RESTRICTEARLYEXECUTION,T_USERTYPES,T_INITDATEKINDID,T_ASKFORDATE,T_BACKOUT,T_ISBACKOUTGROUP,
                            T_MASSEXECUTEMODE,T_ISCASE,T_ISDISTAFFEXECUTE,T_SKIPINITAFTERPLANDATE,T_MASSPACKSIZE)
  VALUES(204603,20,1,0,0,CHR(0),0,'О',0,0,'nptxnettop020.mac',CHR(1),'nptxnettop020.mac',CHR(0),CHR(0),'Отправка в Хранилище',464900000,CHR(0),'X',CHR(0),0,CHR(0),'X',CHR(1),0,CHR(0),0,CHR(0),0,CHR(0),CHR(0),'X',0);

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
BEGIN
  INSERT INTO DOPRKOPER_DBT(T_KIND_OPERATION,T_DOCKIND,T_NOTINUSE,T_INITMACRO,T_SYSTYPES,T_NAME,T_SHORTNAME,T_UPGRADE,T_ISMAINTANANCE,T_PARENT,T_VERSION,T_MASSOPRSTART)
  VALUES(2046,4649,CHR(0),CHR(1),CHR(1),'Зачет удержанного НДФЛ','ЗАЧ_НДФЛ',CHR(0),CHR(0),0,CHR(1),CHR(0));

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;

END;
/

DECLARE
BEGIN
  INSERT INTO DOPRINIST_DBT(T_KIND_OPERATION,T_STATUSKINDID,T_NUMVALUE)
  VALUES(2046,46491,1);

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;

END;
/

DECLARE
  v_OperBlockID NUMBER := 0;
BEGIN
  BEGIN
    SELECT T_OPERBLOCKID
      INTO v_OperBlockID
      FROM DOPROBLCK_DBT
     WHERE T_KIND_OPERATION = 2046
       AND T_BLOCKID = 204601;

    EXCEPTION
         WHEN OTHERS THEN v_OperBlockID := 0;
  END;

  IF v_OperBlockID = 0 THEN

    INSERT INTO DOPROBLCK_DBT(T_OPERBLOCKID,T_KIND_OPERATION,T_BLOCKID,T_SORT,T_NOTINUSE,T_NOINSERT,T_NOREPLACE,T_NOCLOSEINSERT,T_ISMANUAL,
                              T_SYMBOLSFORINSERTION,T_SYMBOL)
    VALUES(0,2046,204601,1,CHR(0),CHR(0),CHR(0),'X',CHR(0),CHR(1),CHR(0)) RETURNING T_OPERBLOCKID INTO v_OperBlockID;

    INSERT INTO DOPRCBLCK_DBT(T_OPERBLOCKID,T_STATUSKINDID,T_NUMVALUE,T_CONDITION)
    VALUES(v_OperBlockID,46491,1,0);

  END IF;

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
  v_OperBlockID NUMBER := 0;
BEGIN
  BEGIN
    SELECT T_OPERBLOCKID
      INTO v_OperBlockID
      FROM DOPROBLCK_DBT
     WHERE T_KIND_OPERATION = 2046
       AND T_BLOCKID = 204601;

    EXCEPTION
         WHEN OTHERS THEN v_OperBlockID := 0;
  END;

  IF v_OperBlockID = 0 THEN

    INSERT INTO DOPROBLCK_DBT(T_OPERBLOCKID,T_KIND_OPERATION,T_BLOCKID,T_SORT,T_NOTINUSE,T_NOINSERT,T_NOREPLACE,T_NOCLOSEINSERT,T_ISMANUAL,
                              T_SYMBOLSFORINSERTION,T_SYMBOL)
    VALUES(0,2046,204602,2,CHR(0),CHR(0),CHR(0),CHR(0),CHR(0),CHR(1),'З') RETURNING T_OPERBLOCKID INTO v_OperBlockID;

    INSERT INTO DOPRCBLCK_DBT(T_OPERBLOCKID,T_STATUSKINDID,T_NUMVALUE,T_CONDITION)
    VALUES(v_OperBlockID,46491,4,0);

  END IF;

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

DECLARE
  v_OperBlockID NUMBER := 0;
BEGIN
  BEGIN
    SELECT T_OPERBLOCKID
      INTO v_OperBlockID
      FROM DOPROBLCK_DBT
     WHERE T_KIND_OPERATION = 2046
       AND T_BLOCKID = 204601;

    EXCEPTION
         WHEN OTHERS THEN v_OperBlockID := 0;
  END;

  IF v_OperBlockID = 0 THEN

    INSERT INTO DOPROBLCK_DBT(T_OPERBLOCKID,T_KIND_OPERATION,T_BLOCKID,T_SORT,T_NOTINUSE,T_NOINSERT,T_NOREPLACE,T_NOCLOSEINSERT,T_ISMANUAL,
                              T_SYMBOLSFORINSERTION,T_SYMBOL)
    VALUES(0,2046,204603,3,CHR(0),CHR(0),CHR(0),'X',CHR(0),CHR(1),CHR(0)) RETURNING T_OPERBLOCKID INTO v_OperBlockID;

    INSERT INTO DOPRCBLCK_DBT(T_OPERBLOCKID,T_STATUSKINDID,T_NUMVALUE,T_CONDITION)
    VALUES(v_OperBlockID,46491,5,0);

  END IF;

EXCEPTION 
   WHEN DUP_VAL_ON_INDEX THEN NULL;
END;
/

BEGIN
 EXECUTE IMMEDIATE 'COMMIT';
EXCEPTION
  WHEN OTHERS THEN NULL;
END;
/