-- Изменения по DEF-57243, изменение системных модулей для 'Реестра ВУ'
DECLARE
  logID VARCHAR2(9) := 'DEF-57243';
  -- Записать сообщение в itt_log
  PROCEDURE LogIt( p_message VARCHAR2 )
  AS
  BEGIN
    it_log.log(p_msg => logID||': '||p_message);
  END;
  -- Добавление настройки
  PROCEDURE ChangeItemsyst ( p_IdentProg IN VARCHAR2, p_CaseItem IN NUMBER, p_NameItem IN VARCHAR2, p_Parm IN VARCHAR2 )
  AS
  BEGIN
    LogIt('Изменение в DITEMSYST_DBT '''||p_IdentProg||''', '||p_CaseItem);
    DELETE FROM DITEMSYST_DBT 
       WHERE T_CIDENTPROGRAM = p_IdentProg AND T_ICASEITEM = p_CaseItem;
    INSERT INTO DITEMSYST_DBT(
       T_CIDENTPROGRAM,T_ICASEITEM,T_IKINDMETHOD,T_IKINDPROGRAM,T_IHELP,T_RESERVE,T_SZNAMEITEM,T_PARM 
    ) VALUES(
       p_IdentProg, p_CaseItem, 1, 2, 0, CHR(1), p_NameItem, p_Parm 
    );
    EXECUTE IMMEDIATE 'COMMIT';
    LogIt('Завершено изменение в DITEMSYST_DBT');
  EXCEPTION
    WHEN OTHERS THEN
       LogIt('Ошибка изменения в DITEMSYST_DBT');
       EXECUTE IMMEDIATE 'ROLLBACK';
  END;
BEGIN
  -- Добавление настройки
  ChangeItemsyst( 'S', 20301, 'Реестр ВУ', '6E726567697374657269615F73632E6D6163000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006E726567697374657269615F73632E6D6163000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' );
  ChangeItemsyst( 'Ю', 25125, 'Реестр ВУ', '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006E726567697374657269615F64762E6D6163000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' );
EXCEPTION
  WHEN OTHERS THEN
    it_error.put_error_in_stack;
    it_log.log( p_msg => logID||': exception'
              , p_msg_type => it_log.C_MSG_TYPE__ERROR
              );
    it_error.clear_error_stack;
END;
/
