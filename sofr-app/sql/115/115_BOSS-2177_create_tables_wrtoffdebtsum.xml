<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
    http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">

  <changeSet id="115_BOSS-2177_create_ddl_wrtoffdebtsumop" author="Zhits">
    <createTable tableName="DDL_WRTOFFDEBTSUMOP_DBT" remarks="Экземпляры запуска операции автоматического списания задолженности">
      <column name="T_ID" type="NUMBER(10)" remarks="Идентификатор операции"/>
      <column name="T_PROCDATE" type="DATE" remarks="Дата запуска процедуры"/>
      <column name="T_CLIENTID" type="NUMBER(10)" remarks="Идентификатор клиента"/>
      <column name="T_DLCONTRID" type="NUMBER(10)" remarks="Идентификатор ДБО"/>
      <column name="T_LOG" type="CLOB" remarks="Протокол"/>
      <column name="T_OPER" type="NUMBER(5)" remarks="Операционист"/>
      <column name="T_SYSDATE" type="DATE" defaultValueComputed="SYSDATE" remarks="Системная дата"/>
    </createTable>

    <createIndex indexName="DDL_WRTOFFDEBTSUMOP_DBT_IDX0" tableName="DDL_WRTOFFDEBTSUMOP_DBT" unique="true">
      <column name="T_ID"/>
    </createIndex>	

    <createSequence sequenceName="DDL_WRTOFFDEBTSUMOP_DBT_SEQ" startValue="1" maxValue="999999999999999999999999999" minValue="1" cacheSize="0"/>
  </changeSet>

  <changeSet id="115_BOSS-2177_create_ddl_wrtoffdebtsum" author="Zhits">
    <createTable tableName="DDL_WRTOFFDEBTSUM_DBT" remarks="Таблица общей задолженности клиентов к списанию">
      <column name="T_ID" type="NUMBER(10)" remarks="Идентификатор общей задолженности"/>
      <column name="T_OPID" type="NUMBER(10)" remarks="Идентификатор запуска"/>
      <column name="T_CLIENTID" type="NUMBER(10)" remarks="Идентификатор клиента"/>
      <column name="T_DLCONTRID" type="NUMBER(10)" remarks="Идентификатор ДБО"/>
      <column name="T_RESTDATE" type="DATE" remarks="Дата по которую собирается задолженность и берется остаток"/>
      <column name="T_DEBTSUM" type="NUMBER(32,12)" remarks="Общая сумма задолженности"/>
      <column name="T_DEBTCURRENCY" type="NUMBER(10)" remarks="Валюта задолженности"/>
      <column name="T_RESTACC" type="NUMBER(32,12)" remarks="Общая сумма по счету/счетам в валюте задолженности на дату"/>
      <column name="T_PAYDEBTSUM" type="NUMBER(32,12)" remarks="Сумма списанной задолженности в валюте задолженности"/>
    </createTable>

    <createIndex indexName="DDL_WRTOFFDEBTSUM_DBT_IDX0" tableName="DDL_WRTOFFDEBTSUM_DBT" unique="true">
      <column name="T_ID"/>
    </createIndex>	

    <createSequence sequenceName="DDL_WRTOFFDEBTSUM_DBT_SEQ" startValue="1" maxValue="999999999999999999999999999" minValue="1" cacheSize="0"/>
  </changeSet>

  <changeSet id="115_BOSS-2177_create_ddl_wrtoffdebtsumval" author="Zhits">
    <createTable tableName="DDL_WRTOFFDEBTSUMVAL_DBT" remarks="Таблица расшифровок сумм задолженности к списанию">
      <column name="T_ID" type="NUMBER(10)" remarks="Идентификатор суммы задолженности"/>
      <column name="T_DEBTSUMID" type="NUMBER(10)" remarks="Идентификатор общей задолженности"/>
      <column name="T_DEBTDATE" type="DATE" remarks="Дата возникновения задолженности"/>
      <column name="T_DEBTTYPE" type="NUMBER(5)" remarks="Тип задолженности"/>
      <column name="T_DEBTID" type="NUMBER(10)" remarks="Идентификатор задолженности"/>
      <column name="T_DEBTSUM" type="NUMBER(32,12)" remarks="Сумма соответствующей задолженности"/>
      <column name="T_DEBTCUR" type="NUMBER(10)" remarks="Валюта задолженности"/>
      <column name="T_DEBTSFCONTR" type="NUMBER(10)" remarks="Идентификатор субдоговора"/>
      <column name="T_ISPAYDEBT" type="CHAR(1)" remarks="Признак списания задолженности"/>
      <column name="T_DEBTPAYSUM" type="NUMBER(32,12)" remarks="Сумма списания задолженности"/>
      <column name="T_PAYDEBTOPERID" type="NUMBER(10)" remarks="Идентификатор операции оплаты"/>
    </createTable>

    <createIndex indexName="DDL_WRTOFFDEBTSUMVAL_DBT_IDX0" tableName="DDL_WRTOFFDEBTSUMVAL_DBT" unique="true">
      <column name="T_ID"/>
    </createIndex>	

    <createSequence sequenceName="DDL_WRTOFFDEBTSUMVAL_DBT_SEQ" startValue="1" maxValue="999999999999999999999999999" minValue="1" cacheSize="0"/>
  </changeSet>

  <!--Триггеры на авто-инкрементные поля-->
  <changeSet id="115_BOSS-2177_create_trg_wrtoffdebtsum.sql" context="prod" author="Zhits"> 
    <sqlFile encoding="cp866" endDelimiter="/" path="./115/115_BOSS-2177_create_trg_wrtoffdebtsum.sql" splitStatements="true" stripComments="false"/> 
  </changeSet>

</databaseChangeLog>