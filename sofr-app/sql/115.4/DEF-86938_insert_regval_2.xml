<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:pro="http://www.liquibase.org/xml/ns/pro" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
    http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd ">
  <changeSet id="DEF-86938_insert_regval_2" author="SennikovIV">
    <preConditions onFail="MARK_RAN">
      <sqlCheck expectedResult="0">
        select count(1) from dregparm_dbt where t_parentid = (SELECT t_keyid from (select p.t_keyid,SYS_CONNECT_BY_PATH(p.t_name, '/') Path from dregparm_dbt p connect by prior p.t_keyid=p.t_parentid start with p.t_parentid=0) where Path='/SECUR/СОБУ') and t_name = 'РАЗБИВАТЬ_ВНУТРИ_ФИ_СОБСТ'
      </sqlCheck>
    </preConditions>
    <insert tableName="dregparm_dbt">
      <column name="t_keyId" valueNumeric="0" />
      <column name="t_ParentId" valueComputed="(SELECT t_keyid from (select p.t_keyid,SYS_CONNECT_BY_PATH(p.t_name, '/') Path
                                                    from dregparm_dbt p
                                                 connect by prior p.t_keyid=p.t_parentid start with p.t_parentid=0)
                                            where Path='/SECUR/СОБУ')" />
      <column name="t_Name" value="РАЗБИВАТЬ_ВНУТРИ_ФИ_СОБСТ" />
      <column name="t_Type" valueNumeric="4" />
      <column name="t_Global" valueComputed="CHR(88)" />
      <column name="t_Description" value="Разбивать на пачки внутри одной ФИ, если строк графика по этой ФИ больше чем СТРОК_ГРАФИКА_В_ПАЧКЕ" />
      <column name="t_Security" valueComputed="CHR(0)" />
      <column name="t_IsBranch" valueComputed="CHR(0)" />
    </insert>
    <insert tableName="dregval_dbt">
      <column name="T_KEYID" valueComputed="(select t_keyid 
                                                 from dregparm_dbt 
                                                where t_parentid = (SELECT t_keyid                                               
                                                                      from (select p.t_keyid,SYS_CONNECT_BY_PATH(p.t_name, '/') Path                                     
                                                                              from dregparm_dbt p
                                                                           connect by prior p.t_keyid=p.t_parentid start with p.t_parentid=0)                                 
                                                                     where Path='/SECUR/СОБУ')
                                                                       and t_name = 'РАЗБИВАТЬ_ВНУТРИ_ФИ_СОБСТ' )" />
      <column name="T_REGKIND" valueNumeric="0" />
      <column name="T_OBJECTID" valueNumeric="0" />
      <column name="T_BLOCKUSERVALUE" valueComputed="CHR(0)" />
      <column name="T_EXPDEP" valueNumeric="0" />
      <column name="T_LINTVALUE" valueNumeric="0" />
      <column name="T_LDOUBLEVALUE" valueNumeric="0" />
      <column name="T_FMTBLOBDATA_XXXX" valueComputed="(to_blob(utl_raw.cast_to_raw(chr(0))))" />
    </insert>
  </changeSet>

  <changeSet id="DEF-86938_delete_regval_2" author="SennikovIV">
    <delete tableName="dregval_dbt">
      <where> t_keyid = (select t_keyid from dregparm_dbt WHERE T_NAME = 'МИН_СДЕЛОК_ДЛЯ_РАЗБИВ_ФИ_СОБСТ')  </where>
    </delete>

    <delete tableName="dregparm_dbt">
      <where> T_NAME = 'МИН_СДЕЛОК_ДЛЯ_РАЗБИВ_ФИ_СОБСТ' </where>
    </delete>
  </changeSet>
</databaseChangeLog>